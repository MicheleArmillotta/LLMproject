[
  {
    "function_name": "ffs2_init_acl_post(",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/jffs2/acl.c",
    "lines": "292-309",
    "snippet": "nt jffs2_init_acl_post(struct inode *inode)\n{\n\tint rc;\n\n\tif (inode->i_default_acl) {\n\t\trc = __jffs2_set_acl(inode, JFFS2_XPREFIX_ACL_DEFAULT, inode->i_default_acl);\n\t\tif (rc)\n\t\t\treturn rc;\n\t}\n\n\tif (inode->i_acl) {\n\t\trc = __jffs2_set_acl(inode, JFFS2_XPREFIX_ACL_ACCESS, inode->i_acl);\n\t\tif (rc)\n\t\t\treturn rc;\n\t}\n\n\treturn 0;\n}",
    "includes": [
      "include \"nodelist.h\"",
      "include <linux/mtd/mtd.h>\n#",
      "include <linux/posix_acl_xattr.h>\n#",
      "include <linux/xattr.h>\n#",
      "include <linux/jffs2.h>\n#",
      "include <linux/crc32.h>\n#",
      "include <linux/time.h>\n#",
      "include <linux/sched.h>\n#",
      "include <linux/fs.h>\n#",
      "include <linux/slab.h>\n#",
      "include <linux/kernel.h>\n#"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "_jffs2_set_acl(",
          "args": [
            "node,",
            "FFS2_XPREFIX_ACL_ACCESS,",
            "node->i_acl)"
          ],
          "line": 303
        },
        "resolved": true,
        "details": {
          "function_name": "_jffs2_set_acl(",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/jffs2/acl.c",
          "lines": "211-228",
          "snippet": "tatic int __jffs2_set_acl(struct inode *inode, int xprefix, struct posix_acl *acl)\n{\n\tchar *value = NULL;\n\tsize_t size = 0;\n\tint rc;\n\n\tif (acl) {\n\t\tvalue = jffs2_acl_to_medium(acl, &size);\n\t\tif (IS_ERR(value))\n\t\t\treturn PTR_ERR(value);\n\t}\n\trc = do_jffs2_setxattr(inode, xprefix, \"\", value, size, 0);\n\tif (!value && rc == -ENODATA)\n\t\trc = 0;\n\tkfree(value);\n\n\treturn rc;\n}",
          "includes": [
            "include \"nodelist.h\"",
            "include <linux/mtd/mtd.h>\n#",
            "include <linux/posix_acl_xattr.h>\n#",
            "include <linux/xattr.h>\n#",
            "include <linux/jffs2.h>\n#",
            "include <linux/crc32.h>\n#",
            "include <linux/time.h>\n#",
            "include <linux/sched.h>\n#",
            "include <linux/fs.h>\n#",
            "include <linux/slab.h>\n#",
            "include <linux/kernel.h>\n#"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "include \"nodelist.h\"\ninclude <linux/mtd/mtd.h>\n#\ninclude <linux/posix_acl_xattr.h>\n#\ninclude <linux/xattr.h>\n#\ninclude <linux/jffs2.h>\n#\ninclude <linux/crc32.h>\n#\ninclude <linux/time.h>\n#\ninclude <linux/sched.h>\n#\ninclude <linux/fs.h>\n#\ninclude <linux/slab.h>\n#\ninclude <linux/kernel.h>\n#\n\ntatic int __jffs2_set_acl(struct inode *inode, int xprefix, struct posix_acl *acl)\n{\n\tchar *value = NULL;\n\tsize_t size = 0;\n\tint rc;\n\n\tif (acl) {\n\t\tvalue = jffs2_acl_to_medium(acl, &size);\n\t\tif (IS_ERR(value))\n\t\t\treturn PTR_ERR(value);\n\t}\n\trc = do_jffs2_setxattr(inode, xprefix, \"\", value, size, 0);\n\tif (!value && rc == -ENODATA)\n\t\trc = 0;\n\tkfree(value);\n\n\treturn rc;\n}"
        }
      }
    ],
    "contextual_snippet": "include \"nodelist.h\"\ninclude <linux/mtd/mtd.h>\n#\ninclude <linux/posix_acl_xattr.h>\n#\ninclude <linux/xattr.h>\n#\ninclude <linux/jffs2.h>\n#\ninclude <linux/crc32.h>\n#\ninclude <linux/time.h>\n#\ninclude <linux/sched.h>\n#\ninclude <linux/fs.h>\n#\ninclude <linux/slab.h>\n#\ninclude <linux/kernel.h>\n#\n\nnt jffs2_init_acl_post(struct inode *inode)\n{\n\tint rc;\n\n\tif (inode->i_default_acl) {\n\t\trc = __jffs2_set_acl(inode, JFFS2_XPREFIX_ACL_DEFAULT, inode->i_default_acl);\n\t\tif (rc)\n\t\t\treturn rc;\n\t}\n\n\tif (inode->i_acl) {\n\t\trc = __jffs2_set_acl(inode, JFFS2_XPREFIX_ACL_ACCESS, inode->i_acl);\n\t\tif (rc)\n\t\t\treturn rc;\n\t}\n\n\treturn 0;\n}"
  },
  {
    "function_name": "ffs2_init_acl_pre(",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/jffs2/acl.c",
    "lines": "270-290",
    "snippet": "nt jffs2_init_acl_pre(struct inode *dir_i, struct inode *inode, umode_t *i_mode)\n{\n\tstruct posix_acl *default_acl, *acl;\n\tint rc;\n\n\tcache_no_acl(inode);\n\n\trc = posix_acl_create(dir_i, i_mode, &default_acl, &acl);\n\tif (rc)\n\t\treturn rc;\n\n\tif (default_acl) {\n\t\tset_cached_acl(inode, ACL_TYPE_DEFAULT, default_acl);\n\t\tposix_acl_release(default_acl);\n\t}\n\tif (acl) {\n\t\tset_cached_acl(inode, ACL_TYPE_ACCESS, acl);\n\t\tposix_acl_release(acl);\n\t}\n\treturn 0;\n}",
    "includes": [
      "include \"nodelist.h\"",
      "include <linux/mtd/mtd.h>\n#",
      "include <linux/posix_acl_xattr.h>\n#",
      "include <linux/xattr.h>\n#",
      "include <linux/jffs2.h>\n#",
      "include <linux/crc32.h>\n#",
      "include <linux/time.h>\n#",
      "include <linux/sched.h>\n#",
      "include <linux/fs.h>\n#",
      "include <linux/slab.h>\n#",
      "include <linux/kernel.h>\n#"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "osix_acl_release(",
          "args": [
            "cl)"
          ],
          "line": 287
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "et_cached_acl(",
          "args": [
            "node,",
            "CL_TYPE_ACCESS,",
            "cl)"
          ],
          "line": 286
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "osix_acl_release(",
          "args": [
            "efault_acl)"
          ],
          "line": 283
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "et_cached_acl(",
          "args": [
            "node,",
            "CL_TYPE_DEFAULT,",
            "efault_acl)"
          ],
          "line": 282
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "osix_acl_create(",
          "args": [
            "ir_i,",
            "_mode,",
            "default_acl,",
            "acl)"
          ],
          "line": 277
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ache_no_acl(",
          "args": [
            "node)"
          ],
          "line": 275
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "include \"nodelist.h\"\ninclude <linux/mtd/mtd.h>\n#\ninclude <linux/posix_acl_xattr.h>\n#\ninclude <linux/xattr.h>\n#\ninclude <linux/jffs2.h>\n#\ninclude <linux/crc32.h>\n#\ninclude <linux/time.h>\n#\ninclude <linux/sched.h>\n#\ninclude <linux/fs.h>\n#\ninclude <linux/slab.h>\n#\ninclude <linux/kernel.h>\n#\n\nnt jffs2_init_acl_pre(struct inode *dir_i, struct inode *inode, umode_t *i_mode)\n{\n\tstruct posix_acl *default_acl, *acl;\n\tint rc;\n\n\tcache_no_acl(inode);\n\n\trc = posix_acl_create(dir_i, i_mode, &default_acl, &acl);\n\tif (rc)\n\t\treturn rc;\n\n\tif (default_acl) {\n\t\tset_cached_acl(inode, ACL_TYPE_DEFAULT, default_acl);\n\t\tposix_acl_release(default_acl);\n\t}\n\tif (acl) {\n\t\tset_cached_acl(inode, ACL_TYPE_ACCESS, acl);\n\t\tposix_acl_release(acl);\n\t}\n\treturn 0;\n}"
  },
  {
    "function_name": "ffs2_set_acl(",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/jffs2/acl.c",
    "lines": "230-268",
    "snippet": "nt jffs2_set_acl(struct inode *inode, struct posix_acl *acl, int type)\n{\n\tint rc, xprefix;\n\n\tswitch (type) {\n\tcase ACL_TYPE_ACCESS:\n\t\txprefix = JFFS2_XPREFIX_ACL_ACCESS;\n\t\tif (acl) {\n\t\t\tumode_t mode = inode->i_mode;\n\t\t\trc = posix_acl_equiv_mode(acl, &mode);\n\t\t\tif (rc < 0)\n\t\t\t\treturn rc;\n\t\t\tif (inode->i_mode != mode) {\n\t\t\t\tstruct iattr attr;\n\n\t\t\t\tattr.ia_valid = ATTR_MODE | ATTR_CTIME;\n\t\t\t\tattr.ia_mode = mode;\n\t\t\t\tattr.ia_ctime = CURRENT_TIME_SEC;\n\t\t\t\trc = jffs2_do_setattr(inode, &attr);\n\t\t\t\tif (rc < 0)\n\t\t\t\t\treturn rc;\n\t\t\t}\n\t\t\tif (rc == 0)\n\t\t\t\tacl = NULL;\n\t\t}\n\t\tbreak;\n\tcase ACL_TYPE_DEFAULT:\n\t\txprefix = JFFS2_XPREFIX_ACL_DEFAULT;\n\t\tif (!S_ISDIR(inode->i_mode))\n\t\t\treturn acl ? -EACCES : 0;\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\trc = __jffs2_set_acl(inode, xprefix, acl);\n\tif (!rc)\n\t\tset_cached_acl(inode, type, acl);\n\treturn rc;\n}",
    "includes": [
      "include \"nodelist.h\"",
      "include <linux/mtd/mtd.h>\n#",
      "include <linux/posix_acl_xattr.h>\n#",
      "include <linux/xattr.h>\n#",
      "include <linux/jffs2.h>\n#",
      "include <linux/crc32.h>\n#",
      "include <linux/time.h>\n#",
      "include <linux/sched.h>\n#",
      "include <linux/fs.h>\n#",
      "include <linux/slab.h>\n#",
      "include <linux/kernel.h>\n#"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "et_cached_acl(",
          "args": [
            "node,",
            "ype,",
            "cl)"
          ],
          "line": 266
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_jffs2_set_acl(",
          "args": [
            "node,",
            "prefix,",
            "cl)"
          ],
          "line": 264
        },
        "resolved": true,
        "details": {
          "function_name": "_jffs2_set_acl(",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/jffs2/acl.c",
          "lines": "211-228",
          "snippet": "tatic int __jffs2_set_acl(struct inode *inode, int xprefix, struct posix_acl *acl)\n{\n\tchar *value = NULL;\n\tsize_t size = 0;\n\tint rc;\n\n\tif (acl) {\n\t\tvalue = jffs2_acl_to_medium(acl, &size);\n\t\tif (IS_ERR(value))\n\t\t\treturn PTR_ERR(value);\n\t}\n\trc = do_jffs2_setxattr(inode, xprefix, \"\", value, size, 0);\n\tif (!value && rc == -ENODATA)\n\t\trc = 0;\n\tkfree(value);\n\n\treturn rc;\n}",
          "includes": [
            "include \"nodelist.h\"",
            "include <linux/mtd/mtd.h>\n#",
            "include <linux/posix_acl_xattr.h>\n#",
            "include <linux/xattr.h>\n#",
            "include <linux/jffs2.h>\n#",
            "include <linux/crc32.h>\n#",
            "include <linux/time.h>\n#",
            "include <linux/sched.h>\n#",
            "include <linux/fs.h>\n#",
            "include <linux/slab.h>\n#",
            "include <linux/kernel.h>\n#"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "include \"nodelist.h\"\ninclude <linux/mtd/mtd.h>\n#\ninclude <linux/posix_acl_xattr.h>\n#\ninclude <linux/xattr.h>\n#\ninclude <linux/jffs2.h>\n#\ninclude <linux/crc32.h>\n#\ninclude <linux/time.h>\n#\ninclude <linux/sched.h>\n#\ninclude <linux/fs.h>\n#\ninclude <linux/slab.h>\n#\ninclude <linux/kernel.h>\n#\n\ntatic int __jffs2_set_acl(struct inode *inode, int xprefix, struct posix_acl *acl)\n{\n\tchar *value = NULL;\n\tsize_t size = 0;\n\tint rc;\n\n\tif (acl) {\n\t\tvalue = jffs2_acl_to_medium(acl, &size);\n\t\tif (IS_ERR(value))\n\t\t\treturn PTR_ERR(value);\n\t}\n\trc = do_jffs2_setxattr(inode, xprefix, \"\", value, size, 0);\n\tif (!value && rc == -ENODATA)\n\t\trc = 0;\n\tkfree(value);\n\n\treturn rc;\n}"
        }
      },
      {
        "call_info": {
          "callee": "_ISDIR(",
          "args": [
            "node->i_mode)"
          ],
          "line": 258
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ffs2_do_setattr(",
          "args": [
            "node,",
            "attr)"
          ],
          "line": 248
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "osix_acl_equiv_mode(",
          "args": [
            "cl,",
            "mode)"
          ],
          "line": 239
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "include \"nodelist.h\"\ninclude <linux/mtd/mtd.h>\n#\ninclude <linux/posix_acl_xattr.h>\n#\ninclude <linux/xattr.h>\n#\ninclude <linux/jffs2.h>\n#\ninclude <linux/crc32.h>\n#\ninclude <linux/time.h>\n#\ninclude <linux/sched.h>\n#\ninclude <linux/fs.h>\n#\ninclude <linux/slab.h>\n#\ninclude <linux/kernel.h>\n#\n\nnt jffs2_set_acl(struct inode *inode, struct posix_acl *acl, int type)\n{\n\tint rc, xprefix;\n\n\tswitch (type) {\n\tcase ACL_TYPE_ACCESS:\n\t\txprefix = JFFS2_XPREFIX_ACL_ACCESS;\n\t\tif (acl) {\n\t\t\tumode_t mode = inode->i_mode;\n\t\t\trc = posix_acl_equiv_mode(acl, &mode);\n\t\t\tif (rc < 0)\n\t\t\t\treturn rc;\n\t\t\tif (inode->i_mode != mode) {\n\t\t\t\tstruct iattr attr;\n\n\t\t\t\tattr.ia_valid = ATTR_MODE | ATTR_CTIME;\n\t\t\t\tattr.ia_mode = mode;\n\t\t\t\tattr.ia_ctime = CURRENT_TIME_SEC;\n\t\t\t\trc = jffs2_do_setattr(inode, &attr);\n\t\t\t\tif (rc < 0)\n\t\t\t\t\treturn rc;\n\t\t\t}\n\t\t\tif (rc == 0)\n\t\t\t\tacl = NULL;\n\t\t}\n\t\tbreak;\n\tcase ACL_TYPE_DEFAULT:\n\t\txprefix = JFFS2_XPREFIX_ACL_DEFAULT;\n\t\tif (!S_ISDIR(inode->i_mode))\n\t\t\treturn acl ? -EACCES : 0;\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\trc = __jffs2_set_acl(inode, xprefix, acl);\n\tif (!rc)\n\t\tset_cached_acl(inode, type, acl);\n\treturn rc;\n}"
  },
  {
    "function_name": "_jffs2_set_acl(",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/jffs2/acl.c",
    "lines": "211-228",
    "snippet": "tatic int __jffs2_set_acl(struct inode *inode, int xprefix, struct posix_acl *acl)\n{\n\tchar *value = NULL;\n\tsize_t size = 0;\n\tint rc;\n\n\tif (acl) {\n\t\tvalue = jffs2_acl_to_medium(acl, &size);\n\t\tif (IS_ERR(value))\n\t\t\treturn PTR_ERR(value);\n\t}\n\trc = do_jffs2_setxattr(inode, xprefix, \"\", value, size, 0);\n\tif (!value && rc == -ENODATA)\n\t\trc = 0;\n\tkfree(value);\n\n\treturn rc;\n}",
    "includes": [
      "include \"nodelist.h\"",
      "include <linux/mtd/mtd.h>\n#",
      "include <linux/posix_acl_xattr.h>\n#",
      "include <linux/xattr.h>\n#",
      "include <linux/jffs2.h>\n#",
      "include <linux/crc32.h>\n#",
      "include <linux/time.h>\n#",
      "include <linux/sched.h>\n#",
      "include <linux/fs.h>\n#",
      "include <linux/slab.h>\n#",
      "include <linux/kernel.h>\n#"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free(",
          "args": [
            "alue)"
          ],
          "line": 225
        },
        "resolved": true,
        "details": {
          "function_name": "in_free(",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/jffs2/scan.c",
          "lines": "51-60",
          "snippet": "tatic inline int min_free(struct jffs2_sb_info *c)\n{\n\tuint32_t min = 2 * sizeof(struct jffs2_raw_inode);\n#ifdef CONFIG_JFFS2_FS_WRITEBUFFER\n\tif (!jffs2_can_mark_obsolete(c) && min < c->wbuf_pagesize)\n\t\treturn c->wbuf_pagesize;\n#endif\n\treturn min;\n\n}",
          "includes": [
            "include \"debug.h\"",
            "include \"summary.h\"\n#",
            "include \"nodelist.h\"\n#",
            "include <linux/compiler.h>\n#",
            "include <linux/crc32.h>\n#",
            "include <linux/pagemap.h>\n#",
            "include <linux/mtd/mtd.h>\n#",
            "include <linux/slab.h>\n#",
            "include <linux/sched.h>\n#",
            "include <linux/kernel.h>\n#"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "include \"debug.h\"\ninclude \"summary.h\"\n#\ninclude \"nodelist.h\"\n#\ninclude <linux/compiler.h>\n#\ninclude <linux/crc32.h>\n#\ninclude <linux/pagemap.h>\n#\ninclude <linux/mtd/mtd.h>\n#\ninclude <linux/slab.h>\n#\ninclude <linux/sched.h>\n#\ninclude <linux/kernel.h>\n#\n\ntatic inline int min_free(struct jffs2_sb_info *c)\n{\n\tuint32_t min = 2 * sizeof(struct jffs2_raw_inode);\n#ifdef CONFIG_JFFS2_FS_WRITEBUFFER\n\tif (!jffs2_can_mark_obsolete(c) && min < c->wbuf_pagesize)\n\t\treturn c->wbuf_pagesize;\n#endif\n\treturn min;\n\n}"
        }
      },
      {
        "call_info": {
          "callee": "o_jffs2_setxattr(",
          "args": [
            "node,",
            "prefix,",
            "\",",
            "alue,",
            "ize,",
            ")"
          ],
          "line": 222
        },
        "resolved": true,
        "details": {
          "function_name": "o_jffs2_setxattr(",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/jffs2/xattr.c",
          "lines": "1086-1198",
          "snippet": "nt do_jffs2_setxattr(struct inode *inode, int xprefix, const char *xname,\n\t\t      const char *buffer, size_t size, int flags)\n{\n\tstruct jffs2_inode_info *f = JFFS2_INODE_INFO(inode);\n\tstruct jffs2_sb_info *c = JFFS2_SB_INFO(inode->i_sb);\n\tstruct jffs2_inode_cache *ic = f->inocache;\n\tstruct jffs2_xattr_datum *xd;\n\tstruct jffs2_xattr_ref *ref, *newref, **pref;\n\tuint32_t length, request;\n\tint rc;\n\n\trc = check_xattr_ref_inode(c, ic);\n\tif (unlikely(rc))\n\t\treturn rc;\n\n\trequest = PAD(sizeof(struct jffs2_raw_xattr) + strlen(xname) + 1 + size);\n\trc = jffs2_reserve_space(c, request, &length,\n\t\t\t\t ALLOC_NORMAL, JFFS2_SUMMARY_XATTR_SIZE);\n\tif (rc) {\n\t\tJFFS2_WARNING(\"jffs2_reserve_space()=%d, request=%u\\n\", rc, request);\n\t\treturn rc;\n\t}\n\n\t/* Find existing xattr */\n\tdown_write(&c->xattr_sem);\n retry:\n\tfor (ref=ic->xref, pref=&ic->xref; ref; pref=&ref->next, ref=ref->next) {\n\t\txd = ref->xd;\n\t\tif (xd->xprefix != xprefix)\n\t\t\tcontinue;\n\t\tif (!xd->xname) {\n\t\t\trc = load_xattr_datum(c, xd);\n\t\t\tif (unlikely(rc > 0)) {\n\t\t\t\t*pref = ref->next;\n\t\t\t\tdelete_xattr_ref(c, ref);\n\t\t\t\tgoto retry;\n\t\t\t} else if (unlikely(rc < 0))\n\t\t\t\tgoto out;\n\t\t}\n\t\tif (!strcmp(xd->xname, xname)) {\n\t\t\tif (flags & XATTR_CREATE) {\n\t\t\t\trc = -EEXIST;\n\t\t\t\tgoto out;\n\t\t\t}\n\t\t\tif (!buffer) {\n\t\t\t\tref->ino = ic->ino;\n\t\t\t\tref->xid = xd->xid;\n\t\t\t\tref->xseqno |= XREF_DELETE_MARKER;\n\t\t\t\trc = save_xattr_ref(c, ref);\n\t\t\t\tif (!rc) {\n\t\t\t\t\t*pref = ref->next;\n\t\t\t\t\tspin_lock(&c->erase_completion_lock);\n\t\t\t\t\tref->next = c->xref_dead_list;\n\t\t\t\t\tc->xref_dead_list = ref;\n\t\t\t\t\tspin_unlock(&c->erase_completion_lock);\n\t\t\t\t\tunrefer_xattr_datum(c, xd);\n\t\t\t\t} else {\n\t\t\t\t\tref->ic = ic;\n\t\t\t\t\tref->xd = xd;\n\t\t\t\t\tref->xseqno &= ~XREF_DELETE_MARKER;\n\t\t\t\t}\n\t\t\t\tgoto out;\n\t\t\t}\n\t\t\tgoto found;\n\t\t}\n\t}\n\t/* not found */\n\tif (flags & XATTR_REPLACE) {\n\t\trc = -ENODATA;\n\t\tgoto out;\n\t}\n\tif (!buffer) {\n\t\trc = -ENODATA;\n\t\tgoto out;\n\t}\n found:\n\txd = create_xattr_datum(c, xprefix, xname, buffer, size);\n\tif (IS_ERR(xd)) {\n\t\trc = PTR_ERR(xd);\n\t\tgoto out;\n\t}\n\tup_write(&c->xattr_sem);\n\tjffs2_complete_reservation(c);\n\n\t/* create xattr_ref */\n\trequest = PAD(sizeof(struct jffs2_raw_xref));\n\trc = jffs2_reserve_space(c, request, &length,\n\t\t\t\t ALLOC_NORMAL, JFFS2_SUMMARY_XREF_SIZE);\n\tdown_write(&c->xattr_sem);\n\tif (rc) {\n\t\tJFFS2_WARNING(\"jffs2_reserve_space()=%d, request=%u\\n\", rc, request);\n\t\tunrefer_xattr_datum(c, xd);\n\t\tup_write(&c->xattr_sem);\n\t\treturn rc;\n\t}\n\tif (ref)\n\t\t*pref = ref->next;\n\tnewref = create_xattr_ref(c, ic, xd);\n\tif (IS_ERR(newref)) {\n\t\tif (ref) {\n\t\t\tref->next = ic->xref;\n\t\t\tic->xref = ref;\n\t\t}\n\t\trc = PTR_ERR(newref);\n\t\tunrefer_xattr_datum(c, xd);\n\t} else if (ref) {\n\t\tdelete_xattr_ref(c, ref);\n\t}\n out:\n\tup_write(&c->xattr_sem);\n\tjffs2_complete_reservation(c);\n\treturn rc;\n}",
          "includes": [
            "include \"nodelist.h\"\n/",
            "include <linux/mtd/mtd.h>\n#",
            "include <linux/posix_acl_xattr.h>\n#",
            "include <linux/xattr.h>\n#",
            "include <linux/jffs2.h>\n#",
            "include <linux/crc32.h>\n#",
            "include <linux/highmem.h>\n#",
            "include <linux/pagemap.h>\n#",
            "include <linux/time.h>\n#",
            "include <linux/fs.h>\n#",
            "include <linux/slab.h>\n#",
            "include <linux/kernel.h>\n#"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "include \"nodelist.h\"\n/\ninclude <linux/mtd/mtd.h>\n#\ninclude <linux/posix_acl_xattr.h>\n#\ninclude <linux/xattr.h>\n#\ninclude <linux/jffs2.h>\n#\ninclude <linux/crc32.h>\n#\ninclude <linux/highmem.h>\n#\ninclude <linux/pagemap.h>\n#\ninclude <linux/time.h>\n#\ninclude <linux/fs.h>\n#\ninclude <linux/slab.h>\n#\ninclude <linux/kernel.h>\n#\n\nnt do_jffs2_setxattr(struct inode *inode, int xprefix, const char *xname,\n\t\t      const char *buffer, size_t size, int flags)\n{\n\tstruct jffs2_inode_info *f = JFFS2_INODE_INFO(inode);\n\tstruct jffs2_sb_info *c = JFFS2_SB_INFO(inode->i_sb);\n\tstruct jffs2_inode_cache *ic = f->inocache;\n\tstruct jffs2_xattr_datum *xd;\n\tstruct jffs2_xattr_ref *ref, *newref, **pref;\n\tuint32_t length, request;\n\tint rc;\n\n\trc = check_xattr_ref_inode(c, ic);\n\tif (unlikely(rc))\n\t\treturn rc;\n\n\trequest = PAD(sizeof(struct jffs2_raw_xattr) + strlen(xname) + 1 + size);\n\trc = jffs2_reserve_space(c, request, &length,\n\t\t\t\t ALLOC_NORMAL, JFFS2_SUMMARY_XATTR_SIZE);\n\tif (rc) {\n\t\tJFFS2_WARNING(\"jffs2_reserve_space()=%d, request=%u\\n\", rc, request);\n\t\treturn rc;\n\t}\n\n\t/* Find existing xattr */\n\tdown_write(&c->xattr_sem);\n retry:\n\tfor (ref=ic->xref, pref=&ic->xref; ref; pref=&ref->next, ref=ref->next) {\n\t\txd = ref->xd;\n\t\tif (xd->xprefix != xprefix)\n\t\t\tcontinue;\n\t\tif (!xd->xname) {\n\t\t\trc = load_xattr_datum(c, xd);\n\t\t\tif (unlikely(rc > 0)) {\n\t\t\t\t*pref = ref->next;\n\t\t\t\tdelete_xattr_ref(c, ref);\n\t\t\t\tgoto retry;\n\t\t\t} else if (unlikely(rc < 0))\n\t\t\t\tgoto out;\n\t\t}\n\t\tif (!strcmp(xd->xname, xname)) {\n\t\t\tif (flags & XATTR_CREATE) {\n\t\t\t\trc = -EEXIST;\n\t\t\t\tgoto out;\n\t\t\t}\n\t\t\tif (!buffer) {\n\t\t\t\tref->ino = ic->ino;\n\t\t\t\tref->xid = xd->xid;\n\t\t\t\tref->xseqno |= XREF_DELETE_MARKER;\n\t\t\t\trc = save_xattr_ref(c, ref);\n\t\t\t\tif (!rc) {\n\t\t\t\t\t*pref = ref->next;\n\t\t\t\t\tspin_lock(&c->erase_completion_lock);\n\t\t\t\t\tref->next = c->xref_dead_list;\n\t\t\t\t\tc->xref_dead_list = ref;\n\t\t\t\t\tspin_unlock(&c->erase_completion_lock);\n\t\t\t\t\tunrefer_xattr_datum(c, xd);\n\t\t\t\t} else {\n\t\t\t\t\tref->ic = ic;\n\t\t\t\t\tref->xd = xd;\n\t\t\t\t\tref->xseqno &= ~XREF_DELETE_MARKER;\n\t\t\t\t}\n\t\t\t\tgoto out;\n\t\t\t}\n\t\t\tgoto found;\n\t\t}\n\t}\n\t/* not found */\n\tif (flags & XATTR_REPLACE) {\n\t\trc = -ENODATA;\n\t\tgoto out;\n\t}\n\tif (!buffer) {\n\t\trc = -ENODATA;\n\t\tgoto out;\n\t}\n found:\n\txd = create_xattr_datum(c, xprefix, xname, buffer, size);\n\tif (IS_ERR(xd)) {\n\t\trc = PTR_ERR(xd);\n\t\tgoto out;\n\t}\n\tup_write(&c->xattr_sem);\n\tjffs2_complete_reservation(c);\n\n\t/* create xattr_ref */\n\trequest = PAD(sizeof(struct jffs2_raw_xref));\n\trc = jffs2_reserve_space(c, request, &length,\n\t\t\t\t ALLOC_NORMAL, JFFS2_SUMMARY_XREF_SIZE);\n\tdown_write(&c->xattr_sem);\n\tif (rc) {\n\t\tJFFS2_WARNING(\"jffs2_reserve_space()=%d, request=%u\\n\", rc, request);\n\t\tunrefer_xattr_datum(c, xd);\n\t\tup_write(&c->xattr_sem);\n\t\treturn rc;\n\t}\n\tif (ref)\n\t\t*pref = ref->next;\n\tnewref = create_xattr_ref(c, ic, xd);\n\tif (IS_ERR(newref)) {\n\t\tif (ref) {\n\t\t\tref->next = ic->xref;\n\t\t\tic->xref = ref;\n\t\t}\n\t\trc = PTR_ERR(newref);\n\t\tunrefer_xattr_datum(c, xd);\n\t} else if (ref) {\n\t\tdelete_xattr_ref(c, ref);\n\t}\n out:\n\tup_write(&c->xattr_sem);\n\tjffs2_complete_reservation(c);\n\treturn rc;\n}"
        }
      },
      {
        "call_info": {
          "callee": "TR_ERR(",
          "args": [
            "alue)"
          ],
          "line": 220
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "S_ERR(",
          "args": [
            "alue)"
          ],
          "line": 219
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ffs2_acl_to_medium(",
          "args": [
            "cl,",
            "size)"
          ],
          "line": 218
        },
        "resolved": true,
        "details": {
          "function_name": "ffs2_acl_to_medium(",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/jffs2/acl.c",
          "lines": "128-173",
          "snippet": "tatic void *jffs2_acl_to_medium(const struct posix_acl *acl, size_t *size)\n{\n\tstruct jffs2_acl_header *header;\n\tstruct jffs2_acl_entry *entry;\n\tvoid *e;\n\tsize_t i;\n\n\t*size = jffs2_acl_size(acl->a_count);\n\theader = kmalloc(sizeof(*header) + acl->a_count * sizeof(*entry), GFP_KERNEL);\n\tif (!header)\n\t\treturn ERR_PTR(-ENOMEM);\n\theader->a_version = cpu_to_je32(JFFS2_ACL_VERSION);\n\te = header + 1;\n\tfor (i=0; i < acl->a_count; i++) {\n\t\tconst struct posix_acl_entry *acl_e = &acl->a_entries[i];\n\t\tentry = e;\n\t\tentry->e_tag = cpu_to_je16(acl_e->e_tag);\n\t\tentry->e_perm = cpu_to_je16(acl_e->e_perm);\n\t\tswitch(acl_e->e_tag) {\n\t\t\tcase ACL_USER:\n\t\t\t\tentry->e_id = cpu_to_je32(\n\t\t\t\t\tfrom_kuid(&init_user_ns, acl_e->e_uid));\n\t\t\t\te += sizeof(struct jffs2_acl_entry);\n\t\t\t\tbreak;\n\t\t\tcase ACL_GROUP:\n\t\t\t\tentry->e_id = cpu_to_je32(\n\t\t\t\t\tfrom_kgid(&init_user_ns, acl_e->e_gid));\n\t\t\t\te += sizeof(struct jffs2_acl_entry);\n\t\t\t\tbreak;\n\n\t\t\tcase ACL_USER_OBJ:\n\t\t\tcase ACL_GROUP_OBJ:\n\t\t\tcase ACL_MASK:\n\t\t\tcase ACL_OTHER:\n\t\t\t\te += sizeof(struct jffs2_acl_entry_short);\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\tgoto fail;\n\t\t}\n\t}\n\treturn header;\n fail:\n\tkfree(header);\n\treturn ERR_PTR(-EINVAL);\n}",
          "includes": [
            "include \"nodelist.h\"",
            "include <linux/mtd/mtd.h>\n#",
            "include <linux/posix_acl_xattr.h>\n#",
            "include <linux/xattr.h>\n#",
            "include <linux/jffs2.h>\n#",
            "include <linux/crc32.h>\n#",
            "include <linux/time.h>\n#",
            "include <linux/sched.h>\n#",
            "include <linux/fs.h>\n#",
            "include <linux/slab.h>\n#",
            "include <linux/kernel.h>\n#"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "include \"nodelist.h\"\ninclude <linux/mtd/mtd.h>\n#\ninclude <linux/posix_acl_xattr.h>\n#\ninclude <linux/xattr.h>\n#\ninclude <linux/jffs2.h>\n#\ninclude <linux/crc32.h>\n#\ninclude <linux/time.h>\n#\ninclude <linux/sched.h>\n#\ninclude <linux/fs.h>\n#\ninclude <linux/slab.h>\n#\ninclude <linux/kernel.h>\n#\n\ntatic void *jffs2_acl_to_medium(const struct posix_acl *acl, size_t *size)\n{\n\tstruct jffs2_acl_header *header;\n\tstruct jffs2_acl_entry *entry;\n\tvoid *e;\n\tsize_t i;\n\n\t*size = jffs2_acl_size(acl->a_count);\n\theader = kmalloc(sizeof(*header) + acl->a_count * sizeof(*entry), GFP_KERNEL);\n\tif (!header)\n\t\treturn ERR_PTR(-ENOMEM);\n\theader->a_version = cpu_to_je32(JFFS2_ACL_VERSION);\n\te = header + 1;\n\tfor (i=0; i < acl->a_count; i++) {\n\t\tconst struct posix_acl_entry *acl_e = &acl->a_entries[i];\n\t\tentry = e;\n\t\tentry->e_tag = cpu_to_je16(acl_e->e_tag);\n\t\tentry->e_perm = cpu_to_je16(acl_e->e_perm);\n\t\tswitch(acl_e->e_tag) {\n\t\t\tcase ACL_USER:\n\t\t\t\tentry->e_id = cpu_to_je32(\n\t\t\t\t\tfrom_kuid(&init_user_ns, acl_e->e_uid));\n\t\t\t\te += sizeof(struct jffs2_acl_entry);\n\t\t\t\tbreak;\n\t\t\tcase ACL_GROUP:\n\t\t\t\tentry->e_id = cpu_to_je32(\n\t\t\t\t\tfrom_kgid(&init_user_ns, acl_e->e_gid));\n\t\t\t\te += sizeof(struct jffs2_acl_entry);\n\t\t\t\tbreak;\n\n\t\t\tcase ACL_USER_OBJ:\n\t\t\tcase ACL_GROUP_OBJ:\n\t\t\tcase ACL_MASK:\n\t\t\tcase ACL_OTHER:\n\t\t\t\te += sizeof(struct jffs2_acl_entry_short);\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\tgoto fail;\n\t\t}\n\t}\n\treturn header;\n fail:\n\tkfree(header);\n\treturn ERR_PTR(-EINVAL);\n}"
        }
      }
    ],
    "contextual_snippet": "include \"nodelist.h\"\ninclude <linux/mtd/mtd.h>\n#\ninclude <linux/posix_acl_xattr.h>\n#\ninclude <linux/xattr.h>\n#\ninclude <linux/jffs2.h>\n#\ninclude <linux/crc32.h>\n#\ninclude <linux/time.h>\n#\ninclude <linux/sched.h>\n#\ninclude <linux/fs.h>\n#\ninclude <linux/slab.h>\n#\ninclude <linux/kernel.h>\n#\n\ntatic int __jffs2_set_acl(struct inode *inode, int xprefix, struct posix_acl *acl)\n{\n\tchar *value = NULL;\n\tsize_t size = 0;\n\tint rc;\n\n\tif (acl) {\n\t\tvalue = jffs2_acl_to_medium(acl, &size);\n\t\tif (IS_ERR(value))\n\t\t\treturn PTR_ERR(value);\n\t}\n\trc = do_jffs2_setxattr(inode, xprefix, \"\", value, size, 0);\n\tif (!value && rc == -ENODATA)\n\t\trc = 0;\n\tkfree(value);\n\n\treturn rc;\n}"
  },
  {
    "function_name": "ffs2_get_acl(",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/jffs2/acl.c",
    "lines": "175-209",
    "snippet": "truct posix_acl *jffs2_get_acl(struct inode *inode, int type)\n{\n\tstruct posix_acl *acl;\n\tchar *value = NULL;\n\tint rc, xprefix;\n\n\tswitch (type) {\n\tcase ACL_TYPE_ACCESS:\n\t\txprefix = JFFS2_XPREFIX_ACL_ACCESS;\n\t\tbreak;\n\tcase ACL_TYPE_DEFAULT:\n\t\txprefix = JFFS2_XPREFIX_ACL_DEFAULT;\n\t\tbreak;\n\tdefault:\n\t\tBUG();\n\t}\n\trc = do_jffs2_getxattr(inode, xprefix, \"\", NULL, 0);\n\tif (rc > 0) {\n\t\tvalue = kmalloc(rc, GFP_KERNEL);\n\t\tif (!value)\n\t\t\treturn ERR_PTR(-ENOMEM);\n\t\trc = do_jffs2_getxattr(inode, xprefix, \"\", value, rc);\n\t}\n\tif (rc > 0) {\n\t\tacl = jffs2_acl_from_medium(value, rc);\n\t} else if (rc == -ENODATA || rc == -ENOSYS) {\n\t\tacl = NULL;\n\t} else {\n\t\tacl = ERR_PTR(rc);\n\t}\n\tkfree(value);\n\tif (!IS_ERR(acl))\n\t\tset_cached_acl(inode, type, acl);\n\treturn acl;\n}",
    "includes": [
      "include \"nodelist.h\"",
      "include <linux/mtd/mtd.h>\n#",
      "include <linux/posix_acl_xattr.h>\n#",
      "include <linux/xattr.h>\n#",
      "include <linux/jffs2.h>\n#",
      "include <linux/crc32.h>\n#",
      "include <linux/time.h>\n#",
      "include <linux/sched.h>\n#",
      "include <linux/fs.h>\n#",
      "include <linux/slab.h>\n#",
      "include <linux/kernel.h>\n#"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "et_cached_acl(",
          "args": [
            "node,",
            "ype,",
            "cl)"
          ],
          "line": 207
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "S_ERR(",
          "args": [
            "cl)"
          ],
          "line": 206
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "free(",
          "args": [
            "alue)"
          ],
          "line": 205
        },
        "resolved": true,
        "details": {
          "function_name": "in_free(",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/jffs2/scan.c",
          "lines": "51-60",
          "snippet": "tatic inline int min_free(struct jffs2_sb_info *c)\n{\n\tuint32_t min = 2 * sizeof(struct jffs2_raw_inode);\n#ifdef CONFIG_JFFS2_FS_WRITEBUFFER\n\tif (!jffs2_can_mark_obsolete(c) && min < c->wbuf_pagesize)\n\t\treturn c->wbuf_pagesize;\n#endif\n\treturn min;\n\n}",
          "includes": [
            "include \"debug.h\"",
            "include \"summary.h\"\n#",
            "include \"nodelist.h\"\n#",
            "include <linux/compiler.h>\n#",
            "include <linux/crc32.h>\n#",
            "include <linux/pagemap.h>\n#",
            "include <linux/mtd/mtd.h>\n#",
            "include <linux/slab.h>\n#",
            "include <linux/sched.h>\n#",
            "include <linux/kernel.h>\n#"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "include \"debug.h\"\ninclude \"summary.h\"\n#\ninclude \"nodelist.h\"\n#\ninclude <linux/compiler.h>\n#\ninclude <linux/crc32.h>\n#\ninclude <linux/pagemap.h>\n#\ninclude <linux/mtd/mtd.h>\n#\ninclude <linux/slab.h>\n#\ninclude <linux/sched.h>\n#\ninclude <linux/kernel.h>\n#\n\ntatic inline int min_free(struct jffs2_sb_info *c)\n{\n\tuint32_t min = 2 * sizeof(struct jffs2_raw_inode);\n#ifdef CONFIG_JFFS2_FS_WRITEBUFFER\n\tif (!jffs2_can_mark_obsolete(c) && min < c->wbuf_pagesize)\n\t\treturn c->wbuf_pagesize;\n#endif\n\treturn min;\n\n}"
        }
      },
      {
        "call_info": {
          "callee": "RR_PTR(",
          "args": [
            "c)"
          ],
          "line": 203
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ffs2_acl_from_medium(",
          "args": [
            "alue,",
            "c)"
          ],
          "line": 199
        },
        "resolved": true,
        "details": {
          "function_name": "ffs2_acl_from_medium(",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/jffs2/acl.c",
          "lines": "55-126",
          "snippet": "tatic struct posix_acl *jffs2_acl_from_medium(void *value, size_t size)\n{\n\tvoid *end = value + size;\n\tstruct jffs2_acl_header *header = value;\n\tstruct jffs2_acl_entry *entry;\n\tstruct posix_acl *acl;\n\tuint32_t ver;\n\tint i, count;\n\n\tif (!value)\n\t\treturn NULL;\n\tif (size < sizeof(struct jffs2_acl_header))\n\t\treturn ERR_PTR(-EINVAL);\n\tver = je32_to_cpu(header->a_version);\n\tif (ver != JFFS2_ACL_VERSION) {\n\t\tJFFS2_WARNING(\"Invalid ACL version. (=%u)\\n\", ver);\n\t\treturn ERR_PTR(-EINVAL);\n\t}\n\n\tvalue += sizeof(struct jffs2_acl_header);\n\tcount = jffs2_acl_count(size);\n\tif (count < 0)\n\t\treturn ERR_PTR(-EINVAL);\n\tif (count == 0)\n\t\treturn NULL;\n\n\tacl = posix_acl_alloc(count, GFP_KERNEL);\n\tif (!acl)\n\t\treturn ERR_PTR(-ENOMEM);\n\n\tfor (i=0; i < count; i++) {\n\t\tentry = value;\n\t\tif (value + sizeof(struct jffs2_acl_entry_short) > end)\n\t\t\tgoto fail;\n\t\tacl->a_entries[i].e_tag = je16_to_cpu(entry->e_tag);\n\t\tacl->a_entries[i].e_perm = je16_to_cpu(entry->e_perm);\n\t\tswitch (acl->a_entries[i].e_tag) {\n\t\t\tcase ACL_USER_OBJ:\n\t\t\tcase ACL_GROUP_OBJ:\n\t\t\tcase ACL_MASK:\n\t\t\tcase ACL_OTHER:\n\t\t\t\tvalue += sizeof(struct jffs2_acl_entry_short);\n\t\t\t\tbreak;\n\n\t\t\tcase ACL_USER:\n\t\t\t\tvalue += sizeof(struct jffs2_acl_entry);\n\t\t\t\tif (value > end)\n\t\t\t\t\tgoto fail;\n\t\t\t\tacl->a_entries[i].e_uid =\n\t\t\t\t\tmake_kuid(&init_user_ns,\n\t\t\t\t\t\t  je32_to_cpu(entry->e_id));\n\t\t\t\tbreak;\n\t\t\tcase ACL_GROUP:\n\t\t\t\tvalue += sizeof(struct jffs2_acl_entry);\n\t\t\t\tif (value > end)\n\t\t\t\t\tgoto fail;\n\t\t\t\tacl->a_entries[i].e_gid =\n\t\t\t\t\tmake_kgid(&init_user_ns,\n\t\t\t\t\t\t  je32_to_cpu(entry->e_id));\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\tgoto fail;\n\t\t}\n\t}\n\tif (value != end)\n\t\tgoto fail;\n\treturn acl;\n fail:\n\tposix_acl_release(acl);\n\treturn ERR_PTR(-EINVAL);\n}",
          "includes": [
            "include \"nodelist.h\"",
            "include <linux/mtd/mtd.h>\n#",
            "include <linux/posix_acl_xattr.h>\n#",
            "include <linux/xattr.h>\n#",
            "include <linux/jffs2.h>\n#",
            "include <linux/crc32.h>\n#",
            "include <linux/time.h>\n#",
            "include <linux/sched.h>\n#",
            "include <linux/fs.h>\n#",
            "include <linux/slab.h>\n#",
            "include <linux/kernel.h>\n#"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "include \"nodelist.h\"\ninclude <linux/mtd/mtd.h>\n#\ninclude <linux/posix_acl_xattr.h>\n#\ninclude <linux/xattr.h>\n#\ninclude <linux/jffs2.h>\n#\ninclude <linux/crc32.h>\n#\ninclude <linux/time.h>\n#\ninclude <linux/sched.h>\n#\ninclude <linux/fs.h>\n#\ninclude <linux/slab.h>\n#\ninclude <linux/kernel.h>\n#\n\ntatic struct posix_acl *jffs2_acl_from_medium(void *value, size_t size)\n{\n\tvoid *end = value + size;\n\tstruct jffs2_acl_header *header = value;\n\tstruct jffs2_acl_entry *entry;\n\tstruct posix_acl *acl;\n\tuint32_t ver;\n\tint i, count;\n\n\tif (!value)\n\t\treturn NULL;\n\tif (size < sizeof(struct jffs2_acl_header))\n\t\treturn ERR_PTR(-EINVAL);\n\tver = je32_to_cpu(header->a_version);\n\tif (ver != JFFS2_ACL_VERSION) {\n\t\tJFFS2_WARNING(\"Invalid ACL version. (=%u)\\n\", ver);\n\t\treturn ERR_PTR(-EINVAL);\n\t}\n\n\tvalue += sizeof(struct jffs2_acl_header);\n\tcount = jffs2_acl_count(size);\n\tif (count < 0)\n\t\treturn ERR_PTR(-EINVAL);\n\tif (count == 0)\n\t\treturn NULL;\n\n\tacl = posix_acl_alloc(count, GFP_KERNEL);\n\tif (!acl)\n\t\treturn ERR_PTR(-ENOMEM);\n\n\tfor (i=0; i < count; i++) {\n\t\tentry = value;\n\t\tif (value + sizeof(struct jffs2_acl_entry_short) > end)\n\t\t\tgoto fail;\n\t\tacl->a_entries[i].e_tag = je16_to_cpu(entry->e_tag);\n\t\tacl->a_entries[i].e_perm = je16_to_cpu(entry->e_perm);\n\t\tswitch (acl->a_entries[i].e_tag) {\n\t\t\tcase ACL_USER_OBJ:\n\t\t\tcase ACL_GROUP_OBJ:\n\t\t\tcase ACL_MASK:\n\t\t\tcase ACL_OTHER:\n\t\t\t\tvalue += sizeof(struct jffs2_acl_entry_short);\n\t\t\t\tbreak;\n\n\t\t\tcase ACL_USER:\n\t\t\t\tvalue += sizeof(struct jffs2_acl_entry);\n\t\t\t\tif (value > end)\n\t\t\t\t\tgoto fail;\n\t\t\t\tacl->a_entries[i].e_uid =\n\t\t\t\t\tmake_kuid(&init_user_ns,\n\t\t\t\t\t\t  je32_to_cpu(entry->e_id));\n\t\t\t\tbreak;\n\t\t\tcase ACL_GROUP:\n\t\t\t\tvalue += sizeof(struct jffs2_acl_entry);\n\t\t\t\tif (value > end)\n\t\t\t\t\tgoto fail;\n\t\t\t\tacl->a_entries[i].e_gid =\n\t\t\t\t\tmake_kgid(&init_user_ns,\n\t\t\t\t\t\t  je32_to_cpu(entry->e_id));\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\tgoto fail;\n\t\t}\n\t}\n\tif (value != end)\n\t\tgoto fail;\n\treturn acl;\n fail:\n\tposix_acl_release(acl);\n\treturn ERR_PTR(-EINVAL);\n}"
        }
      },
      {
        "call_info": {
          "callee": "o_jffs2_getxattr(",
          "args": [
            "node,",
            "prefix,",
            "\",",
            "alue,",
            "c)"
          ],
          "line": 196
        },
        "resolved": true,
        "details": {
          "function_name": "o_jffs2_getxattr(",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/jffs2/xattr.c",
          "lines": "1024-1084",
          "snippet": "nt do_jffs2_getxattr(struct inode *inode, int xprefix, const char *xname,\n\t\t      char *buffer, size_t size)\n{\n\tstruct jffs2_inode_info *f = JFFS2_INODE_INFO(inode);\n\tstruct jffs2_sb_info *c = JFFS2_SB_INFO(inode->i_sb);\n\tstruct jffs2_inode_cache *ic = f->inocache;\n\tstruct jffs2_xattr_datum *xd;\n\tstruct jffs2_xattr_ref *ref, **pref;\n\tint rc, retry = 0;\n\n\trc = check_xattr_ref_inode(c, ic);\n\tif (unlikely(rc))\n\t\treturn rc;\n\n\tdown_read(&c->xattr_sem);\n retry:\n\tfor (ref=ic->xref, pref=&ic->xref; ref; pref=&ref->next, ref=ref->next) {\n\t\tBUG_ON(ref->ic!=ic);\n\n\t\txd = ref->xd;\n\t\tif (xd->xprefix != xprefix)\n\t\t\tcontinue;\n\t\tif (!xd->xname) {\n\t\t\t/* xdatum is unchached */\n\t\t\tif (!retry) {\n\t\t\t\tretry = 1;\n\t\t\t\tup_read(&c->xattr_sem);\n\t\t\t\tdown_write(&c->xattr_sem);\n\t\t\t\tgoto retry;\n\t\t\t} else {\n\t\t\t\trc = load_xattr_datum(c, xd);\n\t\t\t\tif (unlikely(rc > 0)) {\n\t\t\t\t\t*pref = ref->next;\n\t\t\t\t\tdelete_xattr_ref(c, ref);\n\t\t\t\t\tgoto retry;\n\t\t\t\t} else if (unlikely(rc < 0)) {\n\t\t\t\t\tgoto out;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (!strcmp(xname, xd->xname)) {\n\t\t\trc = xd->value_len;\n\t\t\tif (buffer) {\n\t\t\t\tif (size < rc) {\n\t\t\t\t\trc = -ERANGE;\n\t\t\t\t} else {\n\t\t\t\t\tmemcpy(buffer, xd->xvalue, rc);\n\t\t\t\t}\n\t\t\t}\n\t\t\tgoto out;\n\t\t}\n\t}\n\trc = -ENODATA;\n out:\n\tif (!retry) {\n\t\tup_read(&c->xattr_sem);\n\t} else {\n\t\tup_write(&c->xattr_sem);\n\t}\n\treturn rc;\n}",
          "includes": [
            "include \"nodelist.h\"\n/",
            "include <linux/mtd/mtd.h>\n#",
            "include <linux/posix_acl_xattr.h>\n#",
            "include <linux/xattr.h>\n#",
            "include <linux/jffs2.h>\n#",
            "include <linux/crc32.h>\n#",
            "include <linux/highmem.h>\n#",
            "include <linux/pagemap.h>\n#",
            "include <linux/time.h>\n#",
            "include <linux/fs.h>\n#",
            "include <linux/slab.h>\n#",
            "include <linux/kernel.h>\n#"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "include \"nodelist.h\"\n/\ninclude <linux/mtd/mtd.h>\n#\ninclude <linux/posix_acl_xattr.h>\n#\ninclude <linux/xattr.h>\n#\ninclude <linux/jffs2.h>\n#\ninclude <linux/crc32.h>\n#\ninclude <linux/highmem.h>\n#\ninclude <linux/pagemap.h>\n#\ninclude <linux/time.h>\n#\ninclude <linux/fs.h>\n#\ninclude <linux/slab.h>\n#\ninclude <linux/kernel.h>\n#\n\nnt do_jffs2_getxattr(struct inode *inode, int xprefix, const char *xname,\n\t\t      char *buffer, size_t size)\n{\n\tstruct jffs2_inode_info *f = JFFS2_INODE_INFO(inode);\n\tstruct jffs2_sb_info *c = JFFS2_SB_INFO(inode->i_sb);\n\tstruct jffs2_inode_cache *ic = f->inocache;\n\tstruct jffs2_xattr_datum *xd;\n\tstruct jffs2_xattr_ref *ref, **pref;\n\tint rc, retry = 0;\n\n\trc = check_xattr_ref_inode(c, ic);\n\tif (unlikely(rc))\n\t\treturn rc;\n\n\tdown_read(&c->xattr_sem);\n retry:\n\tfor (ref=ic->xref, pref=&ic->xref; ref; pref=&ref->next, ref=ref->next) {\n\t\tBUG_ON(ref->ic!=ic);\n\n\t\txd = ref->xd;\n\t\tif (xd->xprefix != xprefix)\n\t\t\tcontinue;\n\t\tif (!xd->xname) {\n\t\t\t/* xdatum is unchached */\n\t\t\tif (!retry) {\n\t\t\t\tretry = 1;\n\t\t\t\tup_read(&c->xattr_sem);\n\t\t\t\tdown_write(&c->xattr_sem);\n\t\t\t\tgoto retry;\n\t\t\t} else {\n\t\t\t\trc = load_xattr_datum(c, xd);\n\t\t\t\tif (unlikely(rc > 0)) {\n\t\t\t\t\t*pref = ref->next;\n\t\t\t\t\tdelete_xattr_ref(c, ref);\n\t\t\t\t\tgoto retry;\n\t\t\t\t} else if (unlikely(rc < 0)) {\n\t\t\t\t\tgoto out;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (!strcmp(xname, xd->xname)) {\n\t\t\trc = xd->value_len;\n\t\t\tif (buffer) {\n\t\t\t\tif (size < rc) {\n\t\t\t\t\trc = -ERANGE;\n\t\t\t\t} else {\n\t\t\t\t\tmemcpy(buffer, xd->xvalue, rc);\n\t\t\t\t}\n\t\t\t}\n\t\t\tgoto out;\n\t\t}\n\t}\n\trc = -ENODATA;\n out:\n\tif (!retry) {\n\t\tup_read(&c->xattr_sem);\n\t} else {\n\t\tup_write(&c->xattr_sem);\n\t}\n\treturn rc;\n}"
        }
      },
      {
        "call_info": {
          "callee": "RR_PTR(",
          "args": [
            "ENOMEM)"
          ],
          "line": 195
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "malloc(",
          "args": [
            "c,",
            "FP_KERNEL)"
          ],
          "line": 193
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "UG(",
          "args": [],
          "line": 189
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "include \"nodelist.h\"\ninclude <linux/mtd/mtd.h>\n#\ninclude <linux/posix_acl_xattr.h>\n#\ninclude <linux/xattr.h>\n#\ninclude <linux/jffs2.h>\n#\ninclude <linux/crc32.h>\n#\ninclude <linux/time.h>\n#\ninclude <linux/sched.h>\n#\ninclude <linux/fs.h>\n#\ninclude <linux/slab.h>\n#\ninclude <linux/kernel.h>\n#\n\ntruct posix_acl *jffs2_get_acl(struct inode *inode, int type)\n{\n\tstruct posix_acl *acl;\n\tchar *value = NULL;\n\tint rc, xprefix;\n\n\tswitch (type) {\n\tcase ACL_TYPE_ACCESS:\n\t\txprefix = JFFS2_XPREFIX_ACL_ACCESS;\n\t\tbreak;\n\tcase ACL_TYPE_DEFAULT:\n\t\txprefix = JFFS2_XPREFIX_ACL_DEFAULT;\n\t\tbreak;\n\tdefault:\n\t\tBUG();\n\t}\n\trc = do_jffs2_getxattr(inode, xprefix, \"\", NULL, 0);\n\tif (rc > 0) {\n\t\tvalue = kmalloc(rc, GFP_KERNEL);\n\t\tif (!value)\n\t\t\treturn ERR_PTR(-ENOMEM);\n\t\trc = do_jffs2_getxattr(inode, xprefix, \"\", value, rc);\n\t}\n\tif (rc > 0) {\n\t\tacl = jffs2_acl_from_medium(value, rc);\n\t} else if (rc == -ENODATA || rc == -ENOSYS) {\n\t\tacl = NULL;\n\t} else {\n\t\tacl = ERR_PTR(rc);\n\t}\n\tkfree(value);\n\tif (!IS_ERR(acl))\n\t\tset_cached_acl(inode, type, acl);\n\treturn acl;\n}"
  },
  {
    "function_name": "ffs2_acl_to_medium(",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/jffs2/acl.c",
    "lines": "128-173",
    "snippet": "tatic void *jffs2_acl_to_medium(const struct posix_acl *acl, size_t *size)\n{\n\tstruct jffs2_acl_header *header;\n\tstruct jffs2_acl_entry *entry;\n\tvoid *e;\n\tsize_t i;\n\n\t*size = jffs2_acl_size(acl->a_count);\n\theader = kmalloc(sizeof(*header) + acl->a_count * sizeof(*entry), GFP_KERNEL);\n\tif (!header)\n\t\treturn ERR_PTR(-ENOMEM);\n\theader->a_version = cpu_to_je32(JFFS2_ACL_VERSION);\n\te = header + 1;\n\tfor (i=0; i < acl->a_count; i++) {\n\t\tconst struct posix_acl_entry *acl_e = &acl->a_entries[i];\n\t\tentry = e;\n\t\tentry->e_tag = cpu_to_je16(acl_e->e_tag);\n\t\tentry->e_perm = cpu_to_je16(acl_e->e_perm);\n\t\tswitch(acl_e->e_tag) {\n\t\t\tcase ACL_USER:\n\t\t\t\tentry->e_id = cpu_to_je32(\n\t\t\t\t\tfrom_kuid(&init_user_ns, acl_e->e_uid));\n\t\t\t\te += sizeof(struct jffs2_acl_entry);\n\t\t\t\tbreak;\n\t\t\tcase ACL_GROUP:\n\t\t\t\tentry->e_id = cpu_to_je32(\n\t\t\t\t\tfrom_kgid(&init_user_ns, acl_e->e_gid));\n\t\t\t\te += sizeof(struct jffs2_acl_entry);\n\t\t\t\tbreak;\n\n\t\t\tcase ACL_USER_OBJ:\n\t\t\tcase ACL_GROUP_OBJ:\n\t\t\tcase ACL_MASK:\n\t\t\tcase ACL_OTHER:\n\t\t\t\te += sizeof(struct jffs2_acl_entry_short);\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\tgoto fail;\n\t\t}\n\t}\n\treturn header;\n fail:\n\tkfree(header);\n\treturn ERR_PTR(-EINVAL);\n}",
    "includes": [
      "include \"nodelist.h\"",
      "include <linux/mtd/mtd.h>\n#",
      "include <linux/posix_acl_xattr.h>\n#",
      "include <linux/xattr.h>\n#",
      "include <linux/jffs2.h>\n#",
      "include <linux/crc32.h>\n#",
      "include <linux/time.h>\n#",
      "include <linux/sched.h>\n#",
      "include <linux/fs.h>\n#",
      "include <linux/slab.h>\n#",
      "include <linux/kernel.h>\n#"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "RR_PTR(",
          "args": [
            "EINVAL)"
          ],
          "line": 172
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "free(",
          "args": [
            "eader)"
          ],
          "line": 171
        },
        "resolved": true,
        "details": {
          "function_name": "in_free(",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/jffs2/scan.c",
          "lines": "51-60",
          "snippet": "tatic inline int min_free(struct jffs2_sb_info *c)\n{\n\tuint32_t min = 2 * sizeof(struct jffs2_raw_inode);\n#ifdef CONFIG_JFFS2_FS_WRITEBUFFER\n\tif (!jffs2_can_mark_obsolete(c) && min < c->wbuf_pagesize)\n\t\treturn c->wbuf_pagesize;\n#endif\n\treturn min;\n\n}",
          "includes": [
            "include \"debug.h\"",
            "include \"summary.h\"\n#",
            "include \"nodelist.h\"\n#",
            "include <linux/compiler.h>\n#",
            "include <linux/crc32.h>\n#",
            "include <linux/pagemap.h>\n#",
            "include <linux/mtd/mtd.h>\n#",
            "include <linux/slab.h>\n#",
            "include <linux/sched.h>\n#",
            "include <linux/kernel.h>\n#"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "include \"debug.h\"\ninclude \"summary.h\"\n#\ninclude \"nodelist.h\"\n#\ninclude <linux/compiler.h>\n#\ninclude <linux/crc32.h>\n#\ninclude <linux/pagemap.h>\n#\ninclude <linux/mtd/mtd.h>\n#\ninclude <linux/slab.h>\n#\ninclude <linux/sched.h>\n#\ninclude <linux/kernel.h>\n#\n\ntatic inline int min_free(struct jffs2_sb_info *c)\n{\n\tuint32_t min = 2 * sizeof(struct jffs2_raw_inode);\n#ifdef CONFIG_JFFS2_FS_WRITEBUFFER\n\tif (!jffs2_can_mark_obsolete(c) && min < c->wbuf_pagesize)\n\t\treturn c->wbuf_pagesize;\n#endif\n\treturn min;\n\n}"
        }
      },
      {
        "call_info": {
          "callee": "pu_to_je32(",
          "args": [
            "rom_kgid(&init_user_ns, acl_e->e_gid))"
          ],
          "line": 153
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rom_kgid(",
          "args": [
            "init_user_ns,",
            "cl_e->e_gid)"
          ],
          "line": 154
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pu_to_je32(",
          "args": [
            "rom_kuid(&init_user_ns, acl_e->e_uid))"
          ],
          "line": 148
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rom_kuid(",
          "args": [
            "init_user_ns,",
            "cl_e->e_uid)"
          ],
          "line": 149
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pu_to_je16(",
          "args": [
            "cl_e->e_perm)"
          ],
          "line": 145
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pu_to_je16(",
          "args": [
            "cl_e->e_tag)"
          ],
          "line": 144
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pu_to_je32(",
          "args": [
            "FFS2_ACL_VERSION)"
          ],
          "line": 139
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "RR_PTR(",
          "args": [
            "ENOMEM)"
          ],
          "line": 138
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "malloc(",
          "args": [
            "izeof(*header) + acl->a_count * sizeof(*entry),",
            "FP_KERNEL)"
          ],
          "line": 136
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ffs2_acl_size(",
          "args": [
            "cl->a_count)"
          ],
          "line": 135
        },
        "resolved": true,
        "details": {
          "function_name": "ffs2_acl_size(",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/jffs2/acl.c",
          "lines": "26-36",
          "snippet": "tatic size_t jffs2_acl_size(int count)\n{\n\tif (count <= 4) {\n\t\treturn sizeof(struct jffs2_acl_header)\n\t\t       + count * sizeof(struct jffs2_acl_entry_short);\n\t} else {\n\t\treturn sizeof(struct jffs2_acl_header)\n\t\t       + 4 * sizeof(struct jffs2_acl_entry_short)\n\t\t       + (count - 4) * sizeof(struct jffs2_acl_entry);\n\t}\n}",
          "includes": [
            "include \"nodelist.h\"",
            "include <linux/mtd/mtd.h>\n#",
            "include <linux/posix_acl_xattr.h>\n#",
            "include <linux/xattr.h>\n#",
            "include <linux/jffs2.h>\n#",
            "include <linux/crc32.h>\n#",
            "include <linux/time.h>\n#",
            "include <linux/sched.h>\n#",
            "include <linux/fs.h>\n#",
            "include <linux/slab.h>\n#",
            "include <linux/kernel.h>\n#"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "include \"nodelist.h\"\ninclude <linux/mtd/mtd.h>\n#\ninclude <linux/posix_acl_xattr.h>\n#\ninclude <linux/xattr.h>\n#\ninclude <linux/jffs2.h>\n#\ninclude <linux/crc32.h>\n#\ninclude <linux/time.h>\n#\ninclude <linux/sched.h>\n#\ninclude <linux/fs.h>\n#\ninclude <linux/slab.h>\n#\ninclude <linux/kernel.h>\n#\n\ntatic size_t jffs2_acl_size(int count)\n{\n\tif (count <= 4) {\n\t\treturn sizeof(struct jffs2_acl_header)\n\t\t       + count * sizeof(struct jffs2_acl_entry_short);\n\t} else {\n\t\treturn sizeof(struct jffs2_acl_header)\n\t\t       + 4 * sizeof(struct jffs2_acl_entry_short)\n\t\t       + (count - 4) * sizeof(struct jffs2_acl_entry);\n\t}\n}"
        }
      }
    ],
    "contextual_snippet": "include \"nodelist.h\"\ninclude <linux/mtd/mtd.h>\n#\ninclude <linux/posix_acl_xattr.h>\n#\ninclude <linux/xattr.h>\n#\ninclude <linux/jffs2.h>\n#\ninclude <linux/crc32.h>\n#\ninclude <linux/time.h>\n#\ninclude <linux/sched.h>\n#\ninclude <linux/fs.h>\n#\ninclude <linux/slab.h>\n#\ninclude <linux/kernel.h>\n#\n\ntatic void *jffs2_acl_to_medium(const struct posix_acl *acl, size_t *size)\n{\n\tstruct jffs2_acl_header *header;\n\tstruct jffs2_acl_entry *entry;\n\tvoid *e;\n\tsize_t i;\n\n\t*size = jffs2_acl_size(acl->a_count);\n\theader = kmalloc(sizeof(*header) + acl->a_count * sizeof(*entry), GFP_KERNEL);\n\tif (!header)\n\t\treturn ERR_PTR(-ENOMEM);\n\theader->a_version = cpu_to_je32(JFFS2_ACL_VERSION);\n\te = header + 1;\n\tfor (i=0; i < acl->a_count; i++) {\n\t\tconst struct posix_acl_entry *acl_e = &acl->a_entries[i];\n\t\tentry = e;\n\t\tentry->e_tag = cpu_to_je16(acl_e->e_tag);\n\t\tentry->e_perm = cpu_to_je16(acl_e->e_perm);\n\t\tswitch(acl_e->e_tag) {\n\t\t\tcase ACL_USER:\n\t\t\t\tentry->e_id = cpu_to_je32(\n\t\t\t\t\tfrom_kuid(&init_user_ns, acl_e->e_uid));\n\t\t\t\te += sizeof(struct jffs2_acl_entry);\n\t\t\t\tbreak;\n\t\t\tcase ACL_GROUP:\n\t\t\t\tentry->e_id = cpu_to_je32(\n\t\t\t\t\tfrom_kgid(&init_user_ns, acl_e->e_gid));\n\t\t\t\te += sizeof(struct jffs2_acl_entry);\n\t\t\t\tbreak;\n\n\t\t\tcase ACL_USER_OBJ:\n\t\t\tcase ACL_GROUP_OBJ:\n\t\t\tcase ACL_MASK:\n\t\t\tcase ACL_OTHER:\n\t\t\t\te += sizeof(struct jffs2_acl_entry_short);\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\tgoto fail;\n\t\t}\n\t}\n\treturn header;\n fail:\n\tkfree(header);\n\treturn ERR_PTR(-EINVAL);\n}"
  },
  {
    "function_name": "ffs2_acl_from_medium(",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/jffs2/acl.c",
    "lines": "55-126",
    "snippet": "tatic struct posix_acl *jffs2_acl_from_medium(void *value, size_t size)\n{\n\tvoid *end = value + size;\n\tstruct jffs2_acl_header *header = value;\n\tstruct jffs2_acl_entry *entry;\n\tstruct posix_acl *acl;\n\tuint32_t ver;\n\tint i, count;\n\n\tif (!value)\n\t\treturn NULL;\n\tif (size < sizeof(struct jffs2_acl_header))\n\t\treturn ERR_PTR(-EINVAL);\n\tver = je32_to_cpu(header->a_version);\n\tif (ver != JFFS2_ACL_VERSION) {\n\t\tJFFS2_WARNING(\"Invalid ACL version. (=%u)\\n\", ver);\n\t\treturn ERR_PTR(-EINVAL);\n\t}\n\n\tvalue += sizeof(struct jffs2_acl_header);\n\tcount = jffs2_acl_count(size);\n\tif (count < 0)\n\t\treturn ERR_PTR(-EINVAL);\n\tif (count == 0)\n\t\treturn NULL;\n\n\tacl = posix_acl_alloc(count, GFP_KERNEL);\n\tif (!acl)\n\t\treturn ERR_PTR(-ENOMEM);\n\n\tfor (i=0; i < count; i++) {\n\t\tentry = value;\n\t\tif (value + sizeof(struct jffs2_acl_entry_short) > end)\n\t\t\tgoto fail;\n\t\tacl->a_entries[i].e_tag = je16_to_cpu(entry->e_tag);\n\t\tacl->a_entries[i].e_perm = je16_to_cpu(entry->e_perm);\n\t\tswitch (acl->a_entries[i].e_tag) {\n\t\t\tcase ACL_USER_OBJ:\n\t\t\tcase ACL_GROUP_OBJ:\n\t\t\tcase ACL_MASK:\n\t\t\tcase ACL_OTHER:\n\t\t\t\tvalue += sizeof(struct jffs2_acl_entry_short);\n\t\t\t\tbreak;\n\n\t\t\tcase ACL_USER:\n\t\t\t\tvalue += sizeof(struct jffs2_acl_entry);\n\t\t\t\tif (value > end)\n\t\t\t\t\tgoto fail;\n\t\t\t\tacl->a_entries[i].e_uid =\n\t\t\t\t\tmake_kuid(&init_user_ns,\n\t\t\t\t\t\t  je32_to_cpu(entry->e_id));\n\t\t\t\tbreak;\n\t\t\tcase ACL_GROUP:\n\t\t\t\tvalue += sizeof(struct jffs2_acl_entry);\n\t\t\t\tif (value > end)\n\t\t\t\t\tgoto fail;\n\t\t\t\tacl->a_entries[i].e_gid =\n\t\t\t\t\tmake_kgid(&init_user_ns,\n\t\t\t\t\t\t  je32_to_cpu(entry->e_id));\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\tgoto fail;\n\t\t}\n\t}\n\tif (value != end)\n\t\tgoto fail;\n\treturn acl;\n fail:\n\tposix_acl_release(acl);\n\treturn ERR_PTR(-EINVAL);\n}",
    "includes": [
      "include \"nodelist.h\"",
      "include <linux/mtd/mtd.h>\n#",
      "include <linux/posix_acl_xattr.h>\n#",
      "include <linux/xattr.h>\n#",
      "include <linux/jffs2.h>\n#",
      "include <linux/crc32.h>\n#",
      "include <linux/time.h>\n#",
      "include <linux/sched.h>\n#",
      "include <linux/fs.h>\n#",
      "include <linux/slab.h>\n#",
      "include <linux/kernel.h>\n#"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "RR_PTR(",
          "args": [
            "EINVAL)"
          ],
          "line": 125
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "osix_acl_release(",
          "args": [
            "cl)"
          ],
          "line": 124
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ake_kgid(",
          "args": [
            "init_user_ns,",
            "e32_to_cpu(entry->e_id))"
          ],
          "line": 112
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "e32_to_cpu(",
          "args": [
            "ntry->e_id)"
          ],
          "line": 113
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ake_kuid(",
          "args": [
            "init_user_ns,",
            "e32_to_cpu(entry->e_id))"
          ],
          "line": 104
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "e32_to_cpu(",
          "args": [
            "ntry->e_id)"
          ],
          "line": 105
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "e16_to_cpu(",
          "args": [
            "ntry->e_perm)"
          ],
          "line": 90
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "e16_to_cpu(",
          "args": [
            "ntry->e_tag)"
          ],
          "line": 89
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "RR_PTR(",
          "args": [
            "ENOMEM)"
          ],
          "line": 83
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "osix_acl_alloc(",
          "args": [
            "ount,",
            "FP_KERNEL)"
          ],
          "line": 81
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "RR_PTR(",
          "args": [
            "EINVAL)"
          ],
          "line": 77
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ffs2_acl_count(",
          "args": [
            "ize)"
          ],
          "line": 75
        },
        "resolved": true,
        "details": {
          "function_name": "ffs2_acl_count(",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/jffs2/acl.c",
          "lines": "38-53",
          "snippet": "tatic int jffs2_acl_count(size_t size)\n{\n\tsize_t s;\n\n\tsize -= sizeof(struct jffs2_acl_header);\n\tif (size < 4 * sizeof(struct jffs2_acl_entry_short)) {\n\t\tif (size % sizeof(struct jffs2_acl_entry_short))\n\t\t\treturn -1;\n\t\treturn size / sizeof(struct jffs2_acl_entry_short);\n\t} else {\n\t\ts = size - 4 * sizeof(struct jffs2_acl_entry_short);\n\t\tif (s % sizeof(struct jffs2_acl_entry))\n\t\t\treturn -1;\n\t\treturn s / sizeof(struct jffs2_acl_entry) + 4;\n\t}\n}",
          "includes": [
            "include \"nodelist.h\"",
            "include <linux/mtd/mtd.h>\n#",
            "include <linux/posix_acl_xattr.h>\n#",
            "include <linux/xattr.h>\n#",
            "include <linux/jffs2.h>\n#",
            "include <linux/crc32.h>\n#",
            "include <linux/time.h>\n#",
            "include <linux/sched.h>\n#",
            "include <linux/fs.h>\n#",
            "include <linux/slab.h>\n#",
            "include <linux/kernel.h>\n#"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "include \"nodelist.h\"\ninclude <linux/mtd/mtd.h>\n#\ninclude <linux/posix_acl_xattr.h>\n#\ninclude <linux/xattr.h>\n#\ninclude <linux/jffs2.h>\n#\ninclude <linux/crc32.h>\n#\ninclude <linux/time.h>\n#\ninclude <linux/sched.h>\n#\ninclude <linux/fs.h>\n#\ninclude <linux/slab.h>\n#\ninclude <linux/kernel.h>\n#\n\ntatic int jffs2_acl_count(size_t size)\n{\n\tsize_t s;\n\n\tsize -= sizeof(struct jffs2_acl_header);\n\tif (size < 4 * sizeof(struct jffs2_acl_entry_short)) {\n\t\tif (size % sizeof(struct jffs2_acl_entry_short))\n\t\t\treturn -1;\n\t\treturn size / sizeof(struct jffs2_acl_entry_short);\n\t} else {\n\t\ts = size - 4 * sizeof(struct jffs2_acl_entry_short);\n\t\tif (s % sizeof(struct jffs2_acl_entry))\n\t\t\treturn -1;\n\t\treturn s / sizeof(struct jffs2_acl_entry) + 4;\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "RR_PTR(",
          "args": [
            "EINVAL)"
          ],
          "line": 71
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "FFS2_WARNING(",
          "args": [
            "Invalid ACL version. (=%u)\\n\",",
            "er)"
          ],
          "line": 70
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "e32_to_cpu(",
          "args": [
            "eader->a_version)"
          ],
          "line": 68
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "RR_PTR(",
          "args": [
            "EINVAL)"
          ],
          "line": 67
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "include \"nodelist.h\"\ninclude <linux/mtd/mtd.h>\n#\ninclude <linux/posix_acl_xattr.h>\n#\ninclude <linux/xattr.h>\n#\ninclude <linux/jffs2.h>\n#\ninclude <linux/crc32.h>\n#\ninclude <linux/time.h>\n#\ninclude <linux/sched.h>\n#\ninclude <linux/fs.h>\n#\ninclude <linux/slab.h>\n#\ninclude <linux/kernel.h>\n#\n\ntatic struct posix_acl *jffs2_acl_from_medium(void *value, size_t size)\n{\n\tvoid *end = value + size;\n\tstruct jffs2_acl_header *header = value;\n\tstruct jffs2_acl_entry *entry;\n\tstruct posix_acl *acl;\n\tuint32_t ver;\n\tint i, count;\n\n\tif (!value)\n\t\treturn NULL;\n\tif (size < sizeof(struct jffs2_acl_header))\n\t\treturn ERR_PTR(-EINVAL);\n\tver = je32_to_cpu(header->a_version);\n\tif (ver != JFFS2_ACL_VERSION) {\n\t\tJFFS2_WARNING(\"Invalid ACL version. (=%u)\\n\", ver);\n\t\treturn ERR_PTR(-EINVAL);\n\t}\n\n\tvalue += sizeof(struct jffs2_acl_header);\n\tcount = jffs2_acl_count(size);\n\tif (count < 0)\n\t\treturn ERR_PTR(-EINVAL);\n\tif (count == 0)\n\t\treturn NULL;\n\n\tacl = posix_acl_alloc(count, GFP_KERNEL);\n\tif (!acl)\n\t\treturn ERR_PTR(-ENOMEM);\n\n\tfor (i=0; i < count; i++) {\n\t\tentry = value;\n\t\tif (value + sizeof(struct jffs2_acl_entry_short) > end)\n\t\t\tgoto fail;\n\t\tacl->a_entries[i].e_tag = je16_to_cpu(entry->e_tag);\n\t\tacl->a_entries[i].e_perm = je16_to_cpu(entry->e_perm);\n\t\tswitch (acl->a_entries[i].e_tag) {\n\t\t\tcase ACL_USER_OBJ:\n\t\t\tcase ACL_GROUP_OBJ:\n\t\t\tcase ACL_MASK:\n\t\t\tcase ACL_OTHER:\n\t\t\t\tvalue += sizeof(struct jffs2_acl_entry_short);\n\t\t\t\tbreak;\n\n\t\t\tcase ACL_USER:\n\t\t\t\tvalue += sizeof(struct jffs2_acl_entry);\n\t\t\t\tif (value > end)\n\t\t\t\t\tgoto fail;\n\t\t\t\tacl->a_entries[i].e_uid =\n\t\t\t\t\tmake_kuid(&init_user_ns,\n\t\t\t\t\t\t  je32_to_cpu(entry->e_id));\n\t\t\t\tbreak;\n\t\t\tcase ACL_GROUP:\n\t\t\t\tvalue += sizeof(struct jffs2_acl_entry);\n\t\t\t\tif (value > end)\n\t\t\t\t\tgoto fail;\n\t\t\t\tacl->a_entries[i].e_gid =\n\t\t\t\t\tmake_kgid(&init_user_ns,\n\t\t\t\t\t\t  je32_to_cpu(entry->e_id));\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\tgoto fail;\n\t\t}\n\t}\n\tif (value != end)\n\t\tgoto fail;\n\treturn acl;\n fail:\n\tposix_acl_release(acl);\n\treturn ERR_PTR(-EINVAL);\n}"
  },
  {
    "function_name": "ffs2_acl_count(",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/jffs2/acl.c",
    "lines": "38-53",
    "snippet": "tatic int jffs2_acl_count(size_t size)\n{\n\tsize_t s;\n\n\tsize -= sizeof(struct jffs2_acl_header);\n\tif (size < 4 * sizeof(struct jffs2_acl_entry_short)) {\n\t\tif (size % sizeof(struct jffs2_acl_entry_short))\n\t\t\treturn -1;\n\t\treturn size / sizeof(struct jffs2_acl_entry_short);\n\t} else {\n\t\ts = size - 4 * sizeof(struct jffs2_acl_entry_short);\n\t\tif (s % sizeof(struct jffs2_acl_entry))\n\t\t\treturn -1;\n\t\treturn s / sizeof(struct jffs2_acl_entry) + 4;\n\t}\n}",
    "includes": [
      "include \"nodelist.h\"",
      "include <linux/mtd/mtd.h>\n#",
      "include <linux/posix_acl_xattr.h>\n#",
      "include <linux/xattr.h>\n#",
      "include <linux/jffs2.h>\n#",
      "include <linux/crc32.h>\n#",
      "include <linux/time.h>\n#",
      "include <linux/sched.h>\n#",
      "include <linux/fs.h>\n#",
      "include <linux/slab.h>\n#",
      "include <linux/kernel.h>\n#"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "include \"nodelist.h\"\ninclude <linux/mtd/mtd.h>\n#\ninclude <linux/posix_acl_xattr.h>\n#\ninclude <linux/xattr.h>\n#\ninclude <linux/jffs2.h>\n#\ninclude <linux/crc32.h>\n#\ninclude <linux/time.h>\n#\ninclude <linux/sched.h>\n#\ninclude <linux/fs.h>\n#\ninclude <linux/slab.h>\n#\ninclude <linux/kernel.h>\n#\n\ntatic int jffs2_acl_count(size_t size)\n{\n\tsize_t s;\n\n\tsize -= sizeof(struct jffs2_acl_header);\n\tif (size < 4 * sizeof(struct jffs2_acl_entry_short)) {\n\t\tif (size % sizeof(struct jffs2_acl_entry_short))\n\t\t\treturn -1;\n\t\treturn size / sizeof(struct jffs2_acl_entry_short);\n\t} else {\n\t\ts = size - 4 * sizeof(struct jffs2_acl_entry_short);\n\t\tif (s % sizeof(struct jffs2_acl_entry))\n\t\t\treturn -1;\n\t\treturn s / sizeof(struct jffs2_acl_entry) + 4;\n\t}\n}"
  },
  {
    "function_name": "ffs2_acl_size(",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/jffs2/acl.c",
    "lines": "26-36",
    "snippet": "tatic size_t jffs2_acl_size(int count)\n{\n\tif (count <= 4) {\n\t\treturn sizeof(struct jffs2_acl_header)\n\t\t       + count * sizeof(struct jffs2_acl_entry_short);\n\t} else {\n\t\treturn sizeof(struct jffs2_acl_header)\n\t\t       + 4 * sizeof(struct jffs2_acl_entry_short)\n\t\t       + (count - 4) * sizeof(struct jffs2_acl_entry);\n\t}\n}",
    "includes": [
      "include \"nodelist.h\"",
      "include <linux/mtd/mtd.h>\n#",
      "include <linux/posix_acl_xattr.h>\n#",
      "include <linux/xattr.h>\n#",
      "include <linux/jffs2.h>\n#",
      "include <linux/crc32.h>\n#",
      "include <linux/time.h>\n#",
      "include <linux/sched.h>\n#",
      "include <linux/fs.h>\n#",
      "include <linux/slab.h>\n#",
      "include <linux/kernel.h>\n#"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "include \"nodelist.h\"\ninclude <linux/mtd/mtd.h>\n#\ninclude <linux/posix_acl_xattr.h>\n#\ninclude <linux/xattr.h>\n#\ninclude <linux/jffs2.h>\n#\ninclude <linux/crc32.h>\n#\ninclude <linux/time.h>\n#\ninclude <linux/sched.h>\n#\ninclude <linux/fs.h>\n#\ninclude <linux/slab.h>\n#\ninclude <linux/kernel.h>\n#\n\ntatic size_t jffs2_acl_size(int count)\n{\n\tif (count <= 4) {\n\t\treturn sizeof(struct jffs2_acl_header)\n\t\t       + count * sizeof(struct jffs2_acl_entry_short);\n\t} else {\n\t\treturn sizeof(struct jffs2_acl_header)\n\t\t       + 4 * sizeof(struct jffs2_acl_entry_short)\n\t\t       + (count - 4) * sizeof(struct jffs2_acl_entry);\n\t}\n}"
  }
]