[
  {
    "function_name": "fscache_proc_cleanup",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/fscache/proc.c",
    "lines": "69-81",
    "snippet": "void fscache_proc_cleanup(void)\n{\n#ifdef CONFIG_FSCACHE_OBJECT_LIST\n\tremove_proc_entry(\"fs/fscache/objects\", NULL);\n#endif\n#ifdef CONFIG_FSCACHE_HISTOGRAM\n\tremove_proc_entry(\"fs/fscache/histogram\", NULL);\n#endif\n#ifdef CONFIG_FSCACHE_STATS\n\tremove_proc_entry(\"fs/fscache/stats\", NULL);\n#endif\n\tremove_proc_entry(\"fs/fscache\", NULL);\n}",
    "includes": [
      "#include \"internal.h\"",
      "#include <linux/seq_file.h>",
      "#include <linux/proc_fs.h>",
      "#include <linux/module.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "remove_proc_entry",
          "args": [
            "\"fs/fscache\"",
            "NULL"
          ],
          "line": 80
        },
        "resolved": true,
        "details": {
          "function_name": "remove_proc_entry",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/proc/generic.c",
          "lines": "523-554",
          "snippet": "void remove_proc_entry(const char *name, struct proc_dir_entry *parent)\n{\n\tstruct proc_dir_entry *de = NULL;\n\tconst char *fn = name;\n\tunsigned int len;\n\n\tspin_lock(&proc_subdir_lock);\n\tif (__xlate_proc_name(name, &parent, &fn) != 0) {\n\t\tspin_unlock(&proc_subdir_lock);\n\t\treturn;\n\t}\n\tlen = strlen(fn);\n\n\tde = pde_subdir_find(parent, fn, len);\n\tif (de)\n\t\trb_erase(&de->subdir_node, &parent->subdir);\n\tspin_unlock(&proc_subdir_lock);\n\tif (!de) {\n\t\tWARN(1, \"name '%s'\\n\", name);\n\t\treturn;\n\t}\n\n\tproc_entry_rundown(de);\n\n\tif (S_ISDIR(de->mode))\n\t\tparent->nlink--;\n\tde->nlink = 0;\n\tWARN(pde_subdir_first(de),\n\t     \"%s: removing non-empty directory '%s/%s', leaking at least '%s'\\n\",\n\t     __func__, de->parent->name, de->name, pde_subdir_first(de)->name);\n\tpde_put(de);\n}",
          "includes": [
            "#include \"internal.h\"",
            "#include <asm/uaccess.h>",
            "#include <linux/completion.h>",
            "#include <linux/spinlock.h>",
            "#include <linux/bitops.h>",
            "#include <linux/idr.h>",
            "#include <linux/init.h>",
            "#include <linux/mount.h>",
            "#include <linux/printk.h>",
            "#include <linux/slab.h>",
            "#include <linux/module.h>",
            "#include <linux/mm.h>",
            "#include <linux/stat.h>",
            "#include <linux/proc_fs.h>",
            "#include <linux/time.h>",
            "#include <linux/errno.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static DEFINE_SPINLOCK(proc_subdir_lock);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"internal.h\"\n#include <asm/uaccess.h>\n#include <linux/completion.h>\n#include <linux/spinlock.h>\n#include <linux/bitops.h>\n#include <linux/idr.h>\n#include <linux/init.h>\n#include <linux/mount.h>\n#include <linux/printk.h>\n#include <linux/slab.h>\n#include <linux/module.h>\n#include <linux/mm.h>\n#include <linux/stat.h>\n#include <linux/proc_fs.h>\n#include <linux/time.h>\n#include <linux/errno.h>\n\nstatic DEFINE_SPINLOCK(proc_subdir_lock);\n\nvoid remove_proc_entry(const char *name, struct proc_dir_entry *parent)\n{\n\tstruct proc_dir_entry *de = NULL;\n\tconst char *fn = name;\n\tunsigned int len;\n\n\tspin_lock(&proc_subdir_lock);\n\tif (__xlate_proc_name(name, &parent, &fn) != 0) {\n\t\tspin_unlock(&proc_subdir_lock);\n\t\treturn;\n\t}\n\tlen = strlen(fn);\n\n\tde = pde_subdir_find(parent, fn, len);\n\tif (de)\n\t\trb_erase(&de->subdir_node, &parent->subdir);\n\tspin_unlock(&proc_subdir_lock);\n\tif (!de) {\n\t\tWARN(1, \"name '%s'\\n\", name);\n\t\treturn;\n\t}\n\n\tproc_entry_rundown(de);\n\n\tif (S_ISDIR(de->mode))\n\t\tparent->nlink--;\n\tde->nlink = 0;\n\tWARN(pde_subdir_first(de),\n\t     \"%s: removing non-empty directory '%s/%s', leaking at least '%s'\\n\",\n\t     __func__, de->parent->name, de->name, pde_subdir_first(de)->name);\n\tpde_put(de);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"internal.h\"\n#include <linux/seq_file.h>\n#include <linux/proc_fs.h>\n#include <linux/module.h>\n\nvoid fscache_proc_cleanup(void)\n{\n#ifdef CONFIG_FSCACHE_OBJECT_LIST\n\tremove_proc_entry(\"fs/fscache/objects\", NULL);\n#endif\n#ifdef CONFIG_FSCACHE_HISTOGRAM\n\tremove_proc_entry(\"fs/fscache/histogram\", NULL);\n#endif\n#ifdef CONFIG_FSCACHE_STATS\n\tremove_proc_entry(\"fs/fscache/stats\", NULL);\n#endif\n\tremove_proc_entry(\"fs/fscache\", NULL);\n}"
  },
  {
    "function_name": "fscache_proc_init",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/fscache/proc.c",
    "lines": "21-64",
    "snippet": "int __init fscache_proc_init(void)\n{\n\t_enter(\"\");\n\n\tif (!proc_mkdir(\"fs/fscache\", NULL))\n\t\tgoto error_dir;\n\n#ifdef CONFIG_FSCACHE_STATS\n\tif (!proc_create(\"fs/fscache/stats\", S_IFREG | 0444, NULL,\n\t\t\t &fscache_stats_fops))\n\t\tgoto error_stats;\n#endif\n\n#ifdef CONFIG_FSCACHE_HISTOGRAM\n\tif (!proc_create(\"fs/fscache/histogram\", S_IFREG | 0444, NULL,\n\t\t\t &fscache_histogram_fops))\n\t\tgoto error_histogram;\n#endif\n\n#ifdef CONFIG_FSCACHE_OBJECT_LIST\n\tif (!proc_create(\"fs/fscache/objects\", S_IFREG | 0444, NULL,\n\t\t\t &fscache_objlist_fops))\n\t\tgoto error_objects;\n#endif\n\n\t_leave(\" = 0\");\n\treturn 0;\n\n#ifdef CONFIG_FSCACHE_OBJECT_LIST\nerror_objects:\n#endif\n#ifdef CONFIG_FSCACHE_HISTOGRAM\n\tremove_proc_entry(\"fs/fscache/histogram\", NULL);\nerror_histogram:\n#endif\n#ifdef CONFIG_FSCACHE_STATS\n\tremove_proc_entry(\"fs/fscache/stats\", NULL);\nerror_stats:\n#endif\n\tremove_proc_entry(\"fs/fscache\", NULL);\nerror_dir:\n\t_leave(\" = -ENOMEM\");\n\treturn -ENOMEM;\n}",
    "includes": [
      "#include \"internal.h\"",
      "#include <linux/seq_file.h>",
      "#include <linux/proc_fs.h>",
      "#include <linux/module.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "_leave",
          "args": [
            "\" = -ENOMEM\""
          ],
          "line": 62
        },
        "resolved": true,
        "details": {
          "function_name": "ocfs2_leave_group",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/ocfs2/stackglue.c",
          "lines": "426-449",
          "snippet": "static void ocfs2_leave_group(const char *group)\n{\n\tint ret;\n\tchar *argv[5], *envp[3];\n\n\targv[0] = ocfs2_hb_ctl_path;\n\targv[1] = \"-K\";\n\targv[2] = \"-u\";\n\targv[3] = (char *)group;\n\targv[4] = NULL;\n\n\t/* minimal command environment taken from cpu_run_sbin_hotplug */\n\tenvp[0] = \"HOME=/\";\n\tenvp[1] = \"PATH=/sbin:/bin:/usr/sbin:/usr/bin\";\n\tenvp[2] = NULL;\n\n\tret = call_usermodehelper(argv[0], argv, envp, UMH_WAIT_PROC);\n\tif (ret < 0) {\n\t\tprintk(KERN_ERR\n\t\t       \"ocfs2: Error %d running user helper \"\n\t\t       \"\\\"%s %s %s %s\\\"\\n\",\n\t\t       ret, argv[0], argv[1], argv[2], argv[3]);\n\t}\n}",
          "includes": [
            "#include \"stackglue.h\"",
            "#include \"ocfs2_fs.h\"",
            "#include <linux/sysctl.h>",
            "#include <linux/sysfs.h>",
            "#include <linux/kobject.h>",
            "#include <linux/fs.h>",
            "#include <linux/kmod.h>",
            "#include <linux/slab.h>",
            "#include <linux/module.h>",
            "#include <linux/spinlock.h>",
            "#include <linux/list.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static char ocfs2_hb_ctl_path[OCFS2_MAX_HB_CTL_PATH] = \"/sbin/ocfs2_hb_ctl\";"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"stackglue.h\"\n#include \"ocfs2_fs.h\"\n#include <linux/sysctl.h>\n#include <linux/sysfs.h>\n#include <linux/kobject.h>\n#include <linux/fs.h>\n#include <linux/kmod.h>\n#include <linux/slab.h>\n#include <linux/module.h>\n#include <linux/spinlock.h>\n#include <linux/list.h>\n\nstatic char ocfs2_hb_ctl_path[OCFS2_MAX_HB_CTL_PATH] = \"/sbin/ocfs2_hb_ctl\";\n\nstatic void ocfs2_leave_group(const char *group)\n{\n\tint ret;\n\tchar *argv[5], *envp[3];\n\n\targv[0] = ocfs2_hb_ctl_path;\n\targv[1] = \"-K\";\n\targv[2] = \"-u\";\n\targv[3] = (char *)group;\n\targv[4] = NULL;\n\n\t/* minimal command environment taken from cpu_run_sbin_hotplug */\n\tenvp[0] = \"HOME=/\";\n\tenvp[1] = \"PATH=/sbin:/bin:/usr/sbin:/usr/bin\";\n\tenvp[2] = NULL;\n\n\tret = call_usermodehelper(argv[0], argv, envp, UMH_WAIT_PROC);\n\tif (ret < 0) {\n\t\tprintk(KERN_ERR\n\t\t       \"ocfs2: Error %d running user helper \"\n\t\t       \"\\\"%s %s %s %s\\\"\\n\",\n\t\t       ret, argv[0], argv[1], argv[2], argv[3]);\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "remove_proc_entry",
          "args": [
            "\"fs/fscache\"",
            "NULL"
          ],
          "line": 60
        },
        "resolved": true,
        "details": {
          "function_name": "remove_proc_entry",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/proc/generic.c",
          "lines": "523-554",
          "snippet": "void remove_proc_entry(const char *name, struct proc_dir_entry *parent)\n{\n\tstruct proc_dir_entry *de = NULL;\n\tconst char *fn = name;\n\tunsigned int len;\n\n\tspin_lock(&proc_subdir_lock);\n\tif (__xlate_proc_name(name, &parent, &fn) != 0) {\n\t\tspin_unlock(&proc_subdir_lock);\n\t\treturn;\n\t}\n\tlen = strlen(fn);\n\n\tde = pde_subdir_find(parent, fn, len);\n\tif (de)\n\t\trb_erase(&de->subdir_node, &parent->subdir);\n\tspin_unlock(&proc_subdir_lock);\n\tif (!de) {\n\t\tWARN(1, \"name '%s'\\n\", name);\n\t\treturn;\n\t}\n\n\tproc_entry_rundown(de);\n\n\tif (S_ISDIR(de->mode))\n\t\tparent->nlink--;\n\tde->nlink = 0;\n\tWARN(pde_subdir_first(de),\n\t     \"%s: removing non-empty directory '%s/%s', leaking at least '%s'\\n\",\n\t     __func__, de->parent->name, de->name, pde_subdir_first(de)->name);\n\tpde_put(de);\n}",
          "includes": [
            "#include \"internal.h\"",
            "#include <asm/uaccess.h>",
            "#include <linux/completion.h>",
            "#include <linux/spinlock.h>",
            "#include <linux/bitops.h>",
            "#include <linux/idr.h>",
            "#include <linux/init.h>",
            "#include <linux/mount.h>",
            "#include <linux/printk.h>",
            "#include <linux/slab.h>",
            "#include <linux/module.h>",
            "#include <linux/mm.h>",
            "#include <linux/stat.h>",
            "#include <linux/proc_fs.h>",
            "#include <linux/time.h>",
            "#include <linux/errno.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static DEFINE_SPINLOCK(proc_subdir_lock);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"internal.h\"\n#include <asm/uaccess.h>\n#include <linux/completion.h>\n#include <linux/spinlock.h>\n#include <linux/bitops.h>\n#include <linux/idr.h>\n#include <linux/init.h>\n#include <linux/mount.h>\n#include <linux/printk.h>\n#include <linux/slab.h>\n#include <linux/module.h>\n#include <linux/mm.h>\n#include <linux/stat.h>\n#include <linux/proc_fs.h>\n#include <linux/time.h>\n#include <linux/errno.h>\n\nstatic DEFINE_SPINLOCK(proc_subdir_lock);\n\nvoid remove_proc_entry(const char *name, struct proc_dir_entry *parent)\n{\n\tstruct proc_dir_entry *de = NULL;\n\tconst char *fn = name;\n\tunsigned int len;\n\n\tspin_lock(&proc_subdir_lock);\n\tif (__xlate_proc_name(name, &parent, &fn) != 0) {\n\t\tspin_unlock(&proc_subdir_lock);\n\t\treturn;\n\t}\n\tlen = strlen(fn);\n\n\tde = pde_subdir_find(parent, fn, len);\n\tif (de)\n\t\trb_erase(&de->subdir_node, &parent->subdir);\n\tspin_unlock(&proc_subdir_lock);\n\tif (!de) {\n\t\tWARN(1, \"name '%s'\\n\", name);\n\t\treturn;\n\t}\n\n\tproc_entry_rundown(de);\n\n\tif (S_ISDIR(de->mode))\n\t\tparent->nlink--;\n\tde->nlink = 0;\n\tWARN(pde_subdir_first(de),\n\t     \"%s: removing non-empty directory '%s/%s', leaking at least '%s'\\n\",\n\t     __func__, de->parent->name, de->name, pde_subdir_first(de)->name);\n\tpde_put(de);\n}"
        }
      },
      {
        "call_info": {
          "callee": "proc_create",
          "args": [
            "\"fs/fscache/objects\"",
            "S_IFREG | 0444",
            "NULL",
            "&fscache_objlist_fops"
          ],
          "line": 41
        },
        "resolved": true,
        "details": {
          "function_name": "nfs_proc_create",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nfs/proc.c",
          "lines": "228-252",
          "snippet": "static int\nnfs_proc_create(struct inode *dir, struct dentry *dentry, struct iattr *sattr,\n\t\tint flags)\n{\n\tstruct nfs_createdata *data;\n\tstruct rpc_message msg = {\n\t\t.rpc_proc\t= &nfs_procedures[NFSPROC_CREATE],\n\t};\n\tint status = -ENOMEM;\n\n\tdprintk(\"NFS call  create %pd\\n\", dentry);\n\tdata = nfs_alloc_createdata(dir, dentry, sattr);\n\tif (data == NULL)\n\t\tgoto out;\n\tmsg.rpc_argp = &data->arg;\n\tmsg.rpc_resp = &data->res;\n\tstatus = rpc_call_sync(NFS_CLIENT(dir), &msg, 0);\n\tnfs_mark_for_revalidate(dir);\n\tif (status == 0)\n\t\tstatus = nfs_instantiate(dentry, data->res.fh, data->res.fattr, NULL);\n\tnfs_free_createdata(data);\nout:\n\tdprintk(\"NFS reply create: %d\\n\", status);\n\treturn status;\n}",
          "includes": [
            "#include \"internal.h\"",
            "#include <linux/freezer.h>",
            "#include <linux/lockd/bind.h>",
            "#include <linux/nfs_page.h>",
            "#include <linux/nfs_fs.h>",
            "#include <linux/nfs2.h>",
            "#include <linux/nfs.h>",
            "#include <linux/sunrpc/clnt.h>",
            "#include <linux/pagemap.h>",
            "#include <linux/in.h>",
            "#include <linux/string.h>",
            "#include <linux/errno.h>",
            "#include <linux/mm.h>",
            "#include <linux/time.h>",
            "#include <linux/param.h>",
            "#include <linux/types.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"internal.h\"\n#include <linux/freezer.h>\n#include <linux/lockd/bind.h>\n#include <linux/nfs_page.h>\n#include <linux/nfs_fs.h>\n#include <linux/nfs2.h>\n#include <linux/nfs.h>\n#include <linux/sunrpc/clnt.h>\n#include <linux/pagemap.h>\n#include <linux/in.h>\n#include <linux/string.h>\n#include <linux/errno.h>\n#include <linux/mm.h>\n#include <linux/time.h>\n#include <linux/param.h>\n#include <linux/types.h>\n\nstatic int\nnfs_proc_create(struct inode *dir, struct dentry *dentry, struct iattr *sattr,\n\t\tint flags)\n{\n\tstruct nfs_createdata *data;\n\tstruct rpc_message msg = {\n\t\t.rpc_proc\t= &nfs_procedures[NFSPROC_CREATE],\n\t};\n\tint status = -ENOMEM;\n\n\tdprintk(\"NFS call  create %pd\\n\", dentry);\n\tdata = nfs_alloc_createdata(dir, dentry, sattr);\n\tif (data == NULL)\n\t\tgoto out;\n\tmsg.rpc_argp = &data->arg;\n\tmsg.rpc_resp = &data->res;\n\tstatus = rpc_call_sync(NFS_CLIENT(dir), &msg, 0);\n\tnfs_mark_for_revalidate(dir);\n\tif (status == 0)\n\t\tstatus = nfs_instantiate(dentry, data->res.fh, data->res.fattr, NULL);\n\tnfs_free_createdata(data);\nout:\n\tdprintk(\"NFS reply create: %d\\n\", status);\n\treturn status;\n}"
        }
      },
      {
        "call_info": {
          "callee": "proc_mkdir",
          "args": [
            "\"fs/fscache\"",
            "NULL"
          ],
          "line": 25
        },
        "resolved": true,
        "details": {
          "function_name": "proc_mkdir",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/proc/generic.c",
          "lines": "451-455",
          "snippet": "struct proc_dir_entry *proc_mkdir(const char *name,\n\t\tstruct proc_dir_entry *parent)\n{\n\treturn proc_mkdir_data(name, 0, parent, NULL);\n}",
          "includes": [
            "#include \"internal.h\"",
            "#include <asm/uaccess.h>",
            "#include <linux/completion.h>",
            "#include <linux/spinlock.h>",
            "#include <linux/bitops.h>",
            "#include <linux/idr.h>",
            "#include <linux/init.h>",
            "#include <linux/mount.h>",
            "#include <linux/printk.h>",
            "#include <linux/slab.h>",
            "#include <linux/module.h>",
            "#include <linux/mm.h>",
            "#include <linux/stat.h>",
            "#include <linux/proc_fs.h>",
            "#include <linux/time.h>",
            "#include <linux/errno.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"internal.h\"\n#include <asm/uaccess.h>\n#include <linux/completion.h>\n#include <linux/spinlock.h>\n#include <linux/bitops.h>\n#include <linux/idr.h>\n#include <linux/init.h>\n#include <linux/mount.h>\n#include <linux/printk.h>\n#include <linux/slab.h>\n#include <linux/module.h>\n#include <linux/mm.h>\n#include <linux/stat.h>\n#include <linux/proc_fs.h>\n#include <linux/time.h>\n#include <linux/errno.h>\n\nstruct proc_dir_entry *proc_mkdir(const char *name,\n\t\tstruct proc_dir_entry *parent)\n{\n\treturn proc_mkdir_data(name, 0, parent, NULL);\n}"
        }
      },
      {
        "call_info": {
          "callee": "_enter",
          "args": [
            "\"\""
          ],
          "line": 23
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"internal.h\"\n#include <linux/seq_file.h>\n#include <linux/proc_fs.h>\n#include <linux/module.h>\n\nint __init fscache_proc_init(void)\n{\n\t_enter(\"\");\n\n\tif (!proc_mkdir(\"fs/fscache\", NULL))\n\t\tgoto error_dir;\n\n#ifdef CONFIG_FSCACHE_STATS\n\tif (!proc_create(\"fs/fscache/stats\", S_IFREG | 0444, NULL,\n\t\t\t &fscache_stats_fops))\n\t\tgoto error_stats;\n#endif\n\n#ifdef CONFIG_FSCACHE_HISTOGRAM\n\tif (!proc_create(\"fs/fscache/histogram\", S_IFREG | 0444, NULL,\n\t\t\t &fscache_histogram_fops))\n\t\tgoto error_histogram;\n#endif\n\n#ifdef CONFIG_FSCACHE_OBJECT_LIST\n\tif (!proc_create(\"fs/fscache/objects\", S_IFREG | 0444, NULL,\n\t\t\t &fscache_objlist_fops))\n\t\tgoto error_objects;\n#endif\n\n\t_leave(\" = 0\");\n\treturn 0;\n\n#ifdef CONFIG_FSCACHE_OBJECT_LIST\nerror_objects:\n#endif\n#ifdef CONFIG_FSCACHE_HISTOGRAM\n\tremove_proc_entry(\"fs/fscache/histogram\", NULL);\nerror_histogram:\n#endif\n#ifdef CONFIG_FSCACHE_STATS\n\tremove_proc_entry(\"fs/fscache/stats\", NULL);\nerror_stats:\n#endif\n\tremove_proc_entry(\"fs/fscache\", NULL);\nerror_dir:\n\t_leave(\" = -ENOMEM\");\n\treturn -ENOMEM;\n}"
  }
]