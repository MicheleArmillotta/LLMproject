[
  {
    "function_name": "qnx6_lookup",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/qnx6/namei.c",
    "lines": "15-42",
    "snippet": "struct dentry *qnx6_lookup(struct inode *dir, struct dentry *dentry,\n\t\t\t\tunsigned int flags)\n{\n\tunsigned ino;\n\tstruct page *page;\n\tstruct inode *foundinode = NULL;\n\tconst char *name = dentry->d_name.name;\n\tint len = dentry->d_name.len;\n\n\tif (len > QNX6_LONG_NAME_MAX)\n\t\treturn ERR_PTR(-ENAMETOOLONG);\n\n\tino = qnx6_find_entry(len, dir, name, &page);\n\tif (ino) {\n\t\tfoundinode = qnx6_iget(dir->i_sb, ino);\n\t\tqnx6_put_page(page);\n\t\tif (IS_ERR(foundinode)) {\n\t\t\tpr_debug(\"lookup->iget ->  error %ld\\n\",\n\t\t\t\t PTR_ERR(foundinode));\n\t\t\treturn ERR_CAST(foundinode);\n\t\t}\n\t} else {\n\t\tpr_debug(\"%s(): not found %s\\n\", __func__, name);\n\t\treturn NULL;\n\t}\n\td_add(dentry, foundinode);\n\treturn NULL;\n}",
    "includes": [
      "#include \"qnx6.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "d_add",
          "args": [
            "dentry",
            "foundinode"
          ],
          "line": 40
        },
        "resolved": true,
        "details": {
          "function_name": "v9fs_fid_add",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/9p/fid.c",
          "lines": "49-54",
          "snippet": "void v9fs_fid_add(struct dentry *dentry, struct p9_fid *fid)\n{\n\tspin_lock(&dentry->d_lock);\n\t__add_fid(dentry, fid);\n\tspin_unlock(&dentry->d_lock);\n}",
          "includes": [
            "#include \"fid.h\"",
            "#include \"v9fs_vfs.h\"",
            "#include \"v9fs.h\"",
            "#include <net/9p/client.h>",
            "#include <net/9p/9p.h>",
            "#include <linux/idr.h>",
            "#include <linux/sched.h>",
            "#include <linux/slab.h>",
            "#include <linux/fs.h>",
            "#include <linux/errno.h>",
            "#include <linux/module.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"fid.h\"\n#include \"v9fs_vfs.h\"\n#include \"v9fs.h\"\n#include <net/9p/client.h>\n#include <net/9p/9p.h>\n#include <linux/idr.h>\n#include <linux/sched.h>\n#include <linux/slab.h>\n#include <linux/fs.h>\n#include <linux/errno.h>\n#include <linux/module.h>\n\nvoid v9fs_fid_add(struct dentry *dentry, struct p9_fid *fid)\n{\n\tspin_lock(&dentry->d_lock);\n\t__add_fid(dentry, fid);\n\tspin_unlock(&dentry->d_lock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "pr_debug",
          "args": [
            "\"%s(): not found %s\\n\"",
            "__func__",
            "name"
          ],
          "line": 37
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ERR_CAST",
          "args": [
            "foundinode"
          ],
          "line": 34
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pr_debug",
          "args": [
            "\"lookup->iget ->  error %ld\\n\"",
            "PTR_ERR(foundinode)"
          ],
          "line": 32
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "PTR_ERR",
          "args": [
            "foundinode"
          ],
          "line": 33
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "IS_ERR",
          "args": [
            "foundinode"
          ],
          "line": 31
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "qnx6_put_page",
          "args": [
            "page"
          ],
          "line": 30
        },
        "resolved": true,
        "details": {
          "function_name": "qnx6_put_page",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/qnx6/qnx6.h",
          "lines": "128-132",
          "snippet": "static inline void qnx6_put_page(struct page *page)\n{\n\tkunmap(page);\n\tpage_cache_release(page);\n}",
          "includes": [
            "#include <linux/qnx6_fs.h>",
            "#include <linux/pagemap.h>",
            "#include <linux/fs.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/qnx6_fs.h>\n#include <linux/pagemap.h>\n#include <linux/fs.h>\n\nstatic inline void qnx6_put_page(struct page *page)\n{\n\tkunmap(page);\n\tpage_cache_release(page);\n}"
        }
      },
      {
        "call_info": {
          "callee": "qnx6_iget",
          "args": [
            "dir->i_sb",
            "ino"
          ],
          "line": 29
        },
        "resolved": true,
        "details": {
          "function_name": "qnx6_iget",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/qnx6/inode.c",
          "lines": "519-591",
          "snippet": "struct inode *qnx6_iget(struct super_block *sb, unsigned ino)\n{\n\tstruct qnx6_sb_info *sbi = QNX6_SB(sb);\n\tstruct qnx6_inode_entry *raw_inode;\n\tstruct inode *inode;\n\tstruct qnx6_inode_info\t*ei;\n\tstruct address_space *mapping;\n\tstruct page *page;\n\tu32 n, offs;\n\n\tinode = iget_locked(sb, ino);\n\tif (!inode)\n\t\treturn ERR_PTR(-ENOMEM);\n\tif (!(inode->i_state & I_NEW))\n\t\treturn inode;\n\n\tei = QNX6_I(inode);\n\n\tinode->i_mode = 0;\n\n\tif (ino == 0) {\n\t\tpr_err(\"bad inode number on dev %s: %u is out of range\\n\",\n\t\t       sb->s_id, ino);\n\t\tiget_failed(inode);\n\t\treturn ERR_PTR(-EIO);\n\t}\n\tn = (ino - 1) >> (PAGE_CACHE_SHIFT - QNX6_INODE_SIZE_BITS);\n\toffs = (ino - 1) & (~PAGE_CACHE_MASK >> QNX6_INODE_SIZE_BITS);\n\tmapping = sbi->inodes->i_mapping;\n\tpage = read_mapping_page(mapping, n, NULL);\n\tif (IS_ERR(page)) {\n\t\tpr_err(\"major problem: unable to read inode from dev %s\\n\",\n\t\t       sb->s_id);\n\t\tiget_failed(inode);\n\t\treturn ERR_CAST(page);\n\t}\n\tkmap(page);\n\traw_inode = ((struct qnx6_inode_entry *)page_address(page)) + offs;\n\n\tinode->i_mode    = fs16_to_cpu(sbi, raw_inode->di_mode);\n\ti_uid_write(inode, (uid_t)fs32_to_cpu(sbi, raw_inode->di_uid));\n\ti_gid_write(inode, (gid_t)fs32_to_cpu(sbi, raw_inode->di_gid));\n\tinode->i_size    = fs64_to_cpu(sbi, raw_inode->di_size);\n\tinode->i_mtime.tv_sec   = fs32_to_cpu(sbi, raw_inode->di_mtime);\n\tinode->i_mtime.tv_nsec = 0;\n\tinode->i_atime.tv_sec   = fs32_to_cpu(sbi, raw_inode->di_atime);\n\tinode->i_atime.tv_nsec = 0;\n\tinode->i_ctime.tv_sec   = fs32_to_cpu(sbi, raw_inode->di_ctime);\n\tinode->i_ctime.tv_nsec = 0;\n\n\t/* calc blocks based on 512 byte blocksize */\n\tinode->i_blocks = (inode->i_size + 511) >> 9;\n\n\tmemcpy(&ei->di_block_ptr, &raw_inode->di_block_ptr,\n\t\t\t\tsizeof(raw_inode->di_block_ptr));\n\tei->di_filelevels = raw_inode->di_filelevels;\n\n\tif (S_ISREG(inode->i_mode)) {\n\t\tinode->i_fop = &generic_ro_fops;\n\t\tinode->i_mapping->a_ops = &qnx6_aops;\n\t} else if (S_ISDIR(inode->i_mode)) {\n\t\tinode->i_op = &qnx6_dir_inode_operations;\n\t\tinode->i_fop = &qnx6_dir_operations;\n\t\tinode->i_mapping->a_ops = &qnx6_aops;\n\t} else if (S_ISLNK(inode->i_mode)) {\n\t\tinode->i_op = &page_symlink_inode_operations;\n\t\tinode->i_mapping->a_ops = &qnx6_aops;\n\t} else\n\t\tinit_special_inode(inode, inode->i_mode, 0);\n\tqnx6_put_page(page);\n\tunlock_new_inode(inode);\n\treturn inode;\n}",
          "includes": [
            "#include \"qnx6.h\"",
            "#include <linux/mpage.h>",
            "#include <linux/crc32.h>",
            "#include <linux/mount.h>",
            "#include <linux/seq_file.h>",
            "#include <linux/parser.h>",
            "#include <linux/statfs.h>",
            "#include <linux/writeback.h>",
            "#include <linux/buffer_head.h>",
            "#include <linux/pagemap.h>",
            "#include <linux/highuid.h>",
            "#include <linux/slab.h>",
            "#include <linux/init.h>",
            "#include <linux/module.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void qnx6_put_super(struct super_block *sb);",
            "static struct inode *qnx6_alloc_inode(struct super_block *sb);",
            "static void qnx6_destroy_inode(struct inode *inode);",
            "static const struct address_space_operations qnx6_aops = {\n\t.readpage\t= qnx6_readpage,\n\t.readpages\t= qnx6_readpages,\n\t.bmap\t\t= qnx6_bmap\n};"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"qnx6.h\"\n#include <linux/mpage.h>\n#include <linux/crc32.h>\n#include <linux/mount.h>\n#include <linux/seq_file.h>\n#include <linux/parser.h>\n#include <linux/statfs.h>\n#include <linux/writeback.h>\n#include <linux/buffer_head.h>\n#include <linux/pagemap.h>\n#include <linux/highuid.h>\n#include <linux/slab.h>\n#include <linux/init.h>\n#include <linux/module.h>\n\nstatic void qnx6_put_super(struct super_block *sb);\nstatic struct inode *qnx6_alloc_inode(struct super_block *sb);\nstatic void qnx6_destroy_inode(struct inode *inode);\nstatic const struct address_space_operations qnx6_aops = {\n\t.readpage\t= qnx6_readpage,\n\t.readpages\t= qnx6_readpages,\n\t.bmap\t\t= qnx6_bmap\n};\n\nstruct inode *qnx6_iget(struct super_block *sb, unsigned ino)\n{\n\tstruct qnx6_sb_info *sbi = QNX6_SB(sb);\n\tstruct qnx6_inode_entry *raw_inode;\n\tstruct inode *inode;\n\tstruct qnx6_inode_info\t*ei;\n\tstruct address_space *mapping;\n\tstruct page *page;\n\tu32 n, offs;\n\n\tinode = iget_locked(sb, ino);\n\tif (!inode)\n\t\treturn ERR_PTR(-ENOMEM);\n\tif (!(inode->i_state & I_NEW))\n\t\treturn inode;\n\n\tei = QNX6_I(inode);\n\n\tinode->i_mode = 0;\n\n\tif (ino == 0) {\n\t\tpr_err(\"bad inode number on dev %s: %u is out of range\\n\",\n\t\t       sb->s_id, ino);\n\t\tiget_failed(inode);\n\t\treturn ERR_PTR(-EIO);\n\t}\n\tn = (ino - 1) >> (PAGE_CACHE_SHIFT - QNX6_INODE_SIZE_BITS);\n\toffs = (ino - 1) & (~PAGE_CACHE_MASK >> QNX6_INODE_SIZE_BITS);\n\tmapping = sbi->inodes->i_mapping;\n\tpage = read_mapping_page(mapping, n, NULL);\n\tif (IS_ERR(page)) {\n\t\tpr_err(\"major problem: unable to read inode from dev %s\\n\",\n\t\t       sb->s_id);\n\t\tiget_failed(inode);\n\t\treturn ERR_CAST(page);\n\t}\n\tkmap(page);\n\traw_inode = ((struct qnx6_inode_entry *)page_address(page)) + offs;\n\n\tinode->i_mode    = fs16_to_cpu(sbi, raw_inode->di_mode);\n\ti_uid_write(inode, (uid_t)fs32_to_cpu(sbi, raw_inode->di_uid));\n\ti_gid_write(inode, (gid_t)fs32_to_cpu(sbi, raw_inode->di_gid));\n\tinode->i_size    = fs64_to_cpu(sbi, raw_inode->di_size);\n\tinode->i_mtime.tv_sec   = fs32_to_cpu(sbi, raw_inode->di_mtime);\n\tinode->i_mtime.tv_nsec = 0;\n\tinode->i_atime.tv_sec   = fs32_to_cpu(sbi, raw_inode->di_atime);\n\tinode->i_atime.tv_nsec = 0;\n\tinode->i_ctime.tv_sec   = fs32_to_cpu(sbi, raw_inode->di_ctime);\n\tinode->i_ctime.tv_nsec = 0;\n\n\t/* calc blocks based on 512 byte blocksize */\n\tinode->i_blocks = (inode->i_size + 511) >> 9;\n\n\tmemcpy(&ei->di_block_ptr, &raw_inode->di_block_ptr,\n\t\t\t\tsizeof(raw_inode->di_block_ptr));\n\tei->di_filelevels = raw_inode->di_filelevels;\n\n\tif (S_ISREG(inode->i_mode)) {\n\t\tinode->i_fop = &generic_ro_fops;\n\t\tinode->i_mapping->a_ops = &qnx6_aops;\n\t} else if (S_ISDIR(inode->i_mode)) {\n\t\tinode->i_op = &qnx6_dir_inode_operations;\n\t\tinode->i_fop = &qnx6_dir_operations;\n\t\tinode->i_mapping->a_ops = &qnx6_aops;\n\t} else if (S_ISLNK(inode->i_mode)) {\n\t\tinode->i_op = &page_symlink_inode_operations;\n\t\tinode->i_mapping->a_ops = &qnx6_aops;\n\t} else\n\t\tinit_special_inode(inode, inode->i_mode, 0);\n\tqnx6_put_page(page);\n\tunlock_new_inode(inode);\n\treturn inode;\n}"
        }
      },
      {
        "call_info": {
          "callee": "qnx6_find_entry",
          "args": [
            "len",
            "dir",
            "name",
            "&page"
          ],
          "line": 27
        },
        "resolved": true,
        "details": {
          "function_name": "qnx6_find_entry",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/qnx6/dir.c",
          "lines": "217-275",
          "snippet": "unsigned qnx6_find_entry(int len, struct inode *dir, const char *name,\n\t\t\t struct page **res_page)\n{\n\tstruct super_block *s = dir->i_sb;\n\tstruct qnx6_inode_info *ei = QNX6_I(dir);\n\tstruct page *page = NULL;\n\tunsigned long start, n;\n\tunsigned long npages = dir_pages(dir);\n\tunsigned ino;\n\tstruct qnx6_dir_entry *de;\n\tstruct qnx6_long_dir_entry *lde;\n\n\t*res_page = NULL;\n\n\tif (npages == 0)\n\t\treturn 0;\n\tstart = ei->i_dir_start_lookup;\n\tif (start >= npages)\n\t\tstart = 0;\n\tn = start;\n\n\tdo {\n\t\tpage = qnx6_get_page(dir, n);\n\t\tif (!IS_ERR(page)) {\n\t\t\tint limit = last_entry(dir, n);\n\t\t\tint i;\n\n\t\t\tde = (struct qnx6_dir_entry *)page_address(page);\n\t\t\tfor (i = 0; i < limit; i++, de++) {\n\t\t\t\tif (len <= QNX6_SHORT_NAME_MAX) {\n\t\t\t\t\t/* short filename */\n\t\t\t\t\tif (len != de->de_size)\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\tino = qnx6_match(s, len, name, de);\n\t\t\t\t\tif (ino)\n\t\t\t\t\t\tgoto found;\n\t\t\t\t} else if (de->de_size == 0xff) {\n\t\t\t\t\t/* deal with long filename */\n\t\t\t\t\tlde = (struct qnx6_long_dir_entry *)de;\n\t\t\t\t\tino = qnx6_long_match(len,\n\t\t\t\t\t\t\t\tname, lde, dir);\n\t\t\t\t\tif (ino)\n\t\t\t\t\t\tgoto found;\n\t\t\t\t} else\n\t\t\t\t\tpr_err(\"undefined filename size in inode.\\n\");\n\t\t\t}\n\t\t\tqnx6_put_page(page);\n\t\t}\n\n\t\tif (++n >= npages)\n\t\t\tn = 0;\n\t} while (n != start);\n\treturn 0;\n\nfound:\n\t*res_page = page;\n\tei->i_dir_start_lookup = n;\n\treturn ino;\n}",
          "includes": [
            "#include \"qnx6.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"qnx6.h\"\n\nunsigned qnx6_find_entry(int len, struct inode *dir, const char *name,\n\t\t\t struct page **res_page)\n{\n\tstruct super_block *s = dir->i_sb;\n\tstruct qnx6_inode_info *ei = QNX6_I(dir);\n\tstruct page *page = NULL;\n\tunsigned long start, n;\n\tunsigned long npages = dir_pages(dir);\n\tunsigned ino;\n\tstruct qnx6_dir_entry *de;\n\tstruct qnx6_long_dir_entry *lde;\n\n\t*res_page = NULL;\n\n\tif (npages == 0)\n\t\treturn 0;\n\tstart = ei->i_dir_start_lookup;\n\tif (start >= npages)\n\t\tstart = 0;\n\tn = start;\n\n\tdo {\n\t\tpage = qnx6_get_page(dir, n);\n\t\tif (!IS_ERR(page)) {\n\t\t\tint limit = last_entry(dir, n);\n\t\t\tint i;\n\n\t\t\tde = (struct qnx6_dir_entry *)page_address(page);\n\t\t\tfor (i = 0; i < limit; i++, de++) {\n\t\t\t\tif (len <= QNX6_SHORT_NAME_MAX) {\n\t\t\t\t\t/* short filename */\n\t\t\t\t\tif (len != de->de_size)\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\tino = qnx6_match(s, len, name, de);\n\t\t\t\t\tif (ino)\n\t\t\t\t\t\tgoto found;\n\t\t\t\t} else if (de->de_size == 0xff) {\n\t\t\t\t\t/* deal with long filename */\n\t\t\t\t\tlde = (struct qnx6_long_dir_entry *)de;\n\t\t\t\t\tino = qnx6_long_match(len,\n\t\t\t\t\t\t\t\tname, lde, dir);\n\t\t\t\t\tif (ino)\n\t\t\t\t\t\tgoto found;\n\t\t\t\t} else\n\t\t\t\t\tpr_err(\"undefined filename size in inode.\\n\");\n\t\t\t}\n\t\t\tqnx6_put_page(page);\n\t\t}\n\n\t\tif (++n >= npages)\n\t\t\tn = 0;\n\t} while (n != start);\n\treturn 0;\n\nfound:\n\t*res_page = page;\n\tei->i_dir_start_lookup = n;\n\treturn ino;\n}"
        }
      },
      {
        "call_info": {
          "callee": "ERR_PTR",
          "args": [
            "-ENAMETOOLONG"
          ],
          "line": 25
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"qnx6.h\"\n\nstruct dentry *qnx6_lookup(struct inode *dir, struct dentry *dentry,\n\t\t\t\tunsigned int flags)\n{\n\tunsigned ino;\n\tstruct page *page;\n\tstruct inode *foundinode = NULL;\n\tconst char *name = dentry->d_name.name;\n\tint len = dentry->d_name.len;\n\n\tif (len > QNX6_LONG_NAME_MAX)\n\t\treturn ERR_PTR(-ENAMETOOLONG);\n\n\tino = qnx6_find_entry(len, dir, name, &page);\n\tif (ino) {\n\t\tfoundinode = qnx6_iget(dir->i_sb, ino);\n\t\tqnx6_put_page(page);\n\t\tif (IS_ERR(foundinode)) {\n\t\t\tpr_debug(\"lookup->iget ->  error %ld\\n\",\n\t\t\t\t PTR_ERR(foundinode));\n\t\t\treturn ERR_CAST(foundinode);\n\t\t}\n\t} else {\n\t\tpr_debug(\"%s(): not found %s\\n\", __func__, name);\n\t\treturn NULL;\n\t}\n\td_add(dentry, foundinode);\n\treturn NULL;\n}"
  }
]