[
  {
    "function_name": "ffs2_sum_write_sumnode(",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/jffs2/summary.c",
    "lines": "846-874",
    "snippet": "nt jffs2_sum_write_sumnode(struct jffs2_sb_info *c)\n\t__must_hold(&c->erase_completion_block)\n{\n\tint datasize, infosize, padsize;\n\tstruct jffs2_eraseblock *jeb;\n\tint ret = 0;\n\n\tdbg_summary(\"called\\n\");\n\n\tspin_unlock(&c->erase_completion_lock);\n\n\tjeb = c->nextblock;\n\tjffs2_prealloc_raw_node_refs(c, jeb, 1);\n\n\tif (!c->summary->sum_num || !c->summary->sum_list_head) {\n\t\tJFFS2_WARNING(\"Empty summary info!!!\\n\");\n\t\tBUG();\n\t}\n\n\tdatasize = c->summary->sum_size + sizeof(struct jffs2_sum_marker);\n\tinfosize = sizeof(struct jffs2_raw_summary) + datasize;\n\tpadsize = jeb->free_size - infosize;\n\tinfosize += padsize;\n\tdatasize += padsize;\n\n\tret = jffs2_sum_write_data(c, jeb, infosize, datasize, padsize);\n\tspin_lock(&c->erase_completion_lock);\n\treturn ret;\n}",
    "includes": [
      "include \"debug.h\"",
      "include \"nodelist.h\"\n#",
      "include <linux/vmalloc.h>\n#",
      "include <linux/compiler.h>\n#",
      "include <linux/crc32.h>\n#",
      "include <linux/pagemap.h>\n#",
      "include <linux/mtd/mtd.h>\n#",
      "include <linux/slab.h>\n#",
      "include <linux/kernel.h>\n#"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "pin_lock(",
          "args": [
            "c->erase_completion_lock)"
          ],
          "line": 872
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ffs2_sum_write_data(",
          "args": [
            ",",
            "eb,",
            "nfosize,",
            "atasize,",
            "adsize)"
          ],
          "line": 871
        },
        "resolved": true,
        "details": {
          "function_name": "ffs2_sum_write_data(",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/jffs2/summary.c",
          "lines": "674-842",
          "snippet": "tatic int jffs2_sum_write_data(struct jffs2_sb_info *c, struct jffs2_eraseblock *jeb,\n\t\t\t\tuint32_t infosize, uint32_t datasize, int padsize)\n{\n\tstruct jffs2_raw_summary isum;\n\tunion jffs2_sum_mem *temp;\n\tstruct jffs2_sum_marker *sm;\n\tstruct kvec vecs[2];\n\tuint32_t sum_ofs;\n\tvoid *wpage;\n\tint ret;\n\tsize_t retlen;\n\n\tif (padsize + datasize > MAX_SUMMARY_SIZE) {\n\t\t/* It won't fit in the buffer. Abort summary for this jeb */\n\t\tjffs2_sum_disable_collecting(c->summary);\n\n\t\tJFFS2_WARNING(\"Summary too big (%d data, %d pad) in eraseblock at %08x\\n\",\n\t\t\t      datasize, padsize, jeb->offset);\n\t\t/* Non-fatal */\n\t\treturn 0;\n\t}\n\t/* Is there enough space for summary? */\n\tif (padsize < 0) {\n\t\t/* don't try to write out summary for this jeb */\n\t\tjffs2_sum_disable_collecting(c->summary);\n\n\t\tJFFS2_WARNING(\"Not enough space for summary, padsize = %d\\n\",\n\t\t\t      padsize);\n\t\t/* Non-fatal */\n\t\treturn 0;\n\t}\n\n\tmemset(c->summary->sum_buf, 0xff, datasize);\n\tmemset(&isum, 0, sizeof(isum));\n\n\tisum.magic = cpu_to_je16(JFFS2_MAGIC_BITMASK);\n\tisum.nodetype = cpu_to_je16(JFFS2_NODETYPE_SUMMARY);\n\tisum.totlen = cpu_to_je32(infosize);\n\tisum.hdr_crc = cpu_to_je32(crc32(0, &isum, sizeof(struct jffs2_unknown_node) - 4));\n\tisum.padded = cpu_to_je32(c->summary->sum_padded);\n\tisum.cln_mkr = cpu_to_je32(c->cleanmarker_size);\n\tisum.sum_num = cpu_to_je32(c->summary->sum_num);\n\twpage = c->summary->sum_buf;\n\n\twhile (c->summary->sum_num) {\n\t\ttemp = c->summary->sum_list_head;\n\n\t\tswitch (je16_to_cpu(temp->u.nodetype)) {\n\t\t\tcase JFFS2_NODETYPE_INODE: {\n\t\t\t\tstruct jffs2_sum_inode_flash *sino_ptr = wpage;\n\n\t\t\t\tsino_ptr->nodetype = temp->i.nodetype;\n\t\t\t\tsino_ptr->inode = temp->i.inode;\n\t\t\t\tsino_ptr->version = temp->i.version;\n\t\t\t\tsino_ptr->offset = temp->i.offset;\n\t\t\t\tsino_ptr->totlen = temp->i.totlen;\n\n\t\t\t\twpage += JFFS2_SUMMARY_INODE_SIZE;\n\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tcase JFFS2_NODETYPE_DIRENT: {\n\t\t\t\tstruct jffs2_sum_dirent_flash *sdrnt_ptr = wpage;\n\n\t\t\t\tsdrnt_ptr->nodetype = temp->d.nodetype;\n\t\t\t\tsdrnt_ptr->totlen = temp->d.totlen;\n\t\t\t\tsdrnt_ptr->offset = temp->d.offset;\n\t\t\t\tsdrnt_ptr->pino = temp->d.pino;\n\t\t\t\tsdrnt_ptr->version = temp->d.version;\n\t\t\t\tsdrnt_ptr->ino = temp->d.ino;\n\t\t\t\tsdrnt_ptr->nsize = temp->d.nsize;\n\t\t\t\tsdrnt_ptr->type = temp->d.type;\n\n\t\t\t\tmemcpy(sdrnt_ptr->name, temp->d.name,\n\t\t\t\t\t\t\ttemp->d.nsize);\n\n\t\t\t\twpage += JFFS2_SUMMARY_DIRENT_SIZE(temp->d.nsize);\n\n\t\t\t\tbreak;\n\t\t\t}\n#ifdef CONFIG_JFFS2_FS_XATTR\n\t\t\tcase JFFS2_NODETYPE_XATTR: {\n\t\t\t\tstruct jffs2_sum_xattr_flash *sxattr_ptr = wpage;\n\n\t\t\t\ttemp = c->summary->sum_list_head;\n\t\t\t\tsxattr_ptr->nodetype = temp->x.nodetype;\n\t\t\t\tsxattr_ptr->xid = temp->x.xid;\n\t\t\t\tsxattr_ptr->version = temp->x.version;\n\t\t\t\tsxattr_ptr->offset = temp->x.offset;\n\t\t\t\tsxattr_ptr->totlen = temp->x.totlen;\n\n\t\t\t\twpage += JFFS2_SUMMARY_XATTR_SIZE;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase JFFS2_NODETYPE_XREF: {\n\t\t\t\tstruct jffs2_sum_xref_flash *sxref_ptr = wpage;\n\n\t\t\t\ttemp = c->summary->sum_list_head;\n\t\t\t\tsxref_ptr->nodetype = temp->r.nodetype;\n\t\t\t\tsxref_ptr->offset = temp->r.offset;\n\n\t\t\t\twpage += JFFS2_SUMMARY_XREF_SIZE;\n\t\t\t\tbreak;\n\t\t\t}\n#endif\n\t\t\tdefault : {\n\t\t\t\tif ((je16_to_cpu(temp->u.nodetype) & JFFS2_COMPAT_MASK)\n\t\t\t\t    == JFFS2_FEATURE_RWCOMPAT_COPY) {\n\t\t\t\t\tdbg_summary(\"Writing unknown RWCOMPAT_COPY node type %x\\n\",\n\t\t\t\t\t\t    je16_to_cpu(temp->u.nodetype));\n\t\t\t\t\tjffs2_sum_disable_collecting(c->summary);\n\t\t\t\t} else {\n\t\t\t\t\tBUG();\t/* unknown node in summary information */\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tc->summary->sum_list_head = temp->u.next;\n\t\tkfree(temp);\n\n\t\tc->summary->sum_num--;\n\t}\n\n\tjffs2_sum_reset_collected(c->summary);\n\n\twpage += padsize;\n\n\tsm = wpage;\n\tsm->offset = cpu_to_je32(c->sector_size - jeb->free_size);\n\tsm->magic = cpu_to_je32(JFFS2_SUM_MAGIC);\n\n\tisum.sum_crc = cpu_to_je32(crc32(0, c->summary->sum_buf, datasize));\n\tisum.node_crc = cpu_to_je32(crc32(0, &isum, sizeof(isum) - 8));\n\n\tvecs[0].iov_base = &isum;\n\tvecs[0].iov_len = sizeof(isum);\n\tvecs[1].iov_base = c->summary->sum_buf;\n\tvecs[1].iov_len = datasize;\n\n\tsum_ofs = jeb->offset + c->sector_size - jeb->free_size;\n\n\tdbg_summary(\"writing out data to flash to pos : 0x%08x\\n\", sum_ofs);\n\n\tret = jffs2_flash_writev(c, vecs, 2, sum_ofs, &retlen, 0);\n\n\tif (ret || (retlen != infosize)) {\n\n\t\tJFFS2_WARNING(\"Write of %u bytes at 0x%08x failed. returned %d, retlen %zd\\n\",\n\t\t\t      infosize, sum_ofs, ret, retlen);\n\n\t\tif (retlen) {\n\t\t\t/* Waste remaining space */\n\t\t\tspin_lock(&c->erase_completion_lock);\n\t\t\tjffs2_link_node_ref(c, jeb, sum_ofs | REF_OBSOLETE, infosize, NULL);\n\t\t\tspin_unlock(&c->erase_completion_lock);\n\t\t}\n\n\t\tc->summary->sum_size = JFFS2_SUMMARY_NOSUM_SIZE;\n\n\t\treturn 0;\n\t}\n\n\tspin_lock(&c->erase_completion_lock);\n\tjffs2_link_node_ref(c, jeb, sum_ofs | REF_NORMAL, infosize, NULL);\n\tspin_unlock(&c->erase_completion_lock);\n\n\treturn 0;\n}",
          "includes": [
            "include \"debug.h\"",
            "include \"nodelist.h\"\n#",
            "include <linux/vmalloc.h>\n#",
            "include <linux/compiler.h>\n#",
            "include <linux/crc32.h>\n#",
            "include <linux/pagemap.h>\n#",
            "include <linux/mtd/mtd.h>\n#",
            "include <linux/slab.h>\n#",
            "include <linux/kernel.h>\n#"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "include \"debug.h\"\ninclude \"nodelist.h\"\n#\ninclude <linux/vmalloc.h>\n#\ninclude <linux/compiler.h>\n#\ninclude <linux/crc32.h>\n#\ninclude <linux/pagemap.h>\n#\ninclude <linux/mtd/mtd.h>\n#\ninclude <linux/slab.h>\n#\ninclude <linux/kernel.h>\n#\n\ntatic int jffs2_sum_write_data(struct jffs2_sb_info *c, struct jffs2_eraseblock *jeb,\n\t\t\t\tuint32_t infosize, uint32_t datasize, int padsize)\n{\n\tstruct jffs2_raw_summary isum;\n\tunion jffs2_sum_mem *temp;\n\tstruct jffs2_sum_marker *sm;\n\tstruct kvec vecs[2];\n\tuint32_t sum_ofs;\n\tvoid *wpage;\n\tint ret;\n\tsize_t retlen;\n\n\tif (padsize + datasize > MAX_SUMMARY_SIZE) {\n\t\t/* It won't fit in the buffer. Abort summary for this jeb */\n\t\tjffs2_sum_disable_collecting(c->summary);\n\n\t\tJFFS2_WARNING(\"Summary too big (%d data, %d pad) in eraseblock at %08x\\n\",\n\t\t\t      datasize, padsize, jeb->offset);\n\t\t/* Non-fatal */\n\t\treturn 0;\n\t}\n\t/* Is there enough space for summary? */\n\tif (padsize < 0) {\n\t\t/* don't try to write out summary for this jeb */\n\t\tjffs2_sum_disable_collecting(c->summary);\n\n\t\tJFFS2_WARNING(\"Not enough space for summary, padsize = %d\\n\",\n\t\t\t      padsize);\n\t\t/* Non-fatal */\n\t\treturn 0;\n\t}\n\n\tmemset(c->summary->sum_buf, 0xff, datasize);\n\tmemset(&isum, 0, sizeof(isum));\n\n\tisum.magic = cpu_to_je16(JFFS2_MAGIC_BITMASK);\n\tisum.nodetype = cpu_to_je16(JFFS2_NODETYPE_SUMMARY);\n\tisum.totlen = cpu_to_je32(infosize);\n\tisum.hdr_crc = cpu_to_je32(crc32(0, &isum, sizeof(struct jffs2_unknown_node) - 4));\n\tisum.padded = cpu_to_je32(c->summary->sum_padded);\n\tisum.cln_mkr = cpu_to_je32(c->cleanmarker_size);\n\tisum.sum_num = cpu_to_je32(c->summary->sum_num);\n\twpage = c->summary->sum_buf;\n\n\twhile (c->summary->sum_num) {\n\t\ttemp = c->summary->sum_list_head;\n\n\t\tswitch (je16_to_cpu(temp->u.nodetype)) {\n\t\t\tcase JFFS2_NODETYPE_INODE: {\n\t\t\t\tstruct jffs2_sum_inode_flash *sino_ptr = wpage;\n\n\t\t\t\tsino_ptr->nodetype = temp->i.nodetype;\n\t\t\t\tsino_ptr->inode = temp->i.inode;\n\t\t\t\tsino_ptr->version = temp->i.version;\n\t\t\t\tsino_ptr->offset = temp->i.offset;\n\t\t\t\tsino_ptr->totlen = temp->i.totlen;\n\n\t\t\t\twpage += JFFS2_SUMMARY_INODE_SIZE;\n\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tcase JFFS2_NODETYPE_DIRENT: {\n\t\t\t\tstruct jffs2_sum_dirent_flash *sdrnt_ptr = wpage;\n\n\t\t\t\tsdrnt_ptr->nodetype = temp->d.nodetype;\n\t\t\t\tsdrnt_ptr->totlen = temp->d.totlen;\n\t\t\t\tsdrnt_ptr->offset = temp->d.offset;\n\t\t\t\tsdrnt_ptr->pino = temp->d.pino;\n\t\t\t\tsdrnt_ptr->version = temp->d.version;\n\t\t\t\tsdrnt_ptr->ino = temp->d.ino;\n\t\t\t\tsdrnt_ptr->nsize = temp->d.nsize;\n\t\t\t\tsdrnt_ptr->type = temp->d.type;\n\n\t\t\t\tmemcpy(sdrnt_ptr->name, temp->d.name,\n\t\t\t\t\t\t\ttemp->d.nsize);\n\n\t\t\t\twpage += JFFS2_SUMMARY_DIRENT_SIZE(temp->d.nsize);\n\n\t\t\t\tbreak;\n\t\t\t}\n#ifdef CONFIG_JFFS2_FS_XATTR\n\t\t\tcase JFFS2_NODETYPE_XATTR: {\n\t\t\t\tstruct jffs2_sum_xattr_flash *sxattr_ptr = wpage;\n\n\t\t\t\ttemp = c->summary->sum_list_head;\n\t\t\t\tsxattr_ptr->nodetype = temp->x.nodetype;\n\t\t\t\tsxattr_ptr->xid = temp->x.xid;\n\t\t\t\tsxattr_ptr->version = temp->x.version;\n\t\t\t\tsxattr_ptr->offset = temp->x.offset;\n\t\t\t\tsxattr_ptr->totlen = temp->x.totlen;\n\n\t\t\t\twpage += JFFS2_SUMMARY_XATTR_SIZE;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase JFFS2_NODETYPE_XREF: {\n\t\t\t\tstruct jffs2_sum_xref_flash *sxref_ptr = wpage;\n\n\t\t\t\ttemp = c->summary->sum_list_head;\n\t\t\t\tsxref_ptr->nodetype = temp->r.nodetype;\n\t\t\t\tsxref_ptr->offset = temp->r.offset;\n\n\t\t\t\twpage += JFFS2_SUMMARY_XREF_SIZE;\n\t\t\t\tbreak;\n\t\t\t}\n#endif\n\t\t\tdefault : {\n\t\t\t\tif ((je16_to_cpu(temp->u.nodetype) & JFFS2_COMPAT_MASK)\n\t\t\t\t    == JFFS2_FEATURE_RWCOMPAT_COPY) {\n\t\t\t\t\tdbg_summary(\"Writing unknown RWCOMPAT_COPY node type %x\\n\",\n\t\t\t\t\t\t    je16_to_cpu(temp->u.nodetype));\n\t\t\t\t\tjffs2_sum_disable_collecting(c->summary);\n\t\t\t\t} else {\n\t\t\t\t\tBUG();\t/* unknown node in summary information */\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tc->summary->sum_list_head = temp->u.next;\n\t\tkfree(temp);\n\n\t\tc->summary->sum_num--;\n\t}\n\n\tjffs2_sum_reset_collected(c->summary);\n\n\twpage += padsize;\n\n\tsm = wpage;\n\tsm->offset = cpu_to_je32(c->sector_size - jeb->free_size);\n\tsm->magic = cpu_to_je32(JFFS2_SUM_MAGIC);\n\n\tisum.sum_crc = cpu_to_je32(crc32(0, c->summary->sum_buf, datasize));\n\tisum.node_crc = cpu_to_je32(crc32(0, &isum, sizeof(isum) - 8));\n\n\tvecs[0].iov_base = &isum;\n\tvecs[0].iov_len = sizeof(isum);\n\tvecs[1].iov_base = c->summary->sum_buf;\n\tvecs[1].iov_len = datasize;\n\n\tsum_ofs = jeb->offset + c->sector_size - jeb->free_size;\n\n\tdbg_summary(\"writing out data to flash to pos : 0x%08x\\n\", sum_ofs);\n\n\tret = jffs2_flash_writev(c, vecs, 2, sum_ofs, &retlen, 0);\n\n\tif (ret || (retlen != infosize)) {\n\n\t\tJFFS2_WARNING(\"Write of %u bytes at 0x%08x failed. returned %d, retlen %zd\\n\",\n\t\t\t      infosize, sum_ofs, ret, retlen);\n\n\t\tif (retlen) {\n\t\t\t/* Waste remaining space */\n\t\t\tspin_lock(&c->erase_completion_lock);\n\t\t\tjffs2_link_node_ref(c, jeb, sum_ofs | REF_OBSOLETE, infosize, NULL);\n\t\t\tspin_unlock(&c->erase_completion_lock);\n\t\t}\n\n\t\tc->summary->sum_size = JFFS2_SUMMARY_NOSUM_SIZE;\n\n\t\treturn 0;\n\t}\n\n\tspin_lock(&c->erase_completion_lock);\n\tjffs2_link_node_ref(c, jeb, sum_ofs | REF_NORMAL, infosize, NULL);\n\tspin_unlock(&c->erase_completion_lock);\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "UG(",
          "args": [],
          "line": 862
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "FFS2_WARNING(",
          "args": [
            "Empty summary info!!!\\n\")"
          ],
          "line": 861
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ffs2_prealloc_raw_node_refs(",
          "args": [
            ",",
            "eb,",
            ")"
          ],
          "line": 858
        },
        "resolved": true,
        "details": {
          "function_name": "ffs2_prealloc_raw_node_refs(",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/jffs2/malloc.c",
          "lines": "210-249",
          "snippet": "nt jffs2_prealloc_raw_node_refs(struct jffs2_sb_info *c,\n\t\t\t\t struct jffs2_eraseblock *jeb, int nr)\n{\n\tstruct jffs2_raw_node_ref **p, *ref;\n\tint i = nr;\n\n\tdbg_memalloc(\"%d\\n\", nr);\n\n\tp = &jeb->last_node;\n\tref = *p;\n\n\tdbg_memalloc(\"Reserving %d refs for block @0x%08x\\n\", nr, jeb->offset);\n\n\t/* If jeb->last_node is really a valid node then skip over it */\n\tif (ref && ref->flash_offset != REF_EMPTY_NODE)\n\t\tref++;\n\n\twhile (i) {\n\t\tif (!ref) {\n\t\t\tdbg_memalloc(\"Allocating new refblock linked from %p\\n\", p);\n\t\t\tref = *p = jffs2_alloc_refblock();\n\t\t\tif (!ref)\n\t\t\t\treturn -ENOMEM;\n\t\t}\n\t\tif (ref->flash_offset == REF_LINK_NODE) {\n\t\t\tp = &ref->next_in_ino;\n\t\t\tref = *p;\n\t\t\tcontinue;\n\t\t}\n\t\ti--;\n\t\tref++;\n\t}\n\tjeb->allocated_refs = nr;\n\n\tdbg_memalloc(\"Reserved %d refs for block @0x%08x, last_node is %p (%08x,%p)\\n\",\n\t\t  nr, jeb->offset, jeb->last_node, jeb->last_node->flash_offset,\n\t\t  jeb->last_node->next_in_ino);\n\n\treturn 0;\n}",
          "includes": [
            "include \"nodelist.h\"",
            "include <linux/jffs2.h>\n#",
            "include <linux/init.h>\n#",
            "include <linux/slab.h>\n#",
            "include <linux/kernel.h>\n#"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "include \"nodelist.h\"\ninclude <linux/jffs2.h>\n#\ninclude <linux/init.h>\n#\ninclude <linux/slab.h>\n#\ninclude <linux/kernel.h>\n#\n\nnt jffs2_prealloc_raw_node_refs(struct jffs2_sb_info *c,\n\t\t\t\t struct jffs2_eraseblock *jeb, int nr)\n{\n\tstruct jffs2_raw_node_ref **p, *ref;\n\tint i = nr;\n\n\tdbg_memalloc(\"%d\\n\", nr);\n\n\tp = &jeb->last_node;\n\tref = *p;\n\n\tdbg_memalloc(\"Reserving %d refs for block @0x%08x\\n\", nr, jeb->offset);\n\n\t/* If jeb->last_node is really a valid node then skip over it */\n\tif (ref && ref->flash_offset != REF_EMPTY_NODE)\n\t\tref++;\n\n\twhile (i) {\n\t\tif (!ref) {\n\t\t\tdbg_memalloc(\"Allocating new refblock linked from %p\\n\", p);\n\t\t\tref = *p = jffs2_alloc_refblock();\n\t\t\tif (!ref)\n\t\t\t\treturn -ENOMEM;\n\t\t}\n\t\tif (ref->flash_offset == REF_LINK_NODE) {\n\t\t\tp = &ref->next_in_ino;\n\t\t\tref = *p;\n\t\t\tcontinue;\n\t\t}\n\t\ti--;\n\t\tref++;\n\t}\n\tjeb->allocated_refs = nr;\n\n\tdbg_memalloc(\"Reserved %d refs for block @0x%08x, last_node is %p (%08x,%p)\\n\",\n\t\t  nr, jeb->offset, jeb->last_node, jeb->last_node->flash_offset,\n\t\t  jeb->last_node->next_in_ino);\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "pin_unlock(",
          "args": [
            "c->erase_completion_lock)"
          ],
          "line": 855
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bg_summary(",
          "args": [
            "called\\n\")"
          ],
          "line": 853
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_must_hold(",
          "args": [
            "c->erase_completion_block)"
          ],
          "line": 847
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "include \"debug.h\"\ninclude \"nodelist.h\"\n#\ninclude <linux/vmalloc.h>\n#\ninclude <linux/compiler.h>\n#\ninclude <linux/crc32.h>\n#\ninclude <linux/pagemap.h>\n#\ninclude <linux/mtd/mtd.h>\n#\ninclude <linux/slab.h>\n#\ninclude <linux/kernel.h>\n#\n\nnt jffs2_sum_write_sumnode(struct jffs2_sb_info *c)\n\t__must_hold(&c->erase_completion_block)\n{\n\tint datasize, infosize, padsize;\n\tstruct jffs2_eraseblock *jeb;\n\tint ret = 0;\n\n\tdbg_summary(\"called\\n\");\n\n\tspin_unlock(&c->erase_completion_lock);\n\n\tjeb = c->nextblock;\n\tjffs2_prealloc_raw_node_refs(c, jeb, 1);\n\n\tif (!c->summary->sum_num || !c->summary->sum_list_head) {\n\t\tJFFS2_WARNING(\"Empty summary info!!!\\n\");\n\t\tBUG();\n\t}\n\n\tdatasize = c->summary->sum_size + sizeof(struct jffs2_sum_marker);\n\tinfosize = sizeof(struct jffs2_raw_summary) + datasize;\n\tpadsize = jeb->free_size - infosize;\n\tinfosize += padsize;\n\tdatasize += padsize;\n\n\tret = jffs2_sum_write_data(c, jeb, infosize, datasize, padsize);\n\tspin_lock(&c->erase_completion_lock);\n\treturn ret;\n}"
  },
  {
    "function_name": "ffs2_sum_write_data(",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/jffs2/summary.c",
    "lines": "674-842",
    "snippet": "tatic int jffs2_sum_write_data(struct jffs2_sb_info *c, struct jffs2_eraseblock *jeb,\n\t\t\t\tuint32_t infosize, uint32_t datasize, int padsize)\n{\n\tstruct jffs2_raw_summary isum;\n\tunion jffs2_sum_mem *temp;\n\tstruct jffs2_sum_marker *sm;\n\tstruct kvec vecs[2];\n\tuint32_t sum_ofs;\n\tvoid *wpage;\n\tint ret;\n\tsize_t retlen;\n\n\tif (padsize + datasize > MAX_SUMMARY_SIZE) {\n\t\t/* It won't fit in the buffer. Abort summary for this jeb */\n\t\tjffs2_sum_disable_collecting(c->summary);\n\n\t\tJFFS2_WARNING(\"Summary too big (%d data, %d pad) in eraseblock at %08x\\n\",\n\t\t\t      datasize, padsize, jeb->offset);\n\t\t/* Non-fatal */\n\t\treturn 0;\n\t}\n\t/* Is there enough space for summary? */\n\tif (padsize < 0) {\n\t\t/* don't try to write out summary for this jeb */\n\t\tjffs2_sum_disable_collecting(c->summary);\n\n\t\tJFFS2_WARNING(\"Not enough space for summary, padsize = %d\\n\",\n\t\t\t      padsize);\n\t\t/* Non-fatal */\n\t\treturn 0;\n\t}\n\n\tmemset(c->summary->sum_buf, 0xff, datasize);\n\tmemset(&isum, 0, sizeof(isum));\n\n\tisum.magic = cpu_to_je16(JFFS2_MAGIC_BITMASK);\n\tisum.nodetype = cpu_to_je16(JFFS2_NODETYPE_SUMMARY);\n\tisum.totlen = cpu_to_je32(infosize);\n\tisum.hdr_crc = cpu_to_je32(crc32(0, &isum, sizeof(struct jffs2_unknown_node) - 4));\n\tisum.padded = cpu_to_je32(c->summary->sum_padded);\n\tisum.cln_mkr = cpu_to_je32(c->cleanmarker_size);\n\tisum.sum_num = cpu_to_je32(c->summary->sum_num);\n\twpage = c->summary->sum_buf;\n\n\twhile (c->summary->sum_num) {\n\t\ttemp = c->summary->sum_list_head;\n\n\t\tswitch (je16_to_cpu(temp->u.nodetype)) {\n\t\t\tcase JFFS2_NODETYPE_INODE: {\n\t\t\t\tstruct jffs2_sum_inode_flash *sino_ptr = wpage;\n\n\t\t\t\tsino_ptr->nodetype = temp->i.nodetype;\n\t\t\t\tsino_ptr->inode = temp->i.inode;\n\t\t\t\tsino_ptr->version = temp->i.version;\n\t\t\t\tsino_ptr->offset = temp->i.offset;\n\t\t\t\tsino_ptr->totlen = temp->i.totlen;\n\n\t\t\t\twpage += JFFS2_SUMMARY_INODE_SIZE;\n\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tcase JFFS2_NODETYPE_DIRENT: {\n\t\t\t\tstruct jffs2_sum_dirent_flash *sdrnt_ptr = wpage;\n\n\t\t\t\tsdrnt_ptr->nodetype = temp->d.nodetype;\n\t\t\t\tsdrnt_ptr->totlen = temp->d.totlen;\n\t\t\t\tsdrnt_ptr->offset = temp->d.offset;\n\t\t\t\tsdrnt_ptr->pino = temp->d.pino;\n\t\t\t\tsdrnt_ptr->version = temp->d.version;\n\t\t\t\tsdrnt_ptr->ino = temp->d.ino;\n\t\t\t\tsdrnt_ptr->nsize = temp->d.nsize;\n\t\t\t\tsdrnt_ptr->type = temp->d.type;\n\n\t\t\t\tmemcpy(sdrnt_ptr->name, temp->d.name,\n\t\t\t\t\t\t\ttemp->d.nsize);\n\n\t\t\t\twpage += JFFS2_SUMMARY_DIRENT_SIZE(temp->d.nsize);\n\n\t\t\t\tbreak;\n\t\t\t}\n#ifdef CONFIG_JFFS2_FS_XATTR\n\t\t\tcase JFFS2_NODETYPE_XATTR: {\n\t\t\t\tstruct jffs2_sum_xattr_flash *sxattr_ptr = wpage;\n\n\t\t\t\ttemp = c->summary->sum_list_head;\n\t\t\t\tsxattr_ptr->nodetype = temp->x.nodetype;\n\t\t\t\tsxattr_ptr->xid = temp->x.xid;\n\t\t\t\tsxattr_ptr->version = temp->x.version;\n\t\t\t\tsxattr_ptr->offset = temp->x.offset;\n\t\t\t\tsxattr_ptr->totlen = temp->x.totlen;\n\n\t\t\t\twpage += JFFS2_SUMMARY_XATTR_SIZE;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase JFFS2_NODETYPE_XREF: {\n\t\t\t\tstruct jffs2_sum_xref_flash *sxref_ptr = wpage;\n\n\t\t\t\ttemp = c->summary->sum_list_head;\n\t\t\t\tsxref_ptr->nodetype = temp->r.nodetype;\n\t\t\t\tsxref_ptr->offset = temp->r.offset;\n\n\t\t\t\twpage += JFFS2_SUMMARY_XREF_SIZE;\n\t\t\t\tbreak;\n\t\t\t}\n#endif\n\t\t\tdefault : {\n\t\t\t\tif ((je16_to_cpu(temp->u.nodetype) & JFFS2_COMPAT_MASK)\n\t\t\t\t    == JFFS2_FEATURE_RWCOMPAT_COPY) {\n\t\t\t\t\tdbg_summary(\"Writing unknown RWCOMPAT_COPY node type %x\\n\",\n\t\t\t\t\t\t    je16_to_cpu(temp->u.nodetype));\n\t\t\t\t\tjffs2_sum_disable_collecting(c->summary);\n\t\t\t\t} else {\n\t\t\t\t\tBUG();\t/* unknown node in summary information */\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tc->summary->sum_list_head = temp->u.next;\n\t\tkfree(temp);\n\n\t\tc->summary->sum_num--;\n\t}\n\n\tjffs2_sum_reset_collected(c->summary);\n\n\twpage += padsize;\n\n\tsm = wpage;\n\tsm->offset = cpu_to_je32(c->sector_size - jeb->free_size);\n\tsm->magic = cpu_to_je32(JFFS2_SUM_MAGIC);\n\n\tisum.sum_crc = cpu_to_je32(crc32(0, c->summary->sum_buf, datasize));\n\tisum.node_crc = cpu_to_je32(crc32(0, &isum, sizeof(isum) - 8));\n\n\tvecs[0].iov_base = &isum;\n\tvecs[0].iov_len = sizeof(isum);\n\tvecs[1].iov_base = c->summary->sum_buf;\n\tvecs[1].iov_len = datasize;\n\n\tsum_ofs = jeb->offset + c->sector_size - jeb->free_size;\n\n\tdbg_summary(\"writing out data to flash to pos : 0x%08x\\n\", sum_ofs);\n\n\tret = jffs2_flash_writev(c, vecs, 2, sum_ofs, &retlen, 0);\n\n\tif (ret || (retlen != infosize)) {\n\n\t\tJFFS2_WARNING(\"Write of %u bytes at 0x%08x failed. returned %d, retlen %zd\\n\",\n\t\t\t      infosize, sum_ofs, ret, retlen);\n\n\t\tif (retlen) {\n\t\t\t/* Waste remaining space */\n\t\t\tspin_lock(&c->erase_completion_lock);\n\t\t\tjffs2_link_node_ref(c, jeb, sum_ofs | REF_OBSOLETE, infosize, NULL);\n\t\t\tspin_unlock(&c->erase_completion_lock);\n\t\t}\n\n\t\tc->summary->sum_size = JFFS2_SUMMARY_NOSUM_SIZE;\n\n\t\treturn 0;\n\t}\n\n\tspin_lock(&c->erase_completion_lock);\n\tjffs2_link_node_ref(c, jeb, sum_ofs | REF_NORMAL, infosize, NULL);\n\tspin_unlock(&c->erase_completion_lock);\n\n\treturn 0;\n}",
    "includes": [
      "include \"debug.h\"",
      "include \"nodelist.h\"\n#",
      "include <linux/vmalloc.h>\n#",
      "include <linux/compiler.h>\n#",
      "include <linux/crc32.h>\n#",
      "include <linux/pagemap.h>\n#",
      "include <linux/mtd/mtd.h>\n#",
      "include <linux/slab.h>\n#",
      "include <linux/kernel.h>\n#"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "pin_unlock(",
          "args": [
            "c->erase_completion_lock)"
          ],
          "line": 839
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ffs2_link_node_ref(",
          "args": [
            ",",
            "eb,",
            "um_ofs | REF_NORMAL,",
            "nfosize,",
            "ULL)"
          ],
          "line": 838
        },
        "resolved": true,
        "details": {
          "function_name": "ffs2_link_node_ref(",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/jffs2/nodelist.c",
          "lines": "585-659",
          "snippet": "truct jffs2_raw_node_ref *jffs2_link_node_ref(struct jffs2_sb_info *c,\n\t\t\t\t\t       struct jffs2_eraseblock *jeb,\n\t\t\t\t\t       uint32_t ofs, uint32_t len,\n\t\t\t\t\t       struct jffs2_inode_cache *ic)\n{\n\tstruct jffs2_raw_node_ref *ref;\n\n\tBUG_ON(!jeb->allocated_refs);\n\tjeb->allocated_refs--;\n\n\tref = jeb->last_node;\n\n\tdbg_noderef(\"Last node at %p is (%08x,%p)\\n\", ref, ref->flash_offset,\n\t\t    ref->next_in_ino);\n\n\twhile (ref->flash_offset != REF_EMPTY_NODE) {\n\t\tif (ref->flash_offset == REF_LINK_NODE)\n\t\t\tref = ref->next_in_ino;\n\t\telse\n\t\t\tref++;\n\t}\n\n\tdbg_noderef(\"New ref is %p (%08x becomes %08x,%p) len 0x%x\\n\", ref, \n\t\t    ref->flash_offset, ofs, ref->next_in_ino, len);\n\n\tref->flash_offset = ofs;\n\n\tif (!jeb->first_node) {\n\t\tjeb->first_node = ref;\n\t\tBUG_ON(ref_offset(ref) != jeb->offset);\n\t} else if (unlikely(ref_offset(ref) != jeb->offset + c->sector_size - jeb->free_size)) {\n\t\tuint32_t last_len = ref_totlen(c, jeb, jeb->last_node);\n\n\t\tJFFS2_ERROR(\"Adding new ref %p at (0x%08x-0x%08x) not immediately after previous (0x%08x-0x%08x)\\n\",\n\t\t\t    ref, ref_offset(ref), ref_offset(ref)+len,\n\t\t\t    ref_offset(jeb->last_node), \n\t\t\t    ref_offset(jeb->last_node)+last_len);\n\t\tBUG();\n\t}\n\tjeb->last_node = ref;\n\n\tif (ic) {\n\t\tref->next_in_ino = ic->nodes;\n\t\tic->nodes = ref;\n\t} else {\n\t\tref->next_in_ino = NULL;\n\t}\n\n\tswitch(ref_flags(ref)) {\n\tcase REF_UNCHECKED:\n\t\tc->unchecked_size += len;\n\t\tjeb->unchecked_size += len;\n\t\tbreak;\n\n\tcase REF_NORMAL:\n\tcase REF_PRISTINE:\n\t\tc->used_size += len;\n\t\tjeb->used_size += len;\n\t\tbreak;\n\n\tcase REF_OBSOLETE:\n\t\tc->dirty_size += len;\n\t\tjeb->dirty_size += len;\n\t\tbreak;\n\t}\n\tc->free_size -= len;\n\tjeb->free_size -= len;\n\n#ifdef TEST_TOTLEN\n\t/* Set (and test) __totlen field... for now */\n\tref->__totlen = len;\n\tref_totlen(c, jeb, ref);\n#endif\n\treturn ref;\n}",
          "includes": [
            "include \"nodelist.h\"",
            "include <linux/pagemap.h>\n#",
            "include <linux/crc32.h>\n#",
            "include <linux/rbtree.h>\n#",
            "include <linux/mtd/mtd.h>\n#",
            "include <linux/fs.h>\n#",
            "include <linux/sched.h>\n#",
            "include <linux/kernel.h>\n#"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "include \"nodelist.h\"\ninclude <linux/pagemap.h>\n#\ninclude <linux/crc32.h>\n#\ninclude <linux/rbtree.h>\n#\ninclude <linux/mtd/mtd.h>\n#\ninclude <linux/fs.h>\n#\ninclude <linux/sched.h>\n#\ninclude <linux/kernel.h>\n#\n\ntruct jffs2_raw_node_ref *jffs2_link_node_ref(struct jffs2_sb_info *c,\n\t\t\t\t\t       struct jffs2_eraseblock *jeb,\n\t\t\t\t\t       uint32_t ofs, uint32_t len,\n\t\t\t\t\t       struct jffs2_inode_cache *ic)\n{\n\tstruct jffs2_raw_node_ref *ref;\n\n\tBUG_ON(!jeb->allocated_refs);\n\tjeb->allocated_refs--;\n\n\tref = jeb->last_node;\n\n\tdbg_noderef(\"Last node at %p is (%08x,%p)\\n\", ref, ref->flash_offset,\n\t\t    ref->next_in_ino);\n\n\twhile (ref->flash_offset != REF_EMPTY_NODE) {\n\t\tif (ref->flash_offset == REF_LINK_NODE)\n\t\t\tref = ref->next_in_ino;\n\t\telse\n\t\t\tref++;\n\t}\n\n\tdbg_noderef(\"New ref is %p (%08x becomes %08x,%p) len 0x%x\\n\", ref, \n\t\t    ref->flash_offset, ofs, ref->next_in_ino, len);\n\n\tref->flash_offset = ofs;\n\n\tif (!jeb->first_node) {\n\t\tjeb->first_node = ref;\n\t\tBUG_ON(ref_offset(ref) != jeb->offset);\n\t} else if (unlikely(ref_offset(ref) != jeb->offset + c->sector_size - jeb->free_size)) {\n\t\tuint32_t last_len = ref_totlen(c, jeb, jeb->last_node);\n\n\t\tJFFS2_ERROR(\"Adding new ref %p at (0x%08x-0x%08x) not immediately after previous (0x%08x-0x%08x)\\n\",\n\t\t\t    ref, ref_offset(ref), ref_offset(ref)+len,\n\t\t\t    ref_offset(jeb->last_node), \n\t\t\t    ref_offset(jeb->last_node)+last_len);\n\t\tBUG();\n\t}\n\tjeb->last_node = ref;\n\n\tif (ic) {\n\t\tref->next_in_ino = ic->nodes;\n\t\tic->nodes = ref;\n\t} else {\n\t\tref->next_in_ino = NULL;\n\t}\n\n\tswitch(ref_flags(ref)) {\n\tcase REF_UNCHECKED:\n\t\tc->unchecked_size += len;\n\t\tjeb->unchecked_size += len;\n\t\tbreak;\n\n\tcase REF_NORMAL:\n\tcase REF_PRISTINE:\n\t\tc->used_size += len;\n\t\tjeb->used_size += len;\n\t\tbreak;\n\n\tcase REF_OBSOLETE:\n\t\tc->dirty_size += len;\n\t\tjeb->dirty_size += len;\n\t\tbreak;\n\t}\n\tc->free_size -= len;\n\tjeb->free_size -= len;\n\n#ifdef TEST_TOTLEN\n\t/* Set (and test) __totlen field... for now */\n\tref->__totlen = len;\n\tref_totlen(c, jeb, ref);\n#endif\n\treturn ref;\n}"
        }
      },
      {
        "call_info": {
          "callee": "pin_lock(",
          "args": [
            "c->erase_completion_lock)"
          ],
          "line": 837
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pin_unlock(",
          "args": [
            "c->erase_completion_lock)"
          ],
          "line": 829
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pin_lock(",
          "args": [
            "c->erase_completion_lock)"
          ],
          "line": 827
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "FFS2_WARNING(",
          "args": [
            "Write of %u bytes at 0x%08x failed. returned %d, retlen %zd\\n\",",
            "nfosize,",
            "um_ofs,",
            "et,",
            "etlen)"
          ],
          "line": 822
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ffs2_flash_writev(",
          "args": [
            ",",
            "ecs,",
            ",",
            "um_ofs,",
            "retlen,",
            ")"
          ],
          "line": 818
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bg_summary(",
          "args": [
            "writing out data to flash to pos : 0x%08x\\n\",",
            "um_ofs)"
          ],
          "line": 816
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pu_to_je32(",
          "args": [
            "rc32(0, &isum, sizeof(isum) - 8))"
          ],
          "line": 807
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rc32(",
          "args": [
            ",",
            "isum,",
            "izeof(isum) - 8)"
          ],
          "line": 807
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pu_to_je32(",
          "args": [
            "rc32(0, c->summary->sum_buf, datasize))"
          ],
          "line": 806
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rc32(",
          "args": [
            ",",
            "->summary->sum_buf,",
            "atasize)"
          ],
          "line": 806
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pu_to_je32(",
          "args": [
            "FFS2_SUM_MAGIC)"
          ],
          "line": 804
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pu_to_je32(",
          "args": [
            "->sector_size - jeb->free_size)"
          ],
          "line": 803
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ffs2_sum_reset_collected(",
          "args": [
            "->summary)"
          ],
          "line": 798
        },
        "resolved": true,
        "details": {
          "function_name": "ffs2_sum_reset_collected(",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/jffs2/summary.c",
          "lines": "210-215",
          "snippet": "oid jffs2_sum_reset_collected(struct jffs2_summary *s)\n{\n\tdbg_summary(\"called\\n\");\n\tjffs2_sum_clean_collected(s);\n\ts->sum_size = 0;\n}",
          "includes": [
            "include \"debug.h\"",
            "include \"nodelist.h\"\n#",
            "include <linux/vmalloc.h>\n#",
            "include <linux/compiler.h>\n#",
            "include <linux/crc32.h>\n#",
            "include <linux/pagemap.h>\n#",
            "include <linux/mtd/mtd.h>\n#",
            "include <linux/slab.h>\n#",
            "include <linux/kernel.h>\n#"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "include \"debug.h\"\ninclude \"nodelist.h\"\n#\ninclude <linux/vmalloc.h>\n#\ninclude <linux/compiler.h>\n#\ninclude <linux/crc32.h>\n#\ninclude <linux/pagemap.h>\n#\ninclude <linux/mtd/mtd.h>\n#\ninclude <linux/slab.h>\n#\ninclude <linux/kernel.h>\n#\n\noid jffs2_sum_reset_collected(struct jffs2_summary *s)\n{\n\tdbg_summary(\"called\\n\");\n\tjffs2_sum_clean_collected(s);\n\ts->sum_size = 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "free(",
          "args": [
            "emp)"
          ],
          "line": 793
        },
        "resolved": true,
        "details": {
          "function_name": "in_free(",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/jffs2/scan.c",
          "lines": "51-60",
          "snippet": "tatic inline int min_free(struct jffs2_sb_info *c)\n{\n\tuint32_t min = 2 * sizeof(struct jffs2_raw_inode);\n#ifdef CONFIG_JFFS2_FS_WRITEBUFFER\n\tif (!jffs2_can_mark_obsolete(c) && min < c->wbuf_pagesize)\n\t\treturn c->wbuf_pagesize;\n#endif\n\treturn min;\n\n}",
          "includes": [
            "include \"debug.h\"",
            "include \"summary.h\"\n#",
            "include \"nodelist.h\"\n#",
            "include <linux/compiler.h>\n#",
            "include <linux/crc32.h>\n#",
            "include <linux/pagemap.h>\n#",
            "include <linux/mtd/mtd.h>\n#",
            "include <linux/slab.h>\n#",
            "include <linux/sched.h>\n#",
            "include <linux/kernel.h>\n#"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "include \"debug.h\"\ninclude \"summary.h\"\n#\ninclude \"nodelist.h\"\n#\ninclude <linux/compiler.h>\n#\ninclude <linux/crc32.h>\n#\ninclude <linux/pagemap.h>\n#\ninclude <linux/mtd/mtd.h>\n#\ninclude <linux/slab.h>\n#\ninclude <linux/sched.h>\n#\ninclude <linux/kernel.h>\n#\n\ntatic inline int min_free(struct jffs2_sb_info *c)\n{\n\tuint32_t min = 2 * sizeof(struct jffs2_raw_inode);\n#ifdef CONFIG_JFFS2_FS_WRITEBUFFER\n\tif (!jffs2_can_mark_obsolete(c) && min < c->wbuf_pagesize)\n\t\treturn c->wbuf_pagesize;\n#endif\n\treturn min;\n\n}"
        }
      },
      {
        "call_info": {
          "callee": "UG(",
          "args": [],
          "line": 787
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ffs2_sum_disable_collecting(",
          "args": [
            "->summary)"
          ],
          "line": 785
        },
        "resolved": true,
        "details": {
          "function_name": "ffs2_sum_disable_collecting(",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/jffs2/summary.c",
          "lines": "217-222",
          "snippet": "oid jffs2_sum_disable_collecting(struct jffs2_summary *s)\n{\n\tdbg_summary(\"called\\n\");\n\tjffs2_sum_clean_collected(s);\n\ts->sum_size = JFFS2_SUMMARY_NOSUM_SIZE;\n}",
          "includes": [
            "include \"debug.h\"",
            "include \"nodelist.h\"\n#",
            "include <linux/vmalloc.h>\n#",
            "include <linux/compiler.h>\n#",
            "include <linux/crc32.h>\n#",
            "include <linux/pagemap.h>\n#",
            "include <linux/mtd/mtd.h>\n#",
            "include <linux/slab.h>\n#",
            "include <linux/kernel.h>\n#"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "include \"debug.h\"\ninclude \"nodelist.h\"\n#\ninclude <linux/vmalloc.h>\n#\ninclude <linux/compiler.h>\n#\ninclude <linux/crc32.h>\n#\ninclude <linux/pagemap.h>\n#\ninclude <linux/mtd/mtd.h>\n#\ninclude <linux/slab.h>\n#\ninclude <linux/kernel.h>\n#\n\noid jffs2_sum_disable_collecting(struct jffs2_summary *s)\n{\n\tdbg_summary(\"called\\n\");\n\tjffs2_sum_clean_collected(s);\n\ts->sum_size = JFFS2_SUMMARY_NOSUM_SIZE;\n}"
        }
      },
      {
        "call_info": {
          "callee": "bg_summary(",
          "args": [
            "Writing unknown RWCOMPAT_COPY node type %x\\n\",",
            "e16_to_cpu(temp->u.nodetype))"
          ],
          "line": 783
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "e16_to_cpu(",
          "args": [
            "emp->u.nodetype)"
          ],
          "line": 784
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "e16_to_cpu(",
          "args": [
            "emp->u.nodetype)"
          ],
          "line": 781
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "FFS2_SUMMARY_DIRENT_SIZE(",
          "args": [
            "emp->d.nsize)"
          ],
          "line": 751
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "emcpy(",
          "args": [
            "drnt_ptr->name,",
            "emp->d.name,",
            "emp->d.nsize)"
          ],
          "line": 748
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "e16_to_cpu(",
          "args": [
            "emp->u.nodetype)"
          ],
          "line": 721
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pu_to_je32(",
          "args": [
            "->summary->sum_num)"
          ],
          "line": 715
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pu_to_je32(",
          "args": [
            "->cleanmarker_size)"
          ],
          "line": 714
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pu_to_je32(",
          "args": [
            "->summary->sum_padded)"
          ],
          "line": 713
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pu_to_je32(",
          "args": [
            "rc32(0, &isum, sizeof(struct jffs2_unknown_node) - 4))"
          ],
          "line": 712
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rc32(",
          "args": [
            ",",
            "isum,",
            "izeof(struct jffs2_unknown_node) - 4)"
          ],
          "line": 712
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pu_to_je32(",
          "args": [
            "nfosize)"
          ],
          "line": 711
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pu_to_je16(",
          "args": [
            "FFS2_NODETYPE_SUMMARY)"
          ],
          "line": 710
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pu_to_je16(",
          "args": [
            "FFS2_MAGIC_BITMASK)"
          ],
          "line": 709
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "emset(",
          "args": [
            "isum,",
            ",",
            "izeof(isum))"
          ],
          "line": 707
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "emset(",
          "args": [
            "->summary->sum_buf,",
            "xff,",
            "atasize)"
          ],
          "line": 706
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "FFS2_WARNING(",
          "args": [
            "Not enough space for summary, padsize = %d\\n\",",
            "adsize)"
          ],
          "line": 700
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "FFS2_WARNING(",
          "args": [
            "Summary too big (%d data, %d pad) in eraseblock at %08x\\n\",",
            "atasize,",
            "adsize,",
            "eb->offset)"
          ],
          "line": 690
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "include \"debug.h\"\ninclude \"nodelist.h\"\n#\ninclude <linux/vmalloc.h>\n#\ninclude <linux/compiler.h>\n#\ninclude <linux/crc32.h>\n#\ninclude <linux/pagemap.h>\n#\ninclude <linux/mtd/mtd.h>\n#\ninclude <linux/slab.h>\n#\ninclude <linux/kernel.h>\n#\n\ntatic int jffs2_sum_write_data(struct jffs2_sb_info *c, struct jffs2_eraseblock *jeb,\n\t\t\t\tuint32_t infosize, uint32_t datasize, int padsize)\n{\n\tstruct jffs2_raw_summary isum;\n\tunion jffs2_sum_mem *temp;\n\tstruct jffs2_sum_marker *sm;\n\tstruct kvec vecs[2];\n\tuint32_t sum_ofs;\n\tvoid *wpage;\n\tint ret;\n\tsize_t retlen;\n\n\tif (padsize + datasize > MAX_SUMMARY_SIZE) {\n\t\t/* It won't fit in the buffer. Abort summary for this jeb */\n\t\tjffs2_sum_disable_collecting(c->summary);\n\n\t\tJFFS2_WARNING(\"Summary too big (%d data, %d pad) in eraseblock at %08x\\n\",\n\t\t\t      datasize, padsize, jeb->offset);\n\t\t/* Non-fatal */\n\t\treturn 0;\n\t}\n\t/* Is there enough space for summary? */\n\tif (padsize < 0) {\n\t\t/* don't try to write out summary for this jeb */\n\t\tjffs2_sum_disable_collecting(c->summary);\n\n\t\tJFFS2_WARNING(\"Not enough space for summary, padsize = %d\\n\",\n\t\t\t      padsize);\n\t\t/* Non-fatal */\n\t\treturn 0;\n\t}\n\n\tmemset(c->summary->sum_buf, 0xff, datasize);\n\tmemset(&isum, 0, sizeof(isum));\n\n\tisum.magic = cpu_to_je16(JFFS2_MAGIC_BITMASK);\n\tisum.nodetype = cpu_to_je16(JFFS2_NODETYPE_SUMMARY);\n\tisum.totlen = cpu_to_je32(infosize);\n\tisum.hdr_crc = cpu_to_je32(crc32(0, &isum, sizeof(struct jffs2_unknown_node) - 4));\n\tisum.padded = cpu_to_je32(c->summary->sum_padded);\n\tisum.cln_mkr = cpu_to_je32(c->cleanmarker_size);\n\tisum.sum_num = cpu_to_je32(c->summary->sum_num);\n\twpage = c->summary->sum_buf;\n\n\twhile (c->summary->sum_num) {\n\t\ttemp = c->summary->sum_list_head;\n\n\t\tswitch (je16_to_cpu(temp->u.nodetype)) {\n\t\t\tcase JFFS2_NODETYPE_INODE: {\n\t\t\t\tstruct jffs2_sum_inode_flash *sino_ptr = wpage;\n\n\t\t\t\tsino_ptr->nodetype = temp->i.nodetype;\n\t\t\t\tsino_ptr->inode = temp->i.inode;\n\t\t\t\tsino_ptr->version = temp->i.version;\n\t\t\t\tsino_ptr->offset = temp->i.offset;\n\t\t\t\tsino_ptr->totlen = temp->i.totlen;\n\n\t\t\t\twpage += JFFS2_SUMMARY_INODE_SIZE;\n\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tcase JFFS2_NODETYPE_DIRENT: {\n\t\t\t\tstruct jffs2_sum_dirent_flash *sdrnt_ptr = wpage;\n\n\t\t\t\tsdrnt_ptr->nodetype = temp->d.nodetype;\n\t\t\t\tsdrnt_ptr->totlen = temp->d.totlen;\n\t\t\t\tsdrnt_ptr->offset = temp->d.offset;\n\t\t\t\tsdrnt_ptr->pino = temp->d.pino;\n\t\t\t\tsdrnt_ptr->version = temp->d.version;\n\t\t\t\tsdrnt_ptr->ino = temp->d.ino;\n\t\t\t\tsdrnt_ptr->nsize = temp->d.nsize;\n\t\t\t\tsdrnt_ptr->type = temp->d.type;\n\n\t\t\t\tmemcpy(sdrnt_ptr->name, temp->d.name,\n\t\t\t\t\t\t\ttemp->d.nsize);\n\n\t\t\t\twpage += JFFS2_SUMMARY_DIRENT_SIZE(temp->d.nsize);\n\n\t\t\t\tbreak;\n\t\t\t}\n#ifdef CONFIG_JFFS2_FS_XATTR\n\t\t\tcase JFFS2_NODETYPE_XATTR: {\n\t\t\t\tstruct jffs2_sum_xattr_flash *sxattr_ptr = wpage;\n\n\t\t\t\ttemp = c->summary->sum_list_head;\n\t\t\t\tsxattr_ptr->nodetype = temp->x.nodetype;\n\t\t\t\tsxattr_ptr->xid = temp->x.xid;\n\t\t\t\tsxattr_ptr->version = temp->x.version;\n\t\t\t\tsxattr_ptr->offset = temp->x.offset;\n\t\t\t\tsxattr_ptr->totlen = temp->x.totlen;\n\n\t\t\t\twpage += JFFS2_SUMMARY_XATTR_SIZE;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase JFFS2_NODETYPE_XREF: {\n\t\t\t\tstruct jffs2_sum_xref_flash *sxref_ptr = wpage;\n\n\t\t\t\ttemp = c->summary->sum_list_head;\n\t\t\t\tsxref_ptr->nodetype = temp->r.nodetype;\n\t\t\t\tsxref_ptr->offset = temp->r.offset;\n\n\t\t\t\twpage += JFFS2_SUMMARY_XREF_SIZE;\n\t\t\t\tbreak;\n\t\t\t}\n#endif\n\t\t\tdefault : {\n\t\t\t\tif ((je16_to_cpu(temp->u.nodetype) & JFFS2_COMPAT_MASK)\n\t\t\t\t    == JFFS2_FEATURE_RWCOMPAT_COPY) {\n\t\t\t\t\tdbg_summary(\"Writing unknown RWCOMPAT_COPY node type %x\\n\",\n\t\t\t\t\t\t    je16_to_cpu(temp->u.nodetype));\n\t\t\t\t\tjffs2_sum_disable_collecting(c->summary);\n\t\t\t\t} else {\n\t\t\t\t\tBUG();\t/* unknown node in summary information */\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tc->summary->sum_list_head = temp->u.next;\n\t\tkfree(temp);\n\n\t\tc->summary->sum_num--;\n\t}\n\n\tjffs2_sum_reset_collected(c->summary);\n\n\twpage += padsize;\n\n\tsm = wpage;\n\tsm->offset = cpu_to_je32(c->sector_size - jeb->free_size);\n\tsm->magic = cpu_to_je32(JFFS2_SUM_MAGIC);\n\n\tisum.sum_crc = cpu_to_je32(crc32(0, c->summary->sum_buf, datasize));\n\tisum.node_crc = cpu_to_je32(crc32(0, &isum, sizeof(isum) - 8));\n\n\tvecs[0].iov_base = &isum;\n\tvecs[0].iov_len = sizeof(isum);\n\tvecs[1].iov_base = c->summary->sum_buf;\n\tvecs[1].iov_len = datasize;\n\n\tsum_ofs = jeb->offset + c->sector_size - jeb->free_size;\n\n\tdbg_summary(\"writing out data to flash to pos : 0x%08x\\n\", sum_ofs);\n\n\tret = jffs2_flash_writev(c, vecs, 2, sum_ofs, &retlen, 0);\n\n\tif (ret || (retlen != infosize)) {\n\n\t\tJFFS2_WARNING(\"Write of %u bytes at 0x%08x failed. returned %d, retlen %zd\\n\",\n\t\t\t      infosize, sum_ofs, ret, retlen);\n\n\t\tif (retlen) {\n\t\t\t/* Waste remaining space */\n\t\t\tspin_lock(&c->erase_completion_lock);\n\t\t\tjffs2_link_node_ref(c, jeb, sum_ofs | REF_OBSOLETE, infosize, NULL);\n\t\t\tspin_unlock(&c->erase_completion_lock);\n\t\t}\n\n\t\tc->summary->sum_size = JFFS2_SUMMARY_NOSUM_SIZE;\n\n\t\treturn 0;\n\t}\n\n\tspin_lock(&c->erase_completion_lock);\n\tjffs2_link_node_ref(c, jeb, sum_ofs | REF_NORMAL, infosize, NULL);\n\tspin_unlock(&c->erase_completion_lock);\n\n\treturn 0;\n}"
  },
  {
    "function_name": "ffs2_sum_scan_sumnode(",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/jffs2/summary.c",
    "lines": "572-670",
    "snippet": "nt jffs2_sum_scan_sumnode(struct jffs2_sb_info *c, struct jffs2_eraseblock *jeb,\n\t\t\t   struct jffs2_raw_summary *summary, uint32_t sumsize,\n\t\t\t   uint32_t *pseudo_random)\n{\n\tstruct jffs2_unknown_node crcnode;\n\tint ret, ofs;\n\tuint32_t crc;\n\n\tofs = c->sector_size - sumsize;\n\n\tdbg_summary(\"summary found for 0x%08x at 0x%08x (0x%x bytes)\\n\",\n\t\t    jeb->offset, jeb->offset + ofs, sumsize);\n\n\t/* OK, now check for node validity and CRC */\n\tcrcnode.magic = cpu_to_je16(JFFS2_MAGIC_BITMASK);\n\tcrcnode.nodetype = cpu_to_je16(JFFS2_NODETYPE_SUMMARY);\n\tcrcnode.totlen = summary->totlen;\n\tcrc = crc32(0, &crcnode, sizeof(crcnode)-4);\n\n\tif (je32_to_cpu(summary->hdr_crc) != crc) {\n\t\tdbg_summary(\"Summary node header is corrupt (bad CRC or \"\n\t\t\t\t\"no summary at all)\\n\");\n\t\tgoto crc_err;\n\t}\n\n\tif (je32_to_cpu(summary->totlen) != sumsize) {\n\t\tdbg_summary(\"Summary node is corrupt (wrong erasesize?)\\n\");\n\t\tgoto crc_err;\n\t}\n\n\tcrc = crc32(0, summary, sizeof(struct jffs2_raw_summary)-8);\n\n\tif (je32_to_cpu(summary->node_crc) != crc) {\n\t\tdbg_summary(\"Summary node is corrupt (bad CRC)\\n\");\n\t\tgoto crc_err;\n\t}\n\n\tcrc = crc32(0, summary->sum, sumsize - sizeof(struct jffs2_raw_summary));\n\n\tif (je32_to_cpu(summary->sum_crc) != crc) {\n\t\tdbg_summary(\"Summary node data is corrupt (bad CRC)\\n\");\n\t\tgoto crc_err;\n\t}\n\n\tif ( je32_to_cpu(summary->cln_mkr) ) {\n\n\t\tdbg_summary(\"Summary : CLEANMARKER node \\n\");\n\n\t\tret = jffs2_prealloc_raw_node_refs(c, jeb, 1);\n\t\tif (ret)\n\t\t\treturn ret;\n\n\t\tif (je32_to_cpu(summary->cln_mkr) != c->cleanmarker_size) {\n\t\t\tdbg_summary(\"CLEANMARKER node has totlen 0x%x != normal 0x%x\\n\",\n\t\t\t\tje32_to_cpu(summary->cln_mkr), c->cleanmarker_size);\n\t\t\tif ((ret = jffs2_scan_dirty_space(c, jeb, PAD(je32_to_cpu(summary->cln_mkr)))))\n\t\t\t\treturn ret;\n\t\t} else if (jeb->first_node) {\n\t\t\tdbg_summary(\"CLEANMARKER node not first node in block \"\n\t\t\t\t\t\"(0x%08x)\\n\", jeb->offset);\n\t\t\tif ((ret = jffs2_scan_dirty_space(c, jeb, PAD(je32_to_cpu(summary->cln_mkr)))))\n\t\t\t\treturn ret;\n\t\t} else {\n\t\t\tjffs2_link_node_ref(c, jeb, jeb->offset | REF_NORMAL,\n\t\t\t\t\t    je32_to_cpu(summary->cln_mkr), NULL);\n\t\t}\n\t}\n\n\tret = jffs2_sum_process_sum_data(c, jeb, summary, pseudo_random);\n\t/* -ENOTRECOVERABLE isn't a fatal error -- it means we should do a full\n\t   scan of this eraseblock. So return zero */\n\tif (ret == -ENOTRECOVERABLE)\n\t\treturn 0;\n\tif (ret)\n\t\treturn ret;\t\t/* real error */\n\n\t/* for PARANOIA_CHECK */\n\tret = jffs2_prealloc_raw_node_refs(c, jeb, 2);\n\tif (ret)\n\t\treturn ret;\n\n\tsum_link_node_ref(c, jeb, ofs | REF_NORMAL, sumsize, NULL);\n\n\tif (unlikely(jeb->free_size)) {\n\t\tJFFS2_WARNING(\"Free size 0x%x bytes in eraseblock @0x%08x with summary?\\n\",\n\t\t\t      jeb->free_size, jeb->offset);\n\t\tjeb->wasted_size += jeb->free_size;\n\t\tc->wasted_size += jeb->free_size;\n\t\tc->free_size -= jeb->free_size;\n\t\tjeb->free_size = 0;\n\t}\n\n\treturn jffs2_scan_classify_jeb(c, jeb);\n\ncrc_err:\n\tJFFS2_WARNING(\"Summary node crc error, skipping summary information.\\n\");\n\n\treturn 0;\n}",
    "includes": [
      "include \"debug.h\"",
      "include \"nodelist.h\"\n#",
      "include <linux/vmalloc.h>\n#",
      "include <linux/compiler.h>\n#",
      "include <linux/crc32.h>\n#",
      "include <linux/pagemap.h>\n#",
      "include <linux/mtd/mtd.h>\n#",
      "include <linux/slab.h>\n#",
      "include <linux/kernel.h>\n#"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "FFS2_WARNING(",
          "args": [
            "Summary node crc error, skipping summary information.\\n\")"
          ],
          "line": 667
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ffs2_scan_classify_jeb(",
          "args": [
            ",",
            "eb)"
          ],
          "line": 664
        },
        "resolved": true,
        "details": {
          "function_name": "ffs2_scan_classify_jeb(",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/jffs2/scan.c",
          "lines": "307-324",
          "snippet": "nt jffs2_scan_classify_jeb(struct jffs2_sb_info *c, struct jffs2_eraseblock *jeb)\n{\n\tif ((jeb->used_size + jeb->unchecked_size) == PAD(c->cleanmarker_size) && !jeb->dirty_size\n\t    && (!jeb->first_node || !ref_next(jeb->first_node)) )\n\t\treturn BLK_STATE_CLEANMARKER;\n\n\t/* move blocks with max 4 byte dirty space to cleanlist */\n\telse if (!ISDIRTY(c->sector_size - (jeb->used_size + jeb->unchecked_size))) {\n\t\tc->dirty_size -= jeb->dirty_size;\n\t\tc->wasted_size += jeb->dirty_size;\n\t\tjeb->wasted_size += jeb->dirty_size;\n\t\tjeb->dirty_size = 0;\n\t\treturn BLK_STATE_CLEAN;\n\t} else if (jeb->used_size || jeb->unchecked_size)\n\t\treturn BLK_STATE_PARTDIRTY;\n\telse\n\t\treturn BLK_STATE_ALLDIRTY;\n}",
          "includes": [
            "include \"debug.h\"",
            "include \"summary.h\"\n#",
            "include \"nodelist.h\"\n#",
            "include <linux/compiler.h>\n#",
            "include <linux/crc32.h>\n#",
            "include <linux/pagemap.h>\n#",
            "include <linux/mtd/mtd.h>\n#",
            "include <linux/slab.h>\n#",
            "include <linux/sched.h>\n#",
            "include <linux/kernel.h>\n#"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "include \"debug.h\"\ninclude \"summary.h\"\n#\ninclude \"nodelist.h\"\n#\ninclude <linux/compiler.h>\n#\ninclude <linux/crc32.h>\n#\ninclude <linux/pagemap.h>\n#\ninclude <linux/mtd/mtd.h>\n#\ninclude <linux/slab.h>\n#\ninclude <linux/sched.h>\n#\ninclude <linux/kernel.h>\n#\n\nnt jffs2_scan_classify_jeb(struct jffs2_sb_info *c, struct jffs2_eraseblock *jeb)\n{\n\tif ((jeb->used_size + jeb->unchecked_size) == PAD(c->cleanmarker_size) && !jeb->dirty_size\n\t    && (!jeb->first_node || !ref_next(jeb->first_node)) )\n\t\treturn BLK_STATE_CLEANMARKER;\n\n\t/* move blocks with max 4 byte dirty space to cleanlist */\n\telse if (!ISDIRTY(c->sector_size - (jeb->used_size + jeb->unchecked_size))) {\n\t\tc->dirty_size -= jeb->dirty_size;\n\t\tc->wasted_size += jeb->dirty_size;\n\t\tjeb->wasted_size += jeb->dirty_size;\n\t\tjeb->dirty_size = 0;\n\t\treturn BLK_STATE_CLEAN;\n\t} else if (jeb->used_size || jeb->unchecked_size)\n\t\treturn BLK_STATE_PARTDIRTY;\n\telse\n\t\treturn BLK_STATE_ALLDIRTY;\n}"
        }
      },
      {
        "call_info": {
          "callee": "FFS2_WARNING(",
          "args": [
            "Free size 0x%x bytes in eraseblock @0x%08x with summary?\\n\",",
            "eb->free_size,",
            "eb->offset)"
          ],
          "line": 656
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "nlikely(",
          "args": [
            "eb->free_size)"
          ],
          "line": 655
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "um_link_node_ref(",
          "args": [
            ",",
            "eb,",
            "fs | REF_NORMAL,",
            "umsize,",
            "ULL)"
          ],
          "line": 653
        },
        "resolved": true,
        "details": {
          "function_name": "um_link_node_ref(",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/jffs2/summary.c",
          "lines": "370-382",
          "snippet": "tatic struct jffs2_raw_node_ref *sum_link_node_ref(struct jffs2_sb_info *c,\n\t\t\t\t\t\t    struct jffs2_eraseblock *jeb,\n\t\t\t\t\t\t    uint32_t ofs, uint32_t len,\n\t\t\t\t\t\t    struct jffs2_inode_cache *ic)\n{\n\t/* If there was a gap, mark it dirty */\n\tif ((ofs & ~3) > c->sector_size - jeb->free_size) {\n\t\t/* Ew. Summary doesn't actually tell us explicitly about dirty space */\n\t\tjffs2_scan_dirty_space(c, jeb, (ofs & ~3) - (c->sector_size - jeb->free_size));\n\t}\n\n\treturn jffs2_link_node_ref(c, jeb, jeb->offset + ofs, len, ic);\n}",
          "includes": [
            "include \"debug.h\"",
            "include \"nodelist.h\"\n#",
            "include <linux/vmalloc.h>\n#",
            "include <linux/compiler.h>\n#",
            "include <linux/crc32.h>\n#",
            "include <linux/pagemap.h>\n#",
            "include <linux/mtd/mtd.h>\n#",
            "include <linux/slab.h>\n#",
            "include <linux/kernel.h>\n#"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "include \"debug.h\"\ninclude \"nodelist.h\"\n#\ninclude <linux/vmalloc.h>\n#\ninclude <linux/compiler.h>\n#\ninclude <linux/crc32.h>\n#\ninclude <linux/pagemap.h>\n#\ninclude <linux/mtd/mtd.h>\n#\ninclude <linux/slab.h>\n#\ninclude <linux/kernel.h>\n#\n\ntatic struct jffs2_raw_node_ref *sum_link_node_ref(struct jffs2_sb_info *c,\n\t\t\t\t\t\t    struct jffs2_eraseblock *jeb,\n\t\t\t\t\t\t    uint32_t ofs, uint32_t len,\n\t\t\t\t\t\t    struct jffs2_inode_cache *ic)\n{\n\t/* If there was a gap, mark it dirty */\n\tif ((ofs & ~3) > c->sector_size - jeb->free_size) {\n\t\t/* Ew. Summary doesn't actually tell us explicitly about dirty space */\n\t\tjffs2_scan_dirty_space(c, jeb, (ofs & ~3) - (c->sector_size - jeb->free_size));\n\t}\n\n\treturn jffs2_link_node_ref(c, jeb, jeb->offset + ofs, len, ic);\n}"
        }
      },
      {
        "call_info": {
          "callee": "ffs2_prealloc_raw_node_refs(",
          "args": [
            ",",
            "eb,",
            ")"
          ],
          "line": 649
        },
        "resolved": true,
        "details": {
          "function_name": "ffs2_prealloc_raw_node_refs(",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/jffs2/malloc.c",
          "lines": "210-249",
          "snippet": "nt jffs2_prealloc_raw_node_refs(struct jffs2_sb_info *c,\n\t\t\t\t struct jffs2_eraseblock *jeb, int nr)\n{\n\tstruct jffs2_raw_node_ref **p, *ref;\n\tint i = nr;\n\n\tdbg_memalloc(\"%d\\n\", nr);\n\n\tp = &jeb->last_node;\n\tref = *p;\n\n\tdbg_memalloc(\"Reserving %d refs for block @0x%08x\\n\", nr, jeb->offset);\n\n\t/* If jeb->last_node is really a valid node then skip over it */\n\tif (ref && ref->flash_offset != REF_EMPTY_NODE)\n\t\tref++;\n\n\twhile (i) {\n\t\tif (!ref) {\n\t\t\tdbg_memalloc(\"Allocating new refblock linked from %p\\n\", p);\n\t\t\tref = *p = jffs2_alloc_refblock();\n\t\t\tif (!ref)\n\t\t\t\treturn -ENOMEM;\n\t\t}\n\t\tif (ref->flash_offset == REF_LINK_NODE) {\n\t\t\tp = &ref->next_in_ino;\n\t\t\tref = *p;\n\t\t\tcontinue;\n\t\t}\n\t\ti--;\n\t\tref++;\n\t}\n\tjeb->allocated_refs = nr;\n\n\tdbg_memalloc(\"Reserved %d refs for block @0x%08x, last_node is %p (%08x,%p)\\n\",\n\t\t  nr, jeb->offset, jeb->last_node, jeb->last_node->flash_offset,\n\t\t  jeb->last_node->next_in_ino);\n\n\treturn 0;\n}",
          "includes": [
            "include \"nodelist.h\"",
            "include <linux/jffs2.h>\n#",
            "include <linux/init.h>\n#",
            "include <linux/slab.h>\n#",
            "include <linux/kernel.h>\n#"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "include \"nodelist.h\"\ninclude <linux/jffs2.h>\n#\ninclude <linux/init.h>\n#\ninclude <linux/slab.h>\n#\ninclude <linux/kernel.h>\n#\n\nnt jffs2_prealloc_raw_node_refs(struct jffs2_sb_info *c,\n\t\t\t\t struct jffs2_eraseblock *jeb, int nr)\n{\n\tstruct jffs2_raw_node_ref **p, *ref;\n\tint i = nr;\n\n\tdbg_memalloc(\"%d\\n\", nr);\n\n\tp = &jeb->last_node;\n\tref = *p;\n\n\tdbg_memalloc(\"Reserving %d refs for block @0x%08x\\n\", nr, jeb->offset);\n\n\t/* If jeb->last_node is really a valid node then skip over it */\n\tif (ref && ref->flash_offset != REF_EMPTY_NODE)\n\t\tref++;\n\n\twhile (i) {\n\t\tif (!ref) {\n\t\t\tdbg_memalloc(\"Allocating new refblock linked from %p\\n\", p);\n\t\t\tref = *p = jffs2_alloc_refblock();\n\t\t\tif (!ref)\n\t\t\t\treturn -ENOMEM;\n\t\t}\n\t\tif (ref->flash_offset == REF_LINK_NODE) {\n\t\t\tp = &ref->next_in_ino;\n\t\t\tref = *p;\n\t\t\tcontinue;\n\t\t}\n\t\ti--;\n\t\tref++;\n\t}\n\tjeb->allocated_refs = nr;\n\n\tdbg_memalloc(\"Reserved %d refs for block @0x%08x, last_node is %p (%08x,%p)\\n\",\n\t\t  nr, jeb->offset, jeb->last_node, jeb->last_node->flash_offset,\n\t\t  jeb->last_node->next_in_ino);\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "ffs2_sum_process_sum_data(",
          "args": [
            ",",
            "eb,",
            "ummary,",
            "seudo_random)"
          ],
          "line": 640
        },
        "resolved": true,
        "details": {
          "function_name": "ffs2_sum_process_sum_data(",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/jffs2/summary.c",
          "lines": "386-569",
          "snippet": "tatic int jffs2_sum_process_sum_data(struct jffs2_sb_info *c, struct jffs2_eraseblock *jeb,\n\t\t\t\tstruct jffs2_raw_summary *summary, uint32_t *pseudo_random)\n{\n\tstruct jffs2_inode_cache *ic;\n\tstruct jffs2_full_dirent *fd;\n\tvoid *sp;\n\tint i, ino;\n\tint err;\n\n\tsp = summary->sum;\n\n\tfor (i=0; i<je32_to_cpu(summary->sum_num); i++) {\n\t\tdbg_summary(\"processing summary index %d\\n\", i);\n\n\t\tcond_resched();\n\n\t\t/* Make sure there's a spare ref for dirty space */\n\t\terr = jffs2_prealloc_raw_node_refs(c, jeb, 2);\n\t\tif (err)\n\t\t\treturn err;\n\n\t\tswitch (je16_to_cpu(((struct jffs2_sum_unknown_flash *)sp)->nodetype)) {\n\t\t\tcase JFFS2_NODETYPE_INODE: {\n\t\t\t\tstruct jffs2_sum_inode_flash *spi;\n\t\t\t\tspi = sp;\n\n\t\t\t\tino = je32_to_cpu(spi->inode);\n\n\t\t\t\tdbg_summary(\"Inode at 0x%08x-0x%08x\\n\",\n\t\t\t\t\t    jeb->offset + je32_to_cpu(spi->offset),\n\t\t\t\t\t    jeb->offset + je32_to_cpu(spi->offset) + je32_to_cpu(spi->totlen));\n\n\t\t\t\tic = jffs2_scan_make_ino_cache(c, ino);\n\t\t\t\tif (!ic) {\n\t\t\t\t\tJFFS2_NOTICE(\"scan_make_ino_cache failed\\n\");\n\t\t\t\t\treturn -ENOMEM;\n\t\t\t\t}\n\n\t\t\t\tsum_link_node_ref(c, jeb, je32_to_cpu(spi->offset) | REF_UNCHECKED,\n\t\t\t\t\t\t  PAD(je32_to_cpu(spi->totlen)), ic);\n\n\t\t\t\t*pseudo_random += je32_to_cpu(spi->version);\n\n\t\t\t\tsp += JFFS2_SUMMARY_INODE_SIZE;\n\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tcase JFFS2_NODETYPE_DIRENT: {\n\t\t\t\tstruct jffs2_sum_dirent_flash *spd;\n\t\t\t\tint checkedlen;\n\t\t\t\tspd = sp;\n\n\t\t\t\tdbg_summary(\"Dirent at 0x%08x-0x%08x\\n\",\n\t\t\t\t\t    jeb->offset + je32_to_cpu(spd->offset),\n\t\t\t\t\t    jeb->offset + je32_to_cpu(spd->offset) + je32_to_cpu(spd->totlen));\n\n\n\t\t\t\t/* This should never happen, but https://dev.laptop.org/ticket/4184 */\n\t\t\t\tcheckedlen = strnlen(spd->name, spd->nsize);\n\t\t\t\tif (!checkedlen) {\n\t\t\t\t\tpr_err(\"Dirent at %08x has zero at start of name. Aborting mount.\\n\",\n\t\t\t\t\t       jeb->offset +\n\t\t\t\t\t       je32_to_cpu(spd->offset));\n\t\t\t\t\treturn -EIO;\n\t\t\t\t}\n\t\t\t\tif (checkedlen < spd->nsize) {\n\t\t\t\t\tpr_err(\"Dirent at %08x has zeroes in name. Truncating to %d chars\\n\",\n\t\t\t\t\t       jeb->offset +\n\t\t\t\t\t       je32_to_cpu(spd->offset),\n\t\t\t\t\t       checkedlen);\n\t\t\t\t}\n\n\n\t\t\t\tfd = jffs2_alloc_full_dirent(checkedlen+1);\n\t\t\t\tif (!fd)\n\t\t\t\t\treturn -ENOMEM;\n\n\t\t\t\tmemcpy(&fd->name, spd->name, checkedlen);\n\t\t\t\tfd->name[checkedlen] = 0;\n\n\t\t\t\tic = jffs2_scan_make_ino_cache(c, je32_to_cpu(spd->pino));\n\t\t\t\tif (!ic) {\n\t\t\t\t\tjffs2_free_full_dirent(fd);\n\t\t\t\t\treturn -ENOMEM;\n\t\t\t\t}\n\n\t\t\t\tfd->raw = sum_link_node_ref(c, jeb,  je32_to_cpu(spd->offset) | REF_UNCHECKED,\n\t\t\t\t\t\t\t    PAD(je32_to_cpu(spd->totlen)), ic);\n\n\t\t\t\tfd->next = NULL;\n\t\t\t\tfd->version = je32_to_cpu(spd->version);\n\t\t\t\tfd->ino = je32_to_cpu(spd->ino);\n\t\t\t\tfd->nhash = full_name_hash(fd->name, checkedlen);\n\t\t\t\tfd->type = spd->type;\n\n\t\t\t\tjffs2_add_fd_to_list(c, fd, &ic->scan_dents);\n\n\t\t\t\t*pseudo_random += je32_to_cpu(spd->version);\n\n\t\t\t\tsp += JFFS2_SUMMARY_DIRENT_SIZE(spd->nsize);\n\n\t\t\t\tbreak;\n\t\t\t}\n#ifdef CONFIG_JFFS2_FS_XATTR\n\t\t\tcase JFFS2_NODETYPE_XATTR: {\n\t\t\t\tstruct jffs2_xattr_datum *xd;\n\t\t\t\tstruct jffs2_sum_xattr_flash *spx;\n\n\t\t\t\tspx = (struct jffs2_sum_xattr_flash *)sp;\n\t\t\t\tdbg_summary(\"xattr at %#08x-%#08x (xid=%u, version=%u)\\n\", \n\t\t\t\t\t    jeb->offset + je32_to_cpu(spx->offset),\n\t\t\t\t\t    jeb->offset + je32_to_cpu(spx->offset) + je32_to_cpu(spx->totlen),\n\t\t\t\t\t    je32_to_cpu(spx->xid), je32_to_cpu(spx->version));\n\n\t\t\t\txd = jffs2_setup_xattr_datum(c, je32_to_cpu(spx->xid),\n\t\t\t\t\t\t\t\tje32_to_cpu(spx->version));\n\t\t\t\tif (IS_ERR(xd))\n\t\t\t\t\treturn PTR_ERR(xd);\n\t\t\t\tif (xd->version > je32_to_cpu(spx->version)) {\n\t\t\t\t\t/* node is not the newest one */\n\t\t\t\t\tstruct jffs2_raw_node_ref *raw\n\t\t\t\t\t\t= sum_link_node_ref(c, jeb, je32_to_cpu(spx->offset) | REF_UNCHECKED,\n\t\t\t\t\t\t\t\t    PAD(je32_to_cpu(spx->totlen)), NULL);\n\t\t\t\t\traw->next_in_ino = xd->node->next_in_ino;\n\t\t\t\t\txd->node->next_in_ino = raw;\n\t\t\t\t} else {\n\t\t\t\t\txd->version = je32_to_cpu(spx->version);\n\t\t\t\t\tsum_link_node_ref(c, jeb, je32_to_cpu(spx->offset) | REF_UNCHECKED,\n\t\t\t\t\t\t\t  PAD(je32_to_cpu(spx->totlen)), (void *)xd);\n\t\t\t\t}\n\t\t\t\t*pseudo_random += je32_to_cpu(spx->xid);\n\t\t\t\tsp += JFFS2_SUMMARY_XATTR_SIZE;\n\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase JFFS2_NODETYPE_XREF: {\n\t\t\t\tstruct jffs2_xattr_ref *ref;\n\t\t\t\tstruct jffs2_sum_xref_flash *spr;\n\n\t\t\t\tspr = (struct jffs2_sum_xref_flash *)sp;\n\t\t\t\tdbg_summary(\"xref at %#08x-%#08x\\n\",\n\t\t\t\t\t    jeb->offset + je32_to_cpu(spr->offset),\n\t\t\t\t\t    jeb->offset + je32_to_cpu(spr->offset) + \n\t\t\t\t\t    (uint32_t)PAD(sizeof(struct jffs2_raw_xref)));\n\n\t\t\t\tref = jffs2_alloc_xattr_ref();\n\t\t\t\tif (!ref) {\n\t\t\t\t\tJFFS2_NOTICE(\"allocation of xattr_datum failed\\n\");\n\t\t\t\t\treturn -ENOMEM;\n\t\t\t\t}\n\t\t\t\tref->next = c->xref_temp;\n\t\t\t\tc->xref_temp = ref;\n\n\t\t\t\tsum_link_node_ref(c, jeb, je32_to_cpu(spr->offset) | REF_UNCHECKED,\n\t\t\t\t\t\t  PAD(sizeof(struct jffs2_raw_xref)), (void *)ref);\n\n\t\t\t\t*pseudo_random += ref->node->flash_offset;\n\t\t\t\tsp += JFFS2_SUMMARY_XREF_SIZE;\n\n\t\t\t\tbreak;\n\t\t\t}\n#endif\n\t\t\tdefault : {\n\t\t\t\tuint16_t nodetype = je16_to_cpu(((struct jffs2_sum_unknown_flash *)sp)->nodetype);\n\t\t\t\tJFFS2_WARNING(\"Unsupported node type %x found in summary! Exiting...\\n\", nodetype);\n\t\t\t\tif ((nodetype & JFFS2_COMPAT_MASK) == JFFS2_FEATURE_INCOMPAT)\n\t\t\t\t\treturn -EIO;\n\n\t\t\t\t/* For compatible node types, just fall back to the full scan */\n\t\t\t\tc->wasted_size -= jeb->wasted_size;\n\t\t\t\tc->free_size += c->sector_size - jeb->free_size;\n\t\t\t\tc->used_size -= jeb->used_size;\n\t\t\t\tc->dirty_size -= jeb->dirty_size;\n\t\t\t\tjeb->wasted_size = jeb->used_size = jeb->dirty_size = 0;\n\t\t\t\tjeb->free_size = c->sector_size;\n\n\t\t\t\tjffs2_free_jeb_node_refs(c, jeb);\n\t\t\t\treturn -ENOTRECOVERABLE;\n\t\t\t}\n\t\t}\n\t}\n\treturn 0;\n}",
          "includes": [
            "include \"debug.h\"",
            "include \"nodelist.h\"\n#",
            "include <linux/vmalloc.h>\n#",
            "include <linux/compiler.h>\n#",
            "include <linux/crc32.h>\n#",
            "include <linux/pagemap.h>\n#",
            "include <linux/mtd/mtd.h>\n#",
            "include <linux/slab.h>\n#",
            "include <linux/kernel.h>\n#"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "include \"debug.h\"\ninclude \"nodelist.h\"\n#\ninclude <linux/vmalloc.h>\n#\ninclude <linux/compiler.h>\n#\ninclude <linux/crc32.h>\n#\ninclude <linux/pagemap.h>\n#\ninclude <linux/mtd/mtd.h>\n#\ninclude <linux/slab.h>\n#\ninclude <linux/kernel.h>\n#\n\ntatic int jffs2_sum_process_sum_data(struct jffs2_sb_info *c, struct jffs2_eraseblock *jeb,\n\t\t\t\tstruct jffs2_raw_summary *summary, uint32_t *pseudo_random)\n{\n\tstruct jffs2_inode_cache *ic;\n\tstruct jffs2_full_dirent *fd;\n\tvoid *sp;\n\tint i, ino;\n\tint err;\n\n\tsp = summary->sum;\n\n\tfor (i=0; i<je32_to_cpu(summary->sum_num); i++) {\n\t\tdbg_summary(\"processing summary index %d\\n\", i);\n\n\t\tcond_resched();\n\n\t\t/* Make sure there's a spare ref for dirty space */\n\t\terr = jffs2_prealloc_raw_node_refs(c, jeb, 2);\n\t\tif (err)\n\t\t\treturn err;\n\n\t\tswitch (je16_to_cpu(((struct jffs2_sum_unknown_flash *)sp)->nodetype)) {\n\t\t\tcase JFFS2_NODETYPE_INODE: {\n\t\t\t\tstruct jffs2_sum_inode_flash *spi;\n\t\t\t\tspi = sp;\n\n\t\t\t\tino = je32_to_cpu(spi->inode);\n\n\t\t\t\tdbg_summary(\"Inode at 0x%08x-0x%08x\\n\",\n\t\t\t\t\t    jeb->offset + je32_to_cpu(spi->offset),\n\t\t\t\t\t    jeb->offset + je32_to_cpu(spi->offset) + je32_to_cpu(spi->totlen));\n\n\t\t\t\tic = jffs2_scan_make_ino_cache(c, ino);\n\t\t\t\tif (!ic) {\n\t\t\t\t\tJFFS2_NOTICE(\"scan_make_ino_cache failed\\n\");\n\t\t\t\t\treturn -ENOMEM;\n\t\t\t\t}\n\n\t\t\t\tsum_link_node_ref(c, jeb, je32_to_cpu(spi->offset) | REF_UNCHECKED,\n\t\t\t\t\t\t  PAD(je32_to_cpu(spi->totlen)), ic);\n\n\t\t\t\t*pseudo_random += je32_to_cpu(spi->version);\n\n\t\t\t\tsp += JFFS2_SUMMARY_INODE_SIZE;\n\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tcase JFFS2_NODETYPE_DIRENT: {\n\t\t\t\tstruct jffs2_sum_dirent_flash *spd;\n\t\t\t\tint checkedlen;\n\t\t\t\tspd = sp;\n\n\t\t\t\tdbg_summary(\"Dirent at 0x%08x-0x%08x\\n\",\n\t\t\t\t\t    jeb->offset + je32_to_cpu(spd->offset),\n\t\t\t\t\t    jeb->offset + je32_to_cpu(spd->offset) + je32_to_cpu(spd->totlen));\n\n\n\t\t\t\t/* This should never happen, but https://dev.laptop.org/ticket/4184 */\n\t\t\t\tcheckedlen = strnlen(spd->name, spd->nsize);\n\t\t\t\tif (!checkedlen) {\n\t\t\t\t\tpr_err(\"Dirent at %08x has zero at start of name. Aborting mount.\\n\",\n\t\t\t\t\t       jeb->offset +\n\t\t\t\t\t       je32_to_cpu(spd->offset));\n\t\t\t\t\treturn -EIO;\n\t\t\t\t}\n\t\t\t\tif (checkedlen < spd->nsize) {\n\t\t\t\t\tpr_err(\"Dirent at %08x has zeroes in name. Truncating to %d chars\\n\",\n\t\t\t\t\t       jeb->offset +\n\t\t\t\t\t       je32_to_cpu(spd->offset),\n\t\t\t\t\t       checkedlen);\n\t\t\t\t}\n\n\n\t\t\t\tfd = jffs2_alloc_full_dirent(checkedlen+1);\n\t\t\t\tif (!fd)\n\t\t\t\t\treturn -ENOMEM;\n\n\t\t\t\tmemcpy(&fd->name, spd->name, checkedlen);\n\t\t\t\tfd->name[checkedlen] = 0;\n\n\t\t\t\tic = jffs2_scan_make_ino_cache(c, je32_to_cpu(spd->pino));\n\t\t\t\tif (!ic) {\n\t\t\t\t\tjffs2_free_full_dirent(fd);\n\t\t\t\t\treturn -ENOMEM;\n\t\t\t\t}\n\n\t\t\t\tfd->raw = sum_link_node_ref(c, jeb,  je32_to_cpu(spd->offset) | REF_UNCHECKED,\n\t\t\t\t\t\t\t    PAD(je32_to_cpu(spd->totlen)), ic);\n\n\t\t\t\tfd->next = NULL;\n\t\t\t\tfd->version = je32_to_cpu(spd->version);\n\t\t\t\tfd->ino = je32_to_cpu(spd->ino);\n\t\t\t\tfd->nhash = full_name_hash(fd->name, checkedlen);\n\t\t\t\tfd->type = spd->type;\n\n\t\t\t\tjffs2_add_fd_to_list(c, fd, &ic->scan_dents);\n\n\t\t\t\t*pseudo_random += je32_to_cpu(spd->version);\n\n\t\t\t\tsp += JFFS2_SUMMARY_DIRENT_SIZE(spd->nsize);\n\n\t\t\t\tbreak;\n\t\t\t}\n#ifdef CONFIG_JFFS2_FS_XATTR\n\t\t\tcase JFFS2_NODETYPE_XATTR: {\n\t\t\t\tstruct jffs2_xattr_datum *xd;\n\t\t\t\tstruct jffs2_sum_xattr_flash *spx;\n\n\t\t\t\tspx = (struct jffs2_sum_xattr_flash *)sp;\n\t\t\t\tdbg_summary(\"xattr at %#08x-%#08x (xid=%u, version=%u)\\n\", \n\t\t\t\t\t    jeb->offset + je32_to_cpu(spx->offset),\n\t\t\t\t\t    jeb->offset + je32_to_cpu(spx->offset) + je32_to_cpu(spx->totlen),\n\t\t\t\t\t    je32_to_cpu(spx->xid), je32_to_cpu(spx->version));\n\n\t\t\t\txd = jffs2_setup_xattr_datum(c, je32_to_cpu(spx->xid),\n\t\t\t\t\t\t\t\tje32_to_cpu(spx->version));\n\t\t\t\tif (IS_ERR(xd))\n\t\t\t\t\treturn PTR_ERR(xd);\n\t\t\t\tif (xd->version > je32_to_cpu(spx->version)) {\n\t\t\t\t\t/* node is not the newest one */\n\t\t\t\t\tstruct jffs2_raw_node_ref *raw\n\t\t\t\t\t\t= sum_link_node_ref(c, jeb, je32_to_cpu(spx->offset) | REF_UNCHECKED,\n\t\t\t\t\t\t\t\t    PAD(je32_to_cpu(spx->totlen)), NULL);\n\t\t\t\t\traw->next_in_ino = xd->node->next_in_ino;\n\t\t\t\t\txd->node->next_in_ino = raw;\n\t\t\t\t} else {\n\t\t\t\t\txd->version = je32_to_cpu(spx->version);\n\t\t\t\t\tsum_link_node_ref(c, jeb, je32_to_cpu(spx->offset) | REF_UNCHECKED,\n\t\t\t\t\t\t\t  PAD(je32_to_cpu(spx->totlen)), (void *)xd);\n\t\t\t\t}\n\t\t\t\t*pseudo_random += je32_to_cpu(spx->xid);\n\t\t\t\tsp += JFFS2_SUMMARY_XATTR_SIZE;\n\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase JFFS2_NODETYPE_XREF: {\n\t\t\t\tstruct jffs2_xattr_ref *ref;\n\t\t\t\tstruct jffs2_sum_xref_flash *spr;\n\n\t\t\t\tspr = (struct jffs2_sum_xref_flash *)sp;\n\t\t\t\tdbg_summary(\"xref at %#08x-%#08x\\n\",\n\t\t\t\t\t    jeb->offset + je32_to_cpu(spr->offset),\n\t\t\t\t\t    jeb->offset + je32_to_cpu(spr->offset) + \n\t\t\t\t\t    (uint32_t)PAD(sizeof(struct jffs2_raw_xref)));\n\n\t\t\t\tref = jffs2_alloc_xattr_ref();\n\t\t\t\tif (!ref) {\n\t\t\t\t\tJFFS2_NOTICE(\"allocation of xattr_datum failed\\n\");\n\t\t\t\t\treturn -ENOMEM;\n\t\t\t\t}\n\t\t\t\tref->next = c->xref_temp;\n\t\t\t\tc->xref_temp = ref;\n\n\t\t\t\tsum_link_node_ref(c, jeb, je32_to_cpu(spr->offset) | REF_UNCHECKED,\n\t\t\t\t\t\t  PAD(sizeof(struct jffs2_raw_xref)), (void *)ref);\n\n\t\t\t\t*pseudo_random += ref->node->flash_offset;\n\t\t\t\tsp += JFFS2_SUMMARY_XREF_SIZE;\n\n\t\t\t\tbreak;\n\t\t\t}\n#endif\n\t\t\tdefault : {\n\t\t\t\tuint16_t nodetype = je16_to_cpu(((struct jffs2_sum_unknown_flash *)sp)->nodetype);\n\t\t\t\tJFFS2_WARNING(\"Unsupported node type %x found in summary! Exiting...\\n\", nodetype);\n\t\t\t\tif ((nodetype & JFFS2_COMPAT_MASK) == JFFS2_FEATURE_INCOMPAT)\n\t\t\t\t\treturn -EIO;\n\n\t\t\t\t/* For compatible node types, just fall back to the full scan */\n\t\t\t\tc->wasted_size -= jeb->wasted_size;\n\t\t\t\tc->free_size += c->sector_size - jeb->free_size;\n\t\t\t\tc->used_size -= jeb->used_size;\n\t\t\t\tc->dirty_size -= jeb->dirty_size;\n\t\t\t\tjeb->wasted_size = jeb->used_size = jeb->dirty_size = 0;\n\t\t\t\tjeb->free_size = c->sector_size;\n\n\t\t\t\tjffs2_free_jeb_node_refs(c, jeb);\n\t\t\t\treturn -ENOTRECOVERABLE;\n\t\t\t}\n\t\t}\n\t}\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "ffs2_link_node_ref(",
          "args": [
            ",",
            "eb,",
            "eb->offset | REF_NORMAL,",
            "e32_to_cpu(summary->cln_mkr),",
            "ULL)"
          ],
          "line": 635
        },
        "resolved": true,
        "details": {
          "function_name": "ffs2_link_node_ref(",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/jffs2/nodelist.c",
          "lines": "585-659",
          "snippet": "truct jffs2_raw_node_ref *jffs2_link_node_ref(struct jffs2_sb_info *c,\n\t\t\t\t\t       struct jffs2_eraseblock *jeb,\n\t\t\t\t\t       uint32_t ofs, uint32_t len,\n\t\t\t\t\t       struct jffs2_inode_cache *ic)\n{\n\tstruct jffs2_raw_node_ref *ref;\n\n\tBUG_ON(!jeb->allocated_refs);\n\tjeb->allocated_refs--;\n\n\tref = jeb->last_node;\n\n\tdbg_noderef(\"Last node at %p is (%08x,%p)\\n\", ref, ref->flash_offset,\n\t\t    ref->next_in_ino);\n\n\twhile (ref->flash_offset != REF_EMPTY_NODE) {\n\t\tif (ref->flash_offset == REF_LINK_NODE)\n\t\t\tref = ref->next_in_ino;\n\t\telse\n\t\t\tref++;\n\t}\n\n\tdbg_noderef(\"New ref is %p (%08x becomes %08x,%p) len 0x%x\\n\", ref, \n\t\t    ref->flash_offset, ofs, ref->next_in_ino, len);\n\n\tref->flash_offset = ofs;\n\n\tif (!jeb->first_node) {\n\t\tjeb->first_node = ref;\n\t\tBUG_ON(ref_offset(ref) != jeb->offset);\n\t} else if (unlikely(ref_offset(ref) != jeb->offset + c->sector_size - jeb->free_size)) {\n\t\tuint32_t last_len = ref_totlen(c, jeb, jeb->last_node);\n\n\t\tJFFS2_ERROR(\"Adding new ref %p at (0x%08x-0x%08x) not immediately after previous (0x%08x-0x%08x)\\n\",\n\t\t\t    ref, ref_offset(ref), ref_offset(ref)+len,\n\t\t\t    ref_offset(jeb->last_node), \n\t\t\t    ref_offset(jeb->last_node)+last_len);\n\t\tBUG();\n\t}\n\tjeb->last_node = ref;\n\n\tif (ic) {\n\t\tref->next_in_ino = ic->nodes;\n\t\tic->nodes = ref;\n\t} else {\n\t\tref->next_in_ino = NULL;\n\t}\n\n\tswitch(ref_flags(ref)) {\n\tcase REF_UNCHECKED:\n\t\tc->unchecked_size += len;\n\t\tjeb->unchecked_size += len;\n\t\tbreak;\n\n\tcase REF_NORMAL:\n\tcase REF_PRISTINE:\n\t\tc->used_size += len;\n\t\tjeb->used_size += len;\n\t\tbreak;\n\n\tcase REF_OBSOLETE:\n\t\tc->dirty_size += len;\n\t\tjeb->dirty_size += len;\n\t\tbreak;\n\t}\n\tc->free_size -= len;\n\tjeb->free_size -= len;\n\n#ifdef TEST_TOTLEN\n\t/* Set (and test) __totlen field... for now */\n\tref->__totlen = len;\n\tref_totlen(c, jeb, ref);\n#endif\n\treturn ref;\n}",
          "includes": [
            "include \"nodelist.h\"",
            "include <linux/pagemap.h>\n#",
            "include <linux/crc32.h>\n#",
            "include <linux/rbtree.h>\n#",
            "include <linux/mtd/mtd.h>\n#",
            "include <linux/fs.h>\n#",
            "include <linux/sched.h>\n#",
            "include <linux/kernel.h>\n#"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "include \"nodelist.h\"\ninclude <linux/pagemap.h>\n#\ninclude <linux/crc32.h>\n#\ninclude <linux/rbtree.h>\n#\ninclude <linux/mtd/mtd.h>\n#\ninclude <linux/fs.h>\n#\ninclude <linux/sched.h>\n#\ninclude <linux/kernel.h>\n#\n\ntruct jffs2_raw_node_ref *jffs2_link_node_ref(struct jffs2_sb_info *c,\n\t\t\t\t\t       struct jffs2_eraseblock *jeb,\n\t\t\t\t\t       uint32_t ofs, uint32_t len,\n\t\t\t\t\t       struct jffs2_inode_cache *ic)\n{\n\tstruct jffs2_raw_node_ref *ref;\n\n\tBUG_ON(!jeb->allocated_refs);\n\tjeb->allocated_refs--;\n\n\tref = jeb->last_node;\n\n\tdbg_noderef(\"Last node at %p is (%08x,%p)\\n\", ref, ref->flash_offset,\n\t\t    ref->next_in_ino);\n\n\twhile (ref->flash_offset != REF_EMPTY_NODE) {\n\t\tif (ref->flash_offset == REF_LINK_NODE)\n\t\t\tref = ref->next_in_ino;\n\t\telse\n\t\t\tref++;\n\t}\n\n\tdbg_noderef(\"New ref is %p (%08x becomes %08x,%p) len 0x%x\\n\", ref, \n\t\t    ref->flash_offset, ofs, ref->next_in_ino, len);\n\n\tref->flash_offset = ofs;\n\n\tif (!jeb->first_node) {\n\t\tjeb->first_node = ref;\n\t\tBUG_ON(ref_offset(ref) != jeb->offset);\n\t} else if (unlikely(ref_offset(ref) != jeb->offset + c->sector_size - jeb->free_size)) {\n\t\tuint32_t last_len = ref_totlen(c, jeb, jeb->last_node);\n\n\t\tJFFS2_ERROR(\"Adding new ref %p at (0x%08x-0x%08x) not immediately after previous (0x%08x-0x%08x)\\n\",\n\t\t\t    ref, ref_offset(ref), ref_offset(ref)+len,\n\t\t\t    ref_offset(jeb->last_node), \n\t\t\t    ref_offset(jeb->last_node)+last_len);\n\t\tBUG();\n\t}\n\tjeb->last_node = ref;\n\n\tif (ic) {\n\t\tref->next_in_ino = ic->nodes;\n\t\tic->nodes = ref;\n\t} else {\n\t\tref->next_in_ino = NULL;\n\t}\n\n\tswitch(ref_flags(ref)) {\n\tcase REF_UNCHECKED:\n\t\tc->unchecked_size += len;\n\t\tjeb->unchecked_size += len;\n\t\tbreak;\n\n\tcase REF_NORMAL:\n\tcase REF_PRISTINE:\n\t\tc->used_size += len;\n\t\tjeb->used_size += len;\n\t\tbreak;\n\n\tcase REF_OBSOLETE:\n\t\tc->dirty_size += len;\n\t\tjeb->dirty_size += len;\n\t\tbreak;\n\t}\n\tc->free_size -= len;\n\tjeb->free_size -= len;\n\n#ifdef TEST_TOTLEN\n\t/* Set (and test) __totlen field... for now */\n\tref->__totlen = len;\n\tref_totlen(c, jeb, ref);\n#endif\n\treturn ref;\n}"
        }
      },
      {
        "call_info": {
          "callee": "e32_to_cpu(",
          "args": [
            "ummary->cln_mkr)"
          ],
          "line": 636
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ffs2_scan_dirty_space(",
          "args": [
            ",",
            "eb,",
            "AD(je32_to_cpu(summary->cln_mkr)))"
          ],
          "line": 632
        },
        "resolved": true,
        "details": {
          "function_name": "ffs2_scan_dirty_space(",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/jffs2/nodelist.c",
          "lines": "662-689",
          "snippet": "nt jffs2_scan_dirty_space(struct jffs2_sb_info *c, struct jffs2_eraseblock *jeb,\n\t\t\t   uint32_t size)\n{\n\tif (!size)\n\t\treturn 0;\n\tif (unlikely(size > jeb->free_size)) {\n\t\tpr_crit(\"Dirty space 0x%x larger then free_size 0x%x (wasted 0x%x)\\n\",\n\t\t\tsize, jeb->free_size, jeb->wasted_size);\n\t\tBUG();\n\t}\n\t/* REF_EMPTY_NODE is !obsolete, so that works OK */\n\tif (jeb->last_node && ref_obsolete(jeb->last_node)) {\n#ifdef TEST_TOTLEN\n\t\tjeb->last_node->__totlen += size;\n#endif\n\t\tc->dirty_size += size;\n\t\tc->free_size -= size;\n\t\tjeb->dirty_size += size;\n\t\tjeb->free_size -= size;\n\t} else {\n\t\tuint32_t ofs = jeb->offset + c->sector_size - jeb->free_size;\n\t\tofs |= REF_OBSOLETE;\n\n\t\tjffs2_link_node_ref(c, jeb, ofs, size, NULL);\n\t}\n\n\treturn 0;\n}",
          "includes": [
            "include \"nodelist.h\"",
            "include <linux/pagemap.h>\n#",
            "include <linux/crc32.h>\n#",
            "include <linux/rbtree.h>\n#",
            "include <linux/mtd/mtd.h>\n#",
            "include <linux/fs.h>\n#",
            "include <linux/sched.h>\n#",
            "include <linux/kernel.h>\n#"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "include \"nodelist.h\"\ninclude <linux/pagemap.h>\n#\ninclude <linux/crc32.h>\n#\ninclude <linux/rbtree.h>\n#\ninclude <linux/mtd/mtd.h>\n#\ninclude <linux/fs.h>\n#\ninclude <linux/sched.h>\n#\ninclude <linux/kernel.h>\n#\n\nnt jffs2_scan_dirty_space(struct jffs2_sb_info *c, struct jffs2_eraseblock *jeb,\n\t\t\t   uint32_t size)\n{\n\tif (!size)\n\t\treturn 0;\n\tif (unlikely(size > jeb->free_size)) {\n\t\tpr_crit(\"Dirty space 0x%x larger then free_size 0x%x (wasted 0x%x)\\n\",\n\t\t\tsize, jeb->free_size, jeb->wasted_size);\n\t\tBUG();\n\t}\n\t/* REF_EMPTY_NODE is !obsolete, so that works OK */\n\tif (jeb->last_node && ref_obsolete(jeb->last_node)) {\n#ifdef TEST_TOTLEN\n\t\tjeb->last_node->__totlen += size;\n#endif\n\t\tc->dirty_size += size;\n\t\tc->free_size -= size;\n\t\tjeb->dirty_size += size;\n\t\tjeb->free_size -= size;\n\t} else {\n\t\tuint32_t ofs = jeb->offset + c->sector_size - jeb->free_size;\n\t\tofs |= REF_OBSOLETE;\n\n\t\tjffs2_link_node_ref(c, jeb, ofs, size, NULL);\n\t}\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "AD(",
          "args": [
            "e32_to_cpu(summary->cln_mkr))"
          ],
          "line": 632
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "e32_to_cpu(",
          "args": [
            "ummary->cln_mkr)"
          ],
          "line": 632
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bg_summary(",
          "args": [
            "CLEANMARKER node not first node in block \"\n\t\t\t\t\t\"(0x%08x)\\n\",",
            "eb->offset)"
          ],
          "line": 630
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "AD(",
          "args": [
            "e32_to_cpu(summary->cln_mkr))"
          ],
          "line": 627
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "e32_to_cpu(",
          "args": [
            "ummary->cln_mkr)"
          ],
          "line": 627
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bg_summary(",
          "args": [
            "CLEANMARKER node has totlen 0x%x != normal 0x%x\\n\",",
            "e32_to_cpu(summary->cln_mkr),",
            "->cleanmarker_size)"
          ],
          "line": 625
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "e32_to_cpu(",
          "args": [
            "ummary->cln_mkr)"
          ],
          "line": 626
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "e32_to_cpu(",
          "args": [
            "ummary->cln_mkr)"
          ],
          "line": 624
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bg_summary(",
          "args": [
            "Summary : CLEANMARKER node \\n\")"
          ],
          "line": 618
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "e32_to_cpu(",
          "args": [
            "ummary->cln_mkr)"
          ],
          "line": 616
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bg_summary(",
          "args": [
            "Summary node data is corrupt (bad CRC)\\n\")"
          ],
          "line": 612
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "e32_to_cpu(",
          "args": [
            "ummary->sum_crc)"
          ],
          "line": 611
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rc32(",
          "args": [
            ",",
            "ummary->sum,",
            "umsize - sizeof(struct jffs2_raw_summary))"
          ],
          "line": 609
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bg_summary(",
          "args": [
            "Summary node is corrupt (bad CRC)\\n\")"
          ],
          "line": 605
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "e32_to_cpu(",
          "args": [
            "ummary->node_crc)"
          ],
          "line": 604
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rc32(",
          "args": [
            ",",
            "ummary,",
            "izeof(struct jffs2_raw_summary)-8)"
          ],
          "line": 602
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bg_summary(",
          "args": [
            "Summary node is corrupt (wrong erasesize?)\\n\")"
          ],
          "line": 598
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "e32_to_cpu(",
          "args": [
            "ummary->totlen)"
          ],
          "line": 597
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bg_summary(",
          "args": [
            "Summary node header is corrupt (bad CRC or \"\n\t\t\t\t\"no summary at all)\\n\")"
          ],
          "line": 592
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "e32_to_cpu(",
          "args": [
            "ummary->hdr_crc)"
          ],
          "line": 591
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rc32(",
          "args": [
            ",",
            "crcnode,",
            "izeof(crcnode)-4)"
          ],
          "line": 589
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pu_to_je16(",
          "args": [
            "FFS2_NODETYPE_SUMMARY)"
          ],
          "line": 587
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pu_to_je16(",
          "args": [
            "FFS2_MAGIC_BITMASK)"
          ],
          "line": 586
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bg_summary(",
          "args": [
            "summary found for 0x%08x at 0x%08x (0x%x bytes)\\n\",",
            "eb->offset,",
            "eb->offset + ofs,",
            "umsize)"
          ],
          "line": 582
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "include \"debug.h\"\ninclude \"nodelist.h\"\n#\ninclude <linux/vmalloc.h>\n#\ninclude <linux/compiler.h>\n#\ninclude <linux/crc32.h>\n#\ninclude <linux/pagemap.h>\n#\ninclude <linux/mtd/mtd.h>\n#\ninclude <linux/slab.h>\n#\ninclude <linux/kernel.h>\n#\n\nnt jffs2_sum_scan_sumnode(struct jffs2_sb_info *c, struct jffs2_eraseblock *jeb,\n\t\t\t   struct jffs2_raw_summary *summary, uint32_t sumsize,\n\t\t\t   uint32_t *pseudo_random)\n{\n\tstruct jffs2_unknown_node crcnode;\n\tint ret, ofs;\n\tuint32_t crc;\n\n\tofs = c->sector_size - sumsize;\n\n\tdbg_summary(\"summary found for 0x%08x at 0x%08x (0x%x bytes)\\n\",\n\t\t    jeb->offset, jeb->offset + ofs, sumsize);\n\n\t/* OK, now check for node validity and CRC */\n\tcrcnode.magic = cpu_to_je16(JFFS2_MAGIC_BITMASK);\n\tcrcnode.nodetype = cpu_to_je16(JFFS2_NODETYPE_SUMMARY);\n\tcrcnode.totlen = summary->totlen;\n\tcrc = crc32(0, &crcnode, sizeof(crcnode)-4);\n\n\tif (je32_to_cpu(summary->hdr_crc) != crc) {\n\t\tdbg_summary(\"Summary node header is corrupt (bad CRC or \"\n\t\t\t\t\"no summary at all)\\n\");\n\t\tgoto crc_err;\n\t}\n\n\tif (je32_to_cpu(summary->totlen) != sumsize) {\n\t\tdbg_summary(\"Summary node is corrupt (wrong erasesize?)\\n\");\n\t\tgoto crc_err;\n\t}\n\n\tcrc = crc32(0, summary, sizeof(struct jffs2_raw_summary)-8);\n\n\tif (je32_to_cpu(summary->node_crc) != crc) {\n\t\tdbg_summary(\"Summary node is corrupt (bad CRC)\\n\");\n\t\tgoto crc_err;\n\t}\n\n\tcrc = crc32(0, summary->sum, sumsize - sizeof(struct jffs2_raw_summary));\n\n\tif (je32_to_cpu(summary->sum_crc) != crc) {\n\t\tdbg_summary(\"Summary node data is corrupt (bad CRC)\\n\");\n\t\tgoto crc_err;\n\t}\n\n\tif ( je32_to_cpu(summary->cln_mkr) ) {\n\n\t\tdbg_summary(\"Summary : CLEANMARKER node \\n\");\n\n\t\tret = jffs2_prealloc_raw_node_refs(c, jeb, 1);\n\t\tif (ret)\n\t\t\treturn ret;\n\n\t\tif (je32_to_cpu(summary->cln_mkr) != c->cleanmarker_size) {\n\t\t\tdbg_summary(\"CLEANMARKER node has totlen 0x%x != normal 0x%x\\n\",\n\t\t\t\tje32_to_cpu(summary->cln_mkr), c->cleanmarker_size);\n\t\t\tif ((ret = jffs2_scan_dirty_space(c, jeb, PAD(je32_to_cpu(summary->cln_mkr)))))\n\t\t\t\treturn ret;\n\t\t} else if (jeb->first_node) {\n\t\t\tdbg_summary(\"CLEANMARKER node not first node in block \"\n\t\t\t\t\t\"(0x%08x)\\n\", jeb->offset);\n\t\t\tif ((ret = jffs2_scan_dirty_space(c, jeb, PAD(je32_to_cpu(summary->cln_mkr)))))\n\t\t\t\treturn ret;\n\t\t} else {\n\t\t\tjffs2_link_node_ref(c, jeb, jeb->offset | REF_NORMAL,\n\t\t\t\t\t    je32_to_cpu(summary->cln_mkr), NULL);\n\t\t}\n\t}\n\n\tret = jffs2_sum_process_sum_data(c, jeb, summary, pseudo_random);\n\t/* -ENOTRECOVERABLE isn't a fatal error -- it means we should do a full\n\t   scan of this eraseblock. So return zero */\n\tif (ret == -ENOTRECOVERABLE)\n\t\treturn 0;\n\tif (ret)\n\t\treturn ret;\t\t/* real error */\n\n\t/* for PARANOIA_CHECK */\n\tret = jffs2_prealloc_raw_node_refs(c, jeb, 2);\n\tif (ret)\n\t\treturn ret;\n\n\tsum_link_node_ref(c, jeb, ofs | REF_NORMAL, sumsize, NULL);\n\n\tif (unlikely(jeb->free_size)) {\n\t\tJFFS2_WARNING(\"Free size 0x%x bytes in eraseblock @0x%08x with summary?\\n\",\n\t\t\t      jeb->free_size, jeb->offset);\n\t\tjeb->wasted_size += jeb->free_size;\n\t\tc->wasted_size += jeb->free_size;\n\t\tc->free_size -= jeb->free_size;\n\t\tjeb->free_size = 0;\n\t}\n\n\treturn jffs2_scan_classify_jeb(c, jeb);\n\ncrc_err:\n\tJFFS2_WARNING(\"Summary node crc error, skipping summary information.\\n\");\n\n\treturn 0;\n}"
  },
  {
    "function_name": "ffs2_sum_process_sum_data(",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/jffs2/summary.c",
    "lines": "386-569",
    "snippet": "tatic int jffs2_sum_process_sum_data(struct jffs2_sb_info *c, struct jffs2_eraseblock *jeb,\n\t\t\t\tstruct jffs2_raw_summary *summary, uint32_t *pseudo_random)\n{\n\tstruct jffs2_inode_cache *ic;\n\tstruct jffs2_full_dirent *fd;\n\tvoid *sp;\n\tint i, ino;\n\tint err;\n\n\tsp = summary->sum;\n\n\tfor (i=0; i<je32_to_cpu(summary->sum_num); i++) {\n\t\tdbg_summary(\"processing summary index %d\\n\", i);\n\n\t\tcond_resched();\n\n\t\t/* Make sure there's a spare ref for dirty space */\n\t\terr = jffs2_prealloc_raw_node_refs(c, jeb, 2);\n\t\tif (err)\n\t\t\treturn err;\n\n\t\tswitch (je16_to_cpu(((struct jffs2_sum_unknown_flash *)sp)->nodetype)) {\n\t\t\tcase JFFS2_NODETYPE_INODE: {\n\t\t\t\tstruct jffs2_sum_inode_flash *spi;\n\t\t\t\tspi = sp;\n\n\t\t\t\tino = je32_to_cpu(spi->inode);\n\n\t\t\t\tdbg_summary(\"Inode at 0x%08x-0x%08x\\n\",\n\t\t\t\t\t    jeb->offset + je32_to_cpu(spi->offset),\n\t\t\t\t\t    jeb->offset + je32_to_cpu(spi->offset) + je32_to_cpu(spi->totlen));\n\n\t\t\t\tic = jffs2_scan_make_ino_cache(c, ino);\n\t\t\t\tif (!ic) {\n\t\t\t\t\tJFFS2_NOTICE(\"scan_make_ino_cache failed\\n\");\n\t\t\t\t\treturn -ENOMEM;\n\t\t\t\t}\n\n\t\t\t\tsum_link_node_ref(c, jeb, je32_to_cpu(spi->offset) | REF_UNCHECKED,\n\t\t\t\t\t\t  PAD(je32_to_cpu(spi->totlen)), ic);\n\n\t\t\t\t*pseudo_random += je32_to_cpu(spi->version);\n\n\t\t\t\tsp += JFFS2_SUMMARY_INODE_SIZE;\n\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tcase JFFS2_NODETYPE_DIRENT: {\n\t\t\t\tstruct jffs2_sum_dirent_flash *spd;\n\t\t\t\tint checkedlen;\n\t\t\t\tspd = sp;\n\n\t\t\t\tdbg_summary(\"Dirent at 0x%08x-0x%08x\\n\",\n\t\t\t\t\t    jeb->offset + je32_to_cpu(spd->offset),\n\t\t\t\t\t    jeb->offset + je32_to_cpu(spd->offset) + je32_to_cpu(spd->totlen));\n\n\n\t\t\t\t/* This should never happen, but https://dev.laptop.org/ticket/4184 */\n\t\t\t\tcheckedlen = strnlen(spd->name, spd->nsize);\n\t\t\t\tif (!checkedlen) {\n\t\t\t\t\tpr_err(\"Dirent at %08x has zero at start of name. Aborting mount.\\n\",\n\t\t\t\t\t       jeb->offset +\n\t\t\t\t\t       je32_to_cpu(spd->offset));\n\t\t\t\t\treturn -EIO;\n\t\t\t\t}\n\t\t\t\tif (checkedlen < spd->nsize) {\n\t\t\t\t\tpr_err(\"Dirent at %08x has zeroes in name. Truncating to %d chars\\n\",\n\t\t\t\t\t       jeb->offset +\n\t\t\t\t\t       je32_to_cpu(spd->offset),\n\t\t\t\t\t       checkedlen);\n\t\t\t\t}\n\n\n\t\t\t\tfd = jffs2_alloc_full_dirent(checkedlen+1);\n\t\t\t\tif (!fd)\n\t\t\t\t\treturn -ENOMEM;\n\n\t\t\t\tmemcpy(&fd->name, spd->name, checkedlen);\n\t\t\t\tfd->name[checkedlen] = 0;\n\n\t\t\t\tic = jffs2_scan_make_ino_cache(c, je32_to_cpu(spd->pino));\n\t\t\t\tif (!ic) {\n\t\t\t\t\tjffs2_free_full_dirent(fd);\n\t\t\t\t\treturn -ENOMEM;\n\t\t\t\t}\n\n\t\t\t\tfd->raw = sum_link_node_ref(c, jeb,  je32_to_cpu(spd->offset) | REF_UNCHECKED,\n\t\t\t\t\t\t\t    PAD(je32_to_cpu(spd->totlen)), ic);\n\n\t\t\t\tfd->next = NULL;\n\t\t\t\tfd->version = je32_to_cpu(spd->version);\n\t\t\t\tfd->ino = je32_to_cpu(spd->ino);\n\t\t\t\tfd->nhash = full_name_hash(fd->name, checkedlen);\n\t\t\t\tfd->type = spd->type;\n\n\t\t\t\tjffs2_add_fd_to_list(c, fd, &ic->scan_dents);\n\n\t\t\t\t*pseudo_random += je32_to_cpu(spd->version);\n\n\t\t\t\tsp += JFFS2_SUMMARY_DIRENT_SIZE(spd->nsize);\n\n\t\t\t\tbreak;\n\t\t\t}\n#ifdef CONFIG_JFFS2_FS_XATTR\n\t\t\tcase JFFS2_NODETYPE_XATTR: {\n\t\t\t\tstruct jffs2_xattr_datum *xd;\n\t\t\t\tstruct jffs2_sum_xattr_flash *spx;\n\n\t\t\t\tspx = (struct jffs2_sum_xattr_flash *)sp;\n\t\t\t\tdbg_summary(\"xattr at %#08x-%#08x (xid=%u, version=%u)\\n\", \n\t\t\t\t\t    jeb->offset + je32_to_cpu(spx->offset),\n\t\t\t\t\t    jeb->offset + je32_to_cpu(spx->offset) + je32_to_cpu(spx->totlen),\n\t\t\t\t\t    je32_to_cpu(spx->xid), je32_to_cpu(spx->version));\n\n\t\t\t\txd = jffs2_setup_xattr_datum(c, je32_to_cpu(spx->xid),\n\t\t\t\t\t\t\t\tje32_to_cpu(spx->version));\n\t\t\t\tif (IS_ERR(xd))\n\t\t\t\t\treturn PTR_ERR(xd);\n\t\t\t\tif (xd->version > je32_to_cpu(spx->version)) {\n\t\t\t\t\t/* node is not the newest one */\n\t\t\t\t\tstruct jffs2_raw_node_ref *raw\n\t\t\t\t\t\t= sum_link_node_ref(c, jeb, je32_to_cpu(spx->offset) | REF_UNCHECKED,\n\t\t\t\t\t\t\t\t    PAD(je32_to_cpu(spx->totlen)), NULL);\n\t\t\t\t\traw->next_in_ino = xd->node->next_in_ino;\n\t\t\t\t\txd->node->next_in_ino = raw;\n\t\t\t\t} else {\n\t\t\t\t\txd->version = je32_to_cpu(spx->version);\n\t\t\t\t\tsum_link_node_ref(c, jeb, je32_to_cpu(spx->offset) | REF_UNCHECKED,\n\t\t\t\t\t\t\t  PAD(je32_to_cpu(spx->totlen)), (void *)xd);\n\t\t\t\t}\n\t\t\t\t*pseudo_random += je32_to_cpu(spx->xid);\n\t\t\t\tsp += JFFS2_SUMMARY_XATTR_SIZE;\n\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase JFFS2_NODETYPE_XREF: {\n\t\t\t\tstruct jffs2_xattr_ref *ref;\n\t\t\t\tstruct jffs2_sum_xref_flash *spr;\n\n\t\t\t\tspr = (struct jffs2_sum_xref_flash *)sp;\n\t\t\t\tdbg_summary(\"xref at %#08x-%#08x\\n\",\n\t\t\t\t\t    jeb->offset + je32_to_cpu(spr->offset),\n\t\t\t\t\t    jeb->offset + je32_to_cpu(spr->offset) + \n\t\t\t\t\t    (uint32_t)PAD(sizeof(struct jffs2_raw_xref)));\n\n\t\t\t\tref = jffs2_alloc_xattr_ref();\n\t\t\t\tif (!ref) {\n\t\t\t\t\tJFFS2_NOTICE(\"allocation of xattr_datum failed\\n\");\n\t\t\t\t\treturn -ENOMEM;\n\t\t\t\t}\n\t\t\t\tref->next = c->xref_temp;\n\t\t\t\tc->xref_temp = ref;\n\n\t\t\t\tsum_link_node_ref(c, jeb, je32_to_cpu(spr->offset) | REF_UNCHECKED,\n\t\t\t\t\t\t  PAD(sizeof(struct jffs2_raw_xref)), (void *)ref);\n\n\t\t\t\t*pseudo_random += ref->node->flash_offset;\n\t\t\t\tsp += JFFS2_SUMMARY_XREF_SIZE;\n\n\t\t\t\tbreak;\n\t\t\t}\n#endif\n\t\t\tdefault : {\n\t\t\t\tuint16_t nodetype = je16_to_cpu(((struct jffs2_sum_unknown_flash *)sp)->nodetype);\n\t\t\t\tJFFS2_WARNING(\"Unsupported node type %x found in summary! Exiting...\\n\", nodetype);\n\t\t\t\tif ((nodetype & JFFS2_COMPAT_MASK) == JFFS2_FEATURE_INCOMPAT)\n\t\t\t\t\treturn -EIO;\n\n\t\t\t\t/* For compatible node types, just fall back to the full scan */\n\t\t\t\tc->wasted_size -= jeb->wasted_size;\n\t\t\t\tc->free_size += c->sector_size - jeb->free_size;\n\t\t\t\tc->used_size -= jeb->used_size;\n\t\t\t\tc->dirty_size -= jeb->dirty_size;\n\t\t\t\tjeb->wasted_size = jeb->used_size = jeb->dirty_size = 0;\n\t\t\t\tjeb->free_size = c->sector_size;\n\n\t\t\t\tjffs2_free_jeb_node_refs(c, jeb);\n\t\t\t\treturn -ENOTRECOVERABLE;\n\t\t\t}\n\t\t}\n\t}\n\treturn 0;\n}",
    "includes": [
      "include \"debug.h\"",
      "include \"nodelist.h\"\n#",
      "include <linux/vmalloc.h>\n#",
      "include <linux/compiler.h>\n#",
      "include <linux/crc32.h>\n#",
      "include <linux/pagemap.h>\n#",
      "include <linux/mtd/mtd.h>\n#",
      "include <linux/slab.h>\n#",
      "include <linux/kernel.h>\n#"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "ffs2_free_jeb_node_refs(",
          "args": [
            ",",
            "eb)"
          ],
          "line": 563
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "FFS2_WARNING(",
          "args": [
            "Unsupported node type %x found in summary! Exiting...\\n\",",
            "odetype)"
          ],
          "line": 551
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "e16_to_cpu(",
          "args": [
            "(struct jffs2_sum_unknown_flash *)sp)->nodetype)"
          ],
          "line": 550
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "um_link_node_ref(",
          "args": [
            ",",
            "eb,",
            "e32_to_cpu(spr->offset) | REF_UNCHECKED,",
            "AD(sizeof(struct jffs2_raw_xref)),",
            "void *)ref)"
          ],
          "line": 540
        },
        "resolved": true,
        "details": {
          "function_name": "um_link_node_ref(",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/jffs2/summary.c",
          "lines": "370-382",
          "snippet": "tatic struct jffs2_raw_node_ref *sum_link_node_ref(struct jffs2_sb_info *c,\n\t\t\t\t\t\t    struct jffs2_eraseblock *jeb,\n\t\t\t\t\t\t    uint32_t ofs, uint32_t len,\n\t\t\t\t\t\t    struct jffs2_inode_cache *ic)\n{\n\t/* If there was a gap, mark it dirty */\n\tif ((ofs & ~3) > c->sector_size - jeb->free_size) {\n\t\t/* Ew. Summary doesn't actually tell us explicitly about dirty space */\n\t\tjffs2_scan_dirty_space(c, jeb, (ofs & ~3) - (c->sector_size - jeb->free_size));\n\t}\n\n\treturn jffs2_link_node_ref(c, jeb, jeb->offset + ofs, len, ic);\n}",
          "includes": [
            "include \"debug.h\"",
            "include \"nodelist.h\"\n#",
            "include <linux/vmalloc.h>\n#",
            "include <linux/compiler.h>\n#",
            "include <linux/crc32.h>\n#",
            "include <linux/pagemap.h>\n#",
            "include <linux/mtd/mtd.h>\n#",
            "include <linux/slab.h>\n#",
            "include <linux/kernel.h>\n#"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "include \"debug.h\"\ninclude \"nodelist.h\"\n#\ninclude <linux/vmalloc.h>\n#\ninclude <linux/compiler.h>\n#\ninclude <linux/crc32.h>\n#\ninclude <linux/pagemap.h>\n#\ninclude <linux/mtd/mtd.h>\n#\ninclude <linux/slab.h>\n#\ninclude <linux/kernel.h>\n#\n\ntatic struct jffs2_raw_node_ref *sum_link_node_ref(struct jffs2_sb_info *c,\n\t\t\t\t\t\t    struct jffs2_eraseblock *jeb,\n\t\t\t\t\t\t    uint32_t ofs, uint32_t len,\n\t\t\t\t\t\t    struct jffs2_inode_cache *ic)\n{\n\t/* If there was a gap, mark it dirty */\n\tif ((ofs & ~3) > c->sector_size - jeb->free_size) {\n\t\t/* Ew. Summary doesn't actually tell us explicitly about dirty space */\n\t\tjffs2_scan_dirty_space(c, jeb, (ofs & ~3) - (c->sector_size - jeb->free_size));\n\t}\n\n\treturn jffs2_link_node_ref(c, jeb, jeb->offset + ofs, len, ic);\n}"
        }
      },
      {
        "call_info": {
          "callee": "AD(",
          "args": [
            "izeof(struct jffs2_raw_xref))"
          ],
          "line": 541
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "e32_to_cpu(",
          "args": [
            "pr->offset)"
          ],
          "line": 540
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "FFS2_NOTICE(",
          "args": [
            "allocation of xattr_datum failed\\n\")"
          ],
          "line": 534
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ffs2_alloc_xattr_ref(",
          "args": [],
          "line": 532
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bg_summary(",
          "args": [
            "xref at %#08x-%#08x\\n\",",
            "eb->offset + je32_to_cpu(spr->offset),",
            "eb->offset + je32_to_cpu(spr->offset) + \n\t\t\t\t\t    (uint32_t)PAD(sizeof(struct jffs2_raw_xref)))"
          ],
          "line": 527
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "AD(",
          "args": [
            "izeof(struct jffs2_raw_xref))"
          ],
          "line": 530
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "e32_to_cpu(",
          "args": [
            "pr->offset)"
          ],
          "line": 529
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "e32_to_cpu(",
          "args": [
            "pr->offset)"
          ],
          "line": 528
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "e32_to_cpu(",
          "args": [
            "px->xid)"
          ],
          "line": 517
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "AD(",
          "args": [
            "e32_to_cpu(spx->totlen))"
          ],
          "line": 515
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "e32_to_cpu(",
          "args": [
            "px->totlen)"
          ],
          "line": 515
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "e32_to_cpu(",
          "args": [
            "px->offset)"
          ],
          "line": 514
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "e32_to_cpu(",
          "args": [
            "px->version)"
          ],
          "line": 513
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "AD(",
          "args": [
            "e32_to_cpu(spx->totlen))"
          ],
          "line": 509
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "e32_to_cpu(",
          "args": [
            "px->totlen)"
          ],
          "line": 509
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "e32_to_cpu(",
          "args": [
            "px->offset)"
          ],
          "line": 508
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "e32_to_cpu(",
          "args": [
            "px->version)"
          ],
          "line": 505
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "TR_ERR(",
          "args": [
            "d)"
          ],
          "line": 504
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "S_ERR(",
          "args": [
            "d)"
          ],
          "line": 503
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ffs2_setup_xattr_datum(",
          "args": [
            ",",
            "e32_to_cpu(spx->xid),",
            "e32_to_cpu(spx->version))"
          ],
          "line": 501
        },
        "resolved": true,
        "details": {
          "function_name": "ffs2_setup_xattr_datum(",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/jffs2/xattr.c",
          "lines": "889-906",
          "snippet": "truct jffs2_xattr_datum *jffs2_setup_xattr_datum(struct jffs2_sb_info *c,\n\t\t\t\t\t\t  uint32_t xid, uint32_t version)\n{\n\tstruct jffs2_xattr_datum *xd;\n\n\txd = jffs2_find_xattr_datum(c, xid);\n\tif (!xd) {\n\t\txd = jffs2_alloc_xattr_datum();\n\t\tif (!xd)\n\t\t\treturn ERR_PTR(-ENOMEM);\n\t\txd->xid = xid;\n\t\txd->version = version;\n\t\tif (xd->xid > c->highest_xid)\n\t\t\tc->highest_xid = xd->xid;\n\t\tlist_add_tail(&xd->xindex, &c->xattrindex[xid % XATTRINDEX_HASHSIZE]);\n\t}\n\treturn xd;\n}",
          "includes": [
            "include \"nodelist.h\"\n/",
            "include <linux/mtd/mtd.h>\n#",
            "include <linux/posix_acl_xattr.h>\n#",
            "include <linux/xattr.h>\n#",
            "include <linux/jffs2.h>\n#",
            "include <linux/crc32.h>\n#",
            "include <linux/highmem.h>\n#",
            "include <linux/pagemap.h>\n#",
            "include <linux/time.h>\n#",
            "include <linux/fs.h>\n#",
            "include <linux/slab.h>\n#",
            "include <linux/kernel.h>\n#"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "include \"nodelist.h\"\n/\ninclude <linux/mtd/mtd.h>\n#\ninclude <linux/posix_acl_xattr.h>\n#\ninclude <linux/xattr.h>\n#\ninclude <linux/jffs2.h>\n#\ninclude <linux/crc32.h>\n#\ninclude <linux/highmem.h>\n#\ninclude <linux/pagemap.h>\n#\ninclude <linux/time.h>\n#\ninclude <linux/fs.h>\n#\ninclude <linux/slab.h>\n#\ninclude <linux/kernel.h>\n#\n\ntruct jffs2_xattr_datum *jffs2_setup_xattr_datum(struct jffs2_sb_info *c,\n\t\t\t\t\t\t  uint32_t xid, uint32_t version)\n{\n\tstruct jffs2_xattr_datum *xd;\n\n\txd = jffs2_find_xattr_datum(c, xid);\n\tif (!xd) {\n\t\txd = jffs2_alloc_xattr_datum();\n\t\tif (!xd)\n\t\t\treturn ERR_PTR(-ENOMEM);\n\t\txd->xid = xid;\n\t\txd->version = version;\n\t\tif (xd->xid > c->highest_xid)\n\t\t\tc->highest_xid = xd->xid;\n\t\tlist_add_tail(&xd->xindex, &c->xattrindex[xid % XATTRINDEX_HASHSIZE]);\n\t}\n\treturn xd;\n}"
        }
      },
      {
        "call_info": {
          "callee": "e32_to_cpu(",
          "args": [
            "px->version)"
          ],
          "line": 502
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "e32_to_cpu(",
          "args": [
            "px->xid)"
          ],
          "line": 501
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bg_summary(",
          "args": [
            "xattr at %#08x-%#08x (xid=%u, version=%u)\\n\",",
            "eb->offset + je32_to_cpu(spx->offset),",
            "eb->offset + je32_to_cpu(spx->offset) + je32_to_cpu(spx->totlen),",
            "e32_to_cpu(spx->xid),",
            "e32_to_cpu(spx->version))"
          ],
          "line": 496
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "e32_to_cpu(",
          "args": [
            "px->version)"
          ],
          "line": 499
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "e32_to_cpu(",
          "args": [
            "px->xid)"
          ],
          "line": 499
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "e32_to_cpu(",
          "args": [
            "px->totlen)"
          ],
          "line": 498
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "e32_to_cpu(",
          "args": [
            "px->offset)"
          ],
          "line": 498
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "e32_to_cpu(",
          "args": [
            "px->offset)"
          ],
          "line": 497
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "FFS2_SUMMARY_DIRENT_SIZE(",
          "args": [
            "pd->nsize)"
          ],
          "line": 486
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "e32_to_cpu(",
          "args": [
            "pd->version)"
          ],
          "line": 484
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ffs2_add_fd_to_list(",
          "args": [
            ",",
            "d,",
            "ic->scan_dents)"
          ],
          "line": 482
        },
        "resolved": true,
        "details": {
          "function_name": "ffs2_add_fd_to_list(",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/jffs2/nodelist.c",
          "lines": "26-57",
          "snippet": "oid jffs2_add_fd_to_list(struct jffs2_sb_info *c, struct jffs2_full_dirent *new, struct jffs2_full_dirent **list)\n{\n\tstruct jffs2_full_dirent **prev = list;\n\n\tdbg_dentlist(\"add dirent \\\"%s\\\", ino #%u\\n\", new->name, new->ino);\n\n\twhile ((*prev) && (*prev)->nhash <= new->nhash) {\n\t\tif ((*prev)->nhash == new->nhash && !strcmp((*prev)->name, new->name)) {\n\t\t\t/* Duplicate. Free one */\n\t\t\tif (new->version < (*prev)->version) {\n\t\t\t\tdbg_dentlist(\"Eep! Marking new dirent node obsolete, old is \\\"%s\\\", ino #%u\\n\",\n\t\t\t\t\t(*prev)->name, (*prev)->ino);\n\t\t\t\tjffs2_mark_node_obsolete(c, new->raw);\n\t\t\t\tjffs2_free_full_dirent(new);\n\t\t\t} else {\n\t\t\t\tdbg_dentlist(\"marking old dirent \\\"%s\\\", ino #%u obsolete\\n\",\n\t\t\t\t\t(*prev)->name, (*prev)->ino);\n\t\t\t\tnew->next = (*prev)->next;\n\t\t\t\t/* It may have been a 'placeholder' deletion dirent, \n\t\t\t\t   if jffs2_can_mark_obsolete() (see jffs2_do_unlink()) */\n\t\t\t\tif ((*prev)->raw)\n\t\t\t\t\tjffs2_mark_node_obsolete(c, ((*prev)->raw));\n\t\t\t\tjffs2_free_full_dirent(*prev);\n\t\t\t\t*prev = new;\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\t\tprev = &((*prev)->next);\n\t}\n\tnew->next = *prev;\n\t*prev = new;\n}",
          "includes": [
            "include \"nodelist.h\"",
            "include <linux/pagemap.h>\n#",
            "include <linux/crc32.h>\n#",
            "include <linux/rbtree.h>\n#",
            "include <linux/mtd/mtd.h>\n#",
            "include <linux/fs.h>\n#",
            "include <linux/sched.h>\n#",
            "include <linux/kernel.h>\n#"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "include \"nodelist.h\"\ninclude <linux/pagemap.h>\n#\ninclude <linux/crc32.h>\n#\ninclude <linux/rbtree.h>\n#\ninclude <linux/mtd/mtd.h>\n#\ninclude <linux/fs.h>\n#\ninclude <linux/sched.h>\n#\ninclude <linux/kernel.h>\n#\n\noid jffs2_add_fd_to_list(struct jffs2_sb_info *c, struct jffs2_full_dirent *new, struct jffs2_full_dirent **list)\n{\n\tstruct jffs2_full_dirent **prev = list;\n\n\tdbg_dentlist(\"add dirent \\\"%s\\\", ino #%u\\n\", new->name, new->ino);\n\n\twhile ((*prev) && (*prev)->nhash <= new->nhash) {\n\t\tif ((*prev)->nhash == new->nhash && !strcmp((*prev)->name, new->name)) {\n\t\t\t/* Duplicate. Free one */\n\t\t\tif (new->version < (*prev)->version) {\n\t\t\t\tdbg_dentlist(\"Eep! Marking new dirent node obsolete, old is \\\"%s\\\", ino #%u\\n\",\n\t\t\t\t\t(*prev)->name, (*prev)->ino);\n\t\t\t\tjffs2_mark_node_obsolete(c, new->raw);\n\t\t\t\tjffs2_free_full_dirent(new);\n\t\t\t} else {\n\t\t\t\tdbg_dentlist(\"marking old dirent \\\"%s\\\", ino #%u obsolete\\n\",\n\t\t\t\t\t(*prev)->name, (*prev)->ino);\n\t\t\t\tnew->next = (*prev)->next;\n\t\t\t\t/* It may have been a 'placeholder' deletion dirent, \n\t\t\t\t   if jffs2_can_mark_obsolete() (see jffs2_do_unlink()) */\n\t\t\t\tif ((*prev)->raw)\n\t\t\t\t\tjffs2_mark_node_obsolete(c, ((*prev)->raw));\n\t\t\t\tjffs2_free_full_dirent(*prev);\n\t\t\t\t*prev = new;\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\t\tprev = &((*prev)->next);\n\t}\n\tnew->next = *prev;\n\t*prev = new;\n}"
        }
      },
      {
        "call_info": {
          "callee": "ull_name_hash(",
          "args": [
            "d->name,",
            "heckedlen)"
          ],
          "line": 479
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "e32_to_cpu(",
          "args": [
            "pd->ino)"
          ],
          "line": 478
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "e32_to_cpu(",
          "args": [
            "pd->version)"
          ],
          "line": 477
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "AD(",
          "args": [
            "e32_to_cpu(spd->totlen))"
          ],
          "line": 474
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "e32_to_cpu(",
          "args": [
            "pd->totlen)"
          ],
          "line": 474
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "e32_to_cpu(",
          "args": [
            "pd->offset)"
          ],
          "line": 473
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ffs2_free_full_dirent(",
          "args": [
            "d)"
          ],
          "line": 469
        },
        "resolved": true,
        "details": {
          "function_name": "ffs2_free_full_dirent(",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/jffs2/malloc.c",
          "lines": "130-134",
          "snippet": "oid jffs2_free_full_dirent(struct jffs2_full_dirent *x)\n{\n\tdbg_memalloc(\"%p\\n\", x);\n\tkfree(x);\n}",
          "includes": [
            "include \"nodelist.h\"",
            "include <linux/jffs2.h>\n#",
            "include <linux/init.h>\n#",
            "include <linux/slab.h>\n#",
            "include <linux/kernel.h>\n#"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "include \"nodelist.h\"\ninclude <linux/jffs2.h>\n#\ninclude <linux/init.h>\n#\ninclude <linux/slab.h>\n#\ninclude <linux/kernel.h>\n#\n\noid jffs2_free_full_dirent(struct jffs2_full_dirent *x)\n{\n\tdbg_memalloc(\"%p\\n\", x);\n\tkfree(x);\n}"
        }
      },
      {
        "call_info": {
          "callee": "ffs2_scan_make_ino_cache(",
          "args": [
            ",",
            "e32_to_cpu(spd->pino))"
          ],
          "line": 467
        },
        "resolved": true,
        "details": {
          "function_name": "ffs2_scan_make_ino_cache(",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/jffs2/scan.c",
          "lines": "959-983",
          "snippet": "truct jffs2_inode_cache *jffs2_scan_make_ino_cache(struct jffs2_sb_info *c, uint32_t ino)\n{\n\tstruct jffs2_inode_cache *ic;\n\n\tic = jffs2_get_ino_cache(c, ino);\n\tif (ic)\n\t\treturn ic;\n\n\tif (ino > c->highest_ino)\n\t\tc->highest_ino = ino;\n\n\tic = jffs2_alloc_inode_cache();\n\tif (!ic) {\n\t\tpr_notice(\"%s(): allocation of inode cache failed\\n\", __func__);\n\t\treturn NULL;\n\t}\n\tmemset(ic, 0, sizeof(*ic));\n\n\tic->ino = ino;\n\tic->nodes = (void *)ic;\n\tjffs2_add_ino_cache(c, ic);\n\tif (ino == 1)\n\t\tic->pino_nlink = 1;\n\treturn ic;\n}",
          "includes": [
            "include \"debug.h\"",
            "include \"summary.h\"\n#",
            "include \"nodelist.h\"\n#",
            "include <linux/compiler.h>\n#",
            "include <linux/crc32.h>\n#",
            "include <linux/pagemap.h>\n#",
            "include <linux/mtd/mtd.h>\n#",
            "include <linux/slab.h>\n#",
            "include <linux/sched.h>\n#",
            "include <linux/kernel.h>\n#"
          ],
          "macros_used": [],
          "globals_used": [
            "tatic int jffs2_scan_eraseblock (struct jffs2_sb_info *c, struct jffs2_eraseblock *jeb,\n\t\t\t\t  unsigned char *buf, uint32_t buf_size, struct jffs2_summary *s);",
            "tatic int jffs2_scan_inode_node(struct jffs2_sb_info *c, struct jffs2_eraseblock *jeb,\n\t\t\t\t struct jffs2_raw_inode *ri, uint32_t ofs, struct jffs2_summary *s);",
            "tatic int jffs2_scan_dirent_node(struct jffs2_sb_info *c, struct jffs2_eraseblock *jeb,\n\t\t\t\t struct jffs2_raw_dirent *rd, uint32_t ofs, struct jffs2_summary *s);"
          ],
          "called_functions": [],
          "contextual_snippet": "include \"debug.h\"\ninclude \"summary.h\"\n#\ninclude \"nodelist.h\"\n#\ninclude <linux/compiler.h>\n#\ninclude <linux/crc32.h>\n#\ninclude <linux/pagemap.h>\n#\ninclude <linux/mtd/mtd.h>\n#\ninclude <linux/slab.h>\n#\ninclude <linux/sched.h>\n#\ninclude <linux/kernel.h>\n#\n\ntatic int jffs2_scan_eraseblock (struct jffs2_sb_info *c, struct jffs2_eraseblock *jeb,\n\t\t\t\t  unsigned char *buf, uint32_t buf_size, struct jffs2_summary *s);\ntatic int jffs2_scan_inode_node(struct jffs2_sb_info *c, struct jffs2_eraseblock *jeb,\n\t\t\t\t struct jffs2_raw_inode *ri, uint32_t ofs, struct jffs2_summary *s);\ntatic int jffs2_scan_dirent_node(struct jffs2_sb_info *c, struct jffs2_eraseblock *jeb,\n\t\t\t\t struct jffs2_raw_dirent *rd, uint32_t ofs, struct jffs2_summary *s);\n\ntruct jffs2_inode_cache *jffs2_scan_make_ino_cache(struct jffs2_sb_info *c, uint32_t ino)\n{\n\tstruct jffs2_inode_cache *ic;\n\n\tic = jffs2_get_ino_cache(c, ino);\n\tif (ic)\n\t\treturn ic;\n\n\tif (ino > c->highest_ino)\n\t\tc->highest_ino = ino;\n\n\tic = jffs2_alloc_inode_cache();\n\tif (!ic) {\n\t\tpr_notice(\"%s(): allocation of inode cache failed\\n\", __func__);\n\t\treturn NULL;\n\t}\n\tmemset(ic, 0, sizeof(*ic));\n\n\tic->ino = ino;\n\tic->nodes = (void *)ic;\n\tjffs2_add_ino_cache(c, ic);\n\tif (ino == 1)\n\t\tic->pino_nlink = 1;\n\treturn ic;\n}"
        }
      },
      {
        "call_info": {
          "callee": "e32_to_cpu(",
          "args": [
            "pd->pino)"
          ],
          "line": 467
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "emcpy(",
          "args": [
            "fd->name,",
            "pd->name,",
            "heckedlen)"
          ],
          "line": 464
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ffs2_alloc_full_dirent(",
          "args": [
            "heckedlen+1)"
          ],
          "line": 460
        },
        "resolved": true,
        "details": {
          "function_name": "ffs2_alloc_full_dirent(",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/jffs2/malloc.c",
          "lines": "122-128",
          "snippet": "truct jffs2_full_dirent *jffs2_alloc_full_dirent(int namesize)\n{\n\tstruct jffs2_full_dirent *ret;\n\tret = kmalloc(sizeof(struct jffs2_full_dirent) + namesize, GFP_KERNEL);\n\tdbg_memalloc(\"%p\\n\", ret);\n\treturn ret;\n}",
          "includes": [
            "include \"nodelist.h\"",
            "include <linux/jffs2.h>\n#",
            "include <linux/init.h>\n#",
            "include <linux/slab.h>\n#",
            "include <linux/kernel.h>\n#"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "include \"nodelist.h\"\ninclude <linux/jffs2.h>\n#\ninclude <linux/init.h>\n#\ninclude <linux/slab.h>\n#\ninclude <linux/kernel.h>\n#\n\ntruct jffs2_full_dirent *jffs2_alloc_full_dirent(int namesize)\n{\n\tstruct jffs2_full_dirent *ret;\n\tret = kmalloc(sizeof(struct jffs2_full_dirent) + namesize, GFP_KERNEL);\n\tdbg_memalloc(\"%p\\n\", ret);\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "r_err(",
          "args": [
            "Dirent at %08x has zeroes in name. Truncating to %d chars\\n\",",
            "eb->offset +\n\t\t\t\t\t       je32_to_cpu(spd->offset),",
            "heckedlen)"
          ],
          "line": 453
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "e32_to_cpu(",
          "args": [
            "pd->offset)"
          ],
          "line": 455
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "r_err(",
          "args": [
            "Dirent at %08x has zero at start of name. Aborting mount.\\n\",",
            "eb->offset +\n\t\t\t\t\t       je32_to_cpu(spd->offset))"
          ],
          "line": 447
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "e32_to_cpu(",
          "args": [
            "pd->offset)"
          ],
          "line": 449
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "trnlen(",
          "args": [
            "pd->name,",
            "pd->nsize)"
          ],
          "line": 445
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bg_summary(",
          "args": [
            "Dirent at 0x%08x-0x%08x\\n\",",
            "eb->offset + je32_to_cpu(spd->offset),",
            "eb->offset + je32_to_cpu(spd->offset) + je32_to_cpu(spd->totlen))"
          ],
          "line": 439
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "e32_to_cpu(",
          "args": [
            "pd->totlen)"
          ],
          "line": 441
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "e32_to_cpu(",
          "args": [
            "pd->offset)"
          ],
          "line": 441
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "e32_to_cpu(",
          "args": [
            "pd->offset)"
          ],
          "line": 440
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "e32_to_cpu(",
          "args": [
            "pi->version)"
          ],
          "line": 427
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "AD(",
          "args": [
            "e32_to_cpu(spi->totlen))"
          ],
          "line": 425
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "e32_to_cpu(",
          "args": [
            "pi->totlen)"
          ],
          "line": 425
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "e32_to_cpu(",
          "args": [
            "pi->offset)"
          ],
          "line": 424
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "FFS2_NOTICE(",
          "args": [
            "scan_make_ino_cache failed\\n\")"
          ],
          "line": 420
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bg_summary(",
          "args": [
            "Inode at 0x%08x-0x%08x\\n\",",
            "eb->offset + je32_to_cpu(spi->offset),",
            "eb->offset + je32_to_cpu(spi->offset) + je32_to_cpu(spi->totlen))"
          ],
          "line": 414
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "e32_to_cpu(",
          "args": [
            "pi->totlen)"
          ],
          "line": 416
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "e32_to_cpu(",
          "args": [
            "pi->offset)"
          ],
          "line": 416
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "e32_to_cpu(",
          "args": [
            "pi->offset)"
          ],
          "line": 415
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "e32_to_cpu(",
          "args": [
            "pi->inode)"
          ],
          "line": 412
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "e16_to_cpu(",
          "args": [
            "(struct jffs2_sum_unknown_flash *)sp)->nodetype)"
          ],
          "line": 407
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ffs2_prealloc_raw_node_refs(",
          "args": [
            ",",
            "eb,",
            ")"
          ],
          "line": 403
        },
        "resolved": true,
        "details": {
          "function_name": "ffs2_prealloc_raw_node_refs(",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/jffs2/malloc.c",
          "lines": "210-249",
          "snippet": "nt jffs2_prealloc_raw_node_refs(struct jffs2_sb_info *c,\n\t\t\t\t struct jffs2_eraseblock *jeb, int nr)\n{\n\tstruct jffs2_raw_node_ref **p, *ref;\n\tint i = nr;\n\n\tdbg_memalloc(\"%d\\n\", nr);\n\n\tp = &jeb->last_node;\n\tref = *p;\n\n\tdbg_memalloc(\"Reserving %d refs for block @0x%08x\\n\", nr, jeb->offset);\n\n\t/* If jeb->last_node is really a valid node then skip over it */\n\tif (ref && ref->flash_offset != REF_EMPTY_NODE)\n\t\tref++;\n\n\twhile (i) {\n\t\tif (!ref) {\n\t\t\tdbg_memalloc(\"Allocating new refblock linked from %p\\n\", p);\n\t\t\tref = *p = jffs2_alloc_refblock();\n\t\t\tif (!ref)\n\t\t\t\treturn -ENOMEM;\n\t\t}\n\t\tif (ref->flash_offset == REF_LINK_NODE) {\n\t\t\tp = &ref->next_in_ino;\n\t\t\tref = *p;\n\t\t\tcontinue;\n\t\t}\n\t\ti--;\n\t\tref++;\n\t}\n\tjeb->allocated_refs = nr;\n\n\tdbg_memalloc(\"Reserved %d refs for block @0x%08x, last_node is %p (%08x,%p)\\n\",\n\t\t  nr, jeb->offset, jeb->last_node, jeb->last_node->flash_offset,\n\t\t  jeb->last_node->next_in_ino);\n\n\treturn 0;\n}",
          "includes": [
            "include \"nodelist.h\"",
            "include <linux/jffs2.h>\n#",
            "include <linux/init.h>\n#",
            "include <linux/slab.h>\n#",
            "include <linux/kernel.h>\n#"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "include \"nodelist.h\"\ninclude <linux/jffs2.h>\n#\ninclude <linux/init.h>\n#\ninclude <linux/slab.h>\n#\ninclude <linux/kernel.h>\n#\n\nnt jffs2_prealloc_raw_node_refs(struct jffs2_sb_info *c,\n\t\t\t\t struct jffs2_eraseblock *jeb, int nr)\n{\n\tstruct jffs2_raw_node_ref **p, *ref;\n\tint i = nr;\n\n\tdbg_memalloc(\"%d\\n\", nr);\n\n\tp = &jeb->last_node;\n\tref = *p;\n\n\tdbg_memalloc(\"Reserving %d refs for block @0x%08x\\n\", nr, jeb->offset);\n\n\t/* If jeb->last_node is really a valid node then skip over it */\n\tif (ref && ref->flash_offset != REF_EMPTY_NODE)\n\t\tref++;\n\n\twhile (i) {\n\t\tif (!ref) {\n\t\t\tdbg_memalloc(\"Allocating new refblock linked from %p\\n\", p);\n\t\t\tref = *p = jffs2_alloc_refblock();\n\t\t\tif (!ref)\n\t\t\t\treturn -ENOMEM;\n\t\t}\n\t\tif (ref->flash_offset == REF_LINK_NODE) {\n\t\t\tp = &ref->next_in_ino;\n\t\t\tref = *p;\n\t\t\tcontinue;\n\t\t}\n\t\ti--;\n\t\tref++;\n\t}\n\tjeb->allocated_refs = nr;\n\n\tdbg_memalloc(\"Reserved %d refs for block @0x%08x, last_node is %p (%08x,%p)\\n\",\n\t\t  nr, jeb->offset, jeb->last_node, jeb->last_node->flash_offset,\n\t\t  jeb->last_node->next_in_ino);\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "ond_resched(",
          "args": [],
          "line": 400
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bg_summary(",
          "args": [
            "processing summary index %d\\n\",",
            ")"
          ],
          "line": 398
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "e32_to_cpu(",
          "args": [
            "ummary->sum_num)"
          ],
          "line": 397
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "include \"debug.h\"\ninclude \"nodelist.h\"\n#\ninclude <linux/vmalloc.h>\n#\ninclude <linux/compiler.h>\n#\ninclude <linux/crc32.h>\n#\ninclude <linux/pagemap.h>\n#\ninclude <linux/mtd/mtd.h>\n#\ninclude <linux/slab.h>\n#\ninclude <linux/kernel.h>\n#\n\ntatic int jffs2_sum_process_sum_data(struct jffs2_sb_info *c, struct jffs2_eraseblock *jeb,\n\t\t\t\tstruct jffs2_raw_summary *summary, uint32_t *pseudo_random)\n{\n\tstruct jffs2_inode_cache *ic;\n\tstruct jffs2_full_dirent *fd;\n\tvoid *sp;\n\tint i, ino;\n\tint err;\n\n\tsp = summary->sum;\n\n\tfor (i=0; i<je32_to_cpu(summary->sum_num); i++) {\n\t\tdbg_summary(\"processing summary index %d\\n\", i);\n\n\t\tcond_resched();\n\n\t\t/* Make sure there's a spare ref for dirty space */\n\t\terr = jffs2_prealloc_raw_node_refs(c, jeb, 2);\n\t\tif (err)\n\t\t\treturn err;\n\n\t\tswitch (je16_to_cpu(((struct jffs2_sum_unknown_flash *)sp)->nodetype)) {\n\t\t\tcase JFFS2_NODETYPE_INODE: {\n\t\t\t\tstruct jffs2_sum_inode_flash *spi;\n\t\t\t\tspi = sp;\n\n\t\t\t\tino = je32_to_cpu(spi->inode);\n\n\t\t\t\tdbg_summary(\"Inode at 0x%08x-0x%08x\\n\",\n\t\t\t\t\t    jeb->offset + je32_to_cpu(spi->offset),\n\t\t\t\t\t    jeb->offset + je32_to_cpu(spi->offset) + je32_to_cpu(spi->totlen));\n\n\t\t\t\tic = jffs2_scan_make_ino_cache(c, ino);\n\t\t\t\tif (!ic) {\n\t\t\t\t\tJFFS2_NOTICE(\"scan_make_ino_cache failed\\n\");\n\t\t\t\t\treturn -ENOMEM;\n\t\t\t\t}\n\n\t\t\t\tsum_link_node_ref(c, jeb, je32_to_cpu(spi->offset) | REF_UNCHECKED,\n\t\t\t\t\t\t  PAD(je32_to_cpu(spi->totlen)), ic);\n\n\t\t\t\t*pseudo_random += je32_to_cpu(spi->version);\n\n\t\t\t\tsp += JFFS2_SUMMARY_INODE_SIZE;\n\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tcase JFFS2_NODETYPE_DIRENT: {\n\t\t\t\tstruct jffs2_sum_dirent_flash *spd;\n\t\t\t\tint checkedlen;\n\t\t\t\tspd = sp;\n\n\t\t\t\tdbg_summary(\"Dirent at 0x%08x-0x%08x\\n\",\n\t\t\t\t\t    jeb->offset + je32_to_cpu(spd->offset),\n\t\t\t\t\t    jeb->offset + je32_to_cpu(spd->offset) + je32_to_cpu(spd->totlen));\n\n\n\t\t\t\t/* This should never happen, but https://dev.laptop.org/ticket/4184 */\n\t\t\t\tcheckedlen = strnlen(spd->name, spd->nsize);\n\t\t\t\tif (!checkedlen) {\n\t\t\t\t\tpr_err(\"Dirent at %08x has zero at start of name. Aborting mount.\\n\",\n\t\t\t\t\t       jeb->offset +\n\t\t\t\t\t       je32_to_cpu(spd->offset));\n\t\t\t\t\treturn -EIO;\n\t\t\t\t}\n\t\t\t\tif (checkedlen < spd->nsize) {\n\t\t\t\t\tpr_err(\"Dirent at %08x has zeroes in name. Truncating to %d chars\\n\",\n\t\t\t\t\t       jeb->offset +\n\t\t\t\t\t       je32_to_cpu(spd->offset),\n\t\t\t\t\t       checkedlen);\n\t\t\t\t}\n\n\n\t\t\t\tfd = jffs2_alloc_full_dirent(checkedlen+1);\n\t\t\t\tif (!fd)\n\t\t\t\t\treturn -ENOMEM;\n\n\t\t\t\tmemcpy(&fd->name, spd->name, checkedlen);\n\t\t\t\tfd->name[checkedlen] = 0;\n\n\t\t\t\tic = jffs2_scan_make_ino_cache(c, je32_to_cpu(spd->pino));\n\t\t\t\tif (!ic) {\n\t\t\t\t\tjffs2_free_full_dirent(fd);\n\t\t\t\t\treturn -ENOMEM;\n\t\t\t\t}\n\n\t\t\t\tfd->raw = sum_link_node_ref(c, jeb,  je32_to_cpu(spd->offset) | REF_UNCHECKED,\n\t\t\t\t\t\t\t    PAD(je32_to_cpu(spd->totlen)), ic);\n\n\t\t\t\tfd->next = NULL;\n\t\t\t\tfd->version = je32_to_cpu(spd->version);\n\t\t\t\tfd->ino = je32_to_cpu(spd->ino);\n\t\t\t\tfd->nhash = full_name_hash(fd->name, checkedlen);\n\t\t\t\tfd->type = spd->type;\n\n\t\t\t\tjffs2_add_fd_to_list(c, fd, &ic->scan_dents);\n\n\t\t\t\t*pseudo_random += je32_to_cpu(spd->version);\n\n\t\t\t\tsp += JFFS2_SUMMARY_DIRENT_SIZE(spd->nsize);\n\n\t\t\t\tbreak;\n\t\t\t}\n#ifdef CONFIG_JFFS2_FS_XATTR\n\t\t\tcase JFFS2_NODETYPE_XATTR: {\n\t\t\t\tstruct jffs2_xattr_datum *xd;\n\t\t\t\tstruct jffs2_sum_xattr_flash *spx;\n\n\t\t\t\tspx = (struct jffs2_sum_xattr_flash *)sp;\n\t\t\t\tdbg_summary(\"xattr at %#08x-%#08x (xid=%u, version=%u)\\n\", \n\t\t\t\t\t    jeb->offset + je32_to_cpu(spx->offset),\n\t\t\t\t\t    jeb->offset + je32_to_cpu(spx->offset) + je32_to_cpu(spx->totlen),\n\t\t\t\t\t    je32_to_cpu(spx->xid), je32_to_cpu(spx->version));\n\n\t\t\t\txd = jffs2_setup_xattr_datum(c, je32_to_cpu(spx->xid),\n\t\t\t\t\t\t\t\tje32_to_cpu(spx->version));\n\t\t\t\tif (IS_ERR(xd))\n\t\t\t\t\treturn PTR_ERR(xd);\n\t\t\t\tif (xd->version > je32_to_cpu(spx->version)) {\n\t\t\t\t\t/* node is not the newest one */\n\t\t\t\t\tstruct jffs2_raw_node_ref *raw\n\t\t\t\t\t\t= sum_link_node_ref(c, jeb, je32_to_cpu(spx->offset) | REF_UNCHECKED,\n\t\t\t\t\t\t\t\t    PAD(je32_to_cpu(spx->totlen)), NULL);\n\t\t\t\t\traw->next_in_ino = xd->node->next_in_ino;\n\t\t\t\t\txd->node->next_in_ino = raw;\n\t\t\t\t} else {\n\t\t\t\t\txd->version = je32_to_cpu(spx->version);\n\t\t\t\t\tsum_link_node_ref(c, jeb, je32_to_cpu(spx->offset) | REF_UNCHECKED,\n\t\t\t\t\t\t\t  PAD(je32_to_cpu(spx->totlen)), (void *)xd);\n\t\t\t\t}\n\t\t\t\t*pseudo_random += je32_to_cpu(spx->xid);\n\t\t\t\tsp += JFFS2_SUMMARY_XATTR_SIZE;\n\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase JFFS2_NODETYPE_XREF: {\n\t\t\t\tstruct jffs2_xattr_ref *ref;\n\t\t\t\tstruct jffs2_sum_xref_flash *spr;\n\n\t\t\t\tspr = (struct jffs2_sum_xref_flash *)sp;\n\t\t\t\tdbg_summary(\"xref at %#08x-%#08x\\n\",\n\t\t\t\t\t    jeb->offset + je32_to_cpu(spr->offset),\n\t\t\t\t\t    jeb->offset + je32_to_cpu(spr->offset) + \n\t\t\t\t\t    (uint32_t)PAD(sizeof(struct jffs2_raw_xref)));\n\n\t\t\t\tref = jffs2_alloc_xattr_ref();\n\t\t\t\tif (!ref) {\n\t\t\t\t\tJFFS2_NOTICE(\"allocation of xattr_datum failed\\n\");\n\t\t\t\t\treturn -ENOMEM;\n\t\t\t\t}\n\t\t\t\tref->next = c->xref_temp;\n\t\t\t\tc->xref_temp = ref;\n\n\t\t\t\tsum_link_node_ref(c, jeb, je32_to_cpu(spr->offset) | REF_UNCHECKED,\n\t\t\t\t\t\t  PAD(sizeof(struct jffs2_raw_xref)), (void *)ref);\n\n\t\t\t\t*pseudo_random += ref->node->flash_offset;\n\t\t\t\tsp += JFFS2_SUMMARY_XREF_SIZE;\n\n\t\t\t\tbreak;\n\t\t\t}\n#endif\n\t\t\tdefault : {\n\t\t\t\tuint16_t nodetype = je16_to_cpu(((struct jffs2_sum_unknown_flash *)sp)->nodetype);\n\t\t\t\tJFFS2_WARNING(\"Unsupported node type %x found in summary! Exiting...\\n\", nodetype);\n\t\t\t\tif ((nodetype & JFFS2_COMPAT_MASK) == JFFS2_FEATURE_INCOMPAT)\n\t\t\t\t\treturn -EIO;\n\n\t\t\t\t/* For compatible node types, just fall back to the full scan */\n\t\t\t\tc->wasted_size -= jeb->wasted_size;\n\t\t\t\tc->free_size += c->sector_size - jeb->free_size;\n\t\t\t\tc->used_size -= jeb->used_size;\n\t\t\t\tc->dirty_size -= jeb->dirty_size;\n\t\t\t\tjeb->wasted_size = jeb->used_size = jeb->dirty_size = 0;\n\t\t\t\tjeb->free_size = c->sector_size;\n\n\t\t\t\tjffs2_free_jeb_node_refs(c, jeb);\n\t\t\t\treturn -ENOTRECOVERABLE;\n\t\t\t}\n\t\t}\n\t}\n\treturn 0;\n}"
  },
  {
    "function_name": "um_link_node_ref(",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/jffs2/summary.c",
    "lines": "370-382",
    "snippet": "tatic struct jffs2_raw_node_ref *sum_link_node_ref(struct jffs2_sb_info *c,\n\t\t\t\t\t\t    struct jffs2_eraseblock *jeb,\n\t\t\t\t\t\t    uint32_t ofs, uint32_t len,\n\t\t\t\t\t\t    struct jffs2_inode_cache *ic)\n{\n\t/* If there was a gap, mark it dirty */\n\tif ((ofs & ~3) > c->sector_size - jeb->free_size) {\n\t\t/* Ew. Summary doesn't actually tell us explicitly about dirty space */\n\t\tjffs2_scan_dirty_space(c, jeb, (ofs & ~3) - (c->sector_size - jeb->free_size));\n\t}\n\n\treturn jffs2_link_node_ref(c, jeb, jeb->offset + ofs, len, ic);\n}",
    "includes": [
      "include \"debug.h\"",
      "include \"nodelist.h\"\n#",
      "include <linux/vmalloc.h>\n#",
      "include <linux/compiler.h>\n#",
      "include <linux/crc32.h>\n#",
      "include <linux/pagemap.h>\n#",
      "include <linux/mtd/mtd.h>\n#",
      "include <linux/slab.h>\n#",
      "include <linux/kernel.h>\n#"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "ffs2_link_node_ref(",
          "args": [
            ",",
            "eb,",
            "eb->offset + ofs,",
            "en,",
            "c)"
          ],
          "line": 381
        },
        "resolved": true,
        "details": {
          "function_name": "ffs2_link_node_ref(",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/jffs2/nodelist.c",
          "lines": "585-659",
          "snippet": "truct jffs2_raw_node_ref *jffs2_link_node_ref(struct jffs2_sb_info *c,\n\t\t\t\t\t       struct jffs2_eraseblock *jeb,\n\t\t\t\t\t       uint32_t ofs, uint32_t len,\n\t\t\t\t\t       struct jffs2_inode_cache *ic)\n{\n\tstruct jffs2_raw_node_ref *ref;\n\n\tBUG_ON(!jeb->allocated_refs);\n\tjeb->allocated_refs--;\n\n\tref = jeb->last_node;\n\n\tdbg_noderef(\"Last node at %p is (%08x,%p)\\n\", ref, ref->flash_offset,\n\t\t    ref->next_in_ino);\n\n\twhile (ref->flash_offset != REF_EMPTY_NODE) {\n\t\tif (ref->flash_offset == REF_LINK_NODE)\n\t\t\tref = ref->next_in_ino;\n\t\telse\n\t\t\tref++;\n\t}\n\n\tdbg_noderef(\"New ref is %p (%08x becomes %08x,%p) len 0x%x\\n\", ref, \n\t\t    ref->flash_offset, ofs, ref->next_in_ino, len);\n\n\tref->flash_offset = ofs;\n\n\tif (!jeb->first_node) {\n\t\tjeb->first_node = ref;\n\t\tBUG_ON(ref_offset(ref) != jeb->offset);\n\t} else if (unlikely(ref_offset(ref) != jeb->offset + c->sector_size - jeb->free_size)) {\n\t\tuint32_t last_len = ref_totlen(c, jeb, jeb->last_node);\n\n\t\tJFFS2_ERROR(\"Adding new ref %p at (0x%08x-0x%08x) not immediately after previous (0x%08x-0x%08x)\\n\",\n\t\t\t    ref, ref_offset(ref), ref_offset(ref)+len,\n\t\t\t    ref_offset(jeb->last_node), \n\t\t\t    ref_offset(jeb->last_node)+last_len);\n\t\tBUG();\n\t}\n\tjeb->last_node = ref;\n\n\tif (ic) {\n\t\tref->next_in_ino = ic->nodes;\n\t\tic->nodes = ref;\n\t} else {\n\t\tref->next_in_ino = NULL;\n\t}\n\n\tswitch(ref_flags(ref)) {\n\tcase REF_UNCHECKED:\n\t\tc->unchecked_size += len;\n\t\tjeb->unchecked_size += len;\n\t\tbreak;\n\n\tcase REF_NORMAL:\n\tcase REF_PRISTINE:\n\t\tc->used_size += len;\n\t\tjeb->used_size += len;\n\t\tbreak;\n\n\tcase REF_OBSOLETE:\n\t\tc->dirty_size += len;\n\t\tjeb->dirty_size += len;\n\t\tbreak;\n\t}\n\tc->free_size -= len;\n\tjeb->free_size -= len;\n\n#ifdef TEST_TOTLEN\n\t/* Set (and test) __totlen field... for now */\n\tref->__totlen = len;\n\tref_totlen(c, jeb, ref);\n#endif\n\treturn ref;\n}",
          "includes": [
            "include \"nodelist.h\"",
            "include <linux/pagemap.h>\n#",
            "include <linux/crc32.h>\n#",
            "include <linux/rbtree.h>\n#",
            "include <linux/mtd/mtd.h>\n#",
            "include <linux/fs.h>\n#",
            "include <linux/sched.h>\n#",
            "include <linux/kernel.h>\n#"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "include \"nodelist.h\"\ninclude <linux/pagemap.h>\n#\ninclude <linux/crc32.h>\n#\ninclude <linux/rbtree.h>\n#\ninclude <linux/mtd/mtd.h>\n#\ninclude <linux/fs.h>\n#\ninclude <linux/sched.h>\n#\ninclude <linux/kernel.h>\n#\n\ntruct jffs2_raw_node_ref *jffs2_link_node_ref(struct jffs2_sb_info *c,\n\t\t\t\t\t       struct jffs2_eraseblock *jeb,\n\t\t\t\t\t       uint32_t ofs, uint32_t len,\n\t\t\t\t\t       struct jffs2_inode_cache *ic)\n{\n\tstruct jffs2_raw_node_ref *ref;\n\n\tBUG_ON(!jeb->allocated_refs);\n\tjeb->allocated_refs--;\n\n\tref = jeb->last_node;\n\n\tdbg_noderef(\"Last node at %p is (%08x,%p)\\n\", ref, ref->flash_offset,\n\t\t    ref->next_in_ino);\n\n\twhile (ref->flash_offset != REF_EMPTY_NODE) {\n\t\tif (ref->flash_offset == REF_LINK_NODE)\n\t\t\tref = ref->next_in_ino;\n\t\telse\n\t\t\tref++;\n\t}\n\n\tdbg_noderef(\"New ref is %p (%08x becomes %08x,%p) len 0x%x\\n\", ref, \n\t\t    ref->flash_offset, ofs, ref->next_in_ino, len);\n\n\tref->flash_offset = ofs;\n\n\tif (!jeb->first_node) {\n\t\tjeb->first_node = ref;\n\t\tBUG_ON(ref_offset(ref) != jeb->offset);\n\t} else if (unlikely(ref_offset(ref) != jeb->offset + c->sector_size - jeb->free_size)) {\n\t\tuint32_t last_len = ref_totlen(c, jeb, jeb->last_node);\n\n\t\tJFFS2_ERROR(\"Adding new ref %p at (0x%08x-0x%08x) not immediately after previous (0x%08x-0x%08x)\\n\",\n\t\t\t    ref, ref_offset(ref), ref_offset(ref)+len,\n\t\t\t    ref_offset(jeb->last_node), \n\t\t\t    ref_offset(jeb->last_node)+last_len);\n\t\tBUG();\n\t}\n\tjeb->last_node = ref;\n\n\tif (ic) {\n\t\tref->next_in_ino = ic->nodes;\n\t\tic->nodes = ref;\n\t} else {\n\t\tref->next_in_ino = NULL;\n\t}\n\n\tswitch(ref_flags(ref)) {\n\tcase REF_UNCHECKED:\n\t\tc->unchecked_size += len;\n\t\tjeb->unchecked_size += len;\n\t\tbreak;\n\n\tcase REF_NORMAL:\n\tcase REF_PRISTINE:\n\t\tc->used_size += len;\n\t\tjeb->used_size += len;\n\t\tbreak;\n\n\tcase REF_OBSOLETE:\n\t\tc->dirty_size += len;\n\t\tjeb->dirty_size += len;\n\t\tbreak;\n\t}\n\tc->free_size -= len;\n\tjeb->free_size -= len;\n\n#ifdef TEST_TOTLEN\n\t/* Set (and test) __totlen field... for now */\n\tref->__totlen = len;\n\tref_totlen(c, jeb, ref);\n#endif\n\treturn ref;\n}"
        }
      },
      {
        "call_info": {
          "callee": "ffs2_scan_dirty_space(",
          "args": [
            ",",
            "eb,",
            "ofs & ~3) - (c->sector_size - jeb->free_size))"
          ],
          "line": 378
        },
        "resolved": true,
        "details": {
          "function_name": "ffs2_scan_dirty_space(",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/jffs2/nodelist.c",
          "lines": "662-689",
          "snippet": "nt jffs2_scan_dirty_space(struct jffs2_sb_info *c, struct jffs2_eraseblock *jeb,\n\t\t\t   uint32_t size)\n{\n\tif (!size)\n\t\treturn 0;\n\tif (unlikely(size > jeb->free_size)) {\n\t\tpr_crit(\"Dirty space 0x%x larger then free_size 0x%x (wasted 0x%x)\\n\",\n\t\t\tsize, jeb->free_size, jeb->wasted_size);\n\t\tBUG();\n\t}\n\t/* REF_EMPTY_NODE is !obsolete, so that works OK */\n\tif (jeb->last_node && ref_obsolete(jeb->last_node)) {\n#ifdef TEST_TOTLEN\n\t\tjeb->last_node->__totlen += size;\n#endif\n\t\tc->dirty_size += size;\n\t\tc->free_size -= size;\n\t\tjeb->dirty_size += size;\n\t\tjeb->free_size -= size;\n\t} else {\n\t\tuint32_t ofs = jeb->offset + c->sector_size - jeb->free_size;\n\t\tofs |= REF_OBSOLETE;\n\n\t\tjffs2_link_node_ref(c, jeb, ofs, size, NULL);\n\t}\n\n\treturn 0;\n}",
          "includes": [
            "include \"nodelist.h\"",
            "include <linux/pagemap.h>\n#",
            "include <linux/crc32.h>\n#",
            "include <linux/rbtree.h>\n#",
            "include <linux/mtd/mtd.h>\n#",
            "include <linux/fs.h>\n#",
            "include <linux/sched.h>\n#",
            "include <linux/kernel.h>\n#"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "include \"nodelist.h\"\ninclude <linux/pagemap.h>\n#\ninclude <linux/crc32.h>\n#\ninclude <linux/rbtree.h>\n#\ninclude <linux/mtd/mtd.h>\n#\ninclude <linux/fs.h>\n#\ninclude <linux/sched.h>\n#\ninclude <linux/kernel.h>\n#\n\nnt jffs2_scan_dirty_space(struct jffs2_sb_info *c, struct jffs2_eraseblock *jeb,\n\t\t\t   uint32_t size)\n{\n\tif (!size)\n\t\treturn 0;\n\tif (unlikely(size > jeb->free_size)) {\n\t\tpr_crit(\"Dirty space 0x%x larger then free_size 0x%x (wasted 0x%x)\\n\",\n\t\t\tsize, jeb->free_size, jeb->wasted_size);\n\t\tBUG();\n\t}\n\t/* REF_EMPTY_NODE is !obsolete, so that works OK */\n\tif (jeb->last_node && ref_obsolete(jeb->last_node)) {\n#ifdef TEST_TOTLEN\n\t\tjeb->last_node->__totlen += size;\n#endif\n\t\tc->dirty_size += size;\n\t\tc->free_size -= size;\n\t\tjeb->dirty_size += size;\n\t\tjeb->free_size -= size;\n\t} else {\n\t\tuint32_t ofs = jeb->offset + c->sector_size - jeb->free_size;\n\t\tofs |= REF_OBSOLETE;\n\n\t\tjffs2_link_node_ref(c, jeb, ofs, size, NULL);\n\t}\n\n\treturn 0;\n}"
        }
      }
    ],
    "contextual_snippet": "include \"debug.h\"\ninclude \"nodelist.h\"\n#\ninclude <linux/vmalloc.h>\n#\ninclude <linux/compiler.h>\n#\ninclude <linux/crc32.h>\n#\ninclude <linux/pagemap.h>\n#\ninclude <linux/mtd/mtd.h>\n#\ninclude <linux/slab.h>\n#\ninclude <linux/kernel.h>\n#\n\ntatic struct jffs2_raw_node_ref *sum_link_node_ref(struct jffs2_sb_info *c,\n\t\t\t\t\t\t    struct jffs2_eraseblock *jeb,\n\t\t\t\t\t\t    uint32_t ofs, uint32_t len,\n\t\t\t\t\t\t    struct jffs2_inode_cache *ic)\n{\n\t/* If there was a gap, mark it dirty */\n\tif ((ofs & ~3) > c->sector_size - jeb->free_size) {\n\t\t/* Ew. Summary doesn't actually tell us explicitly about dirty space */\n\t\tjffs2_scan_dirty_space(c, jeb, (ofs & ~3) - (c->sector_size - jeb->free_size));\n\t}\n\n\treturn jffs2_link_node_ref(c, jeb, jeb->offset + ofs, len, ic);\n}"
  },
  {
    "function_name": "ffs2_sum_add_kvec(",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/jffs2/summary.c",
    "lines": "248-368",
    "snippet": "nt jffs2_sum_add_kvec(struct jffs2_sb_info *c, const struct kvec *invecs,\n\t\t\t\tunsigned long count, uint32_t ofs)\n{\n\tunion jffs2_node_union *node;\n\tstruct jffs2_eraseblock *jeb;\n\n\tif (c->summary->sum_size == JFFS2_SUMMARY_NOSUM_SIZE) {\n\t\tdbg_summary(\"Summary is disabled for this jeb! Skipping summary info!\\n\");\n\t\treturn 0;\n\t}\n\n\tnode = invecs[0].iov_base;\n\tjeb = &c->blocks[ofs / c->sector_size];\n\tofs -= jeb->offset;\n\n\tswitch (je16_to_cpu(node->u.nodetype)) {\n\t\tcase JFFS2_NODETYPE_INODE: {\n\t\t\tstruct jffs2_sum_inode_mem *temp =\n\t\t\t\tkmalloc(sizeof(struct jffs2_sum_inode_mem), GFP_KERNEL);\n\n\t\t\tif (!temp)\n\t\t\t\tgoto no_mem;\n\n\t\t\ttemp->nodetype = node->i.nodetype;\n\t\t\ttemp->inode = node->i.ino;\n\t\t\ttemp->version = node->i.version;\n\t\t\ttemp->offset = cpu_to_je32(ofs);\n\t\t\ttemp->totlen = node->i.totlen;\n\t\t\ttemp->next = NULL;\n\n\t\t\treturn jffs2_sum_add_mem(c->summary, (union jffs2_sum_mem *)temp);\n\t\t}\n\n\t\tcase JFFS2_NODETYPE_DIRENT: {\n\t\t\tstruct jffs2_sum_dirent_mem *temp =\n\t\t\t\tkmalloc(sizeof(struct jffs2_sum_dirent_mem) + node->d.nsize, GFP_KERNEL);\n\n\t\t\tif (!temp)\n\t\t\t\tgoto no_mem;\n\n\t\t\ttemp->nodetype = node->d.nodetype;\n\t\t\ttemp->totlen = node->d.totlen;\n\t\t\ttemp->offset = cpu_to_je32(ofs);\n\t\t\ttemp->pino = node->d.pino;\n\t\t\ttemp->version = node->d.version;\n\t\t\ttemp->ino = node->d.ino;\n\t\t\ttemp->nsize = node->d.nsize;\n\t\t\ttemp->type = node->d.type;\n\t\t\ttemp->next = NULL;\n\n\t\t\tswitch (count) {\n\t\t\t\tcase 1:\n\t\t\t\t\tmemcpy(temp->name,node->d.name,node->d.nsize);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 2:\n\t\t\t\t\tmemcpy(temp->name,invecs[1].iov_base,node->d.nsize);\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\t\t\t\t\tBUG();\t/* impossible count value */\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\treturn jffs2_sum_add_mem(c->summary, (union jffs2_sum_mem *)temp);\n\t\t}\n#ifdef CONFIG_JFFS2_FS_XATTR\n\t\tcase JFFS2_NODETYPE_XATTR: {\n\t\t\tstruct jffs2_sum_xattr_mem *temp;\n\t\t\ttemp = kmalloc(sizeof(struct jffs2_sum_xattr_mem), GFP_KERNEL);\n\t\t\tif (!temp)\n\t\t\t\tgoto no_mem;\n\n\t\t\ttemp->nodetype = node->x.nodetype;\n\t\t\ttemp->xid = node->x.xid;\n\t\t\ttemp->version = node->x.version;\n\t\t\ttemp->totlen = node->x.totlen;\n\t\t\ttemp->offset = cpu_to_je32(ofs);\n\t\t\ttemp->next = NULL;\n\n\t\t\treturn jffs2_sum_add_mem(c->summary, (union jffs2_sum_mem *)temp);\n\t\t}\n\t\tcase JFFS2_NODETYPE_XREF: {\n\t\t\tstruct jffs2_sum_xref_mem *temp;\n\t\t\ttemp = kmalloc(sizeof(struct jffs2_sum_xref_mem), GFP_KERNEL);\n\t\t\tif (!temp)\n\t\t\t\tgoto no_mem;\n\t\t\ttemp->nodetype = node->r.nodetype;\n\t\t\ttemp->offset = cpu_to_je32(ofs);\n\t\t\ttemp->next = NULL;\n\n\t\t\treturn jffs2_sum_add_mem(c->summary, (union jffs2_sum_mem *)temp);\n\t\t}\n#endif\n\t\tcase JFFS2_NODETYPE_PADDING:\n\t\t\tdbg_summary(\"node PADDING\\n\");\n\t\t\tc->summary->sum_padded += je32_to_cpu(node->u.totlen);\n\t\t\tbreak;\n\n\t\tcase JFFS2_NODETYPE_CLEANMARKER:\n\t\t\tdbg_summary(\"node CLEANMARKER\\n\");\n\t\t\tbreak;\n\n\t\tcase JFFS2_NODETYPE_SUMMARY:\n\t\t\tdbg_summary(\"node SUMMARY\\n\");\n\t\t\tbreak;\n\n\t\tdefault:\n\t\t\t/* If you implement a new node type you should also implement\n\t\t\t   summary support for it or disable summary.\n\t\t\t*/\n\t\t\tBUG();\n\t\t\tbreak;\n\t}\n\n\treturn 0;\n\nno_mem:\n\tJFFS2_WARNING(\"MEMORY ALLOCATION ERROR!\");\n\treturn -ENOMEM;\n}",
    "includes": [
      "include \"debug.h\"",
      "include \"nodelist.h\"\n#",
      "include <linux/vmalloc.h>\n#",
      "include <linux/compiler.h>\n#",
      "include <linux/crc32.h>\n#",
      "include <linux/pagemap.h>\n#",
      "include <linux/mtd/mtd.h>\n#",
      "include <linux/slab.h>\n#",
      "include <linux/kernel.h>\n#"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "FFS2_WARNING(",
          "args": [
            "MEMORY ALLOCATION ERROR!\")"
          ],
          "line": 366
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "UG(",
          "args": [],
          "line": 359
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bg_summary(",
          "args": [
            "node SUMMARY\\n\")"
          ],
          "line": 352
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bg_summary(",
          "args": [
            "node CLEANMARKER\\n\")"
          ],
          "line": 348
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "e32_to_cpu(",
          "args": [
            "ode->u.totlen)"
          ],
          "line": 344
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bg_summary(",
          "args": [
            "node PADDING\\n\")"
          ],
          "line": 343
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ffs2_sum_add_mem(",
          "args": [
            "->summary,",
            "union jffs2_sum_mem *)temp)"
          ],
          "line": 339
        },
        "resolved": true,
        "details": {
          "function_name": "ffs2_sum_add_mem(",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/jffs2/summary.c",
          "lines": "63-103",
          "snippet": "tatic int jffs2_sum_add_mem(struct jffs2_summary *s, union jffs2_sum_mem *item)\n{\n\tif (!s->sum_list_head)\n\t\ts->sum_list_head = (union jffs2_sum_mem *) item;\n\tif (s->sum_list_tail)\n\t\ts->sum_list_tail->u.next = (union jffs2_sum_mem *) item;\n\ts->sum_list_tail = (union jffs2_sum_mem *) item;\n\n\tswitch (je16_to_cpu(item->u.nodetype)) {\n\t\tcase JFFS2_NODETYPE_INODE:\n\t\t\ts->sum_size += JFFS2_SUMMARY_INODE_SIZE;\n\t\t\ts->sum_num++;\n\t\t\tdbg_summary(\"inode (%u) added to summary\\n\",\n\t\t\t\t\t\tje32_to_cpu(item->i.inode));\n\t\t\tbreak;\n\t\tcase JFFS2_NODETYPE_DIRENT:\n\t\t\ts->sum_size += JFFS2_SUMMARY_DIRENT_SIZE(item->d.nsize);\n\t\t\ts->sum_num++;\n\t\t\tdbg_summary(\"dirent (%u) added to summary\\n\",\n\t\t\t\t\t\tje32_to_cpu(item->d.ino));\n\t\t\tbreak;\n#ifdef CONFIG_JFFS2_FS_XATTR\n\t\tcase JFFS2_NODETYPE_XATTR:\n\t\t\ts->sum_size += JFFS2_SUMMARY_XATTR_SIZE;\n\t\t\ts->sum_num++;\n\t\t\tdbg_summary(\"xattr (xid=%u, version=%u) added to summary\\n\",\n\t\t\t\t    je32_to_cpu(item->x.xid), je32_to_cpu(item->x.version));\n\t\t\tbreak;\n\t\tcase JFFS2_NODETYPE_XREF:\n\t\t\ts->sum_size += JFFS2_SUMMARY_XREF_SIZE;\n\t\t\ts->sum_num++;\n\t\t\tdbg_summary(\"xref added to summary\\n\");\n\t\t\tbreak;\n#endif\n\t\tdefault:\n\t\t\tJFFS2_WARNING(\"UNKNOWN node type %u\\n\",\n\t\t\t\t\t    je16_to_cpu(item->u.nodetype));\n\t\t\treturn 1;\n\t}\n\treturn 0;\n}",
          "includes": [
            "include \"debug.h\"",
            "include \"nodelist.h\"\n#",
            "include <linux/vmalloc.h>\n#",
            "include <linux/compiler.h>\n#",
            "include <linux/crc32.h>\n#",
            "include <linux/pagemap.h>\n#",
            "include <linux/mtd/mtd.h>\n#",
            "include <linux/slab.h>\n#",
            "include <linux/kernel.h>\n#"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "include \"debug.h\"\ninclude \"nodelist.h\"\n#\ninclude <linux/vmalloc.h>\n#\ninclude <linux/compiler.h>\n#\ninclude <linux/crc32.h>\n#\ninclude <linux/pagemap.h>\n#\ninclude <linux/mtd/mtd.h>\n#\ninclude <linux/slab.h>\n#\ninclude <linux/kernel.h>\n#\n\ntatic int jffs2_sum_add_mem(struct jffs2_summary *s, union jffs2_sum_mem *item)\n{\n\tif (!s->sum_list_head)\n\t\ts->sum_list_head = (union jffs2_sum_mem *) item;\n\tif (s->sum_list_tail)\n\t\ts->sum_list_tail->u.next = (union jffs2_sum_mem *) item;\n\ts->sum_list_tail = (union jffs2_sum_mem *) item;\n\n\tswitch (je16_to_cpu(item->u.nodetype)) {\n\t\tcase JFFS2_NODETYPE_INODE:\n\t\t\ts->sum_size += JFFS2_SUMMARY_INODE_SIZE;\n\t\t\ts->sum_num++;\n\t\t\tdbg_summary(\"inode (%u) added to summary\\n\",\n\t\t\t\t\t\tje32_to_cpu(item->i.inode));\n\t\t\tbreak;\n\t\tcase JFFS2_NODETYPE_DIRENT:\n\t\t\ts->sum_size += JFFS2_SUMMARY_DIRENT_SIZE(item->d.nsize);\n\t\t\ts->sum_num++;\n\t\t\tdbg_summary(\"dirent (%u) added to summary\\n\",\n\t\t\t\t\t\tje32_to_cpu(item->d.ino));\n\t\t\tbreak;\n#ifdef CONFIG_JFFS2_FS_XATTR\n\t\tcase JFFS2_NODETYPE_XATTR:\n\t\t\ts->sum_size += JFFS2_SUMMARY_XATTR_SIZE;\n\t\t\ts->sum_num++;\n\t\t\tdbg_summary(\"xattr (xid=%u, version=%u) added to summary\\n\",\n\t\t\t\t    je32_to_cpu(item->x.xid), je32_to_cpu(item->x.version));\n\t\t\tbreak;\n\t\tcase JFFS2_NODETYPE_XREF:\n\t\t\ts->sum_size += JFFS2_SUMMARY_XREF_SIZE;\n\t\t\ts->sum_num++;\n\t\t\tdbg_summary(\"xref added to summary\\n\");\n\t\t\tbreak;\n#endif\n\t\tdefault:\n\t\t\tJFFS2_WARNING(\"UNKNOWN node type %u\\n\",\n\t\t\t\t\t    je16_to_cpu(item->u.nodetype));\n\t\t\treturn 1;\n\t}\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "pu_to_je32(",
          "args": [
            "fs)"
          ],
          "line": 336
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "malloc(",
          "args": [
            "izeof(struct jffs2_sum_xref_mem),",
            "FP_KERNEL)"
          ],
          "line": 332
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pu_to_je32(",
          "args": [
            "fs)"
          ],
          "line": 325
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "malloc(",
          "args": [
            "izeof(struct jffs2_sum_xattr_mem),",
            "FP_KERNEL)"
          ],
          "line": 317
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "UG(",
          "args": [],
          "line": 308
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "emcpy(",
          "args": [
            "emp->name,",
            "nvecs[1].iov_base,",
            "ode->d.nsize)"
          ],
          "line": 304
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "emcpy(",
          "args": [
            "emp->name,",
            "ode->d.name,",
            "ode->d.nsize)"
          ],
          "line": 300
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pu_to_je32(",
          "args": [
            "fs)"
          ],
          "line": 290
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "malloc(",
          "args": [
            "izeof(struct jffs2_sum_dirent_mem) + node->d.nsize,",
            "FP_KERNEL)"
          ],
          "line": 283
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pu_to_je32(",
          "args": [
            "fs)"
          ],
          "line": 274
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "malloc(",
          "args": [
            "izeof(struct jffs2_sum_inode_mem),",
            "FP_KERNEL)"
          ],
          "line": 266
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "e16_to_cpu(",
          "args": [
            "ode->u.nodetype)"
          ],
          "line": 263
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bg_summary(",
          "args": [
            "Summary is disabled for this jeb! Skipping summary info!\\n\")"
          ],
          "line": 255
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "include \"debug.h\"\ninclude \"nodelist.h\"\n#\ninclude <linux/vmalloc.h>\n#\ninclude <linux/compiler.h>\n#\ninclude <linux/crc32.h>\n#\ninclude <linux/pagemap.h>\n#\ninclude <linux/mtd/mtd.h>\n#\ninclude <linux/slab.h>\n#\ninclude <linux/kernel.h>\n#\n\nnt jffs2_sum_add_kvec(struct jffs2_sb_info *c, const struct kvec *invecs,\n\t\t\t\tunsigned long count, uint32_t ofs)\n{\n\tunion jffs2_node_union *node;\n\tstruct jffs2_eraseblock *jeb;\n\n\tif (c->summary->sum_size == JFFS2_SUMMARY_NOSUM_SIZE) {\n\t\tdbg_summary(\"Summary is disabled for this jeb! Skipping summary info!\\n\");\n\t\treturn 0;\n\t}\n\n\tnode = invecs[0].iov_base;\n\tjeb = &c->blocks[ofs / c->sector_size];\n\tofs -= jeb->offset;\n\n\tswitch (je16_to_cpu(node->u.nodetype)) {\n\t\tcase JFFS2_NODETYPE_INODE: {\n\t\t\tstruct jffs2_sum_inode_mem *temp =\n\t\t\t\tkmalloc(sizeof(struct jffs2_sum_inode_mem), GFP_KERNEL);\n\n\t\t\tif (!temp)\n\t\t\t\tgoto no_mem;\n\n\t\t\ttemp->nodetype = node->i.nodetype;\n\t\t\ttemp->inode = node->i.ino;\n\t\t\ttemp->version = node->i.version;\n\t\t\ttemp->offset = cpu_to_je32(ofs);\n\t\t\ttemp->totlen = node->i.totlen;\n\t\t\ttemp->next = NULL;\n\n\t\t\treturn jffs2_sum_add_mem(c->summary, (union jffs2_sum_mem *)temp);\n\t\t}\n\n\t\tcase JFFS2_NODETYPE_DIRENT: {\n\t\t\tstruct jffs2_sum_dirent_mem *temp =\n\t\t\t\tkmalloc(sizeof(struct jffs2_sum_dirent_mem) + node->d.nsize, GFP_KERNEL);\n\n\t\t\tif (!temp)\n\t\t\t\tgoto no_mem;\n\n\t\t\ttemp->nodetype = node->d.nodetype;\n\t\t\ttemp->totlen = node->d.totlen;\n\t\t\ttemp->offset = cpu_to_je32(ofs);\n\t\t\ttemp->pino = node->d.pino;\n\t\t\ttemp->version = node->d.version;\n\t\t\ttemp->ino = node->d.ino;\n\t\t\ttemp->nsize = node->d.nsize;\n\t\t\ttemp->type = node->d.type;\n\t\t\ttemp->next = NULL;\n\n\t\t\tswitch (count) {\n\t\t\t\tcase 1:\n\t\t\t\t\tmemcpy(temp->name,node->d.name,node->d.nsize);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 2:\n\t\t\t\t\tmemcpy(temp->name,invecs[1].iov_base,node->d.nsize);\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\t\t\t\t\tBUG();\t/* impossible count value */\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\treturn jffs2_sum_add_mem(c->summary, (union jffs2_sum_mem *)temp);\n\t\t}\n#ifdef CONFIG_JFFS2_FS_XATTR\n\t\tcase JFFS2_NODETYPE_XATTR: {\n\t\t\tstruct jffs2_sum_xattr_mem *temp;\n\t\t\ttemp = kmalloc(sizeof(struct jffs2_sum_xattr_mem), GFP_KERNEL);\n\t\t\tif (!temp)\n\t\t\t\tgoto no_mem;\n\n\t\t\ttemp->nodetype = node->x.nodetype;\n\t\t\ttemp->xid = node->x.xid;\n\t\t\ttemp->version = node->x.version;\n\t\t\ttemp->totlen = node->x.totlen;\n\t\t\ttemp->offset = cpu_to_je32(ofs);\n\t\t\ttemp->next = NULL;\n\n\t\t\treturn jffs2_sum_add_mem(c->summary, (union jffs2_sum_mem *)temp);\n\t\t}\n\t\tcase JFFS2_NODETYPE_XREF: {\n\t\t\tstruct jffs2_sum_xref_mem *temp;\n\t\t\ttemp = kmalloc(sizeof(struct jffs2_sum_xref_mem), GFP_KERNEL);\n\t\t\tif (!temp)\n\t\t\t\tgoto no_mem;\n\t\t\ttemp->nodetype = node->r.nodetype;\n\t\t\ttemp->offset = cpu_to_je32(ofs);\n\t\t\ttemp->next = NULL;\n\n\t\t\treturn jffs2_sum_add_mem(c->summary, (union jffs2_sum_mem *)temp);\n\t\t}\n#endif\n\t\tcase JFFS2_NODETYPE_PADDING:\n\t\t\tdbg_summary(\"node PADDING\\n\");\n\t\t\tc->summary->sum_padded += je32_to_cpu(node->u.totlen);\n\t\t\tbreak;\n\n\t\tcase JFFS2_NODETYPE_CLEANMARKER:\n\t\t\tdbg_summary(\"node CLEANMARKER\\n\");\n\t\t\tbreak;\n\n\t\tcase JFFS2_NODETYPE_SUMMARY:\n\t\t\tdbg_summary(\"node SUMMARY\\n\");\n\t\t\tbreak;\n\n\t\tdefault:\n\t\t\t/* If you implement a new node type you should also implement\n\t\t\t   summary support for it or disable summary.\n\t\t\t*/\n\t\t\tBUG();\n\t\t\tbreak;\n\t}\n\n\treturn 0;\n\nno_mem:\n\tJFFS2_WARNING(\"MEMORY ALLOCATION ERROR!\");\n\treturn -ENOMEM;\n}"
  },
  {
    "function_name": "ffs2_sum_move_collected(",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/jffs2/summary.c",
    "lines": "231-244",
    "snippet": "oid jffs2_sum_move_collected(struct jffs2_sb_info *c, struct jffs2_summary *s)\n{\n\tdbg_summary(\"oldsize=0x%x oldnum=%u => newsize=0x%x newnum=%u\\n\",\n\t\t\t\tc->summary->sum_size, c->summary->sum_num,\n\t\t\t\ts->sum_size, s->sum_num);\n\n\tc->summary->sum_size = s->sum_size;\n\tc->summary->sum_num = s->sum_num;\n\tc->summary->sum_padded = s->sum_padded;\n\tc->summary->sum_list_head = s->sum_list_head;\n\tc->summary->sum_list_tail = s->sum_list_tail;\n\n\ts->sum_list_head = s->sum_list_tail = NULL;\n}",
    "includes": [
      "include \"debug.h\"",
      "include \"nodelist.h\"\n#",
      "include <linux/vmalloc.h>\n#",
      "include <linux/compiler.h>\n#",
      "include <linux/crc32.h>\n#",
      "include <linux/pagemap.h>\n#",
      "include <linux/mtd/mtd.h>\n#",
      "include <linux/slab.h>\n#",
      "include <linux/kernel.h>\n#"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "bg_summary(",
          "args": [
            "oldsize=0x%x oldnum=%u => newsize=0x%x newnum=%u\\n\",",
            "->summary->sum_size,",
            "->summary->sum_num,",
            "->sum_size,",
            "->sum_num)"
          ],
          "line": 233
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "include \"debug.h\"\ninclude \"nodelist.h\"\n#\ninclude <linux/vmalloc.h>\n#\ninclude <linux/compiler.h>\n#\ninclude <linux/crc32.h>\n#\ninclude <linux/pagemap.h>\n#\ninclude <linux/mtd/mtd.h>\n#\ninclude <linux/slab.h>\n#\ninclude <linux/kernel.h>\n#\n\noid jffs2_sum_move_collected(struct jffs2_sb_info *c, struct jffs2_summary *s)\n{\n\tdbg_summary(\"oldsize=0x%x oldnum=%u => newsize=0x%x newnum=%u\\n\",\n\t\t\t\tc->summary->sum_size, c->summary->sum_num,\n\t\t\t\ts->sum_size, s->sum_num);\n\n\tc->summary->sum_size = s->sum_size;\n\tc->summary->sum_num = s->sum_num;\n\tc->summary->sum_padded = s->sum_padded;\n\tc->summary->sum_list_head = s->sum_list_head;\n\tc->summary->sum_list_tail = s->sum_list_tail;\n\n\ts->sum_list_head = s->sum_list_tail = NULL;\n}"
  },
  {
    "function_name": "ffs2_sum_is_disabled(",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/jffs2/summary.c",
    "lines": "224-227",
    "snippet": "nt jffs2_sum_is_disabled(struct jffs2_summary *s)\n{\n\treturn (s->sum_size == JFFS2_SUMMARY_NOSUM_SIZE);\n}",
    "includes": [
      "include \"debug.h\"",
      "include \"nodelist.h\"\n#",
      "include <linux/vmalloc.h>\n#",
      "include <linux/compiler.h>\n#",
      "include <linux/crc32.h>\n#",
      "include <linux/pagemap.h>\n#",
      "include <linux/mtd/mtd.h>\n#",
      "include <linux/slab.h>\n#",
      "include <linux/kernel.h>\n#"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "include \"debug.h\"\ninclude \"nodelist.h\"\n#\ninclude <linux/vmalloc.h>\n#\ninclude <linux/compiler.h>\n#\ninclude <linux/crc32.h>\n#\ninclude <linux/pagemap.h>\n#\ninclude <linux/mtd/mtd.h>\n#\ninclude <linux/slab.h>\n#\ninclude <linux/kernel.h>\n#\n\nnt jffs2_sum_is_disabled(struct jffs2_summary *s)\n{\n\treturn (s->sum_size == JFFS2_SUMMARY_NOSUM_SIZE);\n}"
  },
  {
    "function_name": "ffs2_sum_disable_collecting(",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/jffs2/summary.c",
    "lines": "217-222",
    "snippet": "oid jffs2_sum_disable_collecting(struct jffs2_summary *s)\n{\n\tdbg_summary(\"called\\n\");\n\tjffs2_sum_clean_collected(s);\n\ts->sum_size = JFFS2_SUMMARY_NOSUM_SIZE;\n}",
    "includes": [
      "include \"debug.h\"",
      "include \"nodelist.h\"\n#",
      "include <linux/vmalloc.h>\n#",
      "include <linux/compiler.h>\n#",
      "include <linux/crc32.h>\n#",
      "include <linux/pagemap.h>\n#",
      "include <linux/mtd/mtd.h>\n#",
      "include <linux/slab.h>\n#",
      "include <linux/kernel.h>\n#"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "ffs2_sum_clean_collected(",
          "args": [
            ")"
          ],
          "line": 220
        },
        "resolved": true,
        "details": {
          "function_name": "ffs2_sum_clean_collected(",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/jffs2/summary.c",
          "lines": "193-208",
          "snippet": "tatic void jffs2_sum_clean_collected(struct jffs2_summary *s)\n{\n\tunion jffs2_sum_mem *temp;\n\n\tif (!s->sum_list_head) {\n\t\tdbg_summary(\"already empty\\n\");\n\t}\n\twhile (s->sum_list_head) {\n\t\ttemp = s->sum_list_head;\n\t\ts->sum_list_head = s->sum_list_head->u.next;\n\t\tkfree(temp);\n\t}\n\ts->sum_list_tail = NULL;\n\ts->sum_padded = 0;\n\ts->sum_num = 0;\n}",
          "includes": [
            "include \"debug.h\"",
            "include \"nodelist.h\"\n#",
            "include <linux/vmalloc.h>\n#",
            "include <linux/compiler.h>\n#",
            "include <linux/crc32.h>\n#",
            "include <linux/pagemap.h>\n#",
            "include <linux/mtd/mtd.h>\n#",
            "include <linux/slab.h>\n#",
            "include <linux/kernel.h>\n#"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "include \"debug.h\"\ninclude \"nodelist.h\"\n#\ninclude <linux/vmalloc.h>\n#\ninclude <linux/compiler.h>\n#\ninclude <linux/crc32.h>\n#\ninclude <linux/pagemap.h>\n#\ninclude <linux/mtd/mtd.h>\n#\ninclude <linux/slab.h>\n#\ninclude <linux/kernel.h>\n#\n\ntatic void jffs2_sum_clean_collected(struct jffs2_summary *s)\n{\n\tunion jffs2_sum_mem *temp;\n\n\tif (!s->sum_list_head) {\n\t\tdbg_summary(\"already empty\\n\");\n\t}\n\twhile (s->sum_list_head) {\n\t\ttemp = s->sum_list_head;\n\t\ts->sum_list_head = s->sum_list_head->u.next;\n\t\tkfree(temp);\n\t}\n\ts->sum_list_tail = NULL;\n\ts->sum_padded = 0;\n\ts->sum_num = 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "bg_summary(",
          "args": [
            "called\\n\")"
          ],
          "line": 219
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "include \"debug.h\"\ninclude \"nodelist.h\"\n#\ninclude <linux/vmalloc.h>\n#\ninclude <linux/compiler.h>\n#\ninclude <linux/crc32.h>\n#\ninclude <linux/pagemap.h>\n#\ninclude <linux/mtd/mtd.h>\n#\ninclude <linux/slab.h>\n#\ninclude <linux/kernel.h>\n#\n\noid jffs2_sum_disable_collecting(struct jffs2_summary *s)\n{\n\tdbg_summary(\"called\\n\");\n\tjffs2_sum_clean_collected(s);\n\ts->sum_size = JFFS2_SUMMARY_NOSUM_SIZE;\n}"
  },
  {
    "function_name": "ffs2_sum_reset_collected(",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/jffs2/summary.c",
    "lines": "210-215",
    "snippet": "oid jffs2_sum_reset_collected(struct jffs2_summary *s)\n{\n\tdbg_summary(\"called\\n\");\n\tjffs2_sum_clean_collected(s);\n\ts->sum_size = 0;\n}",
    "includes": [
      "include \"debug.h\"",
      "include \"nodelist.h\"\n#",
      "include <linux/vmalloc.h>\n#",
      "include <linux/compiler.h>\n#",
      "include <linux/crc32.h>\n#",
      "include <linux/pagemap.h>\n#",
      "include <linux/mtd/mtd.h>\n#",
      "include <linux/slab.h>\n#",
      "include <linux/kernel.h>\n#"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "ffs2_sum_clean_collected(",
          "args": [
            ")"
          ],
          "line": 213
        },
        "resolved": true,
        "details": {
          "function_name": "ffs2_sum_clean_collected(",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/jffs2/summary.c",
          "lines": "193-208",
          "snippet": "tatic void jffs2_sum_clean_collected(struct jffs2_summary *s)\n{\n\tunion jffs2_sum_mem *temp;\n\n\tif (!s->sum_list_head) {\n\t\tdbg_summary(\"already empty\\n\");\n\t}\n\twhile (s->sum_list_head) {\n\t\ttemp = s->sum_list_head;\n\t\ts->sum_list_head = s->sum_list_head->u.next;\n\t\tkfree(temp);\n\t}\n\ts->sum_list_tail = NULL;\n\ts->sum_padded = 0;\n\ts->sum_num = 0;\n}",
          "includes": [
            "include \"debug.h\"",
            "include \"nodelist.h\"\n#",
            "include <linux/vmalloc.h>\n#",
            "include <linux/compiler.h>\n#",
            "include <linux/crc32.h>\n#",
            "include <linux/pagemap.h>\n#",
            "include <linux/mtd/mtd.h>\n#",
            "include <linux/slab.h>\n#",
            "include <linux/kernel.h>\n#"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "include \"debug.h\"\ninclude \"nodelist.h\"\n#\ninclude <linux/vmalloc.h>\n#\ninclude <linux/compiler.h>\n#\ninclude <linux/crc32.h>\n#\ninclude <linux/pagemap.h>\n#\ninclude <linux/mtd/mtd.h>\n#\ninclude <linux/slab.h>\n#\ninclude <linux/kernel.h>\n#\n\ntatic void jffs2_sum_clean_collected(struct jffs2_summary *s)\n{\n\tunion jffs2_sum_mem *temp;\n\n\tif (!s->sum_list_head) {\n\t\tdbg_summary(\"already empty\\n\");\n\t}\n\twhile (s->sum_list_head) {\n\t\ttemp = s->sum_list_head;\n\t\ts->sum_list_head = s->sum_list_head->u.next;\n\t\tkfree(temp);\n\t}\n\ts->sum_list_tail = NULL;\n\ts->sum_padded = 0;\n\ts->sum_num = 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "bg_summary(",
          "args": [
            "called\\n\")"
          ],
          "line": 212
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "include \"debug.h\"\ninclude \"nodelist.h\"\n#\ninclude <linux/vmalloc.h>\n#\ninclude <linux/compiler.h>\n#\ninclude <linux/crc32.h>\n#\ninclude <linux/pagemap.h>\n#\ninclude <linux/mtd/mtd.h>\n#\ninclude <linux/slab.h>\n#\ninclude <linux/kernel.h>\n#\n\noid jffs2_sum_reset_collected(struct jffs2_summary *s)\n{\n\tdbg_summary(\"called\\n\");\n\tjffs2_sum_clean_collected(s);\n\ts->sum_size = 0;\n}"
  },
  {
    "function_name": "ffs2_sum_clean_collected(",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/jffs2/summary.c",
    "lines": "193-208",
    "snippet": "tatic void jffs2_sum_clean_collected(struct jffs2_summary *s)\n{\n\tunion jffs2_sum_mem *temp;\n\n\tif (!s->sum_list_head) {\n\t\tdbg_summary(\"already empty\\n\");\n\t}\n\twhile (s->sum_list_head) {\n\t\ttemp = s->sum_list_head;\n\t\ts->sum_list_head = s->sum_list_head->u.next;\n\t\tkfree(temp);\n\t}\n\ts->sum_list_tail = NULL;\n\ts->sum_padded = 0;\n\ts->sum_num = 0;\n}",
    "includes": [
      "include \"debug.h\"",
      "include \"nodelist.h\"\n#",
      "include <linux/vmalloc.h>\n#",
      "include <linux/compiler.h>\n#",
      "include <linux/crc32.h>\n#",
      "include <linux/pagemap.h>\n#",
      "include <linux/mtd/mtd.h>\n#",
      "include <linux/slab.h>\n#",
      "include <linux/kernel.h>\n#"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free(",
          "args": [
            "emp)"
          ],
          "line": 203
        },
        "resolved": true,
        "details": {
          "function_name": "in_free(",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/jffs2/scan.c",
          "lines": "51-60",
          "snippet": "tatic inline int min_free(struct jffs2_sb_info *c)\n{\n\tuint32_t min = 2 * sizeof(struct jffs2_raw_inode);\n#ifdef CONFIG_JFFS2_FS_WRITEBUFFER\n\tif (!jffs2_can_mark_obsolete(c) && min < c->wbuf_pagesize)\n\t\treturn c->wbuf_pagesize;\n#endif\n\treturn min;\n\n}",
          "includes": [
            "include \"debug.h\"",
            "include \"summary.h\"\n#",
            "include \"nodelist.h\"\n#",
            "include <linux/compiler.h>\n#",
            "include <linux/crc32.h>\n#",
            "include <linux/pagemap.h>\n#",
            "include <linux/mtd/mtd.h>\n#",
            "include <linux/slab.h>\n#",
            "include <linux/sched.h>\n#",
            "include <linux/kernel.h>\n#"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "include \"debug.h\"\ninclude \"summary.h\"\n#\ninclude \"nodelist.h\"\n#\ninclude <linux/compiler.h>\n#\ninclude <linux/crc32.h>\n#\ninclude <linux/pagemap.h>\n#\ninclude <linux/mtd/mtd.h>\n#\ninclude <linux/slab.h>\n#\ninclude <linux/sched.h>\n#\ninclude <linux/kernel.h>\n#\n\ntatic inline int min_free(struct jffs2_sb_info *c)\n{\n\tuint32_t min = 2 * sizeof(struct jffs2_raw_inode);\n#ifdef CONFIG_JFFS2_FS_WRITEBUFFER\n\tif (!jffs2_can_mark_obsolete(c) && min < c->wbuf_pagesize)\n\t\treturn c->wbuf_pagesize;\n#endif\n\treturn min;\n\n}"
        }
      },
      {
        "call_info": {
          "callee": "bg_summary(",
          "args": [
            "already empty\\n\")"
          ],
          "line": 198
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "include \"debug.h\"\ninclude \"nodelist.h\"\n#\ninclude <linux/vmalloc.h>\n#\ninclude <linux/compiler.h>\n#\ninclude <linux/crc32.h>\n#\ninclude <linux/pagemap.h>\n#\ninclude <linux/mtd/mtd.h>\n#\ninclude <linux/slab.h>\n#\ninclude <linux/kernel.h>\n#\n\ntatic void jffs2_sum_clean_collected(struct jffs2_summary *s)\n{\n\tunion jffs2_sum_mem *temp;\n\n\tif (!s->sum_list_head) {\n\t\tdbg_summary(\"already empty\\n\");\n\t}\n\twhile (s->sum_list_head) {\n\t\ttemp = s->sum_list_head;\n\t\ts->sum_list_head = s->sum_list_head->u.next;\n\t\tkfree(temp);\n\t}\n\ts->sum_list_tail = NULL;\n\ts->sum_padded = 0;\n\ts->sum_num = 0;\n}"
  },
  {
    "function_name": "ffs2_sum_add_xref_mem(",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/jffs2/summary.c",
    "lines": "176-189",
    "snippet": "nt jffs2_sum_add_xref_mem(struct jffs2_summary *s, struct jffs2_raw_xref *rr, uint32_t ofs)\n{\n\tstruct jffs2_sum_xref_mem *temp;\n\n\ttemp = kmalloc(sizeof(struct jffs2_sum_xref_mem), GFP_KERNEL);\n\tif (!temp)\n\t\treturn -ENOMEM;\n\n\ttemp->nodetype = rr->nodetype;\n\ttemp->offset = cpu_to_je32(ofs);\n\ttemp->next = NULL;\n\n\treturn jffs2_sum_add_mem(s, (union jffs2_sum_mem *)temp);\n}",
    "includes": [
      "include \"debug.h\"",
      "include \"nodelist.h\"\n#",
      "include <linux/vmalloc.h>\n#",
      "include <linux/compiler.h>\n#",
      "include <linux/crc32.h>\n#",
      "include <linux/pagemap.h>\n#",
      "include <linux/mtd/mtd.h>\n#",
      "include <linux/slab.h>\n#",
      "include <linux/kernel.h>\n#"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "ffs2_sum_add_mem(",
          "args": [
            ",",
            "union jffs2_sum_mem *)temp)"
          ],
          "line": 188
        },
        "resolved": true,
        "details": {
          "function_name": "ffs2_sum_add_mem(",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/jffs2/summary.c",
          "lines": "63-103",
          "snippet": "tatic int jffs2_sum_add_mem(struct jffs2_summary *s, union jffs2_sum_mem *item)\n{\n\tif (!s->sum_list_head)\n\t\ts->sum_list_head = (union jffs2_sum_mem *) item;\n\tif (s->sum_list_tail)\n\t\ts->sum_list_tail->u.next = (union jffs2_sum_mem *) item;\n\ts->sum_list_tail = (union jffs2_sum_mem *) item;\n\n\tswitch (je16_to_cpu(item->u.nodetype)) {\n\t\tcase JFFS2_NODETYPE_INODE:\n\t\t\ts->sum_size += JFFS2_SUMMARY_INODE_SIZE;\n\t\t\ts->sum_num++;\n\t\t\tdbg_summary(\"inode (%u) added to summary\\n\",\n\t\t\t\t\t\tje32_to_cpu(item->i.inode));\n\t\t\tbreak;\n\t\tcase JFFS2_NODETYPE_DIRENT:\n\t\t\ts->sum_size += JFFS2_SUMMARY_DIRENT_SIZE(item->d.nsize);\n\t\t\ts->sum_num++;\n\t\t\tdbg_summary(\"dirent (%u) added to summary\\n\",\n\t\t\t\t\t\tje32_to_cpu(item->d.ino));\n\t\t\tbreak;\n#ifdef CONFIG_JFFS2_FS_XATTR\n\t\tcase JFFS2_NODETYPE_XATTR:\n\t\t\ts->sum_size += JFFS2_SUMMARY_XATTR_SIZE;\n\t\t\ts->sum_num++;\n\t\t\tdbg_summary(\"xattr (xid=%u, version=%u) added to summary\\n\",\n\t\t\t\t    je32_to_cpu(item->x.xid), je32_to_cpu(item->x.version));\n\t\t\tbreak;\n\t\tcase JFFS2_NODETYPE_XREF:\n\t\t\ts->sum_size += JFFS2_SUMMARY_XREF_SIZE;\n\t\t\ts->sum_num++;\n\t\t\tdbg_summary(\"xref added to summary\\n\");\n\t\t\tbreak;\n#endif\n\t\tdefault:\n\t\t\tJFFS2_WARNING(\"UNKNOWN node type %u\\n\",\n\t\t\t\t\t    je16_to_cpu(item->u.nodetype));\n\t\t\treturn 1;\n\t}\n\treturn 0;\n}",
          "includes": [
            "include \"debug.h\"",
            "include \"nodelist.h\"\n#",
            "include <linux/vmalloc.h>\n#",
            "include <linux/compiler.h>\n#",
            "include <linux/crc32.h>\n#",
            "include <linux/pagemap.h>\n#",
            "include <linux/mtd/mtd.h>\n#",
            "include <linux/slab.h>\n#",
            "include <linux/kernel.h>\n#"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "include \"debug.h\"\ninclude \"nodelist.h\"\n#\ninclude <linux/vmalloc.h>\n#\ninclude <linux/compiler.h>\n#\ninclude <linux/crc32.h>\n#\ninclude <linux/pagemap.h>\n#\ninclude <linux/mtd/mtd.h>\n#\ninclude <linux/slab.h>\n#\ninclude <linux/kernel.h>\n#\n\ntatic int jffs2_sum_add_mem(struct jffs2_summary *s, union jffs2_sum_mem *item)\n{\n\tif (!s->sum_list_head)\n\t\ts->sum_list_head = (union jffs2_sum_mem *) item;\n\tif (s->sum_list_tail)\n\t\ts->sum_list_tail->u.next = (union jffs2_sum_mem *) item;\n\ts->sum_list_tail = (union jffs2_sum_mem *) item;\n\n\tswitch (je16_to_cpu(item->u.nodetype)) {\n\t\tcase JFFS2_NODETYPE_INODE:\n\t\t\ts->sum_size += JFFS2_SUMMARY_INODE_SIZE;\n\t\t\ts->sum_num++;\n\t\t\tdbg_summary(\"inode (%u) added to summary\\n\",\n\t\t\t\t\t\tje32_to_cpu(item->i.inode));\n\t\t\tbreak;\n\t\tcase JFFS2_NODETYPE_DIRENT:\n\t\t\ts->sum_size += JFFS2_SUMMARY_DIRENT_SIZE(item->d.nsize);\n\t\t\ts->sum_num++;\n\t\t\tdbg_summary(\"dirent (%u) added to summary\\n\",\n\t\t\t\t\t\tje32_to_cpu(item->d.ino));\n\t\t\tbreak;\n#ifdef CONFIG_JFFS2_FS_XATTR\n\t\tcase JFFS2_NODETYPE_XATTR:\n\t\t\ts->sum_size += JFFS2_SUMMARY_XATTR_SIZE;\n\t\t\ts->sum_num++;\n\t\t\tdbg_summary(\"xattr (xid=%u, version=%u) added to summary\\n\",\n\t\t\t\t    je32_to_cpu(item->x.xid), je32_to_cpu(item->x.version));\n\t\t\tbreak;\n\t\tcase JFFS2_NODETYPE_XREF:\n\t\t\ts->sum_size += JFFS2_SUMMARY_XREF_SIZE;\n\t\t\ts->sum_num++;\n\t\t\tdbg_summary(\"xref added to summary\\n\");\n\t\t\tbreak;\n#endif\n\t\tdefault:\n\t\t\tJFFS2_WARNING(\"UNKNOWN node type %u\\n\",\n\t\t\t\t\t    je16_to_cpu(item->u.nodetype));\n\t\t\treturn 1;\n\t}\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "pu_to_je32(",
          "args": [
            "fs)"
          ],
          "line": 185
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "malloc(",
          "args": [
            "izeof(struct jffs2_sum_xref_mem),",
            "FP_KERNEL)"
          ],
          "line": 180
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "include \"debug.h\"\ninclude \"nodelist.h\"\n#\ninclude <linux/vmalloc.h>\n#\ninclude <linux/compiler.h>\n#\ninclude <linux/crc32.h>\n#\ninclude <linux/pagemap.h>\n#\ninclude <linux/mtd/mtd.h>\n#\ninclude <linux/slab.h>\n#\ninclude <linux/kernel.h>\n#\n\nnt jffs2_sum_add_xref_mem(struct jffs2_summary *s, struct jffs2_raw_xref *rr, uint32_t ofs)\n{\n\tstruct jffs2_sum_xref_mem *temp;\n\n\ttemp = kmalloc(sizeof(struct jffs2_sum_xref_mem), GFP_KERNEL);\n\tif (!temp)\n\t\treturn -ENOMEM;\n\n\ttemp->nodetype = rr->nodetype;\n\ttemp->offset = cpu_to_je32(ofs);\n\ttemp->next = NULL;\n\n\treturn jffs2_sum_add_mem(s, (union jffs2_sum_mem *)temp);\n}"
  },
  {
    "function_name": "ffs2_sum_add_xattr_mem(",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/jffs2/summary.c",
    "lines": "158-174",
    "snippet": "nt jffs2_sum_add_xattr_mem(struct jffs2_summary *s, struct jffs2_raw_xattr *rx, uint32_t ofs)\n{\n\tstruct jffs2_sum_xattr_mem *temp;\n\n\ttemp = kmalloc(sizeof(struct jffs2_sum_xattr_mem), GFP_KERNEL);\n\tif (!temp)\n\t\treturn -ENOMEM;\n\n\ttemp->nodetype = rx->nodetype;\n\ttemp->xid = rx->xid;\n\ttemp->version = rx->version;\n\ttemp->offset = cpu_to_je32(ofs);\n\ttemp->totlen = rx->totlen;\n\ttemp->next = NULL;\n\n\treturn jffs2_sum_add_mem(s, (union jffs2_sum_mem *)temp);\n}",
    "includes": [
      "include \"debug.h\"",
      "include \"nodelist.h\"\n#",
      "include <linux/vmalloc.h>\n#",
      "include <linux/compiler.h>\n#",
      "include <linux/crc32.h>\n#",
      "include <linux/pagemap.h>\n#",
      "include <linux/mtd/mtd.h>\n#",
      "include <linux/slab.h>\n#",
      "include <linux/kernel.h>\n#"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "ffs2_sum_add_mem(",
          "args": [
            ",",
            "union jffs2_sum_mem *)temp)"
          ],
          "line": 173
        },
        "resolved": true,
        "details": {
          "function_name": "ffs2_sum_add_mem(",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/jffs2/summary.c",
          "lines": "63-103",
          "snippet": "tatic int jffs2_sum_add_mem(struct jffs2_summary *s, union jffs2_sum_mem *item)\n{\n\tif (!s->sum_list_head)\n\t\ts->sum_list_head = (union jffs2_sum_mem *) item;\n\tif (s->sum_list_tail)\n\t\ts->sum_list_tail->u.next = (union jffs2_sum_mem *) item;\n\ts->sum_list_tail = (union jffs2_sum_mem *) item;\n\n\tswitch (je16_to_cpu(item->u.nodetype)) {\n\t\tcase JFFS2_NODETYPE_INODE:\n\t\t\ts->sum_size += JFFS2_SUMMARY_INODE_SIZE;\n\t\t\ts->sum_num++;\n\t\t\tdbg_summary(\"inode (%u) added to summary\\n\",\n\t\t\t\t\t\tje32_to_cpu(item->i.inode));\n\t\t\tbreak;\n\t\tcase JFFS2_NODETYPE_DIRENT:\n\t\t\ts->sum_size += JFFS2_SUMMARY_DIRENT_SIZE(item->d.nsize);\n\t\t\ts->sum_num++;\n\t\t\tdbg_summary(\"dirent (%u) added to summary\\n\",\n\t\t\t\t\t\tje32_to_cpu(item->d.ino));\n\t\t\tbreak;\n#ifdef CONFIG_JFFS2_FS_XATTR\n\t\tcase JFFS2_NODETYPE_XATTR:\n\t\t\ts->sum_size += JFFS2_SUMMARY_XATTR_SIZE;\n\t\t\ts->sum_num++;\n\t\t\tdbg_summary(\"xattr (xid=%u, version=%u) added to summary\\n\",\n\t\t\t\t    je32_to_cpu(item->x.xid), je32_to_cpu(item->x.version));\n\t\t\tbreak;\n\t\tcase JFFS2_NODETYPE_XREF:\n\t\t\ts->sum_size += JFFS2_SUMMARY_XREF_SIZE;\n\t\t\ts->sum_num++;\n\t\t\tdbg_summary(\"xref added to summary\\n\");\n\t\t\tbreak;\n#endif\n\t\tdefault:\n\t\t\tJFFS2_WARNING(\"UNKNOWN node type %u\\n\",\n\t\t\t\t\t    je16_to_cpu(item->u.nodetype));\n\t\t\treturn 1;\n\t}\n\treturn 0;\n}",
          "includes": [
            "include \"debug.h\"",
            "include \"nodelist.h\"\n#",
            "include <linux/vmalloc.h>\n#",
            "include <linux/compiler.h>\n#",
            "include <linux/crc32.h>\n#",
            "include <linux/pagemap.h>\n#",
            "include <linux/mtd/mtd.h>\n#",
            "include <linux/slab.h>\n#",
            "include <linux/kernel.h>\n#"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "include \"debug.h\"\ninclude \"nodelist.h\"\n#\ninclude <linux/vmalloc.h>\n#\ninclude <linux/compiler.h>\n#\ninclude <linux/crc32.h>\n#\ninclude <linux/pagemap.h>\n#\ninclude <linux/mtd/mtd.h>\n#\ninclude <linux/slab.h>\n#\ninclude <linux/kernel.h>\n#\n\ntatic int jffs2_sum_add_mem(struct jffs2_summary *s, union jffs2_sum_mem *item)\n{\n\tif (!s->sum_list_head)\n\t\ts->sum_list_head = (union jffs2_sum_mem *) item;\n\tif (s->sum_list_tail)\n\t\ts->sum_list_tail->u.next = (union jffs2_sum_mem *) item;\n\ts->sum_list_tail = (union jffs2_sum_mem *) item;\n\n\tswitch (je16_to_cpu(item->u.nodetype)) {\n\t\tcase JFFS2_NODETYPE_INODE:\n\t\t\ts->sum_size += JFFS2_SUMMARY_INODE_SIZE;\n\t\t\ts->sum_num++;\n\t\t\tdbg_summary(\"inode (%u) added to summary\\n\",\n\t\t\t\t\t\tje32_to_cpu(item->i.inode));\n\t\t\tbreak;\n\t\tcase JFFS2_NODETYPE_DIRENT:\n\t\t\ts->sum_size += JFFS2_SUMMARY_DIRENT_SIZE(item->d.nsize);\n\t\t\ts->sum_num++;\n\t\t\tdbg_summary(\"dirent (%u) added to summary\\n\",\n\t\t\t\t\t\tje32_to_cpu(item->d.ino));\n\t\t\tbreak;\n#ifdef CONFIG_JFFS2_FS_XATTR\n\t\tcase JFFS2_NODETYPE_XATTR:\n\t\t\ts->sum_size += JFFS2_SUMMARY_XATTR_SIZE;\n\t\t\ts->sum_num++;\n\t\t\tdbg_summary(\"xattr (xid=%u, version=%u) added to summary\\n\",\n\t\t\t\t    je32_to_cpu(item->x.xid), je32_to_cpu(item->x.version));\n\t\t\tbreak;\n\t\tcase JFFS2_NODETYPE_XREF:\n\t\t\ts->sum_size += JFFS2_SUMMARY_XREF_SIZE;\n\t\t\ts->sum_num++;\n\t\t\tdbg_summary(\"xref added to summary\\n\");\n\t\t\tbreak;\n#endif\n\t\tdefault:\n\t\t\tJFFS2_WARNING(\"UNKNOWN node type %u\\n\",\n\t\t\t\t\t    je16_to_cpu(item->u.nodetype));\n\t\t\treturn 1;\n\t}\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "pu_to_je32(",
          "args": [
            "fs)"
          ],
          "line": 169
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "malloc(",
          "args": [
            "izeof(struct jffs2_sum_xattr_mem),",
            "FP_KERNEL)"
          ],
          "line": 162
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "include \"debug.h\"\ninclude \"nodelist.h\"\n#\ninclude <linux/vmalloc.h>\n#\ninclude <linux/compiler.h>\n#\ninclude <linux/crc32.h>\n#\ninclude <linux/pagemap.h>\n#\ninclude <linux/mtd/mtd.h>\n#\ninclude <linux/slab.h>\n#\ninclude <linux/kernel.h>\n#\n\nnt jffs2_sum_add_xattr_mem(struct jffs2_summary *s, struct jffs2_raw_xattr *rx, uint32_t ofs)\n{\n\tstruct jffs2_sum_xattr_mem *temp;\n\n\ttemp = kmalloc(sizeof(struct jffs2_sum_xattr_mem), GFP_KERNEL);\n\tif (!temp)\n\t\treturn -ENOMEM;\n\n\ttemp->nodetype = rx->nodetype;\n\ttemp->xid = rx->xid;\n\ttemp->version = rx->version;\n\ttemp->offset = cpu_to_je32(ofs);\n\ttemp->totlen = rx->totlen;\n\ttemp->next = NULL;\n\n\treturn jffs2_sum_add_mem(s, (union jffs2_sum_mem *)temp);\n}"
  },
  {
    "function_name": "ffs2_sum_add_dirent_mem(",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/jffs2/summary.c",
    "lines": "133-155",
    "snippet": "nt jffs2_sum_add_dirent_mem(struct jffs2_summary *s, struct jffs2_raw_dirent *rd,\n\t\t\t\tuint32_t ofs)\n{\n\tstruct jffs2_sum_dirent_mem *temp =\n\t\tkmalloc(sizeof(struct jffs2_sum_dirent_mem) + rd->nsize, GFP_KERNEL);\n\n\tif (!temp)\n\t\treturn -ENOMEM;\n\n\ttemp->nodetype = rd->nodetype;\n\ttemp->totlen = rd->totlen;\n\ttemp->offset = cpu_to_je32(ofs);\t/* relative from the beginning of the jeb */\n\ttemp->pino = rd->pino;\n\ttemp->version = rd->version;\n\ttemp->ino = rd->ino;\n\ttemp->nsize = rd->nsize;\n\ttemp->type = rd->type;\n\ttemp->next = NULL;\n\n\tmemcpy(temp->name, rd->name, rd->nsize);\n\n\treturn jffs2_sum_add_mem(s, (union jffs2_sum_mem *)temp);\n}",
    "includes": [
      "include \"debug.h\"",
      "include \"nodelist.h\"\n#",
      "include <linux/vmalloc.h>\n#",
      "include <linux/compiler.h>\n#",
      "include <linux/crc32.h>\n#",
      "include <linux/pagemap.h>\n#",
      "include <linux/mtd/mtd.h>\n#",
      "include <linux/slab.h>\n#",
      "include <linux/kernel.h>\n#"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "ffs2_sum_add_mem(",
          "args": [
            ",",
            "union jffs2_sum_mem *)temp)"
          ],
          "line": 154
        },
        "resolved": true,
        "details": {
          "function_name": "ffs2_sum_add_mem(",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/jffs2/summary.c",
          "lines": "63-103",
          "snippet": "tatic int jffs2_sum_add_mem(struct jffs2_summary *s, union jffs2_sum_mem *item)\n{\n\tif (!s->sum_list_head)\n\t\ts->sum_list_head = (union jffs2_sum_mem *) item;\n\tif (s->sum_list_tail)\n\t\ts->sum_list_tail->u.next = (union jffs2_sum_mem *) item;\n\ts->sum_list_tail = (union jffs2_sum_mem *) item;\n\n\tswitch (je16_to_cpu(item->u.nodetype)) {\n\t\tcase JFFS2_NODETYPE_INODE:\n\t\t\ts->sum_size += JFFS2_SUMMARY_INODE_SIZE;\n\t\t\ts->sum_num++;\n\t\t\tdbg_summary(\"inode (%u) added to summary\\n\",\n\t\t\t\t\t\tje32_to_cpu(item->i.inode));\n\t\t\tbreak;\n\t\tcase JFFS2_NODETYPE_DIRENT:\n\t\t\ts->sum_size += JFFS2_SUMMARY_DIRENT_SIZE(item->d.nsize);\n\t\t\ts->sum_num++;\n\t\t\tdbg_summary(\"dirent (%u) added to summary\\n\",\n\t\t\t\t\t\tje32_to_cpu(item->d.ino));\n\t\t\tbreak;\n#ifdef CONFIG_JFFS2_FS_XATTR\n\t\tcase JFFS2_NODETYPE_XATTR:\n\t\t\ts->sum_size += JFFS2_SUMMARY_XATTR_SIZE;\n\t\t\ts->sum_num++;\n\t\t\tdbg_summary(\"xattr (xid=%u, version=%u) added to summary\\n\",\n\t\t\t\t    je32_to_cpu(item->x.xid), je32_to_cpu(item->x.version));\n\t\t\tbreak;\n\t\tcase JFFS2_NODETYPE_XREF:\n\t\t\ts->sum_size += JFFS2_SUMMARY_XREF_SIZE;\n\t\t\ts->sum_num++;\n\t\t\tdbg_summary(\"xref added to summary\\n\");\n\t\t\tbreak;\n#endif\n\t\tdefault:\n\t\t\tJFFS2_WARNING(\"UNKNOWN node type %u\\n\",\n\t\t\t\t\t    je16_to_cpu(item->u.nodetype));\n\t\t\treturn 1;\n\t}\n\treturn 0;\n}",
          "includes": [
            "include \"debug.h\"",
            "include \"nodelist.h\"\n#",
            "include <linux/vmalloc.h>\n#",
            "include <linux/compiler.h>\n#",
            "include <linux/crc32.h>\n#",
            "include <linux/pagemap.h>\n#",
            "include <linux/mtd/mtd.h>\n#",
            "include <linux/slab.h>\n#",
            "include <linux/kernel.h>\n#"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "include \"debug.h\"\ninclude \"nodelist.h\"\n#\ninclude <linux/vmalloc.h>\n#\ninclude <linux/compiler.h>\n#\ninclude <linux/crc32.h>\n#\ninclude <linux/pagemap.h>\n#\ninclude <linux/mtd/mtd.h>\n#\ninclude <linux/slab.h>\n#\ninclude <linux/kernel.h>\n#\n\ntatic int jffs2_sum_add_mem(struct jffs2_summary *s, union jffs2_sum_mem *item)\n{\n\tif (!s->sum_list_head)\n\t\ts->sum_list_head = (union jffs2_sum_mem *) item;\n\tif (s->sum_list_tail)\n\t\ts->sum_list_tail->u.next = (union jffs2_sum_mem *) item;\n\ts->sum_list_tail = (union jffs2_sum_mem *) item;\n\n\tswitch (je16_to_cpu(item->u.nodetype)) {\n\t\tcase JFFS2_NODETYPE_INODE:\n\t\t\ts->sum_size += JFFS2_SUMMARY_INODE_SIZE;\n\t\t\ts->sum_num++;\n\t\t\tdbg_summary(\"inode (%u) added to summary\\n\",\n\t\t\t\t\t\tje32_to_cpu(item->i.inode));\n\t\t\tbreak;\n\t\tcase JFFS2_NODETYPE_DIRENT:\n\t\t\ts->sum_size += JFFS2_SUMMARY_DIRENT_SIZE(item->d.nsize);\n\t\t\ts->sum_num++;\n\t\t\tdbg_summary(\"dirent (%u) added to summary\\n\",\n\t\t\t\t\t\tje32_to_cpu(item->d.ino));\n\t\t\tbreak;\n#ifdef CONFIG_JFFS2_FS_XATTR\n\t\tcase JFFS2_NODETYPE_XATTR:\n\t\t\ts->sum_size += JFFS2_SUMMARY_XATTR_SIZE;\n\t\t\ts->sum_num++;\n\t\t\tdbg_summary(\"xattr (xid=%u, version=%u) added to summary\\n\",\n\t\t\t\t    je32_to_cpu(item->x.xid), je32_to_cpu(item->x.version));\n\t\t\tbreak;\n\t\tcase JFFS2_NODETYPE_XREF:\n\t\t\ts->sum_size += JFFS2_SUMMARY_XREF_SIZE;\n\t\t\ts->sum_num++;\n\t\t\tdbg_summary(\"xref added to summary\\n\");\n\t\t\tbreak;\n#endif\n\t\tdefault:\n\t\t\tJFFS2_WARNING(\"UNKNOWN node type %u\\n\",\n\t\t\t\t\t    je16_to_cpu(item->u.nodetype));\n\t\t\treturn 1;\n\t}\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "emcpy(",
          "args": [
            "emp->name,",
            "d->name,",
            "d->nsize)"
          ],
          "line": 152
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pu_to_je32(",
          "args": [
            "fs)"
          ],
          "line": 144
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "malloc(",
          "args": [
            "izeof(struct jffs2_sum_dirent_mem) + rd->nsize,",
            "FP_KERNEL)"
          ],
          "line": 137
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "include \"debug.h\"\ninclude \"nodelist.h\"\n#\ninclude <linux/vmalloc.h>\n#\ninclude <linux/compiler.h>\n#\ninclude <linux/crc32.h>\n#\ninclude <linux/pagemap.h>\n#\ninclude <linux/mtd/mtd.h>\n#\ninclude <linux/slab.h>\n#\ninclude <linux/kernel.h>\n#\n\nnt jffs2_sum_add_dirent_mem(struct jffs2_summary *s, struct jffs2_raw_dirent *rd,\n\t\t\t\tuint32_t ofs)\n{\n\tstruct jffs2_sum_dirent_mem *temp =\n\t\tkmalloc(sizeof(struct jffs2_sum_dirent_mem) + rd->nsize, GFP_KERNEL);\n\n\tif (!temp)\n\t\treturn -ENOMEM;\n\n\ttemp->nodetype = rd->nodetype;\n\ttemp->totlen = rd->totlen;\n\ttemp->offset = cpu_to_je32(ofs);\t/* relative from the beginning of the jeb */\n\ttemp->pino = rd->pino;\n\ttemp->version = rd->version;\n\ttemp->ino = rd->ino;\n\ttemp->nsize = rd->nsize;\n\ttemp->type = rd->type;\n\ttemp->next = NULL;\n\n\tmemcpy(temp->name, rd->name, rd->nsize);\n\n\treturn jffs2_sum_add_mem(s, (union jffs2_sum_mem *)temp);\n}"
  },
  {
    "function_name": "ffs2_sum_add_inode_mem(",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/jffs2/summary.c",
    "lines": "115-131",
    "snippet": "nt jffs2_sum_add_inode_mem(struct jffs2_summary *s, struct jffs2_raw_inode *ri,\n\t\t\t\tuint32_t ofs)\n{\n\tstruct jffs2_sum_inode_mem *temp = kmalloc(sizeof(struct jffs2_sum_inode_mem), GFP_KERNEL);\n\n\tif (!temp)\n\t\treturn -ENOMEM;\n\n\ttemp->nodetype = ri->nodetype;\n\ttemp->inode = ri->ino;\n\ttemp->version = ri->version;\n\ttemp->offset = cpu_to_je32(ofs); /* relative offset from the beginning of the jeb */\n\ttemp->totlen = ri->totlen;\n\ttemp->next = NULL;\n\n\treturn jffs2_sum_add_mem(s, (union jffs2_sum_mem *)temp);\n}",
    "includes": [
      "include \"debug.h\"",
      "include \"nodelist.h\"\n#",
      "include <linux/vmalloc.h>\n#",
      "include <linux/compiler.h>\n#",
      "include <linux/crc32.h>\n#",
      "include <linux/pagemap.h>\n#",
      "include <linux/mtd/mtd.h>\n#",
      "include <linux/slab.h>\n#",
      "include <linux/kernel.h>\n#"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "ffs2_sum_add_mem(",
          "args": [
            ",",
            "union jffs2_sum_mem *)temp)"
          ],
          "line": 130
        },
        "resolved": true,
        "details": {
          "function_name": "ffs2_sum_add_mem(",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/jffs2/summary.c",
          "lines": "63-103",
          "snippet": "tatic int jffs2_sum_add_mem(struct jffs2_summary *s, union jffs2_sum_mem *item)\n{\n\tif (!s->sum_list_head)\n\t\ts->sum_list_head = (union jffs2_sum_mem *) item;\n\tif (s->sum_list_tail)\n\t\ts->sum_list_tail->u.next = (union jffs2_sum_mem *) item;\n\ts->sum_list_tail = (union jffs2_sum_mem *) item;\n\n\tswitch (je16_to_cpu(item->u.nodetype)) {\n\t\tcase JFFS2_NODETYPE_INODE:\n\t\t\ts->sum_size += JFFS2_SUMMARY_INODE_SIZE;\n\t\t\ts->sum_num++;\n\t\t\tdbg_summary(\"inode (%u) added to summary\\n\",\n\t\t\t\t\t\tje32_to_cpu(item->i.inode));\n\t\t\tbreak;\n\t\tcase JFFS2_NODETYPE_DIRENT:\n\t\t\ts->sum_size += JFFS2_SUMMARY_DIRENT_SIZE(item->d.nsize);\n\t\t\ts->sum_num++;\n\t\t\tdbg_summary(\"dirent (%u) added to summary\\n\",\n\t\t\t\t\t\tje32_to_cpu(item->d.ino));\n\t\t\tbreak;\n#ifdef CONFIG_JFFS2_FS_XATTR\n\t\tcase JFFS2_NODETYPE_XATTR:\n\t\t\ts->sum_size += JFFS2_SUMMARY_XATTR_SIZE;\n\t\t\ts->sum_num++;\n\t\t\tdbg_summary(\"xattr (xid=%u, version=%u) added to summary\\n\",\n\t\t\t\t    je32_to_cpu(item->x.xid), je32_to_cpu(item->x.version));\n\t\t\tbreak;\n\t\tcase JFFS2_NODETYPE_XREF:\n\t\t\ts->sum_size += JFFS2_SUMMARY_XREF_SIZE;\n\t\t\ts->sum_num++;\n\t\t\tdbg_summary(\"xref added to summary\\n\");\n\t\t\tbreak;\n#endif\n\t\tdefault:\n\t\t\tJFFS2_WARNING(\"UNKNOWN node type %u\\n\",\n\t\t\t\t\t    je16_to_cpu(item->u.nodetype));\n\t\t\treturn 1;\n\t}\n\treturn 0;\n}",
          "includes": [
            "include \"debug.h\"",
            "include \"nodelist.h\"\n#",
            "include <linux/vmalloc.h>\n#",
            "include <linux/compiler.h>\n#",
            "include <linux/crc32.h>\n#",
            "include <linux/pagemap.h>\n#",
            "include <linux/mtd/mtd.h>\n#",
            "include <linux/slab.h>\n#",
            "include <linux/kernel.h>\n#"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "include \"debug.h\"\ninclude \"nodelist.h\"\n#\ninclude <linux/vmalloc.h>\n#\ninclude <linux/compiler.h>\n#\ninclude <linux/crc32.h>\n#\ninclude <linux/pagemap.h>\n#\ninclude <linux/mtd/mtd.h>\n#\ninclude <linux/slab.h>\n#\ninclude <linux/kernel.h>\n#\n\ntatic int jffs2_sum_add_mem(struct jffs2_summary *s, union jffs2_sum_mem *item)\n{\n\tif (!s->sum_list_head)\n\t\ts->sum_list_head = (union jffs2_sum_mem *) item;\n\tif (s->sum_list_tail)\n\t\ts->sum_list_tail->u.next = (union jffs2_sum_mem *) item;\n\ts->sum_list_tail = (union jffs2_sum_mem *) item;\n\n\tswitch (je16_to_cpu(item->u.nodetype)) {\n\t\tcase JFFS2_NODETYPE_INODE:\n\t\t\ts->sum_size += JFFS2_SUMMARY_INODE_SIZE;\n\t\t\ts->sum_num++;\n\t\t\tdbg_summary(\"inode (%u) added to summary\\n\",\n\t\t\t\t\t\tje32_to_cpu(item->i.inode));\n\t\t\tbreak;\n\t\tcase JFFS2_NODETYPE_DIRENT:\n\t\t\ts->sum_size += JFFS2_SUMMARY_DIRENT_SIZE(item->d.nsize);\n\t\t\ts->sum_num++;\n\t\t\tdbg_summary(\"dirent (%u) added to summary\\n\",\n\t\t\t\t\t\tje32_to_cpu(item->d.ino));\n\t\t\tbreak;\n#ifdef CONFIG_JFFS2_FS_XATTR\n\t\tcase JFFS2_NODETYPE_XATTR:\n\t\t\ts->sum_size += JFFS2_SUMMARY_XATTR_SIZE;\n\t\t\ts->sum_num++;\n\t\t\tdbg_summary(\"xattr (xid=%u, version=%u) added to summary\\n\",\n\t\t\t\t    je32_to_cpu(item->x.xid), je32_to_cpu(item->x.version));\n\t\t\tbreak;\n\t\tcase JFFS2_NODETYPE_XREF:\n\t\t\ts->sum_size += JFFS2_SUMMARY_XREF_SIZE;\n\t\t\ts->sum_num++;\n\t\t\tdbg_summary(\"xref added to summary\\n\");\n\t\t\tbreak;\n#endif\n\t\tdefault:\n\t\t\tJFFS2_WARNING(\"UNKNOWN node type %u\\n\",\n\t\t\t\t\t    je16_to_cpu(item->u.nodetype));\n\t\t\treturn 1;\n\t}\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "pu_to_je32(",
          "args": [
            "fs)"
          ],
          "line": 126
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "malloc(",
          "args": [
            "izeof(struct jffs2_sum_inode_mem),",
            "FP_KERNEL)"
          ],
          "line": 118
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "include \"debug.h\"\ninclude \"nodelist.h\"\n#\ninclude <linux/vmalloc.h>\n#\ninclude <linux/compiler.h>\n#\ninclude <linux/crc32.h>\n#\ninclude <linux/pagemap.h>\n#\ninclude <linux/mtd/mtd.h>\n#\ninclude <linux/slab.h>\n#\ninclude <linux/kernel.h>\n#\n\nnt jffs2_sum_add_inode_mem(struct jffs2_summary *s, struct jffs2_raw_inode *ri,\n\t\t\t\tuint32_t ofs)\n{\n\tstruct jffs2_sum_inode_mem *temp = kmalloc(sizeof(struct jffs2_sum_inode_mem), GFP_KERNEL);\n\n\tif (!temp)\n\t\treturn -ENOMEM;\n\n\ttemp->nodetype = ri->nodetype;\n\ttemp->inode = ri->ino;\n\ttemp->version = ri->version;\n\ttemp->offset = cpu_to_je32(ofs); /* relative offset from the beginning of the jeb */\n\ttemp->totlen = ri->totlen;\n\ttemp->next = NULL;\n\n\treturn jffs2_sum_add_mem(s, (union jffs2_sum_mem *)temp);\n}"
  },
  {
    "function_name": "ffs2_sum_add_padding_mem(",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/jffs2/summary.c",
    "lines": "108-113",
    "snippet": "nt jffs2_sum_add_padding_mem(struct jffs2_summary *s, uint32_t size)\n{\n\tdbg_summary(\"called with %u\\n\", size);\n\ts->sum_padded += size;\n\treturn 0;\n}",
    "includes": [
      "include \"debug.h\"",
      "include \"nodelist.h\"\n#",
      "include <linux/vmalloc.h>\n#",
      "include <linux/compiler.h>\n#",
      "include <linux/crc32.h>\n#",
      "include <linux/pagemap.h>\n#",
      "include <linux/mtd/mtd.h>\n#",
      "include <linux/slab.h>\n#",
      "include <linux/kernel.h>\n#"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "bg_summary(",
          "args": [
            "called with %u\\n\",",
            "ize)"
          ],
          "line": 110
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "include \"debug.h\"\ninclude \"nodelist.h\"\n#\ninclude <linux/vmalloc.h>\n#\ninclude <linux/compiler.h>\n#\ninclude <linux/crc32.h>\n#\ninclude <linux/pagemap.h>\n#\ninclude <linux/mtd/mtd.h>\n#\ninclude <linux/slab.h>\n#\ninclude <linux/kernel.h>\n#\n\nnt jffs2_sum_add_padding_mem(struct jffs2_summary *s, uint32_t size)\n{\n\tdbg_summary(\"called with %u\\n\", size);\n\ts->sum_padded += size;\n\treturn 0;\n}"
  },
  {
    "function_name": "ffs2_sum_add_mem(",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/jffs2/summary.c",
    "lines": "63-103",
    "snippet": "tatic int jffs2_sum_add_mem(struct jffs2_summary *s, union jffs2_sum_mem *item)\n{\n\tif (!s->sum_list_head)\n\t\ts->sum_list_head = (union jffs2_sum_mem *) item;\n\tif (s->sum_list_tail)\n\t\ts->sum_list_tail->u.next = (union jffs2_sum_mem *) item;\n\ts->sum_list_tail = (union jffs2_sum_mem *) item;\n\n\tswitch (je16_to_cpu(item->u.nodetype)) {\n\t\tcase JFFS2_NODETYPE_INODE:\n\t\t\ts->sum_size += JFFS2_SUMMARY_INODE_SIZE;\n\t\t\ts->sum_num++;\n\t\t\tdbg_summary(\"inode (%u) added to summary\\n\",\n\t\t\t\t\t\tje32_to_cpu(item->i.inode));\n\t\t\tbreak;\n\t\tcase JFFS2_NODETYPE_DIRENT:\n\t\t\ts->sum_size += JFFS2_SUMMARY_DIRENT_SIZE(item->d.nsize);\n\t\t\ts->sum_num++;\n\t\t\tdbg_summary(\"dirent (%u) added to summary\\n\",\n\t\t\t\t\t\tje32_to_cpu(item->d.ino));\n\t\t\tbreak;\n#ifdef CONFIG_JFFS2_FS_XATTR\n\t\tcase JFFS2_NODETYPE_XATTR:\n\t\t\ts->sum_size += JFFS2_SUMMARY_XATTR_SIZE;\n\t\t\ts->sum_num++;\n\t\t\tdbg_summary(\"xattr (xid=%u, version=%u) added to summary\\n\",\n\t\t\t\t    je32_to_cpu(item->x.xid), je32_to_cpu(item->x.version));\n\t\t\tbreak;\n\t\tcase JFFS2_NODETYPE_XREF:\n\t\t\ts->sum_size += JFFS2_SUMMARY_XREF_SIZE;\n\t\t\ts->sum_num++;\n\t\t\tdbg_summary(\"xref added to summary\\n\");\n\t\t\tbreak;\n#endif\n\t\tdefault:\n\t\t\tJFFS2_WARNING(\"UNKNOWN node type %u\\n\",\n\t\t\t\t\t    je16_to_cpu(item->u.nodetype));\n\t\t\treturn 1;\n\t}\n\treturn 0;\n}",
    "includes": [
      "include \"debug.h\"",
      "include \"nodelist.h\"\n#",
      "include <linux/vmalloc.h>\n#",
      "include <linux/compiler.h>\n#",
      "include <linux/crc32.h>\n#",
      "include <linux/pagemap.h>\n#",
      "include <linux/mtd/mtd.h>\n#",
      "include <linux/slab.h>\n#",
      "include <linux/kernel.h>\n#"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "FFS2_WARNING(",
          "args": [
            "UNKNOWN node type %u\\n\",",
            "e16_to_cpu(item->u.nodetype))"
          ],
          "line": 98
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "e16_to_cpu(",
          "args": [
            "tem->u.nodetype)"
          ],
          "line": 99
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bg_summary(",
          "args": [
            "xref added to summary\\n\")"
          ],
          "line": 94
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bg_summary(",
          "args": [
            "xattr (xid=%u, version=%u) added to summary\\n\",",
            "e32_to_cpu(item->x.xid),",
            "e32_to_cpu(item->x.version))"
          ],
          "line": 88
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "e32_to_cpu(",
          "args": [
            "tem->x.version)"
          ],
          "line": 89
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "e32_to_cpu(",
          "args": [
            "tem->x.xid)"
          ],
          "line": 89
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bg_summary(",
          "args": [
            "dirent (%u) added to summary\\n\",",
            "e32_to_cpu(item->d.ino))"
          ],
          "line": 81
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "e32_to_cpu(",
          "args": [
            "tem->d.ino)"
          ],
          "line": 82
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "FFS2_SUMMARY_DIRENT_SIZE(",
          "args": [
            "tem->d.nsize)"
          ],
          "line": 79
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bg_summary(",
          "args": [
            "inode (%u) added to summary\\n\",",
            "e32_to_cpu(item->i.inode))"
          ],
          "line": 75
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "e32_to_cpu(",
          "args": [
            "tem->i.inode)"
          ],
          "line": 76
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "e16_to_cpu(",
          "args": [
            "tem->u.nodetype)"
          ],
          "line": 71
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "include \"debug.h\"\ninclude \"nodelist.h\"\n#\ninclude <linux/vmalloc.h>\n#\ninclude <linux/compiler.h>\n#\ninclude <linux/crc32.h>\n#\ninclude <linux/pagemap.h>\n#\ninclude <linux/mtd/mtd.h>\n#\ninclude <linux/slab.h>\n#\ninclude <linux/kernel.h>\n#\n\ntatic int jffs2_sum_add_mem(struct jffs2_summary *s, union jffs2_sum_mem *item)\n{\n\tif (!s->sum_list_head)\n\t\ts->sum_list_head = (union jffs2_sum_mem *) item;\n\tif (s->sum_list_tail)\n\t\ts->sum_list_tail->u.next = (union jffs2_sum_mem *) item;\n\ts->sum_list_tail = (union jffs2_sum_mem *) item;\n\n\tswitch (je16_to_cpu(item->u.nodetype)) {\n\t\tcase JFFS2_NODETYPE_INODE:\n\t\t\ts->sum_size += JFFS2_SUMMARY_INODE_SIZE;\n\t\t\ts->sum_num++;\n\t\t\tdbg_summary(\"inode (%u) added to summary\\n\",\n\t\t\t\t\t\tje32_to_cpu(item->i.inode));\n\t\t\tbreak;\n\t\tcase JFFS2_NODETYPE_DIRENT:\n\t\t\ts->sum_size += JFFS2_SUMMARY_DIRENT_SIZE(item->d.nsize);\n\t\t\ts->sum_num++;\n\t\t\tdbg_summary(\"dirent (%u) added to summary\\n\",\n\t\t\t\t\t\tje32_to_cpu(item->d.ino));\n\t\t\tbreak;\n#ifdef CONFIG_JFFS2_FS_XATTR\n\t\tcase JFFS2_NODETYPE_XATTR:\n\t\t\ts->sum_size += JFFS2_SUMMARY_XATTR_SIZE;\n\t\t\ts->sum_num++;\n\t\t\tdbg_summary(\"xattr (xid=%u, version=%u) added to summary\\n\",\n\t\t\t\t    je32_to_cpu(item->x.xid), je32_to_cpu(item->x.version));\n\t\t\tbreak;\n\t\tcase JFFS2_NODETYPE_XREF:\n\t\t\ts->sum_size += JFFS2_SUMMARY_XREF_SIZE;\n\t\t\ts->sum_num++;\n\t\t\tdbg_summary(\"xref added to summary\\n\");\n\t\t\tbreak;\n#endif\n\t\tdefault:\n\t\t\tJFFS2_WARNING(\"UNKNOWN node type %u\\n\",\n\t\t\t\t\t    je16_to_cpu(item->u.nodetype));\n\t\t\treturn 1;\n\t}\n\treturn 0;\n}"
  },
  {
    "function_name": "ffs2_sum_exit(",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/jffs2/summary.c",
    "lines": "50-61",
    "snippet": "oid jffs2_sum_exit(struct jffs2_sb_info *c)\n{\n\tdbg_summary(\"called\\n\");\n\n\tjffs2_sum_disable_collecting(c->summary);\n\n\tkfree(c->summary->sum_buf);\n\tc->summary->sum_buf = NULL;\n\n\tkfree(c->summary);\n\tc->summary = NULL;\n}",
    "includes": [
      "include \"debug.h\"",
      "include \"nodelist.h\"\n#",
      "include <linux/vmalloc.h>\n#",
      "include <linux/compiler.h>\n#",
      "include <linux/crc32.h>\n#",
      "include <linux/pagemap.h>\n#",
      "include <linux/mtd/mtd.h>\n#",
      "include <linux/slab.h>\n#",
      "include <linux/kernel.h>\n#"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free(",
          "args": [
            "->summary)"
          ],
          "line": 59
        },
        "resolved": true,
        "details": {
          "function_name": "in_free(",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/jffs2/scan.c",
          "lines": "51-60",
          "snippet": "tatic inline int min_free(struct jffs2_sb_info *c)\n{\n\tuint32_t min = 2 * sizeof(struct jffs2_raw_inode);\n#ifdef CONFIG_JFFS2_FS_WRITEBUFFER\n\tif (!jffs2_can_mark_obsolete(c) && min < c->wbuf_pagesize)\n\t\treturn c->wbuf_pagesize;\n#endif\n\treturn min;\n\n}",
          "includes": [
            "include \"debug.h\"",
            "include \"summary.h\"\n#",
            "include \"nodelist.h\"\n#",
            "include <linux/compiler.h>\n#",
            "include <linux/crc32.h>\n#",
            "include <linux/pagemap.h>\n#",
            "include <linux/mtd/mtd.h>\n#",
            "include <linux/slab.h>\n#",
            "include <linux/sched.h>\n#",
            "include <linux/kernel.h>\n#"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "include \"debug.h\"\ninclude \"summary.h\"\n#\ninclude \"nodelist.h\"\n#\ninclude <linux/compiler.h>\n#\ninclude <linux/crc32.h>\n#\ninclude <linux/pagemap.h>\n#\ninclude <linux/mtd/mtd.h>\n#\ninclude <linux/slab.h>\n#\ninclude <linux/sched.h>\n#\ninclude <linux/kernel.h>\n#\n\ntatic inline int min_free(struct jffs2_sb_info *c)\n{\n\tuint32_t min = 2 * sizeof(struct jffs2_raw_inode);\n#ifdef CONFIG_JFFS2_FS_WRITEBUFFER\n\tif (!jffs2_can_mark_obsolete(c) && min < c->wbuf_pagesize)\n\t\treturn c->wbuf_pagesize;\n#endif\n\treturn min;\n\n}"
        }
      },
      {
        "call_info": {
          "callee": "ffs2_sum_disable_collecting(",
          "args": [
            "->summary)"
          ],
          "line": 54
        },
        "resolved": true,
        "details": {
          "function_name": "ffs2_sum_disable_collecting(",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/jffs2/summary.c",
          "lines": "217-222",
          "snippet": "oid jffs2_sum_disable_collecting(struct jffs2_summary *s)\n{\n\tdbg_summary(\"called\\n\");\n\tjffs2_sum_clean_collected(s);\n\ts->sum_size = JFFS2_SUMMARY_NOSUM_SIZE;\n}",
          "includes": [
            "include \"debug.h\"",
            "include \"nodelist.h\"\n#",
            "include <linux/vmalloc.h>\n#",
            "include <linux/compiler.h>\n#",
            "include <linux/crc32.h>\n#",
            "include <linux/pagemap.h>\n#",
            "include <linux/mtd/mtd.h>\n#",
            "include <linux/slab.h>\n#",
            "include <linux/kernel.h>\n#"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "include \"debug.h\"\ninclude \"nodelist.h\"\n#\ninclude <linux/vmalloc.h>\n#\ninclude <linux/compiler.h>\n#\ninclude <linux/crc32.h>\n#\ninclude <linux/pagemap.h>\n#\ninclude <linux/mtd/mtd.h>\n#\ninclude <linux/slab.h>\n#\ninclude <linux/kernel.h>\n#\n\noid jffs2_sum_disable_collecting(struct jffs2_summary *s)\n{\n\tdbg_summary(\"called\\n\");\n\tjffs2_sum_clean_collected(s);\n\ts->sum_size = JFFS2_SUMMARY_NOSUM_SIZE;\n}"
        }
      },
      {
        "call_info": {
          "callee": "bg_summary(",
          "args": [
            "called\\n\")"
          ],
          "line": 52
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "include \"debug.h\"\ninclude \"nodelist.h\"\n#\ninclude <linux/vmalloc.h>\n#\ninclude <linux/compiler.h>\n#\ninclude <linux/crc32.h>\n#\ninclude <linux/pagemap.h>\n#\ninclude <linux/mtd/mtd.h>\n#\ninclude <linux/slab.h>\n#\ninclude <linux/kernel.h>\n#\n\noid jffs2_sum_exit(struct jffs2_sb_info *c)\n{\n\tdbg_summary(\"called\\n\");\n\n\tjffs2_sum_disable_collecting(c->summary);\n\n\tkfree(c->summary->sum_buf);\n\tc->summary->sum_buf = NULL;\n\n\tkfree(c->summary);\n\tc->summary = NULL;\n}"
  },
  {
    "function_name": "ffs2_sum_init(",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/jffs2/summary.c",
    "lines": "26-48",
    "snippet": "nt jffs2_sum_init(struct jffs2_sb_info *c)\n{\n\tuint32_t sum_size = min_t(uint32_t, c->sector_size, MAX_SUMMARY_SIZE);\n\n\tc->summary = kzalloc(sizeof(struct jffs2_summary), GFP_KERNEL);\n\n\tif (!c->summary) {\n\t\tJFFS2_WARNING(\"Can't allocate memory for summary information!\\n\");\n\t\treturn -ENOMEM;\n\t}\n\n\tc->summary->sum_buf = kmalloc(sum_size, GFP_KERNEL);\n\n\tif (!c->summary->sum_buf) {\n\t\tJFFS2_WARNING(\"Can't allocate buffer for writing out summary information!\\n\");\n\t\tkfree(c->summary);\n\t\treturn -ENOMEM;\n\t}\n\n\tdbg_summary(\"returned successfully\\n\");\n\n\treturn 0;\n}",
    "includes": [
      "include \"debug.h\"",
      "include \"nodelist.h\"\n#",
      "include <linux/vmalloc.h>\n#",
      "include <linux/compiler.h>\n#",
      "include <linux/crc32.h>\n#",
      "include <linux/pagemap.h>\n#",
      "include <linux/mtd/mtd.h>\n#",
      "include <linux/slab.h>\n#",
      "include <linux/kernel.h>\n#"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "bg_summary(",
          "args": [
            "returned successfully\\n\")"
          ],
          "line": 45
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "free(",
          "args": [
            "->summary)"
          ],
          "line": 41
        },
        "resolved": true,
        "details": {
          "function_name": "in_free(",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/jffs2/scan.c",
          "lines": "51-60",
          "snippet": "tatic inline int min_free(struct jffs2_sb_info *c)\n{\n\tuint32_t min = 2 * sizeof(struct jffs2_raw_inode);\n#ifdef CONFIG_JFFS2_FS_WRITEBUFFER\n\tif (!jffs2_can_mark_obsolete(c) && min < c->wbuf_pagesize)\n\t\treturn c->wbuf_pagesize;\n#endif\n\treturn min;\n\n}",
          "includes": [
            "include \"debug.h\"",
            "include \"summary.h\"\n#",
            "include \"nodelist.h\"\n#",
            "include <linux/compiler.h>\n#",
            "include <linux/crc32.h>\n#",
            "include <linux/pagemap.h>\n#",
            "include <linux/mtd/mtd.h>\n#",
            "include <linux/slab.h>\n#",
            "include <linux/sched.h>\n#",
            "include <linux/kernel.h>\n#"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "include \"debug.h\"\ninclude \"summary.h\"\n#\ninclude \"nodelist.h\"\n#\ninclude <linux/compiler.h>\n#\ninclude <linux/crc32.h>\n#\ninclude <linux/pagemap.h>\n#\ninclude <linux/mtd/mtd.h>\n#\ninclude <linux/slab.h>\n#\ninclude <linux/sched.h>\n#\ninclude <linux/kernel.h>\n#\n\ntatic inline int min_free(struct jffs2_sb_info *c)\n{\n\tuint32_t min = 2 * sizeof(struct jffs2_raw_inode);\n#ifdef CONFIG_JFFS2_FS_WRITEBUFFER\n\tif (!jffs2_can_mark_obsolete(c) && min < c->wbuf_pagesize)\n\t\treturn c->wbuf_pagesize;\n#endif\n\treturn min;\n\n}"
        }
      },
      {
        "call_info": {
          "callee": "FFS2_WARNING(",
          "args": [
            "Can't allocate buffer for writing out summary information!\\n\")"
          ],
          "line": 40
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "malloc(",
          "args": [
            "um_size,",
            "FP_KERNEL)"
          ],
          "line": 37
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "FFS2_WARNING(",
          "args": [
            "Can't allocate memory for summary information!\\n\")"
          ],
          "line": 33
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "zalloc(",
          "args": [
            "izeof(struct jffs2_summary),",
            "FP_KERNEL)"
          ],
          "line": 30
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "in_t(",
          "args": [
            "int32_t,",
            "->sector_size,",
            "AX_SUMMARY_SIZE)"
          ],
          "line": 28
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "include \"debug.h\"\ninclude \"nodelist.h\"\n#\ninclude <linux/vmalloc.h>\n#\ninclude <linux/compiler.h>\n#\ninclude <linux/crc32.h>\n#\ninclude <linux/pagemap.h>\n#\ninclude <linux/mtd/mtd.h>\n#\ninclude <linux/slab.h>\n#\ninclude <linux/kernel.h>\n#\n\nnt jffs2_sum_init(struct jffs2_sb_info *c)\n{\n\tuint32_t sum_size = min_t(uint32_t, c->sector_size, MAX_SUMMARY_SIZE);\n\n\tc->summary = kzalloc(sizeof(struct jffs2_summary), GFP_KERNEL);\n\n\tif (!c->summary) {\n\t\tJFFS2_WARNING(\"Can't allocate memory for summary information!\\n\");\n\t\treturn -ENOMEM;\n\t}\n\n\tc->summary->sum_buf = kmalloc(sum_size, GFP_KERNEL);\n\n\tif (!c->summary->sum_buf) {\n\t\tJFFS2_WARNING(\"Can't allocate buffer for writing out summary information!\\n\");\n\t\tkfree(c->summary);\n\t\treturn -ENOMEM;\n\t}\n\n\tdbg_summary(\"returned successfully\\n\");\n\n\treturn 0;\n}"
  }
]