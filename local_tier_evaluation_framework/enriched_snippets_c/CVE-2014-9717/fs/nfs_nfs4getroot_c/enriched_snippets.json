[
  {
    "function_name": "nfs4_get_rootfh",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nfs/nfs4getroot.c",
    "lines": "12-50",
    "snippet": "int nfs4_get_rootfh(struct nfs_server *server, struct nfs_fh *mntfh, bool auth_probe)\n{\n\tstruct nfs_fsinfo fsinfo;\n\tint ret = -ENOMEM;\n\n\tdprintk(\"--> nfs4_get_rootfh()\\n\");\n\n\tfsinfo.fattr = nfs_alloc_fattr();\n\tif (fsinfo.fattr == NULL)\n\t\tgoto out;\n\n\t/* Start by getting the root filehandle from the server */\n\tret = nfs4_proc_get_rootfh(server, mntfh, &fsinfo, auth_probe);\n\tif (ret < 0) {\n\t\tdprintk(\"nfs4_get_rootfh: getroot error = %d\\n\", -ret);\n\t\tgoto out;\n\t}\n\n\tif (!(fsinfo.fattr->valid & NFS_ATTR_FATTR_TYPE)\n\t\t\t|| !S_ISDIR(fsinfo.fattr->mode)) {\n\t\tprintk(KERN_ERR \"nfs4_get_rootfh:\"\n\t\t       \" getroot encountered non-directory\\n\");\n\t\tret = -ENOTDIR;\n\t\tgoto out;\n\t}\n\n\tif (fsinfo.fattr->valid & NFS_ATTR_FATTR_V4_REFERRAL) {\n\t\tprintk(KERN_ERR \"nfs4_get_rootfh:\"\n\t\t       \" getroot obtained referral\\n\");\n\t\tret = -EREMOTE;\n\t\tgoto out;\n\t}\n\n\tmemcpy(&server->fsid, &fsinfo.fattr->fsid, sizeof(server->fsid));\nout:\n\tnfs_free_fattr(fsinfo.fattr);\n\tdprintk(\"<-- nfs4_get_rootfh() = %d\\n\", ret);\n\treturn ret;\n}",
    "includes": [
      "#include \"internal.h\"",
      "#include \"nfs4_fs.h\"",
      "#include <linux/nfs_fs.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "dprintk",
          "args": [
            "\"<-- nfs4_get_rootfh() = %d\\n\"",
            "ret"
          ],
          "line": 48
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "nfs_free_fattr",
          "args": [
            "fsinfo.fattr"
          ],
          "line": 47
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memcpy",
          "args": [
            "&server->fsid",
            "&fsinfo.fattr->fsid",
            "sizeof(server->fsid)"
          ],
          "line": 45
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "printk",
          "args": [
            "KERN_ERR \"nfs4_get_rootfh:\"\n\t\t       \" getroot obtained referral\\n\""
          ],
          "line": 39
        },
        "resolved": true,
        "details": {
          "function_name": "compat_printk",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/compat.c",
          "lines": "59-69",
          "snippet": "int compat_printk(const char *fmt, ...)\n{\n\tva_list ap;\n\tint ret;\n\tif (!compat_log)\n\t\treturn 0;\n\tva_start(ap, fmt);\n\tret = vprintk(fmt, ap);\n\tva_end(ap);\n\treturn ret;\n}",
          "includes": [
            "#include \"internal.h\"",
            "#include <asm/ioctls.h>",
            "#include <asm/mmu_context.h>",
            "#include <asm/uaccess.h>",
            "#include <linux/aio.h>",
            "#include <linux/pagemap.h>",
            "#include <linux/slab.h>",
            "#include <linux/fs_struct.h>",
            "#include <linux/mm.h>",
            "#include <linux/poll.h>",
            "#include <linux/signal.h>",
            "#include <linux/highmem.h>",
            "#include <linux/security.h>",
            "#include <linux/tsacct_kern.h>",
            "#include <linux/rwsem.h>",
            "#include <linux/personality.h>",
            "#include <linux/highuid.h>",
            "#include <linux/fsnotify.h>",
            "#include <linux/dirent.h>",
            "#include <linux/ctype.h>",
            "#include <linux/syscalls.h>",
            "#include <linux/nfs4_mount.h>",
            "#include <linux/ncp_mount.h>",
            "#include <linux/init.h>",
            "#include <linux/ioctl.h>",
            "#include <linux/vfs.h>",
            "#include <linux/fdtable.h>",
            "#include <linux/file.h>",
            "#include <linux/namei.h>",
            "#include <linux/fcntl.h>",
            "#include <linux/fs.h>",
            "#include <linux/time.h>",
            "#include <linux/errno.h>",
            "#include <linux/compat.h>",
            "#include <linux/linkage.h>",
            "#include <linux/kernel.h>",
            "#include <linux/stddef.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "int compat_log = 1;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"internal.h\"\n#include <asm/ioctls.h>\n#include <asm/mmu_context.h>\n#include <asm/uaccess.h>\n#include <linux/aio.h>\n#include <linux/pagemap.h>\n#include <linux/slab.h>\n#include <linux/fs_struct.h>\n#include <linux/mm.h>\n#include <linux/poll.h>\n#include <linux/signal.h>\n#include <linux/highmem.h>\n#include <linux/security.h>\n#include <linux/tsacct_kern.h>\n#include <linux/rwsem.h>\n#include <linux/personality.h>\n#include <linux/highuid.h>\n#include <linux/fsnotify.h>\n#include <linux/dirent.h>\n#include <linux/ctype.h>\n#include <linux/syscalls.h>\n#include <linux/nfs4_mount.h>\n#include <linux/ncp_mount.h>\n#include <linux/init.h>\n#include <linux/ioctl.h>\n#include <linux/vfs.h>\n#include <linux/fdtable.h>\n#include <linux/file.h>\n#include <linux/namei.h>\n#include <linux/fcntl.h>\n#include <linux/fs.h>\n#include <linux/time.h>\n#include <linux/errno.h>\n#include <linux/compat.h>\n#include <linux/linkage.h>\n#include <linux/kernel.h>\n#include <linux/stddef.h>\n\nint compat_log = 1;\n\nint compat_printk(const char *fmt, ...)\n{\n\tva_list ap;\n\tint ret;\n\tif (!compat_log)\n\t\treturn 0;\n\tva_start(ap, fmt);\n\tret = vprintk(fmt, ap);\n\tva_end(ap);\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "S_ISDIR",
          "args": [
            "fsinfo.fattr->mode"
          ],
          "line": 31
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dprintk",
          "args": [
            "\"nfs4_get_rootfh: getroot error = %d\\n\"",
            "-ret"
          ],
          "line": 26
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "nfs4_proc_get_rootfh",
          "args": [
            "server",
            "mntfh",
            "&fsinfo",
            "auth_probe"
          ],
          "line": 24
        },
        "resolved": true,
        "details": {
          "function_name": "nfs4_proc_get_rootfh",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nfs/nfs4proc.c",
          "lines": "3094-3115",
          "snippet": "int nfs4_proc_get_rootfh(struct nfs_server *server, struct nfs_fh *fhandle,\n\t\t\t struct nfs_fsinfo *info,\n\t\t\t bool auth_probe)\n{\n\tint status;\n\n\tswitch (auth_probe) {\n\tcase false:\n\t\tstatus = nfs4_lookup_root(server, fhandle, info);\n\t\tif (status != -NFS4ERR_WRONGSEC)\n\t\t\tbreak;\n\tdefault:\n\t\tstatus = nfs4_do_find_root_sec(server, fhandle, info);\n\t}\n\n\tif (status == 0)\n\t\tstatus = nfs4_server_capabilities(server, fhandle);\n\tif (status == 0)\n\t\tstatus = nfs4_do_fsinfo(server, fhandle, info);\n\n\treturn nfs4_map_errors(status);\n}",
          "includes": [
            "#include \"nfs4trace.h\"",
            "#include \"fscache.h\"",
            "#include \"nfs4session.h\"",
            "#include \"netns.h\"",
            "#include \"pnfs.h\"",
            "#include \"callback.h\"",
            "#include \"iostat.h\"",
            "#include \"internal.h\"",
            "#include \"delegation.h\"",
            "#include \"nfs4_fs.h\"",
            "#include <linux/freezer.h>",
            "#include <linux/utsname.h>",
            "#include <linux/xattr.h>",
            "#include <linux/nfs_idmap.h>",
            "#include <linux/module.h>",
            "#include <linux/mount.h>",
            "#include <linux/namei.h>",
            "#include <linux/nfs_mount.h>",
            "#include <linux/nfs_page.h>",
            "#include <linux/nfs_fs.h>",
            "#include <linux/nfs4.h>",
            "#include <linux/nfs.h>",
            "#include <linux/sunrpc/clnt.h>",
            "#include <linux/slab.h>",
            "#include <linux/printk.h>",
            "#include <linux/ratelimit.h>",
            "#include <linux/string.h>",
            "#include <linux/errno.h>",
            "#include <linux/delay.h>",
            "#include <linux/mm.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int nfs4_do_fsinfo(struct nfs_server *, struct nfs_fh *, struct nfs_fsinfo *);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"nfs4trace.h\"\n#include \"fscache.h\"\n#include \"nfs4session.h\"\n#include \"netns.h\"\n#include \"pnfs.h\"\n#include \"callback.h\"\n#include \"iostat.h\"\n#include \"internal.h\"\n#include \"delegation.h\"\n#include \"nfs4_fs.h\"\n#include <linux/freezer.h>\n#include <linux/utsname.h>\n#include <linux/xattr.h>\n#include <linux/nfs_idmap.h>\n#include <linux/module.h>\n#include <linux/mount.h>\n#include <linux/namei.h>\n#include <linux/nfs_mount.h>\n#include <linux/nfs_page.h>\n#include <linux/nfs_fs.h>\n#include <linux/nfs4.h>\n#include <linux/nfs.h>\n#include <linux/sunrpc/clnt.h>\n#include <linux/slab.h>\n#include <linux/printk.h>\n#include <linux/ratelimit.h>\n#include <linux/string.h>\n#include <linux/errno.h>\n#include <linux/delay.h>\n#include <linux/mm.h>\n\nstatic int nfs4_do_fsinfo(struct nfs_server *, struct nfs_fh *, struct nfs_fsinfo *);\n\nint nfs4_proc_get_rootfh(struct nfs_server *server, struct nfs_fh *fhandle,\n\t\t\t struct nfs_fsinfo *info,\n\t\t\t bool auth_probe)\n{\n\tint status;\n\n\tswitch (auth_probe) {\n\tcase false:\n\t\tstatus = nfs4_lookup_root(server, fhandle, info);\n\t\tif (status != -NFS4ERR_WRONGSEC)\n\t\t\tbreak;\n\tdefault:\n\t\tstatus = nfs4_do_find_root_sec(server, fhandle, info);\n\t}\n\n\tif (status == 0)\n\t\tstatus = nfs4_server_capabilities(server, fhandle);\n\tif (status == 0)\n\t\tstatus = nfs4_do_fsinfo(server, fhandle, info);\n\n\treturn nfs4_map_errors(status);\n}"
        }
      },
      {
        "call_info": {
          "callee": "nfs_alloc_fattr",
          "args": [],
          "line": 19
        },
        "resolved": true,
        "details": {
          "function_name": "nfs_alloc_fattr",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nfs/inode.c",
          "lines": "1312-1320",
          "snippet": "struct nfs_fattr *nfs_alloc_fattr(void)\n{\n\tstruct nfs_fattr *fattr;\n\n\tfattr = kmalloc(sizeof(*fattr), GFP_NOFS);\n\tif (fattr != NULL)\n\t\tnfs_fattr_init(fattr);\n\treturn fattr;\n}",
          "includes": [
            "#include \"nfstrace.h\"",
            "#include \"netns.h\"",
            "#include \"nfs.h\"",
            "#include \"pnfs.h\"",
            "#include \"fscache.h\"",
            "#include \"internal.h\"",
            "#include \"iostat.h\"",
            "#include \"delegation.h\"",
            "#include \"callback.h\"",
            "#include \"nfs4_fs.h\"",
            "#include <asm/uaccess.h>",
            "#include <linux/freezer.h>",
            "#include <linux/compat.h>",
            "#include <linux/slab.h>",
            "#include <linux/nfs_xdr.h>",
            "#include <linux/inet.h>",
            "#include <linux/vfs.h>",
            "#include <linux/mount.h>",
            "#include <linux/seq_file.h>",
            "#include <linux/lockd/bind.h>",
            "#include <linux/nfs4_mount.h>",
            "#include <linux/nfs_mount.h>",
            "#include <linux/nfs_fs.h>",
            "#include <linux/sunrpc/metrics.h>",
            "#include <linux/sunrpc/stats.h>",
            "#include <linux/sunrpc/clnt.h>",
            "#include <linux/unistd.h>",
            "#include <linux/errno.h>",
            "#include <linux/stat.h>",
            "#include <linux/string.h>",
            "#include <linux/mm.h>",
            "#include <linux/kernel.h>",
            "#include <linux/time.h>",
            "#include <linux/sched.h>",
            "#include <linux/init.h>",
            "#include <linux/module.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int nfs_update_inode(struct inode *, struct nfs_fattr *);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"nfstrace.h\"\n#include \"netns.h\"\n#include \"nfs.h\"\n#include \"pnfs.h\"\n#include \"fscache.h\"\n#include \"internal.h\"\n#include \"iostat.h\"\n#include \"delegation.h\"\n#include \"callback.h\"\n#include \"nfs4_fs.h\"\n#include <asm/uaccess.h>\n#include <linux/freezer.h>\n#include <linux/compat.h>\n#include <linux/slab.h>\n#include <linux/nfs_xdr.h>\n#include <linux/inet.h>\n#include <linux/vfs.h>\n#include <linux/mount.h>\n#include <linux/seq_file.h>\n#include <linux/lockd/bind.h>\n#include <linux/nfs4_mount.h>\n#include <linux/nfs_mount.h>\n#include <linux/nfs_fs.h>\n#include <linux/sunrpc/metrics.h>\n#include <linux/sunrpc/stats.h>\n#include <linux/sunrpc/clnt.h>\n#include <linux/unistd.h>\n#include <linux/errno.h>\n#include <linux/stat.h>\n#include <linux/string.h>\n#include <linux/mm.h>\n#include <linux/kernel.h>\n#include <linux/time.h>\n#include <linux/sched.h>\n#include <linux/init.h>\n#include <linux/module.h>\n\nstatic int nfs_update_inode(struct inode *, struct nfs_fattr *);\n\nstruct nfs_fattr *nfs_alloc_fattr(void)\n{\n\tstruct nfs_fattr *fattr;\n\n\tfattr = kmalloc(sizeof(*fattr), GFP_NOFS);\n\tif (fattr != NULL)\n\t\tnfs_fattr_init(fattr);\n\treturn fattr;\n}"
        }
      },
      {
        "call_info": {
          "callee": "dprintk",
          "args": [
            "\"--> nfs4_get_rootfh()\\n\""
          ],
          "line": 17
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"internal.h\"\n#include \"nfs4_fs.h\"\n#include <linux/nfs_fs.h>\n\nint nfs4_get_rootfh(struct nfs_server *server, struct nfs_fh *mntfh, bool auth_probe)\n{\n\tstruct nfs_fsinfo fsinfo;\n\tint ret = -ENOMEM;\n\n\tdprintk(\"--> nfs4_get_rootfh()\\n\");\n\n\tfsinfo.fattr = nfs_alloc_fattr();\n\tif (fsinfo.fattr == NULL)\n\t\tgoto out;\n\n\t/* Start by getting the root filehandle from the server */\n\tret = nfs4_proc_get_rootfh(server, mntfh, &fsinfo, auth_probe);\n\tif (ret < 0) {\n\t\tdprintk(\"nfs4_get_rootfh: getroot error = %d\\n\", -ret);\n\t\tgoto out;\n\t}\n\n\tif (!(fsinfo.fattr->valid & NFS_ATTR_FATTR_TYPE)\n\t\t\t|| !S_ISDIR(fsinfo.fattr->mode)) {\n\t\tprintk(KERN_ERR \"nfs4_get_rootfh:\"\n\t\t       \" getroot encountered non-directory\\n\");\n\t\tret = -ENOTDIR;\n\t\tgoto out;\n\t}\n\n\tif (fsinfo.fattr->valid & NFS_ATTR_FATTR_V4_REFERRAL) {\n\t\tprintk(KERN_ERR \"nfs4_get_rootfh:\"\n\t\t       \" getroot obtained referral\\n\");\n\t\tret = -EREMOTE;\n\t\tgoto out;\n\t}\n\n\tmemcpy(&server->fsid, &fsinfo.fattr->fsid, sizeof(server->fsid));\nout:\n\tnfs_free_fattr(fsinfo.fattr);\n\tdprintk(\"<-- nfs4_get_rootfh() = %d\\n\", ret);\n\treturn ret;\n}"
  }
]