[
  {
    "function_name": "nfs4_kill_renewd",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nfs/nfs4renewd.c",
    "lines": "133-137",
    "snippet": "void\nnfs4_kill_renewd(struct nfs_client *clp)\n{\n\tcancel_delayed_work_sync(&clp->cl_renewd);\n}",
    "includes": [
      "#include \"delegation.h\"",
      "#include \"nfs4_fs.h\"",
      "#include <linux/nfs_fs.h>",
      "#include <linux/nfs4.h>",
      "#include <linux/nfs.h>",
      "#include <linux/sunrpc/clnt.h>",
      "#include <linux/sunrpc/sched.h>",
      "#include <linux/pagemap.h>",
      "#include <linux/mm.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "cancel_delayed_work_sync",
          "args": [
            "&clp->cl_renewd"
          ],
          "line": 136
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"delegation.h\"\n#include \"nfs4_fs.h\"\n#include <linux/nfs_fs.h>\n#include <linux/nfs4.h>\n#include <linux/nfs.h>\n#include <linux/sunrpc/clnt.h>\n#include <linux/sunrpc/sched.h>\n#include <linux/pagemap.h>\n#include <linux/mm.h>\n\nvoid\nnfs4_kill_renewd(struct nfs_client *clp)\n{\n\tcancel_delayed_work_sync(&clp->cl_renewd);\n}"
  },
  {
    "function_name": "nfs4_schedule_state_renewal",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nfs/nfs4renewd.c",
    "lines": "116-131",
    "snippet": "void\nnfs4_schedule_state_renewal(struct nfs_client *clp)\n{\n\tlong timeout;\n\n\tspin_lock(&clp->cl_lock);\n\ttimeout = (2 * clp->cl_lease_time) / 3 + (long)clp->cl_last_renewal\n\t\t- (long)jiffies;\n\tif (timeout < 5 * HZ)\n\t\ttimeout = 5 * HZ;\n\tdprintk(\"%s: requeueing work. Lease period = %ld\\n\",\n\t\t\t__func__, (timeout + HZ - 1) / HZ);\n\tmod_delayed_work(system_wq, &clp->cl_renewd, timeout);\n\tset_bit(NFS_CS_RENEWD, &clp->cl_res_state);\n\tspin_unlock(&clp->cl_lock);\n}",
    "includes": [
      "#include \"delegation.h\"",
      "#include \"nfs4_fs.h\"",
      "#include <linux/nfs_fs.h>",
      "#include <linux/nfs4.h>",
      "#include <linux/nfs.h>",
      "#include <linux/sunrpc/clnt.h>",
      "#include <linux/sunrpc/sched.h>",
      "#include <linux/pagemap.h>",
      "#include <linux/mm.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "spin_unlock",
          "args": [
            "&clp->cl_lock"
          ],
          "line": 130
        },
        "resolved": true,
        "details": {
          "function_name": "__spin_unlock_mb_cache_entry",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/mbcache.c",
          "lines": "139-144",
          "snippet": "static inline void\n__spin_unlock_mb_cache_entry(struct mb_cache_entry *ce)\n{\n\tspin_unlock(bgl_lock_ptr(mb_cache_bg_lock,\n\t\tMB_CACHE_ENTRY_LOCK_INDEX(ce)));\n}",
          "includes": [
            "#include <linux/log2.h>",
            "#include <linux/blockgroup_lock.h>",
            "#include <linux/init.h>",
            "#include <linux/mbcache.h>",
            "#include <linux/list_bl.h>",
            "#include <linux/sched.h>",
            "#include <linux/slab.h>",
            "#include <linux/mm.h>",
            "#include <linux/fs.h>",
            "#include <linux/hash.h>",
            "#include <linux/module.h>",
            "#include <linux/kernel.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static struct blockgroup_lock *mb_cache_bg_lock;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <linux/log2.h>\n#include <linux/blockgroup_lock.h>\n#include <linux/init.h>\n#include <linux/mbcache.h>\n#include <linux/list_bl.h>\n#include <linux/sched.h>\n#include <linux/slab.h>\n#include <linux/mm.h>\n#include <linux/fs.h>\n#include <linux/hash.h>\n#include <linux/module.h>\n#include <linux/kernel.h>\n\nstatic struct blockgroup_lock *mb_cache_bg_lock;\n\nstatic inline void\n__spin_unlock_mb_cache_entry(struct mb_cache_entry *ce)\n{\n\tspin_unlock(bgl_lock_ptr(mb_cache_bg_lock,\n\t\tMB_CACHE_ENTRY_LOCK_INDEX(ce)));\n}"
        }
      },
      {
        "call_info": {
          "callee": "set_bit",
          "args": [
            "NFS_CS_RENEWD",
            "&clp->cl_res_state"
          ],
          "line": 129
        },
        "resolved": true,
        "details": {
          "function_name": "ocfs2_set_bit_unaligned",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/ocfs2/ocfs2.h",
          "lines": "886-890",
          "snippet": "static inline void ocfs2_set_bit_unaligned(int bit, void *bitmap)\n{\n\tbitmap = correct_addr_and_bit_unaligned(&bit, bitmap);\n\tocfs2_set_bit(bit, bitmap);\n}",
          "includes": [
            "#include \"reservations.h\"",
            "#include \"blockcheck.h\"",
            "#include \"ocfs2_ioctl.h\"",
            "#include \"ocfs2_lockid.h\"",
            "#include \"ocfs2_fs.h\"",
            "#include \"stackglue.h\"",
            "#include <linux/jbd2.h>",
            "#include <linux/lockdep.h>",
            "#include <linux/mutex.h>",
            "#include <linux/kref.h>",
            "#include <linux/workqueue.h>",
            "#include <linux/rbtree.h>",
            "#include <linux/llist.h>",
            "#include <linux/list.h>",
            "#include <linux/wait.h>",
            "#include <linux/sched.h>",
            "#include <linux/spinlock.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"reservations.h\"\n#include \"blockcheck.h\"\n#include \"ocfs2_ioctl.h\"\n#include \"ocfs2_lockid.h\"\n#include \"ocfs2_fs.h\"\n#include \"stackglue.h\"\n#include <linux/jbd2.h>\n#include <linux/lockdep.h>\n#include <linux/mutex.h>\n#include <linux/kref.h>\n#include <linux/workqueue.h>\n#include <linux/rbtree.h>\n#include <linux/llist.h>\n#include <linux/list.h>\n#include <linux/wait.h>\n#include <linux/sched.h>\n#include <linux/spinlock.h>\n\nstatic inline void ocfs2_set_bit_unaligned(int bit, void *bitmap)\n{\n\tbitmap = correct_addr_and_bit_unaligned(&bit, bitmap);\n\tocfs2_set_bit(bit, bitmap);\n}"
        }
      },
      {
        "call_info": {
          "callee": "mod_delayed_work",
          "args": [
            "system_wq",
            "&clp->cl_renewd",
            "timeout"
          ],
          "line": 128
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dprintk",
          "args": [
            "\"%s: requeueing work. Lease period = %ld\\n\"",
            "__func__",
            "(timeout + HZ - 1) / HZ"
          ],
          "line": 126
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "spin_lock",
          "args": [
            "&clp->cl_lock"
          ],
          "line": 121
        },
        "resolved": true,
        "details": {
          "function_name": "__spin_lock_mb_cache_entry",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/mbcache.c",
          "lines": "132-137",
          "snippet": "static inline void\n__spin_lock_mb_cache_entry(struct mb_cache_entry *ce)\n{\n\tspin_lock(bgl_lock_ptr(mb_cache_bg_lock,\n\t\tMB_CACHE_ENTRY_LOCK_INDEX(ce)));\n}",
          "includes": [
            "#include <linux/log2.h>",
            "#include <linux/blockgroup_lock.h>",
            "#include <linux/init.h>",
            "#include <linux/mbcache.h>",
            "#include <linux/list_bl.h>",
            "#include <linux/sched.h>",
            "#include <linux/slab.h>",
            "#include <linux/mm.h>",
            "#include <linux/fs.h>",
            "#include <linux/hash.h>",
            "#include <linux/module.h>",
            "#include <linux/kernel.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static struct blockgroup_lock *mb_cache_bg_lock;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <linux/log2.h>\n#include <linux/blockgroup_lock.h>\n#include <linux/init.h>\n#include <linux/mbcache.h>\n#include <linux/list_bl.h>\n#include <linux/sched.h>\n#include <linux/slab.h>\n#include <linux/mm.h>\n#include <linux/fs.h>\n#include <linux/hash.h>\n#include <linux/module.h>\n#include <linux/kernel.h>\n\nstatic struct blockgroup_lock *mb_cache_bg_lock;\n\nstatic inline void\n__spin_lock_mb_cache_entry(struct mb_cache_entry *ce)\n{\n\tspin_lock(bgl_lock_ptr(mb_cache_bg_lock,\n\t\tMB_CACHE_ENTRY_LOCK_INDEX(ce)));\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"delegation.h\"\n#include \"nfs4_fs.h\"\n#include <linux/nfs_fs.h>\n#include <linux/nfs4.h>\n#include <linux/nfs.h>\n#include <linux/sunrpc/clnt.h>\n#include <linux/sunrpc/sched.h>\n#include <linux/pagemap.h>\n#include <linux/mm.h>\n\nvoid\nnfs4_schedule_state_renewal(struct nfs_client *clp)\n{\n\tlong timeout;\n\n\tspin_lock(&clp->cl_lock);\n\ttimeout = (2 * clp->cl_lease_time) / 3 + (long)clp->cl_last_renewal\n\t\t- (long)jiffies;\n\tif (timeout < 5 * HZ)\n\t\ttimeout = 5 * HZ;\n\tdprintk(\"%s: requeueing work. Lease period = %ld\\n\",\n\t\t\t__func__, (timeout + HZ - 1) / HZ);\n\tmod_delayed_work(system_wq, &clp->cl_renewd, timeout);\n\tset_bit(NFS_CS_RENEWD, &clp->cl_res_state);\n\tspin_unlock(&clp->cl_lock);\n}"
  },
  {
    "function_name": "nfs4_renew_state",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nfs/nfs4renewd.c",
    "lines": "54-114",
    "snippet": "void\nnfs4_renew_state(struct work_struct *work)\n{\n\tconst struct nfs4_state_maintenance_ops *ops;\n\tstruct nfs_client *clp =\n\t\tcontainer_of(work, struct nfs_client, cl_renewd.work);\n\tstruct rpc_cred *cred;\n\tlong lease;\n\tunsigned long last, now;\n\tunsigned renew_flags = 0;\n\n\tops = clp->cl_mvops->state_renewal_ops;\n\tdprintk(\"%s: start\\n\", __func__);\n\n\tif (test_bit(NFS_CS_STOP_RENEW, &clp->cl_res_state))\n\t\tgoto out;\n\n\tspin_lock(&clp->cl_lock);\n\tlease = clp->cl_lease_time;\n\tlast = clp->cl_last_renewal;\n\tnow = jiffies;\n\t/* Are we close to a lease timeout? */\n\tif (time_after(now, last + lease/3))\n\t\trenew_flags |= NFS4_RENEW_TIMEOUT;\n\tif (nfs_delegations_present(clp))\n\t\trenew_flags |= NFS4_RENEW_DELEGATION_CB;\n\n\tif (renew_flags != 0) {\n\t\tcred = ops->get_state_renewal_cred_locked(clp);\n\t\tspin_unlock(&clp->cl_lock);\n\t\tif (cred == NULL) {\n\t\t\tif (!(renew_flags & NFS4_RENEW_DELEGATION_CB)) {\n\t\t\t\tset_bit(NFS4CLNT_LEASE_EXPIRED, &clp->cl_state);\n\t\t\t\tgoto out;\n\t\t\t}\n\t\t\tnfs_expire_all_delegations(clp);\n\t\t} else {\n\t\t\tint ret;\n\n\t\t\t/* Queue an asynchronous RENEW. */\n\t\t\tret = ops->sched_state_renewal(clp, cred, renew_flags);\n\t\t\tput_rpccred(cred);\n\t\t\tswitch (ret) {\n\t\t\tdefault:\n\t\t\t\tgoto out_exp;\n\t\t\tcase -EAGAIN:\n\t\t\tcase -ENOMEM:\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t} else {\n\t\tdprintk(\"%s: failed to call renewd. Reason: lease not expired \\n\",\n\t\t\t\t__func__);\n\t\tspin_unlock(&clp->cl_lock);\n\t}\n\tnfs4_schedule_state_renewal(clp);\nout_exp:\n\tnfs_expire_unreferenced_delegations(clp);\nout:\n\tdprintk(\"%s: done\\n\", __func__);\n}",
    "includes": [
      "#include \"delegation.h\"",
      "#include \"nfs4_fs.h\"",
      "#include <linux/nfs_fs.h>",
      "#include <linux/nfs4.h>",
      "#include <linux/nfs.h>",
      "#include <linux/sunrpc/clnt.h>",
      "#include <linux/sunrpc/sched.h>",
      "#include <linux/pagemap.h>",
      "#include <linux/mm.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "dprintk",
          "args": [
            "\"%s: done\\n\"",
            "__func__"
          ],
          "line": 113
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "nfs_expire_unreferenced_delegations",
          "args": [
            "clp"
          ],
          "line": 111
        },
        "resolved": true,
        "details": {
          "function_name": "nfs_expire_unreferenced_delegations",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nfs/delegation.c",
          "lines": "696-706",
          "snippet": "void nfs_expire_unreferenced_delegations(struct nfs_client *clp)\n{\n\tstruct nfs_server *server;\n\n\trcu_read_lock();\n\tlist_for_each_entry_rcu(server, &clp->cl_superblocks, client_link)\n\t\tnfs_mark_return_unreferenced_delegations(server);\n\trcu_read_unlock();\n\n\tnfs_delegation_run_state_manager(clp);\n}",
          "includes": [
            "#include \"nfs4trace.h\"",
            "#include \"internal.h\"",
            "#include \"delegation.h\"",
            "#include \"nfs4_fs.h\"",
            "#include <linux/nfs_xdr.h>",
            "#include <linux/nfs_fs.h>",
            "#include <linux/nfs4.h>",
            "#include <linux/spinlock.h>",
            "#include <linux/slab.h>",
            "#include <linux/sched.h>",
            "#include <linux/module.h>",
            "#include <linux/kthread.h>",
            "#include <linux/completion.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"nfs4trace.h\"\n#include \"internal.h\"\n#include \"delegation.h\"\n#include \"nfs4_fs.h\"\n#include <linux/nfs_xdr.h>\n#include <linux/nfs_fs.h>\n#include <linux/nfs4.h>\n#include <linux/spinlock.h>\n#include <linux/slab.h>\n#include <linux/sched.h>\n#include <linux/module.h>\n#include <linux/kthread.h>\n#include <linux/completion.h>\n\nvoid nfs_expire_unreferenced_delegations(struct nfs_client *clp)\n{\n\tstruct nfs_server *server;\n\n\trcu_read_lock();\n\tlist_for_each_entry_rcu(server, &clp->cl_superblocks, client_link)\n\t\tnfs_mark_return_unreferenced_delegations(server);\n\trcu_read_unlock();\n\n\tnfs_delegation_run_state_manager(clp);\n}"
        }
      },
      {
        "call_info": {
          "callee": "nfs4_schedule_state_renewal",
          "args": [
            "clp"
          ],
          "line": 109
        },
        "resolved": true,
        "details": {
          "function_name": "nfs4_schedule_state_renewal",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nfs/nfs4renewd.c",
          "lines": "116-131",
          "snippet": "void\nnfs4_schedule_state_renewal(struct nfs_client *clp)\n{\n\tlong timeout;\n\n\tspin_lock(&clp->cl_lock);\n\ttimeout = (2 * clp->cl_lease_time) / 3 + (long)clp->cl_last_renewal\n\t\t- (long)jiffies;\n\tif (timeout < 5 * HZ)\n\t\ttimeout = 5 * HZ;\n\tdprintk(\"%s: requeueing work. Lease period = %ld\\n\",\n\t\t\t__func__, (timeout + HZ - 1) / HZ);\n\tmod_delayed_work(system_wq, &clp->cl_renewd, timeout);\n\tset_bit(NFS_CS_RENEWD, &clp->cl_res_state);\n\tspin_unlock(&clp->cl_lock);\n}",
          "includes": [
            "#include \"delegation.h\"",
            "#include \"nfs4_fs.h\"",
            "#include <linux/nfs_fs.h>",
            "#include <linux/nfs4.h>",
            "#include <linux/nfs.h>",
            "#include <linux/sunrpc/clnt.h>",
            "#include <linux/sunrpc/sched.h>",
            "#include <linux/pagemap.h>",
            "#include <linux/mm.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"delegation.h\"\n#include \"nfs4_fs.h\"\n#include <linux/nfs_fs.h>\n#include <linux/nfs4.h>\n#include <linux/nfs.h>\n#include <linux/sunrpc/clnt.h>\n#include <linux/sunrpc/sched.h>\n#include <linux/pagemap.h>\n#include <linux/mm.h>\n\nvoid\nnfs4_schedule_state_renewal(struct nfs_client *clp)\n{\n\tlong timeout;\n\n\tspin_lock(&clp->cl_lock);\n\ttimeout = (2 * clp->cl_lease_time) / 3 + (long)clp->cl_last_renewal\n\t\t- (long)jiffies;\n\tif (timeout < 5 * HZ)\n\t\ttimeout = 5 * HZ;\n\tdprintk(\"%s: requeueing work. Lease period = %ld\\n\",\n\t\t\t__func__, (timeout + HZ - 1) / HZ);\n\tmod_delayed_work(system_wq, &clp->cl_renewd, timeout);\n\tset_bit(NFS_CS_RENEWD, &clp->cl_res_state);\n\tspin_unlock(&clp->cl_lock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "spin_unlock",
          "args": [
            "&clp->cl_lock"
          ],
          "line": 107
        },
        "resolved": true,
        "details": {
          "function_name": "__spin_unlock_mb_cache_entry",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/mbcache.c",
          "lines": "139-144",
          "snippet": "static inline void\n__spin_unlock_mb_cache_entry(struct mb_cache_entry *ce)\n{\n\tspin_unlock(bgl_lock_ptr(mb_cache_bg_lock,\n\t\tMB_CACHE_ENTRY_LOCK_INDEX(ce)));\n}",
          "includes": [
            "#include <linux/log2.h>",
            "#include <linux/blockgroup_lock.h>",
            "#include <linux/init.h>",
            "#include <linux/mbcache.h>",
            "#include <linux/list_bl.h>",
            "#include <linux/sched.h>",
            "#include <linux/slab.h>",
            "#include <linux/mm.h>",
            "#include <linux/fs.h>",
            "#include <linux/hash.h>",
            "#include <linux/module.h>",
            "#include <linux/kernel.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static struct blockgroup_lock *mb_cache_bg_lock;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <linux/log2.h>\n#include <linux/blockgroup_lock.h>\n#include <linux/init.h>\n#include <linux/mbcache.h>\n#include <linux/list_bl.h>\n#include <linux/sched.h>\n#include <linux/slab.h>\n#include <linux/mm.h>\n#include <linux/fs.h>\n#include <linux/hash.h>\n#include <linux/module.h>\n#include <linux/kernel.h>\n\nstatic struct blockgroup_lock *mb_cache_bg_lock;\n\nstatic inline void\n__spin_unlock_mb_cache_entry(struct mb_cache_entry *ce)\n{\n\tspin_unlock(bgl_lock_ptr(mb_cache_bg_lock,\n\t\tMB_CACHE_ENTRY_LOCK_INDEX(ce)));\n}"
        }
      },
      {
        "call_info": {
          "callee": "dprintk",
          "args": [
            "\"%s: failed to call renewd. Reason: lease not expired \\n\"",
            "__func__"
          ],
          "line": 105
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "put_rpccred",
          "args": [
            "cred"
          ],
          "line": 95
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ops->sched_state_renewal",
          "args": [
            "clp",
            "cred",
            "renew_flags"
          ],
          "line": 94
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "nfs_expire_all_delegations",
          "args": [
            "clp"
          ],
          "line": 89
        },
        "resolved": true,
        "details": {
          "function_name": "nfs_expire_all_delegations",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nfs/delegation.c",
          "lines": "590-594",
          "snippet": "void nfs_expire_all_delegations(struct nfs_client *clp)\n{\n\tnfs_client_mark_return_all_delegations(clp);\n\tnfs_delegation_run_state_manager(clp);\n}",
          "includes": [
            "#include \"nfs4trace.h\"",
            "#include \"internal.h\"",
            "#include \"delegation.h\"",
            "#include \"nfs4_fs.h\"",
            "#include <linux/nfs_xdr.h>",
            "#include <linux/nfs_fs.h>",
            "#include <linux/nfs4.h>",
            "#include <linux/spinlock.h>",
            "#include <linux/slab.h>",
            "#include <linux/sched.h>",
            "#include <linux/module.h>",
            "#include <linux/kthread.h>",
            "#include <linux/completion.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"nfs4trace.h\"\n#include \"internal.h\"\n#include \"delegation.h\"\n#include \"nfs4_fs.h\"\n#include <linux/nfs_xdr.h>\n#include <linux/nfs_fs.h>\n#include <linux/nfs4.h>\n#include <linux/spinlock.h>\n#include <linux/slab.h>\n#include <linux/sched.h>\n#include <linux/module.h>\n#include <linux/kthread.h>\n#include <linux/completion.h>\n\nvoid nfs_expire_all_delegations(struct nfs_client *clp)\n{\n\tnfs_client_mark_return_all_delegations(clp);\n\tnfs_delegation_run_state_manager(clp);\n}"
        }
      },
      {
        "call_info": {
          "callee": "set_bit",
          "args": [
            "NFS4CLNT_LEASE_EXPIRED",
            "&clp->cl_state"
          ],
          "line": 86
        },
        "resolved": true,
        "details": {
          "function_name": "ocfs2_set_bit_unaligned",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/ocfs2/ocfs2.h",
          "lines": "886-890",
          "snippet": "static inline void ocfs2_set_bit_unaligned(int bit, void *bitmap)\n{\n\tbitmap = correct_addr_and_bit_unaligned(&bit, bitmap);\n\tocfs2_set_bit(bit, bitmap);\n}",
          "includes": [
            "#include \"reservations.h\"",
            "#include \"blockcheck.h\"",
            "#include \"ocfs2_ioctl.h\"",
            "#include \"ocfs2_lockid.h\"",
            "#include \"ocfs2_fs.h\"",
            "#include \"stackglue.h\"",
            "#include <linux/jbd2.h>",
            "#include <linux/lockdep.h>",
            "#include <linux/mutex.h>",
            "#include <linux/kref.h>",
            "#include <linux/workqueue.h>",
            "#include <linux/rbtree.h>",
            "#include <linux/llist.h>",
            "#include <linux/list.h>",
            "#include <linux/wait.h>",
            "#include <linux/sched.h>",
            "#include <linux/spinlock.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"reservations.h\"\n#include \"blockcheck.h\"\n#include \"ocfs2_ioctl.h\"\n#include \"ocfs2_lockid.h\"\n#include \"ocfs2_fs.h\"\n#include \"stackglue.h\"\n#include <linux/jbd2.h>\n#include <linux/lockdep.h>\n#include <linux/mutex.h>\n#include <linux/kref.h>\n#include <linux/workqueue.h>\n#include <linux/rbtree.h>\n#include <linux/llist.h>\n#include <linux/list.h>\n#include <linux/wait.h>\n#include <linux/sched.h>\n#include <linux/spinlock.h>\n\nstatic inline void ocfs2_set_bit_unaligned(int bit, void *bitmap)\n{\n\tbitmap = correct_addr_and_bit_unaligned(&bit, bitmap);\n\tocfs2_set_bit(bit, bitmap);\n}"
        }
      },
      {
        "call_info": {
          "callee": "ops->get_state_renewal_cred_locked",
          "args": [
            "clp"
          ],
          "line": 82
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "nfs_delegations_present",
          "args": [
            "clp"
          ],
          "line": 78
        },
        "resolved": true,
        "details": {
          "function_name": "nfs_delegations_present",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nfs/delegation.c",
          "lines": "861-874",
          "snippet": "int nfs_delegations_present(struct nfs_client *clp)\n{\n\tstruct nfs_server *server;\n\tint ret = 0;\n\n\trcu_read_lock();\n\tlist_for_each_entry_rcu(server, &clp->cl_superblocks, client_link)\n\t\tif (!list_empty(&server->delegations)) {\n\t\t\tret = 1;\n\t\t\tbreak;\n\t\t}\n\trcu_read_unlock();\n\treturn ret;\n}",
          "includes": [
            "#include \"nfs4trace.h\"",
            "#include \"internal.h\"",
            "#include \"delegation.h\"",
            "#include \"nfs4_fs.h\"",
            "#include <linux/nfs_xdr.h>",
            "#include <linux/nfs_fs.h>",
            "#include <linux/nfs4.h>",
            "#include <linux/spinlock.h>",
            "#include <linux/slab.h>",
            "#include <linux/sched.h>",
            "#include <linux/module.h>",
            "#include <linux/kthread.h>",
            "#include <linux/completion.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"nfs4trace.h\"\n#include \"internal.h\"\n#include \"delegation.h\"\n#include \"nfs4_fs.h\"\n#include <linux/nfs_xdr.h>\n#include <linux/nfs_fs.h>\n#include <linux/nfs4.h>\n#include <linux/spinlock.h>\n#include <linux/slab.h>\n#include <linux/sched.h>\n#include <linux/module.h>\n#include <linux/kthread.h>\n#include <linux/completion.h>\n\nint nfs_delegations_present(struct nfs_client *clp)\n{\n\tstruct nfs_server *server;\n\tint ret = 0;\n\n\trcu_read_lock();\n\tlist_for_each_entry_rcu(server, &clp->cl_superblocks, client_link)\n\t\tif (!list_empty(&server->delegations)) {\n\t\t\tret = 1;\n\t\t\tbreak;\n\t\t}\n\trcu_read_unlock();\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "time_after",
          "args": [
            "now",
            "last + lease/3"
          ],
          "line": 76
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "spin_lock",
          "args": [
            "&clp->cl_lock"
          ],
          "line": 71
        },
        "resolved": true,
        "details": {
          "function_name": "__spin_lock_mb_cache_entry",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/mbcache.c",
          "lines": "132-137",
          "snippet": "static inline void\n__spin_lock_mb_cache_entry(struct mb_cache_entry *ce)\n{\n\tspin_lock(bgl_lock_ptr(mb_cache_bg_lock,\n\t\tMB_CACHE_ENTRY_LOCK_INDEX(ce)));\n}",
          "includes": [
            "#include <linux/log2.h>",
            "#include <linux/blockgroup_lock.h>",
            "#include <linux/init.h>",
            "#include <linux/mbcache.h>",
            "#include <linux/list_bl.h>",
            "#include <linux/sched.h>",
            "#include <linux/slab.h>",
            "#include <linux/mm.h>",
            "#include <linux/fs.h>",
            "#include <linux/hash.h>",
            "#include <linux/module.h>",
            "#include <linux/kernel.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static struct blockgroup_lock *mb_cache_bg_lock;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <linux/log2.h>\n#include <linux/blockgroup_lock.h>\n#include <linux/init.h>\n#include <linux/mbcache.h>\n#include <linux/list_bl.h>\n#include <linux/sched.h>\n#include <linux/slab.h>\n#include <linux/mm.h>\n#include <linux/fs.h>\n#include <linux/hash.h>\n#include <linux/module.h>\n#include <linux/kernel.h>\n\nstatic struct blockgroup_lock *mb_cache_bg_lock;\n\nstatic inline void\n__spin_lock_mb_cache_entry(struct mb_cache_entry *ce)\n{\n\tspin_lock(bgl_lock_ptr(mb_cache_bg_lock,\n\t\tMB_CACHE_ENTRY_LOCK_INDEX(ce)));\n}"
        }
      },
      {
        "call_info": {
          "callee": "test_bit",
          "args": [
            "NFS_CS_STOP_RENEW",
            "&clp->cl_res_state"
          ],
          "line": 68
        },
        "resolved": true,
        "details": {
          "function_name": "ocfs2_test_bit_unaligned",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/ocfs2/ocfs2.h",
          "lines": "898-902",
          "snippet": "static inline int ocfs2_test_bit_unaligned(int bit, void *bitmap)\n{\n\tbitmap = correct_addr_and_bit_unaligned(&bit, bitmap);\n\treturn ocfs2_test_bit(bit, bitmap);\n}",
          "includes": [
            "#include \"reservations.h\"",
            "#include \"blockcheck.h\"",
            "#include \"ocfs2_ioctl.h\"",
            "#include \"ocfs2_lockid.h\"",
            "#include \"ocfs2_fs.h\"",
            "#include \"stackglue.h\"",
            "#include <linux/jbd2.h>",
            "#include <linux/lockdep.h>",
            "#include <linux/mutex.h>",
            "#include <linux/kref.h>",
            "#include <linux/workqueue.h>",
            "#include <linux/rbtree.h>",
            "#include <linux/llist.h>",
            "#include <linux/list.h>",
            "#include <linux/wait.h>",
            "#include <linux/sched.h>",
            "#include <linux/spinlock.h>"
          ],
          "macros_used": [
            "#define ocfs2_test_bit test_bit_le"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"reservations.h\"\n#include \"blockcheck.h\"\n#include \"ocfs2_ioctl.h\"\n#include \"ocfs2_lockid.h\"\n#include \"ocfs2_fs.h\"\n#include \"stackglue.h\"\n#include <linux/jbd2.h>\n#include <linux/lockdep.h>\n#include <linux/mutex.h>\n#include <linux/kref.h>\n#include <linux/workqueue.h>\n#include <linux/rbtree.h>\n#include <linux/llist.h>\n#include <linux/list.h>\n#include <linux/wait.h>\n#include <linux/sched.h>\n#include <linux/spinlock.h>\n\n#define ocfs2_test_bit test_bit_le\n\nstatic inline int ocfs2_test_bit_unaligned(int bit, void *bitmap)\n{\n\tbitmap = correct_addr_and_bit_unaligned(&bit, bitmap);\n\treturn ocfs2_test_bit(bit, bitmap);\n}"
        }
      },
      {
        "call_info": {
          "callee": "dprintk",
          "args": [
            "\"%s: start\\n\"",
            "__func__"
          ],
          "line": 66
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "container_of",
          "args": [
            "work",
            "structnfs_client",
            "cl_renewd.work"
          ],
          "line": 59
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"delegation.h\"\n#include \"nfs4_fs.h\"\n#include <linux/nfs_fs.h>\n#include <linux/nfs4.h>\n#include <linux/nfs.h>\n#include <linux/sunrpc/clnt.h>\n#include <linux/sunrpc/sched.h>\n#include <linux/pagemap.h>\n#include <linux/mm.h>\n\nvoid\nnfs4_renew_state(struct work_struct *work)\n{\n\tconst struct nfs4_state_maintenance_ops *ops;\n\tstruct nfs_client *clp =\n\t\tcontainer_of(work, struct nfs_client, cl_renewd.work);\n\tstruct rpc_cred *cred;\n\tlong lease;\n\tunsigned long last, now;\n\tunsigned renew_flags = 0;\n\n\tops = clp->cl_mvops->state_renewal_ops;\n\tdprintk(\"%s: start\\n\", __func__);\n\n\tif (test_bit(NFS_CS_STOP_RENEW, &clp->cl_res_state))\n\t\tgoto out;\n\n\tspin_lock(&clp->cl_lock);\n\tlease = clp->cl_lease_time;\n\tlast = clp->cl_last_renewal;\n\tnow = jiffies;\n\t/* Are we close to a lease timeout? */\n\tif (time_after(now, last + lease/3))\n\t\trenew_flags |= NFS4_RENEW_TIMEOUT;\n\tif (nfs_delegations_present(clp))\n\t\trenew_flags |= NFS4_RENEW_DELEGATION_CB;\n\n\tif (renew_flags != 0) {\n\t\tcred = ops->get_state_renewal_cred_locked(clp);\n\t\tspin_unlock(&clp->cl_lock);\n\t\tif (cred == NULL) {\n\t\t\tif (!(renew_flags & NFS4_RENEW_DELEGATION_CB)) {\n\t\t\t\tset_bit(NFS4CLNT_LEASE_EXPIRED, &clp->cl_state);\n\t\t\t\tgoto out;\n\t\t\t}\n\t\t\tnfs_expire_all_delegations(clp);\n\t\t} else {\n\t\t\tint ret;\n\n\t\t\t/* Queue an asynchronous RENEW. */\n\t\t\tret = ops->sched_state_renewal(clp, cred, renew_flags);\n\t\t\tput_rpccred(cred);\n\t\t\tswitch (ret) {\n\t\t\tdefault:\n\t\t\t\tgoto out_exp;\n\t\t\tcase -EAGAIN:\n\t\t\tcase -ENOMEM:\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t} else {\n\t\tdprintk(\"%s: failed to call renewd. Reason: lease not expired \\n\",\n\t\t\t\t__func__);\n\t\tspin_unlock(&clp->cl_lock);\n\t}\n\tnfs4_schedule_state_renewal(clp);\nout_exp:\n\tnfs_expire_unreferenced_delegations(clp);\nout:\n\tdprintk(\"%s: done\\n\", __func__);\n}"
  }
]