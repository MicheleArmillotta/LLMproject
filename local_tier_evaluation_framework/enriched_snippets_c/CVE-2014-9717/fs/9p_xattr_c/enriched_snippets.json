[
  {
    "function_name": "v9fs_listxattr",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/9p/xattr.c",
    "lines": "165-168",
    "snippet": "ssize_t v9fs_listxattr(struct dentry *dentry, char *buffer, size_t buffer_size)\n{\n\treturn v9fs_xattr_get(dentry, NULL, buffer, buffer_size);\n}",
    "includes": [
      "#include \"xattr.h\"",
      "#include \"fid.h\"",
      "#include <net/9p/client.h>",
      "#include <net/9p/9p.h>",
      "#include <linux/sched.h>",
      "#include <linux/fs.h>",
      "#include <linux/module.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "v9fs_xattr_get",
          "args": [
            "dentry",
            "NULL",
            "buffer",
            "buffer_size"
          ],
          "line": 167
        },
        "resolved": true,
        "details": {
          "function_name": "v9fs_xattr_get",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/9p/xattr.c",
          "lines": "85-97",
          "snippet": "ssize_t v9fs_xattr_get(struct dentry *dentry, const char *name,\n\t\t       void *buffer, size_t buffer_size)\n{\n\tstruct p9_fid *fid;\n\n\tp9_debug(P9_DEBUG_VFS, \"name = %s value_len = %zu\\n\",\n\t\t name, buffer_size);\n\tfid = v9fs_fid_lookup(dentry);\n\tif (IS_ERR(fid))\n\t\treturn PTR_ERR(fid);\n\n\treturn v9fs_fid_xattr_get(fid, name, buffer, buffer_size);\n}",
          "includes": [
            "#include \"xattr.h\"",
            "#include \"fid.h\"",
            "#include <net/9p/client.h>",
            "#include <net/9p/9p.h>",
            "#include <linux/sched.h>",
            "#include <linux/fs.h>",
            "#include <linux/module.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"xattr.h\"\n#include \"fid.h\"\n#include <net/9p/client.h>\n#include <net/9p/9p.h>\n#include <linux/sched.h>\n#include <linux/fs.h>\n#include <linux/module.h>\n\nssize_t v9fs_xattr_get(struct dentry *dentry, const char *name,\n\t\t       void *buffer, size_t buffer_size)\n{\n\tstruct p9_fid *fid;\n\n\tp9_debug(P9_DEBUG_VFS, \"name = %s value_len = %zu\\n\",\n\t\t name, buffer_size);\n\tfid = v9fs_fid_lookup(dentry);\n\tif (IS_ERR(fid))\n\t\treturn PTR_ERR(fid);\n\n\treturn v9fs_fid_xattr_get(fid, name, buffer, buffer_size);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"xattr.h\"\n#include \"fid.h\"\n#include <net/9p/client.h>\n#include <net/9p/9p.h>\n#include <linux/sched.h>\n#include <linux/fs.h>\n#include <linux/module.h>\n\nssize_t v9fs_listxattr(struct dentry *dentry, char *buffer, size_t buffer_size)\n{\n\treturn v9fs_xattr_get(dentry, NULL, buffer, buffer_size);\n}"
  },
  {
    "function_name": "v9fs_fid_xattr_set",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/9p/xattr.c",
    "lines": "120-163",
    "snippet": "int v9fs_fid_xattr_set(struct p9_fid *fid, const char *name,\n\t\t   const void *value, size_t value_len, int flags)\n{\n\tu64 offset = 0;\n\tint retval, msize, write_count;\n\n\tp9_debug(P9_DEBUG_VFS, \"name = %s value_len = %zu flags = %d\\n\",\n\t\t name, value_len, flags);\n\n\t/* Clone it */\n\tfid = p9_client_walk(fid, 0, NULL, 1);\n\tif (IS_ERR(fid))\n\t\treturn PTR_ERR(fid);\n\n\t/*\n\t * On success fid points to xattr\n\t */\n\tretval = p9_client_xattrcreate(fid, name, value_len, flags);\n\tif (retval < 0) {\n\t\tp9_debug(P9_DEBUG_VFS, \"p9_client_xattrcreate failed %d\\n\",\n\t\t\t retval);\n\t\tgoto err;\n\t}\n\tmsize = fid->clnt->msize;\n\twhile (value_len) {\n\t\tif (value_len > (msize - P9_IOHDRSZ))\n\t\t\twrite_count = msize - P9_IOHDRSZ;\n\t\telse\n\t\t\twrite_count = value_len;\n\t\twrite_count = p9_client_write(fid, ((char *)value)+offset,\n\t\t\t\t\tNULL, offset, write_count);\n\t\tif (write_count < 0) {\n\t\t\t/* error in xattr write */\n\t\t\tretval = write_count;\n\t\t\tgoto err;\n\t\t}\n\t\toffset += write_count;\n\t\tvalue_len -= write_count;\n\t}\n\tretval = 0;\nerr:\n\tp9_client_clunk(fid);\n\treturn retval;\n}",
    "includes": [
      "#include \"xattr.h\"",
      "#include \"fid.h\"",
      "#include <net/9p/client.h>",
      "#include <net/9p/9p.h>",
      "#include <linux/sched.h>",
      "#include <linux/fs.h>",
      "#include <linux/module.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "p9_client_clunk",
          "args": [
            "fid"
          ],
          "line": 161
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "p9_client_write",
          "args": [
            "fid",
            "((char *)value)+offset",
            "NULL",
            "offset",
            "write_count"
          ],
          "line": 149
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "p9_debug",
          "args": [
            "P9_DEBUG_VFS",
            "\"p9_client_xattrcreate failed %d\\n\"",
            "retval"
          ],
          "line": 139
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "p9_client_xattrcreate",
          "args": [
            "fid",
            "name",
            "value_len",
            "flags"
          ],
          "line": 137
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "PTR_ERR",
          "args": [
            "fid"
          ],
          "line": 132
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "IS_ERR",
          "args": [
            "fid"
          ],
          "line": 131
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "p9_client_walk",
          "args": [
            "fid",
            "0",
            "NULL",
            "1"
          ],
          "line": 130
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "p9_debug",
          "args": [
            "P9_DEBUG_VFS",
            "\"name = %s value_len = %zu flags = %d\\n\"",
            "name",
            "value_len",
            "flags"
          ],
          "line": 126
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"xattr.h\"\n#include \"fid.h\"\n#include <net/9p/client.h>\n#include <net/9p/9p.h>\n#include <linux/sched.h>\n#include <linux/fs.h>\n#include <linux/module.h>\n\nint v9fs_fid_xattr_set(struct p9_fid *fid, const char *name,\n\t\t   const void *value, size_t value_len, int flags)\n{\n\tu64 offset = 0;\n\tint retval, msize, write_count;\n\n\tp9_debug(P9_DEBUG_VFS, \"name = %s value_len = %zu flags = %d\\n\",\n\t\t name, value_len, flags);\n\n\t/* Clone it */\n\tfid = p9_client_walk(fid, 0, NULL, 1);\n\tif (IS_ERR(fid))\n\t\treturn PTR_ERR(fid);\n\n\t/*\n\t * On success fid points to xattr\n\t */\n\tretval = p9_client_xattrcreate(fid, name, value_len, flags);\n\tif (retval < 0) {\n\t\tp9_debug(P9_DEBUG_VFS, \"p9_client_xattrcreate failed %d\\n\",\n\t\t\t retval);\n\t\tgoto err;\n\t}\n\tmsize = fid->clnt->msize;\n\twhile (value_len) {\n\t\tif (value_len > (msize - P9_IOHDRSZ))\n\t\t\twrite_count = msize - P9_IOHDRSZ;\n\t\telse\n\t\t\twrite_count = value_len;\n\t\twrite_count = p9_client_write(fid, ((char *)value)+offset,\n\t\t\t\t\tNULL, offset, write_count);\n\t\tif (write_count < 0) {\n\t\t\t/* error in xattr write */\n\t\t\tretval = write_count;\n\t\t\tgoto err;\n\t\t}\n\t\toffset += write_count;\n\t\tvalue_len -= write_count;\n\t}\n\tretval = 0;\nerr:\n\tp9_client_clunk(fid);\n\treturn retval;\n}"
  },
  {
    "function_name": "v9fs_xattr_set",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/9p/xattr.c",
    "lines": "111-118",
    "snippet": "int v9fs_xattr_set(struct dentry *dentry, const char *name,\n\t\t   const void *value, size_t value_len, int flags)\n{\n\tstruct p9_fid *fid = v9fs_fid_lookup(dentry);\n\tif (IS_ERR(fid))\n\t\treturn PTR_ERR(fid);\n\treturn v9fs_fid_xattr_set(fid, name, value, value_len, flags);\n}",
    "includes": [
      "#include \"xattr.h\"",
      "#include \"fid.h\"",
      "#include <net/9p/client.h>",
      "#include <net/9p/9p.h>",
      "#include <linux/sched.h>",
      "#include <linux/fs.h>",
      "#include <linux/module.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "v9fs_fid_xattr_set",
          "args": [
            "fid",
            "name",
            "value",
            "value_len",
            "flags"
          ],
          "line": 117
        },
        "resolved": true,
        "details": {
          "function_name": "v9fs_fid_xattr_set",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/9p/xattr.c",
          "lines": "120-163",
          "snippet": "int v9fs_fid_xattr_set(struct p9_fid *fid, const char *name,\n\t\t   const void *value, size_t value_len, int flags)\n{\n\tu64 offset = 0;\n\tint retval, msize, write_count;\n\n\tp9_debug(P9_DEBUG_VFS, \"name = %s value_len = %zu flags = %d\\n\",\n\t\t name, value_len, flags);\n\n\t/* Clone it */\n\tfid = p9_client_walk(fid, 0, NULL, 1);\n\tif (IS_ERR(fid))\n\t\treturn PTR_ERR(fid);\n\n\t/*\n\t * On success fid points to xattr\n\t */\n\tretval = p9_client_xattrcreate(fid, name, value_len, flags);\n\tif (retval < 0) {\n\t\tp9_debug(P9_DEBUG_VFS, \"p9_client_xattrcreate failed %d\\n\",\n\t\t\t retval);\n\t\tgoto err;\n\t}\n\tmsize = fid->clnt->msize;\n\twhile (value_len) {\n\t\tif (value_len > (msize - P9_IOHDRSZ))\n\t\t\twrite_count = msize - P9_IOHDRSZ;\n\t\telse\n\t\t\twrite_count = value_len;\n\t\twrite_count = p9_client_write(fid, ((char *)value)+offset,\n\t\t\t\t\tNULL, offset, write_count);\n\t\tif (write_count < 0) {\n\t\t\t/* error in xattr write */\n\t\t\tretval = write_count;\n\t\t\tgoto err;\n\t\t}\n\t\toffset += write_count;\n\t\tvalue_len -= write_count;\n\t}\n\tretval = 0;\nerr:\n\tp9_client_clunk(fid);\n\treturn retval;\n}",
          "includes": [
            "#include \"xattr.h\"",
            "#include \"fid.h\"",
            "#include <net/9p/client.h>",
            "#include <net/9p/9p.h>",
            "#include <linux/sched.h>",
            "#include <linux/fs.h>",
            "#include <linux/module.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"xattr.h\"\n#include \"fid.h\"\n#include <net/9p/client.h>\n#include <net/9p/9p.h>\n#include <linux/sched.h>\n#include <linux/fs.h>\n#include <linux/module.h>\n\nint v9fs_fid_xattr_set(struct p9_fid *fid, const char *name,\n\t\t   const void *value, size_t value_len, int flags)\n{\n\tu64 offset = 0;\n\tint retval, msize, write_count;\n\n\tp9_debug(P9_DEBUG_VFS, \"name = %s value_len = %zu flags = %d\\n\",\n\t\t name, value_len, flags);\n\n\t/* Clone it */\n\tfid = p9_client_walk(fid, 0, NULL, 1);\n\tif (IS_ERR(fid))\n\t\treturn PTR_ERR(fid);\n\n\t/*\n\t * On success fid points to xattr\n\t */\n\tretval = p9_client_xattrcreate(fid, name, value_len, flags);\n\tif (retval < 0) {\n\t\tp9_debug(P9_DEBUG_VFS, \"p9_client_xattrcreate failed %d\\n\",\n\t\t\t retval);\n\t\tgoto err;\n\t}\n\tmsize = fid->clnt->msize;\n\twhile (value_len) {\n\t\tif (value_len > (msize - P9_IOHDRSZ))\n\t\t\twrite_count = msize - P9_IOHDRSZ;\n\t\telse\n\t\t\twrite_count = value_len;\n\t\twrite_count = p9_client_write(fid, ((char *)value)+offset,\n\t\t\t\t\tNULL, offset, write_count);\n\t\tif (write_count < 0) {\n\t\t\t/* error in xattr write */\n\t\t\tretval = write_count;\n\t\t\tgoto err;\n\t\t}\n\t\toffset += write_count;\n\t\tvalue_len -= write_count;\n\t}\n\tretval = 0;\nerr:\n\tp9_client_clunk(fid);\n\treturn retval;\n}"
        }
      },
      {
        "call_info": {
          "callee": "PTR_ERR",
          "args": [
            "fid"
          ],
          "line": 116
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "IS_ERR",
          "args": [
            "fid"
          ],
          "line": 115
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "v9fs_fid_lookup",
          "args": [
            "dentry"
          ],
          "line": 114
        },
        "resolved": true,
        "details": {
          "function_name": "v9fs_fid_lookup",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/9p/fid.c",
          "lines": "231-258",
          "snippet": "struct p9_fid *v9fs_fid_lookup(struct dentry *dentry)\n{\n\tkuid_t uid;\n\tint  any, access;\n\tstruct v9fs_session_info *v9ses;\n\n\tv9ses = v9fs_dentry2v9ses(dentry);\n\taccess = v9ses->flags & V9FS_ACCESS_MASK;\n\tswitch (access) {\n\tcase V9FS_ACCESS_SINGLE:\n\tcase V9FS_ACCESS_USER:\n\tcase V9FS_ACCESS_CLIENT:\n\t\tuid = current_fsuid();\n\t\tany = 0;\n\t\tbreak;\n\n\tcase V9FS_ACCESS_ANY:\n\t\tuid = v9ses->uid;\n\t\tany = 1;\n\t\tbreak;\n\n\tdefault:\n\t\tuid = INVALID_UID;\n\t\tany = 0;\n\t\tbreak;\n\t}\n\treturn v9fs_fid_lookup_with_uid(dentry, uid, any);\n}",
          "includes": [
            "#include \"fid.h\"",
            "#include \"v9fs_vfs.h\"",
            "#include \"v9fs.h\"",
            "#include <net/9p/client.h>",
            "#include <net/9p/9p.h>",
            "#include <linux/idr.h>",
            "#include <linux/sched.h>",
            "#include <linux/slab.h>",
            "#include <linux/fs.h>",
            "#include <linux/errno.h>",
            "#include <linux/module.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"fid.h\"\n#include \"v9fs_vfs.h\"\n#include \"v9fs.h\"\n#include <net/9p/client.h>\n#include <net/9p/9p.h>\n#include <linux/idr.h>\n#include <linux/sched.h>\n#include <linux/slab.h>\n#include <linux/fs.h>\n#include <linux/errno.h>\n#include <linux/module.h>\n\nstruct p9_fid *v9fs_fid_lookup(struct dentry *dentry)\n{\n\tkuid_t uid;\n\tint  any, access;\n\tstruct v9fs_session_info *v9ses;\n\n\tv9ses = v9fs_dentry2v9ses(dentry);\n\taccess = v9ses->flags & V9FS_ACCESS_MASK;\n\tswitch (access) {\n\tcase V9FS_ACCESS_SINGLE:\n\tcase V9FS_ACCESS_USER:\n\tcase V9FS_ACCESS_CLIENT:\n\t\tuid = current_fsuid();\n\t\tany = 0;\n\t\tbreak;\n\n\tcase V9FS_ACCESS_ANY:\n\t\tuid = v9ses->uid;\n\t\tany = 1;\n\t\tbreak;\n\n\tdefault:\n\t\tuid = INVALID_UID;\n\t\tany = 0;\n\t\tbreak;\n\t}\n\treturn v9fs_fid_lookup_with_uid(dentry, uid, any);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"xattr.h\"\n#include \"fid.h\"\n#include <net/9p/client.h>\n#include <net/9p/9p.h>\n#include <linux/sched.h>\n#include <linux/fs.h>\n#include <linux/module.h>\n\nint v9fs_xattr_set(struct dentry *dentry, const char *name,\n\t\t   const void *value, size_t value_len, int flags)\n{\n\tstruct p9_fid *fid = v9fs_fid_lookup(dentry);\n\tif (IS_ERR(fid))\n\t\treturn PTR_ERR(fid);\n\treturn v9fs_fid_xattr_set(fid, name, value, value_len, flags);\n}"
  },
  {
    "function_name": "v9fs_xattr_get",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/9p/xattr.c",
    "lines": "85-97",
    "snippet": "ssize_t v9fs_xattr_get(struct dentry *dentry, const char *name,\n\t\t       void *buffer, size_t buffer_size)\n{\n\tstruct p9_fid *fid;\n\n\tp9_debug(P9_DEBUG_VFS, \"name = %s value_len = %zu\\n\",\n\t\t name, buffer_size);\n\tfid = v9fs_fid_lookup(dentry);\n\tif (IS_ERR(fid))\n\t\treturn PTR_ERR(fid);\n\n\treturn v9fs_fid_xattr_get(fid, name, buffer, buffer_size);\n}",
    "includes": [
      "#include \"xattr.h\"",
      "#include \"fid.h\"",
      "#include <net/9p/client.h>",
      "#include <net/9p/9p.h>",
      "#include <linux/sched.h>",
      "#include <linux/fs.h>",
      "#include <linux/module.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "v9fs_fid_xattr_get",
          "args": [
            "fid",
            "name",
            "buffer",
            "buffer_size"
          ],
          "line": 96
        },
        "resolved": true,
        "details": {
          "function_name": "v9fs_fid_xattr_get",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/9p/xattr.c",
          "lines": "24-72",
          "snippet": "ssize_t v9fs_fid_xattr_get(struct p9_fid *fid, const char *name,\n\t\t\t   void *buffer, size_t buffer_size)\n{\n\tssize_t retval;\n\tint msize, read_count;\n\tu64 offset = 0, attr_size;\n\tstruct p9_fid *attr_fid;\n\n\tattr_fid = p9_client_xattrwalk(fid, name, &attr_size);\n\tif (IS_ERR(attr_fid)) {\n\t\tretval = PTR_ERR(attr_fid);\n\t\tp9_debug(P9_DEBUG_VFS, \"p9_client_attrwalk failed %zd\\n\",\n\t\t\t retval);\n\t\tattr_fid = NULL;\n\t\tgoto error;\n\t}\n\tif (!buffer_size) {\n\t\t/* request to get the attr_size */\n\t\tretval = attr_size;\n\t\tgoto error;\n\t}\n\tif (attr_size > buffer_size) {\n\t\tretval = -ERANGE;\n\t\tgoto error;\n\t}\n\tmsize = attr_fid->clnt->msize;\n\twhile (attr_size) {\n\t\tif (attr_size > (msize - P9_IOHDRSZ))\n\t\t\tread_count = msize - P9_IOHDRSZ;\n\t\telse\n\t\t\tread_count = attr_size;\n\t\tread_count = p9_client_read(attr_fid, ((char *)buffer)+offset,\n\t\t\t\t\tNULL, offset, read_count);\n\t\tif (read_count < 0) {\n\t\t\t/* error in xattr read */\n\t\t\tretval = read_count;\n\t\t\tgoto error;\n\t\t}\n\t\toffset += read_count;\n\t\tattr_size -= read_count;\n\t}\n\t/* Total read xattr bytes */\n\tretval = offset;\nerror:\n\tif (attr_fid)\n\t\tp9_client_clunk(attr_fid);\n\treturn retval;\n\n}",
          "includes": [
            "#include \"xattr.h\"",
            "#include \"fid.h\"",
            "#include <net/9p/client.h>",
            "#include <net/9p/9p.h>",
            "#include <linux/sched.h>",
            "#include <linux/fs.h>",
            "#include <linux/module.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"xattr.h\"\n#include \"fid.h\"\n#include <net/9p/client.h>\n#include <net/9p/9p.h>\n#include <linux/sched.h>\n#include <linux/fs.h>\n#include <linux/module.h>\n\nssize_t v9fs_fid_xattr_get(struct p9_fid *fid, const char *name,\n\t\t\t   void *buffer, size_t buffer_size)\n{\n\tssize_t retval;\n\tint msize, read_count;\n\tu64 offset = 0, attr_size;\n\tstruct p9_fid *attr_fid;\n\n\tattr_fid = p9_client_xattrwalk(fid, name, &attr_size);\n\tif (IS_ERR(attr_fid)) {\n\t\tretval = PTR_ERR(attr_fid);\n\t\tp9_debug(P9_DEBUG_VFS, \"p9_client_attrwalk failed %zd\\n\",\n\t\t\t retval);\n\t\tattr_fid = NULL;\n\t\tgoto error;\n\t}\n\tif (!buffer_size) {\n\t\t/* request to get the attr_size */\n\t\tretval = attr_size;\n\t\tgoto error;\n\t}\n\tif (attr_size > buffer_size) {\n\t\tretval = -ERANGE;\n\t\tgoto error;\n\t}\n\tmsize = attr_fid->clnt->msize;\n\twhile (attr_size) {\n\t\tif (attr_size > (msize - P9_IOHDRSZ))\n\t\t\tread_count = msize - P9_IOHDRSZ;\n\t\telse\n\t\t\tread_count = attr_size;\n\t\tread_count = p9_client_read(attr_fid, ((char *)buffer)+offset,\n\t\t\t\t\tNULL, offset, read_count);\n\t\tif (read_count < 0) {\n\t\t\t/* error in xattr read */\n\t\t\tretval = read_count;\n\t\t\tgoto error;\n\t\t}\n\t\toffset += read_count;\n\t\tattr_size -= read_count;\n\t}\n\t/* Total read xattr bytes */\n\tretval = offset;\nerror:\n\tif (attr_fid)\n\t\tp9_client_clunk(attr_fid);\n\treturn retval;\n\n}"
        }
      },
      {
        "call_info": {
          "callee": "PTR_ERR",
          "args": [
            "fid"
          ],
          "line": 94
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "IS_ERR",
          "args": [
            "fid"
          ],
          "line": 93
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "v9fs_fid_lookup",
          "args": [
            "dentry"
          ],
          "line": 92
        },
        "resolved": true,
        "details": {
          "function_name": "v9fs_fid_lookup",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/9p/fid.c",
          "lines": "231-258",
          "snippet": "struct p9_fid *v9fs_fid_lookup(struct dentry *dentry)\n{\n\tkuid_t uid;\n\tint  any, access;\n\tstruct v9fs_session_info *v9ses;\n\n\tv9ses = v9fs_dentry2v9ses(dentry);\n\taccess = v9ses->flags & V9FS_ACCESS_MASK;\n\tswitch (access) {\n\tcase V9FS_ACCESS_SINGLE:\n\tcase V9FS_ACCESS_USER:\n\tcase V9FS_ACCESS_CLIENT:\n\t\tuid = current_fsuid();\n\t\tany = 0;\n\t\tbreak;\n\n\tcase V9FS_ACCESS_ANY:\n\t\tuid = v9ses->uid;\n\t\tany = 1;\n\t\tbreak;\n\n\tdefault:\n\t\tuid = INVALID_UID;\n\t\tany = 0;\n\t\tbreak;\n\t}\n\treturn v9fs_fid_lookup_with_uid(dentry, uid, any);\n}",
          "includes": [
            "#include \"fid.h\"",
            "#include \"v9fs_vfs.h\"",
            "#include \"v9fs.h\"",
            "#include <net/9p/client.h>",
            "#include <net/9p/9p.h>",
            "#include <linux/idr.h>",
            "#include <linux/sched.h>",
            "#include <linux/slab.h>",
            "#include <linux/fs.h>",
            "#include <linux/errno.h>",
            "#include <linux/module.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"fid.h\"\n#include \"v9fs_vfs.h\"\n#include \"v9fs.h\"\n#include <net/9p/client.h>\n#include <net/9p/9p.h>\n#include <linux/idr.h>\n#include <linux/sched.h>\n#include <linux/slab.h>\n#include <linux/fs.h>\n#include <linux/errno.h>\n#include <linux/module.h>\n\nstruct p9_fid *v9fs_fid_lookup(struct dentry *dentry)\n{\n\tkuid_t uid;\n\tint  any, access;\n\tstruct v9fs_session_info *v9ses;\n\n\tv9ses = v9fs_dentry2v9ses(dentry);\n\taccess = v9ses->flags & V9FS_ACCESS_MASK;\n\tswitch (access) {\n\tcase V9FS_ACCESS_SINGLE:\n\tcase V9FS_ACCESS_USER:\n\tcase V9FS_ACCESS_CLIENT:\n\t\tuid = current_fsuid();\n\t\tany = 0;\n\t\tbreak;\n\n\tcase V9FS_ACCESS_ANY:\n\t\tuid = v9ses->uid;\n\t\tany = 1;\n\t\tbreak;\n\n\tdefault:\n\t\tuid = INVALID_UID;\n\t\tany = 0;\n\t\tbreak;\n\t}\n\treturn v9fs_fid_lookup_with_uid(dentry, uid, any);\n}"
        }
      },
      {
        "call_info": {
          "callee": "p9_debug",
          "args": [
            "P9_DEBUG_VFS",
            "\"name = %s value_len = %zu\\n\"",
            "name",
            "buffer_size"
          ],
          "line": 90
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"xattr.h\"\n#include \"fid.h\"\n#include <net/9p/client.h>\n#include <net/9p/9p.h>\n#include <linux/sched.h>\n#include <linux/fs.h>\n#include <linux/module.h>\n\nssize_t v9fs_xattr_get(struct dentry *dentry, const char *name,\n\t\t       void *buffer, size_t buffer_size)\n{\n\tstruct p9_fid *fid;\n\n\tp9_debug(P9_DEBUG_VFS, \"name = %s value_len = %zu\\n\",\n\t\t name, buffer_size);\n\tfid = v9fs_fid_lookup(dentry);\n\tif (IS_ERR(fid))\n\t\treturn PTR_ERR(fid);\n\n\treturn v9fs_fid_xattr_get(fid, name, buffer, buffer_size);\n}"
  },
  {
    "function_name": "v9fs_fid_xattr_get",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/9p/xattr.c",
    "lines": "24-72",
    "snippet": "ssize_t v9fs_fid_xattr_get(struct p9_fid *fid, const char *name,\n\t\t\t   void *buffer, size_t buffer_size)\n{\n\tssize_t retval;\n\tint msize, read_count;\n\tu64 offset = 0, attr_size;\n\tstruct p9_fid *attr_fid;\n\n\tattr_fid = p9_client_xattrwalk(fid, name, &attr_size);\n\tif (IS_ERR(attr_fid)) {\n\t\tretval = PTR_ERR(attr_fid);\n\t\tp9_debug(P9_DEBUG_VFS, \"p9_client_attrwalk failed %zd\\n\",\n\t\t\t retval);\n\t\tattr_fid = NULL;\n\t\tgoto error;\n\t}\n\tif (!buffer_size) {\n\t\t/* request to get the attr_size */\n\t\tretval = attr_size;\n\t\tgoto error;\n\t}\n\tif (attr_size > buffer_size) {\n\t\tretval = -ERANGE;\n\t\tgoto error;\n\t}\n\tmsize = attr_fid->clnt->msize;\n\twhile (attr_size) {\n\t\tif (attr_size > (msize - P9_IOHDRSZ))\n\t\t\tread_count = msize - P9_IOHDRSZ;\n\t\telse\n\t\t\tread_count = attr_size;\n\t\tread_count = p9_client_read(attr_fid, ((char *)buffer)+offset,\n\t\t\t\t\tNULL, offset, read_count);\n\t\tif (read_count < 0) {\n\t\t\t/* error in xattr read */\n\t\t\tretval = read_count;\n\t\t\tgoto error;\n\t\t}\n\t\toffset += read_count;\n\t\tattr_size -= read_count;\n\t}\n\t/* Total read xattr bytes */\n\tretval = offset;\nerror:\n\tif (attr_fid)\n\t\tp9_client_clunk(attr_fid);\n\treturn retval;\n\n}",
    "includes": [
      "#include \"xattr.h\"",
      "#include \"fid.h\"",
      "#include <net/9p/client.h>",
      "#include <net/9p/9p.h>",
      "#include <linux/sched.h>",
      "#include <linux/fs.h>",
      "#include <linux/module.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "p9_client_clunk",
          "args": [
            "attr_fid"
          ],
          "line": 69
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "p9_client_read",
          "args": [
            "attr_fid",
            "((char *)buffer)+offset",
            "NULL",
            "offset",
            "read_count"
          ],
          "line": 55
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "p9_debug",
          "args": [
            "P9_DEBUG_VFS",
            "\"p9_client_attrwalk failed %zd\\n\"",
            "retval"
          ],
          "line": 35
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "PTR_ERR",
          "args": [
            "attr_fid"
          ],
          "line": 34
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "IS_ERR",
          "args": [
            "attr_fid"
          ],
          "line": 33
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "p9_client_xattrwalk",
          "args": [
            "fid",
            "name",
            "&attr_size"
          ],
          "line": 32
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"xattr.h\"\n#include \"fid.h\"\n#include <net/9p/client.h>\n#include <net/9p/9p.h>\n#include <linux/sched.h>\n#include <linux/fs.h>\n#include <linux/module.h>\n\nssize_t v9fs_fid_xattr_get(struct p9_fid *fid, const char *name,\n\t\t\t   void *buffer, size_t buffer_size)\n{\n\tssize_t retval;\n\tint msize, read_count;\n\tu64 offset = 0, attr_size;\n\tstruct p9_fid *attr_fid;\n\n\tattr_fid = p9_client_xattrwalk(fid, name, &attr_size);\n\tif (IS_ERR(attr_fid)) {\n\t\tretval = PTR_ERR(attr_fid);\n\t\tp9_debug(P9_DEBUG_VFS, \"p9_client_attrwalk failed %zd\\n\",\n\t\t\t retval);\n\t\tattr_fid = NULL;\n\t\tgoto error;\n\t}\n\tif (!buffer_size) {\n\t\t/* request to get the attr_size */\n\t\tretval = attr_size;\n\t\tgoto error;\n\t}\n\tif (attr_size > buffer_size) {\n\t\tretval = -ERANGE;\n\t\tgoto error;\n\t}\n\tmsize = attr_fid->clnt->msize;\n\twhile (attr_size) {\n\t\tif (attr_size > (msize - P9_IOHDRSZ))\n\t\t\tread_count = msize - P9_IOHDRSZ;\n\t\telse\n\t\t\tread_count = attr_size;\n\t\tread_count = p9_client_read(attr_fid, ((char *)buffer)+offset,\n\t\t\t\t\tNULL, offset, read_count);\n\t\tif (read_count < 0) {\n\t\t\t/* error in xattr read */\n\t\t\tretval = read_count;\n\t\t\tgoto error;\n\t\t}\n\t\toffset += read_count;\n\t\tattr_size -= read_count;\n\t}\n\t/* Total read xattr bytes */\n\tretval = offset;\nerror:\n\tif (attr_fid)\n\t\tp9_client_clunk(attr_fid);\n\treturn retval;\n\n}"
  }
]