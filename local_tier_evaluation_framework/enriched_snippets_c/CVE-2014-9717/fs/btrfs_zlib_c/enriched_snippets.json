[
  {
    "function_name": "lib_decompress(",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/btrfs/zlib.c",
    "lines": "307-404",
    "snippet": "tatic int zlib_decompress(struct list_head *ws, unsigned char *data_in,\n\t\t\t   struct page *dest_page,\n\t\t\t   unsigned long start_byte,\n\t\t\t   size_t srclen, size_t destlen)\n{\n\tstruct workspace *workspace = list_entry(ws, struct workspace, list);\n\tint ret = 0;\n\tint wbits = MAX_WBITS;\n\tunsigned long bytes_left;\n\tunsigned long total_out = 0;\n\tunsigned long pg_offset = 0;\n\tchar *kaddr;\n\n\tdestlen = min_t(unsigned long, destlen, PAGE_SIZE);\n\tbytes_left = destlen;\n\n\tworkspace->strm.next_in = data_in;\n\tworkspace->strm.avail_in = srclen;\n\tworkspace->strm.total_in = 0;\n\n\tworkspace->strm.next_out = workspace->buf;\n\tworkspace->strm.avail_out = PAGE_CACHE_SIZE;\n\tworkspace->strm.total_out = 0;\n\t/* If it's deflate, and it's got no preset dictionary, then\n\t   we can tell zlib to skip the adler32 check. */\n\tif (srclen > 2 && !(data_in[1] & PRESET_DICT) &&\n\t    ((data_in[0] & 0x0f) == Z_DEFLATED) &&\n\t    !(((data_in[0]<<8) + data_in[1]) % 31)) {\n\n\t\twbits = -((data_in[0] >> 4) + 8);\n\t\tworkspace->strm.next_in += 2;\n\t\tworkspace->strm.avail_in -= 2;\n\t}\n\n\tif (Z_OK != zlib_inflateInit2(&workspace->strm, wbits)) {\n\t\tprintk(KERN_WARNING \"BTRFS: inflateInit failed\\n\");\n\t\treturn -EIO;\n\t}\n\n\twhile (bytes_left > 0) {\n\t\tunsigned long buf_start;\n\t\tunsigned long buf_offset;\n\t\tunsigned long bytes;\n\n\t\tret = zlib_inflate(&workspace->strm, Z_NO_FLUSH);\n\t\tif (ret != Z_OK && ret != Z_STREAM_END)\n\t\t\tbreak;\n\n\t\tbuf_start = total_out;\n\t\ttotal_out = workspace->strm.total_out;\n\n\t\tif (total_out == buf_start) {\n\t\t\tret = -EIO;\n\t\t\tbreak;\n\t\t}\n\n\t\tif (total_out <= start_byte)\n\t\t\tgoto next;\n\n\t\tif (total_out > start_byte && buf_start < start_byte)\n\t\t\tbuf_offset = start_byte - buf_start;\n\t\telse\n\t\t\tbuf_offset = 0;\n\n\t\tbytes = min(PAGE_CACHE_SIZE - pg_offset,\n\t\t\t    PAGE_CACHE_SIZE - buf_offset);\n\t\tbytes = min(bytes, bytes_left);\n\n\t\tkaddr = kmap_atomic(dest_page);\n\t\tmemcpy(kaddr + pg_offset, workspace->buf + buf_offset, bytes);\n\t\tkunmap_atomic(kaddr);\n\n\t\tpg_offset += bytes;\n\t\tbytes_left -= bytes;\nnext:\n\t\tworkspace->strm.next_out = workspace->buf;\n\t\tworkspace->strm.avail_out = PAGE_CACHE_SIZE;\n\t}\n\n\tif (ret != Z_STREAM_END && bytes_left != 0)\n\t\tret = -EIO;\n\telse\n\t\tret = 0;\n\n\tzlib_inflateEnd(&workspace->strm);\n\n\t/*\n\t * this should only happen if zlib returned fewer bytes than we\n\t * expected.  btrfs_get_block is responsible for zeroing from the\n\t * end of the inline extent (destlen) to the end of the page\n\t */\n\tif (pg_offset < destlen) {\n\t\tkaddr = kmap_atomic(dest_page);\n\t\tmemset(kaddr + pg_offset, 0, destlen - pg_offset);\n\t\tkunmap_atomic(kaddr);\n\t}\n\treturn ret;\n}",
    "includes": [
      "include \"compression.h\"",
      "include <linux/bio.h>\n#",
      "include <linux/pagemap.h>\n#",
      "include <linux/sched.h>\n#",
      "include <linux/err.h>\n#",
      "include <linux/init.h>\n#",
      "include <linux/vmalloc.h>\n#",
      "include <linux/zutil.h>\n#",
      "include <linux/zlib.h>\n#",
      "include <linux/slab.h>\n#",
      "include <linux/kernel.h>\n#"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "unmap_atomic(",
          "args": [
            "addr)"
          ],
          "line": 401
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "emset(",
          "args": [
            "addr + pg_offset,",
            ",",
            "estlen - pg_offset)"
          ],
          "line": 400
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "map_atomic(",
          "args": [
            "est_page)"
          ],
          "line": 399
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lib_inflateEnd(",
          "args": [
            "workspace->strm)"
          ],
          "line": 391
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "unmap_atomic(",
          "args": [
            "addr)"
          ],
          "line": 377
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "emcpy(",
          "args": [
            "addr + pg_offset,",
            "orkspace->buf + buf_offset,",
            "ytes)"
          ],
          "line": 376
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "map_atomic(",
          "args": [
            "est_page)"
          ],
          "line": 375
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "in(",
          "args": [
            "ytes,",
            "ytes_left)"
          ],
          "line": 373
        },
        "resolved": true,
        "details": {
          "function_name": "rst_inode_chain(i",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/jffs2/build.c",
          "lines": "25-33",
          "snippet": "atic inline struct jffs2_inode_cache *\nfirst_inode_chain(int *i, struct jffs2_sb_info *c)\n{\n\tfor (; *i < c->inocache_hashsize; (*i)++) {\n\t\tif (c->inocache_list[*i])\n\t\t\treturn c->inocache_list[*i];\n\t}\n\treturn NULL;\n}",
          "includes": [
            "nclude \"nodelist.h\"\n\ns",
            "nclude <linux/mtd/mtd.h>\n#i",
            "nclude <linux/vmalloc.h>\n#i",
            "nclude <linux/slab.h>\n#i",
            "nclude <linux/sched.h>\n#i",
            "nclude <linux/kernel.h>\n#i"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "nclude \"nodelist.h\"\n\ns\nnclude <linux/mtd/mtd.h>\n#i\nnclude <linux/vmalloc.h>\n#i\nnclude <linux/slab.h>\n#i\nnclude <linux/sched.h>\n#i\nnclude <linux/kernel.h>\n#i\n\natic inline struct jffs2_inode_cache *\nfirst_inode_chain(int *i, struct jffs2_sb_info *c)\n{\n\tfor (; *i < c->inocache_hashsize; (*i)++) {\n\t\tif (c->inocache_list[*i])\n\t\t\treturn c->inocache_list[*i];\n\t}\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "lib_inflate(",
          "args": [
            "workspace->strm,",
            "_NO_FLUSH)"
          ],
          "line": 351
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rintk(",
          "args": [
            "ERN_WARNING \"BTRFS: inflateInit failed\\n\")"
          ],
          "line": 342
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lib_inflateInit2(",
          "args": [
            "workspace->strm,",
            "bits)"
          ],
          "line": 341
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "in_t(",
          "args": [
            "nsigned ong,",
            "estlen,",
            "AGE_SIZE)"
          ],
          "line": 320
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ist_entry(",
          "args": [
            "s,",
            "truct orkspace,",
            "ist)"
          ],
          "line": 312
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "include \"compression.h\"\ninclude <linux/bio.h>\n#\ninclude <linux/pagemap.h>\n#\ninclude <linux/sched.h>\n#\ninclude <linux/err.h>\n#\ninclude <linux/init.h>\n#\ninclude <linux/vmalloc.h>\n#\ninclude <linux/zutil.h>\n#\ninclude <linux/zlib.h>\n#\ninclude <linux/slab.h>\n#\ninclude <linux/kernel.h>\n#\n\ntatic int zlib_decompress(struct list_head *ws, unsigned char *data_in,\n\t\t\t   struct page *dest_page,\n\t\t\t   unsigned long start_byte,\n\t\t\t   size_t srclen, size_t destlen)\n{\n\tstruct workspace *workspace = list_entry(ws, struct workspace, list);\n\tint ret = 0;\n\tint wbits = MAX_WBITS;\n\tunsigned long bytes_left;\n\tunsigned long total_out = 0;\n\tunsigned long pg_offset = 0;\n\tchar *kaddr;\n\n\tdestlen = min_t(unsigned long, destlen, PAGE_SIZE);\n\tbytes_left = destlen;\n\n\tworkspace->strm.next_in = data_in;\n\tworkspace->strm.avail_in = srclen;\n\tworkspace->strm.total_in = 0;\n\n\tworkspace->strm.next_out = workspace->buf;\n\tworkspace->strm.avail_out = PAGE_CACHE_SIZE;\n\tworkspace->strm.total_out = 0;\n\t/* If it's deflate, and it's got no preset dictionary, then\n\t   we can tell zlib to skip the adler32 check. */\n\tif (srclen > 2 && !(data_in[1] & PRESET_DICT) &&\n\t    ((data_in[0] & 0x0f) == Z_DEFLATED) &&\n\t    !(((data_in[0]<<8) + data_in[1]) % 31)) {\n\n\t\twbits = -((data_in[0] >> 4) + 8);\n\t\tworkspace->strm.next_in += 2;\n\t\tworkspace->strm.avail_in -= 2;\n\t}\n\n\tif (Z_OK != zlib_inflateInit2(&workspace->strm, wbits)) {\n\t\tprintk(KERN_WARNING \"BTRFS: inflateInit failed\\n\");\n\t\treturn -EIO;\n\t}\n\n\twhile (bytes_left > 0) {\n\t\tunsigned long buf_start;\n\t\tunsigned long buf_offset;\n\t\tunsigned long bytes;\n\n\t\tret = zlib_inflate(&workspace->strm, Z_NO_FLUSH);\n\t\tif (ret != Z_OK && ret != Z_STREAM_END)\n\t\t\tbreak;\n\n\t\tbuf_start = total_out;\n\t\ttotal_out = workspace->strm.total_out;\n\n\t\tif (total_out == buf_start) {\n\t\t\tret = -EIO;\n\t\t\tbreak;\n\t\t}\n\n\t\tif (total_out <= start_byte)\n\t\t\tgoto next;\n\n\t\tif (total_out > start_byte && buf_start < start_byte)\n\t\t\tbuf_offset = start_byte - buf_start;\n\t\telse\n\t\t\tbuf_offset = 0;\n\n\t\tbytes = min(PAGE_CACHE_SIZE - pg_offset,\n\t\t\t    PAGE_CACHE_SIZE - buf_offset);\n\t\tbytes = min(bytes, bytes_left);\n\n\t\tkaddr = kmap_atomic(dest_page);\n\t\tmemcpy(kaddr + pg_offset, workspace->buf + buf_offset, bytes);\n\t\tkunmap_atomic(kaddr);\n\n\t\tpg_offset += bytes;\n\t\tbytes_left -= bytes;\nnext:\n\t\tworkspace->strm.next_out = workspace->buf;\n\t\tworkspace->strm.avail_out = PAGE_CACHE_SIZE;\n\t}\n\n\tif (ret != Z_STREAM_END && bytes_left != 0)\n\t\tret = -EIO;\n\telse\n\t\tret = 0;\n\n\tzlib_inflateEnd(&workspace->strm);\n\n\t/*\n\t * this should only happen if zlib returned fewer bytes than we\n\t * expected.  btrfs_get_block is responsible for zeroing from the\n\t * end of the inline extent (destlen) to the end of the page\n\t */\n\tif (pg_offset < destlen) {\n\t\tkaddr = kmap_atomic(dest_page);\n\t\tmemset(kaddr + pg_offset, 0, destlen - pg_offset);\n\t\tkunmap_atomic(kaddr);\n\t}\n\treturn ret;\n}"
  },
  {
    "function_name": "lib_decompress_biovec(",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/btrfs/zlib.c",
    "lines": "213-305",
    "snippet": "tatic int zlib_decompress_biovec(struct list_head *ws, struct page **pages_in,\n\t\t\t\t  u64 disk_start,\n\t\t\t\t  struct bio_vec *bvec,\n\t\t\t\t  int vcnt,\n\t\t\t\t  size_t srclen)\n{\n\tstruct workspace *workspace = list_entry(ws, struct workspace, list);\n\tint ret = 0, ret2;\n\tint wbits = MAX_WBITS;\n\tchar *data_in;\n\tsize_t total_out = 0;\n\tunsigned long page_in_index = 0;\n\tunsigned long page_out_index = 0;\n\tunsigned long total_pages_in = DIV_ROUND_UP(srclen, PAGE_CACHE_SIZE);\n\tunsigned long buf_start;\n\tunsigned long pg_offset;\n\n\tdata_in = kmap(pages_in[page_in_index]);\n\tworkspace->strm.next_in = data_in;\n\tworkspace->strm.avail_in = min_t(size_t, srclen, PAGE_CACHE_SIZE);\n\tworkspace->strm.total_in = 0;\n\n\tworkspace->strm.total_out = 0;\n\tworkspace->strm.next_out = workspace->buf;\n\tworkspace->strm.avail_out = PAGE_CACHE_SIZE;\n\tpg_offset = 0;\n\n\t/* If it's deflate, and it's got no preset dictionary, then\n\t   we can tell zlib to skip the adler32 check. */\n\tif (srclen > 2 && !(data_in[1] & PRESET_DICT) &&\n\t    ((data_in[0] & 0x0f) == Z_DEFLATED) &&\n\t    !(((data_in[0]<<8) + data_in[1]) % 31)) {\n\n\t\twbits = -((data_in[0] >> 4) + 8);\n\t\tworkspace->strm.next_in += 2;\n\t\tworkspace->strm.avail_in -= 2;\n\t}\n\n\tif (Z_OK != zlib_inflateInit2(&workspace->strm, wbits)) {\n\t\tprintk(KERN_WARNING \"BTRFS: inflateInit failed\\n\");\n\t\treturn -EIO;\n\t}\n\twhile (workspace->strm.total_in < srclen) {\n\t\tret = zlib_inflate(&workspace->strm, Z_NO_FLUSH);\n\t\tif (ret != Z_OK && ret != Z_STREAM_END)\n\t\t\tbreak;\n\n\t\tbuf_start = total_out;\n\t\ttotal_out = workspace->strm.total_out;\n\n\t\t/* we didn't make progress in this inflate call, we're done */\n\t\tif (buf_start == total_out)\n\t\t\tbreak;\n\n\t\tret2 = btrfs_decompress_buf2page(workspace->buf, buf_start,\n\t\t\t\t\t\t total_out, disk_start,\n\t\t\t\t\t\t bvec, vcnt,\n\t\t\t\t\t\t &page_out_index, &pg_offset);\n\t\tif (ret2 == 0) {\n\t\t\tret = 0;\n\t\t\tgoto done;\n\t\t}\n\n\t\tworkspace->strm.next_out = workspace->buf;\n\t\tworkspace->strm.avail_out = PAGE_CACHE_SIZE;\n\n\t\tif (workspace->strm.avail_in == 0) {\n\t\t\tunsigned long tmp;\n\t\t\tkunmap(pages_in[page_in_index]);\n\t\t\tpage_in_index++;\n\t\t\tif (page_in_index >= total_pages_in) {\n\t\t\t\tdata_in = NULL;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tdata_in = kmap(pages_in[page_in_index]);\n\t\t\tworkspace->strm.next_in = data_in;\n\t\t\ttmp = srclen - workspace->strm.total_in;\n\t\t\tworkspace->strm.avail_in = min(tmp,\n\t\t\t\t\t\t\t   PAGE_CACHE_SIZE);\n\t\t}\n\t}\n\tif (ret != Z_STREAM_END)\n\t\tret = -EIO;\n\telse\n\t\tret = 0;\ndone:\n\tzlib_inflateEnd(&workspace->strm);\n\tif (data_in)\n\t\tkunmap(pages_in[page_in_index]);\n\tif (!ret)\n\t\tbtrfs_clear_biovec_end(bvec, vcnt, page_out_index, pg_offset);\n\treturn ret;\n}",
    "includes": [
      "include \"compression.h\"",
      "include <linux/bio.h>\n#",
      "include <linux/pagemap.h>\n#",
      "include <linux/sched.h>\n#",
      "include <linux/err.h>\n#",
      "include <linux/init.h>\n#",
      "include <linux/vmalloc.h>\n#",
      "include <linux/zutil.h>\n#",
      "include <linux/zlib.h>\n#",
      "include <linux/slab.h>\n#",
      "include <linux/kernel.h>\n#"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "trfs_clear_biovec_end(",
          "args": [
            "vec,",
            "cnt,",
            "age_out_index,",
            "g_offset)"
          ],
          "line": 303
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "unmap(",
          "args": [
            "ages_in[page_in_index])"
          ],
          "line": 301
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lib_inflateEnd(",
          "args": [
            "workspace->strm)"
          ],
          "line": 299
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "in(",
          "args": [
            "mp,",
            "AGE_CACHE_SIZE)"
          ],
          "line": 290
        },
        "resolved": true,
        "details": {
          "function_name": "rst_inode_chain(i",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/jffs2/build.c",
          "lines": "25-33",
          "snippet": "atic inline struct jffs2_inode_cache *\nfirst_inode_chain(int *i, struct jffs2_sb_info *c)\n{\n\tfor (; *i < c->inocache_hashsize; (*i)++) {\n\t\tif (c->inocache_list[*i])\n\t\t\treturn c->inocache_list[*i];\n\t}\n\treturn NULL;\n}",
          "includes": [
            "nclude \"nodelist.h\"\n\ns",
            "nclude <linux/mtd/mtd.h>\n#i",
            "nclude <linux/vmalloc.h>\n#i",
            "nclude <linux/slab.h>\n#i",
            "nclude <linux/sched.h>\n#i",
            "nclude <linux/kernel.h>\n#i"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "nclude \"nodelist.h\"\n\ns\nnclude <linux/mtd/mtd.h>\n#i\nnclude <linux/vmalloc.h>\n#i\nnclude <linux/slab.h>\n#i\nnclude <linux/sched.h>\n#i\nnclude <linux/kernel.h>\n#i\n\natic inline struct jffs2_inode_cache *\nfirst_inode_chain(int *i, struct jffs2_sb_info *c)\n{\n\tfor (; *i < c->inocache_hashsize; (*i)++) {\n\t\tif (c->inocache_list[*i])\n\t\t\treturn c->inocache_list[*i];\n\t}\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "map(",
          "args": [
            "ages_in[page_in_index])"
          ],
          "line": 287
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "unmap(",
          "args": [
            "ages_in[page_in_index])"
          ],
          "line": 281
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "trfs_decompress_buf2page(",
          "args": [
            "orkspace->buf,",
            "uf_start,",
            "otal_out,",
            "isk_start,",
            "vec,",
            "cnt,",
            "page_out_index,",
            "pg_offset)"
          ],
          "line": 267
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lib_inflate(",
          "args": [
            "workspace->strm,",
            "_NO_FLUSH)"
          ],
          "line": 256
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rintk(",
          "args": [
            "ERN_WARNING \"BTRFS: inflateInit failed\\n\")"
          ],
          "line": 252
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lib_inflateInit2(",
          "args": [
            "workspace->strm,",
            "bits)"
          ],
          "line": 251
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "in_t(",
          "args": [
            "ize_t,",
            "rclen,",
            "AGE_CACHE_SIZE)"
          ],
          "line": 232
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "map(",
          "args": [
            "ages_in[page_in_index])"
          ],
          "line": 230
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "IV_ROUND_UP(",
          "args": [
            "rclen,",
            "AGE_CACHE_SIZE)"
          ],
          "line": 226
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ist_entry(",
          "args": [
            "s,",
            "truct orkspace,",
            "ist)"
          ],
          "line": 219
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "include \"compression.h\"\ninclude <linux/bio.h>\n#\ninclude <linux/pagemap.h>\n#\ninclude <linux/sched.h>\n#\ninclude <linux/err.h>\n#\ninclude <linux/init.h>\n#\ninclude <linux/vmalloc.h>\n#\ninclude <linux/zutil.h>\n#\ninclude <linux/zlib.h>\n#\ninclude <linux/slab.h>\n#\ninclude <linux/kernel.h>\n#\n\ntatic int zlib_decompress_biovec(struct list_head *ws, struct page **pages_in,\n\t\t\t\t  u64 disk_start,\n\t\t\t\t  struct bio_vec *bvec,\n\t\t\t\t  int vcnt,\n\t\t\t\t  size_t srclen)\n{\n\tstruct workspace *workspace = list_entry(ws, struct workspace, list);\n\tint ret = 0, ret2;\n\tint wbits = MAX_WBITS;\n\tchar *data_in;\n\tsize_t total_out = 0;\n\tunsigned long page_in_index = 0;\n\tunsigned long page_out_index = 0;\n\tunsigned long total_pages_in = DIV_ROUND_UP(srclen, PAGE_CACHE_SIZE);\n\tunsigned long buf_start;\n\tunsigned long pg_offset;\n\n\tdata_in = kmap(pages_in[page_in_index]);\n\tworkspace->strm.next_in = data_in;\n\tworkspace->strm.avail_in = min_t(size_t, srclen, PAGE_CACHE_SIZE);\n\tworkspace->strm.total_in = 0;\n\n\tworkspace->strm.total_out = 0;\n\tworkspace->strm.next_out = workspace->buf;\n\tworkspace->strm.avail_out = PAGE_CACHE_SIZE;\n\tpg_offset = 0;\n\n\t/* If it's deflate, and it's got no preset dictionary, then\n\t   we can tell zlib to skip the adler32 check. */\n\tif (srclen > 2 && !(data_in[1] & PRESET_DICT) &&\n\t    ((data_in[0] & 0x0f) == Z_DEFLATED) &&\n\t    !(((data_in[0]<<8) + data_in[1]) % 31)) {\n\n\t\twbits = -((data_in[0] >> 4) + 8);\n\t\tworkspace->strm.next_in += 2;\n\t\tworkspace->strm.avail_in -= 2;\n\t}\n\n\tif (Z_OK != zlib_inflateInit2(&workspace->strm, wbits)) {\n\t\tprintk(KERN_WARNING \"BTRFS: inflateInit failed\\n\");\n\t\treturn -EIO;\n\t}\n\twhile (workspace->strm.total_in < srclen) {\n\t\tret = zlib_inflate(&workspace->strm, Z_NO_FLUSH);\n\t\tif (ret != Z_OK && ret != Z_STREAM_END)\n\t\t\tbreak;\n\n\t\tbuf_start = total_out;\n\t\ttotal_out = workspace->strm.total_out;\n\n\t\t/* we didn't make progress in this inflate call, we're done */\n\t\tif (buf_start == total_out)\n\t\t\tbreak;\n\n\t\tret2 = btrfs_decompress_buf2page(workspace->buf, buf_start,\n\t\t\t\t\t\t total_out, disk_start,\n\t\t\t\t\t\t bvec, vcnt,\n\t\t\t\t\t\t &page_out_index, &pg_offset);\n\t\tif (ret2 == 0) {\n\t\t\tret = 0;\n\t\t\tgoto done;\n\t\t}\n\n\t\tworkspace->strm.next_out = workspace->buf;\n\t\tworkspace->strm.avail_out = PAGE_CACHE_SIZE;\n\n\t\tif (workspace->strm.avail_in == 0) {\n\t\t\tunsigned long tmp;\n\t\t\tkunmap(pages_in[page_in_index]);\n\t\t\tpage_in_index++;\n\t\t\tif (page_in_index >= total_pages_in) {\n\t\t\t\tdata_in = NULL;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tdata_in = kmap(pages_in[page_in_index]);\n\t\t\tworkspace->strm.next_in = data_in;\n\t\t\ttmp = srclen - workspace->strm.total_in;\n\t\t\tworkspace->strm.avail_in = min(tmp,\n\t\t\t\t\t\t\t   PAGE_CACHE_SIZE);\n\t\t}\n\t}\n\tif (ret != Z_STREAM_END)\n\t\tret = -EIO;\n\telse\n\t\tret = 0;\ndone:\n\tzlib_inflateEnd(&workspace->strm);\n\tif (data_in)\n\t\tkunmap(pages_in[page_in_index]);\n\tif (!ret)\n\t\tbtrfs_clear_biovec_end(bvec, vcnt, page_out_index, pg_offset);\n\treturn ret;\n}"
  },
  {
    "function_name": "lib_compress_pages(",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/btrfs/zlib.c",
    "lines": "74-211",
    "snippet": "tatic int zlib_compress_pages(struct list_head *ws,\n\t\t\t       struct address_space *mapping,\n\t\t\t       u64 start, unsigned long len,\n\t\t\t       struct page **pages,\n\t\t\t       unsigned long nr_dest_pages,\n\t\t\t       unsigned long *out_pages,\n\t\t\t       unsigned long *total_in,\n\t\t\t       unsigned long *total_out,\n\t\t\t       unsigned long max_out)\n{\n\tstruct workspace *workspace = list_entry(ws, struct workspace, list);\n\tint ret;\n\tchar *data_in;\n\tchar *cpage_out;\n\tint nr_pages = 0;\n\tstruct page *in_page = NULL;\n\tstruct page *out_page = NULL;\n\tunsigned long bytes_left;\n\n\t*out_pages = 0;\n\t*total_out = 0;\n\t*total_in = 0;\n\n\tif (Z_OK != zlib_deflateInit(&workspace->strm, 3)) {\n\t\tprintk(KERN_WARNING \"BTRFS: deflateInit failed\\n\");\n\t\tret = -EIO;\n\t\tgoto out;\n\t}\n\n\tworkspace->strm.total_in = 0;\n\tworkspace->strm.total_out = 0;\n\n\tin_page = find_get_page(mapping, start >> PAGE_CACHE_SHIFT);\n\tdata_in = kmap(in_page);\n\n\tout_page = alloc_page(GFP_NOFS | __GFP_HIGHMEM);\n\tif (out_page == NULL) {\n\t\tret = -ENOMEM;\n\t\tgoto out;\n\t}\n\tcpage_out = kmap(out_page);\n\tpages[0] = out_page;\n\tnr_pages = 1;\n\n\tworkspace->strm.next_in = data_in;\n\tworkspace->strm.next_out = cpage_out;\n\tworkspace->strm.avail_out = PAGE_CACHE_SIZE;\n\tworkspace->strm.avail_in = min(len, PAGE_CACHE_SIZE);\n\n\twhile (workspace->strm.total_in < len) {\n\t\tret = zlib_deflate(&workspace->strm, Z_SYNC_FLUSH);\n\t\tif (ret != Z_OK) {\n\t\t\tprintk(KERN_DEBUG \"BTRFS: deflate in loop returned %d\\n\",\n\t\t\t       ret);\n\t\t\tzlib_deflateEnd(&workspace->strm);\n\t\t\tret = -EIO;\n\t\t\tgoto out;\n\t\t}\n\n\t\t/* we're making it bigger, give up */\n\t\tif (workspace->strm.total_in > 8192 &&\n\t\t    workspace->strm.total_in <\n\t\t    workspace->strm.total_out) {\n\t\t\tret = -E2BIG;\n\t\t\tgoto out;\n\t\t}\n\t\t/* we need another page for writing out.  Test this\n\t\t * before the total_in so we will pull in a new page for\n\t\t * the stream end if required\n\t\t */\n\t\tif (workspace->strm.avail_out == 0) {\n\t\t\tkunmap(out_page);\n\t\t\tif (nr_pages == nr_dest_pages) {\n\t\t\t\tout_page = NULL;\n\t\t\t\tret = -E2BIG;\n\t\t\t\tgoto out;\n\t\t\t}\n\t\t\tout_page = alloc_page(GFP_NOFS | __GFP_HIGHMEM);\n\t\t\tif (out_page == NULL) {\n\t\t\t\tret = -ENOMEM;\n\t\t\t\tgoto out;\n\t\t\t}\n\t\t\tcpage_out = kmap(out_page);\n\t\t\tpages[nr_pages] = out_page;\n\t\t\tnr_pages++;\n\t\t\tworkspace->strm.avail_out = PAGE_CACHE_SIZE;\n\t\t\tworkspace->strm.next_out = cpage_out;\n\t\t}\n\t\t/* we're all done */\n\t\tif (workspace->strm.total_in >= len)\n\t\t\tbreak;\n\n\t\t/* we've read in a full page, get a new one */\n\t\tif (workspace->strm.avail_in == 0) {\n\t\t\tif (workspace->strm.total_out > max_out)\n\t\t\t\tbreak;\n\n\t\t\tbytes_left = len - workspace->strm.total_in;\n\t\t\tkunmap(in_page);\n\t\t\tpage_cache_release(in_page);\n\n\t\t\tstart += PAGE_CACHE_SIZE;\n\t\t\tin_page = find_get_page(mapping,\n\t\t\t\t\t\tstart >> PAGE_CACHE_SHIFT);\n\t\t\tdata_in = kmap(in_page);\n\t\t\tworkspace->strm.avail_in = min(bytes_left,\n\t\t\t\t\t\t\t   PAGE_CACHE_SIZE);\n\t\t\tworkspace->strm.next_in = data_in;\n\t\t}\n\t}\n\tworkspace->strm.avail_in = 0;\n\tret = zlib_deflate(&workspace->strm, Z_FINISH);\n\tzlib_deflateEnd(&workspace->strm);\n\n\tif (ret != Z_STREAM_END) {\n\t\tret = -EIO;\n\t\tgoto out;\n\t}\n\n\tif (workspace->strm.total_out >= workspace->strm.total_in) {\n\t\tret = -E2BIG;\n\t\tgoto out;\n\t}\n\n\tret = 0;\n\t*total_out = workspace->strm.total_out;\n\t*total_in = workspace->strm.total_in;\nout:\n\t*out_pages = nr_pages;\n\tif (out_page)\n\t\tkunmap(out_page);\n\n\tif (in_page) {\n\t\tkunmap(in_page);\n\t\tpage_cache_release(in_page);\n\t}\n\treturn ret;\n}",
    "includes": [
      "include \"compression.h\"",
      "include <linux/bio.h>\n#",
      "include <linux/pagemap.h>\n#",
      "include <linux/sched.h>\n#",
      "include <linux/err.h>\n#",
      "include <linux/init.h>\n#",
      "include <linux/vmalloc.h>\n#",
      "include <linux/zutil.h>\n#",
      "include <linux/zlib.h>\n#",
      "include <linux/slab.h>\n#",
      "include <linux/kernel.h>\n#"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "age_cache_release(",
          "args": [
            "n_page)"
          ],
          "line": 208
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "unmap(",
          "args": [
            "n_page)"
          ],
          "line": 207
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "unmap(",
          "args": [
            "ut_page)"
          ],
          "line": 204
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lib_deflateEnd(",
          "args": [
            "workspace->strm)"
          ],
          "line": 186
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lib_deflate(",
          "args": [
            "workspace->strm,",
            "_FINISH)"
          ],
          "line": 185
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "in(",
          "args": [
            "ytes_left,",
            "AGE_CACHE_SIZE)"
          ],
          "line": 179
        },
        "resolved": true,
        "details": {
          "function_name": "rst_inode_chain(i",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/jffs2/build.c",
          "lines": "25-33",
          "snippet": "atic inline struct jffs2_inode_cache *\nfirst_inode_chain(int *i, struct jffs2_sb_info *c)\n{\n\tfor (; *i < c->inocache_hashsize; (*i)++) {\n\t\tif (c->inocache_list[*i])\n\t\t\treturn c->inocache_list[*i];\n\t}\n\treturn NULL;\n}",
          "includes": [
            "nclude \"nodelist.h\"\n\ns",
            "nclude <linux/mtd/mtd.h>\n#i",
            "nclude <linux/vmalloc.h>\n#i",
            "nclude <linux/slab.h>\n#i",
            "nclude <linux/sched.h>\n#i",
            "nclude <linux/kernel.h>\n#i"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "nclude \"nodelist.h\"\n\ns\nnclude <linux/mtd/mtd.h>\n#i\nnclude <linux/vmalloc.h>\n#i\nnclude <linux/slab.h>\n#i\nnclude <linux/sched.h>\n#i\nnclude <linux/kernel.h>\n#i\n\natic inline struct jffs2_inode_cache *\nfirst_inode_chain(int *i, struct jffs2_sb_info *c)\n{\n\tfor (; *i < c->inocache_hashsize; (*i)++) {\n\t\tif (c->inocache_list[*i])\n\t\t\treturn c->inocache_list[*i];\n\t}\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "map(",
          "args": [
            "n_page)"
          ],
          "line": 178
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ind_get_page(",
          "args": [
            "apping,",
            "tart >> PAGE_CACHE_SHIFT)"
          ],
          "line": 176
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "age_cache_release(",
          "args": [
            "n_page)"
          ],
          "line": 173
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "unmap(",
          "args": [
            "n_page)"
          ],
          "line": 172
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "map(",
          "args": [
            "ut_page)"
          ],
          "line": 156
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lloc_page(",
          "args": [
            "FP_NOFS | __GFP_HIGHMEM)"
          ],
          "line": 151
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "unmap(",
          "args": [
            "ut_page)"
          ],
          "line": 145
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lib_deflateEnd(",
          "args": [
            "workspace->strm)"
          ],
          "line": 128
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rintk(",
          "args": [
            "ERN_DEBUG \"BTRFS: deflate in loop returned %d\\n\",",
            "et)"
          ],
          "line": 126
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lib_deflate(",
          "args": [
            "workspace->strm,",
            "_SYNC_FLUSH)"
          ],
          "line": 124
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "map(",
          "args": [
            "ut_page)"
          ],
          "line": 114
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lloc_page(",
          "args": [
            "FP_NOFS | __GFP_HIGHMEM)"
          ],
          "line": 109
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "map(",
          "args": [
            "n_page)"
          ],
          "line": 107
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ind_get_page(",
          "args": [
            "apping,",
            "tart >> PAGE_CACHE_SHIFT)"
          ],
          "line": 106
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rintk(",
          "args": [
            "ERN_WARNING \"BTRFS: deflateInit failed\\n\")"
          ],
          "line": 98
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lib_deflateInit(",
          "args": [
            "workspace->strm,",
            ")"
          ],
          "line": 97
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ist_entry(",
          "args": [
            "s,",
            "truct orkspace,",
            "ist)"
          ],
          "line": 84
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "include \"compression.h\"\ninclude <linux/bio.h>\n#\ninclude <linux/pagemap.h>\n#\ninclude <linux/sched.h>\n#\ninclude <linux/err.h>\n#\ninclude <linux/init.h>\n#\ninclude <linux/vmalloc.h>\n#\ninclude <linux/zutil.h>\n#\ninclude <linux/zlib.h>\n#\ninclude <linux/slab.h>\n#\ninclude <linux/kernel.h>\n#\n\ntatic int zlib_compress_pages(struct list_head *ws,\n\t\t\t       struct address_space *mapping,\n\t\t\t       u64 start, unsigned long len,\n\t\t\t       struct page **pages,\n\t\t\t       unsigned long nr_dest_pages,\n\t\t\t       unsigned long *out_pages,\n\t\t\t       unsigned long *total_in,\n\t\t\t       unsigned long *total_out,\n\t\t\t       unsigned long max_out)\n{\n\tstruct workspace *workspace = list_entry(ws, struct workspace, list);\n\tint ret;\n\tchar *data_in;\n\tchar *cpage_out;\n\tint nr_pages = 0;\n\tstruct page *in_page = NULL;\n\tstruct page *out_page = NULL;\n\tunsigned long bytes_left;\n\n\t*out_pages = 0;\n\t*total_out = 0;\n\t*total_in = 0;\n\n\tif (Z_OK != zlib_deflateInit(&workspace->strm, 3)) {\n\t\tprintk(KERN_WARNING \"BTRFS: deflateInit failed\\n\");\n\t\tret = -EIO;\n\t\tgoto out;\n\t}\n\n\tworkspace->strm.total_in = 0;\n\tworkspace->strm.total_out = 0;\n\n\tin_page = find_get_page(mapping, start >> PAGE_CACHE_SHIFT);\n\tdata_in = kmap(in_page);\n\n\tout_page = alloc_page(GFP_NOFS | __GFP_HIGHMEM);\n\tif (out_page == NULL) {\n\t\tret = -ENOMEM;\n\t\tgoto out;\n\t}\n\tcpage_out = kmap(out_page);\n\tpages[0] = out_page;\n\tnr_pages = 1;\n\n\tworkspace->strm.next_in = data_in;\n\tworkspace->strm.next_out = cpage_out;\n\tworkspace->strm.avail_out = PAGE_CACHE_SIZE;\n\tworkspace->strm.avail_in = min(len, PAGE_CACHE_SIZE);\n\n\twhile (workspace->strm.total_in < len) {\n\t\tret = zlib_deflate(&workspace->strm, Z_SYNC_FLUSH);\n\t\tif (ret != Z_OK) {\n\t\t\tprintk(KERN_DEBUG \"BTRFS: deflate in loop returned %d\\n\",\n\t\t\t       ret);\n\t\t\tzlib_deflateEnd(&workspace->strm);\n\t\t\tret = -EIO;\n\t\t\tgoto out;\n\t\t}\n\n\t\t/* we're making it bigger, give up */\n\t\tif (workspace->strm.total_in > 8192 &&\n\t\t    workspace->strm.total_in <\n\t\t    workspace->strm.total_out) {\n\t\t\tret = -E2BIG;\n\t\t\tgoto out;\n\t\t}\n\t\t/* we need another page for writing out.  Test this\n\t\t * before the total_in so we will pull in a new page for\n\t\t * the stream end if required\n\t\t */\n\t\tif (workspace->strm.avail_out == 0) {\n\t\t\tkunmap(out_page);\n\t\t\tif (nr_pages == nr_dest_pages) {\n\t\t\t\tout_page = NULL;\n\t\t\t\tret = -E2BIG;\n\t\t\t\tgoto out;\n\t\t\t}\n\t\t\tout_page = alloc_page(GFP_NOFS | __GFP_HIGHMEM);\n\t\t\tif (out_page == NULL) {\n\t\t\t\tret = -ENOMEM;\n\t\t\t\tgoto out;\n\t\t\t}\n\t\t\tcpage_out = kmap(out_page);\n\t\t\tpages[nr_pages] = out_page;\n\t\t\tnr_pages++;\n\t\t\tworkspace->strm.avail_out = PAGE_CACHE_SIZE;\n\t\t\tworkspace->strm.next_out = cpage_out;\n\t\t}\n\t\t/* we're all done */\n\t\tif (workspace->strm.total_in >= len)\n\t\t\tbreak;\n\n\t\t/* we've read in a full page, get a new one */\n\t\tif (workspace->strm.avail_in == 0) {\n\t\t\tif (workspace->strm.total_out > max_out)\n\t\t\t\tbreak;\n\n\t\t\tbytes_left = len - workspace->strm.total_in;\n\t\t\tkunmap(in_page);\n\t\t\tpage_cache_release(in_page);\n\n\t\t\tstart += PAGE_CACHE_SIZE;\n\t\t\tin_page = find_get_page(mapping,\n\t\t\t\t\t\tstart >> PAGE_CACHE_SHIFT);\n\t\t\tdata_in = kmap(in_page);\n\t\t\tworkspace->strm.avail_in = min(bytes_left,\n\t\t\t\t\t\t\t   PAGE_CACHE_SIZE);\n\t\t\tworkspace->strm.next_in = data_in;\n\t\t}\n\t}\n\tworkspace->strm.avail_in = 0;\n\tret = zlib_deflate(&workspace->strm, Z_FINISH);\n\tzlib_deflateEnd(&workspace->strm);\n\n\tif (ret != Z_STREAM_END) {\n\t\tret = -EIO;\n\t\tgoto out;\n\t}\n\n\tif (workspace->strm.total_out >= workspace->strm.total_in) {\n\t\tret = -E2BIG;\n\t\tgoto out;\n\t}\n\n\tret = 0;\n\t*total_out = workspace->strm.total_out;\n\t*total_in = workspace->strm.total_in;\nout:\n\t*out_pages = nr_pages;\n\tif (out_page)\n\t\tkunmap(out_page);\n\n\tif (in_page) {\n\t\tkunmap(in_page);\n\t\tpage_cache_release(in_page);\n\t}\n\treturn ret;\n}"
  },
  {
    "function_name": "lib_alloc_workspace(",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/btrfs/zlib.c",
    "lines": "50-72",
    "snippet": "tatic struct list_head *zlib_alloc_workspace(void)\n{\n\tstruct workspace *workspace;\n\tint workspacesize;\n\n\tworkspace = kzalloc(sizeof(*workspace), GFP_NOFS);\n\tif (!workspace)\n\t\treturn ERR_PTR(-ENOMEM);\n\n\tworkspacesize = max(zlib_deflate_workspacesize(MAX_WBITS, MAX_MEM_LEVEL),\n\t\t\tzlib_inflate_workspacesize());\n\tworkspace->strm.workspace = vmalloc(workspacesize);\n\tworkspace->buf = kmalloc(PAGE_CACHE_SIZE, GFP_NOFS);\n\tif (!workspace->strm.workspace || !workspace->buf)\n\t\tgoto fail;\n\n\tINIT_LIST_HEAD(&workspace->list);\n\n\treturn &workspace->list;\nfail:\n\tzlib_free_workspace(&workspace->list);\n\treturn ERR_PTR(-ENOMEM);\n}",
    "includes": [
      "include \"compression.h\"",
      "include <linux/bio.h>\n#",
      "include <linux/pagemap.h>\n#",
      "include <linux/sched.h>\n#",
      "include <linux/err.h>\n#",
      "include <linux/init.h>\n#",
      "include <linux/vmalloc.h>\n#",
      "include <linux/zutil.h>\n#",
      "include <linux/zlib.h>\n#",
      "include <linux/slab.h>\n#",
      "include <linux/kernel.h>\n#"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "RR_PTR(",
          "args": [
            "ENOMEM)"
          ],
          "line": 71
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lib_free_workspace(",
          "args": [
            "workspace->list)"
          ],
          "line": 70
        },
        "resolved": true,
        "details": {
          "function_name": "lib_free_workspace(",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/btrfs/zlib.c",
          "lines": "41-48",
          "snippet": "tatic void zlib_free_workspace(struct list_head *ws)\n{\n\tstruct workspace *workspace = list_entry(ws, struct workspace, list);\n\n\tvfree(workspace->strm.workspace);\n\tkfree(workspace->buf);\n\tkfree(workspace);\n}",
          "includes": [
            "include \"compression.h\"",
            "include <linux/bio.h>\n#",
            "include <linux/pagemap.h>\n#",
            "include <linux/sched.h>\n#",
            "include <linux/err.h>\n#",
            "include <linux/init.h>\n#",
            "include <linux/vmalloc.h>\n#",
            "include <linux/zutil.h>\n#",
            "include <linux/zlib.h>\n#",
            "include <linux/slab.h>\n#",
            "include <linux/kernel.h>\n#"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "include \"compression.h\"\ninclude <linux/bio.h>\n#\ninclude <linux/pagemap.h>\n#\ninclude <linux/sched.h>\n#\ninclude <linux/err.h>\n#\ninclude <linux/init.h>\n#\ninclude <linux/vmalloc.h>\n#\ninclude <linux/zutil.h>\n#\ninclude <linux/zlib.h>\n#\ninclude <linux/slab.h>\n#\ninclude <linux/kernel.h>\n#\n\ntatic void zlib_free_workspace(struct list_head *ws)\n{\n\tstruct workspace *workspace = list_entry(ws, struct workspace, list);\n\n\tvfree(workspace->strm.workspace);\n\tkfree(workspace->buf);\n\tkfree(workspace);\n}"
        }
      },
      {
        "call_info": {
          "callee": "NIT_LIST_HEAD(",
          "args": [
            "workspace->list)"
          ],
          "line": 66
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "malloc(",
          "args": [
            "AGE_CACHE_SIZE,",
            "FP_NOFS)"
          ],
          "line": 62
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "malloc(",
          "args": [
            "orkspacesize)"
          ],
          "line": 61
        },
        "resolved": true,
        "details": {
          "function_name": "ffs2_blocks_use_vmalloc(",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/jffs2/nodelist.h",
          "lines": "292-295",
          "snippet": "tatic inline int jffs2_blocks_use_vmalloc(struct jffs2_sb_info *c)\n{\n\treturn ((c->flash_size / c->sector_size) * sizeof (struct jffs2_eraseblock)) > (128 * 1024);\n}",
          "includes": [
            "include \"debug.h\"",
            "include \"os-linux.h\"\n#",
            "include \"os-ecos.h\"\n#",
            "include \"summary.h\"",
            "include \"acl.h\"\n#",
            "include \"xattr.h\"\n#",
            "include \"jffs2_fs_i.h\"\n#",
            "include \"jffs2_fs_sb.h\"\n#",
            "include <linux/jffs2.h>\n#",
            "include <linux/types.h>\n#",
            "include <linux/fs.h>\n#"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "include \"debug.h\"\ninclude \"os-linux.h\"\n#\ninclude \"os-ecos.h\"\n#\ninclude \"summary.h\"\ninclude \"acl.h\"\n#\ninclude \"xattr.h\"\n#\ninclude \"jffs2_fs_i.h\"\n#\ninclude \"jffs2_fs_sb.h\"\n#\ninclude <linux/jffs2.h>\n#\ninclude <linux/types.h>\n#\ninclude <linux/fs.h>\n#\n\ntatic inline int jffs2_blocks_use_vmalloc(struct jffs2_sb_info *c)\n{\n\treturn ((c->flash_size / c->sector_size) * sizeof (struct jffs2_eraseblock)) > (128 * 1024);\n}"
        }
      },
      {
        "call_info": {
          "callee": "ax(",
          "args": [
            "lib_deflate_workspacesize(MAX_WBITS, MAX_MEM_LEVEL),",
            "lib_inflate_workspacesize())"
          ],
          "line": 59
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lib_inflate_workspacesize(",
          "args": [],
          "line": 60
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lib_deflate_workspacesize(",
          "args": [
            "AX_WBITS,",
            "AX_MEM_LEVEL)"
          ],
          "line": 59
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "RR_PTR(",
          "args": [
            "ENOMEM)"
          ],
          "line": 57
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "zalloc(",
          "args": [
            "izeof(*workspace),",
            "FP_NOFS)"
          ],
          "line": 55
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "include \"compression.h\"\ninclude <linux/bio.h>\n#\ninclude <linux/pagemap.h>\n#\ninclude <linux/sched.h>\n#\ninclude <linux/err.h>\n#\ninclude <linux/init.h>\n#\ninclude <linux/vmalloc.h>\n#\ninclude <linux/zutil.h>\n#\ninclude <linux/zlib.h>\n#\ninclude <linux/slab.h>\n#\ninclude <linux/kernel.h>\n#\n\ntatic struct list_head *zlib_alloc_workspace(void)\n{\n\tstruct workspace *workspace;\n\tint workspacesize;\n\n\tworkspace = kzalloc(sizeof(*workspace), GFP_NOFS);\n\tif (!workspace)\n\t\treturn ERR_PTR(-ENOMEM);\n\n\tworkspacesize = max(zlib_deflate_workspacesize(MAX_WBITS, MAX_MEM_LEVEL),\n\t\t\tzlib_inflate_workspacesize());\n\tworkspace->strm.workspace = vmalloc(workspacesize);\n\tworkspace->buf = kmalloc(PAGE_CACHE_SIZE, GFP_NOFS);\n\tif (!workspace->strm.workspace || !workspace->buf)\n\t\tgoto fail;\n\n\tINIT_LIST_HEAD(&workspace->list);\n\n\treturn &workspace->list;\nfail:\n\tzlib_free_workspace(&workspace->list);\n\treturn ERR_PTR(-ENOMEM);\n}"
  },
  {
    "function_name": "lib_free_workspace(",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/btrfs/zlib.c",
    "lines": "41-48",
    "snippet": "tatic void zlib_free_workspace(struct list_head *ws)\n{\n\tstruct workspace *workspace = list_entry(ws, struct workspace, list);\n\n\tvfree(workspace->strm.workspace);\n\tkfree(workspace->buf);\n\tkfree(workspace);\n}",
    "includes": [
      "include \"compression.h\"",
      "include <linux/bio.h>\n#",
      "include <linux/pagemap.h>\n#",
      "include <linux/sched.h>\n#",
      "include <linux/err.h>\n#",
      "include <linux/init.h>\n#",
      "include <linux/vmalloc.h>\n#",
      "include <linux/zutil.h>\n#",
      "include <linux/zlib.h>\n#",
      "include <linux/slab.h>\n#",
      "include <linux/kernel.h>\n#"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free(",
          "args": [
            "orkspace)"
          ],
          "line": 47
        },
        "resolved": true,
        "details": {
          "function_name": "in_free(",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/jffs2/scan.c",
          "lines": "51-60",
          "snippet": "tatic inline int min_free(struct jffs2_sb_info *c)\n{\n\tuint32_t min = 2 * sizeof(struct jffs2_raw_inode);\n#ifdef CONFIG_JFFS2_FS_WRITEBUFFER\n\tif (!jffs2_can_mark_obsolete(c) && min < c->wbuf_pagesize)\n\t\treturn c->wbuf_pagesize;\n#endif\n\treturn min;\n\n}",
          "includes": [
            "include \"debug.h\"",
            "include \"summary.h\"\n#",
            "include \"nodelist.h\"\n#",
            "include <linux/compiler.h>\n#",
            "include <linux/crc32.h>\n#",
            "include <linux/pagemap.h>\n#",
            "include <linux/mtd/mtd.h>\n#",
            "include <linux/slab.h>\n#",
            "include <linux/sched.h>\n#",
            "include <linux/kernel.h>\n#"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "include \"debug.h\"\ninclude \"summary.h\"\n#\ninclude \"nodelist.h\"\n#\ninclude <linux/compiler.h>\n#\ninclude <linux/crc32.h>\n#\ninclude <linux/pagemap.h>\n#\ninclude <linux/mtd/mtd.h>\n#\ninclude <linux/slab.h>\n#\ninclude <linux/sched.h>\n#\ninclude <linux/kernel.h>\n#\n\ntatic inline int min_free(struct jffs2_sb_info *c)\n{\n\tuint32_t min = 2 * sizeof(struct jffs2_raw_inode);\n#ifdef CONFIG_JFFS2_FS_WRITEBUFFER\n\tif (!jffs2_can_mark_obsolete(c) && min < c->wbuf_pagesize)\n\t\treturn c->wbuf_pagesize;\n#endif\n\treturn min;\n\n}"
        }
      },
      {
        "call_info": {
          "callee": "ist_entry(",
          "args": [
            "s,",
            "truct orkspace,",
            "ist)"
          ],
          "line": 43
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "include \"compression.h\"\ninclude <linux/bio.h>\n#\ninclude <linux/pagemap.h>\n#\ninclude <linux/sched.h>\n#\ninclude <linux/err.h>\n#\ninclude <linux/init.h>\n#\ninclude <linux/vmalloc.h>\n#\ninclude <linux/zutil.h>\n#\ninclude <linux/zlib.h>\n#\ninclude <linux/slab.h>\n#\ninclude <linux/kernel.h>\n#\n\ntatic void zlib_free_workspace(struct list_head *ws)\n{\n\tstruct workspace *workspace = list_entry(ws, struct workspace, list);\n\n\tvfree(workspace->strm.workspace);\n\tkfree(workspace->buf);\n\tkfree(workspace);\n}"
  }
]