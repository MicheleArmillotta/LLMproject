[
  {
    "function_name": "fs2_lzo_exit(v",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/jffs2/compr_lzo.c",
    "lines": "106-110",
    "snippet": "id jffs2_lzo_exit(void)\n{\n\tjffs2_unregister_compressor(&jffs2_lzo_comp);\n\tfree_workspace();\n}",
    "includes": [
      "nclude \"compr.h\"\n\ns",
      "nclude <linux/lzo.h>\n#i",
      "nclude <linux/init.h>\n#i",
      "nclude <linux/vmalloc.h>\n#i",
      "nclude <linux/sched.h>\n#i",
      "nclude <linux/kernel.h>\n#i"
    ],
    "macros_used": [],
    "globals_used": [
      "atic struct jffs2_compressor jffs2_lzo_comp = {\n\t.priority = JFFS2_LZO_PRIORITY,\n\t.name = \"lzo\",\n\t.compr = JFFS2_COMPR_LZO,\n\t.compress = &jffs2_lzo_compress,\n\t.decompress = &jffs2_lzo_decompress,\n\t.disabled = 0,\n};"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "ee_workspace()",
          "args": [],
          "line": 109
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs2_unregister_compressor(&",
          "args": [
            "ffs2_lzo_comp);"
          ],
          "line": 108
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "nclude \"compr.h\"\n\ns\nnclude <linux/lzo.h>\n#i\nnclude <linux/init.h>\n#i\nnclude <linux/vmalloc.h>\n#i\nnclude <linux/sched.h>\n#i\nnclude <linux/kernel.h>\n#i\n\natic struct jffs2_compressor jffs2_lzo_comp = {\n\t.priority = JFFS2_LZO_PRIORITY,\n\t.name = \"lzo\",\n\t.compr = JFFS2_COMPR_LZO,\n\t.compress = &jffs2_lzo_compress,\n\t.decompress = &jffs2_lzo_decompress,\n\t.disabled = 0,\n};\n\nid jffs2_lzo_exit(void)\n{\n\tjffs2_unregister_compressor(&jffs2_lzo_comp);\n\tfree_workspace();\n}"
  },
  {
    "function_name": "fs2_lzo_init(v",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/jffs2/compr_lzo.c",
    "lines": "91-104",
    "snippet": "t __init jffs2_lzo_init(void)\n{\n\tint ret;\n\n\tret = alloc_workspace();\n\tif (ret < 0)\n\t\treturn ret;\n\n\tret = jffs2_register_compressor(&jffs2_lzo_comp);\n\tif (ret)\n\t\tfree_workspace();\n\n\treturn ret;\n}",
    "includes": [
      "nclude \"compr.h\"\n\ns",
      "nclude <linux/lzo.h>\n#i",
      "nclude <linux/init.h>\n#i",
      "nclude <linux/vmalloc.h>\n#i",
      "nclude <linux/sched.h>\n#i",
      "nclude <linux/kernel.h>\n#i"
    ],
    "macros_used": [],
    "globals_used": [
      "atic struct jffs2_compressor jffs2_lzo_comp = {\n\t.priority = JFFS2_LZO_PRIORITY,\n\t.name = \"lzo\",\n\t.compr = JFFS2_COMPR_LZO,\n\t.compress = &jffs2_lzo_compress,\n\t.decompress = &jffs2_lzo_decompress,\n\t.disabled = 0,\n};"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "ee_workspace()",
          "args": [],
          "line": 101
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs2_register_compressor(&",
          "args": [
            "ffs2_lzo_comp);"
          ],
          "line": 99
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "loc_workspace()",
          "args": [],
          "line": 95
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "nclude \"compr.h\"\n\ns\nnclude <linux/lzo.h>\n#i\nnclude <linux/init.h>\n#i\nnclude <linux/vmalloc.h>\n#i\nnclude <linux/sched.h>\n#i\nnclude <linux/kernel.h>\n#i\n\natic struct jffs2_compressor jffs2_lzo_comp = {\n\t.priority = JFFS2_LZO_PRIORITY,\n\t.name = \"lzo\",\n\t.compr = JFFS2_COMPR_LZO,\n\t.compress = &jffs2_lzo_compress,\n\t.decompress = &jffs2_lzo_decompress,\n\t.disabled = 0,\n};\n\nt __init jffs2_lzo_init(void)\n{\n\tint ret;\n\n\tret = alloc_workspace();\n\tif (ret < 0)\n\t\treturn ret;\n\n\tret = jffs2_register_compressor(&jffs2_lzo_comp);\n\tif (ret)\n\t\tfree_workspace();\n\n\treturn ret;\n}"
  },
  {
    "function_name": "fs2_lzo_decompress(u",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/jffs2/compr_lzo.c",
    "lines": "68-80",
    "snippet": "atic int jffs2_lzo_decompress(unsigned char *data_in, unsigned char *cpage_out,\n\t\t\t\t uint32_t srclen, uint32_t destlen)\n{\n\tsize_t dl = destlen;\n\tint ret;\n\n\tret = lzo1x_decompress_safe(data_in, srclen, cpage_out, &dl);\n\n\tif (ret != LZO_E_OK || dl != destlen)\n\t\treturn -1;\n\n\treturn 0;\n}",
    "includes": [
      "nclude \"compr.h\"\n\ns",
      "nclude <linux/lzo.h>\n#i",
      "nclude <linux/init.h>\n#i",
      "nclude <linux/vmalloc.h>\n#i",
      "nclude <linux/sched.h>\n#i",
      "nclude <linux/kernel.h>\n#i"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "o1x_decompress_safe(d",
          "args": [
            "ta_in,",
            "clen,",
            "age_out,",
            "l);"
          ],
          "line": 74
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "nclude \"compr.h\"\n\ns\nnclude <linux/lzo.h>\n#i\nnclude <linux/init.h>\n#i\nnclude <linux/vmalloc.h>\n#i\nnclude <linux/sched.h>\n#i\nnclude <linux/kernel.h>\n#i\n\natic int jffs2_lzo_decompress(unsigned char *data_in, unsigned char *cpage_out,\n\t\t\t\t uint32_t srclen, uint32_t destlen)\n{\n\tsize_t dl = destlen;\n\tint ret;\n\n\tret = lzo1x_decompress_safe(data_in, srclen, cpage_out, &dl);\n\n\tif (ret != LZO_E_OK || dl != destlen)\n\t\treturn -1;\n\n\treturn 0;\n}"
  },
  {
    "function_name": "fs2_lzo_compress(u",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/jffs2/compr_lzo.c",
    "lines": "43-66",
    "snippet": "atic int jffs2_lzo_compress(unsigned char *data_in, unsigned char *cpage_out,\n\t\t\t      uint32_t *sourcelen, uint32_t *dstlen)\n{\n\tsize_t compress_size;\n\tint ret;\n\n\tmutex_lock(&deflate_mutex);\n\tret = lzo1x_1_compress(data_in, *sourcelen, lzo_compress_buf, &compress_size, lzo_mem);\n\tif (ret != LZO_E_OK)\n\t\tgoto fail;\n\n\tif (compress_size > *dstlen)\n\t\tgoto fail;\n\n\tmemcpy(cpage_out, lzo_compress_buf, compress_size);\n\tmutex_unlock(&deflate_mutex);\n\n\t*dstlen = compress_size;\n\treturn 0;\n\n fail:\n\tmutex_unlock(&deflate_mutex);\n\treturn -1;\n}",
    "includes": [
      "nclude \"compr.h\"\n\ns",
      "nclude <linux/lzo.h>\n#i",
      "nclude <linux/init.h>\n#i",
      "nclude <linux/vmalloc.h>\n#i",
      "nclude <linux/sched.h>\n#i",
      "nclude <linux/kernel.h>\n#i"
    ],
    "macros_used": [],
    "globals_used": [
      "atic DEFINE_MUTEX(deflate_mutex);\t/"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "tex_unlock(&",
          "args": [
            "eflate_mutex);"
          ],
          "line": 64
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "tex_unlock(&",
          "args": [
            "eflate_mutex);"
          ],
          "line": 58
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "mcpy(c",
          "args": [
            "age_out,",
            "o_compress_buf,",
            "mpress_size);"
          ],
          "line": 57
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "o1x_1_compress(d",
          "args": [
            "ta_in,",
            "ourcelen,",
            "o_compress_buf,",
            "ompress_size,",
            "o_mem);"
          ],
          "line": 50
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "tex_lock(&",
          "args": [
            "eflate_mutex);"
          ],
          "line": 49
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "nclude \"compr.h\"\n\ns\nnclude <linux/lzo.h>\n#i\nnclude <linux/init.h>\n#i\nnclude <linux/vmalloc.h>\n#i\nnclude <linux/sched.h>\n#i\nnclude <linux/kernel.h>\n#i\n\natic DEFINE_MUTEX(deflate_mutex);\t/;\n\natic int jffs2_lzo_compress(unsigned char *data_in, unsigned char *cpage_out,\n\t\t\t      uint32_t *sourcelen, uint32_t *dstlen)\n{\n\tsize_t compress_size;\n\tint ret;\n\n\tmutex_lock(&deflate_mutex);\n\tret = lzo1x_1_compress(data_in, *sourcelen, lzo_compress_buf, &compress_size, lzo_mem);\n\tif (ret != LZO_E_OK)\n\t\tgoto fail;\n\n\tif (compress_size > *dstlen)\n\t\tgoto fail;\n\n\tmemcpy(cpage_out, lzo_compress_buf, compress_size);\n\tmutex_unlock(&deflate_mutex);\n\n\t*dstlen = compress_size;\n\treturn 0;\n\n fail:\n\tmutex_unlock(&deflate_mutex);\n\treturn -1;\n}"
  },
  {
    "function_name": "loc_workspace(v",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/jffs2/compr_lzo.c",
    "lines": "30-41",
    "snippet": "atic int __init alloc_workspace(void)\n{\n\tlzo_mem = vmalloc(LZO1X_MEM_COMPRESS);\n\tlzo_compress_buf = vmalloc(lzo1x_worst_compress(PAGE_SIZE));\n\n\tif (!lzo_mem || !lzo_compress_buf) {\n\t\tfree_workspace();\n\t\treturn -ENOMEM;\n\t}\n\n\treturn 0;\n}",
    "includes": [
      "nclude \"compr.h\"\n\ns",
      "nclude <linux/lzo.h>\n#i",
      "nclude <linux/init.h>\n#i",
      "nclude <linux/vmalloc.h>\n#i",
      "nclude <linux/sched.h>\n#i",
      "nclude <linux/kernel.h>\n#i"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "ee_workspace()",
          "args": [],
          "line": 36
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "alloc(l",
          "args": [
            "o1x_worst_compress(PAGE_SIZE));"
          ],
          "line": 33
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "o1x_worst_compress(P",
          "args": [
            "GE_SIZE))"
          ],
          "line": 33
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "alloc(L",
          "args": [
            "O1X_MEM_COMPRESS);"
          ],
          "line": 32
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "nclude \"compr.h\"\n\ns\nnclude <linux/lzo.h>\n#i\nnclude <linux/init.h>\n#i\nnclude <linux/vmalloc.h>\n#i\nnclude <linux/sched.h>\n#i\nnclude <linux/kernel.h>\n#i\n\natic int __init alloc_workspace(void)\n{\n\tlzo_mem = vmalloc(LZO1X_MEM_COMPRESS);\n\tlzo_compress_buf = vmalloc(lzo1x_worst_compress(PAGE_SIZE));\n\n\tif (!lzo_mem || !lzo_compress_buf) {\n\t\tfree_workspace();\n\t\treturn -ENOMEM;\n\t}\n\n\treturn 0;\n}"
  },
  {
    "function_name": "ee_workspace(v",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/jffs2/compr_lzo.c",
    "lines": "24-28",
    "snippet": "atic void free_workspace(void)\n{\n\tvfree(lzo_mem);\n\tvfree(lzo_compress_buf);\n}",
    "includes": [
      "nclude \"compr.h\"\n\ns",
      "nclude <linux/lzo.h>\n#i",
      "nclude <linux/init.h>\n#i",
      "nclude <linux/vmalloc.h>\n#i",
      "nclude <linux/sched.h>\n#i",
      "nclude <linux/kernel.h>\n#i"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "ree(l",
          "args": [
            "o_compress_buf);"
          ],
          "line": 27
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ree(l",
          "args": [
            "o_mem);"
          ],
          "line": 26
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "nclude \"compr.h\"\n\ns\nnclude <linux/lzo.h>\n#i\nnclude <linux/init.h>\n#i\nnclude <linux/vmalloc.h>\n#i\nnclude <linux/sched.h>\n#i\nnclude <linux/kernel.h>\n#i\n\natic void free_workspace(void)\n{\n\tvfree(lzo_mem);\n\tvfree(lzo_compress_buf);\n}"
  }
]