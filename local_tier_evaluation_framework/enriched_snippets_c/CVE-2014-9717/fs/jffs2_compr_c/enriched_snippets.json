[
  {
    "function_name": "s2_compressors_exit(vo",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/jffs2/compr.c",
    "lines": "401-418",
    "snippet": "jffs2_compressors_exit(void)\n{\n/* Unregistering compressors */\n#ifdef CONFIG_JFFS2_LZO\n\tjffs2_lzo_exit();\n#endif\n#ifdef CONFIG_JFFS2_RUBIN\n\tjffs2_dynrubin_exit();\n\tjffs2_rubinmips_exit();\n#endif\n#ifdef CONFIG_JFFS2_RTIME\n\tjffs2_rtime_exit();\n#endif\n#ifdef CONFIG_JFFS2_ZLIB\n\tjffs2_zlib_exit();\n#endif\n\treturn 0;\n}",
    "includes": [
      "clude \"compr.h\"\n\nst"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "s2_zlib_exit();",
          "args": [],
          "line": 415
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "s2_rtime_exit();",
          "args": [],
          "line": 412
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "s2_rubinmips_exit();",
          "args": [],
          "line": 409
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "s2_dynrubin_exit();",
          "args": [],
          "line": 408
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "s2_lzo_exit();",
          "args": [],
          "line": 405
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "clude \"compr.h\"\n\nst\n\njffs2_compressors_exit(void)\n{\n/* Unregistering compressors */\n#ifdef CONFIG_JFFS2_LZO\n\tjffs2_lzo_exit();\n#endif\n#ifdef CONFIG_JFFS2_RUBIN\n\tjffs2_dynrubin_exit();\n\tjffs2_rubinmips_exit();\n#endif\n#ifdef CONFIG_JFFS2_RTIME\n\tjffs2_rtime_exit();\n#endif\n#ifdef CONFIG_JFFS2_ZLIB\n\tjffs2_zlib_exit();\n#endif\n\treturn 0;\n}"
  },
  {
    "function_name": "s2_compressors_init(vo",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/jffs2/compr.c",
    "lines": "365-399",
    "snippet": "__init jffs2_compressors_init(void)\n{\n/* Registering compressors */\n#ifdef CONFIG_JFFS2_ZLIB\n\tjffs2_zlib_init();\n#endif\n#ifdef CONFIG_JFFS2_RTIME\n\tjffs2_rtime_init();\n#endif\n#ifdef CONFIG_JFFS2_RUBIN\n\tjffs2_rubinmips_init();\n\tjffs2_dynrubin_init();\n#endif\n#ifdef CONFIG_JFFS2_LZO\n\tjffs2_lzo_init();\n#endif\n/* Setting default compression mode */\n#ifdef CONFIG_JFFS2_CMODE_NONE\n\tjffs2_compression_mode = JFFS2_COMPR_MODE_NONE;\n\tjffs2_dbg(1, \"default compression mode: none\\n\");\n#else\n#ifdef CONFIG_JFFS2_CMODE_SIZE\n\tjffs2_compression_mode = JFFS2_COMPR_MODE_SIZE;\n\tjffs2_dbg(1, \"default compression mode: size\\n\");\n#else\n#ifdef CONFIG_JFFS2_CMODE_FAVOURLZO\n\tjffs2_compression_mode = JFFS2_COMPR_MODE_FAVOURLZO;\n\tjffs2_dbg(1, \"default compression mode: favourlzo\\n\");\n#else\n\tjffs2_dbg(1, \"default compression mode: priority\\n\");\n#endif\n#endif\n#endif\n\treturn 0;\n}\n\ni",
    "includes": [
      "clude \"compr.h\"\n\nst"
    ],
    "macros_used": [],
    "globals_used": [
      "tic int jffs2_compression_mode = JFFS2_COMPR_MODE_PRIORITY;\n\n/"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "s2_dbg(1,",
          "args": [
            "\"",
            "fault compression mode: priority\\n\");"
          ],
          "line": 394
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "s2_dbg(1,",
          "args": [
            "\"",
            "fault compression mode: favourlzo\\n\");"
          ],
          "line": 392
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "s2_dbg(1,",
          "args": [
            "\"",
            "fault compression mode: size\\n\");"
          ],
          "line": 388
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "s2_dbg(1,",
          "args": [
            "\"",
            "fault compression mode: none\\n\");"
          ],
          "line": 384
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "s2_lzo_init();",
          "args": [],
          "line": 379
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "s2_dynrubin_init();",
          "args": [],
          "line": 376
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "s2_rubinmips_init();",
          "args": [],
          "line": 375
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "s2_rtime_init();",
          "args": [],
          "line": 372
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "s2_zlib_init();",
          "args": [],
          "line": 369
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "clude \"compr.h\"\n\nst\n\ntic int jffs2_compression_mode = JFFS2_COMPR_MODE_PRIORITY;\n\n/;\n\n__init jffs2_compressors_init(void)\n{\n/* Registering compressors */\n#ifdef CONFIG_JFFS2_ZLIB\n\tjffs2_zlib_init();\n#endif\n#ifdef CONFIG_JFFS2_RTIME\n\tjffs2_rtime_init();\n#endif\n#ifdef CONFIG_JFFS2_RUBIN\n\tjffs2_rubinmips_init();\n\tjffs2_dynrubin_init();\n#endif\n#ifdef CONFIG_JFFS2_LZO\n\tjffs2_lzo_init();\n#endif\n/* Setting default compression mode */\n#ifdef CONFIG_JFFS2_CMODE_NONE\n\tjffs2_compression_mode = JFFS2_COMPR_MODE_NONE;\n\tjffs2_dbg(1, \"default compression mode: none\\n\");\n#else\n#ifdef CONFIG_JFFS2_CMODE_SIZE\n\tjffs2_compression_mode = JFFS2_COMPR_MODE_SIZE;\n\tjffs2_dbg(1, \"default compression mode: size\\n\");\n#else\n#ifdef CONFIG_JFFS2_CMODE_FAVOURLZO\n\tjffs2_compression_mode = JFFS2_COMPR_MODE_FAVOURLZO;\n\tjffs2_dbg(1, \"default compression mode: favourlzo\\n\");\n#else\n\tjffs2_dbg(1, \"default compression mode: priority\\n\");\n#endif\n#endif\n#endif\n\treturn 0;\n}\n\ni"
  },
  {
    "function_name": "s2_free_comprbuf(un",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/jffs2/compr.c",
    "lines": "359-363",
    "snippet": "d jffs2_free_comprbuf(unsigned char *comprbuf, unsigned char *orig)\n{\n\tif (orig != comprbuf)\n\t\tkfree(comprbuf);\n}\n\ni",
    "includes": [
      "clude \"compr.h\"\n\nst"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "ee(co",
          "args": [
            "prbuf);"
          ],
          "line": 362
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "clude \"compr.h\"\n\nst\n\nd jffs2_free_comprbuf(unsigned char *comprbuf, unsigned char *orig)\n{\n\tif (orig != comprbuf)\n\t\tkfree(comprbuf);\n}\n\ni"
  },
  {
    "function_name": "s2_unregister_compressor(st",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/jffs2/compr.c",
    "lines": "337-357",
    "snippet": "jffs2_unregister_compressor(struct jffs2_compressor *comp)\n{\n\tD2(struct jffs2_compressor *this);\n\n\tjffs2_dbg(1, \"Unregistering JFFS2 compressor \\\"%s\\\"\\n\", comp->name);\n\n\tspin_lock(&jffs2_compressor_list_lock);\n\n\tif (comp->usecount) {\n\t\tspin_unlock(&jffs2_compressor_list_lock);\n\t\tpr_warn(\"Compressor module is in use. Unregister failed.\\n\");\n\t\treturn -1;\n\t}\n\tlist_del(&comp->list);\n\n\tD2(list_for_each_entry(this, &jffs2_compressor_list, list) {\n\t\tprintk(KERN_DEBUG \"Compressor \\\"%s\\\", prio %d\\n\", this->name, this->priority);\n\t})\n\tspin_unlock(&jffs2_compressor_list_lock);\n\treturn 0;\n}\n\nv",
    "includes": [
      "clude \"compr.h\"\n\nst"
    ],
    "macros_used": [],
    "globals_used": [
      "tic DEFINE_SPINLOCK(jffs2_compressor_list_lock);\n\n/",
      "tic LIST_HEAD(jffs2_compressor_list);\n\n/"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "n_unlock(&j",
          "args": [
            "fs2_compressor_list_lock);"
          ],
          "line": 355
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "li",
          "args": [
            "t_for_each_entry(this, &jffs2_compressor_list, list) {\n\tprintk(KERN_DEBUG \"Compressor \\\"%s\\\", prio %d\\n\", this->name, this->priority);\n\t})"
          ],
          "line": 352
        },
        "resolved": true,
        "details": {
          "function_name": "fs2_clear_wbuf_ino_list(s",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/jffs2/wbuf.c",
          "lines": "69-83",
          "snippet": "atic void jffs2_clear_wbuf_ino_list(struct jffs2_sb_info *c)\n{\n\tstruct jffs2_inodirty *this;\n\n\tthis = c->wbuf_inodes;\n\n\tif (this != &inodirty_nomem) {\n\t\twhile (this) {\n\t\t\tstruct jffs2_inodirty *next = this->next;\n\t\t\tkfree(this);\n\t\t\tthis = next;\n\t\t}\n\t}\n\tc->wbuf_inodes = NULL;\n}",
          "includes": [
            "nclude \"nodelist.h\"\n\n/",
            "nclude <linux/writeback.h>\n\n#",
            "nclude <linux/sched.h>\n#i",
            "nclude <linux/jiffies.h>\n#i",
            "nclude <linux/mtd/nand.h>\n#i",
            "nclude <linux/crc32.h>\n#i",
            "nclude <linux/mtd/mtd.h>\n#i",
            "nclude <linux/slab.h>\n#i",
            "nclude <linux/kernel.h>\n#i"
          ],
          "macros_used": [],
          "globals_used": [
            "atic struct jffs2_inodirty inodirty_nomem;"
          ],
          "called_functions": [],
          "contextual_snippet": "nclude \"nodelist.h\"\n\n/\nnclude <linux/writeback.h>\n\n#\nnclude <linux/sched.h>\n#i\nnclude <linux/jiffies.h>\n#i\nnclude <linux/mtd/nand.h>\n#i\nnclude <linux/crc32.h>\n#i\nnclude <linux/mtd/mtd.h>\n#i\nnclude <linux/slab.h>\n#i\nnclude <linux/kernel.h>\n#i\n\natic struct jffs2_inodirty inodirty_nomem;\n\natic void jffs2_clear_wbuf_ino_list(struct jffs2_sb_info *c)\n{\n\tstruct jffs2_inodirty *this;\n\n\tthis = c->wbuf_inodes;\n\n\tif (this != &inodirty_nomem) {\n\t\twhile (this) {\n\t\t\tstruct jffs2_inodirty *next = this->next;\n\t\t\tkfree(this);\n\t\t\tthis = next;\n\t\t}\n\t}\n\tc->wbuf_inodes = NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "ntk(KE",
          "args": [
            "N_DEBUG \"Compressor \\\"%s\\\", prio %d\\n\", t",
            "s->name, t",
            "s->priority);"
          ],
          "line": 353
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "t_for_each_entry(th",
          "args": [
            "s, &",
            "fs2_compressor_list, l",
            "t) {"
          ],
          "line": 352
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "t_del(&c",
          "args": [
            "mp->list);"
          ],
          "line": 350
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "warn(\"C",
          "args": [
            "mpressor module is in use. Unregister failed.\\n\");"
          ],
          "line": 347
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "n_unlock(&j",
          "args": [
            "fs2_compressor_list_lock);"
          ],
          "line": 346
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "n_lock(&j",
          "args": [
            "fs2_compressor_list_lock);"
          ],
          "line": 343
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "s2_dbg(1,",
          "args": [
            "\"",
            "registering JFFS2 compressor \\\"%s\\\"\\n\", c",
            "p->name);"
          ],
          "line": 341
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "clude \"compr.h\"\n\nst\n\ntic DEFINE_SPINLOCK(jffs2_compressor_list_lock);\n\n/;\ntic LIST_HEAD(jffs2_compressor_list);\n\n/;\n\njffs2_unregister_compressor(struct jffs2_compressor *comp)\n{\n\tD2(struct jffs2_compressor *this);\n\n\tjffs2_dbg(1, \"Unregistering JFFS2 compressor \\\"%s\\\"\\n\", comp->name);\n\n\tspin_lock(&jffs2_compressor_list_lock);\n\n\tif (comp->usecount) {\n\t\tspin_unlock(&jffs2_compressor_list_lock);\n\t\tpr_warn(\"Compressor module is in use. Unregister failed.\\n\");\n\t\treturn -1;\n\t}\n\tlist_del(&comp->list);\n\n\tD2(list_for_each_entry(this, &jffs2_compressor_list, list) {\n\t\tprintk(KERN_DEBUG \"Compressor \\\"%s\\\", prio %d\\n\", this->name, this->priority);\n\t})\n\tspin_unlock(&jffs2_compressor_list_lock);\n\treturn 0;\n}\n\nv"
  },
  {
    "function_name": "s2_register_compressor(st",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/jffs2/compr.c",
    "lines": "301-335",
    "snippet": "jffs2_register_compressor(struct jffs2_compressor *comp)\n{\n\tstruct jffs2_compressor *this;\n\n\tif (!comp->name) {\n\t\tpr_warn(\"NULL compressor name at registering JFFS2 compressor. Failed.\\n\");\n\t\treturn -1;\n\t}\n\tcomp->compr_buf_size=0;\n\tcomp->compr_buf=NULL;\n\tcomp->usecount=0;\n\tcomp->stat_compr_orig_size=0;\n\tcomp->stat_compr_new_size=0;\n\tcomp->stat_compr_blocks=0;\n\tcomp->stat_decompr_blocks=0;\n\tjffs2_dbg(1, \"Registering JFFS2 compressor \\\"%s\\\"\\n\", comp->name);\n\n\tspin_lock(&jffs2_compressor_list_lock);\n\n\tlist_for_each_entry(this, &jffs2_compressor_list, list) {\n\t\tif (this->priority < comp->priority) {\n\t\t\tlist_add(&comp->list, this->list.prev);\n\t\t\tgoto out;\n\t\t}\n\t}\n\tlist_add_tail(&comp->list, &jffs2_compressor_list);\nout:\n\tD2(list_for_each_entry(this, &jffs2_compressor_list, list) {\n\t\tprintk(KERN_DEBUG \"Compressor \\\"%s\\\", prio %d\\n\", this->name, this->priority);\n\t})\n\n\tspin_unlock(&jffs2_compressor_list_lock);\n\n\treturn 0;\n}\n\ni",
    "includes": [
      "clude \"compr.h\"\n\nst"
    ],
    "macros_used": [],
    "globals_used": [
      "tic DEFINE_SPINLOCK(jffs2_compressor_list_lock);\n\n/",
      "tic LIST_HEAD(jffs2_compressor_list);\n\n/"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "n_unlock(&j",
          "args": [
            "fs2_compressor_list_lock);"
          ],
          "line": 332
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "li",
          "args": [
            "t_for_each_entry(this, &jffs2_compressor_list, list) {\n\tprintk(KERN_DEBUG \"Compressor \\\"%s\\\", prio %d\\n\", this->name, this->priority);\n\t})"
          ],
          "line": 328
        },
        "resolved": true,
        "details": {
          "function_name": "fs2_clear_wbuf_ino_list(s",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/jffs2/wbuf.c",
          "lines": "69-83",
          "snippet": "atic void jffs2_clear_wbuf_ino_list(struct jffs2_sb_info *c)\n{\n\tstruct jffs2_inodirty *this;\n\n\tthis = c->wbuf_inodes;\n\n\tif (this != &inodirty_nomem) {\n\t\twhile (this) {\n\t\t\tstruct jffs2_inodirty *next = this->next;\n\t\t\tkfree(this);\n\t\t\tthis = next;\n\t\t}\n\t}\n\tc->wbuf_inodes = NULL;\n}",
          "includes": [
            "nclude \"nodelist.h\"\n\n/",
            "nclude <linux/writeback.h>\n\n#",
            "nclude <linux/sched.h>\n#i",
            "nclude <linux/jiffies.h>\n#i",
            "nclude <linux/mtd/nand.h>\n#i",
            "nclude <linux/crc32.h>\n#i",
            "nclude <linux/mtd/mtd.h>\n#i",
            "nclude <linux/slab.h>\n#i",
            "nclude <linux/kernel.h>\n#i"
          ],
          "macros_used": [],
          "globals_used": [
            "atic struct jffs2_inodirty inodirty_nomem;"
          ],
          "called_functions": [],
          "contextual_snippet": "nclude \"nodelist.h\"\n\n/\nnclude <linux/writeback.h>\n\n#\nnclude <linux/sched.h>\n#i\nnclude <linux/jiffies.h>\n#i\nnclude <linux/mtd/nand.h>\n#i\nnclude <linux/crc32.h>\n#i\nnclude <linux/mtd/mtd.h>\n#i\nnclude <linux/slab.h>\n#i\nnclude <linux/kernel.h>\n#i\n\natic struct jffs2_inodirty inodirty_nomem;\n\natic void jffs2_clear_wbuf_ino_list(struct jffs2_sb_info *c)\n{\n\tstruct jffs2_inodirty *this;\n\n\tthis = c->wbuf_inodes;\n\n\tif (this != &inodirty_nomem) {\n\t\twhile (this) {\n\t\t\tstruct jffs2_inodirty *next = this->next;\n\t\t\tkfree(this);\n\t\t\tthis = next;\n\t\t}\n\t}\n\tc->wbuf_inodes = NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "ntk(KE",
          "args": [
            "N_DEBUG \"Compressor \\\"%s\\\", prio %d\\n\", t",
            "s->name, t",
            "s->priority);"
          ],
          "line": 329
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "t_for_each_entry(th",
          "args": [
            "s, &",
            "fs2_compressor_list, l",
            "t) {"
          ],
          "line": 328
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "t_add_tail(&c",
          "args": [
            "mp->list, &",
            "fs2_compressor_list);"
          ],
          "line": 326
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "t_add(&c",
          "args": [
            "mp->list, t",
            "s->list.prev);"
          ],
          "line": 322
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "t_for_each_entry(th",
          "args": [
            "s, &",
            "fs2_compressor_list, l",
            "t) {"
          ],
          "line": 320
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "n_lock(&j",
          "args": [
            "fs2_compressor_list_lock);"
          ],
          "line": 318
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "s2_dbg(1,",
          "args": [
            "\"",
            "gistering JFFS2 compressor \\\"%s\\\"\\n\", c",
            "p->name);"
          ],
          "line": 316
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "warn(\"N",
          "args": [
            "LL compressor name at registering JFFS2 compressor. Failed.\\n\");"
          ],
          "line": 306
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "clude \"compr.h\"\n\nst\n\ntic DEFINE_SPINLOCK(jffs2_compressor_list_lock);\n\n/;\ntic LIST_HEAD(jffs2_compressor_list);\n\n/;\n\njffs2_register_compressor(struct jffs2_compressor *comp)\n{\n\tstruct jffs2_compressor *this;\n\n\tif (!comp->name) {\n\t\tpr_warn(\"NULL compressor name at registering JFFS2 compressor. Failed.\\n\");\n\t\treturn -1;\n\t}\n\tcomp->compr_buf_size=0;\n\tcomp->compr_buf=NULL;\n\tcomp->usecount=0;\n\tcomp->stat_compr_orig_size=0;\n\tcomp->stat_compr_new_size=0;\n\tcomp->stat_compr_blocks=0;\n\tcomp->stat_decompr_blocks=0;\n\tjffs2_dbg(1, \"Registering JFFS2 compressor \\\"%s\\\"\\n\", comp->name);\n\n\tspin_lock(&jffs2_compressor_list_lock);\n\n\tlist_for_each_entry(this, &jffs2_compressor_list, list) {\n\t\tif (this->priority < comp->priority) {\n\t\t\tlist_add(&comp->list, this->list.prev);\n\t\t\tgoto out;\n\t\t}\n\t}\n\tlist_add_tail(&comp->list, &jffs2_compressor_list);\nout:\n\tD2(list_for_each_entry(this, &jffs2_compressor_list, list) {\n\t\tprintk(KERN_DEBUG \"Compressor \\\"%s\\\", prio %d\\n\", this->name, this->priority);\n\t})\n\n\tspin_unlock(&jffs2_compressor_list_lock);\n\n\treturn 0;\n}\n\ni"
  },
  {
    "function_name": "s2_decompress(st",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/jffs2/compr.c",
    "lines": "253-299",
    "snippet": "jffs2_decompress(struct jffs2_sb_info *c, struct jffs2_inode_info *f,\n\t\t     uint16_t comprtype, unsigned char *cdata_in,\n\t\t     unsigned char *data_out, uint32_t cdatalen, uint32_t datalen)\n{\n\tstruct jffs2_compressor *this;\n\tint ret;\n\n\t/* Older code had a bug where it would write non-zero 'usercompr'\n\t   fields. Deal with it. */\n\tif ((comprtype & 0xff) <= JFFS2_COMPR_ZLIB)\n\t\tcomprtype &= 0xff;\n\n\tswitch (comprtype & 0xff) {\n\tcase JFFS2_COMPR_NONE:\n\t\t/* This should be special-cased elsewhere, but we might as well deal with it */\n\t\tmemcpy(data_out, cdata_in, datalen);\n\t\tnone_stat_decompr_blocks++;\n\t\tbreak;\n\tcase JFFS2_COMPR_ZERO:\n\t\tmemset(data_out, 0, datalen);\n\t\tbreak;\n\tdefault:\n\t\tspin_lock(&jffs2_compressor_list_lock);\n\t\tlist_for_each_entry(this, &jffs2_compressor_list, list) {\n\t\t\tif (comprtype == this->compr) {\n\t\t\t\tthis->usecount++;\n\t\t\t\tspin_unlock(&jffs2_compressor_list_lock);\n\t\t\t\tret = this->decompress(cdata_in, data_out, cdatalen, datalen);\n\t\t\t\tspin_lock(&jffs2_compressor_list_lock);\n\t\t\t\tif (ret) {\n\t\t\t\t\tpr_warn(\"Decompressor \\\"%s\\\" returned %d\\n\",\n\t\t\t\t\t\tthis->name, ret);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tthis->stat_decompr_blocks++;\n\t\t\t\t}\n\t\t\t\tthis->usecount--;\n\t\t\t\tspin_unlock(&jffs2_compressor_list_lock);\n\t\t\t\treturn ret;\n\t\t\t}\n\t\t}\n\t\tpr_warn(\"compression type 0x%02x not available\\n\", comprtype);\n\t\tspin_unlock(&jffs2_compressor_list_lock);\n\t\treturn -EIO;\n\t}\n\treturn 0;\n}\n\ni",
    "includes": [
      "clude \"compr.h\"\n\nst"
    ],
    "macros_used": [],
    "globals_used": [
      "tic DEFINE_SPINLOCK(jffs2_compressor_list_lock);\n\n/",
      "tic LIST_HEAD(jffs2_compressor_list);\n\n/"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "n_unlock(&j",
          "args": [
            "fs2_compressor_list_lock);"
          ],
          "line": 295
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "warn(\"c",
          "args": [
            "mpression type 0x%02x not available\\n\", c",
            "prtype);"
          ],
          "line": 294
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "n_unlock(&j",
          "args": [
            "fs2_compressor_list_lock);"
          ],
          "line": 290
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "warn(\"D",
          "args": [
            "compressor \\\"%s\\\" returned %d\\n\",",
            "s->name, r",
            ");"
          ],
          "line": 283
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "n_lock(&j",
          "args": [
            "fs2_compressor_list_lock);"
          ],
          "line": 281
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "s->decompress",
          "args": [
            "ta_in, d",
            "a_out, c",
            "talen, d",
            "alen);"
          ],
          "line": 280
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "n_unlock(&j",
          "args": [
            "fs2_compressor_list_lock);"
          ],
          "line": 279
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "t_for_each_entry(th",
          "args": [
            "s, &",
            "fs2_compressor_list, l",
            "t) {"
          ],
          "line": 276
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "n_lock(&j",
          "args": [
            "fs2_compressor_list_lock);"
          ],
          "line": 275
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "set(da",
          "args": [
            "a_out, 0",
            "d",
            "alen);"
          ],
          "line": 272
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "cpy(da",
          "args": [
            "a_out, c",
            "ta_in, d",
            "alen);"
          ],
          "line": 268
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "clude \"compr.h\"\n\nst\n\ntic DEFINE_SPINLOCK(jffs2_compressor_list_lock);\n\n/;\ntic LIST_HEAD(jffs2_compressor_list);\n\n/;\n\njffs2_decompress(struct jffs2_sb_info *c, struct jffs2_inode_info *f,\n\t\t     uint16_t comprtype, unsigned char *cdata_in,\n\t\t     unsigned char *data_out, uint32_t cdatalen, uint32_t datalen)\n{\n\tstruct jffs2_compressor *this;\n\tint ret;\n\n\t/* Older code had a bug where it would write non-zero 'usercompr'\n\t   fields. Deal with it. */\n\tif ((comprtype & 0xff) <= JFFS2_COMPR_ZLIB)\n\t\tcomprtype &= 0xff;\n\n\tswitch (comprtype & 0xff) {\n\tcase JFFS2_COMPR_NONE:\n\t\t/* This should be special-cased elsewhere, but we might as well deal with it */\n\t\tmemcpy(data_out, cdata_in, datalen);\n\t\tnone_stat_decompr_blocks++;\n\t\tbreak;\n\tcase JFFS2_COMPR_ZERO:\n\t\tmemset(data_out, 0, datalen);\n\t\tbreak;\n\tdefault:\n\t\tspin_lock(&jffs2_compressor_list_lock);\n\t\tlist_for_each_entry(this, &jffs2_compressor_list, list) {\n\t\t\tif (comprtype == this->compr) {\n\t\t\t\tthis->usecount++;\n\t\t\t\tspin_unlock(&jffs2_compressor_list_lock);\n\t\t\t\tret = this->decompress(cdata_in, data_out, cdatalen, datalen);\n\t\t\t\tspin_lock(&jffs2_compressor_list_lock);\n\t\t\t\tif (ret) {\n\t\t\t\t\tpr_warn(\"Decompressor \\\"%s\\\" returned %d\\n\",\n\t\t\t\t\t\tthis->name, ret);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tthis->stat_decompr_blocks++;\n\t\t\t\t}\n\t\t\t\tthis->usecount--;\n\t\t\t\tspin_unlock(&jffs2_compressor_list_lock);\n\t\t\t\treturn ret;\n\t\t\t}\n\t\t}\n\t\tpr_warn(\"compression type 0x%02x not available\\n\", comprtype);\n\t\tspin_unlock(&jffs2_compressor_list_lock);\n\t\treturn -EIO;\n\t}\n\treturn 0;\n}\n\ni"
  },
  {
    "function_name": "s2_compress(st",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/jffs2/compr.c",
    "lines": "148-251",
    "snippet": "t16_t jffs2_compress(struct jffs2_sb_info *c, struct jffs2_inode_info *f,\n\t\t\tunsigned char *data_in, unsigned char **cpage_out,\n\t\t\tuint32_t *datalen, uint32_t *cdatalen)\n{\n\tint ret = JFFS2_COMPR_NONE;\n\tint mode, compr_ret;\n\tstruct jffs2_compressor *this, *best=NULL;\n\tunsigned char *output_buf = NULL, *tmp_buf;\n\tuint32_t orig_slen, orig_dlen;\n\tuint32_t best_slen=0, best_dlen=0;\n\n\tif (c->mount_opts.override_compr)\n\t\tmode = c->mount_opts.compr;\n\telse\n\t\tmode = jffs2_compression_mode;\n\n\tswitch (mode) {\n\tcase JFFS2_COMPR_MODE_NONE:\n\t\tbreak;\n\tcase JFFS2_COMPR_MODE_PRIORITY:\n\t\tret = jffs2_selected_compress(0, data_in, cpage_out, datalen,\n\t\t\t\tcdatalen);\n\t\tbreak;\n\tcase JFFS2_COMPR_MODE_SIZE:\n\tcase JFFS2_COMPR_MODE_FAVOURLZO:\n\t\torig_slen = *datalen;\n\t\torig_dlen = *cdatalen;\n\t\tspin_lock(&jffs2_compressor_list_lock);\n\t\tlist_for_each_entry(this, &jffs2_compressor_list, list) {\n\t\t\t/* Skip decompress-only backwards-compatibility and disabled modules */\n\t\t\tif ((!this->compress)||(this->disabled))\n\t\t\t\tcontinue;\n\t\t\t/* Allocating memory for output buffer if necessary */\n\t\t\tif ((this->compr_buf_size < orig_slen) && (this->compr_buf)) {\n\t\t\t\tspin_unlock(&jffs2_compressor_list_lock);\n\t\t\t\tkfree(this->compr_buf);\n\t\t\t\tspin_lock(&jffs2_compressor_list_lock);\n\t\t\t\tthis->compr_buf_size=0;\n\t\t\t\tthis->compr_buf=NULL;\n\t\t\t}\n\t\t\tif (!this->compr_buf) {\n\t\t\t\tspin_unlock(&jffs2_compressor_list_lock);\n\t\t\t\ttmp_buf = kmalloc(orig_slen, GFP_KERNEL);\n\t\t\t\tspin_lock(&jffs2_compressor_list_lock);\n\t\t\t\tif (!tmp_buf) {\n\t\t\t\t\tpr_warn(\"No memory for compressor allocation. (%d bytes)\\n\",\n\t\t\t\t\t\torig_slen);\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tthis->compr_buf = tmp_buf;\n\t\t\t\t\tthis->compr_buf_size = orig_slen;\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis->usecount++;\n\t\t\tspin_unlock(&jffs2_compressor_list_lock);\n\t\t\t*datalen  = orig_slen;\n\t\t\t*cdatalen = orig_dlen;\n\t\t\tcompr_ret = this->compress(data_in, this->compr_buf, datalen, cdatalen);\n\t\t\tspin_lock(&jffs2_compressor_list_lock);\n\t\t\tthis->usecount--;\n\t\t\tif (!compr_ret) {\n\t\t\t\tif (((!best_dlen) || jffs2_is_best_compression(this, best, *cdatalen, best_dlen))\n\t\t\t\t\t\t&& (*cdatalen < *datalen)) {\n\t\t\t\t\tbest_dlen = *cdatalen;\n\t\t\t\t\tbest_slen = *datalen;\n\t\t\t\t\tbest = this;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (best_dlen) {\n\t\t\t*cdatalen = best_dlen;\n\t\t\t*datalen  = best_slen;\n\t\t\toutput_buf = best->compr_buf;\n\t\t\tbest->compr_buf = NULL;\n\t\t\tbest->compr_buf_size = 0;\n\t\t\tbest->stat_compr_blocks++;\n\t\t\tbest->stat_compr_orig_size += best_slen;\n\t\t\tbest->stat_compr_new_size  += best_dlen;\n\t\t\tret = best->compr;\n\t\t\t*cpage_out = output_buf;\n\t\t}\n\t\tspin_unlock(&jffs2_compressor_list_lock);\n\t\tbreak;\n\tcase JFFS2_COMPR_MODE_FORCELZO:\n\t\tret = jffs2_selected_compress(JFFS2_COMPR_LZO, data_in,\n\t\t\t\tcpage_out, datalen, cdatalen);\n\t\tbreak;\n\tcase JFFS2_COMPR_MODE_FORCEZLIB:\n\t\tret = jffs2_selected_compress(JFFS2_COMPR_ZLIB, data_in,\n\t\t\t\tcpage_out, datalen, cdatalen);\n\t\tbreak;\n\tdefault:\n\t\tpr_err(\"unknown compression mode\\n\");\n\t}\n\n\tif (ret == JFFS2_COMPR_NONE) {\n\t\t*cpage_out = data_in;\n\t\t*datalen = *cdatalen;\n\t\tnone_stat_compr_blocks++;\n\t\tnone_stat_compr_size += *datalen;\n\t}\n\treturn ret;\n}\n\ni",
    "includes": [
      "clude \"compr.h\"\n\nst"
    ],
    "macros_used": [],
    "globals_used": [
      "tic DEFINE_SPINLOCK(jffs2_compressor_list_lock);\n\n/",
      "tic LIST_HEAD(jffs2_compressor_list);\n\n/",
      "tic int jffs2_compression_mode = JFFS2_COMPR_MODE_PRIORITY;\n\n/",
      "tic uint32_t none_stat_compr_blocks=0,none_stat_decompr_blocks=0,none_stat_compr_size=0;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "err(\"u",
          "args": [
            "known compression mode\\n\");"
          ],
          "line": 241
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "s2_selected_compress(JF",
          "args": [
            "S2_COMPR_ZLIB, d",
            "a_in,",
            "ge_out, d",
            "alen, c",
            "talen);"
          ],
          "line": 237
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "s2_selected_compress(JF",
          "args": [
            "S2_COMPR_LZO, d",
            "a_in,",
            "ge_out, d",
            "alen, c",
            "talen);"
          ],
          "line": 233
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "n_unlock(&j",
          "args": [
            "fs2_compressor_list_lock);"
          ],
          "line": 230
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "s2_is_best_compression(th",
          "args": [
            "s, b",
            "t, *",
            "atalen, b",
            "t_dlen))"
          ],
          "line": 210
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "n_lock(&j",
          "args": [
            "fs2_compressor_list_lock);"
          ],
          "line": 207
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "s->compress",
          "args": [
            "a_in, t",
            "s->compr_buf, d",
            "alen, c",
            "talen);"
          ],
          "line": 206
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "n_unlock(&j",
          "args": [
            "fs2_compressor_list_lock);"
          ],
          "line": 203
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "warn(\"N",
          "args": [
            "memory for compressor allocation. (%d bytes)\\n\",",
            "g_slen);"
          ],
          "line": 193
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "n_lock(&j",
          "args": [
            "fs2_compressor_list_lock);"
          ],
          "line": 191
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lloc(or",
          "args": [
            "g_slen, G",
            "_KERNEL);"
          ],
          "line": 190
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "n_unlock(&j",
          "args": [
            "fs2_compressor_list_lock);"
          ],
          "line": 189
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "n_lock(&j",
          "args": [
            "fs2_compressor_list_lock);"
          ],
          "line": 184
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ee(th",
          "args": [
            "s->compr_buf);"
          ],
          "line": 183
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "n_unlock(&j",
          "args": [
            "fs2_compressor_list_lock);"
          ],
          "line": 182
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "t_for_each_entry(th",
          "args": [
            "s, &",
            "fs2_compressor_list, l",
            "t) {"
          ],
          "line": 176
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "n_lock(&j",
          "args": [
            "fs2_compressor_list_lock);"
          ],
          "line": 175
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "s2_selected_compress(0,",
          "args": [
            "d",
            "a_in, c",
            "ge_out, d",
            "alen,",
            "talen);"
          ],
          "line": 168
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "clude \"compr.h\"\n\nst\n\ntic DEFINE_SPINLOCK(jffs2_compressor_list_lock);\n\n/;\ntic LIST_HEAD(jffs2_compressor_list);\n\n/;\ntic int jffs2_compression_mode = JFFS2_COMPR_MODE_PRIORITY;\n\n/;\ntic uint32_t none_stat_compr_blocks=0,none_stat_decompr_blocks=0,none_stat_compr_size=0;\n\nt16_t jffs2_compress(struct jffs2_sb_info *c, struct jffs2_inode_info *f,\n\t\t\tunsigned char *data_in, unsigned char **cpage_out,\n\t\t\tuint32_t *datalen, uint32_t *cdatalen)\n{\n\tint ret = JFFS2_COMPR_NONE;\n\tint mode, compr_ret;\n\tstruct jffs2_compressor *this, *best=NULL;\n\tunsigned char *output_buf = NULL, *tmp_buf;\n\tuint32_t orig_slen, orig_dlen;\n\tuint32_t best_slen=0, best_dlen=0;\n\n\tif (c->mount_opts.override_compr)\n\t\tmode = c->mount_opts.compr;\n\telse\n\t\tmode = jffs2_compression_mode;\n\n\tswitch (mode) {\n\tcase JFFS2_COMPR_MODE_NONE:\n\t\tbreak;\n\tcase JFFS2_COMPR_MODE_PRIORITY:\n\t\tret = jffs2_selected_compress(0, data_in, cpage_out, datalen,\n\t\t\t\tcdatalen);\n\t\tbreak;\n\tcase JFFS2_COMPR_MODE_SIZE:\n\tcase JFFS2_COMPR_MODE_FAVOURLZO:\n\t\torig_slen = *datalen;\n\t\torig_dlen = *cdatalen;\n\t\tspin_lock(&jffs2_compressor_list_lock);\n\t\tlist_for_each_entry(this, &jffs2_compressor_list, list) {\n\t\t\t/* Skip decompress-only backwards-compatibility and disabled modules */\n\t\t\tif ((!this->compress)||(this->disabled))\n\t\t\t\tcontinue;\n\t\t\t/* Allocating memory for output buffer if necessary */\n\t\t\tif ((this->compr_buf_size < orig_slen) && (this->compr_buf)) {\n\t\t\t\tspin_unlock(&jffs2_compressor_list_lock);\n\t\t\t\tkfree(this->compr_buf);\n\t\t\t\tspin_lock(&jffs2_compressor_list_lock);\n\t\t\t\tthis->compr_buf_size=0;\n\t\t\t\tthis->compr_buf=NULL;\n\t\t\t}\n\t\t\tif (!this->compr_buf) {\n\t\t\t\tspin_unlock(&jffs2_compressor_list_lock);\n\t\t\t\ttmp_buf = kmalloc(orig_slen, GFP_KERNEL);\n\t\t\t\tspin_lock(&jffs2_compressor_list_lock);\n\t\t\t\tif (!tmp_buf) {\n\t\t\t\t\tpr_warn(\"No memory for compressor allocation. (%d bytes)\\n\",\n\t\t\t\t\t\torig_slen);\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tthis->compr_buf = tmp_buf;\n\t\t\t\t\tthis->compr_buf_size = orig_slen;\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis->usecount++;\n\t\t\tspin_unlock(&jffs2_compressor_list_lock);\n\t\t\t*datalen  = orig_slen;\n\t\t\t*cdatalen = orig_dlen;\n\t\t\tcompr_ret = this->compress(data_in, this->compr_buf, datalen, cdatalen);\n\t\t\tspin_lock(&jffs2_compressor_list_lock);\n\t\t\tthis->usecount--;\n\t\t\tif (!compr_ret) {\n\t\t\t\tif (((!best_dlen) || jffs2_is_best_compression(this, best, *cdatalen, best_dlen))\n\t\t\t\t\t\t&& (*cdatalen < *datalen)) {\n\t\t\t\t\tbest_dlen = *cdatalen;\n\t\t\t\t\tbest_slen = *datalen;\n\t\t\t\t\tbest = this;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (best_dlen) {\n\t\t\t*cdatalen = best_dlen;\n\t\t\t*datalen  = best_slen;\n\t\t\toutput_buf = best->compr_buf;\n\t\t\tbest->compr_buf = NULL;\n\t\t\tbest->compr_buf_size = 0;\n\t\t\tbest->stat_compr_blocks++;\n\t\t\tbest->stat_compr_orig_size += best_slen;\n\t\t\tbest->stat_compr_new_size  += best_dlen;\n\t\t\tret = best->compr;\n\t\t\t*cpage_out = output_buf;\n\t\t}\n\t\tspin_unlock(&jffs2_compressor_list_lock);\n\t\tbreak;\n\tcase JFFS2_COMPR_MODE_FORCELZO:\n\t\tret = jffs2_selected_compress(JFFS2_COMPR_LZO, data_in,\n\t\t\t\tcpage_out, datalen, cdatalen);\n\t\tbreak;\n\tcase JFFS2_COMPR_MODE_FORCEZLIB:\n\t\tret = jffs2_selected_compress(JFFS2_COMPR_ZLIB, data_in,\n\t\t\t\tcpage_out, datalen, cdatalen);\n\t\tbreak;\n\tdefault:\n\t\tpr_err(\"unknown compression mode\\n\");\n\t}\n\n\tif (ret == JFFS2_COMPR_NONE) {\n\t\t*cpage_out = data_in;\n\t\t*datalen = *cdatalen;\n\t\tnone_stat_compr_blocks++;\n\t\tnone_stat_compr_size += *datalen;\n\t}\n\treturn ret;\n}\n\ni"
  },
  {
    "function_name": "s2_selected_compress(u8",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/jffs2/compr.c",
    "lines": "74-128",
    "snippet": "tic int jffs2_selected_compress(u8 compr, unsigned char *data_in,\n\t\tunsigned char **cpage_out, u32 *datalen, u32 *cdatalen)\n{\n\tstruct jffs2_compressor *this;\n\tint err, ret = JFFS2_COMPR_NONE;\n\tuint32_t orig_slen, orig_dlen;\n\tchar *output_buf;\n\n\toutput_buf = kmalloc(*cdatalen, GFP_KERNEL);\n\tif (!output_buf) {\n\t\tpr_warn(\"No memory for compressor allocation. Compression failed.\\n\");\n\t\treturn ret;\n\t}\n\torig_slen = *datalen;\n\torig_dlen = *cdatalen;\n\tspin_lock(&jffs2_compressor_list_lock);\n\tlist_for_each_entry(this, &jffs2_compressor_list, list) {\n\t\t/* Skip decompress-only and disabled modules */\n\t\tif (!this->compress || this->disabled)\n\t\t\tcontinue;\n\n\t\t/* Skip if not the desired compression type */\n\t\tif (compr && (compr != this->compr))\n\t\t\tcontinue;\n\n\t\t/*\n\t\t * Either compression type was unspecified, or we found our\n\t\t * compressor; either way, we're good to go.\n\t\t */\n\t\tthis->usecount++;\n\t\tspin_unlock(&jffs2_compressor_list_lock);\n\n\t\t*datalen  = orig_slen;\n\t\t*cdatalen = orig_dlen;\n\t\terr = this->compress(data_in, output_buf, datalen, cdatalen);\n\n\t\tspin_lock(&jffs2_compressor_list_lock);\n\t\tthis->usecount--;\n\t\tif (!err) {\n\t\t\t/* Success */\n\t\t\tret = this->compr;\n\t\t\tthis->stat_compr_blocks++;\n\t\t\tthis->stat_compr_orig_size += *datalen;\n\t\t\tthis->stat_compr_new_size += *cdatalen;\n\t\t\tbreak;\n\t\t}\n\t}\n\tspin_unlock(&jffs2_compressor_list_lock);\n\tif (ret == JFFS2_COMPR_NONE)\n\t\tkfree(output_buf);\n\telse\n\t\t*cpage_out = output_buf;\n\n\treturn ret;\n}\n\n/",
    "includes": [
      "clude \"compr.h\"\n\nst"
    ],
    "macros_used": [],
    "globals_used": [
      "tic DEFINE_SPINLOCK(jffs2_compressor_list_lock);\n\n/",
      "tic LIST_HEAD(jffs2_compressor_list);\n\n/"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "ee(ou",
          "args": [
            "put_buf);"
          ],
          "line": 123
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "n_unlock(&j",
          "args": [
            "fs2_compressor_list_lock);"
          ],
          "line": 121
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "n_lock(&j",
          "args": [
            "fs2_compressor_list_lock);"
          ],
          "line": 110
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "s->compress",
          "args": [
            "a_in, o",
            "put_buf, d",
            "alen, c",
            "talen);"
          ],
          "line": 108
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "n_unlock(&j",
          "args": [
            "fs2_compressor_list_lock);"
          ],
          "line": 104
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "t_for_each_entry(th",
          "args": [
            "s, &",
            "fs2_compressor_list, l",
            "t) {"
          ],
          "line": 90
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "n_lock(&j",
          "args": [
            "fs2_compressor_list_lock);"
          ],
          "line": 89
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "warn(\"N",
          "args": [
            "memory for compressor allocation. Compression failed.\\n\");"
          ],
          "line": 84
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lloc(*c",
          "args": [
            "atalen, G",
            "_KERNEL);"
          ],
          "line": 82
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "clude \"compr.h\"\n\nst\n\ntic DEFINE_SPINLOCK(jffs2_compressor_list_lock);\n\n/;\ntic LIST_HEAD(jffs2_compressor_list);\n\n/;\n\ntic int jffs2_selected_compress(u8 compr, unsigned char *data_in,\n\t\tunsigned char **cpage_out, u32 *datalen, u32 *cdatalen)\n{\n\tstruct jffs2_compressor *this;\n\tint err, ret = JFFS2_COMPR_NONE;\n\tuint32_t orig_slen, orig_dlen;\n\tchar *output_buf;\n\n\toutput_buf = kmalloc(*cdatalen, GFP_KERNEL);\n\tif (!output_buf) {\n\t\tpr_warn(\"No memory for compressor allocation. Compression failed.\\n\");\n\t\treturn ret;\n\t}\n\torig_slen = *datalen;\n\torig_dlen = *cdatalen;\n\tspin_lock(&jffs2_compressor_list_lock);\n\tlist_for_each_entry(this, &jffs2_compressor_list, list) {\n\t\t/* Skip decompress-only and disabled modules */\n\t\tif (!this->compress || this->disabled)\n\t\t\tcontinue;\n\n\t\t/* Skip if not the desired compression type */\n\t\tif (compr && (compr != this->compr))\n\t\t\tcontinue;\n\n\t\t/*\n\t\t * Either compression type was unspecified, or we found our\n\t\t * compressor; either way, we're good to go.\n\t\t */\n\t\tthis->usecount++;\n\t\tspin_unlock(&jffs2_compressor_list_lock);\n\n\t\t*datalen  = orig_slen;\n\t\t*cdatalen = orig_dlen;\n\t\terr = this->compress(data_in, output_buf, datalen, cdatalen);\n\n\t\tspin_lock(&jffs2_compressor_list_lock);\n\t\tthis->usecount--;\n\t\tif (!err) {\n\t\t\t/* Success */\n\t\t\tret = this->compr;\n\t\t\tthis->stat_compr_blocks++;\n\t\t\tthis->stat_compr_orig_size += *datalen;\n\t\t\tthis->stat_compr_new_size += *cdatalen;\n\t\t\tbreak;\n\t\t}\n\t}\n\tspin_unlock(&jffs2_compressor_list_lock);\n\tif (ret == JFFS2_COMPR_NONE)\n\t\tkfree(output_buf);\n\telse\n\t\t*cpage_out = output_buf;\n\n\treturn ret;\n}\n\n/"
  },
  {
    "function_name": "s2_is_best_compression(st",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/jffs2/compr.c",
    "lines": "34-56",
    "snippet": "tic int jffs2_is_best_compression(struct jffs2_compressor *this,\n\t\tstruct jffs2_compressor *best, uint32_t size, uint32_t bestsize)\n{\n\tswitch (jffs2_compression_mode) {\n\tcase JFFS2_COMPR_MODE_SIZE:\n\t\tif (bestsize > size)\n\t\t\treturn 1;\n\t\treturn 0;\n\tcase JFFS2_COMPR_MODE_FAVOURLZO:\n\t\tif ((this->compr == JFFS2_COMPR_LZO) && (bestsize > size))\n\t\t\treturn 1;\n\t\tif ((best->compr != JFFS2_COMPR_LZO) && (bestsize > size))\n\t\t\treturn 1;\n\t\tif ((this->compr == JFFS2_COMPR_LZO) && (bestsize > (size * FAVOUR_LZO_PERCENT / 100)))\n\t\t\treturn 1;\n\t\tif ((bestsize * FAVOUR_LZO_PERCENT / 100) > size)\n\t\t\treturn 1;\n\n\t\treturn 0;\n\t}\n\t/* Shouldn't happen */\n\treturn 0;\n}\n\n/",
    "includes": [
      "clude \"compr.h\"\n\nst"
    ],
    "macros_used": [],
    "globals_used": [
      "tic int jffs2_compression_mode = JFFS2_COMPR_MODE_PRIORITY;\n\n/"
    ],
    "called_functions": [],
    "contextual_snippet": "clude \"compr.h\"\n\nst\n\ntic int jffs2_compression_mode = JFFS2_COMPR_MODE_PRIORITY;\n\n/;\n\ntic int jffs2_is_best_compression(struct jffs2_compressor *this,\n\t\tstruct jffs2_compressor *best, uint32_t size, uint32_t bestsize)\n{\n\tswitch (jffs2_compression_mode) {\n\tcase JFFS2_COMPR_MODE_SIZE:\n\t\tif (bestsize > size)\n\t\t\treturn 1;\n\t\treturn 0;\n\tcase JFFS2_COMPR_MODE_FAVOURLZO:\n\t\tif ((this->compr == JFFS2_COMPR_LZO) && (bestsize > size))\n\t\t\treturn 1;\n\t\tif ((best->compr != JFFS2_COMPR_LZO) && (bestsize > size))\n\t\t\treturn 1;\n\t\tif ((this->compr == JFFS2_COMPR_LZO) && (bestsize > (size * FAVOUR_LZO_PERCENT / 100)))\n\t\t\treturn 1;\n\t\tif ((bestsize * FAVOUR_LZO_PERCENT / 100) > size)\n\t\t\treturn 1;\n\n\t\treturn 0;\n\t}\n\t/* Shouldn't happen */\n\treturn 0;\n}\n\n/"
  }
]