[
  {
    "function_name": "exit_nls_koi8_ru",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nls/nls_koi8-ru.c",
    "lines": "73-77",
    "snippet": "static void __exit exit_nls_koi8_ru(void)\n{\n\tunregister_nls(&table);\n\tunload_nls(p_nls);\n}",
    "includes": [
      "#include <linux/errno.h>",
      "#include <linux/nls.h>",
      "#include <linux/string.h>",
      "#include <linux/kernel.h>",
      "#include <linux/module.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static struct nls_table *p_nls;",
      "static struct nls_table table = {\n\t.charset\t= \"koi8-ru\",\n\t.uni2char\t= uni2char,\n\t.char2uni\t= char2uni,\n};"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "unload_nls",
          "args": [
            "p_nls"
          ],
          "line": 76
        },
        "resolved": true,
        "details": {
          "function_name": "unload_nls",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nls/nls_base.c",
          "lines": "296-300",
          "snippet": "void unload_nls(struct nls_table *nls)\n{\n\tif (nls)\n\t\tmodule_put(nls->owner);\n}",
          "includes": [
            "#include <asm/byteorder.h>",
            "#include <linux/spinlock.h>",
            "#include <linux/kmod.h>",
            "#include <linux/errno.h>",
            "#include <linux/kernel.h>",
            "#include <linux/nls.h>",
            "#include <linux/string.h>",
            "#include <linux/module.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <asm/byteorder.h>\n#include <linux/spinlock.h>\n#include <linux/kmod.h>\n#include <linux/errno.h>\n#include <linux/kernel.h>\n#include <linux/nls.h>\n#include <linux/string.h>\n#include <linux/module.h>\n\nvoid unload_nls(struct nls_table *nls)\n{\n\tif (nls)\n\t\tmodule_put(nls->owner);\n}"
        }
      },
      {
        "call_info": {
          "callee": "unregister_nls",
          "args": [
            "&table"
          ],
          "line": 75
        },
        "resolved": true,
        "details": {
          "function_name": "unregister_nls",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nls/nls_base.c",
          "lines": "258-273",
          "snippet": "int unregister_nls(struct nls_table * nls)\n{\n\tstruct nls_table ** tmp = &tables;\n\n\tspin_lock(&nls_lock);\n\twhile (*tmp) {\n\t\tif (nls == *tmp) {\n\t\t\t*tmp = nls->next;\n\t\t\tspin_unlock(&nls_lock);\n\t\t\treturn 0;\n\t\t}\n\t\ttmp = &(*tmp)->next;\n\t}\n\tspin_unlock(&nls_lock);\n\treturn -EINVAL;\n}",
          "includes": [
            "#include <asm/byteorder.h>",
            "#include <linux/spinlock.h>",
            "#include <linux/kmod.h>",
            "#include <linux/errno.h>",
            "#include <linux/kernel.h>",
            "#include <linux/nls.h>",
            "#include <linux/string.h>",
            "#include <linux/module.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static struct nls_table *tables = &default_table;",
            "static DEFINE_SPINLOCK(nls_lock);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <asm/byteorder.h>\n#include <linux/spinlock.h>\n#include <linux/kmod.h>\n#include <linux/errno.h>\n#include <linux/kernel.h>\n#include <linux/nls.h>\n#include <linux/string.h>\n#include <linux/module.h>\n\nstatic struct nls_table *tables = &default_table;\nstatic DEFINE_SPINLOCK(nls_lock);\n\nint unregister_nls(struct nls_table * nls)\n{\n\tstruct nls_table ** tmp = &tables;\n\n\tspin_lock(&nls_lock);\n\twhile (*tmp) {\n\t\tif (nls == *tmp) {\n\t\t\t*tmp = nls->next;\n\t\t\tspin_unlock(&nls_lock);\n\t\t\treturn 0;\n\t\t}\n\t\ttmp = &(*tmp)->next;\n\t}\n\tspin_unlock(&nls_lock);\n\treturn -EINVAL;\n}"
        }
      }
    ],
    "contextual_snippet": "#include <linux/errno.h>\n#include <linux/nls.h>\n#include <linux/string.h>\n#include <linux/kernel.h>\n#include <linux/module.h>\n\nstatic struct nls_table *p_nls;\nstatic struct nls_table table = {\n\t.charset\t= \"koi8-ru\",\n\t.uni2char\t= uni2char,\n\t.char2uni\t= char2uni,\n};\n\nstatic void __exit exit_nls_koi8_ru(void)\n{\n\tunregister_nls(&table);\n\tunload_nls(p_nls);\n}"
  },
  {
    "function_name": "init_nls_koi8_ru",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nls/nls_koi8-ru.c",
    "lines": "60-71",
    "snippet": "static int __init init_nls_koi8_ru(void)\n{\n\tp_nls = load_nls(\"koi8-u\");\n\n\tif (p_nls) {\n\t\ttable.charset2upper = p_nls->charset2upper;\n\t\ttable.charset2lower = p_nls->charset2lower;\n\t\treturn register_nls(&table);\n\t}\n\n\treturn -EINVAL;\n}",
    "includes": [
      "#include <linux/errno.h>",
      "#include <linux/nls.h>",
      "#include <linux/string.h>",
      "#include <linux/kernel.h>",
      "#include <linux/module.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static struct nls_table *p_nls;",
      "static struct nls_table table = {\n\t.charset\t= \"koi8-ru\",\n\t.uni2char\t= uni2char,\n\t.char2uni\t= char2uni,\n};"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "register_nls",
          "args": [
            "&table"
          ],
          "line": 67
        },
        "resolved": true,
        "details": {
          "function_name": "unregister_nls",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nls/nls_base.c",
          "lines": "258-273",
          "snippet": "int unregister_nls(struct nls_table * nls)\n{\n\tstruct nls_table ** tmp = &tables;\n\n\tspin_lock(&nls_lock);\n\twhile (*tmp) {\n\t\tif (nls == *tmp) {\n\t\t\t*tmp = nls->next;\n\t\t\tspin_unlock(&nls_lock);\n\t\t\treturn 0;\n\t\t}\n\t\ttmp = &(*tmp)->next;\n\t}\n\tspin_unlock(&nls_lock);\n\treturn -EINVAL;\n}",
          "includes": [
            "#include <asm/byteorder.h>",
            "#include <linux/spinlock.h>",
            "#include <linux/kmod.h>",
            "#include <linux/errno.h>",
            "#include <linux/kernel.h>",
            "#include <linux/nls.h>",
            "#include <linux/string.h>",
            "#include <linux/module.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static struct nls_table *tables = &default_table;",
            "static DEFINE_SPINLOCK(nls_lock);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <asm/byteorder.h>\n#include <linux/spinlock.h>\n#include <linux/kmod.h>\n#include <linux/errno.h>\n#include <linux/kernel.h>\n#include <linux/nls.h>\n#include <linux/string.h>\n#include <linux/module.h>\n\nstatic struct nls_table *tables = &default_table;\nstatic DEFINE_SPINLOCK(nls_lock);\n\nint unregister_nls(struct nls_table * nls)\n{\n\tstruct nls_table ** tmp = &tables;\n\n\tspin_lock(&nls_lock);\n\twhile (*tmp) {\n\t\tif (nls == *tmp) {\n\t\t\t*tmp = nls->next;\n\t\t\tspin_unlock(&nls_lock);\n\t\t\treturn 0;\n\t\t}\n\t\ttmp = &(*tmp)->next;\n\t}\n\tspin_unlock(&nls_lock);\n\treturn -EINVAL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "load_nls",
          "args": [
            "\"koi8-u\""
          ],
          "line": 62
        },
        "resolved": true,
        "details": {
          "function_name": "unload_nls",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nls/nls_base.c",
          "lines": "296-300",
          "snippet": "void unload_nls(struct nls_table *nls)\n{\n\tif (nls)\n\t\tmodule_put(nls->owner);\n}",
          "includes": [
            "#include <asm/byteorder.h>",
            "#include <linux/spinlock.h>",
            "#include <linux/kmod.h>",
            "#include <linux/errno.h>",
            "#include <linux/kernel.h>",
            "#include <linux/nls.h>",
            "#include <linux/string.h>",
            "#include <linux/module.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <asm/byteorder.h>\n#include <linux/spinlock.h>\n#include <linux/kmod.h>\n#include <linux/errno.h>\n#include <linux/kernel.h>\n#include <linux/nls.h>\n#include <linux/string.h>\n#include <linux/module.h>\n\nvoid unload_nls(struct nls_table *nls)\n{\n\tif (nls)\n\t\tmodule_put(nls->owner);\n}"
        }
      }
    ],
    "contextual_snippet": "#include <linux/errno.h>\n#include <linux/nls.h>\n#include <linux/string.h>\n#include <linux/kernel.h>\n#include <linux/module.h>\n\nstatic struct nls_table *p_nls;\nstatic struct nls_table table = {\n\t.charset\t= \"koi8-ru\",\n\t.uni2char\t= uni2char,\n\t.char2uni\t= char2uni,\n};\n\nstatic int __init init_nls_koi8_ru(void)\n{\n\tp_nls = load_nls(\"koi8-u\");\n\n\tif (p_nls) {\n\t\ttable.charset2upper = p_nls->charset2upper;\n\t\ttable.charset2lower = p_nls->charset2lower;\n\t\treturn register_nls(&table);\n\t}\n\n\treturn -EINVAL;\n}"
  },
  {
    "function_name": "char2uni",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nls/nls_koi8-ru.c",
    "lines": "39-52",
    "snippet": "static int char2uni(const unsigned char *rawstring, int boundlen,\n\t\t    wchar_t *uni)\n{\n\tint n;\n\n\tif ((*rawstring & 0xef) != 0xae) {\n\t\t/* koi8-ru and koi8-u differ only on two characters */\n\t\t*uni = (*rawstring & 0x10) ? 0x040e : 0x045e;\n\t\treturn 1;\n\t}\n\n\tn = p_nls->char2uni(rawstring, boundlen, uni);\n\treturn n;\n}",
    "includes": [
      "#include <linux/errno.h>",
      "#include <linux/nls.h>",
      "#include <linux/string.h>",
      "#include <linux/kernel.h>",
      "#include <linux/module.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static struct nls_table *p_nls;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "p_nls->char2uni",
          "args": [
            "rawstring",
            "boundlen",
            "uni"
          ],
          "line": 50
        },
        "resolved": true,
        "details": {
          "function_name": "char2uni",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nls/nls_koi8-ru.c",
          "lines": "39-52",
          "snippet": "static int char2uni(const unsigned char *rawstring, int boundlen,\n\t\t    wchar_t *uni)\n{\n\tint n;\n\n\tif ((*rawstring & 0xef) != 0xae) {\n\t\t/* koi8-ru and koi8-u differ only on two characters */\n\t\t*uni = (*rawstring & 0x10) ? 0x040e : 0x045e;\n\t\treturn 1;\n\t}\n\n\tn = p_nls->char2uni(rawstring, boundlen, uni);\n\treturn n;\n}",
          "note": "cyclic_reference_detected"
        }
      }
    ],
    "contextual_snippet": "#include <linux/errno.h>\n#include <linux/nls.h>\n#include <linux/string.h>\n#include <linux/kernel.h>\n#include <linux/module.h>\n\nstatic struct nls_table *p_nls;\n\nstatic int char2uni(const unsigned char *rawstring, int boundlen,\n\t\t    wchar_t *uni)\n{\n\tint n;\n\n\tif ((*rawstring & 0xef) != 0xae) {\n\t\t/* koi8-ru and koi8-u differ only on two characters */\n\t\t*uni = (*rawstring & 0x10) ? 0x040e : 0x045e;\n\t\treturn 1;\n\t}\n\n\tn = p_nls->char2uni(rawstring, boundlen, uni);\n\treturn n;\n}"
  },
  {
    "function_name": "uni2char",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nls/nls_koi8-ru.c",
    "lines": "16-37",
    "snippet": "static int uni2char(const wchar_t uni,\n\t\t    unsigned char *out, int boundlen)\n{\n\tif (boundlen <= 0)\n\t\treturn -ENAMETOOLONG;\n\n\tif ((uni & 0xffaf) == 0x040e || (uni & 0xffce) == 0x254c) {\n\t\t/* koi8-ru and koi8-u differ only on two characters */\n\t\tif (uni == 0x040e)\n\t\t\tout[0] = 0xbe;\n\t\telse if (uni == 0x045e)\n\t\t\tout[0] = 0xae;\n\t\telse if (uni == 0x255d || uni == 0x256c)\n\t\t\treturn 0;\n\t\telse\n\t\t\treturn p_nls->uni2char(uni, out, boundlen);\n\t\treturn 1;\n\t}\n\telse\n\t\t/* fast path */\n\t\treturn p_nls->uni2char(uni, out, boundlen);\n}",
    "includes": [
      "#include <linux/errno.h>",
      "#include <linux/nls.h>",
      "#include <linux/string.h>",
      "#include <linux/kernel.h>",
      "#include <linux/module.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static struct nls_table *p_nls;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "p_nls->uni2char",
          "args": [
            "uni",
            "out",
            "boundlen"
          ],
          "line": 36
        },
        "resolved": true,
        "details": {
          "function_name": "uni2char",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nls/nls_koi8-ru.c",
          "lines": "16-37",
          "snippet": "static int uni2char(const wchar_t uni,\n\t\t    unsigned char *out, int boundlen)\n{\n\tif (boundlen <= 0)\n\t\treturn -ENAMETOOLONG;\n\n\tif ((uni & 0xffaf) == 0x040e || (uni & 0xffce) == 0x254c) {\n\t\t/* koi8-ru and koi8-u differ only on two characters */\n\t\tif (uni == 0x040e)\n\t\t\tout[0] = 0xbe;\n\t\telse if (uni == 0x045e)\n\t\t\tout[0] = 0xae;\n\t\telse if (uni == 0x255d || uni == 0x256c)\n\t\t\treturn 0;\n\t\telse\n\t\t\treturn p_nls->uni2char(uni, out, boundlen);\n\t\treturn 1;\n\t}\n\telse\n\t\t/* fast path */\n\t\treturn p_nls->uni2char(uni, out, boundlen);\n}",
          "note": "cyclic_reference_detected"
        }
      }
    ],
    "contextual_snippet": "#include <linux/errno.h>\n#include <linux/nls.h>\n#include <linux/string.h>\n#include <linux/kernel.h>\n#include <linux/module.h>\n\nstatic struct nls_table *p_nls;\n\nstatic int uni2char(const wchar_t uni,\n\t\t    unsigned char *out, int boundlen)\n{\n\tif (boundlen <= 0)\n\t\treturn -ENAMETOOLONG;\n\n\tif ((uni & 0xffaf) == 0x040e || (uni & 0xffce) == 0x254c) {\n\t\t/* koi8-ru and koi8-u differ only on two characters */\n\t\tif (uni == 0x040e)\n\t\t\tout[0] = 0xbe;\n\t\telse if (uni == 0x045e)\n\t\t\tout[0] = 0xae;\n\t\telse if (uni == 0x255d || uni == 0x256c)\n\t\t\treturn 0;\n\t\telse\n\t\t\treturn p_nls->uni2char(uni, out, boundlen);\n\t\treturn 1;\n\t}\n\telse\n\t\t/* fast path */\n\t\treturn p_nls->uni2char(uni, out, boundlen);\n}"
  }
]