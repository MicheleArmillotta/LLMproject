[
  {
    "function_name": "xfs_trans_ail_copy_lsn",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/xfs/xfs_trans_priv.h",
    "lines": "151-159",
    "snippet": "static inline void\nxfs_trans_ail_copy_lsn(\n\tstruct xfs_ail\t*ailp,\n\txfs_lsn_t\t*dst,\n\txfs_lsn_t\t*src)\n{\n\tASSERT(sizeof(xfs_lsn_t) == 8);\n\t*dst = *src;\n}",
    "includes": [],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "ASSERT",
          "args": [
            "sizeof(xfs_lsn_t) == 8"
          ],
          "line": 157
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "static inline void\nxfs_trans_ail_copy_lsn(\n\tstruct xfs_ail\t*ailp,\n\txfs_lsn_t\t*dst,\n\txfs_lsn_t\t*src)\n{\n\tASSERT(sizeof(xfs_lsn_t) == 8);\n\t*dst = *src;\n}"
  },
  {
    "function_name": "xfs_trans_ail_copy_lsn",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/xfs/xfs_trans_priv.h",
    "lines": "139-149",
    "snippet": "static inline void\nxfs_trans_ail_copy_lsn(\n\tstruct xfs_ail\t*ailp,\n\txfs_lsn_t\t*dst,\n\txfs_lsn_t\t*src)\n{\n\tASSERT(sizeof(xfs_lsn_t) == 8);\t/* don't lock if it shrinks */\n\tspin_lock(&ailp->xa_lock);\n\t*dst = *src;\n\tspin_unlock(&ailp->xa_lock);\n}",
    "includes": [],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "spin_unlock",
          "args": [
            "&ailp->xa_lock"
          ],
          "line": 148
        },
        "resolved": true,
        "details": {
          "function_name": "__spin_unlock_mb_cache_entry",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/mbcache.c",
          "lines": "139-144",
          "snippet": "static inline void\n__spin_unlock_mb_cache_entry(struct mb_cache_entry *ce)\n{\n\tspin_unlock(bgl_lock_ptr(mb_cache_bg_lock,\n\t\tMB_CACHE_ENTRY_LOCK_INDEX(ce)));\n}",
          "includes": [
            "#include <linux/log2.h>",
            "#include <linux/blockgroup_lock.h>",
            "#include <linux/init.h>",
            "#include <linux/mbcache.h>",
            "#include <linux/list_bl.h>",
            "#include <linux/sched.h>",
            "#include <linux/slab.h>",
            "#include <linux/mm.h>",
            "#include <linux/fs.h>",
            "#include <linux/hash.h>",
            "#include <linux/module.h>",
            "#include <linux/kernel.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static struct blockgroup_lock *mb_cache_bg_lock;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <linux/log2.h>\n#include <linux/blockgroup_lock.h>\n#include <linux/init.h>\n#include <linux/mbcache.h>\n#include <linux/list_bl.h>\n#include <linux/sched.h>\n#include <linux/slab.h>\n#include <linux/mm.h>\n#include <linux/fs.h>\n#include <linux/hash.h>\n#include <linux/module.h>\n#include <linux/kernel.h>\n\nstatic struct blockgroup_lock *mb_cache_bg_lock;\n\nstatic inline void\n__spin_unlock_mb_cache_entry(struct mb_cache_entry *ce)\n{\n\tspin_unlock(bgl_lock_ptr(mb_cache_bg_lock,\n\t\tMB_CACHE_ENTRY_LOCK_INDEX(ce)));\n}"
        }
      },
      {
        "call_info": {
          "callee": "spin_lock",
          "args": [
            "&ailp->xa_lock"
          ],
          "line": 146
        },
        "resolved": true,
        "details": {
          "function_name": "__spin_lock_mb_cache_entry",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/mbcache.c",
          "lines": "132-137",
          "snippet": "static inline void\n__spin_lock_mb_cache_entry(struct mb_cache_entry *ce)\n{\n\tspin_lock(bgl_lock_ptr(mb_cache_bg_lock,\n\t\tMB_CACHE_ENTRY_LOCK_INDEX(ce)));\n}",
          "includes": [
            "#include <linux/log2.h>",
            "#include <linux/blockgroup_lock.h>",
            "#include <linux/init.h>",
            "#include <linux/mbcache.h>",
            "#include <linux/list_bl.h>",
            "#include <linux/sched.h>",
            "#include <linux/slab.h>",
            "#include <linux/mm.h>",
            "#include <linux/fs.h>",
            "#include <linux/hash.h>",
            "#include <linux/module.h>",
            "#include <linux/kernel.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static struct blockgroup_lock *mb_cache_bg_lock;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <linux/log2.h>\n#include <linux/blockgroup_lock.h>\n#include <linux/init.h>\n#include <linux/mbcache.h>\n#include <linux/list_bl.h>\n#include <linux/sched.h>\n#include <linux/slab.h>\n#include <linux/mm.h>\n#include <linux/fs.h>\n#include <linux/hash.h>\n#include <linux/module.h>\n#include <linux/kernel.h>\n\nstatic struct blockgroup_lock *mb_cache_bg_lock;\n\nstatic inline void\n__spin_lock_mb_cache_entry(struct mb_cache_entry *ce)\n{\n\tspin_lock(bgl_lock_ptr(mb_cache_bg_lock,\n\t\tMB_CACHE_ENTRY_LOCK_INDEX(ce)));\n}"
        }
      },
      {
        "call_info": {
          "callee": "ASSERT",
          "args": [
            "sizeof(xfs_lsn_t) == 8"
          ],
          "line": 145
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "static inline void\nxfs_trans_ail_copy_lsn(\n\tstruct xfs_ail\t*ailp,\n\txfs_lsn_t\t*dst,\n\txfs_lsn_t\t*src)\n{\n\tASSERT(sizeof(xfs_lsn_t) == 8);\t/* don't lock if it shrinks */\n\tspin_lock(&ailp->xa_lock);\n\t*dst = *src;\n\tspin_unlock(&ailp->xa_lock);\n}"
  },
  {
    "function_name": "xfs_trans_ail_delete",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/xfs/xfs_trans_priv.h",
    "lines": "113-120",
    "snippet": "static inline void\nxfs_trans_ail_delete(\n\tstruct xfs_ail\t*ailp,\n\txfs_log_item_t\t*lip,\n\tint\t\tshutdown_type) __releases(ailp->xa_lock)\n{\n\txfs_trans_ail_delete_bulk(ailp, &lip, 1, shutdown_type);\n}",
    "includes": [],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "xfs_trans_ail_delete_bulk",
          "args": [
            "ailp",
            "&lip",
            "1",
            "shutdown_type"
          ],
          "line": 119
        },
        "resolved": true,
        "details": {
          "function_name": "xfs_trans_ail_delete_bulk",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/xfs/xfs_trans_ail.c",
          "lines": "707-754",
          "snippet": "void\nxfs_trans_ail_delete_bulk(\n\tstruct xfs_ail\t\t*ailp,\n\tstruct xfs_log_item\t**log_items,\n\tint\t\t\tnr_items,\n\tint\t\t\tshutdown_type) __releases(ailp->xa_lock)\n{\n\txfs_log_item_t\t\t*mlip;\n\tint\t\t\tmlip_changed = 0;\n\tint\t\t\ti;\n\n\tmlip = xfs_ail_min(ailp);\n\n\tfor (i = 0; i < nr_items; i++) {\n\t\tstruct xfs_log_item *lip = log_items[i];\n\t\tif (!(lip->li_flags & XFS_LI_IN_AIL)) {\n\t\t\tstruct xfs_mount\t*mp = ailp->xa_mount;\n\n\t\t\tspin_unlock(&ailp->xa_lock);\n\t\t\tif (!XFS_FORCED_SHUTDOWN(mp)) {\n\t\t\t\txfs_alert_tag(mp, XFS_PTAG_AILDELETE,\n\t\t\"%s: attempting to delete a log item that is not in the AIL\",\n\t\t\t\t\t\t__func__);\n\t\t\t\txfs_force_shutdown(mp, shutdown_type);\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\n\t\ttrace_xfs_ail_delete(lip, mlip->li_lsn, lip->li_lsn);\n\t\txfs_ail_delete(ailp, lip);\n\t\tlip->li_flags &= ~XFS_LI_IN_AIL;\n\t\tlip->li_lsn = 0;\n\t\tif (mlip == lip)\n\t\t\tmlip_changed = 1;\n\t}\n\n\tif (mlip_changed) {\n\t\tif (!XFS_FORCED_SHUTDOWN(ailp->xa_mount))\n\t\t\txlog_assign_tail_lsn_locked(ailp->xa_mount);\n\t\tif (list_empty(&ailp->xa_ail))\n\t\t\twake_up_all(&ailp->xa_empty);\n\t\tspin_unlock(&ailp->xa_lock);\n\n\t\txfs_log_space_wake(ailp->xa_mount);\n\t} else {\n\t\tspin_unlock(&ailp->xa_lock);\n\t}\n}",
          "includes": [
            "#include \"xfs_log.h\"",
            "#include \"xfs_error.h\"",
            "#include \"xfs_trace.h\"",
            "#include \"xfs_trans_priv.h\"",
            "#include \"xfs_trans.h\"",
            "#include \"xfs_mount.h\"",
            "#include \"xfs_trans_resv.h\"",
            "#include \"xfs_log_format.h\"",
            "#include \"xfs_format.h\"",
            "#include \"xfs_fs.h\"",
            "#include \"xfs.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"xfs_log.h\"\n#include \"xfs_error.h\"\n#include \"xfs_trace.h\"\n#include \"xfs_trans_priv.h\"\n#include \"xfs_trans.h\"\n#include \"xfs_mount.h\"\n#include \"xfs_trans_resv.h\"\n#include \"xfs_log_format.h\"\n#include \"xfs_format.h\"\n#include \"xfs_fs.h\"\n#include \"xfs.h\"\n\nvoid\nxfs_trans_ail_delete_bulk(\n\tstruct xfs_ail\t\t*ailp,\n\tstruct xfs_log_item\t**log_items,\n\tint\t\t\tnr_items,\n\tint\t\t\tshutdown_type) __releases(ailp->xa_lock)\n{\n\txfs_log_item_t\t\t*mlip;\n\tint\t\t\tmlip_changed = 0;\n\tint\t\t\ti;\n\n\tmlip = xfs_ail_min(ailp);\n\n\tfor (i = 0; i < nr_items; i++) {\n\t\tstruct xfs_log_item *lip = log_items[i];\n\t\tif (!(lip->li_flags & XFS_LI_IN_AIL)) {\n\t\t\tstruct xfs_mount\t*mp = ailp->xa_mount;\n\n\t\t\tspin_unlock(&ailp->xa_lock);\n\t\t\tif (!XFS_FORCED_SHUTDOWN(mp)) {\n\t\t\t\txfs_alert_tag(mp, XFS_PTAG_AILDELETE,\n\t\t\"%s: attempting to delete a log item that is not in the AIL\",\n\t\t\t\t\t\t__func__);\n\t\t\t\txfs_force_shutdown(mp, shutdown_type);\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\n\t\ttrace_xfs_ail_delete(lip, mlip->li_lsn, lip->li_lsn);\n\t\txfs_ail_delete(ailp, lip);\n\t\tlip->li_flags &= ~XFS_LI_IN_AIL;\n\t\tlip->li_lsn = 0;\n\t\tif (mlip == lip)\n\t\t\tmlip_changed = 1;\n\t}\n\n\tif (mlip_changed) {\n\t\tif (!XFS_FORCED_SHUTDOWN(ailp->xa_mount))\n\t\t\txlog_assign_tail_lsn_locked(ailp->xa_mount);\n\t\tif (list_empty(&ailp->xa_ail))\n\t\t\twake_up_all(&ailp->xa_empty);\n\t\tspin_unlock(&ailp->xa_lock);\n\n\t\txfs_log_space_wake(ailp->xa_mount);\n\t} else {\n\t\tspin_unlock(&ailp->xa_lock);\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "__releases",
          "args": [
            "ailp->xa_lock"
          ],
          "line": 117
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "static inline void\nxfs_trans_ail_delete(\n\tstruct xfs_ail\t*ailp,\n\txfs_log_item_t\t*lip,\n\tint\t\tshutdown_type) __releases(ailp->xa_lock)\n{\n\txfs_trans_ail_delete_bulk(ailp, &lip, 1, shutdown_type);\n}"
  },
  {
    "function_name": "xfs_trans_ail_update",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/xfs/xfs_trans_priv.h",
    "lines": "100-107",
    "snippet": "static inline void\nxfs_trans_ail_update(\n\tstruct xfs_ail\t\t*ailp,\n\tstruct xfs_log_item\t*lip,\n\txfs_lsn_t\t\tlsn) __releases(ailp->xa_lock)\n{\n\txfs_trans_ail_update_bulk(ailp, NULL, &lip, 1, lsn);\n}",
    "includes": [],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "xfs_trans_ail_update_bulk",
          "args": [
            "ailp",
            "NULL",
            "&lip",
            "1",
            "lsn"
          ],
          "line": 106
        },
        "resolved": true,
        "details": {
          "function_name": "xfs_trans_ail_update_bulk",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/xfs/xfs_trans_ail.c",
          "lines": "637-684",
          "snippet": "void\nxfs_trans_ail_update_bulk(\n\tstruct xfs_ail\t\t*ailp,\n\tstruct xfs_ail_cursor\t*cur,\n\tstruct xfs_log_item\t**log_items,\n\tint\t\t\tnr_items,\n\txfs_lsn_t\t\tlsn) __releases(ailp->xa_lock)\n{\n\txfs_log_item_t\t\t*mlip;\n\tint\t\t\tmlip_changed = 0;\n\tint\t\t\ti;\n\tLIST_HEAD(tmp);\n\n\tASSERT(nr_items > 0);\t\t/* Not required, but true. */\n\tmlip = xfs_ail_min(ailp);\n\n\tfor (i = 0; i < nr_items; i++) {\n\t\tstruct xfs_log_item *lip = log_items[i];\n\t\tif (lip->li_flags & XFS_LI_IN_AIL) {\n\t\t\t/* check if we really need to move the item */\n\t\t\tif (XFS_LSN_CMP(lsn, lip->li_lsn) <= 0)\n\t\t\t\tcontinue;\n\n\t\t\ttrace_xfs_ail_move(lip, lip->li_lsn, lsn);\n\t\t\txfs_ail_delete(ailp, lip);\n\t\t\tif (mlip == lip)\n\t\t\t\tmlip_changed = 1;\n\t\t} else {\n\t\t\tlip->li_flags |= XFS_LI_IN_AIL;\n\t\t\ttrace_xfs_ail_insert(lip, 0, lsn);\n\t\t}\n\t\tlip->li_lsn = lsn;\n\t\tlist_add(&lip->li_ail, &tmp);\n\t}\n\n\tif (!list_empty(&tmp))\n\t\txfs_ail_splice(ailp, cur, &tmp, lsn);\n\n\tif (mlip_changed) {\n\t\tif (!XFS_FORCED_SHUTDOWN(ailp->xa_mount))\n\t\t\txlog_assign_tail_lsn_locked(ailp->xa_mount);\n\t\tspin_unlock(&ailp->xa_lock);\n\n\t\txfs_log_space_wake(ailp->xa_mount);\n\t} else {\n\t\tspin_unlock(&ailp->xa_lock);\n\t}\n}",
          "includes": [
            "#include \"xfs_log.h\"",
            "#include \"xfs_error.h\"",
            "#include \"xfs_trace.h\"",
            "#include \"xfs_trans_priv.h\"",
            "#include \"xfs_trans.h\"",
            "#include \"xfs_mount.h\"",
            "#include \"xfs_trans_resv.h\"",
            "#include \"xfs_log_format.h\"",
            "#include \"xfs_format.h\"",
            "#include \"xfs_fs.h\"",
            "#include \"xfs.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"xfs_log.h\"\n#include \"xfs_error.h\"\n#include \"xfs_trace.h\"\n#include \"xfs_trans_priv.h\"\n#include \"xfs_trans.h\"\n#include \"xfs_mount.h\"\n#include \"xfs_trans_resv.h\"\n#include \"xfs_log_format.h\"\n#include \"xfs_format.h\"\n#include \"xfs_fs.h\"\n#include \"xfs.h\"\n\nvoid\nxfs_trans_ail_update_bulk(\n\tstruct xfs_ail\t\t*ailp,\n\tstruct xfs_ail_cursor\t*cur,\n\tstruct xfs_log_item\t**log_items,\n\tint\t\t\tnr_items,\n\txfs_lsn_t\t\tlsn) __releases(ailp->xa_lock)\n{\n\txfs_log_item_t\t\t*mlip;\n\tint\t\t\tmlip_changed = 0;\n\tint\t\t\ti;\n\tLIST_HEAD(tmp);\n\n\tASSERT(nr_items > 0);\t\t/* Not required, but true. */\n\tmlip = xfs_ail_min(ailp);\n\n\tfor (i = 0; i < nr_items; i++) {\n\t\tstruct xfs_log_item *lip = log_items[i];\n\t\tif (lip->li_flags & XFS_LI_IN_AIL) {\n\t\t\t/* check if we really need to move the item */\n\t\t\tif (XFS_LSN_CMP(lsn, lip->li_lsn) <= 0)\n\t\t\t\tcontinue;\n\n\t\t\ttrace_xfs_ail_move(lip, lip->li_lsn, lsn);\n\t\t\txfs_ail_delete(ailp, lip);\n\t\t\tif (mlip == lip)\n\t\t\t\tmlip_changed = 1;\n\t\t} else {\n\t\t\tlip->li_flags |= XFS_LI_IN_AIL;\n\t\t\ttrace_xfs_ail_insert(lip, 0, lsn);\n\t\t}\n\t\tlip->li_lsn = lsn;\n\t\tlist_add(&lip->li_ail, &tmp);\n\t}\n\n\tif (!list_empty(&tmp))\n\t\txfs_ail_splice(ailp, cur, &tmp, lsn);\n\n\tif (mlip_changed) {\n\t\tif (!XFS_FORCED_SHUTDOWN(ailp->xa_mount))\n\t\t\txlog_assign_tail_lsn_locked(ailp->xa_mount);\n\t\tspin_unlock(&ailp->xa_lock);\n\n\t\txfs_log_space_wake(ailp->xa_mount);\n\t} else {\n\t\tspin_unlock(&ailp->xa_lock);\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "__releases",
          "args": [
            "ailp->xa_lock"
          ],
          "line": 104
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "static inline void\nxfs_trans_ail_update(\n\tstruct xfs_ail\t\t*ailp,\n\tstruct xfs_log_item\t*lip,\n\txfs_lsn_t\t\tlsn) __releases(ailp->xa_lock)\n{\n\txfs_trans_ail_update_bulk(ailp, NULL, &lip, 1, lsn);\n}"
  },
  {
    "function_name": "xfs_ail_min",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/xfs/xfs_trans_priv.h",
    "lines": "92-98",
    "snippet": "static inline struct xfs_log_item *\nxfs_ail_min(\n\tstruct xfs_ail  *ailp)\n{\n\treturn list_first_entry_or_null(&ailp->xa_ail, struct xfs_log_item,\n\t\t\t\t\tli_ail);\n}",
    "includes": [],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "list_first_entry_or_null",
          "args": [
            "&ailp->xa_ail",
            "structxfs_log_item",
            "li_ail"
          ],
          "line": 96
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "static inline struct xfs_log_item *\nxfs_ail_min(\n\tstruct xfs_ail  *ailp)\n{\n\treturn list_first_entry_or_null(&ailp->xa_ail, struct xfs_log_item,\n\t\t\t\t\tli_ail);\n}"
  }
]