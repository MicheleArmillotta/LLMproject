[
  {
    "function_name": "ocfs2_read_virt_block",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/ocfs2/extent_map.h",
    "lines": "72-89",
    "snippet": "static inline int ocfs2_read_virt_block(struct inode *inode, u64 v_block,\n\t\t\t\t\tstruct buffer_head **bh,\n\t\t\t\t\tint (*validate)(struct super_block *sb,\n\t\t\t\t\t\t\tstruct buffer_head *bh))\n{\n\tint status = 0;\n\n\tif (bh == NULL) {\n\t\tprintk(\"ocfs2: bh == NULL\\n\");\n\t\tstatus = -EINVAL;\n\t\tgoto bail;\n\t}\n\n\tstatus = ocfs2_read_virt_blocks(inode, v_block, 1, bh, 0, validate);\n\nbail:\n\treturn status;\n}",
    "includes": [],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "ocfs2_read_virt_blocks",
          "args": [
            "inode",
            "v_block",
            "1",
            "bh",
            "0",
            "validate"
          ],
          "line": 85
        },
        "resolved": true,
        "details": {
          "function_name": "ocfs2_read_virt_blocks",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/ocfs2/extent_map.c",
          "lines": "927-992",
          "snippet": "int ocfs2_read_virt_blocks(struct inode *inode, u64 v_block, int nr,\n\t\t\t   struct buffer_head *bhs[], int flags,\n\t\t\t   int (*validate)(struct super_block *sb,\n\t\t\t\t\t   struct buffer_head *bh))\n{\n\tint rc = 0;\n\tu64 p_block, p_count;\n\tint i, count, done = 0;\n\n\ttrace_ocfs2_read_virt_blocks(\n\t     inode, (unsigned long long)v_block, nr, bhs, flags,\n\t     validate);\n\n\tif (((v_block + nr - 1) << inode->i_sb->s_blocksize_bits) >=\n\t    i_size_read(inode)) {\n\t\tBUG_ON(!(flags & OCFS2_BH_READAHEAD));\n\t\tgoto out;\n\t}\n\n\twhile (done < nr) {\n\t\tdown_read(&OCFS2_I(inode)->ip_alloc_sem);\n\t\trc = ocfs2_extent_map_get_blocks(inode, v_block + done,\n\t\t\t\t\t\t &p_block, &p_count, NULL);\n\t\tup_read(&OCFS2_I(inode)->ip_alloc_sem);\n\t\tif (rc) {\n\t\t\tmlog_errno(rc);\n\t\t\tbreak;\n\t\t}\n\n\t\tif (!p_block) {\n\t\t\trc = -EIO;\n\t\t\tmlog(ML_ERROR,\n\t\t\t     \"Inode #%llu contains a hole at offset %llu\\n\",\n\t\t\t     (unsigned long long)OCFS2_I(inode)->ip_blkno,\n\t\t\t     (unsigned long long)(v_block + done) <<\n\t\t\t     inode->i_sb->s_blocksize_bits);\n\t\t\tbreak;\n\t\t}\n\n\t\tcount = nr - done;\n\t\tif (p_count < count)\n\t\t\tcount = p_count;\n\n\t\t/*\n\t\t * If the caller passed us bhs, they should have come\n\t\t * from a previous readahead call to this function.  Thus,\n\t\t * they should have the right b_blocknr.\n\t\t */\n\t\tfor (i = 0; i < count; i++) {\n\t\t\tif (!bhs[done + i])\n\t\t\t\tcontinue;\n\t\t\tBUG_ON(bhs[done + i]->b_blocknr != (p_block + i));\n\t\t}\n\n\t\trc = ocfs2_read_blocks(INODE_CACHE(inode), p_block, count,\n\t\t\t\t       bhs + done, flags, validate);\n\t\tif (rc) {\n\t\t\tmlog_errno(rc);\n\t\t\tbreak;\n\t\t}\n\t\tdone += count;\n\t}\n\nout:\n\treturn rc;\n}",
          "includes": [
            "#include \"buffer_head_io.h\"",
            "#include \"ocfs2_trace.h\"",
            "#include \"symlink.h\"",
            "#include \"super.h\"",
            "#include \"inode.h\"",
            "#include \"extent_map.h\"",
            "#include \"dlmglue.h\"",
            "#include \"alloc.h\"",
            "#include \"ocfs2.h\"",
            "#include <cluster/masklog.h>",
            "#include <linux/fiemap.h>",
            "#include <linux/types.h>",
            "#include <linux/slab.h>",
            "#include <linux/init.h>",
            "#include <linux/fs.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"buffer_head_io.h\"\n#include \"ocfs2_trace.h\"\n#include \"symlink.h\"\n#include \"super.h\"\n#include \"inode.h\"\n#include \"extent_map.h\"\n#include \"dlmglue.h\"\n#include \"alloc.h\"\n#include \"ocfs2.h\"\n#include <cluster/masklog.h>\n#include <linux/fiemap.h>\n#include <linux/types.h>\n#include <linux/slab.h>\n#include <linux/init.h>\n#include <linux/fs.h>\n\nint ocfs2_read_virt_blocks(struct inode *inode, u64 v_block, int nr,\n\t\t\t   struct buffer_head *bhs[], int flags,\n\t\t\t   int (*validate)(struct super_block *sb,\n\t\t\t\t\t   struct buffer_head *bh))\n{\n\tint rc = 0;\n\tu64 p_block, p_count;\n\tint i, count, done = 0;\n\n\ttrace_ocfs2_read_virt_blocks(\n\t     inode, (unsigned long long)v_block, nr, bhs, flags,\n\t     validate);\n\n\tif (((v_block + nr - 1) << inode->i_sb->s_blocksize_bits) >=\n\t    i_size_read(inode)) {\n\t\tBUG_ON(!(flags & OCFS2_BH_READAHEAD));\n\t\tgoto out;\n\t}\n\n\twhile (done < nr) {\n\t\tdown_read(&OCFS2_I(inode)->ip_alloc_sem);\n\t\trc = ocfs2_extent_map_get_blocks(inode, v_block + done,\n\t\t\t\t\t\t &p_block, &p_count, NULL);\n\t\tup_read(&OCFS2_I(inode)->ip_alloc_sem);\n\t\tif (rc) {\n\t\t\tmlog_errno(rc);\n\t\t\tbreak;\n\t\t}\n\n\t\tif (!p_block) {\n\t\t\trc = -EIO;\n\t\t\tmlog(ML_ERROR,\n\t\t\t     \"Inode #%llu contains a hole at offset %llu\\n\",\n\t\t\t     (unsigned long long)OCFS2_I(inode)->ip_blkno,\n\t\t\t     (unsigned long long)(v_block + done) <<\n\t\t\t     inode->i_sb->s_blocksize_bits);\n\t\t\tbreak;\n\t\t}\n\n\t\tcount = nr - done;\n\t\tif (p_count < count)\n\t\t\tcount = p_count;\n\n\t\t/*\n\t\t * If the caller passed us bhs, they should have come\n\t\t * from a previous readahead call to this function.  Thus,\n\t\t * they should have the right b_blocknr.\n\t\t */\n\t\tfor (i = 0; i < count; i++) {\n\t\t\tif (!bhs[done + i])\n\t\t\t\tcontinue;\n\t\t\tBUG_ON(bhs[done + i]->b_blocknr != (p_block + i));\n\t\t}\n\n\t\trc = ocfs2_read_blocks(INODE_CACHE(inode), p_block, count,\n\t\t\t\t       bhs + done, flags, validate);\n\t\tif (rc) {\n\t\t\tmlog_errno(rc);\n\t\t\tbreak;\n\t\t}\n\t\tdone += count;\n\t}\n\nout:\n\treturn rc;\n}"
        }
      },
      {
        "call_info": {
          "callee": "printk",
          "args": [
            "\"ocfs2: bh == NULL\\n\""
          ],
          "line": 80
        },
        "resolved": true,
        "details": {
          "function_name": "compat_printk",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/compat.c",
          "lines": "59-69",
          "snippet": "int compat_printk(const char *fmt, ...)\n{\n\tva_list ap;\n\tint ret;\n\tif (!compat_log)\n\t\treturn 0;\n\tva_start(ap, fmt);\n\tret = vprintk(fmt, ap);\n\tva_end(ap);\n\treturn ret;\n}",
          "includes": [
            "#include \"internal.h\"",
            "#include <asm/ioctls.h>",
            "#include <asm/mmu_context.h>",
            "#include <asm/uaccess.h>",
            "#include <linux/aio.h>",
            "#include <linux/pagemap.h>",
            "#include <linux/slab.h>",
            "#include <linux/fs_struct.h>",
            "#include <linux/mm.h>",
            "#include <linux/poll.h>",
            "#include <linux/signal.h>",
            "#include <linux/highmem.h>",
            "#include <linux/security.h>",
            "#include <linux/tsacct_kern.h>",
            "#include <linux/rwsem.h>",
            "#include <linux/personality.h>",
            "#include <linux/highuid.h>",
            "#include <linux/fsnotify.h>",
            "#include <linux/dirent.h>",
            "#include <linux/ctype.h>",
            "#include <linux/syscalls.h>",
            "#include <linux/nfs4_mount.h>",
            "#include <linux/ncp_mount.h>",
            "#include <linux/init.h>",
            "#include <linux/ioctl.h>",
            "#include <linux/vfs.h>",
            "#include <linux/fdtable.h>",
            "#include <linux/file.h>",
            "#include <linux/namei.h>",
            "#include <linux/fcntl.h>",
            "#include <linux/fs.h>",
            "#include <linux/time.h>",
            "#include <linux/errno.h>",
            "#include <linux/compat.h>",
            "#include <linux/linkage.h>",
            "#include <linux/kernel.h>",
            "#include <linux/stddef.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "int compat_log = 1;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"internal.h\"\n#include <asm/ioctls.h>\n#include <asm/mmu_context.h>\n#include <asm/uaccess.h>\n#include <linux/aio.h>\n#include <linux/pagemap.h>\n#include <linux/slab.h>\n#include <linux/fs_struct.h>\n#include <linux/mm.h>\n#include <linux/poll.h>\n#include <linux/signal.h>\n#include <linux/highmem.h>\n#include <linux/security.h>\n#include <linux/tsacct_kern.h>\n#include <linux/rwsem.h>\n#include <linux/personality.h>\n#include <linux/highuid.h>\n#include <linux/fsnotify.h>\n#include <linux/dirent.h>\n#include <linux/ctype.h>\n#include <linux/syscalls.h>\n#include <linux/nfs4_mount.h>\n#include <linux/ncp_mount.h>\n#include <linux/init.h>\n#include <linux/ioctl.h>\n#include <linux/vfs.h>\n#include <linux/fdtable.h>\n#include <linux/file.h>\n#include <linux/namei.h>\n#include <linux/fcntl.h>\n#include <linux/fs.h>\n#include <linux/time.h>\n#include <linux/errno.h>\n#include <linux/compat.h>\n#include <linux/linkage.h>\n#include <linux/kernel.h>\n#include <linux/stddef.h>\n\nint compat_log = 1;\n\nint compat_printk(const char *fmt, ...)\n{\n\tva_list ap;\n\tint ret;\n\tif (!compat_log)\n\t\treturn 0;\n\tva_start(ap, fmt);\n\tret = vprintk(fmt, ap);\n\tva_end(ap);\n\treturn ret;\n}"
        }
      }
    ],
    "contextual_snippet": "static inline int ocfs2_read_virt_block(struct inode *inode, u64 v_block,\n\t\t\t\t\tstruct buffer_head **bh,\n\t\t\t\t\tint (*validate)(struct super_block *sb,\n\t\t\t\t\t\t\tstruct buffer_head *bh))\n{\n\tint status = 0;\n\n\tif (bh == NULL) {\n\t\tprintk(\"ocfs2: bh == NULL\\n\");\n\t\tstatus = -EINVAL;\n\t\tgoto bail;\n\t}\n\n\tstatus = ocfs2_read_virt_blocks(inode, v_block, 1, bh, 0, validate);\n\nbail:\n\treturn status;\n}"
  }
]