[
  {
    "function_name": "ffs2_read_inode_range(",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/jffs2/read.c",
    "lines": "157-227",
    "snippet": "nt jffs2_read_inode_range(struct jffs2_sb_info *c, struct jffs2_inode_info *f,\n\t\t\t   unsigned char *buf, uint32_t offset, uint32_t len)\n{\n\tuint32_t end = offset + len;\n\tstruct jffs2_node_frag *frag;\n\tint ret;\n\n\tjffs2_dbg(1, \"%s(): ino #%u, range 0x%08x-0x%08x\\n\",\n\t\t  __func__, f->inocache->ino, offset, offset + len);\n\n\tfrag = jffs2_lookup_node_frag(&f->fragtree, offset);\n\n\t/* XXX FIXME: Where a single physical node actually shows up in two\n\t   frags, we read it twice. Don't do that. */\n\t/* Now we're pointing at the first frag which overlaps our page\n\t * (or perhaps is before it, if we've been asked to read off the\n\t * end of the file). */\n\twhile(offset < end) {\n\t\tjffs2_dbg(2, \"%s(): offset %d, end %d\\n\",\n\t\t\t  __func__, offset, end);\n\t\tif (unlikely(!frag || frag->ofs > offset ||\n\t\t\t     frag->ofs + frag->size <= offset)) {\n\t\t\tuint32_t holesize = end - offset;\n\t\t\tif (frag && frag->ofs > offset) {\n\t\t\t\tjffs2_dbg(1, \"Eep. Hole in ino #%u fraglist. frag->ofs = 0x%08x, offset = 0x%08x\\n\",\n\t\t\t\t\t  f->inocache->ino, frag->ofs, offset);\n\t\t\t\tholesize = min(holesize, frag->ofs - offset);\n\t\t\t}\n\t\t\tjffs2_dbg(1, \"Filling non-frag hole from %d-%d\\n\",\n\t\t\t\t  offset, offset + holesize);\n\t\t\tmemset(buf, 0, holesize);\n\t\t\tbuf += holesize;\n\t\t\toffset += holesize;\n\t\t\tcontinue;\n\t\t} else if (unlikely(!frag->node)) {\n\t\t\tuint32_t holeend = min(end, frag->ofs + frag->size);\n\t\t\tjffs2_dbg(1, \"Filling frag hole from %d-%d (frag 0x%x 0x%x)\\n\",\n\t\t\t\t  offset, holeend, frag->ofs,\n\t\t\t\t  frag->ofs + frag->size);\n\t\t\tmemset(buf, 0, holeend - offset);\n\t\t\tbuf += holeend - offset;\n\t\t\toffset = holeend;\n\t\t\tfrag = frag_next(frag);\n\t\t\tcontinue;\n\t\t} else {\n\t\t\tuint32_t readlen;\n\t\t\tuint32_t fragofs; /* offset within the frag to start reading */\n\n\t\t\tfragofs = offset - frag->ofs;\n\t\t\treadlen = min(frag->size - fragofs, end - offset);\n\t\t\tjffs2_dbg(1, \"Reading %d-%d from node at 0x%08x (%d)\\n\",\n\t\t\t\t  frag->ofs+fragofs,\n\t\t\t\t  frag->ofs + fragofs+readlen,\n\t\t\t\t  ref_offset(frag->node->raw),\n\t\t\t\t  ref_flags(frag->node->raw));\n\t\t\tret = jffs2_read_dnode(c, f, frag->node, buf, fragofs + frag->ofs - frag->node->ofs, readlen);\n\t\t\tjffs2_dbg(2, \"node read done\\n\");\n\t\t\tif (ret) {\n\t\t\t\tjffs2_dbg(1, \"%s(): error %d\\n\",\n\t\t\t\t\t  __func__, ret);\n\t\t\t\tmemset(buf, 0, readlen);\n\t\t\t\treturn ret;\n\t\t\t}\n\t\t\tbuf += readlen;\n\t\t\toffset += readlen;\n\t\t\tfrag = frag_next(frag);\n\t\t\tjffs2_dbg(2, \"node read was OK. Looping\\n\");\n\t\t}\n\t}\n\treturn 0;\n}",
    "includes": [
      "include \"compr.h\"",
      "include \"nodelist.h\"\n#",
      "include <linux/compiler.h>\n#",
      "include <linux/mtd/mtd.h>\n#",
      "include <linux/pagemap.h>\n#",
      "include <linux/crc32.h>\n#",
      "include <linux/slab.h>\n#",
      "include <linux/kernel.h>\n#"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "ffs2_dbg(",
          "args": [
            ",",
            "node read was OK. Looping\\n\")"
          ],
          "line": 223
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rag_next(",
          "args": [
            "rag)"
          ],
          "line": 222
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "emset(",
          "args": [
            "uf,",
            ",",
            "eadlen)"
          ],
          "line": 217
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ffs2_dbg(",
          "args": [
            ",",
            "%s(): error %d\\n\",",
            "_func__,",
            "et)"
          ],
          "line": 215
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ffs2_dbg(",
          "args": [
            ",",
            "node read done\\n\")"
          ],
          "line": 213
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ffs2_read_dnode(",
          "args": [
            ",",
            ",",
            "rag->node,",
            "uf,",
            "ragofs + frag->ofs - frag->node->ofs,",
            "eadlen)"
          ],
          "line": 212
        },
        "resolved": true,
        "details": {
          "function_name": "ffs2_read_dnode(",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/jffs2/read.c",
          "lines": "23-155",
          "snippet": "nt jffs2_read_dnode(struct jffs2_sb_info *c, struct jffs2_inode_info *f,\n\t\t     struct jffs2_full_dnode *fd, unsigned char *buf,\n\t\t     int ofs, int len)\n{\n\tstruct jffs2_raw_inode *ri;\n\tsize_t readlen;\n\tuint32_t crc;\n\tunsigned char *decomprbuf = NULL;\n\tunsigned char *readbuf = NULL;\n\tint ret = 0;\n\n\tri = jffs2_alloc_raw_inode();\n\tif (!ri)\n\t\treturn -ENOMEM;\n\n\tret = jffs2_flash_read(c, ref_offset(fd->raw), sizeof(*ri), &readlen, (char *)ri);\n\tif (ret) {\n\t\tjffs2_free_raw_inode(ri);\n\t\tpr_warn(\"Error reading node from 0x%08x: %d\\n\",\n\t\t\tref_offset(fd->raw), ret);\n\t\treturn ret;\n\t}\n\tif (readlen != sizeof(*ri)) {\n\t\tjffs2_free_raw_inode(ri);\n\t\tpr_warn(\"Short read from 0x%08x: wanted 0x%zx bytes, got 0x%zx\\n\",\n\t\t\tref_offset(fd->raw), sizeof(*ri), readlen);\n\t\treturn -EIO;\n\t}\n\tcrc = crc32(0, ri, sizeof(*ri)-8);\n\n\tjffs2_dbg(1, \"Node read from %08x: node_crc %08x, calculated CRC %08x. dsize %x, csize %x, offset %x, buf %p\\n\",\n\t\t  ref_offset(fd->raw), je32_to_cpu(ri->node_crc),\n\t\t  crc, je32_to_cpu(ri->dsize), je32_to_cpu(ri->csize),\n\t\t  je32_to_cpu(ri->offset), buf);\n\tif (crc != je32_to_cpu(ri->node_crc)) {\n\t\tpr_warn(\"Node CRC %08x != calculated CRC %08x for node at %08x\\n\",\n\t\t\tje32_to_cpu(ri->node_crc), crc, ref_offset(fd->raw));\n\t\tret = -EIO;\n\t\tgoto out_ri;\n\t}\n\t/* There was a bug where we wrote hole nodes out with csize/dsize\n\t   swapped. Deal with it */\n\tif (ri->compr == JFFS2_COMPR_ZERO && !je32_to_cpu(ri->dsize) &&\n\t    je32_to_cpu(ri->csize)) {\n\t\tri->dsize = ri->csize;\n\t\tri->csize = cpu_to_je32(0);\n\t}\n\n\tD1(if(ofs + len > je32_to_cpu(ri->dsize)) {\n\t\t\tpr_warn(\"jffs2_read_dnode() asked for %d bytes at %d from %d-byte node\\n\",\n\t\t\t\tlen, ofs, je32_to_cpu(ri->dsize));\n\t\tret = -EINVAL;\n\t\tgoto out_ri;\n\t});\n\n\n\tif (ri->compr == JFFS2_COMPR_ZERO) {\n\t\tmemset(buf, 0, len);\n\t\tgoto out_ri;\n\t}\n\n\t/* Cases:\n\t   Reading whole node and it's uncompressed - read directly to buffer provided, check CRC.\n\t   Reading whole node and it's compressed - read into comprbuf, check CRC and decompress to buffer provided\n\t   Reading partial node and it's uncompressed - read into readbuf, check CRC, and copy\n\t   Reading partial node and it's compressed - read into readbuf, check checksum, decompress to decomprbuf and copy\n\t*/\n\tif (ri->compr == JFFS2_COMPR_NONE && len == je32_to_cpu(ri->dsize)) {\n\t\treadbuf = buf;\n\t} else {\n\t\treadbuf = kmalloc(je32_to_cpu(ri->csize), GFP_KERNEL);\n\t\tif (!readbuf) {\n\t\t\tret = -ENOMEM;\n\t\t\tgoto out_ri;\n\t\t}\n\t}\n\tif (ri->compr != JFFS2_COMPR_NONE) {\n\t\tif (len < je32_to_cpu(ri->dsize)) {\n\t\t\tdecomprbuf = kmalloc(je32_to_cpu(ri->dsize), GFP_KERNEL);\n\t\t\tif (!decomprbuf) {\n\t\t\t\tret = -ENOMEM;\n\t\t\t\tgoto out_readbuf;\n\t\t\t}\n\t\t} else {\n\t\t\tdecomprbuf = buf;\n\t\t}\n\t} else {\n\t\tdecomprbuf = readbuf;\n\t}\n\n\tjffs2_dbg(2, \"Read %d bytes to %p\\n\", je32_to_cpu(ri->csize),\n\t\t  readbuf);\n\tret = jffs2_flash_read(c, (ref_offset(fd->raw)) + sizeof(*ri),\n\t\t\t       je32_to_cpu(ri->csize), &readlen, readbuf);\n\n\tif (!ret && readlen != je32_to_cpu(ri->csize))\n\t\tret = -EIO;\n\tif (ret)\n\t\tgoto out_decomprbuf;\n\n\tcrc = crc32(0, readbuf, je32_to_cpu(ri->csize));\n\tif (crc != je32_to_cpu(ri->data_crc)) {\n\t\tpr_warn(\"Data CRC %08x != calculated CRC %08x for node at %08x\\n\",\n\t\t\tje32_to_cpu(ri->data_crc), crc, ref_offset(fd->raw));\n\t\tret = -EIO;\n\t\tgoto out_decomprbuf;\n\t}\n\tjffs2_dbg(2, \"Data CRC matches calculated CRC %08x\\n\", crc);\n\tif (ri->compr != JFFS2_COMPR_NONE) {\n\t\tjffs2_dbg(2, \"Decompress %d bytes from %p to %d bytes at %p\\n\",\n\t\t\t  je32_to_cpu(ri->csize), readbuf,\n\t\t\t  je32_to_cpu(ri->dsize), decomprbuf);\n\t\tret = jffs2_decompress(c, f, ri->compr | (ri->usercompr << 8), readbuf, decomprbuf, je32_to_cpu(ri->csize), je32_to_cpu(ri->dsize));\n\t\tif (ret) {\n\t\t\tpr_warn(\"Error: jffs2_decompress returned %d\\n\", ret);\n\t\t\tgoto out_decomprbuf;\n\t\t}\n\t}\n\n\tif (len < je32_to_cpu(ri->dsize)) {\n\t\tmemcpy(buf, decomprbuf+ofs, len);\n\t}\n out_decomprbuf:\n\tif(decomprbuf != buf && decomprbuf != readbuf)\n\t\tkfree(decomprbuf);\n out_readbuf:\n\tif(readbuf != buf)\n\t\tkfree(readbuf);\n out_ri:\n\tjffs2_free_raw_inode(ri);\n\n\treturn ret;\n}",
          "includes": [
            "include \"compr.h\"",
            "include \"nodelist.h\"\n#",
            "include <linux/compiler.h>\n#",
            "include <linux/mtd/mtd.h>\n#",
            "include <linux/pagemap.h>\n#",
            "include <linux/crc32.h>\n#",
            "include <linux/slab.h>\n#",
            "include <linux/kernel.h>\n#"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "include \"compr.h\"\ninclude \"nodelist.h\"\n#\ninclude <linux/compiler.h>\n#\ninclude <linux/mtd/mtd.h>\n#\ninclude <linux/pagemap.h>\n#\ninclude <linux/crc32.h>\n#\ninclude <linux/slab.h>\n#\ninclude <linux/kernel.h>\n#\n\nnt jffs2_read_dnode(struct jffs2_sb_info *c, struct jffs2_inode_info *f,\n\t\t     struct jffs2_full_dnode *fd, unsigned char *buf,\n\t\t     int ofs, int len)\n{\n\tstruct jffs2_raw_inode *ri;\n\tsize_t readlen;\n\tuint32_t crc;\n\tunsigned char *decomprbuf = NULL;\n\tunsigned char *readbuf = NULL;\n\tint ret = 0;\n\n\tri = jffs2_alloc_raw_inode();\n\tif (!ri)\n\t\treturn -ENOMEM;\n\n\tret = jffs2_flash_read(c, ref_offset(fd->raw), sizeof(*ri), &readlen, (char *)ri);\n\tif (ret) {\n\t\tjffs2_free_raw_inode(ri);\n\t\tpr_warn(\"Error reading node from 0x%08x: %d\\n\",\n\t\t\tref_offset(fd->raw), ret);\n\t\treturn ret;\n\t}\n\tif (readlen != sizeof(*ri)) {\n\t\tjffs2_free_raw_inode(ri);\n\t\tpr_warn(\"Short read from 0x%08x: wanted 0x%zx bytes, got 0x%zx\\n\",\n\t\t\tref_offset(fd->raw), sizeof(*ri), readlen);\n\t\treturn -EIO;\n\t}\n\tcrc = crc32(0, ri, sizeof(*ri)-8);\n\n\tjffs2_dbg(1, \"Node read from %08x: node_crc %08x, calculated CRC %08x. dsize %x, csize %x, offset %x, buf %p\\n\",\n\t\t  ref_offset(fd->raw), je32_to_cpu(ri->node_crc),\n\t\t  crc, je32_to_cpu(ri->dsize), je32_to_cpu(ri->csize),\n\t\t  je32_to_cpu(ri->offset), buf);\n\tif (crc != je32_to_cpu(ri->node_crc)) {\n\t\tpr_warn(\"Node CRC %08x != calculated CRC %08x for node at %08x\\n\",\n\t\t\tje32_to_cpu(ri->node_crc), crc, ref_offset(fd->raw));\n\t\tret = -EIO;\n\t\tgoto out_ri;\n\t}\n\t/* There was a bug where we wrote hole nodes out with csize/dsize\n\t   swapped. Deal with it */\n\tif (ri->compr == JFFS2_COMPR_ZERO && !je32_to_cpu(ri->dsize) &&\n\t    je32_to_cpu(ri->csize)) {\n\t\tri->dsize = ri->csize;\n\t\tri->csize = cpu_to_je32(0);\n\t}\n\n\tD1(if(ofs + len > je32_to_cpu(ri->dsize)) {\n\t\t\tpr_warn(\"jffs2_read_dnode() asked for %d bytes at %d from %d-byte node\\n\",\n\t\t\t\tlen, ofs, je32_to_cpu(ri->dsize));\n\t\tret = -EINVAL;\n\t\tgoto out_ri;\n\t});\n\n\n\tif (ri->compr == JFFS2_COMPR_ZERO) {\n\t\tmemset(buf, 0, len);\n\t\tgoto out_ri;\n\t}\n\n\t/* Cases:\n\t   Reading whole node and it's uncompressed - read directly to buffer provided, check CRC.\n\t   Reading whole node and it's compressed - read into comprbuf, check CRC and decompress to buffer provided\n\t   Reading partial node and it's uncompressed - read into readbuf, check CRC, and copy\n\t   Reading partial node and it's compressed - read into readbuf, check checksum, decompress to decomprbuf and copy\n\t*/\n\tif (ri->compr == JFFS2_COMPR_NONE && len == je32_to_cpu(ri->dsize)) {\n\t\treadbuf = buf;\n\t} else {\n\t\treadbuf = kmalloc(je32_to_cpu(ri->csize), GFP_KERNEL);\n\t\tif (!readbuf) {\n\t\t\tret = -ENOMEM;\n\t\t\tgoto out_ri;\n\t\t}\n\t}\n\tif (ri->compr != JFFS2_COMPR_NONE) {\n\t\tif (len < je32_to_cpu(ri->dsize)) {\n\t\t\tdecomprbuf = kmalloc(je32_to_cpu(ri->dsize), GFP_KERNEL);\n\t\t\tif (!decomprbuf) {\n\t\t\t\tret = -ENOMEM;\n\t\t\t\tgoto out_readbuf;\n\t\t\t}\n\t\t} else {\n\t\t\tdecomprbuf = buf;\n\t\t}\n\t} else {\n\t\tdecomprbuf = readbuf;\n\t}\n\n\tjffs2_dbg(2, \"Read %d bytes to %p\\n\", je32_to_cpu(ri->csize),\n\t\t  readbuf);\n\tret = jffs2_flash_read(c, (ref_offset(fd->raw)) + sizeof(*ri),\n\t\t\t       je32_to_cpu(ri->csize), &readlen, readbuf);\n\n\tif (!ret && readlen != je32_to_cpu(ri->csize))\n\t\tret = -EIO;\n\tif (ret)\n\t\tgoto out_decomprbuf;\n\n\tcrc = crc32(0, readbuf, je32_to_cpu(ri->csize));\n\tif (crc != je32_to_cpu(ri->data_crc)) {\n\t\tpr_warn(\"Data CRC %08x != calculated CRC %08x for node at %08x\\n\",\n\t\t\tje32_to_cpu(ri->data_crc), crc, ref_offset(fd->raw));\n\t\tret = -EIO;\n\t\tgoto out_decomprbuf;\n\t}\n\tjffs2_dbg(2, \"Data CRC matches calculated CRC %08x\\n\", crc);\n\tif (ri->compr != JFFS2_COMPR_NONE) {\n\t\tjffs2_dbg(2, \"Decompress %d bytes from %p to %d bytes at %p\\n\",\n\t\t\t  je32_to_cpu(ri->csize), readbuf,\n\t\t\t  je32_to_cpu(ri->dsize), decomprbuf);\n\t\tret = jffs2_decompress(c, f, ri->compr | (ri->usercompr << 8), readbuf, decomprbuf, je32_to_cpu(ri->csize), je32_to_cpu(ri->dsize));\n\t\tif (ret) {\n\t\t\tpr_warn(\"Error: jffs2_decompress returned %d\\n\", ret);\n\t\t\tgoto out_decomprbuf;\n\t\t}\n\t}\n\n\tif (len < je32_to_cpu(ri->dsize)) {\n\t\tmemcpy(buf, decomprbuf+ofs, len);\n\t}\n out_decomprbuf:\n\tif(decomprbuf != buf && decomprbuf != readbuf)\n\t\tkfree(decomprbuf);\n out_readbuf:\n\tif(readbuf != buf)\n\t\tkfree(readbuf);\n out_ri:\n\tjffs2_free_raw_inode(ri);\n\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "ffs2_dbg(",
          "args": [
            ",",
            "Reading %d-%d from node at 0x%08x (%d)\\n\",",
            "rag->ofs+fragofs,",
            "rag->ofs + fragofs+readlen,",
            "ef_offset(frag->node->raw),",
            "ef_flags(frag->node->raw))"
          ],
          "line": 207
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ef_flags(",
          "args": [
            "rag->node->raw)"
          ],
          "line": 211
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ef_offset(",
          "args": [
            "rag->node->raw)"
          ],
          "line": 210
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "in(",
          "args": [
            "rag->size - fragofs,",
            "nd - offset)"
          ],
          "line": 206
        },
        "resolved": true,
        "details": {
          "function_name": "rst_inode_chain(i",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/jffs2/build.c",
          "lines": "25-33",
          "snippet": "atic inline struct jffs2_inode_cache *\nfirst_inode_chain(int *i, struct jffs2_sb_info *c)\n{\n\tfor (; *i < c->inocache_hashsize; (*i)++) {\n\t\tif (c->inocache_list[*i])\n\t\t\treturn c->inocache_list[*i];\n\t}\n\treturn NULL;\n}",
          "includes": [
            "nclude \"nodelist.h\"\n\ns",
            "nclude <linux/mtd/mtd.h>\n#i",
            "nclude <linux/vmalloc.h>\n#i",
            "nclude <linux/slab.h>\n#i",
            "nclude <linux/sched.h>\n#i",
            "nclude <linux/kernel.h>\n#i"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "nclude \"nodelist.h\"\n\ns\nnclude <linux/mtd/mtd.h>\n#i\nnclude <linux/vmalloc.h>\n#i\nnclude <linux/slab.h>\n#i\nnclude <linux/sched.h>\n#i\nnclude <linux/kernel.h>\n#i\n\natic inline struct jffs2_inode_cache *\nfirst_inode_chain(int *i, struct jffs2_sb_info *c)\n{\n\tfor (; *i < c->inocache_hashsize; (*i)++) {\n\t\tif (c->inocache_list[*i])\n\t\t\treturn c->inocache_list[*i];\n\t}\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "rag_next(",
          "args": [
            "rag)"
          ],
          "line": 199
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "emset(",
          "args": [
            "uf,",
            ",",
            "oleend - offset)"
          ],
          "line": 196
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ffs2_dbg(",
          "args": [
            ",",
            "Filling frag hole from %d-%d (frag 0x%x 0x%x)\\n\",",
            "ffset,",
            "oleend,",
            "rag->ofs,",
            "rag->ofs + frag->size)"
          ],
          "line": 193
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "nlikely(",
          "args": [
            "frag->node)"
          ],
          "line": 191
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "emset(",
          "args": [
            "uf,",
            ",",
            "olesize)"
          ],
          "line": 187
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ffs2_dbg(",
          "args": [
            ",",
            "Filling non-frag hole from %d-%d\\n\",",
            "ffset,",
            "ffset + holesize)"
          ],
          "line": 185
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ffs2_dbg(",
          "args": [
            ",",
            "Eep. Hole in ino #%u fraglist. frag->ofs = 0x%08x, offset = 0x%08x\\n\",",
            "->inocache->ino,",
            "rag->ofs,",
            "ffset)"
          ],
          "line": 181
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "nlikely(",
          "args": [
            "frag || frag->ofs > offset ||\n\t\t\t     frag->ofs + frag->size <= offset)"
          ],
          "line": 177
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ffs2_dbg(",
          "args": [
            ",",
            "%s(): offset %d, end %d\\n\",",
            "_func__,",
            "ffset,",
            "nd)"
          ],
          "line": 175
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ffs2_lookup_node_frag(",
          "args": [
            "f->fragtree,",
            "ffset)"
          ],
          "line": 167
        },
        "resolved": true,
        "details": {
          "function_name": "ffs2_lookup_node_frag(",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/jffs2/nodelist.c",
          "lines": "524-561",
          "snippet": "truct jffs2_node_frag *jffs2_lookup_node_frag(struct rb_root *fragtree, uint32_t offset)\n{\n\t/* The common case in lookup is that there will be a node\n\t   which precisely matches. So we go looking for that first */\n\tstruct rb_node *next;\n\tstruct jffs2_node_frag *prev = NULL;\n\tstruct jffs2_node_frag *frag = NULL;\n\n\tdbg_fragtree2(\"root %p, offset %d\\n\", fragtree, offset);\n\n\tnext = fragtree->rb_node;\n\n\twhile(next) {\n\t\tfrag = rb_entry(next, struct jffs2_node_frag, rb);\n\n\t\tif (frag->ofs + frag->size <= offset) {\n\t\t\t/* Remember the closest smaller match on the way down */\n\t\t\tif (!prev || frag->ofs > prev->ofs)\n\t\t\t\tprev = frag;\n\t\t\tnext = frag->rb.rb_right;\n\t\t} else if (frag->ofs > offset) {\n\t\t\tnext = frag->rb.rb_left;\n\t\t} else {\n\t\t\treturn frag;\n\t\t}\n\t}\n\n\t/* Exact match not found. Go back up looking at each parent,\n\t   and return the closest smaller one */\n\n\tif (prev)\n\t\tdbg_fragtree2(\"no match. Returning frag %#04x-%#04x, closest previous\\n\",\n\t\t\t  prev->ofs, prev->ofs+prev->size);\n\telse\n\t\tdbg_fragtree2(\"returning NULL, empty fragtree\\n\");\n\n\treturn prev;\n}",
          "includes": [
            "include \"nodelist.h\"",
            "include <linux/pagemap.h>\n#",
            "include <linux/crc32.h>\n#",
            "include <linux/rbtree.h>\n#",
            "include <linux/mtd/mtd.h>\n#",
            "include <linux/fs.h>\n#",
            "include <linux/sched.h>\n#",
            "include <linux/kernel.h>\n#"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "include \"nodelist.h\"\ninclude <linux/pagemap.h>\n#\ninclude <linux/crc32.h>\n#\ninclude <linux/rbtree.h>\n#\ninclude <linux/mtd/mtd.h>\n#\ninclude <linux/fs.h>\n#\ninclude <linux/sched.h>\n#\ninclude <linux/kernel.h>\n#\n\ntruct jffs2_node_frag *jffs2_lookup_node_frag(struct rb_root *fragtree, uint32_t offset)\n{\n\t/* The common case in lookup is that there will be a node\n\t   which precisely matches. So we go looking for that first */\n\tstruct rb_node *next;\n\tstruct jffs2_node_frag *prev = NULL;\n\tstruct jffs2_node_frag *frag = NULL;\n\n\tdbg_fragtree2(\"root %p, offset %d\\n\", fragtree, offset);\n\n\tnext = fragtree->rb_node;\n\n\twhile(next) {\n\t\tfrag = rb_entry(next, struct jffs2_node_frag, rb);\n\n\t\tif (frag->ofs + frag->size <= offset) {\n\t\t\t/* Remember the closest smaller match on the way down */\n\t\t\tif (!prev || frag->ofs > prev->ofs)\n\t\t\t\tprev = frag;\n\t\t\tnext = frag->rb.rb_right;\n\t\t} else if (frag->ofs > offset) {\n\t\t\tnext = frag->rb.rb_left;\n\t\t} else {\n\t\t\treturn frag;\n\t\t}\n\t}\n\n\t/* Exact match not found. Go back up looking at each parent,\n\t   and return the closest smaller one */\n\n\tif (prev)\n\t\tdbg_fragtree2(\"no match. Returning frag %#04x-%#04x, closest previous\\n\",\n\t\t\t  prev->ofs, prev->ofs+prev->size);\n\telse\n\t\tdbg_fragtree2(\"returning NULL, empty fragtree\\n\");\n\n\treturn prev;\n}"
        }
      },
      {
        "call_info": {
          "callee": "ffs2_dbg(",
          "args": [
            ",",
            "%s(): ino #%u, range 0x%08x-0x%08x\\n\",",
            "_func__,",
            "->inocache->ino,",
            "ffset,",
            "ffset + len)"
          ],
          "line": 164
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "include \"compr.h\"\ninclude \"nodelist.h\"\n#\ninclude <linux/compiler.h>\n#\ninclude <linux/mtd/mtd.h>\n#\ninclude <linux/pagemap.h>\n#\ninclude <linux/crc32.h>\n#\ninclude <linux/slab.h>\n#\ninclude <linux/kernel.h>\n#\n\nnt jffs2_read_inode_range(struct jffs2_sb_info *c, struct jffs2_inode_info *f,\n\t\t\t   unsigned char *buf, uint32_t offset, uint32_t len)\n{\n\tuint32_t end = offset + len;\n\tstruct jffs2_node_frag *frag;\n\tint ret;\n\n\tjffs2_dbg(1, \"%s(): ino #%u, range 0x%08x-0x%08x\\n\",\n\t\t  __func__, f->inocache->ino, offset, offset + len);\n\n\tfrag = jffs2_lookup_node_frag(&f->fragtree, offset);\n\n\t/* XXX FIXME: Where a single physical node actually shows up in two\n\t   frags, we read it twice. Don't do that. */\n\t/* Now we're pointing at the first frag which overlaps our page\n\t * (or perhaps is before it, if we've been asked to read off the\n\t * end of the file). */\n\twhile(offset < end) {\n\t\tjffs2_dbg(2, \"%s(): offset %d, end %d\\n\",\n\t\t\t  __func__, offset, end);\n\t\tif (unlikely(!frag || frag->ofs > offset ||\n\t\t\t     frag->ofs + frag->size <= offset)) {\n\t\t\tuint32_t holesize = end - offset;\n\t\t\tif (frag && frag->ofs > offset) {\n\t\t\t\tjffs2_dbg(1, \"Eep. Hole in ino #%u fraglist. frag->ofs = 0x%08x, offset = 0x%08x\\n\",\n\t\t\t\t\t  f->inocache->ino, frag->ofs, offset);\n\t\t\t\tholesize = min(holesize, frag->ofs - offset);\n\t\t\t}\n\t\t\tjffs2_dbg(1, \"Filling non-frag hole from %d-%d\\n\",\n\t\t\t\t  offset, offset + holesize);\n\t\t\tmemset(buf, 0, holesize);\n\t\t\tbuf += holesize;\n\t\t\toffset += holesize;\n\t\t\tcontinue;\n\t\t} else if (unlikely(!frag->node)) {\n\t\t\tuint32_t holeend = min(end, frag->ofs + frag->size);\n\t\t\tjffs2_dbg(1, \"Filling frag hole from %d-%d (frag 0x%x 0x%x)\\n\",\n\t\t\t\t  offset, holeend, frag->ofs,\n\t\t\t\t  frag->ofs + frag->size);\n\t\t\tmemset(buf, 0, holeend - offset);\n\t\t\tbuf += holeend - offset;\n\t\t\toffset = holeend;\n\t\t\tfrag = frag_next(frag);\n\t\t\tcontinue;\n\t\t} else {\n\t\t\tuint32_t readlen;\n\t\t\tuint32_t fragofs; /* offset within the frag to start reading */\n\n\t\t\tfragofs = offset - frag->ofs;\n\t\t\treadlen = min(frag->size - fragofs, end - offset);\n\t\t\tjffs2_dbg(1, \"Reading %d-%d from node at 0x%08x (%d)\\n\",\n\t\t\t\t  frag->ofs+fragofs,\n\t\t\t\t  frag->ofs + fragofs+readlen,\n\t\t\t\t  ref_offset(frag->node->raw),\n\t\t\t\t  ref_flags(frag->node->raw));\n\t\t\tret = jffs2_read_dnode(c, f, frag->node, buf, fragofs + frag->ofs - frag->node->ofs, readlen);\n\t\t\tjffs2_dbg(2, \"node read done\\n\");\n\t\t\tif (ret) {\n\t\t\t\tjffs2_dbg(1, \"%s(): error %d\\n\",\n\t\t\t\t\t  __func__, ret);\n\t\t\t\tmemset(buf, 0, readlen);\n\t\t\t\treturn ret;\n\t\t\t}\n\t\t\tbuf += readlen;\n\t\t\toffset += readlen;\n\t\t\tfrag = frag_next(frag);\n\t\t\tjffs2_dbg(2, \"node read was OK. Looping\\n\");\n\t\t}\n\t}\n\treturn 0;\n}"
  },
  {
    "function_name": "ffs2_read_dnode(",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/jffs2/read.c",
    "lines": "23-155",
    "snippet": "nt jffs2_read_dnode(struct jffs2_sb_info *c, struct jffs2_inode_info *f,\n\t\t     struct jffs2_full_dnode *fd, unsigned char *buf,\n\t\t     int ofs, int len)\n{\n\tstruct jffs2_raw_inode *ri;\n\tsize_t readlen;\n\tuint32_t crc;\n\tunsigned char *decomprbuf = NULL;\n\tunsigned char *readbuf = NULL;\n\tint ret = 0;\n\n\tri = jffs2_alloc_raw_inode();\n\tif (!ri)\n\t\treturn -ENOMEM;\n\n\tret = jffs2_flash_read(c, ref_offset(fd->raw), sizeof(*ri), &readlen, (char *)ri);\n\tif (ret) {\n\t\tjffs2_free_raw_inode(ri);\n\t\tpr_warn(\"Error reading node from 0x%08x: %d\\n\",\n\t\t\tref_offset(fd->raw), ret);\n\t\treturn ret;\n\t}\n\tif (readlen != sizeof(*ri)) {\n\t\tjffs2_free_raw_inode(ri);\n\t\tpr_warn(\"Short read from 0x%08x: wanted 0x%zx bytes, got 0x%zx\\n\",\n\t\t\tref_offset(fd->raw), sizeof(*ri), readlen);\n\t\treturn -EIO;\n\t}\n\tcrc = crc32(0, ri, sizeof(*ri)-8);\n\n\tjffs2_dbg(1, \"Node read from %08x: node_crc %08x, calculated CRC %08x. dsize %x, csize %x, offset %x, buf %p\\n\",\n\t\t  ref_offset(fd->raw), je32_to_cpu(ri->node_crc),\n\t\t  crc, je32_to_cpu(ri->dsize), je32_to_cpu(ri->csize),\n\t\t  je32_to_cpu(ri->offset), buf);\n\tif (crc != je32_to_cpu(ri->node_crc)) {\n\t\tpr_warn(\"Node CRC %08x != calculated CRC %08x for node at %08x\\n\",\n\t\t\tje32_to_cpu(ri->node_crc), crc, ref_offset(fd->raw));\n\t\tret = -EIO;\n\t\tgoto out_ri;\n\t}\n\t/* There was a bug where we wrote hole nodes out with csize/dsize\n\t   swapped. Deal with it */\n\tif (ri->compr == JFFS2_COMPR_ZERO && !je32_to_cpu(ri->dsize) &&\n\t    je32_to_cpu(ri->csize)) {\n\t\tri->dsize = ri->csize;\n\t\tri->csize = cpu_to_je32(0);\n\t}\n\n\tD1(if(ofs + len > je32_to_cpu(ri->dsize)) {\n\t\t\tpr_warn(\"jffs2_read_dnode() asked for %d bytes at %d from %d-byte node\\n\",\n\t\t\t\tlen, ofs, je32_to_cpu(ri->dsize));\n\t\tret = -EINVAL;\n\t\tgoto out_ri;\n\t});\n\n\n\tif (ri->compr == JFFS2_COMPR_ZERO) {\n\t\tmemset(buf, 0, len);\n\t\tgoto out_ri;\n\t}\n\n\t/* Cases:\n\t   Reading whole node and it's uncompressed - read directly to buffer provided, check CRC.\n\t   Reading whole node and it's compressed - read into comprbuf, check CRC and decompress to buffer provided\n\t   Reading partial node and it's uncompressed - read into readbuf, check CRC, and copy\n\t   Reading partial node and it's compressed - read into readbuf, check checksum, decompress to decomprbuf and copy\n\t*/\n\tif (ri->compr == JFFS2_COMPR_NONE && len == je32_to_cpu(ri->dsize)) {\n\t\treadbuf = buf;\n\t} else {\n\t\treadbuf = kmalloc(je32_to_cpu(ri->csize), GFP_KERNEL);\n\t\tif (!readbuf) {\n\t\t\tret = -ENOMEM;\n\t\t\tgoto out_ri;\n\t\t}\n\t}\n\tif (ri->compr != JFFS2_COMPR_NONE) {\n\t\tif (len < je32_to_cpu(ri->dsize)) {\n\t\t\tdecomprbuf = kmalloc(je32_to_cpu(ri->dsize), GFP_KERNEL);\n\t\t\tif (!decomprbuf) {\n\t\t\t\tret = -ENOMEM;\n\t\t\t\tgoto out_readbuf;\n\t\t\t}\n\t\t} else {\n\t\t\tdecomprbuf = buf;\n\t\t}\n\t} else {\n\t\tdecomprbuf = readbuf;\n\t}\n\n\tjffs2_dbg(2, \"Read %d bytes to %p\\n\", je32_to_cpu(ri->csize),\n\t\t  readbuf);\n\tret = jffs2_flash_read(c, (ref_offset(fd->raw)) + sizeof(*ri),\n\t\t\t       je32_to_cpu(ri->csize), &readlen, readbuf);\n\n\tif (!ret && readlen != je32_to_cpu(ri->csize))\n\t\tret = -EIO;\n\tif (ret)\n\t\tgoto out_decomprbuf;\n\n\tcrc = crc32(0, readbuf, je32_to_cpu(ri->csize));\n\tif (crc != je32_to_cpu(ri->data_crc)) {\n\t\tpr_warn(\"Data CRC %08x != calculated CRC %08x for node at %08x\\n\",\n\t\t\tje32_to_cpu(ri->data_crc), crc, ref_offset(fd->raw));\n\t\tret = -EIO;\n\t\tgoto out_decomprbuf;\n\t}\n\tjffs2_dbg(2, \"Data CRC matches calculated CRC %08x\\n\", crc);\n\tif (ri->compr != JFFS2_COMPR_NONE) {\n\t\tjffs2_dbg(2, \"Decompress %d bytes from %p to %d bytes at %p\\n\",\n\t\t\t  je32_to_cpu(ri->csize), readbuf,\n\t\t\t  je32_to_cpu(ri->dsize), decomprbuf);\n\t\tret = jffs2_decompress(c, f, ri->compr | (ri->usercompr << 8), readbuf, decomprbuf, je32_to_cpu(ri->csize), je32_to_cpu(ri->dsize));\n\t\tif (ret) {\n\t\t\tpr_warn(\"Error: jffs2_decompress returned %d\\n\", ret);\n\t\t\tgoto out_decomprbuf;\n\t\t}\n\t}\n\n\tif (len < je32_to_cpu(ri->dsize)) {\n\t\tmemcpy(buf, decomprbuf+ofs, len);\n\t}\n out_decomprbuf:\n\tif(decomprbuf != buf && decomprbuf != readbuf)\n\t\tkfree(decomprbuf);\n out_readbuf:\n\tif(readbuf != buf)\n\t\tkfree(readbuf);\n out_ri:\n\tjffs2_free_raw_inode(ri);\n\n\treturn ret;\n}",
    "includes": [
      "include \"compr.h\"",
      "include \"nodelist.h\"\n#",
      "include <linux/compiler.h>\n#",
      "include <linux/mtd/mtd.h>\n#",
      "include <linux/pagemap.h>\n#",
      "include <linux/crc32.h>\n#",
      "include <linux/slab.h>\n#",
      "include <linux/kernel.h>\n#"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "ffs2_free_raw_inode(",
          "args": [
            "i)"
          ],
          "line": 152
        },
        "resolved": true,
        "details": {
          "function_name": "ffs2_free_raw_inode(",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/jffs2/malloc.c",
          "lines": "172-176",
          "snippet": "oid jffs2_free_raw_inode(struct jffs2_raw_inode *x)\n{\n\tdbg_memalloc(\"%p\\n\", x);\n\tkmem_cache_free(raw_inode_slab, x);\n}",
          "includes": [
            "include \"nodelist.h\"",
            "include <linux/jffs2.h>\n#",
            "include <linux/init.h>\n#",
            "include <linux/slab.h>\n#",
            "include <linux/kernel.h>\n#"
          ],
          "macros_used": [],
          "globals_used": [
            "tatic struct kmem_cache *raw_inode_slab;"
          ],
          "called_functions": [],
          "contextual_snippet": "include \"nodelist.h\"\ninclude <linux/jffs2.h>\n#\ninclude <linux/init.h>\n#\ninclude <linux/slab.h>\n#\ninclude <linux/kernel.h>\n#\n\ntatic struct kmem_cache *raw_inode_slab;\n\noid jffs2_free_raw_inode(struct jffs2_raw_inode *x)\n{\n\tdbg_memalloc(\"%p\\n\", x);\n\tkmem_cache_free(raw_inode_slab, x);\n}"
        }
      },
      {
        "call_info": {
          "callee": "free(",
          "args": [
            "eadbuf)"
          ],
          "line": 150
        },
        "resolved": true,
        "details": {
          "function_name": "in_free(",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/jffs2/scan.c",
          "lines": "51-60",
          "snippet": "tatic inline int min_free(struct jffs2_sb_info *c)\n{\n\tuint32_t min = 2 * sizeof(struct jffs2_raw_inode);\n#ifdef CONFIG_JFFS2_FS_WRITEBUFFER\n\tif (!jffs2_can_mark_obsolete(c) && min < c->wbuf_pagesize)\n\t\treturn c->wbuf_pagesize;\n#endif\n\treturn min;\n\n}",
          "includes": [
            "include \"debug.h\"",
            "include \"summary.h\"\n#",
            "include \"nodelist.h\"\n#",
            "include <linux/compiler.h>\n#",
            "include <linux/crc32.h>\n#",
            "include <linux/pagemap.h>\n#",
            "include <linux/mtd/mtd.h>\n#",
            "include <linux/slab.h>\n#",
            "include <linux/sched.h>\n#",
            "include <linux/kernel.h>\n#"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "include \"debug.h\"\ninclude \"summary.h\"\n#\ninclude \"nodelist.h\"\n#\ninclude <linux/compiler.h>\n#\ninclude <linux/crc32.h>\n#\ninclude <linux/pagemap.h>\n#\ninclude <linux/mtd/mtd.h>\n#\ninclude <linux/slab.h>\n#\ninclude <linux/sched.h>\n#\ninclude <linux/kernel.h>\n#\n\ntatic inline int min_free(struct jffs2_sb_info *c)\n{\n\tuint32_t min = 2 * sizeof(struct jffs2_raw_inode);\n#ifdef CONFIG_JFFS2_FS_WRITEBUFFER\n\tif (!jffs2_can_mark_obsolete(c) && min < c->wbuf_pagesize)\n\t\treturn c->wbuf_pagesize;\n#endif\n\treturn min;\n\n}"
        }
      },
      {
        "call_info": {
          "callee": "emcpy(",
          "args": [
            "uf,",
            "ecomprbuf+ofs,",
            "en)"
          ],
          "line": 143
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "e32_to_cpu(",
          "args": [
            "i->dsize)"
          ],
          "line": 142
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "r_warn(",
          "args": [
            "Error: jffs2_decompress returned %d\\n\",",
            "et)"
          ],
          "line": 137
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ffs2_decompress(",
          "args": [
            ",",
            ",",
            "i->compr | (ri->usercompr << 8),",
            "eadbuf,",
            "ecomprbuf,",
            "e32_to_cpu(ri->csize),",
            "e32_to_cpu(ri->dsize))"
          ],
          "line": 135
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "e32_to_cpu(",
          "args": [
            "i->dsize)"
          ],
          "line": 135
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "e32_to_cpu(",
          "args": [
            "i->csize)"
          ],
          "line": 135
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ffs2_dbg(",
          "args": [
            ",",
            "Decompress %d bytes from %p to %d bytes at %p\\n\",",
            "e32_to_cpu(ri->csize),",
            "eadbuf,",
            "e32_to_cpu(ri->dsize),",
            "ecomprbuf)"
          ],
          "line": 132
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "e32_to_cpu(",
          "args": [
            "i->dsize)"
          ],
          "line": 134
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "e32_to_cpu(",
          "args": [
            "i->csize)"
          ],
          "line": 133
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ffs2_dbg(",
          "args": [
            ",",
            "Data CRC matches calculated CRC %08x\\n\",",
            "rc)"
          ],
          "line": 130
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "r_warn(",
          "args": [
            "Data CRC %08x != calculated CRC %08x for node at %08x\\n\",",
            "e32_to_cpu(ri->data_crc),",
            "rc,",
            "ef_offset(fd->raw))"
          ],
          "line": 125
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ef_offset(",
          "args": [
            "d->raw)"
          ],
          "line": 126
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "e32_to_cpu(",
          "args": [
            "i->data_crc)"
          ],
          "line": 126
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "e32_to_cpu(",
          "args": [
            "i->data_crc)"
          ],
          "line": 124
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rc32(",
          "args": [
            ",",
            "eadbuf,",
            "e32_to_cpu(ri->csize))"
          ],
          "line": 123
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "e32_to_cpu(",
          "args": [
            "i->csize)"
          ],
          "line": 123
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "e32_to_cpu(",
          "args": [
            "i->csize)"
          ],
          "line": 118
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ffs2_flash_read(",
          "args": [
            ",",
            "ref_offset(fd->raw)) + sizeof(*ri),",
            "e32_to_cpu(ri->csize),",
            "readlen,",
            "eadbuf)"
          ],
          "line": 115
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "e32_to_cpu(",
          "args": [
            "i->csize)"
          ],
          "line": 116
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ef_offset(",
          "args": [
            "d->raw)"
          ],
          "line": 115
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ffs2_dbg(",
          "args": [
            ",",
            "Read %d bytes to %p\\n\",",
            "e32_to_cpu(ri->csize),",
            "eadbuf)"
          ],
          "line": 113
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "e32_to_cpu(",
          "args": [
            "i->csize)"
          ],
          "line": 113
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "malloc(",
          "args": [
            "e32_to_cpu(ri->dsize),",
            "FP_KERNEL)"
          ],
          "line": 101
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "e32_to_cpu(",
          "args": [
            "i->dsize)"
          ],
          "line": 101
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "e32_to_cpu(",
          "args": [
            "i->dsize)"
          ],
          "line": 100
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "malloc(",
          "args": [
            "e32_to_cpu(ri->csize),",
            "FP_KERNEL)"
          ],
          "line": 93
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "e32_to_cpu(",
          "args": [
            "i->csize)"
          ],
          "line": 93
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "e32_to_cpu(",
          "args": [
            "i->dsize)"
          ],
          "line": 90
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "emset(",
          "args": [
            "uf,",
            ",",
            "en)"
          ],
          "line": 80
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "1(",
          "args": [
            "f(ofs + len > je32_to_cpu(ri->dsize)) \n\t\t\tpr_warn(\"jffs2_read_dnode() asked for %d bytes at %d from %d-byte node\\n\",\n\t\t\t\tlen, ofs, je32_to_cpu(ri->dsize));\n\t\tret = -EINVAL;\n\t\tgoto out_ri;\n\t})"
          ],
          "line": 71
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "r_warn(",
          "args": [
            "jffs2_read_dnode() asked for %d bytes at %d from %d-byte node\\n\",",
            "en,",
            "fs,",
            "e32_to_cpu(ri->dsize))"
          ],
          "line": 72
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "e32_to_cpu(",
          "args": [
            "i->dsize)"
          ],
          "line": 73
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "f(",
          "args": [
            "fs + len > je32_to_cpu(ri->dsize))"
          ],
          "line": 71
        },
        "resolved": true,
        "details": {
          "function_name": "ffs2_free_xattr_ref(",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/jffs2/malloc.c",
          "lines": "319-323",
          "snippet": "oid jffs2_free_xattr_ref(struct jffs2_xattr_ref *ref)\n{\n\tdbg_memalloc(\"%p\\n\", ref);\n\tkmem_cache_free(xattr_ref_cache, ref);\n}",
          "includes": [
            "include \"nodelist.h\"",
            "include <linux/jffs2.h>\n#",
            "include <linux/init.h>\n#",
            "include <linux/slab.h>\n#",
            "include <linux/kernel.h>\n#"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "include \"nodelist.h\"\ninclude <linux/jffs2.h>\n#\ninclude <linux/init.h>\n#\ninclude <linux/slab.h>\n#\ninclude <linux/kernel.h>\n#\n\noid jffs2_free_xattr_ref(struct jffs2_xattr_ref *ref)\n{\n\tdbg_memalloc(\"%p\\n\", ref);\n\tkmem_cache_free(xattr_ref_cache, ref);\n}"
        }
      },
      {
        "call_info": {
          "callee": "e32_to_cpu(",
          "args": [
            "i->dsize)"
          ],
          "line": 71
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pu_to_je32(",
          "args": [
            ")"
          ],
          "line": 68
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "e32_to_cpu(",
          "args": [
            "i->csize)"
          ],
          "line": 66
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "e32_to_cpu(",
          "args": [
            "i->dsize)"
          ],
          "line": 65
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "r_warn(",
          "args": [
            "Node CRC %08x != calculated CRC %08x for node at %08x\\n\",",
            "e32_to_cpu(ri->node_crc),",
            "rc,",
            "ef_offset(fd->raw))"
          ],
          "line": 58
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ef_offset(",
          "args": [
            "d->raw)"
          ],
          "line": 59
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "e32_to_cpu(",
          "args": [
            "i->node_crc)"
          ],
          "line": 59
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "e32_to_cpu(",
          "args": [
            "i->node_crc)"
          ],
          "line": 57
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ffs2_dbg(",
          "args": [
            ",",
            "Node read from %08x: node_crc %08x, calculated CRC %08x. dsize %x, csize %x, offset %x, buf %p\\n\",",
            "ef_offset(fd->raw),",
            "e32_to_cpu(ri->node_crc),",
            "rc,",
            "e32_to_cpu(ri->dsize),",
            "e32_to_cpu(ri->csize),",
            "e32_to_cpu(ri->offset),",
            "uf)"
          ],
          "line": 53
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "e32_to_cpu(",
          "args": [
            "i->offset)"
          ],
          "line": 56
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "e32_to_cpu(",
          "args": [
            "i->csize)"
          ],
          "line": 55
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "e32_to_cpu(",
          "args": [
            "i->dsize)"
          ],
          "line": 55
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "e32_to_cpu(",
          "args": [
            "i->node_crc)"
          ],
          "line": 54
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ef_offset(",
          "args": [
            "d->raw)"
          ],
          "line": 54
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rc32(",
          "args": [
            ",",
            "i,",
            "izeof(*ri)-8)"
          ],
          "line": 51
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "r_warn(",
          "args": [
            "Short read from 0x%08x: wanted 0x%zx bytes, got 0x%zx\\n\",",
            "ef_offset(fd->raw),",
            "izeof(*ri),",
            "eadlen)"
          ],
          "line": 47
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ef_offset(",
          "args": [
            "d->raw)"
          ],
          "line": 48
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "r_warn(",
          "args": [
            "Error reading node from 0x%08x: %d\\n\",",
            "ef_offset(fd->raw),",
            "et)"
          ],
          "line": 41
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ef_offset(",
          "args": [
            "d->raw)"
          ],
          "line": 42
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ffs2_flash_read(",
          "args": [
            ",",
            "ef_offset(fd->raw),",
            "izeof(*ri),",
            "readlen,",
            "char *)ri)"
          ],
          "line": 38
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ef_offset(",
          "args": [
            "d->raw)"
          ],
          "line": 38
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ffs2_alloc_raw_inode(",
          "args": [],
          "line": 34
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "include \"compr.h\"\ninclude \"nodelist.h\"\n#\ninclude <linux/compiler.h>\n#\ninclude <linux/mtd/mtd.h>\n#\ninclude <linux/pagemap.h>\n#\ninclude <linux/crc32.h>\n#\ninclude <linux/slab.h>\n#\ninclude <linux/kernel.h>\n#\n\nnt jffs2_read_dnode(struct jffs2_sb_info *c, struct jffs2_inode_info *f,\n\t\t     struct jffs2_full_dnode *fd, unsigned char *buf,\n\t\t     int ofs, int len)\n{\n\tstruct jffs2_raw_inode *ri;\n\tsize_t readlen;\n\tuint32_t crc;\n\tunsigned char *decomprbuf = NULL;\n\tunsigned char *readbuf = NULL;\n\tint ret = 0;\n\n\tri = jffs2_alloc_raw_inode();\n\tif (!ri)\n\t\treturn -ENOMEM;\n\n\tret = jffs2_flash_read(c, ref_offset(fd->raw), sizeof(*ri), &readlen, (char *)ri);\n\tif (ret) {\n\t\tjffs2_free_raw_inode(ri);\n\t\tpr_warn(\"Error reading node from 0x%08x: %d\\n\",\n\t\t\tref_offset(fd->raw), ret);\n\t\treturn ret;\n\t}\n\tif (readlen != sizeof(*ri)) {\n\t\tjffs2_free_raw_inode(ri);\n\t\tpr_warn(\"Short read from 0x%08x: wanted 0x%zx bytes, got 0x%zx\\n\",\n\t\t\tref_offset(fd->raw), sizeof(*ri), readlen);\n\t\treturn -EIO;\n\t}\n\tcrc = crc32(0, ri, sizeof(*ri)-8);\n\n\tjffs2_dbg(1, \"Node read from %08x: node_crc %08x, calculated CRC %08x. dsize %x, csize %x, offset %x, buf %p\\n\",\n\t\t  ref_offset(fd->raw), je32_to_cpu(ri->node_crc),\n\t\t  crc, je32_to_cpu(ri->dsize), je32_to_cpu(ri->csize),\n\t\t  je32_to_cpu(ri->offset), buf);\n\tif (crc != je32_to_cpu(ri->node_crc)) {\n\t\tpr_warn(\"Node CRC %08x != calculated CRC %08x for node at %08x\\n\",\n\t\t\tje32_to_cpu(ri->node_crc), crc, ref_offset(fd->raw));\n\t\tret = -EIO;\n\t\tgoto out_ri;\n\t}\n\t/* There was a bug where we wrote hole nodes out with csize/dsize\n\t   swapped. Deal with it */\n\tif (ri->compr == JFFS2_COMPR_ZERO && !je32_to_cpu(ri->dsize) &&\n\t    je32_to_cpu(ri->csize)) {\n\t\tri->dsize = ri->csize;\n\t\tri->csize = cpu_to_je32(0);\n\t}\n\n\tD1(if(ofs + len > je32_to_cpu(ri->dsize)) {\n\t\t\tpr_warn(\"jffs2_read_dnode() asked for %d bytes at %d from %d-byte node\\n\",\n\t\t\t\tlen, ofs, je32_to_cpu(ri->dsize));\n\t\tret = -EINVAL;\n\t\tgoto out_ri;\n\t});\n\n\n\tif (ri->compr == JFFS2_COMPR_ZERO) {\n\t\tmemset(buf, 0, len);\n\t\tgoto out_ri;\n\t}\n\n\t/* Cases:\n\t   Reading whole node and it's uncompressed - read directly to buffer provided, check CRC.\n\t   Reading whole node and it's compressed - read into comprbuf, check CRC and decompress to buffer provided\n\t   Reading partial node and it's uncompressed - read into readbuf, check CRC, and copy\n\t   Reading partial node and it's compressed - read into readbuf, check checksum, decompress to decomprbuf and copy\n\t*/\n\tif (ri->compr == JFFS2_COMPR_NONE && len == je32_to_cpu(ri->dsize)) {\n\t\treadbuf = buf;\n\t} else {\n\t\treadbuf = kmalloc(je32_to_cpu(ri->csize), GFP_KERNEL);\n\t\tif (!readbuf) {\n\t\t\tret = -ENOMEM;\n\t\t\tgoto out_ri;\n\t\t}\n\t}\n\tif (ri->compr != JFFS2_COMPR_NONE) {\n\t\tif (len < je32_to_cpu(ri->dsize)) {\n\t\t\tdecomprbuf = kmalloc(je32_to_cpu(ri->dsize), GFP_KERNEL);\n\t\t\tif (!decomprbuf) {\n\t\t\t\tret = -ENOMEM;\n\t\t\t\tgoto out_readbuf;\n\t\t\t}\n\t\t} else {\n\t\t\tdecomprbuf = buf;\n\t\t}\n\t} else {\n\t\tdecomprbuf = readbuf;\n\t}\n\n\tjffs2_dbg(2, \"Read %d bytes to %p\\n\", je32_to_cpu(ri->csize),\n\t\t  readbuf);\n\tret = jffs2_flash_read(c, (ref_offset(fd->raw)) + sizeof(*ri),\n\t\t\t       je32_to_cpu(ri->csize), &readlen, readbuf);\n\n\tif (!ret && readlen != je32_to_cpu(ri->csize))\n\t\tret = -EIO;\n\tif (ret)\n\t\tgoto out_decomprbuf;\n\n\tcrc = crc32(0, readbuf, je32_to_cpu(ri->csize));\n\tif (crc != je32_to_cpu(ri->data_crc)) {\n\t\tpr_warn(\"Data CRC %08x != calculated CRC %08x for node at %08x\\n\",\n\t\t\tje32_to_cpu(ri->data_crc), crc, ref_offset(fd->raw));\n\t\tret = -EIO;\n\t\tgoto out_decomprbuf;\n\t}\n\tjffs2_dbg(2, \"Data CRC matches calculated CRC %08x\\n\", crc);\n\tif (ri->compr != JFFS2_COMPR_NONE) {\n\t\tjffs2_dbg(2, \"Decompress %d bytes from %p to %d bytes at %p\\n\",\n\t\t\t  je32_to_cpu(ri->csize), readbuf,\n\t\t\t  je32_to_cpu(ri->dsize), decomprbuf);\n\t\tret = jffs2_decompress(c, f, ri->compr | (ri->usercompr << 8), readbuf, decomprbuf, je32_to_cpu(ri->csize), je32_to_cpu(ri->dsize));\n\t\tif (ret) {\n\t\t\tpr_warn(\"Error: jffs2_decompress returned %d\\n\", ret);\n\t\t\tgoto out_decomprbuf;\n\t\t}\n\t}\n\n\tif (len < je32_to_cpu(ri->dsize)) {\n\t\tmemcpy(buf, decomprbuf+ofs, len);\n\t}\n out_decomprbuf:\n\tif(decomprbuf != buf && decomprbuf != readbuf)\n\t\tkfree(decomprbuf);\n out_readbuf:\n\tif(readbuf != buf)\n\t\tkfree(readbuf);\n out_ri:\n\tjffs2_free_raw_inode(ri);\n\n\treturn ret;\n}"
  }
]