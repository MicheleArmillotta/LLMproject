[
  {
    "function_name": "kmem_zone_zalloc",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/xfs/kmem.h",
    "lines": "119-123",
    "snippet": "static inline void *\nkmem_zone_zalloc(kmem_zone_t *zone, xfs_km_flags_t flags)\n{\n\treturn kmem_zone_alloc(zone, flags | KM_ZERO);\n}",
    "includes": [
      "#include <linux/vmalloc.h>",
      "#include <linux/mm.h>",
      "#include <linux/sched.h>",
      "#include <linux/slab.h>"
    ],
    "macros_used": [
      "#define kmem_zone_t\tstruct kmem_cache",
      "#define KM_ZERO\t\t((__force xfs_km_flags_t)0x0010u)"
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "kmem_zone_alloc",
          "args": [
            "zone",
            "flags | KM_ZERO"
          ],
          "line": 122
        },
        "resolved": true,
        "details": {
          "function_name": "kmem_zone_alloc",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/xfs/kmem.c",
          "lines": "110-127",
          "snippet": "void *\nkmem_zone_alloc(kmem_zone_t *zone, xfs_km_flags_t flags)\n{\n\tint\tretries = 0;\n\tgfp_t\tlflags = kmem_flags_convert(flags);\n\tvoid\t*ptr;\n\n\tdo {\n\t\tptr = kmem_cache_alloc(zone, lflags);\n\t\tif (ptr || (flags & (KM_MAYFAIL|KM_NOSLEEP)))\n\t\t\treturn ptr;\n\t\tif (!(++retries % 100))\n\t\t\txfs_err(NULL,\n\t\t\"possible memory allocation deadlock in %s (mode:0x%x)\",\n\t\t\t\t\t__func__, lflags);\n\t\tcongestion_wait(BLK_RW_ASYNC, HZ/50);\n\t} while (1);\n}",
          "includes": [
            "#include \"xfs_message.h\"",
            "#include \"kmem.h\"",
            "#include <linux/backing-dev.h>",
            "#include <linux/blkdev.h>",
            "#include <linux/swap.h>",
            "#include <linux/slab.h>",
            "#include <linux/highmem.h>",
            "#include <linux/mm.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"xfs_message.h\"\n#include \"kmem.h\"\n#include <linux/backing-dev.h>\n#include <linux/blkdev.h>\n#include <linux/swap.h>\n#include <linux/slab.h>\n#include <linux/highmem.h>\n#include <linux/mm.h>\n\nvoid *\nkmem_zone_alloc(kmem_zone_t *zone, xfs_km_flags_t flags)\n{\n\tint\tretries = 0;\n\tgfp_t\tlflags = kmem_flags_convert(flags);\n\tvoid\t*ptr;\n\n\tdo {\n\t\tptr = kmem_cache_alloc(zone, lflags);\n\t\tif (ptr || (flags & (KM_MAYFAIL|KM_NOSLEEP)))\n\t\t\treturn ptr;\n\t\tif (!(++retries % 100))\n\t\t\txfs_err(NULL,\n\t\t\"possible memory allocation deadlock in %s (mode:0x%x)\",\n\t\t\t\t\t__func__, lflags);\n\t\tcongestion_wait(BLK_RW_ASYNC, HZ/50);\n\t} while (1);\n}"
        }
      }
    ],
    "contextual_snippet": "#include <linux/vmalloc.h>\n#include <linux/mm.h>\n#include <linux/sched.h>\n#include <linux/slab.h>\n\n#define kmem_zone_t\tstruct kmem_cache\n#define KM_ZERO\t\t((__force xfs_km_flags_t)0x0010u)\n\nstatic inline void *\nkmem_zone_zalloc(kmem_zone_t *zone, xfs_km_flags_t flags)\n{\n\treturn kmem_zone_alloc(zone, flags | KM_ZERO);\n}"
  },
  {
    "function_name": "kmem_zone_destroy",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/xfs/kmem.h",
    "lines": "110-115",
    "snippet": "static inline void\nkmem_zone_destroy(kmem_zone_t *zone)\n{\n\tif (zone)\n\t\tkmem_cache_destroy(zone);\n}",
    "includes": [
      "#include <linux/vmalloc.h>",
      "#include <linux/mm.h>",
      "#include <linux/sched.h>",
      "#include <linux/slab.h>"
    ],
    "macros_used": [
      "#define kmem_zone_t\tstruct kmem_cache"
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "kmem_cache_destroy",
          "args": [
            "zone"
          ],
          "line": 114
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <linux/vmalloc.h>\n#include <linux/mm.h>\n#include <linux/sched.h>\n#include <linux/slab.h>\n\n#define kmem_zone_t\tstruct kmem_cache\n\nstatic inline void\nkmem_zone_destroy(kmem_zone_t *zone)\n{\n\tif (zone)\n\t\tkmem_cache_destroy(zone);\n}"
  },
  {
    "function_name": "kmem_zone_free",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/xfs/kmem.h",
    "lines": "104-108",
    "snippet": "static inline void\nkmem_zone_free(kmem_zone_t *zone, void *ptr)\n{\n\tkmem_cache_free(zone, ptr);\n}",
    "includes": [
      "#include <linux/vmalloc.h>",
      "#include <linux/mm.h>",
      "#include <linux/sched.h>",
      "#include <linux/slab.h>"
    ],
    "macros_used": [
      "#define kmem_zone_t\tstruct kmem_cache"
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "kmem_cache_free",
          "args": [
            "zone",
            "ptr"
          ],
          "line": 107
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <linux/vmalloc.h>\n#include <linux/mm.h>\n#include <linux/sched.h>\n#include <linux/slab.h>\n\n#define kmem_zone_t\tstruct kmem_cache\n\nstatic inline void\nkmem_zone_free(kmem_zone_t *zone, void *ptr)\n{\n\tkmem_cache_free(zone, ptr);\n}"
  },
  {
    "function_name": "kmem_zone_init_flags",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/xfs/kmem.h",
    "lines": "97-102",
    "snippet": "static inline kmem_zone_t *\nkmem_zone_init_flags(int size, char *zone_name, unsigned long flags,\n\t\t     void (*construct)(void *))\n{\n\treturn kmem_cache_create(zone_name, size, 0, flags, construct);\n}",
    "includes": [
      "#include <linux/vmalloc.h>",
      "#include <linux/mm.h>",
      "#include <linux/sched.h>",
      "#include <linux/slab.h>"
    ],
    "macros_used": [
      "#define kmem_zone_t\tstruct kmem_cache"
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "kmem_cache_create",
          "args": [
            "zone_name",
            "size",
            "0",
            "flags",
            "construct"
          ],
          "line": 101
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <linux/vmalloc.h>\n#include <linux/mm.h>\n#include <linux/sched.h>\n#include <linux/slab.h>\n\n#define kmem_zone_t\tstruct kmem_cache\n\nstatic inline kmem_zone_t *\nkmem_zone_init_flags(int size, char *zone_name, unsigned long flags,\n\t\t     void (*construct)(void *))\n{\n\treturn kmem_cache_create(zone_name, size, 0, flags, construct);\n}"
  },
  {
    "function_name": "kmem_zone_init",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/xfs/kmem.h",
    "lines": "91-95",
    "snippet": "static inline kmem_zone_t *\nkmem_zone_init(int size, char *zone_name)\n{\n\treturn kmem_cache_create(zone_name, size, 0, 0, NULL);\n}",
    "includes": [
      "#include <linux/vmalloc.h>",
      "#include <linux/mm.h>",
      "#include <linux/sched.h>",
      "#include <linux/slab.h>"
    ],
    "macros_used": [
      "#define kmem_zone_t\tstruct kmem_cache"
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "kmem_cache_create",
          "args": [
            "zone_name",
            "size",
            "0",
            "0",
            "NULL"
          ],
          "line": 94
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <linux/vmalloc.h>\n#include <linux/mm.h>\n#include <linux/sched.h>\n#include <linux/slab.h>\n\n#define kmem_zone_t\tstruct kmem_cache\n\nstatic inline kmem_zone_t *\nkmem_zone_init(int size, char *zone_name)\n{\n\treturn kmem_cache_create(zone_name, size, 0, 0, NULL);\n}"
  },
  {
    "function_name": "kmem_zalloc",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/xfs/kmem.h",
    "lines": "74-78",
    "snippet": "static inline void *\nkmem_zalloc(size_t size, xfs_km_flags_t flags)\n{\n\treturn kmem_alloc(size, flags | KM_ZERO);\n}",
    "includes": [
      "#include <linux/vmalloc.h>",
      "#include <linux/mm.h>",
      "#include <linux/sched.h>",
      "#include <linux/slab.h>"
    ],
    "macros_used": [
      "#define KM_ZERO\t\t((__force xfs_km_flags_t)0x0010u)"
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "kmem_alloc",
          "args": [
            "size",
            "flags | KM_ZERO"
          ],
          "line": 77
        },
        "resolved": true,
        "details": {
          "function_name": "kmem_alloc",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/xfs/kmem.c",
          "lines": "45-62",
          "snippet": "void *\nkmem_alloc(size_t size, xfs_km_flags_t flags)\n{\n\tint\tretries = 0;\n\tgfp_t\tlflags = kmem_flags_convert(flags);\n\tvoid\t*ptr;\n\n\tdo {\n\t\tptr = kmalloc(size, lflags);\n\t\tif (ptr || (flags & (KM_MAYFAIL|KM_NOSLEEP)))\n\t\t\treturn ptr;\n\t\tif (!(++retries % 100))\n\t\t\txfs_err(NULL,\n\t\t\"possible memory allocation deadlock in %s (mode:0x%x)\",\n\t\t\t\t\t__func__, lflags);\n\t\tcongestion_wait(BLK_RW_ASYNC, HZ/50);\n\t} while (1);\n}",
          "includes": [
            "#include \"xfs_message.h\"",
            "#include \"kmem.h\"",
            "#include <linux/backing-dev.h>",
            "#include <linux/blkdev.h>",
            "#include <linux/swap.h>",
            "#include <linux/slab.h>",
            "#include <linux/highmem.h>",
            "#include <linux/mm.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"xfs_message.h\"\n#include \"kmem.h\"\n#include <linux/backing-dev.h>\n#include <linux/blkdev.h>\n#include <linux/swap.h>\n#include <linux/slab.h>\n#include <linux/highmem.h>\n#include <linux/mm.h>\n\nvoid *\nkmem_alloc(size_t size, xfs_km_flags_t flags)\n{\n\tint\tretries = 0;\n\tgfp_t\tlflags = kmem_flags_convert(flags);\n\tvoid\t*ptr;\n\n\tdo {\n\t\tptr = kmalloc(size, lflags);\n\t\tif (ptr || (flags & (KM_MAYFAIL|KM_NOSLEEP)))\n\t\t\treturn ptr;\n\t\tif (!(++retries % 100))\n\t\t\txfs_err(NULL,\n\t\t\"possible memory allocation deadlock in %s (mode:0x%x)\",\n\t\t\t\t\t__func__, lflags);\n\t\tcongestion_wait(BLK_RW_ASYNC, HZ/50);\n\t} while (1);\n}"
        }
      }
    ],
    "contextual_snippet": "#include <linux/vmalloc.h>\n#include <linux/mm.h>\n#include <linux/sched.h>\n#include <linux/slab.h>\n\n#define KM_ZERO\t\t((__force xfs_km_flags_t)0x0010u)\n\nstatic inline void *\nkmem_zalloc(size_t size, xfs_km_flags_t flags)\n{\n\treturn kmem_alloc(size, flags | KM_ZERO);\n}"
  },
  {
    "function_name": "kmem_free",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/xfs/kmem.h",
    "lines": "66-69",
    "snippet": "static inline void  kmem_free(const void *ptr)\n{\n\tkvfree(ptr);\n}",
    "includes": [
      "#include <linux/vmalloc.h>",
      "#include <linux/mm.h>",
      "#include <linux/sched.h>",
      "#include <linux/slab.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "kvfree",
          "args": [
            "ptr"
          ],
          "line": 68
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <linux/vmalloc.h>\n#include <linux/mm.h>\n#include <linux/sched.h>\n#include <linux/slab.h>\n\nstatic inline void  kmem_free(const void *ptr)\n{\n\tkvfree(ptr);\n}"
  },
  {
    "function_name": "kmem_flags_convert",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/xfs/kmem.h",
    "lines": "42-61",
    "snippet": "static inline gfp_t\nkmem_flags_convert(xfs_km_flags_t flags)\n{\n\tgfp_t\tlflags;\n\n\tBUG_ON(flags & ~(KM_SLEEP|KM_NOSLEEP|KM_NOFS|KM_MAYFAIL|KM_ZERO));\n\n\tif (flags & KM_NOSLEEP) {\n\t\tlflags = GFP_ATOMIC | __GFP_NOWARN;\n\t} else {\n\t\tlflags = GFP_KERNEL | __GFP_NOWARN;\n\t\tif ((current->flags & PF_FSTRANS) || (flags & KM_NOFS))\n\t\t\tlflags &= ~__GFP_FS;\n\t}\n\n\tif (flags & KM_ZERO)\n\t\tlflags |= __GFP_ZERO;\n\n\treturn lflags;\n}",
    "includes": [
      "#include <linux/vmalloc.h>",
      "#include <linux/mm.h>",
      "#include <linux/sched.h>",
      "#include <linux/slab.h>"
    ],
    "macros_used": [
      "#define KM_ZERO\t\t((__force xfs_km_flags_t)0x0010u)",
      "#define KM_MAYFAIL\t((__force xfs_km_flags_t)0x0008u)",
      "#define KM_NOFS\t\t((__force xfs_km_flags_t)0x0004u)",
      "#define KM_NOSLEEP\t((__force xfs_km_flags_t)0x0002u)",
      "#define KM_SLEEP\t((__force xfs_km_flags_t)0x0001u)"
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "BUG_ON",
          "args": [
            "flags & ~(KM_SLEEP|KM_NOSLEEP|KM_NOFS|KM_MAYFAIL|KM_ZERO)"
          ],
          "line": 47
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <linux/vmalloc.h>\n#include <linux/mm.h>\n#include <linux/sched.h>\n#include <linux/slab.h>\n\n#define KM_ZERO\t\t((__force xfs_km_flags_t)0x0010u)\n#define KM_MAYFAIL\t((__force xfs_km_flags_t)0x0008u)\n#define KM_NOFS\t\t((__force xfs_km_flags_t)0x0004u)\n#define KM_NOSLEEP\t((__force xfs_km_flags_t)0x0002u)\n#define KM_SLEEP\t((__force xfs_km_flags_t)0x0001u)\n\nstatic inline gfp_t\nkmem_flags_convert(xfs_km_flags_t flags)\n{\n\tgfp_t\tlflags;\n\n\tBUG_ON(flags & ~(KM_SLEEP|KM_NOSLEEP|KM_NOFS|KM_MAYFAIL|KM_ZERO));\n\n\tif (flags & KM_NOSLEEP) {\n\t\tlflags = GFP_ATOMIC | __GFP_NOWARN;\n\t} else {\n\t\tlflags = GFP_KERNEL | __GFP_NOWARN;\n\t\tif ((current->flags & PF_FSTRANS) || (flags & KM_NOFS))\n\t\t\tlflags &= ~__GFP_FS;\n\t}\n\n\tif (flags & KM_ZERO)\n\t\tlflags |= __GFP_ZERO;\n\n\treturn lflags;\n}"
  }
]