[
  {
    "function_name": "hfs_part_find",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/hfs/part_tbl.c",
    "lines": "58-117",
    "snippet": "int hfs_part_find(struct super_block *sb,\n\t\t  sector_t *part_start, sector_t *part_size)\n{\n\tstruct buffer_head *bh;\n\t__be16 *data;\n\tint i, size, res;\n\n\tres = -ENOENT;\n\tbh = sb_bread512(sb, *part_start + HFS_PMAP_BLK, data);\n\tif (!bh)\n\t\treturn -EIO;\n\n\tswitch (be16_to_cpu(*data)) {\n\tcase HFS_OLD_PMAP_MAGIC:\n\t  {\n\t\tstruct old_pmap *pm;\n\t\tstruct old_pmap_entry *p;\n\n\t\tpm = (struct old_pmap *)bh->b_data;\n\t\tp = pm->pdEntry;\n\t\tsize = 42;\n\t\tfor (i = 0; i < size; p++, i++) {\n\t\t\tif (p->pdStart && p->pdSize &&\n\t\t\t    p->pdFSID == cpu_to_be32(0x54465331)/*\"TFS1\"*/ &&\n\t\t\t    (HFS_SB(sb)->part < 0 || HFS_SB(sb)->part == i)) {\n\t\t\t\t*part_start += be32_to_cpu(p->pdStart);\n\t\t\t\t*part_size = be32_to_cpu(p->pdSize);\n\t\t\t\tres = 0;\n\t\t\t}\n\t\t}\n\t\tbreak;\n\t  }\n\tcase HFS_NEW_PMAP_MAGIC:\n\t  {\n\t\tstruct new_pmap *pm;\n\n\t\tpm = (struct new_pmap *)bh->b_data;\n\t\tsize = be32_to_cpu(pm->pmMapBlkCnt);\n\t\tfor (i = 0; i < size;) {\n\t\t\tif (!memcmp(pm->pmPartType,\"Apple_HFS\", 9) &&\n\t\t\t    (HFS_SB(sb)->part < 0 || HFS_SB(sb)->part == i)) {\n\t\t\t\t*part_start += be32_to_cpu(pm->pmPyPartStart);\n\t\t\t\t*part_size = be32_to_cpu(pm->pmPartBlkCnt);\n\t\t\t\tres = 0;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tbrelse(bh);\n\t\t\tbh = sb_bread512(sb, *part_start + HFS_PMAP_BLK + ++i, pm);\n\t\t\tif (!bh)\n\t\t\t\treturn -EIO;\n\t\t\tif (pm->pmSig != cpu_to_be16(HFS_NEW_PMAP_MAGIC))\n\t\t\t\tbreak;\n\t\t}\n\t\tbreak;\n\t  }\n\t}\n\tbrelse(bh);\n\n\treturn res;\n}",
    "includes": [
      "#include \"hfs_fs.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "struct old_pmap {\n\t__be16\t\tpdSig;\t/* Signature bytes */\n\tstruct \told_pmap_entry {\n\t\t__be32\tpdStart;\n\t\t__be32\tpdSize;\n\t\t__be32\tpdFSID;\n\t}\tpdEntry[42];\n} __packed;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "brelse",
          "args": [
            "bh"
          ],
          "line": 114
        },
        "resolved": true,
        "details": {
          "function_name": "__brelse",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/buffer.c",
          "lines": "1177-1184",
          "snippet": "void __brelse(struct buffer_head * buf)\n{\n\tif (atomic_read(&buf->b_count)) {\n\t\tput_bh(buf);\n\t\treturn;\n\t}\n\tWARN(1, KERN_ERR \"VFS: brelse: Trying to free free buffer\\n\");\n}",
          "includes": [
            "#include <trace/events/block.h>",
            "#include <linux/bit_spinlock.h>",
            "#include <linux/mpage.h>",
            "#include <linux/bitops.h>",
            "#include <linux/cpu.h>",
            "#include <linux/notifier.h>",
            "#include <linux/bio.h>",
            "#include <linux/task_io_accounting_ops.h>",
            "#include <linux/buffer_head.h>",
            "#include <linux/suspend.h>",
            "#include <linux/hash.h>",
            "#include <linux/writeback.h>",
            "#include <linux/export.h>",
            "#include <linux/highmem.h>",
            "#include <linux/quotaops.h>",
            "#include <linux/file.h>",
            "#include <linux/blkdev.h>",
            "#include <linux/capability.h>",
            "#include <linux/slab.h>",
            "#include <linux/percpu.h>",
            "#include <linux/mm.h>",
            "#include <linux/fs.h>",
            "#include <linux/syscalls.h>",
            "#include <linux/kernel.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <trace/events/block.h>\n#include <linux/bit_spinlock.h>\n#include <linux/mpage.h>\n#include <linux/bitops.h>\n#include <linux/cpu.h>\n#include <linux/notifier.h>\n#include <linux/bio.h>\n#include <linux/task_io_accounting_ops.h>\n#include <linux/buffer_head.h>\n#include <linux/suspend.h>\n#include <linux/hash.h>\n#include <linux/writeback.h>\n#include <linux/export.h>\n#include <linux/highmem.h>\n#include <linux/quotaops.h>\n#include <linux/file.h>\n#include <linux/blkdev.h>\n#include <linux/capability.h>\n#include <linux/slab.h>\n#include <linux/percpu.h>\n#include <linux/mm.h>\n#include <linux/fs.h>\n#include <linux/syscalls.h>\n#include <linux/kernel.h>\n\nvoid __brelse(struct buffer_head * buf)\n{\n\tif (atomic_read(&buf->b_count)) {\n\t\tput_bh(buf);\n\t\treturn;\n\t}\n\tWARN(1, KERN_ERR \"VFS: brelse: Trying to free free buffer\\n\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "cpu_to_be16",
          "args": [
            "HFS_NEW_PMAP_MAGIC"
          ],
          "line": 108
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sb_bread512",
          "args": [
            "sb",
            "*part_start + HFS_PMAP_BLK + ++i",
            "pm"
          ],
          "line": 105
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "be32_to_cpu",
          "args": [
            "pm->pmPartBlkCnt"
          ],
          "line": 100
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "be32_to_cpu",
          "args": [
            "pm->pmPyPartStart"
          ],
          "line": 99
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "HFS_SB",
          "args": [
            "sb"
          ],
          "line": 98
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "HFS_SB",
          "args": [
            "sb"
          ],
          "line": 98
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memcmp",
          "args": [
            "pm->pmPartType",
            "\"Apple_HFS\"",
            "9"
          ],
          "line": 97
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "be32_to_cpu",
          "args": [
            "pm->pmMapBlkCnt"
          ],
          "line": 95
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "be32_to_cpu",
          "args": [
            "p->pdSize"
          ],
          "line": 84
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "be32_to_cpu",
          "args": [
            "p->pdStart"
          ],
          "line": 83
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "HFS_SB",
          "args": [
            "sb"
          ],
          "line": 82
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "HFS_SB",
          "args": [
            "sb"
          ],
          "line": 82
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "cpu_to_be32",
          "args": [
            "0x54465331"
          ],
          "line": 81
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "be16_to_cpu",
          "args": [
            "*data"
          ],
          "line": 70
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sb_bread512",
          "args": [
            "sb",
            "*part_start + HFS_PMAP_BLK",
            "data"
          ],
          "line": 66
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"hfs_fs.h\"\n\nstruct old_pmap {\n\t__be16\t\tpdSig;\t/* Signature bytes */\n\tstruct \told_pmap_entry {\n\t\t__be32\tpdStart;\n\t\t__be32\tpdSize;\n\t\t__be32\tpdFSID;\n\t}\tpdEntry[42];\n} __packed;\n\nint hfs_part_find(struct super_block *sb,\n\t\t  sector_t *part_start, sector_t *part_size)\n{\n\tstruct buffer_head *bh;\n\t__be16 *data;\n\tint i, size, res;\n\n\tres = -ENOENT;\n\tbh = sb_bread512(sb, *part_start + HFS_PMAP_BLK, data);\n\tif (!bh)\n\t\treturn -EIO;\n\n\tswitch (be16_to_cpu(*data)) {\n\tcase HFS_OLD_PMAP_MAGIC:\n\t  {\n\t\tstruct old_pmap *pm;\n\t\tstruct old_pmap_entry *p;\n\n\t\tpm = (struct old_pmap *)bh->b_data;\n\t\tp = pm->pdEntry;\n\t\tsize = 42;\n\t\tfor (i = 0; i < size; p++, i++) {\n\t\t\tif (p->pdStart && p->pdSize &&\n\t\t\t    p->pdFSID == cpu_to_be32(0x54465331)/*\"TFS1\"*/ &&\n\t\t\t    (HFS_SB(sb)->part < 0 || HFS_SB(sb)->part == i)) {\n\t\t\t\t*part_start += be32_to_cpu(p->pdStart);\n\t\t\t\t*part_size = be32_to_cpu(p->pdSize);\n\t\t\t\tres = 0;\n\t\t\t}\n\t\t}\n\t\tbreak;\n\t  }\n\tcase HFS_NEW_PMAP_MAGIC:\n\t  {\n\t\tstruct new_pmap *pm;\n\n\t\tpm = (struct new_pmap *)bh->b_data;\n\t\tsize = be32_to_cpu(pm->pmMapBlkCnt);\n\t\tfor (i = 0; i < size;) {\n\t\t\tif (!memcmp(pm->pmPartType,\"Apple_HFS\", 9) &&\n\t\t\t    (HFS_SB(sb)->part < 0 || HFS_SB(sb)->part == i)) {\n\t\t\t\t*part_start += be32_to_cpu(pm->pmPyPartStart);\n\t\t\t\t*part_size = be32_to_cpu(pm->pmPartBlkCnt);\n\t\t\t\tres = 0;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tbrelse(bh);\n\t\t\tbh = sb_bread512(sb, *part_start + HFS_PMAP_BLK + ++i, pm);\n\t\t\tif (!bh)\n\t\t\t\treturn -EIO;\n\t\t\tif (pm->pmSig != cpu_to_be16(HFS_NEW_PMAP_MAGIC))\n\t\t\t\tbreak;\n\t\t}\n\t\tbreak;\n\t  }\n\t}\n\tbrelse(bh);\n\n\treturn res;\n}"
  }
]