[
  {
    "function_name": "fsnotify_add_vfsmount_mark",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/notify/vfsmount_mark.c",
    "lines": "108-127",
    "snippet": "int fsnotify_add_vfsmount_mark(struct fsnotify_mark *mark,\n\t\t\t       struct fsnotify_group *group, struct vfsmount *mnt,\n\t\t\t       int allow_dups)\n{\n\tstruct mount *m = real_mount(mnt);\n\tint ret;\n\n\tmark->flags |= FSNOTIFY_MARK_FLAG_VFSMOUNT;\n\n\tBUG_ON(!mutex_is_locked(&group->mark_mutex));\n\tassert_spin_locked(&mark->lock);\n\n\tspin_lock(&mnt->mnt_root->d_lock);\n\tmark->mnt = mnt;\n\tret = fsnotify_add_mark_list(&m->mnt_fsnotify_marks, mark, allow_dups);\n\tm->mnt_fsnotify_mask = fsnotify_recalc_mask(&m->mnt_fsnotify_marks);\n\tspin_unlock(&mnt->mnt_root->d_lock);\n\n\treturn ret;\n}",
    "includes": [
      "#include \"../mount.h\"",
      "#include \"fsnotify.h\"",
      "#include <linux/fsnotify_backend.h>",
      "#include <linux/atomic.h>",
      "#include <linux/spinlock.h>",
      "#include <linux/mutex.h>",
      "#include <linux/mount.h>",
      "#include <linux/module.h>",
      "#include <linux/kernel.h>",
      "#include <linux/init.h>",
      "#include <linux/fs.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "spin_unlock",
          "args": [
            "&mnt->mnt_root->d_lock"
          ],
          "line": 124
        },
        "resolved": true,
        "details": {
          "function_name": "__spin_unlock_mb_cache_entry",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/mbcache.c",
          "lines": "139-144",
          "snippet": "static inline void\n__spin_unlock_mb_cache_entry(struct mb_cache_entry *ce)\n{\n\tspin_unlock(bgl_lock_ptr(mb_cache_bg_lock,\n\t\tMB_CACHE_ENTRY_LOCK_INDEX(ce)));\n}",
          "includes": [
            "#include <linux/log2.h>",
            "#include <linux/blockgroup_lock.h>",
            "#include <linux/init.h>",
            "#include <linux/mbcache.h>",
            "#include <linux/list_bl.h>",
            "#include <linux/sched.h>",
            "#include <linux/slab.h>",
            "#include <linux/mm.h>",
            "#include <linux/fs.h>",
            "#include <linux/hash.h>",
            "#include <linux/module.h>",
            "#include <linux/kernel.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static struct blockgroup_lock *mb_cache_bg_lock;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <linux/log2.h>\n#include <linux/blockgroup_lock.h>\n#include <linux/init.h>\n#include <linux/mbcache.h>\n#include <linux/list_bl.h>\n#include <linux/sched.h>\n#include <linux/slab.h>\n#include <linux/mm.h>\n#include <linux/fs.h>\n#include <linux/hash.h>\n#include <linux/module.h>\n#include <linux/kernel.h>\n\nstatic struct blockgroup_lock *mb_cache_bg_lock;\n\nstatic inline void\n__spin_unlock_mb_cache_entry(struct mb_cache_entry *ce)\n{\n\tspin_unlock(bgl_lock_ptr(mb_cache_bg_lock,\n\t\tMB_CACHE_ENTRY_LOCK_INDEX(ce)));\n}"
        }
      },
      {
        "call_info": {
          "callee": "fsnotify_recalc_mask",
          "args": [
            "&m->mnt_fsnotify_marks"
          ],
          "line": 123
        },
        "resolved": true,
        "details": {
          "function_name": "fsnotify_recalc_mask",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/notify/mark.c",
          "lines": "114-122",
          "snippet": "u32 fsnotify_recalc_mask(struct hlist_head *head)\n{\n\tu32 new_mask = 0;\n\tstruct fsnotify_mark *mark;\n\n\thlist_for_each_entry(mark, head, obj_list)\n\t\tnew_mask |= mark->mask;\n\treturn new_mask;\n}",
          "includes": [
            "#include \"fsnotify.h\"",
            "#include <linux/fsnotify_backend.h>",
            "#include <linux/atomic.h>",
            "#include <linux/srcu.h>",
            "#include <linux/spinlock.h>",
            "#include <linux/slab.h>",
            "#include <linux/mutex.h>",
            "#include <linux/module.h>",
            "#include <linux/kthread.h>",
            "#include <linux/kernel.h>",
            "#include <linux/init.h>",
            "#include <linux/fs.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"fsnotify.h\"\n#include <linux/fsnotify_backend.h>\n#include <linux/atomic.h>\n#include <linux/srcu.h>\n#include <linux/spinlock.h>\n#include <linux/slab.h>\n#include <linux/mutex.h>\n#include <linux/module.h>\n#include <linux/kthread.h>\n#include <linux/kernel.h>\n#include <linux/init.h>\n#include <linux/fs.h>\n\nu32 fsnotify_recalc_mask(struct hlist_head *head)\n{\n\tu32 new_mask = 0;\n\tstruct fsnotify_mark *mark;\n\n\thlist_for_each_entry(mark, head, obj_list)\n\t\tnew_mask |= mark->mask;\n\treturn new_mask;\n}"
        }
      },
      {
        "call_info": {
          "callee": "fsnotify_add_mark_list",
          "args": [
            "&m->mnt_fsnotify_marks",
            "mark",
            "allow_dups"
          ],
          "line": 122
        },
        "resolved": true,
        "details": {
          "function_name": "fsnotify_add_mark_list",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/notify/mark.c",
          "lines": "281-311",
          "snippet": "int fsnotify_add_mark_list(struct hlist_head *head, struct fsnotify_mark *mark,\n\t\t\t   int allow_dups)\n{\n\tstruct fsnotify_mark *lmark, *last = NULL;\n\tint cmp;\n\n\t/* is mark the first mark? */\n\tif (hlist_empty(head)) {\n\t\thlist_add_head_rcu(&mark->obj_list, head);\n\t\treturn 0;\n\t}\n\n\t/* should mark be in the middle of the current list? */\n\thlist_for_each_entry(lmark, head, obj_list) {\n\t\tlast = lmark;\n\n\t\tif ((lmark->group == mark->group) && !allow_dups)\n\t\t\treturn -EEXIST;\n\n\t\tcmp = fsnotify_compare_groups(lmark->group, mark->group);\n\t\tif (cmp >= 0) {\n\t\t\thlist_add_before_rcu(&mark->obj_list, &lmark->obj_list);\n\t\t\treturn 0;\n\t\t}\n\t}\n\n\tBUG_ON(last == NULL);\n\t/* mark should be the last entry.  last is the current last entry */\n\thlist_add_behind_rcu(&mark->obj_list, &last->obj_list);\n\treturn 0;\n}",
          "includes": [
            "#include \"fsnotify.h\"",
            "#include <linux/fsnotify_backend.h>",
            "#include <linux/atomic.h>",
            "#include <linux/srcu.h>",
            "#include <linux/spinlock.h>",
            "#include <linux/slab.h>",
            "#include <linux/mutex.h>",
            "#include <linux/module.h>",
            "#include <linux/kthread.h>",
            "#include <linux/kernel.h>",
            "#include <linux/init.h>",
            "#include <linux/fs.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"fsnotify.h\"\n#include <linux/fsnotify_backend.h>\n#include <linux/atomic.h>\n#include <linux/srcu.h>\n#include <linux/spinlock.h>\n#include <linux/slab.h>\n#include <linux/mutex.h>\n#include <linux/module.h>\n#include <linux/kthread.h>\n#include <linux/kernel.h>\n#include <linux/init.h>\n#include <linux/fs.h>\n\nint fsnotify_add_mark_list(struct hlist_head *head, struct fsnotify_mark *mark,\n\t\t\t   int allow_dups)\n{\n\tstruct fsnotify_mark *lmark, *last = NULL;\n\tint cmp;\n\n\t/* is mark the first mark? */\n\tif (hlist_empty(head)) {\n\t\thlist_add_head_rcu(&mark->obj_list, head);\n\t\treturn 0;\n\t}\n\n\t/* should mark be in the middle of the current list? */\n\thlist_for_each_entry(lmark, head, obj_list) {\n\t\tlast = lmark;\n\n\t\tif ((lmark->group == mark->group) && !allow_dups)\n\t\t\treturn -EEXIST;\n\n\t\tcmp = fsnotify_compare_groups(lmark->group, mark->group);\n\t\tif (cmp >= 0) {\n\t\t\thlist_add_before_rcu(&mark->obj_list, &lmark->obj_list);\n\t\t\treturn 0;\n\t\t}\n\t}\n\n\tBUG_ON(last == NULL);\n\t/* mark should be the last entry.  last is the current last entry */\n\thlist_add_behind_rcu(&mark->obj_list, &last->obj_list);\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "spin_lock",
          "args": [
            "&mnt->mnt_root->d_lock"
          ],
          "line": 120
        },
        "resolved": true,
        "details": {
          "function_name": "__spin_lock_mb_cache_entry",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/mbcache.c",
          "lines": "132-137",
          "snippet": "static inline void\n__spin_lock_mb_cache_entry(struct mb_cache_entry *ce)\n{\n\tspin_lock(bgl_lock_ptr(mb_cache_bg_lock,\n\t\tMB_CACHE_ENTRY_LOCK_INDEX(ce)));\n}",
          "includes": [
            "#include <linux/log2.h>",
            "#include <linux/blockgroup_lock.h>",
            "#include <linux/init.h>",
            "#include <linux/mbcache.h>",
            "#include <linux/list_bl.h>",
            "#include <linux/sched.h>",
            "#include <linux/slab.h>",
            "#include <linux/mm.h>",
            "#include <linux/fs.h>",
            "#include <linux/hash.h>",
            "#include <linux/module.h>",
            "#include <linux/kernel.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static struct blockgroup_lock *mb_cache_bg_lock;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <linux/log2.h>\n#include <linux/blockgroup_lock.h>\n#include <linux/init.h>\n#include <linux/mbcache.h>\n#include <linux/list_bl.h>\n#include <linux/sched.h>\n#include <linux/slab.h>\n#include <linux/mm.h>\n#include <linux/fs.h>\n#include <linux/hash.h>\n#include <linux/module.h>\n#include <linux/kernel.h>\n\nstatic struct blockgroup_lock *mb_cache_bg_lock;\n\nstatic inline void\n__spin_lock_mb_cache_entry(struct mb_cache_entry *ce)\n{\n\tspin_lock(bgl_lock_ptr(mb_cache_bg_lock,\n\t\tMB_CACHE_ENTRY_LOCK_INDEX(ce)));\n}"
        }
      },
      {
        "call_info": {
          "callee": "assert_spin_locked",
          "args": [
            "&mark->lock"
          ],
          "line": 118
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "BUG_ON",
          "args": [
            "!mutex_is_locked(&group->mark_mutex)"
          ],
          "line": 117
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "mutex_is_locked",
          "args": [
            "&group->mark_mutex"
          ],
          "line": 117
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "real_mount",
          "args": [
            "mnt"
          ],
          "line": 112
        },
        "resolved": true,
        "details": {
          "function_name": "real_mount",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/mount.h",
          "lines": "72-75",
          "snippet": "static inline struct mount *real_mount(struct vfsmount *mnt)\n{\n\treturn container_of(mnt, struct mount, mnt);\n}",
          "includes": [
            "#include <linux/fs_pin.h>",
            "#include <linux/ns_common.h>",
            "#include <linux/poll.h>",
            "#include <linux/seq_file.h>",
            "#include <linux/mount.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "extern bool legitimize_mnt(struct vfsmount *, unsigned);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <linux/fs_pin.h>\n#include <linux/ns_common.h>\n#include <linux/poll.h>\n#include <linux/seq_file.h>\n#include <linux/mount.h>\n\nextern bool legitimize_mnt(struct vfsmount *, unsigned);\n\nstatic inline struct mount *real_mount(struct vfsmount *mnt)\n{\n\treturn container_of(mnt, struct mount, mnt);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"../mount.h\"\n#include \"fsnotify.h\"\n#include <linux/fsnotify_backend.h>\n#include <linux/atomic.h>\n#include <linux/spinlock.h>\n#include <linux/mutex.h>\n#include <linux/mount.h>\n#include <linux/module.h>\n#include <linux/kernel.h>\n#include <linux/init.h>\n#include <linux/fs.h>\n\nint fsnotify_add_vfsmount_mark(struct fsnotify_mark *mark,\n\t\t\t       struct fsnotify_group *group, struct vfsmount *mnt,\n\t\t\t       int allow_dups)\n{\n\tstruct mount *m = real_mount(mnt);\n\tint ret;\n\n\tmark->flags |= FSNOTIFY_MARK_FLAG_VFSMOUNT;\n\n\tBUG_ON(!mutex_is_locked(&group->mark_mutex));\n\tassert_spin_locked(&mark->lock);\n\n\tspin_lock(&mnt->mnt_root->d_lock);\n\tmark->mnt = mnt;\n\tret = fsnotify_add_mark_list(&m->mnt_fsnotify_marks, mark, allow_dups);\n\tm->mnt_fsnotify_mask = fsnotify_recalc_mask(&m->mnt_fsnotify_marks);\n\tspin_unlock(&mnt->mnt_root->d_lock);\n\n\treturn ret;\n}"
  },
  {
    "function_name": "fsnotify_find_vfsmount_mark",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/notify/vfsmount_mark.c",
    "lines": "90-101",
    "snippet": "struct fsnotify_mark *fsnotify_find_vfsmount_mark(struct fsnotify_group *group,\n\t\t\t\t\t\t  struct vfsmount *mnt)\n{\n\tstruct mount *m = real_mount(mnt);\n\tstruct fsnotify_mark *mark;\n\n\tspin_lock(&mnt->mnt_root->d_lock);\n\tmark = fsnotify_find_mark(&m->mnt_fsnotify_marks, group);\n\tspin_unlock(&mnt->mnt_root->d_lock);\n\n\treturn mark;\n}",
    "includes": [
      "#include \"../mount.h\"",
      "#include \"fsnotify.h\"",
      "#include <linux/fsnotify_backend.h>",
      "#include <linux/atomic.h>",
      "#include <linux/spinlock.h>",
      "#include <linux/mutex.h>",
      "#include <linux/mount.h>",
      "#include <linux/module.h>",
      "#include <linux/kernel.h>",
      "#include <linux/init.h>",
      "#include <linux/fs.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "spin_unlock",
          "args": [
            "&mnt->mnt_root->d_lock"
          ],
          "line": 98
        },
        "resolved": true,
        "details": {
          "function_name": "__spin_unlock_mb_cache_entry",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/mbcache.c",
          "lines": "139-144",
          "snippet": "static inline void\n__spin_unlock_mb_cache_entry(struct mb_cache_entry *ce)\n{\n\tspin_unlock(bgl_lock_ptr(mb_cache_bg_lock,\n\t\tMB_CACHE_ENTRY_LOCK_INDEX(ce)));\n}",
          "includes": [
            "#include <linux/log2.h>",
            "#include <linux/blockgroup_lock.h>",
            "#include <linux/init.h>",
            "#include <linux/mbcache.h>",
            "#include <linux/list_bl.h>",
            "#include <linux/sched.h>",
            "#include <linux/slab.h>",
            "#include <linux/mm.h>",
            "#include <linux/fs.h>",
            "#include <linux/hash.h>",
            "#include <linux/module.h>",
            "#include <linux/kernel.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static struct blockgroup_lock *mb_cache_bg_lock;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <linux/log2.h>\n#include <linux/blockgroup_lock.h>\n#include <linux/init.h>\n#include <linux/mbcache.h>\n#include <linux/list_bl.h>\n#include <linux/sched.h>\n#include <linux/slab.h>\n#include <linux/mm.h>\n#include <linux/fs.h>\n#include <linux/hash.h>\n#include <linux/module.h>\n#include <linux/kernel.h>\n\nstatic struct blockgroup_lock *mb_cache_bg_lock;\n\nstatic inline void\n__spin_unlock_mb_cache_entry(struct mb_cache_entry *ce)\n{\n\tspin_unlock(bgl_lock_ptr(mb_cache_bg_lock,\n\t\tMB_CACHE_ENTRY_LOCK_INDEX(ce)));\n}"
        }
      },
      {
        "call_info": {
          "callee": "fsnotify_find_mark",
          "args": [
            "&m->mnt_fsnotify_marks",
            "group"
          ],
          "line": 97
        },
        "resolved": true,
        "details": {
          "function_name": "fsnotify_find_mark",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/notify/mark.c",
          "lines": "394-406",
          "snippet": "struct fsnotify_mark *fsnotify_find_mark(struct hlist_head *head,\n\t\t\t\t\t struct fsnotify_group *group)\n{\n\tstruct fsnotify_mark *mark;\n\n\thlist_for_each_entry(mark, head, obj_list) {\n\t\tif (mark->group == group) {\n\t\t\tfsnotify_get_mark(mark);\n\t\t\treturn mark;\n\t\t}\n\t}\n\treturn NULL;\n}",
          "includes": [
            "#include \"fsnotify.h\"",
            "#include <linux/fsnotify_backend.h>",
            "#include <linux/atomic.h>",
            "#include <linux/srcu.h>",
            "#include <linux/spinlock.h>",
            "#include <linux/slab.h>",
            "#include <linux/mutex.h>",
            "#include <linux/module.h>",
            "#include <linux/kthread.h>",
            "#include <linux/kernel.h>",
            "#include <linux/init.h>",
            "#include <linux/fs.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"fsnotify.h\"\n#include <linux/fsnotify_backend.h>\n#include <linux/atomic.h>\n#include <linux/srcu.h>\n#include <linux/spinlock.h>\n#include <linux/slab.h>\n#include <linux/mutex.h>\n#include <linux/module.h>\n#include <linux/kthread.h>\n#include <linux/kernel.h>\n#include <linux/init.h>\n#include <linux/fs.h>\n\nstruct fsnotify_mark *fsnotify_find_mark(struct hlist_head *head,\n\t\t\t\t\t struct fsnotify_group *group)\n{\n\tstruct fsnotify_mark *mark;\n\n\thlist_for_each_entry(mark, head, obj_list) {\n\t\tif (mark->group == group) {\n\t\t\tfsnotify_get_mark(mark);\n\t\t\treturn mark;\n\t\t}\n\t}\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "spin_lock",
          "args": [
            "&mnt->mnt_root->d_lock"
          ],
          "line": 96
        },
        "resolved": true,
        "details": {
          "function_name": "__spin_lock_mb_cache_entry",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/mbcache.c",
          "lines": "132-137",
          "snippet": "static inline void\n__spin_lock_mb_cache_entry(struct mb_cache_entry *ce)\n{\n\tspin_lock(bgl_lock_ptr(mb_cache_bg_lock,\n\t\tMB_CACHE_ENTRY_LOCK_INDEX(ce)));\n}",
          "includes": [
            "#include <linux/log2.h>",
            "#include <linux/blockgroup_lock.h>",
            "#include <linux/init.h>",
            "#include <linux/mbcache.h>",
            "#include <linux/list_bl.h>",
            "#include <linux/sched.h>",
            "#include <linux/slab.h>",
            "#include <linux/mm.h>",
            "#include <linux/fs.h>",
            "#include <linux/hash.h>",
            "#include <linux/module.h>",
            "#include <linux/kernel.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static struct blockgroup_lock *mb_cache_bg_lock;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <linux/log2.h>\n#include <linux/blockgroup_lock.h>\n#include <linux/init.h>\n#include <linux/mbcache.h>\n#include <linux/list_bl.h>\n#include <linux/sched.h>\n#include <linux/slab.h>\n#include <linux/mm.h>\n#include <linux/fs.h>\n#include <linux/hash.h>\n#include <linux/module.h>\n#include <linux/kernel.h>\n\nstatic struct blockgroup_lock *mb_cache_bg_lock;\n\nstatic inline void\n__spin_lock_mb_cache_entry(struct mb_cache_entry *ce)\n{\n\tspin_lock(bgl_lock_ptr(mb_cache_bg_lock,\n\t\tMB_CACHE_ENTRY_LOCK_INDEX(ce)));\n}"
        }
      },
      {
        "call_info": {
          "callee": "real_mount",
          "args": [
            "mnt"
          ],
          "line": 93
        },
        "resolved": true,
        "details": {
          "function_name": "real_mount",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/mount.h",
          "lines": "72-75",
          "snippet": "static inline struct mount *real_mount(struct vfsmount *mnt)\n{\n\treturn container_of(mnt, struct mount, mnt);\n}",
          "includes": [
            "#include <linux/fs_pin.h>",
            "#include <linux/ns_common.h>",
            "#include <linux/poll.h>",
            "#include <linux/seq_file.h>",
            "#include <linux/mount.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "extern bool legitimize_mnt(struct vfsmount *, unsigned);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <linux/fs_pin.h>\n#include <linux/ns_common.h>\n#include <linux/poll.h>\n#include <linux/seq_file.h>\n#include <linux/mount.h>\n\nextern bool legitimize_mnt(struct vfsmount *, unsigned);\n\nstatic inline struct mount *real_mount(struct vfsmount *mnt)\n{\n\treturn container_of(mnt, struct mount, mnt);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"../mount.h\"\n#include \"fsnotify.h\"\n#include <linux/fsnotify_backend.h>\n#include <linux/atomic.h>\n#include <linux/spinlock.h>\n#include <linux/mutex.h>\n#include <linux/mount.h>\n#include <linux/module.h>\n#include <linux/kernel.h>\n#include <linux/init.h>\n#include <linux/fs.h>\n\nstruct fsnotify_mark *fsnotify_find_vfsmount_mark(struct fsnotify_group *group,\n\t\t\t\t\t\t  struct vfsmount *mnt)\n{\n\tstruct mount *m = real_mount(mnt);\n\tstruct fsnotify_mark *mark;\n\n\tspin_lock(&mnt->mnt_root->d_lock);\n\tmark = fsnotify_find_mark(&m->mnt_fsnotify_marks, group);\n\tspin_unlock(&mnt->mnt_root->d_lock);\n\n\treturn mark;\n}"
  },
  {
    "function_name": "fsnotify_destroy_vfsmount_mark",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/notify/vfsmount_mark.c",
    "lines": "69-84",
    "snippet": "void fsnotify_destroy_vfsmount_mark(struct fsnotify_mark *mark)\n{\n\tstruct vfsmount *mnt = mark->mnt;\n\tstruct mount *m = real_mount(mnt);\n\n\tBUG_ON(!mutex_is_locked(&mark->group->mark_mutex));\n\tassert_spin_locked(&mark->lock);\n\n\tspin_lock(&mnt->mnt_root->d_lock);\n\n\thlist_del_init_rcu(&mark->obj_list);\n\tmark->mnt = NULL;\n\n\tm->mnt_fsnotify_mask = fsnotify_recalc_mask(&m->mnt_fsnotify_marks);\n\tspin_unlock(&mnt->mnt_root->d_lock);\n}",
    "includes": [
      "#include \"../mount.h\"",
      "#include \"fsnotify.h\"",
      "#include <linux/fsnotify_backend.h>",
      "#include <linux/atomic.h>",
      "#include <linux/spinlock.h>",
      "#include <linux/mutex.h>",
      "#include <linux/mount.h>",
      "#include <linux/module.h>",
      "#include <linux/kernel.h>",
      "#include <linux/init.h>",
      "#include <linux/fs.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "spin_unlock",
          "args": [
            "&mnt->mnt_root->d_lock"
          ],
          "line": 83
        },
        "resolved": true,
        "details": {
          "function_name": "__spin_unlock_mb_cache_entry",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/mbcache.c",
          "lines": "139-144",
          "snippet": "static inline void\n__spin_unlock_mb_cache_entry(struct mb_cache_entry *ce)\n{\n\tspin_unlock(bgl_lock_ptr(mb_cache_bg_lock,\n\t\tMB_CACHE_ENTRY_LOCK_INDEX(ce)));\n}",
          "includes": [
            "#include <linux/log2.h>",
            "#include <linux/blockgroup_lock.h>",
            "#include <linux/init.h>",
            "#include <linux/mbcache.h>",
            "#include <linux/list_bl.h>",
            "#include <linux/sched.h>",
            "#include <linux/slab.h>",
            "#include <linux/mm.h>",
            "#include <linux/fs.h>",
            "#include <linux/hash.h>",
            "#include <linux/module.h>",
            "#include <linux/kernel.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static struct blockgroup_lock *mb_cache_bg_lock;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <linux/log2.h>\n#include <linux/blockgroup_lock.h>\n#include <linux/init.h>\n#include <linux/mbcache.h>\n#include <linux/list_bl.h>\n#include <linux/sched.h>\n#include <linux/slab.h>\n#include <linux/mm.h>\n#include <linux/fs.h>\n#include <linux/hash.h>\n#include <linux/module.h>\n#include <linux/kernel.h>\n\nstatic struct blockgroup_lock *mb_cache_bg_lock;\n\nstatic inline void\n__spin_unlock_mb_cache_entry(struct mb_cache_entry *ce)\n{\n\tspin_unlock(bgl_lock_ptr(mb_cache_bg_lock,\n\t\tMB_CACHE_ENTRY_LOCK_INDEX(ce)));\n}"
        }
      },
      {
        "call_info": {
          "callee": "fsnotify_recalc_mask",
          "args": [
            "&m->mnt_fsnotify_marks"
          ],
          "line": 82
        },
        "resolved": true,
        "details": {
          "function_name": "fsnotify_recalc_mask",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/notify/mark.c",
          "lines": "114-122",
          "snippet": "u32 fsnotify_recalc_mask(struct hlist_head *head)\n{\n\tu32 new_mask = 0;\n\tstruct fsnotify_mark *mark;\n\n\thlist_for_each_entry(mark, head, obj_list)\n\t\tnew_mask |= mark->mask;\n\treturn new_mask;\n}",
          "includes": [
            "#include \"fsnotify.h\"",
            "#include <linux/fsnotify_backend.h>",
            "#include <linux/atomic.h>",
            "#include <linux/srcu.h>",
            "#include <linux/spinlock.h>",
            "#include <linux/slab.h>",
            "#include <linux/mutex.h>",
            "#include <linux/module.h>",
            "#include <linux/kthread.h>",
            "#include <linux/kernel.h>",
            "#include <linux/init.h>",
            "#include <linux/fs.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"fsnotify.h\"\n#include <linux/fsnotify_backend.h>\n#include <linux/atomic.h>\n#include <linux/srcu.h>\n#include <linux/spinlock.h>\n#include <linux/slab.h>\n#include <linux/mutex.h>\n#include <linux/module.h>\n#include <linux/kthread.h>\n#include <linux/kernel.h>\n#include <linux/init.h>\n#include <linux/fs.h>\n\nu32 fsnotify_recalc_mask(struct hlist_head *head)\n{\n\tu32 new_mask = 0;\n\tstruct fsnotify_mark *mark;\n\n\thlist_for_each_entry(mark, head, obj_list)\n\t\tnew_mask |= mark->mask;\n\treturn new_mask;\n}"
        }
      },
      {
        "call_info": {
          "callee": "hlist_del_init_rcu",
          "args": [
            "&mark->obj_list"
          ],
          "line": 79
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "spin_lock",
          "args": [
            "&mnt->mnt_root->d_lock"
          ],
          "line": 77
        },
        "resolved": true,
        "details": {
          "function_name": "__spin_lock_mb_cache_entry",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/mbcache.c",
          "lines": "132-137",
          "snippet": "static inline void\n__spin_lock_mb_cache_entry(struct mb_cache_entry *ce)\n{\n\tspin_lock(bgl_lock_ptr(mb_cache_bg_lock,\n\t\tMB_CACHE_ENTRY_LOCK_INDEX(ce)));\n}",
          "includes": [
            "#include <linux/log2.h>",
            "#include <linux/blockgroup_lock.h>",
            "#include <linux/init.h>",
            "#include <linux/mbcache.h>",
            "#include <linux/list_bl.h>",
            "#include <linux/sched.h>",
            "#include <linux/slab.h>",
            "#include <linux/mm.h>",
            "#include <linux/fs.h>",
            "#include <linux/hash.h>",
            "#include <linux/module.h>",
            "#include <linux/kernel.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static struct blockgroup_lock *mb_cache_bg_lock;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <linux/log2.h>\n#include <linux/blockgroup_lock.h>\n#include <linux/init.h>\n#include <linux/mbcache.h>\n#include <linux/list_bl.h>\n#include <linux/sched.h>\n#include <linux/slab.h>\n#include <linux/mm.h>\n#include <linux/fs.h>\n#include <linux/hash.h>\n#include <linux/module.h>\n#include <linux/kernel.h>\n\nstatic struct blockgroup_lock *mb_cache_bg_lock;\n\nstatic inline void\n__spin_lock_mb_cache_entry(struct mb_cache_entry *ce)\n{\n\tspin_lock(bgl_lock_ptr(mb_cache_bg_lock,\n\t\tMB_CACHE_ENTRY_LOCK_INDEX(ce)));\n}"
        }
      },
      {
        "call_info": {
          "callee": "assert_spin_locked",
          "args": [
            "&mark->lock"
          ],
          "line": 75
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "BUG_ON",
          "args": [
            "!mutex_is_locked(&mark->group->mark_mutex)"
          ],
          "line": 74
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "mutex_is_locked",
          "args": [
            "&mark->group->mark_mutex"
          ],
          "line": 74
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "real_mount",
          "args": [
            "mnt"
          ],
          "line": 72
        },
        "resolved": true,
        "details": {
          "function_name": "real_mount",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/mount.h",
          "lines": "72-75",
          "snippet": "static inline struct mount *real_mount(struct vfsmount *mnt)\n{\n\treturn container_of(mnt, struct mount, mnt);\n}",
          "includes": [
            "#include <linux/fs_pin.h>",
            "#include <linux/ns_common.h>",
            "#include <linux/poll.h>",
            "#include <linux/seq_file.h>",
            "#include <linux/mount.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "extern bool legitimize_mnt(struct vfsmount *, unsigned);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <linux/fs_pin.h>\n#include <linux/ns_common.h>\n#include <linux/poll.h>\n#include <linux/seq_file.h>\n#include <linux/mount.h>\n\nextern bool legitimize_mnt(struct vfsmount *, unsigned);\n\nstatic inline struct mount *real_mount(struct vfsmount *mnt)\n{\n\treturn container_of(mnt, struct mount, mnt);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"../mount.h\"\n#include \"fsnotify.h\"\n#include <linux/fsnotify_backend.h>\n#include <linux/atomic.h>\n#include <linux/spinlock.h>\n#include <linux/mutex.h>\n#include <linux/mount.h>\n#include <linux/module.h>\n#include <linux/kernel.h>\n#include <linux/init.h>\n#include <linux/fs.h>\n\nvoid fsnotify_destroy_vfsmount_mark(struct fsnotify_mark *mark)\n{\n\tstruct vfsmount *mnt = mark->mnt;\n\tstruct mount *m = real_mount(mnt);\n\n\tBUG_ON(!mutex_is_locked(&mark->group->mark_mutex));\n\tassert_spin_locked(&mark->lock);\n\n\tspin_lock(&mnt->mnt_root->d_lock);\n\n\thlist_del_init_rcu(&mark->obj_list);\n\tmark->mnt = NULL;\n\n\tm->mnt_fsnotify_mask = fsnotify_recalc_mask(&m->mnt_fsnotify_marks);\n\tspin_unlock(&mnt->mnt_root->d_lock);\n}"
  },
  {
    "function_name": "fsnotify_recalc_vfsmount_mask",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/notify/vfsmount_mark.c",
    "lines": "60-67",
    "snippet": "void fsnotify_recalc_vfsmount_mask(struct vfsmount *mnt)\n{\n\tstruct mount *m = real_mount(mnt);\n\n\tspin_lock(&mnt->mnt_root->d_lock);\n\tm->mnt_fsnotify_mask = fsnotify_recalc_mask(&m->mnt_fsnotify_marks);\n\tspin_unlock(&mnt->mnt_root->d_lock);\n}",
    "includes": [
      "#include \"../mount.h\"",
      "#include \"fsnotify.h\"",
      "#include <linux/fsnotify_backend.h>",
      "#include <linux/atomic.h>",
      "#include <linux/spinlock.h>",
      "#include <linux/mutex.h>",
      "#include <linux/mount.h>",
      "#include <linux/module.h>",
      "#include <linux/kernel.h>",
      "#include <linux/init.h>",
      "#include <linux/fs.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "spin_unlock",
          "args": [
            "&mnt->mnt_root->d_lock"
          ],
          "line": 66
        },
        "resolved": true,
        "details": {
          "function_name": "__spin_unlock_mb_cache_entry",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/mbcache.c",
          "lines": "139-144",
          "snippet": "static inline void\n__spin_unlock_mb_cache_entry(struct mb_cache_entry *ce)\n{\n\tspin_unlock(bgl_lock_ptr(mb_cache_bg_lock,\n\t\tMB_CACHE_ENTRY_LOCK_INDEX(ce)));\n}",
          "includes": [
            "#include <linux/log2.h>",
            "#include <linux/blockgroup_lock.h>",
            "#include <linux/init.h>",
            "#include <linux/mbcache.h>",
            "#include <linux/list_bl.h>",
            "#include <linux/sched.h>",
            "#include <linux/slab.h>",
            "#include <linux/mm.h>",
            "#include <linux/fs.h>",
            "#include <linux/hash.h>",
            "#include <linux/module.h>",
            "#include <linux/kernel.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static struct blockgroup_lock *mb_cache_bg_lock;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <linux/log2.h>\n#include <linux/blockgroup_lock.h>\n#include <linux/init.h>\n#include <linux/mbcache.h>\n#include <linux/list_bl.h>\n#include <linux/sched.h>\n#include <linux/slab.h>\n#include <linux/mm.h>\n#include <linux/fs.h>\n#include <linux/hash.h>\n#include <linux/module.h>\n#include <linux/kernel.h>\n\nstatic struct blockgroup_lock *mb_cache_bg_lock;\n\nstatic inline void\n__spin_unlock_mb_cache_entry(struct mb_cache_entry *ce)\n{\n\tspin_unlock(bgl_lock_ptr(mb_cache_bg_lock,\n\t\tMB_CACHE_ENTRY_LOCK_INDEX(ce)));\n}"
        }
      },
      {
        "call_info": {
          "callee": "fsnotify_recalc_mask",
          "args": [
            "&m->mnt_fsnotify_marks"
          ],
          "line": 65
        },
        "resolved": true,
        "details": {
          "function_name": "fsnotify_recalc_mask",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/notify/mark.c",
          "lines": "114-122",
          "snippet": "u32 fsnotify_recalc_mask(struct hlist_head *head)\n{\n\tu32 new_mask = 0;\n\tstruct fsnotify_mark *mark;\n\n\thlist_for_each_entry(mark, head, obj_list)\n\t\tnew_mask |= mark->mask;\n\treturn new_mask;\n}",
          "includes": [
            "#include \"fsnotify.h\"",
            "#include <linux/fsnotify_backend.h>",
            "#include <linux/atomic.h>",
            "#include <linux/srcu.h>",
            "#include <linux/spinlock.h>",
            "#include <linux/slab.h>",
            "#include <linux/mutex.h>",
            "#include <linux/module.h>",
            "#include <linux/kthread.h>",
            "#include <linux/kernel.h>",
            "#include <linux/init.h>",
            "#include <linux/fs.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"fsnotify.h\"\n#include <linux/fsnotify_backend.h>\n#include <linux/atomic.h>\n#include <linux/srcu.h>\n#include <linux/spinlock.h>\n#include <linux/slab.h>\n#include <linux/mutex.h>\n#include <linux/module.h>\n#include <linux/kthread.h>\n#include <linux/kernel.h>\n#include <linux/init.h>\n#include <linux/fs.h>\n\nu32 fsnotify_recalc_mask(struct hlist_head *head)\n{\n\tu32 new_mask = 0;\n\tstruct fsnotify_mark *mark;\n\n\thlist_for_each_entry(mark, head, obj_list)\n\t\tnew_mask |= mark->mask;\n\treturn new_mask;\n}"
        }
      },
      {
        "call_info": {
          "callee": "spin_lock",
          "args": [
            "&mnt->mnt_root->d_lock"
          ],
          "line": 64
        },
        "resolved": true,
        "details": {
          "function_name": "__spin_lock_mb_cache_entry",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/mbcache.c",
          "lines": "132-137",
          "snippet": "static inline void\n__spin_lock_mb_cache_entry(struct mb_cache_entry *ce)\n{\n\tspin_lock(bgl_lock_ptr(mb_cache_bg_lock,\n\t\tMB_CACHE_ENTRY_LOCK_INDEX(ce)));\n}",
          "includes": [
            "#include <linux/log2.h>",
            "#include <linux/blockgroup_lock.h>",
            "#include <linux/init.h>",
            "#include <linux/mbcache.h>",
            "#include <linux/list_bl.h>",
            "#include <linux/sched.h>",
            "#include <linux/slab.h>",
            "#include <linux/mm.h>",
            "#include <linux/fs.h>",
            "#include <linux/hash.h>",
            "#include <linux/module.h>",
            "#include <linux/kernel.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static struct blockgroup_lock *mb_cache_bg_lock;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <linux/log2.h>\n#include <linux/blockgroup_lock.h>\n#include <linux/init.h>\n#include <linux/mbcache.h>\n#include <linux/list_bl.h>\n#include <linux/sched.h>\n#include <linux/slab.h>\n#include <linux/mm.h>\n#include <linux/fs.h>\n#include <linux/hash.h>\n#include <linux/module.h>\n#include <linux/kernel.h>\n\nstatic struct blockgroup_lock *mb_cache_bg_lock;\n\nstatic inline void\n__spin_lock_mb_cache_entry(struct mb_cache_entry *ce)\n{\n\tspin_lock(bgl_lock_ptr(mb_cache_bg_lock,\n\t\tMB_CACHE_ENTRY_LOCK_INDEX(ce)));\n}"
        }
      },
      {
        "call_info": {
          "callee": "real_mount",
          "args": [
            "mnt"
          ],
          "line": 62
        },
        "resolved": true,
        "details": {
          "function_name": "real_mount",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/mount.h",
          "lines": "72-75",
          "snippet": "static inline struct mount *real_mount(struct vfsmount *mnt)\n{\n\treturn container_of(mnt, struct mount, mnt);\n}",
          "includes": [
            "#include <linux/fs_pin.h>",
            "#include <linux/ns_common.h>",
            "#include <linux/poll.h>",
            "#include <linux/seq_file.h>",
            "#include <linux/mount.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "extern bool legitimize_mnt(struct vfsmount *, unsigned);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <linux/fs_pin.h>\n#include <linux/ns_common.h>\n#include <linux/poll.h>\n#include <linux/seq_file.h>\n#include <linux/mount.h>\n\nextern bool legitimize_mnt(struct vfsmount *, unsigned);\n\nstatic inline struct mount *real_mount(struct vfsmount *mnt)\n{\n\treturn container_of(mnt, struct mount, mnt);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"../mount.h\"\n#include \"fsnotify.h\"\n#include <linux/fsnotify_backend.h>\n#include <linux/atomic.h>\n#include <linux/spinlock.h>\n#include <linux/mutex.h>\n#include <linux/mount.h>\n#include <linux/module.h>\n#include <linux/kernel.h>\n#include <linux/init.h>\n#include <linux/fs.h>\n\nvoid fsnotify_recalc_vfsmount_mask(struct vfsmount *mnt)\n{\n\tstruct mount *m = real_mount(mnt);\n\n\tspin_lock(&mnt->mnt_root->d_lock);\n\tm->mnt_fsnotify_mask = fsnotify_recalc_mask(&m->mnt_fsnotify_marks);\n\tspin_unlock(&mnt->mnt_root->d_lock);\n}"
  },
  {
    "function_name": "fsnotify_clear_vfsmount_marks_by_group",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/notify/vfsmount_mark.c",
    "lines": "51-54",
    "snippet": "void fsnotify_clear_vfsmount_marks_by_group(struct fsnotify_group *group)\n{\n\tfsnotify_clear_marks_by_group_flags(group, FSNOTIFY_MARK_FLAG_VFSMOUNT);\n}",
    "includes": [
      "#include \"../mount.h\"",
      "#include \"fsnotify.h\"",
      "#include <linux/fsnotify_backend.h>",
      "#include <linux/atomic.h>",
      "#include <linux/spinlock.h>",
      "#include <linux/mutex.h>",
      "#include <linux/mount.h>",
      "#include <linux/module.h>",
      "#include <linux/kernel.h>",
      "#include <linux/init.h>",
      "#include <linux/fs.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "fsnotify_clear_marks_by_group_flags",
          "args": [
            "group",
            "FSNOTIFY_MARK_FLAG_VFSMOUNT"
          ],
          "line": 53
        },
        "resolved": true,
        "details": {
          "function_name": "fsnotify_clear_marks_by_group_flags",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/notify/mark.c",
          "lines": "411-425",
          "snippet": "void fsnotify_clear_marks_by_group_flags(struct fsnotify_group *group,\n\t\t\t\t\t unsigned int flags)\n{\n\tstruct fsnotify_mark *lmark, *mark;\n\n\tmutex_lock_nested(&group->mark_mutex, SINGLE_DEPTH_NESTING);\n\tlist_for_each_entry_safe(mark, lmark, &group->marks_list, g_list) {\n\t\tif (mark->flags & flags) {\n\t\t\tfsnotify_get_mark(mark);\n\t\t\tfsnotify_destroy_mark_locked(mark, group);\n\t\t\tfsnotify_put_mark(mark);\n\t\t}\n\t}\n\tmutex_unlock(&group->mark_mutex);\n}",
          "includes": [
            "#include \"fsnotify.h\"",
            "#include <linux/fsnotify_backend.h>",
            "#include <linux/atomic.h>",
            "#include <linux/srcu.h>",
            "#include <linux/spinlock.h>",
            "#include <linux/slab.h>",
            "#include <linux/mutex.h>",
            "#include <linux/module.h>",
            "#include <linux/kthread.h>",
            "#include <linux/kernel.h>",
            "#include <linux/init.h>",
            "#include <linux/fs.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"fsnotify.h\"\n#include <linux/fsnotify_backend.h>\n#include <linux/atomic.h>\n#include <linux/srcu.h>\n#include <linux/spinlock.h>\n#include <linux/slab.h>\n#include <linux/mutex.h>\n#include <linux/module.h>\n#include <linux/kthread.h>\n#include <linux/kernel.h>\n#include <linux/init.h>\n#include <linux/fs.h>\n\nvoid fsnotify_clear_marks_by_group_flags(struct fsnotify_group *group,\n\t\t\t\t\t unsigned int flags)\n{\n\tstruct fsnotify_mark *lmark, *mark;\n\n\tmutex_lock_nested(&group->mark_mutex, SINGLE_DEPTH_NESTING);\n\tlist_for_each_entry_safe(mark, lmark, &group->marks_list, g_list) {\n\t\tif (mark->flags & flags) {\n\t\t\tfsnotify_get_mark(mark);\n\t\t\tfsnotify_destroy_mark_locked(mark, group);\n\t\t\tfsnotify_put_mark(mark);\n\t\t}\n\t}\n\tmutex_unlock(&group->mark_mutex);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"../mount.h\"\n#include \"fsnotify.h\"\n#include <linux/fsnotify_backend.h>\n#include <linux/atomic.h>\n#include <linux/spinlock.h>\n#include <linux/mutex.h>\n#include <linux/mount.h>\n#include <linux/module.h>\n#include <linux/kernel.h>\n#include <linux/init.h>\n#include <linux/fs.h>\n\nvoid fsnotify_clear_vfsmount_marks_by_group(struct fsnotify_group *group)\n{\n\tfsnotify_clear_marks_by_group_flags(group, FSNOTIFY_MARK_FLAG_VFSMOUNT);\n}"
  },
  {
    "function_name": "fsnotify_clear_marks_by_mount",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/notify/vfsmount_mark.c",
    "lines": "33-49",
    "snippet": "void fsnotify_clear_marks_by_mount(struct vfsmount *mnt)\n{\n\tstruct fsnotify_mark *mark;\n\tstruct hlist_node *n;\n\tstruct mount *m = real_mount(mnt);\n\tLIST_HEAD(free_list);\n\n\tspin_lock(&mnt->mnt_root->d_lock);\n\thlist_for_each_entry_safe(mark, n, &m->mnt_fsnotify_marks, obj_list) {\n\t\tlist_add(&mark->free_list, &free_list);\n\t\thlist_del_init_rcu(&mark->obj_list);\n\t\tfsnotify_get_mark(mark);\n\t}\n\tspin_unlock(&mnt->mnt_root->d_lock);\n\n\tfsnotify_destroy_marks(&free_list);\n}",
    "includes": [
      "#include \"../mount.h\"",
      "#include \"fsnotify.h\"",
      "#include <linux/fsnotify_backend.h>",
      "#include <linux/atomic.h>",
      "#include <linux/spinlock.h>",
      "#include <linux/mutex.h>",
      "#include <linux/mount.h>",
      "#include <linux/module.h>",
      "#include <linux/kernel.h>",
      "#include <linux/init.h>",
      "#include <linux/fs.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "fsnotify_destroy_marks",
          "args": [
            "&free_list"
          ],
          "line": 48
        },
        "resolved": true,
        "details": {
          "function_name": "fsnotify_destroy_marks",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/notify/mark.c",
          "lines": "210-225",
          "snippet": "void fsnotify_destroy_marks(struct list_head *to_free)\n{\n\tstruct fsnotify_mark *mark, *lmark;\n\tstruct fsnotify_group *group;\n\n\tlist_for_each_entry_safe(mark, lmark, to_free, free_list) {\n\t\tspin_lock(&mark->lock);\n\t\tfsnotify_get_group(mark->group);\n\t\tgroup = mark->group;\n\t\tspin_unlock(&mark->lock);\n\n\t\tfsnotify_destroy_mark(mark, group);\n\t\tfsnotify_put_mark(mark);\n\t\tfsnotify_put_group(group);\n\t}\n}",
          "includes": [
            "#include \"fsnotify.h\"",
            "#include <linux/fsnotify_backend.h>",
            "#include <linux/atomic.h>",
            "#include <linux/srcu.h>",
            "#include <linux/spinlock.h>",
            "#include <linux/slab.h>",
            "#include <linux/mutex.h>",
            "#include <linux/module.h>",
            "#include <linux/kthread.h>",
            "#include <linux/kernel.h>",
            "#include <linux/init.h>",
            "#include <linux/fs.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"fsnotify.h\"\n#include <linux/fsnotify_backend.h>\n#include <linux/atomic.h>\n#include <linux/srcu.h>\n#include <linux/spinlock.h>\n#include <linux/slab.h>\n#include <linux/mutex.h>\n#include <linux/module.h>\n#include <linux/kthread.h>\n#include <linux/kernel.h>\n#include <linux/init.h>\n#include <linux/fs.h>\n\nvoid fsnotify_destroy_marks(struct list_head *to_free)\n{\n\tstruct fsnotify_mark *mark, *lmark;\n\tstruct fsnotify_group *group;\n\n\tlist_for_each_entry_safe(mark, lmark, to_free, free_list) {\n\t\tspin_lock(&mark->lock);\n\t\tfsnotify_get_group(mark->group);\n\t\tgroup = mark->group;\n\t\tspin_unlock(&mark->lock);\n\n\t\tfsnotify_destroy_mark(mark, group);\n\t\tfsnotify_put_mark(mark);\n\t\tfsnotify_put_group(group);\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "spin_unlock",
          "args": [
            "&mnt->mnt_root->d_lock"
          ],
          "line": 46
        },
        "resolved": true,
        "details": {
          "function_name": "__spin_unlock_mb_cache_entry",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/mbcache.c",
          "lines": "139-144",
          "snippet": "static inline void\n__spin_unlock_mb_cache_entry(struct mb_cache_entry *ce)\n{\n\tspin_unlock(bgl_lock_ptr(mb_cache_bg_lock,\n\t\tMB_CACHE_ENTRY_LOCK_INDEX(ce)));\n}",
          "includes": [
            "#include <linux/log2.h>",
            "#include <linux/blockgroup_lock.h>",
            "#include <linux/init.h>",
            "#include <linux/mbcache.h>",
            "#include <linux/list_bl.h>",
            "#include <linux/sched.h>",
            "#include <linux/slab.h>",
            "#include <linux/mm.h>",
            "#include <linux/fs.h>",
            "#include <linux/hash.h>",
            "#include <linux/module.h>",
            "#include <linux/kernel.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static struct blockgroup_lock *mb_cache_bg_lock;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <linux/log2.h>\n#include <linux/blockgroup_lock.h>\n#include <linux/init.h>\n#include <linux/mbcache.h>\n#include <linux/list_bl.h>\n#include <linux/sched.h>\n#include <linux/slab.h>\n#include <linux/mm.h>\n#include <linux/fs.h>\n#include <linux/hash.h>\n#include <linux/module.h>\n#include <linux/kernel.h>\n\nstatic struct blockgroup_lock *mb_cache_bg_lock;\n\nstatic inline void\n__spin_unlock_mb_cache_entry(struct mb_cache_entry *ce)\n{\n\tspin_unlock(bgl_lock_ptr(mb_cache_bg_lock,\n\t\tMB_CACHE_ENTRY_LOCK_INDEX(ce)));\n}"
        }
      },
      {
        "call_info": {
          "callee": "fsnotify_get_mark",
          "args": [
            "mark"
          ],
          "line": 44
        },
        "resolved": true,
        "details": {
          "function_name": "fsnotify_get_mark",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/notify/mark.c",
          "lines": "99-102",
          "snippet": "void fsnotify_get_mark(struct fsnotify_mark *mark)\n{\n\tatomic_inc(&mark->refcnt);\n}",
          "includes": [
            "#include \"fsnotify.h\"",
            "#include <linux/fsnotify_backend.h>",
            "#include <linux/atomic.h>",
            "#include <linux/srcu.h>",
            "#include <linux/spinlock.h>",
            "#include <linux/slab.h>",
            "#include <linux/mutex.h>",
            "#include <linux/module.h>",
            "#include <linux/kthread.h>",
            "#include <linux/kernel.h>",
            "#include <linux/init.h>",
            "#include <linux/fs.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"fsnotify.h\"\n#include <linux/fsnotify_backend.h>\n#include <linux/atomic.h>\n#include <linux/srcu.h>\n#include <linux/spinlock.h>\n#include <linux/slab.h>\n#include <linux/mutex.h>\n#include <linux/module.h>\n#include <linux/kthread.h>\n#include <linux/kernel.h>\n#include <linux/init.h>\n#include <linux/fs.h>\n\nvoid fsnotify_get_mark(struct fsnotify_mark *mark)\n{\n\tatomic_inc(&mark->refcnt);\n}"
        }
      },
      {
        "call_info": {
          "callee": "hlist_del_init_rcu",
          "args": [
            "&mark->obj_list"
          ],
          "line": 43
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "list_add",
          "args": [
            "&mark->free_list",
            "&free_list"
          ],
          "line": 42
        },
        "resolved": true,
        "details": {
          "function_name": "simple_xattr_list_add",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/xattr.c",
          "lines": "966-972",
          "snippet": "void simple_xattr_list_add(struct simple_xattrs *xattrs,\n\t\t\t   struct simple_xattr *new_xattr)\n{\n\tspin_lock(&xattrs->lock);\n\tlist_add(&new_xattr->list, &xattrs->head);\n\tspin_unlock(&xattrs->lock);\n}",
          "includes": [
            "#include <asm/uaccess.h>",
            "#include <linux/posix_acl_xattr.h>",
            "#include <linux/vmalloc.h>",
            "#include <linux/audit.h>",
            "#include <linux/fsnotify.h>",
            "#include <linux/export.h>",
            "#include <linux/syscalls.h>",
            "#include <linux/evm.h>",
            "#include <linux/security.h>",
            "#include <linux/namei.h>",
            "#include <linux/mount.h>",
            "#include <linux/xattr.h>",
            "#include <linux/file.h>",
            "#include <linux/slab.h>",
            "#include <linux/fs.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <asm/uaccess.h>\n#include <linux/posix_acl_xattr.h>\n#include <linux/vmalloc.h>\n#include <linux/audit.h>\n#include <linux/fsnotify.h>\n#include <linux/export.h>\n#include <linux/syscalls.h>\n#include <linux/evm.h>\n#include <linux/security.h>\n#include <linux/namei.h>\n#include <linux/mount.h>\n#include <linux/xattr.h>\n#include <linux/file.h>\n#include <linux/slab.h>\n#include <linux/fs.h>\n\nvoid simple_xattr_list_add(struct simple_xattrs *xattrs,\n\t\t\t   struct simple_xattr *new_xattr)\n{\n\tspin_lock(&xattrs->lock);\n\tlist_add(&new_xattr->list, &xattrs->head);\n\tspin_unlock(&xattrs->lock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "hlist_for_each_entry_safe",
          "args": [
            "mark",
            "n",
            "&m->mnt_fsnotify_marks",
            "obj_list"
          ],
          "line": 41
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "spin_lock",
          "args": [
            "&mnt->mnt_root->d_lock"
          ],
          "line": 40
        },
        "resolved": true,
        "details": {
          "function_name": "__spin_lock_mb_cache_entry",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/mbcache.c",
          "lines": "132-137",
          "snippet": "static inline void\n__spin_lock_mb_cache_entry(struct mb_cache_entry *ce)\n{\n\tspin_lock(bgl_lock_ptr(mb_cache_bg_lock,\n\t\tMB_CACHE_ENTRY_LOCK_INDEX(ce)));\n}",
          "includes": [
            "#include <linux/log2.h>",
            "#include <linux/blockgroup_lock.h>",
            "#include <linux/init.h>",
            "#include <linux/mbcache.h>",
            "#include <linux/list_bl.h>",
            "#include <linux/sched.h>",
            "#include <linux/slab.h>",
            "#include <linux/mm.h>",
            "#include <linux/fs.h>",
            "#include <linux/hash.h>",
            "#include <linux/module.h>",
            "#include <linux/kernel.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static struct blockgroup_lock *mb_cache_bg_lock;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <linux/log2.h>\n#include <linux/blockgroup_lock.h>\n#include <linux/init.h>\n#include <linux/mbcache.h>\n#include <linux/list_bl.h>\n#include <linux/sched.h>\n#include <linux/slab.h>\n#include <linux/mm.h>\n#include <linux/fs.h>\n#include <linux/hash.h>\n#include <linux/module.h>\n#include <linux/kernel.h>\n\nstatic struct blockgroup_lock *mb_cache_bg_lock;\n\nstatic inline void\n__spin_lock_mb_cache_entry(struct mb_cache_entry *ce)\n{\n\tspin_lock(bgl_lock_ptr(mb_cache_bg_lock,\n\t\tMB_CACHE_ENTRY_LOCK_INDEX(ce)));\n}"
        }
      },
      {
        "call_info": {
          "callee": "LIST_HEAD",
          "args": [
            "free_list"
          ],
          "line": 38
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "real_mount",
          "args": [
            "mnt"
          ],
          "line": 37
        },
        "resolved": true,
        "details": {
          "function_name": "real_mount",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/mount.h",
          "lines": "72-75",
          "snippet": "static inline struct mount *real_mount(struct vfsmount *mnt)\n{\n\treturn container_of(mnt, struct mount, mnt);\n}",
          "includes": [
            "#include <linux/fs_pin.h>",
            "#include <linux/ns_common.h>",
            "#include <linux/poll.h>",
            "#include <linux/seq_file.h>",
            "#include <linux/mount.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "extern bool legitimize_mnt(struct vfsmount *, unsigned);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <linux/fs_pin.h>\n#include <linux/ns_common.h>\n#include <linux/poll.h>\n#include <linux/seq_file.h>\n#include <linux/mount.h>\n\nextern bool legitimize_mnt(struct vfsmount *, unsigned);\n\nstatic inline struct mount *real_mount(struct vfsmount *mnt)\n{\n\treturn container_of(mnt, struct mount, mnt);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"../mount.h\"\n#include \"fsnotify.h\"\n#include <linux/fsnotify_backend.h>\n#include <linux/atomic.h>\n#include <linux/spinlock.h>\n#include <linux/mutex.h>\n#include <linux/mount.h>\n#include <linux/module.h>\n#include <linux/kernel.h>\n#include <linux/init.h>\n#include <linux/fs.h>\n\nvoid fsnotify_clear_marks_by_mount(struct vfsmount *mnt)\n{\n\tstruct fsnotify_mark *mark;\n\tstruct hlist_node *n;\n\tstruct mount *m = real_mount(mnt);\n\tLIST_HEAD(free_list);\n\n\tspin_lock(&mnt->mnt_root->d_lock);\n\thlist_for_each_entry_safe(mark, n, &m->mnt_fsnotify_marks, obj_list) {\n\t\tlist_add(&mark->free_list, &free_list);\n\t\thlist_del_init_rcu(&mark->obj_list);\n\t\tfsnotify_get_mark(mark);\n\t}\n\tspin_unlock(&mnt->mnt_root->d_lock);\n\n\tfsnotify_destroy_marks(&free_list);\n}"
  }
]