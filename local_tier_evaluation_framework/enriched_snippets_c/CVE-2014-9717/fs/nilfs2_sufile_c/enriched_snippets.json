[
  {
    "function_name": "nilfs_sufile_read",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/sufile.c",
    "lines": "1162-1222",
    "snippet": "int nilfs_sufile_read(struct super_block *sb, size_t susize,\n\t\t      struct nilfs_inode *raw_inode, struct inode **inodep)\n{\n\tstruct inode *sufile;\n\tstruct nilfs_sufile_info *sui;\n\tstruct buffer_head *header_bh;\n\tstruct nilfs_sufile_header *header;\n\tvoid *kaddr;\n\tint err;\n\n\tif (susize > sb->s_blocksize) {\n\t\tprintk(KERN_ERR\n\t\t       \"NILFS: too large segment usage size: %zu bytes.\\n\",\n\t\t       susize);\n\t\treturn -EINVAL;\n\t} else if (susize < NILFS_MIN_SEGMENT_USAGE_SIZE) {\n\t\tprintk(KERN_ERR\n\t\t       \"NILFS: too small segment usage size: %zu bytes.\\n\",\n\t\t       susize);\n\t\treturn -EINVAL;\n\t}\n\n\tsufile = nilfs_iget_locked(sb, NULL, NILFS_SUFILE_INO);\n\tif (unlikely(!sufile))\n\t\treturn -ENOMEM;\n\tif (!(sufile->i_state & I_NEW))\n\t\tgoto out;\n\n\terr = nilfs_mdt_init(sufile, NILFS_MDT_GFP, sizeof(*sui));\n\tif (err)\n\t\tgoto failed;\n\n\tnilfs_mdt_set_entry_size(sufile, susize,\n\t\t\t\t sizeof(struct nilfs_sufile_header));\n\n\terr = nilfs_read_inode_common(sufile, raw_inode);\n\tif (err)\n\t\tgoto failed;\n\n\terr = nilfs_sufile_get_header_block(sufile, &header_bh);\n\tif (err)\n\t\tgoto failed;\n\n\tsui = NILFS_SUI(sufile);\n\tkaddr = kmap_atomic(header_bh->b_page);\n\theader = kaddr + bh_offset(header_bh);\n\tsui->ncleansegs = le64_to_cpu(header->sh_ncleansegs);\n\tkunmap_atomic(kaddr);\n\tbrelse(header_bh);\n\n\tsui->allocmax = nilfs_sufile_get_nsegments(sufile) - 1;\n\tsui->allocmin = 0;\n\n\tunlock_new_inode(sufile);\n out:\n\t*inodep = sufile;\n\treturn 0;\n failed:\n\tiget_failed(sufile);\n\treturn err;\n}",
    "includes": [
      "#include \"sufile.h\"",
      "#include \"mdt.h\"",
      "#include <linux/nilfs2_fs.h>",
      "#include <linux/errno.h>",
      "#include <linux/buffer_head.h>",
      "#include <linux/string.h>",
      "#include <linux/fs.h>",
      "#include <linux/kernel.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "iget_failed",
          "args": [
            "sufile"
          ],
          "line": 1220
        },
        "resolved": true,
        "details": {
          "function_name": "iget_failed",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/bad_inode.c",
          "lines": "208-213",
          "snippet": "void iget_failed(struct inode *inode)\n{\n\tmake_bad_inode(inode);\n\tunlock_new_inode(inode);\n\tiput(inode);\n}",
          "includes": [
            "#include <linux/poll.h>",
            "#include <linux/namei.h>",
            "#include <linux/time.h>",
            "#include <linux/stat.h>",
            "#include <linux/export.h>",
            "#include <linux/fs.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/poll.h>\n#include <linux/namei.h>\n#include <linux/time.h>\n#include <linux/stat.h>\n#include <linux/export.h>\n#include <linux/fs.h>\n\nvoid iget_failed(struct inode *inode)\n{\n\tmake_bad_inode(inode);\n\tunlock_new_inode(inode);\n\tiput(inode);\n}"
        }
      },
      {
        "call_info": {
          "callee": "unlock_new_inode",
          "args": [
            "sufile"
          ],
          "line": 1215
        },
        "resolved": true,
        "details": {
          "function_name": "unlock_new_inode",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/inode.c",
          "lines": "924-933",
          "snippet": "void unlock_new_inode(struct inode *inode)\n{\n\tlockdep_annotate_inode_mutex_key(inode);\n\tspin_lock(&inode->i_lock);\n\tWARN_ON(!(inode->i_state & I_NEW));\n\tinode->i_state &= ~I_NEW;\n\tsmp_mb();\n\twake_up_bit(&inode->i_state, __I_NEW);\n\tspin_unlock(&inode->i_lock);\n}",
          "includes": [
            "#include \"internal.h\"",
            "#include <trace/events/writeback.h>",
            "#include <linux/list_lru.h>",
            "#include <linux/ratelimit.h>",
            "#include <linux/buffer_head.h> /* for inode_has_buffers */",
            "#include <linux/prefetch.h>",
            "#include <linux/posix_acl.h>",
            "#include <linux/mount.h>",
            "#include <linux/fsnotify.h>",
            "#include <linux/bootmem.h>",
            "#include <linux/cdev.h>",
            "#include <linux/security.h>",
            "#include <linux/swap.h>",
            "#include <linux/hash.h>",
            "#include <linux/backing-dev.h>",
            "#include <linux/mm.h>",
            "#include <linux/fs.h>",
            "#include <linux/export.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void __wait_on_freeing_inode(struct inode *inode);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"internal.h\"\n#include <trace/events/writeback.h>\n#include <linux/list_lru.h>\n#include <linux/ratelimit.h>\n#include <linux/buffer_head.h> /* for inode_has_buffers */\n#include <linux/prefetch.h>\n#include <linux/posix_acl.h>\n#include <linux/mount.h>\n#include <linux/fsnotify.h>\n#include <linux/bootmem.h>\n#include <linux/cdev.h>\n#include <linux/security.h>\n#include <linux/swap.h>\n#include <linux/hash.h>\n#include <linux/backing-dev.h>\n#include <linux/mm.h>\n#include <linux/fs.h>\n#include <linux/export.h>\n\nstatic void __wait_on_freeing_inode(struct inode *inode);\n\nvoid unlock_new_inode(struct inode *inode)\n{\n\tlockdep_annotate_inode_mutex_key(inode);\n\tspin_lock(&inode->i_lock);\n\tWARN_ON(!(inode->i_state & I_NEW));\n\tinode->i_state &= ~I_NEW;\n\tsmp_mb();\n\twake_up_bit(&inode->i_state, __I_NEW);\n\tspin_unlock(&inode->i_lock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "nilfs_sufile_get_nsegments",
          "args": [
            "sufile"
          ],
          "line": 1212
        },
        "resolved": true,
        "details": {
          "function_name": "nilfs_sufile_get_nsegments",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/sufile.h",
          "lines": "32-35",
          "snippet": "static inline unsigned long nilfs_sufile_get_nsegments(struct inode *sufile)\n{\n\treturn ((struct the_nilfs *)sufile->i_sb->s_fs_info)->ns_nsegments;\n}",
          "includes": [
            "#include \"mdt.h\"",
            "#include <linux/nilfs2_fs.h>",
            "#include <linux/buffer_head.h>",
            "#include <linux/fs.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"mdt.h\"\n#include <linux/nilfs2_fs.h>\n#include <linux/buffer_head.h>\n#include <linux/fs.h>\n\nstatic inline unsigned long nilfs_sufile_get_nsegments(struct inode *sufile)\n{\n\treturn ((struct the_nilfs *)sufile->i_sb->s_fs_info)->ns_nsegments;\n}"
        }
      },
      {
        "call_info": {
          "callee": "brelse",
          "args": [
            "header_bh"
          ],
          "line": 1210
        },
        "resolved": true,
        "details": {
          "function_name": "__brelse",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/buffer.c",
          "lines": "1177-1184",
          "snippet": "void __brelse(struct buffer_head * buf)\n{\n\tif (atomic_read(&buf->b_count)) {\n\t\tput_bh(buf);\n\t\treturn;\n\t}\n\tWARN(1, KERN_ERR \"VFS: brelse: Trying to free free buffer\\n\");\n}",
          "includes": [
            "#include <trace/events/block.h>",
            "#include <linux/bit_spinlock.h>",
            "#include <linux/mpage.h>",
            "#include <linux/bitops.h>",
            "#include <linux/cpu.h>",
            "#include <linux/notifier.h>",
            "#include <linux/bio.h>",
            "#include <linux/task_io_accounting_ops.h>",
            "#include <linux/buffer_head.h>",
            "#include <linux/suspend.h>",
            "#include <linux/hash.h>",
            "#include <linux/writeback.h>",
            "#include <linux/export.h>",
            "#include <linux/highmem.h>",
            "#include <linux/quotaops.h>",
            "#include <linux/file.h>",
            "#include <linux/blkdev.h>",
            "#include <linux/capability.h>",
            "#include <linux/slab.h>",
            "#include <linux/percpu.h>",
            "#include <linux/mm.h>",
            "#include <linux/fs.h>",
            "#include <linux/syscalls.h>",
            "#include <linux/kernel.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <trace/events/block.h>\n#include <linux/bit_spinlock.h>\n#include <linux/mpage.h>\n#include <linux/bitops.h>\n#include <linux/cpu.h>\n#include <linux/notifier.h>\n#include <linux/bio.h>\n#include <linux/task_io_accounting_ops.h>\n#include <linux/buffer_head.h>\n#include <linux/suspend.h>\n#include <linux/hash.h>\n#include <linux/writeback.h>\n#include <linux/export.h>\n#include <linux/highmem.h>\n#include <linux/quotaops.h>\n#include <linux/file.h>\n#include <linux/blkdev.h>\n#include <linux/capability.h>\n#include <linux/slab.h>\n#include <linux/percpu.h>\n#include <linux/mm.h>\n#include <linux/fs.h>\n#include <linux/syscalls.h>\n#include <linux/kernel.h>\n\nvoid __brelse(struct buffer_head * buf)\n{\n\tif (atomic_read(&buf->b_count)) {\n\t\tput_bh(buf);\n\t\treturn;\n\t}\n\tWARN(1, KERN_ERR \"VFS: brelse: Trying to free free buffer\\n\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "kunmap_atomic",
          "args": [
            "kaddr"
          ],
          "line": 1209
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "le64_to_cpu",
          "args": [
            "header->sh_ncleansegs"
          ],
          "line": 1208
        },
        "resolved": true,
        "details": {
          "function_name": "sle64_to_cpup",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/ntfs/endian.h",
          "lines": "58-61",
          "snippet": "static inline s64 sle64_to_cpup(sle64 *x)\n{\n\treturn le64_to_cpu(*(__force le64*)x);\n}",
          "includes": [
            "#include \"types.h\"",
            "#include <asm/byteorder.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"types.h\"\n#include <asm/byteorder.h>\n\nstatic inline s64 sle64_to_cpup(sle64 *x)\n{\n\treturn le64_to_cpu(*(__force le64*)x);\n}"
        }
      },
      {
        "call_info": {
          "callee": "bh_offset",
          "args": [
            "header_bh"
          ],
          "line": 1207
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kmap_atomic",
          "args": [
            "header_bh->b_page"
          ],
          "line": 1206
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "NILFS_SUI",
          "args": [
            "sufile"
          ],
          "line": 1205
        },
        "resolved": true,
        "details": {
          "function_name": "NILFS_SUI",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/sufile.c",
          "lines": "47-50",
          "snippet": "static inline struct nilfs_sufile_info *NILFS_SUI(struct inode *sufile)\n{\n\treturn (struct nilfs_sufile_info *)NILFS_MDT(sufile);\n}",
          "includes": [
            "#include \"sufile.h\"",
            "#include \"mdt.h\"",
            "#include <linux/nilfs2_fs.h>",
            "#include <linux/errno.h>",
            "#include <linux/buffer_head.h>",
            "#include <linux/string.h>",
            "#include <linux/fs.h>",
            "#include <linux/kernel.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sufile.h\"\n#include \"mdt.h\"\n#include <linux/nilfs2_fs.h>\n#include <linux/errno.h>\n#include <linux/buffer_head.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n#include <linux/kernel.h>\n\nstatic inline struct nilfs_sufile_info *NILFS_SUI(struct inode *sufile)\n{\n\treturn (struct nilfs_sufile_info *)NILFS_MDT(sufile);\n}"
        }
      },
      {
        "call_info": {
          "callee": "nilfs_sufile_get_header_block",
          "args": [
            "sufile",
            "&header_bh"
          ],
          "line": 1201
        },
        "resolved": true,
        "details": {
          "function_name": "nilfs_sufile_get_header_block",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/sufile.c",
          "lines": "92-96",
          "snippet": "static inline int nilfs_sufile_get_header_block(struct inode *sufile,\n\t\t\t\t\t\tstruct buffer_head **bhp)\n{\n\treturn nilfs_mdt_get_block(sufile, 0, 0, NULL, bhp);\n}",
          "includes": [
            "#include \"sufile.h\"",
            "#include \"mdt.h\"",
            "#include <linux/nilfs2_fs.h>",
            "#include <linux/errno.h>",
            "#include <linux/buffer_head.h>",
            "#include <linux/string.h>",
            "#include <linux/fs.h>",
            "#include <linux/kernel.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sufile.h\"\n#include \"mdt.h\"\n#include <linux/nilfs2_fs.h>\n#include <linux/errno.h>\n#include <linux/buffer_head.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n#include <linux/kernel.h>\n\nstatic inline int nilfs_sufile_get_header_block(struct inode *sufile,\n\t\t\t\t\t\tstruct buffer_head **bhp)\n{\n\treturn nilfs_mdt_get_block(sufile, 0, 0, NULL, bhp);\n}"
        }
      },
      {
        "call_info": {
          "callee": "nilfs_read_inode_common",
          "args": [
            "sufile",
            "raw_inode"
          ],
          "line": 1197
        },
        "resolved": true,
        "details": {
          "function_name": "nilfs_read_inode_common",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/inode.c",
          "lines": "463-502",
          "snippet": "int nilfs_read_inode_common(struct inode *inode,\n\t\t\t    struct nilfs_inode *raw_inode)\n{\n\tstruct nilfs_inode_info *ii = NILFS_I(inode);\n\tint err;\n\n\tinode->i_mode = le16_to_cpu(raw_inode->i_mode);\n\ti_uid_write(inode, le32_to_cpu(raw_inode->i_uid));\n\ti_gid_write(inode, le32_to_cpu(raw_inode->i_gid));\n\tset_nlink(inode, le16_to_cpu(raw_inode->i_links_count));\n\tinode->i_size = le64_to_cpu(raw_inode->i_size);\n\tinode->i_atime.tv_sec = le64_to_cpu(raw_inode->i_mtime);\n\tinode->i_ctime.tv_sec = le64_to_cpu(raw_inode->i_ctime);\n\tinode->i_mtime.tv_sec = le64_to_cpu(raw_inode->i_mtime);\n\tinode->i_atime.tv_nsec = le32_to_cpu(raw_inode->i_mtime_nsec);\n\tinode->i_ctime.tv_nsec = le32_to_cpu(raw_inode->i_ctime_nsec);\n\tinode->i_mtime.tv_nsec = le32_to_cpu(raw_inode->i_mtime_nsec);\n\tif (inode->i_nlink == 0)\n\t\treturn -ESTALE; /* this inode is deleted */\n\n\tinode->i_blocks = le64_to_cpu(raw_inode->i_blocks);\n\tii->i_flags = le32_to_cpu(raw_inode->i_flags);\n#if 0\n\tii->i_file_acl = le32_to_cpu(raw_inode->i_file_acl);\n\tii->i_dir_acl = S_ISREG(inode->i_mode) ?\n\t\t0 : le32_to_cpu(raw_inode->i_dir_acl);\n#endif\n\tii->i_dir_start_lookup = 0;\n\tinode->i_generation = le32_to_cpu(raw_inode->i_generation);\n\n\tif (S_ISREG(inode->i_mode) || S_ISDIR(inode->i_mode) ||\n\t    S_ISLNK(inode->i_mode)) {\n\t\terr = nilfs_bmap_read(ii->i_bmap, raw_inode);\n\t\tif (err < 0)\n\t\t\treturn err;\n\t\tset_bit(NILFS_I_BMAP, &ii->i_state);\n\t\t/* No lock is needed; iget() ensures it. */\n\t}\n\treturn 0;\n}",
          "includes": [
            "#include \"ifile.h\"",
            "#include \"cpfile.h\"",
            "#include \"mdt.h\"",
            "#include \"page.h\"",
            "#include \"segment.h\"",
            "#include \"btnode.h\"",
            "#include \"nilfs.h\"",
            "#include <linux/aio.h>",
            "#include <linux/writeback.h>",
            "#include <linux/pagemap.h>",
            "#include <linux/mpage.h>",
            "#include <linux/gfp.h>",
            "#include <linux/buffer_head.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"ifile.h\"\n#include \"cpfile.h\"\n#include \"mdt.h\"\n#include \"page.h\"\n#include \"segment.h\"\n#include \"btnode.h\"\n#include \"nilfs.h\"\n#include <linux/aio.h>\n#include <linux/writeback.h>\n#include <linux/pagemap.h>\n#include <linux/mpage.h>\n#include <linux/gfp.h>\n#include <linux/buffer_head.h>\n\nint nilfs_read_inode_common(struct inode *inode,\n\t\t\t    struct nilfs_inode *raw_inode)\n{\n\tstruct nilfs_inode_info *ii = NILFS_I(inode);\n\tint err;\n\n\tinode->i_mode = le16_to_cpu(raw_inode->i_mode);\n\ti_uid_write(inode, le32_to_cpu(raw_inode->i_uid));\n\ti_gid_write(inode, le32_to_cpu(raw_inode->i_gid));\n\tset_nlink(inode, le16_to_cpu(raw_inode->i_links_count));\n\tinode->i_size = le64_to_cpu(raw_inode->i_size);\n\tinode->i_atime.tv_sec = le64_to_cpu(raw_inode->i_mtime);\n\tinode->i_ctime.tv_sec = le64_to_cpu(raw_inode->i_ctime);\n\tinode->i_mtime.tv_sec = le64_to_cpu(raw_inode->i_mtime);\n\tinode->i_atime.tv_nsec = le32_to_cpu(raw_inode->i_mtime_nsec);\n\tinode->i_ctime.tv_nsec = le32_to_cpu(raw_inode->i_ctime_nsec);\n\tinode->i_mtime.tv_nsec = le32_to_cpu(raw_inode->i_mtime_nsec);\n\tif (inode->i_nlink == 0)\n\t\treturn -ESTALE; /* this inode is deleted */\n\n\tinode->i_blocks = le64_to_cpu(raw_inode->i_blocks);\n\tii->i_flags = le32_to_cpu(raw_inode->i_flags);\n#if 0\n\tii->i_file_acl = le32_to_cpu(raw_inode->i_file_acl);\n\tii->i_dir_acl = S_ISREG(inode->i_mode) ?\n\t\t0 : le32_to_cpu(raw_inode->i_dir_acl);\n#endif\n\tii->i_dir_start_lookup = 0;\n\tinode->i_generation = le32_to_cpu(raw_inode->i_generation);\n\n\tif (S_ISREG(inode->i_mode) || S_ISDIR(inode->i_mode) ||\n\t    S_ISLNK(inode->i_mode)) {\n\t\terr = nilfs_bmap_read(ii->i_bmap, raw_inode);\n\t\tif (err < 0)\n\t\t\treturn err;\n\t\tset_bit(NILFS_I_BMAP, &ii->i_state);\n\t\t/* No lock is needed; iget() ensures it. */\n\t}\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "nilfs_mdt_set_entry_size",
          "args": [
            "sufile",
            "susize",
            "sizeof(struct nilfs_sufile_header)"
          ],
          "line": 1194
        },
        "resolved": true,
        "details": {
          "function_name": "nilfs_mdt_set_entry_size",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/mdt.c",
          "lines": "440-448",
          "snippet": "void nilfs_mdt_set_entry_size(struct inode *inode, unsigned entry_size,\n\t\t\t      unsigned header_size)\n{\n\tstruct nilfs_mdt_info *mi = NILFS_MDT(inode);\n\n\tmi->mi_entry_size = entry_size;\n\tmi->mi_entries_per_block = (1 << inode->i_blkbits) / entry_size;\n\tmi->mi_first_entry_offset = DIV_ROUND_UP(header_size, entry_size);\n}",
          "includes": [
            "#include \"mdt.h\"",
            "#include \"page.h\"",
            "#include \"segment.h\"",
            "#include \"btnode.h\"",
            "#include \"nilfs.h\"",
            "#include <linux/slab.h>",
            "#include <linux/swap.h>",
            "#include <linux/backing-dev.h>",
            "#include <linux/writeback.h>",
            "#include <linux/mm.h>",
            "#include <linux/mpage.h>",
            "#include <linux/buffer_head.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"mdt.h\"\n#include \"page.h\"\n#include \"segment.h\"\n#include \"btnode.h\"\n#include \"nilfs.h\"\n#include <linux/slab.h>\n#include <linux/swap.h>\n#include <linux/backing-dev.h>\n#include <linux/writeback.h>\n#include <linux/mm.h>\n#include <linux/mpage.h>\n#include <linux/buffer_head.h>\n\nvoid nilfs_mdt_set_entry_size(struct inode *inode, unsigned entry_size,\n\t\t\t      unsigned header_size)\n{\n\tstruct nilfs_mdt_info *mi = NILFS_MDT(inode);\n\n\tmi->mi_entry_size = entry_size;\n\tmi->mi_entries_per_block = (1 << inode->i_blkbits) / entry_size;\n\tmi->mi_first_entry_offset = DIV_ROUND_UP(header_size, entry_size);\n}"
        }
      },
      {
        "call_info": {
          "callee": "nilfs_mdt_init",
          "args": [
            "sufile",
            "NILFS_MDT_GFP",
            "sizeof(*sui)"
          ],
          "line": 1190
        },
        "resolved": true,
        "details": {
          "function_name": "nilfs_mdt_init",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/mdt.c",
          "lines": "419-438",
          "snippet": "int nilfs_mdt_init(struct inode *inode, gfp_t gfp_mask, size_t objsz)\n{\n\tstruct nilfs_mdt_info *mi;\n\n\tmi = kzalloc(max(sizeof(*mi), objsz), GFP_NOFS);\n\tif (!mi)\n\t\treturn -ENOMEM;\n\n\tinit_rwsem(&mi->mi_sem);\n\tinode->i_private = mi;\n\n\tinode->i_mode = S_IFREG;\n\tmapping_set_gfp_mask(inode->i_mapping, gfp_mask);\n\n\tinode->i_op = &def_mdt_iops;\n\tinode->i_fop = &def_mdt_fops;\n\tinode->i_mapping->a_ops = &def_mdt_aops;\n\n\treturn 0;\n}",
          "includes": [
            "#include \"mdt.h\"",
            "#include \"page.h\"",
            "#include \"segment.h\"",
            "#include \"btnode.h\"",
            "#include \"nilfs.h\"",
            "#include <linux/slab.h>",
            "#include <linux/swap.h>",
            "#include <linux/backing-dev.h>",
            "#include <linux/writeback.h>",
            "#include <linux/mm.h>",
            "#include <linux/mpage.h>",
            "#include <linux/buffer_head.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static const struct address_space_operations def_mdt_aops = {\n\t.writepage\t\t= nilfs_mdt_write_page,\n};",
            "static const struct inode_operations def_mdt_iops;",
            "static const struct file_operations def_mdt_fops;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"mdt.h\"\n#include \"page.h\"\n#include \"segment.h\"\n#include \"btnode.h\"\n#include \"nilfs.h\"\n#include <linux/slab.h>\n#include <linux/swap.h>\n#include <linux/backing-dev.h>\n#include <linux/writeback.h>\n#include <linux/mm.h>\n#include <linux/mpage.h>\n#include <linux/buffer_head.h>\n\nstatic const struct address_space_operations def_mdt_aops = {\n\t.writepage\t\t= nilfs_mdt_write_page,\n};\nstatic const struct inode_operations def_mdt_iops;\nstatic const struct file_operations def_mdt_fops;\n\nint nilfs_mdt_init(struct inode *inode, gfp_t gfp_mask, size_t objsz)\n{\n\tstruct nilfs_mdt_info *mi;\n\n\tmi = kzalloc(max(sizeof(*mi), objsz), GFP_NOFS);\n\tif (!mi)\n\t\treturn -ENOMEM;\n\n\tinit_rwsem(&mi->mi_sem);\n\tinode->i_private = mi;\n\n\tinode->i_mode = S_IFREG;\n\tmapping_set_gfp_mask(inode->i_mapping, gfp_mask);\n\n\tinode->i_op = &def_mdt_iops;\n\tinode->i_fop = &def_mdt_fops;\n\tinode->i_mapping->a_ops = &def_mdt_aops;\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "unlikely",
          "args": [
            "!sufile"
          ],
          "line": 1185
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "nilfs_iget_locked",
          "args": [
            "sb",
            "NULL",
            "NILFS_SUFILE_INO"
          ],
          "line": 1184
        },
        "resolved": true,
        "details": {
          "function_name": "nilfs_iget_locked",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/inode.c",
          "lines": "598-606",
          "snippet": "struct inode *nilfs_iget_locked(struct super_block *sb, struct nilfs_root *root,\n\t\t\t\tunsigned long ino)\n{\n\tstruct nilfs_iget_args args = {\n\t\t.ino = ino, .root = root, .cno = 0, .for_gc = 0\n\t};\n\n\treturn iget5_locked(sb, ino, nilfs_iget_test, nilfs_iget_set, &args);\n}",
          "includes": [
            "#include \"ifile.h\"",
            "#include \"cpfile.h\"",
            "#include \"mdt.h\"",
            "#include \"page.h\"",
            "#include \"segment.h\"",
            "#include \"btnode.h\"",
            "#include \"nilfs.h\"",
            "#include <linux/aio.h>",
            "#include <linux/writeback.h>",
            "#include <linux/pagemap.h>",
            "#include <linux/mpage.h>",
            "#include <linux/gfp.h>",
            "#include <linux/buffer_head.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"ifile.h\"\n#include \"cpfile.h\"\n#include \"mdt.h\"\n#include \"page.h\"\n#include \"segment.h\"\n#include \"btnode.h\"\n#include \"nilfs.h\"\n#include <linux/aio.h>\n#include <linux/writeback.h>\n#include <linux/pagemap.h>\n#include <linux/mpage.h>\n#include <linux/gfp.h>\n#include <linux/buffer_head.h>\n\nstruct inode *nilfs_iget_locked(struct super_block *sb, struct nilfs_root *root,\n\t\t\t\tunsigned long ino)\n{\n\tstruct nilfs_iget_args args = {\n\t\t.ino = ino, .root = root, .cno = 0, .for_gc = 0\n\t};\n\n\treturn iget5_locked(sb, ino, nilfs_iget_test, nilfs_iget_set, &args);\n}"
        }
      },
      {
        "call_info": {
          "callee": "printk",
          "args": [
            "KERN_ERR\n\t\t       \"NILFS: too small segment usage size: %zu bytes.\\n\"",
            "susize"
          ],
          "line": 1178
        },
        "resolved": true,
        "details": {
          "function_name": "compat_printk",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/compat.c",
          "lines": "59-69",
          "snippet": "int compat_printk(const char *fmt, ...)\n{\n\tva_list ap;\n\tint ret;\n\tif (!compat_log)\n\t\treturn 0;\n\tva_start(ap, fmt);\n\tret = vprintk(fmt, ap);\n\tva_end(ap);\n\treturn ret;\n}",
          "includes": [
            "#include \"internal.h\"",
            "#include <asm/ioctls.h>",
            "#include <asm/mmu_context.h>",
            "#include <asm/uaccess.h>",
            "#include <linux/aio.h>",
            "#include <linux/pagemap.h>",
            "#include <linux/slab.h>",
            "#include <linux/fs_struct.h>",
            "#include <linux/mm.h>",
            "#include <linux/poll.h>",
            "#include <linux/signal.h>",
            "#include <linux/highmem.h>",
            "#include <linux/security.h>",
            "#include <linux/tsacct_kern.h>",
            "#include <linux/rwsem.h>",
            "#include <linux/personality.h>",
            "#include <linux/highuid.h>",
            "#include <linux/fsnotify.h>",
            "#include <linux/dirent.h>",
            "#include <linux/ctype.h>",
            "#include <linux/syscalls.h>",
            "#include <linux/nfs4_mount.h>",
            "#include <linux/ncp_mount.h>",
            "#include <linux/init.h>",
            "#include <linux/ioctl.h>",
            "#include <linux/vfs.h>",
            "#include <linux/fdtable.h>",
            "#include <linux/file.h>",
            "#include <linux/namei.h>",
            "#include <linux/fcntl.h>",
            "#include <linux/fs.h>",
            "#include <linux/time.h>",
            "#include <linux/errno.h>",
            "#include <linux/compat.h>",
            "#include <linux/linkage.h>",
            "#include <linux/kernel.h>",
            "#include <linux/stddef.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "int compat_log = 1;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"internal.h\"\n#include <asm/ioctls.h>\n#include <asm/mmu_context.h>\n#include <asm/uaccess.h>\n#include <linux/aio.h>\n#include <linux/pagemap.h>\n#include <linux/slab.h>\n#include <linux/fs_struct.h>\n#include <linux/mm.h>\n#include <linux/poll.h>\n#include <linux/signal.h>\n#include <linux/highmem.h>\n#include <linux/security.h>\n#include <linux/tsacct_kern.h>\n#include <linux/rwsem.h>\n#include <linux/personality.h>\n#include <linux/highuid.h>\n#include <linux/fsnotify.h>\n#include <linux/dirent.h>\n#include <linux/ctype.h>\n#include <linux/syscalls.h>\n#include <linux/nfs4_mount.h>\n#include <linux/ncp_mount.h>\n#include <linux/init.h>\n#include <linux/ioctl.h>\n#include <linux/vfs.h>\n#include <linux/fdtable.h>\n#include <linux/file.h>\n#include <linux/namei.h>\n#include <linux/fcntl.h>\n#include <linux/fs.h>\n#include <linux/time.h>\n#include <linux/errno.h>\n#include <linux/compat.h>\n#include <linux/linkage.h>\n#include <linux/kernel.h>\n#include <linux/stddef.h>\n\nint compat_log = 1;\n\nint compat_printk(const char *fmt, ...)\n{\n\tva_list ap;\n\tint ret;\n\tif (!compat_log)\n\t\treturn 0;\n\tva_start(ap, fmt);\n\tret = vprintk(fmt, ap);\n\tva_end(ap);\n\treturn ret;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"sufile.h\"\n#include \"mdt.h\"\n#include <linux/nilfs2_fs.h>\n#include <linux/errno.h>\n#include <linux/buffer_head.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n#include <linux/kernel.h>\n\nint nilfs_sufile_read(struct super_block *sb, size_t susize,\n\t\t      struct nilfs_inode *raw_inode, struct inode **inodep)\n{\n\tstruct inode *sufile;\n\tstruct nilfs_sufile_info *sui;\n\tstruct buffer_head *header_bh;\n\tstruct nilfs_sufile_header *header;\n\tvoid *kaddr;\n\tint err;\n\n\tif (susize > sb->s_blocksize) {\n\t\tprintk(KERN_ERR\n\t\t       \"NILFS: too large segment usage size: %zu bytes.\\n\",\n\t\t       susize);\n\t\treturn -EINVAL;\n\t} else if (susize < NILFS_MIN_SEGMENT_USAGE_SIZE) {\n\t\tprintk(KERN_ERR\n\t\t       \"NILFS: too small segment usage size: %zu bytes.\\n\",\n\t\t       susize);\n\t\treturn -EINVAL;\n\t}\n\n\tsufile = nilfs_iget_locked(sb, NULL, NILFS_SUFILE_INO);\n\tif (unlikely(!sufile))\n\t\treturn -ENOMEM;\n\tif (!(sufile->i_state & I_NEW))\n\t\tgoto out;\n\n\terr = nilfs_mdt_init(sufile, NILFS_MDT_GFP, sizeof(*sui));\n\tif (err)\n\t\tgoto failed;\n\n\tnilfs_mdt_set_entry_size(sufile, susize,\n\t\t\t\t sizeof(struct nilfs_sufile_header));\n\n\terr = nilfs_read_inode_common(sufile, raw_inode);\n\tif (err)\n\t\tgoto failed;\n\n\terr = nilfs_sufile_get_header_block(sufile, &header_bh);\n\tif (err)\n\t\tgoto failed;\n\n\tsui = NILFS_SUI(sufile);\n\tkaddr = kmap_atomic(header_bh->b_page);\n\theader = kaddr + bh_offset(header_bh);\n\tsui->ncleansegs = le64_to_cpu(header->sh_ncleansegs);\n\tkunmap_atomic(kaddr);\n\tbrelse(header_bh);\n\n\tsui->allocmax = nilfs_sufile_get_nsegments(sufile) - 1;\n\tsui->allocmin = 0;\n\n\tunlock_new_inode(sufile);\n out:\n\t*inodep = sufile;\n\treturn 0;\n failed:\n\tiget_failed(sufile);\n\treturn err;\n}"
  },
  {
    "function_name": "nilfs_sufile_trim_fs",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/sufile.c",
    "lines": "1019-1153",
    "snippet": "int nilfs_sufile_trim_fs(struct inode *sufile, struct fstrim_range *range)\n{\n\tstruct the_nilfs *nilfs = sufile->i_sb->s_fs_info;\n\tstruct buffer_head *su_bh;\n\tstruct nilfs_segment_usage *su;\n\tvoid *kaddr;\n\tsize_t n, i, susz = NILFS_MDT(sufile)->mi_entry_size;\n\tsector_t seg_start, seg_end, start_block, end_block;\n\tsector_t start = 0, nblocks = 0;\n\tu64 segnum, segnum_end, minlen, len, max_blocks, ndiscarded = 0;\n\tint ret = 0;\n\tunsigned int sects_per_block;\n\n\tsects_per_block = (1 << nilfs->ns_blocksize_bits) /\n\t\t\tbdev_logical_block_size(nilfs->ns_bdev);\n\tlen = range->len >> nilfs->ns_blocksize_bits;\n\tminlen = range->minlen >> nilfs->ns_blocksize_bits;\n\tmax_blocks = ((u64)nilfs->ns_nsegments * nilfs->ns_blocks_per_segment);\n\n\tif (!len || range->start >= max_blocks << nilfs->ns_blocksize_bits)\n\t\treturn -EINVAL;\n\n\tstart_block = (range->start + nilfs->ns_blocksize - 1) >>\n\t\t\tnilfs->ns_blocksize_bits;\n\n\t/*\n\t * range->len can be very large (actually, it is set to\n\t * ULLONG_MAX by default) - truncate upper end of the range\n\t * carefully so as not to overflow.\n\t */\n\tif (max_blocks - start_block < len)\n\t\tend_block = max_blocks - 1;\n\telse\n\t\tend_block = start_block + len - 1;\n\n\tsegnum = nilfs_get_segnum_of_block(nilfs, start_block);\n\tsegnum_end = nilfs_get_segnum_of_block(nilfs, end_block);\n\n\tdown_read(&NILFS_MDT(sufile)->mi_sem);\n\n\twhile (segnum <= segnum_end) {\n\t\tn = nilfs_sufile_segment_usages_in_block(sufile, segnum,\n\t\t\t\tsegnum_end);\n\n\t\tret = nilfs_sufile_get_segment_usage_block(sufile, segnum, 0,\n\t\t\t\t\t\t\t   &su_bh);\n\t\tif (ret < 0) {\n\t\t\tif (ret != -ENOENT)\n\t\t\t\tgoto out_sem;\n\t\t\t/* hole */\n\t\t\tsegnum += n;\n\t\t\tcontinue;\n\t\t}\n\n\t\tkaddr = kmap_atomic(su_bh->b_page);\n\t\tsu = nilfs_sufile_block_get_segment_usage(sufile, segnum,\n\t\t\t\tsu_bh, kaddr);\n\t\tfor (i = 0; i < n; ++i, ++segnum, su = (void *)su + susz) {\n\t\t\tif (!nilfs_segment_usage_clean(su))\n\t\t\t\tcontinue;\n\n\t\t\tnilfs_get_segment_range(nilfs, segnum, &seg_start,\n\t\t\t\t\t\t&seg_end);\n\n\t\t\tif (!nblocks) {\n\t\t\t\t/* start new extent */\n\t\t\t\tstart = seg_start;\n\t\t\t\tnblocks = seg_end - seg_start + 1;\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (start + nblocks == seg_start) {\n\t\t\t\t/* add to previous extent */\n\t\t\t\tnblocks += seg_end - seg_start + 1;\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t/* discard previous extent */\n\t\t\tif (start < start_block) {\n\t\t\t\tnblocks -= start_block - start;\n\t\t\t\tstart = start_block;\n\t\t\t}\n\n\t\t\tif (nblocks >= minlen) {\n\t\t\t\tkunmap_atomic(kaddr);\n\n\t\t\t\tret = blkdev_issue_discard(nilfs->ns_bdev,\n\t\t\t\t\t\tstart * sects_per_block,\n\t\t\t\t\t\tnblocks * sects_per_block,\n\t\t\t\t\t\tGFP_NOFS, 0);\n\t\t\t\tif (ret < 0) {\n\t\t\t\t\tput_bh(su_bh);\n\t\t\t\t\tgoto out_sem;\n\t\t\t\t}\n\n\t\t\t\tndiscarded += nblocks;\n\t\t\t\tkaddr = kmap_atomic(su_bh->b_page);\n\t\t\t\tsu = nilfs_sufile_block_get_segment_usage(\n\t\t\t\t\tsufile, segnum, su_bh, kaddr);\n\t\t\t}\n\n\t\t\t/* start new extent */\n\t\t\tstart = seg_start;\n\t\t\tnblocks = seg_end - seg_start + 1;\n\t\t}\n\t\tkunmap_atomic(kaddr);\n\t\tput_bh(su_bh);\n\t}\n\n\n\tif (nblocks) {\n\t\t/* discard last extent */\n\t\tif (start < start_block) {\n\t\t\tnblocks -= start_block - start;\n\t\t\tstart = start_block;\n\t\t}\n\t\tif (start + nblocks > end_block + 1)\n\t\t\tnblocks = end_block - start + 1;\n\n\t\tif (nblocks >= minlen) {\n\t\t\tret = blkdev_issue_discard(nilfs->ns_bdev,\n\t\t\t\t\tstart * sects_per_block,\n\t\t\t\t\tnblocks * sects_per_block,\n\t\t\t\t\tGFP_NOFS, 0);\n\t\t\tif (!ret)\n\t\t\t\tndiscarded += nblocks;\n\t\t}\n\t}\n\nout_sem:\n\tup_read(&NILFS_MDT(sufile)->mi_sem);\n\n\trange->len = ndiscarded << nilfs->ns_blocksize_bits;\n\treturn ret;\n}",
    "includes": [
      "#include \"sufile.h\"",
      "#include \"mdt.h\"",
      "#include <linux/nilfs2_fs.h>",
      "#include <linux/errno.h>",
      "#include <linux/buffer_head.h>",
      "#include <linux/string.h>",
      "#include <linux/fs.h>",
      "#include <linux/kernel.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "up_read",
          "args": [
            "&NILFS_MDT(sufile)->mi_sem"
          ],
          "line": 1149
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "NILFS_MDT",
          "args": [
            "sufile"
          ],
          "line": 1149
        },
        "resolved": true,
        "details": {
          "function_name": "NILFS_MDT",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/mdt.h",
          "lines": "69-72",
          "snippet": "static inline struct nilfs_mdt_info *NILFS_MDT(const struct inode *inode)\n{\n\treturn inode->i_private;\n}",
          "includes": [
            "#include \"page.h\"",
            "#include \"nilfs.h\"",
            "#include <linux/blockgroup_lock.h>",
            "#include <linux/buffer_head.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"page.h\"\n#include \"nilfs.h\"\n#include <linux/blockgroup_lock.h>\n#include <linux/buffer_head.h>\n\nstatic inline struct nilfs_mdt_info *NILFS_MDT(const struct inode *inode)\n{\n\treturn inode->i_private;\n}"
        }
      },
      {
        "call_info": {
          "callee": "blkdev_issue_discard",
          "args": [
            "nilfs->ns_bdev",
            "start * sects_per_block",
            "nblocks * sects_per_block",
            "GFP_NOFS",
            "0"
          ],
          "line": 1139
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "put_bh",
          "args": [
            "su_bh"
          ],
          "line": 1125
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kunmap_atomic",
          "args": [
            "kaddr"
          ],
          "line": 1124
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "nilfs_sufile_block_get_segment_usage",
          "args": [
            "sufile",
            "segnum",
            "su_bh",
            "kaddr"
          ],
          "line": 1116
        },
        "resolved": true,
        "details": {
          "function_name": "nilfs_sufile_block_get_segment_usage",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/sufile.c",
          "lines": "83-90",
          "snippet": "static struct nilfs_segment_usage *\nnilfs_sufile_block_get_segment_usage(const struct inode *sufile, __u64 segnum,\n\t\t\t\t     struct buffer_head *bh, void *kaddr)\n{\n\treturn kaddr + bh_offset(bh) +\n\t\tnilfs_sufile_get_offset(sufile, segnum) *\n\t\tNILFS_MDT(sufile)->mi_entry_size;\n}",
          "includes": [
            "#include \"sufile.h\"",
            "#include \"mdt.h\"",
            "#include <linux/nilfs2_fs.h>",
            "#include <linux/errno.h>",
            "#include <linux/buffer_head.h>",
            "#include <linux/string.h>",
            "#include <linux/fs.h>",
            "#include <linux/kernel.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sufile.h\"\n#include \"mdt.h\"\n#include <linux/nilfs2_fs.h>\n#include <linux/errno.h>\n#include <linux/buffer_head.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n#include <linux/kernel.h>\n\nstatic struct nilfs_segment_usage *\nnilfs_sufile_block_get_segment_usage(const struct inode *sufile, __u64 segnum,\n\t\t\t\t     struct buffer_head *bh, void *kaddr)\n{\n\treturn kaddr + bh_offset(bh) +\n\t\tnilfs_sufile_get_offset(sufile, segnum) *\n\t\tNILFS_MDT(sufile)->mi_entry_size;\n}"
        }
      },
      {
        "call_info": {
          "callee": "kmap_atomic",
          "args": [
            "su_bh->b_page"
          ],
          "line": 1115
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "put_bh",
          "args": [
            "su_bh"
          ],
          "line": 1110
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "blkdev_issue_discard",
          "args": [
            "nilfs->ns_bdev",
            "start * sects_per_block",
            "nblocks * sects_per_block",
            "GFP_NOFS",
            "0"
          ],
          "line": 1105
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kunmap_atomic",
          "args": [
            "kaddr"
          ],
          "line": 1103
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "nilfs_get_segment_range",
          "args": [
            "nilfs",
            "segnum",
            "&seg_start",
            "&seg_end"
          ],
          "line": 1080
        },
        "resolved": true,
        "details": {
          "function_name": "nilfs_get_segment_range",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/the_nilfs.h",
          "lines": "319-327",
          "snippet": "static inline void\nnilfs_get_segment_range(struct the_nilfs *nilfs, __u64 segnum,\n\t\t\tsector_t *seg_start, sector_t *seg_end)\n{\n\t*seg_start = (sector_t)nilfs->ns_blocks_per_segment * segnum;\n\t*seg_end = *seg_start + nilfs->ns_blocks_per_segment - 1;\n\tif (segnum == 0)\n\t\t*seg_start = nilfs->ns_first_data_block;\n}",
          "includes": [
            "#include <linux/slab.h>",
            "#include <linux/backing-dev.h>",
            "#include <linux/blkdev.h>",
            "#include <linux/fs.h>",
            "#include <linux/rbtree.h>",
            "#include <linux/buffer_head.h>",
            "#include <linux/types.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/slab.h>\n#include <linux/backing-dev.h>\n#include <linux/blkdev.h>\n#include <linux/fs.h>\n#include <linux/rbtree.h>\n#include <linux/buffer_head.h>\n#include <linux/types.h>\n\nstatic inline void\nnilfs_get_segment_range(struct the_nilfs *nilfs, __u64 segnum,\n\t\t\tsector_t *seg_start, sector_t *seg_end)\n{\n\t*seg_start = (sector_t)nilfs->ns_blocks_per_segment * segnum;\n\t*seg_end = *seg_start + nilfs->ns_blocks_per_segment - 1;\n\tif (segnum == 0)\n\t\t*seg_start = nilfs->ns_first_data_block;\n}"
        }
      },
      {
        "call_info": {
          "callee": "nilfs_segment_usage_clean",
          "args": [
            "su"
          ],
          "line": 1077
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kmap_atomic",
          "args": [
            "su_bh->b_page"
          ],
          "line": 1073
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "nilfs_sufile_get_segment_usage_block",
          "args": [
            "sufile",
            "segnum",
            "0",
            "&su_bh"
          ],
          "line": 1063
        },
        "resolved": true,
        "details": {
          "function_name": "nilfs_sufile_get_segment_usage_block",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/sufile.c",
          "lines": "98-105",
          "snippet": "static inline int\nnilfs_sufile_get_segment_usage_block(struct inode *sufile, __u64 segnum,\n\t\t\t\t     int create, struct buffer_head **bhp)\n{\n\treturn nilfs_mdt_get_block(sufile,\n\t\t\t\t   nilfs_sufile_get_blkoff(sufile, segnum),\n\t\t\t\t   create, NULL, bhp);\n}",
          "includes": [
            "#include \"sufile.h\"",
            "#include \"mdt.h\"",
            "#include <linux/nilfs2_fs.h>",
            "#include <linux/errno.h>",
            "#include <linux/buffer_head.h>",
            "#include <linux/string.h>",
            "#include <linux/fs.h>",
            "#include <linux/kernel.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sufile.h\"\n#include \"mdt.h\"\n#include <linux/nilfs2_fs.h>\n#include <linux/errno.h>\n#include <linux/buffer_head.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n#include <linux/kernel.h>\n\nstatic inline int\nnilfs_sufile_get_segment_usage_block(struct inode *sufile, __u64 segnum,\n\t\t\t\t     int create, struct buffer_head **bhp)\n{\n\treturn nilfs_mdt_get_block(sufile,\n\t\t\t\t   nilfs_sufile_get_blkoff(sufile, segnum),\n\t\t\t\t   create, NULL, bhp);\n}"
        }
      },
      {
        "call_info": {
          "callee": "nilfs_sufile_segment_usages_in_block",
          "args": [
            "sufile",
            "segnum",
            "segnum_end"
          ],
          "line": 1060
        },
        "resolved": true,
        "details": {
          "function_name": "nilfs_sufile_segment_usages_in_block",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/sufile.c",
          "lines": "73-81",
          "snippet": "static unsigned long\nnilfs_sufile_segment_usages_in_block(const struct inode *sufile, __u64 curr,\n\t\t\t\t     __u64 max)\n{\n\treturn min_t(unsigned long,\n\t\t     nilfs_sufile_segment_usages_per_block(sufile) -\n\t\t     nilfs_sufile_get_offset(sufile, curr),\n\t\t     max - curr + 1);\n}",
          "includes": [
            "#include \"sufile.h\"",
            "#include \"mdt.h\"",
            "#include <linux/nilfs2_fs.h>",
            "#include <linux/errno.h>",
            "#include <linux/buffer_head.h>",
            "#include <linux/string.h>",
            "#include <linux/fs.h>",
            "#include <linux/kernel.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sufile.h\"\n#include \"mdt.h\"\n#include <linux/nilfs2_fs.h>\n#include <linux/errno.h>\n#include <linux/buffer_head.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n#include <linux/kernel.h>\n\nstatic unsigned long\nnilfs_sufile_segment_usages_in_block(const struct inode *sufile, __u64 curr,\n\t\t\t\t     __u64 max)\n{\n\treturn min_t(unsigned long,\n\t\t     nilfs_sufile_segment_usages_per_block(sufile) -\n\t\t     nilfs_sufile_get_offset(sufile, curr),\n\t\t     max - curr + 1);\n}"
        }
      },
      {
        "call_info": {
          "callee": "down_read",
          "args": [
            "&NILFS_MDT(sufile)->mi_sem"
          ],
          "line": 1057
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "nilfs_get_segnum_of_block",
          "args": [
            "nilfs",
            "end_block"
          ],
          "line": 1055
        },
        "resolved": true,
        "details": {
          "function_name": "nilfs_get_segnum_of_block",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/the_nilfs.h",
          "lines": "336-343",
          "snippet": "static inline __u64\nnilfs_get_segnum_of_block(struct the_nilfs *nilfs, sector_t blocknr)\n{\n\tsector_t segnum = blocknr;\n\n\tsector_div(segnum, nilfs->ns_blocks_per_segment);\n\treturn segnum;\n}",
          "includes": [
            "#include <linux/slab.h>",
            "#include <linux/backing-dev.h>",
            "#include <linux/blkdev.h>",
            "#include <linux/fs.h>",
            "#include <linux/rbtree.h>",
            "#include <linux/buffer_head.h>",
            "#include <linux/types.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/slab.h>\n#include <linux/backing-dev.h>\n#include <linux/blkdev.h>\n#include <linux/fs.h>\n#include <linux/rbtree.h>\n#include <linux/buffer_head.h>\n#include <linux/types.h>\n\nstatic inline __u64\nnilfs_get_segnum_of_block(struct the_nilfs *nilfs, sector_t blocknr)\n{\n\tsector_t segnum = blocknr;\n\n\tsector_div(segnum, nilfs->ns_blocks_per_segment);\n\treturn segnum;\n}"
        }
      },
      {
        "call_info": {
          "callee": "bdev_logical_block_size",
          "args": [
            "nilfs->ns_bdev"
          ],
          "line": 1033
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"sufile.h\"\n#include \"mdt.h\"\n#include <linux/nilfs2_fs.h>\n#include <linux/errno.h>\n#include <linux/buffer_head.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n#include <linux/kernel.h>\n\nint nilfs_sufile_trim_fs(struct inode *sufile, struct fstrim_range *range)\n{\n\tstruct the_nilfs *nilfs = sufile->i_sb->s_fs_info;\n\tstruct buffer_head *su_bh;\n\tstruct nilfs_segment_usage *su;\n\tvoid *kaddr;\n\tsize_t n, i, susz = NILFS_MDT(sufile)->mi_entry_size;\n\tsector_t seg_start, seg_end, start_block, end_block;\n\tsector_t start = 0, nblocks = 0;\n\tu64 segnum, segnum_end, minlen, len, max_blocks, ndiscarded = 0;\n\tint ret = 0;\n\tunsigned int sects_per_block;\n\n\tsects_per_block = (1 << nilfs->ns_blocksize_bits) /\n\t\t\tbdev_logical_block_size(nilfs->ns_bdev);\n\tlen = range->len >> nilfs->ns_blocksize_bits;\n\tminlen = range->minlen >> nilfs->ns_blocksize_bits;\n\tmax_blocks = ((u64)nilfs->ns_nsegments * nilfs->ns_blocks_per_segment);\n\n\tif (!len || range->start >= max_blocks << nilfs->ns_blocksize_bits)\n\t\treturn -EINVAL;\n\n\tstart_block = (range->start + nilfs->ns_blocksize - 1) >>\n\t\t\tnilfs->ns_blocksize_bits;\n\n\t/*\n\t * range->len can be very large (actually, it is set to\n\t * ULLONG_MAX by default) - truncate upper end of the range\n\t * carefully so as not to overflow.\n\t */\n\tif (max_blocks - start_block < len)\n\t\tend_block = max_blocks - 1;\n\telse\n\t\tend_block = start_block + len - 1;\n\n\tsegnum = nilfs_get_segnum_of_block(nilfs, start_block);\n\tsegnum_end = nilfs_get_segnum_of_block(nilfs, end_block);\n\n\tdown_read(&NILFS_MDT(sufile)->mi_sem);\n\n\twhile (segnum <= segnum_end) {\n\t\tn = nilfs_sufile_segment_usages_in_block(sufile, segnum,\n\t\t\t\tsegnum_end);\n\n\t\tret = nilfs_sufile_get_segment_usage_block(sufile, segnum, 0,\n\t\t\t\t\t\t\t   &su_bh);\n\t\tif (ret < 0) {\n\t\t\tif (ret != -ENOENT)\n\t\t\t\tgoto out_sem;\n\t\t\t/* hole */\n\t\t\tsegnum += n;\n\t\t\tcontinue;\n\t\t}\n\n\t\tkaddr = kmap_atomic(su_bh->b_page);\n\t\tsu = nilfs_sufile_block_get_segment_usage(sufile, segnum,\n\t\t\t\tsu_bh, kaddr);\n\t\tfor (i = 0; i < n; ++i, ++segnum, su = (void *)su + susz) {\n\t\t\tif (!nilfs_segment_usage_clean(su))\n\t\t\t\tcontinue;\n\n\t\t\tnilfs_get_segment_range(nilfs, segnum, &seg_start,\n\t\t\t\t\t\t&seg_end);\n\n\t\t\tif (!nblocks) {\n\t\t\t\t/* start new extent */\n\t\t\t\tstart = seg_start;\n\t\t\t\tnblocks = seg_end - seg_start + 1;\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (start + nblocks == seg_start) {\n\t\t\t\t/* add to previous extent */\n\t\t\t\tnblocks += seg_end - seg_start + 1;\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t/* discard previous extent */\n\t\t\tif (start < start_block) {\n\t\t\t\tnblocks -= start_block - start;\n\t\t\t\tstart = start_block;\n\t\t\t}\n\n\t\t\tif (nblocks >= minlen) {\n\t\t\t\tkunmap_atomic(kaddr);\n\n\t\t\t\tret = blkdev_issue_discard(nilfs->ns_bdev,\n\t\t\t\t\t\tstart * sects_per_block,\n\t\t\t\t\t\tnblocks * sects_per_block,\n\t\t\t\t\t\tGFP_NOFS, 0);\n\t\t\t\tif (ret < 0) {\n\t\t\t\t\tput_bh(su_bh);\n\t\t\t\t\tgoto out_sem;\n\t\t\t\t}\n\n\t\t\t\tndiscarded += nblocks;\n\t\t\t\tkaddr = kmap_atomic(su_bh->b_page);\n\t\t\t\tsu = nilfs_sufile_block_get_segment_usage(\n\t\t\t\t\tsufile, segnum, su_bh, kaddr);\n\t\t\t}\n\n\t\t\t/* start new extent */\n\t\t\tstart = seg_start;\n\t\t\tnblocks = seg_end - seg_start + 1;\n\t\t}\n\t\tkunmap_atomic(kaddr);\n\t\tput_bh(su_bh);\n\t}\n\n\n\tif (nblocks) {\n\t\t/* discard last extent */\n\t\tif (start < start_block) {\n\t\t\tnblocks -= start_block - start;\n\t\t\tstart = start_block;\n\t\t}\n\t\tif (start + nblocks > end_block + 1)\n\t\t\tnblocks = end_block - start + 1;\n\n\t\tif (nblocks >= minlen) {\n\t\t\tret = blkdev_issue_discard(nilfs->ns_bdev,\n\t\t\t\t\tstart * sects_per_block,\n\t\t\t\t\tnblocks * sects_per_block,\n\t\t\t\t\tGFP_NOFS, 0);\n\t\t\tif (!ret)\n\t\t\t\tndiscarded += nblocks;\n\t\t}\n\t}\n\nout_sem:\n\tup_read(&NILFS_MDT(sufile)->mi_sem);\n\n\trange->len = ndiscarded << nilfs->ns_blocksize_bits;\n\treturn ret;\n}"
  },
  {
    "function_name": "nilfs_sufile_set_suinfo",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/sufile.c",
    "lines": "892-1001",
    "snippet": "ssize_t nilfs_sufile_set_suinfo(struct inode *sufile, void *buf,\n\t\t\t\tunsigned supsz, size_t nsup)\n{\n\tstruct the_nilfs *nilfs = sufile->i_sb->s_fs_info;\n\tstruct buffer_head *header_bh, *bh;\n\tstruct nilfs_suinfo_update *sup, *supend = buf + supsz * nsup;\n\tstruct nilfs_segment_usage *su;\n\tvoid *kaddr;\n\tunsigned long blkoff, prev_blkoff;\n\tint cleansi, cleansu, dirtysi, dirtysu;\n\tlong ncleaned = 0, ndirtied = 0;\n\tint ret = 0;\n\n\tif (unlikely(nsup == 0))\n\t\treturn ret;\n\n\tfor (sup = buf; sup < supend; sup = (void *)sup + supsz) {\n\t\tif (sup->sup_segnum >= nilfs->ns_nsegments\n\t\t\t|| (sup->sup_flags &\n\t\t\t\t(~0UL << __NR_NILFS_SUINFO_UPDATE_FIELDS))\n\t\t\t|| (nilfs_suinfo_update_nblocks(sup) &&\n\t\t\t\tsup->sup_sui.sui_nblocks >\n\t\t\t\tnilfs->ns_blocks_per_segment))\n\t\t\treturn -EINVAL;\n\t}\n\n\tdown_write(&NILFS_MDT(sufile)->mi_sem);\n\n\tret = nilfs_sufile_get_header_block(sufile, &header_bh);\n\tif (ret < 0)\n\t\tgoto out_sem;\n\n\tsup = buf;\n\tblkoff = nilfs_sufile_get_blkoff(sufile, sup->sup_segnum);\n\tret = nilfs_mdt_get_block(sufile, blkoff, 1, NULL, &bh);\n\tif (ret < 0)\n\t\tgoto out_header;\n\n\tfor (;;) {\n\t\tkaddr = kmap_atomic(bh->b_page);\n\t\tsu = nilfs_sufile_block_get_segment_usage(\n\t\t\tsufile, sup->sup_segnum, bh, kaddr);\n\n\t\tif (nilfs_suinfo_update_lastmod(sup))\n\t\t\tsu->su_lastmod = cpu_to_le64(sup->sup_sui.sui_lastmod);\n\n\t\tif (nilfs_suinfo_update_nblocks(sup))\n\t\t\tsu->su_nblocks = cpu_to_le32(sup->sup_sui.sui_nblocks);\n\n\t\tif (nilfs_suinfo_update_flags(sup)) {\n\t\t\t/*\n\t\t\t * Active flag is a virtual flag projected by running\n\t\t\t * nilfs kernel code - drop it not to write it to\n\t\t\t * disk.\n\t\t\t */\n\t\t\tsup->sup_sui.sui_flags &=\n\t\t\t\t\t~(1UL << NILFS_SEGMENT_USAGE_ACTIVE);\n\n\t\t\tcleansi = nilfs_suinfo_clean(&sup->sup_sui);\n\t\t\tcleansu = nilfs_segment_usage_clean(su);\n\t\t\tdirtysi = nilfs_suinfo_dirty(&sup->sup_sui);\n\t\t\tdirtysu = nilfs_segment_usage_dirty(su);\n\n\t\t\tif (cleansi && !cleansu)\n\t\t\t\t++ncleaned;\n\t\t\telse if (!cleansi && cleansu)\n\t\t\t\t--ncleaned;\n\n\t\t\tif (dirtysi && !dirtysu)\n\t\t\t\t++ndirtied;\n\t\t\telse if (!dirtysi && dirtysu)\n\t\t\t\t--ndirtied;\n\n\t\t\tsu->su_flags = cpu_to_le32(sup->sup_sui.sui_flags);\n\t\t}\n\n\t\tkunmap_atomic(kaddr);\n\n\t\tsup = (void *)sup + supsz;\n\t\tif (sup >= supend)\n\t\t\tbreak;\n\n\t\tprev_blkoff = blkoff;\n\t\tblkoff = nilfs_sufile_get_blkoff(sufile, sup->sup_segnum);\n\t\tif (blkoff == prev_blkoff)\n\t\t\tcontinue;\n\n\t\t/* get different block */\n\t\tmark_buffer_dirty(bh);\n\t\tput_bh(bh);\n\t\tret = nilfs_mdt_get_block(sufile, blkoff, 1, NULL, &bh);\n\t\tif (unlikely(ret < 0))\n\t\t\tgoto out_mark;\n\t}\n\tmark_buffer_dirty(bh);\n\tput_bh(bh);\n\n out_mark:\n\tif (ncleaned || ndirtied) {\n\t\tnilfs_sufile_mod_counter(header_bh, (u64)ncleaned,\n\t\t\t\t(u64)ndirtied);\n\t\tNILFS_SUI(sufile)->ncleansegs += ncleaned;\n\t}\n\tnilfs_mdt_mark_dirty(sufile);\n out_header:\n\tput_bh(header_bh);\n out_sem:\n\tup_write(&NILFS_MDT(sufile)->mi_sem);\n\treturn ret;\n}",
    "includes": [
      "#include \"sufile.h\"",
      "#include \"mdt.h\"",
      "#include <linux/nilfs2_fs.h>",
      "#include <linux/errno.h>",
      "#include <linux/buffer_head.h>",
      "#include <linux/string.h>",
      "#include <linux/fs.h>",
      "#include <linux/kernel.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "up_write",
          "args": [
            "&NILFS_MDT(sufile)->mi_sem"
          ],
          "line": 999
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "NILFS_MDT",
          "args": [
            "sufile"
          ],
          "line": 999
        },
        "resolved": true,
        "details": {
          "function_name": "NILFS_MDT",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/mdt.h",
          "lines": "69-72",
          "snippet": "static inline struct nilfs_mdt_info *NILFS_MDT(const struct inode *inode)\n{\n\treturn inode->i_private;\n}",
          "includes": [
            "#include \"page.h\"",
            "#include \"nilfs.h\"",
            "#include <linux/blockgroup_lock.h>",
            "#include <linux/buffer_head.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"page.h\"\n#include \"nilfs.h\"\n#include <linux/blockgroup_lock.h>\n#include <linux/buffer_head.h>\n\nstatic inline struct nilfs_mdt_info *NILFS_MDT(const struct inode *inode)\n{\n\treturn inode->i_private;\n}"
        }
      },
      {
        "call_info": {
          "callee": "put_bh",
          "args": [
            "header_bh"
          ],
          "line": 997
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "nilfs_mdt_mark_dirty",
          "args": [
            "sufile"
          ],
          "line": 995
        },
        "resolved": true,
        "details": {
          "function_name": "nilfs_mdt_mark_dirty",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/mdt.h",
          "lines": "98-102",
          "snippet": "static inline void nilfs_mdt_mark_dirty(struct inode *inode)\n{\n\tif (!test_bit(NILFS_I_DIRTY, &NILFS_I(inode)->i_state))\n\t\tset_bit(NILFS_I_DIRTY, &NILFS_I(inode)->i_state);\n}",
          "includes": [
            "#include \"page.h\"",
            "#include \"nilfs.h\"",
            "#include <linux/blockgroup_lock.h>",
            "#include <linux/buffer_head.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"page.h\"\n#include \"nilfs.h\"\n#include <linux/blockgroup_lock.h>\n#include <linux/buffer_head.h>\n\nstatic inline void nilfs_mdt_mark_dirty(struct inode *inode)\n{\n\tif (!test_bit(NILFS_I_DIRTY, &NILFS_I(inode)->i_state))\n\t\tset_bit(NILFS_I_DIRTY, &NILFS_I(inode)->i_state);\n}"
        }
      },
      {
        "call_info": {
          "callee": "NILFS_SUI",
          "args": [
            "sufile"
          ],
          "line": 993
        },
        "resolved": true,
        "details": {
          "function_name": "NILFS_SUI",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/sufile.c",
          "lines": "47-50",
          "snippet": "static inline struct nilfs_sufile_info *NILFS_SUI(struct inode *sufile)\n{\n\treturn (struct nilfs_sufile_info *)NILFS_MDT(sufile);\n}",
          "includes": [
            "#include \"sufile.h\"",
            "#include \"mdt.h\"",
            "#include <linux/nilfs2_fs.h>",
            "#include <linux/errno.h>",
            "#include <linux/buffer_head.h>",
            "#include <linux/string.h>",
            "#include <linux/fs.h>",
            "#include <linux/kernel.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sufile.h\"\n#include \"mdt.h\"\n#include <linux/nilfs2_fs.h>\n#include <linux/errno.h>\n#include <linux/buffer_head.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n#include <linux/kernel.h>\n\nstatic inline struct nilfs_sufile_info *NILFS_SUI(struct inode *sufile)\n{\n\treturn (struct nilfs_sufile_info *)NILFS_MDT(sufile);\n}"
        }
      },
      {
        "call_info": {
          "callee": "nilfs_sufile_mod_counter",
          "args": [
            "header_bh",
            "(u64)ncleaned",
            "(u64)ndirtied"
          ],
          "line": 991
        },
        "resolved": true,
        "details": {
          "function_name": "nilfs_sufile_mod_counter",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/sufile.c",
          "lines": "114-127",
          "snippet": "static void nilfs_sufile_mod_counter(struct buffer_head *header_bh,\n\t\t\t\t     u64 ncleanadd, u64 ndirtyadd)\n{\n\tstruct nilfs_sufile_header *header;\n\tvoid *kaddr;\n\n\tkaddr = kmap_atomic(header_bh->b_page);\n\theader = kaddr + bh_offset(header_bh);\n\tle64_add_cpu(&header->sh_ncleansegs, ncleanadd);\n\tle64_add_cpu(&header->sh_ndirtysegs, ndirtyadd);\n\tkunmap_atomic(kaddr);\n\n\tmark_buffer_dirty(header_bh);\n}",
          "includes": [
            "#include \"sufile.h\"",
            "#include \"mdt.h\"",
            "#include <linux/nilfs2_fs.h>",
            "#include <linux/errno.h>",
            "#include <linux/buffer_head.h>",
            "#include <linux/string.h>",
            "#include <linux/fs.h>",
            "#include <linux/kernel.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sufile.h\"\n#include \"mdt.h\"\n#include <linux/nilfs2_fs.h>\n#include <linux/errno.h>\n#include <linux/buffer_head.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n#include <linux/kernel.h>\n\nstatic void nilfs_sufile_mod_counter(struct buffer_head *header_bh,\n\t\t\t\t     u64 ncleanadd, u64 ndirtyadd)\n{\n\tstruct nilfs_sufile_header *header;\n\tvoid *kaddr;\n\n\tkaddr = kmap_atomic(header_bh->b_page);\n\theader = kaddr + bh_offset(header_bh);\n\tle64_add_cpu(&header->sh_ncleansegs, ncleanadd);\n\tle64_add_cpu(&header->sh_ndirtysegs, ndirtyadd);\n\tkunmap_atomic(kaddr);\n\n\tmark_buffer_dirty(header_bh);\n}"
        }
      },
      {
        "call_info": {
          "callee": "put_bh",
          "args": [
            "bh"
          ],
          "line": 987
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "mark_buffer_dirty",
          "args": [
            "bh"
          ],
          "line": 986
        },
        "resolved": true,
        "details": {
          "function_name": "mark_buffer_dirty",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/buffer.c",
          "lines": "1141-1167",
          "snippet": "void mark_buffer_dirty(struct buffer_head *bh)\n{\n\tWARN_ON_ONCE(!buffer_uptodate(bh));\n\n\ttrace_block_dirty_buffer(bh);\n\n\t/*\n\t * Very *carefully* optimize the it-is-already-dirty case.\n\t *\n\t * Don't let the final \"is it dirty\" escape to before we\n\t * perhaps modified the buffer.\n\t */\n\tif (buffer_dirty(bh)) {\n\t\tsmp_mb();\n\t\tif (buffer_dirty(bh))\n\t\t\treturn;\n\t}\n\n\tif (!test_set_buffer_dirty(bh)) {\n\t\tstruct page *page = bh->b_page;\n\t\tif (!TestSetPageDirty(page)) {\n\t\t\tstruct address_space *mapping = page_mapping(page);\n\t\t\tif (mapping)\n\t\t\t\t__set_page_dirty(page, mapping, 0);\n\t\t}\n\t}\n}",
          "includes": [
            "#include <trace/events/block.h>",
            "#include <linux/bit_spinlock.h>",
            "#include <linux/mpage.h>",
            "#include <linux/bitops.h>",
            "#include <linux/cpu.h>",
            "#include <linux/notifier.h>",
            "#include <linux/bio.h>",
            "#include <linux/task_io_accounting_ops.h>",
            "#include <linux/buffer_head.h>",
            "#include <linux/suspend.h>",
            "#include <linux/hash.h>",
            "#include <linux/writeback.h>",
            "#include <linux/export.h>",
            "#include <linux/highmem.h>",
            "#include <linux/quotaops.h>",
            "#include <linux/file.h>",
            "#include <linux/blkdev.h>",
            "#include <linux/capability.h>",
            "#include <linux/slab.h>",
            "#include <linux/percpu.h>",
            "#include <linux/mm.h>",
            "#include <linux/fs.h>",
            "#include <linux/syscalls.h>",
            "#include <linux/kernel.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <trace/events/block.h>\n#include <linux/bit_spinlock.h>\n#include <linux/mpage.h>\n#include <linux/bitops.h>\n#include <linux/cpu.h>\n#include <linux/notifier.h>\n#include <linux/bio.h>\n#include <linux/task_io_accounting_ops.h>\n#include <linux/buffer_head.h>\n#include <linux/suspend.h>\n#include <linux/hash.h>\n#include <linux/writeback.h>\n#include <linux/export.h>\n#include <linux/highmem.h>\n#include <linux/quotaops.h>\n#include <linux/file.h>\n#include <linux/blkdev.h>\n#include <linux/capability.h>\n#include <linux/slab.h>\n#include <linux/percpu.h>\n#include <linux/mm.h>\n#include <linux/fs.h>\n#include <linux/syscalls.h>\n#include <linux/kernel.h>\n\nvoid mark_buffer_dirty(struct buffer_head *bh)\n{\n\tWARN_ON_ONCE(!buffer_uptodate(bh));\n\n\ttrace_block_dirty_buffer(bh);\n\n\t/*\n\t * Very *carefully* optimize the it-is-already-dirty case.\n\t *\n\t * Don't let the final \"is it dirty\" escape to before we\n\t * perhaps modified the buffer.\n\t */\n\tif (buffer_dirty(bh)) {\n\t\tsmp_mb();\n\t\tif (buffer_dirty(bh))\n\t\t\treturn;\n\t}\n\n\tif (!test_set_buffer_dirty(bh)) {\n\t\tstruct page *page = bh->b_page;\n\t\tif (!TestSetPageDirty(page)) {\n\t\t\tstruct address_space *mapping = page_mapping(page);\n\t\t\tif (mapping)\n\t\t\t\t__set_page_dirty(page, mapping, 0);\n\t\t}\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "unlikely",
          "args": [
            "ret < 0"
          ],
          "line": 983
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "nilfs_mdt_get_block",
          "args": [
            "sufile",
            "blkoff",
            "1",
            "NULL",
            "&bh"
          ],
          "line": 982
        },
        "resolved": true,
        "details": {
          "function_name": "nilfs_mdt_get_block",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/mdt.c",
          "lines": "242-261",
          "snippet": "int nilfs_mdt_get_block(struct inode *inode, unsigned long blkoff, int create,\n\t\t\tvoid (*init_block)(struct inode *,\n\t\t\t\t\t   struct buffer_head *, void *),\n\t\t\tstruct buffer_head **out_bh)\n{\n\tint ret;\n\n\t/* Should be rewritten with merging nilfs_mdt_read_block() */\n retry:\n\tret = nilfs_mdt_read_block(inode, blkoff, !create, out_bh);\n\tif (!create || ret != -ENOENT)\n\t\treturn ret;\n\n\tret = nilfs_mdt_create_block(inode, blkoff, out_bh, init_block);\n\tif (unlikely(ret == -EEXIST)) {\n\t\t/* create = 0; */  /* limit read-create loop retries */\n\t\tgoto retry;\n\t}\n\treturn ret;\n}",
          "includes": [
            "#include \"mdt.h\"",
            "#include \"page.h\"",
            "#include \"segment.h\"",
            "#include \"btnode.h\"",
            "#include \"nilfs.h\"",
            "#include <linux/slab.h>",
            "#include <linux/swap.h>",
            "#include <linux/backing-dev.h>",
            "#include <linux/writeback.h>",
            "#include <linux/mm.h>",
            "#include <linux/mpage.h>",
            "#include <linux/buffer_head.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"mdt.h\"\n#include \"page.h\"\n#include \"segment.h\"\n#include \"btnode.h\"\n#include \"nilfs.h\"\n#include <linux/slab.h>\n#include <linux/swap.h>\n#include <linux/backing-dev.h>\n#include <linux/writeback.h>\n#include <linux/mm.h>\n#include <linux/mpage.h>\n#include <linux/buffer_head.h>\n\nint nilfs_mdt_get_block(struct inode *inode, unsigned long blkoff, int create,\n\t\t\tvoid (*init_block)(struct inode *,\n\t\t\t\t\t   struct buffer_head *, void *),\n\t\t\tstruct buffer_head **out_bh)\n{\n\tint ret;\n\n\t/* Should be rewritten with merging nilfs_mdt_read_block() */\n retry:\n\tret = nilfs_mdt_read_block(inode, blkoff, !create, out_bh);\n\tif (!create || ret != -ENOENT)\n\t\treturn ret;\n\n\tret = nilfs_mdt_create_block(inode, blkoff, out_bh, init_block);\n\tif (unlikely(ret == -EEXIST)) {\n\t\t/* create = 0; */  /* limit read-create loop retries */\n\t\tgoto retry;\n\t}\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "put_bh",
          "args": [
            "bh"
          ],
          "line": 981
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "nilfs_sufile_get_blkoff",
          "args": [
            "sufile",
            "sup->sup_segnum"
          ],
          "line": 975
        },
        "resolved": true,
        "details": {
          "function_name": "nilfs_sufile_get_blkoff",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/sufile.c",
          "lines": "58-64",
          "snippet": "static unsigned long\nnilfs_sufile_get_blkoff(const struct inode *sufile, __u64 segnum)\n{\n\t__u64 t = segnum + NILFS_MDT(sufile)->mi_first_entry_offset;\n\tdo_div(t, nilfs_sufile_segment_usages_per_block(sufile));\n\treturn (unsigned long)t;\n}",
          "includes": [
            "#include \"sufile.h\"",
            "#include \"mdt.h\"",
            "#include <linux/nilfs2_fs.h>",
            "#include <linux/errno.h>",
            "#include <linux/buffer_head.h>",
            "#include <linux/string.h>",
            "#include <linux/fs.h>",
            "#include <linux/kernel.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sufile.h\"\n#include \"mdt.h\"\n#include <linux/nilfs2_fs.h>\n#include <linux/errno.h>\n#include <linux/buffer_head.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n#include <linux/kernel.h>\n\nstatic unsigned long\nnilfs_sufile_get_blkoff(const struct inode *sufile, __u64 segnum)\n{\n\t__u64 t = segnum + NILFS_MDT(sufile)->mi_first_entry_offset;\n\tdo_div(t, nilfs_sufile_segment_usages_per_block(sufile));\n\treturn (unsigned long)t;\n}"
        }
      },
      {
        "call_info": {
          "callee": "kunmap_atomic",
          "args": [
            "kaddr"
          ],
          "line": 968
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "cpu_to_le32",
          "args": [
            "sup->sup_sui.sui_flags"
          ],
          "line": 965
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "nilfs_segment_usage_dirty",
          "args": [
            "su"
          ],
          "line": 953
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "nilfs_suinfo_dirty",
          "args": [
            "&sup->sup_sui"
          ],
          "line": 952
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "nilfs_segment_usage_clean",
          "args": [
            "su"
          ],
          "line": 951
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "nilfs_suinfo_clean",
          "args": [
            "&sup->sup_sui"
          ],
          "line": 950
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "nilfs_suinfo_update_flags",
          "args": [
            "sup"
          ],
          "line": 941
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "cpu_to_le32",
          "args": [
            "sup->sup_sui.sui_nblocks"
          ],
          "line": 939
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "nilfs_suinfo_update_nblocks",
          "args": [
            "sup"
          ],
          "line": 938
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "cpu_to_le64",
          "args": [
            "sup->sup_sui.sui_lastmod"
          ],
          "line": 936
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "nilfs_suinfo_update_lastmod",
          "args": [
            "sup"
          ],
          "line": 935
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "nilfs_sufile_block_get_segment_usage",
          "args": [
            "sufile",
            "sup->sup_segnum",
            "bh",
            "kaddr"
          ],
          "line": 932
        },
        "resolved": true,
        "details": {
          "function_name": "nilfs_sufile_block_get_segment_usage",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/sufile.c",
          "lines": "83-90",
          "snippet": "static struct nilfs_segment_usage *\nnilfs_sufile_block_get_segment_usage(const struct inode *sufile, __u64 segnum,\n\t\t\t\t     struct buffer_head *bh, void *kaddr)\n{\n\treturn kaddr + bh_offset(bh) +\n\t\tnilfs_sufile_get_offset(sufile, segnum) *\n\t\tNILFS_MDT(sufile)->mi_entry_size;\n}",
          "includes": [
            "#include \"sufile.h\"",
            "#include \"mdt.h\"",
            "#include <linux/nilfs2_fs.h>",
            "#include <linux/errno.h>",
            "#include <linux/buffer_head.h>",
            "#include <linux/string.h>",
            "#include <linux/fs.h>",
            "#include <linux/kernel.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sufile.h\"\n#include \"mdt.h\"\n#include <linux/nilfs2_fs.h>\n#include <linux/errno.h>\n#include <linux/buffer_head.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n#include <linux/kernel.h>\n\nstatic struct nilfs_segment_usage *\nnilfs_sufile_block_get_segment_usage(const struct inode *sufile, __u64 segnum,\n\t\t\t\t     struct buffer_head *bh, void *kaddr)\n{\n\treturn kaddr + bh_offset(bh) +\n\t\tnilfs_sufile_get_offset(sufile, segnum) *\n\t\tNILFS_MDT(sufile)->mi_entry_size;\n}"
        }
      },
      {
        "call_info": {
          "callee": "kmap_atomic",
          "args": [
            "bh->b_page"
          ],
          "line": 931
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "nilfs_sufile_get_header_block",
          "args": [
            "sufile",
            "&header_bh"
          ],
          "line": 920
        },
        "resolved": true,
        "details": {
          "function_name": "nilfs_sufile_get_header_block",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/sufile.c",
          "lines": "92-96",
          "snippet": "static inline int nilfs_sufile_get_header_block(struct inode *sufile,\n\t\t\t\t\t\tstruct buffer_head **bhp)\n{\n\treturn nilfs_mdt_get_block(sufile, 0, 0, NULL, bhp);\n}",
          "includes": [
            "#include \"sufile.h\"",
            "#include \"mdt.h\"",
            "#include <linux/nilfs2_fs.h>",
            "#include <linux/errno.h>",
            "#include <linux/buffer_head.h>",
            "#include <linux/string.h>",
            "#include <linux/fs.h>",
            "#include <linux/kernel.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sufile.h\"\n#include \"mdt.h\"\n#include <linux/nilfs2_fs.h>\n#include <linux/errno.h>\n#include <linux/buffer_head.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n#include <linux/kernel.h>\n\nstatic inline int nilfs_sufile_get_header_block(struct inode *sufile,\n\t\t\t\t\t\tstruct buffer_head **bhp)\n{\n\treturn nilfs_mdt_get_block(sufile, 0, 0, NULL, bhp);\n}"
        }
      },
      {
        "call_info": {
          "callee": "down_write",
          "args": [
            "&NILFS_MDT(sufile)->mi_sem"
          ],
          "line": 918
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "nilfs_suinfo_update_nblocks",
          "args": [
            "sup"
          ],
          "line": 912
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "unlikely",
          "args": [
            "nsup == 0"
          ],
          "line": 905
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"sufile.h\"\n#include \"mdt.h\"\n#include <linux/nilfs2_fs.h>\n#include <linux/errno.h>\n#include <linux/buffer_head.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n#include <linux/kernel.h>\n\nssize_t nilfs_sufile_set_suinfo(struct inode *sufile, void *buf,\n\t\t\t\tunsigned supsz, size_t nsup)\n{\n\tstruct the_nilfs *nilfs = sufile->i_sb->s_fs_info;\n\tstruct buffer_head *header_bh, *bh;\n\tstruct nilfs_suinfo_update *sup, *supend = buf + supsz * nsup;\n\tstruct nilfs_segment_usage *su;\n\tvoid *kaddr;\n\tunsigned long blkoff, prev_blkoff;\n\tint cleansi, cleansu, dirtysi, dirtysu;\n\tlong ncleaned = 0, ndirtied = 0;\n\tint ret = 0;\n\n\tif (unlikely(nsup == 0))\n\t\treturn ret;\n\n\tfor (sup = buf; sup < supend; sup = (void *)sup + supsz) {\n\t\tif (sup->sup_segnum >= nilfs->ns_nsegments\n\t\t\t|| (sup->sup_flags &\n\t\t\t\t(~0UL << __NR_NILFS_SUINFO_UPDATE_FIELDS))\n\t\t\t|| (nilfs_suinfo_update_nblocks(sup) &&\n\t\t\t\tsup->sup_sui.sui_nblocks >\n\t\t\t\tnilfs->ns_blocks_per_segment))\n\t\t\treturn -EINVAL;\n\t}\n\n\tdown_write(&NILFS_MDT(sufile)->mi_sem);\n\n\tret = nilfs_sufile_get_header_block(sufile, &header_bh);\n\tif (ret < 0)\n\t\tgoto out_sem;\n\n\tsup = buf;\n\tblkoff = nilfs_sufile_get_blkoff(sufile, sup->sup_segnum);\n\tret = nilfs_mdt_get_block(sufile, blkoff, 1, NULL, &bh);\n\tif (ret < 0)\n\t\tgoto out_header;\n\n\tfor (;;) {\n\t\tkaddr = kmap_atomic(bh->b_page);\n\t\tsu = nilfs_sufile_block_get_segment_usage(\n\t\t\tsufile, sup->sup_segnum, bh, kaddr);\n\n\t\tif (nilfs_suinfo_update_lastmod(sup))\n\t\t\tsu->su_lastmod = cpu_to_le64(sup->sup_sui.sui_lastmod);\n\n\t\tif (nilfs_suinfo_update_nblocks(sup))\n\t\t\tsu->su_nblocks = cpu_to_le32(sup->sup_sui.sui_nblocks);\n\n\t\tif (nilfs_suinfo_update_flags(sup)) {\n\t\t\t/*\n\t\t\t * Active flag is a virtual flag projected by running\n\t\t\t * nilfs kernel code - drop it not to write it to\n\t\t\t * disk.\n\t\t\t */\n\t\t\tsup->sup_sui.sui_flags &=\n\t\t\t\t\t~(1UL << NILFS_SEGMENT_USAGE_ACTIVE);\n\n\t\t\tcleansi = nilfs_suinfo_clean(&sup->sup_sui);\n\t\t\tcleansu = nilfs_segment_usage_clean(su);\n\t\t\tdirtysi = nilfs_suinfo_dirty(&sup->sup_sui);\n\t\t\tdirtysu = nilfs_segment_usage_dirty(su);\n\n\t\t\tif (cleansi && !cleansu)\n\t\t\t\t++ncleaned;\n\t\t\telse if (!cleansi && cleansu)\n\t\t\t\t--ncleaned;\n\n\t\t\tif (dirtysi && !dirtysu)\n\t\t\t\t++ndirtied;\n\t\t\telse if (!dirtysi && dirtysu)\n\t\t\t\t--ndirtied;\n\n\t\t\tsu->su_flags = cpu_to_le32(sup->sup_sui.sui_flags);\n\t\t}\n\n\t\tkunmap_atomic(kaddr);\n\n\t\tsup = (void *)sup + supsz;\n\t\tif (sup >= supend)\n\t\t\tbreak;\n\n\t\tprev_blkoff = blkoff;\n\t\tblkoff = nilfs_sufile_get_blkoff(sufile, sup->sup_segnum);\n\t\tif (blkoff == prev_blkoff)\n\t\t\tcontinue;\n\n\t\t/* get different block */\n\t\tmark_buffer_dirty(bh);\n\t\tput_bh(bh);\n\t\tret = nilfs_mdt_get_block(sufile, blkoff, 1, NULL, &bh);\n\t\tif (unlikely(ret < 0))\n\t\t\tgoto out_mark;\n\t}\n\tmark_buffer_dirty(bh);\n\tput_bh(bh);\n\n out_mark:\n\tif (ncleaned || ndirtied) {\n\t\tnilfs_sufile_mod_counter(header_bh, (u64)ncleaned,\n\t\t\t\t(u64)ndirtied);\n\t\tNILFS_SUI(sufile)->ncleansegs += ncleaned;\n\t}\n\tnilfs_mdt_mark_dirty(sufile);\n out_header:\n\tput_bh(header_bh);\n out_sem:\n\tup_write(&NILFS_MDT(sufile)->mi_sem);\n\treturn ret;\n}"
  },
  {
    "function_name": "nilfs_sufile_get_suinfo",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/sufile.c",
    "lines": "814-870",
    "snippet": "ssize_t nilfs_sufile_get_suinfo(struct inode *sufile, __u64 segnum, void *buf,\n\t\t\t\tunsigned sisz, size_t nsi)\n{\n\tstruct buffer_head *su_bh;\n\tstruct nilfs_segment_usage *su;\n\tstruct nilfs_suinfo *si = buf;\n\tsize_t susz = NILFS_MDT(sufile)->mi_entry_size;\n\tstruct the_nilfs *nilfs = sufile->i_sb->s_fs_info;\n\tvoid *kaddr;\n\tunsigned long nsegs, segusages_per_block;\n\tssize_t n;\n\tint ret, i, j;\n\n\tdown_read(&NILFS_MDT(sufile)->mi_sem);\n\n\tsegusages_per_block = nilfs_sufile_segment_usages_per_block(sufile);\n\tnsegs = min_t(unsigned long,\n\t\t      nilfs_sufile_get_nsegments(sufile) - segnum,\n\t\t      nsi);\n\tfor (i = 0; i < nsegs; i += n, segnum += n) {\n\t\tn = min_t(unsigned long,\n\t\t\t  segusages_per_block -\n\t\t\t\t  nilfs_sufile_get_offset(sufile, segnum),\n\t\t\t  nsegs - i);\n\t\tret = nilfs_sufile_get_segment_usage_block(sufile, segnum, 0,\n\t\t\t\t\t\t\t   &su_bh);\n\t\tif (ret < 0) {\n\t\t\tif (ret != -ENOENT)\n\t\t\t\tgoto out;\n\t\t\t/* hole */\n\t\t\tmemset(si, 0, sisz * n);\n\t\t\tsi = (void *)si + sisz * n;\n\t\t\tcontinue;\n\t\t}\n\n\t\tkaddr = kmap_atomic(su_bh->b_page);\n\t\tsu = nilfs_sufile_block_get_segment_usage(\n\t\t\tsufile, segnum, su_bh, kaddr);\n\t\tfor (j = 0; j < n;\n\t\t     j++, su = (void *)su + susz, si = (void *)si + sisz) {\n\t\t\tsi->sui_lastmod = le64_to_cpu(su->su_lastmod);\n\t\t\tsi->sui_nblocks = le32_to_cpu(su->su_nblocks);\n\t\t\tsi->sui_flags = le32_to_cpu(su->su_flags) &\n\t\t\t\t~(1UL << NILFS_SEGMENT_USAGE_ACTIVE);\n\t\t\tif (nilfs_segment_is_active(nilfs, segnum + j))\n\t\t\t\tsi->sui_flags |=\n\t\t\t\t\t(1UL << NILFS_SEGMENT_USAGE_ACTIVE);\n\t\t}\n\t\tkunmap_atomic(kaddr);\n\t\tbrelse(su_bh);\n\t}\n\tret = nsegs;\n\n out:\n\tup_read(&NILFS_MDT(sufile)->mi_sem);\n\treturn ret;\n}",
    "includes": [
      "#include \"sufile.h\"",
      "#include \"mdt.h\"",
      "#include <linux/nilfs2_fs.h>",
      "#include <linux/errno.h>",
      "#include <linux/buffer_head.h>",
      "#include <linux/string.h>",
      "#include <linux/fs.h>",
      "#include <linux/kernel.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "up_read",
          "args": [
            "&NILFS_MDT(sufile)->mi_sem"
          ],
          "line": 868
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "NILFS_MDT",
          "args": [
            "sufile"
          ],
          "line": 868
        },
        "resolved": true,
        "details": {
          "function_name": "NILFS_MDT",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/mdt.h",
          "lines": "69-72",
          "snippet": "static inline struct nilfs_mdt_info *NILFS_MDT(const struct inode *inode)\n{\n\treturn inode->i_private;\n}",
          "includes": [
            "#include \"page.h\"",
            "#include \"nilfs.h\"",
            "#include <linux/blockgroup_lock.h>",
            "#include <linux/buffer_head.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"page.h\"\n#include \"nilfs.h\"\n#include <linux/blockgroup_lock.h>\n#include <linux/buffer_head.h>\n\nstatic inline struct nilfs_mdt_info *NILFS_MDT(const struct inode *inode)\n{\n\treturn inode->i_private;\n}"
        }
      },
      {
        "call_info": {
          "callee": "brelse",
          "args": [
            "su_bh"
          ],
          "line": 863
        },
        "resolved": true,
        "details": {
          "function_name": "__brelse",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/buffer.c",
          "lines": "1177-1184",
          "snippet": "void __brelse(struct buffer_head * buf)\n{\n\tif (atomic_read(&buf->b_count)) {\n\t\tput_bh(buf);\n\t\treturn;\n\t}\n\tWARN(1, KERN_ERR \"VFS: brelse: Trying to free free buffer\\n\");\n}",
          "includes": [
            "#include <trace/events/block.h>",
            "#include <linux/bit_spinlock.h>",
            "#include <linux/mpage.h>",
            "#include <linux/bitops.h>",
            "#include <linux/cpu.h>",
            "#include <linux/notifier.h>",
            "#include <linux/bio.h>",
            "#include <linux/task_io_accounting_ops.h>",
            "#include <linux/buffer_head.h>",
            "#include <linux/suspend.h>",
            "#include <linux/hash.h>",
            "#include <linux/writeback.h>",
            "#include <linux/export.h>",
            "#include <linux/highmem.h>",
            "#include <linux/quotaops.h>",
            "#include <linux/file.h>",
            "#include <linux/blkdev.h>",
            "#include <linux/capability.h>",
            "#include <linux/slab.h>",
            "#include <linux/percpu.h>",
            "#include <linux/mm.h>",
            "#include <linux/fs.h>",
            "#include <linux/syscalls.h>",
            "#include <linux/kernel.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <trace/events/block.h>\n#include <linux/bit_spinlock.h>\n#include <linux/mpage.h>\n#include <linux/bitops.h>\n#include <linux/cpu.h>\n#include <linux/notifier.h>\n#include <linux/bio.h>\n#include <linux/task_io_accounting_ops.h>\n#include <linux/buffer_head.h>\n#include <linux/suspend.h>\n#include <linux/hash.h>\n#include <linux/writeback.h>\n#include <linux/export.h>\n#include <linux/highmem.h>\n#include <linux/quotaops.h>\n#include <linux/file.h>\n#include <linux/blkdev.h>\n#include <linux/capability.h>\n#include <linux/slab.h>\n#include <linux/percpu.h>\n#include <linux/mm.h>\n#include <linux/fs.h>\n#include <linux/syscalls.h>\n#include <linux/kernel.h>\n\nvoid __brelse(struct buffer_head * buf)\n{\n\tif (atomic_read(&buf->b_count)) {\n\t\tput_bh(buf);\n\t\treturn;\n\t}\n\tWARN(1, KERN_ERR \"VFS: brelse: Trying to free free buffer\\n\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "kunmap_atomic",
          "args": [
            "kaddr"
          ],
          "line": 862
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "nilfs_segment_is_active",
          "args": [
            "nilfs",
            "segnum + j"
          ],
          "line": 858
        },
        "resolved": true,
        "details": {
          "function_name": "nilfs_segment_is_active",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/the_nilfs.h",
          "lines": "371-374",
          "snippet": "static inline int nilfs_segment_is_active(struct the_nilfs *nilfs, __u64 n)\n{\n\treturn n == nilfs->ns_segnum || n == nilfs->ns_nextnum;\n}",
          "includes": [
            "#include <linux/slab.h>",
            "#include <linux/backing-dev.h>",
            "#include <linux/blkdev.h>",
            "#include <linux/fs.h>",
            "#include <linux/rbtree.h>",
            "#include <linux/buffer_head.h>",
            "#include <linux/types.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/slab.h>\n#include <linux/backing-dev.h>\n#include <linux/blkdev.h>\n#include <linux/fs.h>\n#include <linux/rbtree.h>\n#include <linux/buffer_head.h>\n#include <linux/types.h>\n\nstatic inline int nilfs_segment_is_active(struct the_nilfs *nilfs, __u64 n)\n{\n\treturn n == nilfs->ns_segnum || n == nilfs->ns_nextnum;\n}"
        }
      },
      {
        "call_info": {
          "callee": "le32_to_cpu",
          "args": [
            "su->su_flags"
          ],
          "line": 856
        },
        "resolved": true,
        "details": {
          "function_name": "sle32_to_cpup",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/ntfs/endian.h",
          "lines": "53-56",
          "snippet": "static inline s32 sle32_to_cpup(sle32 *x)\n{\n\treturn le32_to_cpu(*(__force le32*)x);\n}",
          "includes": [
            "#include \"types.h\"",
            "#include <asm/byteorder.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"types.h\"\n#include <asm/byteorder.h>\n\nstatic inline s32 sle32_to_cpup(sle32 *x)\n{\n\treturn le32_to_cpu(*(__force le32*)x);\n}"
        }
      },
      {
        "call_info": {
          "callee": "le64_to_cpu",
          "args": [
            "su->su_lastmod"
          ],
          "line": 854
        },
        "resolved": true,
        "details": {
          "function_name": "sle64_to_cpup",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/ntfs/endian.h",
          "lines": "58-61",
          "snippet": "static inline s64 sle64_to_cpup(sle64 *x)\n{\n\treturn le64_to_cpu(*(__force le64*)x);\n}",
          "includes": [
            "#include \"types.h\"",
            "#include <asm/byteorder.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"types.h\"\n#include <asm/byteorder.h>\n\nstatic inline s64 sle64_to_cpup(sle64 *x)\n{\n\treturn le64_to_cpu(*(__force le64*)x);\n}"
        }
      },
      {
        "call_info": {
          "callee": "nilfs_sufile_block_get_segment_usage",
          "args": [
            "sufile",
            "segnum",
            "su_bh",
            "kaddr"
          ],
          "line": 850
        },
        "resolved": true,
        "details": {
          "function_name": "nilfs_sufile_block_get_segment_usage",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/sufile.c",
          "lines": "83-90",
          "snippet": "static struct nilfs_segment_usage *\nnilfs_sufile_block_get_segment_usage(const struct inode *sufile, __u64 segnum,\n\t\t\t\t     struct buffer_head *bh, void *kaddr)\n{\n\treturn kaddr + bh_offset(bh) +\n\t\tnilfs_sufile_get_offset(sufile, segnum) *\n\t\tNILFS_MDT(sufile)->mi_entry_size;\n}",
          "includes": [
            "#include \"sufile.h\"",
            "#include \"mdt.h\"",
            "#include <linux/nilfs2_fs.h>",
            "#include <linux/errno.h>",
            "#include <linux/buffer_head.h>",
            "#include <linux/string.h>",
            "#include <linux/fs.h>",
            "#include <linux/kernel.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sufile.h\"\n#include \"mdt.h\"\n#include <linux/nilfs2_fs.h>\n#include <linux/errno.h>\n#include <linux/buffer_head.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n#include <linux/kernel.h>\n\nstatic struct nilfs_segment_usage *\nnilfs_sufile_block_get_segment_usage(const struct inode *sufile, __u64 segnum,\n\t\t\t\t     struct buffer_head *bh, void *kaddr)\n{\n\treturn kaddr + bh_offset(bh) +\n\t\tnilfs_sufile_get_offset(sufile, segnum) *\n\t\tNILFS_MDT(sufile)->mi_entry_size;\n}"
        }
      },
      {
        "call_info": {
          "callee": "kmap_atomic",
          "args": [
            "su_bh->b_page"
          ],
          "line": 849
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memset",
          "args": [
            "si",
            "0",
            "sisz * n"
          ],
          "line": 844
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "nilfs_sufile_get_segment_usage_block",
          "args": [
            "sufile",
            "segnum",
            "0",
            "&su_bh"
          ],
          "line": 838
        },
        "resolved": true,
        "details": {
          "function_name": "nilfs_sufile_get_segment_usage_block",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/sufile.c",
          "lines": "98-105",
          "snippet": "static inline int\nnilfs_sufile_get_segment_usage_block(struct inode *sufile, __u64 segnum,\n\t\t\t\t     int create, struct buffer_head **bhp)\n{\n\treturn nilfs_mdt_get_block(sufile,\n\t\t\t\t   nilfs_sufile_get_blkoff(sufile, segnum),\n\t\t\t\t   create, NULL, bhp);\n}",
          "includes": [
            "#include \"sufile.h\"",
            "#include \"mdt.h\"",
            "#include <linux/nilfs2_fs.h>",
            "#include <linux/errno.h>",
            "#include <linux/buffer_head.h>",
            "#include <linux/string.h>",
            "#include <linux/fs.h>",
            "#include <linux/kernel.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sufile.h\"\n#include \"mdt.h\"\n#include <linux/nilfs2_fs.h>\n#include <linux/errno.h>\n#include <linux/buffer_head.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n#include <linux/kernel.h>\n\nstatic inline int\nnilfs_sufile_get_segment_usage_block(struct inode *sufile, __u64 segnum,\n\t\t\t\t     int create, struct buffer_head **bhp)\n{\n\treturn nilfs_mdt_get_block(sufile,\n\t\t\t\t   nilfs_sufile_get_blkoff(sufile, segnum),\n\t\t\t\t   create, NULL, bhp);\n}"
        }
      },
      {
        "call_info": {
          "callee": "min_t",
          "args": [
            "unsignedlong",
            "segusages_per_block -\n\t\t\t\t  nilfs_sufile_get_offset(sufile, segnum)",
            "nsegs - i"
          ],
          "line": 834
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "nilfs_sufile_get_offset",
          "args": [
            "sufile",
            "segnum"
          ],
          "line": 836
        },
        "resolved": true,
        "details": {
          "function_name": "nilfs_sufile_get_offset",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/sufile.c",
          "lines": "66-71",
          "snippet": "static unsigned long\nnilfs_sufile_get_offset(const struct inode *sufile, __u64 segnum)\n{\n\t__u64 t = segnum + NILFS_MDT(sufile)->mi_first_entry_offset;\n\treturn do_div(t, nilfs_sufile_segment_usages_per_block(sufile));\n}",
          "includes": [
            "#include \"sufile.h\"",
            "#include \"mdt.h\"",
            "#include <linux/nilfs2_fs.h>",
            "#include <linux/errno.h>",
            "#include <linux/buffer_head.h>",
            "#include <linux/string.h>",
            "#include <linux/fs.h>",
            "#include <linux/kernel.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sufile.h\"\n#include \"mdt.h\"\n#include <linux/nilfs2_fs.h>\n#include <linux/errno.h>\n#include <linux/buffer_head.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n#include <linux/kernel.h>\n\nstatic unsigned long\nnilfs_sufile_get_offset(const struct inode *sufile, __u64 segnum)\n{\n\t__u64 t = segnum + NILFS_MDT(sufile)->mi_first_entry_offset;\n\treturn do_div(t, nilfs_sufile_segment_usages_per_block(sufile));\n}"
        }
      },
      {
        "call_info": {
          "callee": "min_t",
          "args": [
            "unsignedlong",
            "nilfs_sufile_get_nsegments(sufile) - segnum",
            "nsi"
          ],
          "line": 830
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "nilfs_sufile_get_nsegments",
          "args": [
            "sufile"
          ],
          "line": 831
        },
        "resolved": true,
        "details": {
          "function_name": "nilfs_sufile_get_nsegments",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/sufile.h",
          "lines": "32-35",
          "snippet": "static inline unsigned long nilfs_sufile_get_nsegments(struct inode *sufile)\n{\n\treturn ((struct the_nilfs *)sufile->i_sb->s_fs_info)->ns_nsegments;\n}",
          "includes": [
            "#include \"mdt.h\"",
            "#include <linux/nilfs2_fs.h>",
            "#include <linux/buffer_head.h>",
            "#include <linux/fs.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"mdt.h\"\n#include <linux/nilfs2_fs.h>\n#include <linux/buffer_head.h>\n#include <linux/fs.h>\n\nstatic inline unsigned long nilfs_sufile_get_nsegments(struct inode *sufile)\n{\n\treturn ((struct the_nilfs *)sufile->i_sb->s_fs_info)->ns_nsegments;\n}"
        }
      },
      {
        "call_info": {
          "callee": "nilfs_sufile_segment_usages_per_block",
          "args": [
            "sufile"
          ],
          "line": 829
        },
        "resolved": true,
        "details": {
          "function_name": "nilfs_sufile_segment_usages_per_block",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/sufile.c",
          "lines": "52-56",
          "snippet": "static inline unsigned long\nnilfs_sufile_segment_usages_per_block(const struct inode *sufile)\n{\n\treturn NILFS_MDT(sufile)->mi_entries_per_block;\n}",
          "includes": [
            "#include \"sufile.h\"",
            "#include \"mdt.h\"",
            "#include <linux/nilfs2_fs.h>",
            "#include <linux/errno.h>",
            "#include <linux/buffer_head.h>",
            "#include <linux/string.h>",
            "#include <linux/fs.h>",
            "#include <linux/kernel.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sufile.h\"\n#include \"mdt.h\"\n#include <linux/nilfs2_fs.h>\n#include <linux/errno.h>\n#include <linux/buffer_head.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n#include <linux/kernel.h>\n\nstatic inline unsigned long\nnilfs_sufile_segment_usages_per_block(const struct inode *sufile)\n{\n\treturn NILFS_MDT(sufile)->mi_entries_per_block;\n}"
        }
      },
      {
        "call_info": {
          "callee": "down_read",
          "args": [
            "&NILFS_MDT(sufile)->mi_sem"
          ],
          "line": 827
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"sufile.h\"\n#include \"mdt.h\"\n#include <linux/nilfs2_fs.h>\n#include <linux/errno.h>\n#include <linux/buffer_head.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n#include <linux/kernel.h>\n\nssize_t nilfs_sufile_get_suinfo(struct inode *sufile, __u64 segnum, void *buf,\n\t\t\t\tunsigned sisz, size_t nsi)\n{\n\tstruct buffer_head *su_bh;\n\tstruct nilfs_segment_usage *su;\n\tstruct nilfs_suinfo *si = buf;\n\tsize_t susz = NILFS_MDT(sufile)->mi_entry_size;\n\tstruct the_nilfs *nilfs = sufile->i_sb->s_fs_info;\n\tvoid *kaddr;\n\tunsigned long nsegs, segusages_per_block;\n\tssize_t n;\n\tint ret, i, j;\n\n\tdown_read(&NILFS_MDT(sufile)->mi_sem);\n\n\tsegusages_per_block = nilfs_sufile_segment_usages_per_block(sufile);\n\tnsegs = min_t(unsigned long,\n\t\t      nilfs_sufile_get_nsegments(sufile) - segnum,\n\t\t      nsi);\n\tfor (i = 0; i < nsegs; i += n, segnum += n) {\n\t\tn = min_t(unsigned long,\n\t\t\t  segusages_per_block -\n\t\t\t\t  nilfs_sufile_get_offset(sufile, segnum),\n\t\t\t  nsegs - i);\n\t\tret = nilfs_sufile_get_segment_usage_block(sufile, segnum, 0,\n\t\t\t\t\t\t\t   &su_bh);\n\t\tif (ret < 0) {\n\t\t\tif (ret != -ENOENT)\n\t\t\t\tgoto out;\n\t\t\t/* hole */\n\t\t\tmemset(si, 0, sisz * n);\n\t\t\tsi = (void *)si + sisz * n;\n\t\t\tcontinue;\n\t\t}\n\n\t\tkaddr = kmap_atomic(su_bh->b_page);\n\t\tsu = nilfs_sufile_block_get_segment_usage(\n\t\t\tsufile, segnum, su_bh, kaddr);\n\t\tfor (j = 0; j < n;\n\t\t     j++, su = (void *)su + susz, si = (void *)si + sisz) {\n\t\t\tsi->sui_lastmod = le64_to_cpu(su->su_lastmod);\n\t\t\tsi->sui_nblocks = le32_to_cpu(su->su_nblocks);\n\t\t\tsi->sui_flags = le32_to_cpu(su->su_flags) &\n\t\t\t\t~(1UL << NILFS_SEGMENT_USAGE_ACTIVE);\n\t\t\tif (nilfs_segment_is_active(nilfs, segnum + j))\n\t\t\t\tsi->sui_flags |=\n\t\t\t\t\t(1UL << NILFS_SEGMENT_USAGE_ACTIVE);\n\t\t}\n\t\tkunmap_atomic(kaddr);\n\t\tbrelse(su_bh);\n\t}\n\tret = nsegs;\n\n out:\n\tup_read(&NILFS_MDT(sufile)->mi_sem);\n\treturn ret;\n}"
  },
  {
    "function_name": "nilfs_sufile_resize",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/sufile.c",
    "lines": "746-795",
    "snippet": "int nilfs_sufile_resize(struct inode *sufile, __u64 newnsegs)\n{\n\tstruct the_nilfs *nilfs = sufile->i_sb->s_fs_info;\n\tstruct buffer_head *header_bh;\n\tstruct nilfs_sufile_header *header;\n\tstruct nilfs_sufile_info *sui = NILFS_SUI(sufile);\n\tvoid *kaddr;\n\tunsigned long nsegs, nrsvsegs;\n\tint ret = 0;\n\n\tdown_write(&NILFS_MDT(sufile)->mi_sem);\n\n\tnsegs = nilfs_sufile_get_nsegments(sufile);\n\tif (nsegs == newnsegs)\n\t\tgoto out;\n\n\tret = -ENOSPC;\n\tnrsvsegs = nilfs_nrsvsegs(nilfs, newnsegs);\n\tif (newnsegs < nsegs && nsegs - newnsegs + nrsvsegs > sui->ncleansegs)\n\t\tgoto out;\n\n\tret = nilfs_sufile_get_header_block(sufile, &header_bh);\n\tif (ret < 0)\n\t\tgoto out;\n\n\tif (newnsegs > nsegs) {\n\t\tsui->ncleansegs += newnsegs - nsegs;\n\t} else /* newnsegs < nsegs */ {\n\t\tret = nilfs_sufile_truncate_range(sufile, newnsegs, nsegs - 1);\n\t\tif (ret < 0)\n\t\t\tgoto out_header;\n\n\t\tsui->ncleansegs -= nsegs - newnsegs;\n\t}\n\n\tkaddr = kmap_atomic(header_bh->b_page);\n\theader = kaddr + bh_offset(header_bh);\n\theader->sh_ncleansegs = cpu_to_le64(sui->ncleansegs);\n\tkunmap_atomic(kaddr);\n\n\tmark_buffer_dirty(header_bh);\n\tnilfs_mdt_mark_dirty(sufile);\n\tnilfs_set_nsegments(nilfs, newnsegs);\n\nout_header:\n\tbrelse(header_bh);\nout:\n\tup_write(&NILFS_MDT(sufile)->mi_sem);\n\treturn ret;\n}",
    "includes": [
      "#include \"sufile.h\"",
      "#include \"mdt.h\"",
      "#include <linux/nilfs2_fs.h>",
      "#include <linux/errno.h>",
      "#include <linux/buffer_head.h>",
      "#include <linux/string.h>",
      "#include <linux/fs.h>",
      "#include <linux/kernel.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "up_write",
          "args": [
            "&NILFS_MDT(sufile)->mi_sem"
          ],
          "line": 793
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "NILFS_MDT",
          "args": [
            "sufile"
          ],
          "line": 793
        },
        "resolved": true,
        "details": {
          "function_name": "NILFS_MDT",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/mdt.h",
          "lines": "69-72",
          "snippet": "static inline struct nilfs_mdt_info *NILFS_MDT(const struct inode *inode)\n{\n\treturn inode->i_private;\n}",
          "includes": [
            "#include \"page.h\"",
            "#include \"nilfs.h\"",
            "#include <linux/blockgroup_lock.h>",
            "#include <linux/buffer_head.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"page.h\"\n#include \"nilfs.h\"\n#include <linux/blockgroup_lock.h>\n#include <linux/buffer_head.h>\n\nstatic inline struct nilfs_mdt_info *NILFS_MDT(const struct inode *inode)\n{\n\treturn inode->i_private;\n}"
        }
      },
      {
        "call_info": {
          "callee": "brelse",
          "args": [
            "header_bh"
          ],
          "line": 791
        },
        "resolved": true,
        "details": {
          "function_name": "__brelse",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/buffer.c",
          "lines": "1177-1184",
          "snippet": "void __brelse(struct buffer_head * buf)\n{\n\tif (atomic_read(&buf->b_count)) {\n\t\tput_bh(buf);\n\t\treturn;\n\t}\n\tWARN(1, KERN_ERR \"VFS: brelse: Trying to free free buffer\\n\");\n}",
          "includes": [
            "#include <trace/events/block.h>",
            "#include <linux/bit_spinlock.h>",
            "#include <linux/mpage.h>",
            "#include <linux/bitops.h>",
            "#include <linux/cpu.h>",
            "#include <linux/notifier.h>",
            "#include <linux/bio.h>",
            "#include <linux/task_io_accounting_ops.h>",
            "#include <linux/buffer_head.h>",
            "#include <linux/suspend.h>",
            "#include <linux/hash.h>",
            "#include <linux/writeback.h>",
            "#include <linux/export.h>",
            "#include <linux/highmem.h>",
            "#include <linux/quotaops.h>",
            "#include <linux/file.h>",
            "#include <linux/blkdev.h>",
            "#include <linux/capability.h>",
            "#include <linux/slab.h>",
            "#include <linux/percpu.h>",
            "#include <linux/mm.h>",
            "#include <linux/fs.h>",
            "#include <linux/syscalls.h>",
            "#include <linux/kernel.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <trace/events/block.h>\n#include <linux/bit_spinlock.h>\n#include <linux/mpage.h>\n#include <linux/bitops.h>\n#include <linux/cpu.h>\n#include <linux/notifier.h>\n#include <linux/bio.h>\n#include <linux/task_io_accounting_ops.h>\n#include <linux/buffer_head.h>\n#include <linux/suspend.h>\n#include <linux/hash.h>\n#include <linux/writeback.h>\n#include <linux/export.h>\n#include <linux/highmem.h>\n#include <linux/quotaops.h>\n#include <linux/file.h>\n#include <linux/blkdev.h>\n#include <linux/capability.h>\n#include <linux/slab.h>\n#include <linux/percpu.h>\n#include <linux/mm.h>\n#include <linux/fs.h>\n#include <linux/syscalls.h>\n#include <linux/kernel.h>\n\nvoid __brelse(struct buffer_head * buf)\n{\n\tif (atomic_read(&buf->b_count)) {\n\t\tput_bh(buf);\n\t\treturn;\n\t}\n\tWARN(1, KERN_ERR \"VFS: brelse: Trying to free free buffer\\n\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "nilfs_set_nsegments",
          "args": [
            "nilfs",
            "newnsegs"
          ],
          "line": 788
        },
        "resolved": true,
        "details": {
          "function_name": "nilfs_set_nsegments",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/the_nilfs.c",
          "lines": "381-385",
          "snippet": "void nilfs_set_nsegments(struct the_nilfs *nilfs, unsigned long nsegs)\n{\n\tnilfs->ns_nsegments = nsegs;\n\tnilfs->ns_nrsvsegs = nilfs_nrsvsegs(nilfs, nsegs);\n}",
          "includes": [
            "#include \"segbuf.h\"",
            "#include \"dat.h\"",
            "#include \"sufile.h\"",
            "#include \"cpfile.h\"",
            "#include \"alloc.h\"",
            "#include \"segment.h\"",
            "#include \"nilfs.h\"",
            "#include <linux/crc32.h>",
            "#include <linux/random.h>",
            "#include <linux/backing-dev.h>",
            "#include <linux/blkdev.h>",
            "#include <linux/slab.h>",
            "#include <linux/buffer_head.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"segbuf.h\"\n#include \"dat.h\"\n#include \"sufile.h\"\n#include \"cpfile.h\"\n#include \"alloc.h\"\n#include \"segment.h\"\n#include \"nilfs.h\"\n#include <linux/crc32.h>\n#include <linux/random.h>\n#include <linux/backing-dev.h>\n#include <linux/blkdev.h>\n#include <linux/slab.h>\n#include <linux/buffer_head.h>\n\nvoid nilfs_set_nsegments(struct the_nilfs *nilfs, unsigned long nsegs)\n{\n\tnilfs->ns_nsegments = nsegs;\n\tnilfs->ns_nrsvsegs = nilfs_nrsvsegs(nilfs, nsegs);\n}"
        }
      },
      {
        "call_info": {
          "callee": "nilfs_mdt_mark_dirty",
          "args": [
            "sufile"
          ],
          "line": 787
        },
        "resolved": true,
        "details": {
          "function_name": "nilfs_mdt_mark_dirty",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/mdt.h",
          "lines": "98-102",
          "snippet": "static inline void nilfs_mdt_mark_dirty(struct inode *inode)\n{\n\tif (!test_bit(NILFS_I_DIRTY, &NILFS_I(inode)->i_state))\n\t\tset_bit(NILFS_I_DIRTY, &NILFS_I(inode)->i_state);\n}",
          "includes": [
            "#include \"page.h\"",
            "#include \"nilfs.h\"",
            "#include <linux/blockgroup_lock.h>",
            "#include <linux/buffer_head.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"page.h\"\n#include \"nilfs.h\"\n#include <linux/blockgroup_lock.h>\n#include <linux/buffer_head.h>\n\nstatic inline void nilfs_mdt_mark_dirty(struct inode *inode)\n{\n\tif (!test_bit(NILFS_I_DIRTY, &NILFS_I(inode)->i_state))\n\t\tset_bit(NILFS_I_DIRTY, &NILFS_I(inode)->i_state);\n}"
        }
      },
      {
        "call_info": {
          "callee": "mark_buffer_dirty",
          "args": [
            "header_bh"
          ],
          "line": 786
        },
        "resolved": true,
        "details": {
          "function_name": "mark_buffer_dirty",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/buffer.c",
          "lines": "1141-1167",
          "snippet": "void mark_buffer_dirty(struct buffer_head *bh)\n{\n\tWARN_ON_ONCE(!buffer_uptodate(bh));\n\n\ttrace_block_dirty_buffer(bh);\n\n\t/*\n\t * Very *carefully* optimize the it-is-already-dirty case.\n\t *\n\t * Don't let the final \"is it dirty\" escape to before we\n\t * perhaps modified the buffer.\n\t */\n\tif (buffer_dirty(bh)) {\n\t\tsmp_mb();\n\t\tif (buffer_dirty(bh))\n\t\t\treturn;\n\t}\n\n\tif (!test_set_buffer_dirty(bh)) {\n\t\tstruct page *page = bh->b_page;\n\t\tif (!TestSetPageDirty(page)) {\n\t\t\tstruct address_space *mapping = page_mapping(page);\n\t\t\tif (mapping)\n\t\t\t\t__set_page_dirty(page, mapping, 0);\n\t\t}\n\t}\n}",
          "includes": [
            "#include <trace/events/block.h>",
            "#include <linux/bit_spinlock.h>",
            "#include <linux/mpage.h>",
            "#include <linux/bitops.h>",
            "#include <linux/cpu.h>",
            "#include <linux/notifier.h>",
            "#include <linux/bio.h>",
            "#include <linux/task_io_accounting_ops.h>",
            "#include <linux/buffer_head.h>",
            "#include <linux/suspend.h>",
            "#include <linux/hash.h>",
            "#include <linux/writeback.h>",
            "#include <linux/export.h>",
            "#include <linux/highmem.h>",
            "#include <linux/quotaops.h>",
            "#include <linux/file.h>",
            "#include <linux/blkdev.h>",
            "#include <linux/capability.h>",
            "#include <linux/slab.h>",
            "#include <linux/percpu.h>",
            "#include <linux/mm.h>",
            "#include <linux/fs.h>",
            "#include <linux/syscalls.h>",
            "#include <linux/kernel.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <trace/events/block.h>\n#include <linux/bit_spinlock.h>\n#include <linux/mpage.h>\n#include <linux/bitops.h>\n#include <linux/cpu.h>\n#include <linux/notifier.h>\n#include <linux/bio.h>\n#include <linux/task_io_accounting_ops.h>\n#include <linux/buffer_head.h>\n#include <linux/suspend.h>\n#include <linux/hash.h>\n#include <linux/writeback.h>\n#include <linux/export.h>\n#include <linux/highmem.h>\n#include <linux/quotaops.h>\n#include <linux/file.h>\n#include <linux/blkdev.h>\n#include <linux/capability.h>\n#include <linux/slab.h>\n#include <linux/percpu.h>\n#include <linux/mm.h>\n#include <linux/fs.h>\n#include <linux/syscalls.h>\n#include <linux/kernel.h>\n\nvoid mark_buffer_dirty(struct buffer_head *bh)\n{\n\tWARN_ON_ONCE(!buffer_uptodate(bh));\n\n\ttrace_block_dirty_buffer(bh);\n\n\t/*\n\t * Very *carefully* optimize the it-is-already-dirty case.\n\t *\n\t * Don't let the final \"is it dirty\" escape to before we\n\t * perhaps modified the buffer.\n\t */\n\tif (buffer_dirty(bh)) {\n\t\tsmp_mb();\n\t\tif (buffer_dirty(bh))\n\t\t\treturn;\n\t}\n\n\tif (!test_set_buffer_dirty(bh)) {\n\t\tstruct page *page = bh->b_page;\n\t\tif (!TestSetPageDirty(page)) {\n\t\t\tstruct address_space *mapping = page_mapping(page);\n\t\t\tif (mapping)\n\t\t\t\t__set_page_dirty(page, mapping, 0);\n\t\t}\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "kunmap_atomic",
          "args": [
            "kaddr"
          ],
          "line": 784
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "cpu_to_le64",
          "args": [
            "sui->ncleansegs"
          ],
          "line": 783
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bh_offset",
          "args": [
            "header_bh"
          ],
          "line": 782
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kmap_atomic",
          "args": [
            "header_bh->b_page"
          ],
          "line": 781
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "nilfs_sufile_truncate_range",
          "args": [
            "sufile",
            "newnsegs",
            "nsegs - 1"
          ],
          "line": 774
        },
        "resolved": true,
        "details": {
          "function_name": "nilfs_sufile_truncate_range",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/sufile.c",
          "lines": "642-728",
          "snippet": "static int nilfs_sufile_truncate_range(struct inode *sufile,\n\t\t\t\t       __u64 start, __u64 end)\n{\n\tstruct the_nilfs *nilfs = sufile->i_sb->s_fs_info;\n\tstruct buffer_head *header_bh;\n\tstruct buffer_head *su_bh;\n\tstruct nilfs_segment_usage *su, *su2;\n\tsize_t susz = NILFS_MDT(sufile)->mi_entry_size;\n\tunsigned long segusages_per_block;\n\tunsigned long nsegs, ncleaned;\n\t__u64 segnum;\n\tvoid *kaddr;\n\tssize_t n, nc;\n\tint ret;\n\tint j;\n\n\tnsegs = nilfs_sufile_get_nsegments(sufile);\n\n\tret = -EINVAL;\n\tif (start > end || start >= nsegs)\n\t\tgoto out;\n\n\tret = nilfs_sufile_get_header_block(sufile, &header_bh);\n\tif (ret < 0)\n\t\tgoto out;\n\n\tsegusages_per_block = nilfs_sufile_segment_usages_per_block(sufile);\n\tncleaned = 0;\n\n\tfor (segnum = start; segnum <= end; segnum += n) {\n\t\tn = min_t(unsigned long,\n\t\t\t  segusages_per_block -\n\t\t\t\t  nilfs_sufile_get_offset(sufile, segnum),\n\t\t\t  end - segnum + 1);\n\t\tret = nilfs_sufile_get_segment_usage_block(sufile, segnum, 0,\n\t\t\t\t\t\t\t   &su_bh);\n\t\tif (ret < 0) {\n\t\t\tif (ret != -ENOENT)\n\t\t\t\tgoto out_header;\n\t\t\t/* hole */\n\t\t\tcontinue;\n\t\t}\n\t\tkaddr = kmap_atomic(su_bh->b_page);\n\t\tsu = nilfs_sufile_block_get_segment_usage(\n\t\t\tsufile, segnum, su_bh, kaddr);\n\t\tsu2 = su;\n\t\tfor (j = 0; j < n; j++, su = (void *)su + susz) {\n\t\t\tif ((le32_to_cpu(su->su_flags) &\n\t\t\t     ~(1UL << NILFS_SEGMENT_USAGE_ERROR)) ||\n\t\t\t    nilfs_segment_is_active(nilfs, segnum + j)) {\n\t\t\t\tret = -EBUSY;\n\t\t\t\tkunmap_atomic(kaddr);\n\t\t\t\tbrelse(su_bh);\n\t\t\t\tgoto out_header;\n\t\t\t}\n\t\t}\n\t\tnc = 0;\n\t\tfor (su = su2, j = 0; j < n; j++, su = (void *)su + susz) {\n\t\t\tif (nilfs_segment_usage_error(su)) {\n\t\t\t\tnilfs_segment_usage_set_clean(su);\n\t\t\t\tnc++;\n\t\t\t}\n\t\t}\n\t\tkunmap_atomic(kaddr);\n\t\tif (nc > 0) {\n\t\t\tmark_buffer_dirty(su_bh);\n\t\t\tncleaned += nc;\n\t\t}\n\t\tbrelse(su_bh);\n\n\t\tif (n == segusages_per_block) {\n\t\t\t/* make hole */\n\t\t\tnilfs_sufile_delete_segment_usage_block(sufile, segnum);\n\t\t}\n\t}\n\tret = 0;\n\nout_header:\n\tif (ncleaned > 0) {\n\t\tNILFS_SUI(sufile)->ncleansegs += ncleaned;\n\t\tnilfs_sufile_mod_counter(header_bh, ncleaned, 0);\n\t\tnilfs_mdt_mark_dirty(sufile);\n\t}\n\tbrelse(header_bh);\nout:\n\treturn ret;\n}",
          "includes": [
            "#include \"sufile.h\"",
            "#include \"mdt.h\"",
            "#include <linux/nilfs2_fs.h>",
            "#include <linux/errno.h>",
            "#include <linux/buffer_head.h>",
            "#include <linux/string.h>",
            "#include <linux/fs.h>",
            "#include <linux/kernel.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sufile.h\"\n#include \"mdt.h\"\n#include <linux/nilfs2_fs.h>\n#include <linux/errno.h>\n#include <linux/buffer_head.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n#include <linux/kernel.h>\n\nstatic int nilfs_sufile_truncate_range(struct inode *sufile,\n\t\t\t\t       __u64 start, __u64 end)\n{\n\tstruct the_nilfs *nilfs = sufile->i_sb->s_fs_info;\n\tstruct buffer_head *header_bh;\n\tstruct buffer_head *su_bh;\n\tstruct nilfs_segment_usage *su, *su2;\n\tsize_t susz = NILFS_MDT(sufile)->mi_entry_size;\n\tunsigned long segusages_per_block;\n\tunsigned long nsegs, ncleaned;\n\t__u64 segnum;\n\tvoid *kaddr;\n\tssize_t n, nc;\n\tint ret;\n\tint j;\n\n\tnsegs = nilfs_sufile_get_nsegments(sufile);\n\n\tret = -EINVAL;\n\tif (start > end || start >= nsegs)\n\t\tgoto out;\n\n\tret = nilfs_sufile_get_header_block(sufile, &header_bh);\n\tif (ret < 0)\n\t\tgoto out;\n\n\tsegusages_per_block = nilfs_sufile_segment_usages_per_block(sufile);\n\tncleaned = 0;\n\n\tfor (segnum = start; segnum <= end; segnum += n) {\n\t\tn = min_t(unsigned long,\n\t\t\t  segusages_per_block -\n\t\t\t\t  nilfs_sufile_get_offset(sufile, segnum),\n\t\t\t  end - segnum + 1);\n\t\tret = nilfs_sufile_get_segment_usage_block(sufile, segnum, 0,\n\t\t\t\t\t\t\t   &su_bh);\n\t\tif (ret < 0) {\n\t\t\tif (ret != -ENOENT)\n\t\t\t\tgoto out_header;\n\t\t\t/* hole */\n\t\t\tcontinue;\n\t\t}\n\t\tkaddr = kmap_atomic(su_bh->b_page);\n\t\tsu = nilfs_sufile_block_get_segment_usage(\n\t\t\tsufile, segnum, su_bh, kaddr);\n\t\tsu2 = su;\n\t\tfor (j = 0; j < n; j++, su = (void *)su + susz) {\n\t\t\tif ((le32_to_cpu(su->su_flags) &\n\t\t\t     ~(1UL << NILFS_SEGMENT_USAGE_ERROR)) ||\n\t\t\t    nilfs_segment_is_active(nilfs, segnum + j)) {\n\t\t\t\tret = -EBUSY;\n\t\t\t\tkunmap_atomic(kaddr);\n\t\t\t\tbrelse(su_bh);\n\t\t\t\tgoto out_header;\n\t\t\t}\n\t\t}\n\t\tnc = 0;\n\t\tfor (su = su2, j = 0; j < n; j++, su = (void *)su + susz) {\n\t\t\tif (nilfs_segment_usage_error(su)) {\n\t\t\t\tnilfs_segment_usage_set_clean(su);\n\t\t\t\tnc++;\n\t\t\t}\n\t\t}\n\t\tkunmap_atomic(kaddr);\n\t\tif (nc > 0) {\n\t\t\tmark_buffer_dirty(su_bh);\n\t\t\tncleaned += nc;\n\t\t}\n\t\tbrelse(su_bh);\n\n\t\tif (n == segusages_per_block) {\n\t\t\t/* make hole */\n\t\t\tnilfs_sufile_delete_segment_usage_block(sufile, segnum);\n\t\t}\n\t}\n\tret = 0;\n\nout_header:\n\tif (ncleaned > 0) {\n\t\tNILFS_SUI(sufile)->ncleansegs += ncleaned;\n\t\tnilfs_sufile_mod_counter(header_bh, ncleaned, 0);\n\t\tnilfs_mdt_mark_dirty(sufile);\n\t}\n\tbrelse(header_bh);\nout:\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "nilfs_sufile_get_header_block",
          "args": [
            "sufile",
            "&header_bh"
          ],
          "line": 767
        },
        "resolved": true,
        "details": {
          "function_name": "nilfs_sufile_get_header_block",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/sufile.c",
          "lines": "92-96",
          "snippet": "static inline int nilfs_sufile_get_header_block(struct inode *sufile,\n\t\t\t\t\t\tstruct buffer_head **bhp)\n{\n\treturn nilfs_mdt_get_block(sufile, 0, 0, NULL, bhp);\n}",
          "includes": [
            "#include \"sufile.h\"",
            "#include \"mdt.h\"",
            "#include <linux/nilfs2_fs.h>",
            "#include <linux/errno.h>",
            "#include <linux/buffer_head.h>",
            "#include <linux/string.h>",
            "#include <linux/fs.h>",
            "#include <linux/kernel.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sufile.h\"\n#include \"mdt.h\"\n#include <linux/nilfs2_fs.h>\n#include <linux/errno.h>\n#include <linux/buffer_head.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n#include <linux/kernel.h>\n\nstatic inline int nilfs_sufile_get_header_block(struct inode *sufile,\n\t\t\t\t\t\tstruct buffer_head **bhp)\n{\n\treturn nilfs_mdt_get_block(sufile, 0, 0, NULL, bhp);\n}"
        }
      },
      {
        "call_info": {
          "callee": "nilfs_nrsvsegs",
          "args": [
            "nilfs",
            "newnsegs"
          ],
          "line": 763
        },
        "resolved": true,
        "details": {
          "function_name": "nilfs_nrsvsegs",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/the_nilfs.c",
          "lines": "374-379",
          "snippet": "unsigned long nilfs_nrsvsegs(struct the_nilfs *nilfs, unsigned long nsegs)\n{\n\treturn max_t(unsigned long, NILFS_MIN_NRSVSEGS,\n\t\t     DIV_ROUND_UP(nsegs * nilfs->ns_r_segments_percentage,\n\t\t\t\t  100));\n}",
          "includes": [
            "#include \"segbuf.h\"",
            "#include \"dat.h\"",
            "#include \"sufile.h\"",
            "#include \"cpfile.h\"",
            "#include \"alloc.h\"",
            "#include \"segment.h\"",
            "#include \"nilfs.h\"",
            "#include <linux/crc32.h>",
            "#include <linux/random.h>",
            "#include <linux/backing-dev.h>",
            "#include <linux/blkdev.h>",
            "#include <linux/slab.h>",
            "#include <linux/buffer_head.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"segbuf.h\"\n#include \"dat.h\"\n#include \"sufile.h\"\n#include \"cpfile.h\"\n#include \"alloc.h\"\n#include \"segment.h\"\n#include \"nilfs.h\"\n#include <linux/crc32.h>\n#include <linux/random.h>\n#include <linux/backing-dev.h>\n#include <linux/blkdev.h>\n#include <linux/slab.h>\n#include <linux/buffer_head.h>\n\nunsigned long nilfs_nrsvsegs(struct the_nilfs *nilfs, unsigned long nsegs)\n{\n\treturn max_t(unsigned long, NILFS_MIN_NRSVSEGS,\n\t\t     DIV_ROUND_UP(nsegs * nilfs->ns_r_segments_percentage,\n\t\t\t\t  100));\n}"
        }
      },
      {
        "call_info": {
          "callee": "nilfs_sufile_get_nsegments",
          "args": [
            "sufile"
          ],
          "line": 758
        },
        "resolved": true,
        "details": {
          "function_name": "nilfs_sufile_get_nsegments",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/sufile.h",
          "lines": "32-35",
          "snippet": "static inline unsigned long nilfs_sufile_get_nsegments(struct inode *sufile)\n{\n\treturn ((struct the_nilfs *)sufile->i_sb->s_fs_info)->ns_nsegments;\n}",
          "includes": [
            "#include \"mdt.h\"",
            "#include <linux/nilfs2_fs.h>",
            "#include <linux/buffer_head.h>",
            "#include <linux/fs.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"mdt.h\"\n#include <linux/nilfs2_fs.h>\n#include <linux/buffer_head.h>\n#include <linux/fs.h>\n\nstatic inline unsigned long nilfs_sufile_get_nsegments(struct inode *sufile)\n{\n\treturn ((struct the_nilfs *)sufile->i_sb->s_fs_info)->ns_nsegments;\n}"
        }
      },
      {
        "call_info": {
          "callee": "down_write",
          "args": [
            "&NILFS_MDT(sufile)->mi_sem"
          ],
          "line": 756
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "NILFS_SUI",
          "args": [
            "sufile"
          ],
          "line": 751
        },
        "resolved": true,
        "details": {
          "function_name": "NILFS_SUI",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/sufile.c",
          "lines": "47-50",
          "snippet": "static inline struct nilfs_sufile_info *NILFS_SUI(struct inode *sufile)\n{\n\treturn (struct nilfs_sufile_info *)NILFS_MDT(sufile);\n}",
          "includes": [
            "#include \"sufile.h\"",
            "#include \"mdt.h\"",
            "#include <linux/nilfs2_fs.h>",
            "#include <linux/errno.h>",
            "#include <linux/buffer_head.h>",
            "#include <linux/string.h>",
            "#include <linux/fs.h>",
            "#include <linux/kernel.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sufile.h\"\n#include \"mdt.h\"\n#include <linux/nilfs2_fs.h>\n#include <linux/errno.h>\n#include <linux/buffer_head.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n#include <linux/kernel.h>\n\nstatic inline struct nilfs_sufile_info *NILFS_SUI(struct inode *sufile)\n{\n\treturn (struct nilfs_sufile_info *)NILFS_MDT(sufile);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"sufile.h\"\n#include \"mdt.h\"\n#include <linux/nilfs2_fs.h>\n#include <linux/errno.h>\n#include <linux/buffer_head.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n#include <linux/kernel.h>\n\nint nilfs_sufile_resize(struct inode *sufile, __u64 newnsegs)\n{\n\tstruct the_nilfs *nilfs = sufile->i_sb->s_fs_info;\n\tstruct buffer_head *header_bh;\n\tstruct nilfs_sufile_header *header;\n\tstruct nilfs_sufile_info *sui = NILFS_SUI(sufile);\n\tvoid *kaddr;\n\tunsigned long nsegs, nrsvsegs;\n\tint ret = 0;\n\n\tdown_write(&NILFS_MDT(sufile)->mi_sem);\n\n\tnsegs = nilfs_sufile_get_nsegments(sufile);\n\tif (nsegs == newnsegs)\n\t\tgoto out;\n\n\tret = -ENOSPC;\n\tnrsvsegs = nilfs_nrsvsegs(nilfs, newnsegs);\n\tif (newnsegs < nsegs && nsegs - newnsegs + nrsvsegs > sui->ncleansegs)\n\t\tgoto out;\n\n\tret = nilfs_sufile_get_header_block(sufile, &header_bh);\n\tif (ret < 0)\n\t\tgoto out;\n\n\tif (newnsegs > nsegs) {\n\t\tsui->ncleansegs += newnsegs - nsegs;\n\t} else /* newnsegs < nsegs */ {\n\t\tret = nilfs_sufile_truncate_range(sufile, newnsegs, nsegs - 1);\n\t\tif (ret < 0)\n\t\t\tgoto out_header;\n\n\t\tsui->ncleansegs -= nsegs - newnsegs;\n\t}\n\n\tkaddr = kmap_atomic(header_bh->b_page);\n\theader = kaddr + bh_offset(header_bh);\n\theader->sh_ncleansegs = cpu_to_le64(sui->ncleansegs);\n\tkunmap_atomic(kaddr);\n\n\tmark_buffer_dirty(header_bh);\n\tnilfs_mdt_mark_dirty(sufile);\n\tnilfs_set_nsegments(nilfs, newnsegs);\n\nout_header:\n\tbrelse(header_bh);\nout:\n\tup_write(&NILFS_MDT(sufile)->mi_sem);\n\treturn ret;\n}"
  },
  {
    "function_name": "nilfs_sufile_truncate_range",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/sufile.c",
    "lines": "642-728",
    "snippet": "static int nilfs_sufile_truncate_range(struct inode *sufile,\n\t\t\t\t       __u64 start, __u64 end)\n{\n\tstruct the_nilfs *nilfs = sufile->i_sb->s_fs_info;\n\tstruct buffer_head *header_bh;\n\tstruct buffer_head *su_bh;\n\tstruct nilfs_segment_usage *su, *su2;\n\tsize_t susz = NILFS_MDT(sufile)->mi_entry_size;\n\tunsigned long segusages_per_block;\n\tunsigned long nsegs, ncleaned;\n\t__u64 segnum;\n\tvoid *kaddr;\n\tssize_t n, nc;\n\tint ret;\n\tint j;\n\n\tnsegs = nilfs_sufile_get_nsegments(sufile);\n\n\tret = -EINVAL;\n\tif (start > end || start >= nsegs)\n\t\tgoto out;\n\n\tret = nilfs_sufile_get_header_block(sufile, &header_bh);\n\tif (ret < 0)\n\t\tgoto out;\n\n\tsegusages_per_block = nilfs_sufile_segment_usages_per_block(sufile);\n\tncleaned = 0;\n\n\tfor (segnum = start; segnum <= end; segnum += n) {\n\t\tn = min_t(unsigned long,\n\t\t\t  segusages_per_block -\n\t\t\t\t  nilfs_sufile_get_offset(sufile, segnum),\n\t\t\t  end - segnum + 1);\n\t\tret = nilfs_sufile_get_segment_usage_block(sufile, segnum, 0,\n\t\t\t\t\t\t\t   &su_bh);\n\t\tif (ret < 0) {\n\t\t\tif (ret != -ENOENT)\n\t\t\t\tgoto out_header;\n\t\t\t/* hole */\n\t\t\tcontinue;\n\t\t}\n\t\tkaddr = kmap_atomic(su_bh->b_page);\n\t\tsu = nilfs_sufile_block_get_segment_usage(\n\t\t\tsufile, segnum, su_bh, kaddr);\n\t\tsu2 = su;\n\t\tfor (j = 0; j < n; j++, su = (void *)su + susz) {\n\t\t\tif ((le32_to_cpu(su->su_flags) &\n\t\t\t     ~(1UL << NILFS_SEGMENT_USAGE_ERROR)) ||\n\t\t\t    nilfs_segment_is_active(nilfs, segnum + j)) {\n\t\t\t\tret = -EBUSY;\n\t\t\t\tkunmap_atomic(kaddr);\n\t\t\t\tbrelse(su_bh);\n\t\t\t\tgoto out_header;\n\t\t\t}\n\t\t}\n\t\tnc = 0;\n\t\tfor (su = su2, j = 0; j < n; j++, su = (void *)su + susz) {\n\t\t\tif (nilfs_segment_usage_error(su)) {\n\t\t\t\tnilfs_segment_usage_set_clean(su);\n\t\t\t\tnc++;\n\t\t\t}\n\t\t}\n\t\tkunmap_atomic(kaddr);\n\t\tif (nc > 0) {\n\t\t\tmark_buffer_dirty(su_bh);\n\t\t\tncleaned += nc;\n\t\t}\n\t\tbrelse(su_bh);\n\n\t\tif (n == segusages_per_block) {\n\t\t\t/* make hole */\n\t\t\tnilfs_sufile_delete_segment_usage_block(sufile, segnum);\n\t\t}\n\t}\n\tret = 0;\n\nout_header:\n\tif (ncleaned > 0) {\n\t\tNILFS_SUI(sufile)->ncleansegs += ncleaned;\n\t\tnilfs_sufile_mod_counter(header_bh, ncleaned, 0);\n\t\tnilfs_mdt_mark_dirty(sufile);\n\t}\n\tbrelse(header_bh);\nout:\n\treturn ret;\n}",
    "includes": [
      "#include \"sufile.h\"",
      "#include \"mdt.h\"",
      "#include <linux/nilfs2_fs.h>",
      "#include <linux/errno.h>",
      "#include <linux/buffer_head.h>",
      "#include <linux/string.h>",
      "#include <linux/fs.h>",
      "#include <linux/kernel.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "brelse",
          "args": [
            "header_bh"
          ],
          "line": 725
        },
        "resolved": true,
        "details": {
          "function_name": "__brelse",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/buffer.c",
          "lines": "1177-1184",
          "snippet": "void __brelse(struct buffer_head * buf)\n{\n\tif (atomic_read(&buf->b_count)) {\n\t\tput_bh(buf);\n\t\treturn;\n\t}\n\tWARN(1, KERN_ERR \"VFS: brelse: Trying to free free buffer\\n\");\n}",
          "includes": [
            "#include <trace/events/block.h>",
            "#include <linux/bit_spinlock.h>",
            "#include <linux/mpage.h>",
            "#include <linux/bitops.h>",
            "#include <linux/cpu.h>",
            "#include <linux/notifier.h>",
            "#include <linux/bio.h>",
            "#include <linux/task_io_accounting_ops.h>",
            "#include <linux/buffer_head.h>",
            "#include <linux/suspend.h>",
            "#include <linux/hash.h>",
            "#include <linux/writeback.h>",
            "#include <linux/export.h>",
            "#include <linux/highmem.h>",
            "#include <linux/quotaops.h>",
            "#include <linux/file.h>",
            "#include <linux/blkdev.h>",
            "#include <linux/capability.h>",
            "#include <linux/slab.h>",
            "#include <linux/percpu.h>",
            "#include <linux/mm.h>",
            "#include <linux/fs.h>",
            "#include <linux/syscalls.h>",
            "#include <linux/kernel.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <trace/events/block.h>\n#include <linux/bit_spinlock.h>\n#include <linux/mpage.h>\n#include <linux/bitops.h>\n#include <linux/cpu.h>\n#include <linux/notifier.h>\n#include <linux/bio.h>\n#include <linux/task_io_accounting_ops.h>\n#include <linux/buffer_head.h>\n#include <linux/suspend.h>\n#include <linux/hash.h>\n#include <linux/writeback.h>\n#include <linux/export.h>\n#include <linux/highmem.h>\n#include <linux/quotaops.h>\n#include <linux/file.h>\n#include <linux/blkdev.h>\n#include <linux/capability.h>\n#include <linux/slab.h>\n#include <linux/percpu.h>\n#include <linux/mm.h>\n#include <linux/fs.h>\n#include <linux/syscalls.h>\n#include <linux/kernel.h>\n\nvoid __brelse(struct buffer_head * buf)\n{\n\tif (atomic_read(&buf->b_count)) {\n\t\tput_bh(buf);\n\t\treturn;\n\t}\n\tWARN(1, KERN_ERR \"VFS: brelse: Trying to free free buffer\\n\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "nilfs_mdt_mark_dirty",
          "args": [
            "sufile"
          ],
          "line": 723
        },
        "resolved": true,
        "details": {
          "function_name": "nilfs_mdt_mark_dirty",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/mdt.h",
          "lines": "98-102",
          "snippet": "static inline void nilfs_mdt_mark_dirty(struct inode *inode)\n{\n\tif (!test_bit(NILFS_I_DIRTY, &NILFS_I(inode)->i_state))\n\t\tset_bit(NILFS_I_DIRTY, &NILFS_I(inode)->i_state);\n}",
          "includes": [
            "#include \"page.h\"",
            "#include \"nilfs.h\"",
            "#include <linux/blockgroup_lock.h>",
            "#include <linux/buffer_head.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"page.h\"\n#include \"nilfs.h\"\n#include <linux/blockgroup_lock.h>\n#include <linux/buffer_head.h>\n\nstatic inline void nilfs_mdt_mark_dirty(struct inode *inode)\n{\n\tif (!test_bit(NILFS_I_DIRTY, &NILFS_I(inode)->i_state))\n\t\tset_bit(NILFS_I_DIRTY, &NILFS_I(inode)->i_state);\n}"
        }
      },
      {
        "call_info": {
          "callee": "nilfs_sufile_mod_counter",
          "args": [
            "header_bh",
            "ncleaned",
            "0"
          ],
          "line": 722
        },
        "resolved": true,
        "details": {
          "function_name": "nilfs_sufile_mod_counter",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/sufile.c",
          "lines": "114-127",
          "snippet": "static void nilfs_sufile_mod_counter(struct buffer_head *header_bh,\n\t\t\t\t     u64 ncleanadd, u64 ndirtyadd)\n{\n\tstruct nilfs_sufile_header *header;\n\tvoid *kaddr;\n\n\tkaddr = kmap_atomic(header_bh->b_page);\n\theader = kaddr + bh_offset(header_bh);\n\tle64_add_cpu(&header->sh_ncleansegs, ncleanadd);\n\tle64_add_cpu(&header->sh_ndirtysegs, ndirtyadd);\n\tkunmap_atomic(kaddr);\n\n\tmark_buffer_dirty(header_bh);\n}",
          "includes": [
            "#include \"sufile.h\"",
            "#include \"mdt.h\"",
            "#include <linux/nilfs2_fs.h>",
            "#include <linux/errno.h>",
            "#include <linux/buffer_head.h>",
            "#include <linux/string.h>",
            "#include <linux/fs.h>",
            "#include <linux/kernel.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sufile.h\"\n#include \"mdt.h\"\n#include <linux/nilfs2_fs.h>\n#include <linux/errno.h>\n#include <linux/buffer_head.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n#include <linux/kernel.h>\n\nstatic void nilfs_sufile_mod_counter(struct buffer_head *header_bh,\n\t\t\t\t     u64 ncleanadd, u64 ndirtyadd)\n{\n\tstruct nilfs_sufile_header *header;\n\tvoid *kaddr;\n\n\tkaddr = kmap_atomic(header_bh->b_page);\n\theader = kaddr + bh_offset(header_bh);\n\tle64_add_cpu(&header->sh_ncleansegs, ncleanadd);\n\tle64_add_cpu(&header->sh_ndirtysegs, ndirtyadd);\n\tkunmap_atomic(kaddr);\n\n\tmark_buffer_dirty(header_bh);\n}"
        }
      },
      {
        "call_info": {
          "callee": "NILFS_SUI",
          "args": [
            "sufile"
          ],
          "line": 721
        },
        "resolved": true,
        "details": {
          "function_name": "NILFS_SUI",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/sufile.c",
          "lines": "47-50",
          "snippet": "static inline struct nilfs_sufile_info *NILFS_SUI(struct inode *sufile)\n{\n\treturn (struct nilfs_sufile_info *)NILFS_MDT(sufile);\n}",
          "includes": [
            "#include \"sufile.h\"",
            "#include \"mdt.h\"",
            "#include <linux/nilfs2_fs.h>",
            "#include <linux/errno.h>",
            "#include <linux/buffer_head.h>",
            "#include <linux/string.h>",
            "#include <linux/fs.h>",
            "#include <linux/kernel.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sufile.h\"\n#include \"mdt.h\"\n#include <linux/nilfs2_fs.h>\n#include <linux/errno.h>\n#include <linux/buffer_head.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n#include <linux/kernel.h>\n\nstatic inline struct nilfs_sufile_info *NILFS_SUI(struct inode *sufile)\n{\n\treturn (struct nilfs_sufile_info *)NILFS_MDT(sufile);\n}"
        }
      },
      {
        "call_info": {
          "callee": "nilfs_sufile_delete_segment_usage_block",
          "args": [
            "sufile",
            "segnum"
          ],
          "line": 714
        },
        "resolved": true,
        "details": {
          "function_name": "nilfs_sufile_delete_segment_usage_block",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/sufile.c",
          "lines": "107-112",
          "snippet": "static int nilfs_sufile_delete_segment_usage_block(struct inode *sufile,\n\t\t\t\t\t\t   __u64 segnum)\n{\n\treturn nilfs_mdt_delete_block(sufile,\n\t\t\t\t      nilfs_sufile_get_blkoff(sufile, segnum));\n}",
          "includes": [
            "#include \"sufile.h\"",
            "#include \"mdt.h\"",
            "#include <linux/nilfs2_fs.h>",
            "#include <linux/errno.h>",
            "#include <linux/buffer_head.h>",
            "#include <linux/string.h>",
            "#include <linux/fs.h>",
            "#include <linux/kernel.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sufile.h\"\n#include \"mdt.h\"\n#include <linux/nilfs2_fs.h>\n#include <linux/errno.h>\n#include <linux/buffer_head.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n#include <linux/kernel.h>\n\nstatic int nilfs_sufile_delete_segment_usage_block(struct inode *sufile,\n\t\t\t\t\t\t   __u64 segnum)\n{\n\treturn nilfs_mdt_delete_block(sufile,\n\t\t\t\t      nilfs_sufile_get_blkoff(sufile, segnum));\n}"
        }
      },
      {
        "call_info": {
          "callee": "mark_buffer_dirty",
          "args": [
            "su_bh"
          ],
          "line": 707
        },
        "resolved": true,
        "details": {
          "function_name": "mark_buffer_dirty",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/buffer.c",
          "lines": "1141-1167",
          "snippet": "void mark_buffer_dirty(struct buffer_head *bh)\n{\n\tWARN_ON_ONCE(!buffer_uptodate(bh));\n\n\ttrace_block_dirty_buffer(bh);\n\n\t/*\n\t * Very *carefully* optimize the it-is-already-dirty case.\n\t *\n\t * Don't let the final \"is it dirty\" escape to before we\n\t * perhaps modified the buffer.\n\t */\n\tif (buffer_dirty(bh)) {\n\t\tsmp_mb();\n\t\tif (buffer_dirty(bh))\n\t\t\treturn;\n\t}\n\n\tif (!test_set_buffer_dirty(bh)) {\n\t\tstruct page *page = bh->b_page;\n\t\tif (!TestSetPageDirty(page)) {\n\t\t\tstruct address_space *mapping = page_mapping(page);\n\t\t\tif (mapping)\n\t\t\t\t__set_page_dirty(page, mapping, 0);\n\t\t}\n\t}\n}",
          "includes": [
            "#include <trace/events/block.h>",
            "#include <linux/bit_spinlock.h>",
            "#include <linux/mpage.h>",
            "#include <linux/bitops.h>",
            "#include <linux/cpu.h>",
            "#include <linux/notifier.h>",
            "#include <linux/bio.h>",
            "#include <linux/task_io_accounting_ops.h>",
            "#include <linux/buffer_head.h>",
            "#include <linux/suspend.h>",
            "#include <linux/hash.h>",
            "#include <linux/writeback.h>",
            "#include <linux/export.h>",
            "#include <linux/highmem.h>",
            "#include <linux/quotaops.h>",
            "#include <linux/file.h>",
            "#include <linux/blkdev.h>",
            "#include <linux/capability.h>",
            "#include <linux/slab.h>",
            "#include <linux/percpu.h>",
            "#include <linux/mm.h>",
            "#include <linux/fs.h>",
            "#include <linux/syscalls.h>",
            "#include <linux/kernel.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <trace/events/block.h>\n#include <linux/bit_spinlock.h>\n#include <linux/mpage.h>\n#include <linux/bitops.h>\n#include <linux/cpu.h>\n#include <linux/notifier.h>\n#include <linux/bio.h>\n#include <linux/task_io_accounting_ops.h>\n#include <linux/buffer_head.h>\n#include <linux/suspend.h>\n#include <linux/hash.h>\n#include <linux/writeback.h>\n#include <linux/export.h>\n#include <linux/highmem.h>\n#include <linux/quotaops.h>\n#include <linux/file.h>\n#include <linux/blkdev.h>\n#include <linux/capability.h>\n#include <linux/slab.h>\n#include <linux/percpu.h>\n#include <linux/mm.h>\n#include <linux/fs.h>\n#include <linux/syscalls.h>\n#include <linux/kernel.h>\n\nvoid mark_buffer_dirty(struct buffer_head *bh)\n{\n\tWARN_ON_ONCE(!buffer_uptodate(bh));\n\n\ttrace_block_dirty_buffer(bh);\n\n\t/*\n\t * Very *carefully* optimize the it-is-already-dirty case.\n\t *\n\t * Don't let the final \"is it dirty\" escape to before we\n\t * perhaps modified the buffer.\n\t */\n\tif (buffer_dirty(bh)) {\n\t\tsmp_mb();\n\t\tif (buffer_dirty(bh))\n\t\t\treturn;\n\t}\n\n\tif (!test_set_buffer_dirty(bh)) {\n\t\tstruct page *page = bh->b_page;\n\t\tif (!TestSetPageDirty(page)) {\n\t\t\tstruct address_space *mapping = page_mapping(page);\n\t\t\tif (mapping)\n\t\t\t\t__set_page_dirty(page, mapping, 0);\n\t\t}\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "kunmap_atomic",
          "args": [
            "kaddr"
          ],
          "line": 705
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "nilfs_segment_usage_set_clean",
          "args": [
            "su"
          ],
          "line": 701
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "nilfs_segment_usage_error",
          "args": [
            "su"
          ],
          "line": 700
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kunmap_atomic",
          "args": [
            "kaddr"
          ],
          "line": 693
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "nilfs_segment_is_active",
          "args": [
            "nilfs",
            "segnum + j"
          ],
          "line": 691
        },
        "resolved": true,
        "details": {
          "function_name": "nilfs_segment_is_active",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/the_nilfs.h",
          "lines": "371-374",
          "snippet": "static inline int nilfs_segment_is_active(struct the_nilfs *nilfs, __u64 n)\n{\n\treturn n == nilfs->ns_segnum || n == nilfs->ns_nextnum;\n}",
          "includes": [
            "#include <linux/slab.h>",
            "#include <linux/backing-dev.h>",
            "#include <linux/blkdev.h>",
            "#include <linux/fs.h>",
            "#include <linux/rbtree.h>",
            "#include <linux/buffer_head.h>",
            "#include <linux/types.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/slab.h>\n#include <linux/backing-dev.h>\n#include <linux/blkdev.h>\n#include <linux/fs.h>\n#include <linux/rbtree.h>\n#include <linux/buffer_head.h>\n#include <linux/types.h>\n\nstatic inline int nilfs_segment_is_active(struct the_nilfs *nilfs, __u64 n)\n{\n\treturn n == nilfs->ns_segnum || n == nilfs->ns_nextnum;\n}"
        }
      },
      {
        "call_info": {
          "callee": "le32_to_cpu",
          "args": [
            "su->su_flags"
          ],
          "line": 689
        },
        "resolved": true,
        "details": {
          "function_name": "sle32_to_cpup",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/ntfs/endian.h",
          "lines": "53-56",
          "snippet": "static inline s32 sle32_to_cpup(sle32 *x)\n{\n\treturn le32_to_cpu(*(__force le32*)x);\n}",
          "includes": [
            "#include \"types.h\"",
            "#include <asm/byteorder.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"types.h\"\n#include <asm/byteorder.h>\n\nstatic inline s32 sle32_to_cpup(sle32 *x)\n{\n\treturn le32_to_cpu(*(__force le32*)x);\n}"
        }
      },
      {
        "call_info": {
          "callee": "nilfs_sufile_block_get_segment_usage",
          "args": [
            "sufile",
            "segnum",
            "su_bh",
            "kaddr"
          ],
          "line": 685
        },
        "resolved": true,
        "details": {
          "function_name": "nilfs_sufile_block_get_segment_usage",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/sufile.c",
          "lines": "83-90",
          "snippet": "static struct nilfs_segment_usage *\nnilfs_sufile_block_get_segment_usage(const struct inode *sufile, __u64 segnum,\n\t\t\t\t     struct buffer_head *bh, void *kaddr)\n{\n\treturn kaddr + bh_offset(bh) +\n\t\tnilfs_sufile_get_offset(sufile, segnum) *\n\t\tNILFS_MDT(sufile)->mi_entry_size;\n}",
          "includes": [
            "#include \"sufile.h\"",
            "#include \"mdt.h\"",
            "#include <linux/nilfs2_fs.h>",
            "#include <linux/errno.h>",
            "#include <linux/buffer_head.h>",
            "#include <linux/string.h>",
            "#include <linux/fs.h>",
            "#include <linux/kernel.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sufile.h\"\n#include \"mdt.h\"\n#include <linux/nilfs2_fs.h>\n#include <linux/errno.h>\n#include <linux/buffer_head.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n#include <linux/kernel.h>\n\nstatic struct nilfs_segment_usage *\nnilfs_sufile_block_get_segment_usage(const struct inode *sufile, __u64 segnum,\n\t\t\t\t     struct buffer_head *bh, void *kaddr)\n{\n\treturn kaddr + bh_offset(bh) +\n\t\tnilfs_sufile_get_offset(sufile, segnum) *\n\t\tNILFS_MDT(sufile)->mi_entry_size;\n}"
        }
      },
      {
        "call_info": {
          "callee": "kmap_atomic",
          "args": [
            "su_bh->b_page"
          ],
          "line": 684
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "nilfs_sufile_get_segment_usage_block",
          "args": [
            "sufile",
            "segnum",
            "0",
            "&su_bh"
          ],
          "line": 676
        },
        "resolved": true,
        "details": {
          "function_name": "nilfs_sufile_get_segment_usage_block",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/sufile.c",
          "lines": "98-105",
          "snippet": "static inline int\nnilfs_sufile_get_segment_usage_block(struct inode *sufile, __u64 segnum,\n\t\t\t\t     int create, struct buffer_head **bhp)\n{\n\treturn nilfs_mdt_get_block(sufile,\n\t\t\t\t   nilfs_sufile_get_blkoff(sufile, segnum),\n\t\t\t\t   create, NULL, bhp);\n}",
          "includes": [
            "#include \"sufile.h\"",
            "#include \"mdt.h\"",
            "#include <linux/nilfs2_fs.h>",
            "#include <linux/errno.h>",
            "#include <linux/buffer_head.h>",
            "#include <linux/string.h>",
            "#include <linux/fs.h>",
            "#include <linux/kernel.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sufile.h\"\n#include \"mdt.h\"\n#include <linux/nilfs2_fs.h>\n#include <linux/errno.h>\n#include <linux/buffer_head.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n#include <linux/kernel.h>\n\nstatic inline int\nnilfs_sufile_get_segment_usage_block(struct inode *sufile, __u64 segnum,\n\t\t\t\t     int create, struct buffer_head **bhp)\n{\n\treturn nilfs_mdt_get_block(sufile,\n\t\t\t\t   nilfs_sufile_get_blkoff(sufile, segnum),\n\t\t\t\t   create, NULL, bhp);\n}"
        }
      },
      {
        "call_info": {
          "callee": "min_t",
          "args": [
            "unsignedlong",
            "segusages_per_block -\n\t\t\t\t  nilfs_sufile_get_offset(sufile, segnum)",
            "end - segnum + 1"
          ],
          "line": 672
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "nilfs_sufile_get_offset",
          "args": [
            "sufile",
            "segnum"
          ],
          "line": 674
        },
        "resolved": true,
        "details": {
          "function_name": "nilfs_sufile_get_offset",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/sufile.c",
          "lines": "66-71",
          "snippet": "static unsigned long\nnilfs_sufile_get_offset(const struct inode *sufile, __u64 segnum)\n{\n\t__u64 t = segnum + NILFS_MDT(sufile)->mi_first_entry_offset;\n\treturn do_div(t, nilfs_sufile_segment_usages_per_block(sufile));\n}",
          "includes": [
            "#include \"sufile.h\"",
            "#include \"mdt.h\"",
            "#include <linux/nilfs2_fs.h>",
            "#include <linux/errno.h>",
            "#include <linux/buffer_head.h>",
            "#include <linux/string.h>",
            "#include <linux/fs.h>",
            "#include <linux/kernel.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sufile.h\"\n#include \"mdt.h\"\n#include <linux/nilfs2_fs.h>\n#include <linux/errno.h>\n#include <linux/buffer_head.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n#include <linux/kernel.h>\n\nstatic unsigned long\nnilfs_sufile_get_offset(const struct inode *sufile, __u64 segnum)\n{\n\t__u64 t = segnum + NILFS_MDT(sufile)->mi_first_entry_offset;\n\treturn do_div(t, nilfs_sufile_segment_usages_per_block(sufile));\n}"
        }
      },
      {
        "call_info": {
          "callee": "nilfs_sufile_segment_usages_per_block",
          "args": [
            "sufile"
          ],
          "line": 668
        },
        "resolved": true,
        "details": {
          "function_name": "nilfs_sufile_segment_usages_per_block",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/sufile.c",
          "lines": "52-56",
          "snippet": "static inline unsigned long\nnilfs_sufile_segment_usages_per_block(const struct inode *sufile)\n{\n\treturn NILFS_MDT(sufile)->mi_entries_per_block;\n}",
          "includes": [
            "#include \"sufile.h\"",
            "#include \"mdt.h\"",
            "#include <linux/nilfs2_fs.h>",
            "#include <linux/errno.h>",
            "#include <linux/buffer_head.h>",
            "#include <linux/string.h>",
            "#include <linux/fs.h>",
            "#include <linux/kernel.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sufile.h\"\n#include \"mdt.h\"\n#include <linux/nilfs2_fs.h>\n#include <linux/errno.h>\n#include <linux/buffer_head.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n#include <linux/kernel.h>\n\nstatic inline unsigned long\nnilfs_sufile_segment_usages_per_block(const struct inode *sufile)\n{\n\treturn NILFS_MDT(sufile)->mi_entries_per_block;\n}"
        }
      },
      {
        "call_info": {
          "callee": "nilfs_sufile_get_header_block",
          "args": [
            "sufile",
            "&header_bh"
          ],
          "line": 664
        },
        "resolved": true,
        "details": {
          "function_name": "nilfs_sufile_get_header_block",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/sufile.c",
          "lines": "92-96",
          "snippet": "static inline int nilfs_sufile_get_header_block(struct inode *sufile,\n\t\t\t\t\t\tstruct buffer_head **bhp)\n{\n\treturn nilfs_mdt_get_block(sufile, 0, 0, NULL, bhp);\n}",
          "includes": [
            "#include \"sufile.h\"",
            "#include \"mdt.h\"",
            "#include <linux/nilfs2_fs.h>",
            "#include <linux/errno.h>",
            "#include <linux/buffer_head.h>",
            "#include <linux/string.h>",
            "#include <linux/fs.h>",
            "#include <linux/kernel.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sufile.h\"\n#include \"mdt.h\"\n#include <linux/nilfs2_fs.h>\n#include <linux/errno.h>\n#include <linux/buffer_head.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n#include <linux/kernel.h>\n\nstatic inline int nilfs_sufile_get_header_block(struct inode *sufile,\n\t\t\t\t\t\tstruct buffer_head **bhp)\n{\n\treturn nilfs_mdt_get_block(sufile, 0, 0, NULL, bhp);\n}"
        }
      },
      {
        "call_info": {
          "callee": "nilfs_sufile_get_nsegments",
          "args": [
            "sufile"
          ],
          "line": 658
        },
        "resolved": true,
        "details": {
          "function_name": "nilfs_sufile_get_nsegments",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/sufile.h",
          "lines": "32-35",
          "snippet": "static inline unsigned long nilfs_sufile_get_nsegments(struct inode *sufile)\n{\n\treturn ((struct the_nilfs *)sufile->i_sb->s_fs_info)->ns_nsegments;\n}",
          "includes": [
            "#include \"mdt.h\"",
            "#include <linux/nilfs2_fs.h>",
            "#include <linux/buffer_head.h>",
            "#include <linux/fs.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"mdt.h\"\n#include <linux/nilfs2_fs.h>\n#include <linux/buffer_head.h>\n#include <linux/fs.h>\n\nstatic inline unsigned long nilfs_sufile_get_nsegments(struct inode *sufile)\n{\n\treturn ((struct the_nilfs *)sufile->i_sb->s_fs_info)->ns_nsegments;\n}"
        }
      },
      {
        "call_info": {
          "callee": "NILFS_MDT",
          "args": [
            "sufile"
          ],
          "line": 649
        },
        "resolved": true,
        "details": {
          "function_name": "NILFS_MDT",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/mdt.h",
          "lines": "69-72",
          "snippet": "static inline struct nilfs_mdt_info *NILFS_MDT(const struct inode *inode)\n{\n\treturn inode->i_private;\n}",
          "includes": [
            "#include \"page.h\"",
            "#include \"nilfs.h\"",
            "#include <linux/blockgroup_lock.h>",
            "#include <linux/buffer_head.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"page.h\"\n#include \"nilfs.h\"\n#include <linux/blockgroup_lock.h>\n#include <linux/buffer_head.h>\n\nstatic inline struct nilfs_mdt_info *NILFS_MDT(const struct inode *inode)\n{\n\treturn inode->i_private;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"sufile.h\"\n#include \"mdt.h\"\n#include <linux/nilfs2_fs.h>\n#include <linux/errno.h>\n#include <linux/buffer_head.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n#include <linux/kernel.h>\n\nstatic int nilfs_sufile_truncate_range(struct inode *sufile,\n\t\t\t\t       __u64 start, __u64 end)\n{\n\tstruct the_nilfs *nilfs = sufile->i_sb->s_fs_info;\n\tstruct buffer_head *header_bh;\n\tstruct buffer_head *su_bh;\n\tstruct nilfs_segment_usage *su, *su2;\n\tsize_t susz = NILFS_MDT(sufile)->mi_entry_size;\n\tunsigned long segusages_per_block;\n\tunsigned long nsegs, ncleaned;\n\t__u64 segnum;\n\tvoid *kaddr;\n\tssize_t n, nc;\n\tint ret;\n\tint j;\n\n\tnsegs = nilfs_sufile_get_nsegments(sufile);\n\n\tret = -EINVAL;\n\tif (start > end || start >= nsegs)\n\t\tgoto out;\n\n\tret = nilfs_sufile_get_header_block(sufile, &header_bh);\n\tif (ret < 0)\n\t\tgoto out;\n\n\tsegusages_per_block = nilfs_sufile_segment_usages_per_block(sufile);\n\tncleaned = 0;\n\n\tfor (segnum = start; segnum <= end; segnum += n) {\n\t\tn = min_t(unsigned long,\n\t\t\t  segusages_per_block -\n\t\t\t\t  nilfs_sufile_get_offset(sufile, segnum),\n\t\t\t  end - segnum + 1);\n\t\tret = nilfs_sufile_get_segment_usage_block(sufile, segnum, 0,\n\t\t\t\t\t\t\t   &su_bh);\n\t\tif (ret < 0) {\n\t\t\tif (ret != -ENOENT)\n\t\t\t\tgoto out_header;\n\t\t\t/* hole */\n\t\t\tcontinue;\n\t\t}\n\t\tkaddr = kmap_atomic(su_bh->b_page);\n\t\tsu = nilfs_sufile_block_get_segment_usage(\n\t\t\tsufile, segnum, su_bh, kaddr);\n\t\tsu2 = su;\n\t\tfor (j = 0; j < n; j++, su = (void *)su + susz) {\n\t\t\tif ((le32_to_cpu(su->su_flags) &\n\t\t\t     ~(1UL << NILFS_SEGMENT_USAGE_ERROR)) ||\n\t\t\t    nilfs_segment_is_active(nilfs, segnum + j)) {\n\t\t\t\tret = -EBUSY;\n\t\t\t\tkunmap_atomic(kaddr);\n\t\t\t\tbrelse(su_bh);\n\t\t\t\tgoto out_header;\n\t\t\t}\n\t\t}\n\t\tnc = 0;\n\t\tfor (su = su2, j = 0; j < n; j++, su = (void *)su + susz) {\n\t\t\tif (nilfs_segment_usage_error(su)) {\n\t\t\t\tnilfs_segment_usage_set_clean(su);\n\t\t\t\tnc++;\n\t\t\t}\n\t\t}\n\t\tkunmap_atomic(kaddr);\n\t\tif (nc > 0) {\n\t\t\tmark_buffer_dirty(su_bh);\n\t\t\tncleaned += nc;\n\t\t}\n\t\tbrelse(su_bh);\n\n\t\tif (n == segusages_per_block) {\n\t\t\t/* make hole */\n\t\t\tnilfs_sufile_delete_segment_usage_block(sufile, segnum);\n\t\t}\n\t}\n\tret = 0;\n\nout_header:\n\tif (ncleaned > 0) {\n\t\tNILFS_SUI(sufile)->ncleansegs += ncleaned;\n\t\tnilfs_sufile_mod_counter(header_bh, ncleaned, 0);\n\t\tnilfs_mdt_mark_dirty(sufile);\n\t}\n\tbrelse(header_bh);\nout:\n\treturn ret;\n}"
  },
  {
    "function_name": "nilfs_sufile_do_set_error",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/sufile.c",
    "lines": "599-623",
    "snippet": "void nilfs_sufile_do_set_error(struct inode *sufile, __u64 segnum,\n\t\t\t       struct buffer_head *header_bh,\n\t\t\t       struct buffer_head *su_bh)\n{\n\tstruct nilfs_segment_usage *su;\n\tvoid *kaddr;\n\tint suclean;\n\n\tkaddr = kmap_atomic(su_bh->b_page);\n\tsu = nilfs_sufile_block_get_segment_usage(sufile, segnum, su_bh, kaddr);\n\tif (nilfs_segment_usage_error(su)) {\n\t\tkunmap_atomic(kaddr);\n\t\treturn;\n\t}\n\tsuclean = nilfs_segment_usage_clean(su);\n\tnilfs_segment_usage_set_error(su);\n\tkunmap_atomic(kaddr);\n\n\tif (suclean) {\n\t\tnilfs_sufile_mod_counter(header_bh, -1, 0);\n\t\tNILFS_SUI(sufile)->ncleansegs--;\n\t}\n\tmark_buffer_dirty(su_bh);\n\tnilfs_mdt_mark_dirty(sufile);\n}",
    "includes": [
      "#include \"sufile.h\"",
      "#include \"mdt.h\"",
      "#include <linux/nilfs2_fs.h>",
      "#include <linux/errno.h>",
      "#include <linux/buffer_head.h>",
      "#include <linux/string.h>",
      "#include <linux/fs.h>",
      "#include <linux/kernel.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "nilfs_mdt_mark_dirty",
          "args": [
            "sufile"
          ],
          "line": 622
        },
        "resolved": true,
        "details": {
          "function_name": "nilfs_mdt_mark_dirty",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/mdt.h",
          "lines": "98-102",
          "snippet": "static inline void nilfs_mdt_mark_dirty(struct inode *inode)\n{\n\tif (!test_bit(NILFS_I_DIRTY, &NILFS_I(inode)->i_state))\n\t\tset_bit(NILFS_I_DIRTY, &NILFS_I(inode)->i_state);\n}",
          "includes": [
            "#include \"page.h\"",
            "#include \"nilfs.h\"",
            "#include <linux/blockgroup_lock.h>",
            "#include <linux/buffer_head.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"page.h\"\n#include \"nilfs.h\"\n#include <linux/blockgroup_lock.h>\n#include <linux/buffer_head.h>\n\nstatic inline void nilfs_mdt_mark_dirty(struct inode *inode)\n{\n\tif (!test_bit(NILFS_I_DIRTY, &NILFS_I(inode)->i_state))\n\t\tset_bit(NILFS_I_DIRTY, &NILFS_I(inode)->i_state);\n}"
        }
      },
      {
        "call_info": {
          "callee": "mark_buffer_dirty",
          "args": [
            "su_bh"
          ],
          "line": 621
        },
        "resolved": true,
        "details": {
          "function_name": "mark_buffer_dirty",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/buffer.c",
          "lines": "1141-1167",
          "snippet": "void mark_buffer_dirty(struct buffer_head *bh)\n{\n\tWARN_ON_ONCE(!buffer_uptodate(bh));\n\n\ttrace_block_dirty_buffer(bh);\n\n\t/*\n\t * Very *carefully* optimize the it-is-already-dirty case.\n\t *\n\t * Don't let the final \"is it dirty\" escape to before we\n\t * perhaps modified the buffer.\n\t */\n\tif (buffer_dirty(bh)) {\n\t\tsmp_mb();\n\t\tif (buffer_dirty(bh))\n\t\t\treturn;\n\t}\n\n\tif (!test_set_buffer_dirty(bh)) {\n\t\tstruct page *page = bh->b_page;\n\t\tif (!TestSetPageDirty(page)) {\n\t\t\tstruct address_space *mapping = page_mapping(page);\n\t\t\tif (mapping)\n\t\t\t\t__set_page_dirty(page, mapping, 0);\n\t\t}\n\t}\n}",
          "includes": [
            "#include <trace/events/block.h>",
            "#include <linux/bit_spinlock.h>",
            "#include <linux/mpage.h>",
            "#include <linux/bitops.h>",
            "#include <linux/cpu.h>",
            "#include <linux/notifier.h>",
            "#include <linux/bio.h>",
            "#include <linux/task_io_accounting_ops.h>",
            "#include <linux/buffer_head.h>",
            "#include <linux/suspend.h>",
            "#include <linux/hash.h>",
            "#include <linux/writeback.h>",
            "#include <linux/export.h>",
            "#include <linux/highmem.h>",
            "#include <linux/quotaops.h>",
            "#include <linux/file.h>",
            "#include <linux/blkdev.h>",
            "#include <linux/capability.h>",
            "#include <linux/slab.h>",
            "#include <linux/percpu.h>",
            "#include <linux/mm.h>",
            "#include <linux/fs.h>",
            "#include <linux/syscalls.h>",
            "#include <linux/kernel.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <trace/events/block.h>\n#include <linux/bit_spinlock.h>\n#include <linux/mpage.h>\n#include <linux/bitops.h>\n#include <linux/cpu.h>\n#include <linux/notifier.h>\n#include <linux/bio.h>\n#include <linux/task_io_accounting_ops.h>\n#include <linux/buffer_head.h>\n#include <linux/suspend.h>\n#include <linux/hash.h>\n#include <linux/writeback.h>\n#include <linux/export.h>\n#include <linux/highmem.h>\n#include <linux/quotaops.h>\n#include <linux/file.h>\n#include <linux/blkdev.h>\n#include <linux/capability.h>\n#include <linux/slab.h>\n#include <linux/percpu.h>\n#include <linux/mm.h>\n#include <linux/fs.h>\n#include <linux/syscalls.h>\n#include <linux/kernel.h>\n\nvoid mark_buffer_dirty(struct buffer_head *bh)\n{\n\tWARN_ON_ONCE(!buffer_uptodate(bh));\n\n\ttrace_block_dirty_buffer(bh);\n\n\t/*\n\t * Very *carefully* optimize the it-is-already-dirty case.\n\t *\n\t * Don't let the final \"is it dirty\" escape to before we\n\t * perhaps modified the buffer.\n\t */\n\tif (buffer_dirty(bh)) {\n\t\tsmp_mb();\n\t\tif (buffer_dirty(bh))\n\t\t\treturn;\n\t}\n\n\tif (!test_set_buffer_dirty(bh)) {\n\t\tstruct page *page = bh->b_page;\n\t\tif (!TestSetPageDirty(page)) {\n\t\t\tstruct address_space *mapping = page_mapping(page);\n\t\t\tif (mapping)\n\t\t\t\t__set_page_dirty(page, mapping, 0);\n\t\t}\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "NILFS_SUI",
          "args": [
            "sufile"
          ],
          "line": 619
        },
        "resolved": true,
        "details": {
          "function_name": "NILFS_SUI",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/sufile.c",
          "lines": "47-50",
          "snippet": "static inline struct nilfs_sufile_info *NILFS_SUI(struct inode *sufile)\n{\n\treturn (struct nilfs_sufile_info *)NILFS_MDT(sufile);\n}",
          "includes": [
            "#include \"sufile.h\"",
            "#include \"mdt.h\"",
            "#include <linux/nilfs2_fs.h>",
            "#include <linux/errno.h>",
            "#include <linux/buffer_head.h>",
            "#include <linux/string.h>",
            "#include <linux/fs.h>",
            "#include <linux/kernel.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sufile.h\"\n#include \"mdt.h\"\n#include <linux/nilfs2_fs.h>\n#include <linux/errno.h>\n#include <linux/buffer_head.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n#include <linux/kernel.h>\n\nstatic inline struct nilfs_sufile_info *NILFS_SUI(struct inode *sufile)\n{\n\treturn (struct nilfs_sufile_info *)NILFS_MDT(sufile);\n}"
        }
      },
      {
        "call_info": {
          "callee": "nilfs_sufile_mod_counter",
          "args": [
            "header_bh",
            "-1",
            "0"
          ],
          "line": 618
        },
        "resolved": true,
        "details": {
          "function_name": "nilfs_sufile_mod_counter",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/sufile.c",
          "lines": "114-127",
          "snippet": "static void nilfs_sufile_mod_counter(struct buffer_head *header_bh,\n\t\t\t\t     u64 ncleanadd, u64 ndirtyadd)\n{\n\tstruct nilfs_sufile_header *header;\n\tvoid *kaddr;\n\n\tkaddr = kmap_atomic(header_bh->b_page);\n\theader = kaddr + bh_offset(header_bh);\n\tle64_add_cpu(&header->sh_ncleansegs, ncleanadd);\n\tle64_add_cpu(&header->sh_ndirtysegs, ndirtyadd);\n\tkunmap_atomic(kaddr);\n\n\tmark_buffer_dirty(header_bh);\n}",
          "includes": [
            "#include \"sufile.h\"",
            "#include \"mdt.h\"",
            "#include <linux/nilfs2_fs.h>",
            "#include <linux/errno.h>",
            "#include <linux/buffer_head.h>",
            "#include <linux/string.h>",
            "#include <linux/fs.h>",
            "#include <linux/kernel.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sufile.h\"\n#include \"mdt.h\"\n#include <linux/nilfs2_fs.h>\n#include <linux/errno.h>\n#include <linux/buffer_head.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n#include <linux/kernel.h>\n\nstatic void nilfs_sufile_mod_counter(struct buffer_head *header_bh,\n\t\t\t\t     u64 ncleanadd, u64 ndirtyadd)\n{\n\tstruct nilfs_sufile_header *header;\n\tvoid *kaddr;\n\n\tkaddr = kmap_atomic(header_bh->b_page);\n\theader = kaddr + bh_offset(header_bh);\n\tle64_add_cpu(&header->sh_ncleansegs, ncleanadd);\n\tle64_add_cpu(&header->sh_ndirtysegs, ndirtyadd);\n\tkunmap_atomic(kaddr);\n\n\tmark_buffer_dirty(header_bh);\n}"
        }
      },
      {
        "call_info": {
          "callee": "kunmap_atomic",
          "args": [
            "kaddr"
          ],
          "line": 615
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "nilfs_segment_usage_set_error",
          "args": [
            "su"
          ],
          "line": 614
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "nilfs_segment_usage_clean",
          "args": [
            "su"
          ],
          "line": 613
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kunmap_atomic",
          "args": [
            "kaddr"
          ],
          "line": 610
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "nilfs_segment_usage_error",
          "args": [
            "su"
          ],
          "line": 609
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "nilfs_sufile_block_get_segment_usage",
          "args": [
            "sufile",
            "segnum",
            "su_bh",
            "kaddr"
          ],
          "line": 608
        },
        "resolved": true,
        "details": {
          "function_name": "nilfs_sufile_block_get_segment_usage",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/sufile.c",
          "lines": "83-90",
          "snippet": "static struct nilfs_segment_usage *\nnilfs_sufile_block_get_segment_usage(const struct inode *sufile, __u64 segnum,\n\t\t\t\t     struct buffer_head *bh, void *kaddr)\n{\n\treturn kaddr + bh_offset(bh) +\n\t\tnilfs_sufile_get_offset(sufile, segnum) *\n\t\tNILFS_MDT(sufile)->mi_entry_size;\n}",
          "includes": [
            "#include \"sufile.h\"",
            "#include \"mdt.h\"",
            "#include <linux/nilfs2_fs.h>",
            "#include <linux/errno.h>",
            "#include <linux/buffer_head.h>",
            "#include <linux/string.h>",
            "#include <linux/fs.h>",
            "#include <linux/kernel.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sufile.h\"\n#include \"mdt.h\"\n#include <linux/nilfs2_fs.h>\n#include <linux/errno.h>\n#include <linux/buffer_head.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n#include <linux/kernel.h>\n\nstatic struct nilfs_segment_usage *\nnilfs_sufile_block_get_segment_usage(const struct inode *sufile, __u64 segnum,\n\t\t\t\t     struct buffer_head *bh, void *kaddr)\n{\n\treturn kaddr + bh_offset(bh) +\n\t\tnilfs_sufile_get_offset(sufile, segnum) *\n\t\tNILFS_MDT(sufile)->mi_entry_size;\n}"
        }
      },
      {
        "call_info": {
          "callee": "kmap_atomic",
          "args": [
            "su_bh->b_page"
          ],
          "line": 607
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"sufile.h\"\n#include \"mdt.h\"\n#include <linux/nilfs2_fs.h>\n#include <linux/errno.h>\n#include <linux/buffer_head.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n#include <linux/kernel.h>\n\nvoid nilfs_sufile_do_set_error(struct inode *sufile, __u64 segnum,\n\t\t\t       struct buffer_head *header_bh,\n\t\t\t       struct buffer_head *su_bh)\n{\n\tstruct nilfs_segment_usage *su;\n\tvoid *kaddr;\n\tint suclean;\n\n\tkaddr = kmap_atomic(su_bh->b_page);\n\tsu = nilfs_sufile_block_get_segment_usage(sufile, segnum, su_bh, kaddr);\n\tif (nilfs_segment_usage_error(su)) {\n\t\tkunmap_atomic(kaddr);\n\t\treturn;\n\t}\n\tsuclean = nilfs_segment_usage_clean(su);\n\tnilfs_segment_usage_set_error(su);\n\tkunmap_atomic(kaddr);\n\n\tif (suclean) {\n\t\tnilfs_sufile_mod_counter(header_bh, -1, 0);\n\t\tNILFS_SUI(sufile)->ncleansegs--;\n\t}\n\tmark_buffer_dirty(su_bh);\n\tnilfs_mdt_mark_dirty(sufile);\n}"
  },
  {
    "function_name": "nilfs_sufile_get_stat",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/sufile.c",
    "lines": "567-597",
    "snippet": "int nilfs_sufile_get_stat(struct inode *sufile, struct nilfs_sustat *sustat)\n{\n\tstruct buffer_head *header_bh;\n\tstruct nilfs_sufile_header *header;\n\tstruct the_nilfs *nilfs = sufile->i_sb->s_fs_info;\n\tvoid *kaddr;\n\tint ret;\n\n\tdown_read(&NILFS_MDT(sufile)->mi_sem);\n\n\tret = nilfs_sufile_get_header_block(sufile, &header_bh);\n\tif (ret < 0)\n\t\tgoto out_sem;\n\n\tkaddr = kmap_atomic(header_bh->b_page);\n\theader = kaddr + bh_offset(header_bh);\n\tsustat->ss_nsegs = nilfs_sufile_get_nsegments(sufile);\n\tsustat->ss_ncleansegs = le64_to_cpu(header->sh_ncleansegs);\n\tsustat->ss_ndirtysegs = le64_to_cpu(header->sh_ndirtysegs);\n\tsustat->ss_ctime = nilfs->ns_ctime;\n\tsustat->ss_nongc_ctime = nilfs->ns_nongc_ctime;\n\tspin_lock(&nilfs->ns_last_segment_lock);\n\tsustat->ss_prot_seq = nilfs->ns_prot_seq;\n\tspin_unlock(&nilfs->ns_last_segment_lock);\n\tkunmap_atomic(kaddr);\n\tbrelse(header_bh);\n\n out_sem:\n\tup_read(&NILFS_MDT(sufile)->mi_sem);\n\treturn ret;\n}",
    "includes": [
      "#include \"sufile.h\"",
      "#include \"mdt.h\"",
      "#include <linux/nilfs2_fs.h>",
      "#include <linux/errno.h>",
      "#include <linux/buffer_head.h>",
      "#include <linux/string.h>",
      "#include <linux/fs.h>",
      "#include <linux/kernel.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "up_read",
          "args": [
            "&NILFS_MDT(sufile)->mi_sem"
          ],
          "line": 595
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "NILFS_MDT",
          "args": [
            "sufile"
          ],
          "line": 595
        },
        "resolved": true,
        "details": {
          "function_name": "NILFS_MDT",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/mdt.h",
          "lines": "69-72",
          "snippet": "static inline struct nilfs_mdt_info *NILFS_MDT(const struct inode *inode)\n{\n\treturn inode->i_private;\n}",
          "includes": [
            "#include \"page.h\"",
            "#include \"nilfs.h\"",
            "#include <linux/blockgroup_lock.h>",
            "#include <linux/buffer_head.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"page.h\"\n#include \"nilfs.h\"\n#include <linux/blockgroup_lock.h>\n#include <linux/buffer_head.h>\n\nstatic inline struct nilfs_mdt_info *NILFS_MDT(const struct inode *inode)\n{\n\treturn inode->i_private;\n}"
        }
      },
      {
        "call_info": {
          "callee": "brelse",
          "args": [
            "header_bh"
          ],
          "line": 592
        },
        "resolved": true,
        "details": {
          "function_name": "__brelse",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/buffer.c",
          "lines": "1177-1184",
          "snippet": "void __brelse(struct buffer_head * buf)\n{\n\tif (atomic_read(&buf->b_count)) {\n\t\tput_bh(buf);\n\t\treturn;\n\t}\n\tWARN(1, KERN_ERR \"VFS: brelse: Trying to free free buffer\\n\");\n}",
          "includes": [
            "#include <trace/events/block.h>",
            "#include <linux/bit_spinlock.h>",
            "#include <linux/mpage.h>",
            "#include <linux/bitops.h>",
            "#include <linux/cpu.h>",
            "#include <linux/notifier.h>",
            "#include <linux/bio.h>",
            "#include <linux/task_io_accounting_ops.h>",
            "#include <linux/buffer_head.h>",
            "#include <linux/suspend.h>",
            "#include <linux/hash.h>",
            "#include <linux/writeback.h>",
            "#include <linux/export.h>",
            "#include <linux/highmem.h>",
            "#include <linux/quotaops.h>",
            "#include <linux/file.h>",
            "#include <linux/blkdev.h>",
            "#include <linux/capability.h>",
            "#include <linux/slab.h>",
            "#include <linux/percpu.h>",
            "#include <linux/mm.h>",
            "#include <linux/fs.h>",
            "#include <linux/syscalls.h>",
            "#include <linux/kernel.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <trace/events/block.h>\n#include <linux/bit_spinlock.h>\n#include <linux/mpage.h>\n#include <linux/bitops.h>\n#include <linux/cpu.h>\n#include <linux/notifier.h>\n#include <linux/bio.h>\n#include <linux/task_io_accounting_ops.h>\n#include <linux/buffer_head.h>\n#include <linux/suspend.h>\n#include <linux/hash.h>\n#include <linux/writeback.h>\n#include <linux/export.h>\n#include <linux/highmem.h>\n#include <linux/quotaops.h>\n#include <linux/file.h>\n#include <linux/blkdev.h>\n#include <linux/capability.h>\n#include <linux/slab.h>\n#include <linux/percpu.h>\n#include <linux/mm.h>\n#include <linux/fs.h>\n#include <linux/syscalls.h>\n#include <linux/kernel.h>\n\nvoid __brelse(struct buffer_head * buf)\n{\n\tif (atomic_read(&buf->b_count)) {\n\t\tput_bh(buf);\n\t\treturn;\n\t}\n\tWARN(1, KERN_ERR \"VFS: brelse: Trying to free free buffer\\n\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "kunmap_atomic",
          "args": [
            "kaddr"
          ],
          "line": 591
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "spin_unlock",
          "args": [
            "&nilfs->ns_last_segment_lock"
          ],
          "line": 590
        },
        "resolved": true,
        "details": {
          "function_name": "__spin_unlock_mb_cache_entry",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/mbcache.c",
          "lines": "139-144",
          "snippet": "static inline void\n__spin_unlock_mb_cache_entry(struct mb_cache_entry *ce)\n{\n\tspin_unlock(bgl_lock_ptr(mb_cache_bg_lock,\n\t\tMB_CACHE_ENTRY_LOCK_INDEX(ce)));\n}",
          "includes": [
            "#include <linux/log2.h>",
            "#include <linux/blockgroup_lock.h>",
            "#include <linux/init.h>",
            "#include <linux/mbcache.h>",
            "#include <linux/list_bl.h>",
            "#include <linux/sched.h>",
            "#include <linux/slab.h>",
            "#include <linux/mm.h>",
            "#include <linux/fs.h>",
            "#include <linux/hash.h>",
            "#include <linux/module.h>",
            "#include <linux/kernel.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static struct blockgroup_lock *mb_cache_bg_lock;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <linux/log2.h>\n#include <linux/blockgroup_lock.h>\n#include <linux/init.h>\n#include <linux/mbcache.h>\n#include <linux/list_bl.h>\n#include <linux/sched.h>\n#include <linux/slab.h>\n#include <linux/mm.h>\n#include <linux/fs.h>\n#include <linux/hash.h>\n#include <linux/module.h>\n#include <linux/kernel.h>\n\nstatic struct blockgroup_lock *mb_cache_bg_lock;\n\nstatic inline void\n__spin_unlock_mb_cache_entry(struct mb_cache_entry *ce)\n{\n\tspin_unlock(bgl_lock_ptr(mb_cache_bg_lock,\n\t\tMB_CACHE_ENTRY_LOCK_INDEX(ce)));\n}"
        }
      },
      {
        "call_info": {
          "callee": "spin_lock",
          "args": [
            "&nilfs->ns_last_segment_lock"
          ],
          "line": 588
        },
        "resolved": true,
        "details": {
          "function_name": "__spin_lock_mb_cache_entry",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/mbcache.c",
          "lines": "132-137",
          "snippet": "static inline void\n__spin_lock_mb_cache_entry(struct mb_cache_entry *ce)\n{\n\tspin_lock(bgl_lock_ptr(mb_cache_bg_lock,\n\t\tMB_CACHE_ENTRY_LOCK_INDEX(ce)));\n}",
          "includes": [
            "#include <linux/log2.h>",
            "#include <linux/blockgroup_lock.h>",
            "#include <linux/init.h>",
            "#include <linux/mbcache.h>",
            "#include <linux/list_bl.h>",
            "#include <linux/sched.h>",
            "#include <linux/slab.h>",
            "#include <linux/mm.h>",
            "#include <linux/fs.h>",
            "#include <linux/hash.h>",
            "#include <linux/module.h>",
            "#include <linux/kernel.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static struct blockgroup_lock *mb_cache_bg_lock;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <linux/log2.h>\n#include <linux/blockgroup_lock.h>\n#include <linux/init.h>\n#include <linux/mbcache.h>\n#include <linux/list_bl.h>\n#include <linux/sched.h>\n#include <linux/slab.h>\n#include <linux/mm.h>\n#include <linux/fs.h>\n#include <linux/hash.h>\n#include <linux/module.h>\n#include <linux/kernel.h>\n\nstatic struct blockgroup_lock *mb_cache_bg_lock;\n\nstatic inline void\n__spin_lock_mb_cache_entry(struct mb_cache_entry *ce)\n{\n\tspin_lock(bgl_lock_ptr(mb_cache_bg_lock,\n\t\tMB_CACHE_ENTRY_LOCK_INDEX(ce)));\n}"
        }
      },
      {
        "call_info": {
          "callee": "le64_to_cpu",
          "args": [
            "header->sh_ndirtysegs"
          ],
          "line": 585
        },
        "resolved": true,
        "details": {
          "function_name": "sle64_to_cpup",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/ntfs/endian.h",
          "lines": "58-61",
          "snippet": "static inline s64 sle64_to_cpup(sle64 *x)\n{\n\treturn le64_to_cpu(*(__force le64*)x);\n}",
          "includes": [
            "#include \"types.h\"",
            "#include <asm/byteorder.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"types.h\"\n#include <asm/byteorder.h>\n\nstatic inline s64 sle64_to_cpup(sle64 *x)\n{\n\treturn le64_to_cpu(*(__force le64*)x);\n}"
        }
      },
      {
        "call_info": {
          "callee": "nilfs_sufile_get_nsegments",
          "args": [
            "sufile"
          ],
          "line": 583
        },
        "resolved": true,
        "details": {
          "function_name": "nilfs_sufile_get_nsegments",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/sufile.h",
          "lines": "32-35",
          "snippet": "static inline unsigned long nilfs_sufile_get_nsegments(struct inode *sufile)\n{\n\treturn ((struct the_nilfs *)sufile->i_sb->s_fs_info)->ns_nsegments;\n}",
          "includes": [
            "#include \"mdt.h\"",
            "#include <linux/nilfs2_fs.h>",
            "#include <linux/buffer_head.h>",
            "#include <linux/fs.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"mdt.h\"\n#include <linux/nilfs2_fs.h>\n#include <linux/buffer_head.h>\n#include <linux/fs.h>\n\nstatic inline unsigned long nilfs_sufile_get_nsegments(struct inode *sufile)\n{\n\treturn ((struct the_nilfs *)sufile->i_sb->s_fs_info)->ns_nsegments;\n}"
        }
      },
      {
        "call_info": {
          "callee": "bh_offset",
          "args": [
            "header_bh"
          ],
          "line": 582
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kmap_atomic",
          "args": [
            "header_bh->b_page"
          ],
          "line": 581
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "nilfs_sufile_get_header_block",
          "args": [
            "sufile",
            "&header_bh"
          ],
          "line": 577
        },
        "resolved": true,
        "details": {
          "function_name": "nilfs_sufile_get_header_block",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/sufile.c",
          "lines": "92-96",
          "snippet": "static inline int nilfs_sufile_get_header_block(struct inode *sufile,\n\t\t\t\t\t\tstruct buffer_head **bhp)\n{\n\treturn nilfs_mdt_get_block(sufile, 0, 0, NULL, bhp);\n}",
          "includes": [
            "#include \"sufile.h\"",
            "#include \"mdt.h\"",
            "#include <linux/nilfs2_fs.h>",
            "#include <linux/errno.h>",
            "#include <linux/buffer_head.h>",
            "#include <linux/string.h>",
            "#include <linux/fs.h>",
            "#include <linux/kernel.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sufile.h\"\n#include \"mdt.h\"\n#include <linux/nilfs2_fs.h>\n#include <linux/errno.h>\n#include <linux/buffer_head.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n#include <linux/kernel.h>\n\nstatic inline int nilfs_sufile_get_header_block(struct inode *sufile,\n\t\t\t\t\t\tstruct buffer_head **bhp)\n{\n\treturn nilfs_mdt_get_block(sufile, 0, 0, NULL, bhp);\n}"
        }
      },
      {
        "call_info": {
          "callee": "down_read",
          "args": [
            "&NILFS_MDT(sufile)->mi_sem"
          ],
          "line": 575
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"sufile.h\"\n#include \"mdt.h\"\n#include <linux/nilfs2_fs.h>\n#include <linux/errno.h>\n#include <linux/buffer_head.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n#include <linux/kernel.h>\n\nint nilfs_sufile_get_stat(struct inode *sufile, struct nilfs_sustat *sustat)\n{\n\tstruct buffer_head *header_bh;\n\tstruct nilfs_sufile_header *header;\n\tstruct the_nilfs *nilfs = sufile->i_sb->s_fs_info;\n\tvoid *kaddr;\n\tint ret;\n\n\tdown_read(&NILFS_MDT(sufile)->mi_sem);\n\n\tret = nilfs_sufile_get_header_block(sufile, &header_bh);\n\tif (ret < 0)\n\t\tgoto out_sem;\n\n\tkaddr = kmap_atomic(header_bh->b_page);\n\theader = kaddr + bh_offset(header_bh);\n\tsustat->ss_nsegs = nilfs_sufile_get_nsegments(sufile);\n\tsustat->ss_ncleansegs = le64_to_cpu(header->sh_ncleansegs);\n\tsustat->ss_ndirtysegs = le64_to_cpu(header->sh_ndirtysegs);\n\tsustat->ss_ctime = nilfs->ns_ctime;\n\tsustat->ss_nongc_ctime = nilfs->ns_nongc_ctime;\n\tspin_lock(&nilfs->ns_last_segment_lock);\n\tsustat->ss_prot_seq = nilfs->ns_prot_seq;\n\tspin_unlock(&nilfs->ns_last_segment_lock);\n\tkunmap_atomic(kaddr);\n\tbrelse(header_bh);\n\n out_sem:\n\tup_read(&NILFS_MDT(sufile)->mi_sem);\n\treturn ret;\n}"
  },
  {
    "function_name": "nilfs_sufile_set_segment_usage",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/sufile.c",
    "lines": "521-549",
    "snippet": "int nilfs_sufile_set_segment_usage(struct inode *sufile, __u64 segnum,\n\t\t\t\t   unsigned long nblocks, time_t modtime)\n{\n\tstruct buffer_head *bh;\n\tstruct nilfs_segment_usage *su;\n\tvoid *kaddr;\n\tint ret;\n\n\tdown_write(&NILFS_MDT(sufile)->mi_sem);\n\tret = nilfs_sufile_get_segment_usage_block(sufile, segnum, 0, &bh);\n\tif (ret < 0)\n\t\tgoto out_sem;\n\n\tkaddr = kmap_atomic(bh->b_page);\n\tsu = nilfs_sufile_block_get_segment_usage(sufile, segnum, bh, kaddr);\n\tWARN_ON(nilfs_segment_usage_error(su));\n\tif (modtime)\n\t\tsu->su_lastmod = cpu_to_le64(modtime);\n\tsu->su_nblocks = cpu_to_le32(nblocks);\n\tkunmap_atomic(kaddr);\n\n\tmark_buffer_dirty(bh);\n\tnilfs_mdt_mark_dirty(sufile);\n\tbrelse(bh);\n\n out_sem:\n\tup_write(&NILFS_MDT(sufile)->mi_sem);\n\treturn ret;\n}",
    "includes": [
      "#include \"sufile.h\"",
      "#include \"mdt.h\"",
      "#include <linux/nilfs2_fs.h>",
      "#include <linux/errno.h>",
      "#include <linux/buffer_head.h>",
      "#include <linux/string.h>",
      "#include <linux/fs.h>",
      "#include <linux/kernel.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "up_write",
          "args": [
            "&NILFS_MDT(sufile)->mi_sem"
          ],
          "line": 547
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "NILFS_MDT",
          "args": [
            "sufile"
          ],
          "line": 547
        },
        "resolved": true,
        "details": {
          "function_name": "NILFS_MDT",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/mdt.h",
          "lines": "69-72",
          "snippet": "static inline struct nilfs_mdt_info *NILFS_MDT(const struct inode *inode)\n{\n\treturn inode->i_private;\n}",
          "includes": [
            "#include \"page.h\"",
            "#include \"nilfs.h\"",
            "#include <linux/blockgroup_lock.h>",
            "#include <linux/buffer_head.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"page.h\"\n#include \"nilfs.h\"\n#include <linux/blockgroup_lock.h>\n#include <linux/buffer_head.h>\n\nstatic inline struct nilfs_mdt_info *NILFS_MDT(const struct inode *inode)\n{\n\treturn inode->i_private;\n}"
        }
      },
      {
        "call_info": {
          "callee": "brelse",
          "args": [
            "bh"
          ],
          "line": 544
        },
        "resolved": true,
        "details": {
          "function_name": "__brelse",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/buffer.c",
          "lines": "1177-1184",
          "snippet": "void __brelse(struct buffer_head * buf)\n{\n\tif (atomic_read(&buf->b_count)) {\n\t\tput_bh(buf);\n\t\treturn;\n\t}\n\tWARN(1, KERN_ERR \"VFS: brelse: Trying to free free buffer\\n\");\n}",
          "includes": [
            "#include <trace/events/block.h>",
            "#include <linux/bit_spinlock.h>",
            "#include <linux/mpage.h>",
            "#include <linux/bitops.h>",
            "#include <linux/cpu.h>",
            "#include <linux/notifier.h>",
            "#include <linux/bio.h>",
            "#include <linux/task_io_accounting_ops.h>",
            "#include <linux/buffer_head.h>",
            "#include <linux/suspend.h>",
            "#include <linux/hash.h>",
            "#include <linux/writeback.h>",
            "#include <linux/export.h>",
            "#include <linux/highmem.h>",
            "#include <linux/quotaops.h>",
            "#include <linux/file.h>",
            "#include <linux/blkdev.h>",
            "#include <linux/capability.h>",
            "#include <linux/slab.h>",
            "#include <linux/percpu.h>",
            "#include <linux/mm.h>",
            "#include <linux/fs.h>",
            "#include <linux/syscalls.h>",
            "#include <linux/kernel.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <trace/events/block.h>\n#include <linux/bit_spinlock.h>\n#include <linux/mpage.h>\n#include <linux/bitops.h>\n#include <linux/cpu.h>\n#include <linux/notifier.h>\n#include <linux/bio.h>\n#include <linux/task_io_accounting_ops.h>\n#include <linux/buffer_head.h>\n#include <linux/suspend.h>\n#include <linux/hash.h>\n#include <linux/writeback.h>\n#include <linux/export.h>\n#include <linux/highmem.h>\n#include <linux/quotaops.h>\n#include <linux/file.h>\n#include <linux/blkdev.h>\n#include <linux/capability.h>\n#include <linux/slab.h>\n#include <linux/percpu.h>\n#include <linux/mm.h>\n#include <linux/fs.h>\n#include <linux/syscalls.h>\n#include <linux/kernel.h>\n\nvoid __brelse(struct buffer_head * buf)\n{\n\tif (atomic_read(&buf->b_count)) {\n\t\tput_bh(buf);\n\t\treturn;\n\t}\n\tWARN(1, KERN_ERR \"VFS: brelse: Trying to free free buffer\\n\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "nilfs_mdt_mark_dirty",
          "args": [
            "sufile"
          ],
          "line": 543
        },
        "resolved": true,
        "details": {
          "function_name": "nilfs_mdt_mark_dirty",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/mdt.h",
          "lines": "98-102",
          "snippet": "static inline void nilfs_mdt_mark_dirty(struct inode *inode)\n{\n\tif (!test_bit(NILFS_I_DIRTY, &NILFS_I(inode)->i_state))\n\t\tset_bit(NILFS_I_DIRTY, &NILFS_I(inode)->i_state);\n}",
          "includes": [
            "#include \"page.h\"",
            "#include \"nilfs.h\"",
            "#include <linux/blockgroup_lock.h>",
            "#include <linux/buffer_head.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"page.h\"\n#include \"nilfs.h\"\n#include <linux/blockgroup_lock.h>\n#include <linux/buffer_head.h>\n\nstatic inline void nilfs_mdt_mark_dirty(struct inode *inode)\n{\n\tif (!test_bit(NILFS_I_DIRTY, &NILFS_I(inode)->i_state))\n\t\tset_bit(NILFS_I_DIRTY, &NILFS_I(inode)->i_state);\n}"
        }
      },
      {
        "call_info": {
          "callee": "mark_buffer_dirty",
          "args": [
            "bh"
          ],
          "line": 542
        },
        "resolved": true,
        "details": {
          "function_name": "mark_buffer_dirty",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/buffer.c",
          "lines": "1141-1167",
          "snippet": "void mark_buffer_dirty(struct buffer_head *bh)\n{\n\tWARN_ON_ONCE(!buffer_uptodate(bh));\n\n\ttrace_block_dirty_buffer(bh);\n\n\t/*\n\t * Very *carefully* optimize the it-is-already-dirty case.\n\t *\n\t * Don't let the final \"is it dirty\" escape to before we\n\t * perhaps modified the buffer.\n\t */\n\tif (buffer_dirty(bh)) {\n\t\tsmp_mb();\n\t\tif (buffer_dirty(bh))\n\t\t\treturn;\n\t}\n\n\tif (!test_set_buffer_dirty(bh)) {\n\t\tstruct page *page = bh->b_page;\n\t\tif (!TestSetPageDirty(page)) {\n\t\t\tstruct address_space *mapping = page_mapping(page);\n\t\t\tif (mapping)\n\t\t\t\t__set_page_dirty(page, mapping, 0);\n\t\t}\n\t}\n}",
          "includes": [
            "#include <trace/events/block.h>",
            "#include <linux/bit_spinlock.h>",
            "#include <linux/mpage.h>",
            "#include <linux/bitops.h>",
            "#include <linux/cpu.h>",
            "#include <linux/notifier.h>",
            "#include <linux/bio.h>",
            "#include <linux/task_io_accounting_ops.h>",
            "#include <linux/buffer_head.h>",
            "#include <linux/suspend.h>",
            "#include <linux/hash.h>",
            "#include <linux/writeback.h>",
            "#include <linux/export.h>",
            "#include <linux/highmem.h>",
            "#include <linux/quotaops.h>",
            "#include <linux/file.h>",
            "#include <linux/blkdev.h>",
            "#include <linux/capability.h>",
            "#include <linux/slab.h>",
            "#include <linux/percpu.h>",
            "#include <linux/mm.h>",
            "#include <linux/fs.h>",
            "#include <linux/syscalls.h>",
            "#include <linux/kernel.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <trace/events/block.h>\n#include <linux/bit_spinlock.h>\n#include <linux/mpage.h>\n#include <linux/bitops.h>\n#include <linux/cpu.h>\n#include <linux/notifier.h>\n#include <linux/bio.h>\n#include <linux/task_io_accounting_ops.h>\n#include <linux/buffer_head.h>\n#include <linux/suspend.h>\n#include <linux/hash.h>\n#include <linux/writeback.h>\n#include <linux/export.h>\n#include <linux/highmem.h>\n#include <linux/quotaops.h>\n#include <linux/file.h>\n#include <linux/blkdev.h>\n#include <linux/capability.h>\n#include <linux/slab.h>\n#include <linux/percpu.h>\n#include <linux/mm.h>\n#include <linux/fs.h>\n#include <linux/syscalls.h>\n#include <linux/kernel.h>\n\nvoid mark_buffer_dirty(struct buffer_head *bh)\n{\n\tWARN_ON_ONCE(!buffer_uptodate(bh));\n\n\ttrace_block_dirty_buffer(bh);\n\n\t/*\n\t * Very *carefully* optimize the it-is-already-dirty case.\n\t *\n\t * Don't let the final \"is it dirty\" escape to before we\n\t * perhaps modified the buffer.\n\t */\n\tif (buffer_dirty(bh)) {\n\t\tsmp_mb();\n\t\tif (buffer_dirty(bh))\n\t\t\treturn;\n\t}\n\n\tif (!test_set_buffer_dirty(bh)) {\n\t\tstruct page *page = bh->b_page;\n\t\tif (!TestSetPageDirty(page)) {\n\t\t\tstruct address_space *mapping = page_mapping(page);\n\t\t\tif (mapping)\n\t\t\t\t__set_page_dirty(page, mapping, 0);\n\t\t}\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "kunmap_atomic",
          "args": [
            "kaddr"
          ],
          "line": 540
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "cpu_to_le32",
          "args": [
            "nblocks"
          ],
          "line": 539
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "cpu_to_le64",
          "args": [
            "modtime"
          ],
          "line": 538
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "WARN_ON",
          "args": [
            "nilfs_segment_usage_error(su)"
          ],
          "line": 536
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "nilfs_segment_usage_error",
          "args": [
            "su"
          ],
          "line": 536
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "nilfs_sufile_block_get_segment_usage",
          "args": [
            "sufile",
            "segnum",
            "bh",
            "kaddr"
          ],
          "line": 535
        },
        "resolved": true,
        "details": {
          "function_name": "nilfs_sufile_block_get_segment_usage",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/sufile.c",
          "lines": "83-90",
          "snippet": "static struct nilfs_segment_usage *\nnilfs_sufile_block_get_segment_usage(const struct inode *sufile, __u64 segnum,\n\t\t\t\t     struct buffer_head *bh, void *kaddr)\n{\n\treturn kaddr + bh_offset(bh) +\n\t\tnilfs_sufile_get_offset(sufile, segnum) *\n\t\tNILFS_MDT(sufile)->mi_entry_size;\n}",
          "includes": [
            "#include \"sufile.h\"",
            "#include \"mdt.h\"",
            "#include <linux/nilfs2_fs.h>",
            "#include <linux/errno.h>",
            "#include <linux/buffer_head.h>",
            "#include <linux/string.h>",
            "#include <linux/fs.h>",
            "#include <linux/kernel.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sufile.h\"\n#include \"mdt.h\"\n#include <linux/nilfs2_fs.h>\n#include <linux/errno.h>\n#include <linux/buffer_head.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n#include <linux/kernel.h>\n\nstatic struct nilfs_segment_usage *\nnilfs_sufile_block_get_segment_usage(const struct inode *sufile, __u64 segnum,\n\t\t\t\t     struct buffer_head *bh, void *kaddr)\n{\n\treturn kaddr + bh_offset(bh) +\n\t\tnilfs_sufile_get_offset(sufile, segnum) *\n\t\tNILFS_MDT(sufile)->mi_entry_size;\n}"
        }
      },
      {
        "call_info": {
          "callee": "kmap_atomic",
          "args": [
            "bh->b_page"
          ],
          "line": 534
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "nilfs_sufile_get_segment_usage_block",
          "args": [
            "sufile",
            "segnum",
            "0",
            "&bh"
          ],
          "line": 530
        },
        "resolved": true,
        "details": {
          "function_name": "nilfs_sufile_get_segment_usage_block",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/sufile.c",
          "lines": "98-105",
          "snippet": "static inline int\nnilfs_sufile_get_segment_usage_block(struct inode *sufile, __u64 segnum,\n\t\t\t\t     int create, struct buffer_head **bhp)\n{\n\treturn nilfs_mdt_get_block(sufile,\n\t\t\t\t   nilfs_sufile_get_blkoff(sufile, segnum),\n\t\t\t\t   create, NULL, bhp);\n}",
          "includes": [
            "#include \"sufile.h\"",
            "#include \"mdt.h\"",
            "#include <linux/nilfs2_fs.h>",
            "#include <linux/errno.h>",
            "#include <linux/buffer_head.h>",
            "#include <linux/string.h>",
            "#include <linux/fs.h>",
            "#include <linux/kernel.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sufile.h\"\n#include \"mdt.h\"\n#include <linux/nilfs2_fs.h>\n#include <linux/errno.h>\n#include <linux/buffer_head.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n#include <linux/kernel.h>\n\nstatic inline int\nnilfs_sufile_get_segment_usage_block(struct inode *sufile, __u64 segnum,\n\t\t\t\t     int create, struct buffer_head **bhp)\n{\n\treturn nilfs_mdt_get_block(sufile,\n\t\t\t\t   nilfs_sufile_get_blkoff(sufile, segnum),\n\t\t\t\t   create, NULL, bhp);\n}"
        }
      },
      {
        "call_info": {
          "callee": "down_write",
          "args": [
            "&NILFS_MDT(sufile)->mi_sem"
          ],
          "line": 529
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"sufile.h\"\n#include \"mdt.h\"\n#include <linux/nilfs2_fs.h>\n#include <linux/errno.h>\n#include <linux/buffer_head.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n#include <linux/kernel.h>\n\nint nilfs_sufile_set_segment_usage(struct inode *sufile, __u64 segnum,\n\t\t\t\t   unsigned long nblocks, time_t modtime)\n{\n\tstruct buffer_head *bh;\n\tstruct nilfs_segment_usage *su;\n\tvoid *kaddr;\n\tint ret;\n\n\tdown_write(&NILFS_MDT(sufile)->mi_sem);\n\tret = nilfs_sufile_get_segment_usage_block(sufile, segnum, 0, &bh);\n\tif (ret < 0)\n\t\tgoto out_sem;\n\n\tkaddr = kmap_atomic(bh->b_page);\n\tsu = nilfs_sufile_block_get_segment_usage(sufile, segnum, bh, kaddr);\n\tWARN_ON(nilfs_segment_usage_error(su));\n\tif (modtime)\n\t\tsu->su_lastmod = cpu_to_le64(modtime);\n\tsu->su_nblocks = cpu_to_le32(nblocks);\n\tkunmap_atomic(kaddr);\n\n\tmark_buffer_dirty(bh);\n\tnilfs_mdt_mark_dirty(sufile);\n\tbrelse(bh);\n\n out_sem:\n\tup_write(&NILFS_MDT(sufile)->mi_sem);\n\treturn ret;\n}"
  },
  {
    "function_name": "nilfs_sufile_mark_dirty",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/sufile.c",
    "lines": "500-512",
    "snippet": "int nilfs_sufile_mark_dirty(struct inode *sufile, __u64 segnum)\n{\n\tstruct buffer_head *bh;\n\tint ret;\n\n\tret = nilfs_sufile_get_segment_usage_block(sufile, segnum, 0, &bh);\n\tif (!ret) {\n\t\tmark_buffer_dirty(bh);\n\t\tnilfs_mdt_mark_dirty(sufile);\n\t\tbrelse(bh);\n\t}\n\treturn ret;\n}",
    "includes": [
      "#include \"sufile.h\"",
      "#include \"mdt.h\"",
      "#include <linux/nilfs2_fs.h>",
      "#include <linux/errno.h>",
      "#include <linux/buffer_head.h>",
      "#include <linux/string.h>",
      "#include <linux/fs.h>",
      "#include <linux/kernel.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "brelse",
          "args": [
            "bh"
          ],
          "line": 509
        },
        "resolved": true,
        "details": {
          "function_name": "__brelse",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/buffer.c",
          "lines": "1177-1184",
          "snippet": "void __brelse(struct buffer_head * buf)\n{\n\tif (atomic_read(&buf->b_count)) {\n\t\tput_bh(buf);\n\t\treturn;\n\t}\n\tWARN(1, KERN_ERR \"VFS: brelse: Trying to free free buffer\\n\");\n}",
          "includes": [
            "#include <trace/events/block.h>",
            "#include <linux/bit_spinlock.h>",
            "#include <linux/mpage.h>",
            "#include <linux/bitops.h>",
            "#include <linux/cpu.h>",
            "#include <linux/notifier.h>",
            "#include <linux/bio.h>",
            "#include <linux/task_io_accounting_ops.h>",
            "#include <linux/buffer_head.h>",
            "#include <linux/suspend.h>",
            "#include <linux/hash.h>",
            "#include <linux/writeback.h>",
            "#include <linux/export.h>",
            "#include <linux/highmem.h>",
            "#include <linux/quotaops.h>",
            "#include <linux/file.h>",
            "#include <linux/blkdev.h>",
            "#include <linux/capability.h>",
            "#include <linux/slab.h>",
            "#include <linux/percpu.h>",
            "#include <linux/mm.h>",
            "#include <linux/fs.h>",
            "#include <linux/syscalls.h>",
            "#include <linux/kernel.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <trace/events/block.h>\n#include <linux/bit_spinlock.h>\n#include <linux/mpage.h>\n#include <linux/bitops.h>\n#include <linux/cpu.h>\n#include <linux/notifier.h>\n#include <linux/bio.h>\n#include <linux/task_io_accounting_ops.h>\n#include <linux/buffer_head.h>\n#include <linux/suspend.h>\n#include <linux/hash.h>\n#include <linux/writeback.h>\n#include <linux/export.h>\n#include <linux/highmem.h>\n#include <linux/quotaops.h>\n#include <linux/file.h>\n#include <linux/blkdev.h>\n#include <linux/capability.h>\n#include <linux/slab.h>\n#include <linux/percpu.h>\n#include <linux/mm.h>\n#include <linux/fs.h>\n#include <linux/syscalls.h>\n#include <linux/kernel.h>\n\nvoid __brelse(struct buffer_head * buf)\n{\n\tif (atomic_read(&buf->b_count)) {\n\t\tput_bh(buf);\n\t\treturn;\n\t}\n\tWARN(1, KERN_ERR \"VFS: brelse: Trying to free free buffer\\n\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "nilfs_mdt_mark_dirty",
          "args": [
            "sufile"
          ],
          "line": 508
        },
        "resolved": true,
        "details": {
          "function_name": "nilfs_mdt_mark_dirty",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/mdt.h",
          "lines": "98-102",
          "snippet": "static inline void nilfs_mdt_mark_dirty(struct inode *inode)\n{\n\tif (!test_bit(NILFS_I_DIRTY, &NILFS_I(inode)->i_state))\n\t\tset_bit(NILFS_I_DIRTY, &NILFS_I(inode)->i_state);\n}",
          "includes": [
            "#include \"page.h\"",
            "#include \"nilfs.h\"",
            "#include <linux/blockgroup_lock.h>",
            "#include <linux/buffer_head.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"page.h\"\n#include \"nilfs.h\"\n#include <linux/blockgroup_lock.h>\n#include <linux/buffer_head.h>\n\nstatic inline void nilfs_mdt_mark_dirty(struct inode *inode)\n{\n\tif (!test_bit(NILFS_I_DIRTY, &NILFS_I(inode)->i_state))\n\t\tset_bit(NILFS_I_DIRTY, &NILFS_I(inode)->i_state);\n}"
        }
      },
      {
        "call_info": {
          "callee": "mark_buffer_dirty",
          "args": [
            "bh"
          ],
          "line": 507
        },
        "resolved": true,
        "details": {
          "function_name": "mark_buffer_dirty",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/buffer.c",
          "lines": "1141-1167",
          "snippet": "void mark_buffer_dirty(struct buffer_head *bh)\n{\n\tWARN_ON_ONCE(!buffer_uptodate(bh));\n\n\ttrace_block_dirty_buffer(bh);\n\n\t/*\n\t * Very *carefully* optimize the it-is-already-dirty case.\n\t *\n\t * Don't let the final \"is it dirty\" escape to before we\n\t * perhaps modified the buffer.\n\t */\n\tif (buffer_dirty(bh)) {\n\t\tsmp_mb();\n\t\tif (buffer_dirty(bh))\n\t\t\treturn;\n\t}\n\n\tif (!test_set_buffer_dirty(bh)) {\n\t\tstruct page *page = bh->b_page;\n\t\tif (!TestSetPageDirty(page)) {\n\t\t\tstruct address_space *mapping = page_mapping(page);\n\t\t\tif (mapping)\n\t\t\t\t__set_page_dirty(page, mapping, 0);\n\t\t}\n\t}\n}",
          "includes": [
            "#include <trace/events/block.h>",
            "#include <linux/bit_spinlock.h>",
            "#include <linux/mpage.h>",
            "#include <linux/bitops.h>",
            "#include <linux/cpu.h>",
            "#include <linux/notifier.h>",
            "#include <linux/bio.h>",
            "#include <linux/task_io_accounting_ops.h>",
            "#include <linux/buffer_head.h>",
            "#include <linux/suspend.h>",
            "#include <linux/hash.h>",
            "#include <linux/writeback.h>",
            "#include <linux/export.h>",
            "#include <linux/highmem.h>",
            "#include <linux/quotaops.h>",
            "#include <linux/file.h>",
            "#include <linux/blkdev.h>",
            "#include <linux/capability.h>",
            "#include <linux/slab.h>",
            "#include <linux/percpu.h>",
            "#include <linux/mm.h>",
            "#include <linux/fs.h>",
            "#include <linux/syscalls.h>",
            "#include <linux/kernel.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <trace/events/block.h>\n#include <linux/bit_spinlock.h>\n#include <linux/mpage.h>\n#include <linux/bitops.h>\n#include <linux/cpu.h>\n#include <linux/notifier.h>\n#include <linux/bio.h>\n#include <linux/task_io_accounting_ops.h>\n#include <linux/buffer_head.h>\n#include <linux/suspend.h>\n#include <linux/hash.h>\n#include <linux/writeback.h>\n#include <linux/export.h>\n#include <linux/highmem.h>\n#include <linux/quotaops.h>\n#include <linux/file.h>\n#include <linux/blkdev.h>\n#include <linux/capability.h>\n#include <linux/slab.h>\n#include <linux/percpu.h>\n#include <linux/mm.h>\n#include <linux/fs.h>\n#include <linux/syscalls.h>\n#include <linux/kernel.h>\n\nvoid mark_buffer_dirty(struct buffer_head *bh)\n{\n\tWARN_ON_ONCE(!buffer_uptodate(bh));\n\n\ttrace_block_dirty_buffer(bh);\n\n\t/*\n\t * Very *carefully* optimize the it-is-already-dirty case.\n\t *\n\t * Don't let the final \"is it dirty\" escape to before we\n\t * perhaps modified the buffer.\n\t */\n\tif (buffer_dirty(bh)) {\n\t\tsmp_mb();\n\t\tif (buffer_dirty(bh))\n\t\t\treturn;\n\t}\n\n\tif (!test_set_buffer_dirty(bh)) {\n\t\tstruct page *page = bh->b_page;\n\t\tif (!TestSetPageDirty(page)) {\n\t\t\tstruct address_space *mapping = page_mapping(page);\n\t\t\tif (mapping)\n\t\t\t\t__set_page_dirty(page, mapping, 0);\n\t\t}\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "nilfs_sufile_get_segment_usage_block",
          "args": [
            "sufile",
            "segnum",
            "0",
            "&bh"
          ],
          "line": 505
        },
        "resolved": true,
        "details": {
          "function_name": "nilfs_sufile_get_segment_usage_block",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/sufile.c",
          "lines": "98-105",
          "snippet": "static inline int\nnilfs_sufile_get_segment_usage_block(struct inode *sufile, __u64 segnum,\n\t\t\t\t     int create, struct buffer_head **bhp)\n{\n\treturn nilfs_mdt_get_block(sufile,\n\t\t\t\t   nilfs_sufile_get_blkoff(sufile, segnum),\n\t\t\t\t   create, NULL, bhp);\n}",
          "includes": [
            "#include \"sufile.h\"",
            "#include \"mdt.h\"",
            "#include <linux/nilfs2_fs.h>",
            "#include <linux/errno.h>",
            "#include <linux/buffer_head.h>",
            "#include <linux/string.h>",
            "#include <linux/fs.h>",
            "#include <linux/kernel.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sufile.h\"\n#include \"mdt.h\"\n#include <linux/nilfs2_fs.h>\n#include <linux/errno.h>\n#include <linux/buffer_head.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n#include <linux/kernel.h>\n\nstatic inline int\nnilfs_sufile_get_segment_usage_block(struct inode *sufile, __u64 segnum,\n\t\t\t\t     int create, struct buffer_head **bhp)\n{\n\treturn nilfs_mdt_get_block(sufile,\n\t\t\t\t   nilfs_sufile_get_blkoff(sufile, segnum),\n\t\t\t\t   create, NULL, bhp);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"sufile.h\"\n#include \"mdt.h\"\n#include <linux/nilfs2_fs.h>\n#include <linux/errno.h>\n#include <linux/buffer_head.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n#include <linux/kernel.h>\n\nint nilfs_sufile_mark_dirty(struct inode *sufile, __u64 segnum)\n{\n\tstruct buffer_head *bh;\n\tint ret;\n\n\tret = nilfs_sufile_get_segment_usage_block(sufile, segnum, 0, &bh);\n\tif (!ret) {\n\t\tmark_buffer_dirty(bh);\n\t\tnilfs_mdt_mark_dirty(sufile);\n\t\tbrelse(bh);\n\t}\n\treturn ret;\n}"
  },
  {
    "function_name": "nilfs_sufile_do_free",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/sufile.c",
    "lines": "465-493",
    "snippet": "void nilfs_sufile_do_free(struct inode *sufile, __u64 segnum,\n\t\t\t  struct buffer_head *header_bh,\n\t\t\t  struct buffer_head *su_bh)\n{\n\tstruct nilfs_segment_usage *su;\n\tvoid *kaddr;\n\tint sudirty;\n\n\tkaddr = kmap_atomic(su_bh->b_page);\n\tsu = nilfs_sufile_block_get_segment_usage(sufile, segnum, su_bh, kaddr);\n\tif (nilfs_segment_usage_clean(su)) {\n\t\tprintk(KERN_WARNING \"%s: segment %llu is already clean\\n\",\n\t\t       __func__, (unsigned long long)segnum);\n\t\tkunmap_atomic(kaddr);\n\t\treturn;\n\t}\n\tWARN_ON(nilfs_segment_usage_error(su));\n\tWARN_ON(!nilfs_segment_usage_dirty(su));\n\n\tsudirty = nilfs_segment_usage_dirty(su);\n\tnilfs_segment_usage_set_clean(su);\n\tkunmap_atomic(kaddr);\n\tmark_buffer_dirty(su_bh);\n\n\tnilfs_sufile_mod_counter(header_bh, 1, sudirty ? (u64)-1 : 0);\n\tNILFS_SUI(sufile)->ncleansegs++;\n\n\tnilfs_mdt_mark_dirty(sufile);\n}",
    "includes": [
      "#include \"sufile.h\"",
      "#include \"mdt.h\"",
      "#include <linux/nilfs2_fs.h>",
      "#include <linux/errno.h>",
      "#include <linux/buffer_head.h>",
      "#include <linux/string.h>",
      "#include <linux/fs.h>",
      "#include <linux/kernel.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "nilfs_mdt_mark_dirty",
          "args": [
            "sufile"
          ],
          "line": 492
        },
        "resolved": true,
        "details": {
          "function_name": "nilfs_mdt_mark_dirty",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/mdt.h",
          "lines": "98-102",
          "snippet": "static inline void nilfs_mdt_mark_dirty(struct inode *inode)\n{\n\tif (!test_bit(NILFS_I_DIRTY, &NILFS_I(inode)->i_state))\n\t\tset_bit(NILFS_I_DIRTY, &NILFS_I(inode)->i_state);\n}",
          "includes": [
            "#include \"page.h\"",
            "#include \"nilfs.h\"",
            "#include <linux/blockgroup_lock.h>",
            "#include <linux/buffer_head.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"page.h\"\n#include \"nilfs.h\"\n#include <linux/blockgroup_lock.h>\n#include <linux/buffer_head.h>\n\nstatic inline void nilfs_mdt_mark_dirty(struct inode *inode)\n{\n\tif (!test_bit(NILFS_I_DIRTY, &NILFS_I(inode)->i_state))\n\t\tset_bit(NILFS_I_DIRTY, &NILFS_I(inode)->i_state);\n}"
        }
      },
      {
        "call_info": {
          "callee": "NILFS_SUI",
          "args": [
            "sufile"
          ],
          "line": 490
        },
        "resolved": true,
        "details": {
          "function_name": "NILFS_SUI",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/sufile.c",
          "lines": "47-50",
          "snippet": "static inline struct nilfs_sufile_info *NILFS_SUI(struct inode *sufile)\n{\n\treturn (struct nilfs_sufile_info *)NILFS_MDT(sufile);\n}",
          "includes": [
            "#include \"sufile.h\"",
            "#include \"mdt.h\"",
            "#include <linux/nilfs2_fs.h>",
            "#include <linux/errno.h>",
            "#include <linux/buffer_head.h>",
            "#include <linux/string.h>",
            "#include <linux/fs.h>",
            "#include <linux/kernel.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sufile.h\"\n#include \"mdt.h\"\n#include <linux/nilfs2_fs.h>\n#include <linux/errno.h>\n#include <linux/buffer_head.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n#include <linux/kernel.h>\n\nstatic inline struct nilfs_sufile_info *NILFS_SUI(struct inode *sufile)\n{\n\treturn (struct nilfs_sufile_info *)NILFS_MDT(sufile);\n}"
        }
      },
      {
        "call_info": {
          "callee": "nilfs_sufile_mod_counter",
          "args": [
            "header_bh",
            "1",
            "sudirty ? (u64)-1 : 0"
          ],
          "line": 489
        },
        "resolved": true,
        "details": {
          "function_name": "nilfs_sufile_mod_counter",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/sufile.c",
          "lines": "114-127",
          "snippet": "static void nilfs_sufile_mod_counter(struct buffer_head *header_bh,\n\t\t\t\t     u64 ncleanadd, u64 ndirtyadd)\n{\n\tstruct nilfs_sufile_header *header;\n\tvoid *kaddr;\n\n\tkaddr = kmap_atomic(header_bh->b_page);\n\theader = kaddr + bh_offset(header_bh);\n\tle64_add_cpu(&header->sh_ncleansegs, ncleanadd);\n\tle64_add_cpu(&header->sh_ndirtysegs, ndirtyadd);\n\tkunmap_atomic(kaddr);\n\n\tmark_buffer_dirty(header_bh);\n}",
          "includes": [
            "#include \"sufile.h\"",
            "#include \"mdt.h\"",
            "#include <linux/nilfs2_fs.h>",
            "#include <linux/errno.h>",
            "#include <linux/buffer_head.h>",
            "#include <linux/string.h>",
            "#include <linux/fs.h>",
            "#include <linux/kernel.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sufile.h\"\n#include \"mdt.h\"\n#include <linux/nilfs2_fs.h>\n#include <linux/errno.h>\n#include <linux/buffer_head.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n#include <linux/kernel.h>\n\nstatic void nilfs_sufile_mod_counter(struct buffer_head *header_bh,\n\t\t\t\t     u64 ncleanadd, u64 ndirtyadd)\n{\n\tstruct nilfs_sufile_header *header;\n\tvoid *kaddr;\n\n\tkaddr = kmap_atomic(header_bh->b_page);\n\theader = kaddr + bh_offset(header_bh);\n\tle64_add_cpu(&header->sh_ncleansegs, ncleanadd);\n\tle64_add_cpu(&header->sh_ndirtysegs, ndirtyadd);\n\tkunmap_atomic(kaddr);\n\n\tmark_buffer_dirty(header_bh);\n}"
        }
      },
      {
        "call_info": {
          "callee": "mark_buffer_dirty",
          "args": [
            "su_bh"
          ],
          "line": 487
        },
        "resolved": true,
        "details": {
          "function_name": "mark_buffer_dirty",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/buffer.c",
          "lines": "1141-1167",
          "snippet": "void mark_buffer_dirty(struct buffer_head *bh)\n{\n\tWARN_ON_ONCE(!buffer_uptodate(bh));\n\n\ttrace_block_dirty_buffer(bh);\n\n\t/*\n\t * Very *carefully* optimize the it-is-already-dirty case.\n\t *\n\t * Don't let the final \"is it dirty\" escape to before we\n\t * perhaps modified the buffer.\n\t */\n\tif (buffer_dirty(bh)) {\n\t\tsmp_mb();\n\t\tif (buffer_dirty(bh))\n\t\t\treturn;\n\t}\n\n\tif (!test_set_buffer_dirty(bh)) {\n\t\tstruct page *page = bh->b_page;\n\t\tif (!TestSetPageDirty(page)) {\n\t\t\tstruct address_space *mapping = page_mapping(page);\n\t\t\tif (mapping)\n\t\t\t\t__set_page_dirty(page, mapping, 0);\n\t\t}\n\t}\n}",
          "includes": [
            "#include <trace/events/block.h>",
            "#include <linux/bit_spinlock.h>",
            "#include <linux/mpage.h>",
            "#include <linux/bitops.h>",
            "#include <linux/cpu.h>",
            "#include <linux/notifier.h>",
            "#include <linux/bio.h>",
            "#include <linux/task_io_accounting_ops.h>",
            "#include <linux/buffer_head.h>",
            "#include <linux/suspend.h>",
            "#include <linux/hash.h>",
            "#include <linux/writeback.h>",
            "#include <linux/export.h>",
            "#include <linux/highmem.h>",
            "#include <linux/quotaops.h>",
            "#include <linux/file.h>",
            "#include <linux/blkdev.h>",
            "#include <linux/capability.h>",
            "#include <linux/slab.h>",
            "#include <linux/percpu.h>",
            "#include <linux/mm.h>",
            "#include <linux/fs.h>",
            "#include <linux/syscalls.h>",
            "#include <linux/kernel.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <trace/events/block.h>\n#include <linux/bit_spinlock.h>\n#include <linux/mpage.h>\n#include <linux/bitops.h>\n#include <linux/cpu.h>\n#include <linux/notifier.h>\n#include <linux/bio.h>\n#include <linux/task_io_accounting_ops.h>\n#include <linux/buffer_head.h>\n#include <linux/suspend.h>\n#include <linux/hash.h>\n#include <linux/writeback.h>\n#include <linux/export.h>\n#include <linux/highmem.h>\n#include <linux/quotaops.h>\n#include <linux/file.h>\n#include <linux/blkdev.h>\n#include <linux/capability.h>\n#include <linux/slab.h>\n#include <linux/percpu.h>\n#include <linux/mm.h>\n#include <linux/fs.h>\n#include <linux/syscalls.h>\n#include <linux/kernel.h>\n\nvoid mark_buffer_dirty(struct buffer_head *bh)\n{\n\tWARN_ON_ONCE(!buffer_uptodate(bh));\n\n\ttrace_block_dirty_buffer(bh);\n\n\t/*\n\t * Very *carefully* optimize the it-is-already-dirty case.\n\t *\n\t * Don't let the final \"is it dirty\" escape to before we\n\t * perhaps modified the buffer.\n\t */\n\tif (buffer_dirty(bh)) {\n\t\tsmp_mb();\n\t\tif (buffer_dirty(bh))\n\t\t\treturn;\n\t}\n\n\tif (!test_set_buffer_dirty(bh)) {\n\t\tstruct page *page = bh->b_page;\n\t\tif (!TestSetPageDirty(page)) {\n\t\t\tstruct address_space *mapping = page_mapping(page);\n\t\t\tif (mapping)\n\t\t\t\t__set_page_dirty(page, mapping, 0);\n\t\t}\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "kunmap_atomic",
          "args": [
            "kaddr"
          ],
          "line": 486
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "nilfs_segment_usage_set_clean",
          "args": [
            "su"
          ],
          "line": 485
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "nilfs_segment_usage_dirty",
          "args": [
            "su"
          ],
          "line": 484
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "WARN_ON",
          "args": [
            "!nilfs_segment_usage_dirty(su)"
          ],
          "line": 482
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "nilfs_segment_usage_dirty",
          "args": [
            "su"
          ],
          "line": 482
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "WARN_ON",
          "args": [
            "nilfs_segment_usage_error(su)"
          ],
          "line": 481
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "nilfs_segment_usage_error",
          "args": [
            "su"
          ],
          "line": 481
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kunmap_atomic",
          "args": [
            "kaddr"
          ],
          "line": 478
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "printk",
          "args": [
            "KERN_WARNING \"%s: segment %llu is already clean\\n\"",
            "__func__",
            "(unsigned long long)segnum"
          ],
          "line": 476
        },
        "resolved": true,
        "details": {
          "function_name": "compat_printk",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/compat.c",
          "lines": "59-69",
          "snippet": "int compat_printk(const char *fmt, ...)\n{\n\tva_list ap;\n\tint ret;\n\tif (!compat_log)\n\t\treturn 0;\n\tva_start(ap, fmt);\n\tret = vprintk(fmt, ap);\n\tva_end(ap);\n\treturn ret;\n}",
          "includes": [
            "#include \"internal.h\"",
            "#include <asm/ioctls.h>",
            "#include <asm/mmu_context.h>",
            "#include <asm/uaccess.h>",
            "#include <linux/aio.h>",
            "#include <linux/pagemap.h>",
            "#include <linux/slab.h>",
            "#include <linux/fs_struct.h>",
            "#include <linux/mm.h>",
            "#include <linux/poll.h>",
            "#include <linux/signal.h>",
            "#include <linux/highmem.h>",
            "#include <linux/security.h>",
            "#include <linux/tsacct_kern.h>",
            "#include <linux/rwsem.h>",
            "#include <linux/personality.h>",
            "#include <linux/highuid.h>",
            "#include <linux/fsnotify.h>",
            "#include <linux/dirent.h>",
            "#include <linux/ctype.h>",
            "#include <linux/syscalls.h>",
            "#include <linux/nfs4_mount.h>",
            "#include <linux/ncp_mount.h>",
            "#include <linux/init.h>",
            "#include <linux/ioctl.h>",
            "#include <linux/vfs.h>",
            "#include <linux/fdtable.h>",
            "#include <linux/file.h>",
            "#include <linux/namei.h>",
            "#include <linux/fcntl.h>",
            "#include <linux/fs.h>",
            "#include <linux/time.h>",
            "#include <linux/errno.h>",
            "#include <linux/compat.h>",
            "#include <linux/linkage.h>",
            "#include <linux/kernel.h>",
            "#include <linux/stddef.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "int compat_log = 1;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"internal.h\"\n#include <asm/ioctls.h>\n#include <asm/mmu_context.h>\n#include <asm/uaccess.h>\n#include <linux/aio.h>\n#include <linux/pagemap.h>\n#include <linux/slab.h>\n#include <linux/fs_struct.h>\n#include <linux/mm.h>\n#include <linux/poll.h>\n#include <linux/signal.h>\n#include <linux/highmem.h>\n#include <linux/security.h>\n#include <linux/tsacct_kern.h>\n#include <linux/rwsem.h>\n#include <linux/personality.h>\n#include <linux/highuid.h>\n#include <linux/fsnotify.h>\n#include <linux/dirent.h>\n#include <linux/ctype.h>\n#include <linux/syscalls.h>\n#include <linux/nfs4_mount.h>\n#include <linux/ncp_mount.h>\n#include <linux/init.h>\n#include <linux/ioctl.h>\n#include <linux/vfs.h>\n#include <linux/fdtable.h>\n#include <linux/file.h>\n#include <linux/namei.h>\n#include <linux/fcntl.h>\n#include <linux/fs.h>\n#include <linux/time.h>\n#include <linux/errno.h>\n#include <linux/compat.h>\n#include <linux/linkage.h>\n#include <linux/kernel.h>\n#include <linux/stddef.h>\n\nint compat_log = 1;\n\nint compat_printk(const char *fmt, ...)\n{\n\tva_list ap;\n\tint ret;\n\tif (!compat_log)\n\t\treturn 0;\n\tva_start(ap, fmt);\n\tret = vprintk(fmt, ap);\n\tva_end(ap);\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "nilfs_segment_usage_clean",
          "args": [
            "su"
          ],
          "line": 475
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "nilfs_sufile_block_get_segment_usage",
          "args": [
            "sufile",
            "segnum",
            "su_bh",
            "kaddr"
          ],
          "line": 474
        },
        "resolved": true,
        "details": {
          "function_name": "nilfs_sufile_block_get_segment_usage",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/sufile.c",
          "lines": "83-90",
          "snippet": "static struct nilfs_segment_usage *\nnilfs_sufile_block_get_segment_usage(const struct inode *sufile, __u64 segnum,\n\t\t\t\t     struct buffer_head *bh, void *kaddr)\n{\n\treturn kaddr + bh_offset(bh) +\n\t\tnilfs_sufile_get_offset(sufile, segnum) *\n\t\tNILFS_MDT(sufile)->mi_entry_size;\n}",
          "includes": [
            "#include \"sufile.h\"",
            "#include \"mdt.h\"",
            "#include <linux/nilfs2_fs.h>",
            "#include <linux/errno.h>",
            "#include <linux/buffer_head.h>",
            "#include <linux/string.h>",
            "#include <linux/fs.h>",
            "#include <linux/kernel.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sufile.h\"\n#include \"mdt.h\"\n#include <linux/nilfs2_fs.h>\n#include <linux/errno.h>\n#include <linux/buffer_head.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n#include <linux/kernel.h>\n\nstatic struct nilfs_segment_usage *\nnilfs_sufile_block_get_segment_usage(const struct inode *sufile, __u64 segnum,\n\t\t\t\t     struct buffer_head *bh, void *kaddr)\n{\n\treturn kaddr + bh_offset(bh) +\n\t\tnilfs_sufile_get_offset(sufile, segnum) *\n\t\tNILFS_MDT(sufile)->mi_entry_size;\n}"
        }
      },
      {
        "call_info": {
          "callee": "kmap_atomic",
          "args": [
            "su_bh->b_page"
          ],
          "line": 473
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"sufile.h\"\n#include \"mdt.h\"\n#include <linux/nilfs2_fs.h>\n#include <linux/errno.h>\n#include <linux/buffer_head.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n#include <linux/kernel.h>\n\nvoid nilfs_sufile_do_free(struct inode *sufile, __u64 segnum,\n\t\t\t  struct buffer_head *header_bh,\n\t\t\t  struct buffer_head *su_bh)\n{\n\tstruct nilfs_segment_usage *su;\n\tvoid *kaddr;\n\tint sudirty;\n\n\tkaddr = kmap_atomic(su_bh->b_page);\n\tsu = nilfs_sufile_block_get_segment_usage(sufile, segnum, su_bh, kaddr);\n\tif (nilfs_segment_usage_clean(su)) {\n\t\tprintk(KERN_WARNING \"%s: segment %llu is already clean\\n\",\n\t\t       __func__, (unsigned long long)segnum);\n\t\tkunmap_atomic(kaddr);\n\t\treturn;\n\t}\n\tWARN_ON(nilfs_segment_usage_error(su));\n\tWARN_ON(!nilfs_segment_usage_dirty(su));\n\n\tsudirty = nilfs_segment_usage_dirty(su);\n\tnilfs_segment_usage_set_clean(su);\n\tkunmap_atomic(kaddr);\n\tmark_buffer_dirty(su_bh);\n\n\tnilfs_sufile_mod_counter(header_bh, 1, sudirty ? (u64)-1 : 0);\n\tNILFS_SUI(sufile)->ncleansegs++;\n\n\tnilfs_mdt_mark_dirty(sufile);\n}"
  },
  {
    "function_name": "nilfs_sufile_do_scrap",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/sufile.c",
    "lines": "434-463",
    "snippet": "void nilfs_sufile_do_scrap(struct inode *sufile, __u64 segnum,\n\t\t\t   struct buffer_head *header_bh,\n\t\t\t   struct buffer_head *su_bh)\n{\n\tstruct nilfs_segment_usage *su;\n\tvoid *kaddr;\n\tint clean, dirty;\n\n\tkaddr = kmap_atomic(su_bh->b_page);\n\tsu = nilfs_sufile_block_get_segment_usage(sufile, segnum, su_bh, kaddr);\n\tif (su->su_flags == cpu_to_le32(1UL << NILFS_SEGMENT_USAGE_DIRTY) &&\n\t    su->su_nblocks == cpu_to_le32(0)) {\n\t\tkunmap_atomic(kaddr);\n\t\treturn;\n\t}\n\tclean = nilfs_segment_usage_clean(su);\n\tdirty = nilfs_segment_usage_dirty(su);\n\n\t/* make the segment garbage */\n\tsu->su_lastmod = cpu_to_le64(0);\n\tsu->su_nblocks = cpu_to_le32(0);\n\tsu->su_flags = cpu_to_le32(1UL << NILFS_SEGMENT_USAGE_DIRTY);\n\tkunmap_atomic(kaddr);\n\n\tnilfs_sufile_mod_counter(header_bh, clean ? (u64)-1 : 0, dirty ? 0 : 1);\n\tNILFS_SUI(sufile)->ncleansegs -= clean;\n\n\tmark_buffer_dirty(su_bh);\n\tnilfs_mdt_mark_dirty(sufile);\n}",
    "includes": [
      "#include \"sufile.h\"",
      "#include \"mdt.h\"",
      "#include <linux/nilfs2_fs.h>",
      "#include <linux/errno.h>",
      "#include <linux/buffer_head.h>",
      "#include <linux/string.h>",
      "#include <linux/fs.h>",
      "#include <linux/kernel.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "nilfs_mdt_mark_dirty",
          "args": [
            "sufile"
          ],
          "line": 462
        },
        "resolved": true,
        "details": {
          "function_name": "nilfs_mdt_mark_dirty",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/mdt.h",
          "lines": "98-102",
          "snippet": "static inline void nilfs_mdt_mark_dirty(struct inode *inode)\n{\n\tif (!test_bit(NILFS_I_DIRTY, &NILFS_I(inode)->i_state))\n\t\tset_bit(NILFS_I_DIRTY, &NILFS_I(inode)->i_state);\n}",
          "includes": [
            "#include \"page.h\"",
            "#include \"nilfs.h\"",
            "#include <linux/blockgroup_lock.h>",
            "#include <linux/buffer_head.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"page.h\"\n#include \"nilfs.h\"\n#include <linux/blockgroup_lock.h>\n#include <linux/buffer_head.h>\n\nstatic inline void nilfs_mdt_mark_dirty(struct inode *inode)\n{\n\tif (!test_bit(NILFS_I_DIRTY, &NILFS_I(inode)->i_state))\n\t\tset_bit(NILFS_I_DIRTY, &NILFS_I(inode)->i_state);\n}"
        }
      },
      {
        "call_info": {
          "callee": "mark_buffer_dirty",
          "args": [
            "su_bh"
          ],
          "line": 461
        },
        "resolved": true,
        "details": {
          "function_name": "mark_buffer_dirty",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/buffer.c",
          "lines": "1141-1167",
          "snippet": "void mark_buffer_dirty(struct buffer_head *bh)\n{\n\tWARN_ON_ONCE(!buffer_uptodate(bh));\n\n\ttrace_block_dirty_buffer(bh);\n\n\t/*\n\t * Very *carefully* optimize the it-is-already-dirty case.\n\t *\n\t * Don't let the final \"is it dirty\" escape to before we\n\t * perhaps modified the buffer.\n\t */\n\tif (buffer_dirty(bh)) {\n\t\tsmp_mb();\n\t\tif (buffer_dirty(bh))\n\t\t\treturn;\n\t}\n\n\tif (!test_set_buffer_dirty(bh)) {\n\t\tstruct page *page = bh->b_page;\n\t\tif (!TestSetPageDirty(page)) {\n\t\t\tstruct address_space *mapping = page_mapping(page);\n\t\t\tif (mapping)\n\t\t\t\t__set_page_dirty(page, mapping, 0);\n\t\t}\n\t}\n}",
          "includes": [
            "#include <trace/events/block.h>",
            "#include <linux/bit_spinlock.h>",
            "#include <linux/mpage.h>",
            "#include <linux/bitops.h>",
            "#include <linux/cpu.h>",
            "#include <linux/notifier.h>",
            "#include <linux/bio.h>",
            "#include <linux/task_io_accounting_ops.h>",
            "#include <linux/buffer_head.h>",
            "#include <linux/suspend.h>",
            "#include <linux/hash.h>",
            "#include <linux/writeback.h>",
            "#include <linux/export.h>",
            "#include <linux/highmem.h>",
            "#include <linux/quotaops.h>",
            "#include <linux/file.h>",
            "#include <linux/blkdev.h>",
            "#include <linux/capability.h>",
            "#include <linux/slab.h>",
            "#include <linux/percpu.h>",
            "#include <linux/mm.h>",
            "#include <linux/fs.h>",
            "#include <linux/syscalls.h>",
            "#include <linux/kernel.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <trace/events/block.h>\n#include <linux/bit_spinlock.h>\n#include <linux/mpage.h>\n#include <linux/bitops.h>\n#include <linux/cpu.h>\n#include <linux/notifier.h>\n#include <linux/bio.h>\n#include <linux/task_io_accounting_ops.h>\n#include <linux/buffer_head.h>\n#include <linux/suspend.h>\n#include <linux/hash.h>\n#include <linux/writeback.h>\n#include <linux/export.h>\n#include <linux/highmem.h>\n#include <linux/quotaops.h>\n#include <linux/file.h>\n#include <linux/blkdev.h>\n#include <linux/capability.h>\n#include <linux/slab.h>\n#include <linux/percpu.h>\n#include <linux/mm.h>\n#include <linux/fs.h>\n#include <linux/syscalls.h>\n#include <linux/kernel.h>\n\nvoid mark_buffer_dirty(struct buffer_head *bh)\n{\n\tWARN_ON_ONCE(!buffer_uptodate(bh));\n\n\ttrace_block_dirty_buffer(bh);\n\n\t/*\n\t * Very *carefully* optimize the it-is-already-dirty case.\n\t *\n\t * Don't let the final \"is it dirty\" escape to before we\n\t * perhaps modified the buffer.\n\t */\n\tif (buffer_dirty(bh)) {\n\t\tsmp_mb();\n\t\tif (buffer_dirty(bh))\n\t\t\treturn;\n\t}\n\n\tif (!test_set_buffer_dirty(bh)) {\n\t\tstruct page *page = bh->b_page;\n\t\tif (!TestSetPageDirty(page)) {\n\t\t\tstruct address_space *mapping = page_mapping(page);\n\t\t\tif (mapping)\n\t\t\t\t__set_page_dirty(page, mapping, 0);\n\t\t}\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "NILFS_SUI",
          "args": [
            "sufile"
          ],
          "line": 459
        },
        "resolved": true,
        "details": {
          "function_name": "NILFS_SUI",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/sufile.c",
          "lines": "47-50",
          "snippet": "static inline struct nilfs_sufile_info *NILFS_SUI(struct inode *sufile)\n{\n\treturn (struct nilfs_sufile_info *)NILFS_MDT(sufile);\n}",
          "includes": [
            "#include \"sufile.h\"",
            "#include \"mdt.h\"",
            "#include <linux/nilfs2_fs.h>",
            "#include <linux/errno.h>",
            "#include <linux/buffer_head.h>",
            "#include <linux/string.h>",
            "#include <linux/fs.h>",
            "#include <linux/kernel.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sufile.h\"\n#include \"mdt.h\"\n#include <linux/nilfs2_fs.h>\n#include <linux/errno.h>\n#include <linux/buffer_head.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n#include <linux/kernel.h>\n\nstatic inline struct nilfs_sufile_info *NILFS_SUI(struct inode *sufile)\n{\n\treturn (struct nilfs_sufile_info *)NILFS_MDT(sufile);\n}"
        }
      },
      {
        "call_info": {
          "callee": "nilfs_sufile_mod_counter",
          "args": [
            "header_bh",
            "clean ? (u64)-1 : 0",
            "dirty ? 0 : 1"
          ],
          "line": 458
        },
        "resolved": true,
        "details": {
          "function_name": "nilfs_sufile_mod_counter",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/sufile.c",
          "lines": "114-127",
          "snippet": "static void nilfs_sufile_mod_counter(struct buffer_head *header_bh,\n\t\t\t\t     u64 ncleanadd, u64 ndirtyadd)\n{\n\tstruct nilfs_sufile_header *header;\n\tvoid *kaddr;\n\n\tkaddr = kmap_atomic(header_bh->b_page);\n\theader = kaddr + bh_offset(header_bh);\n\tle64_add_cpu(&header->sh_ncleansegs, ncleanadd);\n\tle64_add_cpu(&header->sh_ndirtysegs, ndirtyadd);\n\tkunmap_atomic(kaddr);\n\n\tmark_buffer_dirty(header_bh);\n}",
          "includes": [
            "#include \"sufile.h\"",
            "#include \"mdt.h\"",
            "#include <linux/nilfs2_fs.h>",
            "#include <linux/errno.h>",
            "#include <linux/buffer_head.h>",
            "#include <linux/string.h>",
            "#include <linux/fs.h>",
            "#include <linux/kernel.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sufile.h\"\n#include \"mdt.h\"\n#include <linux/nilfs2_fs.h>\n#include <linux/errno.h>\n#include <linux/buffer_head.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n#include <linux/kernel.h>\n\nstatic void nilfs_sufile_mod_counter(struct buffer_head *header_bh,\n\t\t\t\t     u64 ncleanadd, u64 ndirtyadd)\n{\n\tstruct nilfs_sufile_header *header;\n\tvoid *kaddr;\n\n\tkaddr = kmap_atomic(header_bh->b_page);\n\theader = kaddr + bh_offset(header_bh);\n\tle64_add_cpu(&header->sh_ncleansegs, ncleanadd);\n\tle64_add_cpu(&header->sh_ndirtysegs, ndirtyadd);\n\tkunmap_atomic(kaddr);\n\n\tmark_buffer_dirty(header_bh);\n}"
        }
      },
      {
        "call_info": {
          "callee": "kunmap_atomic",
          "args": [
            "kaddr"
          ],
          "line": 456
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "cpu_to_le32",
          "args": [
            "1UL << NILFS_SEGMENT_USAGE_DIRTY"
          ],
          "line": 455
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "cpu_to_le32",
          "args": [
            "0"
          ],
          "line": 454
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "cpu_to_le64",
          "args": [
            "0"
          ],
          "line": 453
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "nilfs_segment_usage_dirty",
          "args": [
            "su"
          ],
          "line": 450
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "nilfs_segment_usage_clean",
          "args": [
            "su"
          ],
          "line": 449
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kunmap_atomic",
          "args": [
            "kaddr"
          ],
          "line": 446
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "cpu_to_le32",
          "args": [
            "0"
          ],
          "line": 445
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "cpu_to_le32",
          "args": [
            "1UL << NILFS_SEGMENT_USAGE_DIRTY"
          ],
          "line": 444
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "nilfs_sufile_block_get_segment_usage",
          "args": [
            "sufile",
            "segnum",
            "su_bh",
            "kaddr"
          ],
          "line": 443
        },
        "resolved": true,
        "details": {
          "function_name": "nilfs_sufile_block_get_segment_usage",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/sufile.c",
          "lines": "83-90",
          "snippet": "static struct nilfs_segment_usage *\nnilfs_sufile_block_get_segment_usage(const struct inode *sufile, __u64 segnum,\n\t\t\t\t     struct buffer_head *bh, void *kaddr)\n{\n\treturn kaddr + bh_offset(bh) +\n\t\tnilfs_sufile_get_offset(sufile, segnum) *\n\t\tNILFS_MDT(sufile)->mi_entry_size;\n}",
          "includes": [
            "#include \"sufile.h\"",
            "#include \"mdt.h\"",
            "#include <linux/nilfs2_fs.h>",
            "#include <linux/errno.h>",
            "#include <linux/buffer_head.h>",
            "#include <linux/string.h>",
            "#include <linux/fs.h>",
            "#include <linux/kernel.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sufile.h\"\n#include \"mdt.h\"\n#include <linux/nilfs2_fs.h>\n#include <linux/errno.h>\n#include <linux/buffer_head.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n#include <linux/kernel.h>\n\nstatic struct nilfs_segment_usage *\nnilfs_sufile_block_get_segment_usage(const struct inode *sufile, __u64 segnum,\n\t\t\t\t     struct buffer_head *bh, void *kaddr)\n{\n\treturn kaddr + bh_offset(bh) +\n\t\tnilfs_sufile_get_offset(sufile, segnum) *\n\t\tNILFS_MDT(sufile)->mi_entry_size;\n}"
        }
      },
      {
        "call_info": {
          "callee": "kmap_atomic",
          "args": [
            "su_bh->b_page"
          ],
          "line": 442
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"sufile.h\"\n#include \"mdt.h\"\n#include <linux/nilfs2_fs.h>\n#include <linux/errno.h>\n#include <linux/buffer_head.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n#include <linux/kernel.h>\n\nvoid nilfs_sufile_do_scrap(struct inode *sufile, __u64 segnum,\n\t\t\t   struct buffer_head *header_bh,\n\t\t\t   struct buffer_head *su_bh)\n{\n\tstruct nilfs_segment_usage *su;\n\tvoid *kaddr;\n\tint clean, dirty;\n\n\tkaddr = kmap_atomic(su_bh->b_page);\n\tsu = nilfs_sufile_block_get_segment_usage(sufile, segnum, su_bh, kaddr);\n\tif (su->su_flags == cpu_to_le32(1UL << NILFS_SEGMENT_USAGE_DIRTY) &&\n\t    su->su_nblocks == cpu_to_le32(0)) {\n\t\tkunmap_atomic(kaddr);\n\t\treturn;\n\t}\n\tclean = nilfs_segment_usage_clean(su);\n\tdirty = nilfs_segment_usage_dirty(su);\n\n\t/* make the segment garbage */\n\tsu->su_lastmod = cpu_to_le64(0);\n\tsu->su_nblocks = cpu_to_le32(0);\n\tsu->su_flags = cpu_to_le32(1UL << NILFS_SEGMENT_USAGE_DIRTY);\n\tkunmap_atomic(kaddr);\n\n\tnilfs_sufile_mod_counter(header_bh, clean ? (u64)-1 : 0, dirty ? 0 : 1);\n\tNILFS_SUI(sufile)->ncleansegs -= clean;\n\n\tmark_buffer_dirty(su_bh);\n\tnilfs_mdt_mark_dirty(sufile);\n}"
  },
  {
    "function_name": "nilfs_sufile_do_cancel_free",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/sufile.c",
    "lines": "409-432",
    "snippet": "void nilfs_sufile_do_cancel_free(struct inode *sufile, __u64 segnum,\n\t\t\t\t struct buffer_head *header_bh,\n\t\t\t\t struct buffer_head *su_bh)\n{\n\tstruct nilfs_segment_usage *su;\n\tvoid *kaddr;\n\n\tkaddr = kmap_atomic(su_bh->b_page);\n\tsu = nilfs_sufile_block_get_segment_usage(sufile, segnum, su_bh, kaddr);\n\tif (unlikely(!nilfs_segment_usage_clean(su))) {\n\t\tprintk(KERN_WARNING \"%s: segment %llu must be clean\\n\",\n\t\t       __func__, (unsigned long long)segnum);\n\t\tkunmap_atomic(kaddr);\n\t\treturn;\n\t}\n\tnilfs_segment_usage_set_dirty(su);\n\tkunmap_atomic(kaddr);\n\n\tnilfs_sufile_mod_counter(header_bh, -1, 1);\n\tNILFS_SUI(sufile)->ncleansegs--;\n\n\tmark_buffer_dirty(su_bh);\n\tnilfs_mdt_mark_dirty(sufile);\n}",
    "includes": [
      "#include \"sufile.h\"",
      "#include \"mdt.h\"",
      "#include <linux/nilfs2_fs.h>",
      "#include <linux/errno.h>",
      "#include <linux/buffer_head.h>",
      "#include <linux/string.h>",
      "#include <linux/fs.h>",
      "#include <linux/kernel.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "nilfs_mdt_mark_dirty",
          "args": [
            "sufile"
          ],
          "line": 431
        },
        "resolved": true,
        "details": {
          "function_name": "nilfs_mdt_mark_dirty",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/mdt.h",
          "lines": "98-102",
          "snippet": "static inline void nilfs_mdt_mark_dirty(struct inode *inode)\n{\n\tif (!test_bit(NILFS_I_DIRTY, &NILFS_I(inode)->i_state))\n\t\tset_bit(NILFS_I_DIRTY, &NILFS_I(inode)->i_state);\n}",
          "includes": [
            "#include \"page.h\"",
            "#include \"nilfs.h\"",
            "#include <linux/blockgroup_lock.h>",
            "#include <linux/buffer_head.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"page.h\"\n#include \"nilfs.h\"\n#include <linux/blockgroup_lock.h>\n#include <linux/buffer_head.h>\n\nstatic inline void nilfs_mdt_mark_dirty(struct inode *inode)\n{\n\tif (!test_bit(NILFS_I_DIRTY, &NILFS_I(inode)->i_state))\n\t\tset_bit(NILFS_I_DIRTY, &NILFS_I(inode)->i_state);\n}"
        }
      },
      {
        "call_info": {
          "callee": "mark_buffer_dirty",
          "args": [
            "su_bh"
          ],
          "line": 430
        },
        "resolved": true,
        "details": {
          "function_name": "mark_buffer_dirty",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/buffer.c",
          "lines": "1141-1167",
          "snippet": "void mark_buffer_dirty(struct buffer_head *bh)\n{\n\tWARN_ON_ONCE(!buffer_uptodate(bh));\n\n\ttrace_block_dirty_buffer(bh);\n\n\t/*\n\t * Very *carefully* optimize the it-is-already-dirty case.\n\t *\n\t * Don't let the final \"is it dirty\" escape to before we\n\t * perhaps modified the buffer.\n\t */\n\tif (buffer_dirty(bh)) {\n\t\tsmp_mb();\n\t\tif (buffer_dirty(bh))\n\t\t\treturn;\n\t}\n\n\tif (!test_set_buffer_dirty(bh)) {\n\t\tstruct page *page = bh->b_page;\n\t\tif (!TestSetPageDirty(page)) {\n\t\t\tstruct address_space *mapping = page_mapping(page);\n\t\t\tif (mapping)\n\t\t\t\t__set_page_dirty(page, mapping, 0);\n\t\t}\n\t}\n}",
          "includes": [
            "#include <trace/events/block.h>",
            "#include <linux/bit_spinlock.h>",
            "#include <linux/mpage.h>",
            "#include <linux/bitops.h>",
            "#include <linux/cpu.h>",
            "#include <linux/notifier.h>",
            "#include <linux/bio.h>",
            "#include <linux/task_io_accounting_ops.h>",
            "#include <linux/buffer_head.h>",
            "#include <linux/suspend.h>",
            "#include <linux/hash.h>",
            "#include <linux/writeback.h>",
            "#include <linux/export.h>",
            "#include <linux/highmem.h>",
            "#include <linux/quotaops.h>",
            "#include <linux/file.h>",
            "#include <linux/blkdev.h>",
            "#include <linux/capability.h>",
            "#include <linux/slab.h>",
            "#include <linux/percpu.h>",
            "#include <linux/mm.h>",
            "#include <linux/fs.h>",
            "#include <linux/syscalls.h>",
            "#include <linux/kernel.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <trace/events/block.h>\n#include <linux/bit_spinlock.h>\n#include <linux/mpage.h>\n#include <linux/bitops.h>\n#include <linux/cpu.h>\n#include <linux/notifier.h>\n#include <linux/bio.h>\n#include <linux/task_io_accounting_ops.h>\n#include <linux/buffer_head.h>\n#include <linux/suspend.h>\n#include <linux/hash.h>\n#include <linux/writeback.h>\n#include <linux/export.h>\n#include <linux/highmem.h>\n#include <linux/quotaops.h>\n#include <linux/file.h>\n#include <linux/blkdev.h>\n#include <linux/capability.h>\n#include <linux/slab.h>\n#include <linux/percpu.h>\n#include <linux/mm.h>\n#include <linux/fs.h>\n#include <linux/syscalls.h>\n#include <linux/kernel.h>\n\nvoid mark_buffer_dirty(struct buffer_head *bh)\n{\n\tWARN_ON_ONCE(!buffer_uptodate(bh));\n\n\ttrace_block_dirty_buffer(bh);\n\n\t/*\n\t * Very *carefully* optimize the it-is-already-dirty case.\n\t *\n\t * Don't let the final \"is it dirty\" escape to before we\n\t * perhaps modified the buffer.\n\t */\n\tif (buffer_dirty(bh)) {\n\t\tsmp_mb();\n\t\tif (buffer_dirty(bh))\n\t\t\treturn;\n\t}\n\n\tif (!test_set_buffer_dirty(bh)) {\n\t\tstruct page *page = bh->b_page;\n\t\tif (!TestSetPageDirty(page)) {\n\t\t\tstruct address_space *mapping = page_mapping(page);\n\t\t\tif (mapping)\n\t\t\t\t__set_page_dirty(page, mapping, 0);\n\t\t}\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "NILFS_SUI",
          "args": [
            "sufile"
          ],
          "line": 428
        },
        "resolved": true,
        "details": {
          "function_name": "NILFS_SUI",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/sufile.c",
          "lines": "47-50",
          "snippet": "static inline struct nilfs_sufile_info *NILFS_SUI(struct inode *sufile)\n{\n\treturn (struct nilfs_sufile_info *)NILFS_MDT(sufile);\n}",
          "includes": [
            "#include \"sufile.h\"",
            "#include \"mdt.h\"",
            "#include <linux/nilfs2_fs.h>",
            "#include <linux/errno.h>",
            "#include <linux/buffer_head.h>",
            "#include <linux/string.h>",
            "#include <linux/fs.h>",
            "#include <linux/kernel.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sufile.h\"\n#include \"mdt.h\"\n#include <linux/nilfs2_fs.h>\n#include <linux/errno.h>\n#include <linux/buffer_head.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n#include <linux/kernel.h>\n\nstatic inline struct nilfs_sufile_info *NILFS_SUI(struct inode *sufile)\n{\n\treturn (struct nilfs_sufile_info *)NILFS_MDT(sufile);\n}"
        }
      },
      {
        "call_info": {
          "callee": "nilfs_sufile_mod_counter",
          "args": [
            "header_bh",
            "-1",
            "1"
          ],
          "line": 427
        },
        "resolved": true,
        "details": {
          "function_name": "nilfs_sufile_mod_counter",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/sufile.c",
          "lines": "114-127",
          "snippet": "static void nilfs_sufile_mod_counter(struct buffer_head *header_bh,\n\t\t\t\t     u64 ncleanadd, u64 ndirtyadd)\n{\n\tstruct nilfs_sufile_header *header;\n\tvoid *kaddr;\n\n\tkaddr = kmap_atomic(header_bh->b_page);\n\theader = kaddr + bh_offset(header_bh);\n\tle64_add_cpu(&header->sh_ncleansegs, ncleanadd);\n\tle64_add_cpu(&header->sh_ndirtysegs, ndirtyadd);\n\tkunmap_atomic(kaddr);\n\n\tmark_buffer_dirty(header_bh);\n}",
          "includes": [
            "#include \"sufile.h\"",
            "#include \"mdt.h\"",
            "#include <linux/nilfs2_fs.h>",
            "#include <linux/errno.h>",
            "#include <linux/buffer_head.h>",
            "#include <linux/string.h>",
            "#include <linux/fs.h>",
            "#include <linux/kernel.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sufile.h\"\n#include \"mdt.h\"\n#include <linux/nilfs2_fs.h>\n#include <linux/errno.h>\n#include <linux/buffer_head.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n#include <linux/kernel.h>\n\nstatic void nilfs_sufile_mod_counter(struct buffer_head *header_bh,\n\t\t\t\t     u64 ncleanadd, u64 ndirtyadd)\n{\n\tstruct nilfs_sufile_header *header;\n\tvoid *kaddr;\n\n\tkaddr = kmap_atomic(header_bh->b_page);\n\theader = kaddr + bh_offset(header_bh);\n\tle64_add_cpu(&header->sh_ncleansegs, ncleanadd);\n\tle64_add_cpu(&header->sh_ndirtysegs, ndirtyadd);\n\tkunmap_atomic(kaddr);\n\n\tmark_buffer_dirty(header_bh);\n}"
        }
      },
      {
        "call_info": {
          "callee": "kunmap_atomic",
          "args": [
            "kaddr"
          ],
          "line": 425
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "nilfs_segment_usage_set_dirty",
          "args": [
            "su"
          ],
          "line": 424
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kunmap_atomic",
          "args": [
            "kaddr"
          ],
          "line": 421
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "printk",
          "args": [
            "KERN_WARNING \"%s: segment %llu must be clean\\n\"",
            "__func__",
            "(unsigned long long)segnum"
          ],
          "line": 419
        },
        "resolved": true,
        "details": {
          "function_name": "compat_printk",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/compat.c",
          "lines": "59-69",
          "snippet": "int compat_printk(const char *fmt, ...)\n{\n\tva_list ap;\n\tint ret;\n\tif (!compat_log)\n\t\treturn 0;\n\tva_start(ap, fmt);\n\tret = vprintk(fmt, ap);\n\tva_end(ap);\n\treturn ret;\n}",
          "includes": [
            "#include \"internal.h\"",
            "#include <asm/ioctls.h>",
            "#include <asm/mmu_context.h>",
            "#include <asm/uaccess.h>",
            "#include <linux/aio.h>",
            "#include <linux/pagemap.h>",
            "#include <linux/slab.h>",
            "#include <linux/fs_struct.h>",
            "#include <linux/mm.h>",
            "#include <linux/poll.h>",
            "#include <linux/signal.h>",
            "#include <linux/highmem.h>",
            "#include <linux/security.h>",
            "#include <linux/tsacct_kern.h>",
            "#include <linux/rwsem.h>",
            "#include <linux/personality.h>",
            "#include <linux/highuid.h>",
            "#include <linux/fsnotify.h>",
            "#include <linux/dirent.h>",
            "#include <linux/ctype.h>",
            "#include <linux/syscalls.h>",
            "#include <linux/nfs4_mount.h>",
            "#include <linux/ncp_mount.h>",
            "#include <linux/init.h>",
            "#include <linux/ioctl.h>",
            "#include <linux/vfs.h>",
            "#include <linux/fdtable.h>",
            "#include <linux/file.h>",
            "#include <linux/namei.h>",
            "#include <linux/fcntl.h>",
            "#include <linux/fs.h>",
            "#include <linux/time.h>",
            "#include <linux/errno.h>",
            "#include <linux/compat.h>",
            "#include <linux/linkage.h>",
            "#include <linux/kernel.h>",
            "#include <linux/stddef.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "int compat_log = 1;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"internal.h\"\n#include <asm/ioctls.h>\n#include <asm/mmu_context.h>\n#include <asm/uaccess.h>\n#include <linux/aio.h>\n#include <linux/pagemap.h>\n#include <linux/slab.h>\n#include <linux/fs_struct.h>\n#include <linux/mm.h>\n#include <linux/poll.h>\n#include <linux/signal.h>\n#include <linux/highmem.h>\n#include <linux/security.h>\n#include <linux/tsacct_kern.h>\n#include <linux/rwsem.h>\n#include <linux/personality.h>\n#include <linux/highuid.h>\n#include <linux/fsnotify.h>\n#include <linux/dirent.h>\n#include <linux/ctype.h>\n#include <linux/syscalls.h>\n#include <linux/nfs4_mount.h>\n#include <linux/ncp_mount.h>\n#include <linux/init.h>\n#include <linux/ioctl.h>\n#include <linux/vfs.h>\n#include <linux/fdtable.h>\n#include <linux/file.h>\n#include <linux/namei.h>\n#include <linux/fcntl.h>\n#include <linux/fs.h>\n#include <linux/time.h>\n#include <linux/errno.h>\n#include <linux/compat.h>\n#include <linux/linkage.h>\n#include <linux/kernel.h>\n#include <linux/stddef.h>\n\nint compat_log = 1;\n\nint compat_printk(const char *fmt, ...)\n{\n\tva_list ap;\n\tint ret;\n\tif (!compat_log)\n\t\treturn 0;\n\tva_start(ap, fmt);\n\tret = vprintk(fmt, ap);\n\tva_end(ap);\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "unlikely",
          "args": [
            "!nilfs_segment_usage_clean(su)"
          ],
          "line": 418
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "nilfs_segment_usage_clean",
          "args": [
            "su"
          ],
          "line": 418
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "nilfs_sufile_block_get_segment_usage",
          "args": [
            "sufile",
            "segnum",
            "su_bh",
            "kaddr"
          ],
          "line": 417
        },
        "resolved": true,
        "details": {
          "function_name": "nilfs_sufile_block_get_segment_usage",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/sufile.c",
          "lines": "83-90",
          "snippet": "static struct nilfs_segment_usage *\nnilfs_sufile_block_get_segment_usage(const struct inode *sufile, __u64 segnum,\n\t\t\t\t     struct buffer_head *bh, void *kaddr)\n{\n\treturn kaddr + bh_offset(bh) +\n\t\tnilfs_sufile_get_offset(sufile, segnum) *\n\t\tNILFS_MDT(sufile)->mi_entry_size;\n}",
          "includes": [
            "#include \"sufile.h\"",
            "#include \"mdt.h\"",
            "#include <linux/nilfs2_fs.h>",
            "#include <linux/errno.h>",
            "#include <linux/buffer_head.h>",
            "#include <linux/string.h>",
            "#include <linux/fs.h>",
            "#include <linux/kernel.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sufile.h\"\n#include \"mdt.h\"\n#include <linux/nilfs2_fs.h>\n#include <linux/errno.h>\n#include <linux/buffer_head.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n#include <linux/kernel.h>\n\nstatic struct nilfs_segment_usage *\nnilfs_sufile_block_get_segment_usage(const struct inode *sufile, __u64 segnum,\n\t\t\t\t     struct buffer_head *bh, void *kaddr)\n{\n\treturn kaddr + bh_offset(bh) +\n\t\tnilfs_sufile_get_offset(sufile, segnum) *\n\t\tNILFS_MDT(sufile)->mi_entry_size;\n}"
        }
      },
      {
        "call_info": {
          "callee": "kmap_atomic",
          "args": [
            "su_bh->b_page"
          ],
          "line": 416
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"sufile.h\"\n#include \"mdt.h\"\n#include <linux/nilfs2_fs.h>\n#include <linux/errno.h>\n#include <linux/buffer_head.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n#include <linux/kernel.h>\n\nvoid nilfs_sufile_do_cancel_free(struct inode *sufile, __u64 segnum,\n\t\t\t\t struct buffer_head *header_bh,\n\t\t\t\t struct buffer_head *su_bh)\n{\n\tstruct nilfs_segment_usage *su;\n\tvoid *kaddr;\n\n\tkaddr = kmap_atomic(su_bh->b_page);\n\tsu = nilfs_sufile_block_get_segment_usage(sufile, segnum, su_bh, kaddr);\n\tif (unlikely(!nilfs_segment_usage_clean(su))) {\n\t\tprintk(KERN_WARNING \"%s: segment %llu must be clean\\n\",\n\t\t       __func__, (unsigned long long)segnum);\n\t\tkunmap_atomic(kaddr);\n\t\treturn;\n\t}\n\tnilfs_segment_usage_set_dirty(su);\n\tkunmap_atomic(kaddr);\n\n\tnilfs_sufile_mod_counter(header_bh, -1, 1);\n\tNILFS_SUI(sufile)->ncleansegs--;\n\n\tmark_buffer_dirty(su_bh);\n\tnilfs_mdt_mark_dirty(sufile);\n}"
  },
  {
    "function_name": "nilfs_sufile_alloc",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/sufile.c",
    "lines": "311-407",
    "snippet": "int nilfs_sufile_alloc(struct inode *sufile, __u64 *segnump)\n{\n\tstruct buffer_head *header_bh, *su_bh;\n\tstruct nilfs_sufile_header *header;\n\tstruct nilfs_segment_usage *su;\n\tstruct nilfs_sufile_info *sui = NILFS_SUI(sufile);\n\tsize_t susz = NILFS_MDT(sufile)->mi_entry_size;\n\t__u64 segnum, maxsegnum, last_alloc;\n\tvoid *kaddr;\n\tunsigned long nsegments, ncleansegs, nsus, cnt;\n\tint ret, j;\n\n\tdown_write(&NILFS_MDT(sufile)->mi_sem);\n\n\tret = nilfs_sufile_get_header_block(sufile, &header_bh);\n\tif (ret < 0)\n\t\tgoto out_sem;\n\tkaddr = kmap_atomic(header_bh->b_page);\n\theader = kaddr + bh_offset(header_bh);\n\tncleansegs = le64_to_cpu(header->sh_ncleansegs);\n\tlast_alloc = le64_to_cpu(header->sh_last_alloc);\n\tkunmap_atomic(kaddr);\n\n\tnsegments = nilfs_sufile_get_nsegments(sufile);\n\tmaxsegnum = sui->allocmax;\n\tsegnum = last_alloc + 1;\n\tif (segnum < sui->allocmin || segnum > sui->allocmax)\n\t\tsegnum = sui->allocmin;\n\n\tfor (cnt = 0; cnt < nsegments; cnt += nsus) {\n\t\tif (segnum > maxsegnum) {\n\t\t\tif (cnt < sui->allocmax - sui->allocmin + 1) {\n\t\t\t\t/*\n\t\t\t\t * wrap around in the limited region.\n\t\t\t\t * if allocation started from\n\t\t\t\t * sui->allocmin, this never happens.\n\t\t\t\t */\n\t\t\t\tsegnum = sui->allocmin;\n\t\t\t\tmaxsegnum = last_alloc;\n\t\t\t} else if (segnum > sui->allocmin &&\n\t\t\t\t   sui->allocmax + 1 < nsegments) {\n\t\t\t\tsegnum = sui->allocmax + 1;\n\t\t\t\tmaxsegnum = nsegments - 1;\n\t\t\t} else if (sui->allocmin > 0)  {\n\t\t\t\tsegnum = 0;\n\t\t\t\tmaxsegnum = sui->allocmin - 1;\n\t\t\t} else {\n\t\t\t\tbreak; /* never happens */\n\t\t\t}\n\t\t}\n\t\tret = nilfs_sufile_get_segment_usage_block(sufile, segnum, 1,\n\t\t\t\t\t\t\t   &su_bh);\n\t\tif (ret < 0)\n\t\t\tgoto out_header;\n\t\tkaddr = kmap_atomic(su_bh->b_page);\n\t\tsu = nilfs_sufile_block_get_segment_usage(\n\t\t\tsufile, segnum, su_bh, kaddr);\n\n\t\tnsus = nilfs_sufile_segment_usages_in_block(\n\t\t\tsufile, segnum, maxsegnum);\n\t\tfor (j = 0; j < nsus; j++, su = (void *)su + susz, segnum++) {\n\t\t\tif (!nilfs_segment_usage_clean(su))\n\t\t\t\tcontinue;\n\t\t\t/* found a clean segment */\n\t\t\tnilfs_segment_usage_set_dirty(su);\n\t\t\tkunmap_atomic(kaddr);\n\n\t\t\tkaddr = kmap_atomic(header_bh->b_page);\n\t\t\theader = kaddr + bh_offset(header_bh);\n\t\t\tle64_add_cpu(&header->sh_ncleansegs, -1);\n\t\t\tle64_add_cpu(&header->sh_ndirtysegs, 1);\n\t\t\theader->sh_last_alloc = cpu_to_le64(segnum);\n\t\t\tkunmap_atomic(kaddr);\n\n\t\t\tsui->ncleansegs--;\n\t\t\tmark_buffer_dirty(header_bh);\n\t\t\tmark_buffer_dirty(su_bh);\n\t\t\tnilfs_mdt_mark_dirty(sufile);\n\t\t\tbrelse(su_bh);\n\t\t\t*segnump = segnum;\n\t\t\tgoto out_header;\n\t\t}\n\n\t\tkunmap_atomic(kaddr);\n\t\tbrelse(su_bh);\n\t}\n\n\t/* no segments left */\n\tret = -ENOSPC;\n\n out_header:\n\tbrelse(header_bh);\n\n out_sem:\n\tup_write(&NILFS_MDT(sufile)->mi_sem);\n\treturn ret;\n}",
    "includes": [
      "#include \"sufile.h\"",
      "#include \"mdt.h\"",
      "#include <linux/nilfs2_fs.h>",
      "#include <linux/errno.h>",
      "#include <linux/buffer_head.h>",
      "#include <linux/string.h>",
      "#include <linux/fs.h>",
      "#include <linux/kernel.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "up_write",
          "args": [
            "&NILFS_MDT(sufile)->mi_sem"
          ],
          "line": 405
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "NILFS_MDT",
          "args": [
            "sufile"
          ],
          "line": 405
        },
        "resolved": true,
        "details": {
          "function_name": "NILFS_MDT",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/mdt.h",
          "lines": "69-72",
          "snippet": "static inline struct nilfs_mdt_info *NILFS_MDT(const struct inode *inode)\n{\n\treturn inode->i_private;\n}",
          "includes": [
            "#include \"page.h\"",
            "#include \"nilfs.h\"",
            "#include <linux/blockgroup_lock.h>",
            "#include <linux/buffer_head.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"page.h\"\n#include \"nilfs.h\"\n#include <linux/blockgroup_lock.h>\n#include <linux/buffer_head.h>\n\nstatic inline struct nilfs_mdt_info *NILFS_MDT(const struct inode *inode)\n{\n\treturn inode->i_private;\n}"
        }
      },
      {
        "call_info": {
          "callee": "brelse",
          "args": [
            "header_bh"
          ],
          "line": 402
        },
        "resolved": true,
        "details": {
          "function_name": "__brelse",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/buffer.c",
          "lines": "1177-1184",
          "snippet": "void __brelse(struct buffer_head * buf)\n{\n\tif (atomic_read(&buf->b_count)) {\n\t\tput_bh(buf);\n\t\treturn;\n\t}\n\tWARN(1, KERN_ERR \"VFS: brelse: Trying to free free buffer\\n\");\n}",
          "includes": [
            "#include <trace/events/block.h>",
            "#include <linux/bit_spinlock.h>",
            "#include <linux/mpage.h>",
            "#include <linux/bitops.h>",
            "#include <linux/cpu.h>",
            "#include <linux/notifier.h>",
            "#include <linux/bio.h>",
            "#include <linux/task_io_accounting_ops.h>",
            "#include <linux/buffer_head.h>",
            "#include <linux/suspend.h>",
            "#include <linux/hash.h>",
            "#include <linux/writeback.h>",
            "#include <linux/export.h>",
            "#include <linux/highmem.h>",
            "#include <linux/quotaops.h>",
            "#include <linux/file.h>",
            "#include <linux/blkdev.h>",
            "#include <linux/capability.h>",
            "#include <linux/slab.h>",
            "#include <linux/percpu.h>",
            "#include <linux/mm.h>",
            "#include <linux/fs.h>",
            "#include <linux/syscalls.h>",
            "#include <linux/kernel.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <trace/events/block.h>\n#include <linux/bit_spinlock.h>\n#include <linux/mpage.h>\n#include <linux/bitops.h>\n#include <linux/cpu.h>\n#include <linux/notifier.h>\n#include <linux/bio.h>\n#include <linux/task_io_accounting_ops.h>\n#include <linux/buffer_head.h>\n#include <linux/suspend.h>\n#include <linux/hash.h>\n#include <linux/writeback.h>\n#include <linux/export.h>\n#include <linux/highmem.h>\n#include <linux/quotaops.h>\n#include <linux/file.h>\n#include <linux/blkdev.h>\n#include <linux/capability.h>\n#include <linux/slab.h>\n#include <linux/percpu.h>\n#include <linux/mm.h>\n#include <linux/fs.h>\n#include <linux/syscalls.h>\n#include <linux/kernel.h>\n\nvoid __brelse(struct buffer_head * buf)\n{\n\tif (atomic_read(&buf->b_count)) {\n\t\tput_bh(buf);\n\t\treturn;\n\t}\n\tWARN(1, KERN_ERR \"VFS: brelse: Trying to free free buffer\\n\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "kunmap_atomic",
          "args": [
            "kaddr"
          ],
          "line": 394
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "nilfs_mdt_mark_dirty",
          "args": [
            "sufile"
          ],
          "line": 388
        },
        "resolved": true,
        "details": {
          "function_name": "nilfs_mdt_mark_dirty",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/mdt.h",
          "lines": "98-102",
          "snippet": "static inline void nilfs_mdt_mark_dirty(struct inode *inode)\n{\n\tif (!test_bit(NILFS_I_DIRTY, &NILFS_I(inode)->i_state))\n\t\tset_bit(NILFS_I_DIRTY, &NILFS_I(inode)->i_state);\n}",
          "includes": [
            "#include \"page.h\"",
            "#include \"nilfs.h\"",
            "#include <linux/blockgroup_lock.h>",
            "#include <linux/buffer_head.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"page.h\"\n#include \"nilfs.h\"\n#include <linux/blockgroup_lock.h>\n#include <linux/buffer_head.h>\n\nstatic inline void nilfs_mdt_mark_dirty(struct inode *inode)\n{\n\tif (!test_bit(NILFS_I_DIRTY, &NILFS_I(inode)->i_state))\n\t\tset_bit(NILFS_I_DIRTY, &NILFS_I(inode)->i_state);\n}"
        }
      },
      {
        "call_info": {
          "callee": "mark_buffer_dirty",
          "args": [
            "su_bh"
          ],
          "line": 387
        },
        "resolved": true,
        "details": {
          "function_name": "mark_buffer_dirty",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/buffer.c",
          "lines": "1141-1167",
          "snippet": "void mark_buffer_dirty(struct buffer_head *bh)\n{\n\tWARN_ON_ONCE(!buffer_uptodate(bh));\n\n\ttrace_block_dirty_buffer(bh);\n\n\t/*\n\t * Very *carefully* optimize the it-is-already-dirty case.\n\t *\n\t * Don't let the final \"is it dirty\" escape to before we\n\t * perhaps modified the buffer.\n\t */\n\tif (buffer_dirty(bh)) {\n\t\tsmp_mb();\n\t\tif (buffer_dirty(bh))\n\t\t\treturn;\n\t}\n\n\tif (!test_set_buffer_dirty(bh)) {\n\t\tstruct page *page = bh->b_page;\n\t\tif (!TestSetPageDirty(page)) {\n\t\t\tstruct address_space *mapping = page_mapping(page);\n\t\t\tif (mapping)\n\t\t\t\t__set_page_dirty(page, mapping, 0);\n\t\t}\n\t}\n}",
          "includes": [
            "#include <trace/events/block.h>",
            "#include <linux/bit_spinlock.h>",
            "#include <linux/mpage.h>",
            "#include <linux/bitops.h>",
            "#include <linux/cpu.h>",
            "#include <linux/notifier.h>",
            "#include <linux/bio.h>",
            "#include <linux/task_io_accounting_ops.h>",
            "#include <linux/buffer_head.h>",
            "#include <linux/suspend.h>",
            "#include <linux/hash.h>",
            "#include <linux/writeback.h>",
            "#include <linux/export.h>",
            "#include <linux/highmem.h>",
            "#include <linux/quotaops.h>",
            "#include <linux/file.h>",
            "#include <linux/blkdev.h>",
            "#include <linux/capability.h>",
            "#include <linux/slab.h>",
            "#include <linux/percpu.h>",
            "#include <linux/mm.h>",
            "#include <linux/fs.h>",
            "#include <linux/syscalls.h>",
            "#include <linux/kernel.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <trace/events/block.h>\n#include <linux/bit_spinlock.h>\n#include <linux/mpage.h>\n#include <linux/bitops.h>\n#include <linux/cpu.h>\n#include <linux/notifier.h>\n#include <linux/bio.h>\n#include <linux/task_io_accounting_ops.h>\n#include <linux/buffer_head.h>\n#include <linux/suspend.h>\n#include <linux/hash.h>\n#include <linux/writeback.h>\n#include <linux/export.h>\n#include <linux/highmem.h>\n#include <linux/quotaops.h>\n#include <linux/file.h>\n#include <linux/blkdev.h>\n#include <linux/capability.h>\n#include <linux/slab.h>\n#include <linux/percpu.h>\n#include <linux/mm.h>\n#include <linux/fs.h>\n#include <linux/syscalls.h>\n#include <linux/kernel.h>\n\nvoid mark_buffer_dirty(struct buffer_head *bh)\n{\n\tWARN_ON_ONCE(!buffer_uptodate(bh));\n\n\ttrace_block_dirty_buffer(bh);\n\n\t/*\n\t * Very *carefully* optimize the it-is-already-dirty case.\n\t *\n\t * Don't let the final \"is it dirty\" escape to before we\n\t * perhaps modified the buffer.\n\t */\n\tif (buffer_dirty(bh)) {\n\t\tsmp_mb();\n\t\tif (buffer_dirty(bh))\n\t\t\treturn;\n\t}\n\n\tif (!test_set_buffer_dirty(bh)) {\n\t\tstruct page *page = bh->b_page;\n\t\tif (!TestSetPageDirty(page)) {\n\t\t\tstruct address_space *mapping = page_mapping(page);\n\t\t\tif (mapping)\n\t\t\t\t__set_page_dirty(page, mapping, 0);\n\t\t}\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "kunmap_atomic",
          "args": [
            "kaddr"
          ],
          "line": 383
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "cpu_to_le64",
          "args": [
            "segnum"
          ],
          "line": 382
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "le64_add_cpu",
          "args": [
            "&header->sh_ndirtysegs",
            "1"
          ],
          "line": 381
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "le64_add_cpu",
          "args": [
            "&header->sh_ncleansegs",
            "-1"
          ],
          "line": 380
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bh_offset",
          "args": [
            "header_bh"
          ],
          "line": 379
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kmap_atomic",
          "args": [
            "header_bh->b_page"
          ],
          "line": 378
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kunmap_atomic",
          "args": [
            "kaddr"
          ],
          "line": 376
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "nilfs_segment_usage_set_dirty",
          "args": [
            "su"
          ],
          "line": 375
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "nilfs_segment_usage_clean",
          "args": [
            "su"
          ],
          "line": 372
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "nilfs_sufile_segment_usages_in_block",
          "args": [
            "sufile",
            "segnum",
            "maxsegnum"
          ],
          "line": 369
        },
        "resolved": true,
        "details": {
          "function_name": "nilfs_sufile_segment_usages_in_block",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/sufile.c",
          "lines": "73-81",
          "snippet": "static unsigned long\nnilfs_sufile_segment_usages_in_block(const struct inode *sufile, __u64 curr,\n\t\t\t\t     __u64 max)\n{\n\treturn min_t(unsigned long,\n\t\t     nilfs_sufile_segment_usages_per_block(sufile) -\n\t\t     nilfs_sufile_get_offset(sufile, curr),\n\t\t     max - curr + 1);\n}",
          "includes": [
            "#include \"sufile.h\"",
            "#include \"mdt.h\"",
            "#include <linux/nilfs2_fs.h>",
            "#include <linux/errno.h>",
            "#include <linux/buffer_head.h>",
            "#include <linux/string.h>",
            "#include <linux/fs.h>",
            "#include <linux/kernel.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sufile.h\"\n#include \"mdt.h\"\n#include <linux/nilfs2_fs.h>\n#include <linux/errno.h>\n#include <linux/buffer_head.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n#include <linux/kernel.h>\n\nstatic unsigned long\nnilfs_sufile_segment_usages_in_block(const struct inode *sufile, __u64 curr,\n\t\t\t\t     __u64 max)\n{\n\treturn min_t(unsigned long,\n\t\t     nilfs_sufile_segment_usages_per_block(sufile) -\n\t\t     nilfs_sufile_get_offset(sufile, curr),\n\t\t     max - curr + 1);\n}"
        }
      },
      {
        "call_info": {
          "callee": "nilfs_sufile_block_get_segment_usage",
          "args": [
            "sufile",
            "segnum",
            "su_bh",
            "kaddr"
          ],
          "line": 366
        },
        "resolved": true,
        "details": {
          "function_name": "nilfs_sufile_block_get_segment_usage",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/sufile.c",
          "lines": "83-90",
          "snippet": "static struct nilfs_segment_usage *\nnilfs_sufile_block_get_segment_usage(const struct inode *sufile, __u64 segnum,\n\t\t\t\t     struct buffer_head *bh, void *kaddr)\n{\n\treturn kaddr + bh_offset(bh) +\n\t\tnilfs_sufile_get_offset(sufile, segnum) *\n\t\tNILFS_MDT(sufile)->mi_entry_size;\n}",
          "includes": [
            "#include \"sufile.h\"",
            "#include \"mdt.h\"",
            "#include <linux/nilfs2_fs.h>",
            "#include <linux/errno.h>",
            "#include <linux/buffer_head.h>",
            "#include <linux/string.h>",
            "#include <linux/fs.h>",
            "#include <linux/kernel.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sufile.h\"\n#include \"mdt.h\"\n#include <linux/nilfs2_fs.h>\n#include <linux/errno.h>\n#include <linux/buffer_head.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n#include <linux/kernel.h>\n\nstatic struct nilfs_segment_usage *\nnilfs_sufile_block_get_segment_usage(const struct inode *sufile, __u64 segnum,\n\t\t\t\t     struct buffer_head *bh, void *kaddr)\n{\n\treturn kaddr + bh_offset(bh) +\n\t\tnilfs_sufile_get_offset(sufile, segnum) *\n\t\tNILFS_MDT(sufile)->mi_entry_size;\n}"
        }
      },
      {
        "call_info": {
          "callee": "kmap_atomic",
          "args": [
            "su_bh->b_page"
          ],
          "line": 365
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "nilfs_sufile_get_segment_usage_block",
          "args": [
            "sufile",
            "segnum",
            "1",
            "&su_bh"
          ],
          "line": 361
        },
        "resolved": true,
        "details": {
          "function_name": "nilfs_sufile_get_segment_usage_block",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/sufile.c",
          "lines": "98-105",
          "snippet": "static inline int\nnilfs_sufile_get_segment_usage_block(struct inode *sufile, __u64 segnum,\n\t\t\t\t     int create, struct buffer_head **bhp)\n{\n\treturn nilfs_mdt_get_block(sufile,\n\t\t\t\t   nilfs_sufile_get_blkoff(sufile, segnum),\n\t\t\t\t   create, NULL, bhp);\n}",
          "includes": [
            "#include \"sufile.h\"",
            "#include \"mdt.h\"",
            "#include <linux/nilfs2_fs.h>",
            "#include <linux/errno.h>",
            "#include <linux/buffer_head.h>",
            "#include <linux/string.h>",
            "#include <linux/fs.h>",
            "#include <linux/kernel.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sufile.h\"\n#include \"mdt.h\"\n#include <linux/nilfs2_fs.h>\n#include <linux/errno.h>\n#include <linux/buffer_head.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n#include <linux/kernel.h>\n\nstatic inline int\nnilfs_sufile_get_segment_usage_block(struct inode *sufile, __u64 segnum,\n\t\t\t\t     int create, struct buffer_head **bhp)\n{\n\treturn nilfs_mdt_get_block(sufile,\n\t\t\t\t   nilfs_sufile_get_blkoff(sufile, segnum),\n\t\t\t\t   create, NULL, bhp);\n}"
        }
      },
      {
        "call_info": {
          "callee": "nilfs_sufile_get_nsegments",
          "args": [
            "sufile"
          ],
          "line": 334
        },
        "resolved": true,
        "details": {
          "function_name": "nilfs_sufile_get_nsegments",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/sufile.h",
          "lines": "32-35",
          "snippet": "static inline unsigned long nilfs_sufile_get_nsegments(struct inode *sufile)\n{\n\treturn ((struct the_nilfs *)sufile->i_sb->s_fs_info)->ns_nsegments;\n}",
          "includes": [
            "#include \"mdt.h\"",
            "#include <linux/nilfs2_fs.h>",
            "#include <linux/buffer_head.h>",
            "#include <linux/fs.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"mdt.h\"\n#include <linux/nilfs2_fs.h>\n#include <linux/buffer_head.h>\n#include <linux/fs.h>\n\nstatic inline unsigned long nilfs_sufile_get_nsegments(struct inode *sufile)\n{\n\treturn ((struct the_nilfs *)sufile->i_sb->s_fs_info)->ns_nsegments;\n}"
        }
      },
      {
        "call_info": {
          "callee": "kunmap_atomic",
          "args": [
            "kaddr"
          ],
          "line": 332
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "le64_to_cpu",
          "args": [
            "header->sh_last_alloc"
          ],
          "line": 331
        },
        "resolved": true,
        "details": {
          "function_name": "sle64_to_cpup",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/ntfs/endian.h",
          "lines": "58-61",
          "snippet": "static inline s64 sle64_to_cpup(sle64 *x)\n{\n\treturn le64_to_cpu(*(__force le64*)x);\n}",
          "includes": [
            "#include \"types.h\"",
            "#include <asm/byteorder.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"types.h\"\n#include <asm/byteorder.h>\n\nstatic inline s64 sle64_to_cpup(sle64 *x)\n{\n\treturn le64_to_cpu(*(__force le64*)x);\n}"
        }
      },
      {
        "call_info": {
          "callee": "bh_offset",
          "args": [
            "header_bh"
          ],
          "line": 329
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kmap_atomic",
          "args": [
            "header_bh->b_page"
          ],
          "line": 328
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "nilfs_sufile_get_header_block",
          "args": [
            "sufile",
            "&header_bh"
          ],
          "line": 325
        },
        "resolved": true,
        "details": {
          "function_name": "nilfs_sufile_get_header_block",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/sufile.c",
          "lines": "92-96",
          "snippet": "static inline int nilfs_sufile_get_header_block(struct inode *sufile,\n\t\t\t\t\t\tstruct buffer_head **bhp)\n{\n\treturn nilfs_mdt_get_block(sufile, 0, 0, NULL, bhp);\n}",
          "includes": [
            "#include \"sufile.h\"",
            "#include \"mdt.h\"",
            "#include <linux/nilfs2_fs.h>",
            "#include <linux/errno.h>",
            "#include <linux/buffer_head.h>",
            "#include <linux/string.h>",
            "#include <linux/fs.h>",
            "#include <linux/kernel.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sufile.h\"\n#include \"mdt.h\"\n#include <linux/nilfs2_fs.h>\n#include <linux/errno.h>\n#include <linux/buffer_head.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n#include <linux/kernel.h>\n\nstatic inline int nilfs_sufile_get_header_block(struct inode *sufile,\n\t\t\t\t\t\tstruct buffer_head **bhp)\n{\n\treturn nilfs_mdt_get_block(sufile, 0, 0, NULL, bhp);\n}"
        }
      },
      {
        "call_info": {
          "callee": "down_write",
          "args": [
            "&NILFS_MDT(sufile)->mi_sem"
          ],
          "line": 323
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "NILFS_SUI",
          "args": [
            "sufile"
          ],
          "line": 316
        },
        "resolved": true,
        "details": {
          "function_name": "NILFS_SUI",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/sufile.c",
          "lines": "47-50",
          "snippet": "static inline struct nilfs_sufile_info *NILFS_SUI(struct inode *sufile)\n{\n\treturn (struct nilfs_sufile_info *)NILFS_MDT(sufile);\n}",
          "includes": [
            "#include \"sufile.h\"",
            "#include \"mdt.h\"",
            "#include <linux/nilfs2_fs.h>",
            "#include <linux/errno.h>",
            "#include <linux/buffer_head.h>",
            "#include <linux/string.h>",
            "#include <linux/fs.h>",
            "#include <linux/kernel.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sufile.h\"\n#include \"mdt.h\"\n#include <linux/nilfs2_fs.h>\n#include <linux/errno.h>\n#include <linux/buffer_head.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n#include <linux/kernel.h>\n\nstatic inline struct nilfs_sufile_info *NILFS_SUI(struct inode *sufile)\n{\n\treturn (struct nilfs_sufile_info *)NILFS_MDT(sufile);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"sufile.h\"\n#include \"mdt.h\"\n#include <linux/nilfs2_fs.h>\n#include <linux/errno.h>\n#include <linux/buffer_head.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n#include <linux/kernel.h>\n\nint nilfs_sufile_alloc(struct inode *sufile, __u64 *segnump)\n{\n\tstruct buffer_head *header_bh, *su_bh;\n\tstruct nilfs_sufile_header *header;\n\tstruct nilfs_segment_usage *su;\n\tstruct nilfs_sufile_info *sui = NILFS_SUI(sufile);\n\tsize_t susz = NILFS_MDT(sufile)->mi_entry_size;\n\t__u64 segnum, maxsegnum, last_alloc;\n\tvoid *kaddr;\n\tunsigned long nsegments, ncleansegs, nsus, cnt;\n\tint ret, j;\n\n\tdown_write(&NILFS_MDT(sufile)->mi_sem);\n\n\tret = nilfs_sufile_get_header_block(sufile, &header_bh);\n\tif (ret < 0)\n\t\tgoto out_sem;\n\tkaddr = kmap_atomic(header_bh->b_page);\n\theader = kaddr + bh_offset(header_bh);\n\tncleansegs = le64_to_cpu(header->sh_ncleansegs);\n\tlast_alloc = le64_to_cpu(header->sh_last_alloc);\n\tkunmap_atomic(kaddr);\n\n\tnsegments = nilfs_sufile_get_nsegments(sufile);\n\tmaxsegnum = sui->allocmax;\n\tsegnum = last_alloc + 1;\n\tif (segnum < sui->allocmin || segnum > sui->allocmax)\n\t\tsegnum = sui->allocmin;\n\n\tfor (cnt = 0; cnt < nsegments; cnt += nsus) {\n\t\tif (segnum > maxsegnum) {\n\t\t\tif (cnt < sui->allocmax - sui->allocmin + 1) {\n\t\t\t\t/*\n\t\t\t\t * wrap around in the limited region.\n\t\t\t\t * if allocation started from\n\t\t\t\t * sui->allocmin, this never happens.\n\t\t\t\t */\n\t\t\t\tsegnum = sui->allocmin;\n\t\t\t\tmaxsegnum = last_alloc;\n\t\t\t} else if (segnum > sui->allocmin &&\n\t\t\t\t   sui->allocmax + 1 < nsegments) {\n\t\t\t\tsegnum = sui->allocmax + 1;\n\t\t\t\tmaxsegnum = nsegments - 1;\n\t\t\t} else if (sui->allocmin > 0)  {\n\t\t\t\tsegnum = 0;\n\t\t\t\tmaxsegnum = sui->allocmin - 1;\n\t\t\t} else {\n\t\t\t\tbreak; /* never happens */\n\t\t\t}\n\t\t}\n\t\tret = nilfs_sufile_get_segment_usage_block(sufile, segnum, 1,\n\t\t\t\t\t\t\t   &su_bh);\n\t\tif (ret < 0)\n\t\t\tgoto out_header;\n\t\tkaddr = kmap_atomic(su_bh->b_page);\n\t\tsu = nilfs_sufile_block_get_segment_usage(\n\t\t\tsufile, segnum, su_bh, kaddr);\n\n\t\tnsus = nilfs_sufile_segment_usages_in_block(\n\t\t\tsufile, segnum, maxsegnum);\n\t\tfor (j = 0; j < nsus; j++, su = (void *)su + susz, segnum++) {\n\t\t\tif (!nilfs_segment_usage_clean(su))\n\t\t\t\tcontinue;\n\t\t\t/* found a clean segment */\n\t\t\tnilfs_segment_usage_set_dirty(su);\n\t\t\tkunmap_atomic(kaddr);\n\n\t\t\tkaddr = kmap_atomic(header_bh->b_page);\n\t\t\theader = kaddr + bh_offset(header_bh);\n\t\t\tle64_add_cpu(&header->sh_ncleansegs, -1);\n\t\t\tle64_add_cpu(&header->sh_ndirtysegs, 1);\n\t\t\theader->sh_last_alloc = cpu_to_le64(segnum);\n\t\t\tkunmap_atomic(kaddr);\n\n\t\t\tsui->ncleansegs--;\n\t\t\tmark_buffer_dirty(header_bh);\n\t\t\tmark_buffer_dirty(su_bh);\n\t\t\tnilfs_mdt_mark_dirty(sufile);\n\t\t\tbrelse(su_bh);\n\t\t\t*segnump = segnum;\n\t\t\tgoto out_header;\n\t\t}\n\n\t\tkunmap_atomic(kaddr);\n\t\tbrelse(su_bh);\n\t}\n\n\t/* no segments left */\n\tret = -ENOSPC;\n\n out_header:\n\tbrelse(header_bh);\n\n out_sem:\n\tup_write(&NILFS_MDT(sufile)->mi_sem);\n\treturn ret;\n}"
  },
  {
    "function_name": "nilfs_sufile_set_alloc_range",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/sufile.c",
    "lines": "276-292",
    "snippet": "int nilfs_sufile_set_alloc_range(struct inode *sufile, __u64 start, __u64 end)\n{\n\tstruct nilfs_sufile_info *sui = NILFS_SUI(sufile);\n\t__u64 nsegs;\n\tint ret = -ERANGE;\n\n\tdown_write(&NILFS_MDT(sufile)->mi_sem);\n\tnsegs = nilfs_sufile_get_nsegments(sufile);\n\n\tif (start <= end && end < nsegs) {\n\t\tsui->allocmin = start;\n\t\tsui->allocmax = end;\n\t\tret = 0;\n\t}\n\tup_write(&NILFS_MDT(sufile)->mi_sem);\n\treturn ret;\n}",
    "includes": [
      "#include \"sufile.h\"",
      "#include \"mdt.h\"",
      "#include <linux/nilfs2_fs.h>",
      "#include <linux/errno.h>",
      "#include <linux/buffer_head.h>",
      "#include <linux/string.h>",
      "#include <linux/fs.h>",
      "#include <linux/kernel.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "up_write",
          "args": [
            "&NILFS_MDT(sufile)->mi_sem"
          ],
          "line": 290
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "NILFS_MDT",
          "args": [
            "sufile"
          ],
          "line": 290
        },
        "resolved": true,
        "details": {
          "function_name": "NILFS_MDT",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/mdt.h",
          "lines": "69-72",
          "snippet": "static inline struct nilfs_mdt_info *NILFS_MDT(const struct inode *inode)\n{\n\treturn inode->i_private;\n}",
          "includes": [
            "#include \"page.h\"",
            "#include \"nilfs.h\"",
            "#include <linux/blockgroup_lock.h>",
            "#include <linux/buffer_head.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"page.h\"\n#include \"nilfs.h\"\n#include <linux/blockgroup_lock.h>\n#include <linux/buffer_head.h>\n\nstatic inline struct nilfs_mdt_info *NILFS_MDT(const struct inode *inode)\n{\n\treturn inode->i_private;\n}"
        }
      },
      {
        "call_info": {
          "callee": "nilfs_sufile_get_nsegments",
          "args": [
            "sufile"
          ],
          "line": 283
        },
        "resolved": true,
        "details": {
          "function_name": "nilfs_sufile_get_nsegments",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/sufile.h",
          "lines": "32-35",
          "snippet": "static inline unsigned long nilfs_sufile_get_nsegments(struct inode *sufile)\n{\n\treturn ((struct the_nilfs *)sufile->i_sb->s_fs_info)->ns_nsegments;\n}",
          "includes": [
            "#include \"mdt.h\"",
            "#include <linux/nilfs2_fs.h>",
            "#include <linux/buffer_head.h>",
            "#include <linux/fs.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"mdt.h\"\n#include <linux/nilfs2_fs.h>\n#include <linux/buffer_head.h>\n#include <linux/fs.h>\n\nstatic inline unsigned long nilfs_sufile_get_nsegments(struct inode *sufile)\n{\n\treturn ((struct the_nilfs *)sufile->i_sb->s_fs_info)->ns_nsegments;\n}"
        }
      },
      {
        "call_info": {
          "callee": "down_write",
          "args": [
            "&NILFS_MDT(sufile)->mi_sem"
          ],
          "line": 282
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "NILFS_SUI",
          "args": [
            "sufile"
          ],
          "line": 278
        },
        "resolved": true,
        "details": {
          "function_name": "NILFS_SUI",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/sufile.c",
          "lines": "47-50",
          "snippet": "static inline struct nilfs_sufile_info *NILFS_SUI(struct inode *sufile)\n{\n\treturn (struct nilfs_sufile_info *)NILFS_MDT(sufile);\n}",
          "includes": [
            "#include \"sufile.h\"",
            "#include \"mdt.h\"",
            "#include <linux/nilfs2_fs.h>",
            "#include <linux/errno.h>",
            "#include <linux/buffer_head.h>",
            "#include <linux/string.h>",
            "#include <linux/fs.h>",
            "#include <linux/kernel.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sufile.h\"\n#include \"mdt.h\"\n#include <linux/nilfs2_fs.h>\n#include <linux/errno.h>\n#include <linux/buffer_head.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n#include <linux/kernel.h>\n\nstatic inline struct nilfs_sufile_info *NILFS_SUI(struct inode *sufile)\n{\n\treturn (struct nilfs_sufile_info *)NILFS_MDT(sufile);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"sufile.h\"\n#include \"mdt.h\"\n#include <linux/nilfs2_fs.h>\n#include <linux/errno.h>\n#include <linux/buffer_head.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n#include <linux/kernel.h>\n\nint nilfs_sufile_set_alloc_range(struct inode *sufile, __u64 start, __u64 end)\n{\n\tstruct nilfs_sufile_info *sui = NILFS_SUI(sufile);\n\t__u64 nsegs;\n\tint ret = -ERANGE;\n\n\tdown_write(&NILFS_MDT(sufile)->mi_sem);\n\tnsegs = nilfs_sufile_get_nsegments(sufile);\n\n\tif (start <= end && end < nsegs) {\n\t\tsui->allocmin = start;\n\t\tsui->allocmax = end;\n\t\tret = 0;\n\t}\n\tup_write(&NILFS_MDT(sufile)->mi_sem);\n\treturn ret;\n}"
  },
  {
    "function_name": "nilfs_sufile_update",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/sufile.c",
    "lines": "234-263",
    "snippet": "int nilfs_sufile_update(struct inode *sufile, __u64 segnum, int create,\n\t\t\tvoid (*dofunc)(struct inode *, __u64,\n\t\t\t\t       struct buffer_head *,\n\t\t\t\t       struct buffer_head *))\n{\n\tstruct buffer_head *header_bh, *bh;\n\tint ret;\n\n\tif (unlikely(segnum >= nilfs_sufile_get_nsegments(sufile))) {\n\t\tprintk(KERN_WARNING \"%s: invalid segment number: %llu\\n\",\n\t\t       __func__, (unsigned long long)segnum);\n\t\treturn -EINVAL;\n\t}\n\tdown_write(&NILFS_MDT(sufile)->mi_sem);\n\n\tret = nilfs_sufile_get_header_block(sufile, &header_bh);\n\tif (ret < 0)\n\t\tgoto out_sem;\n\n\tret = nilfs_sufile_get_segment_usage_block(sufile, segnum, create, &bh);\n\tif (!ret) {\n\t\tdofunc(sufile, segnum, header_bh, bh);\n\t\tbrelse(bh);\n\t}\n\tbrelse(header_bh);\n\n out_sem:\n\tup_write(&NILFS_MDT(sufile)->mi_sem);\n\treturn ret;\n}",
    "includes": [
      "#include \"sufile.h\"",
      "#include \"mdt.h\"",
      "#include <linux/nilfs2_fs.h>",
      "#include <linux/errno.h>",
      "#include <linux/buffer_head.h>",
      "#include <linux/string.h>",
      "#include <linux/fs.h>",
      "#include <linux/kernel.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "up_write",
          "args": [
            "&NILFS_MDT(sufile)->mi_sem"
          ],
          "line": 261
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "NILFS_MDT",
          "args": [
            "sufile"
          ],
          "line": 261
        },
        "resolved": true,
        "details": {
          "function_name": "NILFS_MDT",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/mdt.h",
          "lines": "69-72",
          "snippet": "static inline struct nilfs_mdt_info *NILFS_MDT(const struct inode *inode)\n{\n\treturn inode->i_private;\n}",
          "includes": [
            "#include \"page.h\"",
            "#include \"nilfs.h\"",
            "#include <linux/blockgroup_lock.h>",
            "#include <linux/buffer_head.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"page.h\"\n#include \"nilfs.h\"\n#include <linux/blockgroup_lock.h>\n#include <linux/buffer_head.h>\n\nstatic inline struct nilfs_mdt_info *NILFS_MDT(const struct inode *inode)\n{\n\treturn inode->i_private;\n}"
        }
      },
      {
        "call_info": {
          "callee": "brelse",
          "args": [
            "header_bh"
          ],
          "line": 258
        },
        "resolved": true,
        "details": {
          "function_name": "__brelse",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/buffer.c",
          "lines": "1177-1184",
          "snippet": "void __brelse(struct buffer_head * buf)\n{\n\tif (atomic_read(&buf->b_count)) {\n\t\tput_bh(buf);\n\t\treturn;\n\t}\n\tWARN(1, KERN_ERR \"VFS: brelse: Trying to free free buffer\\n\");\n}",
          "includes": [
            "#include <trace/events/block.h>",
            "#include <linux/bit_spinlock.h>",
            "#include <linux/mpage.h>",
            "#include <linux/bitops.h>",
            "#include <linux/cpu.h>",
            "#include <linux/notifier.h>",
            "#include <linux/bio.h>",
            "#include <linux/task_io_accounting_ops.h>",
            "#include <linux/buffer_head.h>",
            "#include <linux/suspend.h>",
            "#include <linux/hash.h>",
            "#include <linux/writeback.h>",
            "#include <linux/export.h>",
            "#include <linux/highmem.h>",
            "#include <linux/quotaops.h>",
            "#include <linux/file.h>",
            "#include <linux/blkdev.h>",
            "#include <linux/capability.h>",
            "#include <linux/slab.h>",
            "#include <linux/percpu.h>",
            "#include <linux/mm.h>",
            "#include <linux/fs.h>",
            "#include <linux/syscalls.h>",
            "#include <linux/kernel.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <trace/events/block.h>\n#include <linux/bit_spinlock.h>\n#include <linux/mpage.h>\n#include <linux/bitops.h>\n#include <linux/cpu.h>\n#include <linux/notifier.h>\n#include <linux/bio.h>\n#include <linux/task_io_accounting_ops.h>\n#include <linux/buffer_head.h>\n#include <linux/suspend.h>\n#include <linux/hash.h>\n#include <linux/writeback.h>\n#include <linux/export.h>\n#include <linux/highmem.h>\n#include <linux/quotaops.h>\n#include <linux/file.h>\n#include <linux/blkdev.h>\n#include <linux/capability.h>\n#include <linux/slab.h>\n#include <linux/percpu.h>\n#include <linux/mm.h>\n#include <linux/fs.h>\n#include <linux/syscalls.h>\n#include <linux/kernel.h>\n\nvoid __brelse(struct buffer_head * buf)\n{\n\tif (atomic_read(&buf->b_count)) {\n\t\tput_bh(buf);\n\t\treturn;\n\t}\n\tWARN(1, KERN_ERR \"VFS: brelse: Trying to free free buffer\\n\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "dofunc",
          "args": [
            "sufile",
            "segnum",
            "header_bh",
            "bh"
          ],
          "line": 255
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "nilfs_sufile_get_segment_usage_block",
          "args": [
            "sufile",
            "segnum",
            "create",
            "&bh"
          ],
          "line": 253
        },
        "resolved": true,
        "details": {
          "function_name": "nilfs_sufile_get_segment_usage_block",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/sufile.c",
          "lines": "98-105",
          "snippet": "static inline int\nnilfs_sufile_get_segment_usage_block(struct inode *sufile, __u64 segnum,\n\t\t\t\t     int create, struct buffer_head **bhp)\n{\n\treturn nilfs_mdt_get_block(sufile,\n\t\t\t\t   nilfs_sufile_get_blkoff(sufile, segnum),\n\t\t\t\t   create, NULL, bhp);\n}",
          "includes": [
            "#include \"sufile.h\"",
            "#include \"mdt.h\"",
            "#include <linux/nilfs2_fs.h>",
            "#include <linux/errno.h>",
            "#include <linux/buffer_head.h>",
            "#include <linux/string.h>",
            "#include <linux/fs.h>",
            "#include <linux/kernel.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sufile.h\"\n#include \"mdt.h\"\n#include <linux/nilfs2_fs.h>\n#include <linux/errno.h>\n#include <linux/buffer_head.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n#include <linux/kernel.h>\n\nstatic inline int\nnilfs_sufile_get_segment_usage_block(struct inode *sufile, __u64 segnum,\n\t\t\t\t     int create, struct buffer_head **bhp)\n{\n\treturn nilfs_mdt_get_block(sufile,\n\t\t\t\t   nilfs_sufile_get_blkoff(sufile, segnum),\n\t\t\t\t   create, NULL, bhp);\n}"
        }
      },
      {
        "call_info": {
          "callee": "nilfs_sufile_get_header_block",
          "args": [
            "sufile",
            "&header_bh"
          ],
          "line": 249
        },
        "resolved": true,
        "details": {
          "function_name": "nilfs_sufile_get_header_block",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/sufile.c",
          "lines": "92-96",
          "snippet": "static inline int nilfs_sufile_get_header_block(struct inode *sufile,\n\t\t\t\t\t\tstruct buffer_head **bhp)\n{\n\treturn nilfs_mdt_get_block(sufile, 0, 0, NULL, bhp);\n}",
          "includes": [
            "#include \"sufile.h\"",
            "#include \"mdt.h\"",
            "#include <linux/nilfs2_fs.h>",
            "#include <linux/errno.h>",
            "#include <linux/buffer_head.h>",
            "#include <linux/string.h>",
            "#include <linux/fs.h>",
            "#include <linux/kernel.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sufile.h\"\n#include \"mdt.h\"\n#include <linux/nilfs2_fs.h>\n#include <linux/errno.h>\n#include <linux/buffer_head.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n#include <linux/kernel.h>\n\nstatic inline int nilfs_sufile_get_header_block(struct inode *sufile,\n\t\t\t\t\t\tstruct buffer_head **bhp)\n{\n\treturn nilfs_mdt_get_block(sufile, 0, 0, NULL, bhp);\n}"
        }
      },
      {
        "call_info": {
          "callee": "down_write",
          "args": [
            "&NILFS_MDT(sufile)->mi_sem"
          ],
          "line": 247
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "printk",
          "args": [
            "KERN_WARNING \"%s: invalid segment number: %llu\\n\"",
            "__func__",
            "(unsigned long long)segnum"
          ],
          "line": 243
        },
        "resolved": true,
        "details": {
          "function_name": "compat_printk",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/compat.c",
          "lines": "59-69",
          "snippet": "int compat_printk(const char *fmt, ...)\n{\n\tva_list ap;\n\tint ret;\n\tif (!compat_log)\n\t\treturn 0;\n\tva_start(ap, fmt);\n\tret = vprintk(fmt, ap);\n\tva_end(ap);\n\treturn ret;\n}",
          "includes": [
            "#include \"internal.h\"",
            "#include <asm/ioctls.h>",
            "#include <asm/mmu_context.h>",
            "#include <asm/uaccess.h>",
            "#include <linux/aio.h>",
            "#include <linux/pagemap.h>",
            "#include <linux/slab.h>",
            "#include <linux/fs_struct.h>",
            "#include <linux/mm.h>",
            "#include <linux/poll.h>",
            "#include <linux/signal.h>",
            "#include <linux/highmem.h>",
            "#include <linux/security.h>",
            "#include <linux/tsacct_kern.h>",
            "#include <linux/rwsem.h>",
            "#include <linux/personality.h>",
            "#include <linux/highuid.h>",
            "#include <linux/fsnotify.h>",
            "#include <linux/dirent.h>",
            "#include <linux/ctype.h>",
            "#include <linux/syscalls.h>",
            "#include <linux/nfs4_mount.h>",
            "#include <linux/ncp_mount.h>",
            "#include <linux/init.h>",
            "#include <linux/ioctl.h>",
            "#include <linux/vfs.h>",
            "#include <linux/fdtable.h>",
            "#include <linux/file.h>",
            "#include <linux/namei.h>",
            "#include <linux/fcntl.h>",
            "#include <linux/fs.h>",
            "#include <linux/time.h>",
            "#include <linux/errno.h>",
            "#include <linux/compat.h>",
            "#include <linux/linkage.h>",
            "#include <linux/kernel.h>",
            "#include <linux/stddef.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "int compat_log = 1;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"internal.h\"\n#include <asm/ioctls.h>\n#include <asm/mmu_context.h>\n#include <asm/uaccess.h>\n#include <linux/aio.h>\n#include <linux/pagemap.h>\n#include <linux/slab.h>\n#include <linux/fs_struct.h>\n#include <linux/mm.h>\n#include <linux/poll.h>\n#include <linux/signal.h>\n#include <linux/highmem.h>\n#include <linux/security.h>\n#include <linux/tsacct_kern.h>\n#include <linux/rwsem.h>\n#include <linux/personality.h>\n#include <linux/highuid.h>\n#include <linux/fsnotify.h>\n#include <linux/dirent.h>\n#include <linux/ctype.h>\n#include <linux/syscalls.h>\n#include <linux/nfs4_mount.h>\n#include <linux/ncp_mount.h>\n#include <linux/init.h>\n#include <linux/ioctl.h>\n#include <linux/vfs.h>\n#include <linux/fdtable.h>\n#include <linux/file.h>\n#include <linux/namei.h>\n#include <linux/fcntl.h>\n#include <linux/fs.h>\n#include <linux/time.h>\n#include <linux/errno.h>\n#include <linux/compat.h>\n#include <linux/linkage.h>\n#include <linux/kernel.h>\n#include <linux/stddef.h>\n\nint compat_log = 1;\n\nint compat_printk(const char *fmt, ...)\n{\n\tva_list ap;\n\tint ret;\n\tif (!compat_log)\n\t\treturn 0;\n\tva_start(ap, fmt);\n\tret = vprintk(fmt, ap);\n\tva_end(ap);\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "unlikely",
          "args": [
            "segnum >= nilfs_sufile_get_nsegments(sufile)"
          ],
          "line": 242
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "nilfs_sufile_get_nsegments",
          "args": [
            "sufile"
          ],
          "line": 242
        },
        "resolved": true,
        "details": {
          "function_name": "nilfs_sufile_get_nsegments",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/sufile.h",
          "lines": "32-35",
          "snippet": "static inline unsigned long nilfs_sufile_get_nsegments(struct inode *sufile)\n{\n\treturn ((struct the_nilfs *)sufile->i_sb->s_fs_info)->ns_nsegments;\n}",
          "includes": [
            "#include \"mdt.h\"",
            "#include <linux/nilfs2_fs.h>",
            "#include <linux/buffer_head.h>",
            "#include <linux/fs.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"mdt.h\"\n#include <linux/nilfs2_fs.h>\n#include <linux/buffer_head.h>\n#include <linux/fs.h>\n\nstatic inline unsigned long nilfs_sufile_get_nsegments(struct inode *sufile)\n{\n\treturn ((struct the_nilfs *)sufile->i_sb->s_fs_info)->ns_nsegments;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"sufile.h\"\n#include \"mdt.h\"\n#include <linux/nilfs2_fs.h>\n#include <linux/errno.h>\n#include <linux/buffer_head.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n#include <linux/kernel.h>\n\nint nilfs_sufile_update(struct inode *sufile, __u64 segnum, int create,\n\t\t\tvoid (*dofunc)(struct inode *, __u64,\n\t\t\t\t       struct buffer_head *,\n\t\t\t\t       struct buffer_head *))\n{\n\tstruct buffer_head *header_bh, *bh;\n\tint ret;\n\n\tif (unlikely(segnum >= nilfs_sufile_get_nsegments(sufile))) {\n\t\tprintk(KERN_WARNING \"%s: invalid segment number: %llu\\n\",\n\t\t       __func__, (unsigned long long)segnum);\n\t\treturn -EINVAL;\n\t}\n\tdown_write(&NILFS_MDT(sufile)->mi_sem);\n\n\tret = nilfs_sufile_get_header_block(sufile, &header_bh);\n\tif (ret < 0)\n\t\tgoto out_sem;\n\n\tret = nilfs_sufile_get_segment_usage_block(sufile, segnum, create, &bh);\n\tif (!ret) {\n\t\tdofunc(sufile, segnum, header_bh, bh);\n\t\tbrelse(bh);\n\t}\n\tbrelse(header_bh);\n\n out_sem:\n\tup_write(&NILFS_MDT(sufile)->mi_sem);\n\treturn ret;\n}"
  },
  {
    "function_name": "nilfs_sufile_updatev",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/sufile.c",
    "lines": "166-232",
    "snippet": "int nilfs_sufile_updatev(struct inode *sufile, __u64 *segnumv, size_t nsegs,\n\t\t\t int create, size_t *ndone,\n\t\t\t void (*dofunc)(struct inode *, __u64,\n\t\t\t\t\tstruct buffer_head *,\n\t\t\t\t\tstruct buffer_head *))\n{\n\tstruct buffer_head *header_bh, *bh;\n\tunsigned long blkoff, prev_blkoff;\n\t__u64 *seg;\n\tsize_t nerr = 0, n = 0;\n\tint ret = 0;\n\n\tif (unlikely(nsegs == 0))\n\t\tgoto out;\n\n\tdown_write(&NILFS_MDT(sufile)->mi_sem);\n\tfor (seg = segnumv; seg < segnumv + nsegs; seg++) {\n\t\tif (unlikely(*seg >= nilfs_sufile_get_nsegments(sufile))) {\n\t\t\tprintk(KERN_WARNING\n\t\t\t       \"%s: invalid segment number: %llu\\n\", __func__,\n\t\t\t       (unsigned long long)*seg);\n\t\t\tnerr++;\n\t\t}\n\t}\n\tif (nerr > 0) {\n\t\tret = -EINVAL;\n\t\tgoto out_sem;\n\t}\n\n\tret = nilfs_sufile_get_header_block(sufile, &header_bh);\n\tif (ret < 0)\n\t\tgoto out_sem;\n\n\tseg = segnumv;\n\tblkoff = nilfs_sufile_get_blkoff(sufile, *seg);\n\tret = nilfs_mdt_get_block(sufile, blkoff, create, NULL, &bh);\n\tif (ret < 0)\n\t\tgoto out_header;\n\n\tfor (;;) {\n\t\tdofunc(sufile, *seg, header_bh, bh);\n\n\t\tif (++seg >= segnumv + nsegs)\n\t\t\tbreak;\n\t\tprev_blkoff = blkoff;\n\t\tblkoff = nilfs_sufile_get_blkoff(sufile, *seg);\n\t\tif (blkoff == prev_blkoff)\n\t\t\tcontinue;\n\n\t\t/* get different block */\n\t\tbrelse(bh);\n\t\tret = nilfs_mdt_get_block(sufile, blkoff, create, NULL, &bh);\n\t\tif (unlikely(ret < 0))\n\t\t\tgoto out_header;\n\t}\n\tbrelse(bh);\n\n out_header:\n\tn = seg - segnumv;\n\tbrelse(header_bh);\n out_sem:\n\tup_write(&NILFS_MDT(sufile)->mi_sem);\n out:\n\tif (ndone)\n\t\t*ndone = n;\n\treturn ret;\n}",
    "includes": [
      "#include \"sufile.h\"",
      "#include \"mdt.h\"",
      "#include <linux/nilfs2_fs.h>",
      "#include <linux/errno.h>",
      "#include <linux/buffer_head.h>",
      "#include <linux/string.h>",
      "#include <linux/fs.h>",
      "#include <linux/kernel.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "up_write",
          "args": [
            "&NILFS_MDT(sufile)->mi_sem"
          ],
          "line": 227
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "NILFS_MDT",
          "args": [
            "sufile"
          ],
          "line": 227
        },
        "resolved": true,
        "details": {
          "function_name": "NILFS_MDT",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/mdt.h",
          "lines": "69-72",
          "snippet": "static inline struct nilfs_mdt_info *NILFS_MDT(const struct inode *inode)\n{\n\treturn inode->i_private;\n}",
          "includes": [
            "#include \"page.h\"",
            "#include \"nilfs.h\"",
            "#include <linux/blockgroup_lock.h>",
            "#include <linux/buffer_head.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"page.h\"\n#include \"nilfs.h\"\n#include <linux/blockgroup_lock.h>\n#include <linux/buffer_head.h>\n\nstatic inline struct nilfs_mdt_info *NILFS_MDT(const struct inode *inode)\n{\n\treturn inode->i_private;\n}"
        }
      },
      {
        "call_info": {
          "callee": "brelse",
          "args": [
            "header_bh"
          ],
          "line": 225
        },
        "resolved": true,
        "details": {
          "function_name": "__brelse",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/buffer.c",
          "lines": "1177-1184",
          "snippet": "void __brelse(struct buffer_head * buf)\n{\n\tif (atomic_read(&buf->b_count)) {\n\t\tput_bh(buf);\n\t\treturn;\n\t}\n\tWARN(1, KERN_ERR \"VFS: brelse: Trying to free free buffer\\n\");\n}",
          "includes": [
            "#include <trace/events/block.h>",
            "#include <linux/bit_spinlock.h>",
            "#include <linux/mpage.h>",
            "#include <linux/bitops.h>",
            "#include <linux/cpu.h>",
            "#include <linux/notifier.h>",
            "#include <linux/bio.h>",
            "#include <linux/task_io_accounting_ops.h>",
            "#include <linux/buffer_head.h>",
            "#include <linux/suspend.h>",
            "#include <linux/hash.h>",
            "#include <linux/writeback.h>",
            "#include <linux/export.h>",
            "#include <linux/highmem.h>",
            "#include <linux/quotaops.h>",
            "#include <linux/file.h>",
            "#include <linux/blkdev.h>",
            "#include <linux/capability.h>",
            "#include <linux/slab.h>",
            "#include <linux/percpu.h>",
            "#include <linux/mm.h>",
            "#include <linux/fs.h>",
            "#include <linux/syscalls.h>",
            "#include <linux/kernel.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <trace/events/block.h>\n#include <linux/bit_spinlock.h>\n#include <linux/mpage.h>\n#include <linux/bitops.h>\n#include <linux/cpu.h>\n#include <linux/notifier.h>\n#include <linux/bio.h>\n#include <linux/task_io_accounting_ops.h>\n#include <linux/buffer_head.h>\n#include <linux/suspend.h>\n#include <linux/hash.h>\n#include <linux/writeback.h>\n#include <linux/export.h>\n#include <linux/highmem.h>\n#include <linux/quotaops.h>\n#include <linux/file.h>\n#include <linux/blkdev.h>\n#include <linux/capability.h>\n#include <linux/slab.h>\n#include <linux/percpu.h>\n#include <linux/mm.h>\n#include <linux/fs.h>\n#include <linux/syscalls.h>\n#include <linux/kernel.h>\n\nvoid __brelse(struct buffer_head * buf)\n{\n\tif (atomic_read(&buf->b_count)) {\n\t\tput_bh(buf);\n\t\treturn;\n\t}\n\tWARN(1, KERN_ERR \"VFS: brelse: Trying to free free buffer\\n\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "unlikely",
          "args": [
            "ret < 0"
          ],
          "line": 218
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "nilfs_mdt_get_block",
          "args": [
            "sufile",
            "blkoff",
            "create",
            "NULL",
            "&bh"
          ],
          "line": 217
        },
        "resolved": true,
        "details": {
          "function_name": "nilfs_mdt_get_block",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/mdt.c",
          "lines": "242-261",
          "snippet": "int nilfs_mdt_get_block(struct inode *inode, unsigned long blkoff, int create,\n\t\t\tvoid (*init_block)(struct inode *,\n\t\t\t\t\t   struct buffer_head *, void *),\n\t\t\tstruct buffer_head **out_bh)\n{\n\tint ret;\n\n\t/* Should be rewritten with merging nilfs_mdt_read_block() */\n retry:\n\tret = nilfs_mdt_read_block(inode, blkoff, !create, out_bh);\n\tif (!create || ret != -ENOENT)\n\t\treturn ret;\n\n\tret = nilfs_mdt_create_block(inode, blkoff, out_bh, init_block);\n\tif (unlikely(ret == -EEXIST)) {\n\t\t/* create = 0; */  /* limit read-create loop retries */\n\t\tgoto retry;\n\t}\n\treturn ret;\n}",
          "includes": [
            "#include \"mdt.h\"",
            "#include \"page.h\"",
            "#include \"segment.h\"",
            "#include \"btnode.h\"",
            "#include \"nilfs.h\"",
            "#include <linux/slab.h>",
            "#include <linux/swap.h>",
            "#include <linux/backing-dev.h>",
            "#include <linux/writeback.h>",
            "#include <linux/mm.h>",
            "#include <linux/mpage.h>",
            "#include <linux/buffer_head.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"mdt.h\"\n#include \"page.h\"\n#include \"segment.h\"\n#include \"btnode.h\"\n#include \"nilfs.h\"\n#include <linux/slab.h>\n#include <linux/swap.h>\n#include <linux/backing-dev.h>\n#include <linux/writeback.h>\n#include <linux/mm.h>\n#include <linux/mpage.h>\n#include <linux/buffer_head.h>\n\nint nilfs_mdt_get_block(struct inode *inode, unsigned long blkoff, int create,\n\t\t\tvoid (*init_block)(struct inode *,\n\t\t\t\t\t   struct buffer_head *, void *),\n\t\t\tstruct buffer_head **out_bh)\n{\n\tint ret;\n\n\t/* Should be rewritten with merging nilfs_mdt_read_block() */\n retry:\n\tret = nilfs_mdt_read_block(inode, blkoff, !create, out_bh);\n\tif (!create || ret != -ENOENT)\n\t\treturn ret;\n\n\tret = nilfs_mdt_create_block(inode, blkoff, out_bh, init_block);\n\tif (unlikely(ret == -EEXIST)) {\n\t\t/* create = 0; */  /* limit read-create loop retries */\n\t\tgoto retry;\n\t}\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "nilfs_sufile_get_blkoff",
          "args": [
            "sufile",
            "*seg"
          ],
          "line": 211
        },
        "resolved": true,
        "details": {
          "function_name": "nilfs_sufile_get_blkoff",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/sufile.c",
          "lines": "58-64",
          "snippet": "static unsigned long\nnilfs_sufile_get_blkoff(const struct inode *sufile, __u64 segnum)\n{\n\t__u64 t = segnum + NILFS_MDT(sufile)->mi_first_entry_offset;\n\tdo_div(t, nilfs_sufile_segment_usages_per_block(sufile));\n\treturn (unsigned long)t;\n}",
          "includes": [
            "#include \"sufile.h\"",
            "#include \"mdt.h\"",
            "#include <linux/nilfs2_fs.h>",
            "#include <linux/errno.h>",
            "#include <linux/buffer_head.h>",
            "#include <linux/string.h>",
            "#include <linux/fs.h>",
            "#include <linux/kernel.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sufile.h\"\n#include \"mdt.h\"\n#include <linux/nilfs2_fs.h>\n#include <linux/errno.h>\n#include <linux/buffer_head.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n#include <linux/kernel.h>\n\nstatic unsigned long\nnilfs_sufile_get_blkoff(const struct inode *sufile, __u64 segnum)\n{\n\t__u64 t = segnum + NILFS_MDT(sufile)->mi_first_entry_offset;\n\tdo_div(t, nilfs_sufile_segment_usages_per_block(sufile));\n\treturn (unsigned long)t;\n}"
        }
      },
      {
        "call_info": {
          "callee": "dofunc",
          "args": [
            "sufile",
            "*seg",
            "header_bh",
            "bh"
          ],
          "line": 206
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "nilfs_sufile_get_header_block",
          "args": [
            "sufile",
            "&header_bh"
          ],
          "line": 195
        },
        "resolved": true,
        "details": {
          "function_name": "nilfs_sufile_get_header_block",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/sufile.c",
          "lines": "92-96",
          "snippet": "static inline int nilfs_sufile_get_header_block(struct inode *sufile,\n\t\t\t\t\t\tstruct buffer_head **bhp)\n{\n\treturn nilfs_mdt_get_block(sufile, 0, 0, NULL, bhp);\n}",
          "includes": [
            "#include \"sufile.h\"",
            "#include \"mdt.h\"",
            "#include <linux/nilfs2_fs.h>",
            "#include <linux/errno.h>",
            "#include <linux/buffer_head.h>",
            "#include <linux/string.h>",
            "#include <linux/fs.h>",
            "#include <linux/kernel.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sufile.h\"\n#include \"mdt.h\"\n#include <linux/nilfs2_fs.h>\n#include <linux/errno.h>\n#include <linux/buffer_head.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n#include <linux/kernel.h>\n\nstatic inline int nilfs_sufile_get_header_block(struct inode *sufile,\n\t\t\t\t\t\tstruct buffer_head **bhp)\n{\n\treturn nilfs_mdt_get_block(sufile, 0, 0, NULL, bhp);\n}"
        }
      },
      {
        "call_info": {
          "callee": "printk",
          "args": [
            "KERN_WARNING\n\t\t\t       \"%s: invalid segment number: %llu\\n\"",
            "__func__",
            "(unsigned long long)*seg"
          ],
          "line": 184
        },
        "resolved": true,
        "details": {
          "function_name": "compat_printk",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/compat.c",
          "lines": "59-69",
          "snippet": "int compat_printk(const char *fmt, ...)\n{\n\tva_list ap;\n\tint ret;\n\tif (!compat_log)\n\t\treturn 0;\n\tva_start(ap, fmt);\n\tret = vprintk(fmt, ap);\n\tva_end(ap);\n\treturn ret;\n}",
          "includes": [
            "#include \"internal.h\"",
            "#include <asm/ioctls.h>",
            "#include <asm/mmu_context.h>",
            "#include <asm/uaccess.h>",
            "#include <linux/aio.h>",
            "#include <linux/pagemap.h>",
            "#include <linux/slab.h>",
            "#include <linux/fs_struct.h>",
            "#include <linux/mm.h>",
            "#include <linux/poll.h>",
            "#include <linux/signal.h>",
            "#include <linux/highmem.h>",
            "#include <linux/security.h>",
            "#include <linux/tsacct_kern.h>",
            "#include <linux/rwsem.h>",
            "#include <linux/personality.h>",
            "#include <linux/highuid.h>",
            "#include <linux/fsnotify.h>",
            "#include <linux/dirent.h>",
            "#include <linux/ctype.h>",
            "#include <linux/syscalls.h>",
            "#include <linux/nfs4_mount.h>",
            "#include <linux/ncp_mount.h>",
            "#include <linux/init.h>",
            "#include <linux/ioctl.h>",
            "#include <linux/vfs.h>",
            "#include <linux/fdtable.h>",
            "#include <linux/file.h>",
            "#include <linux/namei.h>",
            "#include <linux/fcntl.h>",
            "#include <linux/fs.h>",
            "#include <linux/time.h>",
            "#include <linux/errno.h>",
            "#include <linux/compat.h>",
            "#include <linux/linkage.h>",
            "#include <linux/kernel.h>",
            "#include <linux/stddef.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "int compat_log = 1;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"internal.h\"\n#include <asm/ioctls.h>\n#include <asm/mmu_context.h>\n#include <asm/uaccess.h>\n#include <linux/aio.h>\n#include <linux/pagemap.h>\n#include <linux/slab.h>\n#include <linux/fs_struct.h>\n#include <linux/mm.h>\n#include <linux/poll.h>\n#include <linux/signal.h>\n#include <linux/highmem.h>\n#include <linux/security.h>\n#include <linux/tsacct_kern.h>\n#include <linux/rwsem.h>\n#include <linux/personality.h>\n#include <linux/highuid.h>\n#include <linux/fsnotify.h>\n#include <linux/dirent.h>\n#include <linux/ctype.h>\n#include <linux/syscalls.h>\n#include <linux/nfs4_mount.h>\n#include <linux/ncp_mount.h>\n#include <linux/init.h>\n#include <linux/ioctl.h>\n#include <linux/vfs.h>\n#include <linux/fdtable.h>\n#include <linux/file.h>\n#include <linux/namei.h>\n#include <linux/fcntl.h>\n#include <linux/fs.h>\n#include <linux/time.h>\n#include <linux/errno.h>\n#include <linux/compat.h>\n#include <linux/linkage.h>\n#include <linux/kernel.h>\n#include <linux/stddef.h>\n\nint compat_log = 1;\n\nint compat_printk(const char *fmt, ...)\n{\n\tva_list ap;\n\tint ret;\n\tif (!compat_log)\n\t\treturn 0;\n\tva_start(ap, fmt);\n\tret = vprintk(fmt, ap);\n\tva_end(ap);\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "unlikely",
          "args": [
            "*seg >= nilfs_sufile_get_nsegments(sufile)"
          ],
          "line": 183
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "nilfs_sufile_get_nsegments",
          "args": [
            "sufile"
          ],
          "line": 183
        },
        "resolved": true,
        "details": {
          "function_name": "nilfs_sufile_get_nsegments",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/sufile.h",
          "lines": "32-35",
          "snippet": "static inline unsigned long nilfs_sufile_get_nsegments(struct inode *sufile)\n{\n\treturn ((struct the_nilfs *)sufile->i_sb->s_fs_info)->ns_nsegments;\n}",
          "includes": [
            "#include \"mdt.h\"",
            "#include <linux/nilfs2_fs.h>",
            "#include <linux/buffer_head.h>",
            "#include <linux/fs.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"mdt.h\"\n#include <linux/nilfs2_fs.h>\n#include <linux/buffer_head.h>\n#include <linux/fs.h>\n\nstatic inline unsigned long nilfs_sufile_get_nsegments(struct inode *sufile)\n{\n\treturn ((struct the_nilfs *)sufile->i_sb->s_fs_info)->ns_nsegments;\n}"
        }
      },
      {
        "call_info": {
          "callee": "down_write",
          "args": [
            "&NILFS_MDT(sufile)->mi_sem"
          ],
          "line": 181
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "unlikely",
          "args": [
            "nsegs == 0"
          ],
          "line": 178
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"sufile.h\"\n#include \"mdt.h\"\n#include <linux/nilfs2_fs.h>\n#include <linux/errno.h>\n#include <linux/buffer_head.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n#include <linux/kernel.h>\n\nint nilfs_sufile_updatev(struct inode *sufile, __u64 *segnumv, size_t nsegs,\n\t\t\t int create, size_t *ndone,\n\t\t\t void (*dofunc)(struct inode *, __u64,\n\t\t\t\t\tstruct buffer_head *,\n\t\t\t\t\tstruct buffer_head *))\n{\n\tstruct buffer_head *header_bh, *bh;\n\tunsigned long blkoff, prev_blkoff;\n\t__u64 *seg;\n\tsize_t nerr = 0, n = 0;\n\tint ret = 0;\n\n\tif (unlikely(nsegs == 0))\n\t\tgoto out;\n\n\tdown_write(&NILFS_MDT(sufile)->mi_sem);\n\tfor (seg = segnumv; seg < segnumv + nsegs; seg++) {\n\t\tif (unlikely(*seg >= nilfs_sufile_get_nsegments(sufile))) {\n\t\t\tprintk(KERN_WARNING\n\t\t\t       \"%s: invalid segment number: %llu\\n\", __func__,\n\t\t\t       (unsigned long long)*seg);\n\t\t\tnerr++;\n\t\t}\n\t}\n\tif (nerr > 0) {\n\t\tret = -EINVAL;\n\t\tgoto out_sem;\n\t}\n\n\tret = nilfs_sufile_get_header_block(sufile, &header_bh);\n\tif (ret < 0)\n\t\tgoto out_sem;\n\n\tseg = segnumv;\n\tblkoff = nilfs_sufile_get_blkoff(sufile, *seg);\n\tret = nilfs_mdt_get_block(sufile, blkoff, create, NULL, &bh);\n\tif (ret < 0)\n\t\tgoto out_header;\n\n\tfor (;;) {\n\t\tdofunc(sufile, *seg, header_bh, bh);\n\n\t\tif (++seg >= segnumv + nsegs)\n\t\t\tbreak;\n\t\tprev_blkoff = blkoff;\n\t\tblkoff = nilfs_sufile_get_blkoff(sufile, *seg);\n\t\tif (blkoff == prev_blkoff)\n\t\t\tcontinue;\n\n\t\t/* get different block */\n\t\tbrelse(bh);\n\t\tret = nilfs_mdt_get_block(sufile, blkoff, create, NULL, &bh);\n\t\tif (unlikely(ret < 0))\n\t\t\tgoto out_header;\n\t}\n\tbrelse(bh);\n\n out_header:\n\tn = seg - segnumv;\n\tbrelse(header_bh);\n out_sem:\n\tup_write(&NILFS_MDT(sufile)->mi_sem);\n out:\n\tif (ndone)\n\t\t*ndone = n;\n\treturn ret;\n}"
  },
  {
    "function_name": "nilfs_sufile_get_ncleansegs",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/sufile.c",
    "lines": "133-136",
    "snippet": "unsigned long nilfs_sufile_get_ncleansegs(struct inode *sufile)\n{\n\treturn NILFS_SUI(sufile)->ncleansegs;\n}",
    "includes": [
      "#include \"sufile.h\"",
      "#include \"mdt.h\"",
      "#include <linux/nilfs2_fs.h>",
      "#include <linux/errno.h>",
      "#include <linux/buffer_head.h>",
      "#include <linux/string.h>",
      "#include <linux/fs.h>",
      "#include <linux/kernel.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "NILFS_SUI",
          "args": [
            "sufile"
          ],
          "line": 135
        },
        "resolved": true,
        "details": {
          "function_name": "NILFS_SUI",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/sufile.c",
          "lines": "47-50",
          "snippet": "static inline struct nilfs_sufile_info *NILFS_SUI(struct inode *sufile)\n{\n\treturn (struct nilfs_sufile_info *)NILFS_MDT(sufile);\n}",
          "includes": [
            "#include \"sufile.h\"",
            "#include \"mdt.h\"",
            "#include <linux/nilfs2_fs.h>",
            "#include <linux/errno.h>",
            "#include <linux/buffer_head.h>",
            "#include <linux/string.h>",
            "#include <linux/fs.h>",
            "#include <linux/kernel.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sufile.h\"\n#include \"mdt.h\"\n#include <linux/nilfs2_fs.h>\n#include <linux/errno.h>\n#include <linux/buffer_head.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n#include <linux/kernel.h>\n\nstatic inline struct nilfs_sufile_info *NILFS_SUI(struct inode *sufile)\n{\n\treturn (struct nilfs_sufile_info *)NILFS_MDT(sufile);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"sufile.h\"\n#include \"mdt.h\"\n#include <linux/nilfs2_fs.h>\n#include <linux/errno.h>\n#include <linux/buffer_head.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n#include <linux/kernel.h>\n\nunsigned long nilfs_sufile_get_ncleansegs(struct inode *sufile)\n{\n\treturn NILFS_SUI(sufile)->ncleansegs;\n}"
  },
  {
    "function_name": "nilfs_sufile_mod_counter",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/sufile.c",
    "lines": "114-127",
    "snippet": "static void nilfs_sufile_mod_counter(struct buffer_head *header_bh,\n\t\t\t\t     u64 ncleanadd, u64 ndirtyadd)\n{\n\tstruct nilfs_sufile_header *header;\n\tvoid *kaddr;\n\n\tkaddr = kmap_atomic(header_bh->b_page);\n\theader = kaddr + bh_offset(header_bh);\n\tle64_add_cpu(&header->sh_ncleansegs, ncleanadd);\n\tle64_add_cpu(&header->sh_ndirtysegs, ndirtyadd);\n\tkunmap_atomic(kaddr);\n\n\tmark_buffer_dirty(header_bh);\n}",
    "includes": [
      "#include \"sufile.h\"",
      "#include \"mdt.h\"",
      "#include <linux/nilfs2_fs.h>",
      "#include <linux/errno.h>",
      "#include <linux/buffer_head.h>",
      "#include <linux/string.h>",
      "#include <linux/fs.h>",
      "#include <linux/kernel.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "mark_buffer_dirty",
          "args": [
            "header_bh"
          ],
          "line": 126
        },
        "resolved": true,
        "details": {
          "function_name": "mark_buffer_dirty",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/buffer.c",
          "lines": "1141-1167",
          "snippet": "void mark_buffer_dirty(struct buffer_head *bh)\n{\n\tWARN_ON_ONCE(!buffer_uptodate(bh));\n\n\ttrace_block_dirty_buffer(bh);\n\n\t/*\n\t * Very *carefully* optimize the it-is-already-dirty case.\n\t *\n\t * Don't let the final \"is it dirty\" escape to before we\n\t * perhaps modified the buffer.\n\t */\n\tif (buffer_dirty(bh)) {\n\t\tsmp_mb();\n\t\tif (buffer_dirty(bh))\n\t\t\treturn;\n\t}\n\n\tif (!test_set_buffer_dirty(bh)) {\n\t\tstruct page *page = bh->b_page;\n\t\tif (!TestSetPageDirty(page)) {\n\t\t\tstruct address_space *mapping = page_mapping(page);\n\t\t\tif (mapping)\n\t\t\t\t__set_page_dirty(page, mapping, 0);\n\t\t}\n\t}\n}",
          "includes": [
            "#include <trace/events/block.h>",
            "#include <linux/bit_spinlock.h>",
            "#include <linux/mpage.h>",
            "#include <linux/bitops.h>",
            "#include <linux/cpu.h>",
            "#include <linux/notifier.h>",
            "#include <linux/bio.h>",
            "#include <linux/task_io_accounting_ops.h>",
            "#include <linux/buffer_head.h>",
            "#include <linux/suspend.h>",
            "#include <linux/hash.h>",
            "#include <linux/writeback.h>",
            "#include <linux/export.h>",
            "#include <linux/highmem.h>",
            "#include <linux/quotaops.h>",
            "#include <linux/file.h>",
            "#include <linux/blkdev.h>",
            "#include <linux/capability.h>",
            "#include <linux/slab.h>",
            "#include <linux/percpu.h>",
            "#include <linux/mm.h>",
            "#include <linux/fs.h>",
            "#include <linux/syscalls.h>",
            "#include <linux/kernel.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <trace/events/block.h>\n#include <linux/bit_spinlock.h>\n#include <linux/mpage.h>\n#include <linux/bitops.h>\n#include <linux/cpu.h>\n#include <linux/notifier.h>\n#include <linux/bio.h>\n#include <linux/task_io_accounting_ops.h>\n#include <linux/buffer_head.h>\n#include <linux/suspend.h>\n#include <linux/hash.h>\n#include <linux/writeback.h>\n#include <linux/export.h>\n#include <linux/highmem.h>\n#include <linux/quotaops.h>\n#include <linux/file.h>\n#include <linux/blkdev.h>\n#include <linux/capability.h>\n#include <linux/slab.h>\n#include <linux/percpu.h>\n#include <linux/mm.h>\n#include <linux/fs.h>\n#include <linux/syscalls.h>\n#include <linux/kernel.h>\n\nvoid mark_buffer_dirty(struct buffer_head *bh)\n{\n\tWARN_ON_ONCE(!buffer_uptodate(bh));\n\n\ttrace_block_dirty_buffer(bh);\n\n\t/*\n\t * Very *carefully* optimize the it-is-already-dirty case.\n\t *\n\t * Don't let the final \"is it dirty\" escape to before we\n\t * perhaps modified the buffer.\n\t */\n\tif (buffer_dirty(bh)) {\n\t\tsmp_mb();\n\t\tif (buffer_dirty(bh))\n\t\t\treturn;\n\t}\n\n\tif (!test_set_buffer_dirty(bh)) {\n\t\tstruct page *page = bh->b_page;\n\t\tif (!TestSetPageDirty(page)) {\n\t\t\tstruct address_space *mapping = page_mapping(page);\n\t\t\tif (mapping)\n\t\t\t\t__set_page_dirty(page, mapping, 0);\n\t\t}\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "kunmap_atomic",
          "args": [
            "kaddr"
          ],
          "line": 124
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "le64_add_cpu",
          "args": [
            "&header->sh_ndirtysegs",
            "ndirtyadd"
          ],
          "line": 123
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "le64_add_cpu",
          "args": [
            "&header->sh_ncleansegs",
            "ncleanadd"
          ],
          "line": 122
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bh_offset",
          "args": [
            "header_bh"
          ],
          "line": 121
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kmap_atomic",
          "args": [
            "header_bh->b_page"
          ],
          "line": 120
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"sufile.h\"\n#include \"mdt.h\"\n#include <linux/nilfs2_fs.h>\n#include <linux/errno.h>\n#include <linux/buffer_head.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n#include <linux/kernel.h>\n\nstatic void nilfs_sufile_mod_counter(struct buffer_head *header_bh,\n\t\t\t\t     u64 ncleanadd, u64 ndirtyadd)\n{\n\tstruct nilfs_sufile_header *header;\n\tvoid *kaddr;\n\n\tkaddr = kmap_atomic(header_bh->b_page);\n\theader = kaddr + bh_offset(header_bh);\n\tle64_add_cpu(&header->sh_ncleansegs, ncleanadd);\n\tle64_add_cpu(&header->sh_ndirtysegs, ndirtyadd);\n\tkunmap_atomic(kaddr);\n\n\tmark_buffer_dirty(header_bh);\n}"
  },
  {
    "function_name": "nilfs_sufile_delete_segment_usage_block",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/sufile.c",
    "lines": "107-112",
    "snippet": "static int nilfs_sufile_delete_segment_usage_block(struct inode *sufile,\n\t\t\t\t\t\t   __u64 segnum)\n{\n\treturn nilfs_mdt_delete_block(sufile,\n\t\t\t\t      nilfs_sufile_get_blkoff(sufile, segnum));\n}",
    "includes": [
      "#include \"sufile.h\"",
      "#include \"mdt.h\"",
      "#include <linux/nilfs2_fs.h>",
      "#include <linux/errno.h>",
      "#include <linux/buffer_head.h>",
      "#include <linux/string.h>",
      "#include <linux/fs.h>",
      "#include <linux/kernel.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "nilfs_mdt_delete_block",
          "args": [
            "sufile",
            "nilfs_sufile_get_blkoff(sufile, segnum)"
          ],
          "line": 110
        },
        "resolved": true,
        "details": {
          "function_name": "nilfs_mdt_delete_block",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/mdt.c",
          "lines": "275-286",
          "snippet": "int nilfs_mdt_delete_block(struct inode *inode, unsigned long block)\n{\n\tstruct nilfs_inode_info *ii = NILFS_I(inode);\n\tint err;\n\n\terr = nilfs_bmap_delete(ii->i_bmap, block);\n\tif (!err || err == -ENOENT) {\n\t\tnilfs_mdt_mark_dirty(inode);\n\t\tnilfs_mdt_forget_block(inode, block);\n\t}\n\treturn err;\n}",
          "includes": [
            "#include \"mdt.h\"",
            "#include \"page.h\"",
            "#include \"segment.h\"",
            "#include \"btnode.h\"",
            "#include \"nilfs.h\"",
            "#include <linux/slab.h>",
            "#include <linux/swap.h>",
            "#include <linux/backing-dev.h>",
            "#include <linux/writeback.h>",
            "#include <linux/mm.h>",
            "#include <linux/mpage.h>",
            "#include <linux/buffer_head.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"mdt.h\"\n#include \"page.h\"\n#include \"segment.h\"\n#include \"btnode.h\"\n#include \"nilfs.h\"\n#include <linux/slab.h>\n#include <linux/swap.h>\n#include <linux/backing-dev.h>\n#include <linux/writeback.h>\n#include <linux/mm.h>\n#include <linux/mpage.h>\n#include <linux/buffer_head.h>\n\nint nilfs_mdt_delete_block(struct inode *inode, unsigned long block)\n{\n\tstruct nilfs_inode_info *ii = NILFS_I(inode);\n\tint err;\n\n\terr = nilfs_bmap_delete(ii->i_bmap, block);\n\tif (!err || err == -ENOENT) {\n\t\tnilfs_mdt_mark_dirty(inode);\n\t\tnilfs_mdt_forget_block(inode, block);\n\t}\n\treturn err;\n}"
        }
      },
      {
        "call_info": {
          "callee": "nilfs_sufile_get_blkoff",
          "args": [
            "sufile",
            "segnum"
          ],
          "line": 111
        },
        "resolved": true,
        "details": {
          "function_name": "nilfs_sufile_get_blkoff",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/sufile.c",
          "lines": "58-64",
          "snippet": "static unsigned long\nnilfs_sufile_get_blkoff(const struct inode *sufile, __u64 segnum)\n{\n\t__u64 t = segnum + NILFS_MDT(sufile)->mi_first_entry_offset;\n\tdo_div(t, nilfs_sufile_segment_usages_per_block(sufile));\n\treturn (unsigned long)t;\n}",
          "includes": [
            "#include \"sufile.h\"",
            "#include \"mdt.h\"",
            "#include <linux/nilfs2_fs.h>",
            "#include <linux/errno.h>",
            "#include <linux/buffer_head.h>",
            "#include <linux/string.h>",
            "#include <linux/fs.h>",
            "#include <linux/kernel.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sufile.h\"\n#include \"mdt.h\"\n#include <linux/nilfs2_fs.h>\n#include <linux/errno.h>\n#include <linux/buffer_head.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n#include <linux/kernel.h>\n\nstatic unsigned long\nnilfs_sufile_get_blkoff(const struct inode *sufile, __u64 segnum)\n{\n\t__u64 t = segnum + NILFS_MDT(sufile)->mi_first_entry_offset;\n\tdo_div(t, nilfs_sufile_segment_usages_per_block(sufile));\n\treturn (unsigned long)t;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"sufile.h\"\n#include \"mdt.h\"\n#include <linux/nilfs2_fs.h>\n#include <linux/errno.h>\n#include <linux/buffer_head.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n#include <linux/kernel.h>\n\nstatic int nilfs_sufile_delete_segment_usage_block(struct inode *sufile,\n\t\t\t\t\t\t   __u64 segnum)\n{\n\treturn nilfs_mdt_delete_block(sufile,\n\t\t\t\t      nilfs_sufile_get_blkoff(sufile, segnum));\n}"
  },
  {
    "function_name": "nilfs_sufile_get_segment_usage_block",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/sufile.c",
    "lines": "98-105",
    "snippet": "static inline int\nnilfs_sufile_get_segment_usage_block(struct inode *sufile, __u64 segnum,\n\t\t\t\t     int create, struct buffer_head **bhp)\n{\n\treturn nilfs_mdt_get_block(sufile,\n\t\t\t\t   nilfs_sufile_get_blkoff(sufile, segnum),\n\t\t\t\t   create, NULL, bhp);\n}",
    "includes": [
      "#include \"sufile.h\"",
      "#include \"mdt.h\"",
      "#include <linux/nilfs2_fs.h>",
      "#include <linux/errno.h>",
      "#include <linux/buffer_head.h>",
      "#include <linux/string.h>",
      "#include <linux/fs.h>",
      "#include <linux/kernel.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "nilfs_mdt_get_block",
          "args": [
            "sufile",
            "nilfs_sufile_get_blkoff(sufile, segnum)",
            "create",
            "NULL",
            "bhp"
          ],
          "line": 102
        },
        "resolved": true,
        "details": {
          "function_name": "nilfs_mdt_get_block",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/mdt.c",
          "lines": "242-261",
          "snippet": "int nilfs_mdt_get_block(struct inode *inode, unsigned long blkoff, int create,\n\t\t\tvoid (*init_block)(struct inode *,\n\t\t\t\t\t   struct buffer_head *, void *),\n\t\t\tstruct buffer_head **out_bh)\n{\n\tint ret;\n\n\t/* Should be rewritten with merging nilfs_mdt_read_block() */\n retry:\n\tret = nilfs_mdt_read_block(inode, blkoff, !create, out_bh);\n\tif (!create || ret != -ENOENT)\n\t\treturn ret;\n\n\tret = nilfs_mdt_create_block(inode, blkoff, out_bh, init_block);\n\tif (unlikely(ret == -EEXIST)) {\n\t\t/* create = 0; */  /* limit read-create loop retries */\n\t\tgoto retry;\n\t}\n\treturn ret;\n}",
          "includes": [
            "#include \"mdt.h\"",
            "#include \"page.h\"",
            "#include \"segment.h\"",
            "#include \"btnode.h\"",
            "#include \"nilfs.h\"",
            "#include <linux/slab.h>",
            "#include <linux/swap.h>",
            "#include <linux/backing-dev.h>",
            "#include <linux/writeback.h>",
            "#include <linux/mm.h>",
            "#include <linux/mpage.h>",
            "#include <linux/buffer_head.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"mdt.h\"\n#include \"page.h\"\n#include \"segment.h\"\n#include \"btnode.h\"\n#include \"nilfs.h\"\n#include <linux/slab.h>\n#include <linux/swap.h>\n#include <linux/backing-dev.h>\n#include <linux/writeback.h>\n#include <linux/mm.h>\n#include <linux/mpage.h>\n#include <linux/buffer_head.h>\n\nint nilfs_mdt_get_block(struct inode *inode, unsigned long blkoff, int create,\n\t\t\tvoid (*init_block)(struct inode *,\n\t\t\t\t\t   struct buffer_head *, void *),\n\t\t\tstruct buffer_head **out_bh)\n{\n\tint ret;\n\n\t/* Should be rewritten with merging nilfs_mdt_read_block() */\n retry:\n\tret = nilfs_mdt_read_block(inode, blkoff, !create, out_bh);\n\tif (!create || ret != -ENOENT)\n\t\treturn ret;\n\n\tret = nilfs_mdt_create_block(inode, blkoff, out_bh, init_block);\n\tif (unlikely(ret == -EEXIST)) {\n\t\t/* create = 0; */  /* limit read-create loop retries */\n\t\tgoto retry;\n\t}\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "nilfs_sufile_get_blkoff",
          "args": [
            "sufile",
            "segnum"
          ],
          "line": 103
        },
        "resolved": true,
        "details": {
          "function_name": "nilfs_sufile_get_blkoff",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/sufile.c",
          "lines": "58-64",
          "snippet": "static unsigned long\nnilfs_sufile_get_blkoff(const struct inode *sufile, __u64 segnum)\n{\n\t__u64 t = segnum + NILFS_MDT(sufile)->mi_first_entry_offset;\n\tdo_div(t, nilfs_sufile_segment_usages_per_block(sufile));\n\treturn (unsigned long)t;\n}",
          "includes": [
            "#include \"sufile.h\"",
            "#include \"mdt.h\"",
            "#include <linux/nilfs2_fs.h>",
            "#include <linux/errno.h>",
            "#include <linux/buffer_head.h>",
            "#include <linux/string.h>",
            "#include <linux/fs.h>",
            "#include <linux/kernel.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sufile.h\"\n#include \"mdt.h\"\n#include <linux/nilfs2_fs.h>\n#include <linux/errno.h>\n#include <linux/buffer_head.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n#include <linux/kernel.h>\n\nstatic unsigned long\nnilfs_sufile_get_blkoff(const struct inode *sufile, __u64 segnum)\n{\n\t__u64 t = segnum + NILFS_MDT(sufile)->mi_first_entry_offset;\n\tdo_div(t, nilfs_sufile_segment_usages_per_block(sufile));\n\treturn (unsigned long)t;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"sufile.h\"\n#include \"mdt.h\"\n#include <linux/nilfs2_fs.h>\n#include <linux/errno.h>\n#include <linux/buffer_head.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n#include <linux/kernel.h>\n\nstatic inline int\nnilfs_sufile_get_segment_usage_block(struct inode *sufile, __u64 segnum,\n\t\t\t\t     int create, struct buffer_head **bhp)\n{\n\treturn nilfs_mdt_get_block(sufile,\n\t\t\t\t   nilfs_sufile_get_blkoff(sufile, segnum),\n\t\t\t\t   create, NULL, bhp);\n}"
  },
  {
    "function_name": "nilfs_sufile_get_header_block",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/sufile.c",
    "lines": "92-96",
    "snippet": "static inline int nilfs_sufile_get_header_block(struct inode *sufile,\n\t\t\t\t\t\tstruct buffer_head **bhp)\n{\n\treturn nilfs_mdt_get_block(sufile, 0, 0, NULL, bhp);\n}",
    "includes": [
      "#include \"sufile.h\"",
      "#include \"mdt.h\"",
      "#include <linux/nilfs2_fs.h>",
      "#include <linux/errno.h>",
      "#include <linux/buffer_head.h>",
      "#include <linux/string.h>",
      "#include <linux/fs.h>",
      "#include <linux/kernel.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "nilfs_mdt_get_block",
          "args": [
            "sufile",
            "0",
            "0",
            "NULL",
            "bhp"
          ],
          "line": 95
        },
        "resolved": true,
        "details": {
          "function_name": "nilfs_mdt_get_block",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/mdt.c",
          "lines": "242-261",
          "snippet": "int nilfs_mdt_get_block(struct inode *inode, unsigned long blkoff, int create,\n\t\t\tvoid (*init_block)(struct inode *,\n\t\t\t\t\t   struct buffer_head *, void *),\n\t\t\tstruct buffer_head **out_bh)\n{\n\tint ret;\n\n\t/* Should be rewritten with merging nilfs_mdt_read_block() */\n retry:\n\tret = nilfs_mdt_read_block(inode, blkoff, !create, out_bh);\n\tif (!create || ret != -ENOENT)\n\t\treturn ret;\n\n\tret = nilfs_mdt_create_block(inode, blkoff, out_bh, init_block);\n\tif (unlikely(ret == -EEXIST)) {\n\t\t/* create = 0; */  /* limit read-create loop retries */\n\t\tgoto retry;\n\t}\n\treturn ret;\n}",
          "includes": [
            "#include \"mdt.h\"",
            "#include \"page.h\"",
            "#include \"segment.h\"",
            "#include \"btnode.h\"",
            "#include \"nilfs.h\"",
            "#include <linux/slab.h>",
            "#include <linux/swap.h>",
            "#include <linux/backing-dev.h>",
            "#include <linux/writeback.h>",
            "#include <linux/mm.h>",
            "#include <linux/mpage.h>",
            "#include <linux/buffer_head.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"mdt.h\"\n#include \"page.h\"\n#include \"segment.h\"\n#include \"btnode.h\"\n#include \"nilfs.h\"\n#include <linux/slab.h>\n#include <linux/swap.h>\n#include <linux/backing-dev.h>\n#include <linux/writeback.h>\n#include <linux/mm.h>\n#include <linux/mpage.h>\n#include <linux/buffer_head.h>\n\nint nilfs_mdt_get_block(struct inode *inode, unsigned long blkoff, int create,\n\t\t\tvoid (*init_block)(struct inode *,\n\t\t\t\t\t   struct buffer_head *, void *),\n\t\t\tstruct buffer_head **out_bh)\n{\n\tint ret;\n\n\t/* Should be rewritten with merging nilfs_mdt_read_block() */\n retry:\n\tret = nilfs_mdt_read_block(inode, blkoff, !create, out_bh);\n\tif (!create || ret != -ENOENT)\n\t\treturn ret;\n\n\tret = nilfs_mdt_create_block(inode, blkoff, out_bh, init_block);\n\tif (unlikely(ret == -EEXIST)) {\n\t\t/* create = 0; */  /* limit read-create loop retries */\n\t\tgoto retry;\n\t}\n\treturn ret;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"sufile.h\"\n#include \"mdt.h\"\n#include <linux/nilfs2_fs.h>\n#include <linux/errno.h>\n#include <linux/buffer_head.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n#include <linux/kernel.h>\n\nstatic inline int nilfs_sufile_get_header_block(struct inode *sufile,\n\t\t\t\t\t\tstruct buffer_head **bhp)\n{\n\treturn nilfs_mdt_get_block(sufile, 0, 0, NULL, bhp);\n}"
  },
  {
    "function_name": "nilfs_sufile_block_get_segment_usage",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/sufile.c",
    "lines": "83-90",
    "snippet": "static struct nilfs_segment_usage *\nnilfs_sufile_block_get_segment_usage(const struct inode *sufile, __u64 segnum,\n\t\t\t\t     struct buffer_head *bh, void *kaddr)\n{\n\treturn kaddr + bh_offset(bh) +\n\t\tnilfs_sufile_get_offset(sufile, segnum) *\n\t\tNILFS_MDT(sufile)->mi_entry_size;\n}",
    "includes": [
      "#include \"sufile.h\"",
      "#include \"mdt.h\"",
      "#include <linux/nilfs2_fs.h>",
      "#include <linux/errno.h>",
      "#include <linux/buffer_head.h>",
      "#include <linux/string.h>",
      "#include <linux/fs.h>",
      "#include <linux/kernel.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "NILFS_MDT",
          "args": [
            "sufile"
          ],
          "line": 89
        },
        "resolved": true,
        "details": {
          "function_name": "NILFS_MDT",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/mdt.h",
          "lines": "69-72",
          "snippet": "static inline struct nilfs_mdt_info *NILFS_MDT(const struct inode *inode)\n{\n\treturn inode->i_private;\n}",
          "includes": [
            "#include \"page.h\"",
            "#include \"nilfs.h\"",
            "#include <linux/blockgroup_lock.h>",
            "#include <linux/buffer_head.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"page.h\"\n#include \"nilfs.h\"\n#include <linux/blockgroup_lock.h>\n#include <linux/buffer_head.h>\n\nstatic inline struct nilfs_mdt_info *NILFS_MDT(const struct inode *inode)\n{\n\treturn inode->i_private;\n}"
        }
      },
      {
        "call_info": {
          "callee": "nilfs_sufile_get_offset",
          "args": [
            "sufile",
            "segnum"
          ],
          "line": 88
        },
        "resolved": true,
        "details": {
          "function_name": "nilfs_sufile_get_offset",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/sufile.c",
          "lines": "66-71",
          "snippet": "static unsigned long\nnilfs_sufile_get_offset(const struct inode *sufile, __u64 segnum)\n{\n\t__u64 t = segnum + NILFS_MDT(sufile)->mi_first_entry_offset;\n\treturn do_div(t, nilfs_sufile_segment_usages_per_block(sufile));\n}",
          "includes": [
            "#include \"sufile.h\"",
            "#include \"mdt.h\"",
            "#include <linux/nilfs2_fs.h>",
            "#include <linux/errno.h>",
            "#include <linux/buffer_head.h>",
            "#include <linux/string.h>",
            "#include <linux/fs.h>",
            "#include <linux/kernel.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sufile.h\"\n#include \"mdt.h\"\n#include <linux/nilfs2_fs.h>\n#include <linux/errno.h>\n#include <linux/buffer_head.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n#include <linux/kernel.h>\n\nstatic unsigned long\nnilfs_sufile_get_offset(const struct inode *sufile, __u64 segnum)\n{\n\t__u64 t = segnum + NILFS_MDT(sufile)->mi_first_entry_offset;\n\treturn do_div(t, nilfs_sufile_segment_usages_per_block(sufile));\n}"
        }
      },
      {
        "call_info": {
          "callee": "bh_offset",
          "args": [
            "bh"
          ],
          "line": 87
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"sufile.h\"\n#include \"mdt.h\"\n#include <linux/nilfs2_fs.h>\n#include <linux/errno.h>\n#include <linux/buffer_head.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n#include <linux/kernel.h>\n\nstatic struct nilfs_segment_usage *\nnilfs_sufile_block_get_segment_usage(const struct inode *sufile, __u64 segnum,\n\t\t\t\t     struct buffer_head *bh, void *kaddr)\n{\n\treturn kaddr + bh_offset(bh) +\n\t\tnilfs_sufile_get_offset(sufile, segnum) *\n\t\tNILFS_MDT(sufile)->mi_entry_size;\n}"
  },
  {
    "function_name": "nilfs_sufile_segment_usages_in_block",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/sufile.c",
    "lines": "73-81",
    "snippet": "static unsigned long\nnilfs_sufile_segment_usages_in_block(const struct inode *sufile, __u64 curr,\n\t\t\t\t     __u64 max)\n{\n\treturn min_t(unsigned long,\n\t\t     nilfs_sufile_segment_usages_per_block(sufile) -\n\t\t     nilfs_sufile_get_offset(sufile, curr),\n\t\t     max - curr + 1);\n}",
    "includes": [
      "#include \"sufile.h\"",
      "#include \"mdt.h\"",
      "#include <linux/nilfs2_fs.h>",
      "#include <linux/errno.h>",
      "#include <linux/buffer_head.h>",
      "#include <linux/string.h>",
      "#include <linux/fs.h>",
      "#include <linux/kernel.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "min_t",
          "args": [
            "unsignedlong",
            "nilfs_sufile_segment_usages_per_block(sufile) -\n\t\t     nilfs_sufile_get_offset(sufile, curr)",
            "max - curr + 1"
          ],
          "line": 77
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "nilfs_sufile_get_offset",
          "args": [
            "sufile",
            "curr"
          ],
          "line": 79
        },
        "resolved": true,
        "details": {
          "function_name": "nilfs_sufile_get_offset",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/sufile.c",
          "lines": "66-71",
          "snippet": "static unsigned long\nnilfs_sufile_get_offset(const struct inode *sufile, __u64 segnum)\n{\n\t__u64 t = segnum + NILFS_MDT(sufile)->mi_first_entry_offset;\n\treturn do_div(t, nilfs_sufile_segment_usages_per_block(sufile));\n}",
          "includes": [
            "#include \"sufile.h\"",
            "#include \"mdt.h\"",
            "#include <linux/nilfs2_fs.h>",
            "#include <linux/errno.h>",
            "#include <linux/buffer_head.h>",
            "#include <linux/string.h>",
            "#include <linux/fs.h>",
            "#include <linux/kernel.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sufile.h\"\n#include \"mdt.h\"\n#include <linux/nilfs2_fs.h>\n#include <linux/errno.h>\n#include <linux/buffer_head.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n#include <linux/kernel.h>\n\nstatic unsigned long\nnilfs_sufile_get_offset(const struct inode *sufile, __u64 segnum)\n{\n\t__u64 t = segnum + NILFS_MDT(sufile)->mi_first_entry_offset;\n\treturn do_div(t, nilfs_sufile_segment_usages_per_block(sufile));\n}"
        }
      },
      {
        "call_info": {
          "callee": "nilfs_sufile_segment_usages_per_block",
          "args": [
            "sufile"
          ],
          "line": 78
        },
        "resolved": true,
        "details": {
          "function_name": "nilfs_sufile_segment_usages_per_block",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/sufile.c",
          "lines": "52-56",
          "snippet": "static inline unsigned long\nnilfs_sufile_segment_usages_per_block(const struct inode *sufile)\n{\n\treturn NILFS_MDT(sufile)->mi_entries_per_block;\n}",
          "includes": [
            "#include \"sufile.h\"",
            "#include \"mdt.h\"",
            "#include <linux/nilfs2_fs.h>",
            "#include <linux/errno.h>",
            "#include <linux/buffer_head.h>",
            "#include <linux/string.h>",
            "#include <linux/fs.h>",
            "#include <linux/kernel.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sufile.h\"\n#include \"mdt.h\"\n#include <linux/nilfs2_fs.h>\n#include <linux/errno.h>\n#include <linux/buffer_head.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n#include <linux/kernel.h>\n\nstatic inline unsigned long\nnilfs_sufile_segment_usages_per_block(const struct inode *sufile)\n{\n\treturn NILFS_MDT(sufile)->mi_entries_per_block;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"sufile.h\"\n#include \"mdt.h\"\n#include <linux/nilfs2_fs.h>\n#include <linux/errno.h>\n#include <linux/buffer_head.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n#include <linux/kernel.h>\n\nstatic unsigned long\nnilfs_sufile_segment_usages_in_block(const struct inode *sufile, __u64 curr,\n\t\t\t\t     __u64 max)\n{\n\treturn min_t(unsigned long,\n\t\t     nilfs_sufile_segment_usages_per_block(sufile) -\n\t\t     nilfs_sufile_get_offset(sufile, curr),\n\t\t     max - curr + 1);\n}"
  },
  {
    "function_name": "nilfs_sufile_get_offset",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/sufile.c",
    "lines": "66-71",
    "snippet": "static unsigned long\nnilfs_sufile_get_offset(const struct inode *sufile, __u64 segnum)\n{\n\t__u64 t = segnum + NILFS_MDT(sufile)->mi_first_entry_offset;\n\treturn do_div(t, nilfs_sufile_segment_usages_per_block(sufile));\n}",
    "includes": [
      "#include \"sufile.h\"",
      "#include \"mdt.h\"",
      "#include <linux/nilfs2_fs.h>",
      "#include <linux/errno.h>",
      "#include <linux/buffer_head.h>",
      "#include <linux/string.h>",
      "#include <linux/fs.h>",
      "#include <linux/kernel.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "do_div",
          "args": [
            "t",
            "nilfs_sufile_segment_usages_per_block(sufile)"
          ],
          "line": 70
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "nilfs_sufile_segment_usages_per_block",
          "args": [
            "sufile"
          ],
          "line": 70
        },
        "resolved": true,
        "details": {
          "function_name": "nilfs_sufile_segment_usages_per_block",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/sufile.c",
          "lines": "52-56",
          "snippet": "static inline unsigned long\nnilfs_sufile_segment_usages_per_block(const struct inode *sufile)\n{\n\treturn NILFS_MDT(sufile)->mi_entries_per_block;\n}",
          "includes": [
            "#include \"sufile.h\"",
            "#include \"mdt.h\"",
            "#include <linux/nilfs2_fs.h>",
            "#include <linux/errno.h>",
            "#include <linux/buffer_head.h>",
            "#include <linux/string.h>",
            "#include <linux/fs.h>",
            "#include <linux/kernel.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sufile.h\"\n#include \"mdt.h\"\n#include <linux/nilfs2_fs.h>\n#include <linux/errno.h>\n#include <linux/buffer_head.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n#include <linux/kernel.h>\n\nstatic inline unsigned long\nnilfs_sufile_segment_usages_per_block(const struct inode *sufile)\n{\n\treturn NILFS_MDT(sufile)->mi_entries_per_block;\n}"
        }
      },
      {
        "call_info": {
          "callee": "NILFS_MDT",
          "args": [
            "sufile"
          ],
          "line": 69
        },
        "resolved": true,
        "details": {
          "function_name": "NILFS_MDT",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/mdt.h",
          "lines": "69-72",
          "snippet": "static inline struct nilfs_mdt_info *NILFS_MDT(const struct inode *inode)\n{\n\treturn inode->i_private;\n}",
          "includes": [
            "#include \"page.h\"",
            "#include \"nilfs.h\"",
            "#include <linux/blockgroup_lock.h>",
            "#include <linux/buffer_head.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"page.h\"\n#include \"nilfs.h\"\n#include <linux/blockgroup_lock.h>\n#include <linux/buffer_head.h>\n\nstatic inline struct nilfs_mdt_info *NILFS_MDT(const struct inode *inode)\n{\n\treturn inode->i_private;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"sufile.h\"\n#include \"mdt.h\"\n#include <linux/nilfs2_fs.h>\n#include <linux/errno.h>\n#include <linux/buffer_head.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n#include <linux/kernel.h>\n\nstatic unsigned long\nnilfs_sufile_get_offset(const struct inode *sufile, __u64 segnum)\n{\n\t__u64 t = segnum + NILFS_MDT(sufile)->mi_first_entry_offset;\n\treturn do_div(t, nilfs_sufile_segment_usages_per_block(sufile));\n}"
  },
  {
    "function_name": "nilfs_sufile_get_blkoff",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/sufile.c",
    "lines": "58-64",
    "snippet": "static unsigned long\nnilfs_sufile_get_blkoff(const struct inode *sufile, __u64 segnum)\n{\n\t__u64 t = segnum + NILFS_MDT(sufile)->mi_first_entry_offset;\n\tdo_div(t, nilfs_sufile_segment_usages_per_block(sufile));\n\treturn (unsigned long)t;\n}",
    "includes": [
      "#include \"sufile.h\"",
      "#include \"mdt.h\"",
      "#include <linux/nilfs2_fs.h>",
      "#include <linux/errno.h>",
      "#include <linux/buffer_head.h>",
      "#include <linux/string.h>",
      "#include <linux/fs.h>",
      "#include <linux/kernel.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "do_div",
          "args": [
            "t",
            "nilfs_sufile_segment_usages_per_block(sufile)"
          ],
          "line": 62
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "nilfs_sufile_segment_usages_per_block",
          "args": [
            "sufile"
          ],
          "line": 62
        },
        "resolved": true,
        "details": {
          "function_name": "nilfs_sufile_segment_usages_per_block",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/sufile.c",
          "lines": "52-56",
          "snippet": "static inline unsigned long\nnilfs_sufile_segment_usages_per_block(const struct inode *sufile)\n{\n\treturn NILFS_MDT(sufile)->mi_entries_per_block;\n}",
          "includes": [
            "#include \"sufile.h\"",
            "#include \"mdt.h\"",
            "#include <linux/nilfs2_fs.h>",
            "#include <linux/errno.h>",
            "#include <linux/buffer_head.h>",
            "#include <linux/string.h>",
            "#include <linux/fs.h>",
            "#include <linux/kernel.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sufile.h\"\n#include \"mdt.h\"\n#include <linux/nilfs2_fs.h>\n#include <linux/errno.h>\n#include <linux/buffer_head.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n#include <linux/kernel.h>\n\nstatic inline unsigned long\nnilfs_sufile_segment_usages_per_block(const struct inode *sufile)\n{\n\treturn NILFS_MDT(sufile)->mi_entries_per_block;\n}"
        }
      },
      {
        "call_info": {
          "callee": "NILFS_MDT",
          "args": [
            "sufile"
          ],
          "line": 61
        },
        "resolved": true,
        "details": {
          "function_name": "NILFS_MDT",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/mdt.h",
          "lines": "69-72",
          "snippet": "static inline struct nilfs_mdt_info *NILFS_MDT(const struct inode *inode)\n{\n\treturn inode->i_private;\n}",
          "includes": [
            "#include \"page.h\"",
            "#include \"nilfs.h\"",
            "#include <linux/blockgroup_lock.h>",
            "#include <linux/buffer_head.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"page.h\"\n#include \"nilfs.h\"\n#include <linux/blockgroup_lock.h>\n#include <linux/buffer_head.h>\n\nstatic inline struct nilfs_mdt_info *NILFS_MDT(const struct inode *inode)\n{\n\treturn inode->i_private;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"sufile.h\"\n#include \"mdt.h\"\n#include <linux/nilfs2_fs.h>\n#include <linux/errno.h>\n#include <linux/buffer_head.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n#include <linux/kernel.h>\n\nstatic unsigned long\nnilfs_sufile_get_blkoff(const struct inode *sufile, __u64 segnum)\n{\n\t__u64 t = segnum + NILFS_MDT(sufile)->mi_first_entry_offset;\n\tdo_div(t, nilfs_sufile_segment_usages_per_block(sufile));\n\treturn (unsigned long)t;\n}"
  },
  {
    "function_name": "nilfs_sufile_segment_usages_per_block",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/sufile.c",
    "lines": "52-56",
    "snippet": "static inline unsigned long\nnilfs_sufile_segment_usages_per_block(const struct inode *sufile)\n{\n\treturn NILFS_MDT(sufile)->mi_entries_per_block;\n}",
    "includes": [
      "#include \"sufile.h\"",
      "#include \"mdt.h\"",
      "#include <linux/nilfs2_fs.h>",
      "#include <linux/errno.h>",
      "#include <linux/buffer_head.h>",
      "#include <linux/string.h>",
      "#include <linux/fs.h>",
      "#include <linux/kernel.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "NILFS_MDT",
          "args": [
            "sufile"
          ],
          "line": 55
        },
        "resolved": true,
        "details": {
          "function_name": "NILFS_MDT",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/mdt.h",
          "lines": "69-72",
          "snippet": "static inline struct nilfs_mdt_info *NILFS_MDT(const struct inode *inode)\n{\n\treturn inode->i_private;\n}",
          "includes": [
            "#include \"page.h\"",
            "#include \"nilfs.h\"",
            "#include <linux/blockgroup_lock.h>",
            "#include <linux/buffer_head.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"page.h\"\n#include \"nilfs.h\"\n#include <linux/blockgroup_lock.h>\n#include <linux/buffer_head.h>\n\nstatic inline struct nilfs_mdt_info *NILFS_MDT(const struct inode *inode)\n{\n\treturn inode->i_private;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"sufile.h\"\n#include \"mdt.h\"\n#include <linux/nilfs2_fs.h>\n#include <linux/errno.h>\n#include <linux/buffer_head.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n#include <linux/kernel.h>\n\nstatic inline unsigned long\nnilfs_sufile_segment_usages_per_block(const struct inode *sufile)\n{\n\treturn NILFS_MDT(sufile)->mi_entries_per_block;\n}"
  },
  {
    "function_name": "NILFS_SUI",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/sufile.c",
    "lines": "47-50",
    "snippet": "static inline struct nilfs_sufile_info *NILFS_SUI(struct inode *sufile)\n{\n\treturn (struct nilfs_sufile_info *)NILFS_MDT(sufile);\n}",
    "includes": [
      "#include \"sufile.h\"",
      "#include \"mdt.h\"",
      "#include <linux/nilfs2_fs.h>",
      "#include <linux/errno.h>",
      "#include <linux/buffer_head.h>",
      "#include <linux/string.h>",
      "#include <linux/fs.h>",
      "#include <linux/kernel.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "NILFS_MDT",
          "args": [
            "sufile"
          ],
          "line": 49
        },
        "resolved": true,
        "details": {
          "function_name": "NILFS_MDT",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/mdt.h",
          "lines": "69-72",
          "snippet": "static inline struct nilfs_mdt_info *NILFS_MDT(const struct inode *inode)\n{\n\treturn inode->i_private;\n}",
          "includes": [
            "#include \"page.h\"",
            "#include \"nilfs.h\"",
            "#include <linux/blockgroup_lock.h>",
            "#include <linux/buffer_head.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"page.h\"\n#include \"nilfs.h\"\n#include <linux/blockgroup_lock.h>\n#include <linux/buffer_head.h>\n\nstatic inline struct nilfs_mdt_info *NILFS_MDT(const struct inode *inode)\n{\n\treturn inode->i_private;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"sufile.h\"\n#include \"mdt.h\"\n#include <linux/nilfs2_fs.h>\n#include <linux/errno.h>\n#include <linux/buffer_head.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n#include <linux/kernel.h>\n\nstatic inline struct nilfs_sufile_info *NILFS_SUI(struct inode *sufile)\n{\n\treturn (struct nilfs_sufile_info *)NILFS_MDT(sufile);\n}"
  }
]