[
  {
    "function_name": "befs_find_brun_dblindirect",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/befs/datastream.c",
    "lines": "413-529",
    "snippet": "static int\nbefs_find_brun_dblindirect(struct super_block *sb,\n\t\t\t   befs_data_stream * data, befs_blocknr_t blockno,\n\t\t\t   befs_block_run * run)\n{\n\tint dblindir_indx;\n\tint indir_indx;\n\tint offset;\n\tint dbl_which_block;\n\tint which_block;\n\tint dbl_block_indx;\n\tint block_indx;\n\toff_t dblindir_leftover;\n\tbefs_blocknr_t blockno_at_run_start;\n\tstruct buffer_head *dbl_indir_block;\n\tstruct buffer_head *indir_block;\n\tbefs_block_run indir_run;\n\tbefs_disk_inode_addr *iaddr_array = NULL;\n\tbefs_sb_info *befs_sb = BEFS_SB(sb);\n\n\tbefs_blocknr_t indir_start_blk =\n\t    data->max_indirect_range >> befs_sb->block_shift;\n\n\toff_t dbl_indir_off = blockno - indir_start_blk;\n\n\t/* number of data blocks mapped by each of the iaddrs in\n\t * the indirect block pointed to by the double indirect block\n\t */\n\tsize_t iblklen = BEFS_DBLINDIR_BRUN_LEN;\n\n\t/* number of data blocks mapped by each of the iaddrs in\n\t * the double indirect block\n\t */\n\tsize_t diblklen = iblklen * befs_iaddrs_per_block(sb)\n\t    * BEFS_DBLINDIR_BRUN_LEN;\n\n\tbefs_debug(sb, \"---> %s find %lu\", __func__, (unsigned long)blockno);\n\n\t/* First, discover which of the double_indir->indir blocks\n\t * contains pos. Then figure out how much of pos that\n\t * accounted for. Then discover which of the iaddrs in\n\t * the indirect block contains pos.\n\t */\n\n\tdblindir_indx = dbl_indir_off / diblklen;\n\tdblindir_leftover = dbl_indir_off % diblklen;\n\tindir_indx = dblindir_leftover / diblklen;\n\n\t/* Read double indirect block */\n\tdbl_which_block = dblindir_indx / befs_iaddrs_per_block(sb);\n\tif (dbl_which_block > data->double_indirect.len) {\n\t\tbefs_error(sb, \"The double-indirect index calculated by \"\n\t\t\t   \"%s, %d, is outside the range \"\n\t\t\t   \"of the double-indirect block\", __func__,\n\t\t\t   dblindir_indx);\n\t\treturn BEFS_ERR;\n\t}\n\n\tdbl_indir_block =\n\t    befs_bread(sb, iaddr2blockno(sb, &data->double_indirect) +\n\t\t\t\t\tdbl_which_block);\n\tif (dbl_indir_block == NULL) {\n\t\tbefs_error(sb, \"%s couldn't read the \"\n\t\t\t   \"double-indirect block at blockno %lu\", __func__,\n\t\t\t   (unsigned long)\n\t\t\t   iaddr2blockno(sb, &data->double_indirect) +\n\t\t\t   dbl_which_block);\n\t\tbrelse(dbl_indir_block);\n\t\treturn BEFS_ERR;\n\t}\n\n\tdbl_block_indx =\n\t    dblindir_indx - (dbl_which_block * befs_iaddrs_per_block(sb));\n\tiaddr_array = (befs_disk_inode_addr *) dbl_indir_block->b_data;\n\tindir_run = fsrun_to_cpu(sb, iaddr_array[dbl_block_indx]);\n\tbrelse(dbl_indir_block);\n\tiaddr_array = NULL;\n\n\t/* Read indirect block */\n\twhich_block = indir_indx / befs_iaddrs_per_block(sb);\n\tif (which_block > indir_run.len) {\n\t\tbefs_error(sb, \"The indirect index calculated by \"\n\t\t\t   \"%s, %d, is outside the range \"\n\t\t\t   \"of the indirect block\", __func__, indir_indx);\n\t\treturn BEFS_ERR;\n\t}\n\n\tindir_block =\n\t    befs_bread(sb, iaddr2blockno(sb, &indir_run) + which_block);\n\tif (indir_block == NULL) {\n\t\tbefs_error(sb, \"%s couldn't read the indirect block \"\n\t\t\t   \"at blockno %lu\", __func__, (unsigned long)\n\t\t\t   iaddr2blockno(sb, &indir_run) + which_block);\n\t\tbrelse(indir_block);\n\t\treturn BEFS_ERR;\n\t}\n\n\tblock_indx = indir_indx - (which_block * befs_iaddrs_per_block(sb));\n\tiaddr_array = (befs_disk_inode_addr *) indir_block->b_data;\n\t*run = fsrun_to_cpu(sb, iaddr_array[block_indx]);\n\tbrelse(indir_block);\n\tiaddr_array = NULL;\n\n\tblockno_at_run_start = indir_start_blk;\n\tblockno_at_run_start += diblklen * dblindir_indx;\n\tblockno_at_run_start += iblklen * indir_indx;\n\toffset = blockno - blockno_at_run_start;\n\n\trun->start += offset;\n\trun->len -= offset;\n\n\tbefs_debug(sb, \"Found file block %lu in double_indirect[%d][%d],\"\n\t\t   \" double_indirect_leftover = %lu\", (unsigned long)\n\t\t   blockno, dblindir_indx, indir_indx, dblindir_leftover);\n\n\treturn BEFS_OK;\n}",
    "includes": [
      "#include \"io.h\"",
      "#include \"datastream.h\"",
      "#include \"befs.h\"",
      "#include <linux/string.h>",
      "#include <linux/buffer_head.h>",
      "#include <linux/kernel.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static int befs_find_brun_direct(struct super_block *sb,\n\t\t\t\t befs_data_stream * data,\n\t\t\t\t befs_blocknr_t blockno, befs_block_run * run);",
      "static int befs_find_brun_indirect(struct super_block *sb,\n\t\t\t\t   befs_data_stream * data,\n\t\t\t\t   befs_blocknr_t blockno,\n\t\t\t\t   befs_block_run * run);",
      "static int befs_find_brun_dblindirect(struct super_block *sb,\n\t\t\t\t      befs_data_stream * data,\n\t\t\t\t      befs_blocknr_t blockno,\n\t\t\t\t      befs_block_run * run);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "befs_debug",
          "args": [
            "sb",
            "\"Found file block %lu in double_indirect[%d][%d],\"\n\t\t   \" double_indirect_leftover = %lu\"",
            "(unsigned long)\n\t\t   blockno",
            "dblindir_indx",
            "indir_indx",
            "dblindir_leftover"
          ],
          "line": 524
        },
        "resolved": true,
        "details": {
          "function_name": "befs_debug",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/befs/debug.c",
          "lines": "53-67",
          "snippet": "void\nbefs_debug(const struct super_block *sb, const char *fmt, ...)\n{\n#ifdef CONFIG_BEFS_DEBUG\n\n\tstruct va_format vaf;\n\tva_list args;\n\tva_start(args, fmt);\n\tvaf.fmt = fmt;\n\tvaf.va = &args;\n\tpr_debug(\"(%s): %pV\\n\", sb->s_id, &vaf);\n\tva_end(args);\n\n#endif\t\t\t\t//CONFIG_BEFS_DEBUG\n}",
          "includes": [
            "#include \"befs.h\"",
            "#include <linux/slab.h>",
            "#include <linux/fs.h>",
            "#include <linux/kernel.h>",
            "#include <linux/spinlock.h>",
            "#include <linux/string.h>",
            "#include <stdarg.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"befs.h\"\n#include <linux/slab.h>\n#include <linux/fs.h>\n#include <linux/kernel.h>\n#include <linux/spinlock.h>\n#include <linux/string.h>\n#include <stdarg.h>\n\nvoid\nbefs_debug(const struct super_block *sb, const char *fmt, ...)\n{\n#ifdef CONFIG_BEFS_DEBUG\n\n\tstruct va_format vaf;\n\tva_list args;\n\tva_start(args, fmt);\n\tvaf.fmt = fmt;\n\tvaf.va = &args;\n\tpr_debug(\"(%s): %pV\\n\", sb->s_id, &vaf);\n\tva_end(args);\n\n#endif\t\t\t\t//CONFIG_BEFS_DEBUG\n}"
        }
      },
      {
        "call_info": {
          "callee": "brelse",
          "args": [
            "indir_block"
          ],
          "line": 513
        },
        "resolved": true,
        "details": {
          "function_name": "__brelse",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/buffer.c",
          "lines": "1177-1184",
          "snippet": "void __brelse(struct buffer_head * buf)\n{\n\tif (atomic_read(&buf->b_count)) {\n\t\tput_bh(buf);\n\t\treturn;\n\t}\n\tWARN(1, KERN_ERR \"VFS: brelse: Trying to free free buffer\\n\");\n}",
          "includes": [
            "#include <trace/events/block.h>",
            "#include <linux/bit_spinlock.h>",
            "#include <linux/mpage.h>",
            "#include <linux/bitops.h>",
            "#include <linux/cpu.h>",
            "#include <linux/notifier.h>",
            "#include <linux/bio.h>",
            "#include <linux/task_io_accounting_ops.h>",
            "#include <linux/buffer_head.h>",
            "#include <linux/suspend.h>",
            "#include <linux/hash.h>",
            "#include <linux/writeback.h>",
            "#include <linux/export.h>",
            "#include <linux/highmem.h>",
            "#include <linux/quotaops.h>",
            "#include <linux/file.h>",
            "#include <linux/blkdev.h>",
            "#include <linux/capability.h>",
            "#include <linux/slab.h>",
            "#include <linux/percpu.h>",
            "#include <linux/mm.h>",
            "#include <linux/fs.h>",
            "#include <linux/syscalls.h>",
            "#include <linux/kernel.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <trace/events/block.h>\n#include <linux/bit_spinlock.h>\n#include <linux/mpage.h>\n#include <linux/bitops.h>\n#include <linux/cpu.h>\n#include <linux/notifier.h>\n#include <linux/bio.h>\n#include <linux/task_io_accounting_ops.h>\n#include <linux/buffer_head.h>\n#include <linux/suspend.h>\n#include <linux/hash.h>\n#include <linux/writeback.h>\n#include <linux/export.h>\n#include <linux/highmem.h>\n#include <linux/quotaops.h>\n#include <linux/file.h>\n#include <linux/blkdev.h>\n#include <linux/capability.h>\n#include <linux/slab.h>\n#include <linux/percpu.h>\n#include <linux/mm.h>\n#include <linux/fs.h>\n#include <linux/syscalls.h>\n#include <linux/kernel.h>\n\nvoid __brelse(struct buffer_head * buf)\n{\n\tif (atomic_read(&buf->b_count)) {\n\t\tput_bh(buf);\n\t\treturn;\n\t}\n\tWARN(1, KERN_ERR \"VFS: brelse: Trying to free free buffer\\n\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "fsrun_to_cpu",
          "args": [
            "sb",
            "iaddr_array[block_indx]"
          ],
          "line": 512
        },
        "resolved": true,
        "details": {
          "function_name": "fsrun_to_cpu",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/befs/endian.h",
          "lines": "70-85",
          "snippet": "static inline befs_block_run\nfsrun_to_cpu(const struct super_block *sb, befs_disk_block_run n)\n{\n\tbefs_block_run run;\n\n\tif (BEFS_SB(sb)->byte_order == BEFS_BYTESEX_LE) {\n\t\trun.allocation_group = le32_to_cpu((__force __le32)n.allocation_group);\n\t\trun.start = le16_to_cpu((__force __le16)n.start);\n\t\trun.len = le16_to_cpu((__force __le16)n.len);\n\t} else {\n\t\trun.allocation_group = be32_to_cpu((__force __be32)n.allocation_group);\n\t\trun.start = be16_to_cpu((__force __be16)n.start);\n\t\trun.len = be16_to_cpu((__force __be16)n.len);\n\t}\n\treturn run;\n}",
          "includes": [
            "#include <asm/byteorder.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <asm/byteorder.h>\n\nstatic inline befs_block_run\nfsrun_to_cpu(const struct super_block *sb, befs_disk_block_run n)\n{\n\tbefs_block_run run;\n\n\tif (BEFS_SB(sb)->byte_order == BEFS_BYTESEX_LE) {\n\t\trun.allocation_group = le32_to_cpu((__force __le32)n.allocation_group);\n\t\trun.start = le16_to_cpu((__force __le16)n.start);\n\t\trun.len = le16_to_cpu((__force __le16)n.len);\n\t} else {\n\t\trun.allocation_group = be32_to_cpu((__force __be32)n.allocation_group);\n\t\trun.start = be16_to_cpu((__force __be16)n.start);\n\t\trun.len = be16_to_cpu((__force __be16)n.len);\n\t}\n\treturn run;\n}"
        }
      },
      {
        "call_info": {
          "callee": "befs_iaddrs_per_block",
          "args": [
            "sb"
          ],
          "line": 510
        },
        "resolved": true,
        "details": {
          "function_name": "befs_iaddrs_per_block",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/befs/befs.h",
          "lines": "139-143",
          "snippet": "static inline unsigned int\nbefs_iaddrs_per_block(struct super_block *sb)\n{\n\treturn BEFS_SB(sb)->block_size / sizeof (befs_disk_inode_addr);\n}",
          "includes": [
            "#include \"endian.h\"",
            "#include \"befs_fs_types.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"endian.h\"\n#include \"befs_fs_types.h\"\n\nstatic inline unsigned int\nbefs_iaddrs_per_block(struct super_block *sb)\n{\n\treturn BEFS_SB(sb)->block_size / sizeof (befs_disk_inode_addr);\n}"
        }
      },
      {
        "call_info": {
          "callee": "befs_error",
          "args": [
            "sb",
            "\"%s couldn't read the indirect block \"\n\t\t\t   \"at blockno %lu\"",
            "__func__",
            "(unsigned long)\n\t\t\t   iaddr2blockno(sb, &indir_run) + which_block"
          ],
          "line": 503
        },
        "resolved": true,
        "details": {
          "function_name": "befs_error",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/befs/debug.c",
          "lines": "27-38",
          "snippet": "void\nbefs_error(const struct super_block *sb, const char *fmt, ...)\n{\n\tstruct va_format vaf;\n\tva_list args;\n\n\tva_start(args, fmt);\n\tvaf.fmt = fmt;\n\tvaf.va = &args;\n\tpr_err(\"(%s): %pV\\n\", sb->s_id, &vaf);\n\tva_end(args);\n}",
          "includes": [
            "#include \"befs.h\"",
            "#include <linux/slab.h>",
            "#include <linux/fs.h>",
            "#include <linux/kernel.h>",
            "#include <linux/spinlock.h>",
            "#include <linux/string.h>",
            "#include <stdarg.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"befs.h\"\n#include <linux/slab.h>\n#include <linux/fs.h>\n#include <linux/kernel.h>\n#include <linux/spinlock.h>\n#include <linux/string.h>\n#include <stdarg.h>\n\nvoid\nbefs_error(const struct super_block *sb, const char *fmt, ...)\n{\n\tstruct va_format vaf;\n\tva_list args;\n\n\tva_start(args, fmt);\n\tvaf.fmt = fmt;\n\tvaf.va = &args;\n\tpr_err(\"(%s): %pV\\n\", sb->s_id, &vaf);\n\tva_end(args);\n}"
        }
      },
      {
        "call_info": {
          "callee": "iaddr2blockno",
          "args": [
            "sb",
            "&indir_run"
          ],
          "line": 505
        },
        "resolved": true,
        "details": {
          "function_name": "iaddr2blockno",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/befs/befs.h",
          "lines": "120-125",
          "snippet": "static inline befs_blocknr_t\niaddr2blockno(struct super_block *sb, befs_inode_addr * iaddr)\n{\n\treturn ((iaddr->allocation_group << BEFS_SB(sb)->ag_shift) +\n\t\tiaddr->start);\n}",
          "includes": [
            "#include \"endian.h\"",
            "#include \"befs_fs_types.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"endian.h\"\n#include \"befs_fs_types.h\"\n\nstatic inline befs_blocknr_t\niaddr2blockno(struct super_block *sb, befs_inode_addr * iaddr)\n{\n\treturn ((iaddr->allocation_group << BEFS_SB(sb)->ag_shift) +\n\t\tiaddr->start);\n}"
        }
      },
      {
        "call_info": {
          "callee": "befs_bread",
          "args": [
            "sb",
            "iaddr2blockno(sb, &indir_run) + which_block"
          ],
          "line": 501
        },
        "resolved": true,
        "details": {
          "function_name": "befs_bread",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/befs/io.c",
          "lines": "63-85",
          "snippet": "struct buffer_head *\nbefs_bread(struct super_block *sb, befs_blocknr_t block)\n{\n\tstruct buffer_head *bh = NULL;\n\n\tbefs_debug(sb, \"---> Enter %s %lu\", __func__, (unsigned long)block);\n\n\tbh = sb_bread(sb, block);\n\n\tif (bh == NULL) {\n\t\tbefs_error(sb, \"Failed to read block %lu\",\n\t\t\t   (unsigned long)block);\n\t\tgoto error;\n\t}\n\n\tbefs_debug(sb, \"<--- %s\", __func__);\n\n\treturn bh;\n\n      error:\n\tbefs_debug(sb, \"<--- %s ERROR\", __func__);\n\treturn NULL;\n}",
          "includes": [
            "#include \"io.h\"",
            "#include \"befs.h\"",
            "#include <linux/buffer_head.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"io.h\"\n#include \"befs.h\"\n#include <linux/buffer_head.h>\n\nstruct buffer_head *\nbefs_bread(struct super_block *sb, befs_blocknr_t block)\n{\n\tstruct buffer_head *bh = NULL;\n\n\tbefs_debug(sb, \"---> Enter %s %lu\", __func__, (unsigned long)block);\n\n\tbh = sb_bread(sb, block);\n\n\tif (bh == NULL) {\n\t\tbefs_error(sb, \"Failed to read block %lu\",\n\t\t\t   (unsigned long)block);\n\t\tgoto error;\n\t}\n\n\tbefs_debug(sb, \"<--- %s\", __func__);\n\n\treturn bh;\n\n      error:\n\tbefs_debug(sb, \"<--- %s ERROR\", __func__);\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "BEFS_SB",
          "args": [
            "sb"
          ],
          "line": 431
        },
        "resolved": true,
        "details": {
          "function_name": "BEFS_SB",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/befs/befs.h",
          "lines": "108-112",
          "snippet": "static inline befs_sb_info *\nBEFS_SB(const struct super_block *super)\n{\n\treturn (befs_sb_info *) super->s_fs_info;\n}",
          "includes": [
            "#include \"endian.h\"",
            "#include \"befs_fs_types.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"endian.h\"\n#include \"befs_fs_types.h\"\n\nstatic inline befs_sb_info *\nBEFS_SB(const struct super_block *super)\n{\n\treturn (befs_sb_info *) super->s_fs_info;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"io.h\"\n#include \"datastream.h\"\n#include \"befs.h\"\n#include <linux/string.h>\n#include <linux/buffer_head.h>\n#include <linux/kernel.h>\n\nstatic int befs_find_brun_direct(struct super_block *sb,\n\t\t\t\t befs_data_stream * data,\n\t\t\t\t befs_blocknr_t blockno, befs_block_run * run);\nstatic int befs_find_brun_indirect(struct super_block *sb,\n\t\t\t\t   befs_data_stream * data,\n\t\t\t\t   befs_blocknr_t blockno,\n\t\t\t\t   befs_block_run * run);\nstatic int befs_find_brun_dblindirect(struct super_block *sb,\n\t\t\t\t      befs_data_stream * data,\n\t\t\t\t      befs_blocknr_t blockno,\n\t\t\t\t      befs_block_run * run);\n\nstatic int\nbefs_find_brun_dblindirect(struct super_block *sb,\n\t\t\t   befs_data_stream * data, befs_blocknr_t blockno,\n\t\t\t   befs_block_run * run)\n{\n\tint dblindir_indx;\n\tint indir_indx;\n\tint offset;\n\tint dbl_which_block;\n\tint which_block;\n\tint dbl_block_indx;\n\tint block_indx;\n\toff_t dblindir_leftover;\n\tbefs_blocknr_t blockno_at_run_start;\n\tstruct buffer_head *dbl_indir_block;\n\tstruct buffer_head *indir_block;\n\tbefs_block_run indir_run;\n\tbefs_disk_inode_addr *iaddr_array = NULL;\n\tbefs_sb_info *befs_sb = BEFS_SB(sb);\n\n\tbefs_blocknr_t indir_start_blk =\n\t    data->max_indirect_range >> befs_sb->block_shift;\n\n\toff_t dbl_indir_off = blockno - indir_start_blk;\n\n\t/* number of data blocks mapped by each of the iaddrs in\n\t * the indirect block pointed to by the double indirect block\n\t */\n\tsize_t iblklen = BEFS_DBLINDIR_BRUN_LEN;\n\n\t/* number of data blocks mapped by each of the iaddrs in\n\t * the double indirect block\n\t */\n\tsize_t diblklen = iblklen * befs_iaddrs_per_block(sb)\n\t    * BEFS_DBLINDIR_BRUN_LEN;\n\n\tbefs_debug(sb, \"---> %s find %lu\", __func__, (unsigned long)blockno);\n\n\t/* First, discover which of the double_indir->indir blocks\n\t * contains pos. Then figure out how much of pos that\n\t * accounted for. Then discover which of the iaddrs in\n\t * the indirect block contains pos.\n\t */\n\n\tdblindir_indx = dbl_indir_off / diblklen;\n\tdblindir_leftover = dbl_indir_off % diblklen;\n\tindir_indx = dblindir_leftover / diblklen;\n\n\t/* Read double indirect block */\n\tdbl_which_block = dblindir_indx / befs_iaddrs_per_block(sb);\n\tif (dbl_which_block > data->double_indirect.len) {\n\t\tbefs_error(sb, \"The double-indirect index calculated by \"\n\t\t\t   \"%s, %d, is outside the range \"\n\t\t\t   \"of the double-indirect block\", __func__,\n\t\t\t   dblindir_indx);\n\t\treturn BEFS_ERR;\n\t}\n\n\tdbl_indir_block =\n\t    befs_bread(sb, iaddr2blockno(sb, &data->double_indirect) +\n\t\t\t\t\tdbl_which_block);\n\tif (dbl_indir_block == NULL) {\n\t\tbefs_error(sb, \"%s couldn't read the \"\n\t\t\t   \"double-indirect block at blockno %lu\", __func__,\n\t\t\t   (unsigned long)\n\t\t\t   iaddr2blockno(sb, &data->double_indirect) +\n\t\t\t   dbl_which_block);\n\t\tbrelse(dbl_indir_block);\n\t\treturn BEFS_ERR;\n\t}\n\n\tdbl_block_indx =\n\t    dblindir_indx - (dbl_which_block * befs_iaddrs_per_block(sb));\n\tiaddr_array = (befs_disk_inode_addr *) dbl_indir_block->b_data;\n\tindir_run = fsrun_to_cpu(sb, iaddr_array[dbl_block_indx]);\n\tbrelse(dbl_indir_block);\n\tiaddr_array = NULL;\n\n\t/* Read indirect block */\n\twhich_block = indir_indx / befs_iaddrs_per_block(sb);\n\tif (which_block > indir_run.len) {\n\t\tbefs_error(sb, \"The indirect index calculated by \"\n\t\t\t   \"%s, %d, is outside the range \"\n\t\t\t   \"of the indirect block\", __func__, indir_indx);\n\t\treturn BEFS_ERR;\n\t}\n\n\tindir_block =\n\t    befs_bread(sb, iaddr2blockno(sb, &indir_run) + which_block);\n\tif (indir_block == NULL) {\n\t\tbefs_error(sb, \"%s couldn't read the indirect block \"\n\t\t\t   \"at blockno %lu\", __func__, (unsigned long)\n\t\t\t   iaddr2blockno(sb, &indir_run) + which_block);\n\t\tbrelse(indir_block);\n\t\treturn BEFS_ERR;\n\t}\n\n\tblock_indx = indir_indx - (which_block * befs_iaddrs_per_block(sb));\n\tiaddr_array = (befs_disk_inode_addr *) indir_block->b_data;\n\t*run = fsrun_to_cpu(sb, iaddr_array[block_indx]);\n\tbrelse(indir_block);\n\tiaddr_array = NULL;\n\n\tblockno_at_run_start = indir_start_blk;\n\tblockno_at_run_start += diblklen * dblindir_indx;\n\tblockno_at_run_start += iblklen * indir_indx;\n\toffset = blockno - blockno_at_run_start;\n\n\trun->start += offset;\n\trun->len -= offset;\n\n\tbefs_debug(sb, \"Found file block %lu in double_indirect[%d][%d],\"\n\t\t   \" double_indirect_leftover = %lu\", (unsigned long)\n\t\t   blockno, dblindir_indx, indir_indx, dblindir_leftover);\n\n\treturn BEFS_OK;\n}"
  },
  {
    "function_name": "befs_find_brun_indirect",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/befs/datastream.c",
    "lines": "305-370",
    "snippet": "static int\nbefs_find_brun_indirect(struct super_block *sb,\n\t\t\tbefs_data_stream * data, befs_blocknr_t blockno,\n\t\t\tbefs_block_run * run)\n{\n\tint i, j;\n\tbefs_blocknr_t sum = 0;\n\tbefs_blocknr_t indir_start_blk;\n\tbefs_blocknr_t search_blk;\n\tstruct buffer_head *indirblock;\n\tbefs_disk_block_run *array;\n\n\tbefs_block_run indirect = data->indirect;\n\tbefs_blocknr_t indirblockno = iaddr2blockno(sb, &indirect);\n\tint arraylen = befs_iaddrs_per_block(sb);\n\n\tbefs_debug(sb, \"---> %s, find %lu\", __func__, (unsigned long)blockno);\n\n\tindir_start_blk = data->max_direct_range >> BEFS_SB(sb)->block_shift;\n\tsearch_blk = blockno - indir_start_blk;\n\n\t/* Examine blocks of the indirect run one at a time */\n\tfor (i = 0; i < indirect.len; i++) {\n\t\tindirblock = befs_bread(sb, indirblockno + i);\n\t\tif (indirblock == NULL) {\n\t\t\tbefs_debug(sb, \"---> %s failed to read \"\n\t\t\t\t   \"disk block %lu from the indirect brun\",\n\t\t\t\t   __func__, (unsigned long)indirblockno + i);\n\t\t\treturn BEFS_ERR;\n\t\t}\n\n\t\tarray = (befs_disk_block_run *) indirblock->b_data;\n\n\t\tfor (j = 0; j < arraylen; ++j) {\n\t\t\tint len = fs16_to_cpu(sb, array[j].len);\n\n\t\t\tif (search_blk >= sum && search_blk < sum + len) {\n\t\t\t\tint offset = search_blk - sum;\n\t\t\t\trun->allocation_group =\n\t\t\t\t    fs32_to_cpu(sb, array[j].allocation_group);\n\t\t\t\trun->start =\n\t\t\t\t    fs16_to_cpu(sb, array[j].start) + offset;\n\t\t\t\trun->len =\n\t\t\t\t    fs16_to_cpu(sb, array[j].len) - offset;\n\n\t\t\t\tbrelse(indirblock);\n\t\t\t\tbefs_debug(sb,\n\t\t\t\t\t   \"<--- %s found file block \"\n\t\t\t\t\t   \"%lu at indirect[%d]\", __func__,\n\t\t\t\t\t   (unsigned long)blockno,\n\t\t\t\t\t   j + (i * arraylen));\n\t\t\t\treturn BEFS_OK;\n\t\t\t}\n\t\t\tsum += len;\n\t\t}\n\n\t\tbrelse(indirblock);\n\t}\n\n\t/* Only fallthrough is an error */\n\tbefs_error(sb, \"BeFS: %s failed to find \"\n\t\t   \"file block %lu\", __func__, (unsigned long)blockno);\n\n\tbefs_debug(sb, \"<--- %s ERROR\", __func__);\n\treturn BEFS_ERR;\n}",
    "includes": [
      "#include \"io.h\"",
      "#include \"datastream.h\"",
      "#include \"befs.h\"",
      "#include <linux/string.h>",
      "#include <linux/buffer_head.h>",
      "#include <linux/kernel.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static int befs_find_brun_direct(struct super_block *sb,\n\t\t\t\t befs_data_stream * data,\n\t\t\t\t befs_blocknr_t blockno, befs_block_run * run);",
      "static int befs_find_brun_indirect(struct super_block *sb,\n\t\t\t\t   befs_data_stream * data,\n\t\t\t\t   befs_blocknr_t blockno,\n\t\t\t\t   befs_block_run * run);",
      "static int befs_find_brun_dblindirect(struct super_block *sb,\n\t\t\t\t      befs_data_stream * data,\n\t\t\t\t      befs_blocknr_t blockno,\n\t\t\t\t      befs_block_run * run);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "befs_debug",
          "args": [
            "sb",
            "\"<--- %s ERROR\"",
            "__func__"
          ],
          "line": 368
        },
        "resolved": true,
        "details": {
          "function_name": "befs_debug",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/befs/debug.c",
          "lines": "53-67",
          "snippet": "void\nbefs_debug(const struct super_block *sb, const char *fmt, ...)\n{\n#ifdef CONFIG_BEFS_DEBUG\n\n\tstruct va_format vaf;\n\tva_list args;\n\tva_start(args, fmt);\n\tvaf.fmt = fmt;\n\tvaf.va = &args;\n\tpr_debug(\"(%s): %pV\\n\", sb->s_id, &vaf);\n\tva_end(args);\n\n#endif\t\t\t\t//CONFIG_BEFS_DEBUG\n}",
          "includes": [
            "#include \"befs.h\"",
            "#include <linux/slab.h>",
            "#include <linux/fs.h>",
            "#include <linux/kernel.h>",
            "#include <linux/spinlock.h>",
            "#include <linux/string.h>",
            "#include <stdarg.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"befs.h\"\n#include <linux/slab.h>\n#include <linux/fs.h>\n#include <linux/kernel.h>\n#include <linux/spinlock.h>\n#include <linux/string.h>\n#include <stdarg.h>\n\nvoid\nbefs_debug(const struct super_block *sb, const char *fmt, ...)\n{\n#ifdef CONFIG_BEFS_DEBUG\n\n\tstruct va_format vaf;\n\tva_list args;\n\tva_start(args, fmt);\n\tvaf.fmt = fmt;\n\tvaf.va = &args;\n\tpr_debug(\"(%s): %pV\\n\", sb->s_id, &vaf);\n\tva_end(args);\n\n#endif\t\t\t\t//CONFIG_BEFS_DEBUG\n}"
        }
      },
      {
        "call_info": {
          "callee": "befs_error",
          "args": [
            "sb",
            "\"BeFS: %s failed to find \"\n\t\t   \"file block %lu\"",
            "__func__",
            "(unsigned long)blockno"
          ],
          "line": 365
        },
        "resolved": true,
        "details": {
          "function_name": "befs_error",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/befs/debug.c",
          "lines": "27-38",
          "snippet": "void\nbefs_error(const struct super_block *sb, const char *fmt, ...)\n{\n\tstruct va_format vaf;\n\tva_list args;\n\n\tva_start(args, fmt);\n\tvaf.fmt = fmt;\n\tvaf.va = &args;\n\tpr_err(\"(%s): %pV\\n\", sb->s_id, &vaf);\n\tva_end(args);\n}",
          "includes": [
            "#include \"befs.h\"",
            "#include <linux/slab.h>",
            "#include <linux/fs.h>",
            "#include <linux/kernel.h>",
            "#include <linux/spinlock.h>",
            "#include <linux/string.h>",
            "#include <stdarg.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"befs.h\"\n#include <linux/slab.h>\n#include <linux/fs.h>\n#include <linux/kernel.h>\n#include <linux/spinlock.h>\n#include <linux/string.h>\n#include <stdarg.h>\n\nvoid\nbefs_error(const struct super_block *sb, const char *fmt, ...)\n{\n\tstruct va_format vaf;\n\tva_list args;\n\n\tva_start(args, fmt);\n\tvaf.fmt = fmt;\n\tvaf.va = &args;\n\tpr_err(\"(%s): %pV\\n\", sb->s_id, &vaf);\n\tva_end(args);\n}"
        }
      },
      {
        "call_info": {
          "callee": "brelse",
          "args": [
            "indirblock"
          ],
          "line": 361
        },
        "resolved": true,
        "details": {
          "function_name": "__brelse",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/buffer.c",
          "lines": "1177-1184",
          "snippet": "void __brelse(struct buffer_head * buf)\n{\n\tif (atomic_read(&buf->b_count)) {\n\t\tput_bh(buf);\n\t\treturn;\n\t}\n\tWARN(1, KERN_ERR \"VFS: brelse: Trying to free free buffer\\n\");\n}",
          "includes": [
            "#include <trace/events/block.h>",
            "#include <linux/bit_spinlock.h>",
            "#include <linux/mpage.h>",
            "#include <linux/bitops.h>",
            "#include <linux/cpu.h>",
            "#include <linux/notifier.h>",
            "#include <linux/bio.h>",
            "#include <linux/task_io_accounting_ops.h>",
            "#include <linux/buffer_head.h>",
            "#include <linux/suspend.h>",
            "#include <linux/hash.h>",
            "#include <linux/writeback.h>",
            "#include <linux/export.h>",
            "#include <linux/highmem.h>",
            "#include <linux/quotaops.h>",
            "#include <linux/file.h>",
            "#include <linux/blkdev.h>",
            "#include <linux/capability.h>",
            "#include <linux/slab.h>",
            "#include <linux/percpu.h>",
            "#include <linux/mm.h>",
            "#include <linux/fs.h>",
            "#include <linux/syscalls.h>",
            "#include <linux/kernel.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <trace/events/block.h>\n#include <linux/bit_spinlock.h>\n#include <linux/mpage.h>\n#include <linux/bitops.h>\n#include <linux/cpu.h>\n#include <linux/notifier.h>\n#include <linux/bio.h>\n#include <linux/task_io_accounting_ops.h>\n#include <linux/buffer_head.h>\n#include <linux/suspend.h>\n#include <linux/hash.h>\n#include <linux/writeback.h>\n#include <linux/export.h>\n#include <linux/highmem.h>\n#include <linux/quotaops.h>\n#include <linux/file.h>\n#include <linux/blkdev.h>\n#include <linux/capability.h>\n#include <linux/slab.h>\n#include <linux/percpu.h>\n#include <linux/mm.h>\n#include <linux/fs.h>\n#include <linux/syscalls.h>\n#include <linux/kernel.h>\n\nvoid __brelse(struct buffer_head * buf)\n{\n\tif (atomic_read(&buf->b_count)) {\n\t\tput_bh(buf);\n\t\treturn;\n\t}\n\tWARN(1, KERN_ERR \"VFS: brelse: Trying to free free buffer\\n\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "fs16_to_cpu",
          "args": [
            "sb",
            "array[j].len"
          ],
          "line": 348
        },
        "resolved": true,
        "details": {
          "function_name": "fs16_to_cpu",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/befs/endian.h",
          "lines": "50-57",
          "snippet": "static inline u16\nfs16_to_cpu(const struct super_block *sb, fs16 n)\n{\n\tif (BEFS_SB(sb)->byte_order == BEFS_BYTESEX_LE)\n\t\treturn le16_to_cpu((__force __le16)n);\n\telse\n\t\treturn be16_to_cpu((__force __be16)n);\n}",
          "includes": [
            "#include <asm/byteorder.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <asm/byteorder.h>\n\nstatic inline u16\nfs16_to_cpu(const struct super_block *sb, fs16 n)\n{\n\tif (BEFS_SB(sb)->byte_order == BEFS_BYTESEX_LE)\n\t\treturn le16_to_cpu((__force __le16)n);\n\telse\n\t\treturn be16_to_cpu((__force __be16)n);\n}"
        }
      },
      {
        "call_info": {
          "callee": "fs32_to_cpu",
          "args": [
            "sb",
            "array[j].allocation_group"
          ],
          "line": 344
        },
        "resolved": true,
        "details": {
          "function_name": "fs32_to_cpu",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/befs/endian.h",
          "lines": "32-39",
          "snippet": "static inline u32\nfs32_to_cpu(const struct super_block *sb, fs32 n)\n{\n\tif (BEFS_SB(sb)->byte_order == BEFS_BYTESEX_LE)\n\t\treturn le32_to_cpu((__force __le32)n);\n\telse\n\t\treturn be32_to_cpu((__force __be32)n);\n}",
          "includes": [
            "#include <asm/byteorder.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <asm/byteorder.h>\n\nstatic inline u32\nfs32_to_cpu(const struct super_block *sb, fs32 n)\n{\n\tif (BEFS_SB(sb)->byte_order == BEFS_BYTESEX_LE)\n\t\treturn le32_to_cpu((__force __le32)n);\n\telse\n\t\treturn be32_to_cpu((__force __be32)n);\n}"
        }
      },
      {
        "call_info": {
          "callee": "befs_bread",
          "args": [
            "sb",
            "indirblockno + i"
          ],
          "line": 328
        },
        "resolved": true,
        "details": {
          "function_name": "befs_bread",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/befs/io.c",
          "lines": "63-85",
          "snippet": "struct buffer_head *\nbefs_bread(struct super_block *sb, befs_blocknr_t block)\n{\n\tstruct buffer_head *bh = NULL;\n\n\tbefs_debug(sb, \"---> Enter %s %lu\", __func__, (unsigned long)block);\n\n\tbh = sb_bread(sb, block);\n\n\tif (bh == NULL) {\n\t\tbefs_error(sb, \"Failed to read block %lu\",\n\t\t\t   (unsigned long)block);\n\t\tgoto error;\n\t}\n\n\tbefs_debug(sb, \"<--- %s\", __func__);\n\n\treturn bh;\n\n      error:\n\tbefs_debug(sb, \"<--- %s ERROR\", __func__);\n\treturn NULL;\n}",
          "includes": [
            "#include \"io.h\"",
            "#include \"befs.h\"",
            "#include <linux/buffer_head.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"io.h\"\n#include \"befs.h\"\n#include <linux/buffer_head.h>\n\nstruct buffer_head *\nbefs_bread(struct super_block *sb, befs_blocknr_t block)\n{\n\tstruct buffer_head *bh = NULL;\n\n\tbefs_debug(sb, \"---> Enter %s %lu\", __func__, (unsigned long)block);\n\n\tbh = sb_bread(sb, block);\n\n\tif (bh == NULL) {\n\t\tbefs_error(sb, \"Failed to read block %lu\",\n\t\t\t   (unsigned long)block);\n\t\tgoto error;\n\t}\n\n\tbefs_debug(sb, \"<--- %s\", __func__);\n\n\treturn bh;\n\n      error:\n\tbefs_debug(sb, \"<--- %s ERROR\", __func__);\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "BEFS_SB",
          "args": [
            "sb"
          ],
          "line": 323
        },
        "resolved": true,
        "details": {
          "function_name": "BEFS_SB",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/befs/befs.h",
          "lines": "108-112",
          "snippet": "static inline befs_sb_info *\nBEFS_SB(const struct super_block *super)\n{\n\treturn (befs_sb_info *) super->s_fs_info;\n}",
          "includes": [
            "#include \"endian.h\"",
            "#include \"befs_fs_types.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"endian.h\"\n#include \"befs_fs_types.h\"\n\nstatic inline befs_sb_info *\nBEFS_SB(const struct super_block *super)\n{\n\treturn (befs_sb_info *) super->s_fs_info;\n}"
        }
      },
      {
        "call_info": {
          "callee": "befs_iaddrs_per_block",
          "args": [
            "sb"
          ],
          "line": 319
        },
        "resolved": true,
        "details": {
          "function_name": "befs_iaddrs_per_block",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/befs/befs.h",
          "lines": "139-143",
          "snippet": "static inline unsigned int\nbefs_iaddrs_per_block(struct super_block *sb)\n{\n\treturn BEFS_SB(sb)->block_size / sizeof (befs_disk_inode_addr);\n}",
          "includes": [
            "#include \"endian.h\"",
            "#include \"befs_fs_types.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"endian.h\"\n#include \"befs_fs_types.h\"\n\nstatic inline unsigned int\nbefs_iaddrs_per_block(struct super_block *sb)\n{\n\treturn BEFS_SB(sb)->block_size / sizeof (befs_disk_inode_addr);\n}"
        }
      },
      {
        "call_info": {
          "callee": "iaddr2blockno",
          "args": [
            "sb",
            "&indirect"
          ],
          "line": 318
        },
        "resolved": true,
        "details": {
          "function_name": "iaddr2blockno",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/befs/befs.h",
          "lines": "120-125",
          "snippet": "static inline befs_blocknr_t\niaddr2blockno(struct super_block *sb, befs_inode_addr * iaddr)\n{\n\treturn ((iaddr->allocation_group << BEFS_SB(sb)->ag_shift) +\n\t\tiaddr->start);\n}",
          "includes": [
            "#include \"endian.h\"",
            "#include \"befs_fs_types.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"endian.h\"\n#include \"befs_fs_types.h\"\n\nstatic inline befs_blocknr_t\niaddr2blockno(struct super_block *sb, befs_inode_addr * iaddr)\n{\n\treturn ((iaddr->allocation_group << BEFS_SB(sb)->ag_shift) +\n\t\tiaddr->start);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"io.h\"\n#include \"datastream.h\"\n#include \"befs.h\"\n#include <linux/string.h>\n#include <linux/buffer_head.h>\n#include <linux/kernel.h>\n\nstatic int befs_find_brun_direct(struct super_block *sb,\n\t\t\t\t befs_data_stream * data,\n\t\t\t\t befs_blocknr_t blockno, befs_block_run * run);\nstatic int befs_find_brun_indirect(struct super_block *sb,\n\t\t\t\t   befs_data_stream * data,\n\t\t\t\t   befs_blocknr_t blockno,\n\t\t\t\t   befs_block_run * run);\nstatic int befs_find_brun_dblindirect(struct super_block *sb,\n\t\t\t\t      befs_data_stream * data,\n\t\t\t\t      befs_blocknr_t blockno,\n\t\t\t\t      befs_block_run * run);\n\nstatic int\nbefs_find_brun_indirect(struct super_block *sb,\n\t\t\tbefs_data_stream * data, befs_blocknr_t blockno,\n\t\t\tbefs_block_run * run)\n{\n\tint i, j;\n\tbefs_blocknr_t sum = 0;\n\tbefs_blocknr_t indir_start_blk;\n\tbefs_blocknr_t search_blk;\n\tstruct buffer_head *indirblock;\n\tbefs_disk_block_run *array;\n\n\tbefs_block_run indirect = data->indirect;\n\tbefs_blocknr_t indirblockno = iaddr2blockno(sb, &indirect);\n\tint arraylen = befs_iaddrs_per_block(sb);\n\n\tbefs_debug(sb, \"---> %s, find %lu\", __func__, (unsigned long)blockno);\n\n\tindir_start_blk = data->max_direct_range >> BEFS_SB(sb)->block_shift;\n\tsearch_blk = blockno - indir_start_blk;\n\n\t/* Examine blocks of the indirect run one at a time */\n\tfor (i = 0; i < indirect.len; i++) {\n\t\tindirblock = befs_bread(sb, indirblockno + i);\n\t\tif (indirblock == NULL) {\n\t\t\tbefs_debug(sb, \"---> %s failed to read \"\n\t\t\t\t   \"disk block %lu from the indirect brun\",\n\t\t\t\t   __func__, (unsigned long)indirblockno + i);\n\t\t\treturn BEFS_ERR;\n\t\t}\n\n\t\tarray = (befs_disk_block_run *) indirblock->b_data;\n\n\t\tfor (j = 0; j < arraylen; ++j) {\n\t\t\tint len = fs16_to_cpu(sb, array[j].len);\n\n\t\t\tif (search_blk >= sum && search_blk < sum + len) {\n\t\t\t\tint offset = search_blk - sum;\n\t\t\t\trun->allocation_group =\n\t\t\t\t    fs32_to_cpu(sb, array[j].allocation_group);\n\t\t\t\trun->start =\n\t\t\t\t    fs16_to_cpu(sb, array[j].start) + offset;\n\t\t\t\trun->len =\n\t\t\t\t    fs16_to_cpu(sb, array[j].len) - offset;\n\n\t\t\t\tbrelse(indirblock);\n\t\t\t\tbefs_debug(sb,\n\t\t\t\t\t   \"<--- %s found file block \"\n\t\t\t\t\t   \"%lu at indirect[%d]\", __func__,\n\t\t\t\t\t   (unsigned long)blockno,\n\t\t\t\t\t   j + (i * arraylen));\n\t\t\t\treturn BEFS_OK;\n\t\t\t}\n\t\t\tsum += len;\n\t\t}\n\n\t\tbrelse(indirblock);\n\t}\n\n\t/* Only fallthrough is an error */\n\tbefs_error(sb, \"BeFS: %s failed to find \"\n\t\t   \"file block %lu\", __func__, (unsigned long)blockno);\n\n\tbefs_debug(sb, \"<--- %s ERROR\", __func__);\n\treturn BEFS_ERR;\n}"
  },
  {
    "function_name": "befs_find_brun_direct",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/befs/datastream.c",
    "lines": "245-280",
    "snippet": "static int\nbefs_find_brun_direct(struct super_block *sb, befs_data_stream * data,\n\t\t      befs_blocknr_t blockno, befs_block_run * run)\n{\n\tint i;\n\tbefs_block_run *array = data->direct;\n\tbefs_blocknr_t sum;\n\tbefs_blocknr_t max_block =\n\t    data->max_direct_range >> BEFS_SB(sb)->block_shift;\n\n\tbefs_debug(sb, \"---> %s, find %lu\", __func__, (unsigned long)blockno);\n\n\tif (blockno > max_block) {\n\t\tbefs_error(sb, \"%s passed block outside of direct region\",\n\t\t\t   __func__);\n\t\treturn BEFS_ERR;\n\t}\n\n\tfor (i = 0, sum = 0; i < BEFS_NUM_DIRECT_BLOCKS;\n\t     sum += array[i].len, i++) {\n\t\tif (blockno >= sum && blockno < sum + (array[i].len)) {\n\t\t\tint offset = blockno - sum;\n\t\t\trun->allocation_group = array[i].allocation_group;\n\t\t\trun->start = array[i].start + offset;\n\t\t\trun->len = array[i].len - offset;\n\n\t\t\tbefs_debug(sb, \"---> %s, \"\n\t\t\t\t   \"found %lu at direct[%d]\", __func__,\n\t\t\t\t   (unsigned long)blockno, i);\n\t\t\treturn BEFS_OK;\n\t\t}\n\t}\n\n\tbefs_debug(sb, \"---> %s ERROR\", __func__);\n\treturn BEFS_ERR;\n}",
    "includes": [
      "#include \"io.h\"",
      "#include \"datastream.h\"",
      "#include \"befs.h\"",
      "#include <linux/string.h>",
      "#include <linux/buffer_head.h>",
      "#include <linux/kernel.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static int befs_find_brun_direct(struct super_block *sb,\n\t\t\t\t befs_data_stream * data,\n\t\t\t\t befs_blocknr_t blockno, befs_block_run * run);",
      "static int befs_find_brun_indirect(struct super_block *sb,\n\t\t\t\t   befs_data_stream * data,\n\t\t\t\t   befs_blocknr_t blockno,\n\t\t\t\t   befs_block_run * run);",
      "static int befs_find_brun_dblindirect(struct super_block *sb,\n\t\t\t\t      befs_data_stream * data,\n\t\t\t\t      befs_blocknr_t blockno,\n\t\t\t\t      befs_block_run * run);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "befs_debug",
          "args": [
            "sb",
            "\"---> %s ERROR\"",
            "__func__"
          ],
          "line": 278
        },
        "resolved": true,
        "details": {
          "function_name": "befs_debug",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/befs/debug.c",
          "lines": "53-67",
          "snippet": "void\nbefs_debug(const struct super_block *sb, const char *fmt, ...)\n{\n#ifdef CONFIG_BEFS_DEBUG\n\n\tstruct va_format vaf;\n\tva_list args;\n\tva_start(args, fmt);\n\tvaf.fmt = fmt;\n\tvaf.va = &args;\n\tpr_debug(\"(%s): %pV\\n\", sb->s_id, &vaf);\n\tva_end(args);\n\n#endif\t\t\t\t//CONFIG_BEFS_DEBUG\n}",
          "includes": [
            "#include \"befs.h\"",
            "#include <linux/slab.h>",
            "#include <linux/fs.h>",
            "#include <linux/kernel.h>",
            "#include <linux/spinlock.h>",
            "#include <linux/string.h>",
            "#include <stdarg.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"befs.h\"\n#include <linux/slab.h>\n#include <linux/fs.h>\n#include <linux/kernel.h>\n#include <linux/spinlock.h>\n#include <linux/string.h>\n#include <stdarg.h>\n\nvoid\nbefs_debug(const struct super_block *sb, const char *fmt, ...)\n{\n#ifdef CONFIG_BEFS_DEBUG\n\n\tstruct va_format vaf;\n\tva_list args;\n\tva_start(args, fmt);\n\tvaf.fmt = fmt;\n\tvaf.va = &args;\n\tpr_debug(\"(%s): %pV\\n\", sb->s_id, &vaf);\n\tva_end(args);\n\n#endif\t\t\t\t//CONFIG_BEFS_DEBUG\n}"
        }
      },
      {
        "call_info": {
          "callee": "befs_error",
          "args": [
            "sb",
            "\"%s passed block outside of direct region\"",
            "__func__"
          ],
          "line": 258
        },
        "resolved": true,
        "details": {
          "function_name": "befs_error",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/befs/debug.c",
          "lines": "27-38",
          "snippet": "void\nbefs_error(const struct super_block *sb, const char *fmt, ...)\n{\n\tstruct va_format vaf;\n\tva_list args;\n\n\tva_start(args, fmt);\n\tvaf.fmt = fmt;\n\tvaf.va = &args;\n\tpr_err(\"(%s): %pV\\n\", sb->s_id, &vaf);\n\tva_end(args);\n}",
          "includes": [
            "#include \"befs.h\"",
            "#include <linux/slab.h>",
            "#include <linux/fs.h>",
            "#include <linux/kernel.h>",
            "#include <linux/spinlock.h>",
            "#include <linux/string.h>",
            "#include <stdarg.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"befs.h\"\n#include <linux/slab.h>\n#include <linux/fs.h>\n#include <linux/kernel.h>\n#include <linux/spinlock.h>\n#include <linux/string.h>\n#include <stdarg.h>\n\nvoid\nbefs_error(const struct super_block *sb, const char *fmt, ...)\n{\n\tstruct va_format vaf;\n\tva_list args;\n\n\tva_start(args, fmt);\n\tvaf.fmt = fmt;\n\tvaf.va = &args;\n\tpr_err(\"(%s): %pV\\n\", sb->s_id, &vaf);\n\tva_end(args);\n}"
        }
      },
      {
        "call_info": {
          "callee": "BEFS_SB",
          "args": [
            "sb"
          ],
          "line": 253
        },
        "resolved": true,
        "details": {
          "function_name": "BEFS_SB",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/befs/befs.h",
          "lines": "108-112",
          "snippet": "static inline befs_sb_info *\nBEFS_SB(const struct super_block *super)\n{\n\treturn (befs_sb_info *) super->s_fs_info;\n}",
          "includes": [
            "#include \"endian.h\"",
            "#include \"befs_fs_types.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"endian.h\"\n#include \"befs_fs_types.h\"\n\nstatic inline befs_sb_info *\nBEFS_SB(const struct super_block *super)\n{\n\treturn (befs_sb_info *) super->s_fs_info;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"io.h\"\n#include \"datastream.h\"\n#include \"befs.h\"\n#include <linux/string.h>\n#include <linux/buffer_head.h>\n#include <linux/kernel.h>\n\nstatic int befs_find_brun_direct(struct super_block *sb,\n\t\t\t\t befs_data_stream * data,\n\t\t\t\t befs_blocknr_t blockno, befs_block_run * run);\nstatic int befs_find_brun_indirect(struct super_block *sb,\n\t\t\t\t   befs_data_stream * data,\n\t\t\t\t   befs_blocknr_t blockno,\n\t\t\t\t   befs_block_run * run);\nstatic int befs_find_brun_dblindirect(struct super_block *sb,\n\t\t\t\t      befs_data_stream * data,\n\t\t\t\t      befs_blocknr_t blockno,\n\t\t\t\t      befs_block_run * run);\n\nstatic int\nbefs_find_brun_direct(struct super_block *sb, befs_data_stream * data,\n\t\t      befs_blocknr_t blockno, befs_block_run * run)\n{\n\tint i;\n\tbefs_block_run *array = data->direct;\n\tbefs_blocknr_t sum;\n\tbefs_blocknr_t max_block =\n\t    data->max_direct_range >> BEFS_SB(sb)->block_shift;\n\n\tbefs_debug(sb, \"---> %s, find %lu\", __func__, (unsigned long)blockno);\n\n\tif (blockno > max_block) {\n\t\tbefs_error(sb, \"%s passed block outside of direct region\",\n\t\t\t   __func__);\n\t\treturn BEFS_ERR;\n\t}\n\n\tfor (i = 0, sum = 0; i < BEFS_NUM_DIRECT_BLOCKS;\n\t     sum += array[i].len, i++) {\n\t\tif (blockno >= sum && blockno < sum + (array[i].len)) {\n\t\t\tint offset = blockno - sum;\n\t\t\trun->allocation_group = array[i].allocation_group;\n\t\t\trun->start = array[i].start + offset;\n\t\t\trun->len = array[i].len - offset;\n\n\t\t\tbefs_debug(sb, \"---> %s, \"\n\t\t\t\t   \"found %lu at direct[%d]\", __func__,\n\t\t\t\t   (unsigned long)blockno, i);\n\t\t\treturn BEFS_OK;\n\t\t}\n\t}\n\n\tbefs_debug(sb, \"---> %s ERROR\", __func__);\n\treturn BEFS_ERR;\n}"
  },
  {
    "function_name": "befs_count_blocks",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/befs/datastream.c",
    "lines": "165-213",
    "snippet": "befs_blocknr_t\nbefs_count_blocks(struct super_block * sb, befs_data_stream * ds)\n{\n\tbefs_blocknr_t blocks;\n\tbefs_blocknr_t datablocks;\t/* File data blocks */\n\tbefs_blocknr_t metablocks;\t/* FS metadata blocks */\n\tbefs_sb_info *befs_sb = BEFS_SB(sb);\n\n\tbefs_debug(sb, \"---> %s\", __func__);\n\n\tdatablocks = ds->size >> befs_sb->block_shift;\n\tif (ds->size & (befs_sb->block_size - 1))\n\t\tdatablocks += 1;\n\n\tmetablocks = 1;\t\t/* Start with 1 block for inode */\n\n\t/* Size of indirect block */\n\tif (ds->size > ds->max_direct_range)\n\t\tmetablocks += ds->indirect.len;\n\n\t/*\n\t   Double indir block, plus all the indirect blocks it mapps\n\t   In the double-indirect range, all block runs of data are\n\t   BEFS_DBLINDIR_BRUN_LEN blocks long. Therefore, we know \n\t   how many data block runs are in the double-indirect region,\n\t   and from that we know how many indirect blocks it takes to\n\t   map them. We assume that the indirect blocks are also\n\t   BEFS_DBLINDIR_BRUN_LEN blocks long.\n\t */\n\tif (ds->size > ds->max_indirect_range && ds->max_indirect_range != 0) {\n\t\tuint dbl_bytes;\n\t\tuint dbl_bruns;\n\t\tuint indirblocks;\n\n\t\tdbl_bytes =\n\t\t    ds->max_double_indirect_range - ds->max_indirect_range;\n\t\tdbl_bruns =\n\t\t    dbl_bytes / (befs_sb->block_size * BEFS_DBLINDIR_BRUN_LEN);\n\t\tindirblocks = dbl_bruns / befs_iaddrs_per_block(sb);\n\n\t\tmetablocks += ds->double_indirect.len;\n\t\tmetablocks += indirblocks;\n\t}\n\n\tblocks = datablocks + metablocks;\n\tbefs_debug(sb, \"<--- %s %u blocks\", __func__, (unsigned int)blocks);\n\n\treturn blocks;\n}",
    "includes": [
      "#include \"io.h\"",
      "#include \"datastream.h\"",
      "#include \"befs.h\"",
      "#include <linux/string.h>",
      "#include <linux/buffer_head.h>",
      "#include <linux/kernel.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "befs_debug",
          "args": [
            "sb",
            "\"<--- %s %u blocks\"",
            "__func__",
            "(unsigned int)blocks"
          ],
          "line": 210
        },
        "resolved": true,
        "details": {
          "function_name": "befs_debug",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/befs/debug.c",
          "lines": "53-67",
          "snippet": "void\nbefs_debug(const struct super_block *sb, const char *fmt, ...)\n{\n#ifdef CONFIG_BEFS_DEBUG\n\n\tstruct va_format vaf;\n\tva_list args;\n\tva_start(args, fmt);\n\tvaf.fmt = fmt;\n\tvaf.va = &args;\n\tpr_debug(\"(%s): %pV\\n\", sb->s_id, &vaf);\n\tva_end(args);\n\n#endif\t\t\t\t//CONFIG_BEFS_DEBUG\n}",
          "includes": [
            "#include \"befs.h\"",
            "#include <linux/slab.h>",
            "#include <linux/fs.h>",
            "#include <linux/kernel.h>",
            "#include <linux/spinlock.h>",
            "#include <linux/string.h>",
            "#include <stdarg.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"befs.h\"\n#include <linux/slab.h>\n#include <linux/fs.h>\n#include <linux/kernel.h>\n#include <linux/spinlock.h>\n#include <linux/string.h>\n#include <stdarg.h>\n\nvoid\nbefs_debug(const struct super_block *sb, const char *fmt, ...)\n{\n#ifdef CONFIG_BEFS_DEBUG\n\n\tstruct va_format vaf;\n\tva_list args;\n\tva_start(args, fmt);\n\tvaf.fmt = fmt;\n\tvaf.va = &args;\n\tpr_debug(\"(%s): %pV\\n\", sb->s_id, &vaf);\n\tva_end(args);\n\n#endif\t\t\t\t//CONFIG_BEFS_DEBUG\n}"
        }
      },
      {
        "call_info": {
          "callee": "befs_iaddrs_per_block",
          "args": [
            "sb"
          ],
          "line": 203
        },
        "resolved": true,
        "details": {
          "function_name": "befs_iaddrs_per_block",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/befs/befs.h",
          "lines": "139-143",
          "snippet": "static inline unsigned int\nbefs_iaddrs_per_block(struct super_block *sb)\n{\n\treturn BEFS_SB(sb)->block_size / sizeof (befs_disk_inode_addr);\n}",
          "includes": [
            "#include \"endian.h\"",
            "#include \"befs_fs_types.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"endian.h\"\n#include \"befs_fs_types.h\"\n\nstatic inline unsigned int\nbefs_iaddrs_per_block(struct super_block *sb)\n{\n\treturn BEFS_SB(sb)->block_size / sizeof (befs_disk_inode_addr);\n}"
        }
      },
      {
        "call_info": {
          "callee": "BEFS_SB",
          "args": [
            "sb"
          ],
          "line": 171
        },
        "resolved": true,
        "details": {
          "function_name": "BEFS_SB",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/befs/befs.h",
          "lines": "108-112",
          "snippet": "static inline befs_sb_info *\nBEFS_SB(const struct super_block *super)\n{\n\treturn (befs_sb_info *) super->s_fs_info;\n}",
          "includes": [
            "#include \"endian.h\"",
            "#include \"befs_fs_types.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"endian.h\"\n#include \"befs_fs_types.h\"\n\nstatic inline befs_sb_info *\nBEFS_SB(const struct super_block *super)\n{\n\treturn (befs_sb_info *) super->s_fs_info;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"io.h\"\n#include \"datastream.h\"\n#include \"befs.h\"\n#include <linux/string.h>\n#include <linux/buffer_head.h>\n#include <linux/kernel.h>\n\nbefs_blocknr_t\nbefs_count_blocks(struct super_block * sb, befs_data_stream * ds)\n{\n\tbefs_blocknr_t blocks;\n\tbefs_blocknr_t datablocks;\t/* File data blocks */\n\tbefs_blocknr_t metablocks;\t/* FS metadata blocks */\n\tbefs_sb_info *befs_sb = BEFS_SB(sb);\n\n\tbefs_debug(sb, \"---> %s\", __func__);\n\n\tdatablocks = ds->size >> befs_sb->block_shift;\n\tif (ds->size & (befs_sb->block_size - 1))\n\t\tdatablocks += 1;\n\n\tmetablocks = 1;\t\t/* Start with 1 block for inode */\n\n\t/* Size of indirect block */\n\tif (ds->size > ds->max_direct_range)\n\t\tmetablocks += ds->indirect.len;\n\n\t/*\n\t   Double indir block, plus all the indirect blocks it mapps\n\t   In the double-indirect range, all block runs of data are\n\t   BEFS_DBLINDIR_BRUN_LEN blocks long. Therefore, we know \n\t   how many data block runs are in the double-indirect region,\n\t   and from that we know how many indirect blocks it takes to\n\t   map them. We assume that the indirect blocks are also\n\t   BEFS_DBLINDIR_BRUN_LEN blocks long.\n\t */\n\tif (ds->size > ds->max_indirect_range && ds->max_indirect_range != 0) {\n\t\tuint dbl_bytes;\n\t\tuint dbl_bruns;\n\t\tuint indirblocks;\n\n\t\tdbl_bytes =\n\t\t    ds->max_double_indirect_range - ds->max_indirect_range;\n\t\tdbl_bruns =\n\t\t    dbl_bytes / (befs_sb->block_size * BEFS_DBLINDIR_BRUN_LEN);\n\t\tindirblocks = dbl_bruns / befs_iaddrs_per_block(sb);\n\n\t\tmetablocks += ds->double_indirect.len;\n\t\tmetablocks += indirblocks;\n\t}\n\n\tblocks = datablocks + metablocks;\n\tbefs_debug(sb, \"<--- %s %u blocks\", __func__, (unsigned int)blocks);\n\n\treturn blocks;\n}"
  },
  {
    "function_name": "befs_read_lsymlink",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/befs/datastream.c",
    "lines": "124-152",
    "snippet": "size_t\nbefs_read_lsymlink(struct super_block * sb, befs_data_stream * ds, void *buff,\n\t\t   befs_off_t len)\n{\n\tbefs_off_t bytes_read = 0;\t/* bytes readed */\n\tu16 plen;\n\tstruct buffer_head *bh = NULL;\n\tbefs_debug(sb, \"---> %s length: %llu\", __func__, len);\n\n\twhile (bytes_read < len) {\n\t\tbh = befs_read_datastream(sb, ds, bytes_read, NULL);\n\t\tif (!bh) {\n\t\t\tbefs_error(sb, \"BeFS: Error reading datastream block \"\n\t\t\t\t   \"starting from %llu\", bytes_read);\n\t\t\tbefs_debug(sb, \"<--- %s ERROR\", __func__);\n\t\t\treturn bytes_read;\n\n\t\t}\n\t\tplen = ((bytes_read + BEFS_SB(sb)->block_size) < len) ?\n\t\t    BEFS_SB(sb)->block_size : len - bytes_read;\n\t\tmemcpy(buff + bytes_read, bh->b_data, plen);\n\t\tbrelse(bh);\n\t\tbytes_read += plen;\n\t}\n\n\tbefs_debug(sb, \"<--- %s read %u bytes\", __func__, (unsigned int)\n\t\t   bytes_read);\n\treturn bytes_read;\n}",
    "includes": [
      "#include \"io.h\"",
      "#include \"datastream.h\"",
      "#include \"befs.h\"",
      "#include <linux/string.h>",
      "#include <linux/buffer_head.h>",
      "#include <linux/kernel.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "befs_debug",
          "args": [
            "sb",
            "\"<--- %s read %u bytes\"",
            "__func__",
            "(unsigned int)\n\t\t   bytes_read"
          ],
          "line": 149
        },
        "resolved": true,
        "details": {
          "function_name": "befs_debug",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/befs/debug.c",
          "lines": "53-67",
          "snippet": "void\nbefs_debug(const struct super_block *sb, const char *fmt, ...)\n{\n#ifdef CONFIG_BEFS_DEBUG\n\n\tstruct va_format vaf;\n\tva_list args;\n\tva_start(args, fmt);\n\tvaf.fmt = fmt;\n\tvaf.va = &args;\n\tpr_debug(\"(%s): %pV\\n\", sb->s_id, &vaf);\n\tva_end(args);\n\n#endif\t\t\t\t//CONFIG_BEFS_DEBUG\n}",
          "includes": [
            "#include \"befs.h\"",
            "#include <linux/slab.h>",
            "#include <linux/fs.h>",
            "#include <linux/kernel.h>",
            "#include <linux/spinlock.h>",
            "#include <linux/string.h>",
            "#include <stdarg.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"befs.h\"\n#include <linux/slab.h>\n#include <linux/fs.h>\n#include <linux/kernel.h>\n#include <linux/spinlock.h>\n#include <linux/string.h>\n#include <stdarg.h>\n\nvoid\nbefs_debug(const struct super_block *sb, const char *fmt, ...)\n{\n#ifdef CONFIG_BEFS_DEBUG\n\n\tstruct va_format vaf;\n\tva_list args;\n\tva_start(args, fmt);\n\tvaf.fmt = fmt;\n\tvaf.va = &args;\n\tpr_debug(\"(%s): %pV\\n\", sb->s_id, &vaf);\n\tva_end(args);\n\n#endif\t\t\t\t//CONFIG_BEFS_DEBUG\n}"
        }
      },
      {
        "call_info": {
          "callee": "brelse",
          "args": [
            "bh"
          ],
          "line": 145
        },
        "resolved": true,
        "details": {
          "function_name": "__brelse",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/buffer.c",
          "lines": "1177-1184",
          "snippet": "void __brelse(struct buffer_head * buf)\n{\n\tif (atomic_read(&buf->b_count)) {\n\t\tput_bh(buf);\n\t\treturn;\n\t}\n\tWARN(1, KERN_ERR \"VFS: brelse: Trying to free free buffer\\n\");\n}",
          "includes": [
            "#include <trace/events/block.h>",
            "#include <linux/bit_spinlock.h>",
            "#include <linux/mpage.h>",
            "#include <linux/bitops.h>",
            "#include <linux/cpu.h>",
            "#include <linux/notifier.h>",
            "#include <linux/bio.h>",
            "#include <linux/task_io_accounting_ops.h>",
            "#include <linux/buffer_head.h>",
            "#include <linux/suspend.h>",
            "#include <linux/hash.h>",
            "#include <linux/writeback.h>",
            "#include <linux/export.h>",
            "#include <linux/highmem.h>",
            "#include <linux/quotaops.h>",
            "#include <linux/file.h>",
            "#include <linux/blkdev.h>",
            "#include <linux/capability.h>",
            "#include <linux/slab.h>",
            "#include <linux/percpu.h>",
            "#include <linux/mm.h>",
            "#include <linux/fs.h>",
            "#include <linux/syscalls.h>",
            "#include <linux/kernel.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <trace/events/block.h>\n#include <linux/bit_spinlock.h>\n#include <linux/mpage.h>\n#include <linux/bitops.h>\n#include <linux/cpu.h>\n#include <linux/notifier.h>\n#include <linux/bio.h>\n#include <linux/task_io_accounting_ops.h>\n#include <linux/buffer_head.h>\n#include <linux/suspend.h>\n#include <linux/hash.h>\n#include <linux/writeback.h>\n#include <linux/export.h>\n#include <linux/highmem.h>\n#include <linux/quotaops.h>\n#include <linux/file.h>\n#include <linux/blkdev.h>\n#include <linux/capability.h>\n#include <linux/slab.h>\n#include <linux/percpu.h>\n#include <linux/mm.h>\n#include <linux/fs.h>\n#include <linux/syscalls.h>\n#include <linux/kernel.h>\n\nvoid __brelse(struct buffer_head * buf)\n{\n\tif (atomic_read(&buf->b_count)) {\n\t\tput_bh(buf);\n\t\treturn;\n\t}\n\tWARN(1, KERN_ERR \"VFS: brelse: Trying to free free buffer\\n\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "memcpy",
          "args": [
            "buff + bytes_read",
            "bh->b_data",
            "plen"
          ],
          "line": 144
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "BEFS_SB",
          "args": [
            "sb"
          ],
          "line": 143
        },
        "resolved": true,
        "details": {
          "function_name": "BEFS_SB",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/befs/befs.h",
          "lines": "108-112",
          "snippet": "static inline befs_sb_info *\nBEFS_SB(const struct super_block *super)\n{\n\treturn (befs_sb_info *) super->s_fs_info;\n}",
          "includes": [
            "#include \"endian.h\"",
            "#include \"befs_fs_types.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"endian.h\"\n#include \"befs_fs_types.h\"\n\nstatic inline befs_sb_info *\nBEFS_SB(const struct super_block *super)\n{\n\treturn (befs_sb_info *) super->s_fs_info;\n}"
        }
      },
      {
        "call_info": {
          "callee": "befs_error",
          "args": [
            "sb",
            "\"BeFS: Error reading datastream block \"\n\t\t\t\t   \"starting from %llu\"",
            "bytes_read"
          ],
          "line": 136
        },
        "resolved": true,
        "details": {
          "function_name": "befs_error",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/befs/debug.c",
          "lines": "27-38",
          "snippet": "void\nbefs_error(const struct super_block *sb, const char *fmt, ...)\n{\n\tstruct va_format vaf;\n\tva_list args;\n\n\tva_start(args, fmt);\n\tvaf.fmt = fmt;\n\tvaf.va = &args;\n\tpr_err(\"(%s): %pV\\n\", sb->s_id, &vaf);\n\tva_end(args);\n}",
          "includes": [
            "#include \"befs.h\"",
            "#include <linux/slab.h>",
            "#include <linux/fs.h>",
            "#include <linux/kernel.h>",
            "#include <linux/spinlock.h>",
            "#include <linux/string.h>",
            "#include <stdarg.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"befs.h\"\n#include <linux/slab.h>\n#include <linux/fs.h>\n#include <linux/kernel.h>\n#include <linux/spinlock.h>\n#include <linux/string.h>\n#include <stdarg.h>\n\nvoid\nbefs_error(const struct super_block *sb, const char *fmt, ...)\n{\n\tstruct va_format vaf;\n\tva_list args;\n\n\tva_start(args, fmt);\n\tvaf.fmt = fmt;\n\tvaf.va = &args;\n\tpr_err(\"(%s): %pV\\n\", sb->s_id, &vaf);\n\tva_end(args);\n}"
        }
      },
      {
        "call_info": {
          "callee": "befs_read_datastream",
          "args": [
            "sb",
            "ds",
            "bytes_read",
            "NULL"
          ],
          "line": 134
        },
        "resolved": true,
        "details": {
          "function_name": "befs_read_datastream",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/befs/datastream.c",
          "lines": "47-76",
          "snippet": "struct buffer_head *\nbefs_read_datastream(struct super_block *sb, befs_data_stream * ds,\n\t\t     befs_off_t pos, uint * off)\n{\n\tstruct buffer_head *bh = NULL;\n\tbefs_block_run run;\n\tbefs_blocknr_t block;\t/* block coresponding to pos */\n\n\tbefs_debug(sb, \"---> %s %llu\", __func__, pos);\n\tblock = pos >> BEFS_SB(sb)->block_shift;\n\tif (off)\n\t\t*off = pos - (block << BEFS_SB(sb)->block_shift);\n\n\tif (befs_fblock2brun(sb, ds, block, &run) != BEFS_OK) {\n\t\tbefs_error(sb, \"BeFS: Error finding disk addr of block %lu\",\n\t\t\t   (unsigned long)block);\n\t\tbefs_debug(sb, \"<--- %s ERROR\", __func__);\n\t\treturn NULL;\n\t}\n\tbh = befs_bread_iaddr(sb, run);\n\tif (!bh) {\n\t\tbefs_error(sb, \"BeFS: Error reading block %lu from datastream\",\n\t\t\t   (unsigned long)block);\n\t\treturn NULL;\n\t}\n\n\tbefs_debug(sb, \"<--- %s read data, starting at %llu\", __func__, pos);\n\n\treturn bh;\n}",
          "includes": [
            "#include \"io.h\"",
            "#include \"datastream.h\"",
            "#include \"befs.h\"",
            "#include <linux/string.h>",
            "#include <linux/buffer_head.h>",
            "#include <linux/kernel.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int befs_find_brun_direct(struct super_block *sb,\n\t\t\t\t befs_data_stream * data,\n\t\t\t\t befs_blocknr_t blockno, befs_block_run * run);",
            "static int befs_find_brun_indirect(struct super_block *sb,\n\t\t\t\t   befs_data_stream * data,\n\t\t\t\t   befs_blocknr_t blockno,\n\t\t\t\t   befs_block_run * run);",
            "static int befs_find_brun_dblindirect(struct super_block *sb,\n\t\t\t\t      befs_data_stream * data,\n\t\t\t\t      befs_blocknr_t blockno,\n\t\t\t\t      befs_block_run * run);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"io.h\"\n#include \"datastream.h\"\n#include \"befs.h\"\n#include <linux/string.h>\n#include <linux/buffer_head.h>\n#include <linux/kernel.h>\n\nstatic int befs_find_brun_direct(struct super_block *sb,\n\t\t\t\t befs_data_stream * data,\n\t\t\t\t befs_blocknr_t blockno, befs_block_run * run);\nstatic int befs_find_brun_indirect(struct super_block *sb,\n\t\t\t\t   befs_data_stream * data,\n\t\t\t\t   befs_blocknr_t blockno,\n\t\t\t\t   befs_block_run * run);\nstatic int befs_find_brun_dblindirect(struct super_block *sb,\n\t\t\t\t      befs_data_stream * data,\n\t\t\t\t      befs_blocknr_t blockno,\n\t\t\t\t      befs_block_run * run);\n\nstruct buffer_head *\nbefs_read_datastream(struct super_block *sb, befs_data_stream * ds,\n\t\t     befs_off_t pos, uint * off)\n{\n\tstruct buffer_head *bh = NULL;\n\tbefs_block_run run;\n\tbefs_blocknr_t block;\t/* block coresponding to pos */\n\n\tbefs_debug(sb, \"---> %s %llu\", __func__, pos);\n\tblock = pos >> BEFS_SB(sb)->block_shift;\n\tif (off)\n\t\t*off = pos - (block << BEFS_SB(sb)->block_shift);\n\n\tif (befs_fblock2brun(sb, ds, block, &run) != BEFS_OK) {\n\t\tbefs_error(sb, \"BeFS: Error finding disk addr of block %lu\",\n\t\t\t   (unsigned long)block);\n\t\tbefs_debug(sb, \"<--- %s ERROR\", __func__);\n\t\treturn NULL;\n\t}\n\tbh = befs_bread_iaddr(sb, run);\n\tif (!bh) {\n\t\tbefs_error(sb, \"BeFS: Error reading block %lu from datastream\",\n\t\t\t   (unsigned long)block);\n\t\treturn NULL;\n\t}\n\n\tbefs_debug(sb, \"<--- %s read data, starting at %llu\", __func__, pos);\n\n\treturn bh;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"io.h\"\n#include \"datastream.h\"\n#include \"befs.h\"\n#include <linux/string.h>\n#include <linux/buffer_head.h>\n#include <linux/kernel.h>\n\nsize_t\nbefs_read_lsymlink(struct super_block * sb, befs_data_stream * ds, void *buff,\n\t\t   befs_off_t len)\n{\n\tbefs_off_t bytes_read = 0;\t/* bytes readed */\n\tu16 plen;\n\tstruct buffer_head *bh = NULL;\n\tbefs_debug(sb, \"---> %s length: %llu\", __func__, len);\n\n\twhile (bytes_read < len) {\n\t\tbh = befs_read_datastream(sb, ds, bytes_read, NULL);\n\t\tif (!bh) {\n\t\t\tbefs_error(sb, \"BeFS: Error reading datastream block \"\n\t\t\t\t   \"starting from %llu\", bytes_read);\n\t\t\tbefs_debug(sb, \"<--- %s ERROR\", __func__);\n\t\t\treturn bytes_read;\n\n\t\t}\n\t\tplen = ((bytes_read + BEFS_SB(sb)->block_size) < len) ?\n\t\t    BEFS_SB(sb)->block_size : len - bytes_read;\n\t\tmemcpy(buff + bytes_read, bh->b_data, plen);\n\t\tbrelse(bh);\n\t\tbytes_read += plen;\n\t}\n\n\tbefs_debug(sb, \"<--- %s read %u bytes\", __func__, (unsigned int)\n\t\t   bytes_read);\n\treturn bytes_read;\n}"
  },
  {
    "function_name": "befs_fblock2brun",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/befs/datastream.c",
    "lines": "89-113",
    "snippet": "int\nbefs_fblock2brun(struct super_block *sb, befs_data_stream * data,\n\t\t befs_blocknr_t fblock, befs_block_run * run)\n{\n\tint err;\n\tbefs_off_t pos = fblock << BEFS_SB(sb)->block_shift;\n\n\tif (pos < data->max_direct_range) {\n\t\terr = befs_find_brun_direct(sb, data, fblock, run);\n\n\t} else if (pos < data->max_indirect_range) {\n\t\terr = befs_find_brun_indirect(sb, data, fblock, run);\n\n\t} else if (pos < data->max_double_indirect_range) {\n\t\terr = befs_find_brun_dblindirect(sb, data, fblock, run);\n\n\t} else {\n\t\tbefs_error(sb,\n\t\t\t   \"befs_fblock2brun() was asked to find block %lu, \"\n\t\t\t   \"which is not mapped by the datastream\\n\",\n\t\t\t   (unsigned long)fblock);\n\t\terr = BEFS_ERR;\n\t}\n\treturn err;\n}",
    "includes": [
      "#include \"io.h\"",
      "#include \"datastream.h\"",
      "#include \"befs.h\"",
      "#include <linux/string.h>",
      "#include <linux/buffer_head.h>",
      "#include <linux/kernel.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static int befs_find_brun_direct(struct super_block *sb,\n\t\t\t\t befs_data_stream * data,\n\t\t\t\t befs_blocknr_t blockno, befs_block_run * run);",
      "static int befs_find_brun_indirect(struct super_block *sb,\n\t\t\t\t   befs_data_stream * data,\n\t\t\t\t   befs_blocknr_t blockno,\n\t\t\t\t   befs_block_run * run);",
      "static int befs_find_brun_dblindirect(struct super_block *sb,\n\t\t\t\t      befs_data_stream * data,\n\t\t\t\t      befs_blocknr_t blockno,\n\t\t\t\t      befs_block_run * run);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "befs_error",
          "args": [
            "sb",
            "\"befs_fblock2brun() was asked to find block %lu, \"\n\t\t\t   \"which is not mapped by the datastream\\n\"",
            "(unsigned long)fblock"
          ],
          "line": 106
        },
        "resolved": true,
        "details": {
          "function_name": "befs_error",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/befs/debug.c",
          "lines": "27-38",
          "snippet": "void\nbefs_error(const struct super_block *sb, const char *fmt, ...)\n{\n\tstruct va_format vaf;\n\tva_list args;\n\n\tva_start(args, fmt);\n\tvaf.fmt = fmt;\n\tvaf.va = &args;\n\tpr_err(\"(%s): %pV\\n\", sb->s_id, &vaf);\n\tva_end(args);\n}",
          "includes": [
            "#include \"befs.h\"",
            "#include <linux/slab.h>",
            "#include <linux/fs.h>",
            "#include <linux/kernel.h>",
            "#include <linux/spinlock.h>",
            "#include <linux/string.h>",
            "#include <stdarg.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"befs.h\"\n#include <linux/slab.h>\n#include <linux/fs.h>\n#include <linux/kernel.h>\n#include <linux/spinlock.h>\n#include <linux/string.h>\n#include <stdarg.h>\n\nvoid\nbefs_error(const struct super_block *sb, const char *fmt, ...)\n{\n\tstruct va_format vaf;\n\tva_list args;\n\n\tva_start(args, fmt);\n\tvaf.fmt = fmt;\n\tvaf.va = &args;\n\tpr_err(\"(%s): %pV\\n\", sb->s_id, &vaf);\n\tva_end(args);\n}"
        }
      },
      {
        "call_info": {
          "callee": "befs_find_brun_dblindirect",
          "args": [
            "sb",
            "data",
            "fblock",
            "run"
          ],
          "line": 103
        },
        "resolved": true,
        "details": {
          "function_name": "befs_find_brun_dblindirect",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/befs/datastream.c",
          "lines": "413-529",
          "snippet": "static int\nbefs_find_brun_dblindirect(struct super_block *sb,\n\t\t\t   befs_data_stream * data, befs_blocknr_t blockno,\n\t\t\t   befs_block_run * run)\n{\n\tint dblindir_indx;\n\tint indir_indx;\n\tint offset;\n\tint dbl_which_block;\n\tint which_block;\n\tint dbl_block_indx;\n\tint block_indx;\n\toff_t dblindir_leftover;\n\tbefs_blocknr_t blockno_at_run_start;\n\tstruct buffer_head *dbl_indir_block;\n\tstruct buffer_head *indir_block;\n\tbefs_block_run indir_run;\n\tbefs_disk_inode_addr *iaddr_array = NULL;\n\tbefs_sb_info *befs_sb = BEFS_SB(sb);\n\n\tbefs_blocknr_t indir_start_blk =\n\t    data->max_indirect_range >> befs_sb->block_shift;\n\n\toff_t dbl_indir_off = blockno - indir_start_blk;\n\n\t/* number of data blocks mapped by each of the iaddrs in\n\t * the indirect block pointed to by the double indirect block\n\t */\n\tsize_t iblklen = BEFS_DBLINDIR_BRUN_LEN;\n\n\t/* number of data blocks mapped by each of the iaddrs in\n\t * the double indirect block\n\t */\n\tsize_t diblklen = iblklen * befs_iaddrs_per_block(sb)\n\t    * BEFS_DBLINDIR_BRUN_LEN;\n\n\tbefs_debug(sb, \"---> %s find %lu\", __func__, (unsigned long)blockno);\n\n\t/* First, discover which of the double_indir->indir blocks\n\t * contains pos. Then figure out how much of pos that\n\t * accounted for. Then discover which of the iaddrs in\n\t * the indirect block contains pos.\n\t */\n\n\tdblindir_indx = dbl_indir_off / diblklen;\n\tdblindir_leftover = dbl_indir_off % diblklen;\n\tindir_indx = dblindir_leftover / diblklen;\n\n\t/* Read double indirect block */\n\tdbl_which_block = dblindir_indx / befs_iaddrs_per_block(sb);\n\tif (dbl_which_block > data->double_indirect.len) {\n\t\tbefs_error(sb, \"The double-indirect index calculated by \"\n\t\t\t   \"%s, %d, is outside the range \"\n\t\t\t   \"of the double-indirect block\", __func__,\n\t\t\t   dblindir_indx);\n\t\treturn BEFS_ERR;\n\t}\n\n\tdbl_indir_block =\n\t    befs_bread(sb, iaddr2blockno(sb, &data->double_indirect) +\n\t\t\t\t\tdbl_which_block);\n\tif (dbl_indir_block == NULL) {\n\t\tbefs_error(sb, \"%s couldn't read the \"\n\t\t\t   \"double-indirect block at blockno %lu\", __func__,\n\t\t\t   (unsigned long)\n\t\t\t   iaddr2blockno(sb, &data->double_indirect) +\n\t\t\t   dbl_which_block);\n\t\tbrelse(dbl_indir_block);\n\t\treturn BEFS_ERR;\n\t}\n\n\tdbl_block_indx =\n\t    dblindir_indx - (dbl_which_block * befs_iaddrs_per_block(sb));\n\tiaddr_array = (befs_disk_inode_addr *) dbl_indir_block->b_data;\n\tindir_run = fsrun_to_cpu(sb, iaddr_array[dbl_block_indx]);\n\tbrelse(dbl_indir_block);\n\tiaddr_array = NULL;\n\n\t/* Read indirect block */\n\twhich_block = indir_indx / befs_iaddrs_per_block(sb);\n\tif (which_block > indir_run.len) {\n\t\tbefs_error(sb, \"The indirect index calculated by \"\n\t\t\t   \"%s, %d, is outside the range \"\n\t\t\t   \"of the indirect block\", __func__, indir_indx);\n\t\treturn BEFS_ERR;\n\t}\n\n\tindir_block =\n\t    befs_bread(sb, iaddr2blockno(sb, &indir_run) + which_block);\n\tif (indir_block == NULL) {\n\t\tbefs_error(sb, \"%s couldn't read the indirect block \"\n\t\t\t   \"at blockno %lu\", __func__, (unsigned long)\n\t\t\t   iaddr2blockno(sb, &indir_run) + which_block);\n\t\tbrelse(indir_block);\n\t\treturn BEFS_ERR;\n\t}\n\n\tblock_indx = indir_indx - (which_block * befs_iaddrs_per_block(sb));\n\tiaddr_array = (befs_disk_inode_addr *) indir_block->b_data;\n\t*run = fsrun_to_cpu(sb, iaddr_array[block_indx]);\n\tbrelse(indir_block);\n\tiaddr_array = NULL;\n\n\tblockno_at_run_start = indir_start_blk;\n\tblockno_at_run_start += diblklen * dblindir_indx;\n\tblockno_at_run_start += iblklen * indir_indx;\n\toffset = blockno - blockno_at_run_start;\n\n\trun->start += offset;\n\trun->len -= offset;\n\n\tbefs_debug(sb, \"Found file block %lu in double_indirect[%d][%d],\"\n\t\t   \" double_indirect_leftover = %lu\", (unsigned long)\n\t\t   blockno, dblindir_indx, indir_indx, dblindir_leftover);\n\n\treturn BEFS_OK;\n}",
          "includes": [
            "#include \"io.h\"",
            "#include \"datastream.h\"",
            "#include \"befs.h\"",
            "#include <linux/string.h>",
            "#include <linux/buffer_head.h>",
            "#include <linux/kernel.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int befs_find_brun_direct(struct super_block *sb,\n\t\t\t\t befs_data_stream * data,\n\t\t\t\t befs_blocknr_t blockno, befs_block_run * run);",
            "static int befs_find_brun_indirect(struct super_block *sb,\n\t\t\t\t   befs_data_stream * data,\n\t\t\t\t   befs_blocknr_t blockno,\n\t\t\t\t   befs_block_run * run);",
            "static int befs_find_brun_dblindirect(struct super_block *sb,\n\t\t\t\t      befs_data_stream * data,\n\t\t\t\t      befs_blocknr_t blockno,\n\t\t\t\t      befs_block_run * run);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"io.h\"\n#include \"datastream.h\"\n#include \"befs.h\"\n#include <linux/string.h>\n#include <linux/buffer_head.h>\n#include <linux/kernel.h>\n\nstatic int befs_find_brun_direct(struct super_block *sb,\n\t\t\t\t befs_data_stream * data,\n\t\t\t\t befs_blocknr_t blockno, befs_block_run * run);\nstatic int befs_find_brun_indirect(struct super_block *sb,\n\t\t\t\t   befs_data_stream * data,\n\t\t\t\t   befs_blocknr_t blockno,\n\t\t\t\t   befs_block_run * run);\nstatic int befs_find_brun_dblindirect(struct super_block *sb,\n\t\t\t\t      befs_data_stream * data,\n\t\t\t\t      befs_blocknr_t blockno,\n\t\t\t\t      befs_block_run * run);\n\nstatic int\nbefs_find_brun_dblindirect(struct super_block *sb,\n\t\t\t   befs_data_stream * data, befs_blocknr_t blockno,\n\t\t\t   befs_block_run * run)\n{\n\tint dblindir_indx;\n\tint indir_indx;\n\tint offset;\n\tint dbl_which_block;\n\tint which_block;\n\tint dbl_block_indx;\n\tint block_indx;\n\toff_t dblindir_leftover;\n\tbefs_blocknr_t blockno_at_run_start;\n\tstruct buffer_head *dbl_indir_block;\n\tstruct buffer_head *indir_block;\n\tbefs_block_run indir_run;\n\tbefs_disk_inode_addr *iaddr_array = NULL;\n\tbefs_sb_info *befs_sb = BEFS_SB(sb);\n\n\tbefs_blocknr_t indir_start_blk =\n\t    data->max_indirect_range >> befs_sb->block_shift;\n\n\toff_t dbl_indir_off = blockno - indir_start_blk;\n\n\t/* number of data blocks mapped by each of the iaddrs in\n\t * the indirect block pointed to by the double indirect block\n\t */\n\tsize_t iblklen = BEFS_DBLINDIR_BRUN_LEN;\n\n\t/* number of data blocks mapped by each of the iaddrs in\n\t * the double indirect block\n\t */\n\tsize_t diblklen = iblklen * befs_iaddrs_per_block(sb)\n\t    * BEFS_DBLINDIR_BRUN_LEN;\n\n\tbefs_debug(sb, \"---> %s find %lu\", __func__, (unsigned long)blockno);\n\n\t/* First, discover which of the double_indir->indir blocks\n\t * contains pos. Then figure out how much of pos that\n\t * accounted for. Then discover which of the iaddrs in\n\t * the indirect block contains pos.\n\t */\n\n\tdblindir_indx = dbl_indir_off / diblklen;\n\tdblindir_leftover = dbl_indir_off % diblklen;\n\tindir_indx = dblindir_leftover / diblklen;\n\n\t/* Read double indirect block */\n\tdbl_which_block = dblindir_indx / befs_iaddrs_per_block(sb);\n\tif (dbl_which_block > data->double_indirect.len) {\n\t\tbefs_error(sb, \"The double-indirect index calculated by \"\n\t\t\t   \"%s, %d, is outside the range \"\n\t\t\t   \"of the double-indirect block\", __func__,\n\t\t\t   dblindir_indx);\n\t\treturn BEFS_ERR;\n\t}\n\n\tdbl_indir_block =\n\t    befs_bread(sb, iaddr2blockno(sb, &data->double_indirect) +\n\t\t\t\t\tdbl_which_block);\n\tif (dbl_indir_block == NULL) {\n\t\tbefs_error(sb, \"%s couldn't read the \"\n\t\t\t   \"double-indirect block at blockno %lu\", __func__,\n\t\t\t   (unsigned long)\n\t\t\t   iaddr2blockno(sb, &data->double_indirect) +\n\t\t\t   dbl_which_block);\n\t\tbrelse(dbl_indir_block);\n\t\treturn BEFS_ERR;\n\t}\n\n\tdbl_block_indx =\n\t    dblindir_indx - (dbl_which_block * befs_iaddrs_per_block(sb));\n\tiaddr_array = (befs_disk_inode_addr *) dbl_indir_block->b_data;\n\tindir_run = fsrun_to_cpu(sb, iaddr_array[dbl_block_indx]);\n\tbrelse(dbl_indir_block);\n\tiaddr_array = NULL;\n\n\t/* Read indirect block */\n\twhich_block = indir_indx / befs_iaddrs_per_block(sb);\n\tif (which_block > indir_run.len) {\n\t\tbefs_error(sb, \"The indirect index calculated by \"\n\t\t\t   \"%s, %d, is outside the range \"\n\t\t\t   \"of the indirect block\", __func__, indir_indx);\n\t\treturn BEFS_ERR;\n\t}\n\n\tindir_block =\n\t    befs_bread(sb, iaddr2blockno(sb, &indir_run) + which_block);\n\tif (indir_block == NULL) {\n\t\tbefs_error(sb, \"%s couldn't read the indirect block \"\n\t\t\t   \"at blockno %lu\", __func__, (unsigned long)\n\t\t\t   iaddr2blockno(sb, &indir_run) + which_block);\n\t\tbrelse(indir_block);\n\t\treturn BEFS_ERR;\n\t}\n\n\tblock_indx = indir_indx - (which_block * befs_iaddrs_per_block(sb));\n\tiaddr_array = (befs_disk_inode_addr *) indir_block->b_data;\n\t*run = fsrun_to_cpu(sb, iaddr_array[block_indx]);\n\tbrelse(indir_block);\n\tiaddr_array = NULL;\n\n\tblockno_at_run_start = indir_start_blk;\n\tblockno_at_run_start += diblklen * dblindir_indx;\n\tblockno_at_run_start += iblklen * indir_indx;\n\toffset = blockno - blockno_at_run_start;\n\n\trun->start += offset;\n\trun->len -= offset;\n\n\tbefs_debug(sb, \"Found file block %lu in double_indirect[%d][%d],\"\n\t\t   \" double_indirect_leftover = %lu\", (unsigned long)\n\t\t   blockno, dblindir_indx, indir_indx, dblindir_leftover);\n\n\treturn BEFS_OK;\n}"
        }
      },
      {
        "call_info": {
          "callee": "befs_find_brun_indirect",
          "args": [
            "sb",
            "data",
            "fblock",
            "run"
          ],
          "line": 100
        },
        "resolved": true,
        "details": {
          "function_name": "befs_find_brun_indirect",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/befs/datastream.c",
          "lines": "305-370",
          "snippet": "static int\nbefs_find_brun_indirect(struct super_block *sb,\n\t\t\tbefs_data_stream * data, befs_blocknr_t blockno,\n\t\t\tbefs_block_run * run)\n{\n\tint i, j;\n\tbefs_blocknr_t sum = 0;\n\tbefs_blocknr_t indir_start_blk;\n\tbefs_blocknr_t search_blk;\n\tstruct buffer_head *indirblock;\n\tbefs_disk_block_run *array;\n\n\tbefs_block_run indirect = data->indirect;\n\tbefs_blocknr_t indirblockno = iaddr2blockno(sb, &indirect);\n\tint arraylen = befs_iaddrs_per_block(sb);\n\n\tbefs_debug(sb, \"---> %s, find %lu\", __func__, (unsigned long)blockno);\n\n\tindir_start_blk = data->max_direct_range >> BEFS_SB(sb)->block_shift;\n\tsearch_blk = blockno - indir_start_blk;\n\n\t/* Examine blocks of the indirect run one at a time */\n\tfor (i = 0; i < indirect.len; i++) {\n\t\tindirblock = befs_bread(sb, indirblockno + i);\n\t\tif (indirblock == NULL) {\n\t\t\tbefs_debug(sb, \"---> %s failed to read \"\n\t\t\t\t   \"disk block %lu from the indirect brun\",\n\t\t\t\t   __func__, (unsigned long)indirblockno + i);\n\t\t\treturn BEFS_ERR;\n\t\t}\n\n\t\tarray = (befs_disk_block_run *) indirblock->b_data;\n\n\t\tfor (j = 0; j < arraylen; ++j) {\n\t\t\tint len = fs16_to_cpu(sb, array[j].len);\n\n\t\t\tif (search_blk >= sum && search_blk < sum + len) {\n\t\t\t\tint offset = search_blk - sum;\n\t\t\t\trun->allocation_group =\n\t\t\t\t    fs32_to_cpu(sb, array[j].allocation_group);\n\t\t\t\trun->start =\n\t\t\t\t    fs16_to_cpu(sb, array[j].start) + offset;\n\t\t\t\trun->len =\n\t\t\t\t    fs16_to_cpu(sb, array[j].len) - offset;\n\n\t\t\t\tbrelse(indirblock);\n\t\t\t\tbefs_debug(sb,\n\t\t\t\t\t   \"<--- %s found file block \"\n\t\t\t\t\t   \"%lu at indirect[%d]\", __func__,\n\t\t\t\t\t   (unsigned long)blockno,\n\t\t\t\t\t   j + (i * arraylen));\n\t\t\t\treturn BEFS_OK;\n\t\t\t}\n\t\t\tsum += len;\n\t\t}\n\n\t\tbrelse(indirblock);\n\t}\n\n\t/* Only fallthrough is an error */\n\tbefs_error(sb, \"BeFS: %s failed to find \"\n\t\t   \"file block %lu\", __func__, (unsigned long)blockno);\n\n\tbefs_debug(sb, \"<--- %s ERROR\", __func__);\n\treturn BEFS_ERR;\n}",
          "includes": [
            "#include \"io.h\"",
            "#include \"datastream.h\"",
            "#include \"befs.h\"",
            "#include <linux/string.h>",
            "#include <linux/buffer_head.h>",
            "#include <linux/kernel.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int befs_find_brun_direct(struct super_block *sb,\n\t\t\t\t befs_data_stream * data,\n\t\t\t\t befs_blocknr_t blockno, befs_block_run * run);",
            "static int befs_find_brun_indirect(struct super_block *sb,\n\t\t\t\t   befs_data_stream * data,\n\t\t\t\t   befs_blocknr_t blockno,\n\t\t\t\t   befs_block_run * run);",
            "static int befs_find_brun_dblindirect(struct super_block *sb,\n\t\t\t\t      befs_data_stream * data,\n\t\t\t\t      befs_blocknr_t blockno,\n\t\t\t\t      befs_block_run * run);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"io.h\"\n#include \"datastream.h\"\n#include \"befs.h\"\n#include <linux/string.h>\n#include <linux/buffer_head.h>\n#include <linux/kernel.h>\n\nstatic int befs_find_brun_direct(struct super_block *sb,\n\t\t\t\t befs_data_stream * data,\n\t\t\t\t befs_blocknr_t blockno, befs_block_run * run);\nstatic int befs_find_brun_indirect(struct super_block *sb,\n\t\t\t\t   befs_data_stream * data,\n\t\t\t\t   befs_blocknr_t blockno,\n\t\t\t\t   befs_block_run * run);\nstatic int befs_find_brun_dblindirect(struct super_block *sb,\n\t\t\t\t      befs_data_stream * data,\n\t\t\t\t      befs_blocknr_t blockno,\n\t\t\t\t      befs_block_run * run);\n\nstatic int\nbefs_find_brun_indirect(struct super_block *sb,\n\t\t\tbefs_data_stream * data, befs_blocknr_t blockno,\n\t\t\tbefs_block_run * run)\n{\n\tint i, j;\n\tbefs_blocknr_t sum = 0;\n\tbefs_blocknr_t indir_start_blk;\n\tbefs_blocknr_t search_blk;\n\tstruct buffer_head *indirblock;\n\tbefs_disk_block_run *array;\n\n\tbefs_block_run indirect = data->indirect;\n\tbefs_blocknr_t indirblockno = iaddr2blockno(sb, &indirect);\n\tint arraylen = befs_iaddrs_per_block(sb);\n\n\tbefs_debug(sb, \"---> %s, find %lu\", __func__, (unsigned long)blockno);\n\n\tindir_start_blk = data->max_direct_range >> BEFS_SB(sb)->block_shift;\n\tsearch_blk = blockno - indir_start_blk;\n\n\t/* Examine blocks of the indirect run one at a time */\n\tfor (i = 0; i < indirect.len; i++) {\n\t\tindirblock = befs_bread(sb, indirblockno + i);\n\t\tif (indirblock == NULL) {\n\t\t\tbefs_debug(sb, \"---> %s failed to read \"\n\t\t\t\t   \"disk block %lu from the indirect brun\",\n\t\t\t\t   __func__, (unsigned long)indirblockno + i);\n\t\t\treturn BEFS_ERR;\n\t\t}\n\n\t\tarray = (befs_disk_block_run *) indirblock->b_data;\n\n\t\tfor (j = 0; j < arraylen; ++j) {\n\t\t\tint len = fs16_to_cpu(sb, array[j].len);\n\n\t\t\tif (search_blk >= sum && search_blk < sum + len) {\n\t\t\t\tint offset = search_blk - sum;\n\t\t\t\trun->allocation_group =\n\t\t\t\t    fs32_to_cpu(sb, array[j].allocation_group);\n\t\t\t\trun->start =\n\t\t\t\t    fs16_to_cpu(sb, array[j].start) + offset;\n\t\t\t\trun->len =\n\t\t\t\t    fs16_to_cpu(sb, array[j].len) - offset;\n\n\t\t\t\tbrelse(indirblock);\n\t\t\t\tbefs_debug(sb,\n\t\t\t\t\t   \"<--- %s found file block \"\n\t\t\t\t\t   \"%lu at indirect[%d]\", __func__,\n\t\t\t\t\t   (unsigned long)blockno,\n\t\t\t\t\t   j + (i * arraylen));\n\t\t\t\treturn BEFS_OK;\n\t\t\t}\n\t\t\tsum += len;\n\t\t}\n\n\t\tbrelse(indirblock);\n\t}\n\n\t/* Only fallthrough is an error */\n\tbefs_error(sb, \"BeFS: %s failed to find \"\n\t\t   \"file block %lu\", __func__, (unsigned long)blockno);\n\n\tbefs_debug(sb, \"<--- %s ERROR\", __func__);\n\treturn BEFS_ERR;\n}"
        }
      },
      {
        "call_info": {
          "callee": "befs_find_brun_direct",
          "args": [
            "sb",
            "data",
            "fblock",
            "run"
          ],
          "line": 97
        },
        "resolved": true,
        "details": {
          "function_name": "befs_find_brun_direct",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/befs/datastream.c",
          "lines": "245-280",
          "snippet": "static int\nbefs_find_brun_direct(struct super_block *sb, befs_data_stream * data,\n\t\t      befs_blocknr_t blockno, befs_block_run * run)\n{\n\tint i;\n\tbefs_block_run *array = data->direct;\n\tbefs_blocknr_t sum;\n\tbefs_blocknr_t max_block =\n\t    data->max_direct_range >> BEFS_SB(sb)->block_shift;\n\n\tbefs_debug(sb, \"---> %s, find %lu\", __func__, (unsigned long)blockno);\n\n\tif (blockno > max_block) {\n\t\tbefs_error(sb, \"%s passed block outside of direct region\",\n\t\t\t   __func__);\n\t\treturn BEFS_ERR;\n\t}\n\n\tfor (i = 0, sum = 0; i < BEFS_NUM_DIRECT_BLOCKS;\n\t     sum += array[i].len, i++) {\n\t\tif (blockno >= sum && blockno < sum + (array[i].len)) {\n\t\t\tint offset = blockno - sum;\n\t\t\trun->allocation_group = array[i].allocation_group;\n\t\t\trun->start = array[i].start + offset;\n\t\t\trun->len = array[i].len - offset;\n\n\t\t\tbefs_debug(sb, \"---> %s, \"\n\t\t\t\t   \"found %lu at direct[%d]\", __func__,\n\t\t\t\t   (unsigned long)blockno, i);\n\t\t\treturn BEFS_OK;\n\t\t}\n\t}\n\n\tbefs_debug(sb, \"---> %s ERROR\", __func__);\n\treturn BEFS_ERR;\n}",
          "includes": [
            "#include \"io.h\"",
            "#include \"datastream.h\"",
            "#include \"befs.h\"",
            "#include <linux/string.h>",
            "#include <linux/buffer_head.h>",
            "#include <linux/kernel.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int befs_find_brun_direct(struct super_block *sb,\n\t\t\t\t befs_data_stream * data,\n\t\t\t\t befs_blocknr_t blockno, befs_block_run * run);",
            "static int befs_find_brun_indirect(struct super_block *sb,\n\t\t\t\t   befs_data_stream * data,\n\t\t\t\t   befs_blocknr_t blockno,\n\t\t\t\t   befs_block_run * run);",
            "static int befs_find_brun_dblindirect(struct super_block *sb,\n\t\t\t\t      befs_data_stream * data,\n\t\t\t\t      befs_blocknr_t blockno,\n\t\t\t\t      befs_block_run * run);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"io.h\"\n#include \"datastream.h\"\n#include \"befs.h\"\n#include <linux/string.h>\n#include <linux/buffer_head.h>\n#include <linux/kernel.h>\n\nstatic int befs_find_brun_direct(struct super_block *sb,\n\t\t\t\t befs_data_stream * data,\n\t\t\t\t befs_blocknr_t blockno, befs_block_run * run);\nstatic int befs_find_brun_indirect(struct super_block *sb,\n\t\t\t\t   befs_data_stream * data,\n\t\t\t\t   befs_blocknr_t blockno,\n\t\t\t\t   befs_block_run * run);\nstatic int befs_find_brun_dblindirect(struct super_block *sb,\n\t\t\t\t      befs_data_stream * data,\n\t\t\t\t      befs_blocknr_t blockno,\n\t\t\t\t      befs_block_run * run);\n\nstatic int\nbefs_find_brun_direct(struct super_block *sb, befs_data_stream * data,\n\t\t      befs_blocknr_t blockno, befs_block_run * run)\n{\n\tint i;\n\tbefs_block_run *array = data->direct;\n\tbefs_blocknr_t sum;\n\tbefs_blocknr_t max_block =\n\t    data->max_direct_range >> BEFS_SB(sb)->block_shift;\n\n\tbefs_debug(sb, \"---> %s, find %lu\", __func__, (unsigned long)blockno);\n\n\tif (blockno > max_block) {\n\t\tbefs_error(sb, \"%s passed block outside of direct region\",\n\t\t\t   __func__);\n\t\treturn BEFS_ERR;\n\t}\n\n\tfor (i = 0, sum = 0; i < BEFS_NUM_DIRECT_BLOCKS;\n\t     sum += array[i].len, i++) {\n\t\tif (blockno >= sum && blockno < sum + (array[i].len)) {\n\t\t\tint offset = blockno - sum;\n\t\t\trun->allocation_group = array[i].allocation_group;\n\t\t\trun->start = array[i].start + offset;\n\t\t\trun->len = array[i].len - offset;\n\n\t\t\tbefs_debug(sb, \"---> %s, \"\n\t\t\t\t   \"found %lu at direct[%d]\", __func__,\n\t\t\t\t   (unsigned long)blockno, i);\n\t\t\treturn BEFS_OK;\n\t\t}\n\t}\n\n\tbefs_debug(sb, \"---> %s ERROR\", __func__);\n\treturn BEFS_ERR;\n}"
        }
      },
      {
        "call_info": {
          "callee": "BEFS_SB",
          "args": [
            "sb"
          ],
          "line": 94
        },
        "resolved": true,
        "details": {
          "function_name": "BEFS_SB",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/befs/befs.h",
          "lines": "108-112",
          "snippet": "static inline befs_sb_info *\nBEFS_SB(const struct super_block *super)\n{\n\treturn (befs_sb_info *) super->s_fs_info;\n}",
          "includes": [
            "#include \"endian.h\"",
            "#include \"befs_fs_types.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"endian.h\"\n#include \"befs_fs_types.h\"\n\nstatic inline befs_sb_info *\nBEFS_SB(const struct super_block *super)\n{\n\treturn (befs_sb_info *) super->s_fs_info;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"io.h\"\n#include \"datastream.h\"\n#include \"befs.h\"\n#include <linux/string.h>\n#include <linux/buffer_head.h>\n#include <linux/kernel.h>\n\nstatic int befs_find_brun_direct(struct super_block *sb,\n\t\t\t\t befs_data_stream * data,\n\t\t\t\t befs_blocknr_t blockno, befs_block_run * run);\nstatic int befs_find_brun_indirect(struct super_block *sb,\n\t\t\t\t   befs_data_stream * data,\n\t\t\t\t   befs_blocknr_t blockno,\n\t\t\t\t   befs_block_run * run);\nstatic int befs_find_brun_dblindirect(struct super_block *sb,\n\t\t\t\t      befs_data_stream * data,\n\t\t\t\t      befs_blocknr_t blockno,\n\t\t\t\t      befs_block_run * run);\n\nint\nbefs_fblock2brun(struct super_block *sb, befs_data_stream * data,\n\t\t befs_blocknr_t fblock, befs_block_run * run)\n{\n\tint err;\n\tbefs_off_t pos = fblock << BEFS_SB(sb)->block_shift;\n\n\tif (pos < data->max_direct_range) {\n\t\terr = befs_find_brun_direct(sb, data, fblock, run);\n\n\t} else if (pos < data->max_indirect_range) {\n\t\terr = befs_find_brun_indirect(sb, data, fblock, run);\n\n\t} else if (pos < data->max_double_indirect_range) {\n\t\terr = befs_find_brun_dblindirect(sb, data, fblock, run);\n\n\t} else {\n\t\tbefs_error(sb,\n\t\t\t   \"befs_fblock2brun() was asked to find block %lu, \"\n\t\t\t   \"which is not mapped by the datastream\\n\",\n\t\t\t   (unsigned long)fblock);\n\t\terr = BEFS_ERR;\n\t}\n\treturn err;\n}"
  },
  {
    "function_name": "befs_read_datastream",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/befs/datastream.c",
    "lines": "47-76",
    "snippet": "struct buffer_head *\nbefs_read_datastream(struct super_block *sb, befs_data_stream * ds,\n\t\t     befs_off_t pos, uint * off)\n{\n\tstruct buffer_head *bh = NULL;\n\tbefs_block_run run;\n\tbefs_blocknr_t block;\t/* block coresponding to pos */\n\n\tbefs_debug(sb, \"---> %s %llu\", __func__, pos);\n\tblock = pos >> BEFS_SB(sb)->block_shift;\n\tif (off)\n\t\t*off = pos - (block << BEFS_SB(sb)->block_shift);\n\n\tif (befs_fblock2brun(sb, ds, block, &run) != BEFS_OK) {\n\t\tbefs_error(sb, \"BeFS: Error finding disk addr of block %lu\",\n\t\t\t   (unsigned long)block);\n\t\tbefs_debug(sb, \"<--- %s ERROR\", __func__);\n\t\treturn NULL;\n\t}\n\tbh = befs_bread_iaddr(sb, run);\n\tif (!bh) {\n\t\tbefs_error(sb, \"BeFS: Error reading block %lu from datastream\",\n\t\t\t   (unsigned long)block);\n\t\treturn NULL;\n\t}\n\n\tbefs_debug(sb, \"<--- %s read data, starting at %llu\", __func__, pos);\n\n\treturn bh;\n}",
    "includes": [
      "#include \"io.h\"",
      "#include \"datastream.h\"",
      "#include \"befs.h\"",
      "#include <linux/string.h>",
      "#include <linux/buffer_head.h>",
      "#include <linux/kernel.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static int befs_find_brun_direct(struct super_block *sb,\n\t\t\t\t befs_data_stream * data,\n\t\t\t\t befs_blocknr_t blockno, befs_block_run * run);",
      "static int befs_find_brun_indirect(struct super_block *sb,\n\t\t\t\t   befs_data_stream * data,\n\t\t\t\t   befs_blocknr_t blockno,\n\t\t\t\t   befs_block_run * run);",
      "static int befs_find_brun_dblindirect(struct super_block *sb,\n\t\t\t\t      befs_data_stream * data,\n\t\t\t\t      befs_blocknr_t blockno,\n\t\t\t\t      befs_block_run * run);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "befs_debug",
          "args": [
            "sb",
            "\"<--- %s read data, starting at %llu\"",
            "__func__",
            "pos"
          ],
          "line": 73
        },
        "resolved": true,
        "details": {
          "function_name": "befs_debug",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/befs/debug.c",
          "lines": "53-67",
          "snippet": "void\nbefs_debug(const struct super_block *sb, const char *fmt, ...)\n{\n#ifdef CONFIG_BEFS_DEBUG\n\n\tstruct va_format vaf;\n\tva_list args;\n\tva_start(args, fmt);\n\tvaf.fmt = fmt;\n\tvaf.va = &args;\n\tpr_debug(\"(%s): %pV\\n\", sb->s_id, &vaf);\n\tva_end(args);\n\n#endif\t\t\t\t//CONFIG_BEFS_DEBUG\n}",
          "includes": [
            "#include \"befs.h\"",
            "#include <linux/slab.h>",
            "#include <linux/fs.h>",
            "#include <linux/kernel.h>",
            "#include <linux/spinlock.h>",
            "#include <linux/string.h>",
            "#include <stdarg.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"befs.h\"\n#include <linux/slab.h>\n#include <linux/fs.h>\n#include <linux/kernel.h>\n#include <linux/spinlock.h>\n#include <linux/string.h>\n#include <stdarg.h>\n\nvoid\nbefs_debug(const struct super_block *sb, const char *fmt, ...)\n{\n#ifdef CONFIG_BEFS_DEBUG\n\n\tstruct va_format vaf;\n\tva_list args;\n\tva_start(args, fmt);\n\tvaf.fmt = fmt;\n\tvaf.va = &args;\n\tpr_debug(\"(%s): %pV\\n\", sb->s_id, &vaf);\n\tva_end(args);\n\n#endif\t\t\t\t//CONFIG_BEFS_DEBUG\n}"
        }
      },
      {
        "call_info": {
          "callee": "befs_error",
          "args": [
            "sb",
            "\"BeFS: Error reading block %lu from datastream\"",
            "(unsigned long)block"
          ],
          "line": 68
        },
        "resolved": true,
        "details": {
          "function_name": "befs_error",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/befs/debug.c",
          "lines": "27-38",
          "snippet": "void\nbefs_error(const struct super_block *sb, const char *fmt, ...)\n{\n\tstruct va_format vaf;\n\tva_list args;\n\n\tva_start(args, fmt);\n\tvaf.fmt = fmt;\n\tvaf.va = &args;\n\tpr_err(\"(%s): %pV\\n\", sb->s_id, &vaf);\n\tva_end(args);\n}",
          "includes": [
            "#include \"befs.h\"",
            "#include <linux/slab.h>",
            "#include <linux/fs.h>",
            "#include <linux/kernel.h>",
            "#include <linux/spinlock.h>",
            "#include <linux/string.h>",
            "#include <stdarg.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"befs.h\"\n#include <linux/slab.h>\n#include <linux/fs.h>\n#include <linux/kernel.h>\n#include <linux/spinlock.h>\n#include <linux/string.h>\n#include <stdarg.h>\n\nvoid\nbefs_error(const struct super_block *sb, const char *fmt, ...)\n{\n\tstruct va_format vaf;\n\tva_list args;\n\n\tva_start(args, fmt);\n\tvaf.fmt = fmt;\n\tvaf.va = &args;\n\tpr_err(\"(%s): %pV\\n\", sb->s_id, &vaf);\n\tva_end(args);\n}"
        }
      },
      {
        "call_info": {
          "callee": "befs_bread_iaddr",
          "args": [
            "sb",
            "run"
          ],
          "line": 66
        },
        "resolved": true,
        "details": {
          "function_name": "befs_bread_iaddr",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/befs/io.c",
          "lines": "26-61",
          "snippet": "struct buffer_head *\nbefs_bread_iaddr(struct super_block *sb, befs_inode_addr iaddr)\n{\n\tstruct buffer_head *bh = NULL;\n\tbefs_blocknr_t block = 0;\n\tbefs_sb_info *befs_sb = BEFS_SB(sb);\n\n\tbefs_debug(sb, \"---> Enter %s \"\n\t\t   \"[%u, %hu, %hu]\", __func__, iaddr.allocation_group,\n\t\t   iaddr.start, iaddr.len);\n\n\tif (iaddr.allocation_group > befs_sb->num_ags) {\n\t\tbefs_error(sb, \"BEFS: Invalid allocation group %u, max is %u\",\n\t\t\t   iaddr.allocation_group, befs_sb->num_ags);\n\t\tgoto error;\n\t}\n\n\tblock = iaddr2blockno(sb, &iaddr);\n\n\tbefs_debug(sb, \"%s: offset = %lu\", __func__, (unsigned long)block);\n\n\tbh = sb_bread(sb, block);\n\n\tif (bh == NULL) {\n\t\tbefs_error(sb, \"Failed to read block %lu\",\n\t\t\t   (unsigned long)block);\n\t\tgoto error;\n\t}\n\n\tbefs_debug(sb, \"<--- %s\", __func__);\n\treturn bh;\n\n      error:\n\tbefs_debug(sb, \"<--- %s ERROR\", __func__);\n\treturn NULL;\n}",
          "includes": [
            "#include \"io.h\"",
            "#include \"befs.h\"",
            "#include <linux/buffer_head.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"io.h\"\n#include \"befs.h\"\n#include <linux/buffer_head.h>\n\nstruct buffer_head *\nbefs_bread_iaddr(struct super_block *sb, befs_inode_addr iaddr)\n{\n\tstruct buffer_head *bh = NULL;\n\tbefs_blocknr_t block = 0;\n\tbefs_sb_info *befs_sb = BEFS_SB(sb);\n\n\tbefs_debug(sb, \"---> Enter %s \"\n\t\t   \"[%u, %hu, %hu]\", __func__, iaddr.allocation_group,\n\t\t   iaddr.start, iaddr.len);\n\n\tif (iaddr.allocation_group > befs_sb->num_ags) {\n\t\tbefs_error(sb, \"BEFS: Invalid allocation group %u, max is %u\",\n\t\t\t   iaddr.allocation_group, befs_sb->num_ags);\n\t\tgoto error;\n\t}\n\n\tblock = iaddr2blockno(sb, &iaddr);\n\n\tbefs_debug(sb, \"%s: offset = %lu\", __func__, (unsigned long)block);\n\n\tbh = sb_bread(sb, block);\n\n\tif (bh == NULL) {\n\t\tbefs_error(sb, \"Failed to read block %lu\",\n\t\t\t   (unsigned long)block);\n\t\tgoto error;\n\t}\n\n\tbefs_debug(sb, \"<--- %s\", __func__);\n\treturn bh;\n\n      error:\n\tbefs_debug(sb, \"<--- %s ERROR\", __func__);\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "befs_fblock2brun",
          "args": [
            "sb",
            "ds",
            "block",
            "&run"
          ],
          "line": 60
        },
        "resolved": true,
        "details": {
          "function_name": "befs_fblock2brun",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/befs/datastream.c",
          "lines": "89-113",
          "snippet": "int\nbefs_fblock2brun(struct super_block *sb, befs_data_stream * data,\n\t\t befs_blocknr_t fblock, befs_block_run * run)\n{\n\tint err;\n\tbefs_off_t pos = fblock << BEFS_SB(sb)->block_shift;\n\n\tif (pos < data->max_direct_range) {\n\t\terr = befs_find_brun_direct(sb, data, fblock, run);\n\n\t} else if (pos < data->max_indirect_range) {\n\t\terr = befs_find_brun_indirect(sb, data, fblock, run);\n\n\t} else if (pos < data->max_double_indirect_range) {\n\t\terr = befs_find_brun_dblindirect(sb, data, fblock, run);\n\n\t} else {\n\t\tbefs_error(sb,\n\t\t\t   \"befs_fblock2brun() was asked to find block %lu, \"\n\t\t\t   \"which is not mapped by the datastream\\n\",\n\t\t\t   (unsigned long)fblock);\n\t\terr = BEFS_ERR;\n\t}\n\treturn err;\n}",
          "includes": [
            "#include \"io.h\"",
            "#include \"datastream.h\"",
            "#include \"befs.h\"",
            "#include <linux/string.h>",
            "#include <linux/buffer_head.h>",
            "#include <linux/kernel.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int befs_find_brun_direct(struct super_block *sb,\n\t\t\t\t befs_data_stream * data,\n\t\t\t\t befs_blocknr_t blockno, befs_block_run * run);",
            "static int befs_find_brun_indirect(struct super_block *sb,\n\t\t\t\t   befs_data_stream * data,\n\t\t\t\t   befs_blocknr_t blockno,\n\t\t\t\t   befs_block_run * run);",
            "static int befs_find_brun_dblindirect(struct super_block *sb,\n\t\t\t\t      befs_data_stream * data,\n\t\t\t\t      befs_blocknr_t blockno,\n\t\t\t\t      befs_block_run * run);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"io.h\"\n#include \"datastream.h\"\n#include \"befs.h\"\n#include <linux/string.h>\n#include <linux/buffer_head.h>\n#include <linux/kernel.h>\n\nstatic int befs_find_brun_direct(struct super_block *sb,\n\t\t\t\t befs_data_stream * data,\n\t\t\t\t befs_blocknr_t blockno, befs_block_run * run);\nstatic int befs_find_brun_indirect(struct super_block *sb,\n\t\t\t\t   befs_data_stream * data,\n\t\t\t\t   befs_blocknr_t blockno,\n\t\t\t\t   befs_block_run * run);\nstatic int befs_find_brun_dblindirect(struct super_block *sb,\n\t\t\t\t      befs_data_stream * data,\n\t\t\t\t      befs_blocknr_t blockno,\n\t\t\t\t      befs_block_run * run);\n\nint\nbefs_fblock2brun(struct super_block *sb, befs_data_stream * data,\n\t\t befs_blocknr_t fblock, befs_block_run * run)\n{\n\tint err;\n\tbefs_off_t pos = fblock << BEFS_SB(sb)->block_shift;\n\n\tif (pos < data->max_direct_range) {\n\t\terr = befs_find_brun_direct(sb, data, fblock, run);\n\n\t} else if (pos < data->max_indirect_range) {\n\t\terr = befs_find_brun_indirect(sb, data, fblock, run);\n\n\t} else if (pos < data->max_double_indirect_range) {\n\t\terr = befs_find_brun_dblindirect(sb, data, fblock, run);\n\n\t} else {\n\t\tbefs_error(sb,\n\t\t\t   \"befs_fblock2brun() was asked to find block %lu, \"\n\t\t\t   \"which is not mapped by the datastream\\n\",\n\t\t\t   (unsigned long)fblock);\n\t\terr = BEFS_ERR;\n\t}\n\treturn err;\n}"
        }
      },
      {
        "call_info": {
          "callee": "BEFS_SB",
          "args": [
            "sb"
          ],
          "line": 58
        },
        "resolved": true,
        "details": {
          "function_name": "BEFS_SB",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/befs/befs.h",
          "lines": "108-112",
          "snippet": "static inline befs_sb_info *\nBEFS_SB(const struct super_block *super)\n{\n\treturn (befs_sb_info *) super->s_fs_info;\n}",
          "includes": [
            "#include \"endian.h\"",
            "#include \"befs_fs_types.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"endian.h\"\n#include \"befs_fs_types.h\"\n\nstatic inline befs_sb_info *\nBEFS_SB(const struct super_block *super)\n{\n\treturn (befs_sb_info *) super->s_fs_info;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"io.h\"\n#include \"datastream.h\"\n#include \"befs.h\"\n#include <linux/string.h>\n#include <linux/buffer_head.h>\n#include <linux/kernel.h>\n\nstatic int befs_find_brun_direct(struct super_block *sb,\n\t\t\t\t befs_data_stream * data,\n\t\t\t\t befs_blocknr_t blockno, befs_block_run * run);\nstatic int befs_find_brun_indirect(struct super_block *sb,\n\t\t\t\t   befs_data_stream * data,\n\t\t\t\t   befs_blocknr_t blockno,\n\t\t\t\t   befs_block_run * run);\nstatic int befs_find_brun_dblindirect(struct super_block *sb,\n\t\t\t\t      befs_data_stream * data,\n\t\t\t\t      befs_blocknr_t blockno,\n\t\t\t\t      befs_block_run * run);\n\nstruct buffer_head *\nbefs_read_datastream(struct super_block *sb, befs_data_stream * ds,\n\t\t     befs_off_t pos, uint * off)\n{\n\tstruct buffer_head *bh = NULL;\n\tbefs_block_run run;\n\tbefs_blocknr_t block;\t/* block coresponding to pos */\n\n\tbefs_debug(sb, \"---> %s %llu\", __func__, pos);\n\tblock = pos >> BEFS_SB(sb)->block_shift;\n\tif (off)\n\t\t*off = pos - (block << BEFS_SB(sb)->block_shift);\n\n\tif (befs_fblock2brun(sb, ds, block, &run) != BEFS_OK) {\n\t\tbefs_error(sb, \"BeFS: Error finding disk addr of block %lu\",\n\t\t\t   (unsigned long)block);\n\t\tbefs_debug(sb, \"<--- %s ERROR\", __func__);\n\t\treturn NULL;\n\t}\n\tbh = befs_bread_iaddr(sb, run);\n\tif (!bh) {\n\t\tbefs_error(sb, \"BeFS: Error reading block %lu from datastream\",\n\t\t\t   (unsigned long)block);\n\t\treturn NULL;\n\t}\n\n\tbefs_debug(sb, \"<--- %s read data, starting at %llu\", __func__, pos);\n\n\treturn bh;\n}"
  }
]