[
  {
    "function_name": "ntfs_index_entry_mark_dirty",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/ntfs/index.h",
    "lines": "137-144",
    "snippet": "static inline void ntfs_index_entry_mark_dirty(ntfs_index_context *ictx)\n{\n\tif (ictx->is_in_root)\n\t\tmark_mft_record_dirty(ictx->actx->ntfs_ino);\n\telse\n\t\tmark_ntfs_record_dirty(ictx->page,\n\t\t\t\t(u8*)ictx->ia - (u8*)page_address(ictx->page));\n}",
    "includes": [
      "#include \"aops.h\"",
      "#include \"mft.h\"",
      "#include \"attrib.h\"",
      "#include \"inode.h\"",
      "#include \"layout.h\"",
      "#include \"types.h\"",
      "#include <linux/fs.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "mark_ntfs_record_dirty",
          "args": [
            "ictx->page",
            "(u8*)ictx->ia - (u8*)page_address(ictx->page)"
          ],
          "line": 142
        },
        "resolved": true,
        "details": {
          "function_name": "mark_ntfs_record_dirty",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/ntfs/aops.c",
          "lines": "1729-1775",
          "snippet": "void mark_ntfs_record_dirty(struct page *page, const unsigned int ofs) {\n\tstruct address_space *mapping = page->mapping;\n\tntfs_inode *ni = NTFS_I(mapping->host);\n\tstruct buffer_head *bh, *head, *buffers_to_free = NULL;\n\tunsigned int end, bh_size, bh_ofs;\n\n\tBUG_ON(!PageUptodate(page));\n\tend = ofs + ni->itype.index.block_size;\n\tbh_size = VFS_I(ni)->i_sb->s_blocksize;\n\tspin_lock(&mapping->private_lock);\n\tif (unlikely(!page_has_buffers(page))) {\n\t\tspin_unlock(&mapping->private_lock);\n\t\tbh = head = alloc_page_buffers(page, bh_size, 1);\n\t\tspin_lock(&mapping->private_lock);\n\t\tif (likely(!page_has_buffers(page))) {\n\t\t\tstruct buffer_head *tail;\n\n\t\t\tdo {\n\t\t\t\tset_buffer_uptodate(bh);\n\t\t\t\ttail = bh;\n\t\t\t\tbh = bh->b_this_page;\n\t\t\t} while (bh);\n\t\t\ttail->b_this_page = head;\n\t\t\tattach_page_buffers(page, head);\n\t\t} else\n\t\t\tbuffers_to_free = bh;\n\t}\n\tbh = head = page_buffers(page);\n\tBUG_ON(!bh);\n\tdo {\n\t\tbh_ofs = bh_offset(bh);\n\t\tif (bh_ofs + bh_size <= ofs)\n\t\t\tcontinue;\n\t\tif (unlikely(bh_ofs >= end))\n\t\t\tbreak;\n\t\tset_buffer_dirty(bh);\n\t} while ((bh = bh->b_this_page) != head);\n\tspin_unlock(&mapping->private_lock);\n\t__set_page_dirty_nobuffers(page);\n\tif (unlikely(buffers_to_free)) {\n\t\tdo {\n\t\t\tbh = buffers_to_free->b_this_page;\n\t\t\tfree_buffer_head(buffers_to_free);\n\t\t\tbuffers_to_free = bh;\n\t\t} while (buffers_to_free);\n\t}\n}",
          "includes": [
            "#include \"ntfs.h\"",
            "#include \"types.h\"",
            "#include \"runlist.h\"",
            "#include \"mft.h\"",
            "#include \"inode.h\"",
            "#include \"debug.h\"",
            "#include \"attrib.h\"",
            "#include \"aops.h\"",
            "#include <linux/bit_spinlock.h>",
            "#include <linux/writeback.h>",
            "#include <linux/buffer_head.h>",
            "#include <linux/swap.h>",
            "#include <linux/pagemap.h>",
            "#include <linux/mm.h>",
            "#include <linux/gfp.h>",
            "#include <linux/fs.h>",
            "#include <linux/errno.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"ntfs.h\"\n#include \"types.h\"\n#include \"runlist.h\"\n#include \"mft.h\"\n#include \"inode.h\"\n#include \"debug.h\"\n#include \"attrib.h\"\n#include \"aops.h\"\n#include <linux/bit_spinlock.h>\n#include <linux/writeback.h>\n#include <linux/buffer_head.h>\n#include <linux/swap.h>\n#include <linux/pagemap.h>\n#include <linux/mm.h>\n#include <linux/gfp.h>\n#include <linux/fs.h>\n#include <linux/errno.h>\n\nvoid mark_ntfs_record_dirty(struct page *page, const unsigned int ofs) {\n\tstruct address_space *mapping = page->mapping;\n\tntfs_inode *ni = NTFS_I(mapping->host);\n\tstruct buffer_head *bh, *head, *buffers_to_free = NULL;\n\tunsigned int end, bh_size, bh_ofs;\n\n\tBUG_ON(!PageUptodate(page));\n\tend = ofs + ni->itype.index.block_size;\n\tbh_size = VFS_I(ni)->i_sb->s_blocksize;\n\tspin_lock(&mapping->private_lock);\n\tif (unlikely(!page_has_buffers(page))) {\n\t\tspin_unlock(&mapping->private_lock);\n\t\tbh = head = alloc_page_buffers(page, bh_size, 1);\n\t\tspin_lock(&mapping->private_lock);\n\t\tif (likely(!page_has_buffers(page))) {\n\t\t\tstruct buffer_head *tail;\n\n\t\t\tdo {\n\t\t\t\tset_buffer_uptodate(bh);\n\t\t\t\ttail = bh;\n\t\t\t\tbh = bh->b_this_page;\n\t\t\t} while (bh);\n\t\t\ttail->b_this_page = head;\n\t\t\tattach_page_buffers(page, head);\n\t\t} else\n\t\t\tbuffers_to_free = bh;\n\t}\n\tbh = head = page_buffers(page);\n\tBUG_ON(!bh);\n\tdo {\n\t\tbh_ofs = bh_offset(bh);\n\t\tif (bh_ofs + bh_size <= ofs)\n\t\t\tcontinue;\n\t\tif (unlikely(bh_ofs >= end))\n\t\t\tbreak;\n\t\tset_buffer_dirty(bh);\n\t} while ((bh = bh->b_this_page) != head);\n\tspin_unlock(&mapping->private_lock);\n\t__set_page_dirty_nobuffers(page);\n\tif (unlikely(buffers_to_free)) {\n\t\tdo {\n\t\t\tbh = buffers_to_free->b_this_page;\n\t\t\tfree_buffer_head(buffers_to_free);\n\t\t\tbuffers_to_free = bh;\n\t\t} while (buffers_to_free);\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "page_address",
          "args": [
            "ictx->page"
          ],
          "line": 143
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "mark_mft_record_dirty",
          "args": [
            "ictx->actx->ntfs_ino"
          ],
          "line": 140
        },
        "resolved": true,
        "details": {
          "function_name": "__mark_mft_record_dirty",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/ntfs/mft.c",
          "lines": "395-410",
          "snippet": "void __mark_mft_record_dirty(ntfs_inode *ni)\n{\n\tntfs_inode *base_ni;\n\n\tntfs_debug(\"Entering for inode 0x%lx.\", ni->mft_no);\n\tBUG_ON(NInoAttr(ni));\n\tmark_ntfs_record_dirty(ni->page, ni->page_ofs);\n\t/* Determine the base vfs inode and mark it dirty, too. */\n\tmutex_lock(&ni->extent_lock);\n\tif (likely(ni->nr_extents >= 0))\n\t\tbase_ni = ni;\n\telse\n\t\tbase_ni = ni->ext.base_ntfs_ino;\n\tmutex_unlock(&ni->extent_lock);\n\t__mark_inode_dirty(VFS_I(base_ni), I_DIRTY_SYNC | I_DIRTY_DATASYNC);\n}",
          "includes": [
            "#include \"ntfs.h\"",
            "#include \"mft.h\"",
            "#include \"malloc.h\"",
            "#include \"lcnalloc.h\"",
            "#include \"dir.h\"",
            "#include \"debug.h\"",
            "#include \"bitmap.h\"",
            "#include \"aops.h\"",
            "#include \"attrib.h\"",
            "#include <linux/swap.h>",
            "#include <linux/slab.h>",
            "#include <linux/buffer_head.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"ntfs.h\"\n#include \"mft.h\"\n#include \"malloc.h\"\n#include \"lcnalloc.h\"\n#include \"dir.h\"\n#include \"debug.h\"\n#include \"bitmap.h\"\n#include \"aops.h\"\n#include \"attrib.h\"\n#include <linux/swap.h>\n#include <linux/slab.h>\n#include <linux/buffer_head.h>\n\nvoid __mark_mft_record_dirty(ntfs_inode *ni)\n{\n\tntfs_inode *base_ni;\n\n\tntfs_debug(\"Entering for inode 0x%lx.\", ni->mft_no);\n\tBUG_ON(NInoAttr(ni));\n\tmark_ntfs_record_dirty(ni->page, ni->page_ofs);\n\t/* Determine the base vfs inode and mark it dirty, too. */\n\tmutex_lock(&ni->extent_lock);\n\tif (likely(ni->nr_extents >= 0))\n\t\tbase_ni = ni;\n\telse\n\t\tbase_ni = ni->ext.base_ntfs_ino;\n\tmutex_unlock(&ni->extent_lock);\n\t__mark_inode_dirty(VFS_I(base_ni), I_DIRTY_SYNC | I_DIRTY_DATASYNC);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"aops.h\"\n#include \"mft.h\"\n#include \"attrib.h\"\n#include \"inode.h\"\n#include \"layout.h\"\n#include \"types.h\"\n#include <linux/fs.h>\n\nstatic inline void ntfs_index_entry_mark_dirty(ntfs_index_context *ictx)\n{\n\tif (ictx->is_in_root)\n\t\tmark_mft_record_dirty(ictx->actx->ntfs_ino);\n\telse\n\t\tmark_ntfs_record_dirty(ictx->page,\n\t\t\t\t(u8*)ictx->ia - (u8*)page_address(ictx->page));\n}"
  },
  {
    "function_name": "ntfs_index_entry_flush_dcache_page",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/ntfs/index.h",
    "lines": "111-117",
    "snippet": "static inline void ntfs_index_entry_flush_dcache_page(ntfs_index_context *ictx)\n{\n\tif (ictx->is_in_root)\n\t\tflush_dcache_mft_record_page(ictx->actx->ntfs_ino);\n\telse\n\t\tflush_dcache_page(ictx->page);\n}",
    "includes": [
      "#include \"aops.h\"",
      "#include \"mft.h\"",
      "#include \"attrib.h\"",
      "#include \"inode.h\"",
      "#include \"layout.h\"",
      "#include \"types.h\"",
      "#include <linux/fs.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "flush_dcache_page",
          "args": [
            "ictx->page"
          ],
          "line": 116
        },
        "resolved": true,
        "details": {
          "function_name": "ntfs_index_entry_flush_dcache_page",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/ntfs/index.h",
          "lines": "111-117",
          "snippet": "static inline void ntfs_index_entry_flush_dcache_page(ntfs_index_context *ictx)\n{\n\tif (ictx->is_in_root)\n\t\tflush_dcache_mft_record_page(ictx->actx->ntfs_ino);\n\telse\n\t\tflush_dcache_page(ictx->page);\n}",
          "note": "cyclic_reference_detected"
        }
      },
      {
        "call_info": {
          "callee": "flush_dcache_mft_record_page",
          "args": [
            "ictx->actx->ntfs_ino"
          ],
          "line": 114
        },
        "resolved": true,
        "details": {
          "function_name": "flush_dcache_mft_record_page",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/ntfs/mft.h",
          "lines": "55-58",
          "snippet": "static inline void flush_dcache_mft_record_page(ntfs_inode *ni)\n{\n\tflush_dcache_page(ni->page);\n}",
          "includes": [
            "#include \"inode.h\"",
            "#include <linux/pagemap.h>",
            "#include <linux/highmem.h>",
            "#include <linux/fs.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"inode.h\"\n#include <linux/pagemap.h>\n#include <linux/highmem.h>\n#include <linux/fs.h>\n\nstatic inline void flush_dcache_mft_record_page(ntfs_inode *ni)\n{\n\tflush_dcache_page(ni->page);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"aops.h\"\n#include \"mft.h\"\n#include \"attrib.h\"\n#include \"inode.h\"\n#include \"layout.h\"\n#include \"types.h\"\n#include <linux/fs.h>\n\nstatic inline void ntfs_index_entry_flush_dcache_page(ntfs_index_context *ictx)\n{\n\tif (ictx->is_in_root)\n\t\tflush_dcache_mft_record_page(ictx->actx->ntfs_ino);\n\telse\n\t\tflush_dcache_page(ictx->page);\n}"
  }
]