[
  {
    "function_name": "exit_nls_utf8",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nls/nls_utf8.c",
    "lines": "60-63",
    "snippet": "static void __exit exit_nls_utf8(void)\n{\n        unregister_nls(&table);\n}",
    "includes": [
      "#include <linux/errno.h>",
      "#include <linux/nls.h>",
      "#include <linux/string.h>",
      "#include <linux/kernel.h>",
      "#include <linux/module.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static struct nls_table table = {\n\t.charset\t= \"utf8\",\n\t.uni2char\t= uni2char,\n\t.char2uni\t= char2uni,\n\t.charset2lower\t= identity,\t/* no conversion */\n\t.charset2upper\t= identity,\n};"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "unregister_nls",
          "args": [
            "&table"
          ],
          "line": 62
        },
        "resolved": true,
        "details": {
          "function_name": "unregister_nls",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nls/nls_base.c",
          "lines": "258-273",
          "snippet": "int unregister_nls(struct nls_table * nls)\n{\n\tstruct nls_table ** tmp = &tables;\n\n\tspin_lock(&nls_lock);\n\twhile (*tmp) {\n\t\tif (nls == *tmp) {\n\t\t\t*tmp = nls->next;\n\t\t\tspin_unlock(&nls_lock);\n\t\t\treturn 0;\n\t\t}\n\t\ttmp = &(*tmp)->next;\n\t}\n\tspin_unlock(&nls_lock);\n\treturn -EINVAL;\n}",
          "includes": [
            "#include <asm/byteorder.h>",
            "#include <linux/spinlock.h>",
            "#include <linux/kmod.h>",
            "#include <linux/errno.h>",
            "#include <linux/kernel.h>",
            "#include <linux/nls.h>",
            "#include <linux/string.h>",
            "#include <linux/module.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static struct nls_table *tables = &default_table;",
            "static DEFINE_SPINLOCK(nls_lock);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <asm/byteorder.h>\n#include <linux/spinlock.h>\n#include <linux/kmod.h>\n#include <linux/errno.h>\n#include <linux/kernel.h>\n#include <linux/nls.h>\n#include <linux/string.h>\n#include <linux/module.h>\n\nstatic struct nls_table *tables = &default_table;\nstatic DEFINE_SPINLOCK(nls_lock);\n\nint unregister_nls(struct nls_table * nls)\n{\n\tstruct nls_table ** tmp = &tables;\n\n\tspin_lock(&nls_lock);\n\twhile (*tmp) {\n\t\tif (nls == *tmp) {\n\t\t\t*tmp = nls->next;\n\t\t\tspin_unlock(&nls_lock);\n\t\t\treturn 0;\n\t\t}\n\t\ttmp = &(*tmp)->next;\n\t}\n\tspin_unlock(&nls_lock);\n\treturn -EINVAL;\n}"
        }
      }
    ],
    "contextual_snippet": "#include <linux/errno.h>\n#include <linux/nls.h>\n#include <linux/string.h>\n#include <linux/kernel.h>\n#include <linux/module.h>\n\nstatic struct nls_table table = {\n\t.charset\t= \"utf8\",\n\t.uni2char\t= uni2char,\n\t.char2uni\t= char2uni,\n\t.charset2lower\t= identity,\t/* no conversion */\n\t.charset2upper\t= identity,\n};\n\nstatic void __exit exit_nls_utf8(void)\n{\n        unregister_nls(&table);\n}"
  },
  {
    "function_name": "init_nls_utf8",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nls/nls_utf8.c",
    "lines": "51-58",
    "snippet": "static int __init init_nls_utf8(void)\n{\n\tint i;\n\tfor (i=0; i<256; i++)\n\t\tidentity[i] = i;\n\n        return register_nls(&table);\n}",
    "includes": [
      "#include <linux/errno.h>",
      "#include <linux/nls.h>",
      "#include <linux/string.h>",
      "#include <linux/kernel.h>",
      "#include <linux/module.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static unsigned char identity[256];",
      "static struct nls_table table = {\n\t.charset\t= \"utf8\",\n\t.uni2char\t= uni2char,\n\t.char2uni\t= char2uni,\n\t.charset2lower\t= identity,\t/* no conversion */\n\t.charset2upper\t= identity,\n};"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "register_nls",
          "args": [
            "&table"
          ],
          "line": 57
        },
        "resolved": true,
        "details": {
          "function_name": "unregister_nls",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nls/nls_base.c",
          "lines": "258-273",
          "snippet": "int unregister_nls(struct nls_table * nls)\n{\n\tstruct nls_table ** tmp = &tables;\n\n\tspin_lock(&nls_lock);\n\twhile (*tmp) {\n\t\tif (nls == *tmp) {\n\t\t\t*tmp = nls->next;\n\t\t\tspin_unlock(&nls_lock);\n\t\t\treturn 0;\n\t\t}\n\t\ttmp = &(*tmp)->next;\n\t}\n\tspin_unlock(&nls_lock);\n\treturn -EINVAL;\n}",
          "includes": [
            "#include <asm/byteorder.h>",
            "#include <linux/spinlock.h>",
            "#include <linux/kmod.h>",
            "#include <linux/errno.h>",
            "#include <linux/kernel.h>",
            "#include <linux/nls.h>",
            "#include <linux/string.h>",
            "#include <linux/module.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static struct nls_table *tables = &default_table;",
            "static DEFINE_SPINLOCK(nls_lock);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <asm/byteorder.h>\n#include <linux/spinlock.h>\n#include <linux/kmod.h>\n#include <linux/errno.h>\n#include <linux/kernel.h>\n#include <linux/nls.h>\n#include <linux/string.h>\n#include <linux/module.h>\n\nstatic struct nls_table *tables = &default_table;\nstatic DEFINE_SPINLOCK(nls_lock);\n\nint unregister_nls(struct nls_table * nls)\n{\n\tstruct nls_table ** tmp = &tables;\n\n\tspin_lock(&nls_lock);\n\twhile (*tmp) {\n\t\tif (nls == *tmp) {\n\t\t\t*tmp = nls->next;\n\t\t\tspin_unlock(&nls_lock);\n\t\t\treturn 0;\n\t\t}\n\t\ttmp = &(*tmp)->next;\n\t}\n\tspin_unlock(&nls_lock);\n\treturn -EINVAL;\n}"
        }
      }
    ],
    "contextual_snippet": "#include <linux/errno.h>\n#include <linux/nls.h>\n#include <linux/string.h>\n#include <linux/kernel.h>\n#include <linux/module.h>\n\nstatic unsigned char identity[256];\nstatic struct nls_table table = {\n\t.charset\t= \"utf8\",\n\t.uni2char\t= uni2char,\n\t.char2uni\t= char2uni,\n\t.charset2lower\t= identity,\t/* no conversion */\n\t.charset2upper\t= identity,\n};\n\nstatic int __init init_nls_utf8(void)\n{\n\tint i;\n\tfor (i=0; i<256; i++)\n\t\tidentity[i] = i;\n\n        return register_nls(&table);\n}"
  },
  {
    "function_name": "char2uni",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nls/nls_utf8.c",
    "lines": "29-41",
    "snippet": "static int char2uni(const unsigned char *rawstring, int boundlen, wchar_t *uni)\n{\n\tint n;\n\tunicode_t u;\n\n\tn = utf8_to_utf32(rawstring, boundlen, &u);\n\tif (n < 0 || u > MAX_WCHAR_T) {\n\t\t*uni = 0x003f;\t/* ? */\n\t\treturn -EINVAL;\n\t}\n\t*uni = (wchar_t) u;\n\treturn n;\n}",
    "includes": [
      "#include <linux/errno.h>",
      "#include <linux/nls.h>",
      "#include <linux/string.h>",
      "#include <linux/kernel.h>",
      "#include <linux/module.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "utf8_to_utf32",
          "args": [
            "rawstring",
            "boundlen",
            "&u"
          ],
          "line": 34
        },
        "resolved": true,
        "details": {
          "function_name": "utf8_to_utf32",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nls/nls_base.c",
          "lines": "55-83",
          "snippet": "int utf8_to_utf32(const u8 *s, int inlen, unicode_t *pu)\n{\n\tunsigned long l;\n\tint c0, c, nc;\n\tconst struct utf8_table *t;\n  \n\tnc = 0;\n\tc0 = *s;\n\tl = c0;\n\tfor (t = utf8_table; t->cmask; t++) {\n\t\tnc++;\n\t\tif ((c0 & t->cmask) == t->cval) {\n\t\t\tl &= t->lmask;\n\t\t\tif (l < t->lval || l > UNICODE_MAX ||\n\t\t\t\t\t(l & SURROGATE_MASK) == SURROGATE_PAIR)\n\t\t\t\treturn -1;\n\t\t\t*pu = (unicode_t) l;\n\t\t\treturn nc;\n\t\t}\n\t\tif (inlen <= nc)\n\t\t\treturn -1;\n\t\ts++;\n\t\tc = (*s ^ 0x80) & 0xFF;\n\t\tif (c & 0xC0)\n\t\t\treturn -1;\n\t\tl = (l << 6) | c;\n\t}\n\treturn -1;\n}",
          "includes": [
            "#include <asm/byteorder.h>",
            "#include <linux/spinlock.h>",
            "#include <linux/kmod.h>",
            "#include <linux/errno.h>",
            "#include <linux/kernel.h>",
            "#include <linux/nls.h>",
            "#include <linux/string.h>",
            "#include <linux/module.h>"
          ],
          "macros_used": [
            "#define SURROGATE_PAIR\t0x0000d800",
            "#define SURROGATE_MASK\t0xfffff800",
            "#define UNICODE_MAX\t0x0010ffff"
          ],
          "globals_used": [
            "static const struct utf8_table utf8_table[] =\n{\n    {0x80,  0x00,   0*6,    0x7F,           0,         /* 1 byte sequence */},\n    {0xE0,  0xC0,   1*6,    0x7FF,          0x80,      /* 2 byte sequence */},\n    {0xF0,  0xE0,   2*6,    0xFFFF,         0x800,     /* 3 byte sequence */},\n    {0xF8,  0xF0,   3*6,    0x1FFFFF,       0x10000,   /* 4 byte sequence */},\n    {0xFC,  0xF8,   4*6,    0x3FFFFFF,      0x200000,  /* 5 byte sequence */},\n    {0xFE,  0xFC,   5*6,    0x7FFFFFFF,     0x4000000, /* 6 byte sequence */},\n    {0,\t\t\t\t\t\t       /* end of table    */}\n};"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <asm/byteorder.h>\n#include <linux/spinlock.h>\n#include <linux/kmod.h>\n#include <linux/errno.h>\n#include <linux/kernel.h>\n#include <linux/nls.h>\n#include <linux/string.h>\n#include <linux/module.h>\n\n#define SURROGATE_PAIR\t0x0000d800\n#define SURROGATE_MASK\t0xfffff800\n#define UNICODE_MAX\t0x0010ffff\n\nstatic const struct utf8_table utf8_table[] =\n{\n    {0x80,  0x00,   0*6,    0x7F,           0,         /* 1 byte sequence */},\n    {0xE0,  0xC0,   1*6,    0x7FF,          0x80,      /* 2 byte sequence */},\n    {0xF0,  0xE0,   2*6,    0xFFFF,         0x800,     /* 3 byte sequence */},\n    {0xF8,  0xF0,   3*6,    0x1FFFFF,       0x10000,   /* 4 byte sequence */},\n    {0xFC,  0xF8,   4*6,    0x3FFFFFF,      0x200000,  /* 5 byte sequence */},\n    {0xFE,  0xFC,   5*6,    0x7FFFFFFF,     0x4000000, /* 6 byte sequence */},\n    {0,\t\t\t\t\t\t       /* end of table    */}\n};\n\nint utf8_to_utf32(const u8 *s, int inlen, unicode_t *pu)\n{\n\tunsigned long l;\n\tint c0, c, nc;\n\tconst struct utf8_table *t;\n  \n\tnc = 0;\n\tc0 = *s;\n\tl = c0;\n\tfor (t = utf8_table; t->cmask; t++) {\n\t\tnc++;\n\t\tif ((c0 & t->cmask) == t->cval) {\n\t\t\tl &= t->lmask;\n\t\t\tif (l < t->lval || l > UNICODE_MAX ||\n\t\t\t\t\t(l & SURROGATE_MASK) == SURROGATE_PAIR)\n\t\t\t\treturn -1;\n\t\t\t*pu = (unicode_t) l;\n\t\t\treturn nc;\n\t\t}\n\t\tif (inlen <= nc)\n\t\t\treturn -1;\n\t\ts++;\n\t\tc = (*s ^ 0x80) & 0xFF;\n\t\tif (c & 0xC0)\n\t\t\treturn -1;\n\t\tl = (l << 6) | c;\n\t}\n\treturn -1;\n}"
        }
      }
    ],
    "contextual_snippet": "#include <linux/errno.h>\n#include <linux/nls.h>\n#include <linux/string.h>\n#include <linux/kernel.h>\n#include <linux/module.h>\n\nstatic int char2uni(const unsigned char *rawstring, int boundlen, wchar_t *uni)\n{\n\tint n;\n\tunicode_t u;\n\n\tn = utf8_to_utf32(rawstring, boundlen, &u);\n\tif (n < 0 || u > MAX_WCHAR_T) {\n\t\t*uni = 0x003f;\t/* ? */\n\t\treturn -EINVAL;\n\t}\n\t*uni = (wchar_t) u;\n\treturn n;\n}"
  },
  {
    "function_name": "uni2char",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nls/nls_utf8.c",
    "lines": "14-27",
    "snippet": "static int uni2char(wchar_t uni, unsigned char *out, int boundlen)\n{\n\tint n;\n\n\tif (boundlen <= 0)\n\t\treturn -ENAMETOOLONG;\n\n\tn = utf32_to_utf8(uni, out, boundlen);\n\tif (n < 0) {\n\t\t*out = '?';\n\t\treturn -EINVAL;\n\t}\n\treturn n;\n}",
    "includes": [
      "#include <linux/errno.h>",
      "#include <linux/nls.h>",
      "#include <linux/string.h>",
      "#include <linux/kernel.h>",
      "#include <linux/module.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "utf32_to_utf8",
          "args": [
            "uni",
            "out",
            "boundlen"
          ],
          "line": 21
        },
        "resolved": true,
        "details": {
          "function_name": "utf32_to_utf8",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nls/nls_base.c",
          "lines": "86-114",
          "snippet": "int utf32_to_utf8(unicode_t u, u8 *s, int maxout)\n{\n\tunsigned long l;\n\tint c, nc;\n\tconst struct utf8_table *t;\n\n\tif (!s)\n\t\treturn 0;\n\n\tl = u;\n\tif (l > UNICODE_MAX || (l & SURROGATE_MASK) == SURROGATE_PAIR)\n\t\treturn -1;\n\n\tnc = 0;\n\tfor (t = utf8_table; t->cmask && maxout; t++, maxout--) {\n\t\tnc++;\n\t\tif (l <= t->lmask) {\n\t\t\tc = t->shift;\n\t\t\t*s = (u8) (t->cval | (l >> c));\n\t\t\twhile (c > 0) {\n\t\t\t\tc -= 6;\n\t\t\t\ts++;\n\t\t\t\t*s = (u8) (0x80 | ((l >> c) & 0x3F));\n\t\t\t}\n\t\t\treturn nc;\n\t\t}\n\t}\n\treturn -1;\n}",
          "includes": [
            "#include <asm/byteorder.h>",
            "#include <linux/spinlock.h>",
            "#include <linux/kmod.h>",
            "#include <linux/errno.h>",
            "#include <linux/kernel.h>",
            "#include <linux/nls.h>",
            "#include <linux/string.h>",
            "#include <linux/module.h>"
          ],
          "macros_used": [
            "#define SURROGATE_PAIR\t0x0000d800",
            "#define SURROGATE_MASK\t0xfffff800",
            "#define UNICODE_MAX\t0x0010ffff"
          ],
          "globals_used": [
            "static const struct utf8_table utf8_table[] =\n{\n    {0x80,  0x00,   0*6,    0x7F,           0,         /* 1 byte sequence */},\n    {0xE0,  0xC0,   1*6,    0x7FF,          0x80,      /* 2 byte sequence */},\n    {0xF0,  0xE0,   2*6,    0xFFFF,         0x800,     /* 3 byte sequence */},\n    {0xF8,  0xF0,   3*6,    0x1FFFFF,       0x10000,   /* 4 byte sequence */},\n    {0xFC,  0xF8,   4*6,    0x3FFFFFF,      0x200000,  /* 5 byte sequence */},\n    {0xFE,  0xFC,   5*6,    0x7FFFFFFF,     0x4000000, /* 6 byte sequence */},\n    {0,\t\t\t\t\t\t       /* end of table    */}\n};"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <asm/byteorder.h>\n#include <linux/spinlock.h>\n#include <linux/kmod.h>\n#include <linux/errno.h>\n#include <linux/kernel.h>\n#include <linux/nls.h>\n#include <linux/string.h>\n#include <linux/module.h>\n\n#define SURROGATE_PAIR\t0x0000d800\n#define SURROGATE_MASK\t0xfffff800\n#define UNICODE_MAX\t0x0010ffff\n\nstatic const struct utf8_table utf8_table[] =\n{\n    {0x80,  0x00,   0*6,    0x7F,           0,         /* 1 byte sequence */},\n    {0xE0,  0xC0,   1*6,    0x7FF,          0x80,      /* 2 byte sequence */},\n    {0xF0,  0xE0,   2*6,    0xFFFF,         0x800,     /* 3 byte sequence */},\n    {0xF8,  0xF0,   3*6,    0x1FFFFF,       0x10000,   /* 4 byte sequence */},\n    {0xFC,  0xF8,   4*6,    0x3FFFFFF,      0x200000,  /* 5 byte sequence */},\n    {0xFE,  0xFC,   5*6,    0x7FFFFFFF,     0x4000000, /* 6 byte sequence */},\n    {0,\t\t\t\t\t\t       /* end of table    */}\n};\n\nint utf32_to_utf8(unicode_t u, u8 *s, int maxout)\n{\n\tunsigned long l;\n\tint c, nc;\n\tconst struct utf8_table *t;\n\n\tif (!s)\n\t\treturn 0;\n\n\tl = u;\n\tif (l > UNICODE_MAX || (l & SURROGATE_MASK) == SURROGATE_PAIR)\n\t\treturn -1;\n\n\tnc = 0;\n\tfor (t = utf8_table; t->cmask && maxout; t++, maxout--) {\n\t\tnc++;\n\t\tif (l <= t->lmask) {\n\t\t\tc = t->shift;\n\t\t\t*s = (u8) (t->cval | (l >> c));\n\t\t\twhile (c > 0) {\n\t\t\t\tc -= 6;\n\t\t\t\ts++;\n\t\t\t\t*s = (u8) (0x80 | ((l >> c) & 0x3F));\n\t\t\t}\n\t\t\treturn nc;\n\t\t}\n\t}\n\treturn -1;\n}"
        }
      }
    ],
    "contextual_snippet": "#include <linux/errno.h>\n#include <linux/nls.h>\n#include <linux/string.h>\n#include <linux/kernel.h>\n#include <linux/module.h>\n\nstatic int uni2char(wchar_t uni, unsigned char *out, int boundlen)\n{\n\tint n;\n\n\tif (boundlen <= 0)\n\t\treturn -ENAMETOOLONG;\n\n\tn = utf32_to_utf8(uni, out, boundlen);\n\tif (n < 0) {\n\t\t*out = '?';\n\t\treturn -EINVAL;\n\t}\n\treturn n;\n}"
  }
]