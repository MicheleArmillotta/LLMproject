[
  {
    "function_name": "hfs_file_truncate",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/hfs/extent.c",
    "lines": "470-545",
    "snippet": "void hfs_file_truncate(struct inode *inode)\n{\n\tstruct super_block *sb = inode->i_sb;\n\tstruct hfs_find_data fd;\n\tu16 blk_cnt, alloc_cnt, start;\n\tu32 size;\n\tint res;\n\n\thfs_dbg(INODE, \"truncate: %lu, %Lu -> %Lu\\n\",\n\t\tinode->i_ino, (long long)HFS_I(inode)->phys_size,\n\t\tinode->i_size);\n\tif (inode->i_size > HFS_I(inode)->phys_size) {\n\t\tstruct address_space *mapping = inode->i_mapping;\n\t\tvoid *fsdata;\n\t\tstruct page *page;\n\n\t\t/* XXX: Can use generic_cont_expand? */\n\t\tsize = inode->i_size - 1;\n\t\tres = pagecache_write_begin(NULL, mapping, size+1, 0,\n\t\t\t\tAOP_FLAG_UNINTERRUPTIBLE, &page, &fsdata);\n\t\tif (!res) {\n\t\t\tres = pagecache_write_end(NULL, mapping, size+1, 0, 0,\n\t\t\t\t\tpage, fsdata);\n\t\t}\n\t\tif (res)\n\t\t\tinode->i_size = HFS_I(inode)->phys_size;\n\t\treturn;\n\t} else if (inode->i_size == HFS_I(inode)->phys_size)\n\t\treturn;\n\tsize = inode->i_size + HFS_SB(sb)->alloc_blksz - 1;\n\tblk_cnt = size / HFS_SB(sb)->alloc_blksz;\n\talloc_cnt = HFS_I(inode)->alloc_blocks;\n\tif (blk_cnt == alloc_cnt)\n\t\tgoto out;\n\n\tmutex_lock(&HFS_I(inode)->extents_lock);\n\tres = hfs_find_init(HFS_SB(sb)->ext_tree, &fd);\n\tif (res) {\n\t\tmutex_unlock(&HFS_I(inode)->extents_lock);\n\t\t/* XXX: We lack error handling of hfs_file_truncate() */\n\t\treturn;\n\t}\n\twhile (1) {\n\t\tif (alloc_cnt == HFS_I(inode)->first_blocks) {\n\t\t\thfs_free_extents(sb, HFS_I(inode)->first_extents,\n\t\t\t\t\t alloc_cnt, alloc_cnt - blk_cnt);\n\t\t\thfs_dump_extent(HFS_I(inode)->first_extents);\n\t\t\tHFS_I(inode)->first_blocks = blk_cnt;\n\t\t\tbreak;\n\t\t}\n\t\tres = __hfs_ext_cache_extent(&fd, inode, alloc_cnt);\n\t\tif (res)\n\t\t\tbreak;\n\t\tstart = HFS_I(inode)->cached_start;\n\t\thfs_free_extents(sb, HFS_I(inode)->cached_extents,\n\t\t\t\t alloc_cnt - start, alloc_cnt - blk_cnt);\n\t\thfs_dump_extent(HFS_I(inode)->cached_extents);\n\t\tif (blk_cnt > start) {\n\t\t\tHFS_I(inode)->flags |= HFS_FLG_EXT_DIRTY;\n\t\t\tbreak;\n\t\t}\n\t\talloc_cnt = start;\n\t\tHFS_I(inode)->cached_start = HFS_I(inode)->cached_blocks = 0;\n\t\tHFS_I(inode)->flags &= ~(HFS_FLG_EXT_DIRTY|HFS_FLG_EXT_NEW);\n\t\thfs_brec_remove(&fd);\n\t}\n\thfs_find_exit(&fd);\n\tmutex_unlock(&HFS_I(inode)->extents_lock);\n\n\tHFS_I(inode)->alloc_blocks = blk_cnt;\nout:\n\tHFS_I(inode)->phys_size = inode->i_size;\n\tHFS_I(inode)->fs_blocks = (inode->i_size + sb->s_blocksize - 1) >> sb->s_blocksize_bits;\n\tinode_set_bytes(inode, HFS_I(inode)->fs_blocks << sb->s_blocksize_bits);\n\tmark_inode_dirty(inode);\n}",
    "includes": [
      "#include \"btree.h\"",
      "#include \"hfs_fs.h\"",
      "#include <linux/pagemap.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "mark_inode_dirty",
          "args": [
            "inode"
          ],
          "line": 544
        },
        "resolved": true,
        "details": {
          "function_name": "block_dump___mark_inode_dirty",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/fs-writeback.c",
          "lines": "1134-1154",
          "snippet": "static noinline void block_dump___mark_inode_dirty(struct inode *inode)\n{\n\tif (inode->i_ino || strcmp(inode->i_sb->s_id, \"bdev\")) {\n\t\tstruct dentry *dentry;\n\t\tconst char *name = \"?\";\n\n\t\tdentry = d_find_alias(inode);\n\t\tif (dentry) {\n\t\t\tspin_lock(&dentry->d_lock);\n\t\t\tname = (const char *) dentry->d_name.name;\n\t\t}\n\t\tprintk(KERN_DEBUG\n\t\t       \"%s(%d): dirtied inode %lu (%s) on %s\\n\",\n\t\t       current->comm, task_pid_nr(current), inode->i_ino,\n\t\t       name, inode->i_sb->s_id);\n\t\tif (dentry) {\n\t\t\tspin_unlock(&dentry->d_lock);\n\t\t\tdput(dentry);\n\t\t}\n\t}\n}",
          "includes": [
            "#include <trace/events/writeback.h>",
            "#include \"internal.h\"",
            "#include <linux/device.h>",
            "#include <linux/tracepoint.h>",
            "#include <linux/backing-dev.h>",
            "#include <linux/blkdev.h>",
            "#include <linux/writeback.h>",
            "#include <linux/kthread.h>",
            "#include <linux/pagemap.h>",
            "#include <linux/mm.h>",
            "#include <linux/fs.h>",
            "#include <linux/sched.h>",
            "#include <linux/slab.h>",
            "#include <linux/spinlock.h>",
            "#include <linux/export.h>",
            "#include <linux/kernel.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <trace/events/writeback.h>\n#include \"internal.h\"\n#include <linux/device.h>\n#include <linux/tracepoint.h>\n#include <linux/backing-dev.h>\n#include <linux/blkdev.h>\n#include <linux/writeback.h>\n#include <linux/kthread.h>\n#include <linux/pagemap.h>\n#include <linux/mm.h>\n#include <linux/fs.h>\n#include <linux/sched.h>\n#include <linux/slab.h>\n#include <linux/spinlock.h>\n#include <linux/export.h>\n#include <linux/kernel.h>\n\nstatic noinline void block_dump___mark_inode_dirty(struct inode *inode)\n{\n\tif (inode->i_ino || strcmp(inode->i_sb->s_id, \"bdev\")) {\n\t\tstruct dentry *dentry;\n\t\tconst char *name = \"?\";\n\n\t\tdentry = d_find_alias(inode);\n\t\tif (dentry) {\n\t\t\tspin_lock(&dentry->d_lock);\n\t\t\tname = (const char *) dentry->d_name.name;\n\t\t}\n\t\tprintk(KERN_DEBUG\n\t\t       \"%s(%d): dirtied inode %lu (%s) on %s\\n\",\n\t\t       current->comm, task_pid_nr(current), inode->i_ino,\n\t\t       name, inode->i_sb->s_id);\n\t\tif (dentry) {\n\t\t\tspin_unlock(&dentry->d_lock);\n\t\t\tdput(dentry);\n\t\t}\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "inode_set_bytes",
          "args": [
            "inode",
            "HFS_I(inode)->fs_blocks << sb->s_blocksize_bits"
          ],
          "line": 543
        },
        "resolved": true,
        "details": {
          "function_name": "inode_set_bytes",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/stat.c",
          "lines": "503-509",
          "snippet": "void inode_set_bytes(struct inode *inode, loff_t bytes)\n{\n\t/* Caller is here responsible for sufficient locking\n\t * (ie. inode->i_lock) */\n\tinode->i_blocks = bytes >> 9;\n\tinode->i_bytes = bytes & 511;\n}",
          "includes": [
            "#include <asm/unistd.h>",
            "#include <asm/uaccess.h>",
            "#include <linux/pagemap.h>",
            "#include <linux/syscalls.h>",
            "#include <linux/security.h>",
            "#include <linux/namei.h>",
            "#include <linux/fs.h>",
            "#include <linux/highuid.h>",
            "#include <linux/file.h>",
            "#include <linux/errno.h>",
            "#include <linux/mm.h>",
            "#include <linux/export.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <asm/unistd.h>\n#include <asm/uaccess.h>\n#include <linux/pagemap.h>\n#include <linux/syscalls.h>\n#include <linux/security.h>\n#include <linux/namei.h>\n#include <linux/fs.h>\n#include <linux/highuid.h>\n#include <linux/file.h>\n#include <linux/errno.h>\n#include <linux/mm.h>\n#include <linux/export.h>\n\nvoid inode_set_bytes(struct inode *inode, loff_t bytes)\n{\n\t/* Caller is here responsible for sufficient locking\n\t * (ie. inode->i_lock) */\n\tinode->i_blocks = bytes >> 9;\n\tinode->i_bytes = bytes & 511;\n}"
        }
      },
      {
        "call_info": {
          "callee": "HFS_I",
          "args": [
            "inode"
          ],
          "line": 543
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "HFS_I",
          "args": [
            "inode"
          ],
          "line": 542
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "HFS_I",
          "args": [
            "inode"
          ],
          "line": 541
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "HFS_I",
          "args": [
            "inode"
          ],
          "line": 539
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "mutex_unlock",
          "args": [
            "&HFS_I(inode)->extents_lock"
          ],
          "line": 537
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "HFS_I",
          "args": [
            "inode"
          ],
          "line": 537
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "hfs_find_exit",
          "args": [
            "&fd"
          ],
          "line": 536
        },
        "resolved": true,
        "details": {
          "function_name": "hfs_find_exit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/hfs/bfind.c",
          "lines": "31-39",
          "snippet": "void hfs_find_exit(struct hfs_find_data *fd)\n{\n\thfs_bnode_put(fd->bnode);\n\tkfree(fd->search_key);\n\thfs_dbg(BNODE_REFS, \"find_exit: %d (%p)\\n\",\n\t\tfd->tree->cnid, __builtin_return_address(0));\n\tmutex_unlock(&fd->tree->tree_lock);\n\tfd->tree = NULL;\n}",
          "includes": [
            "#include \"btree.h\"",
            "#include <linux/slab.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"btree.h\"\n#include <linux/slab.h>\n\nvoid hfs_find_exit(struct hfs_find_data *fd)\n{\n\thfs_bnode_put(fd->bnode);\n\tkfree(fd->search_key);\n\thfs_dbg(BNODE_REFS, \"find_exit: %d (%p)\\n\",\n\t\tfd->tree->cnid, __builtin_return_address(0));\n\tmutex_unlock(&fd->tree->tree_lock);\n\tfd->tree = NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "hfs_brec_remove",
          "args": [
            "&fd"
          ],
          "line": 534
        },
        "resolved": true,
        "details": {
          "function_name": "hfs_brec_remove",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/hfs/brec.c",
          "lines": "175-227",
          "snippet": "int hfs_brec_remove(struct hfs_find_data *fd)\n{\n\tstruct hfs_btree *tree;\n\tstruct hfs_bnode *node, *parent;\n\tint end_off, rec_off, data_off, size;\n\n\ttree = fd->tree;\n\tnode = fd->bnode;\nagain:\n\trec_off = tree->node_size - (fd->record + 2) * 2;\n\tend_off = tree->node_size - (node->num_recs + 1) * 2;\n\n\tif (node->type == HFS_NODE_LEAF) {\n\t\ttree->leaf_count--;\n\t\tmark_inode_dirty(tree->inode);\n\t}\n\thfs_bnode_dump(node);\n\thfs_dbg(BNODE_MOD, \"remove_rec: %d, %d\\n\",\n\t\tfd->record, fd->keylength + fd->entrylength);\n\tif (!--node->num_recs) {\n\t\thfs_bnode_unlink(node);\n\t\tif (!node->parent)\n\t\t\treturn 0;\n\t\tparent = hfs_bnode_find(tree, node->parent);\n\t\tif (IS_ERR(parent))\n\t\t\treturn PTR_ERR(parent);\n\t\thfs_bnode_put(node);\n\t\tnode = fd->bnode = parent;\n\n\t\t__hfs_brec_find(node, fd);\n\t\tgoto again;\n\t}\n\thfs_bnode_write_u16(node, offsetof(struct hfs_bnode_desc, num_recs), node->num_recs);\n\n\tif (rec_off == end_off)\n\t\tgoto skip;\n\tsize = fd->keylength + fd->entrylength;\n\n\tdo {\n\t\tdata_off = hfs_bnode_read_u16(node, rec_off);\n\t\thfs_bnode_write_u16(node, rec_off + 2, data_off - size);\n\t\trec_off -= 2;\n\t} while (rec_off >= end_off);\n\n\t/* fill hole */\n\thfs_bnode_move(node, fd->keyoffset, fd->keyoffset + size,\n\t\t       data_off - fd->keyoffset - size);\nskip:\n\thfs_bnode_dump(node);\n\tif (!fd->record)\n\t\thfs_brec_update_parent(fd);\n\treturn 0;\n}",
          "includes": [
            "#include \"btree.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static struct hfs_bnode *hfs_bnode_split(struct hfs_find_data *fd);",
            "static int hfs_brec_update_parent(struct hfs_find_data *fd);",
            "static int hfs_btree_inc_height(struct hfs_btree *tree);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"btree.h\"\n\nstatic struct hfs_bnode *hfs_bnode_split(struct hfs_find_data *fd);\nstatic int hfs_brec_update_parent(struct hfs_find_data *fd);\nstatic int hfs_btree_inc_height(struct hfs_btree *tree);\n\nint hfs_brec_remove(struct hfs_find_data *fd)\n{\n\tstruct hfs_btree *tree;\n\tstruct hfs_bnode *node, *parent;\n\tint end_off, rec_off, data_off, size;\n\n\ttree = fd->tree;\n\tnode = fd->bnode;\nagain:\n\trec_off = tree->node_size - (fd->record + 2) * 2;\n\tend_off = tree->node_size - (node->num_recs + 1) * 2;\n\n\tif (node->type == HFS_NODE_LEAF) {\n\t\ttree->leaf_count--;\n\t\tmark_inode_dirty(tree->inode);\n\t}\n\thfs_bnode_dump(node);\n\thfs_dbg(BNODE_MOD, \"remove_rec: %d, %d\\n\",\n\t\tfd->record, fd->keylength + fd->entrylength);\n\tif (!--node->num_recs) {\n\t\thfs_bnode_unlink(node);\n\t\tif (!node->parent)\n\t\t\treturn 0;\n\t\tparent = hfs_bnode_find(tree, node->parent);\n\t\tif (IS_ERR(parent))\n\t\t\treturn PTR_ERR(parent);\n\t\thfs_bnode_put(node);\n\t\tnode = fd->bnode = parent;\n\n\t\t__hfs_brec_find(node, fd);\n\t\tgoto again;\n\t}\n\thfs_bnode_write_u16(node, offsetof(struct hfs_bnode_desc, num_recs), node->num_recs);\n\n\tif (rec_off == end_off)\n\t\tgoto skip;\n\tsize = fd->keylength + fd->entrylength;\n\n\tdo {\n\t\tdata_off = hfs_bnode_read_u16(node, rec_off);\n\t\thfs_bnode_write_u16(node, rec_off + 2, data_off - size);\n\t\trec_off -= 2;\n\t} while (rec_off >= end_off);\n\n\t/* fill hole */\n\thfs_bnode_move(node, fd->keyoffset, fd->keyoffset + size,\n\t\t       data_off - fd->keyoffset - size);\nskip:\n\thfs_bnode_dump(node);\n\tif (!fd->record)\n\t\thfs_brec_update_parent(fd);\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "HFS_I",
          "args": [
            "inode"
          ],
          "line": 533
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "HFS_I",
          "args": [
            "inode"
          ],
          "line": 532
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "HFS_I",
          "args": [
            "inode"
          ],
          "line": 532
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "HFS_I",
          "args": [
            "inode"
          ],
          "line": 528
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "hfs_dump_extent",
          "args": [
            "HFS_I(inode)->cached_extents"
          ],
          "line": 526
        },
        "resolved": true,
        "details": {
          "function_name": "hfs_dump_extent",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/hfs/extent.c",
          "lines": "204-214",
          "snippet": "static void hfs_dump_extent(struct hfs_extent *extent)\n{\n\tint i;\n\n\thfs_dbg(EXTENT, \"   \");\n\tfor (i = 0; i < 3; i++)\n\t\thfs_dbg_cont(EXTENT, \" %u:%u\",\n\t\t\t     be16_to_cpu(extent[i].block),\n\t\t\t     be16_to_cpu(extent[i].count));\n\thfs_dbg_cont(EXTENT, \"\\n\");\n}",
          "includes": [
            "#include \"btree.h\"",
            "#include \"hfs_fs.h\"",
            "#include <linux/pagemap.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"btree.h\"\n#include \"hfs_fs.h\"\n#include <linux/pagemap.h>\n\nstatic void hfs_dump_extent(struct hfs_extent *extent)\n{\n\tint i;\n\n\thfs_dbg(EXTENT, \"   \");\n\tfor (i = 0; i < 3; i++)\n\t\thfs_dbg_cont(EXTENT, \" %u:%u\",\n\t\t\t     be16_to_cpu(extent[i].block),\n\t\t\t     be16_to_cpu(extent[i].count));\n\thfs_dbg_cont(EXTENT, \"\\n\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "HFS_I",
          "args": [
            "inode"
          ],
          "line": 526
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "hfs_free_extents",
          "args": [
            "sb",
            "HFS_I(inode)->cached_extents",
            "alloc_cnt - start",
            "alloc_cnt - blk_cnt"
          ],
          "line": 524
        },
        "resolved": true,
        "details": {
          "function_name": "hfs_free_extents",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/hfs/extent.c",
          "lines": "244-281",
          "snippet": "static int hfs_free_extents(struct super_block *sb, struct hfs_extent *extent,\n\t\t\t    u16 offset, u16 block_nr)\n{\n\tu16 count, start;\n\tint i;\n\n\thfs_dump_extent(extent);\n\tfor (i = 0; i < 3; extent++, i++) {\n\t\tcount = be16_to_cpu(extent->count);\n\t\tif (offset == count)\n\t\t\tgoto found;\n\t\telse if (offset < count)\n\t\t\tbreak;\n\t\toffset -= count;\n\t}\n\t/* panic? */\n\treturn -EIO;\nfound:\n\tfor (;;) {\n\t\tstart = be16_to_cpu(extent->block);\n\t\tif (count <= block_nr) {\n\t\t\thfs_clear_vbm_bits(sb, start, count);\n\t\t\textent->block = 0;\n\t\t\textent->count = 0;\n\t\t\tblock_nr -= count;\n\t\t} else {\n\t\t\tcount -= block_nr;\n\t\t\thfs_clear_vbm_bits(sb, start + count, block_nr);\n\t\t\textent->count = cpu_to_be16(count);\n\t\t\tblock_nr = 0;\n\t\t}\n\t\tif (!block_nr || !i)\n\t\t\treturn 0;\n\t\ti--;\n\t\textent--;\n\t\tcount = be16_to_cpu(extent->count);\n\t}\n}",
          "includes": [
            "#include \"btree.h\"",
            "#include \"hfs_fs.h\"",
            "#include <linux/pagemap.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"btree.h\"\n#include \"hfs_fs.h\"\n#include <linux/pagemap.h>\n\nstatic int hfs_free_extents(struct super_block *sb, struct hfs_extent *extent,\n\t\t\t    u16 offset, u16 block_nr)\n{\n\tu16 count, start;\n\tint i;\n\n\thfs_dump_extent(extent);\n\tfor (i = 0; i < 3; extent++, i++) {\n\t\tcount = be16_to_cpu(extent->count);\n\t\tif (offset == count)\n\t\t\tgoto found;\n\t\telse if (offset < count)\n\t\t\tbreak;\n\t\toffset -= count;\n\t}\n\t/* panic? */\n\treturn -EIO;\nfound:\n\tfor (;;) {\n\t\tstart = be16_to_cpu(extent->block);\n\t\tif (count <= block_nr) {\n\t\t\thfs_clear_vbm_bits(sb, start, count);\n\t\t\textent->block = 0;\n\t\t\textent->count = 0;\n\t\t\tblock_nr -= count;\n\t\t} else {\n\t\t\tcount -= block_nr;\n\t\t\thfs_clear_vbm_bits(sb, start + count, block_nr);\n\t\t\textent->count = cpu_to_be16(count);\n\t\t\tblock_nr = 0;\n\t\t}\n\t\tif (!block_nr || !i)\n\t\t\treturn 0;\n\t\ti--;\n\t\textent--;\n\t\tcount = be16_to_cpu(extent->count);\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "HFS_I",
          "args": [
            "inode"
          ],
          "line": 524
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "HFS_I",
          "args": [
            "inode"
          ],
          "line": 523
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "__hfs_ext_cache_extent",
          "args": [
            "&fd",
            "inode",
            "alloc_cnt"
          ],
          "line": 520
        },
        "resolved": true,
        "details": {
          "function_name": "__hfs_ext_cache_extent",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/hfs/extent.c",
          "lines": "165-185",
          "snippet": "static inline int __hfs_ext_cache_extent(struct hfs_find_data *fd, struct inode *inode, u32 block)\n{\n\tint res;\n\n\tif (HFS_I(inode)->flags & HFS_FLG_EXT_DIRTY) {\n\t\tres = __hfs_ext_write_extent(inode, fd);\n\t\tif (res)\n\t\t\treturn res;\n\t}\n\n\tres = __hfs_ext_read_extent(fd, HFS_I(inode)->cached_extents, inode->i_ino,\n\t\t\t\t    block, HFS_IS_RSRC(inode) ? HFS_FK_RSRC : HFS_FK_DATA);\n\tif (!res) {\n\t\tHFS_I(inode)->cached_start = be16_to_cpu(fd->key->ext.FABN);\n\t\tHFS_I(inode)->cached_blocks = hfs_ext_block_count(HFS_I(inode)->cached_extents);\n\t} else {\n\t\tHFS_I(inode)->cached_start = HFS_I(inode)->cached_blocks = 0;\n\t\tHFS_I(inode)->flags &= ~(HFS_FLG_EXT_DIRTY|HFS_FLG_EXT_NEW);\n\t}\n\treturn res;\n}",
          "includes": [
            "#include \"btree.h\"",
            "#include \"hfs_fs.h\"",
            "#include <linux/pagemap.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"btree.h\"\n#include \"hfs_fs.h\"\n#include <linux/pagemap.h>\n\nstatic inline int __hfs_ext_cache_extent(struct hfs_find_data *fd, struct inode *inode, u32 block)\n{\n\tint res;\n\n\tif (HFS_I(inode)->flags & HFS_FLG_EXT_DIRTY) {\n\t\tres = __hfs_ext_write_extent(inode, fd);\n\t\tif (res)\n\t\t\treturn res;\n\t}\n\n\tres = __hfs_ext_read_extent(fd, HFS_I(inode)->cached_extents, inode->i_ino,\n\t\t\t\t    block, HFS_IS_RSRC(inode) ? HFS_FK_RSRC : HFS_FK_DATA);\n\tif (!res) {\n\t\tHFS_I(inode)->cached_start = be16_to_cpu(fd->key->ext.FABN);\n\t\tHFS_I(inode)->cached_blocks = hfs_ext_block_count(HFS_I(inode)->cached_extents);\n\t} else {\n\t\tHFS_I(inode)->cached_start = HFS_I(inode)->cached_blocks = 0;\n\t\tHFS_I(inode)->flags &= ~(HFS_FLG_EXT_DIRTY|HFS_FLG_EXT_NEW);\n\t}\n\treturn res;\n}"
        }
      },
      {
        "call_info": {
          "callee": "HFS_I",
          "args": [
            "inode"
          ],
          "line": 517
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "HFS_I",
          "args": [
            "inode"
          ],
          "line": 516
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "HFS_I",
          "args": [
            "inode"
          ],
          "line": 514
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "HFS_I",
          "args": [
            "inode"
          ],
          "line": 513
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "mutex_unlock",
          "args": [
            "&HFS_I(inode)->extents_lock"
          ],
          "line": 508
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "HFS_I",
          "args": [
            "inode"
          ],
          "line": 508
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "hfs_find_init",
          "args": [
            "HFS_SB(sb)->ext_tree",
            "&fd"
          ],
          "line": 506
        },
        "resolved": true,
        "details": {
          "function_name": "hfs_find_init",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/hfs/bfind.c",
          "lines": "14-29",
          "snippet": "int hfs_find_init(struct hfs_btree *tree, struct hfs_find_data *fd)\n{\n\tvoid *ptr;\n\n\tfd->tree = tree;\n\tfd->bnode = NULL;\n\tptr = kmalloc(tree->max_key_len * 2 + 4, GFP_KERNEL);\n\tif (!ptr)\n\t\treturn -ENOMEM;\n\tfd->search_key = ptr;\n\tfd->key = ptr + tree->max_key_len + 2;\n\thfs_dbg(BNODE_REFS, \"find_init: %d (%p)\\n\",\n\t\ttree->cnid, __builtin_return_address(0));\n\tmutex_lock(&tree->tree_lock);\n\treturn 0;\n}",
          "includes": [
            "#include \"btree.h\"",
            "#include <linux/slab.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"btree.h\"\n#include <linux/slab.h>\n\nint hfs_find_init(struct hfs_btree *tree, struct hfs_find_data *fd)\n{\n\tvoid *ptr;\n\n\tfd->tree = tree;\n\tfd->bnode = NULL;\n\tptr = kmalloc(tree->max_key_len * 2 + 4, GFP_KERNEL);\n\tif (!ptr)\n\t\treturn -ENOMEM;\n\tfd->search_key = ptr;\n\tfd->key = ptr + tree->max_key_len + 2;\n\thfs_dbg(BNODE_REFS, \"find_init: %d (%p)\\n\",\n\t\ttree->cnid, __builtin_return_address(0));\n\tmutex_lock(&tree->tree_lock);\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "HFS_SB",
          "args": [
            "sb"
          ],
          "line": 506
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "mutex_lock",
          "args": [
            "&HFS_I(inode)->extents_lock"
          ],
          "line": 505
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "HFS_I",
          "args": [
            "inode"
          ],
          "line": 505
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "HFS_I",
          "args": [
            "inode"
          ],
          "line": 501
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "HFS_SB",
          "args": [
            "sb"
          ],
          "line": 500
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "HFS_SB",
          "args": [
            "sb"
          ],
          "line": 499
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "HFS_I",
          "args": [
            "inode"
          ],
          "line": 497
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "HFS_I",
          "args": [
            "inode"
          ],
          "line": 495
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pagecache_write_end",
          "args": [
            "NULL",
            "mapping",
            "size+1",
            "0",
            "0",
            "page",
            "fsdata"
          ],
          "line": 491
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pagecache_write_begin",
          "args": [
            "NULL",
            "mapping",
            "size+1",
            "0",
            "AOP_FLAG_UNINTERRUPTIBLE",
            "&page",
            "&fsdata"
          ],
          "line": 488
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "HFS_I",
          "args": [
            "inode"
          ],
          "line": 481
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "hfs_dbg",
          "args": [
            "INODE",
            "\"truncate: %lu, %Lu -> %Lu\\n\"",
            "inode->i_ino",
            "(long long)HFS_I(inode)->phys_size",
            "inode->i_size"
          ],
          "line": 478
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "HFS_I",
          "args": [
            "inode"
          ],
          "line": 479
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"btree.h\"\n#include \"hfs_fs.h\"\n#include <linux/pagemap.h>\n\nvoid hfs_file_truncate(struct inode *inode)\n{\n\tstruct super_block *sb = inode->i_sb;\n\tstruct hfs_find_data fd;\n\tu16 blk_cnt, alloc_cnt, start;\n\tu32 size;\n\tint res;\n\n\thfs_dbg(INODE, \"truncate: %lu, %Lu -> %Lu\\n\",\n\t\tinode->i_ino, (long long)HFS_I(inode)->phys_size,\n\t\tinode->i_size);\n\tif (inode->i_size > HFS_I(inode)->phys_size) {\n\t\tstruct address_space *mapping = inode->i_mapping;\n\t\tvoid *fsdata;\n\t\tstruct page *page;\n\n\t\t/* XXX: Can use generic_cont_expand? */\n\t\tsize = inode->i_size - 1;\n\t\tres = pagecache_write_begin(NULL, mapping, size+1, 0,\n\t\t\t\tAOP_FLAG_UNINTERRUPTIBLE, &page, &fsdata);\n\t\tif (!res) {\n\t\t\tres = pagecache_write_end(NULL, mapping, size+1, 0, 0,\n\t\t\t\t\tpage, fsdata);\n\t\t}\n\t\tif (res)\n\t\t\tinode->i_size = HFS_I(inode)->phys_size;\n\t\treturn;\n\t} else if (inode->i_size == HFS_I(inode)->phys_size)\n\t\treturn;\n\tsize = inode->i_size + HFS_SB(sb)->alloc_blksz - 1;\n\tblk_cnt = size / HFS_SB(sb)->alloc_blksz;\n\talloc_cnt = HFS_I(inode)->alloc_blocks;\n\tif (blk_cnt == alloc_cnt)\n\t\tgoto out;\n\n\tmutex_lock(&HFS_I(inode)->extents_lock);\n\tres = hfs_find_init(HFS_SB(sb)->ext_tree, &fd);\n\tif (res) {\n\t\tmutex_unlock(&HFS_I(inode)->extents_lock);\n\t\t/* XXX: We lack error handling of hfs_file_truncate() */\n\t\treturn;\n\t}\n\twhile (1) {\n\t\tif (alloc_cnt == HFS_I(inode)->first_blocks) {\n\t\t\thfs_free_extents(sb, HFS_I(inode)->first_extents,\n\t\t\t\t\t alloc_cnt, alloc_cnt - blk_cnt);\n\t\t\thfs_dump_extent(HFS_I(inode)->first_extents);\n\t\t\tHFS_I(inode)->first_blocks = blk_cnt;\n\t\t\tbreak;\n\t\t}\n\t\tres = __hfs_ext_cache_extent(&fd, inode, alloc_cnt);\n\t\tif (res)\n\t\t\tbreak;\n\t\tstart = HFS_I(inode)->cached_start;\n\t\thfs_free_extents(sb, HFS_I(inode)->cached_extents,\n\t\t\t\t alloc_cnt - start, alloc_cnt - blk_cnt);\n\t\thfs_dump_extent(HFS_I(inode)->cached_extents);\n\t\tif (blk_cnt > start) {\n\t\t\tHFS_I(inode)->flags |= HFS_FLG_EXT_DIRTY;\n\t\t\tbreak;\n\t\t}\n\t\talloc_cnt = start;\n\t\tHFS_I(inode)->cached_start = HFS_I(inode)->cached_blocks = 0;\n\t\tHFS_I(inode)->flags &= ~(HFS_FLG_EXT_DIRTY|HFS_FLG_EXT_NEW);\n\t\thfs_brec_remove(&fd);\n\t}\n\thfs_find_exit(&fd);\n\tmutex_unlock(&HFS_I(inode)->extents_lock);\n\n\tHFS_I(inode)->alloc_blocks = blk_cnt;\nout:\n\tHFS_I(inode)->phys_size = inode->i_size;\n\tHFS_I(inode)->fs_blocks = (inode->i_size + sb->s_blocksize - 1) >> sb->s_blocksize_bits;\n\tinode_set_bytes(inode, HFS_I(inode)->fs_blocks << sb->s_blocksize_bits);\n\tmark_inode_dirty(inode);\n}"
  },
  {
    "function_name": "hfs_extend_file",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/hfs/extent.c",
    "lines": "385-468",
    "snippet": "int hfs_extend_file(struct inode *inode)\n{\n\tstruct super_block *sb = inode->i_sb;\n\tu32 start, len, goal;\n\tint res;\n\n\tmutex_lock(&HFS_I(inode)->extents_lock);\n\tif (HFS_I(inode)->alloc_blocks == HFS_I(inode)->first_blocks)\n\t\tgoal = hfs_ext_lastblock(HFS_I(inode)->first_extents);\n\telse {\n\t\tres = hfs_ext_read_extent(inode, HFS_I(inode)->alloc_blocks);\n\t\tif (res)\n\t\t\tgoto out;\n\t\tgoal = hfs_ext_lastblock(HFS_I(inode)->cached_extents);\n\t}\n\n\tlen = HFS_I(inode)->clump_blocks;\n\tstart = hfs_vbm_search_free(sb, goal, &len);\n\tif (!len) {\n\t\tres = -ENOSPC;\n\t\tgoto out;\n\t}\n\n\thfs_dbg(EXTENT, \"extend %lu: %u,%u\\n\", inode->i_ino, start, len);\n\tif (HFS_I(inode)->alloc_blocks == HFS_I(inode)->first_blocks) {\n\t\tif (!HFS_I(inode)->first_blocks) {\n\t\t\thfs_dbg(EXTENT, \"first extents\\n\");\n\t\t\t/* no extents yet */\n\t\t\tHFS_I(inode)->first_extents[0].block = cpu_to_be16(start);\n\t\t\tHFS_I(inode)->first_extents[0].count = cpu_to_be16(len);\n\t\t\tres = 0;\n\t\t} else {\n\t\t\t/* try to append to extents in inode */\n\t\t\tres = hfs_add_extent(HFS_I(inode)->first_extents,\n\t\t\t\t\t     HFS_I(inode)->alloc_blocks,\n\t\t\t\t\t     start, len);\n\t\t\tif (res == -ENOSPC)\n\t\t\t\tgoto insert_extent;\n\t\t}\n\t\tif (!res) {\n\t\t\thfs_dump_extent(HFS_I(inode)->first_extents);\n\t\t\tHFS_I(inode)->first_blocks += len;\n\t\t}\n\t} else {\n\t\tres = hfs_add_extent(HFS_I(inode)->cached_extents,\n\t\t\t\t     HFS_I(inode)->alloc_blocks -\n\t\t\t\t     HFS_I(inode)->cached_start,\n\t\t\t\t     start, len);\n\t\tif (!res) {\n\t\t\thfs_dump_extent(HFS_I(inode)->cached_extents);\n\t\t\tHFS_I(inode)->flags |= HFS_FLG_EXT_DIRTY;\n\t\t\tHFS_I(inode)->cached_blocks += len;\n\t\t} else if (res == -ENOSPC)\n\t\t\tgoto insert_extent;\n\t}\nout:\n\tmutex_unlock(&HFS_I(inode)->extents_lock);\n\tif (!res) {\n\t\tHFS_I(inode)->alloc_blocks += len;\n\t\tmark_inode_dirty(inode);\n\t\tif (inode->i_ino < HFS_FIRSTUSER_CNID)\n\t\t\tset_bit(HFS_FLG_ALT_MDB_DIRTY, &HFS_SB(sb)->flags);\n\t\tset_bit(HFS_FLG_MDB_DIRTY, &HFS_SB(sb)->flags);\n\t\thfs_mark_mdb_dirty(sb);\n\t}\n\treturn res;\n\ninsert_extent:\n\thfs_dbg(EXTENT, \"insert new extent\\n\");\n\tres = hfs_ext_write_extent(inode);\n\tif (res)\n\t\tgoto out;\n\n\tmemset(HFS_I(inode)->cached_extents, 0, sizeof(hfs_extent_rec));\n\tHFS_I(inode)->cached_extents[0].block = cpu_to_be16(start);\n\tHFS_I(inode)->cached_extents[0].count = cpu_to_be16(len);\n\thfs_dump_extent(HFS_I(inode)->cached_extents);\n\tHFS_I(inode)->flags |= HFS_FLG_EXT_DIRTY|HFS_FLG_EXT_NEW;\n\tHFS_I(inode)->cached_start = HFS_I(inode)->alloc_blocks;\n\tHFS_I(inode)->cached_blocks = len;\n\n\tres = 0;\n\tgoto out;\n}",
    "includes": [
      "#include \"btree.h\"",
      "#include \"hfs_fs.h\"",
      "#include <linux/pagemap.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "HFS_I",
          "args": [
            "inode"
          ],
          "line": 464
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "HFS_I",
          "args": [
            "inode"
          ],
          "line": 463
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "HFS_I",
          "args": [
            "inode"
          ],
          "line": 463
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "HFS_I",
          "args": [
            "inode"
          ],
          "line": 462
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "hfs_dump_extent",
          "args": [
            "HFS_I(inode)->cached_extents"
          ],
          "line": 461
        },
        "resolved": true,
        "details": {
          "function_name": "hfs_dump_extent",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/hfs/extent.c",
          "lines": "204-214",
          "snippet": "static void hfs_dump_extent(struct hfs_extent *extent)\n{\n\tint i;\n\n\thfs_dbg(EXTENT, \"   \");\n\tfor (i = 0; i < 3; i++)\n\t\thfs_dbg_cont(EXTENT, \" %u:%u\",\n\t\t\t     be16_to_cpu(extent[i].block),\n\t\t\t     be16_to_cpu(extent[i].count));\n\thfs_dbg_cont(EXTENT, \"\\n\");\n}",
          "includes": [
            "#include \"btree.h\"",
            "#include \"hfs_fs.h\"",
            "#include <linux/pagemap.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"btree.h\"\n#include \"hfs_fs.h\"\n#include <linux/pagemap.h>\n\nstatic void hfs_dump_extent(struct hfs_extent *extent)\n{\n\tint i;\n\n\thfs_dbg(EXTENT, \"   \");\n\tfor (i = 0; i < 3; i++)\n\t\thfs_dbg_cont(EXTENT, \" %u:%u\",\n\t\t\t     be16_to_cpu(extent[i].block),\n\t\t\t     be16_to_cpu(extent[i].count));\n\thfs_dbg_cont(EXTENT, \"\\n\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "HFS_I",
          "args": [
            "inode"
          ],
          "line": 461
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "cpu_to_be16",
          "args": [
            "len"
          ],
          "line": 460
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "HFS_I",
          "args": [
            "inode"
          ],
          "line": 460
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "cpu_to_be16",
          "args": [
            "start"
          ],
          "line": 459
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "HFS_I",
          "args": [
            "inode"
          ],
          "line": 459
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memset",
          "args": [
            "HFS_I(inode)->cached_extents",
            "0",
            "sizeof(hfs_extent_rec)"
          ],
          "line": 458
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "HFS_I",
          "args": [
            "inode"
          ],
          "line": 458
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "hfs_ext_write_extent",
          "args": [
            "inode"
          ],
          "line": 454
        },
        "resolved": true,
        "details": {
          "function_name": "hfs_ext_write_extent",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/hfs/extent.c",
          "lines": "131-144",
          "snippet": "int hfs_ext_write_extent(struct inode *inode)\n{\n\tstruct hfs_find_data fd;\n\tint res = 0;\n\n\tif (HFS_I(inode)->flags & HFS_FLG_EXT_DIRTY) {\n\t\tres = hfs_find_init(HFS_SB(inode->i_sb)->ext_tree, &fd);\n\t\tif (res)\n\t\t\treturn res;\n\t\tres = __hfs_ext_write_extent(inode, &fd);\n\t\thfs_find_exit(&fd);\n\t}\n\treturn res;\n}",
          "includes": [
            "#include \"btree.h\"",
            "#include \"hfs_fs.h\"",
            "#include <linux/pagemap.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"btree.h\"\n#include \"hfs_fs.h\"\n#include <linux/pagemap.h>\n\nint hfs_ext_write_extent(struct inode *inode)\n{\n\tstruct hfs_find_data fd;\n\tint res = 0;\n\n\tif (HFS_I(inode)->flags & HFS_FLG_EXT_DIRTY) {\n\t\tres = hfs_find_init(HFS_SB(inode->i_sb)->ext_tree, &fd);\n\t\tif (res)\n\t\t\treturn res;\n\t\tres = __hfs_ext_write_extent(inode, &fd);\n\t\thfs_find_exit(&fd);\n\t}\n\treturn res;\n}"
        }
      },
      {
        "call_info": {
          "callee": "hfs_dbg",
          "args": [
            "EXTENT",
            "\"insert new extent\\n\""
          ],
          "line": 453
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "hfs_mark_mdb_dirty",
          "args": [
            "sb"
          ],
          "line": 448
        },
        "resolved": true,
        "details": {
          "function_name": "hfs_mark_mdb_dirty",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/hfs/super.c",
          "lines": "68-83",
          "snippet": "void hfs_mark_mdb_dirty(struct super_block *sb)\n{\n\tstruct hfs_sb_info *sbi = HFS_SB(sb);\n\tunsigned long delay;\n\n\tif (sb->s_flags & MS_RDONLY)\n\t\treturn;\n\n\tspin_lock(&sbi->work_lock);\n\tif (!sbi->work_queued) {\n\t\tdelay = msecs_to_jiffies(dirty_writeback_interval * 10);\n\t\tqueue_delayed_work(system_long_wq, &sbi->mdb_work, delay);\n\t\tsbi->work_queued = 1;\n\t}\n\tspin_unlock(&sbi->work_lock);\n}",
          "includes": [
            "#include \"btree.h\"",
            "#include \"hfs_fs.h\"",
            "#include <linux/vfs.h>",
            "#include <linux/slab.h>",
            "#include <linux/seq_file.h>",
            "#include <linux/parser.h>",
            "#include <linux/nls.h>",
            "#include <linux/init.h>",
            "#include <linux/mount.h>",
            "#include <linux/blkdev.h>",
            "#include <linux/module.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"btree.h\"\n#include \"hfs_fs.h\"\n#include <linux/vfs.h>\n#include <linux/slab.h>\n#include <linux/seq_file.h>\n#include <linux/parser.h>\n#include <linux/nls.h>\n#include <linux/init.h>\n#include <linux/mount.h>\n#include <linux/blkdev.h>\n#include <linux/module.h>\n\nvoid hfs_mark_mdb_dirty(struct super_block *sb)\n{\n\tstruct hfs_sb_info *sbi = HFS_SB(sb);\n\tunsigned long delay;\n\n\tif (sb->s_flags & MS_RDONLY)\n\t\treturn;\n\n\tspin_lock(&sbi->work_lock);\n\tif (!sbi->work_queued) {\n\t\tdelay = msecs_to_jiffies(dirty_writeback_interval * 10);\n\t\tqueue_delayed_work(system_long_wq, &sbi->mdb_work, delay);\n\t\tsbi->work_queued = 1;\n\t}\n\tspin_unlock(&sbi->work_lock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "set_bit",
          "args": [
            "HFS_FLG_MDB_DIRTY",
            "&HFS_SB(sb)->flags"
          ],
          "line": 447
        },
        "resolved": true,
        "details": {
          "function_name": "ocfs2_set_bit_unaligned",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/ocfs2/ocfs2.h",
          "lines": "886-890",
          "snippet": "static inline void ocfs2_set_bit_unaligned(int bit, void *bitmap)\n{\n\tbitmap = correct_addr_and_bit_unaligned(&bit, bitmap);\n\tocfs2_set_bit(bit, bitmap);\n}",
          "includes": [
            "#include \"reservations.h\"",
            "#include \"blockcheck.h\"",
            "#include \"ocfs2_ioctl.h\"",
            "#include \"ocfs2_lockid.h\"",
            "#include \"ocfs2_fs.h\"",
            "#include \"stackglue.h\"",
            "#include <linux/jbd2.h>",
            "#include <linux/lockdep.h>",
            "#include <linux/mutex.h>",
            "#include <linux/kref.h>",
            "#include <linux/workqueue.h>",
            "#include <linux/rbtree.h>",
            "#include <linux/llist.h>",
            "#include <linux/list.h>",
            "#include <linux/wait.h>",
            "#include <linux/sched.h>",
            "#include <linux/spinlock.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"reservations.h\"\n#include \"blockcheck.h\"\n#include \"ocfs2_ioctl.h\"\n#include \"ocfs2_lockid.h\"\n#include \"ocfs2_fs.h\"\n#include \"stackglue.h\"\n#include <linux/jbd2.h>\n#include <linux/lockdep.h>\n#include <linux/mutex.h>\n#include <linux/kref.h>\n#include <linux/workqueue.h>\n#include <linux/rbtree.h>\n#include <linux/llist.h>\n#include <linux/list.h>\n#include <linux/wait.h>\n#include <linux/sched.h>\n#include <linux/spinlock.h>\n\nstatic inline void ocfs2_set_bit_unaligned(int bit, void *bitmap)\n{\n\tbitmap = correct_addr_and_bit_unaligned(&bit, bitmap);\n\tocfs2_set_bit(bit, bitmap);\n}"
        }
      },
      {
        "call_info": {
          "callee": "HFS_SB",
          "args": [
            "sb"
          ],
          "line": 447
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "HFS_SB",
          "args": [
            "sb"
          ],
          "line": 446
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "mark_inode_dirty",
          "args": [
            "inode"
          ],
          "line": 444
        },
        "resolved": true,
        "details": {
          "function_name": "block_dump___mark_inode_dirty",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/fs-writeback.c",
          "lines": "1134-1154",
          "snippet": "static noinline void block_dump___mark_inode_dirty(struct inode *inode)\n{\n\tif (inode->i_ino || strcmp(inode->i_sb->s_id, \"bdev\")) {\n\t\tstruct dentry *dentry;\n\t\tconst char *name = \"?\";\n\n\t\tdentry = d_find_alias(inode);\n\t\tif (dentry) {\n\t\t\tspin_lock(&dentry->d_lock);\n\t\t\tname = (const char *) dentry->d_name.name;\n\t\t}\n\t\tprintk(KERN_DEBUG\n\t\t       \"%s(%d): dirtied inode %lu (%s) on %s\\n\",\n\t\t       current->comm, task_pid_nr(current), inode->i_ino,\n\t\t       name, inode->i_sb->s_id);\n\t\tif (dentry) {\n\t\t\tspin_unlock(&dentry->d_lock);\n\t\t\tdput(dentry);\n\t\t}\n\t}\n}",
          "includes": [
            "#include <trace/events/writeback.h>",
            "#include \"internal.h\"",
            "#include <linux/device.h>",
            "#include <linux/tracepoint.h>",
            "#include <linux/backing-dev.h>",
            "#include <linux/blkdev.h>",
            "#include <linux/writeback.h>",
            "#include <linux/kthread.h>",
            "#include <linux/pagemap.h>",
            "#include <linux/mm.h>",
            "#include <linux/fs.h>",
            "#include <linux/sched.h>",
            "#include <linux/slab.h>",
            "#include <linux/spinlock.h>",
            "#include <linux/export.h>",
            "#include <linux/kernel.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <trace/events/writeback.h>\n#include \"internal.h\"\n#include <linux/device.h>\n#include <linux/tracepoint.h>\n#include <linux/backing-dev.h>\n#include <linux/blkdev.h>\n#include <linux/writeback.h>\n#include <linux/kthread.h>\n#include <linux/pagemap.h>\n#include <linux/mm.h>\n#include <linux/fs.h>\n#include <linux/sched.h>\n#include <linux/slab.h>\n#include <linux/spinlock.h>\n#include <linux/export.h>\n#include <linux/kernel.h>\n\nstatic noinline void block_dump___mark_inode_dirty(struct inode *inode)\n{\n\tif (inode->i_ino || strcmp(inode->i_sb->s_id, \"bdev\")) {\n\t\tstruct dentry *dentry;\n\t\tconst char *name = \"?\";\n\n\t\tdentry = d_find_alias(inode);\n\t\tif (dentry) {\n\t\t\tspin_lock(&dentry->d_lock);\n\t\t\tname = (const char *) dentry->d_name.name;\n\t\t}\n\t\tprintk(KERN_DEBUG\n\t\t       \"%s(%d): dirtied inode %lu (%s) on %s\\n\",\n\t\t       current->comm, task_pid_nr(current), inode->i_ino,\n\t\t       name, inode->i_sb->s_id);\n\t\tif (dentry) {\n\t\t\tspin_unlock(&dentry->d_lock);\n\t\t\tdput(dentry);\n\t\t}\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "HFS_I",
          "args": [
            "inode"
          ],
          "line": 443
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "mutex_unlock",
          "args": [
            "&HFS_I(inode)->extents_lock"
          ],
          "line": 441
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "HFS_I",
          "args": [
            "inode"
          ],
          "line": 441
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "HFS_I",
          "args": [
            "inode"
          ],
          "line": 436
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "HFS_I",
          "args": [
            "inode"
          ],
          "line": 435
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "HFS_I",
          "args": [
            "inode"
          ],
          "line": 434
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "hfs_add_extent",
          "args": [
            "HFS_I(inode)->cached_extents",
            "HFS_I(inode)->alloc_blocks -\n\t\t\t\t     HFS_I(inode)->cached_start",
            "start",
            "len"
          ],
          "line": 429
        },
        "resolved": true,
        "details": {
          "function_name": "hfs_add_extent",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/hfs/extent.c",
          "lines": "216-242",
          "snippet": "static int hfs_add_extent(struct hfs_extent *extent, u16 offset,\n\t\t\t  u16 alloc_block, u16 block_count)\n{\n\tu16 count, start;\n\tint i;\n\n\thfs_dump_extent(extent);\n\tfor (i = 0; i < 3; extent++, i++) {\n\t\tcount = be16_to_cpu(extent->count);\n\t\tif (offset == count) {\n\t\t\tstart = be16_to_cpu(extent->block);\n\t\t\tif (alloc_block != start + count) {\n\t\t\t\tif (++i >= 3)\n\t\t\t\t\treturn -ENOSPC;\n\t\t\t\textent++;\n\t\t\t\textent->block = cpu_to_be16(alloc_block);\n\t\t\t} else\n\t\t\t\tblock_count += count;\n\t\t\textent->count = cpu_to_be16(block_count);\n\t\t\treturn 0;\n\t\t} else if (offset < count)\n\t\t\tbreak;\n\t\toffset -= count;\n\t}\n\t/* panic? */\n\treturn -EIO;\n}",
          "includes": [
            "#include \"btree.h\"",
            "#include \"hfs_fs.h\"",
            "#include <linux/pagemap.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"btree.h\"\n#include \"hfs_fs.h\"\n#include <linux/pagemap.h>\n\nstatic int hfs_add_extent(struct hfs_extent *extent, u16 offset,\n\t\t\t  u16 alloc_block, u16 block_count)\n{\n\tu16 count, start;\n\tint i;\n\n\thfs_dump_extent(extent);\n\tfor (i = 0; i < 3; extent++, i++) {\n\t\tcount = be16_to_cpu(extent->count);\n\t\tif (offset == count) {\n\t\t\tstart = be16_to_cpu(extent->block);\n\t\t\tif (alloc_block != start + count) {\n\t\t\t\tif (++i >= 3)\n\t\t\t\t\treturn -ENOSPC;\n\t\t\t\textent++;\n\t\t\t\textent->block = cpu_to_be16(alloc_block);\n\t\t\t} else\n\t\t\t\tblock_count += count;\n\t\t\textent->count = cpu_to_be16(block_count);\n\t\t\treturn 0;\n\t\t} else if (offset < count)\n\t\t\tbreak;\n\t\toffset -= count;\n\t}\n\t/* panic? */\n\treturn -EIO;\n}"
        }
      },
      {
        "call_info": {
          "callee": "HFS_I",
          "args": [
            "inode"
          ],
          "line": 431
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "HFS_I",
          "args": [
            "inode"
          ],
          "line": 430
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "HFS_I",
          "args": [
            "inode"
          ],
          "line": 429
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "HFS_I",
          "args": [
            "inode"
          ],
          "line": 426
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "HFS_I",
          "args": [
            "inode"
          ],
          "line": 425
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "HFS_I",
          "args": [
            "inode"
          ],
          "line": 419
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "HFS_I",
          "args": [
            "inode"
          ],
          "line": 418
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "cpu_to_be16",
          "args": [
            "len"
          ],
          "line": 414
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "HFS_I",
          "args": [
            "inode"
          ],
          "line": 414
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "cpu_to_be16",
          "args": [
            "start"
          ],
          "line": 413
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "HFS_I",
          "args": [
            "inode"
          ],
          "line": 413
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "hfs_dbg",
          "args": [
            "EXTENT",
            "\"first extents\\n\""
          ],
          "line": 411
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "HFS_I",
          "args": [
            "inode"
          ],
          "line": 410
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "HFS_I",
          "args": [
            "inode"
          ],
          "line": 409
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "HFS_I",
          "args": [
            "inode"
          ],
          "line": 409
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "hfs_dbg",
          "args": [
            "EXTENT",
            "\"extend %lu: %u,%u\\n\"",
            "inode->i_ino",
            "start",
            "len"
          ],
          "line": 408
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "hfs_vbm_search_free",
          "args": [
            "sb",
            "goal",
            "&len"
          ],
          "line": 402
        },
        "resolved": true,
        "details": {
          "function_name": "hfs_vbm_search_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/hfs/bitmap.c",
          "lines": "139-167",
          "snippet": "u32 hfs_vbm_search_free(struct super_block *sb, u32 goal, u32 *num_bits)\n{\n\tvoid *bitmap;\n\tu32 pos;\n\n\t/* make sure we have actual work to perform */\n\tif (!*num_bits)\n\t\treturn 0;\n\n\tmutex_lock(&HFS_SB(sb)->bitmap_lock);\n\tbitmap = HFS_SB(sb)->bitmap;\n\n\tpos = hfs_find_set_zero_bits(bitmap, HFS_SB(sb)->fs_ablocks, goal, num_bits);\n\tif (pos >= HFS_SB(sb)->fs_ablocks) {\n\t\tif (goal)\n\t\t\tpos = hfs_find_set_zero_bits(bitmap, goal, 0, num_bits);\n\t\tif (pos >= HFS_SB(sb)->fs_ablocks) {\n\t\t\t*num_bits = pos = 0;\n\t\t\tgoto out;\n\t\t}\n\t}\n\n\thfs_dbg(BITMAP, \"alloc_bits: %u,%u\\n\", pos, *num_bits);\n\tHFS_SB(sb)->free_ablocks -= *num_bits;\n\thfs_bitmap_dirty(sb);\nout:\n\tmutex_unlock(&HFS_SB(sb)->bitmap_lock);\n\treturn pos;\n}",
          "includes": [
            "#include \"hfs_fs.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"hfs_fs.h\"\n\nu32 hfs_vbm_search_free(struct super_block *sb, u32 goal, u32 *num_bits)\n{\n\tvoid *bitmap;\n\tu32 pos;\n\n\t/* make sure we have actual work to perform */\n\tif (!*num_bits)\n\t\treturn 0;\n\n\tmutex_lock(&HFS_SB(sb)->bitmap_lock);\n\tbitmap = HFS_SB(sb)->bitmap;\n\n\tpos = hfs_find_set_zero_bits(bitmap, HFS_SB(sb)->fs_ablocks, goal, num_bits);\n\tif (pos >= HFS_SB(sb)->fs_ablocks) {\n\t\tif (goal)\n\t\t\tpos = hfs_find_set_zero_bits(bitmap, goal, 0, num_bits);\n\t\tif (pos >= HFS_SB(sb)->fs_ablocks) {\n\t\t\t*num_bits = pos = 0;\n\t\t\tgoto out;\n\t\t}\n\t}\n\n\thfs_dbg(BITMAP, \"alloc_bits: %u,%u\\n\", pos, *num_bits);\n\tHFS_SB(sb)->free_ablocks -= *num_bits;\n\thfs_bitmap_dirty(sb);\nout:\n\tmutex_unlock(&HFS_SB(sb)->bitmap_lock);\n\treturn pos;\n}"
        }
      },
      {
        "call_info": {
          "callee": "HFS_I",
          "args": [
            "inode"
          ],
          "line": 401
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "hfs_ext_lastblock",
          "args": [
            "HFS_I(inode)->cached_extents"
          ],
          "line": 398
        },
        "resolved": true,
        "details": {
          "function_name": "hfs_ext_lastblock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/hfs/extent.c",
          "lines": "99-108",
          "snippet": "static u16 hfs_ext_lastblock(struct hfs_extent *ext)\n{\n\tint i;\n\n\text += 2;\n\tfor (i = 0; i < 2; ext--, i++)\n\t\tif (ext->count)\n\t\t\tbreak;\n\treturn be16_to_cpu(ext->block) + be16_to_cpu(ext->count);\n}",
          "includes": [
            "#include \"btree.h\"",
            "#include \"hfs_fs.h\"",
            "#include <linux/pagemap.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"btree.h\"\n#include \"hfs_fs.h\"\n#include <linux/pagemap.h>\n\nstatic u16 hfs_ext_lastblock(struct hfs_extent *ext)\n{\n\tint i;\n\n\text += 2;\n\tfor (i = 0; i < 2; ext--, i++)\n\t\tif (ext->count)\n\t\t\tbreak;\n\treturn be16_to_cpu(ext->block) + be16_to_cpu(ext->count);\n}"
        }
      },
      {
        "call_info": {
          "callee": "HFS_I",
          "args": [
            "inode"
          ],
          "line": 398
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "hfs_ext_read_extent",
          "args": [
            "inode",
            "HFS_I(inode)->alloc_blocks"
          ],
          "line": 395
        },
        "resolved": true,
        "details": {
          "function_name": "hfs_ext_read_extent",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/hfs/extent.c",
          "lines": "187-202",
          "snippet": "static int hfs_ext_read_extent(struct inode *inode, u16 block)\n{\n\tstruct hfs_find_data fd;\n\tint res;\n\n\tif (block >= HFS_I(inode)->cached_start &&\n\t    block < HFS_I(inode)->cached_start + HFS_I(inode)->cached_blocks)\n\t\treturn 0;\n\n\tres = hfs_find_init(HFS_SB(inode->i_sb)->ext_tree, &fd);\n\tif (!res) {\n\t\tres = __hfs_ext_cache_extent(&fd, inode, block);\n\t\thfs_find_exit(&fd);\n\t}\n\treturn res;\n}",
          "includes": [
            "#include \"btree.h\"",
            "#include \"hfs_fs.h\"",
            "#include <linux/pagemap.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"btree.h\"\n#include \"hfs_fs.h\"\n#include <linux/pagemap.h>\n\nstatic int hfs_ext_read_extent(struct inode *inode, u16 block)\n{\n\tstruct hfs_find_data fd;\n\tint res;\n\n\tif (block >= HFS_I(inode)->cached_start &&\n\t    block < HFS_I(inode)->cached_start + HFS_I(inode)->cached_blocks)\n\t\treturn 0;\n\n\tres = hfs_find_init(HFS_SB(inode->i_sb)->ext_tree, &fd);\n\tif (!res) {\n\t\tres = __hfs_ext_cache_extent(&fd, inode, block);\n\t\thfs_find_exit(&fd);\n\t}\n\treturn res;\n}"
        }
      },
      {
        "call_info": {
          "callee": "HFS_I",
          "args": [
            "inode"
          ],
          "line": 395
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "HFS_I",
          "args": [
            "inode"
          ],
          "line": 393
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "HFS_I",
          "args": [
            "inode"
          ],
          "line": 392
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "HFS_I",
          "args": [
            "inode"
          ],
          "line": 392
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "mutex_lock",
          "args": [
            "&HFS_I(inode)->extents_lock"
          ],
          "line": 391
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "HFS_I",
          "args": [
            "inode"
          ],
          "line": 391
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"btree.h\"\n#include \"hfs_fs.h\"\n#include <linux/pagemap.h>\n\nint hfs_extend_file(struct inode *inode)\n{\n\tstruct super_block *sb = inode->i_sb;\n\tu32 start, len, goal;\n\tint res;\n\n\tmutex_lock(&HFS_I(inode)->extents_lock);\n\tif (HFS_I(inode)->alloc_blocks == HFS_I(inode)->first_blocks)\n\t\tgoal = hfs_ext_lastblock(HFS_I(inode)->first_extents);\n\telse {\n\t\tres = hfs_ext_read_extent(inode, HFS_I(inode)->alloc_blocks);\n\t\tif (res)\n\t\t\tgoto out;\n\t\tgoal = hfs_ext_lastblock(HFS_I(inode)->cached_extents);\n\t}\n\n\tlen = HFS_I(inode)->clump_blocks;\n\tstart = hfs_vbm_search_free(sb, goal, &len);\n\tif (!len) {\n\t\tres = -ENOSPC;\n\t\tgoto out;\n\t}\n\n\thfs_dbg(EXTENT, \"extend %lu: %u,%u\\n\", inode->i_ino, start, len);\n\tif (HFS_I(inode)->alloc_blocks == HFS_I(inode)->first_blocks) {\n\t\tif (!HFS_I(inode)->first_blocks) {\n\t\t\thfs_dbg(EXTENT, \"first extents\\n\");\n\t\t\t/* no extents yet */\n\t\t\tHFS_I(inode)->first_extents[0].block = cpu_to_be16(start);\n\t\t\tHFS_I(inode)->first_extents[0].count = cpu_to_be16(len);\n\t\t\tres = 0;\n\t\t} else {\n\t\t\t/* try to append to extents in inode */\n\t\t\tres = hfs_add_extent(HFS_I(inode)->first_extents,\n\t\t\t\t\t     HFS_I(inode)->alloc_blocks,\n\t\t\t\t\t     start, len);\n\t\t\tif (res == -ENOSPC)\n\t\t\t\tgoto insert_extent;\n\t\t}\n\t\tif (!res) {\n\t\t\thfs_dump_extent(HFS_I(inode)->first_extents);\n\t\t\tHFS_I(inode)->first_blocks += len;\n\t\t}\n\t} else {\n\t\tres = hfs_add_extent(HFS_I(inode)->cached_extents,\n\t\t\t\t     HFS_I(inode)->alloc_blocks -\n\t\t\t\t     HFS_I(inode)->cached_start,\n\t\t\t\t     start, len);\n\t\tif (!res) {\n\t\t\thfs_dump_extent(HFS_I(inode)->cached_extents);\n\t\t\tHFS_I(inode)->flags |= HFS_FLG_EXT_DIRTY;\n\t\t\tHFS_I(inode)->cached_blocks += len;\n\t\t} else if (res == -ENOSPC)\n\t\t\tgoto insert_extent;\n\t}\nout:\n\tmutex_unlock(&HFS_I(inode)->extents_lock);\n\tif (!res) {\n\t\tHFS_I(inode)->alloc_blocks += len;\n\t\tmark_inode_dirty(inode);\n\t\tif (inode->i_ino < HFS_FIRSTUSER_CNID)\n\t\t\tset_bit(HFS_FLG_ALT_MDB_DIRTY, &HFS_SB(sb)->flags);\n\t\tset_bit(HFS_FLG_MDB_DIRTY, &HFS_SB(sb)->flags);\n\t\thfs_mark_mdb_dirty(sb);\n\t}\n\treturn res;\n\ninsert_extent:\n\thfs_dbg(EXTENT, \"insert new extent\\n\");\n\tres = hfs_ext_write_extent(inode);\n\tif (res)\n\t\tgoto out;\n\n\tmemset(HFS_I(inode)->cached_extents, 0, sizeof(hfs_extent_rec));\n\tHFS_I(inode)->cached_extents[0].block = cpu_to_be16(start);\n\tHFS_I(inode)->cached_extents[0].count = cpu_to_be16(len);\n\thfs_dump_extent(HFS_I(inode)->cached_extents);\n\tHFS_I(inode)->flags |= HFS_FLG_EXT_DIRTY|HFS_FLG_EXT_NEW;\n\tHFS_I(inode)->cached_start = HFS_I(inode)->alloc_blocks;\n\tHFS_I(inode)->cached_blocks = len;\n\n\tres = 0;\n\tgoto out;\n}"
  },
  {
    "function_name": "hfs_get_block",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/hfs/extent.c",
    "lines": "332-383",
    "snippet": "int hfs_get_block(struct inode *inode, sector_t block,\n\t\t  struct buffer_head *bh_result, int create)\n{\n\tstruct super_block *sb;\n\tu16 dblock, ablock;\n\tint res;\n\n\tsb = inode->i_sb;\n\t/* Convert inode block to disk allocation block */\n\tablock = (u32)block / HFS_SB(sb)->fs_div;\n\n\tif (block >= HFS_I(inode)->fs_blocks) {\n\t\tif (block > HFS_I(inode)->fs_blocks || !create)\n\t\t\treturn -EIO;\n\t\tif (ablock >= HFS_I(inode)->alloc_blocks) {\n\t\t\tres = hfs_extend_file(inode);\n\t\t\tif (res)\n\t\t\t\treturn res;\n\t\t}\n\t} else\n\t\tcreate = 0;\n\n\tif (ablock < HFS_I(inode)->first_blocks) {\n\t\tdblock = hfs_ext_find_block(HFS_I(inode)->first_extents, ablock);\n\t\tgoto done;\n\t}\n\n\tmutex_lock(&HFS_I(inode)->extents_lock);\n\tres = hfs_ext_read_extent(inode, ablock);\n\tif (!res)\n\t\tdblock = hfs_ext_find_block(HFS_I(inode)->cached_extents,\n\t\t\t\t\t    ablock - HFS_I(inode)->cached_start);\n\telse {\n\t\tmutex_unlock(&HFS_I(inode)->extents_lock);\n\t\treturn -EIO;\n\t}\n\tmutex_unlock(&HFS_I(inode)->extents_lock);\n\ndone:\n\tmap_bh(bh_result, sb, HFS_SB(sb)->fs_start +\n\t       dblock * HFS_SB(sb)->fs_div +\n\t       (u32)block % HFS_SB(sb)->fs_div);\n\n\tif (create) {\n\t\tset_buffer_new(bh_result);\n\t\tHFS_I(inode)->phys_size += sb->s_blocksize;\n\t\tHFS_I(inode)->fs_blocks++;\n\t\tinode_add_bytes(inode, sb->s_blocksize);\n\t\tmark_inode_dirty(inode);\n\t}\n\treturn 0;\n}",
    "includes": [
      "#include \"btree.h\"",
      "#include \"hfs_fs.h\"",
      "#include <linux/pagemap.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "mark_inode_dirty",
          "args": [
            "inode"
          ],
          "line": 380
        },
        "resolved": true,
        "details": {
          "function_name": "block_dump___mark_inode_dirty",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/fs-writeback.c",
          "lines": "1134-1154",
          "snippet": "static noinline void block_dump___mark_inode_dirty(struct inode *inode)\n{\n\tif (inode->i_ino || strcmp(inode->i_sb->s_id, \"bdev\")) {\n\t\tstruct dentry *dentry;\n\t\tconst char *name = \"?\";\n\n\t\tdentry = d_find_alias(inode);\n\t\tif (dentry) {\n\t\t\tspin_lock(&dentry->d_lock);\n\t\t\tname = (const char *) dentry->d_name.name;\n\t\t}\n\t\tprintk(KERN_DEBUG\n\t\t       \"%s(%d): dirtied inode %lu (%s) on %s\\n\",\n\t\t       current->comm, task_pid_nr(current), inode->i_ino,\n\t\t       name, inode->i_sb->s_id);\n\t\tif (dentry) {\n\t\t\tspin_unlock(&dentry->d_lock);\n\t\t\tdput(dentry);\n\t\t}\n\t}\n}",
          "includes": [
            "#include <trace/events/writeback.h>",
            "#include \"internal.h\"",
            "#include <linux/device.h>",
            "#include <linux/tracepoint.h>",
            "#include <linux/backing-dev.h>",
            "#include <linux/blkdev.h>",
            "#include <linux/writeback.h>",
            "#include <linux/kthread.h>",
            "#include <linux/pagemap.h>",
            "#include <linux/mm.h>",
            "#include <linux/fs.h>",
            "#include <linux/sched.h>",
            "#include <linux/slab.h>",
            "#include <linux/spinlock.h>",
            "#include <linux/export.h>",
            "#include <linux/kernel.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <trace/events/writeback.h>\n#include \"internal.h\"\n#include <linux/device.h>\n#include <linux/tracepoint.h>\n#include <linux/backing-dev.h>\n#include <linux/blkdev.h>\n#include <linux/writeback.h>\n#include <linux/kthread.h>\n#include <linux/pagemap.h>\n#include <linux/mm.h>\n#include <linux/fs.h>\n#include <linux/sched.h>\n#include <linux/slab.h>\n#include <linux/spinlock.h>\n#include <linux/export.h>\n#include <linux/kernel.h>\n\nstatic noinline void block_dump___mark_inode_dirty(struct inode *inode)\n{\n\tif (inode->i_ino || strcmp(inode->i_sb->s_id, \"bdev\")) {\n\t\tstruct dentry *dentry;\n\t\tconst char *name = \"?\";\n\n\t\tdentry = d_find_alias(inode);\n\t\tif (dentry) {\n\t\t\tspin_lock(&dentry->d_lock);\n\t\t\tname = (const char *) dentry->d_name.name;\n\t\t}\n\t\tprintk(KERN_DEBUG\n\t\t       \"%s(%d): dirtied inode %lu (%s) on %s\\n\",\n\t\t       current->comm, task_pid_nr(current), inode->i_ino,\n\t\t       name, inode->i_sb->s_id);\n\t\tif (dentry) {\n\t\t\tspin_unlock(&dentry->d_lock);\n\t\t\tdput(dentry);\n\t\t}\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "inode_add_bytes",
          "args": [
            "inode",
            "sb->s_blocksize"
          ],
          "line": 379
        },
        "resolved": true,
        "details": {
          "function_name": "inode_add_bytes",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/stat.c",
          "lines": "460-465",
          "snippet": "void inode_add_bytes(struct inode *inode, loff_t bytes)\n{\n\tspin_lock(&inode->i_lock);\n\t__inode_add_bytes(inode, bytes);\n\tspin_unlock(&inode->i_lock);\n}",
          "includes": [
            "#include <asm/unistd.h>",
            "#include <asm/uaccess.h>",
            "#include <linux/pagemap.h>",
            "#include <linux/syscalls.h>",
            "#include <linux/security.h>",
            "#include <linux/namei.h>",
            "#include <linux/fs.h>",
            "#include <linux/highuid.h>",
            "#include <linux/file.h>",
            "#include <linux/errno.h>",
            "#include <linux/mm.h>",
            "#include <linux/export.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <asm/unistd.h>\n#include <asm/uaccess.h>\n#include <linux/pagemap.h>\n#include <linux/syscalls.h>\n#include <linux/security.h>\n#include <linux/namei.h>\n#include <linux/fs.h>\n#include <linux/highuid.h>\n#include <linux/file.h>\n#include <linux/errno.h>\n#include <linux/mm.h>\n#include <linux/export.h>\n\nvoid inode_add_bytes(struct inode *inode, loff_t bytes)\n{\n\tspin_lock(&inode->i_lock);\n\t__inode_add_bytes(inode, bytes);\n\tspin_unlock(&inode->i_lock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "HFS_I",
          "args": [
            "inode"
          ],
          "line": 378
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "HFS_I",
          "args": [
            "inode"
          ],
          "line": 377
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "set_buffer_new",
          "args": [
            "bh_result"
          ],
          "line": 376
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "map_bh",
          "args": [
            "bh_result",
            "sb",
            "HFS_SB(sb)->fs_start +\n\t       dblock * HFS_SB(sb)->fs_div +\n\t       (u32)block % HFS_SB(sb)->fs_div"
          ],
          "line": 371
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "HFS_SB",
          "args": [
            "sb"
          ],
          "line": 373
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "HFS_SB",
          "args": [
            "sb"
          ],
          "line": 372
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "HFS_SB",
          "args": [
            "sb"
          ],
          "line": 371
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "mutex_unlock",
          "args": [
            "&HFS_I(inode)->extents_lock"
          ],
          "line": 368
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "HFS_I",
          "args": [
            "inode"
          ],
          "line": 368
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "mutex_unlock",
          "args": [
            "&HFS_I(inode)->extents_lock"
          ],
          "line": 365
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "HFS_I",
          "args": [
            "inode"
          ],
          "line": 365
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "hfs_ext_find_block",
          "args": [
            "HFS_I(inode)->cached_extents",
            "ablock - HFS_I(inode)->cached_start"
          ],
          "line": 362
        },
        "resolved": true,
        "details": {
          "function_name": "hfs_ext_find_block",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/hfs/extent.c",
          "lines": "74-87",
          "snippet": "static u16 hfs_ext_find_block(struct hfs_extent *ext, u16 off)\n{\n\tint i;\n\tu16 count;\n\n\tfor (i = 0; i < 3; ext++, i++) {\n\t\tcount = be16_to_cpu(ext->count);\n\t\tif (off < count)\n\t\t\treturn be16_to_cpu(ext->block) + off;\n\t\toff -= count;\n\t}\n\t/* panic? */\n\treturn 0;\n}",
          "includes": [
            "#include \"btree.h\"",
            "#include \"hfs_fs.h\"",
            "#include <linux/pagemap.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"btree.h\"\n#include \"hfs_fs.h\"\n#include <linux/pagemap.h>\n\nstatic u16 hfs_ext_find_block(struct hfs_extent *ext, u16 off)\n{\n\tint i;\n\tu16 count;\n\n\tfor (i = 0; i < 3; ext++, i++) {\n\t\tcount = be16_to_cpu(ext->count);\n\t\tif (off < count)\n\t\t\treturn be16_to_cpu(ext->block) + off;\n\t\toff -= count;\n\t}\n\t/* panic? */\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "HFS_I",
          "args": [
            "inode"
          ],
          "line": 363
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "HFS_I",
          "args": [
            "inode"
          ],
          "line": 362
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "hfs_ext_read_extent",
          "args": [
            "inode",
            "ablock"
          ],
          "line": 360
        },
        "resolved": true,
        "details": {
          "function_name": "hfs_ext_read_extent",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/hfs/extent.c",
          "lines": "187-202",
          "snippet": "static int hfs_ext_read_extent(struct inode *inode, u16 block)\n{\n\tstruct hfs_find_data fd;\n\tint res;\n\n\tif (block >= HFS_I(inode)->cached_start &&\n\t    block < HFS_I(inode)->cached_start + HFS_I(inode)->cached_blocks)\n\t\treturn 0;\n\n\tres = hfs_find_init(HFS_SB(inode->i_sb)->ext_tree, &fd);\n\tif (!res) {\n\t\tres = __hfs_ext_cache_extent(&fd, inode, block);\n\t\thfs_find_exit(&fd);\n\t}\n\treturn res;\n}",
          "includes": [
            "#include \"btree.h\"",
            "#include \"hfs_fs.h\"",
            "#include <linux/pagemap.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"btree.h\"\n#include \"hfs_fs.h\"\n#include <linux/pagemap.h>\n\nstatic int hfs_ext_read_extent(struct inode *inode, u16 block)\n{\n\tstruct hfs_find_data fd;\n\tint res;\n\n\tif (block >= HFS_I(inode)->cached_start &&\n\t    block < HFS_I(inode)->cached_start + HFS_I(inode)->cached_blocks)\n\t\treturn 0;\n\n\tres = hfs_find_init(HFS_SB(inode->i_sb)->ext_tree, &fd);\n\tif (!res) {\n\t\tres = __hfs_ext_cache_extent(&fd, inode, block);\n\t\thfs_find_exit(&fd);\n\t}\n\treturn res;\n}"
        }
      },
      {
        "call_info": {
          "callee": "mutex_lock",
          "args": [
            "&HFS_I(inode)->extents_lock"
          ],
          "line": 359
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "HFS_I",
          "args": [
            "inode"
          ],
          "line": 359
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "HFS_I",
          "args": [
            "inode"
          ],
          "line": 355
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "HFS_I",
          "args": [
            "inode"
          ],
          "line": 354
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "hfs_extend_file",
          "args": [
            "inode"
          ],
          "line": 347
        },
        "resolved": true,
        "details": {
          "function_name": "hfs_extend_file",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/hfs/extent.c",
          "lines": "385-468",
          "snippet": "int hfs_extend_file(struct inode *inode)\n{\n\tstruct super_block *sb = inode->i_sb;\n\tu32 start, len, goal;\n\tint res;\n\n\tmutex_lock(&HFS_I(inode)->extents_lock);\n\tif (HFS_I(inode)->alloc_blocks == HFS_I(inode)->first_blocks)\n\t\tgoal = hfs_ext_lastblock(HFS_I(inode)->first_extents);\n\telse {\n\t\tres = hfs_ext_read_extent(inode, HFS_I(inode)->alloc_blocks);\n\t\tif (res)\n\t\t\tgoto out;\n\t\tgoal = hfs_ext_lastblock(HFS_I(inode)->cached_extents);\n\t}\n\n\tlen = HFS_I(inode)->clump_blocks;\n\tstart = hfs_vbm_search_free(sb, goal, &len);\n\tif (!len) {\n\t\tres = -ENOSPC;\n\t\tgoto out;\n\t}\n\n\thfs_dbg(EXTENT, \"extend %lu: %u,%u\\n\", inode->i_ino, start, len);\n\tif (HFS_I(inode)->alloc_blocks == HFS_I(inode)->first_blocks) {\n\t\tif (!HFS_I(inode)->first_blocks) {\n\t\t\thfs_dbg(EXTENT, \"first extents\\n\");\n\t\t\t/* no extents yet */\n\t\t\tHFS_I(inode)->first_extents[0].block = cpu_to_be16(start);\n\t\t\tHFS_I(inode)->first_extents[0].count = cpu_to_be16(len);\n\t\t\tres = 0;\n\t\t} else {\n\t\t\t/* try to append to extents in inode */\n\t\t\tres = hfs_add_extent(HFS_I(inode)->first_extents,\n\t\t\t\t\t     HFS_I(inode)->alloc_blocks,\n\t\t\t\t\t     start, len);\n\t\t\tif (res == -ENOSPC)\n\t\t\t\tgoto insert_extent;\n\t\t}\n\t\tif (!res) {\n\t\t\thfs_dump_extent(HFS_I(inode)->first_extents);\n\t\t\tHFS_I(inode)->first_blocks += len;\n\t\t}\n\t} else {\n\t\tres = hfs_add_extent(HFS_I(inode)->cached_extents,\n\t\t\t\t     HFS_I(inode)->alloc_blocks -\n\t\t\t\t     HFS_I(inode)->cached_start,\n\t\t\t\t     start, len);\n\t\tif (!res) {\n\t\t\thfs_dump_extent(HFS_I(inode)->cached_extents);\n\t\t\tHFS_I(inode)->flags |= HFS_FLG_EXT_DIRTY;\n\t\t\tHFS_I(inode)->cached_blocks += len;\n\t\t} else if (res == -ENOSPC)\n\t\t\tgoto insert_extent;\n\t}\nout:\n\tmutex_unlock(&HFS_I(inode)->extents_lock);\n\tif (!res) {\n\t\tHFS_I(inode)->alloc_blocks += len;\n\t\tmark_inode_dirty(inode);\n\t\tif (inode->i_ino < HFS_FIRSTUSER_CNID)\n\t\t\tset_bit(HFS_FLG_ALT_MDB_DIRTY, &HFS_SB(sb)->flags);\n\t\tset_bit(HFS_FLG_MDB_DIRTY, &HFS_SB(sb)->flags);\n\t\thfs_mark_mdb_dirty(sb);\n\t}\n\treturn res;\n\ninsert_extent:\n\thfs_dbg(EXTENT, \"insert new extent\\n\");\n\tres = hfs_ext_write_extent(inode);\n\tif (res)\n\t\tgoto out;\n\n\tmemset(HFS_I(inode)->cached_extents, 0, sizeof(hfs_extent_rec));\n\tHFS_I(inode)->cached_extents[0].block = cpu_to_be16(start);\n\tHFS_I(inode)->cached_extents[0].count = cpu_to_be16(len);\n\thfs_dump_extent(HFS_I(inode)->cached_extents);\n\tHFS_I(inode)->flags |= HFS_FLG_EXT_DIRTY|HFS_FLG_EXT_NEW;\n\tHFS_I(inode)->cached_start = HFS_I(inode)->alloc_blocks;\n\tHFS_I(inode)->cached_blocks = len;\n\n\tres = 0;\n\tgoto out;\n}",
          "includes": [
            "#include \"btree.h\"",
            "#include \"hfs_fs.h\"",
            "#include <linux/pagemap.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"btree.h\"\n#include \"hfs_fs.h\"\n#include <linux/pagemap.h>\n\nint hfs_extend_file(struct inode *inode)\n{\n\tstruct super_block *sb = inode->i_sb;\n\tu32 start, len, goal;\n\tint res;\n\n\tmutex_lock(&HFS_I(inode)->extents_lock);\n\tif (HFS_I(inode)->alloc_blocks == HFS_I(inode)->first_blocks)\n\t\tgoal = hfs_ext_lastblock(HFS_I(inode)->first_extents);\n\telse {\n\t\tres = hfs_ext_read_extent(inode, HFS_I(inode)->alloc_blocks);\n\t\tif (res)\n\t\t\tgoto out;\n\t\tgoal = hfs_ext_lastblock(HFS_I(inode)->cached_extents);\n\t}\n\n\tlen = HFS_I(inode)->clump_blocks;\n\tstart = hfs_vbm_search_free(sb, goal, &len);\n\tif (!len) {\n\t\tres = -ENOSPC;\n\t\tgoto out;\n\t}\n\n\thfs_dbg(EXTENT, \"extend %lu: %u,%u\\n\", inode->i_ino, start, len);\n\tif (HFS_I(inode)->alloc_blocks == HFS_I(inode)->first_blocks) {\n\t\tif (!HFS_I(inode)->first_blocks) {\n\t\t\thfs_dbg(EXTENT, \"first extents\\n\");\n\t\t\t/* no extents yet */\n\t\t\tHFS_I(inode)->first_extents[0].block = cpu_to_be16(start);\n\t\t\tHFS_I(inode)->first_extents[0].count = cpu_to_be16(len);\n\t\t\tres = 0;\n\t\t} else {\n\t\t\t/* try to append to extents in inode */\n\t\t\tres = hfs_add_extent(HFS_I(inode)->first_extents,\n\t\t\t\t\t     HFS_I(inode)->alloc_blocks,\n\t\t\t\t\t     start, len);\n\t\t\tif (res == -ENOSPC)\n\t\t\t\tgoto insert_extent;\n\t\t}\n\t\tif (!res) {\n\t\t\thfs_dump_extent(HFS_I(inode)->first_extents);\n\t\t\tHFS_I(inode)->first_blocks += len;\n\t\t}\n\t} else {\n\t\tres = hfs_add_extent(HFS_I(inode)->cached_extents,\n\t\t\t\t     HFS_I(inode)->alloc_blocks -\n\t\t\t\t     HFS_I(inode)->cached_start,\n\t\t\t\t     start, len);\n\t\tif (!res) {\n\t\t\thfs_dump_extent(HFS_I(inode)->cached_extents);\n\t\t\tHFS_I(inode)->flags |= HFS_FLG_EXT_DIRTY;\n\t\t\tHFS_I(inode)->cached_blocks += len;\n\t\t} else if (res == -ENOSPC)\n\t\t\tgoto insert_extent;\n\t}\nout:\n\tmutex_unlock(&HFS_I(inode)->extents_lock);\n\tif (!res) {\n\t\tHFS_I(inode)->alloc_blocks += len;\n\t\tmark_inode_dirty(inode);\n\t\tif (inode->i_ino < HFS_FIRSTUSER_CNID)\n\t\t\tset_bit(HFS_FLG_ALT_MDB_DIRTY, &HFS_SB(sb)->flags);\n\t\tset_bit(HFS_FLG_MDB_DIRTY, &HFS_SB(sb)->flags);\n\t\thfs_mark_mdb_dirty(sb);\n\t}\n\treturn res;\n\ninsert_extent:\n\thfs_dbg(EXTENT, \"insert new extent\\n\");\n\tres = hfs_ext_write_extent(inode);\n\tif (res)\n\t\tgoto out;\n\n\tmemset(HFS_I(inode)->cached_extents, 0, sizeof(hfs_extent_rec));\n\tHFS_I(inode)->cached_extents[0].block = cpu_to_be16(start);\n\tHFS_I(inode)->cached_extents[0].count = cpu_to_be16(len);\n\thfs_dump_extent(HFS_I(inode)->cached_extents);\n\tHFS_I(inode)->flags |= HFS_FLG_EXT_DIRTY|HFS_FLG_EXT_NEW;\n\tHFS_I(inode)->cached_start = HFS_I(inode)->alloc_blocks;\n\tHFS_I(inode)->cached_blocks = len;\n\n\tres = 0;\n\tgoto out;\n}"
        }
      },
      {
        "call_info": {
          "callee": "HFS_I",
          "args": [
            "inode"
          ],
          "line": 346
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "HFS_I",
          "args": [
            "inode"
          ],
          "line": 344
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "HFS_I",
          "args": [
            "inode"
          ],
          "line": 343
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "HFS_SB",
          "args": [
            "sb"
          ],
          "line": 341
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"btree.h\"\n#include \"hfs_fs.h\"\n#include <linux/pagemap.h>\n\nint hfs_get_block(struct inode *inode, sector_t block,\n\t\t  struct buffer_head *bh_result, int create)\n{\n\tstruct super_block *sb;\n\tu16 dblock, ablock;\n\tint res;\n\n\tsb = inode->i_sb;\n\t/* Convert inode block to disk allocation block */\n\tablock = (u32)block / HFS_SB(sb)->fs_div;\n\n\tif (block >= HFS_I(inode)->fs_blocks) {\n\t\tif (block > HFS_I(inode)->fs_blocks || !create)\n\t\t\treturn -EIO;\n\t\tif (ablock >= HFS_I(inode)->alloc_blocks) {\n\t\t\tres = hfs_extend_file(inode);\n\t\t\tif (res)\n\t\t\t\treturn res;\n\t\t}\n\t} else\n\t\tcreate = 0;\n\n\tif (ablock < HFS_I(inode)->first_blocks) {\n\t\tdblock = hfs_ext_find_block(HFS_I(inode)->first_extents, ablock);\n\t\tgoto done;\n\t}\n\n\tmutex_lock(&HFS_I(inode)->extents_lock);\n\tres = hfs_ext_read_extent(inode, ablock);\n\tif (!res)\n\t\tdblock = hfs_ext_find_block(HFS_I(inode)->cached_extents,\n\t\t\t\t\t    ablock - HFS_I(inode)->cached_start);\n\telse {\n\t\tmutex_unlock(&HFS_I(inode)->extents_lock);\n\t\treturn -EIO;\n\t}\n\tmutex_unlock(&HFS_I(inode)->extents_lock);\n\ndone:\n\tmap_bh(bh_result, sb, HFS_SB(sb)->fs_start +\n\t       dblock * HFS_SB(sb)->fs_div +\n\t       (u32)block % HFS_SB(sb)->fs_div);\n\n\tif (create) {\n\t\tset_buffer_new(bh_result);\n\t\tHFS_I(inode)->phys_size += sb->s_blocksize;\n\t\tHFS_I(inode)->fs_blocks++;\n\t\tinode_add_bytes(inode, sb->s_blocksize);\n\t\tmark_inode_dirty(inode);\n\t}\n\treturn 0;\n}"
  },
  {
    "function_name": "hfs_free_fork",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/hfs/extent.c",
    "lines": "283-327",
    "snippet": "int hfs_free_fork(struct super_block *sb, struct hfs_cat_file *file, int type)\n{\n\tstruct hfs_find_data fd;\n\tu32 total_blocks, blocks, start;\n\tu32 cnid = be32_to_cpu(file->FlNum);\n\tstruct hfs_extent *extent;\n\tint res, i;\n\n\tif (type == HFS_FK_DATA) {\n\t\ttotal_blocks = be32_to_cpu(file->PyLen);\n\t\textent = file->ExtRec;\n\t} else {\n\t\ttotal_blocks = be32_to_cpu(file->RPyLen);\n\t\textent = file->RExtRec;\n\t}\n\ttotal_blocks /= HFS_SB(sb)->alloc_blksz;\n\tif (!total_blocks)\n\t\treturn 0;\n\n\tblocks = 0;\n\tfor (i = 0; i < 3; extent++, i++)\n\t\tblocks += be16_to_cpu(extent[i].count);\n\n\tres = hfs_free_extents(sb, extent, blocks, blocks);\n\tif (res)\n\t\treturn res;\n\tif (total_blocks == blocks)\n\t\treturn 0;\n\n\tres = hfs_find_init(HFS_SB(sb)->ext_tree, &fd);\n\tif (res)\n\t\treturn res;\n\tdo {\n\t\tres = __hfs_ext_read_extent(&fd, extent, cnid, total_blocks, type);\n\t\tif (res)\n\t\t\tbreak;\n\t\tstart = be16_to_cpu(fd.key->ext.FABN);\n\t\thfs_free_extents(sb, extent, total_blocks - start, total_blocks);\n\t\thfs_brec_remove(&fd);\n\t\ttotal_blocks = start;\n\t} while (total_blocks > blocks);\n\thfs_find_exit(&fd);\n\n\treturn res;\n}",
    "includes": [
      "#include \"btree.h\"",
      "#include \"hfs_fs.h\"",
      "#include <linux/pagemap.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "hfs_find_exit",
          "args": [
            "&fd"
          ],
          "line": 324
        },
        "resolved": true,
        "details": {
          "function_name": "hfs_find_exit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/hfs/bfind.c",
          "lines": "31-39",
          "snippet": "void hfs_find_exit(struct hfs_find_data *fd)\n{\n\thfs_bnode_put(fd->bnode);\n\tkfree(fd->search_key);\n\thfs_dbg(BNODE_REFS, \"find_exit: %d (%p)\\n\",\n\t\tfd->tree->cnid, __builtin_return_address(0));\n\tmutex_unlock(&fd->tree->tree_lock);\n\tfd->tree = NULL;\n}",
          "includes": [
            "#include \"btree.h\"",
            "#include <linux/slab.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"btree.h\"\n#include <linux/slab.h>\n\nvoid hfs_find_exit(struct hfs_find_data *fd)\n{\n\thfs_bnode_put(fd->bnode);\n\tkfree(fd->search_key);\n\thfs_dbg(BNODE_REFS, \"find_exit: %d (%p)\\n\",\n\t\tfd->tree->cnid, __builtin_return_address(0));\n\tmutex_unlock(&fd->tree->tree_lock);\n\tfd->tree = NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "hfs_brec_remove",
          "args": [
            "&fd"
          ],
          "line": 321
        },
        "resolved": true,
        "details": {
          "function_name": "hfs_brec_remove",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/hfs/brec.c",
          "lines": "175-227",
          "snippet": "int hfs_brec_remove(struct hfs_find_data *fd)\n{\n\tstruct hfs_btree *tree;\n\tstruct hfs_bnode *node, *parent;\n\tint end_off, rec_off, data_off, size;\n\n\ttree = fd->tree;\n\tnode = fd->bnode;\nagain:\n\trec_off = tree->node_size - (fd->record + 2) * 2;\n\tend_off = tree->node_size - (node->num_recs + 1) * 2;\n\n\tif (node->type == HFS_NODE_LEAF) {\n\t\ttree->leaf_count--;\n\t\tmark_inode_dirty(tree->inode);\n\t}\n\thfs_bnode_dump(node);\n\thfs_dbg(BNODE_MOD, \"remove_rec: %d, %d\\n\",\n\t\tfd->record, fd->keylength + fd->entrylength);\n\tif (!--node->num_recs) {\n\t\thfs_bnode_unlink(node);\n\t\tif (!node->parent)\n\t\t\treturn 0;\n\t\tparent = hfs_bnode_find(tree, node->parent);\n\t\tif (IS_ERR(parent))\n\t\t\treturn PTR_ERR(parent);\n\t\thfs_bnode_put(node);\n\t\tnode = fd->bnode = parent;\n\n\t\t__hfs_brec_find(node, fd);\n\t\tgoto again;\n\t}\n\thfs_bnode_write_u16(node, offsetof(struct hfs_bnode_desc, num_recs), node->num_recs);\n\n\tif (rec_off == end_off)\n\t\tgoto skip;\n\tsize = fd->keylength + fd->entrylength;\n\n\tdo {\n\t\tdata_off = hfs_bnode_read_u16(node, rec_off);\n\t\thfs_bnode_write_u16(node, rec_off + 2, data_off - size);\n\t\trec_off -= 2;\n\t} while (rec_off >= end_off);\n\n\t/* fill hole */\n\thfs_bnode_move(node, fd->keyoffset, fd->keyoffset + size,\n\t\t       data_off - fd->keyoffset - size);\nskip:\n\thfs_bnode_dump(node);\n\tif (!fd->record)\n\t\thfs_brec_update_parent(fd);\n\treturn 0;\n}",
          "includes": [
            "#include \"btree.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static struct hfs_bnode *hfs_bnode_split(struct hfs_find_data *fd);",
            "static int hfs_brec_update_parent(struct hfs_find_data *fd);",
            "static int hfs_btree_inc_height(struct hfs_btree *tree);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"btree.h\"\n\nstatic struct hfs_bnode *hfs_bnode_split(struct hfs_find_data *fd);\nstatic int hfs_brec_update_parent(struct hfs_find_data *fd);\nstatic int hfs_btree_inc_height(struct hfs_btree *tree);\n\nint hfs_brec_remove(struct hfs_find_data *fd)\n{\n\tstruct hfs_btree *tree;\n\tstruct hfs_bnode *node, *parent;\n\tint end_off, rec_off, data_off, size;\n\n\ttree = fd->tree;\n\tnode = fd->bnode;\nagain:\n\trec_off = tree->node_size - (fd->record + 2) * 2;\n\tend_off = tree->node_size - (node->num_recs + 1) * 2;\n\n\tif (node->type == HFS_NODE_LEAF) {\n\t\ttree->leaf_count--;\n\t\tmark_inode_dirty(tree->inode);\n\t}\n\thfs_bnode_dump(node);\n\thfs_dbg(BNODE_MOD, \"remove_rec: %d, %d\\n\",\n\t\tfd->record, fd->keylength + fd->entrylength);\n\tif (!--node->num_recs) {\n\t\thfs_bnode_unlink(node);\n\t\tif (!node->parent)\n\t\t\treturn 0;\n\t\tparent = hfs_bnode_find(tree, node->parent);\n\t\tif (IS_ERR(parent))\n\t\t\treturn PTR_ERR(parent);\n\t\thfs_bnode_put(node);\n\t\tnode = fd->bnode = parent;\n\n\t\t__hfs_brec_find(node, fd);\n\t\tgoto again;\n\t}\n\thfs_bnode_write_u16(node, offsetof(struct hfs_bnode_desc, num_recs), node->num_recs);\n\n\tif (rec_off == end_off)\n\t\tgoto skip;\n\tsize = fd->keylength + fd->entrylength;\n\n\tdo {\n\t\tdata_off = hfs_bnode_read_u16(node, rec_off);\n\t\thfs_bnode_write_u16(node, rec_off + 2, data_off - size);\n\t\trec_off -= 2;\n\t} while (rec_off >= end_off);\n\n\t/* fill hole */\n\thfs_bnode_move(node, fd->keyoffset, fd->keyoffset + size,\n\t\t       data_off - fd->keyoffset - size);\nskip:\n\thfs_bnode_dump(node);\n\tif (!fd->record)\n\t\thfs_brec_update_parent(fd);\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "hfs_free_extents",
          "args": [
            "sb",
            "extent",
            "total_blocks - start",
            "total_blocks"
          ],
          "line": 320
        },
        "resolved": true,
        "details": {
          "function_name": "hfs_free_extents",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/hfs/extent.c",
          "lines": "244-281",
          "snippet": "static int hfs_free_extents(struct super_block *sb, struct hfs_extent *extent,\n\t\t\t    u16 offset, u16 block_nr)\n{\n\tu16 count, start;\n\tint i;\n\n\thfs_dump_extent(extent);\n\tfor (i = 0; i < 3; extent++, i++) {\n\t\tcount = be16_to_cpu(extent->count);\n\t\tif (offset == count)\n\t\t\tgoto found;\n\t\telse if (offset < count)\n\t\t\tbreak;\n\t\toffset -= count;\n\t}\n\t/* panic? */\n\treturn -EIO;\nfound:\n\tfor (;;) {\n\t\tstart = be16_to_cpu(extent->block);\n\t\tif (count <= block_nr) {\n\t\t\thfs_clear_vbm_bits(sb, start, count);\n\t\t\textent->block = 0;\n\t\t\textent->count = 0;\n\t\t\tblock_nr -= count;\n\t\t} else {\n\t\t\tcount -= block_nr;\n\t\t\thfs_clear_vbm_bits(sb, start + count, block_nr);\n\t\t\textent->count = cpu_to_be16(count);\n\t\t\tblock_nr = 0;\n\t\t}\n\t\tif (!block_nr || !i)\n\t\t\treturn 0;\n\t\ti--;\n\t\textent--;\n\t\tcount = be16_to_cpu(extent->count);\n\t}\n}",
          "includes": [
            "#include \"btree.h\"",
            "#include \"hfs_fs.h\"",
            "#include <linux/pagemap.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"btree.h\"\n#include \"hfs_fs.h\"\n#include <linux/pagemap.h>\n\nstatic int hfs_free_extents(struct super_block *sb, struct hfs_extent *extent,\n\t\t\t    u16 offset, u16 block_nr)\n{\n\tu16 count, start;\n\tint i;\n\n\thfs_dump_extent(extent);\n\tfor (i = 0; i < 3; extent++, i++) {\n\t\tcount = be16_to_cpu(extent->count);\n\t\tif (offset == count)\n\t\t\tgoto found;\n\t\telse if (offset < count)\n\t\t\tbreak;\n\t\toffset -= count;\n\t}\n\t/* panic? */\n\treturn -EIO;\nfound:\n\tfor (;;) {\n\t\tstart = be16_to_cpu(extent->block);\n\t\tif (count <= block_nr) {\n\t\t\thfs_clear_vbm_bits(sb, start, count);\n\t\t\textent->block = 0;\n\t\t\textent->count = 0;\n\t\t\tblock_nr -= count;\n\t\t} else {\n\t\t\tcount -= block_nr;\n\t\t\thfs_clear_vbm_bits(sb, start + count, block_nr);\n\t\t\textent->count = cpu_to_be16(count);\n\t\t\tblock_nr = 0;\n\t\t}\n\t\tif (!block_nr || !i)\n\t\t\treturn 0;\n\t\ti--;\n\t\textent--;\n\t\tcount = be16_to_cpu(extent->count);\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "be16_to_cpu",
          "args": [
            "fd.key->ext.FABN"
          ],
          "line": 319
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "__hfs_ext_read_extent",
          "args": [
            "&fd",
            "extent",
            "cnid",
            "total_blocks",
            "type"
          ],
          "line": 316
        },
        "resolved": true,
        "details": {
          "function_name": "__hfs_ext_read_extent",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/hfs/extent.c",
          "lines": "146-163",
          "snippet": "static inline int __hfs_ext_read_extent(struct hfs_find_data *fd, struct hfs_extent *extent,\n\t\t\t\t\tu32 cnid, u32 block, u8 type)\n{\n\tint res;\n\n\thfs_ext_build_key(fd->search_key, cnid, block, type);\n\tfd->key->ext.FNum = 0;\n\tres = hfs_brec_find(fd);\n\tif (res && res != -ENOENT)\n\t\treturn res;\n\tif (fd->key->ext.FNum != fd->search_key->ext.FNum ||\n\t    fd->key->ext.FkType != fd->search_key->ext.FkType)\n\t\treturn -ENOENT;\n\tif (fd->entrylength != sizeof(hfs_extent_rec))\n\t\treturn -EIO;\n\thfs_bnode_read(fd->bnode, extent, fd->entryoffset, sizeof(hfs_extent_rec));\n\treturn 0;\n}",
          "includes": [
            "#include \"btree.h\"",
            "#include \"hfs_fs.h\"",
            "#include <linux/pagemap.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"btree.h\"\n#include \"hfs_fs.h\"\n#include <linux/pagemap.h>\n\nstatic inline int __hfs_ext_read_extent(struct hfs_find_data *fd, struct hfs_extent *extent,\n\t\t\t\t\tu32 cnid, u32 block, u8 type)\n{\n\tint res;\n\n\thfs_ext_build_key(fd->search_key, cnid, block, type);\n\tfd->key->ext.FNum = 0;\n\tres = hfs_brec_find(fd);\n\tif (res && res != -ENOENT)\n\t\treturn res;\n\tif (fd->key->ext.FNum != fd->search_key->ext.FNum ||\n\t    fd->key->ext.FkType != fd->search_key->ext.FkType)\n\t\treturn -ENOENT;\n\tif (fd->entrylength != sizeof(hfs_extent_rec))\n\t\treturn -EIO;\n\thfs_bnode_read(fd->bnode, extent, fd->entryoffset, sizeof(hfs_extent_rec));\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "hfs_find_init",
          "args": [
            "HFS_SB(sb)->ext_tree",
            "&fd"
          ],
          "line": 312
        },
        "resolved": true,
        "details": {
          "function_name": "hfs_find_init",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/hfs/bfind.c",
          "lines": "14-29",
          "snippet": "int hfs_find_init(struct hfs_btree *tree, struct hfs_find_data *fd)\n{\n\tvoid *ptr;\n\n\tfd->tree = tree;\n\tfd->bnode = NULL;\n\tptr = kmalloc(tree->max_key_len * 2 + 4, GFP_KERNEL);\n\tif (!ptr)\n\t\treturn -ENOMEM;\n\tfd->search_key = ptr;\n\tfd->key = ptr + tree->max_key_len + 2;\n\thfs_dbg(BNODE_REFS, \"find_init: %d (%p)\\n\",\n\t\ttree->cnid, __builtin_return_address(0));\n\tmutex_lock(&tree->tree_lock);\n\treturn 0;\n}",
          "includes": [
            "#include \"btree.h\"",
            "#include <linux/slab.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"btree.h\"\n#include <linux/slab.h>\n\nint hfs_find_init(struct hfs_btree *tree, struct hfs_find_data *fd)\n{\n\tvoid *ptr;\n\n\tfd->tree = tree;\n\tfd->bnode = NULL;\n\tptr = kmalloc(tree->max_key_len * 2 + 4, GFP_KERNEL);\n\tif (!ptr)\n\t\treturn -ENOMEM;\n\tfd->search_key = ptr;\n\tfd->key = ptr + tree->max_key_len + 2;\n\thfs_dbg(BNODE_REFS, \"find_init: %d (%p)\\n\",\n\t\ttree->cnid, __builtin_return_address(0));\n\tmutex_lock(&tree->tree_lock);\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "HFS_SB",
          "args": [
            "sb"
          ],
          "line": 312
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "be16_to_cpu",
          "args": [
            "extent[i].count"
          ],
          "line": 304
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "HFS_SB",
          "args": [
            "sb"
          ],
          "line": 298
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "be32_to_cpu",
          "args": [
            "file->RPyLen"
          ],
          "line": 295
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "be32_to_cpu",
          "args": [
            "file->PyLen"
          ],
          "line": 292
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "be32_to_cpu",
          "args": [
            "file->FlNum"
          ],
          "line": 287
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"btree.h\"\n#include \"hfs_fs.h\"\n#include <linux/pagemap.h>\n\nint hfs_free_fork(struct super_block *sb, struct hfs_cat_file *file, int type)\n{\n\tstruct hfs_find_data fd;\n\tu32 total_blocks, blocks, start;\n\tu32 cnid = be32_to_cpu(file->FlNum);\n\tstruct hfs_extent *extent;\n\tint res, i;\n\n\tif (type == HFS_FK_DATA) {\n\t\ttotal_blocks = be32_to_cpu(file->PyLen);\n\t\textent = file->ExtRec;\n\t} else {\n\t\ttotal_blocks = be32_to_cpu(file->RPyLen);\n\t\textent = file->RExtRec;\n\t}\n\ttotal_blocks /= HFS_SB(sb)->alloc_blksz;\n\tif (!total_blocks)\n\t\treturn 0;\n\n\tblocks = 0;\n\tfor (i = 0; i < 3; extent++, i++)\n\t\tblocks += be16_to_cpu(extent[i].count);\n\n\tres = hfs_free_extents(sb, extent, blocks, blocks);\n\tif (res)\n\t\treturn res;\n\tif (total_blocks == blocks)\n\t\treturn 0;\n\n\tres = hfs_find_init(HFS_SB(sb)->ext_tree, &fd);\n\tif (res)\n\t\treturn res;\n\tdo {\n\t\tres = __hfs_ext_read_extent(&fd, extent, cnid, total_blocks, type);\n\t\tif (res)\n\t\t\tbreak;\n\t\tstart = be16_to_cpu(fd.key->ext.FABN);\n\t\thfs_free_extents(sb, extent, total_blocks - start, total_blocks);\n\t\thfs_brec_remove(&fd);\n\t\ttotal_blocks = start;\n\t} while (total_blocks > blocks);\n\thfs_find_exit(&fd);\n\n\treturn res;\n}"
  },
  {
    "function_name": "hfs_free_extents",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/hfs/extent.c",
    "lines": "244-281",
    "snippet": "static int hfs_free_extents(struct super_block *sb, struct hfs_extent *extent,\n\t\t\t    u16 offset, u16 block_nr)\n{\n\tu16 count, start;\n\tint i;\n\n\thfs_dump_extent(extent);\n\tfor (i = 0; i < 3; extent++, i++) {\n\t\tcount = be16_to_cpu(extent->count);\n\t\tif (offset == count)\n\t\t\tgoto found;\n\t\telse if (offset < count)\n\t\t\tbreak;\n\t\toffset -= count;\n\t}\n\t/* panic? */\n\treturn -EIO;\nfound:\n\tfor (;;) {\n\t\tstart = be16_to_cpu(extent->block);\n\t\tif (count <= block_nr) {\n\t\t\thfs_clear_vbm_bits(sb, start, count);\n\t\t\textent->block = 0;\n\t\t\textent->count = 0;\n\t\t\tblock_nr -= count;\n\t\t} else {\n\t\t\tcount -= block_nr;\n\t\t\thfs_clear_vbm_bits(sb, start + count, block_nr);\n\t\t\textent->count = cpu_to_be16(count);\n\t\t\tblock_nr = 0;\n\t\t}\n\t\tif (!block_nr || !i)\n\t\t\treturn 0;\n\t\ti--;\n\t\textent--;\n\t\tcount = be16_to_cpu(extent->count);\n\t}\n}",
    "includes": [
      "#include \"btree.h\"",
      "#include \"hfs_fs.h\"",
      "#include <linux/pagemap.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "be16_to_cpu",
          "args": [
            "extent->count"
          ],
          "line": 279
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "cpu_to_be16",
          "args": [
            "count"
          ],
          "line": 272
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "hfs_clear_vbm_bits",
          "args": [
            "sb",
            "start + count",
            "block_nr"
          ],
          "line": 271
        },
        "resolved": true,
        "details": {
          "function_name": "hfs_clear_vbm_bits",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/hfs/bitmap.c",
          "lines": "193-243",
          "snippet": "int hfs_clear_vbm_bits(struct super_block *sb, u16 start, u16 count)\n{\n\t__be32 *curr;\n\tu32 mask;\n\tint i, len;\n\n\t/* is there any actual work to be done? */\n\tif (!count)\n\t\treturn 0;\n\n\thfs_dbg(BITMAP, \"clear_bits: %u,%u\\n\", start, count);\n\t/* are all of the bits in range? */\n\tif ((start + count) > HFS_SB(sb)->fs_ablocks)\n\t\treturn -2;\n\n\tmutex_lock(&HFS_SB(sb)->bitmap_lock);\n\t/* bitmap is always on a 32-bit boundary */\n\tcurr = HFS_SB(sb)->bitmap + (start / 32);\n\tlen = count;\n\n\t/* do any partial u32 at the start */\n\ti = start % 32;\n\tif (i) {\n\t\tint j = 32 - i;\n\t\tmask = 0xffffffffU << j;\n\t\tif (j > count) {\n\t\t\tmask |= 0xffffffffU >> (i + count);\n\t\t\t*curr &= cpu_to_be32(mask);\n\t\t\tgoto out;\n\t\t}\n\t\t*curr++ &= cpu_to_be32(mask);\n\t\tcount -= j;\n\t}\n\n\t/* do full u32s */\n\twhile (count >= 32) {\n\t\t*curr++ = 0;\n\t\tcount -= 32;\n\t}\n\t/* do any partial u32 at end */\n\tif (count) {\n\t\tmask = 0xffffffffU >> count;\n\t\t*curr &= cpu_to_be32(mask);\n\t}\nout:\n\tHFS_SB(sb)->free_ablocks += len;\n\tmutex_unlock(&HFS_SB(sb)->bitmap_lock);\n\thfs_bitmap_dirty(sb);\n\n\treturn 0;\n}",
          "includes": [
            "#include \"hfs_fs.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"hfs_fs.h\"\n\nint hfs_clear_vbm_bits(struct super_block *sb, u16 start, u16 count)\n{\n\t__be32 *curr;\n\tu32 mask;\n\tint i, len;\n\n\t/* is there any actual work to be done? */\n\tif (!count)\n\t\treturn 0;\n\n\thfs_dbg(BITMAP, \"clear_bits: %u,%u\\n\", start, count);\n\t/* are all of the bits in range? */\n\tif ((start + count) > HFS_SB(sb)->fs_ablocks)\n\t\treturn -2;\n\n\tmutex_lock(&HFS_SB(sb)->bitmap_lock);\n\t/* bitmap is always on a 32-bit boundary */\n\tcurr = HFS_SB(sb)->bitmap + (start / 32);\n\tlen = count;\n\n\t/* do any partial u32 at the start */\n\ti = start % 32;\n\tif (i) {\n\t\tint j = 32 - i;\n\t\tmask = 0xffffffffU << j;\n\t\tif (j > count) {\n\t\t\tmask |= 0xffffffffU >> (i + count);\n\t\t\t*curr &= cpu_to_be32(mask);\n\t\t\tgoto out;\n\t\t}\n\t\t*curr++ &= cpu_to_be32(mask);\n\t\tcount -= j;\n\t}\n\n\t/* do full u32s */\n\twhile (count >= 32) {\n\t\t*curr++ = 0;\n\t\tcount -= 32;\n\t}\n\t/* do any partial u32 at end */\n\tif (count) {\n\t\tmask = 0xffffffffU >> count;\n\t\t*curr &= cpu_to_be32(mask);\n\t}\nout:\n\tHFS_SB(sb)->free_ablocks += len;\n\tmutex_unlock(&HFS_SB(sb)->bitmap_lock);\n\thfs_bitmap_dirty(sb);\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "be16_to_cpu",
          "args": [
            "extent->block"
          ],
          "line": 263
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "be16_to_cpu",
          "args": [
            "extent->count"
          ],
          "line": 252
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "hfs_dump_extent",
          "args": [
            "extent"
          ],
          "line": 250
        },
        "resolved": true,
        "details": {
          "function_name": "hfs_dump_extent",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/hfs/extent.c",
          "lines": "204-214",
          "snippet": "static void hfs_dump_extent(struct hfs_extent *extent)\n{\n\tint i;\n\n\thfs_dbg(EXTENT, \"   \");\n\tfor (i = 0; i < 3; i++)\n\t\thfs_dbg_cont(EXTENT, \" %u:%u\",\n\t\t\t     be16_to_cpu(extent[i].block),\n\t\t\t     be16_to_cpu(extent[i].count));\n\thfs_dbg_cont(EXTENT, \"\\n\");\n}",
          "includes": [
            "#include \"btree.h\"",
            "#include \"hfs_fs.h\"",
            "#include <linux/pagemap.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"btree.h\"\n#include \"hfs_fs.h\"\n#include <linux/pagemap.h>\n\nstatic void hfs_dump_extent(struct hfs_extent *extent)\n{\n\tint i;\n\n\thfs_dbg(EXTENT, \"   \");\n\tfor (i = 0; i < 3; i++)\n\t\thfs_dbg_cont(EXTENT, \" %u:%u\",\n\t\t\t     be16_to_cpu(extent[i].block),\n\t\t\t     be16_to_cpu(extent[i].count));\n\thfs_dbg_cont(EXTENT, \"\\n\");\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"btree.h\"\n#include \"hfs_fs.h\"\n#include <linux/pagemap.h>\n\nstatic int hfs_free_extents(struct super_block *sb, struct hfs_extent *extent,\n\t\t\t    u16 offset, u16 block_nr)\n{\n\tu16 count, start;\n\tint i;\n\n\thfs_dump_extent(extent);\n\tfor (i = 0; i < 3; extent++, i++) {\n\t\tcount = be16_to_cpu(extent->count);\n\t\tif (offset == count)\n\t\t\tgoto found;\n\t\telse if (offset < count)\n\t\t\tbreak;\n\t\toffset -= count;\n\t}\n\t/* panic? */\n\treturn -EIO;\nfound:\n\tfor (;;) {\n\t\tstart = be16_to_cpu(extent->block);\n\t\tif (count <= block_nr) {\n\t\t\thfs_clear_vbm_bits(sb, start, count);\n\t\t\textent->block = 0;\n\t\t\textent->count = 0;\n\t\t\tblock_nr -= count;\n\t\t} else {\n\t\t\tcount -= block_nr;\n\t\t\thfs_clear_vbm_bits(sb, start + count, block_nr);\n\t\t\textent->count = cpu_to_be16(count);\n\t\t\tblock_nr = 0;\n\t\t}\n\t\tif (!block_nr || !i)\n\t\t\treturn 0;\n\t\ti--;\n\t\textent--;\n\t\tcount = be16_to_cpu(extent->count);\n\t}\n}"
  },
  {
    "function_name": "hfs_add_extent",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/hfs/extent.c",
    "lines": "216-242",
    "snippet": "static int hfs_add_extent(struct hfs_extent *extent, u16 offset,\n\t\t\t  u16 alloc_block, u16 block_count)\n{\n\tu16 count, start;\n\tint i;\n\n\thfs_dump_extent(extent);\n\tfor (i = 0; i < 3; extent++, i++) {\n\t\tcount = be16_to_cpu(extent->count);\n\t\tif (offset == count) {\n\t\t\tstart = be16_to_cpu(extent->block);\n\t\t\tif (alloc_block != start + count) {\n\t\t\t\tif (++i >= 3)\n\t\t\t\t\treturn -ENOSPC;\n\t\t\t\textent++;\n\t\t\t\textent->block = cpu_to_be16(alloc_block);\n\t\t\t} else\n\t\t\t\tblock_count += count;\n\t\t\textent->count = cpu_to_be16(block_count);\n\t\t\treturn 0;\n\t\t} else if (offset < count)\n\t\t\tbreak;\n\t\toffset -= count;\n\t}\n\t/* panic? */\n\treturn -EIO;\n}",
    "includes": [
      "#include \"btree.h\"",
      "#include \"hfs_fs.h\"",
      "#include <linux/pagemap.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "cpu_to_be16",
          "args": [
            "block_count"
          ],
          "line": 234
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "cpu_to_be16",
          "args": [
            "alloc_block"
          ],
          "line": 231
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "be16_to_cpu",
          "args": [
            "extent->block"
          ],
          "line": 226
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "be16_to_cpu",
          "args": [
            "extent->count"
          ],
          "line": 224
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "hfs_dump_extent",
          "args": [
            "extent"
          ],
          "line": 222
        },
        "resolved": true,
        "details": {
          "function_name": "hfs_dump_extent",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/hfs/extent.c",
          "lines": "204-214",
          "snippet": "static void hfs_dump_extent(struct hfs_extent *extent)\n{\n\tint i;\n\n\thfs_dbg(EXTENT, \"   \");\n\tfor (i = 0; i < 3; i++)\n\t\thfs_dbg_cont(EXTENT, \" %u:%u\",\n\t\t\t     be16_to_cpu(extent[i].block),\n\t\t\t     be16_to_cpu(extent[i].count));\n\thfs_dbg_cont(EXTENT, \"\\n\");\n}",
          "includes": [
            "#include \"btree.h\"",
            "#include \"hfs_fs.h\"",
            "#include <linux/pagemap.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"btree.h\"\n#include \"hfs_fs.h\"\n#include <linux/pagemap.h>\n\nstatic void hfs_dump_extent(struct hfs_extent *extent)\n{\n\tint i;\n\n\thfs_dbg(EXTENT, \"   \");\n\tfor (i = 0; i < 3; i++)\n\t\thfs_dbg_cont(EXTENT, \" %u:%u\",\n\t\t\t     be16_to_cpu(extent[i].block),\n\t\t\t     be16_to_cpu(extent[i].count));\n\thfs_dbg_cont(EXTENT, \"\\n\");\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"btree.h\"\n#include \"hfs_fs.h\"\n#include <linux/pagemap.h>\n\nstatic int hfs_add_extent(struct hfs_extent *extent, u16 offset,\n\t\t\t  u16 alloc_block, u16 block_count)\n{\n\tu16 count, start;\n\tint i;\n\n\thfs_dump_extent(extent);\n\tfor (i = 0; i < 3; extent++, i++) {\n\t\tcount = be16_to_cpu(extent->count);\n\t\tif (offset == count) {\n\t\t\tstart = be16_to_cpu(extent->block);\n\t\t\tif (alloc_block != start + count) {\n\t\t\t\tif (++i >= 3)\n\t\t\t\t\treturn -ENOSPC;\n\t\t\t\textent++;\n\t\t\t\textent->block = cpu_to_be16(alloc_block);\n\t\t\t} else\n\t\t\t\tblock_count += count;\n\t\t\textent->count = cpu_to_be16(block_count);\n\t\t\treturn 0;\n\t\t} else if (offset < count)\n\t\t\tbreak;\n\t\toffset -= count;\n\t}\n\t/* panic? */\n\treturn -EIO;\n}"
  },
  {
    "function_name": "hfs_dump_extent",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/hfs/extent.c",
    "lines": "204-214",
    "snippet": "static void hfs_dump_extent(struct hfs_extent *extent)\n{\n\tint i;\n\n\thfs_dbg(EXTENT, \"   \");\n\tfor (i = 0; i < 3; i++)\n\t\thfs_dbg_cont(EXTENT, \" %u:%u\",\n\t\t\t     be16_to_cpu(extent[i].block),\n\t\t\t     be16_to_cpu(extent[i].count));\n\thfs_dbg_cont(EXTENT, \"\\n\");\n}",
    "includes": [
      "#include \"btree.h\"",
      "#include \"hfs_fs.h\"",
      "#include <linux/pagemap.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "hfs_dbg_cont",
          "args": [
            "EXTENT",
            "\"\\n\""
          ],
          "line": 213
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "hfs_dbg_cont",
          "args": [
            "EXTENT",
            "\" %u:%u\"",
            "be16_to_cpu(extent[i].block)",
            "be16_to_cpu(extent[i].count)"
          ],
          "line": 210
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "be16_to_cpu",
          "args": [
            "extent[i].count"
          ],
          "line": 212
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "be16_to_cpu",
          "args": [
            "extent[i].block"
          ],
          "line": 211
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "hfs_dbg",
          "args": [
            "EXTENT",
            "\"   \""
          ],
          "line": 208
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"btree.h\"\n#include \"hfs_fs.h\"\n#include <linux/pagemap.h>\n\nstatic void hfs_dump_extent(struct hfs_extent *extent)\n{\n\tint i;\n\n\thfs_dbg(EXTENT, \"   \");\n\tfor (i = 0; i < 3; i++)\n\t\thfs_dbg_cont(EXTENT, \" %u:%u\",\n\t\t\t     be16_to_cpu(extent[i].block),\n\t\t\t     be16_to_cpu(extent[i].count));\n\thfs_dbg_cont(EXTENT, \"\\n\");\n}"
  },
  {
    "function_name": "hfs_ext_read_extent",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/hfs/extent.c",
    "lines": "187-202",
    "snippet": "static int hfs_ext_read_extent(struct inode *inode, u16 block)\n{\n\tstruct hfs_find_data fd;\n\tint res;\n\n\tif (block >= HFS_I(inode)->cached_start &&\n\t    block < HFS_I(inode)->cached_start + HFS_I(inode)->cached_blocks)\n\t\treturn 0;\n\n\tres = hfs_find_init(HFS_SB(inode->i_sb)->ext_tree, &fd);\n\tif (!res) {\n\t\tres = __hfs_ext_cache_extent(&fd, inode, block);\n\t\thfs_find_exit(&fd);\n\t}\n\treturn res;\n}",
    "includes": [
      "#include \"btree.h\"",
      "#include \"hfs_fs.h\"",
      "#include <linux/pagemap.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "hfs_find_exit",
          "args": [
            "&fd"
          ],
          "line": 199
        },
        "resolved": true,
        "details": {
          "function_name": "hfs_find_exit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/hfs/bfind.c",
          "lines": "31-39",
          "snippet": "void hfs_find_exit(struct hfs_find_data *fd)\n{\n\thfs_bnode_put(fd->bnode);\n\tkfree(fd->search_key);\n\thfs_dbg(BNODE_REFS, \"find_exit: %d (%p)\\n\",\n\t\tfd->tree->cnid, __builtin_return_address(0));\n\tmutex_unlock(&fd->tree->tree_lock);\n\tfd->tree = NULL;\n}",
          "includes": [
            "#include \"btree.h\"",
            "#include <linux/slab.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"btree.h\"\n#include <linux/slab.h>\n\nvoid hfs_find_exit(struct hfs_find_data *fd)\n{\n\thfs_bnode_put(fd->bnode);\n\tkfree(fd->search_key);\n\thfs_dbg(BNODE_REFS, \"find_exit: %d (%p)\\n\",\n\t\tfd->tree->cnid, __builtin_return_address(0));\n\tmutex_unlock(&fd->tree->tree_lock);\n\tfd->tree = NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "__hfs_ext_cache_extent",
          "args": [
            "&fd",
            "inode",
            "block"
          ],
          "line": 198
        },
        "resolved": true,
        "details": {
          "function_name": "__hfs_ext_cache_extent",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/hfs/extent.c",
          "lines": "165-185",
          "snippet": "static inline int __hfs_ext_cache_extent(struct hfs_find_data *fd, struct inode *inode, u32 block)\n{\n\tint res;\n\n\tif (HFS_I(inode)->flags & HFS_FLG_EXT_DIRTY) {\n\t\tres = __hfs_ext_write_extent(inode, fd);\n\t\tif (res)\n\t\t\treturn res;\n\t}\n\n\tres = __hfs_ext_read_extent(fd, HFS_I(inode)->cached_extents, inode->i_ino,\n\t\t\t\t    block, HFS_IS_RSRC(inode) ? HFS_FK_RSRC : HFS_FK_DATA);\n\tif (!res) {\n\t\tHFS_I(inode)->cached_start = be16_to_cpu(fd->key->ext.FABN);\n\t\tHFS_I(inode)->cached_blocks = hfs_ext_block_count(HFS_I(inode)->cached_extents);\n\t} else {\n\t\tHFS_I(inode)->cached_start = HFS_I(inode)->cached_blocks = 0;\n\t\tHFS_I(inode)->flags &= ~(HFS_FLG_EXT_DIRTY|HFS_FLG_EXT_NEW);\n\t}\n\treturn res;\n}",
          "includes": [
            "#include \"btree.h\"",
            "#include \"hfs_fs.h\"",
            "#include <linux/pagemap.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"btree.h\"\n#include \"hfs_fs.h\"\n#include <linux/pagemap.h>\n\nstatic inline int __hfs_ext_cache_extent(struct hfs_find_data *fd, struct inode *inode, u32 block)\n{\n\tint res;\n\n\tif (HFS_I(inode)->flags & HFS_FLG_EXT_DIRTY) {\n\t\tres = __hfs_ext_write_extent(inode, fd);\n\t\tif (res)\n\t\t\treturn res;\n\t}\n\n\tres = __hfs_ext_read_extent(fd, HFS_I(inode)->cached_extents, inode->i_ino,\n\t\t\t\t    block, HFS_IS_RSRC(inode) ? HFS_FK_RSRC : HFS_FK_DATA);\n\tif (!res) {\n\t\tHFS_I(inode)->cached_start = be16_to_cpu(fd->key->ext.FABN);\n\t\tHFS_I(inode)->cached_blocks = hfs_ext_block_count(HFS_I(inode)->cached_extents);\n\t} else {\n\t\tHFS_I(inode)->cached_start = HFS_I(inode)->cached_blocks = 0;\n\t\tHFS_I(inode)->flags &= ~(HFS_FLG_EXT_DIRTY|HFS_FLG_EXT_NEW);\n\t}\n\treturn res;\n}"
        }
      },
      {
        "call_info": {
          "callee": "hfs_find_init",
          "args": [
            "HFS_SB(inode->i_sb)->ext_tree",
            "&fd"
          ],
          "line": 196
        },
        "resolved": true,
        "details": {
          "function_name": "hfs_find_init",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/hfs/bfind.c",
          "lines": "14-29",
          "snippet": "int hfs_find_init(struct hfs_btree *tree, struct hfs_find_data *fd)\n{\n\tvoid *ptr;\n\n\tfd->tree = tree;\n\tfd->bnode = NULL;\n\tptr = kmalloc(tree->max_key_len * 2 + 4, GFP_KERNEL);\n\tif (!ptr)\n\t\treturn -ENOMEM;\n\tfd->search_key = ptr;\n\tfd->key = ptr + tree->max_key_len + 2;\n\thfs_dbg(BNODE_REFS, \"find_init: %d (%p)\\n\",\n\t\ttree->cnid, __builtin_return_address(0));\n\tmutex_lock(&tree->tree_lock);\n\treturn 0;\n}",
          "includes": [
            "#include \"btree.h\"",
            "#include <linux/slab.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"btree.h\"\n#include <linux/slab.h>\n\nint hfs_find_init(struct hfs_btree *tree, struct hfs_find_data *fd)\n{\n\tvoid *ptr;\n\n\tfd->tree = tree;\n\tfd->bnode = NULL;\n\tptr = kmalloc(tree->max_key_len * 2 + 4, GFP_KERNEL);\n\tif (!ptr)\n\t\treturn -ENOMEM;\n\tfd->search_key = ptr;\n\tfd->key = ptr + tree->max_key_len + 2;\n\thfs_dbg(BNODE_REFS, \"find_init: %d (%p)\\n\",\n\t\ttree->cnid, __builtin_return_address(0));\n\tmutex_lock(&tree->tree_lock);\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "HFS_SB",
          "args": [
            "inode->i_sb"
          ],
          "line": 196
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "HFS_I",
          "args": [
            "inode"
          ],
          "line": 193
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "HFS_I",
          "args": [
            "inode"
          ],
          "line": 193
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "HFS_I",
          "args": [
            "inode"
          ],
          "line": 192
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"btree.h\"\n#include \"hfs_fs.h\"\n#include <linux/pagemap.h>\n\nstatic int hfs_ext_read_extent(struct inode *inode, u16 block)\n{\n\tstruct hfs_find_data fd;\n\tint res;\n\n\tif (block >= HFS_I(inode)->cached_start &&\n\t    block < HFS_I(inode)->cached_start + HFS_I(inode)->cached_blocks)\n\t\treturn 0;\n\n\tres = hfs_find_init(HFS_SB(inode->i_sb)->ext_tree, &fd);\n\tif (!res) {\n\t\tres = __hfs_ext_cache_extent(&fd, inode, block);\n\t\thfs_find_exit(&fd);\n\t}\n\treturn res;\n}"
  },
  {
    "function_name": "__hfs_ext_cache_extent",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/hfs/extent.c",
    "lines": "165-185",
    "snippet": "static inline int __hfs_ext_cache_extent(struct hfs_find_data *fd, struct inode *inode, u32 block)\n{\n\tint res;\n\n\tif (HFS_I(inode)->flags & HFS_FLG_EXT_DIRTY) {\n\t\tres = __hfs_ext_write_extent(inode, fd);\n\t\tif (res)\n\t\t\treturn res;\n\t}\n\n\tres = __hfs_ext_read_extent(fd, HFS_I(inode)->cached_extents, inode->i_ino,\n\t\t\t\t    block, HFS_IS_RSRC(inode) ? HFS_FK_RSRC : HFS_FK_DATA);\n\tif (!res) {\n\t\tHFS_I(inode)->cached_start = be16_to_cpu(fd->key->ext.FABN);\n\t\tHFS_I(inode)->cached_blocks = hfs_ext_block_count(HFS_I(inode)->cached_extents);\n\t} else {\n\t\tHFS_I(inode)->cached_start = HFS_I(inode)->cached_blocks = 0;\n\t\tHFS_I(inode)->flags &= ~(HFS_FLG_EXT_DIRTY|HFS_FLG_EXT_NEW);\n\t}\n\treturn res;\n}",
    "includes": [
      "#include \"btree.h\"",
      "#include \"hfs_fs.h\"",
      "#include <linux/pagemap.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "HFS_I",
          "args": [
            "inode"
          ],
          "line": 182
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "HFS_I",
          "args": [
            "inode"
          ],
          "line": 181
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "HFS_I",
          "args": [
            "inode"
          ],
          "line": 181
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "hfs_ext_block_count",
          "args": [
            "HFS_I(inode)->cached_extents"
          ],
          "line": 179
        },
        "resolved": true,
        "details": {
          "function_name": "hfs_ext_block_count",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/hfs/extent.c",
          "lines": "89-97",
          "snippet": "static int hfs_ext_block_count(struct hfs_extent *ext)\n{\n\tint i;\n\tu16 count = 0;\n\n\tfor (i = 0; i < 3; ext++, i++)\n\t\tcount += be16_to_cpu(ext->count);\n\treturn count;\n}",
          "includes": [
            "#include \"btree.h\"",
            "#include \"hfs_fs.h\"",
            "#include <linux/pagemap.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"btree.h\"\n#include \"hfs_fs.h\"\n#include <linux/pagemap.h>\n\nstatic int hfs_ext_block_count(struct hfs_extent *ext)\n{\n\tint i;\n\tu16 count = 0;\n\n\tfor (i = 0; i < 3; ext++, i++)\n\t\tcount += be16_to_cpu(ext->count);\n\treturn count;\n}"
        }
      },
      {
        "call_info": {
          "callee": "HFS_I",
          "args": [
            "inode"
          ],
          "line": 179
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "HFS_I",
          "args": [
            "inode"
          ],
          "line": 179
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "be16_to_cpu",
          "args": [
            "fd->key->ext.FABN"
          ],
          "line": 178
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "HFS_I",
          "args": [
            "inode"
          ],
          "line": 178
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "__hfs_ext_read_extent",
          "args": [
            "fd",
            "HFS_I(inode)->cached_extents",
            "inode->i_ino",
            "block",
            "HFS_IS_RSRC(inode) ? HFS_FK_RSRC : HFS_FK_DATA"
          ],
          "line": 175
        },
        "resolved": true,
        "details": {
          "function_name": "__hfs_ext_read_extent",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/hfs/extent.c",
          "lines": "146-163",
          "snippet": "static inline int __hfs_ext_read_extent(struct hfs_find_data *fd, struct hfs_extent *extent,\n\t\t\t\t\tu32 cnid, u32 block, u8 type)\n{\n\tint res;\n\n\thfs_ext_build_key(fd->search_key, cnid, block, type);\n\tfd->key->ext.FNum = 0;\n\tres = hfs_brec_find(fd);\n\tif (res && res != -ENOENT)\n\t\treturn res;\n\tif (fd->key->ext.FNum != fd->search_key->ext.FNum ||\n\t    fd->key->ext.FkType != fd->search_key->ext.FkType)\n\t\treturn -ENOENT;\n\tif (fd->entrylength != sizeof(hfs_extent_rec))\n\t\treturn -EIO;\n\thfs_bnode_read(fd->bnode, extent, fd->entryoffset, sizeof(hfs_extent_rec));\n\treturn 0;\n}",
          "includes": [
            "#include \"btree.h\"",
            "#include \"hfs_fs.h\"",
            "#include <linux/pagemap.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"btree.h\"\n#include \"hfs_fs.h\"\n#include <linux/pagemap.h>\n\nstatic inline int __hfs_ext_read_extent(struct hfs_find_data *fd, struct hfs_extent *extent,\n\t\t\t\t\tu32 cnid, u32 block, u8 type)\n{\n\tint res;\n\n\thfs_ext_build_key(fd->search_key, cnid, block, type);\n\tfd->key->ext.FNum = 0;\n\tres = hfs_brec_find(fd);\n\tif (res && res != -ENOENT)\n\t\treturn res;\n\tif (fd->key->ext.FNum != fd->search_key->ext.FNum ||\n\t    fd->key->ext.FkType != fd->search_key->ext.FkType)\n\t\treturn -ENOENT;\n\tif (fd->entrylength != sizeof(hfs_extent_rec))\n\t\treturn -EIO;\n\thfs_bnode_read(fd->bnode, extent, fd->entryoffset, sizeof(hfs_extent_rec));\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "HFS_IS_RSRC",
          "args": [
            "inode"
          ],
          "line": 176
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "HFS_I",
          "args": [
            "inode"
          ],
          "line": 175
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "__hfs_ext_write_extent",
          "args": [
            "inode",
            "fd"
          ],
          "line": 170
        },
        "resolved": true,
        "details": {
          "function_name": "__hfs_ext_write_extent",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/hfs/extent.c",
          "lines": "110-129",
          "snippet": "static int __hfs_ext_write_extent(struct inode *inode, struct hfs_find_data *fd)\n{\n\tint res;\n\n\thfs_ext_build_key(fd->search_key, inode->i_ino, HFS_I(inode)->cached_start,\n\t\t\t  HFS_IS_RSRC(inode) ?  HFS_FK_RSRC : HFS_FK_DATA);\n\tres = hfs_brec_find(fd);\n\tif (HFS_I(inode)->flags & HFS_FLG_EXT_NEW) {\n\t\tif (res != -ENOENT)\n\t\t\treturn res;\n\t\thfs_brec_insert(fd, HFS_I(inode)->cached_extents, sizeof(hfs_extent_rec));\n\t\tHFS_I(inode)->flags &= ~(HFS_FLG_EXT_DIRTY|HFS_FLG_EXT_NEW);\n\t} else {\n\t\tif (res)\n\t\t\treturn res;\n\t\thfs_bnode_write(fd->bnode, HFS_I(inode)->cached_extents, fd->entryoffset, fd->entrylength);\n\t\tHFS_I(inode)->flags &= ~HFS_FLG_EXT_DIRTY;\n\t}\n\treturn 0;\n}",
          "includes": [
            "#include \"btree.h\"",
            "#include \"hfs_fs.h\"",
            "#include <linux/pagemap.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"btree.h\"\n#include \"hfs_fs.h\"\n#include <linux/pagemap.h>\n\nstatic int __hfs_ext_write_extent(struct inode *inode, struct hfs_find_data *fd)\n{\n\tint res;\n\n\thfs_ext_build_key(fd->search_key, inode->i_ino, HFS_I(inode)->cached_start,\n\t\t\t  HFS_IS_RSRC(inode) ?  HFS_FK_RSRC : HFS_FK_DATA);\n\tres = hfs_brec_find(fd);\n\tif (HFS_I(inode)->flags & HFS_FLG_EXT_NEW) {\n\t\tif (res != -ENOENT)\n\t\t\treturn res;\n\t\thfs_brec_insert(fd, HFS_I(inode)->cached_extents, sizeof(hfs_extent_rec));\n\t\tHFS_I(inode)->flags &= ~(HFS_FLG_EXT_DIRTY|HFS_FLG_EXT_NEW);\n\t} else {\n\t\tif (res)\n\t\t\treturn res;\n\t\thfs_bnode_write(fd->bnode, HFS_I(inode)->cached_extents, fd->entryoffset, fd->entrylength);\n\t\tHFS_I(inode)->flags &= ~HFS_FLG_EXT_DIRTY;\n\t}\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "HFS_I",
          "args": [
            "inode"
          ],
          "line": 169
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"btree.h\"\n#include \"hfs_fs.h\"\n#include <linux/pagemap.h>\n\nstatic inline int __hfs_ext_cache_extent(struct hfs_find_data *fd, struct inode *inode, u32 block)\n{\n\tint res;\n\n\tif (HFS_I(inode)->flags & HFS_FLG_EXT_DIRTY) {\n\t\tres = __hfs_ext_write_extent(inode, fd);\n\t\tif (res)\n\t\t\treturn res;\n\t}\n\n\tres = __hfs_ext_read_extent(fd, HFS_I(inode)->cached_extents, inode->i_ino,\n\t\t\t\t    block, HFS_IS_RSRC(inode) ? HFS_FK_RSRC : HFS_FK_DATA);\n\tif (!res) {\n\t\tHFS_I(inode)->cached_start = be16_to_cpu(fd->key->ext.FABN);\n\t\tHFS_I(inode)->cached_blocks = hfs_ext_block_count(HFS_I(inode)->cached_extents);\n\t} else {\n\t\tHFS_I(inode)->cached_start = HFS_I(inode)->cached_blocks = 0;\n\t\tHFS_I(inode)->flags &= ~(HFS_FLG_EXT_DIRTY|HFS_FLG_EXT_NEW);\n\t}\n\treturn res;\n}"
  },
  {
    "function_name": "__hfs_ext_read_extent",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/hfs/extent.c",
    "lines": "146-163",
    "snippet": "static inline int __hfs_ext_read_extent(struct hfs_find_data *fd, struct hfs_extent *extent,\n\t\t\t\t\tu32 cnid, u32 block, u8 type)\n{\n\tint res;\n\n\thfs_ext_build_key(fd->search_key, cnid, block, type);\n\tfd->key->ext.FNum = 0;\n\tres = hfs_brec_find(fd);\n\tif (res && res != -ENOENT)\n\t\treturn res;\n\tif (fd->key->ext.FNum != fd->search_key->ext.FNum ||\n\t    fd->key->ext.FkType != fd->search_key->ext.FkType)\n\t\treturn -ENOENT;\n\tif (fd->entrylength != sizeof(hfs_extent_rec))\n\t\treturn -EIO;\n\thfs_bnode_read(fd->bnode, extent, fd->entryoffset, sizeof(hfs_extent_rec));\n\treturn 0;\n}",
    "includes": [
      "#include \"btree.h\"",
      "#include \"hfs_fs.h\"",
      "#include <linux/pagemap.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "hfs_bnode_read",
          "args": [
            "fd->bnode",
            "extent",
            "fd->entryoffset",
            "sizeof(hfs_extent_rec)"
          ],
          "line": 161
        },
        "resolved": true,
        "details": {
          "function_name": "hfs_bnode_read",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/hfs/bnode.c",
          "lines": "17-27",
          "snippet": "void hfs_bnode_read(struct hfs_bnode *node, void *buf,\n\t\tint off, int len)\n{\n\tstruct page *page;\n\n\toff += node->page_offset;\n\tpage = node->page[0];\n\n\tmemcpy(buf, kmap(page) + off, len);\n\tkunmap(page);\n}",
          "includes": [
            "#include \"btree.h\"",
            "#include <linux/swap.h>",
            "#include <linux/slab.h>",
            "#include <linux/pagemap.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"btree.h\"\n#include <linux/swap.h>\n#include <linux/slab.h>\n#include <linux/pagemap.h>\n\nvoid hfs_bnode_read(struct hfs_bnode *node, void *buf,\n\t\tint off, int len)\n{\n\tstruct page *page;\n\n\toff += node->page_offset;\n\tpage = node->page[0];\n\n\tmemcpy(buf, kmap(page) + off, len);\n\tkunmap(page);\n}"
        }
      },
      {
        "call_info": {
          "callee": "hfs_brec_find",
          "args": [
            "fd"
          ],
          "line": 153
        },
        "resolved": true,
        "details": {
          "function_name": "hfs_brec_find",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/hfs/bfind.c",
          "lines": "94-146",
          "snippet": "int hfs_brec_find(struct hfs_find_data *fd)\n{\n\tstruct hfs_btree *tree;\n\tstruct hfs_bnode *bnode;\n\tu32 nidx, parent;\n\t__be32 data;\n\tint height, res;\n\n\ttree = fd->tree;\n\tif (fd->bnode)\n\t\thfs_bnode_put(fd->bnode);\n\tfd->bnode = NULL;\n\tnidx = tree->root;\n\tif (!nidx)\n\t\treturn -ENOENT;\n\theight = tree->depth;\n\tres = 0;\n\tparent = 0;\n\tfor (;;) {\n\t\tbnode = hfs_bnode_find(tree, nidx);\n\t\tif (IS_ERR(bnode)) {\n\t\t\tres = PTR_ERR(bnode);\n\t\t\tbnode = NULL;\n\t\t\tbreak;\n\t\t}\n\t\tif (bnode->height != height)\n\t\t\tgoto invalid;\n\t\tif (bnode->type != (--height ? HFS_NODE_INDEX : HFS_NODE_LEAF))\n\t\t\tgoto invalid;\n\t\tbnode->parent = parent;\n\n\t\tres = __hfs_brec_find(bnode, fd);\n\t\tif (!height)\n\t\t\tbreak;\n\t\tif (fd->record < 0)\n\t\t\tgoto release;\n\n\t\tparent = nidx;\n\t\thfs_bnode_read(bnode, &data, fd->entryoffset, 4);\n\t\tnidx = be32_to_cpu(data);\n\t\thfs_bnode_put(bnode);\n\t}\n\tfd->bnode = bnode;\n\treturn res;\n\ninvalid:\n\tpr_err(\"inconsistency in B*Tree (%d,%d,%d,%u,%u)\\n\",\n\t       height, bnode->height, bnode->type, nidx, parent);\n\tres = -EIO;\nrelease:\n\thfs_bnode_put(bnode);\n\treturn res;\n}",
          "includes": [
            "#include \"btree.h\"",
            "#include <linux/slab.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"btree.h\"\n#include <linux/slab.h>\n\nint hfs_brec_find(struct hfs_find_data *fd)\n{\n\tstruct hfs_btree *tree;\n\tstruct hfs_bnode *bnode;\n\tu32 nidx, parent;\n\t__be32 data;\n\tint height, res;\n\n\ttree = fd->tree;\n\tif (fd->bnode)\n\t\thfs_bnode_put(fd->bnode);\n\tfd->bnode = NULL;\n\tnidx = tree->root;\n\tif (!nidx)\n\t\treturn -ENOENT;\n\theight = tree->depth;\n\tres = 0;\n\tparent = 0;\n\tfor (;;) {\n\t\tbnode = hfs_bnode_find(tree, nidx);\n\t\tif (IS_ERR(bnode)) {\n\t\t\tres = PTR_ERR(bnode);\n\t\t\tbnode = NULL;\n\t\t\tbreak;\n\t\t}\n\t\tif (bnode->height != height)\n\t\t\tgoto invalid;\n\t\tif (bnode->type != (--height ? HFS_NODE_INDEX : HFS_NODE_LEAF))\n\t\t\tgoto invalid;\n\t\tbnode->parent = parent;\n\n\t\tres = __hfs_brec_find(bnode, fd);\n\t\tif (!height)\n\t\t\tbreak;\n\t\tif (fd->record < 0)\n\t\t\tgoto release;\n\n\t\tparent = nidx;\n\t\thfs_bnode_read(bnode, &data, fd->entryoffset, 4);\n\t\tnidx = be32_to_cpu(data);\n\t\thfs_bnode_put(bnode);\n\t}\n\tfd->bnode = bnode;\n\treturn res;\n\ninvalid:\n\tpr_err(\"inconsistency in B*Tree (%d,%d,%d,%u,%u)\\n\",\n\t       height, bnode->height, bnode->type, nidx, parent);\n\tres = -EIO;\nrelease:\n\thfs_bnode_put(bnode);\n\treturn res;\n}"
        }
      },
      {
        "call_info": {
          "callee": "hfs_ext_build_key",
          "args": [
            "fd->search_key",
            "cnid",
            "block",
            "type"
          ],
          "line": 151
        },
        "resolved": true,
        "details": {
          "function_name": "hfs_ext_build_key",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/hfs/extent.c",
          "lines": "21-27",
          "snippet": "static void hfs_ext_build_key(hfs_btree_key *key, u32 cnid, u16 block, u8 type)\n{\n\tkey->key_len = 7;\n\tkey->ext.FkType = type;\n\tkey->ext.FNum = cpu_to_be32(cnid);\n\tkey->ext.FABN = cpu_to_be16(block);\n}",
          "includes": [
            "#include \"btree.h\"",
            "#include \"hfs_fs.h\"",
            "#include <linux/pagemap.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"btree.h\"\n#include \"hfs_fs.h\"\n#include <linux/pagemap.h>\n\nstatic void hfs_ext_build_key(hfs_btree_key *key, u32 cnid, u16 block, u8 type)\n{\n\tkey->key_len = 7;\n\tkey->ext.FkType = type;\n\tkey->ext.FNum = cpu_to_be32(cnid);\n\tkey->ext.FABN = cpu_to_be16(block);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"btree.h\"\n#include \"hfs_fs.h\"\n#include <linux/pagemap.h>\n\nstatic inline int __hfs_ext_read_extent(struct hfs_find_data *fd, struct hfs_extent *extent,\n\t\t\t\t\tu32 cnid, u32 block, u8 type)\n{\n\tint res;\n\n\thfs_ext_build_key(fd->search_key, cnid, block, type);\n\tfd->key->ext.FNum = 0;\n\tres = hfs_brec_find(fd);\n\tif (res && res != -ENOENT)\n\t\treturn res;\n\tif (fd->key->ext.FNum != fd->search_key->ext.FNum ||\n\t    fd->key->ext.FkType != fd->search_key->ext.FkType)\n\t\treturn -ENOENT;\n\tif (fd->entrylength != sizeof(hfs_extent_rec))\n\t\treturn -EIO;\n\thfs_bnode_read(fd->bnode, extent, fd->entryoffset, sizeof(hfs_extent_rec));\n\treturn 0;\n}"
  },
  {
    "function_name": "hfs_ext_write_extent",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/hfs/extent.c",
    "lines": "131-144",
    "snippet": "int hfs_ext_write_extent(struct inode *inode)\n{\n\tstruct hfs_find_data fd;\n\tint res = 0;\n\n\tif (HFS_I(inode)->flags & HFS_FLG_EXT_DIRTY) {\n\t\tres = hfs_find_init(HFS_SB(inode->i_sb)->ext_tree, &fd);\n\t\tif (res)\n\t\t\treturn res;\n\t\tres = __hfs_ext_write_extent(inode, &fd);\n\t\thfs_find_exit(&fd);\n\t}\n\treturn res;\n}",
    "includes": [
      "#include \"btree.h\"",
      "#include \"hfs_fs.h\"",
      "#include <linux/pagemap.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "hfs_find_exit",
          "args": [
            "&fd"
          ],
          "line": 141
        },
        "resolved": true,
        "details": {
          "function_name": "hfs_find_exit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/hfs/bfind.c",
          "lines": "31-39",
          "snippet": "void hfs_find_exit(struct hfs_find_data *fd)\n{\n\thfs_bnode_put(fd->bnode);\n\tkfree(fd->search_key);\n\thfs_dbg(BNODE_REFS, \"find_exit: %d (%p)\\n\",\n\t\tfd->tree->cnid, __builtin_return_address(0));\n\tmutex_unlock(&fd->tree->tree_lock);\n\tfd->tree = NULL;\n}",
          "includes": [
            "#include \"btree.h\"",
            "#include <linux/slab.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"btree.h\"\n#include <linux/slab.h>\n\nvoid hfs_find_exit(struct hfs_find_data *fd)\n{\n\thfs_bnode_put(fd->bnode);\n\tkfree(fd->search_key);\n\thfs_dbg(BNODE_REFS, \"find_exit: %d (%p)\\n\",\n\t\tfd->tree->cnid, __builtin_return_address(0));\n\tmutex_unlock(&fd->tree->tree_lock);\n\tfd->tree = NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "__hfs_ext_write_extent",
          "args": [
            "inode",
            "&fd"
          ],
          "line": 140
        },
        "resolved": true,
        "details": {
          "function_name": "__hfs_ext_write_extent",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/hfs/extent.c",
          "lines": "110-129",
          "snippet": "static int __hfs_ext_write_extent(struct inode *inode, struct hfs_find_data *fd)\n{\n\tint res;\n\n\thfs_ext_build_key(fd->search_key, inode->i_ino, HFS_I(inode)->cached_start,\n\t\t\t  HFS_IS_RSRC(inode) ?  HFS_FK_RSRC : HFS_FK_DATA);\n\tres = hfs_brec_find(fd);\n\tif (HFS_I(inode)->flags & HFS_FLG_EXT_NEW) {\n\t\tif (res != -ENOENT)\n\t\t\treturn res;\n\t\thfs_brec_insert(fd, HFS_I(inode)->cached_extents, sizeof(hfs_extent_rec));\n\t\tHFS_I(inode)->flags &= ~(HFS_FLG_EXT_DIRTY|HFS_FLG_EXT_NEW);\n\t} else {\n\t\tif (res)\n\t\t\treturn res;\n\t\thfs_bnode_write(fd->bnode, HFS_I(inode)->cached_extents, fd->entryoffset, fd->entrylength);\n\t\tHFS_I(inode)->flags &= ~HFS_FLG_EXT_DIRTY;\n\t}\n\treturn 0;\n}",
          "includes": [
            "#include \"btree.h\"",
            "#include \"hfs_fs.h\"",
            "#include <linux/pagemap.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"btree.h\"\n#include \"hfs_fs.h\"\n#include <linux/pagemap.h>\n\nstatic int __hfs_ext_write_extent(struct inode *inode, struct hfs_find_data *fd)\n{\n\tint res;\n\n\thfs_ext_build_key(fd->search_key, inode->i_ino, HFS_I(inode)->cached_start,\n\t\t\t  HFS_IS_RSRC(inode) ?  HFS_FK_RSRC : HFS_FK_DATA);\n\tres = hfs_brec_find(fd);\n\tif (HFS_I(inode)->flags & HFS_FLG_EXT_NEW) {\n\t\tif (res != -ENOENT)\n\t\t\treturn res;\n\t\thfs_brec_insert(fd, HFS_I(inode)->cached_extents, sizeof(hfs_extent_rec));\n\t\tHFS_I(inode)->flags &= ~(HFS_FLG_EXT_DIRTY|HFS_FLG_EXT_NEW);\n\t} else {\n\t\tif (res)\n\t\t\treturn res;\n\t\thfs_bnode_write(fd->bnode, HFS_I(inode)->cached_extents, fd->entryoffset, fd->entrylength);\n\t\tHFS_I(inode)->flags &= ~HFS_FLG_EXT_DIRTY;\n\t}\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "hfs_find_init",
          "args": [
            "HFS_SB(inode->i_sb)->ext_tree",
            "&fd"
          ],
          "line": 137
        },
        "resolved": true,
        "details": {
          "function_name": "hfs_find_init",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/hfs/bfind.c",
          "lines": "14-29",
          "snippet": "int hfs_find_init(struct hfs_btree *tree, struct hfs_find_data *fd)\n{\n\tvoid *ptr;\n\n\tfd->tree = tree;\n\tfd->bnode = NULL;\n\tptr = kmalloc(tree->max_key_len * 2 + 4, GFP_KERNEL);\n\tif (!ptr)\n\t\treturn -ENOMEM;\n\tfd->search_key = ptr;\n\tfd->key = ptr + tree->max_key_len + 2;\n\thfs_dbg(BNODE_REFS, \"find_init: %d (%p)\\n\",\n\t\ttree->cnid, __builtin_return_address(0));\n\tmutex_lock(&tree->tree_lock);\n\treturn 0;\n}",
          "includes": [
            "#include \"btree.h\"",
            "#include <linux/slab.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"btree.h\"\n#include <linux/slab.h>\n\nint hfs_find_init(struct hfs_btree *tree, struct hfs_find_data *fd)\n{\n\tvoid *ptr;\n\n\tfd->tree = tree;\n\tfd->bnode = NULL;\n\tptr = kmalloc(tree->max_key_len * 2 + 4, GFP_KERNEL);\n\tif (!ptr)\n\t\treturn -ENOMEM;\n\tfd->search_key = ptr;\n\tfd->key = ptr + tree->max_key_len + 2;\n\thfs_dbg(BNODE_REFS, \"find_init: %d (%p)\\n\",\n\t\ttree->cnid, __builtin_return_address(0));\n\tmutex_lock(&tree->tree_lock);\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "HFS_SB",
          "args": [
            "inode->i_sb"
          ],
          "line": 137
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "HFS_I",
          "args": [
            "inode"
          ],
          "line": 136
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"btree.h\"\n#include \"hfs_fs.h\"\n#include <linux/pagemap.h>\n\nint hfs_ext_write_extent(struct inode *inode)\n{\n\tstruct hfs_find_data fd;\n\tint res = 0;\n\n\tif (HFS_I(inode)->flags & HFS_FLG_EXT_DIRTY) {\n\t\tres = hfs_find_init(HFS_SB(inode->i_sb)->ext_tree, &fd);\n\t\tif (res)\n\t\t\treturn res;\n\t\tres = __hfs_ext_write_extent(inode, &fd);\n\t\thfs_find_exit(&fd);\n\t}\n\treturn res;\n}"
  },
  {
    "function_name": "__hfs_ext_write_extent",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/hfs/extent.c",
    "lines": "110-129",
    "snippet": "static int __hfs_ext_write_extent(struct inode *inode, struct hfs_find_data *fd)\n{\n\tint res;\n\n\thfs_ext_build_key(fd->search_key, inode->i_ino, HFS_I(inode)->cached_start,\n\t\t\t  HFS_IS_RSRC(inode) ?  HFS_FK_RSRC : HFS_FK_DATA);\n\tres = hfs_brec_find(fd);\n\tif (HFS_I(inode)->flags & HFS_FLG_EXT_NEW) {\n\t\tif (res != -ENOENT)\n\t\t\treturn res;\n\t\thfs_brec_insert(fd, HFS_I(inode)->cached_extents, sizeof(hfs_extent_rec));\n\t\tHFS_I(inode)->flags &= ~(HFS_FLG_EXT_DIRTY|HFS_FLG_EXT_NEW);\n\t} else {\n\t\tif (res)\n\t\t\treturn res;\n\t\thfs_bnode_write(fd->bnode, HFS_I(inode)->cached_extents, fd->entryoffset, fd->entrylength);\n\t\tHFS_I(inode)->flags &= ~HFS_FLG_EXT_DIRTY;\n\t}\n\treturn 0;\n}",
    "includes": [
      "#include \"btree.h\"",
      "#include \"hfs_fs.h\"",
      "#include <linux/pagemap.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "HFS_I",
          "args": [
            "inode"
          ],
          "line": 126
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "hfs_bnode_write",
          "args": [
            "fd->bnode",
            "HFS_I(inode)->cached_extents",
            "fd->entryoffset",
            "fd->entrylength"
          ],
          "line": 125
        },
        "resolved": true,
        "details": {
          "function_name": "hfs_bnode_write",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/hfs/bnode.c",
          "lines": "60-70",
          "snippet": "void hfs_bnode_write(struct hfs_bnode *node, void *buf, int off, int len)\n{\n\tstruct page *page;\n\n\toff += node->page_offset;\n\tpage = node->page[0];\n\n\tmemcpy(kmap(page) + off, buf, len);\n\tkunmap(page);\n\tset_page_dirty(page);\n}",
          "includes": [
            "#include \"btree.h\"",
            "#include <linux/swap.h>",
            "#include <linux/slab.h>",
            "#include <linux/pagemap.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"btree.h\"\n#include <linux/swap.h>\n#include <linux/slab.h>\n#include <linux/pagemap.h>\n\nvoid hfs_bnode_write(struct hfs_bnode *node, void *buf, int off, int len)\n{\n\tstruct page *page;\n\n\toff += node->page_offset;\n\tpage = node->page[0];\n\n\tmemcpy(kmap(page) + off, buf, len);\n\tkunmap(page);\n\tset_page_dirty(page);\n}"
        }
      },
      {
        "call_info": {
          "callee": "HFS_I",
          "args": [
            "inode"
          ],
          "line": 125
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "HFS_I",
          "args": [
            "inode"
          ],
          "line": 121
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "hfs_brec_insert",
          "args": [
            "fd",
            "HFS_I(inode)->cached_extents",
            "sizeof(hfs_extent_rec)"
          ],
          "line": 120
        },
        "resolved": true,
        "details": {
          "function_name": "hfs_brec_insert",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/hfs/brec.c",
          "lines": "64-173",
          "snippet": "int hfs_brec_insert(struct hfs_find_data *fd, void *entry, int entry_len)\n{\n\tstruct hfs_btree *tree;\n\tstruct hfs_bnode *node, *new_node;\n\tint size, key_len, rec;\n\tint data_off, end_off;\n\tint idx_rec_off, data_rec_off, end_rec_off;\n\t__be32 cnid;\n\n\ttree = fd->tree;\n\tif (!fd->bnode) {\n\t\tif (!tree->root)\n\t\t\thfs_btree_inc_height(tree);\n\t\tfd->bnode = hfs_bnode_find(tree, tree->leaf_head);\n\t\tif (IS_ERR(fd->bnode))\n\t\t\treturn PTR_ERR(fd->bnode);\n\t\tfd->record = -1;\n\t}\n\tnew_node = NULL;\n\tkey_len = (fd->search_key->key_len | 1) + 1;\nagain:\n\t/* new record idx and complete record size */\n\trec = fd->record + 1;\n\tsize = key_len + entry_len;\n\n\tnode = fd->bnode;\n\thfs_bnode_dump(node);\n\t/* get last offset */\n\tend_rec_off = tree->node_size - (node->num_recs + 1) * 2;\n\tend_off = hfs_bnode_read_u16(node, end_rec_off);\n\tend_rec_off -= 2;\n\thfs_dbg(BNODE_MOD, \"insert_rec: %d, %d, %d, %d\\n\",\n\t\trec, size, end_off, end_rec_off);\n\tif (size > end_rec_off - end_off) {\n\t\tif (new_node)\n\t\t\tpanic(\"not enough room!\\n\");\n\t\tnew_node = hfs_bnode_split(fd);\n\t\tif (IS_ERR(new_node))\n\t\t\treturn PTR_ERR(new_node);\n\t\tgoto again;\n\t}\n\tif (node->type == HFS_NODE_LEAF) {\n\t\ttree->leaf_count++;\n\t\tmark_inode_dirty(tree->inode);\n\t}\n\tnode->num_recs++;\n\t/* write new last offset */\n\thfs_bnode_write_u16(node, offsetof(struct hfs_bnode_desc, num_recs), node->num_recs);\n\thfs_bnode_write_u16(node, end_rec_off, end_off + size);\n\tdata_off = end_off;\n\tdata_rec_off = end_rec_off + 2;\n\tidx_rec_off = tree->node_size - (rec + 1) * 2;\n\tif (idx_rec_off == data_rec_off)\n\t\tgoto skip;\n\t/* move all following entries */\n\tdo {\n\t\tdata_off = hfs_bnode_read_u16(node, data_rec_off + 2);\n\t\thfs_bnode_write_u16(node, data_rec_off, data_off + size);\n\t\tdata_rec_off += 2;\n\t} while (data_rec_off < idx_rec_off);\n\n\t/* move data away */\n\thfs_bnode_move(node, data_off + size, data_off,\n\t\t       end_off - data_off);\n\nskip:\n\thfs_bnode_write(node, fd->search_key, data_off, key_len);\n\thfs_bnode_write(node, entry, data_off + key_len, entry_len);\n\thfs_bnode_dump(node);\n\n\tif (new_node) {\n\t\t/* update parent key if we inserted a key\n\t\t * at the start of the first node\n\t\t */\n\t\tif (!rec && new_node != node)\n\t\t\thfs_brec_update_parent(fd);\n\n\t\thfs_bnode_put(fd->bnode);\n\t\tif (!new_node->parent) {\n\t\t\thfs_btree_inc_height(tree);\n\t\t\tnew_node->parent = tree->root;\n\t\t}\n\t\tfd->bnode = hfs_bnode_find(tree, new_node->parent);\n\n\t\t/* create index data entry */\n\t\tcnid = cpu_to_be32(new_node->this);\n\t\tentry = &cnid;\n\t\tentry_len = sizeof(cnid);\n\n\t\t/* get index key */\n\t\thfs_bnode_read_key(new_node, fd->search_key, 14);\n\t\t__hfs_brec_find(fd->bnode, fd);\n\n\t\thfs_bnode_put(new_node);\n\t\tnew_node = NULL;\n\n\t\tif (tree->attributes & HFS_TREE_VARIDXKEYS)\n\t\t\tkey_len = fd->search_key->key_len + 1;\n\t\telse {\n\t\t\tfd->search_key->key_len = tree->max_key_len;\n\t\t\tkey_len = tree->max_key_len + 1;\n\t\t}\n\t\tgoto again;\n\t}\n\n\tif (!rec)\n\t\thfs_brec_update_parent(fd);\n\n\treturn 0;\n}",
          "includes": [
            "#include \"btree.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static struct hfs_bnode *hfs_bnode_split(struct hfs_find_data *fd);",
            "static int hfs_brec_update_parent(struct hfs_find_data *fd);",
            "static int hfs_btree_inc_height(struct hfs_btree *tree);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"btree.h\"\n\nstatic struct hfs_bnode *hfs_bnode_split(struct hfs_find_data *fd);\nstatic int hfs_brec_update_parent(struct hfs_find_data *fd);\nstatic int hfs_btree_inc_height(struct hfs_btree *tree);\n\nint hfs_brec_insert(struct hfs_find_data *fd, void *entry, int entry_len)\n{\n\tstruct hfs_btree *tree;\n\tstruct hfs_bnode *node, *new_node;\n\tint size, key_len, rec;\n\tint data_off, end_off;\n\tint idx_rec_off, data_rec_off, end_rec_off;\n\t__be32 cnid;\n\n\ttree = fd->tree;\n\tif (!fd->bnode) {\n\t\tif (!tree->root)\n\t\t\thfs_btree_inc_height(tree);\n\t\tfd->bnode = hfs_bnode_find(tree, tree->leaf_head);\n\t\tif (IS_ERR(fd->bnode))\n\t\t\treturn PTR_ERR(fd->bnode);\n\t\tfd->record = -1;\n\t}\n\tnew_node = NULL;\n\tkey_len = (fd->search_key->key_len | 1) + 1;\nagain:\n\t/* new record idx and complete record size */\n\trec = fd->record + 1;\n\tsize = key_len + entry_len;\n\n\tnode = fd->bnode;\n\thfs_bnode_dump(node);\n\t/* get last offset */\n\tend_rec_off = tree->node_size - (node->num_recs + 1) * 2;\n\tend_off = hfs_bnode_read_u16(node, end_rec_off);\n\tend_rec_off -= 2;\n\thfs_dbg(BNODE_MOD, \"insert_rec: %d, %d, %d, %d\\n\",\n\t\trec, size, end_off, end_rec_off);\n\tif (size > end_rec_off - end_off) {\n\t\tif (new_node)\n\t\t\tpanic(\"not enough room!\\n\");\n\t\tnew_node = hfs_bnode_split(fd);\n\t\tif (IS_ERR(new_node))\n\t\t\treturn PTR_ERR(new_node);\n\t\tgoto again;\n\t}\n\tif (node->type == HFS_NODE_LEAF) {\n\t\ttree->leaf_count++;\n\t\tmark_inode_dirty(tree->inode);\n\t}\n\tnode->num_recs++;\n\t/* write new last offset */\n\thfs_bnode_write_u16(node, offsetof(struct hfs_bnode_desc, num_recs), node->num_recs);\n\thfs_bnode_write_u16(node, end_rec_off, end_off + size);\n\tdata_off = end_off;\n\tdata_rec_off = end_rec_off + 2;\n\tidx_rec_off = tree->node_size - (rec + 1) * 2;\n\tif (idx_rec_off == data_rec_off)\n\t\tgoto skip;\n\t/* move all following entries */\n\tdo {\n\t\tdata_off = hfs_bnode_read_u16(node, data_rec_off + 2);\n\t\thfs_bnode_write_u16(node, data_rec_off, data_off + size);\n\t\tdata_rec_off += 2;\n\t} while (data_rec_off < idx_rec_off);\n\n\t/* move data away */\n\thfs_bnode_move(node, data_off + size, data_off,\n\t\t       end_off - data_off);\n\nskip:\n\thfs_bnode_write(node, fd->search_key, data_off, key_len);\n\thfs_bnode_write(node, entry, data_off + key_len, entry_len);\n\thfs_bnode_dump(node);\n\n\tif (new_node) {\n\t\t/* update parent key if we inserted a key\n\t\t * at the start of the first node\n\t\t */\n\t\tif (!rec && new_node != node)\n\t\t\thfs_brec_update_parent(fd);\n\n\t\thfs_bnode_put(fd->bnode);\n\t\tif (!new_node->parent) {\n\t\t\thfs_btree_inc_height(tree);\n\t\t\tnew_node->parent = tree->root;\n\t\t}\n\t\tfd->bnode = hfs_bnode_find(tree, new_node->parent);\n\n\t\t/* create index data entry */\n\t\tcnid = cpu_to_be32(new_node->this);\n\t\tentry = &cnid;\n\t\tentry_len = sizeof(cnid);\n\n\t\t/* get index key */\n\t\thfs_bnode_read_key(new_node, fd->search_key, 14);\n\t\t__hfs_brec_find(fd->bnode, fd);\n\n\t\thfs_bnode_put(new_node);\n\t\tnew_node = NULL;\n\n\t\tif (tree->attributes & HFS_TREE_VARIDXKEYS)\n\t\t\tkey_len = fd->search_key->key_len + 1;\n\t\telse {\n\t\t\tfd->search_key->key_len = tree->max_key_len;\n\t\t\tkey_len = tree->max_key_len + 1;\n\t\t}\n\t\tgoto again;\n\t}\n\n\tif (!rec)\n\t\thfs_brec_update_parent(fd);\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "HFS_I",
          "args": [
            "inode"
          ],
          "line": 120
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "HFS_I",
          "args": [
            "inode"
          ],
          "line": 117
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "hfs_brec_find",
          "args": [
            "fd"
          ],
          "line": 116
        },
        "resolved": true,
        "details": {
          "function_name": "hfs_brec_find",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/hfs/bfind.c",
          "lines": "94-146",
          "snippet": "int hfs_brec_find(struct hfs_find_data *fd)\n{\n\tstruct hfs_btree *tree;\n\tstruct hfs_bnode *bnode;\n\tu32 nidx, parent;\n\t__be32 data;\n\tint height, res;\n\n\ttree = fd->tree;\n\tif (fd->bnode)\n\t\thfs_bnode_put(fd->bnode);\n\tfd->bnode = NULL;\n\tnidx = tree->root;\n\tif (!nidx)\n\t\treturn -ENOENT;\n\theight = tree->depth;\n\tres = 0;\n\tparent = 0;\n\tfor (;;) {\n\t\tbnode = hfs_bnode_find(tree, nidx);\n\t\tif (IS_ERR(bnode)) {\n\t\t\tres = PTR_ERR(bnode);\n\t\t\tbnode = NULL;\n\t\t\tbreak;\n\t\t}\n\t\tif (bnode->height != height)\n\t\t\tgoto invalid;\n\t\tif (bnode->type != (--height ? HFS_NODE_INDEX : HFS_NODE_LEAF))\n\t\t\tgoto invalid;\n\t\tbnode->parent = parent;\n\n\t\tres = __hfs_brec_find(bnode, fd);\n\t\tif (!height)\n\t\t\tbreak;\n\t\tif (fd->record < 0)\n\t\t\tgoto release;\n\n\t\tparent = nidx;\n\t\thfs_bnode_read(bnode, &data, fd->entryoffset, 4);\n\t\tnidx = be32_to_cpu(data);\n\t\thfs_bnode_put(bnode);\n\t}\n\tfd->bnode = bnode;\n\treturn res;\n\ninvalid:\n\tpr_err(\"inconsistency in B*Tree (%d,%d,%d,%u,%u)\\n\",\n\t       height, bnode->height, bnode->type, nidx, parent);\n\tres = -EIO;\nrelease:\n\thfs_bnode_put(bnode);\n\treturn res;\n}",
          "includes": [
            "#include \"btree.h\"",
            "#include <linux/slab.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"btree.h\"\n#include <linux/slab.h>\n\nint hfs_brec_find(struct hfs_find_data *fd)\n{\n\tstruct hfs_btree *tree;\n\tstruct hfs_bnode *bnode;\n\tu32 nidx, parent;\n\t__be32 data;\n\tint height, res;\n\n\ttree = fd->tree;\n\tif (fd->bnode)\n\t\thfs_bnode_put(fd->bnode);\n\tfd->bnode = NULL;\n\tnidx = tree->root;\n\tif (!nidx)\n\t\treturn -ENOENT;\n\theight = tree->depth;\n\tres = 0;\n\tparent = 0;\n\tfor (;;) {\n\t\tbnode = hfs_bnode_find(tree, nidx);\n\t\tif (IS_ERR(bnode)) {\n\t\t\tres = PTR_ERR(bnode);\n\t\t\tbnode = NULL;\n\t\t\tbreak;\n\t\t}\n\t\tif (bnode->height != height)\n\t\t\tgoto invalid;\n\t\tif (bnode->type != (--height ? HFS_NODE_INDEX : HFS_NODE_LEAF))\n\t\t\tgoto invalid;\n\t\tbnode->parent = parent;\n\n\t\tres = __hfs_brec_find(bnode, fd);\n\t\tif (!height)\n\t\t\tbreak;\n\t\tif (fd->record < 0)\n\t\t\tgoto release;\n\n\t\tparent = nidx;\n\t\thfs_bnode_read(bnode, &data, fd->entryoffset, 4);\n\t\tnidx = be32_to_cpu(data);\n\t\thfs_bnode_put(bnode);\n\t}\n\tfd->bnode = bnode;\n\treturn res;\n\ninvalid:\n\tpr_err(\"inconsistency in B*Tree (%d,%d,%d,%u,%u)\\n\",\n\t       height, bnode->height, bnode->type, nidx, parent);\n\tres = -EIO;\nrelease:\n\thfs_bnode_put(bnode);\n\treturn res;\n}"
        }
      },
      {
        "call_info": {
          "callee": "hfs_ext_build_key",
          "args": [
            "fd->search_key",
            "inode->i_ino",
            "HFS_I(inode)->cached_start",
            "HFS_IS_RSRC(inode) ?  HFS_FK_RSRC : HFS_FK_DATA"
          ],
          "line": 114
        },
        "resolved": true,
        "details": {
          "function_name": "hfs_ext_build_key",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/hfs/extent.c",
          "lines": "21-27",
          "snippet": "static void hfs_ext_build_key(hfs_btree_key *key, u32 cnid, u16 block, u8 type)\n{\n\tkey->key_len = 7;\n\tkey->ext.FkType = type;\n\tkey->ext.FNum = cpu_to_be32(cnid);\n\tkey->ext.FABN = cpu_to_be16(block);\n}",
          "includes": [
            "#include \"btree.h\"",
            "#include \"hfs_fs.h\"",
            "#include <linux/pagemap.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"btree.h\"\n#include \"hfs_fs.h\"\n#include <linux/pagemap.h>\n\nstatic void hfs_ext_build_key(hfs_btree_key *key, u32 cnid, u16 block, u8 type)\n{\n\tkey->key_len = 7;\n\tkey->ext.FkType = type;\n\tkey->ext.FNum = cpu_to_be32(cnid);\n\tkey->ext.FABN = cpu_to_be16(block);\n}"
        }
      },
      {
        "call_info": {
          "callee": "HFS_IS_RSRC",
          "args": [
            "inode"
          ],
          "line": 115
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "HFS_I",
          "args": [
            "inode"
          ],
          "line": 114
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"btree.h\"\n#include \"hfs_fs.h\"\n#include <linux/pagemap.h>\n\nstatic int __hfs_ext_write_extent(struct inode *inode, struct hfs_find_data *fd)\n{\n\tint res;\n\n\thfs_ext_build_key(fd->search_key, inode->i_ino, HFS_I(inode)->cached_start,\n\t\t\t  HFS_IS_RSRC(inode) ?  HFS_FK_RSRC : HFS_FK_DATA);\n\tres = hfs_brec_find(fd);\n\tif (HFS_I(inode)->flags & HFS_FLG_EXT_NEW) {\n\t\tif (res != -ENOENT)\n\t\t\treturn res;\n\t\thfs_brec_insert(fd, HFS_I(inode)->cached_extents, sizeof(hfs_extent_rec));\n\t\tHFS_I(inode)->flags &= ~(HFS_FLG_EXT_DIRTY|HFS_FLG_EXT_NEW);\n\t} else {\n\t\tif (res)\n\t\t\treturn res;\n\t\thfs_bnode_write(fd->bnode, HFS_I(inode)->cached_extents, fd->entryoffset, fd->entrylength);\n\t\tHFS_I(inode)->flags &= ~HFS_FLG_EXT_DIRTY;\n\t}\n\treturn 0;\n}"
  },
  {
    "function_name": "hfs_ext_lastblock",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/hfs/extent.c",
    "lines": "99-108",
    "snippet": "static u16 hfs_ext_lastblock(struct hfs_extent *ext)\n{\n\tint i;\n\n\text += 2;\n\tfor (i = 0; i < 2; ext--, i++)\n\t\tif (ext->count)\n\t\t\tbreak;\n\treturn be16_to_cpu(ext->block) + be16_to_cpu(ext->count);\n}",
    "includes": [
      "#include \"btree.h\"",
      "#include \"hfs_fs.h\"",
      "#include <linux/pagemap.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "be16_to_cpu",
          "args": [
            "ext->count"
          ],
          "line": 107
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "be16_to_cpu",
          "args": [
            "ext->block"
          ],
          "line": 107
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"btree.h\"\n#include \"hfs_fs.h\"\n#include <linux/pagemap.h>\n\nstatic u16 hfs_ext_lastblock(struct hfs_extent *ext)\n{\n\tint i;\n\n\text += 2;\n\tfor (i = 0; i < 2; ext--, i++)\n\t\tif (ext->count)\n\t\t\tbreak;\n\treturn be16_to_cpu(ext->block) + be16_to_cpu(ext->count);\n}"
  },
  {
    "function_name": "hfs_ext_block_count",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/hfs/extent.c",
    "lines": "89-97",
    "snippet": "static int hfs_ext_block_count(struct hfs_extent *ext)\n{\n\tint i;\n\tu16 count = 0;\n\n\tfor (i = 0; i < 3; ext++, i++)\n\t\tcount += be16_to_cpu(ext->count);\n\treturn count;\n}",
    "includes": [
      "#include \"btree.h\"",
      "#include \"hfs_fs.h\"",
      "#include <linux/pagemap.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "be16_to_cpu",
          "args": [
            "ext->count"
          ],
          "line": 95
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"btree.h\"\n#include \"hfs_fs.h\"\n#include <linux/pagemap.h>\n\nstatic int hfs_ext_block_count(struct hfs_extent *ext)\n{\n\tint i;\n\tu16 count = 0;\n\n\tfor (i = 0; i < 3; ext++, i++)\n\t\tcount += be16_to_cpu(ext->count);\n\treturn count;\n}"
  },
  {
    "function_name": "hfs_ext_find_block",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/hfs/extent.c",
    "lines": "74-87",
    "snippet": "static u16 hfs_ext_find_block(struct hfs_extent *ext, u16 off)\n{\n\tint i;\n\tu16 count;\n\n\tfor (i = 0; i < 3; ext++, i++) {\n\t\tcount = be16_to_cpu(ext->count);\n\t\tif (off < count)\n\t\t\treturn be16_to_cpu(ext->block) + off;\n\t\toff -= count;\n\t}\n\t/* panic? */\n\treturn 0;\n}",
    "includes": [
      "#include \"btree.h\"",
      "#include \"hfs_fs.h\"",
      "#include <linux/pagemap.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "be16_to_cpu",
          "args": [
            "ext->block"
          ],
          "line": 82
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "be16_to_cpu",
          "args": [
            "ext->count"
          ],
          "line": 80
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"btree.h\"\n#include \"hfs_fs.h\"\n#include <linux/pagemap.h>\n\nstatic u16 hfs_ext_find_block(struct hfs_extent *ext, u16 off)\n{\n\tint i;\n\tu16 count;\n\n\tfor (i = 0; i < 3; ext++, i++) {\n\t\tcount = be16_to_cpu(ext->count);\n\t\tif (off < count)\n\t\t\treturn be16_to_cpu(ext->block) + off;\n\t\toff -= count;\n\t}\n\t/* panic? */\n\treturn 0;\n}"
  },
  {
    "function_name": "hfs_ext_keycmp",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/hfs/extent.c",
    "lines": "50-67",
    "snippet": "int hfs_ext_keycmp(const btree_key *key1, const btree_key *key2)\n{\n\t__be32 fnum1, fnum2;\n\t__be16 block1, block2;\n\n\tfnum1 = key1->ext.FNum;\n\tfnum2 = key2->ext.FNum;\n\tif (fnum1 != fnum2)\n\t\treturn be32_to_cpu(fnum1) < be32_to_cpu(fnum2) ? -1 : 1;\n\tif (key1->ext.FkType != key2->ext.FkType)\n\t\treturn key1->ext.FkType < key2->ext.FkType ? -1 : 1;\n\n\tblock1 = key1->ext.FABN;\n\tblock2 = key2->ext.FABN;\n\tif (block1 == block2)\n\t\treturn 0;\n\treturn be16_to_cpu(block1) < be16_to_cpu(block2) ? -1 : 1;\n}",
    "includes": [
      "#include \"btree.h\"",
      "#include \"hfs_fs.h\"",
      "#include <linux/pagemap.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "be16_to_cpu",
          "args": [
            "block2"
          ],
          "line": 66
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "be16_to_cpu",
          "args": [
            "block1"
          ],
          "line": 66
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "be32_to_cpu",
          "args": [
            "fnum2"
          ],
          "line": 58
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "be32_to_cpu",
          "args": [
            "fnum1"
          ],
          "line": 58
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"btree.h\"\n#include \"hfs_fs.h\"\n#include <linux/pagemap.h>\n\nint hfs_ext_keycmp(const btree_key *key1, const btree_key *key2)\n{\n\t__be32 fnum1, fnum2;\n\t__be16 block1, block2;\n\n\tfnum1 = key1->ext.FNum;\n\tfnum2 = key2->ext.FNum;\n\tif (fnum1 != fnum2)\n\t\treturn be32_to_cpu(fnum1) < be32_to_cpu(fnum2) ? -1 : 1;\n\tif (key1->ext.FkType != key2->ext.FkType)\n\t\treturn key1->ext.FkType < key2->ext.FkType ? -1 : 1;\n\n\tblock1 = key1->ext.FABN;\n\tblock2 = key2->ext.FABN;\n\tif (block1 == block2)\n\t\treturn 0;\n\treturn be16_to_cpu(block1) < be16_to_cpu(block2) ? -1 : 1;\n}"
  },
  {
    "function_name": "hfs_ext_build_key",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/hfs/extent.c",
    "lines": "21-27",
    "snippet": "static void hfs_ext_build_key(hfs_btree_key *key, u32 cnid, u16 block, u8 type)\n{\n\tkey->key_len = 7;\n\tkey->ext.FkType = type;\n\tkey->ext.FNum = cpu_to_be32(cnid);\n\tkey->ext.FABN = cpu_to_be16(block);\n}",
    "includes": [
      "#include \"btree.h\"",
      "#include \"hfs_fs.h\"",
      "#include <linux/pagemap.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "cpu_to_be16",
          "args": [
            "block"
          ],
          "line": 26
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "cpu_to_be32",
          "args": [
            "cnid"
          ],
          "line": 25
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"btree.h\"\n#include \"hfs_fs.h\"\n#include <linux/pagemap.h>\n\nstatic void hfs_ext_build_key(hfs_btree_key *key, u32 cnid, u16 block, u8 type)\n{\n\tkey->key_len = 7;\n\tkey->ext.FkType = type;\n\tkey->ext.FNum = cpu_to_be32(cnid);\n\tkey->ext.FABN = cpu_to_be16(block);\n}"
  }
]