[
  {
    "function_name": "fs2_write_end(s",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/jffs2/file.c",
    "lines": "242-339",
    "snippet": "atic int jffs2_write_end(struct file *filp, struct address_space *mapping,\n\t\t\tloff_t pos, unsigned len, unsigned copied,\n\t\t\tstruct page *pg, void *fsdata)\n{\n\t/* Actually commit the write from the page cache page we're looking at.\n\t * For now, we write the full page out each time. It sucks, but it's simple\n\t */\n\tstruct inode *inode = mapping->host;\n\tstruct jffs2_inode_info *f = JFFS2_INODE_INFO(inode);\n\tstruct jffs2_sb_info *c = JFFS2_SB_INFO(inode->i_sb);\n\tstruct jffs2_raw_inode *ri;\n\tunsigned start = pos & (PAGE_CACHE_SIZE - 1);\n\tunsigned end = start + copied;\n\tunsigned aligned_start = start & ~3;\n\tint ret = 0;\n\tuint32_t writtenlen = 0;\n\n\tjffs2_dbg(1, \"%s(): ino #%lu, page at 0x%lx, range %d-%d, flags %lx\\n\",\n\t\t  __func__, inode->i_ino, pg->index << PAGE_CACHE_SHIFT,\n\t\t  start, end, pg->flags);\n\n\t/* We need to avoid deadlock with page_cache_read() in\n\t   jffs2_garbage_collect_pass(). So the page must be\n\t   up to date to prevent page_cache_read() from trying\n\t   to re-lock it. */\n\tBUG_ON(!PageUptodate(pg));\n\n\tif (end == PAGE_CACHE_SIZE) {\n\t\t/* When writing out the end of a page, write out the\n\t\t   _whole_ page. This helps to reduce the number of\n\t\t   nodes in files which have many short writes, like\n\t\t   syslog files. */\n\t\taligned_start = 0;\n\t}\n\n\tri = jffs2_alloc_raw_inode();\n\n\tif (!ri) {\n\t\tjffs2_dbg(1, \"%s(): Allocation of raw inode failed\\n\",\n\t\t\t  __func__);\n\t\tunlock_page(pg);\n\t\tpage_cache_release(pg);\n\t\treturn -ENOMEM;\n\t}\n\n\t/* Set the fields that the generic jffs2_write_inode_range() code can't find */\n\tri->ino = cpu_to_je32(inode->i_ino);\n\tri->mode = cpu_to_jemode(inode->i_mode);\n\tri->uid = cpu_to_je16(i_uid_read(inode));\n\tri->gid = cpu_to_je16(i_gid_read(inode));\n\tri->isize = cpu_to_je32((uint32_t)inode->i_size);\n\tri->atime = ri->ctime = ri->mtime = cpu_to_je32(get_seconds());\n\n\t/* In 2.4, it was already kmapped by generic_file_write(). Doesn't\n\t   hurt to do it again. The alternative is ifdefs, which are ugly. */\n\tkmap(pg);\n\n\tret = jffs2_write_inode_range(c, f, ri, page_address(pg) + aligned_start,\n\t\t\t\t      (pg->index << PAGE_CACHE_SHIFT) + aligned_start,\n\t\t\t\t      end - aligned_start, &writtenlen);\n\n\tkunmap(pg);\n\n\tif (ret) {\n\t\t/* There was an error writing. */\n\t\tSetPageError(pg);\n\t}\n\n\t/* Adjust writtenlen for the padding we did, so we don't confuse our caller */\n\twrittenlen -= min(writtenlen, (start - aligned_start));\n\n\tif (writtenlen) {\n\t\tif (inode->i_size < pos + writtenlen) {\n\t\t\tinode->i_size = pos + writtenlen;\n\t\t\tinode->i_blocks = (inode->i_size + 511) >> 9;\n\n\t\t\tinode->i_ctime = inode->i_mtime = ITIME(je32_to_cpu(ri->ctime));\n\t\t}\n\t}\n\n\tjffs2_free_raw_inode(ri);\n\n\tif (start+writtenlen < end) {\n\t\t/* generic_file_write has written more to the page cache than we've\n\t\t   actually written to the medium. Mark the page !Uptodate so that\n\t\t   it gets reread */\n\t\tjffs2_dbg(1, \"%s(): Not all bytes written. Marking page !uptodate\\n\",\n\t\t\t__func__);\n\t\tSetPageError(pg);\n\t\tClearPageUptodate(pg);\n\t}\n\n\tjffs2_dbg(1, \"%s() returning %d\\n\",\n\t\t  __func__, writtenlen > 0 ? writtenlen : ret);\n\tunlock_page(pg);\n\tpage_cache_release(pg);\n\treturn writtenlen > 0 ? writtenlen : ret;\n}",
    "includes": [
      "nclude \"nodelist.h\"\n\ns",
      "nclude <linux/jffs2.h>\n#i",
      "nclude <linux/crc32.h>\n#i",
      "nclude <linux/highmem.h>\n#i",
      "nclude <linux/pagemap.h>\n#i",
      "nclude <linux/time.h>\n#i",
      "nclude <linux/fs.h>\n#i",
      "nclude <linux/kernel.h>\n#i"
    ],
    "macros_used": [],
    "globals_used": [
      "atic int jffs2_write_end(struct file *filp, struct address_space *mapping,\n\t\t\tloff_t pos, unsigned len, unsigned copied,\n\t\t\tstruct page *pg, void *fsdata);\ns",
      "atic int jffs2_write_begin(struct file *filp, struct address_space *mapping,\n\t\t\tloff_t pos, unsigned len, unsigned flags,\n\t\t\tstruct page **pagep, void **fsdata);\ns",
      "atic int jffs2_readpage (struct file *filp, struct page *pg);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "ge_cache_release(p",
          "args": [
            ");"
          ],
          "line": 337
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lock_page(p",
          "args": [
            ");"
          ],
          "line": 336
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs2_dbg(1",
          "args": [
            "s() returning %d\\n\",",
            "func__,",
            "ittenlen > 0 ? writtenlen : ret);"
          ],
          "line": 334
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "earPageUptodate(p",
          "args": [
            ");"
          ],
          "line": 331
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "tPageError(p",
          "args": [
            ");"
          ],
          "line": 330
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs2_dbg(1",
          "args": [
            "s(): Not all bytes written. Marking page !uptodate\\n\",",
            "func__);"
          ],
          "line": 328
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs2_free_raw_inode(r",
          "args": [
            ");"
          ],
          "line": 322
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "IME(j",
          "args": [
            "32_to_cpu(ri->ctime));"
          ],
          "line": 318
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "32_to_cpu(r",
          "args": [
            "->ctime))"
          ],
          "line": 318
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "n(w",
          "args": [
            "ittenlen,",
            "tart - aligned_start));"
          ],
          "line": 311
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "tPageError(p",
          "args": [
            ");"
          ],
          "line": 307
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "nmap(p",
          "args": [
            ");"
          ],
          "line": 303
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs2_write_inode_range(c",
          "args": [
            ",",
            "ge_address(pg) + aligned_start,",
            "g->index << PAGE_CACHE_SHIFT) + aligned_start,",
            "d - aligned_start,",
            "rittenlen);"
          ],
          "line": 299
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ge_address(p",
          "args": [
            ")"
          ],
          "line": 299
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ap(p",
          "args": [
            ");"
          ],
          "line": 297
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "u_to_je32(g",
          "args": [
            "t_seconds());"
          ],
          "line": 293
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "t_seconds()",
          "args": [],
          "line": 293
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "u_to_je32((",
          "args": [
            "int32_t)inode->i_size);"
          ],
          "line": 292
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "u_to_je16(i",
          "args": [
            "gid_read(inode));"
          ],
          "line": 291
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "gid_read(i",
          "args": [
            "ode))"
          ],
          "line": 291
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "u_to_je16(i",
          "args": [
            "uid_read(inode));"
          ],
          "line": 290
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "uid_read(i",
          "args": [
            "ode))"
          ],
          "line": 290
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "u_to_jemode(i",
          "args": [
            "ode->i_mode);"
          ],
          "line": 289
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "u_to_je32(i",
          "args": [
            "ode->i_ino);"
          ],
          "line": 288
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ge_cache_release(p",
          "args": [
            ");"
          ],
          "line": 283
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lock_page(p",
          "args": [
            ");"
          ],
          "line": 282
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs2_dbg(1",
          "args": [
            "s(): Allocation of raw inode failed\\n\",",
            "func__);"
          ],
          "line": 280
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs2_alloc_raw_inode()",
          "args": [],
          "line": 277
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "G_ON(!",
          "args": [
            "ageUptodate(pg));"
          ],
          "line": 267
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "geUptodate(p",
          "args": [
            "))"
          ],
          "line": 267
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs2_dbg(1",
          "args": [
            "s(): ino #%lu, page at 0x%lx, range %d-%d, flags %lx\\n\",",
            "func__,",
            "ode->i_ino,",
            "->index << PAGE_CACHE_SHIFT,",
            "art,",
            "d,",
            "->flags);"
          ],
          "line": 259
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "FS2_SB_INFO(i",
          "args": [
            "ode->i_sb);"
          ],
          "line": 251
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "FS2_INODE_INFO(i",
          "args": [
            "ode);"
          ],
          "line": 250
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "nclude \"nodelist.h\"\n\ns\nnclude <linux/jffs2.h>\n#i\nnclude <linux/crc32.h>\n#i\nnclude <linux/highmem.h>\n#i\nnclude <linux/pagemap.h>\n#i\nnclude <linux/time.h>\n#i\nnclude <linux/fs.h>\n#i\nnclude <linux/kernel.h>\n#i\n\natic int jffs2_write_end(struct file *filp, struct address_space *mapping,\n\t\t\tloff_t pos, unsigned len, unsigned copied,\n\t\t\tstruct page *pg, void *fsdata);\ns;\natic int jffs2_write_begin(struct file *filp, struct address_space *mapping,\n\t\t\tloff_t pos, unsigned len, unsigned flags,\n\t\t\tstruct page **pagep, void **fsdata);\ns;\natic int jffs2_readpage (struct file *filp, struct page *pg);\n\natic int jffs2_write_end(struct file *filp, struct address_space *mapping,\n\t\t\tloff_t pos, unsigned len, unsigned copied,\n\t\t\tstruct page *pg, void *fsdata)\n{\n\t/* Actually commit the write from the page cache page we're looking at.\n\t * For now, we write the full page out each time. It sucks, but it's simple\n\t */\n\tstruct inode *inode = mapping->host;\n\tstruct jffs2_inode_info *f = JFFS2_INODE_INFO(inode);\n\tstruct jffs2_sb_info *c = JFFS2_SB_INFO(inode->i_sb);\n\tstruct jffs2_raw_inode *ri;\n\tunsigned start = pos & (PAGE_CACHE_SIZE - 1);\n\tunsigned end = start + copied;\n\tunsigned aligned_start = start & ~3;\n\tint ret = 0;\n\tuint32_t writtenlen = 0;\n\n\tjffs2_dbg(1, \"%s(): ino #%lu, page at 0x%lx, range %d-%d, flags %lx\\n\",\n\t\t  __func__, inode->i_ino, pg->index << PAGE_CACHE_SHIFT,\n\t\t  start, end, pg->flags);\n\n\t/* We need to avoid deadlock with page_cache_read() in\n\t   jffs2_garbage_collect_pass(). So the page must be\n\t   up to date to prevent page_cache_read() from trying\n\t   to re-lock it. */\n\tBUG_ON(!PageUptodate(pg));\n\n\tif (end == PAGE_CACHE_SIZE) {\n\t\t/* When writing out the end of a page, write out the\n\t\t   _whole_ page. This helps to reduce the number of\n\t\t   nodes in files which have many short writes, like\n\t\t   syslog files. */\n\t\taligned_start = 0;\n\t}\n\n\tri = jffs2_alloc_raw_inode();\n\n\tif (!ri) {\n\t\tjffs2_dbg(1, \"%s(): Allocation of raw inode failed\\n\",\n\t\t\t  __func__);\n\t\tunlock_page(pg);\n\t\tpage_cache_release(pg);\n\t\treturn -ENOMEM;\n\t}\n\n\t/* Set the fields that the generic jffs2_write_inode_range() code can't find */\n\tri->ino = cpu_to_je32(inode->i_ino);\n\tri->mode = cpu_to_jemode(inode->i_mode);\n\tri->uid = cpu_to_je16(i_uid_read(inode));\n\tri->gid = cpu_to_je16(i_gid_read(inode));\n\tri->isize = cpu_to_je32((uint32_t)inode->i_size);\n\tri->atime = ri->ctime = ri->mtime = cpu_to_je32(get_seconds());\n\n\t/* In 2.4, it was already kmapped by generic_file_write(). Doesn't\n\t   hurt to do it again. The alternative is ifdefs, which are ugly. */\n\tkmap(pg);\n\n\tret = jffs2_write_inode_range(c, f, ri, page_address(pg) + aligned_start,\n\t\t\t\t      (pg->index << PAGE_CACHE_SHIFT) + aligned_start,\n\t\t\t\t      end - aligned_start, &writtenlen);\n\n\tkunmap(pg);\n\n\tif (ret) {\n\t\t/* There was an error writing. */\n\t\tSetPageError(pg);\n\t}\n\n\t/* Adjust writtenlen for the padding we did, so we don't confuse our caller */\n\twrittenlen -= min(writtenlen, (start - aligned_start));\n\n\tif (writtenlen) {\n\t\tif (inode->i_size < pos + writtenlen) {\n\t\t\tinode->i_size = pos + writtenlen;\n\t\t\tinode->i_blocks = (inode->i_size + 511) >> 9;\n\n\t\t\tinode->i_ctime = inode->i_mtime = ITIME(je32_to_cpu(ri->ctime));\n\t\t}\n\t}\n\n\tjffs2_free_raw_inode(ri);\n\n\tif (start+writtenlen < end) {\n\t\t/* generic_file_write has written more to the page cache than we've\n\t\t   actually written to the medium. Mark the page !Uptodate so that\n\t\t   it gets reread */\n\t\tjffs2_dbg(1, \"%s(): Not all bytes written. Marking page !uptodate\\n\",\n\t\t\t__func__);\n\t\tSetPageError(pg);\n\t\tClearPageUptodate(pg);\n\t}\n\n\tjffs2_dbg(1, \"%s() returning %d\\n\",\n\t\t  __func__, writtenlen > 0 ? writtenlen : ret);\n\tunlock_page(pg);\n\tpage_cache_release(pg);\n\treturn writtenlen > 0 ? writtenlen : ret;\n}"
  },
  {
    "function_name": "fs2_write_begin(s",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/jffs2/file.c",
    "lines": "135-240",
    "snippet": "atic int jffs2_write_begin(struct file *filp, struct address_space *mapping,\n\t\t\tloff_t pos, unsigned len, unsigned flags,\n\t\t\tstruct page **pagep, void **fsdata)\n{\n\tstruct page *pg;\n\tstruct inode *inode = mapping->host;\n\tstruct jffs2_inode_info *f = JFFS2_INODE_INFO(inode);\n\tstruct jffs2_sb_info *c = JFFS2_SB_INFO(inode->i_sb);\n\tstruct jffs2_raw_inode ri;\n\tuint32_t alloc_len = 0;\n\tpgoff_t index = pos >> PAGE_CACHE_SHIFT;\n\tuint32_t pageofs = index << PAGE_CACHE_SHIFT;\n\tint ret = 0;\n\n\tjffs2_dbg(1, \"%s()\\n\", __func__);\n\n\tif (pageofs > inode->i_size) {\n\t\tret = jffs2_reserve_space(c, sizeof(ri), &alloc_len,\n\t\t\t\t\t  ALLOC_NORMAL, JFFS2_SUMMARY_INODE_SIZE);\n\t\tif (ret)\n\t\t\treturn ret;\n\t}\n\n\tmutex_lock(&f->sem);\n\tpg = grab_cache_page_write_begin(mapping, index, flags);\n\tif (!pg) {\n\t\tif (alloc_len)\n\t\t\tjffs2_complete_reservation(c);\n\t\tmutex_unlock(&f->sem);\n\t\treturn -ENOMEM;\n\t}\n\t*pagep = pg;\n\n\tif (alloc_len) {\n\t\t/* Make new hole frag from old EOF to new page */\n\t\tstruct jffs2_full_dnode *fn;\n\n\t\tjffs2_dbg(1, \"Writing new hole frag 0x%x-0x%x between current EOF and new page\\n\",\n\t\t\t  (unsigned int)inode->i_size, pageofs);\n\n\t\tmemset(&ri, 0, sizeof(ri));\n\n\t\tri.magic = cpu_to_je16(JFFS2_MAGIC_BITMASK);\n\t\tri.nodetype = cpu_to_je16(JFFS2_NODETYPE_INODE);\n\t\tri.totlen = cpu_to_je32(sizeof(ri));\n\t\tri.hdr_crc = cpu_to_je32(crc32(0, &ri, sizeof(struct jffs2_unknown_node)-4));\n\n\t\tri.ino = cpu_to_je32(f->inocache->ino);\n\t\tri.version = cpu_to_je32(++f->highest_version);\n\t\tri.mode = cpu_to_jemode(inode->i_mode);\n\t\tri.uid = cpu_to_je16(i_uid_read(inode));\n\t\tri.gid = cpu_to_je16(i_gid_read(inode));\n\t\tri.isize = cpu_to_je32(max((uint32_t)inode->i_size, pageofs));\n\t\tri.atime = ri.ctime = ri.mtime = cpu_to_je32(get_seconds());\n\t\tri.offset = cpu_to_je32(inode->i_size);\n\t\tri.dsize = cpu_to_je32(pageofs - inode->i_size);\n\t\tri.csize = cpu_to_je32(0);\n\t\tri.compr = JFFS2_COMPR_ZERO;\n\t\tri.node_crc = cpu_to_je32(crc32(0, &ri, sizeof(ri)-8));\n\t\tri.data_crc = cpu_to_je32(0);\n\n\t\tfn = jffs2_write_dnode(c, f, &ri, NULL, 0, ALLOC_NORMAL);\n\n\t\tif (IS_ERR(fn)) {\n\t\t\tret = PTR_ERR(fn);\n\t\t\tjffs2_complete_reservation(c);\n\t\t\tgoto out_page;\n\t\t}\n\t\tret = jffs2_add_full_dnode_to_inode(c, f, fn);\n\t\tif (f->metadata) {\n\t\t\tjffs2_mark_node_obsolete(c, f->metadata->raw);\n\t\t\tjffs2_free_full_dnode(f->metadata);\n\t\t\tf->metadata = NULL;\n\t\t}\n\t\tif (ret) {\n\t\t\tjffs2_dbg(1, \"Eep. add_full_dnode_to_inode() failed in write_begin, returned %d\\n\",\n\t\t\t\t  ret);\n\t\t\tjffs2_mark_node_obsolete(c, fn->raw);\n\t\t\tjffs2_free_full_dnode(fn);\n\t\t\tjffs2_complete_reservation(c);\n\t\t\tgoto out_page;\n\t\t}\n\t\tjffs2_complete_reservation(c);\n\t\tinode->i_size = pageofs;\n\t}\n\n\t/*\n\t * Read in the page if it wasn't already present. Cannot optimize away\n\t * the whole page write case until jffs2_write_end can handle the\n\t * case of a short-copy.\n\t */\n\tif (!PageUptodate(pg)) {\n\t\tret = jffs2_do_readpage_nolock(inode, pg);\n\t\tif (ret)\n\t\t\tgoto out_page;\n\t}\n\tmutex_unlock(&f->sem);\n\tjffs2_dbg(1, \"end write_begin(). pg->flags %lx\\n\", pg->flags);\n\treturn ret;\n\nout_page:\n\tunlock_page(pg);\n\tpage_cache_release(pg);\n\tmutex_unlock(&f->sem);\n\treturn ret;\n}",
    "includes": [
      "nclude \"nodelist.h\"\n\ns",
      "nclude <linux/jffs2.h>\n#i",
      "nclude <linux/crc32.h>\n#i",
      "nclude <linux/highmem.h>\n#i",
      "nclude <linux/pagemap.h>\n#i",
      "nclude <linux/time.h>\n#i",
      "nclude <linux/fs.h>\n#i",
      "nclude <linux/kernel.h>\n#i"
    ],
    "macros_used": [],
    "globals_used": [
      "atic int jffs2_write_end(struct file *filp, struct address_space *mapping,\n\t\t\tloff_t pos, unsigned len, unsigned copied,\n\t\t\tstruct page *pg, void *fsdata);\ns",
      "atic int jffs2_write_begin(struct file *filp, struct address_space *mapping,\n\t\t\tloff_t pos, unsigned len, unsigned flags,\n\t\t\tstruct page **pagep, void **fsdata);\ns",
      "atic int jffs2_readpage (struct file *filp, struct page *pg);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "tex_unlock(&",
          "args": [
            "->sem);"
          ],
          "line": 238
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ge_cache_release(p",
          "args": [
            ");"
          ],
          "line": 237
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lock_page(p",
          "args": [
            ");"
          ],
          "line": 236
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs2_dbg(1",
          "args": [
            "nd write_begin(). pg->flags %lx\\n\",",
            "->flags);"
          ],
          "line": 232
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "tex_unlock(&",
          "args": [
            "->sem);"
          ],
          "line": 231
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs2_do_readpage_nolock(i",
          "args": [
            "ode,",
            ");"
          ],
          "line": 227
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "geUptodate(p",
          "args": [
            "))"
          ],
          "line": 226
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs2_complete_reservation(c",
          "args": [
            ";"
          ],
          "line": 217
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs2_complete_reservation(c",
          "args": [
            ";"
          ],
          "line": 214
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs2_free_full_dnode(f",
          "args": [
            ");"
          ],
          "line": 213
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs2_mark_node_obsolete(c",
          "args": [
            "->raw);"
          ],
          "line": 212
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs2_dbg(1",
          "args": [
            "ep. add_full_dnode_to_inode() failed in write_begin, returned %d\\n\",",
            "t);"
          ],
          "line": 210
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs2_free_full_dnode(f",
          "args": [
            ">metadata);"
          ],
          "line": 206
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs2_mark_node_obsolete(c",
          "args": [
            ">metadata->raw);"
          ],
          "line": 205
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs2_add_full_dnode_to_inode(c",
          "args": [
            ");"
          ],
          "line": 203
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs2_complete_reservation(c",
          "args": [
            ";"
          ],
          "line": 200
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "R_ERR(f",
          "args": [
            ");"
          ],
          "line": 199
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_ERR(f",
          "args": [
            "))"
          ],
          "line": 198
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs2_write_dnode(c",
          "args": [
            "i,",
            "LL,",
            "LOC_NORMAL);"
          ],
          "line": 196
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "u_to_je32(0",
          "args": [
            ";"
          ],
          "line": 194
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "u_to_je32(c",
          "args": [
            "c32(0, &ri, sizeof(ri)-8));"
          ],
          "line": 193
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "c32(0",
          "args": [
            "i,",
            "zeof(ri)-8))"
          ],
          "line": 193
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "u_to_je32(0",
          "args": [
            ";"
          ],
          "line": 191
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "u_to_je32(p",
          "args": [
            "geofs - inode->i_size);"
          ],
          "line": 190
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "u_to_je32(i",
          "args": [
            "ode->i_size);"
          ],
          "line": 189
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "u_to_je32(g",
          "args": [
            "t_seconds());"
          ],
          "line": 188
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "t_seconds()",
          "args": [],
          "line": 188
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "u_to_je32(m",
          "args": [
            "x((uint32_t)inode->i_size, pageofs));"
          ],
          "line": 187
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "x((",
          "args": [
            "int32_t)inode->i_size,",
            "geofs))"
          ],
          "line": 187
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "u_to_je16(i",
          "args": [
            "gid_read(inode));"
          ],
          "line": 186
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "gid_read(i",
          "args": [
            "ode))"
          ],
          "line": 186
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "u_to_je16(i",
          "args": [
            "uid_read(inode));"
          ],
          "line": 185
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "uid_read(i",
          "args": [
            "ode))"
          ],
          "line": 185
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "u_to_jemode(i",
          "args": [
            "ode->i_mode);"
          ],
          "line": 184
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "u_to_je32(+",
          "args": [
            "f->highest_version);"
          ],
          "line": 183
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "u_to_je32(f",
          "args": [
            ">inocache->ino);"
          ],
          "line": 182
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "u_to_je32(c",
          "args": [
            "c32(0, &ri, sizeof(struct jffs2_unknown_node)-4));"
          ],
          "line": 180
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "c32(0",
          "args": [
            "i,",
            "zeof(struct jffs2_unknown_node)-4))"
          ],
          "line": 180
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "u_to_je32(s",
          "args": [
            "zeof(ri));"
          ],
          "line": 179
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "u_to_je16(J",
          "args": [
            "FS2_NODETYPE_INODE);"
          ],
          "line": 178
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "u_to_je16(J",
          "args": [
            "FS2_MAGIC_BITMASK);"
          ],
          "line": 177
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "mset(&",
          "args": [
            "i,",
            "zeof(ri));"
          ],
          "line": 175
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs2_dbg(1",
          "args": [
            "riting new hole frag 0x%x-0x%x between current EOF and new page\\n\",",
            "nsigned int)inode->i_size,",
            "geofs);"
          ],
          "line": 172
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "tex_unlock(&",
          "args": [
            "->sem);"
          ],
          "line": 163
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs2_complete_reservation(c",
          "args": [
            ";"
          ],
          "line": 162
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ab_cache_page_write_begin(m",
          "args": [
            "pping,",
            "dex,",
            "ags);"
          ],
          "line": 159
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "tex_lock(&",
          "args": [
            "->sem);"
          ],
          "line": 158
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs2_reserve_space(c",
          "args": [
            "zeof(ri),",
            "lloc_len,",
            "LOC_NORMAL,",
            "FS2_SUMMARY_INODE_SIZE);"
          ],
          "line": 152
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs2_dbg(1",
          "args": [
            "s()\\n\",",
            "func__);"
          ],
          "line": 149
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "FS2_SB_INFO(i",
          "args": [
            "ode->i_sb);"
          ],
          "line": 142
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "FS2_INODE_INFO(i",
          "args": [
            "ode);"
          ],
          "line": 141
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "nclude \"nodelist.h\"\n\ns\nnclude <linux/jffs2.h>\n#i\nnclude <linux/crc32.h>\n#i\nnclude <linux/highmem.h>\n#i\nnclude <linux/pagemap.h>\n#i\nnclude <linux/time.h>\n#i\nnclude <linux/fs.h>\n#i\nnclude <linux/kernel.h>\n#i\n\natic int jffs2_write_end(struct file *filp, struct address_space *mapping,\n\t\t\tloff_t pos, unsigned len, unsigned copied,\n\t\t\tstruct page *pg, void *fsdata);\ns;\natic int jffs2_write_begin(struct file *filp, struct address_space *mapping,\n\t\t\tloff_t pos, unsigned len, unsigned flags,\n\t\t\tstruct page **pagep, void **fsdata);\ns;\natic int jffs2_readpage (struct file *filp, struct page *pg);\n\natic int jffs2_write_begin(struct file *filp, struct address_space *mapping,\n\t\t\tloff_t pos, unsigned len, unsigned flags,\n\t\t\tstruct page **pagep, void **fsdata)\n{\n\tstruct page *pg;\n\tstruct inode *inode = mapping->host;\n\tstruct jffs2_inode_info *f = JFFS2_INODE_INFO(inode);\n\tstruct jffs2_sb_info *c = JFFS2_SB_INFO(inode->i_sb);\n\tstruct jffs2_raw_inode ri;\n\tuint32_t alloc_len = 0;\n\tpgoff_t index = pos >> PAGE_CACHE_SHIFT;\n\tuint32_t pageofs = index << PAGE_CACHE_SHIFT;\n\tint ret = 0;\n\n\tjffs2_dbg(1, \"%s()\\n\", __func__);\n\n\tif (pageofs > inode->i_size) {\n\t\tret = jffs2_reserve_space(c, sizeof(ri), &alloc_len,\n\t\t\t\t\t  ALLOC_NORMAL, JFFS2_SUMMARY_INODE_SIZE);\n\t\tif (ret)\n\t\t\treturn ret;\n\t}\n\n\tmutex_lock(&f->sem);\n\tpg = grab_cache_page_write_begin(mapping, index, flags);\n\tif (!pg) {\n\t\tif (alloc_len)\n\t\t\tjffs2_complete_reservation(c);\n\t\tmutex_unlock(&f->sem);\n\t\treturn -ENOMEM;\n\t}\n\t*pagep = pg;\n\n\tif (alloc_len) {\n\t\t/* Make new hole frag from old EOF to new page */\n\t\tstruct jffs2_full_dnode *fn;\n\n\t\tjffs2_dbg(1, \"Writing new hole frag 0x%x-0x%x between current EOF and new page\\n\",\n\t\t\t  (unsigned int)inode->i_size, pageofs);\n\n\t\tmemset(&ri, 0, sizeof(ri));\n\n\t\tri.magic = cpu_to_je16(JFFS2_MAGIC_BITMASK);\n\t\tri.nodetype = cpu_to_je16(JFFS2_NODETYPE_INODE);\n\t\tri.totlen = cpu_to_je32(sizeof(ri));\n\t\tri.hdr_crc = cpu_to_je32(crc32(0, &ri, sizeof(struct jffs2_unknown_node)-4));\n\n\t\tri.ino = cpu_to_je32(f->inocache->ino);\n\t\tri.version = cpu_to_je32(++f->highest_version);\n\t\tri.mode = cpu_to_jemode(inode->i_mode);\n\t\tri.uid = cpu_to_je16(i_uid_read(inode));\n\t\tri.gid = cpu_to_je16(i_gid_read(inode));\n\t\tri.isize = cpu_to_je32(max((uint32_t)inode->i_size, pageofs));\n\t\tri.atime = ri.ctime = ri.mtime = cpu_to_je32(get_seconds());\n\t\tri.offset = cpu_to_je32(inode->i_size);\n\t\tri.dsize = cpu_to_je32(pageofs - inode->i_size);\n\t\tri.csize = cpu_to_je32(0);\n\t\tri.compr = JFFS2_COMPR_ZERO;\n\t\tri.node_crc = cpu_to_je32(crc32(0, &ri, sizeof(ri)-8));\n\t\tri.data_crc = cpu_to_je32(0);\n\n\t\tfn = jffs2_write_dnode(c, f, &ri, NULL, 0, ALLOC_NORMAL);\n\n\t\tif (IS_ERR(fn)) {\n\t\t\tret = PTR_ERR(fn);\n\t\t\tjffs2_complete_reservation(c);\n\t\t\tgoto out_page;\n\t\t}\n\t\tret = jffs2_add_full_dnode_to_inode(c, f, fn);\n\t\tif (f->metadata) {\n\t\t\tjffs2_mark_node_obsolete(c, f->metadata->raw);\n\t\t\tjffs2_free_full_dnode(f->metadata);\n\t\t\tf->metadata = NULL;\n\t\t}\n\t\tif (ret) {\n\t\t\tjffs2_dbg(1, \"Eep. add_full_dnode_to_inode() failed in write_begin, returned %d\\n\",\n\t\t\t\t  ret);\n\t\t\tjffs2_mark_node_obsolete(c, fn->raw);\n\t\t\tjffs2_free_full_dnode(fn);\n\t\t\tjffs2_complete_reservation(c);\n\t\t\tgoto out_page;\n\t\t}\n\t\tjffs2_complete_reservation(c);\n\t\tinode->i_size = pageofs;\n\t}\n\n\t/*\n\t * Read in the page if it wasn't already present. Cannot optimize away\n\t * the whole page write case until jffs2_write_end can handle the\n\t * case of a short-copy.\n\t */\n\tif (!PageUptodate(pg)) {\n\t\tret = jffs2_do_readpage_nolock(inode, pg);\n\t\tif (ret)\n\t\t\tgoto out_page;\n\t}\n\tmutex_unlock(&f->sem);\n\tjffs2_dbg(1, \"end write_begin(). pg->flags %lx\\n\", pg->flags);\n\treturn ret;\n\nout_page:\n\tunlock_page(pg);\n\tpage_cache_release(pg);\n\tmutex_unlock(&f->sem);\n\treturn ret;\n}"
  },
  {
    "function_name": "fs2_readpage (",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/jffs2/file.c",
    "lines": "124-133",
    "snippet": "atic int jffs2_readpage (struct file *filp, struct page *pg)\n{\n\tstruct jffs2_inode_info *f = JFFS2_INODE_INFO(pg->mapping->host);\n\tint ret;\n\n\tmutex_lock(&f->sem);\n\tret = jffs2_do_readpage_unlock(pg->mapping->host, pg);\n\tmutex_unlock(&f->sem);\n\treturn ret;\n}",
    "includes": [
      "nclude \"nodelist.h\"\n\ns",
      "nclude <linux/jffs2.h>\n#i",
      "nclude <linux/crc32.h>\n#i",
      "nclude <linux/highmem.h>\n#i",
      "nclude <linux/pagemap.h>\n#i",
      "nclude <linux/time.h>\n#i",
      "nclude <linux/fs.h>\n#i",
      "nclude <linux/kernel.h>\n#i"
    ],
    "macros_used": [],
    "globals_used": [
      "atic int jffs2_readpage (struct file *filp, struct page *pg);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "tex_unlock(&",
          "args": [
            "->sem);"
          ],
          "line": 131
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs2_do_readpage_unlock(p",
          "args": [
            "->mapping->host,",
            ");"
          ],
          "line": 130
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "tex_lock(&",
          "args": [
            "->sem);"
          ],
          "line": 129
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "FS2_INODE_INFO(p",
          "args": [
            "->mapping->host);"
          ],
          "line": 126
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "nclude \"nodelist.h\"\n\ns\nnclude <linux/jffs2.h>\n#i\nnclude <linux/crc32.h>\n#i\nnclude <linux/highmem.h>\n#i\nnclude <linux/pagemap.h>\n#i\nnclude <linux/time.h>\n#i\nnclude <linux/fs.h>\n#i\nnclude <linux/kernel.h>\n#i\n\natic int jffs2_readpage (struct file *filp, struct page *pg);\n\natic int jffs2_readpage (struct file *filp, struct page *pg)\n{\n\tstruct jffs2_inode_info *f = JFFS2_INODE_INFO(pg->mapping->host);\n\tint ret;\n\n\tmutex_lock(&f->sem);\n\tret = jffs2_do_readpage_unlock(pg->mapping->host, pg);\n\tmutex_unlock(&f->sem);\n\treturn ret;\n}"
  },
  {
    "function_name": "fs2_do_readpage_unlock(s",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/jffs2/file.c",
    "lines": "116-121",
    "snippet": "t jffs2_do_readpage_unlock(struct inode *inode, struct page *pg)\n{\n\tint ret = jffs2_do_readpage_nolock(inode, pg);\n\tunlock_page(pg);\n\treturn ret;\n}",
    "includes": [
      "nclude \"nodelist.h\"\n\ns",
      "nclude <linux/jffs2.h>\n#i",
      "nclude <linux/crc32.h>\n#i",
      "nclude <linux/highmem.h>\n#i",
      "nclude <linux/pagemap.h>\n#i",
      "nclude <linux/time.h>\n#i",
      "nclude <linux/fs.h>\n#i",
      "nclude <linux/kernel.h>\n#i"
    ],
    "macros_used": [],
    "globals_used": [
      "atic int jffs2_readpage (struct file *filp, struct page *pg);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "lock_page(p",
          "args": [
            ");"
          ],
          "line": 119
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs2_do_readpage_nolock(i",
          "args": [
            "ode,",
            ");"
          ],
          "line": 118
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "nclude \"nodelist.h\"\n\ns\nnclude <linux/jffs2.h>\n#i\nnclude <linux/crc32.h>\n#i\nnclude <linux/highmem.h>\n#i\nnclude <linux/pagemap.h>\n#i\nnclude <linux/time.h>\n#i\nnclude <linux/fs.h>\n#i\nnclude <linux/kernel.h>\n#i\n\natic int jffs2_readpage (struct file *filp, struct page *pg);\n\nt jffs2_do_readpage_unlock(struct inode *inode, struct page *pg)\n{\n\tint ret = jffs2_do_readpage_nolock(inode, pg);\n\tunlock_page(pg);\n\treturn ret;\n}"
  },
  {
    "function_name": "fs2_do_readpage_nolock (",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/jffs2/file.c",
    "lines": "84-114",
    "snippet": "atic int jffs2_do_readpage_nolock (struct inode *inode, struct page *pg)\n{\n\tstruct jffs2_inode_info *f = JFFS2_INODE_INFO(inode);\n\tstruct jffs2_sb_info *c = JFFS2_SB_INFO(inode->i_sb);\n\tunsigned char *pg_buf;\n\tint ret;\n\n\tjffs2_dbg(2, \"%s(): ino #%lu, page at offset 0x%lx\\n\",\n\t\t  __func__, inode->i_ino, pg->index << PAGE_CACHE_SHIFT);\n\n\tBUG_ON(!PageLocked(pg));\n\n\tpg_buf = kmap(pg);\n\t/* FIXME: Can kmap fail? */\n\n\tret = jffs2_read_inode_range(c, f, pg_buf, pg->index << PAGE_CACHE_SHIFT, PAGE_CACHE_SIZE);\n\n\tif (ret) {\n\t\tClearPageUptodate(pg);\n\t\tSetPageError(pg);\n\t} else {\n\t\tSetPageUptodate(pg);\n\t\tClearPageError(pg);\n\t}\n\n\tflush_dcache_page(pg);\n\tkunmap(pg);\n\n\tjffs2_dbg(2, \"readpage finished\\n\");\n\treturn ret;\n}",
    "includes": [
      "nclude \"nodelist.h\"\n\ns",
      "nclude <linux/jffs2.h>\n#i",
      "nclude <linux/crc32.h>\n#i",
      "nclude <linux/highmem.h>\n#i",
      "nclude <linux/pagemap.h>\n#i",
      "nclude <linux/time.h>\n#i",
      "nclude <linux/fs.h>\n#i",
      "nclude <linux/kernel.h>\n#i"
    ],
    "macros_used": [],
    "globals_used": [
      "atic int jffs2_write_end(struct file *filp, struct address_space *mapping,\n\t\t\tloff_t pos, unsigned len, unsigned copied,\n\t\t\tstruct page *pg, void *fsdata);\ns",
      "atic int jffs2_write_begin(struct file *filp, struct address_space *mapping,\n\t\t\tloff_t pos, unsigned len, unsigned flags,\n\t\t\tstruct page **pagep, void **fsdata);\ns",
      "atic int jffs2_readpage (struct file *filp, struct page *pg);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "fs2_dbg(2",
          "args": [
            "eadpage finished\\n\");"
          ],
          "line": 112
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "nmap(p",
          "args": [
            ");"
          ],
          "line": 110
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ush_dcache_page(p",
          "args": [
            ");"
          ],
          "line": 109
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "earPageError(p",
          "args": [
            ");"
          ],
          "line": 106
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "tPageUptodate(p",
          "args": [
            ");"
          ],
          "line": 105
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "tPageError(p",
          "args": [
            ");"
          ],
          "line": 103
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "earPageUptodate(p",
          "args": [
            ");"
          ],
          "line": 102
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs2_read_inode_range(c",
          "args": [
            "_buf,",
            "->index << PAGE_CACHE_SHIFT,",
            "GE_CACHE_SIZE);"
          ],
          "line": 99
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ap(p",
          "args": [
            ");"
          ],
          "line": 96
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "G_ON(!",
          "args": [
            "ageLocked(pg));"
          ],
          "line": 94
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "geLocked(p",
          "args": [
            "))"
          ],
          "line": 94
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs2_dbg(2",
          "args": [
            "s(): ino #%lu, page at offset 0x%lx\\n\",",
            "func__,",
            "ode->i_ino,",
            "->index << PAGE_CACHE_SHIFT);"
          ],
          "line": 91
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "FS2_SB_INFO(i",
          "args": [
            "ode->i_sb);"
          ],
          "line": 87
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "FS2_INODE_INFO(i",
          "args": [
            "ode);"
          ],
          "line": 86
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "nclude \"nodelist.h\"\n\ns\nnclude <linux/jffs2.h>\n#i\nnclude <linux/crc32.h>\n#i\nnclude <linux/highmem.h>\n#i\nnclude <linux/pagemap.h>\n#i\nnclude <linux/time.h>\n#i\nnclude <linux/fs.h>\n#i\nnclude <linux/kernel.h>\n#i\n\natic int jffs2_write_end(struct file *filp, struct address_space *mapping,\n\t\t\tloff_t pos, unsigned len, unsigned copied,\n\t\t\tstruct page *pg, void *fsdata);\ns;\natic int jffs2_write_begin(struct file *filp, struct address_space *mapping,\n\t\t\tloff_t pos, unsigned len, unsigned flags,\n\t\t\tstruct page **pagep, void **fsdata);\ns;\natic int jffs2_readpage (struct file *filp, struct page *pg);\n\natic int jffs2_do_readpage_nolock (struct inode *inode, struct page *pg)\n{\n\tstruct jffs2_inode_info *f = JFFS2_INODE_INFO(inode);\n\tstruct jffs2_sb_info *c = JFFS2_SB_INFO(inode->i_sb);\n\tunsigned char *pg_buf;\n\tint ret;\n\n\tjffs2_dbg(2, \"%s(): ino #%lu, page at offset 0x%lx\\n\",\n\t\t  __func__, inode->i_ino, pg->index << PAGE_CACHE_SHIFT);\n\n\tBUG_ON(!PageLocked(pg));\n\n\tpg_buf = kmap(pg);\n\t/* FIXME: Can kmap fail? */\n\n\tret = jffs2_read_inode_range(c, f, pg_buf, pg->index << PAGE_CACHE_SHIFT, PAGE_CACHE_SIZE);\n\n\tif (ret) {\n\t\tClearPageUptodate(pg);\n\t\tSetPageError(pg);\n\t} else {\n\t\tSetPageUptodate(pg);\n\t\tClearPageError(pg);\n\t}\n\n\tflush_dcache_page(pg);\n\tkunmap(pg);\n\n\tjffs2_dbg(2, \"readpage finished\\n\");\n\treturn ret;\n}"
  },
  {
    "function_name": "fs2_fsync(s",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/jffs2/file.c",
    "lines": "32-48",
    "snippet": "t jffs2_fsync(struct file *filp, loff_t start, loff_t end, int datasync)\n{\n\tstruct inode *inode = filp->f_mapping->host;\n\tstruct jffs2_sb_info *c = JFFS2_SB_INFO(inode->i_sb);\n\tint ret;\n\n\tret = filemap_write_and_wait_range(inode->i_mapping, start, end);\n\tif (ret)\n\t\treturn ret;\n\n\tmutex_lock(&inode->i_mutex);\n\t/* Trigger GC to flush any pending writes for this inode */\n\tjffs2_flush_wbuf_gc(c, inode->i_ino);\n\tmutex_unlock(&inode->i_mutex);\n\n\treturn 0;\n}",
    "includes": [
      "nclude \"nodelist.h\"\n\ns",
      "nclude <linux/jffs2.h>\n#i",
      "nclude <linux/crc32.h>\n#i",
      "nclude <linux/highmem.h>\n#i",
      "nclude <linux/pagemap.h>\n#i",
      "nclude <linux/time.h>\n#i",
      "nclude <linux/fs.h>\n#i",
      "nclude <linux/kernel.h>\n#i"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "tex_unlock(&",
          "args": [
            "node->i_mutex);"
          ],
          "line": 45
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs2_flush_wbuf_gc(c",
          "args": [
            "ode->i_ino);"
          ],
          "line": 44
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "tex_lock(&",
          "args": [
            "node->i_mutex);"
          ],
          "line": 42
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lemap_write_and_wait_range(i",
          "args": [
            "ode->i_mapping,",
            "art,",
            "d);"
          ],
          "line": 38
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "FS2_SB_INFO(i",
          "args": [
            "ode->i_sb);"
          ],
          "line": 35
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "nclude \"nodelist.h\"\n\ns\nnclude <linux/jffs2.h>\n#i\nnclude <linux/crc32.h>\n#i\nnclude <linux/highmem.h>\n#i\nnclude <linux/pagemap.h>\n#i\nnclude <linux/time.h>\n#i\nnclude <linux/fs.h>\n#i\nnclude <linux/kernel.h>\n#i\n\nt jffs2_fsync(struct file *filp, loff_t start, loff_t end, int datasync)\n{\n\tstruct inode *inode = filp->f_mapping->host;\n\tstruct jffs2_sb_info *c = JFFS2_SB_INFO(inode->i_sb);\n\tint ret;\n\n\tret = filemap_write_and_wait_range(inode->i_mapping, start, end);\n\tif (ret)\n\t\treturn ret;\n\n\tmutex_lock(&inode->i_mutex);\n\t/* Trigger GC to flush any pending writes for this inode */\n\tjffs2_flush_wbuf_gc(c, inode->i_ino);\n\tmutex_unlock(&inode->i_mutex);\n\n\treturn 0;\n}"
  }
]