[
  {
    "function_name": "nilfs_bmap_restore",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/bmap.c",
    "lines": "560-567",
    "snippet": "void nilfs_bmap_restore(struct nilfs_bmap *bmap,\n\t\t\tconst struct nilfs_bmap_store *store)\n{\n\tmemcpy(bmap->b_u.u_data, store->data, sizeof(store->data));\n\tbmap->b_last_allocated_key = store->last_allocated_key;\n\tbmap->b_last_allocated_ptr = store->last_allocated_ptr;\n\tbmap->b_state = store->state;\n}",
    "includes": [
      "#include \"alloc.h\"",
      "#include \"dat.h\"",
      "#include \"mdt.h\"",
      "#include \"btnode.h\"",
      "#include \"direct.h\"",
      "#include \"btree.h\"",
      "#include \"bmap.h\"",
      "#include \"nilfs.h\"",
      "#include <linux/errno.h>",
      "#include <linux/string.h>",
      "#include <linux/fs.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "memcpy",
          "args": [
            "bmap->b_u.u_data",
            "store->data",
            "sizeof(store->data)"
          ],
          "line": 563
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"alloc.h\"\n#include \"dat.h\"\n#include \"mdt.h\"\n#include \"btnode.h\"\n#include \"direct.h\"\n#include \"btree.h\"\n#include \"bmap.h\"\n#include \"nilfs.h\"\n#include <linux/errno.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n\nvoid nilfs_bmap_restore(struct nilfs_bmap *bmap,\n\t\t\tconst struct nilfs_bmap_store *store)\n{\n\tmemcpy(bmap->b_u.u_data, store->data, sizeof(store->data));\n\tbmap->b_last_allocated_key = store->last_allocated_key;\n\tbmap->b_last_allocated_ptr = store->last_allocated_ptr;\n\tbmap->b_state = store->state;\n}"
  },
  {
    "function_name": "nilfs_bmap_save",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/bmap.c",
    "lines": "551-558",
    "snippet": "void nilfs_bmap_save(const struct nilfs_bmap *bmap,\n\t\t     struct nilfs_bmap_store *store)\n{\n\tmemcpy(store->data, bmap->b_u.u_data, sizeof(store->data));\n\tstore->last_allocated_key = bmap->b_last_allocated_key;\n\tstore->last_allocated_ptr = bmap->b_last_allocated_ptr;\n\tstore->state = bmap->b_state;\n}",
    "includes": [
      "#include \"alloc.h\"",
      "#include \"dat.h\"",
      "#include \"mdt.h\"",
      "#include \"btnode.h\"",
      "#include \"direct.h\"",
      "#include \"btree.h\"",
      "#include \"bmap.h\"",
      "#include \"nilfs.h\"",
      "#include <linux/errno.h>",
      "#include <linux/string.h>",
      "#include <linux/fs.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "memcpy",
          "args": [
            "store->data",
            "bmap->b_u.u_data",
            "sizeof(store->data)"
          ],
          "line": 554
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"alloc.h\"\n#include \"dat.h\"\n#include \"mdt.h\"\n#include \"btnode.h\"\n#include \"direct.h\"\n#include \"btree.h\"\n#include \"bmap.h\"\n#include \"nilfs.h\"\n#include <linux/errno.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n\nvoid nilfs_bmap_save(const struct nilfs_bmap *bmap,\n\t\t     struct nilfs_bmap_store *store)\n{\n\tmemcpy(store->data, bmap->b_u.u_data, sizeof(store->data));\n\tstore->last_allocated_key = bmap->b_last_allocated_key;\n\tstore->last_allocated_ptr = bmap->b_last_allocated_ptr;\n\tstore->state = bmap->b_state;\n}"
  },
  {
    "function_name": "nilfs_bmap_init_gc",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/bmap.c",
    "lines": "539-549",
    "snippet": "void nilfs_bmap_init_gc(struct nilfs_bmap *bmap)\n{\n\tmemset(&bmap->b_u, 0, NILFS_BMAP_SIZE);\n\tinit_rwsem(&bmap->b_sem);\n\tbmap->b_inode = &NILFS_BMAP_I(bmap)->vfs_inode;\n\tbmap->b_ptr_type = NILFS_BMAP_PTR_U;\n\tbmap->b_last_allocated_key = 0;\n\tbmap->b_last_allocated_ptr = NILFS_BMAP_INVALID_PTR;\n\tbmap->b_state = 0;\n\tnilfs_btree_init_gc(bmap);\n}",
    "includes": [
      "#include \"alloc.h\"",
      "#include \"dat.h\"",
      "#include \"mdt.h\"",
      "#include \"btnode.h\"",
      "#include \"direct.h\"",
      "#include \"btree.h\"",
      "#include \"bmap.h\"",
      "#include \"nilfs.h\"",
      "#include <linux/errno.h>",
      "#include <linux/string.h>",
      "#include <linux/fs.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "nilfs_btree_init_gc",
          "args": [
            "bmap"
          ],
          "line": 548
        },
        "resolved": true,
        "details": {
          "function_name": "nilfs_btree_init_gc",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/btree.c",
          "lines": "2346-2351",
          "snippet": "void nilfs_btree_init_gc(struct nilfs_bmap *bmap)\n{\n\tbmap->b_ops = &nilfs_btree_ops_gc;\n\tbmap->b_nchildren_per_block =\n\t\tNILFS_BTREE_NODE_NCHILDREN_MAX(nilfs_btree_node_size(bmap));\n}",
          "includes": [
            "#include \"dat.h\"",
            "#include \"alloc.h\"",
            "#include \"btree.h\"",
            "#include \"btnode.h\"",
            "#include \"page.h\"",
            "#include \"nilfs.h\"",
            "#include <linux/pagevec.h>",
            "#include <linux/errno.h>",
            "#include <linux/string.h>",
            "#include <linux/slab.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void __nilfs_btree_init(struct nilfs_bmap *bmap);",
            "static const struct nilfs_bmap_operations nilfs_btree_ops_gc = {\n\t.bop_lookup\t\t=\tNULL,\n\t.bop_lookup_contig\t=\tNULL,\n\t.bop_insert\t\t=\tNULL,\n\t.bop_delete\t\t=\tNULL,\n\t.bop_clear\t\t=\tNULL,\n\n\t.bop_propagate\t\t=\tnilfs_btree_propagate_gc,\n\n\t.bop_lookup_dirty_buffers =\tnilfs_btree_lookup_dirty_buffers,\n\n\t.bop_assign\t\t=\tnilfs_btree_assign_gc,\n\t.bop_mark\t\t=\tNULL,\n\n\t.bop_last_key\t\t=\tNULL,\n\t.bop_check_insert\t=\tNULL,\n\t.bop_check_delete\t=\tNULL,\n\t.bop_gather_data\t=\tNULL,\n};"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"dat.h\"\n#include \"alloc.h\"\n#include \"btree.h\"\n#include \"btnode.h\"\n#include \"page.h\"\n#include \"nilfs.h\"\n#include <linux/pagevec.h>\n#include <linux/errno.h>\n#include <linux/string.h>\n#include <linux/slab.h>\n\nstatic void __nilfs_btree_init(struct nilfs_bmap *bmap);\nstatic const struct nilfs_bmap_operations nilfs_btree_ops_gc = {\n\t.bop_lookup\t\t=\tNULL,\n\t.bop_lookup_contig\t=\tNULL,\n\t.bop_insert\t\t=\tNULL,\n\t.bop_delete\t\t=\tNULL,\n\t.bop_clear\t\t=\tNULL,\n\n\t.bop_propagate\t\t=\tnilfs_btree_propagate_gc,\n\n\t.bop_lookup_dirty_buffers =\tnilfs_btree_lookup_dirty_buffers,\n\n\t.bop_assign\t\t=\tnilfs_btree_assign_gc,\n\t.bop_mark\t\t=\tNULL,\n\n\t.bop_last_key\t\t=\tNULL,\n\t.bop_check_insert\t=\tNULL,\n\t.bop_check_delete\t=\tNULL,\n\t.bop_gather_data\t=\tNULL,\n};\n\nvoid nilfs_btree_init_gc(struct nilfs_bmap *bmap)\n{\n\tbmap->b_ops = &nilfs_btree_ops_gc;\n\tbmap->b_nchildren_per_block =\n\t\tNILFS_BTREE_NODE_NCHILDREN_MAX(nilfs_btree_node_size(bmap));\n}"
        }
      },
      {
        "call_info": {
          "callee": "NILFS_BMAP_I",
          "args": [
            "bmap"
          ],
          "line": 543
        },
        "resolved": true,
        "details": {
          "function_name": "NILFS_BMAP_I",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/nilfs.h",
          "lines": "83-87",
          "snippet": "static inline struct nilfs_inode_info *\nNILFS_BMAP_I(const struct nilfs_bmap *bmap)\n{\n\treturn container_of(bmap, struct nilfs_inode_info, i_bmap_data);\n}",
          "includes": [
            "#include \"bmap.h\"",
            "#include \"the_nilfs.h\"",
            "#include <linux/nilfs2_fs.h>",
            "#include <linux/blkdev.h>",
            "#include <linux/spinlock.h>",
            "#include <linux/buffer_head.h>",
            "#include <linux/kernel.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"bmap.h\"\n#include \"the_nilfs.h\"\n#include <linux/nilfs2_fs.h>\n#include <linux/blkdev.h>\n#include <linux/spinlock.h>\n#include <linux/buffer_head.h>\n#include <linux/kernel.h>\n\nstatic inline struct nilfs_inode_info *\nNILFS_BMAP_I(const struct nilfs_bmap *bmap)\n{\n\treturn container_of(bmap, struct nilfs_inode_info, i_bmap_data);\n}"
        }
      },
      {
        "call_info": {
          "callee": "init_rwsem",
          "args": [
            "&bmap->b_sem"
          ],
          "line": 542
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memset",
          "args": [
            "&bmap->b_u",
            "0",
            "NILFS_BMAP_SIZE"
          ],
          "line": 541
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"alloc.h\"\n#include \"dat.h\"\n#include \"mdt.h\"\n#include \"btnode.h\"\n#include \"direct.h\"\n#include \"btree.h\"\n#include \"bmap.h\"\n#include \"nilfs.h\"\n#include <linux/errno.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n\nvoid nilfs_bmap_init_gc(struct nilfs_bmap *bmap)\n{\n\tmemset(&bmap->b_u, 0, NILFS_BMAP_SIZE);\n\tinit_rwsem(&bmap->b_sem);\n\tbmap->b_inode = &NILFS_BMAP_I(bmap)->vfs_inode;\n\tbmap->b_ptr_type = NILFS_BMAP_PTR_U;\n\tbmap->b_last_allocated_key = 0;\n\tbmap->b_last_allocated_ptr = NILFS_BMAP_INVALID_PTR;\n\tbmap->b_state = 0;\n\tnilfs_btree_init_gc(bmap);\n}"
  },
  {
    "function_name": "nilfs_bmap_write",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/bmap.c",
    "lines": "528-537",
    "snippet": "void nilfs_bmap_write(struct nilfs_bmap *bmap, struct nilfs_inode *raw_inode)\n{\n\tdown_write(&bmap->b_sem);\n\tmemcpy(raw_inode->i_bmap, bmap->b_u.u_data,\n\t       NILFS_INODE_BMAP_SIZE * sizeof(__le64));\n\tif (bmap->b_inode->i_ino == NILFS_DAT_INO)\n\t\tbmap->b_last_allocated_ptr = NILFS_BMAP_NEW_PTR_INIT;\n\n\tup_write(&bmap->b_sem);\n}",
    "includes": [
      "#include \"alloc.h\"",
      "#include \"dat.h\"",
      "#include \"mdt.h\"",
      "#include \"btnode.h\"",
      "#include \"direct.h\"",
      "#include \"btree.h\"",
      "#include \"bmap.h\"",
      "#include \"nilfs.h\"",
      "#include <linux/errno.h>",
      "#include <linux/string.h>",
      "#include <linux/fs.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "up_write",
          "args": [
            "&bmap->b_sem"
          ],
          "line": 536
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memcpy",
          "args": [
            "raw_inode->i_bmap",
            "bmap->b_u.u_data",
            "NILFS_INODE_BMAP_SIZE * sizeof(__le64)"
          ],
          "line": 531
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "down_write",
          "args": [
            "&bmap->b_sem"
          ],
          "line": 530
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"alloc.h\"\n#include \"dat.h\"\n#include \"mdt.h\"\n#include \"btnode.h\"\n#include \"direct.h\"\n#include \"btree.h\"\n#include \"bmap.h\"\n#include \"nilfs.h\"\n#include <linux/errno.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n\nvoid nilfs_bmap_write(struct nilfs_bmap *bmap, struct nilfs_inode *raw_inode)\n{\n\tdown_write(&bmap->b_sem);\n\tmemcpy(raw_inode->i_bmap, bmap->b_u.u_data,\n\t       NILFS_INODE_BMAP_SIZE * sizeof(__le64));\n\tif (bmap->b_inode->i_ino == NILFS_DAT_INO)\n\t\tbmap->b_last_allocated_ptr = NILFS_BMAP_NEW_PTR_INIT;\n\n\tup_write(&bmap->b_sem);\n}"
  },
  {
    "function_name": "nilfs_bmap_read",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/bmap.c",
    "lines": "483-519",
    "snippet": "int nilfs_bmap_read(struct nilfs_bmap *bmap, struct nilfs_inode *raw_inode)\n{\n\tif (raw_inode == NULL)\n\t\tmemset(bmap->b_u.u_data, 0, NILFS_BMAP_SIZE);\n\telse\n\t\tmemcpy(bmap->b_u.u_data, raw_inode->i_bmap, NILFS_BMAP_SIZE);\n\n\tinit_rwsem(&bmap->b_sem);\n\tbmap->b_state = 0;\n\tbmap->b_inode = &NILFS_BMAP_I(bmap)->vfs_inode;\n\tswitch (bmap->b_inode->i_ino) {\n\tcase NILFS_DAT_INO:\n\t\tbmap->b_ptr_type = NILFS_BMAP_PTR_P;\n\t\tbmap->b_last_allocated_key = 0;\n\t\tbmap->b_last_allocated_ptr = NILFS_BMAP_NEW_PTR_INIT;\n\t\tlockdep_set_class(&bmap->b_sem, &nilfs_bmap_dat_lock_key);\n\t\tbreak;\n\tcase NILFS_CPFILE_INO:\n\tcase NILFS_SUFILE_INO:\n\t\tbmap->b_ptr_type = NILFS_BMAP_PTR_VS;\n\t\tbmap->b_last_allocated_key = 0;\n\t\tbmap->b_last_allocated_ptr = NILFS_BMAP_INVALID_PTR;\n\t\tlockdep_set_class(&bmap->b_sem, &nilfs_bmap_mdt_lock_key);\n\t\tbreak;\n\tcase NILFS_IFILE_INO:\n\t\tlockdep_set_class(&bmap->b_sem, &nilfs_bmap_mdt_lock_key);\n\t\t/* Fall through */\n\tdefault:\n\t\tbmap->b_ptr_type = NILFS_BMAP_PTR_VM;\n\t\tbmap->b_last_allocated_key = 0;\n\t\tbmap->b_last_allocated_ptr = NILFS_BMAP_INVALID_PTR;\n\t\tbreak;\n\t}\n\n\treturn (bmap->b_u.u_flags & NILFS_BMAP_LARGE) ?\n\t\tnilfs_btree_init(bmap) : nilfs_direct_init(bmap);\n}",
    "includes": [
      "#include \"alloc.h\"",
      "#include \"dat.h\"",
      "#include \"mdt.h\"",
      "#include \"btnode.h\"",
      "#include \"direct.h\"",
      "#include \"btree.h\"",
      "#include \"bmap.h\"",
      "#include \"nilfs.h\"",
      "#include <linux/errno.h>",
      "#include <linux/string.h>",
      "#include <linux/fs.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static struct lock_class_key nilfs_bmap_dat_lock_key;",
      "static struct lock_class_key nilfs_bmap_mdt_lock_key;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "nilfs_direct_init",
          "args": [
            "bmap"
          ],
          "line": 518
        },
        "resolved": true,
        "details": {
          "function_name": "nilfs_direct_init",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/direct.c",
          "lines": "365-369",
          "snippet": "int nilfs_direct_init(struct nilfs_bmap *bmap)\n{\n\tbmap->b_ops = &nilfs_direct_ops;\n\treturn 0;\n}",
          "includes": [
            "#include \"dat.h\"",
            "#include \"alloc.h\"",
            "#include \"direct.h\"",
            "#include \"page.h\"",
            "#include \"nilfs.h\"",
            "#include <linux/errno.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static const struct nilfs_bmap_operations nilfs_direct_ops = {\n\t.bop_lookup\t\t=\tnilfs_direct_lookup,\n\t.bop_lookup_contig\t=\tnilfs_direct_lookup_contig,\n\t.bop_insert\t\t=\tnilfs_direct_insert,\n\t.bop_delete\t\t=\tnilfs_direct_delete,\n\t.bop_clear\t\t=\tNULL,\n\n\t.bop_propagate\t\t=\tnilfs_direct_propagate,\n\n\t.bop_lookup_dirty_buffers\t=\tNULL,\n\n\t.bop_assign\t\t=\tnilfs_direct_assign,\n\t.bop_mark\t\t=\tNULL,\n\n\t.bop_last_key\t\t=\tnilfs_direct_last_key,\n\t.bop_check_insert\t=\tnilfs_direct_check_insert,\n\t.bop_check_delete\t=\tNULL,\n\t.bop_gather_data\t=\tnilfs_direct_gather_data,\n};"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"dat.h\"\n#include \"alloc.h\"\n#include \"direct.h\"\n#include \"page.h\"\n#include \"nilfs.h\"\n#include <linux/errno.h>\n\nstatic const struct nilfs_bmap_operations nilfs_direct_ops = {\n\t.bop_lookup\t\t=\tnilfs_direct_lookup,\n\t.bop_lookup_contig\t=\tnilfs_direct_lookup_contig,\n\t.bop_insert\t\t=\tnilfs_direct_insert,\n\t.bop_delete\t\t=\tnilfs_direct_delete,\n\t.bop_clear\t\t=\tNULL,\n\n\t.bop_propagate\t\t=\tnilfs_direct_propagate,\n\n\t.bop_lookup_dirty_buffers\t=\tNULL,\n\n\t.bop_assign\t\t=\tnilfs_direct_assign,\n\t.bop_mark\t\t=\tNULL,\n\n\t.bop_last_key\t\t=\tnilfs_direct_last_key,\n\t.bop_check_insert\t=\tnilfs_direct_check_insert,\n\t.bop_check_delete\t=\tNULL,\n\t.bop_gather_data\t=\tnilfs_direct_gather_data,\n};\n\nint nilfs_direct_init(struct nilfs_bmap *bmap)\n{\n\tbmap->b_ops = &nilfs_direct_ops;\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "nilfs_btree_init",
          "args": [
            "bmap"
          ],
          "line": 518
        },
        "resolved": true,
        "details": {
          "function_name": "nilfs_btree_init_gc",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/btree.c",
          "lines": "2346-2351",
          "snippet": "void nilfs_btree_init_gc(struct nilfs_bmap *bmap)\n{\n\tbmap->b_ops = &nilfs_btree_ops_gc;\n\tbmap->b_nchildren_per_block =\n\t\tNILFS_BTREE_NODE_NCHILDREN_MAX(nilfs_btree_node_size(bmap));\n}",
          "includes": [
            "#include \"dat.h\"",
            "#include \"alloc.h\"",
            "#include \"btree.h\"",
            "#include \"btnode.h\"",
            "#include \"page.h\"",
            "#include \"nilfs.h\"",
            "#include <linux/pagevec.h>",
            "#include <linux/errno.h>",
            "#include <linux/string.h>",
            "#include <linux/slab.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void __nilfs_btree_init(struct nilfs_bmap *bmap);",
            "static const struct nilfs_bmap_operations nilfs_btree_ops_gc = {\n\t.bop_lookup\t\t=\tNULL,\n\t.bop_lookup_contig\t=\tNULL,\n\t.bop_insert\t\t=\tNULL,\n\t.bop_delete\t\t=\tNULL,\n\t.bop_clear\t\t=\tNULL,\n\n\t.bop_propagate\t\t=\tnilfs_btree_propagate_gc,\n\n\t.bop_lookup_dirty_buffers =\tnilfs_btree_lookup_dirty_buffers,\n\n\t.bop_assign\t\t=\tnilfs_btree_assign_gc,\n\t.bop_mark\t\t=\tNULL,\n\n\t.bop_last_key\t\t=\tNULL,\n\t.bop_check_insert\t=\tNULL,\n\t.bop_check_delete\t=\tNULL,\n\t.bop_gather_data\t=\tNULL,\n};"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"dat.h\"\n#include \"alloc.h\"\n#include \"btree.h\"\n#include \"btnode.h\"\n#include \"page.h\"\n#include \"nilfs.h\"\n#include <linux/pagevec.h>\n#include <linux/errno.h>\n#include <linux/string.h>\n#include <linux/slab.h>\n\nstatic void __nilfs_btree_init(struct nilfs_bmap *bmap);\nstatic const struct nilfs_bmap_operations nilfs_btree_ops_gc = {\n\t.bop_lookup\t\t=\tNULL,\n\t.bop_lookup_contig\t=\tNULL,\n\t.bop_insert\t\t=\tNULL,\n\t.bop_delete\t\t=\tNULL,\n\t.bop_clear\t\t=\tNULL,\n\n\t.bop_propagate\t\t=\tnilfs_btree_propagate_gc,\n\n\t.bop_lookup_dirty_buffers =\tnilfs_btree_lookup_dirty_buffers,\n\n\t.bop_assign\t\t=\tnilfs_btree_assign_gc,\n\t.bop_mark\t\t=\tNULL,\n\n\t.bop_last_key\t\t=\tNULL,\n\t.bop_check_insert\t=\tNULL,\n\t.bop_check_delete\t=\tNULL,\n\t.bop_gather_data\t=\tNULL,\n};\n\nvoid nilfs_btree_init_gc(struct nilfs_bmap *bmap)\n{\n\tbmap->b_ops = &nilfs_btree_ops_gc;\n\tbmap->b_nchildren_per_block =\n\t\tNILFS_BTREE_NODE_NCHILDREN_MAX(nilfs_btree_node_size(bmap));\n}"
        }
      },
      {
        "call_info": {
          "callee": "lockdep_set_class",
          "args": [
            "&bmap->b_sem",
            "&nilfs_bmap_mdt_lock_key"
          ],
          "line": 508
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lockdep_set_class",
          "args": [
            "&bmap->b_sem",
            "&nilfs_bmap_mdt_lock_key"
          ],
          "line": 505
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lockdep_set_class",
          "args": [
            "&bmap->b_sem",
            "&nilfs_bmap_dat_lock_key"
          ],
          "line": 498
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "NILFS_BMAP_I",
          "args": [
            "bmap"
          ],
          "line": 492
        },
        "resolved": true,
        "details": {
          "function_name": "NILFS_BMAP_I",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/nilfs.h",
          "lines": "83-87",
          "snippet": "static inline struct nilfs_inode_info *\nNILFS_BMAP_I(const struct nilfs_bmap *bmap)\n{\n\treturn container_of(bmap, struct nilfs_inode_info, i_bmap_data);\n}",
          "includes": [
            "#include \"bmap.h\"",
            "#include \"the_nilfs.h\"",
            "#include <linux/nilfs2_fs.h>",
            "#include <linux/blkdev.h>",
            "#include <linux/spinlock.h>",
            "#include <linux/buffer_head.h>",
            "#include <linux/kernel.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"bmap.h\"\n#include \"the_nilfs.h\"\n#include <linux/nilfs2_fs.h>\n#include <linux/blkdev.h>\n#include <linux/spinlock.h>\n#include <linux/buffer_head.h>\n#include <linux/kernel.h>\n\nstatic inline struct nilfs_inode_info *\nNILFS_BMAP_I(const struct nilfs_bmap *bmap)\n{\n\treturn container_of(bmap, struct nilfs_inode_info, i_bmap_data);\n}"
        }
      },
      {
        "call_info": {
          "callee": "init_rwsem",
          "args": [
            "&bmap->b_sem"
          ],
          "line": 490
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memcpy",
          "args": [
            "bmap->b_u.u_data",
            "raw_inode->i_bmap",
            "NILFS_BMAP_SIZE"
          ],
          "line": 488
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memset",
          "args": [
            "bmap->b_u.u_data",
            "0",
            "NILFS_BMAP_SIZE"
          ],
          "line": 486
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"alloc.h\"\n#include \"dat.h\"\n#include \"mdt.h\"\n#include \"btnode.h\"\n#include \"direct.h\"\n#include \"btree.h\"\n#include \"bmap.h\"\n#include \"nilfs.h\"\n#include <linux/errno.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n\nstatic struct lock_class_key nilfs_bmap_dat_lock_key;\nstatic struct lock_class_key nilfs_bmap_mdt_lock_key;\n\nint nilfs_bmap_read(struct nilfs_bmap *bmap, struct nilfs_inode *raw_inode)\n{\n\tif (raw_inode == NULL)\n\t\tmemset(bmap->b_u.u_data, 0, NILFS_BMAP_SIZE);\n\telse\n\t\tmemcpy(bmap->b_u.u_data, raw_inode->i_bmap, NILFS_BMAP_SIZE);\n\n\tinit_rwsem(&bmap->b_sem);\n\tbmap->b_state = 0;\n\tbmap->b_inode = &NILFS_BMAP_I(bmap)->vfs_inode;\n\tswitch (bmap->b_inode->i_ino) {\n\tcase NILFS_DAT_INO:\n\t\tbmap->b_ptr_type = NILFS_BMAP_PTR_P;\n\t\tbmap->b_last_allocated_key = 0;\n\t\tbmap->b_last_allocated_ptr = NILFS_BMAP_NEW_PTR_INIT;\n\t\tlockdep_set_class(&bmap->b_sem, &nilfs_bmap_dat_lock_key);\n\t\tbreak;\n\tcase NILFS_CPFILE_INO:\n\tcase NILFS_SUFILE_INO:\n\t\tbmap->b_ptr_type = NILFS_BMAP_PTR_VS;\n\t\tbmap->b_last_allocated_key = 0;\n\t\tbmap->b_last_allocated_ptr = NILFS_BMAP_INVALID_PTR;\n\t\tlockdep_set_class(&bmap->b_sem, &nilfs_bmap_mdt_lock_key);\n\t\tbreak;\n\tcase NILFS_IFILE_INO:\n\t\tlockdep_set_class(&bmap->b_sem, &nilfs_bmap_mdt_lock_key);\n\t\t/* Fall through */\n\tdefault:\n\t\tbmap->b_ptr_type = NILFS_BMAP_PTR_VM;\n\t\tbmap->b_last_allocated_key = 0;\n\t\tbmap->b_last_allocated_ptr = NILFS_BMAP_INVALID_PTR;\n\t\tbreak;\n\t}\n\n\treturn (bmap->b_u.u_flags & NILFS_BMAP_LARGE) ?\n\t\tnilfs_btree_init(bmap) : nilfs_direct_init(bmap);\n}"
  },
  {
    "function_name": "nilfs_bmap_find_target_in_group",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/bmap.c",
    "lines": "457-466",
    "snippet": "__u64 nilfs_bmap_find_target_in_group(const struct nilfs_bmap *bmap)\n{\n\tstruct inode *dat = nilfs_bmap_get_dat(bmap);\n\tunsigned long entries_per_group = nilfs_palloc_entries_per_group(dat);\n\tunsigned long group = bmap->b_inode->i_ino / entries_per_group;\n\n\treturn group * entries_per_group +\n\t\t(bmap->b_inode->i_ino % NILFS_BMAP_GROUP_DIV) *\n\t\t(entries_per_group / NILFS_BMAP_GROUP_DIV);\n}",
    "includes": [
      "#include \"alloc.h\"",
      "#include \"dat.h\"",
      "#include \"mdt.h\"",
      "#include \"btnode.h\"",
      "#include \"direct.h\"",
      "#include \"btree.h\"",
      "#include \"bmap.h\"",
      "#include \"nilfs.h\"",
      "#include <linux/errno.h>",
      "#include <linux/string.h>",
      "#include <linux/fs.h>"
    ],
    "macros_used": [
      "#define NILFS_BMAP_GROUP_DIV\t8"
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "nilfs_palloc_entries_per_group",
          "args": [
            "dat"
          ],
          "line": 460
        },
        "resolved": true,
        "details": {
          "function_name": "nilfs_palloc_entries_per_group",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/alloc.h",
          "lines": "39-43",
          "snippet": "static inline unsigned long\nnilfs_palloc_entries_per_group(const struct inode *inode)\n{\n\treturn 1UL << (inode->i_blkbits + 3 /* log2(8 = CHAR_BITS) */);\n}",
          "includes": [
            "#include <linux/fs.h>",
            "#include <linux/buffer_head.h>",
            "#include <linux/types.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/fs.h>\n#include <linux/buffer_head.h>\n#include <linux/types.h>\n\nstatic inline unsigned long\nnilfs_palloc_entries_per_group(const struct inode *inode)\n{\n\treturn 1UL << (inode->i_blkbits + 3 /* log2(8 = CHAR_BITS) */);\n}"
        }
      },
      {
        "call_info": {
          "callee": "nilfs_bmap_get_dat",
          "args": [
            "bmap"
          ],
          "line": 459
        },
        "resolved": true,
        "details": {
          "function_name": "nilfs_bmap_get_dat",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/bmap.c",
          "lines": "35-40",
          "snippet": "struct inode *nilfs_bmap_get_dat(const struct nilfs_bmap *bmap)\n{\n\tstruct the_nilfs *nilfs = bmap->b_inode->i_sb->s_fs_info;\n\n\treturn nilfs->ns_dat;\n}",
          "includes": [
            "#include \"alloc.h\"",
            "#include \"dat.h\"",
            "#include \"mdt.h\"",
            "#include \"btnode.h\"",
            "#include \"direct.h\"",
            "#include \"btree.h\"",
            "#include \"bmap.h\"",
            "#include \"nilfs.h\"",
            "#include <linux/errno.h>",
            "#include <linux/string.h>",
            "#include <linux/fs.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"alloc.h\"\n#include \"dat.h\"\n#include \"mdt.h\"\n#include \"btnode.h\"\n#include \"direct.h\"\n#include \"btree.h\"\n#include \"bmap.h\"\n#include \"nilfs.h\"\n#include <linux/errno.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n\nstruct inode *nilfs_bmap_get_dat(const struct nilfs_bmap *bmap)\n{\n\tstruct the_nilfs *nilfs = bmap->b_inode->i_sb->s_fs_info;\n\n\treturn nilfs->ns_dat;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"alloc.h\"\n#include \"dat.h\"\n#include \"mdt.h\"\n#include \"btnode.h\"\n#include \"direct.h\"\n#include \"btree.h\"\n#include \"bmap.h\"\n#include \"nilfs.h\"\n#include <linux/errno.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n\n#define NILFS_BMAP_GROUP_DIV\t8\n\n__u64 nilfs_bmap_find_target_in_group(const struct nilfs_bmap *bmap)\n{\n\tstruct inode *dat = nilfs_bmap_get_dat(bmap);\n\tunsigned long entries_per_group = nilfs_palloc_entries_per_group(dat);\n\tunsigned long group = bmap->b_inode->i_ino / entries_per_group;\n\n\treturn group * entries_per_group +\n\t\t(bmap->b_inode->i_ino % NILFS_BMAP_GROUP_DIV) *\n\t\t(entries_per_group / NILFS_BMAP_GROUP_DIV);\n}"
  },
  {
    "function_name": "nilfs_bmap_find_target_seq",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/bmap.c",
    "lines": "443-454",
    "snippet": "__u64 nilfs_bmap_find_target_seq(const struct nilfs_bmap *bmap, __u64 key)\n{\n\t__s64 diff;\n\n\tdiff = key - bmap->b_last_allocated_key;\n\tif ((nilfs_bmap_keydiff_abs(diff) < NILFS_INODE_BMAP_SIZE) &&\n\t    (bmap->b_last_allocated_ptr != NILFS_BMAP_INVALID_PTR) &&\n\t    (bmap->b_last_allocated_ptr + diff > 0))\n\t\treturn bmap->b_last_allocated_ptr + diff;\n\telse\n\t\treturn NILFS_BMAP_INVALID_PTR;\n}",
    "includes": [
      "#include \"alloc.h\"",
      "#include \"dat.h\"",
      "#include \"mdt.h\"",
      "#include \"btnode.h\"",
      "#include \"direct.h\"",
      "#include \"btree.h\"",
      "#include \"bmap.h\"",
      "#include \"nilfs.h\"",
      "#include <linux/errno.h>",
      "#include <linux/string.h>",
      "#include <linux/fs.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "nilfs_bmap_keydiff_abs",
          "args": [
            "diff"
          ],
          "line": 448
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"alloc.h\"\n#include \"dat.h\"\n#include \"mdt.h\"\n#include \"btnode.h\"\n#include \"direct.h\"\n#include \"btree.h\"\n#include \"bmap.h\"\n#include \"nilfs.h\"\n#include <linux/errno.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n\n__u64 nilfs_bmap_find_target_seq(const struct nilfs_bmap *bmap, __u64 key)\n{\n\t__s64 diff;\n\n\tdiff = key - bmap->b_last_allocated_key;\n\tif ((nilfs_bmap_keydiff_abs(diff) < NILFS_INODE_BMAP_SIZE) &&\n\t    (bmap->b_last_allocated_ptr != NILFS_BMAP_INVALID_PTR) &&\n\t    (bmap->b_last_allocated_ptr + diff > 0))\n\t\treturn bmap->b_last_allocated_ptr + diff;\n\telse\n\t\treturn NILFS_BMAP_INVALID_PTR;\n}"
  },
  {
    "function_name": "nilfs_bmap_data_get_key",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/bmap.c",
    "lines": "429-441",
    "snippet": "__u64 nilfs_bmap_data_get_key(const struct nilfs_bmap *bmap,\n\t\t\t      const struct buffer_head *bh)\n{\n\tstruct buffer_head *pbh;\n\t__u64 key;\n\n\tkey = page_index(bh->b_page) << (PAGE_CACHE_SHIFT -\n\t\t\t\t\t bmap->b_inode->i_blkbits);\n\tfor (pbh = page_buffers(bh->b_page); pbh != bh; pbh = pbh->b_this_page)\n\t\tkey++;\n\n\treturn key;\n}",
    "includes": [
      "#include \"alloc.h\"",
      "#include \"dat.h\"",
      "#include \"mdt.h\"",
      "#include \"btnode.h\"",
      "#include \"direct.h\"",
      "#include \"btree.h\"",
      "#include \"bmap.h\"",
      "#include \"nilfs.h\"",
      "#include <linux/errno.h>",
      "#include <linux/string.h>",
      "#include <linux/fs.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "page_buffers",
          "args": [
            "bh->b_page"
          ],
          "line": 437
        },
        "resolved": true,
        "details": {
          "function_name": "nilfs_page_buffers_clean",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/page.c",
          "lines": "157-168",
          "snippet": "int nilfs_page_buffers_clean(struct page *page)\n{\n\tstruct buffer_head *bh, *head;\n\n\tbh = head = page_buffers(page);\n\tdo {\n\t\tif (buffer_dirty(bh))\n\t\t\treturn 0;\n\t\tbh = bh->b_this_page;\n\t} while (bh != head);\n\treturn 1;\n}",
          "includes": [
            "#include \"mdt.h\"",
            "#include \"page.h\"",
            "#include \"nilfs.h\"",
            "#include <linux/gfp.h>",
            "#include <linux/pagevec.h>",
            "#include <linux/highmem.h>",
            "#include <linux/list.h>",
            "#include <linux/page-flags.h>",
            "#include <linux/bitops.h>",
            "#include <linux/swap.h>",
            "#include <linux/writeback.h>",
            "#include <linux/pagemap.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"mdt.h\"\n#include \"page.h\"\n#include \"nilfs.h\"\n#include <linux/gfp.h>\n#include <linux/pagevec.h>\n#include <linux/highmem.h>\n#include <linux/list.h>\n#include <linux/page-flags.h>\n#include <linux/bitops.h>\n#include <linux/swap.h>\n#include <linux/writeback.h>\n#include <linux/pagemap.h>\n\nint nilfs_page_buffers_clean(struct page *page)\n{\n\tstruct buffer_head *bh, *head;\n\n\tbh = head = page_buffers(page);\n\tdo {\n\t\tif (buffer_dirty(bh))\n\t\t\treturn 0;\n\t\tbh = bh->b_this_page;\n\t} while (bh != head);\n\treturn 1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "page_index",
          "args": [
            "bh->b_page"
          ],
          "line": 435
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"alloc.h\"\n#include \"dat.h\"\n#include \"mdt.h\"\n#include \"btnode.h\"\n#include \"direct.h\"\n#include \"btree.h\"\n#include \"bmap.h\"\n#include \"nilfs.h\"\n#include <linux/errno.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n\n__u64 nilfs_bmap_data_get_key(const struct nilfs_bmap *bmap,\n\t\t\t      const struct buffer_head *bh)\n{\n\tstruct buffer_head *pbh;\n\t__u64 key;\n\n\tkey = page_index(bh->b_page) << (PAGE_CACHE_SHIFT -\n\t\t\t\t\t bmap->b_inode->i_blkbits);\n\tfor (pbh = page_buffers(bh->b_page); pbh != bh; pbh = pbh->b_this_page)\n\t\tkey++;\n\n\treturn key;\n}"
  },
  {
    "function_name": "nilfs_bmap_test_and_clear_dirty",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/bmap.c",
    "lines": "414-423",
    "snippet": "int nilfs_bmap_test_and_clear_dirty(struct nilfs_bmap *bmap)\n{\n\tint ret;\n\n\tdown_write(&bmap->b_sem);\n\tret = nilfs_bmap_dirty(bmap);\n\tnilfs_bmap_clear_dirty(bmap);\n\tup_write(&bmap->b_sem);\n\treturn ret;\n}",
    "includes": [
      "#include \"alloc.h\"",
      "#include \"dat.h\"",
      "#include \"mdt.h\"",
      "#include \"btnode.h\"",
      "#include \"direct.h\"",
      "#include \"btree.h\"",
      "#include \"bmap.h\"",
      "#include \"nilfs.h\"",
      "#include <linux/errno.h>",
      "#include <linux/string.h>",
      "#include <linux/fs.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "up_write",
          "args": [
            "&bmap->b_sem"
          ],
          "line": 421
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "nilfs_bmap_clear_dirty",
          "args": [
            "bmap"
          ],
          "line": 420
        },
        "resolved": true,
        "details": {
          "function_name": "nilfs_bmap_clear_dirty",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/bmap.h",
          "lines": "264-267",
          "snippet": "static inline void nilfs_bmap_clear_dirty(struct nilfs_bmap *bmap)\n{\n\tbmap->b_state &= ~NILFS_BMAP_DIRTY;\n}",
          "includes": [
            "#include \"dat.h\"",
            "#include \"alloc.h\"",
            "#include <linux/nilfs2_fs.h>",
            "#include <linux/buffer_head.h>",
            "#include <linux/fs.h>",
            "#include <linux/types.h>"
          ],
          "macros_used": [
            "#define NILFS_BMAP_DIRTY\t0x00000001"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"dat.h\"\n#include \"alloc.h\"\n#include <linux/nilfs2_fs.h>\n#include <linux/buffer_head.h>\n#include <linux/fs.h>\n#include <linux/types.h>\n\n#define NILFS_BMAP_DIRTY\t0x00000001\n\nstatic inline void nilfs_bmap_clear_dirty(struct nilfs_bmap *bmap)\n{\n\tbmap->b_state &= ~NILFS_BMAP_DIRTY;\n}"
        }
      },
      {
        "call_info": {
          "callee": "nilfs_bmap_dirty",
          "args": [
            "bmap"
          ],
          "line": 419
        },
        "resolved": true,
        "details": {
          "function_name": "nilfs_bmap_dirty",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/bmap.h",
          "lines": "252-255",
          "snippet": "static inline int nilfs_bmap_dirty(const struct nilfs_bmap *bmap)\n{\n\treturn !!(bmap->b_state & NILFS_BMAP_DIRTY);\n}",
          "includes": [
            "#include \"dat.h\"",
            "#include \"alloc.h\"",
            "#include <linux/nilfs2_fs.h>",
            "#include <linux/buffer_head.h>",
            "#include <linux/fs.h>",
            "#include <linux/types.h>"
          ],
          "macros_used": [
            "#define NILFS_BMAP_DIRTY\t0x00000001"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"dat.h\"\n#include \"alloc.h\"\n#include <linux/nilfs2_fs.h>\n#include <linux/buffer_head.h>\n#include <linux/fs.h>\n#include <linux/types.h>\n\n#define NILFS_BMAP_DIRTY\t0x00000001\n\nstatic inline int nilfs_bmap_dirty(const struct nilfs_bmap *bmap)\n{\n\treturn !!(bmap->b_state & NILFS_BMAP_DIRTY);\n}"
        }
      },
      {
        "call_info": {
          "callee": "down_write",
          "args": [
            "&bmap->b_sem"
          ],
          "line": 418
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"alloc.h\"\n#include \"dat.h\"\n#include \"mdt.h\"\n#include \"btnode.h\"\n#include \"direct.h\"\n#include \"btree.h\"\n#include \"bmap.h\"\n#include \"nilfs.h\"\n#include <linux/errno.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n\nint nilfs_bmap_test_and_clear_dirty(struct nilfs_bmap *bmap)\n{\n\tint ret;\n\n\tdown_write(&bmap->b_sem);\n\tret = nilfs_bmap_dirty(bmap);\n\tnilfs_bmap_clear_dirty(bmap);\n\tup_write(&bmap->b_sem);\n\treturn ret;\n}"
  },
  {
    "function_name": "nilfs_bmap_mark",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/bmap.c",
    "lines": "391-403",
    "snippet": "int nilfs_bmap_mark(struct nilfs_bmap *bmap, __u64 key, int level)\n{\n\tint ret;\n\n\tif (bmap->b_ops->bop_mark == NULL)\n\t\treturn 0;\n\n\tdown_write(&bmap->b_sem);\n\tret = bmap->b_ops->bop_mark(bmap, key, level);\n\tup_write(&bmap->b_sem);\n\n\treturn nilfs_bmap_convert_error(bmap, __func__, ret);\n}",
    "includes": [
      "#include \"alloc.h\"",
      "#include \"dat.h\"",
      "#include \"mdt.h\"",
      "#include \"btnode.h\"",
      "#include \"direct.h\"",
      "#include \"btree.h\"",
      "#include \"bmap.h\"",
      "#include \"nilfs.h\"",
      "#include <linux/errno.h>",
      "#include <linux/string.h>",
      "#include <linux/fs.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "nilfs_bmap_convert_error",
          "args": [
            "bmap",
            "__func__",
            "ret"
          ],
          "line": 402
        },
        "resolved": true,
        "details": {
          "function_name": "nilfs_bmap_convert_error",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/bmap.c",
          "lines": "42-53",
          "snippet": "static int nilfs_bmap_convert_error(struct nilfs_bmap *bmap,\n\t\t\t\t     const char *fname, int err)\n{\n\tstruct inode *inode = bmap->b_inode;\n\n\tif (err == -EINVAL) {\n\t\tnilfs_error(inode->i_sb, fname,\n\t\t\t    \"broken bmap (inode number=%lu)\\n\", inode->i_ino);\n\t\terr = -EIO;\n\t}\n\treturn err;\n}",
          "includes": [
            "#include \"alloc.h\"",
            "#include \"dat.h\"",
            "#include \"mdt.h\"",
            "#include \"btnode.h\"",
            "#include \"direct.h\"",
            "#include \"btree.h\"",
            "#include \"bmap.h\"",
            "#include \"nilfs.h\"",
            "#include <linux/errno.h>",
            "#include <linux/string.h>",
            "#include <linux/fs.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"alloc.h\"\n#include \"dat.h\"\n#include \"mdt.h\"\n#include \"btnode.h\"\n#include \"direct.h\"\n#include \"btree.h\"\n#include \"bmap.h\"\n#include \"nilfs.h\"\n#include <linux/errno.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n\nstatic int nilfs_bmap_convert_error(struct nilfs_bmap *bmap,\n\t\t\t\t     const char *fname, int err)\n{\n\tstruct inode *inode = bmap->b_inode;\n\n\tif (err == -EINVAL) {\n\t\tnilfs_error(inode->i_sb, fname,\n\t\t\t    \"broken bmap (inode number=%lu)\\n\", inode->i_ino);\n\t\terr = -EIO;\n\t}\n\treturn err;\n}"
        }
      },
      {
        "call_info": {
          "callee": "up_write",
          "args": [
            "&bmap->b_sem"
          ],
          "line": 400
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bmap->b_ops->bop_mark",
          "args": [
            "bmap",
            "key",
            "level"
          ],
          "line": 399
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "down_write",
          "args": [
            "&bmap->b_sem"
          ],
          "line": 398
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"alloc.h\"\n#include \"dat.h\"\n#include \"mdt.h\"\n#include \"btnode.h\"\n#include \"direct.h\"\n#include \"btree.h\"\n#include \"bmap.h\"\n#include \"nilfs.h\"\n#include <linux/errno.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n\nint nilfs_bmap_mark(struct nilfs_bmap *bmap, __u64 key, int level)\n{\n\tint ret;\n\n\tif (bmap->b_ops->bop_mark == NULL)\n\t\treturn 0;\n\n\tdown_write(&bmap->b_sem);\n\tret = bmap->b_ops->bop_mark(bmap, key, level);\n\tup_write(&bmap->b_sem);\n\n\treturn nilfs_bmap_convert_error(bmap, __func__, ret);\n}"
  },
  {
    "function_name": "nilfs_bmap_assign",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/bmap.c",
    "lines": "361-373",
    "snippet": "int nilfs_bmap_assign(struct nilfs_bmap *bmap,\n\t\t      struct buffer_head **bh,\n\t\t      unsigned long blocknr,\n\t\t      union nilfs_binfo *binfo)\n{\n\tint ret;\n\n\tdown_write(&bmap->b_sem);\n\tret = bmap->b_ops->bop_assign(bmap, bh, blocknr, binfo);\n\tup_write(&bmap->b_sem);\n\n\treturn nilfs_bmap_convert_error(bmap, __func__, ret);\n}",
    "includes": [
      "#include \"alloc.h\"",
      "#include \"dat.h\"",
      "#include \"mdt.h\"",
      "#include \"btnode.h\"",
      "#include \"direct.h\"",
      "#include \"btree.h\"",
      "#include \"bmap.h\"",
      "#include \"nilfs.h\"",
      "#include <linux/errno.h>",
      "#include <linux/string.h>",
      "#include <linux/fs.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "nilfs_bmap_convert_error",
          "args": [
            "bmap",
            "__func__",
            "ret"
          ],
          "line": 372
        },
        "resolved": true,
        "details": {
          "function_name": "nilfs_bmap_convert_error",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/bmap.c",
          "lines": "42-53",
          "snippet": "static int nilfs_bmap_convert_error(struct nilfs_bmap *bmap,\n\t\t\t\t     const char *fname, int err)\n{\n\tstruct inode *inode = bmap->b_inode;\n\n\tif (err == -EINVAL) {\n\t\tnilfs_error(inode->i_sb, fname,\n\t\t\t    \"broken bmap (inode number=%lu)\\n\", inode->i_ino);\n\t\terr = -EIO;\n\t}\n\treturn err;\n}",
          "includes": [
            "#include \"alloc.h\"",
            "#include \"dat.h\"",
            "#include \"mdt.h\"",
            "#include \"btnode.h\"",
            "#include \"direct.h\"",
            "#include \"btree.h\"",
            "#include \"bmap.h\"",
            "#include \"nilfs.h\"",
            "#include <linux/errno.h>",
            "#include <linux/string.h>",
            "#include <linux/fs.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"alloc.h\"\n#include \"dat.h\"\n#include \"mdt.h\"\n#include \"btnode.h\"\n#include \"direct.h\"\n#include \"btree.h\"\n#include \"bmap.h\"\n#include \"nilfs.h\"\n#include <linux/errno.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n\nstatic int nilfs_bmap_convert_error(struct nilfs_bmap *bmap,\n\t\t\t\t     const char *fname, int err)\n{\n\tstruct inode *inode = bmap->b_inode;\n\n\tif (err == -EINVAL) {\n\t\tnilfs_error(inode->i_sb, fname,\n\t\t\t    \"broken bmap (inode number=%lu)\\n\", inode->i_ino);\n\t\terr = -EIO;\n\t}\n\treturn err;\n}"
        }
      },
      {
        "call_info": {
          "callee": "up_write",
          "args": [
            "&bmap->b_sem"
          ],
          "line": 370
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bmap->b_ops->bop_assign",
          "args": [
            "bmap",
            "bh",
            "blocknr",
            "binfo"
          ],
          "line": 369
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "down_write",
          "args": [
            "&bmap->b_sem"
          ],
          "line": 368
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"alloc.h\"\n#include \"dat.h\"\n#include \"mdt.h\"\n#include \"btnode.h\"\n#include \"direct.h\"\n#include \"btree.h\"\n#include \"bmap.h\"\n#include \"nilfs.h\"\n#include <linux/errno.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n\nint nilfs_bmap_assign(struct nilfs_bmap *bmap,\n\t\t      struct buffer_head **bh,\n\t\t      unsigned long blocknr,\n\t\t      union nilfs_binfo *binfo)\n{\n\tint ret;\n\n\tdown_write(&bmap->b_sem);\n\tret = bmap->b_ops->bop_assign(bmap, bh, blocknr, binfo);\n\tup_write(&bmap->b_sem);\n\n\treturn nilfs_bmap_convert_error(bmap, __func__, ret);\n}"
  },
  {
    "function_name": "nilfs_bmap_lookup_dirty_buffers",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/bmap.c",
    "lines": "335-340",
    "snippet": "void nilfs_bmap_lookup_dirty_buffers(struct nilfs_bmap *bmap,\n\t\t\t\t     struct list_head *listp)\n{\n\tif (bmap->b_ops->bop_lookup_dirty_buffers != NULL)\n\t\tbmap->b_ops->bop_lookup_dirty_buffers(bmap, listp);\n}",
    "includes": [
      "#include \"alloc.h\"",
      "#include \"dat.h\"",
      "#include \"mdt.h\"",
      "#include \"btnode.h\"",
      "#include \"direct.h\"",
      "#include \"btree.h\"",
      "#include \"bmap.h\"",
      "#include \"nilfs.h\"",
      "#include <linux/errno.h>",
      "#include <linux/string.h>",
      "#include <linux/fs.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "bmap->b_ops->bop_lookup_dirty_buffers",
          "args": [
            "bmap",
            "listp"
          ],
          "line": 339
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"alloc.h\"\n#include \"dat.h\"\n#include \"mdt.h\"\n#include \"btnode.h\"\n#include \"direct.h\"\n#include \"btree.h\"\n#include \"bmap.h\"\n#include \"nilfs.h\"\n#include <linux/errno.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n\nvoid nilfs_bmap_lookup_dirty_buffers(struct nilfs_bmap *bmap,\n\t\t\t\t     struct list_head *listp)\n{\n\tif (bmap->b_ops->bop_lookup_dirty_buffers != NULL)\n\t\tbmap->b_ops->bop_lookup_dirty_buffers(bmap, listp);\n}"
  },
  {
    "function_name": "nilfs_bmap_propagate",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/bmap.c",
    "lines": "319-328",
    "snippet": "int nilfs_bmap_propagate(struct nilfs_bmap *bmap, struct buffer_head *bh)\n{\n\tint ret;\n\n\tdown_write(&bmap->b_sem);\n\tret = bmap->b_ops->bop_propagate(bmap, bh);\n\tup_write(&bmap->b_sem);\n\n\treturn nilfs_bmap_convert_error(bmap, __func__, ret);\n}",
    "includes": [
      "#include \"alloc.h\"",
      "#include \"dat.h\"",
      "#include \"mdt.h\"",
      "#include \"btnode.h\"",
      "#include \"direct.h\"",
      "#include \"btree.h\"",
      "#include \"bmap.h\"",
      "#include \"nilfs.h\"",
      "#include <linux/errno.h>",
      "#include <linux/string.h>",
      "#include <linux/fs.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "nilfs_bmap_convert_error",
          "args": [
            "bmap",
            "__func__",
            "ret"
          ],
          "line": 327
        },
        "resolved": true,
        "details": {
          "function_name": "nilfs_bmap_convert_error",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/bmap.c",
          "lines": "42-53",
          "snippet": "static int nilfs_bmap_convert_error(struct nilfs_bmap *bmap,\n\t\t\t\t     const char *fname, int err)\n{\n\tstruct inode *inode = bmap->b_inode;\n\n\tif (err == -EINVAL) {\n\t\tnilfs_error(inode->i_sb, fname,\n\t\t\t    \"broken bmap (inode number=%lu)\\n\", inode->i_ino);\n\t\terr = -EIO;\n\t}\n\treturn err;\n}",
          "includes": [
            "#include \"alloc.h\"",
            "#include \"dat.h\"",
            "#include \"mdt.h\"",
            "#include \"btnode.h\"",
            "#include \"direct.h\"",
            "#include \"btree.h\"",
            "#include \"bmap.h\"",
            "#include \"nilfs.h\"",
            "#include <linux/errno.h>",
            "#include <linux/string.h>",
            "#include <linux/fs.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"alloc.h\"\n#include \"dat.h\"\n#include \"mdt.h\"\n#include \"btnode.h\"\n#include \"direct.h\"\n#include \"btree.h\"\n#include \"bmap.h\"\n#include \"nilfs.h\"\n#include <linux/errno.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n\nstatic int nilfs_bmap_convert_error(struct nilfs_bmap *bmap,\n\t\t\t\t     const char *fname, int err)\n{\n\tstruct inode *inode = bmap->b_inode;\n\n\tif (err == -EINVAL) {\n\t\tnilfs_error(inode->i_sb, fname,\n\t\t\t    \"broken bmap (inode number=%lu)\\n\", inode->i_ino);\n\t\terr = -EIO;\n\t}\n\treturn err;\n}"
        }
      },
      {
        "call_info": {
          "callee": "up_write",
          "args": [
            "&bmap->b_sem"
          ],
          "line": 325
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bmap->b_ops->bop_propagate",
          "args": [
            "bmap",
            "bh"
          ],
          "line": 324
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "down_write",
          "args": [
            "&bmap->b_sem"
          ],
          "line": 323
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"alloc.h\"\n#include \"dat.h\"\n#include \"mdt.h\"\n#include \"btnode.h\"\n#include \"direct.h\"\n#include \"btree.h\"\n#include \"bmap.h\"\n#include \"nilfs.h\"\n#include <linux/errno.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n\nint nilfs_bmap_propagate(struct nilfs_bmap *bmap, struct buffer_head *bh)\n{\n\tint ret;\n\n\tdown_write(&bmap->b_sem);\n\tret = bmap->b_ops->bop_propagate(bmap, bh);\n\tup_write(&bmap->b_sem);\n\n\treturn nilfs_bmap_convert_error(bmap, __func__, ret);\n}"
  },
  {
    "function_name": "nilfs_bmap_clear",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/bmap.c",
    "lines": "296-302",
    "snippet": "void nilfs_bmap_clear(struct nilfs_bmap *bmap)\n{\n\tdown_write(&bmap->b_sem);\n\tif (bmap->b_ops->bop_clear != NULL)\n\t\tbmap->b_ops->bop_clear(bmap);\n\tup_write(&bmap->b_sem);\n}",
    "includes": [
      "#include \"alloc.h\"",
      "#include \"dat.h\"",
      "#include \"mdt.h\"",
      "#include \"btnode.h\"",
      "#include \"direct.h\"",
      "#include \"btree.h\"",
      "#include \"bmap.h\"",
      "#include \"nilfs.h\"",
      "#include <linux/errno.h>",
      "#include <linux/string.h>",
      "#include <linux/fs.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "up_write",
          "args": [
            "&bmap->b_sem"
          ],
          "line": 301
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bmap->b_ops->bop_clear",
          "args": [
            "bmap"
          ],
          "line": 300
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "down_write",
          "args": [
            "&bmap->b_sem"
          ],
          "line": 298
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"alloc.h\"\n#include \"dat.h\"\n#include \"mdt.h\"\n#include \"btnode.h\"\n#include \"direct.h\"\n#include \"btree.h\"\n#include \"bmap.h\"\n#include \"nilfs.h\"\n#include <linux/errno.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n\nvoid nilfs_bmap_clear(struct nilfs_bmap *bmap)\n{\n\tdown_write(&bmap->b_sem);\n\tif (bmap->b_ops->bop_clear != NULL)\n\t\tbmap->b_ops->bop_clear(bmap);\n\tup_write(&bmap->b_sem);\n}"
  },
  {
    "function_name": "nilfs_bmap_truncate",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/bmap.c",
    "lines": "279-288",
    "snippet": "int nilfs_bmap_truncate(struct nilfs_bmap *bmap, unsigned long key)\n{\n\tint ret;\n\n\tdown_write(&bmap->b_sem);\n\tret = nilfs_bmap_do_truncate(bmap, key);\n\tup_write(&bmap->b_sem);\n\n\treturn nilfs_bmap_convert_error(bmap, __func__, ret);\n}",
    "includes": [
      "#include \"alloc.h\"",
      "#include \"dat.h\"",
      "#include \"mdt.h\"",
      "#include \"btnode.h\"",
      "#include \"direct.h\"",
      "#include \"btree.h\"",
      "#include \"bmap.h\"",
      "#include \"nilfs.h\"",
      "#include <linux/errno.h>",
      "#include <linux/string.h>",
      "#include <linux/fs.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "nilfs_bmap_convert_error",
          "args": [
            "bmap",
            "__func__",
            "ret"
          ],
          "line": 287
        },
        "resolved": true,
        "details": {
          "function_name": "nilfs_bmap_convert_error",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/bmap.c",
          "lines": "42-53",
          "snippet": "static int nilfs_bmap_convert_error(struct nilfs_bmap *bmap,\n\t\t\t\t     const char *fname, int err)\n{\n\tstruct inode *inode = bmap->b_inode;\n\n\tif (err == -EINVAL) {\n\t\tnilfs_error(inode->i_sb, fname,\n\t\t\t    \"broken bmap (inode number=%lu)\\n\", inode->i_ino);\n\t\terr = -EIO;\n\t}\n\treturn err;\n}",
          "includes": [
            "#include \"alloc.h\"",
            "#include \"dat.h\"",
            "#include \"mdt.h\"",
            "#include \"btnode.h\"",
            "#include \"direct.h\"",
            "#include \"btree.h\"",
            "#include \"bmap.h\"",
            "#include \"nilfs.h\"",
            "#include <linux/errno.h>",
            "#include <linux/string.h>",
            "#include <linux/fs.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"alloc.h\"\n#include \"dat.h\"\n#include \"mdt.h\"\n#include \"btnode.h\"\n#include \"direct.h\"\n#include \"btree.h\"\n#include \"bmap.h\"\n#include \"nilfs.h\"\n#include <linux/errno.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n\nstatic int nilfs_bmap_convert_error(struct nilfs_bmap *bmap,\n\t\t\t\t     const char *fname, int err)\n{\n\tstruct inode *inode = bmap->b_inode;\n\n\tif (err == -EINVAL) {\n\t\tnilfs_error(inode->i_sb, fname,\n\t\t\t    \"broken bmap (inode number=%lu)\\n\", inode->i_ino);\n\t\terr = -EIO;\n\t}\n\treturn err;\n}"
        }
      },
      {
        "call_info": {
          "callee": "up_write",
          "args": [
            "&bmap->b_sem"
          ],
          "line": 285
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "nilfs_bmap_do_truncate",
          "args": [
            "bmap",
            "key"
          ],
          "line": 284
        },
        "resolved": true,
        "details": {
          "function_name": "nilfs_bmap_do_truncate",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/bmap.c",
          "lines": "238-262",
          "snippet": "static int nilfs_bmap_do_truncate(struct nilfs_bmap *bmap, unsigned long key)\n{\n\t__u64 lastkey;\n\tint ret;\n\n\tret = bmap->b_ops->bop_last_key(bmap, &lastkey);\n\tif (ret < 0) {\n\t\tif (ret == -ENOENT)\n\t\t\tret = 0;\n\t\treturn ret;\n\t}\n\n\twhile (key <= lastkey) {\n\t\tret = nilfs_bmap_do_delete(bmap, lastkey);\n\t\tif (ret < 0)\n\t\t\treturn ret;\n\t\tret = bmap->b_ops->bop_last_key(bmap, &lastkey);\n\t\tif (ret < 0) {\n\t\t\tif (ret == -ENOENT)\n\t\t\t\tret = 0;\n\t\t\treturn ret;\n\t\t}\n\t}\n\treturn 0;\n}",
          "includes": [
            "#include \"alloc.h\"",
            "#include \"dat.h\"",
            "#include \"mdt.h\"",
            "#include \"btnode.h\"",
            "#include \"direct.h\"",
            "#include \"btree.h\"",
            "#include \"bmap.h\"",
            "#include \"nilfs.h\"",
            "#include <linux/errno.h>",
            "#include <linux/string.h>",
            "#include <linux/fs.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"alloc.h\"\n#include \"dat.h\"\n#include \"mdt.h\"\n#include \"btnode.h\"\n#include \"direct.h\"\n#include \"btree.h\"\n#include \"bmap.h\"\n#include \"nilfs.h\"\n#include <linux/errno.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n\nstatic int nilfs_bmap_do_truncate(struct nilfs_bmap *bmap, unsigned long key)\n{\n\t__u64 lastkey;\n\tint ret;\n\n\tret = bmap->b_ops->bop_last_key(bmap, &lastkey);\n\tif (ret < 0) {\n\t\tif (ret == -ENOENT)\n\t\t\tret = 0;\n\t\treturn ret;\n\t}\n\n\twhile (key <= lastkey) {\n\t\tret = nilfs_bmap_do_delete(bmap, lastkey);\n\t\tif (ret < 0)\n\t\t\treturn ret;\n\t\tret = bmap->b_ops->bop_last_key(bmap, &lastkey);\n\t\tif (ret < 0) {\n\t\t\tif (ret == -ENOENT)\n\t\t\t\tret = 0;\n\t\t\treturn ret;\n\t\t}\n\t}\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "down_write",
          "args": [
            "&bmap->b_sem"
          ],
          "line": 283
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"alloc.h\"\n#include \"dat.h\"\n#include \"mdt.h\"\n#include \"btnode.h\"\n#include \"direct.h\"\n#include \"btree.h\"\n#include \"bmap.h\"\n#include \"nilfs.h\"\n#include <linux/errno.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n\nint nilfs_bmap_truncate(struct nilfs_bmap *bmap, unsigned long key)\n{\n\tint ret;\n\n\tdown_write(&bmap->b_sem);\n\tret = nilfs_bmap_do_truncate(bmap, key);\n\tup_write(&bmap->b_sem);\n\n\treturn nilfs_bmap_convert_error(bmap, __func__, ret);\n}"
  },
  {
    "function_name": "nilfs_bmap_do_truncate",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/bmap.c",
    "lines": "238-262",
    "snippet": "static int nilfs_bmap_do_truncate(struct nilfs_bmap *bmap, unsigned long key)\n{\n\t__u64 lastkey;\n\tint ret;\n\n\tret = bmap->b_ops->bop_last_key(bmap, &lastkey);\n\tif (ret < 0) {\n\t\tif (ret == -ENOENT)\n\t\t\tret = 0;\n\t\treturn ret;\n\t}\n\n\twhile (key <= lastkey) {\n\t\tret = nilfs_bmap_do_delete(bmap, lastkey);\n\t\tif (ret < 0)\n\t\t\treturn ret;\n\t\tret = bmap->b_ops->bop_last_key(bmap, &lastkey);\n\t\tif (ret < 0) {\n\t\t\tif (ret == -ENOENT)\n\t\t\t\tret = 0;\n\t\t\treturn ret;\n\t\t}\n\t}\n\treturn 0;\n}",
    "includes": [
      "#include \"alloc.h\"",
      "#include \"dat.h\"",
      "#include \"mdt.h\"",
      "#include \"btnode.h\"",
      "#include \"direct.h\"",
      "#include \"btree.h\"",
      "#include \"bmap.h\"",
      "#include \"nilfs.h\"",
      "#include <linux/errno.h>",
      "#include <linux/string.h>",
      "#include <linux/fs.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "bmap->b_ops->bop_last_key",
          "args": [
            "bmap",
            "&lastkey"
          ],
          "line": 254
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "nilfs_bmap_do_delete",
          "args": [
            "bmap",
            "lastkey"
          ],
          "line": 251
        },
        "resolved": true,
        "details": {
          "function_name": "nilfs_bmap_do_delete",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/bmap.c",
          "lines": "168-192",
          "snippet": "static int nilfs_bmap_do_delete(struct nilfs_bmap *bmap, __u64 key)\n{\n\t__u64 keys[NILFS_BMAP_LARGE_LOW + 1];\n\t__u64 ptrs[NILFS_BMAP_LARGE_LOW + 1];\n\tint ret, n;\n\n\tif (bmap->b_ops->bop_check_delete != NULL) {\n\t\tret = bmap->b_ops->bop_check_delete(bmap, key);\n\t\tif (ret > 0) {\n\t\t\tn = bmap->b_ops->bop_gather_data(\n\t\t\t\tbmap, keys, ptrs, NILFS_BMAP_LARGE_LOW + 1);\n\t\t\tif (n < 0)\n\t\t\t\treturn n;\n\t\t\tret = nilfs_direct_delete_and_convert(\n\t\t\t\tbmap, key, keys, ptrs, n);\n\t\t\tif (ret == 0)\n\t\t\t\tbmap->b_u.u_flags &= ~NILFS_BMAP_LARGE;\n\n\t\t\treturn ret;\n\t\t} else if (ret < 0)\n\t\t\treturn ret;\n\t}\n\n\treturn bmap->b_ops->bop_delete(bmap, key);\n}",
          "includes": [
            "#include \"alloc.h\"",
            "#include \"dat.h\"",
            "#include \"mdt.h\"",
            "#include \"btnode.h\"",
            "#include \"direct.h\"",
            "#include \"btree.h\"",
            "#include \"bmap.h\"",
            "#include \"nilfs.h\"",
            "#include <linux/errno.h>",
            "#include <linux/string.h>",
            "#include <linux/fs.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"alloc.h\"\n#include \"dat.h\"\n#include \"mdt.h\"\n#include \"btnode.h\"\n#include \"direct.h\"\n#include \"btree.h\"\n#include \"bmap.h\"\n#include \"nilfs.h\"\n#include <linux/errno.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n\nstatic int nilfs_bmap_do_delete(struct nilfs_bmap *bmap, __u64 key)\n{\n\t__u64 keys[NILFS_BMAP_LARGE_LOW + 1];\n\t__u64 ptrs[NILFS_BMAP_LARGE_LOW + 1];\n\tint ret, n;\n\n\tif (bmap->b_ops->bop_check_delete != NULL) {\n\t\tret = bmap->b_ops->bop_check_delete(bmap, key);\n\t\tif (ret > 0) {\n\t\t\tn = bmap->b_ops->bop_gather_data(\n\t\t\t\tbmap, keys, ptrs, NILFS_BMAP_LARGE_LOW + 1);\n\t\t\tif (n < 0)\n\t\t\t\treturn n;\n\t\t\tret = nilfs_direct_delete_and_convert(\n\t\t\t\tbmap, key, keys, ptrs, n);\n\t\t\tif (ret == 0)\n\t\t\t\tbmap->b_u.u_flags &= ~NILFS_BMAP_LARGE;\n\n\t\t\treturn ret;\n\t\t} else if (ret < 0)\n\t\t\treturn ret;\n\t}\n\n\treturn bmap->b_ops->bop_delete(bmap, key);\n}"
        }
      },
      {
        "call_info": {
          "callee": "bmap->b_ops->bop_last_key",
          "args": [
            "bmap",
            "&lastkey"
          ],
          "line": 243
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"alloc.h\"\n#include \"dat.h\"\n#include \"mdt.h\"\n#include \"btnode.h\"\n#include \"direct.h\"\n#include \"btree.h\"\n#include \"bmap.h\"\n#include \"nilfs.h\"\n#include <linux/errno.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n\nstatic int nilfs_bmap_do_truncate(struct nilfs_bmap *bmap, unsigned long key)\n{\n\t__u64 lastkey;\n\tint ret;\n\n\tret = bmap->b_ops->bop_last_key(bmap, &lastkey);\n\tif (ret < 0) {\n\t\tif (ret == -ENOENT)\n\t\t\tret = 0;\n\t\treturn ret;\n\t}\n\n\twhile (key <= lastkey) {\n\t\tret = nilfs_bmap_do_delete(bmap, lastkey);\n\t\tif (ret < 0)\n\t\t\treturn ret;\n\t\tret = bmap->b_ops->bop_last_key(bmap, &lastkey);\n\t\tif (ret < 0) {\n\t\t\tif (ret == -ENOENT)\n\t\t\t\tret = 0;\n\t\t\treturn ret;\n\t\t}\n\t}\n\treturn 0;\n}"
  },
  {
    "function_name": "nilfs_bmap_delete",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/bmap.c",
    "lines": "227-236",
    "snippet": "int nilfs_bmap_delete(struct nilfs_bmap *bmap, unsigned long key)\n{\n\tint ret;\n\n\tdown_write(&bmap->b_sem);\n\tret = nilfs_bmap_do_delete(bmap, key);\n\tup_write(&bmap->b_sem);\n\n\treturn nilfs_bmap_convert_error(bmap, __func__, ret);\n}",
    "includes": [
      "#include \"alloc.h\"",
      "#include \"dat.h\"",
      "#include \"mdt.h\"",
      "#include \"btnode.h\"",
      "#include \"direct.h\"",
      "#include \"btree.h\"",
      "#include \"bmap.h\"",
      "#include \"nilfs.h\"",
      "#include <linux/errno.h>",
      "#include <linux/string.h>",
      "#include <linux/fs.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "nilfs_bmap_convert_error",
          "args": [
            "bmap",
            "__func__",
            "ret"
          ],
          "line": 235
        },
        "resolved": true,
        "details": {
          "function_name": "nilfs_bmap_convert_error",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/bmap.c",
          "lines": "42-53",
          "snippet": "static int nilfs_bmap_convert_error(struct nilfs_bmap *bmap,\n\t\t\t\t     const char *fname, int err)\n{\n\tstruct inode *inode = bmap->b_inode;\n\n\tif (err == -EINVAL) {\n\t\tnilfs_error(inode->i_sb, fname,\n\t\t\t    \"broken bmap (inode number=%lu)\\n\", inode->i_ino);\n\t\terr = -EIO;\n\t}\n\treturn err;\n}",
          "includes": [
            "#include \"alloc.h\"",
            "#include \"dat.h\"",
            "#include \"mdt.h\"",
            "#include \"btnode.h\"",
            "#include \"direct.h\"",
            "#include \"btree.h\"",
            "#include \"bmap.h\"",
            "#include \"nilfs.h\"",
            "#include <linux/errno.h>",
            "#include <linux/string.h>",
            "#include <linux/fs.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"alloc.h\"\n#include \"dat.h\"\n#include \"mdt.h\"\n#include \"btnode.h\"\n#include \"direct.h\"\n#include \"btree.h\"\n#include \"bmap.h\"\n#include \"nilfs.h\"\n#include <linux/errno.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n\nstatic int nilfs_bmap_convert_error(struct nilfs_bmap *bmap,\n\t\t\t\t     const char *fname, int err)\n{\n\tstruct inode *inode = bmap->b_inode;\n\n\tif (err == -EINVAL) {\n\t\tnilfs_error(inode->i_sb, fname,\n\t\t\t    \"broken bmap (inode number=%lu)\\n\", inode->i_ino);\n\t\terr = -EIO;\n\t}\n\treturn err;\n}"
        }
      },
      {
        "call_info": {
          "callee": "up_write",
          "args": [
            "&bmap->b_sem"
          ],
          "line": 233
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "nilfs_bmap_do_delete",
          "args": [
            "bmap",
            "key"
          ],
          "line": 232
        },
        "resolved": true,
        "details": {
          "function_name": "nilfs_bmap_do_delete",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/bmap.c",
          "lines": "168-192",
          "snippet": "static int nilfs_bmap_do_delete(struct nilfs_bmap *bmap, __u64 key)\n{\n\t__u64 keys[NILFS_BMAP_LARGE_LOW + 1];\n\t__u64 ptrs[NILFS_BMAP_LARGE_LOW + 1];\n\tint ret, n;\n\n\tif (bmap->b_ops->bop_check_delete != NULL) {\n\t\tret = bmap->b_ops->bop_check_delete(bmap, key);\n\t\tif (ret > 0) {\n\t\t\tn = bmap->b_ops->bop_gather_data(\n\t\t\t\tbmap, keys, ptrs, NILFS_BMAP_LARGE_LOW + 1);\n\t\t\tif (n < 0)\n\t\t\t\treturn n;\n\t\t\tret = nilfs_direct_delete_and_convert(\n\t\t\t\tbmap, key, keys, ptrs, n);\n\t\t\tif (ret == 0)\n\t\t\t\tbmap->b_u.u_flags &= ~NILFS_BMAP_LARGE;\n\n\t\t\treturn ret;\n\t\t} else if (ret < 0)\n\t\t\treturn ret;\n\t}\n\n\treturn bmap->b_ops->bop_delete(bmap, key);\n}",
          "includes": [
            "#include \"alloc.h\"",
            "#include \"dat.h\"",
            "#include \"mdt.h\"",
            "#include \"btnode.h\"",
            "#include \"direct.h\"",
            "#include \"btree.h\"",
            "#include \"bmap.h\"",
            "#include \"nilfs.h\"",
            "#include <linux/errno.h>",
            "#include <linux/string.h>",
            "#include <linux/fs.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"alloc.h\"\n#include \"dat.h\"\n#include \"mdt.h\"\n#include \"btnode.h\"\n#include \"direct.h\"\n#include \"btree.h\"\n#include \"bmap.h\"\n#include \"nilfs.h\"\n#include <linux/errno.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n\nstatic int nilfs_bmap_do_delete(struct nilfs_bmap *bmap, __u64 key)\n{\n\t__u64 keys[NILFS_BMAP_LARGE_LOW + 1];\n\t__u64 ptrs[NILFS_BMAP_LARGE_LOW + 1];\n\tint ret, n;\n\n\tif (bmap->b_ops->bop_check_delete != NULL) {\n\t\tret = bmap->b_ops->bop_check_delete(bmap, key);\n\t\tif (ret > 0) {\n\t\t\tn = bmap->b_ops->bop_gather_data(\n\t\t\t\tbmap, keys, ptrs, NILFS_BMAP_LARGE_LOW + 1);\n\t\t\tif (n < 0)\n\t\t\t\treturn n;\n\t\t\tret = nilfs_direct_delete_and_convert(\n\t\t\t\tbmap, key, keys, ptrs, n);\n\t\t\tif (ret == 0)\n\t\t\t\tbmap->b_u.u_flags &= ~NILFS_BMAP_LARGE;\n\n\t\t\treturn ret;\n\t\t} else if (ret < 0)\n\t\t\treturn ret;\n\t}\n\n\treturn bmap->b_ops->bop_delete(bmap, key);\n}"
        }
      },
      {
        "call_info": {
          "callee": "down_write",
          "args": [
            "&bmap->b_sem"
          ],
          "line": 231
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"alloc.h\"\n#include \"dat.h\"\n#include \"mdt.h\"\n#include \"btnode.h\"\n#include \"direct.h\"\n#include \"btree.h\"\n#include \"bmap.h\"\n#include \"nilfs.h\"\n#include <linux/errno.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n\nint nilfs_bmap_delete(struct nilfs_bmap *bmap, unsigned long key)\n{\n\tint ret;\n\n\tdown_write(&bmap->b_sem);\n\tret = nilfs_bmap_do_delete(bmap, key);\n\tup_write(&bmap->b_sem);\n\n\treturn nilfs_bmap_convert_error(bmap, __func__, ret);\n}"
  },
  {
    "function_name": "nilfs_bmap_last_key",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/bmap.c",
    "lines": "194-208",
    "snippet": "int nilfs_bmap_last_key(struct nilfs_bmap *bmap, unsigned long *key)\n{\n\t__u64 lastkey;\n\tint ret;\n\n\tdown_read(&bmap->b_sem);\n\tret = bmap->b_ops->bop_last_key(bmap, &lastkey);\n\tup_read(&bmap->b_sem);\n\n\tif (ret < 0)\n\t\tret = nilfs_bmap_convert_error(bmap, __func__, ret);\n\telse\n\t\t*key = lastkey;\n\treturn ret;\n}",
    "includes": [
      "#include \"alloc.h\"",
      "#include \"dat.h\"",
      "#include \"mdt.h\"",
      "#include \"btnode.h\"",
      "#include \"direct.h\"",
      "#include \"btree.h\"",
      "#include \"bmap.h\"",
      "#include \"nilfs.h\"",
      "#include <linux/errno.h>",
      "#include <linux/string.h>",
      "#include <linux/fs.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "nilfs_bmap_convert_error",
          "args": [
            "bmap",
            "__func__",
            "ret"
          ],
          "line": 204
        },
        "resolved": true,
        "details": {
          "function_name": "nilfs_bmap_convert_error",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/bmap.c",
          "lines": "42-53",
          "snippet": "static int nilfs_bmap_convert_error(struct nilfs_bmap *bmap,\n\t\t\t\t     const char *fname, int err)\n{\n\tstruct inode *inode = bmap->b_inode;\n\n\tif (err == -EINVAL) {\n\t\tnilfs_error(inode->i_sb, fname,\n\t\t\t    \"broken bmap (inode number=%lu)\\n\", inode->i_ino);\n\t\terr = -EIO;\n\t}\n\treturn err;\n}",
          "includes": [
            "#include \"alloc.h\"",
            "#include \"dat.h\"",
            "#include \"mdt.h\"",
            "#include \"btnode.h\"",
            "#include \"direct.h\"",
            "#include \"btree.h\"",
            "#include \"bmap.h\"",
            "#include \"nilfs.h\"",
            "#include <linux/errno.h>",
            "#include <linux/string.h>",
            "#include <linux/fs.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"alloc.h\"\n#include \"dat.h\"\n#include \"mdt.h\"\n#include \"btnode.h\"\n#include \"direct.h\"\n#include \"btree.h\"\n#include \"bmap.h\"\n#include \"nilfs.h\"\n#include <linux/errno.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n\nstatic int nilfs_bmap_convert_error(struct nilfs_bmap *bmap,\n\t\t\t\t     const char *fname, int err)\n{\n\tstruct inode *inode = bmap->b_inode;\n\n\tif (err == -EINVAL) {\n\t\tnilfs_error(inode->i_sb, fname,\n\t\t\t    \"broken bmap (inode number=%lu)\\n\", inode->i_ino);\n\t\terr = -EIO;\n\t}\n\treturn err;\n}"
        }
      },
      {
        "call_info": {
          "callee": "up_read",
          "args": [
            "&bmap->b_sem"
          ],
          "line": 201
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bmap->b_ops->bop_last_key",
          "args": [
            "bmap",
            "&lastkey"
          ],
          "line": 200
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "down_read",
          "args": [
            "&bmap->b_sem"
          ],
          "line": 199
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"alloc.h\"\n#include \"dat.h\"\n#include \"mdt.h\"\n#include \"btnode.h\"\n#include \"direct.h\"\n#include \"btree.h\"\n#include \"bmap.h\"\n#include \"nilfs.h\"\n#include <linux/errno.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n\nint nilfs_bmap_last_key(struct nilfs_bmap *bmap, unsigned long *key)\n{\n\t__u64 lastkey;\n\tint ret;\n\n\tdown_read(&bmap->b_sem);\n\tret = bmap->b_ops->bop_last_key(bmap, &lastkey);\n\tup_read(&bmap->b_sem);\n\n\tif (ret < 0)\n\t\tret = nilfs_bmap_convert_error(bmap, __func__, ret);\n\telse\n\t\t*key = lastkey;\n\treturn ret;\n}"
  },
  {
    "function_name": "nilfs_bmap_do_delete",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/bmap.c",
    "lines": "168-192",
    "snippet": "static int nilfs_bmap_do_delete(struct nilfs_bmap *bmap, __u64 key)\n{\n\t__u64 keys[NILFS_BMAP_LARGE_LOW + 1];\n\t__u64 ptrs[NILFS_BMAP_LARGE_LOW + 1];\n\tint ret, n;\n\n\tif (bmap->b_ops->bop_check_delete != NULL) {\n\t\tret = bmap->b_ops->bop_check_delete(bmap, key);\n\t\tif (ret > 0) {\n\t\t\tn = bmap->b_ops->bop_gather_data(\n\t\t\t\tbmap, keys, ptrs, NILFS_BMAP_LARGE_LOW + 1);\n\t\t\tif (n < 0)\n\t\t\t\treturn n;\n\t\t\tret = nilfs_direct_delete_and_convert(\n\t\t\t\tbmap, key, keys, ptrs, n);\n\t\t\tif (ret == 0)\n\t\t\t\tbmap->b_u.u_flags &= ~NILFS_BMAP_LARGE;\n\n\t\t\treturn ret;\n\t\t} else if (ret < 0)\n\t\t\treturn ret;\n\t}\n\n\treturn bmap->b_ops->bop_delete(bmap, key);\n}",
    "includes": [
      "#include \"alloc.h\"",
      "#include \"dat.h\"",
      "#include \"mdt.h\"",
      "#include \"btnode.h\"",
      "#include \"direct.h\"",
      "#include \"btree.h\"",
      "#include \"bmap.h\"",
      "#include \"nilfs.h\"",
      "#include <linux/errno.h>",
      "#include <linux/string.h>",
      "#include <linux/fs.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "bmap->b_ops->bop_delete",
          "args": [
            "bmap",
            "key"
          ],
          "line": 191
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "nilfs_direct_delete_and_convert",
          "args": [
            "bmap",
            "key",
            "keys",
            "ptrs",
            "n"
          ],
          "line": 181
        },
        "resolved": true,
        "details": {
          "function_name": "nilfs_direct_delete_and_convert",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/direct.c",
          "lines": "220-251",
          "snippet": "int nilfs_direct_delete_and_convert(struct nilfs_bmap *bmap,\n\t\t\t\t    __u64 key, __u64 *keys, __u64 *ptrs, int n)\n{\n\t__le64 *dptrs;\n\tint ret, i, j;\n\n\t/* no need to allocate any resource for conversion */\n\n\t/* delete */\n\tret = bmap->b_ops->bop_delete(bmap, key);\n\tif (ret < 0)\n\t\treturn ret;\n\n\t/* free resources */\n\tif (bmap->b_ops->bop_clear != NULL)\n\t\tbmap->b_ops->bop_clear(bmap);\n\n\t/* convert */\n\tdptrs = nilfs_direct_dptrs(bmap);\n\tfor (i = 0, j = 0; i < NILFS_DIRECT_NBLOCKS; i++) {\n\t\tif ((j < n) && (i == keys[j])) {\n\t\t\tdptrs[i] = (i != key) ?\n\t\t\t\tcpu_to_le64(ptrs[j]) :\n\t\t\t\tNILFS_BMAP_INVALID_PTR;\n\t\t\tj++;\n\t\t} else\n\t\t\tdptrs[i] = NILFS_BMAP_INVALID_PTR;\n\t}\n\n\tnilfs_direct_init(bmap);\n\treturn 0;\n}",
          "includes": [
            "#include \"dat.h\"",
            "#include \"alloc.h\"",
            "#include \"direct.h\"",
            "#include \"page.h\"",
            "#include \"nilfs.h\"",
            "#include <linux/errno.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"dat.h\"\n#include \"alloc.h\"\n#include \"direct.h\"\n#include \"page.h\"\n#include \"nilfs.h\"\n#include <linux/errno.h>\n\nint nilfs_direct_delete_and_convert(struct nilfs_bmap *bmap,\n\t\t\t\t    __u64 key, __u64 *keys, __u64 *ptrs, int n)\n{\n\t__le64 *dptrs;\n\tint ret, i, j;\n\n\t/* no need to allocate any resource for conversion */\n\n\t/* delete */\n\tret = bmap->b_ops->bop_delete(bmap, key);\n\tif (ret < 0)\n\t\treturn ret;\n\n\t/* free resources */\n\tif (bmap->b_ops->bop_clear != NULL)\n\t\tbmap->b_ops->bop_clear(bmap);\n\n\t/* convert */\n\tdptrs = nilfs_direct_dptrs(bmap);\n\tfor (i = 0, j = 0; i < NILFS_DIRECT_NBLOCKS; i++) {\n\t\tif ((j < n) && (i == keys[j])) {\n\t\t\tdptrs[i] = (i != key) ?\n\t\t\t\tcpu_to_le64(ptrs[j]) :\n\t\t\t\tNILFS_BMAP_INVALID_PTR;\n\t\t\tj++;\n\t\t} else\n\t\t\tdptrs[i] = NILFS_BMAP_INVALID_PTR;\n\t}\n\n\tnilfs_direct_init(bmap);\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "bmap->b_ops->bop_gather_data",
          "args": [
            "bmap",
            "keys",
            "ptrs",
            "NILFS_BMAP_LARGE_LOW + 1"
          ],
          "line": 177
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bmap->b_ops->bop_check_delete",
          "args": [
            "bmap",
            "key"
          ],
          "line": 175
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"alloc.h\"\n#include \"dat.h\"\n#include \"mdt.h\"\n#include \"btnode.h\"\n#include \"direct.h\"\n#include \"btree.h\"\n#include \"bmap.h\"\n#include \"nilfs.h\"\n#include <linux/errno.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n\nstatic int nilfs_bmap_do_delete(struct nilfs_bmap *bmap, __u64 key)\n{\n\t__u64 keys[NILFS_BMAP_LARGE_LOW + 1];\n\t__u64 ptrs[NILFS_BMAP_LARGE_LOW + 1];\n\tint ret, n;\n\n\tif (bmap->b_ops->bop_check_delete != NULL) {\n\t\tret = bmap->b_ops->bop_check_delete(bmap, key);\n\t\tif (ret > 0) {\n\t\t\tn = bmap->b_ops->bop_gather_data(\n\t\t\t\tbmap, keys, ptrs, NILFS_BMAP_LARGE_LOW + 1);\n\t\t\tif (n < 0)\n\t\t\t\treturn n;\n\t\t\tret = nilfs_direct_delete_and_convert(\n\t\t\t\tbmap, key, keys, ptrs, n);\n\t\t\tif (ret == 0)\n\t\t\t\tbmap->b_u.u_flags &= ~NILFS_BMAP_LARGE;\n\n\t\t\treturn ret;\n\t\t} else if (ret < 0)\n\t\t\treturn ret;\n\t}\n\n\treturn bmap->b_ops->bop_delete(bmap, key);\n}"
  },
  {
    "function_name": "nilfs_bmap_insert",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/bmap.c",
    "lines": "155-166",
    "snippet": "int nilfs_bmap_insert(struct nilfs_bmap *bmap,\n\t\t      unsigned long key,\n\t\t      unsigned long rec)\n{\n\tint ret;\n\n\tdown_write(&bmap->b_sem);\n\tret = nilfs_bmap_do_insert(bmap, key, rec);\n\tup_write(&bmap->b_sem);\n\n\treturn nilfs_bmap_convert_error(bmap, __func__, ret);\n}",
    "includes": [
      "#include \"alloc.h\"",
      "#include \"dat.h\"",
      "#include \"mdt.h\"",
      "#include \"btnode.h\"",
      "#include \"direct.h\"",
      "#include \"btree.h\"",
      "#include \"bmap.h\"",
      "#include \"nilfs.h\"",
      "#include <linux/errno.h>",
      "#include <linux/string.h>",
      "#include <linux/fs.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "nilfs_bmap_convert_error",
          "args": [
            "bmap",
            "__func__",
            "ret"
          ],
          "line": 165
        },
        "resolved": true,
        "details": {
          "function_name": "nilfs_bmap_convert_error",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/bmap.c",
          "lines": "42-53",
          "snippet": "static int nilfs_bmap_convert_error(struct nilfs_bmap *bmap,\n\t\t\t\t     const char *fname, int err)\n{\n\tstruct inode *inode = bmap->b_inode;\n\n\tif (err == -EINVAL) {\n\t\tnilfs_error(inode->i_sb, fname,\n\t\t\t    \"broken bmap (inode number=%lu)\\n\", inode->i_ino);\n\t\terr = -EIO;\n\t}\n\treturn err;\n}",
          "includes": [
            "#include \"alloc.h\"",
            "#include \"dat.h\"",
            "#include \"mdt.h\"",
            "#include \"btnode.h\"",
            "#include \"direct.h\"",
            "#include \"btree.h\"",
            "#include \"bmap.h\"",
            "#include \"nilfs.h\"",
            "#include <linux/errno.h>",
            "#include <linux/string.h>",
            "#include <linux/fs.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"alloc.h\"\n#include \"dat.h\"\n#include \"mdt.h\"\n#include \"btnode.h\"\n#include \"direct.h\"\n#include \"btree.h\"\n#include \"bmap.h\"\n#include \"nilfs.h\"\n#include <linux/errno.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n\nstatic int nilfs_bmap_convert_error(struct nilfs_bmap *bmap,\n\t\t\t\t     const char *fname, int err)\n{\n\tstruct inode *inode = bmap->b_inode;\n\n\tif (err == -EINVAL) {\n\t\tnilfs_error(inode->i_sb, fname,\n\t\t\t    \"broken bmap (inode number=%lu)\\n\", inode->i_ino);\n\t\terr = -EIO;\n\t}\n\treturn err;\n}"
        }
      },
      {
        "call_info": {
          "callee": "up_write",
          "args": [
            "&bmap->b_sem"
          ],
          "line": 163
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "nilfs_bmap_do_insert",
          "args": [
            "bmap",
            "key",
            "rec"
          ],
          "line": 162
        },
        "resolved": true,
        "details": {
          "function_name": "nilfs_bmap_do_insert",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/bmap.c",
          "lines": "111-135",
          "snippet": "static int nilfs_bmap_do_insert(struct nilfs_bmap *bmap, __u64 key, __u64 ptr)\n{\n\t__u64 keys[NILFS_BMAP_SMALL_HIGH + 1];\n\t__u64 ptrs[NILFS_BMAP_SMALL_HIGH + 1];\n\tint ret, n;\n\n\tif (bmap->b_ops->bop_check_insert != NULL) {\n\t\tret = bmap->b_ops->bop_check_insert(bmap, key);\n\t\tif (ret > 0) {\n\t\t\tn = bmap->b_ops->bop_gather_data(\n\t\t\t\tbmap, keys, ptrs, NILFS_BMAP_SMALL_HIGH + 1);\n\t\t\tif (n < 0)\n\t\t\t\treturn n;\n\t\t\tret = nilfs_btree_convert_and_insert(\n\t\t\t\tbmap, key, ptr, keys, ptrs, n);\n\t\t\tif (ret == 0)\n\t\t\t\tbmap->b_u.u_flags |= NILFS_BMAP_LARGE;\n\n\t\t\treturn ret;\n\t\t} else if (ret < 0)\n\t\t\treturn ret;\n\t}\n\n\treturn bmap->b_ops->bop_insert(bmap, key, ptr);\n}",
          "includes": [
            "#include \"alloc.h\"",
            "#include \"dat.h\"",
            "#include \"mdt.h\"",
            "#include \"btnode.h\"",
            "#include \"direct.h\"",
            "#include \"btree.h\"",
            "#include \"bmap.h\"",
            "#include \"nilfs.h\"",
            "#include <linux/errno.h>",
            "#include <linux/string.h>",
            "#include <linux/fs.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"alloc.h\"\n#include \"dat.h\"\n#include \"mdt.h\"\n#include \"btnode.h\"\n#include \"direct.h\"\n#include \"btree.h\"\n#include \"bmap.h\"\n#include \"nilfs.h\"\n#include <linux/errno.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n\nstatic int nilfs_bmap_do_insert(struct nilfs_bmap *bmap, __u64 key, __u64 ptr)\n{\n\t__u64 keys[NILFS_BMAP_SMALL_HIGH + 1];\n\t__u64 ptrs[NILFS_BMAP_SMALL_HIGH + 1];\n\tint ret, n;\n\n\tif (bmap->b_ops->bop_check_insert != NULL) {\n\t\tret = bmap->b_ops->bop_check_insert(bmap, key);\n\t\tif (ret > 0) {\n\t\t\tn = bmap->b_ops->bop_gather_data(\n\t\t\t\tbmap, keys, ptrs, NILFS_BMAP_SMALL_HIGH + 1);\n\t\t\tif (n < 0)\n\t\t\t\treturn n;\n\t\t\tret = nilfs_btree_convert_and_insert(\n\t\t\t\tbmap, key, ptr, keys, ptrs, n);\n\t\t\tif (ret == 0)\n\t\t\t\tbmap->b_u.u_flags |= NILFS_BMAP_LARGE;\n\n\t\t\treturn ret;\n\t\t} else if (ret < 0)\n\t\t\treturn ret;\n\t}\n\n\treturn bmap->b_ops->bop_insert(bmap, key, ptr);\n}"
        }
      },
      {
        "call_info": {
          "callee": "down_write",
          "args": [
            "&bmap->b_sem"
          ],
          "line": 161
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"alloc.h\"\n#include \"dat.h\"\n#include \"mdt.h\"\n#include \"btnode.h\"\n#include \"direct.h\"\n#include \"btree.h\"\n#include \"bmap.h\"\n#include \"nilfs.h\"\n#include <linux/errno.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n\nint nilfs_bmap_insert(struct nilfs_bmap *bmap,\n\t\t      unsigned long key,\n\t\t      unsigned long rec)\n{\n\tint ret;\n\n\tdown_write(&bmap->b_sem);\n\tret = nilfs_bmap_do_insert(bmap, key, rec);\n\tup_write(&bmap->b_sem);\n\n\treturn nilfs_bmap_convert_error(bmap, __func__, ret);\n}"
  },
  {
    "function_name": "nilfs_bmap_do_insert",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/bmap.c",
    "lines": "111-135",
    "snippet": "static int nilfs_bmap_do_insert(struct nilfs_bmap *bmap, __u64 key, __u64 ptr)\n{\n\t__u64 keys[NILFS_BMAP_SMALL_HIGH + 1];\n\t__u64 ptrs[NILFS_BMAP_SMALL_HIGH + 1];\n\tint ret, n;\n\n\tif (bmap->b_ops->bop_check_insert != NULL) {\n\t\tret = bmap->b_ops->bop_check_insert(bmap, key);\n\t\tif (ret > 0) {\n\t\t\tn = bmap->b_ops->bop_gather_data(\n\t\t\t\tbmap, keys, ptrs, NILFS_BMAP_SMALL_HIGH + 1);\n\t\t\tif (n < 0)\n\t\t\t\treturn n;\n\t\t\tret = nilfs_btree_convert_and_insert(\n\t\t\t\tbmap, key, ptr, keys, ptrs, n);\n\t\t\tif (ret == 0)\n\t\t\t\tbmap->b_u.u_flags |= NILFS_BMAP_LARGE;\n\n\t\t\treturn ret;\n\t\t} else if (ret < 0)\n\t\t\treturn ret;\n\t}\n\n\treturn bmap->b_ops->bop_insert(bmap, key, ptr);\n}",
    "includes": [
      "#include \"alloc.h\"",
      "#include \"dat.h\"",
      "#include \"mdt.h\"",
      "#include \"btnode.h\"",
      "#include \"direct.h\"",
      "#include \"btree.h\"",
      "#include \"bmap.h\"",
      "#include \"nilfs.h\"",
      "#include <linux/errno.h>",
      "#include <linux/string.h>",
      "#include <linux/fs.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "bmap->b_ops->bop_insert",
          "args": [
            "bmap",
            "key",
            "ptr"
          ],
          "line": 134
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "nilfs_btree_convert_and_insert",
          "args": [
            "bmap",
            "key",
            "ptr",
            "keys",
            "ptrs",
            "n"
          ],
          "line": 124
        },
        "resolved": true,
        "details": {
          "function_name": "nilfs_btree_convert_and_insert",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/btree.c",
          "lines": "1796-1826",
          "snippet": "int nilfs_btree_convert_and_insert(struct nilfs_bmap *btree,\n\t\t\t\t   __u64 key, __u64 ptr,\n\t\t\t\t   const __u64 *keys, const __u64 *ptrs, int n)\n{\n\tstruct buffer_head *bh;\n\tunion nilfs_bmap_ptr_req dreq, nreq, *di, *ni;\n\tstruct nilfs_bmap_stats stats;\n\tint ret;\n\n\tif (n + 1 <= NILFS_BTREE_ROOT_NCHILDREN_MAX) {\n\t\tdi = &dreq;\n\t\tni = NULL;\n\t} else if ((n + 1) <= NILFS_BTREE_NODE_NCHILDREN_MAX(\n\t\t\t   1 << btree->b_inode->i_blkbits)) {\n\t\tdi = &dreq;\n\t\tni = &nreq;\n\t} else {\n\t\tdi = NULL;\n\t\tni = NULL;\n\t\tBUG();\n\t}\n\n\tret = nilfs_btree_prepare_convert_and_insert(btree, key, di, ni, &bh,\n\t\t\t\t\t\t     &stats);\n\tif (ret < 0)\n\t\treturn ret;\n\tnilfs_btree_commit_convert_and_insert(btree, key, ptr, keys, ptrs, n,\n\t\t\t\t\t      di, ni, bh);\n\tnilfs_inode_add_blocks(btree->b_inode, stats.bs_nblocks);\n\treturn 0;\n}",
          "includes": [
            "#include \"dat.h\"",
            "#include \"alloc.h\"",
            "#include \"btree.h\"",
            "#include \"btnode.h\"",
            "#include \"page.h\"",
            "#include \"nilfs.h\"",
            "#include <linux/pagevec.h>",
            "#include <linux/errno.h>",
            "#include <linux/string.h>",
            "#include <linux/slab.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"dat.h\"\n#include \"alloc.h\"\n#include \"btree.h\"\n#include \"btnode.h\"\n#include \"page.h\"\n#include \"nilfs.h\"\n#include <linux/pagevec.h>\n#include <linux/errno.h>\n#include <linux/string.h>\n#include <linux/slab.h>\n\nint nilfs_btree_convert_and_insert(struct nilfs_bmap *btree,\n\t\t\t\t   __u64 key, __u64 ptr,\n\t\t\t\t   const __u64 *keys, const __u64 *ptrs, int n)\n{\n\tstruct buffer_head *bh;\n\tunion nilfs_bmap_ptr_req dreq, nreq, *di, *ni;\n\tstruct nilfs_bmap_stats stats;\n\tint ret;\n\n\tif (n + 1 <= NILFS_BTREE_ROOT_NCHILDREN_MAX) {\n\t\tdi = &dreq;\n\t\tni = NULL;\n\t} else if ((n + 1) <= NILFS_BTREE_NODE_NCHILDREN_MAX(\n\t\t\t   1 << btree->b_inode->i_blkbits)) {\n\t\tdi = &dreq;\n\t\tni = &nreq;\n\t} else {\n\t\tdi = NULL;\n\t\tni = NULL;\n\t\tBUG();\n\t}\n\n\tret = nilfs_btree_prepare_convert_and_insert(btree, key, di, ni, &bh,\n\t\t\t\t\t\t     &stats);\n\tif (ret < 0)\n\t\treturn ret;\n\tnilfs_btree_commit_convert_and_insert(btree, key, ptr, keys, ptrs, n,\n\t\t\t\t\t      di, ni, bh);\n\tnilfs_inode_add_blocks(btree->b_inode, stats.bs_nblocks);\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "bmap->b_ops->bop_gather_data",
          "args": [
            "bmap",
            "keys",
            "ptrs",
            "NILFS_BMAP_SMALL_HIGH + 1"
          ],
          "line": 120
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bmap->b_ops->bop_check_insert",
          "args": [
            "bmap",
            "key"
          ],
          "line": 118
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"alloc.h\"\n#include \"dat.h\"\n#include \"mdt.h\"\n#include \"btnode.h\"\n#include \"direct.h\"\n#include \"btree.h\"\n#include \"bmap.h\"\n#include \"nilfs.h\"\n#include <linux/errno.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n\nstatic int nilfs_bmap_do_insert(struct nilfs_bmap *bmap, __u64 key, __u64 ptr)\n{\n\t__u64 keys[NILFS_BMAP_SMALL_HIGH + 1];\n\t__u64 ptrs[NILFS_BMAP_SMALL_HIGH + 1];\n\tint ret, n;\n\n\tif (bmap->b_ops->bop_check_insert != NULL) {\n\t\tret = bmap->b_ops->bop_check_insert(bmap, key);\n\t\tif (ret > 0) {\n\t\t\tn = bmap->b_ops->bop_gather_data(\n\t\t\t\tbmap, keys, ptrs, NILFS_BMAP_SMALL_HIGH + 1);\n\t\t\tif (n < 0)\n\t\t\t\treturn n;\n\t\t\tret = nilfs_btree_convert_and_insert(\n\t\t\t\tbmap, key, ptr, keys, ptrs, n);\n\t\t\tif (ret == 0)\n\t\t\t\tbmap->b_u.u_flags |= NILFS_BMAP_LARGE;\n\n\t\t\treturn ret;\n\t\t} else if (ret < 0)\n\t\t\treturn ret;\n\t}\n\n\treturn bmap->b_ops->bop_insert(bmap, key, ptr);\n}"
  },
  {
    "function_name": "nilfs_bmap_lookup_contig",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/bmap.c",
    "lines": "99-109",
    "snippet": "int nilfs_bmap_lookup_contig(struct nilfs_bmap *bmap, __u64 key, __u64 *ptrp,\n\t\t\t     unsigned maxblocks)\n{\n\tint ret;\n\n\tdown_read(&bmap->b_sem);\n\tret = bmap->b_ops->bop_lookup_contig(bmap, key, ptrp, maxblocks);\n\tup_read(&bmap->b_sem);\n\n\treturn nilfs_bmap_convert_error(bmap, __func__, ret);\n}",
    "includes": [
      "#include \"alloc.h\"",
      "#include \"dat.h\"",
      "#include \"mdt.h\"",
      "#include \"btnode.h\"",
      "#include \"direct.h\"",
      "#include \"btree.h\"",
      "#include \"bmap.h\"",
      "#include \"nilfs.h\"",
      "#include <linux/errno.h>",
      "#include <linux/string.h>",
      "#include <linux/fs.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "nilfs_bmap_convert_error",
          "args": [
            "bmap",
            "__func__",
            "ret"
          ],
          "line": 108
        },
        "resolved": true,
        "details": {
          "function_name": "nilfs_bmap_convert_error",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/bmap.c",
          "lines": "42-53",
          "snippet": "static int nilfs_bmap_convert_error(struct nilfs_bmap *bmap,\n\t\t\t\t     const char *fname, int err)\n{\n\tstruct inode *inode = bmap->b_inode;\n\n\tif (err == -EINVAL) {\n\t\tnilfs_error(inode->i_sb, fname,\n\t\t\t    \"broken bmap (inode number=%lu)\\n\", inode->i_ino);\n\t\terr = -EIO;\n\t}\n\treturn err;\n}",
          "includes": [
            "#include \"alloc.h\"",
            "#include \"dat.h\"",
            "#include \"mdt.h\"",
            "#include \"btnode.h\"",
            "#include \"direct.h\"",
            "#include \"btree.h\"",
            "#include \"bmap.h\"",
            "#include \"nilfs.h\"",
            "#include <linux/errno.h>",
            "#include <linux/string.h>",
            "#include <linux/fs.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"alloc.h\"\n#include \"dat.h\"\n#include \"mdt.h\"\n#include \"btnode.h\"\n#include \"direct.h\"\n#include \"btree.h\"\n#include \"bmap.h\"\n#include \"nilfs.h\"\n#include <linux/errno.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n\nstatic int nilfs_bmap_convert_error(struct nilfs_bmap *bmap,\n\t\t\t\t     const char *fname, int err)\n{\n\tstruct inode *inode = bmap->b_inode;\n\n\tif (err == -EINVAL) {\n\t\tnilfs_error(inode->i_sb, fname,\n\t\t\t    \"broken bmap (inode number=%lu)\\n\", inode->i_ino);\n\t\terr = -EIO;\n\t}\n\treturn err;\n}"
        }
      },
      {
        "call_info": {
          "callee": "up_read",
          "args": [
            "&bmap->b_sem"
          ],
          "line": 106
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bmap->b_ops->bop_lookup_contig",
          "args": [
            "bmap",
            "key",
            "ptrp",
            "maxblocks"
          ],
          "line": 105
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "down_read",
          "args": [
            "&bmap->b_sem"
          ],
          "line": 104
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"alloc.h\"\n#include \"dat.h\"\n#include \"mdt.h\"\n#include \"btnode.h\"\n#include \"direct.h\"\n#include \"btree.h\"\n#include \"bmap.h\"\n#include \"nilfs.h\"\n#include <linux/errno.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n\nint nilfs_bmap_lookup_contig(struct nilfs_bmap *bmap, __u64 key, __u64 *ptrp,\n\t\t\t     unsigned maxblocks)\n{\n\tint ret;\n\n\tdown_read(&bmap->b_sem);\n\tret = bmap->b_ops->bop_lookup_contig(bmap, key, ptrp, maxblocks);\n\tup_read(&bmap->b_sem);\n\n\treturn nilfs_bmap_convert_error(bmap, __func__, ret);\n}"
  },
  {
    "function_name": "nilfs_bmap_lookup_at_level",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/bmap.c",
    "lines": "75-97",
    "snippet": "int nilfs_bmap_lookup_at_level(struct nilfs_bmap *bmap, __u64 key, int level,\n\t\t\t       __u64 *ptrp)\n{\n\tsector_t blocknr;\n\tint ret;\n\n\tdown_read(&bmap->b_sem);\n\tret = bmap->b_ops->bop_lookup(bmap, key, level, ptrp);\n\tif (ret < 0) {\n\t\tret = nilfs_bmap_convert_error(bmap, __func__, ret);\n\t\tgoto out;\n\t}\n\tif (NILFS_BMAP_USE_VBN(bmap)) {\n\t\tret = nilfs_dat_translate(nilfs_bmap_get_dat(bmap), *ptrp,\n\t\t\t\t\t  &blocknr);\n\t\tif (!ret)\n\t\t\t*ptrp = blocknr;\n\t}\n\n out:\n\tup_read(&bmap->b_sem);\n\treturn ret;\n}",
    "includes": [
      "#include \"alloc.h\"",
      "#include \"dat.h\"",
      "#include \"mdt.h\"",
      "#include \"btnode.h\"",
      "#include \"direct.h\"",
      "#include \"btree.h\"",
      "#include \"bmap.h\"",
      "#include \"nilfs.h\"",
      "#include <linux/errno.h>",
      "#include <linux/string.h>",
      "#include <linux/fs.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "up_read",
          "args": [
            "&bmap->b_sem"
          ],
          "line": 95
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "nilfs_dat_translate",
          "args": [
            "nilfs_bmap_get_dat(bmap)",
            "*ptrp",
            "&blocknr"
          ],
          "line": 88
        },
        "resolved": true,
        "details": {
          "function_name": "nilfs_dat_translate",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/dat.c",
          "lines": "397-431",
          "snippet": "int nilfs_dat_translate(struct inode *dat, __u64 vblocknr, sector_t *blocknrp)\n{\n\tstruct buffer_head *entry_bh, *bh;\n\tstruct nilfs_dat_entry *entry;\n\tsector_t blocknr;\n\tvoid *kaddr;\n\tint ret;\n\n\tret = nilfs_palloc_get_entry_block(dat, vblocknr, 0, &entry_bh);\n\tif (ret < 0)\n\t\treturn ret;\n\n\tif (!nilfs_doing_gc() && buffer_nilfs_redirected(entry_bh)) {\n\t\tbh = nilfs_mdt_get_frozen_buffer(dat, entry_bh);\n\t\tif (bh) {\n\t\t\tWARN_ON(!buffer_uptodate(bh));\n\t\t\tbrelse(entry_bh);\n\t\t\tentry_bh = bh;\n\t\t}\n\t}\n\n\tkaddr = kmap_atomic(entry_bh->b_page);\n\tentry = nilfs_palloc_block_get_entry(dat, vblocknr, entry_bh, kaddr);\n\tblocknr = le64_to_cpu(entry->de_blocknr);\n\tif (blocknr == 0) {\n\t\tret = -ENOENT;\n\t\tgoto out;\n\t}\n\t*blocknrp = blocknr;\n\n out:\n\tkunmap_atomic(kaddr);\n\tbrelse(entry_bh);\n\treturn ret;\n}",
          "includes": [
            "#include \"dat.h\"",
            "#include \"alloc.h\"",
            "#include \"mdt.h\"",
            "#include \"nilfs.h\"",
            "#include <linux/errno.h>",
            "#include <linux/string.h>",
            "#include <linux/buffer_head.h>",
            "#include <linux/types.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"dat.h\"\n#include \"alloc.h\"\n#include \"mdt.h\"\n#include \"nilfs.h\"\n#include <linux/errno.h>\n#include <linux/string.h>\n#include <linux/buffer_head.h>\n#include <linux/types.h>\n\nint nilfs_dat_translate(struct inode *dat, __u64 vblocknr, sector_t *blocknrp)\n{\n\tstruct buffer_head *entry_bh, *bh;\n\tstruct nilfs_dat_entry *entry;\n\tsector_t blocknr;\n\tvoid *kaddr;\n\tint ret;\n\n\tret = nilfs_palloc_get_entry_block(dat, vblocknr, 0, &entry_bh);\n\tif (ret < 0)\n\t\treturn ret;\n\n\tif (!nilfs_doing_gc() && buffer_nilfs_redirected(entry_bh)) {\n\t\tbh = nilfs_mdt_get_frozen_buffer(dat, entry_bh);\n\t\tif (bh) {\n\t\t\tWARN_ON(!buffer_uptodate(bh));\n\t\t\tbrelse(entry_bh);\n\t\t\tentry_bh = bh;\n\t\t}\n\t}\n\n\tkaddr = kmap_atomic(entry_bh->b_page);\n\tentry = nilfs_palloc_block_get_entry(dat, vblocknr, entry_bh, kaddr);\n\tblocknr = le64_to_cpu(entry->de_blocknr);\n\tif (blocknr == 0) {\n\t\tret = -ENOENT;\n\t\tgoto out;\n\t}\n\t*blocknrp = blocknr;\n\n out:\n\tkunmap_atomic(kaddr);\n\tbrelse(entry_bh);\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "nilfs_bmap_get_dat",
          "args": [
            "bmap"
          ],
          "line": 88
        },
        "resolved": true,
        "details": {
          "function_name": "nilfs_bmap_get_dat",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/bmap.c",
          "lines": "35-40",
          "snippet": "struct inode *nilfs_bmap_get_dat(const struct nilfs_bmap *bmap)\n{\n\tstruct the_nilfs *nilfs = bmap->b_inode->i_sb->s_fs_info;\n\n\treturn nilfs->ns_dat;\n}",
          "includes": [
            "#include \"alloc.h\"",
            "#include \"dat.h\"",
            "#include \"mdt.h\"",
            "#include \"btnode.h\"",
            "#include \"direct.h\"",
            "#include \"btree.h\"",
            "#include \"bmap.h\"",
            "#include \"nilfs.h\"",
            "#include <linux/errno.h>",
            "#include <linux/string.h>",
            "#include <linux/fs.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"alloc.h\"\n#include \"dat.h\"\n#include \"mdt.h\"\n#include \"btnode.h\"\n#include \"direct.h\"\n#include \"btree.h\"\n#include \"bmap.h\"\n#include \"nilfs.h\"\n#include <linux/errno.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n\nstruct inode *nilfs_bmap_get_dat(const struct nilfs_bmap *bmap)\n{\n\tstruct the_nilfs *nilfs = bmap->b_inode->i_sb->s_fs_info;\n\n\treturn nilfs->ns_dat;\n}"
        }
      },
      {
        "call_info": {
          "callee": "NILFS_BMAP_USE_VBN",
          "args": [
            "bmap"
          ],
          "line": 87
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "nilfs_bmap_convert_error",
          "args": [
            "bmap",
            "__func__",
            "ret"
          ],
          "line": 84
        },
        "resolved": true,
        "details": {
          "function_name": "nilfs_bmap_convert_error",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/bmap.c",
          "lines": "42-53",
          "snippet": "static int nilfs_bmap_convert_error(struct nilfs_bmap *bmap,\n\t\t\t\t     const char *fname, int err)\n{\n\tstruct inode *inode = bmap->b_inode;\n\n\tif (err == -EINVAL) {\n\t\tnilfs_error(inode->i_sb, fname,\n\t\t\t    \"broken bmap (inode number=%lu)\\n\", inode->i_ino);\n\t\terr = -EIO;\n\t}\n\treturn err;\n}",
          "includes": [
            "#include \"alloc.h\"",
            "#include \"dat.h\"",
            "#include \"mdt.h\"",
            "#include \"btnode.h\"",
            "#include \"direct.h\"",
            "#include \"btree.h\"",
            "#include \"bmap.h\"",
            "#include \"nilfs.h\"",
            "#include <linux/errno.h>",
            "#include <linux/string.h>",
            "#include <linux/fs.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"alloc.h\"\n#include \"dat.h\"\n#include \"mdt.h\"\n#include \"btnode.h\"\n#include \"direct.h\"\n#include \"btree.h\"\n#include \"bmap.h\"\n#include \"nilfs.h\"\n#include <linux/errno.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n\nstatic int nilfs_bmap_convert_error(struct nilfs_bmap *bmap,\n\t\t\t\t     const char *fname, int err)\n{\n\tstruct inode *inode = bmap->b_inode;\n\n\tif (err == -EINVAL) {\n\t\tnilfs_error(inode->i_sb, fname,\n\t\t\t    \"broken bmap (inode number=%lu)\\n\", inode->i_ino);\n\t\terr = -EIO;\n\t}\n\treturn err;\n}"
        }
      },
      {
        "call_info": {
          "callee": "bmap->b_ops->bop_lookup",
          "args": [
            "bmap",
            "key",
            "level",
            "ptrp"
          ],
          "line": 82
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "down_read",
          "args": [
            "&bmap->b_sem"
          ],
          "line": 81
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"alloc.h\"\n#include \"dat.h\"\n#include \"mdt.h\"\n#include \"btnode.h\"\n#include \"direct.h\"\n#include \"btree.h\"\n#include \"bmap.h\"\n#include \"nilfs.h\"\n#include <linux/errno.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n\nint nilfs_bmap_lookup_at_level(struct nilfs_bmap *bmap, __u64 key, int level,\n\t\t\t       __u64 *ptrp)\n{\n\tsector_t blocknr;\n\tint ret;\n\n\tdown_read(&bmap->b_sem);\n\tret = bmap->b_ops->bop_lookup(bmap, key, level, ptrp);\n\tif (ret < 0) {\n\t\tret = nilfs_bmap_convert_error(bmap, __func__, ret);\n\t\tgoto out;\n\t}\n\tif (NILFS_BMAP_USE_VBN(bmap)) {\n\t\tret = nilfs_dat_translate(nilfs_bmap_get_dat(bmap), *ptrp,\n\t\t\t\t\t  &blocknr);\n\t\tif (!ret)\n\t\t\t*ptrp = blocknr;\n\t}\n\n out:\n\tup_read(&bmap->b_sem);\n\treturn ret;\n}"
  },
  {
    "function_name": "nilfs_bmap_convert_error",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/bmap.c",
    "lines": "42-53",
    "snippet": "static int nilfs_bmap_convert_error(struct nilfs_bmap *bmap,\n\t\t\t\t     const char *fname, int err)\n{\n\tstruct inode *inode = bmap->b_inode;\n\n\tif (err == -EINVAL) {\n\t\tnilfs_error(inode->i_sb, fname,\n\t\t\t    \"broken bmap (inode number=%lu)\\n\", inode->i_ino);\n\t\terr = -EIO;\n\t}\n\treturn err;\n}",
    "includes": [
      "#include \"alloc.h\"",
      "#include \"dat.h\"",
      "#include \"mdt.h\"",
      "#include \"btnode.h\"",
      "#include \"direct.h\"",
      "#include \"btree.h\"",
      "#include \"bmap.h\"",
      "#include \"nilfs.h\"",
      "#include <linux/errno.h>",
      "#include <linux/string.h>",
      "#include <linux/fs.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "nilfs_error",
          "args": [
            "inode->i_sb",
            "fname",
            "\"broken bmap (inode number=%lu)\\n\"",
            "inode->i_ino"
          ],
          "line": 48
        },
        "resolved": true,
        "details": {
          "function_name": "nilfs_error",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/super.c",
          "lines": "109-138",
          "snippet": "void nilfs_error(struct super_block *sb, const char *function,\n\t\t const char *fmt, ...)\n{\n\tstruct the_nilfs *nilfs = sb->s_fs_info;\n\tstruct va_format vaf;\n\tva_list args;\n\n\tva_start(args, fmt);\n\n\tvaf.fmt = fmt;\n\tvaf.va = &args;\n\n\tprintk(KERN_CRIT \"NILFS error (device %s): %s: %pV\\n\",\n\t       sb->s_id, function, &vaf);\n\n\tva_end(args);\n\n\tif (!(sb->s_flags & MS_RDONLY)) {\n\t\tnilfs_set_error(sb);\n\n\t\tif (nilfs_test_opt(nilfs, ERRORS_RO)) {\n\t\t\tprintk(KERN_CRIT \"Remounting filesystem read-only\\n\");\n\t\t\tsb->s_flags |= MS_RDONLY;\n\t\t}\n\t}\n\n\tif (nilfs_test_opt(nilfs, ERRORS_PANIC))\n\t\tpanic(\"NILFS (device %s): panic forced after error\\n\",\n\t\t      sb->s_id);\n}",
          "includes": [
            "#include \"segbuf.h\"",
            "#include \"segment.h\"",
            "#include \"dat.h\"",
            "#include \"ifile.h\"",
            "#include \"sufile.h\" /* nilfs_sufile_resize(), nilfs_sufile_set_alloc_range() */",
            "#include \"cpfile.h\"",
            "#include \"page.h\"",
            "#include \"btnode.h\"",
            "#include \"btree.h\"",
            "#include \"alloc.h\"",
            "#include \"mdt.h\"",
            "#include \"export.h\"",
            "#include \"nilfs.h\"",
            "#include <linux/mount.h>",
            "#include <linux/seq_file.h>",
            "#include <linux/writeback.h>",
            "#include <linux/vfs.h>",
            "#include <linux/crc32.h>",
            "#include <linux/parser.h>",
            "#include <linux/blkdev.h>",
            "#include <linux/init.h>",
            "#include <linux/slab.h>",
            "#include <linux/string.h>",
            "#include <linux/module.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"segbuf.h\"\n#include \"segment.h\"\n#include \"dat.h\"\n#include \"ifile.h\"\n#include \"sufile.h\" /* nilfs_sufile_resize(), nilfs_sufile_set_alloc_range() */\n#include \"cpfile.h\"\n#include \"page.h\"\n#include \"btnode.h\"\n#include \"btree.h\"\n#include \"alloc.h\"\n#include \"mdt.h\"\n#include \"export.h\"\n#include \"nilfs.h\"\n#include <linux/mount.h>\n#include <linux/seq_file.h>\n#include <linux/writeback.h>\n#include <linux/vfs.h>\n#include <linux/crc32.h>\n#include <linux/parser.h>\n#include <linux/blkdev.h>\n#include <linux/init.h>\n#include <linux/slab.h>\n#include <linux/string.h>\n#include <linux/module.h>\n\nvoid nilfs_error(struct super_block *sb, const char *function,\n\t\t const char *fmt, ...)\n{\n\tstruct the_nilfs *nilfs = sb->s_fs_info;\n\tstruct va_format vaf;\n\tva_list args;\n\n\tva_start(args, fmt);\n\n\tvaf.fmt = fmt;\n\tvaf.va = &args;\n\n\tprintk(KERN_CRIT \"NILFS error (device %s): %s: %pV\\n\",\n\t       sb->s_id, function, &vaf);\n\n\tva_end(args);\n\n\tif (!(sb->s_flags & MS_RDONLY)) {\n\t\tnilfs_set_error(sb);\n\n\t\tif (nilfs_test_opt(nilfs, ERRORS_RO)) {\n\t\t\tprintk(KERN_CRIT \"Remounting filesystem read-only\\n\");\n\t\t\tsb->s_flags |= MS_RDONLY;\n\t\t}\n\t}\n\n\tif (nilfs_test_opt(nilfs, ERRORS_PANIC))\n\t\tpanic(\"NILFS (device %s): panic forced after error\\n\",\n\t\t      sb->s_id);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"alloc.h\"\n#include \"dat.h\"\n#include \"mdt.h\"\n#include \"btnode.h\"\n#include \"direct.h\"\n#include \"btree.h\"\n#include \"bmap.h\"\n#include \"nilfs.h\"\n#include <linux/errno.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n\nstatic int nilfs_bmap_convert_error(struct nilfs_bmap *bmap,\n\t\t\t\t     const char *fname, int err)\n{\n\tstruct inode *inode = bmap->b_inode;\n\n\tif (err == -EINVAL) {\n\t\tnilfs_error(inode->i_sb, fname,\n\t\t\t    \"broken bmap (inode number=%lu)\\n\", inode->i_ino);\n\t\terr = -EIO;\n\t}\n\treturn err;\n}"
  },
  {
    "function_name": "nilfs_bmap_get_dat",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nilfs2/bmap.c",
    "lines": "35-40",
    "snippet": "struct inode *nilfs_bmap_get_dat(const struct nilfs_bmap *bmap)\n{\n\tstruct the_nilfs *nilfs = bmap->b_inode->i_sb->s_fs_info;\n\n\treturn nilfs->ns_dat;\n}",
    "includes": [
      "#include \"alloc.h\"",
      "#include \"dat.h\"",
      "#include \"mdt.h\"",
      "#include \"btnode.h\"",
      "#include \"direct.h\"",
      "#include \"btree.h\"",
      "#include \"bmap.h\"",
      "#include \"nilfs.h\"",
      "#include <linux/errno.h>",
      "#include <linux/string.h>",
      "#include <linux/fs.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"alloc.h\"\n#include \"dat.h\"\n#include \"mdt.h\"\n#include \"btnode.h\"\n#include \"direct.h\"\n#include \"btree.h\"\n#include \"bmap.h\"\n#include \"nilfs.h\"\n#include <linux/errno.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n\nstruct inode *nilfs_bmap_get_dat(const struct nilfs_bmap *bmap)\n{\n\tstruct the_nilfs *nilfs = bmap->b_inode->i_sb->s_fs_info;\n\n\treturn nilfs->ns_dat;\n}"
  }
]