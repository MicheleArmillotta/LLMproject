[
  {
    "function_name": "exit_aout_binfmt",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/binfmt_aout.c",
    "lines": "416-419",
    "snippet": "static void __exit exit_aout_binfmt(void)\n{\n\tunregister_binfmt(&aout_format);\n}",
    "includes": [
      "#include <asm/a.out-core.h>",
      "#include <asm/cacheflush.h>",
      "#include <asm/uaccess.h>",
      "#include <linux/slab.h>",
      "#include <linux/coredump.h>",
      "#include <linux/init.h>",
      "#include <linux/personality.h>",
      "#include <linux/binfmts.h>",
      "#include <linux/user.h>",
      "#include <linux/ptrace.h>",
      "#include <linux/fcntl.h>",
      "#include <linux/stat.h>",
      "#include <linux/file.h>",
      "#include <linux/fs.h>",
      "#include <linux/string.h>",
      "#include <linux/signal.h>",
      "#include <linux/errno.h>",
      "#include <linux/a.out.h>",
      "#include <linux/mman.h>",
      "#include <linux/mm.h>",
      "#include <linux/kernel.h>",
      "#include <linux/time.h>",
      "#include <linux/module.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static struct linux_binfmt aout_format = {\n\t.module\t\t= THIS_MODULE,\n\t.load_binary\t= load_aout_binary,\n\t.load_shlib\t= load_aout_library,\n\t.core_dump\t= aout_core_dump,\n\t.min_coredump\t= PAGE_SIZE\n};"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "unregister_binfmt",
          "args": [
            "&aout_format"
          ],
          "line": 418
        },
        "resolved": true,
        "details": {
          "function_name": "unregister_binfmt",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/exec.c",
          "lines": "87-92",
          "snippet": "void unregister_binfmt(struct linux_binfmt * fmt)\n{\n\twrite_lock(&binfmt_lock);\n\tlist_del(&fmt->lh);\n\twrite_unlock(&binfmt_lock);\n}",
          "includes": [
            "#include <trace/events/sched.h>",
            "#include \"internal.h\"",
            "#include <trace/events/task.h>",
            "#include <asm/tlb.h>",
            "#include <asm/mmu_context.h>",
            "#include <asm/uaccess.h>",
            "#include <linux/compat.h>",
            "#include <linux/oom.h>",
            "#include <linux/pipe_fs_i.h>",
            "#include <linux/fs_struct.h>",
            "#include <linux/fsnotify.h>",
            "#include <linux/kmod.h>",
            "#include <linux/tracehook.h>",
            "#include <linux/audit.h>",
            "#include <linux/cn_proc.h>",
            "#include <linux/tsacct_kern.h>",
            "#include <linux/syscalls.h>",
            "#include <linux/security.h>",
            "#include <linux/mount.h>",
            "#include <linux/namei.h>",
            "#include <linux/module.h>",
            "#include <linux/pid_namespace.h>",
            "#include <linux/utsname.h>",
            "#include <linux/binfmts.h>",
            "#include <linux/personality.h>",
            "#include <linux/key.h>",
            "#include <linux/spinlock.h>",
            "#include <linux/highmem.h>",
            "#include <linux/perf_event.h>",
            "#include <linux/pagemap.h>",
            "#include <linux/init.h>",
            "#include <linux/string.h>",
            "#include <linux/swap.h>",
            "#include <linux/fcntl.h>",
            "#include <linux/stat.h>",
            "#include <linux/vmacache.h>",
            "#include <linux/mm.h>",
            "#include <linux/fdtable.h>",
            "#include <linux/file.h>",
            "#include <linux/slab.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static DEFINE_RWLOCK(binfmt_lock);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <trace/events/sched.h>\n#include \"internal.h\"\n#include <trace/events/task.h>\n#include <asm/tlb.h>\n#include <asm/mmu_context.h>\n#include <asm/uaccess.h>\n#include <linux/compat.h>\n#include <linux/oom.h>\n#include <linux/pipe_fs_i.h>\n#include <linux/fs_struct.h>\n#include <linux/fsnotify.h>\n#include <linux/kmod.h>\n#include <linux/tracehook.h>\n#include <linux/audit.h>\n#include <linux/cn_proc.h>\n#include <linux/tsacct_kern.h>\n#include <linux/syscalls.h>\n#include <linux/security.h>\n#include <linux/mount.h>\n#include <linux/namei.h>\n#include <linux/module.h>\n#include <linux/pid_namespace.h>\n#include <linux/utsname.h>\n#include <linux/binfmts.h>\n#include <linux/personality.h>\n#include <linux/key.h>\n#include <linux/spinlock.h>\n#include <linux/highmem.h>\n#include <linux/perf_event.h>\n#include <linux/pagemap.h>\n#include <linux/init.h>\n#include <linux/string.h>\n#include <linux/swap.h>\n#include <linux/fcntl.h>\n#include <linux/stat.h>\n#include <linux/vmacache.h>\n#include <linux/mm.h>\n#include <linux/fdtable.h>\n#include <linux/file.h>\n#include <linux/slab.h>\n\nstatic DEFINE_RWLOCK(binfmt_lock);\n\nvoid unregister_binfmt(struct linux_binfmt * fmt)\n{\n\twrite_lock(&binfmt_lock);\n\tlist_del(&fmt->lh);\n\twrite_unlock(&binfmt_lock);\n}"
        }
      }
    ],
    "contextual_snippet": "#include <asm/a.out-core.h>\n#include <asm/cacheflush.h>\n#include <asm/uaccess.h>\n#include <linux/slab.h>\n#include <linux/coredump.h>\n#include <linux/init.h>\n#include <linux/personality.h>\n#include <linux/binfmts.h>\n#include <linux/user.h>\n#include <linux/ptrace.h>\n#include <linux/fcntl.h>\n#include <linux/stat.h>\n#include <linux/file.h>\n#include <linux/fs.h>\n#include <linux/string.h>\n#include <linux/signal.h>\n#include <linux/errno.h>\n#include <linux/a.out.h>\n#include <linux/mman.h>\n#include <linux/mm.h>\n#include <linux/kernel.h>\n#include <linux/time.h>\n#include <linux/module.h>\n\nstatic struct linux_binfmt aout_format = {\n\t.module\t\t= THIS_MODULE,\n\t.load_binary\t= load_aout_binary,\n\t.load_shlib\t= load_aout_library,\n\t.core_dump\t= aout_core_dump,\n\t.min_coredump\t= PAGE_SIZE\n};\n\nstatic void __exit exit_aout_binfmt(void)\n{\n\tunregister_binfmt(&aout_format);\n}"
  },
  {
    "function_name": "init_aout_binfmt",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/binfmt_aout.c",
    "lines": "410-414",
    "snippet": "static int __init init_aout_binfmt(void)\n{\n\tregister_binfmt(&aout_format);\n\treturn 0;\n}",
    "includes": [
      "#include <asm/a.out-core.h>",
      "#include <asm/cacheflush.h>",
      "#include <asm/uaccess.h>",
      "#include <linux/slab.h>",
      "#include <linux/coredump.h>",
      "#include <linux/init.h>",
      "#include <linux/personality.h>",
      "#include <linux/binfmts.h>",
      "#include <linux/user.h>",
      "#include <linux/ptrace.h>",
      "#include <linux/fcntl.h>",
      "#include <linux/stat.h>",
      "#include <linux/file.h>",
      "#include <linux/fs.h>",
      "#include <linux/string.h>",
      "#include <linux/signal.h>",
      "#include <linux/errno.h>",
      "#include <linux/a.out.h>",
      "#include <linux/mman.h>",
      "#include <linux/mm.h>",
      "#include <linux/kernel.h>",
      "#include <linux/time.h>",
      "#include <linux/module.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static struct linux_binfmt aout_format = {\n\t.module\t\t= THIS_MODULE,\n\t.load_binary\t= load_aout_binary,\n\t.load_shlib\t= load_aout_library,\n\t.core_dump\t= aout_core_dump,\n\t.min_coredump\t= PAGE_SIZE\n};"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "register_binfmt",
          "args": [
            "&aout_format"
          ],
          "line": 412
        },
        "resolved": true,
        "details": {
          "function_name": "unregister_binfmt",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/exec.c",
          "lines": "87-92",
          "snippet": "void unregister_binfmt(struct linux_binfmt * fmt)\n{\n\twrite_lock(&binfmt_lock);\n\tlist_del(&fmt->lh);\n\twrite_unlock(&binfmt_lock);\n}",
          "includes": [
            "#include <trace/events/sched.h>",
            "#include \"internal.h\"",
            "#include <trace/events/task.h>",
            "#include <asm/tlb.h>",
            "#include <asm/mmu_context.h>",
            "#include <asm/uaccess.h>",
            "#include <linux/compat.h>",
            "#include <linux/oom.h>",
            "#include <linux/pipe_fs_i.h>",
            "#include <linux/fs_struct.h>",
            "#include <linux/fsnotify.h>",
            "#include <linux/kmod.h>",
            "#include <linux/tracehook.h>",
            "#include <linux/audit.h>",
            "#include <linux/cn_proc.h>",
            "#include <linux/tsacct_kern.h>",
            "#include <linux/syscalls.h>",
            "#include <linux/security.h>",
            "#include <linux/mount.h>",
            "#include <linux/namei.h>",
            "#include <linux/module.h>",
            "#include <linux/pid_namespace.h>",
            "#include <linux/utsname.h>",
            "#include <linux/binfmts.h>",
            "#include <linux/personality.h>",
            "#include <linux/key.h>",
            "#include <linux/spinlock.h>",
            "#include <linux/highmem.h>",
            "#include <linux/perf_event.h>",
            "#include <linux/pagemap.h>",
            "#include <linux/init.h>",
            "#include <linux/string.h>",
            "#include <linux/swap.h>",
            "#include <linux/fcntl.h>",
            "#include <linux/stat.h>",
            "#include <linux/vmacache.h>",
            "#include <linux/mm.h>",
            "#include <linux/fdtable.h>",
            "#include <linux/file.h>",
            "#include <linux/slab.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static DEFINE_RWLOCK(binfmt_lock);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <trace/events/sched.h>\n#include \"internal.h\"\n#include <trace/events/task.h>\n#include <asm/tlb.h>\n#include <asm/mmu_context.h>\n#include <asm/uaccess.h>\n#include <linux/compat.h>\n#include <linux/oom.h>\n#include <linux/pipe_fs_i.h>\n#include <linux/fs_struct.h>\n#include <linux/fsnotify.h>\n#include <linux/kmod.h>\n#include <linux/tracehook.h>\n#include <linux/audit.h>\n#include <linux/cn_proc.h>\n#include <linux/tsacct_kern.h>\n#include <linux/syscalls.h>\n#include <linux/security.h>\n#include <linux/mount.h>\n#include <linux/namei.h>\n#include <linux/module.h>\n#include <linux/pid_namespace.h>\n#include <linux/utsname.h>\n#include <linux/binfmts.h>\n#include <linux/personality.h>\n#include <linux/key.h>\n#include <linux/spinlock.h>\n#include <linux/highmem.h>\n#include <linux/perf_event.h>\n#include <linux/pagemap.h>\n#include <linux/init.h>\n#include <linux/string.h>\n#include <linux/swap.h>\n#include <linux/fcntl.h>\n#include <linux/stat.h>\n#include <linux/vmacache.h>\n#include <linux/mm.h>\n#include <linux/fdtable.h>\n#include <linux/file.h>\n#include <linux/slab.h>\n\nstatic DEFINE_RWLOCK(binfmt_lock);\n\nvoid unregister_binfmt(struct linux_binfmt * fmt)\n{\n\twrite_lock(&binfmt_lock);\n\tlist_del(&fmt->lh);\n\twrite_unlock(&binfmt_lock);\n}"
        }
      }
    ],
    "contextual_snippet": "#include <asm/a.out-core.h>\n#include <asm/cacheflush.h>\n#include <asm/uaccess.h>\n#include <linux/slab.h>\n#include <linux/coredump.h>\n#include <linux/init.h>\n#include <linux/personality.h>\n#include <linux/binfmts.h>\n#include <linux/user.h>\n#include <linux/ptrace.h>\n#include <linux/fcntl.h>\n#include <linux/stat.h>\n#include <linux/file.h>\n#include <linux/fs.h>\n#include <linux/string.h>\n#include <linux/signal.h>\n#include <linux/errno.h>\n#include <linux/a.out.h>\n#include <linux/mman.h>\n#include <linux/mm.h>\n#include <linux/kernel.h>\n#include <linux/time.h>\n#include <linux/module.h>\n\nstatic struct linux_binfmt aout_format = {\n\t.module\t\t= THIS_MODULE,\n\t.load_binary\t= load_aout_binary,\n\t.load_shlib\t= load_aout_library,\n\t.core_dump\t= aout_core_dump,\n\t.min_coredump\t= PAGE_SIZE\n};\n\nstatic int __init init_aout_binfmt(void)\n{\n\tregister_binfmt(&aout_format);\n\treturn 0;\n}"
  },
  {
    "function_name": "load_aout_library",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/binfmt_aout.c",
    "lines": "337-408",
    "snippet": "static int load_aout_library(struct file *file)\n{\n\tstruct inode * inode;\n\tunsigned long bss, start_addr, len;\n\tunsigned long error;\n\tint retval;\n\tstruct exec ex;\n\n\tinode = file_inode(file);\n\n\tretval = -ENOEXEC;\n\terror = kernel_read(file, 0, (char *) &ex, sizeof(ex));\n\tif (error != sizeof(ex))\n\t\tgoto out;\n\n\t/* We come in here for the regular a.out style of shared libraries */\n\tif ((N_MAGIC(ex) != ZMAGIC && N_MAGIC(ex) != QMAGIC) || N_TRSIZE(ex) ||\n\t    N_DRSIZE(ex) || ((ex.a_entry & 0xfff) && N_MAGIC(ex) == ZMAGIC) ||\n\t    i_size_read(inode) < ex.a_text+ex.a_data+N_SYMSIZE(ex)+N_TXTOFF(ex)) {\n\t\tgoto out;\n\t}\n\n\t/*\n\t * Requires a mmap handler. This prevents people from using a.out\n\t * as part of an exploit attack against /proc-related vulnerabilities.\n\t */\n\tif (!file->f_op->mmap)\n\t\tgoto out;\n\n\tif (N_FLAGS(ex))\n\t\tgoto out;\n\n\t/* For  QMAGIC, the starting address is 0x20 into the page.  We mask\n\t   this off to get the starting address for the page */\n\n\tstart_addr =  ex.a_entry & 0xfffff000;\n\n\tif ((N_TXTOFF(ex) & ~PAGE_MASK) != 0) {\n\t\tif (printk_ratelimit())\n\t\t{\n\t\t\tprintk(KERN_WARNING \n\t\t\t       \"N_TXTOFF is not page aligned. Please convert library: %pD\\n\",\n\t\t\t       file);\n\t\t}\n\t\tvm_brk(start_addr, ex.a_text + ex.a_data + ex.a_bss);\n\t\t\n\t\tread_code(file, start_addr, N_TXTOFF(ex),\n\t\t\t  ex.a_text + ex.a_data);\n\t\tretval = 0;\n\t\tgoto out;\n\t}\n\t/* Now use mmap to map the library into memory. */\n\terror = vm_mmap(file, start_addr, ex.a_text + ex.a_data,\n\t\t\tPROT_READ | PROT_WRITE | PROT_EXEC,\n\t\t\tMAP_FIXED | MAP_PRIVATE | MAP_DENYWRITE,\n\t\t\tN_TXTOFF(ex));\n\tretval = error;\n\tif (error != start_addr)\n\t\tgoto out;\n\n\tlen = PAGE_ALIGN(ex.a_text + ex.a_data);\n\tbss = ex.a_text + ex.a_data + ex.a_bss;\n\tif (bss > len) {\n\t\terror = vm_brk(start_addr + len, bss - len);\n\t\tretval = error;\n\t\tif (error != start_addr + len)\n\t\t\tgoto out;\n\t}\n\tretval = 0;\nout:\n\treturn retval;\n}",
    "includes": [
      "#include <asm/a.out-core.h>",
      "#include <asm/cacheflush.h>",
      "#include <asm/uaccess.h>",
      "#include <linux/slab.h>",
      "#include <linux/coredump.h>",
      "#include <linux/init.h>",
      "#include <linux/personality.h>",
      "#include <linux/binfmts.h>",
      "#include <linux/user.h>",
      "#include <linux/ptrace.h>",
      "#include <linux/fcntl.h>",
      "#include <linux/stat.h>",
      "#include <linux/file.h>",
      "#include <linux/fs.h>",
      "#include <linux/string.h>",
      "#include <linux/signal.h>",
      "#include <linux/errno.h>",
      "#include <linux/a.out.h>",
      "#include <linux/mman.h>",
      "#include <linux/mm.h>",
      "#include <linux/kernel.h>",
      "#include <linux/time.h>",
      "#include <linux/module.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static int load_aout_library(struct file*);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "vm_brk",
          "args": [
            "start_addr + len",
            "bss - len"
          ],
          "line": 400
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "PAGE_ALIGN",
          "args": [
            "ex.a_text + ex.a_data"
          ],
          "line": 397
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "vm_mmap",
          "args": [
            "file",
            "start_addr",
            "ex.a_text + ex.a_data",
            "PROT_READ | PROT_WRITE | PROT_EXEC",
            "MAP_FIXED | MAP_PRIVATE | MAP_DENYWRITE",
            "N_TXTOFF(ex)"
          ],
          "line": 389
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "N_TXTOFF",
          "args": [
            "ex"
          ],
          "line": 392
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "read_code",
          "args": [
            "file",
            "start_addr",
            "N_TXTOFF(ex)",
            "ex.a_text + ex.a_data"
          ],
          "line": 383
        },
        "resolved": true,
        "details": {
          "function_name": "read_code",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/exec.c",
          "lines": "825-831",
          "snippet": "ssize_t read_code(struct file *file, unsigned long addr, loff_t pos, size_t len)\n{\n\tssize_t res = vfs_read(file, (void __user *)addr, len, &pos);\n\tif (res > 0)\n\t\tflush_icache_range(addr, addr + len);\n\treturn res;\n}",
          "includes": [
            "#include <trace/events/sched.h>",
            "#include \"internal.h\"",
            "#include <trace/events/task.h>",
            "#include <asm/tlb.h>",
            "#include <asm/mmu_context.h>",
            "#include <asm/uaccess.h>",
            "#include <linux/compat.h>",
            "#include <linux/oom.h>",
            "#include <linux/pipe_fs_i.h>",
            "#include <linux/fs_struct.h>",
            "#include <linux/fsnotify.h>",
            "#include <linux/kmod.h>",
            "#include <linux/tracehook.h>",
            "#include <linux/audit.h>",
            "#include <linux/cn_proc.h>",
            "#include <linux/tsacct_kern.h>",
            "#include <linux/syscalls.h>",
            "#include <linux/security.h>",
            "#include <linux/mount.h>",
            "#include <linux/namei.h>",
            "#include <linux/module.h>",
            "#include <linux/pid_namespace.h>",
            "#include <linux/utsname.h>",
            "#include <linux/binfmts.h>",
            "#include <linux/personality.h>",
            "#include <linux/key.h>",
            "#include <linux/spinlock.h>",
            "#include <linux/highmem.h>",
            "#include <linux/perf_event.h>",
            "#include <linux/pagemap.h>",
            "#include <linux/init.h>",
            "#include <linux/string.h>",
            "#include <linux/swap.h>",
            "#include <linux/fcntl.h>",
            "#include <linux/stat.h>",
            "#include <linux/vmacache.h>",
            "#include <linux/mm.h>",
            "#include <linux/fdtable.h>",
            "#include <linux/file.h>",
            "#include <linux/slab.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <trace/events/sched.h>\n#include \"internal.h\"\n#include <trace/events/task.h>\n#include <asm/tlb.h>\n#include <asm/mmu_context.h>\n#include <asm/uaccess.h>\n#include <linux/compat.h>\n#include <linux/oom.h>\n#include <linux/pipe_fs_i.h>\n#include <linux/fs_struct.h>\n#include <linux/fsnotify.h>\n#include <linux/kmod.h>\n#include <linux/tracehook.h>\n#include <linux/audit.h>\n#include <linux/cn_proc.h>\n#include <linux/tsacct_kern.h>\n#include <linux/syscalls.h>\n#include <linux/security.h>\n#include <linux/mount.h>\n#include <linux/namei.h>\n#include <linux/module.h>\n#include <linux/pid_namespace.h>\n#include <linux/utsname.h>\n#include <linux/binfmts.h>\n#include <linux/personality.h>\n#include <linux/key.h>\n#include <linux/spinlock.h>\n#include <linux/highmem.h>\n#include <linux/perf_event.h>\n#include <linux/pagemap.h>\n#include <linux/init.h>\n#include <linux/string.h>\n#include <linux/swap.h>\n#include <linux/fcntl.h>\n#include <linux/stat.h>\n#include <linux/vmacache.h>\n#include <linux/mm.h>\n#include <linux/fdtable.h>\n#include <linux/file.h>\n#include <linux/slab.h>\n\nssize_t read_code(struct file *file, unsigned long addr, loff_t pos, size_t len)\n{\n\tssize_t res = vfs_read(file, (void __user *)addr, len, &pos);\n\tif (res > 0)\n\t\tflush_icache_range(addr, addr + len);\n\treturn res;\n}"
        }
      },
      {
        "call_info": {
          "callee": "N_TXTOFF",
          "args": [
            "ex"
          ],
          "line": 383
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "vm_brk",
          "args": [
            "start_addr",
            "ex.a_text + ex.a_data + ex.a_bss"
          ],
          "line": 381
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "printk",
          "args": [
            "KERN_WARNING \n\t\t\t       \"N_TXTOFF is not page aligned. Please convert library: %pD\\n\"",
            "file"
          ],
          "line": 377
        },
        "resolved": true,
        "details": {
          "function_name": "compat_printk",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/compat.c",
          "lines": "59-69",
          "snippet": "int compat_printk(const char *fmt, ...)\n{\n\tva_list ap;\n\tint ret;\n\tif (!compat_log)\n\t\treturn 0;\n\tva_start(ap, fmt);\n\tret = vprintk(fmt, ap);\n\tva_end(ap);\n\treturn ret;\n}",
          "includes": [
            "#include \"internal.h\"",
            "#include <asm/ioctls.h>",
            "#include <asm/mmu_context.h>",
            "#include <asm/uaccess.h>",
            "#include <linux/aio.h>",
            "#include <linux/pagemap.h>",
            "#include <linux/slab.h>",
            "#include <linux/fs_struct.h>",
            "#include <linux/mm.h>",
            "#include <linux/poll.h>",
            "#include <linux/signal.h>",
            "#include <linux/highmem.h>",
            "#include <linux/security.h>",
            "#include <linux/tsacct_kern.h>",
            "#include <linux/rwsem.h>",
            "#include <linux/personality.h>",
            "#include <linux/highuid.h>",
            "#include <linux/fsnotify.h>",
            "#include <linux/dirent.h>",
            "#include <linux/ctype.h>",
            "#include <linux/syscalls.h>",
            "#include <linux/nfs4_mount.h>",
            "#include <linux/ncp_mount.h>",
            "#include <linux/init.h>",
            "#include <linux/ioctl.h>",
            "#include <linux/vfs.h>",
            "#include <linux/fdtable.h>",
            "#include <linux/file.h>",
            "#include <linux/namei.h>",
            "#include <linux/fcntl.h>",
            "#include <linux/fs.h>",
            "#include <linux/time.h>",
            "#include <linux/errno.h>",
            "#include <linux/compat.h>",
            "#include <linux/linkage.h>",
            "#include <linux/kernel.h>",
            "#include <linux/stddef.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "int compat_log = 1;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"internal.h\"\n#include <asm/ioctls.h>\n#include <asm/mmu_context.h>\n#include <asm/uaccess.h>\n#include <linux/aio.h>\n#include <linux/pagemap.h>\n#include <linux/slab.h>\n#include <linux/fs_struct.h>\n#include <linux/mm.h>\n#include <linux/poll.h>\n#include <linux/signal.h>\n#include <linux/highmem.h>\n#include <linux/security.h>\n#include <linux/tsacct_kern.h>\n#include <linux/rwsem.h>\n#include <linux/personality.h>\n#include <linux/highuid.h>\n#include <linux/fsnotify.h>\n#include <linux/dirent.h>\n#include <linux/ctype.h>\n#include <linux/syscalls.h>\n#include <linux/nfs4_mount.h>\n#include <linux/ncp_mount.h>\n#include <linux/init.h>\n#include <linux/ioctl.h>\n#include <linux/vfs.h>\n#include <linux/fdtable.h>\n#include <linux/file.h>\n#include <linux/namei.h>\n#include <linux/fcntl.h>\n#include <linux/fs.h>\n#include <linux/time.h>\n#include <linux/errno.h>\n#include <linux/compat.h>\n#include <linux/linkage.h>\n#include <linux/kernel.h>\n#include <linux/stddef.h>\n\nint compat_log = 1;\n\nint compat_printk(const char *fmt, ...)\n{\n\tva_list ap;\n\tint ret;\n\tif (!compat_log)\n\t\treturn 0;\n\tva_start(ap, fmt);\n\tret = vprintk(fmt, ap);\n\tva_end(ap);\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "printk_ratelimit",
          "args": [],
          "line": 375
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "N_TXTOFF",
          "args": [
            "ex"
          ],
          "line": 374
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "N_FLAGS",
          "args": [
            "ex"
          ],
          "line": 366
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "N_TXTOFF",
          "args": [
            "ex"
          ],
          "line": 355
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "N_SYMSIZE",
          "args": [
            "ex"
          ],
          "line": 355
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "i_size_read",
          "args": [
            "inode"
          ],
          "line": 355
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "N_MAGIC",
          "args": [
            "ex"
          ],
          "line": 354
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "N_DRSIZE",
          "args": [
            "ex"
          ],
          "line": 354
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "N_TRSIZE",
          "args": [
            "ex"
          ],
          "line": 353
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "N_MAGIC",
          "args": [
            "ex"
          ],
          "line": 353
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "N_MAGIC",
          "args": [
            "ex"
          ],
          "line": 353
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kernel_read",
          "args": [
            "file",
            "0",
            "(char *) &ex",
            "sizeof(ex)"
          ],
          "line": 348
        },
        "resolved": true,
        "details": {
          "function_name": "kernel_readv",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/splice.c",
          "lines": "569-583",
          "snippet": "static ssize_t kernel_readv(struct file *file, const struct iovec *vec,\n\t\t\t    unsigned long vlen, loff_t offset)\n{\n\tmm_segment_t old_fs;\n\tloff_t pos = offset;\n\tssize_t res;\n\n\told_fs = get_fs();\n\tset_fs(get_ds());\n\t/* The cast to a user pointer is valid due to the set_fs() */\n\tres = vfs_readv(file, (const struct iovec __user *)vec, vlen, &pos);\n\tset_fs(old_fs);\n\n\treturn res;\n}",
          "includes": [
            "#include \"internal.h\"",
            "#include <linux/aio.h>",
            "#include <linux/compat.h>",
            "#include <linux/socket.h>",
            "#include <linux/gfp.h>",
            "#include <linux/security.h>",
            "#include <linux/uio.h>",
            "#include <linux/syscalls.h>",
            "#include <linux/export.h>",
            "#include <linux/writeback.h>",
            "#include <linux/swap.h>",
            "#include <linux/mm_inline.h>",
            "#include <linux/memcontrol.h>",
            "#include <linux/splice.h>",
            "#include <linux/pagemap.h>",
            "#include <linux/file.h>",
            "#include <linux/fs.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"internal.h\"\n#include <linux/aio.h>\n#include <linux/compat.h>\n#include <linux/socket.h>\n#include <linux/gfp.h>\n#include <linux/security.h>\n#include <linux/uio.h>\n#include <linux/syscalls.h>\n#include <linux/export.h>\n#include <linux/writeback.h>\n#include <linux/swap.h>\n#include <linux/mm_inline.h>\n#include <linux/memcontrol.h>\n#include <linux/splice.h>\n#include <linux/pagemap.h>\n#include <linux/file.h>\n#include <linux/fs.h>\n\nstatic ssize_t kernel_readv(struct file *file, const struct iovec *vec,\n\t\t\t    unsigned long vlen, loff_t offset)\n{\n\tmm_segment_t old_fs;\n\tloff_t pos = offset;\n\tssize_t res;\n\n\told_fs = get_fs();\n\tset_fs(get_ds());\n\t/* The cast to a user pointer is valid due to the set_fs() */\n\tres = vfs_readv(file, (const struct iovec __user *)vec, vlen, &pos);\n\tset_fs(old_fs);\n\n\treturn res;\n}"
        }
      },
      {
        "call_info": {
          "callee": "file_inode",
          "args": [
            "file"
          ],
          "line": 345
        },
        "resolved": true,
        "details": {
          "function_name": "fuse_init_file_inode",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/fuse/file.c",
          "lines": "3009-3013",
          "snippet": "void fuse_init_file_inode(struct inode *inode)\n{\n\tinode->i_fop = &fuse_file_operations;\n\tinode->i_data.a_ops = &fuse_file_aops;\n}",
          "includes": [
            "#include <linux/falloc.h>",
            "#include <linux/aio.h>",
            "#include <linux/swap.h>",
            "#include <linux/compat.h>",
            "#include <linux/module.h>",
            "#include <linux/sched.h>",
            "#include <linux/kernel.h>",
            "#include <linux/slab.h>",
            "#include <linux/pagemap.h>",
            "#include \"fuse_i.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static const struct file_operations fuse_file_operations = {\n\t.llseek\t\t= fuse_file_llseek,\n\t.read\t\t= new_sync_read,\n\t.read_iter\t= fuse_file_read_iter,\n\t.write\t\t= new_sync_write,\n\t.write_iter\t= fuse_file_write_iter,\n\t.mmap\t\t= fuse_file_mmap,\n\t.open\t\t= fuse_open,\n\t.flush\t\t= fuse_flush,\n\t.release\t= fuse_release,\n\t.fsync\t\t= fuse_fsync,\n\t.lock\t\t= fuse_file_lock,\n\t.flock\t\t= fuse_file_flock,\n\t.splice_read\t= generic_file_splice_read,\n\t.unlocked_ioctl\t= fuse_file_ioctl,\n\t.compat_ioctl\t= fuse_file_compat_ioctl,\n\t.poll\t\t= fuse_file_poll,\n\t.fallocate\t= fuse_file_fallocate,\n};",
            "static const struct address_space_operations fuse_file_aops  = {\n\t.readpage\t= fuse_readpage,\n\t.writepage\t= fuse_writepage,\n\t.writepages\t= fuse_writepages,\n\t.launder_page\t= fuse_launder_page,\n\t.readpages\t= fuse_readpages,\n\t.set_page_dirty\t= __set_page_dirty_nobuffers,\n\t.bmap\t\t= fuse_bmap,\n\t.direct_IO\t= fuse_direct_IO,\n\t.write_begin\t= fuse_write_begin,\n\t.write_end\t= fuse_write_end,\n};"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <linux/falloc.h>\n#include <linux/aio.h>\n#include <linux/swap.h>\n#include <linux/compat.h>\n#include <linux/module.h>\n#include <linux/sched.h>\n#include <linux/kernel.h>\n#include <linux/slab.h>\n#include <linux/pagemap.h>\n#include \"fuse_i.h\"\n\nstatic const struct file_operations fuse_file_operations = {\n\t.llseek\t\t= fuse_file_llseek,\n\t.read\t\t= new_sync_read,\n\t.read_iter\t= fuse_file_read_iter,\n\t.write\t\t= new_sync_write,\n\t.write_iter\t= fuse_file_write_iter,\n\t.mmap\t\t= fuse_file_mmap,\n\t.open\t\t= fuse_open,\n\t.flush\t\t= fuse_flush,\n\t.release\t= fuse_release,\n\t.fsync\t\t= fuse_fsync,\n\t.lock\t\t= fuse_file_lock,\n\t.flock\t\t= fuse_file_flock,\n\t.splice_read\t= generic_file_splice_read,\n\t.unlocked_ioctl\t= fuse_file_ioctl,\n\t.compat_ioctl\t= fuse_file_compat_ioctl,\n\t.poll\t\t= fuse_file_poll,\n\t.fallocate\t= fuse_file_fallocate,\n};\nstatic const struct address_space_operations fuse_file_aops  = {\n\t.readpage\t= fuse_readpage,\n\t.writepage\t= fuse_writepage,\n\t.writepages\t= fuse_writepages,\n\t.launder_page\t= fuse_launder_page,\n\t.readpages\t= fuse_readpages,\n\t.set_page_dirty\t= __set_page_dirty_nobuffers,\n\t.bmap\t\t= fuse_bmap,\n\t.direct_IO\t= fuse_direct_IO,\n\t.write_begin\t= fuse_write_begin,\n\t.write_end\t= fuse_write_end,\n};\n\nvoid fuse_init_file_inode(struct inode *inode)\n{\n\tinode->i_fop = &fuse_file_operations;\n\tinode->i_data.a_ops = &fuse_file_aops;\n}"
        }
      }
    ],
    "contextual_snippet": "#include <asm/a.out-core.h>\n#include <asm/cacheflush.h>\n#include <asm/uaccess.h>\n#include <linux/slab.h>\n#include <linux/coredump.h>\n#include <linux/init.h>\n#include <linux/personality.h>\n#include <linux/binfmts.h>\n#include <linux/user.h>\n#include <linux/ptrace.h>\n#include <linux/fcntl.h>\n#include <linux/stat.h>\n#include <linux/file.h>\n#include <linux/fs.h>\n#include <linux/string.h>\n#include <linux/signal.h>\n#include <linux/errno.h>\n#include <linux/a.out.h>\n#include <linux/mman.h>\n#include <linux/mm.h>\n#include <linux/kernel.h>\n#include <linux/time.h>\n#include <linux/module.h>\n\nstatic int load_aout_library(struct file*);\n\nstatic int load_aout_library(struct file *file)\n{\n\tstruct inode * inode;\n\tunsigned long bss, start_addr, len;\n\tunsigned long error;\n\tint retval;\n\tstruct exec ex;\n\n\tinode = file_inode(file);\n\n\tretval = -ENOEXEC;\n\terror = kernel_read(file, 0, (char *) &ex, sizeof(ex));\n\tif (error != sizeof(ex))\n\t\tgoto out;\n\n\t/* We come in here for the regular a.out style of shared libraries */\n\tif ((N_MAGIC(ex) != ZMAGIC && N_MAGIC(ex) != QMAGIC) || N_TRSIZE(ex) ||\n\t    N_DRSIZE(ex) || ((ex.a_entry & 0xfff) && N_MAGIC(ex) == ZMAGIC) ||\n\t    i_size_read(inode) < ex.a_text+ex.a_data+N_SYMSIZE(ex)+N_TXTOFF(ex)) {\n\t\tgoto out;\n\t}\n\n\t/*\n\t * Requires a mmap handler. This prevents people from using a.out\n\t * as part of an exploit attack against /proc-related vulnerabilities.\n\t */\n\tif (!file->f_op->mmap)\n\t\tgoto out;\n\n\tif (N_FLAGS(ex))\n\t\tgoto out;\n\n\t/* For  QMAGIC, the starting address is 0x20 into the page.  We mask\n\t   this off to get the starting address for the page */\n\n\tstart_addr =  ex.a_entry & 0xfffff000;\n\n\tif ((N_TXTOFF(ex) & ~PAGE_MASK) != 0) {\n\t\tif (printk_ratelimit())\n\t\t{\n\t\t\tprintk(KERN_WARNING \n\t\t\t       \"N_TXTOFF is not page aligned. Please convert library: %pD\\n\",\n\t\t\t       file);\n\t\t}\n\t\tvm_brk(start_addr, ex.a_text + ex.a_data + ex.a_bss);\n\t\t\n\t\tread_code(file, start_addr, N_TXTOFF(ex),\n\t\t\t  ex.a_text + ex.a_data);\n\t\tretval = 0;\n\t\tgoto out;\n\t}\n\t/* Now use mmap to map the library into memory. */\n\terror = vm_mmap(file, start_addr, ex.a_text + ex.a_data,\n\t\t\tPROT_READ | PROT_WRITE | PROT_EXEC,\n\t\t\tMAP_FIXED | MAP_PRIVATE | MAP_DENYWRITE,\n\t\t\tN_TXTOFF(ex));\n\tretval = error;\n\tif (error != start_addr)\n\t\tgoto out;\n\n\tlen = PAGE_ALIGN(ex.a_text + ex.a_data);\n\tbss = ex.a_text + ex.a_data + ex.a_bss;\n\tif (bss > len) {\n\t\terror = vm_brk(start_addr + len, bss - len);\n\t\tretval = error;\n\t\tif (error != start_addr + len)\n\t\t\tgoto out;\n\t}\n\tretval = 0;\nout:\n\treturn retval;\n}"
  },
  {
    "function_name": "load_aout_binary",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/binfmt_aout.c",
    "lines": "202-335",
    "snippet": "static int load_aout_binary(struct linux_binprm * bprm)\n{\n\tstruct pt_regs *regs = current_pt_regs();\n\tstruct exec ex;\n\tunsigned long error;\n\tunsigned long fd_offset;\n\tunsigned long rlim;\n\tint retval;\n\n\tex = *((struct exec *) bprm->buf);\t\t/* exec-header */\n\tif ((N_MAGIC(ex) != ZMAGIC && N_MAGIC(ex) != OMAGIC &&\n\t     N_MAGIC(ex) != QMAGIC && N_MAGIC(ex) != NMAGIC) ||\n\t    N_TRSIZE(ex) || N_DRSIZE(ex) ||\n\t    i_size_read(file_inode(bprm->file)) < ex.a_text+ex.a_data+N_SYMSIZE(ex)+N_TXTOFF(ex)) {\n\t\treturn -ENOEXEC;\n\t}\n\n\t/*\n\t * Requires a mmap handler. This prevents people from using a.out\n\t * as part of an exploit attack against /proc-related vulnerabilities.\n\t */\n\tif (!bprm->file->f_op->mmap)\n\t\treturn -ENOEXEC;\n\n\tfd_offset = N_TXTOFF(ex);\n\n\t/* Check initial limits. This avoids letting people circumvent\n\t * size limits imposed on them by creating programs with large\n\t * arrays in the data or bss.\n\t */\n\trlim = rlimit(RLIMIT_DATA);\n\tif (rlim >= RLIM_INFINITY)\n\t\trlim = ~0;\n\tif (ex.a_data + ex.a_bss > rlim)\n\t\treturn -ENOMEM;\n\n\t/* Flush all traces of the currently running executable */\n\tretval = flush_old_exec(bprm);\n\tif (retval)\n\t\treturn retval;\n\n\t/* OK, This is the point of no return */\n#ifdef __alpha__\n\tSET_AOUT_PERSONALITY(bprm, ex);\n#else\n\tset_personality(PER_LINUX);\n#endif\n\tsetup_new_exec(bprm);\n\n\tcurrent->mm->end_code = ex.a_text +\n\t\t(current->mm->start_code = N_TXTADDR(ex));\n\tcurrent->mm->end_data = ex.a_data +\n\t\t(current->mm->start_data = N_DATADDR(ex));\n\tcurrent->mm->brk = ex.a_bss +\n\t\t(current->mm->start_brk = N_BSSADDR(ex));\n\n\tretval = setup_arg_pages(bprm, STACK_TOP, EXSTACK_DEFAULT);\n\tif (retval < 0)\n\t\treturn retval;\n\n\tinstall_exec_creds(bprm);\n\n\tif (N_MAGIC(ex) == OMAGIC) {\n\t\tunsigned long text_addr, map_size;\n\t\tloff_t pos;\n\n\t\ttext_addr = N_TXTADDR(ex);\n\n#ifdef __alpha__\n\t\tpos = fd_offset;\n\t\tmap_size = ex.a_text+ex.a_data + PAGE_SIZE - 1;\n#else\n\t\tpos = 32;\n\t\tmap_size = ex.a_text+ex.a_data;\n#endif\n\t\terror = vm_brk(text_addr & PAGE_MASK, map_size);\n\t\tif (error != (text_addr & PAGE_MASK))\n\t\t\treturn error;\n\n\t\terror = read_code(bprm->file, text_addr, pos,\n\t\t\t\t  ex.a_text+ex.a_data);\n\t\tif ((signed long)error < 0)\n\t\t\treturn error;\n\t} else {\n\t\tif ((ex.a_text & 0xfff || ex.a_data & 0xfff) &&\n\t\t    (N_MAGIC(ex) != NMAGIC) && printk_ratelimit())\n\t\t{\n\t\t\tprintk(KERN_NOTICE \"executable not page aligned\\n\");\n\t\t}\n\n\t\tif ((fd_offset & ~PAGE_MASK) != 0 && printk_ratelimit())\n\t\t{\n\t\t\tprintk(KERN_WARNING \n\t\t\t       \"fd_offset is not page aligned. Please convert program: %pD\\n\",\n\t\t\t       bprm->file);\n\t\t}\n\n\t\tif (!bprm->file->f_op->mmap||((fd_offset & ~PAGE_MASK) != 0)) {\n\t\t\tvm_brk(N_TXTADDR(ex), ex.a_text+ex.a_data);\n\t\t\tread_code(bprm->file, N_TXTADDR(ex), fd_offset,\n\t\t\t\t  ex.a_text + ex.a_data);\n\t\t\tgoto beyond_if;\n\t\t}\n\n\t\terror = vm_mmap(bprm->file, N_TXTADDR(ex), ex.a_text,\n\t\t\tPROT_READ | PROT_EXEC,\n\t\t\tMAP_FIXED | MAP_PRIVATE | MAP_DENYWRITE | MAP_EXECUTABLE,\n\t\t\tfd_offset);\n\n\t\tif (error != N_TXTADDR(ex))\n\t\t\treturn error;\n\n\t\terror = vm_mmap(bprm->file, N_DATADDR(ex), ex.a_data,\n\t\t\t\tPROT_READ | PROT_WRITE | PROT_EXEC,\n\t\t\t\tMAP_FIXED | MAP_PRIVATE | MAP_DENYWRITE | MAP_EXECUTABLE,\n\t\t\t\tfd_offset + ex.a_text);\n\t\tif (error != N_DATADDR(ex))\n\t\t\treturn error;\n\t}\nbeyond_if:\n\tset_binfmt(&aout_format);\n\n\tretval = set_brk(current->mm->start_brk, current->mm->brk);\n\tif (retval < 0)\n\t\treturn retval;\n\n\tcurrent->mm->start_stack =\n\t\t(unsigned long) create_aout_tables((char __user *) bprm->p, bprm);\n#ifdef __alpha__\n\tregs->gp = ex.a_gpvalue;\n#endif\n\tstart_thread(regs, ex.a_entry, current->mm->start_stack);\n\treturn 0;\n}",
    "includes": [
      "#include <asm/a.out-core.h>",
      "#include <asm/cacheflush.h>",
      "#include <asm/uaccess.h>",
      "#include <linux/slab.h>",
      "#include <linux/coredump.h>",
      "#include <linux/init.h>",
      "#include <linux/personality.h>",
      "#include <linux/binfmts.h>",
      "#include <linux/user.h>",
      "#include <linux/ptrace.h>",
      "#include <linux/fcntl.h>",
      "#include <linux/stat.h>",
      "#include <linux/file.h>",
      "#include <linux/fs.h>",
      "#include <linux/string.h>",
      "#include <linux/signal.h>",
      "#include <linux/errno.h>",
      "#include <linux/a.out.h>",
      "#include <linux/mman.h>",
      "#include <linux/mm.h>",
      "#include <linux/kernel.h>",
      "#include <linux/time.h>",
      "#include <linux/module.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static int load_aout_binary(struct linux_binprm *);",
      "static int load_aout_library(struct file*);",
      "static struct linux_binfmt aout_format = {\n\t.module\t\t= THIS_MODULE,\n\t.load_binary\t= load_aout_binary,\n\t.load_shlib\t= load_aout_library,\n\t.core_dump\t= aout_core_dump,\n\t.min_coredump\t= PAGE_SIZE\n};"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "start_thread",
          "args": [
            "regs",
            "ex.a_entry",
            "current->mm->start_stack"
          ],
          "line": 333
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "create_aout_tables",
          "args": [
            "(char __user *) bprm->p",
            "bprm"
          ],
          "line": 329
        },
        "resolved": true,
        "details": {
          "function_name": "create_aout_tables",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/binfmt_aout.c",
          "lines": "144-195",
          "snippet": "static unsigned long __user *create_aout_tables(char __user *p, struct linux_binprm * bprm)\n{\n\tchar __user * __user *argv;\n\tchar __user * __user *envp;\n\tunsigned long __user *sp;\n\tint argc = bprm->argc;\n\tint envc = bprm->envc;\n\n\tsp = (void __user *)((-(unsigned long)sizeof(char *)) & (unsigned long) p);\n#ifdef __alpha__\n/* whee.. test-programs are so much fun. */\n\tput_user(0, --sp);\n\tput_user(0, --sp);\n\tif (bprm->loader) {\n\t\tput_user(0, --sp);\n\t\tput_user(1003, --sp);\n\t\tput_user(bprm->loader, --sp);\n\t\tput_user(1002, --sp);\n\t}\n\tput_user(bprm->exec, --sp);\n\tput_user(1001, --sp);\n#endif\n\tsp -= envc+1;\n\tenvp = (char __user * __user *) sp;\n\tsp -= argc+1;\n\targv = (char __user * __user *) sp;\n#ifndef __alpha__\n\tput_user((unsigned long) envp,--sp);\n\tput_user((unsigned long) argv,--sp);\n#endif\n\tput_user(argc,--sp);\n\tcurrent->mm->arg_start = (unsigned long) p;\n\twhile (argc-->0) {\n\t\tchar c;\n\t\tput_user(p,argv++);\n\t\tdo {\n\t\t\tget_user(c,p++);\n\t\t} while (c);\n\t}\n\tput_user(NULL,argv);\n\tcurrent->mm->arg_end = current->mm->env_start = (unsigned long) p;\n\twhile (envc-->0) {\n\t\tchar c;\n\t\tput_user(p,envp++);\n\t\tdo {\n\t\t\tget_user(c,p++);\n\t\t} while (c);\n\t}\n\tput_user(NULL,envp);\n\tcurrent->mm->env_end = (unsigned long) p;\n\treturn sp;\n}",
          "includes": [
            "#include <asm/a.out-core.h>",
            "#include <asm/cacheflush.h>",
            "#include <asm/uaccess.h>",
            "#include <linux/slab.h>",
            "#include <linux/coredump.h>",
            "#include <linux/init.h>",
            "#include <linux/personality.h>",
            "#include <linux/binfmts.h>",
            "#include <linux/user.h>",
            "#include <linux/ptrace.h>",
            "#include <linux/fcntl.h>",
            "#include <linux/stat.h>",
            "#include <linux/file.h>",
            "#include <linux/fs.h>",
            "#include <linux/string.h>",
            "#include <linux/signal.h>",
            "#include <linux/errno.h>",
            "#include <linux/a.out.h>",
            "#include <linux/mman.h>",
            "#include <linux/mm.h>",
            "#include <linux/kernel.h>",
            "#include <linux/time.h>",
            "#include <linux/module.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int load_aout_binary(struct linux_binprm *);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <asm/a.out-core.h>\n#include <asm/cacheflush.h>\n#include <asm/uaccess.h>\n#include <linux/slab.h>\n#include <linux/coredump.h>\n#include <linux/init.h>\n#include <linux/personality.h>\n#include <linux/binfmts.h>\n#include <linux/user.h>\n#include <linux/ptrace.h>\n#include <linux/fcntl.h>\n#include <linux/stat.h>\n#include <linux/file.h>\n#include <linux/fs.h>\n#include <linux/string.h>\n#include <linux/signal.h>\n#include <linux/errno.h>\n#include <linux/a.out.h>\n#include <linux/mman.h>\n#include <linux/mm.h>\n#include <linux/kernel.h>\n#include <linux/time.h>\n#include <linux/module.h>\n\nstatic int load_aout_binary(struct linux_binprm *);\n\nstatic unsigned long __user *create_aout_tables(char __user *p, struct linux_binprm * bprm)\n{\n\tchar __user * __user *argv;\n\tchar __user * __user *envp;\n\tunsigned long __user *sp;\n\tint argc = bprm->argc;\n\tint envc = bprm->envc;\n\n\tsp = (void __user *)((-(unsigned long)sizeof(char *)) & (unsigned long) p);\n#ifdef __alpha__\n/* whee.. test-programs are so much fun. */\n\tput_user(0, --sp);\n\tput_user(0, --sp);\n\tif (bprm->loader) {\n\t\tput_user(0, --sp);\n\t\tput_user(1003, --sp);\n\t\tput_user(bprm->loader, --sp);\n\t\tput_user(1002, --sp);\n\t}\n\tput_user(bprm->exec, --sp);\n\tput_user(1001, --sp);\n#endif\n\tsp -= envc+1;\n\tenvp = (char __user * __user *) sp;\n\tsp -= argc+1;\n\targv = (char __user * __user *) sp;\n#ifndef __alpha__\n\tput_user((unsigned long) envp,--sp);\n\tput_user((unsigned long) argv,--sp);\n#endif\n\tput_user(argc,--sp);\n\tcurrent->mm->arg_start = (unsigned long) p;\n\twhile (argc-->0) {\n\t\tchar c;\n\t\tput_user(p,argv++);\n\t\tdo {\n\t\t\tget_user(c,p++);\n\t\t} while (c);\n\t}\n\tput_user(NULL,argv);\n\tcurrent->mm->arg_end = current->mm->env_start = (unsigned long) p;\n\twhile (envc-->0) {\n\t\tchar c;\n\t\tput_user(p,envp++);\n\t\tdo {\n\t\t\tget_user(c,p++);\n\t\t} while (c);\n\t}\n\tput_user(NULL,envp);\n\tcurrent->mm->env_end = (unsigned long) p;\n\treturn sp;\n}"
        }
      },
      {
        "call_info": {
          "callee": "set_brk",
          "args": [
            "current->mm->start_brk",
            "current->mm->brk"
          ],
          "line": 324
        },
        "resolved": true,
        "details": {
          "function_name": "set_brk",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/binfmt_aout.c",
          "lines": "126-137",
          "snippet": "static int set_brk(unsigned long start, unsigned long end)\n{\n\tstart = PAGE_ALIGN(start);\n\tend = PAGE_ALIGN(end);\n\tif (end > start) {\n\t\tunsigned long addr;\n\t\taddr = vm_brk(start, end - start);\n\t\tif (BAD_ADDR(addr))\n\t\t\treturn addr;\n\t}\n\treturn 0;\n}",
          "includes": [
            "#include <asm/a.out-core.h>",
            "#include <asm/cacheflush.h>",
            "#include <asm/uaccess.h>",
            "#include <linux/slab.h>",
            "#include <linux/coredump.h>",
            "#include <linux/init.h>",
            "#include <linux/personality.h>",
            "#include <linux/binfmts.h>",
            "#include <linux/user.h>",
            "#include <linux/ptrace.h>",
            "#include <linux/fcntl.h>",
            "#include <linux/stat.h>",
            "#include <linux/file.h>",
            "#include <linux/fs.h>",
            "#include <linux/string.h>",
            "#include <linux/signal.h>",
            "#include <linux/errno.h>",
            "#include <linux/a.out.h>",
            "#include <linux/mman.h>",
            "#include <linux/mm.h>",
            "#include <linux/kernel.h>",
            "#include <linux/time.h>",
            "#include <linux/module.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <asm/a.out-core.h>\n#include <asm/cacheflush.h>\n#include <asm/uaccess.h>\n#include <linux/slab.h>\n#include <linux/coredump.h>\n#include <linux/init.h>\n#include <linux/personality.h>\n#include <linux/binfmts.h>\n#include <linux/user.h>\n#include <linux/ptrace.h>\n#include <linux/fcntl.h>\n#include <linux/stat.h>\n#include <linux/file.h>\n#include <linux/fs.h>\n#include <linux/string.h>\n#include <linux/signal.h>\n#include <linux/errno.h>\n#include <linux/a.out.h>\n#include <linux/mman.h>\n#include <linux/mm.h>\n#include <linux/kernel.h>\n#include <linux/time.h>\n#include <linux/module.h>\n\nstatic int set_brk(unsigned long start, unsigned long end)\n{\n\tstart = PAGE_ALIGN(start);\n\tend = PAGE_ALIGN(end);\n\tif (end > start) {\n\t\tunsigned long addr;\n\t\taddr = vm_brk(start, end - start);\n\t\tif (BAD_ADDR(addr))\n\t\t\treturn addr;\n\t}\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "set_binfmt",
          "args": [
            "&aout_format"
          ],
          "line": 322
        },
        "resolved": true,
        "details": {
          "function_name": "set_binfmt",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/exec.c",
          "lines": "1642-1652",
          "snippet": "void set_binfmt(struct linux_binfmt *new)\n{\n\tstruct mm_struct *mm = current->mm;\n\n\tif (mm->binfmt)\n\t\tmodule_put(mm->binfmt->module);\n\n\tmm->binfmt = new;\n\tif (new)\n\t\t__module_get(new->module);\n}",
          "includes": [
            "#include <trace/events/sched.h>",
            "#include \"internal.h\"",
            "#include <trace/events/task.h>",
            "#include <asm/tlb.h>",
            "#include <asm/mmu_context.h>",
            "#include <asm/uaccess.h>",
            "#include <linux/compat.h>",
            "#include <linux/oom.h>",
            "#include <linux/pipe_fs_i.h>",
            "#include <linux/fs_struct.h>",
            "#include <linux/fsnotify.h>",
            "#include <linux/kmod.h>",
            "#include <linux/tracehook.h>",
            "#include <linux/audit.h>",
            "#include <linux/cn_proc.h>",
            "#include <linux/tsacct_kern.h>",
            "#include <linux/syscalls.h>",
            "#include <linux/security.h>",
            "#include <linux/mount.h>",
            "#include <linux/namei.h>",
            "#include <linux/module.h>",
            "#include <linux/pid_namespace.h>",
            "#include <linux/utsname.h>",
            "#include <linux/binfmts.h>",
            "#include <linux/personality.h>",
            "#include <linux/key.h>",
            "#include <linux/spinlock.h>",
            "#include <linux/highmem.h>",
            "#include <linux/perf_event.h>",
            "#include <linux/pagemap.h>",
            "#include <linux/init.h>",
            "#include <linux/string.h>",
            "#include <linux/swap.h>",
            "#include <linux/fcntl.h>",
            "#include <linux/stat.h>",
            "#include <linux/vmacache.h>",
            "#include <linux/mm.h>",
            "#include <linux/fdtable.h>",
            "#include <linux/file.h>",
            "#include <linux/slab.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <trace/events/sched.h>\n#include \"internal.h\"\n#include <trace/events/task.h>\n#include <asm/tlb.h>\n#include <asm/mmu_context.h>\n#include <asm/uaccess.h>\n#include <linux/compat.h>\n#include <linux/oom.h>\n#include <linux/pipe_fs_i.h>\n#include <linux/fs_struct.h>\n#include <linux/fsnotify.h>\n#include <linux/kmod.h>\n#include <linux/tracehook.h>\n#include <linux/audit.h>\n#include <linux/cn_proc.h>\n#include <linux/tsacct_kern.h>\n#include <linux/syscalls.h>\n#include <linux/security.h>\n#include <linux/mount.h>\n#include <linux/namei.h>\n#include <linux/module.h>\n#include <linux/pid_namespace.h>\n#include <linux/utsname.h>\n#include <linux/binfmts.h>\n#include <linux/personality.h>\n#include <linux/key.h>\n#include <linux/spinlock.h>\n#include <linux/highmem.h>\n#include <linux/perf_event.h>\n#include <linux/pagemap.h>\n#include <linux/init.h>\n#include <linux/string.h>\n#include <linux/swap.h>\n#include <linux/fcntl.h>\n#include <linux/stat.h>\n#include <linux/vmacache.h>\n#include <linux/mm.h>\n#include <linux/fdtable.h>\n#include <linux/file.h>\n#include <linux/slab.h>\n\nvoid set_binfmt(struct linux_binfmt *new)\n{\n\tstruct mm_struct *mm = current->mm;\n\n\tif (mm->binfmt)\n\t\tmodule_put(mm->binfmt->module);\n\n\tmm->binfmt = new;\n\tif (new)\n\t\t__module_get(new->module);\n}"
        }
      },
      {
        "call_info": {
          "callee": "N_DATADDR",
          "args": [
            "ex"
          ],
          "line": 318
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "vm_mmap",
          "args": [
            "bprm->file",
            "N_DATADDR(ex)",
            "ex.a_data",
            "PROT_READ | PROT_WRITE | PROT_EXEC",
            "MAP_FIXED | MAP_PRIVATE | MAP_DENYWRITE | MAP_EXECUTABLE",
            "fd_offset + ex.a_text"
          ],
          "line": 314
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "N_DATADDR",
          "args": [
            "ex"
          ],
          "line": 314
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "N_TXTADDR",
          "args": [
            "ex"
          ],
          "line": 311
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "vm_mmap",
          "args": [
            "bprm->file",
            "N_TXTADDR(ex)",
            "ex.a_text",
            "PROT_READ | PROT_EXEC",
            "MAP_FIXED | MAP_PRIVATE | MAP_DENYWRITE | MAP_EXECUTABLE",
            "fd_offset"
          ],
          "line": 306
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "N_TXTADDR",
          "args": [
            "ex"
          ],
          "line": 306
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "read_code",
          "args": [
            "bprm->file",
            "N_TXTADDR(ex)",
            "fd_offset",
            "ex.a_text + ex.a_data"
          ],
          "line": 301
        },
        "resolved": true,
        "details": {
          "function_name": "read_code",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/exec.c",
          "lines": "825-831",
          "snippet": "ssize_t read_code(struct file *file, unsigned long addr, loff_t pos, size_t len)\n{\n\tssize_t res = vfs_read(file, (void __user *)addr, len, &pos);\n\tif (res > 0)\n\t\tflush_icache_range(addr, addr + len);\n\treturn res;\n}",
          "includes": [
            "#include <trace/events/sched.h>",
            "#include \"internal.h\"",
            "#include <trace/events/task.h>",
            "#include <asm/tlb.h>",
            "#include <asm/mmu_context.h>",
            "#include <asm/uaccess.h>",
            "#include <linux/compat.h>",
            "#include <linux/oom.h>",
            "#include <linux/pipe_fs_i.h>",
            "#include <linux/fs_struct.h>",
            "#include <linux/fsnotify.h>",
            "#include <linux/kmod.h>",
            "#include <linux/tracehook.h>",
            "#include <linux/audit.h>",
            "#include <linux/cn_proc.h>",
            "#include <linux/tsacct_kern.h>",
            "#include <linux/syscalls.h>",
            "#include <linux/security.h>",
            "#include <linux/mount.h>",
            "#include <linux/namei.h>",
            "#include <linux/module.h>",
            "#include <linux/pid_namespace.h>",
            "#include <linux/utsname.h>",
            "#include <linux/binfmts.h>",
            "#include <linux/personality.h>",
            "#include <linux/key.h>",
            "#include <linux/spinlock.h>",
            "#include <linux/highmem.h>",
            "#include <linux/perf_event.h>",
            "#include <linux/pagemap.h>",
            "#include <linux/init.h>",
            "#include <linux/string.h>",
            "#include <linux/swap.h>",
            "#include <linux/fcntl.h>",
            "#include <linux/stat.h>",
            "#include <linux/vmacache.h>",
            "#include <linux/mm.h>",
            "#include <linux/fdtable.h>",
            "#include <linux/file.h>",
            "#include <linux/slab.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <trace/events/sched.h>\n#include \"internal.h\"\n#include <trace/events/task.h>\n#include <asm/tlb.h>\n#include <asm/mmu_context.h>\n#include <asm/uaccess.h>\n#include <linux/compat.h>\n#include <linux/oom.h>\n#include <linux/pipe_fs_i.h>\n#include <linux/fs_struct.h>\n#include <linux/fsnotify.h>\n#include <linux/kmod.h>\n#include <linux/tracehook.h>\n#include <linux/audit.h>\n#include <linux/cn_proc.h>\n#include <linux/tsacct_kern.h>\n#include <linux/syscalls.h>\n#include <linux/security.h>\n#include <linux/mount.h>\n#include <linux/namei.h>\n#include <linux/module.h>\n#include <linux/pid_namespace.h>\n#include <linux/utsname.h>\n#include <linux/binfmts.h>\n#include <linux/personality.h>\n#include <linux/key.h>\n#include <linux/spinlock.h>\n#include <linux/highmem.h>\n#include <linux/perf_event.h>\n#include <linux/pagemap.h>\n#include <linux/init.h>\n#include <linux/string.h>\n#include <linux/swap.h>\n#include <linux/fcntl.h>\n#include <linux/stat.h>\n#include <linux/vmacache.h>\n#include <linux/mm.h>\n#include <linux/fdtable.h>\n#include <linux/file.h>\n#include <linux/slab.h>\n\nssize_t read_code(struct file *file, unsigned long addr, loff_t pos, size_t len)\n{\n\tssize_t res = vfs_read(file, (void __user *)addr, len, &pos);\n\tif (res > 0)\n\t\tflush_icache_range(addr, addr + len);\n\treturn res;\n}"
        }
      },
      {
        "call_info": {
          "callee": "N_TXTADDR",
          "args": [
            "ex"
          ],
          "line": 301
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "vm_brk",
          "args": [
            "N_TXTADDR(ex)",
            "ex.a_text+ex.a_data"
          ],
          "line": 300
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "N_TXTADDR",
          "args": [
            "ex"
          ],
          "line": 300
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "printk",
          "args": [
            "KERN_WARNING \n\t\t\t       \"fd_offset is not page aligned. Please convert program: %pD\\n\"",
            "bprm->file"
          ],
          "line": 294
        },
        "resolved": true,
        "details": {
          "function_name": "compat_printk",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/compat.c",
          "lines": "59-69",
          "snippet": "int compat_printk(const char *fmt, ...)\n{\n\tva_list ap;\n\tint ret;\n\tif (!compat_log)\n\t\treturn 0;\n\tva_start(ap, fmt);\n\tret = vprintk(fmt, ap);\n\tva_end(ap);\n\treturn ret;\n}",
          "includes": [
            "#include \"internal.h\"",
            "#include <asm/ioctls.h>",
            "#include <asm/mmu_context.h>",
            "#include <asm/uaccess.h>",
            "#include <linux/aio.h>",
            "#include <linux/pagemap.h>",
            "#include <linux/slab.h>",
            "#include <linux/fs_struct.h>",
            "#include <linux/mm.h>",
            "#include <linux/poll.h>",
            "#include <linux/signal.h>",
            "#include <linux/highmem.h>",
            "#include <linux/security.h>",
            "#include <linux/tsacct_kern.h>",
            "#include <linux/rwsem.h>",
            "#include <linux/personality.h>",
            "#include <linux/highuid.h>",
            "#include <linux/fsnotify.h>",
            "#include <linux/dirent.h>",
            "#include <linux/ctype.h>",
            "#include <linux/syscalls.h>",
            "#include <linux/nfs4_mount.h>",
            "#include <linux/ncp_mount.h>",
            "#include <linux/init.h>",
            "#include <linux/ioctl.h>",
            "#include <linux/vfs.h>",
            "#include <linux/fdtable.h>",
            "#include <linux/file.h>",
            "#include <linux/namei.h>",
            "#include <linux/fcntl.h>",
            "#include <linux/fs.h>",
            "#include <linux/time.h>",
            "#include <linux/errno.h>",
            "#include <linux/compat.h>",
            "#include <linux/linkage.h>",
            "#include <linux/kernel.h>",
            "#include <linux/stddef.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "int compat_log = 1;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"internal.h\"\n#include <asm/ioctls.h>\n#include <asm/mmu_context.h>\n#include <asm/uaccess.h>\n#include <linux/aio.h>\n#include <linux/pagemap.h>\n#include <linux/slab.h>\n#include <linux/fs_struct.h>\n#include <linux/mm.h>\n#include <linux/poll.h>\n#include <linux/signal.h>\n#include <linux/highmem.h>\n#include <linux/security.h>\n#include <linux/tsacct_kern.h>\n#include <linux/rwsem.h>\n#include <linux/personality.h>\n#include <linux/highuid.h>\n#include <linux/fsnotify.h>\n#include <linux/dirent.h>\n#include <linux/ctype.h>\n#include <linux/syscalls.h>\n#include <linux/nfs4_mount.h>\n#include <linux/ncp_mount.h>\n#include <linux/init.h>\n#include <linux/ioctl.h>\n#include <linux/vfs.h>\n#include <linux/fdtable.h>\n#include <linux/file.h>\n#include <linux/namei.h>\n#include <linux/fcntl.h>\n#include <linux/fs.h>\n#include <linux/time.h>\n#include <linux/errno.h>\n#include <linux/compat.h>\n#include <linux/linkage.h>\n#include <linux/kernel.h>\n#include <linux/stddef.h>\n\nint compat_log = 1;\n\nint compat_printk(const char *fmt, ...)\n{\n\tva_list ap;\n\tint ret;\n\tif (!compat_log)\n\t\treturn 0;\n\tva_start(ap, fmt);\n\tret = vprintk(fmt, ap);\n\tva_end(ap);\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "printk_ratelimit",
          "args": [],
          "line": 292
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "printk_ratelimit",
          "args": [],
          "line": 287
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "N_MAGIC",
          "args": [
            "ex"
          ],
          "line": 287
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "vm_brk",
          "args": [
            "text_addr & PAGE_MASK",
            "map_size"
          ],
          "line": 277
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "N_TXTADDR",
          "args": [
            "ex"
          ],
          "line": 268
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "N_MAGIC",
          "args": [
            "ex"
          ],
          "line": 264
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "install_exec_creds",
          "args": [
            "bprm"
          ],
          "line": 262
        },
        "resolved": true,
        "details": {
          "function_name": "install_exec_creds",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/exec.c",
          "lines": "1202-1224",
          "snippet": "void install_exec_creds(struct linux_binprm *bprm)\n{\n\tsecurity_bprm_committing_creds(bprm);\n\n\tcommit_creds(bprm->cred);\n\tbprm->cred = NULL;\n\n\t/*\n\t * Disable monitoring for regular users\n\t * when executing setuid binaries. Must\n\t * wait until new credentials are committed\n\t * by commit_creds() above\n\t */\n\tif (get_dumpable(current->mm) != SUID_DUMP_USER)\n\t\tperf_event_exit_task(current);\n\t/*\n\t * cred_guard_mutex must be held at least to this point to prevent\n\t * ptrace_attach() from altering our determination of the task's\n\t * credentials; any time after this it may be unlocked.\n\t */\n\tsecurity_bprm_committed_creds(bprm);\n\tmutex_unlock(&current->signal->cred_guard_mutex);\n}",
          "includes": [
            "#include <trace/events/sched.h>",
            "#include \"internal.h\"",
            "#include <trace/events/task.h>",
            "#include <asm/tlb.h>",
            "#include <asm/mmu_context.h>",
            "#include <asm/uaccess.h>",
            "#include <linux/compat.h>",
            "#include <linux/oom.h>",
            "#include <linux/pipe_fs_i.h>",
            "#include <linux/fs_struct.h>",
            "#include <linux/fsnotify.h>",
            "#include <linux/kmod.h>",
            "#include <linux/tracehook.h>",
            "#include <linux/audit.h>",
            "#include <linux/cn_proc.h>",
            "#include <linux/tsacct_kern.h>",
            "#include <linux/syscalls.h>",
            "#include <linux/security.h>",
            "#include <linux/mount.h>",
            "#include <linux/namei.h>",
            "#include <linux/module.h>",
            "#include <linux/pid_namespace.h>",
            "#include <linux/utsname.h>",
            "#include <linux/binfmts.h>",
            "#include <linux/personality.h>",
            "#include <linux/key.h>",
            "#include <linux/spinlock.h>",
            "#include <linux/highmem.h>",
            "#include <linux/perf_event.h>",
            "#include <linux/pagemap.h>",
            "#include <linux/init.h>",
            "#include <linux/string.h>",
            "#include <linux/swap.h>",
            "#include <linux/fcntl.h>",
            "#include <linux/stat.h>",
            "#include <linux/vmacache.h>",
            "#include <linux/mm.h>",
            "#include <linux/fdtable.h>",
            "#include <linux/file.h>",
            "#include <linux/slab.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <trace/events/sched.h>\n#include \"internal.h\"\n#include <trace/events/task.h>\n#include <asm/tlb.h>\n#include <asm/mmu_context.h>\n#include <asm/uaccess.h>\n#include <linux/compat.h>\n#include <linux/oom.h>\n#include <linux/pipe_fs_i.h>\n#include <linux/fs_struct.h>\n#include <linux/fsnotify.h>\n#include <linux/kmod.h>\n#include <linux/tracehook.h>\n#include <linux/audit.h>\n#include <linux/cn_proc.h>\n#include <linux/tsacct_kern.h>\n#include <linux/syscalls.h>\n#include <linux/security.h>\n#include <linux/mount.h>\n#include <linux/namei.h>\n#include <linux/module.h>\n#include <linux/pid_namespace.h>\n#include <linux/utsname.h>\n#include <linux/binfmts.h>\n#include <linux/personality.h>\n#include <linux/key.h>\n#include <linux/spinlock.h>\n#include <linux/highmem.h>\n#include <linux/perf_event.h>\n#include <linux/pagemap.h>\n#include <linux/init.h>\n#include <linux/string.h>\n#include <linux/swap.h>\n#include <linux/fcntl.h>\n#include <linux/stat.h>\n#include <linux/vmacache.h>\n#include <linux/mm.h>\n#include <linux/fdtable.h>\n#include <linux/file.h>\n#include <linux/slab.h>\n\nvoid install_exec_creds(struct linux_binprm *bprm)\n{\n\tsecurity_bprm_committing_creds(bprm);\n\n\tcommit_creds(bprm->cred);\n\tbprm->cred = NULL;\n\n\t/*\n\t * Disable monitoring for regular users\n\t * when executing setuid binaries. Must\n\t * wait until new credentials are committed\n\t * by commit_creds() above\n\t */\n\tif (get_dumpable(current->mm) != SUID_DUMP_USER)\n\t\tperf_event_exit_task(current);\n\t/*\n\t * cred_guard_mutex must be held at least to this point to prevent\n\t * ptrace_attach() from altering our determination of the task's\n\t * credentials; any time after this it may be unlocked.\n\t */\n\tsecurity_bprm_committed_creds(bprm);\n\tmutex_unlock(&current->signal->cred_guard_mutex);\n}"
        }
      },
      {
        "call_info": {
          "callee": "setup_arg_pages",
          "args": [
            "bprm",
            "STACK_TOP",
            "EXSTACK_DEFAULT"
          ],
          "line": 258
        },
        "resolved": true,
        "details": {
          "function_name": "setup_arg_pages",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/exec.c",
          "lines": "641-746",
          "snippet": "int setup_arg_pages(struct linux_binprm *bprm,\n\t\t    unsigned long stack_top,\n\t\t    int executable_stack)\n{\n\tunsigned long ret;\n\tunsigned long stack_shift;\n\tstruct mm_struct *mm = current->mm;\n\tstruct vm_area_struct *vma = bprm->vma;\n\tstruct vm_area_struct *prev = NULL;\n\tunsigned long vm_flags;\n\tunsigned long stack_base;\n\tunsigned long stack_size;\n\tunsigned long stack_expand;\n\tunsigned long rlim_stack;\n\n#ifdef CONFIG_STACK_GROWSUP\n\t/* Limit stack size */\n\tstack_base = rlimit_max(RLIMIT_STACK);\n\tif (stack_base > STACK_SIZE_MAX)\n\t\tstack_base = STACK_SIZE_MAX;\n\n\t/* Make sure we didn't let the argument array grow too large. */\n\tif (vma->vm_end - vma->vm_start > stack_base)\n\t\treturn -ENOMEM;\n\n\tstack_base = PAGE_ALIGN(stack_top - stack_base);\n\n\tstack_shift = vma->vm_start - stack_base;\n\tmm->arg_start = bprm->p - stack_shift;\n\tbprm->p = vma->vm_end - stack_shift;\n#else\n\tstack_top = arch_align_stack(stack_top);\n\tstack_top = PAGE_ALIGN(stack_top);\n\n\tif (unlikely(stack_top < mmap_min_addr) ||\n\t    unlikely(vma->vm_end - vma->vm_start >= stack_top - mmap_min_addr))\n\t\treturn -ENOMEM;\n\n\tstack_shift = vma->vm_end - stack_top;\n\n\tbprm->p -= stack_shift;\n\tmm->arg_start = bprm->p;\n#endif\n\n\tif (bprm->loader)\n\t\tbprm->loader -= stack_shift;\n\tbprm->exec -= stack_shift;\n\n\tdown_write(&mm->mmap_sem);\n\tvm_flags = VM_STACK_FLAGS;\n\n\t/*\n\t * Adjust stack execute permissions; explicitly enable for\n\t * EXSTACK_ENABLE_X, disable for EXSTACK_DISABLE_X and leave alone\n\t * (arch default) otherwise.\n\t */\n\tif (unlikely(executable_stack == EXSTACK_ENABLE_X))\n\t\tvm_flags |= VM_EXEC;\n\telse if (executable_stack == EXSTACK_DISABLE_X)\n\t\tvm_flags &= ~VM_EXEC;\n\tvm_flags |= mm->def_flags;\n\tvm_flags |= VM_STACK_INCOMPLETE_SETUP;\n\n\tret = mprotect_fixup(vma, &prev, vma->vm_start, vma->vm_end,\n\t\t\tvm_flags);\n\tif (ret)\n\t\tgoto out_unlock;\n\tBUG_ON(prev != vma);\n\n\t/* Move stack pages down in memory. */\n\tif (stack_shift) {\n\t\tret = shift_arg_pages(vma, stack_shift);\n\t\tif (ret)\n\t\t\tgoto out_unlock;\n\t}\n\n\t/* mprotect_fixup is overkill to remove the temporary stack flags */\n\tvma->vm_flags &= ~VM_STACK_INCOMPLETE_SETUP;\n\n\tstack_expand = 131072UL; /* randomly 32*4k (or 2*64k) pages */\n\tstack_size = vma->vm_end - vma->vm_start;\n\t/*\n\t * Align this down to a page boundary as expand_stack\n\t * will align it up.\n\t */\n\trlim_stack = rlimit(RLIMIT_STACK) & PAGE_MASK;\n#ifdef CONFIG_STACK_GROWSUP\n\tif (stack_size + stack_expand > rlim_stack)\n\t\tstack_base = vma->vm_start + rlim_stack;\n\telse\n\t\tstack_base = vma->vm_end + stack_expand;\n#else\n\tif (stack_size + stack_expand > rlim_stack)\n\t\tstack_base = vma->vm_end - rlim_stack;\n\telse\n\t\tstack_base = vma->vm_start - stack_expand;\n#endif\n\tcurrent->mm->start_stack = bprm->p;\n\tret = expand_stack(vma, stack_base);\n\tif (ret)\n\t\tret = -EFAULT;\n\nout_unlock:\n\tup_write(&mm->mmap_sem);\n\treturn ret;\n}",
          "includes": [
            "#include <trace/events/sched.h>",
            "#include \"internal.h\"",
            "#include <trace/events/task.h>",
            "#include <asm/tlb.h>",
            "#include <asm/mmu_context.h>",
            "#include <asm/uaccess.h>",
            "#include <linux/compat.h>",
            "#include <linux/oom.h>",
            "#include <linux/pipe_fs_i.h>",
            "#include <linux/fs_struct.h>",
            "#include <linux/fsnotify.h>",
            "#include <linux/kmod.h>",
            "#include <linux/tracehook.h>",
            "#include <linux/audit.h>",
            "#include <linux/cn_proc.h>",
            "#include <linux/tsacct_kern.h>",
            "#include <linux/syscalls.h>",
            "#include <linux/security.h>",
            "#include <linux/mount.h>",
            "#include <linux/namei.h>",
            "#include <linux/module.h>",
            "#include <linux/pid_namespace.h>",
            "#include <linux/utsname.h>",
            "#include <linux/binfmts.h>",
            "#include <linux/personality.h>",
            "#include <linux/key.h>",
            "#include <linux/spinlock.h>",
            "#include <linux/highmem.h>",
            "#include <linux/perf_event.h>",
            "#include <linux/pagemap.h>",
            "#include <linux/init.h>",
            "#include <linux/string.h>",
            "#include <linux/swap.h>",
            "#include <linux/fcntl.h>",
            "#include <linux/stat.h>",
            "#include <linux/vmacache.h>",
            "#include <linux/mm.h>",
            "#include <linux/fdtable.h>",
            "#include <linux/file.h>",
            "#include <linux/slab.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <trace/events/sched.h>\n#include \"internal.h\"\n#include <trace/events/task.h>\n#include <asm/tlb.h>\n#include <asm/mmu_context.h>\n#include <asm/uaccess.h>\n#include <linux/compat.h>\n#include <linux/oom.h>\n#include <linux/pipe_fs_i.h>\n#include <linux/fs_struct.h>\n#include <linux/fsnotify.h>\n#include <linux/kmod.h>\n#include <linux/tracehook.h>\n#include <linux/audit.h>\n#include <linux/cn_proc.h>\n#include <linux/tsacct_kern.h>\n#include <linux/syscalls.h>\n#include <linux/security.h>\n#include <linux/mount.h>\n#include <linux/namei.h>\n#include <linux/module.h>\n#include <linux/pid_namespace.h>\n#include <linux/utsname.h>\n#include <linux/binfmts.h>\n#include <linux/personality.h>\n#include <linux/key.h>\n#include <linux/spinlock.h>\n#include <linux/highmem.h>\n#include <linux/perf_event.h>\n#include <linux/pagemap.h>\n#include <linux/init.h>\n#include <linux/string.h>\n#include <linux/swap.h>\n#include <linux/fcntl.h>\n#include <linux/stat.h>\n#include <linux/vmacache.h>\n#include <linux/mm.h>\n#include <linux/fdtable.h>\n#include <linux/file.h>\n#include <linux/slab.h>\n\nint setup_arg_pages(struct linux_binprm *bprm,\n\t\t    unsigned long stack_top,\n\t\t    int executable_stack)\n{\n\tunsigned long ret;\n\tunsigned long stack_shift;\n\tstruct mm_struct *mm = current->mm;\n\tstruct vm_area_struct *vma = bprm->vma;\n\tstruct vm_area_struct *prev = NULL;\n\tunsigned long vm_flags;\n\tunsigned long stack_base;\n\tunsigned long stack_size;\n\tunsigned long stack_expand;\n\tunsigned long rlim_stack;\n\n#ifdef CONFIG_STACK_GROWSUP\n\t/* Limit stack size */\n\tstack_base = rlimit_max(RLIMIT_STACK);\n\tif (stack_base > STACK_SIZE_MAX)\n\t\tstack_base = STACK_SIZE_MAX;\n\n\t/* Make sure we didn't let the argument array grow too large. */\n\tif (vma->vm_end - vma->vm_start > stack_base)\n\t\treturn -ENOMEM;\n\n\tstack_base = PAGE_ALIGN(stack_top - stack_base);\n\n\tstack_shift = vma->vm_start - stack_base;\n\tmm->arg_start = bprm->p - stack_shift;\n\tbprm->p = vma->vm_end - stack_shift;\n#else\n\tstack_top = arch_align_stack(stack_top);\n\tstack_top = PAGE_ALIGN(stack_top);\n\n\tif (unlikely(stack_top < mmap_min_addr) ||\n\t    unlikely(vma->vm_end - vma->vm_start >= stack_top - mmap_min_addr))\n\t\treturn -ENOMEM;\n\n\tstack_shift = vma->vm_end - stack_top;\n\n\tbprm->p -= stack_shift;\n\tmm->arg_start = bprm->p;\n#endif\n\n\tif (bprm->loader)\n\t\tbprm->loader -= stack_shift;\n\tbprm->exec -= stack_shift;\n\n\tdown_write(&mm->mmap_sem);\n\tvm_flags = VM_STACK_FLAGS;\n\n\t/*\n\t * Adjust stack execute permissions; explicitly enable for\n\t * EXSTACK_ENABLE_X, disable for EXSTACK_DISABLE_X and leave alone\n\t * (arch default) otherwise.\n\t */\n\tif (unlikely(executable_stack == EXSTACK_ENABLE_X))\n\t\tvm_flags |= VM_EXEC;\n\telse if (executable_stack == EXSTACK_DISABLE_X)\n\t\tvm_flags &= ~VM_EXEC;\n\tvm_flags |= mm->def_flags;\n\tvm_flags |= VM_STACK_INCOMPLETE_SETUP;\n\n\tret = mprotect_fixup(vma, &prev, vma->vm_start, vma->vm_end,\n\t\t\tvm_flags);\n\tif (ret)\n\t\tgoto out_unlock;\n\tBUG_ON(prev != vma);\n\n\t/* Move stack pages down in memory. */\n\tif (stack_shift) {\n\t\tret = shift_arg_pages(vma, stack_shift);\n\t\tif (ret)\n\t\t\tgoto out_unlock;\n\t}\n\n\t/* mprotect_fixup is overkill to remove the temporary stack flags */\n\tvma->vm_flags &= ~VM_STACK_INCOMPLETE_SETUP;\n\n\tstack_expand = 131072UL; /* randomly 32*4k (or 2*64k) pages */\n\tstack_size = vma->vm_end - vma->vm_start;\n\t/*\n\t * Align this down to a page boundary as expand_stack\n\t * will align it up.\n\t */\n\trlim_stack = rlimit(RLIMIT_STACK) & PAGE_MASK;\n#ifdef CONFIG_STACK_GROWSUP\n\tif (stack_size + stack_expand > rlim_stack)\n\t\tstack_base = vma->vm_start + rlim_stack;\n\telse\n\t\tstack_base = vma->vm_end + stack_expand;\n#else\n\tif (stack_size + stack_expand > rlim_stack)\n\t\tstack_base = vma->vm_end - rlim_stack;\n\telse\n\t\tstack_base = vma->vm_start - stack_expand;\n#endif\n\tcurrent->mm->start_stack = bprm->p;\n\tret = expand_stack(vma, stack_base);\n\tif (ret)\n\t\tret = -EFAULT;\n\nout_unlock:\n\tup_write(&mm->mmap_sem);\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "N_BSSADDR",
          "args": [
            "ex"
          ],
          "line": 256
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "N_DATADDR",
          "args": [
            "ex"
          ],
          "line": 254
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "N_TXTADDR",
          "args": [
            "ex"
          ],
          "line": 252
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "setup_new_exec",
          "args": [
            "bprm"
          ],
          "line": 249
        },
        "resolved": true,
        "details": {
          "function_name": "setup_new_exec",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/exec.c",
          "lines": "1112-1148",
          "snippet": "void setup_new_exec(struct linux_binprm * bprm)\n{\n\tarch_pick_mmap_layout(current->mm);\n\n\t/* This is the point of no return */\n\tcurrent->sas_ss_sp = current->sas_ss_size = 0;\n\n\tif (uid_eq(current_euid(), current_uid()) && gid_eq(current_egid(), current_gid()))\n\t\tset_dumpable(current->mm, SUID_DUMP_USER);\n\telse\n\t\tset_dumpable(current->mm, suid_dumpable);\n\n\tperf_event_exec();\n\t__set_task_comm(current, kbasename(bprm->filename), true);\n\n\t/* Set the new mm task size. We have to do that late because it may\n\t * depend on TIF_32BIT which is only updated in flush_thread() on\n\t * some architectures like powerpc\n\t */\n\tcurrent->mm->task_size = TASK_SIZE;\n\n\t/* install the new credentials */\n\tif (!uid_eq(bprm->cred->uid, current_euid()) ||\n\t    !gid_eq(bprm->cred->gid, current_egid())) {\n\t\tcurrent->pdeath_signal = 0;\n\t} else {\n\t\twould_dump(bprm, bprm->file);\n\t\tif (bprm->interp_flags & BINPRM_FLAGS_ENFORCE_NONDUMP)\n\t\t\tset_dumpable(current->mm, suid_dumpable);\n\t}\n\n\t/* An exec changes our domain. We are no longer part of the thread\n\t   group */\n\tcurrent->self_exec_id++;\n\tflush_signal_handlers(current, 0);\n\tdo_close_on_exec(current->files);\n}",
          "includes": [
            "#include <trace/events/sched.h>",
            "#include \"internal.h\"",
            "#include <trace/events/task.h>",
            "#include <asm/tlb.h>",
            "#include <asm/mmu_context.h>",
            "#include <asm/uaccess.h>",
            "#include <linux/compat.h>",
            "#include <linux/oom.h>",
            "#include <linux/pipe_fs_i.h>",
            "#include <linux/fs_struct.h>",
            "#include <linux/fsnotify.h>",
            "#include <linux/kmod.h>",
            "#include <linux/tracehook.h>",
            "#include <linux/audit.h>",
            "#include <linux/cn_proc.h>",
            "#include <linux/tsacct_kern.h>",
            "#include <linux/syscalls.h>",
            "#include <linux/security.h>",
            "#include <linux/mount.h>",
            "#include <linux/namei.h>",
            "#include <linux/module.h>",
            "#include <linux/pid_namespace.h>",
            "#include <linux/utsname.h>",
            "#include <linux/binfmts.h>",
            "#include <linux/personality.h>",
            "#include <linux/key.h>",
            "#include <linux/spinlock.h>",
            "#include <linux/highmem.h>",
            "#include <linux/perf_event.h>",
            "#include <linux/pagemap.h>",
            "#include <linux/init.h>",
            "#include <linux/string.h>",
            "#include <linux/swap.h>",
            "#include <linux/fcntl.h>",
            "#include <linux/stat.h>",
            "#include <linux/vmacache.h>",
            "#include <linux/mm.h>",
            "#include <linux/fdtable.h>",
            "#include <linux/file.h>",
            "#include <linux/slab.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "int suid_dumpable = 0;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <trace/events/sched.h>\n#include \"internal.h\"\n#include <trace/events/task.h>\n#include <asm/tlb.h>\n#include <asm/mmu_context.h>\n#include <asm/uaccess.h>\n#include <linux/compat.h>\n#include <linux/oom.h>\n#include <linux/pipe_fs_i.h>\n#include <linux/fs_struct.h>\n#include <linux/fsnotify.h>\n#include <linux/kmod.h>\n#include <linux/tracehook.h>\n#include <linux/audit.h>\n#include <linux/cn_proc.h>\n#include <linux/tsacct_kern.h>\n#include <linux/syscalls.h>\n#include <linux/security.h>\n#include <linux/mount.h>\n#include <linux/namei.h>\n#include <linux/module.h>\n#include <linux/pid_namespace.h>\n#include <linux/utsname.h>\n#include <linux/binfmts.h>\n#include <linux/personality.h>\n#include <linux/key.h>\n#include <linux/spinlock.h>\n#include <linux/highmem.h>\n#include <linux/perf_event.h>\n#include <linux/pagemap.h>\n#include <linux/init.h>\n#include <linux/string.h>\n#include <linux/swap.h>\n#include <linux/fcntl.h>\n#include <linux/stat.h>\n#include <linux/vmacache.h>\n#include <linux/mm.h>\n#include <linux/fdtable.h>\n#include <linux/file.h>\n#include <linux/slab.h>\n\nint suid_dumpable = 0;\n\nvoid setup_new_exec(struct linux_binprm * bprm)\n{\n\tarch_pick_mmap_layout(current->mm);\n\n\t/* This is the point of no return */\n\tcurrent->sas_ss_sp = current->sas_ss_size = 0;\n\n\tif (uid_eq(current_euid(), current_uid()) && gid_eq(current_egid(), current_gid()))\n\t\tset_dumpable(current->mm, SUID_DUMP_USER);\n\telse\n\t\tset_dumpable(current->mm, suid_dumpable);\n\n\tperf_event_exec();\n\t__set_task_comm(current, kbasename(bprm->filename), true);\n\n\t/* Set the new mm task size. We have to do that late because it may\n\t * depend on TIF_32BIT which is only updated in flush_thread() on\n\t * some architectures like powerpc\n\t */\n\tcurrent->mm->task_size = TASK_SIZE;\n\n\t/* install the new credentials */\n\tif (!uid_eq(bprm->cred->uid, current_euid()) ||\n\t    !gid_eq(bprm->cred->gid, current_egid())) {\n\t\tcurrent->pdeath_signal = 0;\n\t} else {\n\t\twould_dump(bprm, bprm->file);\n\t\tif (bprm->interp_flags & BINPRM_FLAGS_ENFORCE_NONDUMP)\n\t\t\tset_dumpable(current->mm, suid_dumpable);\n\t}\n\n\t/* An exec changes our domain. We are no longer part of the thread\n\t   group */\n\tcurrent->self_exec_id++;\n\tflush_signal_handlers(current, 0);\n\tdo_close_on_exec(current->files);\n}"
        }
      },
      {
        "call_info": {
          "callee": "set_personality",
          "args": [
            "PER_LINUX"
          ],
          "line": 247
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "SET_AOUT_PERSONALITY",
          "args": [
            "bprm",
            "ex"
          ],
          "line": 245
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "flush_old_exec",
          "args": [
            "bprm"
          ],
          "line": 239
        },
        "resolved": true,
        "details": {
          "function_name": "flush_old_exec",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/exec.c",
          "lines": "1069-1102",
          "snippet": "int flush_old_exec(struct linux_binprm * bprm)\n{\n\tint retval;\n\n\t/*\n\t * Make sure we have a private signal table and that\n\t * we are unassociated from the previous thread group.\n\t */\n\tretval = de_thread(current);\n\tif (retval)\n\t\tgoto out;\n\n\tset_mm_exe_file(bprm->mm, bprm->file);\n\t/*\n\t * Release all of the old mmap stuff\n\t */\n\tacct_arg_size(bprm, 0);\n\tretval = exec_mmap(bprm->mm);\n\tif (retval)\n\t\tgoto out;\n\n\tbprm->mm = NULL;\t\t/* We're using it now */\n\n\tset_fs(USER_DS);\n\tcurrent->flags &= ~(PF_RANDOMIZE | PF_FORKNOEXEC | PF_KTHREAD |\n\t\t\t\t\tPF_NOFREEZE | PF_NO_SETAFFINITY);\n\tflush_thread();\n\tcurrent->personality &= ~bprm->per_clear;\n\n\treturn 0;\n\nout:\n\treturn retval;\n}",
          "includes": [
            "#include <trace/events/sched.h>",
            "#include \"internal.h\"",
            "#include <trace/events/task.h>",
            "#include <asm/tlb.h>",
            "#include <asm/mmu_context.h>",
            "#include <asm/uaccess.h>",
            "#include <linux/compat.h>",
            "#include <linux/oom.h>",
            "#include <linux/pipe_fs_i.h>",
            "#include <linux/fs_struct.h>",
            "#include <linux/fsnotify.h>",
            "#include <linux/kmod.h>",
            "#include <linux/tracehook.h>",
            "#include <linux/audit.h>",
            "#include <linux/cn_proc.h>",
            "#include <linux/tsacct_kern.h>",
            "#include <linux/syscalls.h>",
            "#include <linux/security.h>",
            "#include <linux/mount.h>",
            "#include <linux/namei.h>",
            "#include <linux/module.h>",
            "#include <linux/pid_namespace.h>",
            "#include <linux/utsname.h>",
            "#include <linux/binfmts.h>",
            "#include <linux/personality.h>",
            "#include <linux/key.h>",
            "#include <linux/spinlock.h>",
            "#include <linux/highmem.h>",
            "#include <linux/perf_event.h>",
            "#include <linux/pagemap.h>",
            "#include <linux/init.h>",
            "#include <linux/string.h>",
            "#include <linux/swap.h>",
            "#include <linux/fcntl.h>",
            "#include <linux/stat.h>",
            "#include <linux/vmacache.h>",
            "#include <linux/mm.h>",
            "#include <linux/fdtable.h>",
            "#include <linux/file.h>",
            "#include <linux/slab.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <trace/events/sched.h>\n#include \"internal.h\"\n#include <trace/events/task.h>\n#include <asm/tlb.h>\n#include <asm/mmu_context.h>\n#include <asm/uaccess.h>\n#include <linux/compat.h>\n#include <linux/oom.h>\n#include <linux/pipe_fs_i.h>\n#include <linux/fs_struct.h>\n#include <linux/fsnotify.h>\n#include <linux/kmod.h>\n#include <linux/tracehook.h>\n#include <linux/audit.h>\n#include <linux/cn_proc.h>\n#include <linux/tsacct_kern.h>\n#include <linux/syscalls.h>\n#include <linux/security.h>\n#include <linux/mount.h>\n#include <linux/namei.h>\n#include <linux/module.h>\n#include <linux/pid_namespace.h>\n#include <linux/utsname.h>\n#include <linux/binfmts.h>\n#include <linux/personality.h>\n#include <linux/key.h>\n#include <linux/spinlock.h>\n#include <linux/highmem.h>\n#include <linux/perf_event.h>\n#include <linux/pagemap.h>\n#include <linux/init.h>\n#include <linux/string.h>\n#include <linux/swap.h>\n#include <linux/fcntl.h>\n#include <linux/stat.h>\n#include <linux/vmacache.h>\n#include <linux/mm.h>\n#include <linux/fdtable.h>\n#include <linux/file.h>\n#include <linux/slab.h>\n\nint flush_old_exec(struct linux_binprm * bprm)\n{\n\tint retval;\n\n\t/*\n\t * Make sure we have a private signal table and that\n\t * we are unassociated from the previous thread group.\n\t */\n\tretval = de_thread(current);\n\tif (retval)\n\t\tgoto out;\n\n\tset_mm_exe_file(bprm->mm, bprm->file);\n\t/*\n\t * Release all of the old mmap stuff\n\t */\n\tacct_arg_size(bprm, 0);\n\tretval = exec_mmap(bprm->mm);\n\tif (retval)\n\t\tgoto out;\n\n\tbprm->mm = NULL;\t\t/* We're using it now */\n\n\tset_fs(USER_DS);\n\tcurrent->flags &= ~(PF_RANDOMIZE | PF_FORKNOEXEC | PF_KTHREAD |\n\t\t\t\t\tPF_NOFREEZE | PF_NO_SETAFFINITY);\n\tflush_thread();\n\tcurrent->personality &= ~bprm->per_clear;\n\n\treturn 0;\n\nout:\n\treturn retval;\n}"
        }
      },
      {
        "call_info": {
          "callee": "rlimit",
          "args": [
            "RLIMIT_DATA"
          ],
          "line": 232
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "N_TXTOFF",
          "args": [
            "ex"
          ],
          "line": 226
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "N_TXTOFF",
          "args": [
            "ex"
          ],
          "line": 215
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "N_SYMSIZE",
          "args": [
            "ex"
          ],
          "line": 215
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "i_size_read",
          "args": [
            "file_inode(bprm->file)"
          ],
          "line": 215
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "file_inode",
          "args": [
            "bprm->file"
          ],
          "line": 215
        },
        "resolved": true,
        "details": {
          "function_name": "fuse_init_file_inode",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/fuse/file.c",
          "lines": "3009-3013",
          "snippet": "void fuse_init_file_inode(struct inode *inode)\n{\n\tinode->i_fop = &fuse_file_operations;\n\tinode->i_data.a_ops = &fuse_file_aops;\n}",
          "includes": [
            "#include <linux/falloc.h>",
            "#include <linux/aio.h>",
            "#include <linux/swap.h>",
            "#include <linux/compat.h>",
            "#include <linux/module.h>",
            "#include <linux/sched.h>",
            "#include <linux/kernel.h>",
            "#include <linux/slab.h>",
            "#include <linux/pagemap.h>",
            "#include \"fuse_i.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static const struct file_operations fuse_file_operations = {\n\t.llseek\t\t= fuse_file_llseek,\n\t.read\t\t= new_sync_read,\n\t.read_iter\t= fuse_file_read_iter,\n\t.write\t\t= new_sync_write,\n\t.write_iter\t= fuse_file_write_iter,\n\t.mmap\t\t= fuse_file_mmap,\n\t.open\t\t= fuse_open,\n\t.flush\t\t= fuse_flush,\n\t.release\t= fuse_release,\n\t.fsync\t\t= fuse_fsync,\n\t.lock\t\t= fuse_file_lock,\n\t.flock\t\t= fuse_file_flock,\n\t.splice_read\t= generic_file_splice_read,\n\t.unlocked_ioctl\t= fuse_file_ioctl,\n\t.compat_ioctl\t= fuse_file_compat_ioctl,\n\t.poll\t\t= fuse_file_poll,\n\t.fallocate\t= fuse_file_fallocate,\n};",
            "static const struct address_space_operations fuse_file_aops  = {\n\t.readpage\t= fuse_readpage,\n\t.writepage\t= fuse_writepage,\n\t.writepages\t= fuse_writepages,\n\t.launder_page\t= fuse_launder_page,\n\t.readpages\t= fuse_readpages,\n\t.set_page_dirty\t= __set_page_dirty_nobuffers,\n\t.bmap\t\t= fuse_bmap,\n\t.direct_IO\t= fuse_direct_IO,\n\t.write_begin\t= fuse_write_begin,\n\t.write_end\t= fuse_write_end,\n};"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <linux/falloc.h>\n#include <linux/aio.h>\n#include <linux/swap.h>\n#include <linux/compat.h>\n#include <linux/module.h>\n#include <linux/sched.h>\n#include <linux/kernel.h>\n#include <linux/slab.h>\n#include <linux/pagemap.h>\n#include \"fuse_i.h\"\n\nstatic const struct file_operations fuse_file_operations = {\n\t.llseek\t\t= fuse_file_llseek,\n\t.read\t\t= new_sync_read,\n\t.read_iter\t= fuse_file_read_iter,\n\t.write\t\t= new_sync_write,\n\t.write_iter\t= fuse_file_write_iter,\n\t.mmap\t\t= fuse_file_mmap,\n\t.open\t\t= fuse_open,\n\t.flush\t\t= fuse_flush,\n\t.release\t= fuse_release,\n\t.fsync\t\t= fuse_fsync,\n\t.lock\t\t= fuse_file_lock,\n\t.flock\t\t= fuse_file_flock,\n\t.splice_read\t= generic_file_splice_read,\n\t.unlocked_ioctl\t= fuse_file_ioctl,\n\t.compat_ioctl\t= fuse_file_compat_ioctl,\n\t.poll\t\t= fuse_file_poll,\n\t.fallocate\t= fuse_file_fallocate,\n};\nstatic const struct address_space_operations fuse_file_aops  = {\n\t.readpage\t= fuse_readpage,\n\t.writepage\t= fuse_writepage,\n\t.writepages\t= fuse_writepages,\n\t.launder_page\t= fuse_launder_page,\n\t.readpages\t= fuse_readpages,\n\t.set_page_dirty\t= __set_page_dirty_nobuffers,\n\t.bmap\t\t= fuse_bmap,\n\t.direct_IO\t= fuse_direct_IO,\n\t.write_begin\t= fuse_write_begin,\n\t.write_end\t= fuse_write_end,\n};\n\nvoid fuse_init_file_inode(struct inode *inode)\n{\n\tinode->i_fop = &fuse_file_operations;\n\tinode->i_data.a_ops = &fuse_file_aops;\n}"
        }
      },
      {
        "call_info": {
          "callee": "N_DRSIZE",
          "args": [
            "ex"
          ],
          "line": 214
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "N_TRSIZE",
          "args": [
            "ex"
          ],
          "line": 214
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "N_MAGIC",
          "args": [
            "ex"
          ],
          "line": 213
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "N_MAGIC",
          "args": [
            "ex"
          ],
          "line": 213
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "N_MAGIC",
          "args": [
            "ex"
          ],
          "line": 212
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "N_MAGIC",
          "args": [
            "ex"
          ],
          "line": 212
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "current_pt_regs",
          "args": [],
          "line": 204
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <asm/a.out-core.h>\n#include <asm/cacheflush.h>\n#include <asm/uaccess.h>\n#include <linux/slab.h>\n#include <linux/coredump.h>\n#include <linux/init.h>\n#include <linux/personality.h>\n#include <linux/binfmts.h>\n#include <linux/user.h>\n#include <linux/ptrace.h>\n#include <linux/fcntl.h>\n#include <linux/stat.h>\n#include <linux/file.h>\n#include <linux/fs.h>\n#include <linux/string.h>\n#include <linux/signal.h>\n#include <linux/errno.h>\n#include <linux/a.out.h>\n#include <linux/mman.h>\n#include <linux/mm.h>\n#include <linux/kernel.h>\n#include <linux/time.h>\n#include <linux/module.h>\n\nstatic int load_aout_binary(struct linux_binprm *);\nstatic int load_aout_library(struct file*);\nstatic struct linux_binfmt aout_format = {\n\t.module\t\t= THIS_MODULE,\n\t.load_binary\t= load_aout_binary,\n\t.load_shlib\t= load_aout_library,\n\t.core_dump\t= aout_core_dump,\n\t.min_coredump\t= PAGE_SIZE\n};\n\nstatic int load_aout_binary(struct linux_binprm * bprm)\n{\n\tstruct pt_regs *regs = current_pt_regs();\n\tstruct exec ex;\n\tunsigned long error;\n\tunsigned long fd_offset;\n\tunsigned long rlim;\n\tint retval;\n\n\tex = *((struct exec *) bprm->buf);\t\t/* exec-header */\n\tif ((N_MAGIC(ex) != ZMAGIC && N_MAGIC(ex) != OMAGIC &&\n\t     N_MAGIC(ex) != QMAGIC && N_MAGIC(ex) != NMAGIC) ||\n\t    N_TRSIZE(ex) || N_DRSIZE(ex) ||\n\t    i_size_read(file_inode(bprm->file)) < ex.a_text+ex.a_data+N_SYMSIZE(ex)+N_TXTOFF(ex)) {\n\t\treturn -ENOEXEC;\n\t}\n\n\t/*\n\t * Requires a mmap handler. This prevents people from using a.out\n\t * as part of an exploit attack against /proc-related vulnerabilities.\n\t */\n\tif (!bprm->file->f_op->mmap)\n\t\treturn -ENOEXEC;\n\n\tfd_offset = N_TXTOFF(ex);\n\n\t/* Check initial limits. This avoids letting people circumvent\n\t * size limits imposed on them by creating programs with large\n\t * arrays in the data or bss.\n\t */\n\trlim = rlimit(RLIMIT_DATA);\n\tif (rlim >= RLIM_INFINITY)\n\t\trlim = ~0;\n\tif (ex.a_data + ex.a_bss > rlim)\n\t\treturn -ENOMEM;\n\n\t/* Flush all traces of the currently running executable */\n\tretval = flush_old_exec(bprm);\n\tif (retval)\n\t\treturn retval;\n\n\t/* OK, This is the point of no return */\n#ifdef __alpha__\n\tSET_AOUT_PERSONALITY(bprm, ex);\n#else\n\tset_personality(PER_LINUX);\n#endif\n\tsetup_new_exec(bprm);\n\n\tcurrent->mm->end_code = ex.a_text +\n\t\t(current->mm->start_code = N_TXTADDR(ex));\n\tcurrent->mm->end_data = ex.a_data +\n\t\t(current->mm->start_data = N_DATADDR(ex));\n\tcurrent->mm->brk = ex.a_bss +\n\t\t(current->mm->start_brk = N_BSSADDR(ex));\n\n\tretval = setup_arg_pages(bprm, STACK_TOP, EXSTACK_DEFAULT);\n\tif (retval < 0)\n\t\treturn retval;\n\n\tinstall_exec_creds(bprm);\n\n\tif (N_MAGIC(ex) == OMAGIC) {\n\t\tunsigned long text_addr, map_size;\n\t\tloff_t pos;\n\n\t\ttext_addr = N_TXTADDR(ex);\n\n#ifdef __alpha__\n\t\tpos = fd_offset;\n\t\tmap_size = ex.a_text+ex.a_data + PAGE_SIZE - 1;\n#else\n\t\tpos = 32;\n\t\tmap_size = ex.a_text+ex.a_data;\n#endif\n\t\terror = vm_brk(text_addr & PAGE_MASK, map_size);\n\t\tif (error != (text_addr & PAGE_MASK))\n\t\t\treturn error;\n\n\t\terror = read_code(bprm->file, text_addr, pos,\n\t\t\t\t  ex.a_text+ex.a_data);\n\t\tif ((signed long)error < 0)\n\t\t\treturn error;\n\t} else {\n\t\tif ((ex.a_text & 0xfff || ex.a_data & 0xfff) &&\n\t\t    (N_MAGIC(ex) != NMAGIC) && printk_ratelimit())\n\t\t{\n\t\t\tprintk(KERN_NOTICE \"executable not page aligned\\n\");\n\t\t}\n\n\t\tif ((fd_offset & ~PAGE_MASK) != 0 && printk_ratelimit())\n\t\t{\n\t\t\tprintk(KERN_WARNING \n\t\t\t       \"fd_offset is not page aligned. Please convert program: %pD\\n\",\n\t\t\t       bprm->file);\n\t\t}\n\n\t\tif (!bprm->file->f_op->mmap||((fd_offset & ~PAGE_MASK) != 0)) {\n\t\t\tvm_brk(N_TXTADDR(ex), ex.a_text+ex.a_data);\n\t\t\tread_code(bprm->file, N_TXTADDR(ex), fd_offset,\n\t\t\t\t  ex.a_text + ex.a_data);\n\t\t\tgoto beyond_if;\n\t\t}\n\n\t\terror = vm_mmap(bprm->file, N_TXTADDR(ex), ex.a_text,\n\t\t\tPROT_READ | PROT_EXEC,\n\t\t\tMAP_FIXED | MAP_PRIVATE | MAP_DENYWRITE | MAP_EXECUTABLE,\n\t\t\tfd_offset);\n\n\t\tif (error != N_TXTADDR(ex))\n\t\t\treturn error;\n\n\t\terror = vm_mmap(bprm->file, N_DATADDR(ex), ex.a_data,\n\t\t\t\tPROT_READ | PROT_WRITE | PROT_EXEC,\n\t\t\t\tMAP_FIXED | MAP_PRIVATE | MAP_DENYWRITE | MAP_EXECUTABLE,\n\t\t\t\tfd_offset + ex.a_text);\n\t\tif (error != N_DATADDR(ex))\n\t\t\treturn error;\n\t}\nbeyond_if:\n\tset_binfmt(&aout_format);\n\n\tretval = set_brk(current->mm->start_brk, current->mm->brk);\n\tif (retval < 0)\n\t\treturn retval;\n\n\tcurrent->mm->start_stack =\n\t\t(unsigned long) create_aout_tables((char __user *) bprm->p, bprm);\n#ifdef __alpha__\n\tregs->gp = ex.a_gpvalue;\n#endif\n\tstart_thread(regs, ex.a_entry, current->mm->start_stack);\n\treturn 0;\n}"
  },
  {
    "function_name": "create_aout_tables",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/binfmt_aout.c",
    "lines": "144-195",
    "snippet": "static unsigned long __user *create_aout_tables(char __user *p, struct linux_binprm * bprm)\n{\n\tchar __user * __user *argv;\n\tchar __user * __user *envp;\n\tunsigned long __user *sp;\n\tint argc = bprm->argc;\n\tint envc = bprm->envc;\n\n\tsp = (void __user *)((-(unsigned long)sizeof(char *)) & (unsigned long) p);\n#ifdef __alpha__\n/* whee.. test-programs are so much fun. */\n\tput_user(0, --sp);\n\tput_user(0, --sp);\n\tif (bprm->loader) {\n\t\tput_user(0, --sp);\n\t\tput_user(1003, --sp);\n\t\tput_user(bprm->loader, --sp);\n\t\tput_user(1002, --sp);\n\t}\n\tput_user(bprm->exec, --sp);\n\tput_user(1001, --sp);\n#endif\n\tsp -= envc+1;\n\tenvp = (char __user * __user *) sp;\n\tsp -= argc+1;\n\targv = (char __user * __user *) sp;\n#ifndef __alpha__\n\tput_user((unsigned long) envp,--sp);\n\tput_user((unsigned long) argv,--sp);\n#endif\n\tput_user(argc,--sp);\n\tcurrent->mm->arg_start = (unsigned long) p;\n\twhile (argc-->0) {\n\t\tchar c;\n\t\tput_user(p,argv++);\n\t\tdo {\n\t\t\tget_user(c,p++);\n\t\t} while (c);\n\t}\n\tput_user(NULL,argv);\n\tcurrent->mm->arg_end = current->mm->env_start = (unsigned long) p;\n\twhile (envc-->0) {\n\t\tchar c;\n\t\tput_user(p,envp++);\n\t\tdo {\n\t\t\tget_user(c,p++);\n\t\t} while (c);\n\t}\n\tput_user(NULL,envp);\n\tcurrent->mm->env_end = (unsigned long) p;\n\treturn sp;\n}",
    "includes": [
      "#include <asm/a.out-core.h>",
      "#include <asm/cacheflush.h>",
      "#include <asm/uaccess.h>",
      "#include <linux/slab.h>",
      "#include <linux/coredump.h>",
      "#include <linux/init.h>",
      "#include <linux/personality.h>",
      "#include <linux/binfmts.h>",
      "#include <linux/user.h>",
      "#include <linux/ptrace.h>",
      "#include <linux/fcntl.h>",
      "#include <linux/stat.h>",
      "#include <linux/file.h>",
      "#include <linux/fs.h>",
      "#include <linux/string.h>",
      "#include <linux/signal.h>",
      "#include <linux/errno.h>",
      "#include <linux/a.out.h>",
      "#include <linux/mman.h>",
      "#include <linux/mm.h>",
      "#include <linux/kernel.h>",
      "#include <linux/time.h>",
      "#include <linux/module.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static int load_aout_binary(struct linux_binprm *);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "put_user",
          "args": [
            "NULL",
            "envp"
          ],
          "line": 192
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "get_user",
          "args": [
            "c",
            "p++"
          ],
          "line": 189
        },
        "resolved": true,
        "details": {
          "function_name": "get_user_arg_ptr",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/exec.c",
          "lines": "399-418",
          "snippet": "static const char __user *get_user_arg_ptr(struct user_arg_ptr argv, int nr)\n{\n\tconst char __user *native;\n\n#ifdef CONFIG_COMPAT\n\tif (unlikely(argv.is_compat)) {\n\t\tcompat_uptr_t compat;\n\n\t\tif (get_user(compat, argv.ptr.compat + nr))\n\t\t\treturn ERR_PTR(-EFAULT);\n\n\t\treturn compat_ptr(compat);\n\t}\n#endif\n\n\tif (get_user(native, argv.ptr.native + nr))\n\t\treturn ERR_PTR(-EFAULT);\n\n\treturn native;\n}",
          "includes": [
            "#include <trace/events/sched.h>",
            "#include \"internal.h\"",
            "#include <trace/events/task.h>",
            "#include <asm/tlb.h>",
            "#include <asm/mmu_context.h>",
            "#include <asm/uaccess.h>",
            "#include <linux/compat.h>",
            "#include <linux/oom.h>",
            "#include <linux/pipe_fs_i.h>",
            "#include <linux/fs_struct.h>",
            "#include <linux/fsnotify.h>",
            "#include <linux/kmod.h>",
            "#include <linux/tracehook.h>",
            "#include <linux/audit.h>",
            "#include <linux/cn_proc.h>",
            "#include <linux/tsacct_kern.h>",
            "#include <linux/syscalls.h>",
            "#include <linux/security.h>",
            "#include <linux/mount.h>",
            "#include <linux/namei.h>",
            "#include <linux/module.h>",
            "#include <linux/pid_namespace.h>",
            "#include <linux/utsname.h>",
            "#include <linux/binfmts.h>",
            "#include <linux/personality.h>",
            "#include <linux/key.h>",
            "#include <linux/spinlock.h>",
            "#include <linux/highmem.h>",
            "#include <linux/perf_event.h>",
            "#include <linux/pagemap.h>",
            "#include <linux/init.h>",
            "#include <linux/string.h>",
            "#include <linux/swap.h>",
            "#include <linux/fcntl.h>",
            "#include <linux/stat.h>",
            "#include <linux/vmacache.h>",
            "#include <linux/mm.h>",
            "#include <linux/fdtable.h>",
            "#include <linux/file.h>",
            "#include <linux/slab.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <trace/events/sched.h>\n#include \"internal.h\"\n#include <trace/events/task.h>\n#include <asm/tlb.h>\n#include <asm/mmu_context.h>\n#include <asm/uaccess.h>\n#include <linux/compat.h>\n#include <linux/oom.h>\n#include <linux/pipe_fs_i.h>\n#include <linux/fs_struct.h>\n#include <linux/fsnotify.h>\n#include <linux/kmod.h>\n#include <linux/tracehook.h>\n#include <linux/audit.h>\n#include <linux/cn_proc.h>\n#include <linux/tsacct_kern.h>\n#include <linux/syscalls.h>\n#include <linux/security.h>\n#include <linux/mount.h>\n#include <linux/namei.h>\n#include <linux/module.h>\n#include <linux/pid_namespace.h>\n#include <linux/utsname.h>\n#include <linux/binfmts.h>\n#include <linux/personality.h>\n#include <linux/key.h>\n#include <linux/spinlock.h>\n#include <linux/highmem.h>\n#include <linux/perf_event.h>\n#include <linux/pagemap.h>\n#include <linux/init.h>\n#include <linux/string.h>\n#include <linux/swap.h>\n#include <linux/fcntl.h>\n#include <linux/stat.h>\n#include <linux/vmacache.h>\n#include <linux/mm.h>\n#include <linux/fdtable.h>\n#include <linux/file.h>\n#include <linux/slab.h>\n\nstatic const char __user *get_user_arg_ptr(struct user_arg_ptr argv, int nr)\n{\n\tconst char __user *native;\n\n#ifdef CONFIG_COMPAT\n\tif (unlikely(argv.is_compat)) {\n\t\tcompat_uptr_t compat;\n\n\t\tif (get_user(compat, argv.ptr.compat + nr))\n\t\t\treturn ERR_PTR(-EFAULT);\n\n\t\treturn compat_ptr(compat);\n\t}\n#endif\n\n\tif (get_user(native, argv.ptr.native + nr))\n\t\treturn ERR_PTR(-EFAULT);\n\n\treturn native;\n}"
        }
      },
      {
        "call_info": {
          "callee": "put_user",
          "args": [
            "p",
            "envp++"
          ],
          "line": 187
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "put_user",
          "args": [
            "NULL",
            "argv"
          ],
          "line": 183
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "put_user",
          "args": [
            "p",
            "argv++"
          ],
          "line": 178
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "put_user",
          "args": [
            "argc",
            "--sp"
          ],
          "line": 174
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "put_user",
          "args": [
            "(unsigned long) argv",
            "--sp"
          ],
          "line": 172
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "put_user",
          "args": [
            "(unsigned long) envp",
            "--sp"
          ],
          "line": 171
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "put_user",
          "args": [
            "1001",
            "--sp"
          ],
          "line": 164
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "put_user",
          "args": [
            "bprm->exec",
            "--sp"
          ],
          "line": 163
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "put_user",
          "args": [
            "1002",
            "--sp"
          ],
          "line": 161
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "put_user",
          "args": [
            "bprm->loader",
            "--sp"
          ],
          "line": 160
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "put_user",
          "args": [
            "1003",
            "--sp"
          ],
          "line": 159
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "put_user",
          "args": [
            "0",
            "--sp"
          ],
          "line": 158
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "put_user",
          "args": [
            "0",
            "--sp"
          ],
          "line": 156
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "put_user",
          "args": [
            "0",
            "--sp"
          ],
          "line": 155
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <asm/a.out-core.h>\n#include <asm/cacheflush.h>\n#include <asm/uaccess.h>\n#include <linux/slab.h>\n#include <linux/coredump.h>\n#include <linux/init.h>\n#include <linux/personality.h>\n#include <linux/binfmts.h>\n#include <linux/user.h>\n#include <linux/ptrace.h>\n#include <linux/fcntl.h>\n#include <linux/stat.h>\n#include <linux/file.h>\n#include <linux/fs.h>\n#include <linux/string.h>\n#include <linux/signal.h>\n#include <linux/errno.h>\n#include <linux/a.out.h>\n#include <linux/mman.h>\n#include <linux/mm.h>\n#include <linux/kernel.h>\n#include <linux/time.h>\n#include <linux/module.h>\n\nstatic int load_aout_binary(struct linux_binprm *);\n\nstatic unsigned long __user *create_aout_tables(char __user *p, struct linux_binprm * bprm)\n{\n\tchar __user * __user *argv;\n\tchar __user * __user *envp;\n\tunsigned long __user *sp;\n\tint argc = bprm->argc;\n\tint envc = bprm->envc;\n\n\tsp = (void __user *)((-(unsigned long)sizeof(char *)) & (unsigned long) p);\n#ifdef __alpha__\n/* whee.. test-programs are so much fun. */\n\tput_user(0, --sp);\n\tput_user(0, --sp);\n\tif (bprm->loader) {\n\t\tput_user(0, --sp);\n\t\tput_user(1003, --sp);\n\t\tput_user(bprm->loader, --sp);\n\t\tput_user(1002, --sp);\n\t}\n\tput_user(bprm->exec, --sp);\n\tput_user(1001, --sp);\n#endif\n\tsp -= envc+1;\n\tenvp = (char __user * __user *) sp;\n\tsp -= argc+1;\n\targv = (char __user * __user *) sp;\n#ifndef __alpha__\n\tput_user((unsigned long) envp,--sp);\n\tput_user((unsigned long) argv,--sp);\n#endif\n\tput_user(argc,--sp);\n\tcurrent->mm->arg_start = (unsigned long) p;\n\twhile (argc-->0) {\n\t\tchar c;\n\t\tput_user(p,argv++);\n\t\tdo {\n\t\t\tget_user(c,p++);\n\t\t} while (c);\n\t}\n\tput_user(NULL,argv);\n\tcurrent->mm->arg_end = current->mm->env_start = (unsigned long) p;\n\twhile (envc-->0) {\n\t\tchar c;\n\t\tput_user(p,envp++);\n\t\tdo {\n\t\t\tget_user(c,p++);\n\t\t} while (c);\n\t}\n\tput_user(NULL,envp);\n\tcurrent->mm->env_end = (unsigned long) p;\n\treturn sp;\n}"
  },
  {
    "function_name": "set_brk",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/binfmt_aout.c",
    "lines": "126-137",
    "snippet": "static int set_brk(unsigned long start, unsigned long end)\n{\n\tstart = PAGE_ALIGN(start);\n\tend = PAGE_ALIGN(end);\n\tif (end > start) {\n\t\tunsigned long addr;\n\t\taddr = vm_brk(start, end - start);\n\t\tif (BAD_ADDR(addr))\n\t\t\treturn addr;\n\t}\n\treturn 0;\n}",
    "includes": [
      "#include <asm/a.out-core.h>",
      "#include <asm/cacheflush.h>",
      "#include <asm/uaccess.h>",
      "#include <linux/slab.h>",
      "#include <linux/coredump.h>",
      "#include <linux/init.h>",
      "#include <linux/personality.h>",
      "#include <linux/binfmts.h>",
      "#include <linux/user.h>",
      "#include <linux/ptrace.h>",
      "#include <linux/fcntl.h>",
      "#include <linux/stat.h>",
      "#include <linux/file.h>",
      "#include <linux/fs.h>",
      "#include <linux/string.h>",
      "#include <linux/signal.h>",
      "#include <linux/errno.h>",
      "#include <linux/a.out.h>",
      "#include <linux/mman.h>",
      "#include <linux/mm.h>",
      "#include <linux/kernel.h>",
      "#include <linux/time.h>",
      "#include <linux/module.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "BAD_ADDR",
          "args": [
            "addr"
          ],
          "line": 133
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "vm_brk",
          "args": [
            "start",
            "end - start"
          ],
          "line": 132
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "PAGE_ALIGN",
          "args": [
            "end"
          ],
          "line": 129
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "PAGE_ALIGN",
          "args": [
            "start"
          ],
          "line": 128
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <asm/a.out-core.h>\n#include <asm/cacheflush.h>\n#include <asm/uaccess.h>\n#include <linux/slab.h>\n#include <linux/coredump.h>\n#include <linux/init.h>\n#include <linux/personality.h>\n#include <linux/binfmts.h>\n#include <linux/user.h>\n#include <linux/ptrace.h>\n#include <linux/fcntl.h>\n#include <linux/stat.h>\n#include <linux/file.h>\n#include <linux/fs.h>\n#include <linux/string.h>\n#include <linux/signal.h>\n#include <linux/errno.h>\n#include <linux/a.out.h>\n#include <linux/mman.h>\n#include <linux/mm.h>\n#include <linux/kernel.h>\n#include <linux/time.h>\n#include <linux/module.h>\n\nstatic int set_brk(unsigned long start, unsigned long end)\n{\n\tstart = PAGE_ALIGN(start);\n\tend = PAGE_ALIGN(end);\n\tif (end > start) {\n\t\tunsigned long addr;\n\t\taddr = vm_brk(start, end - start);\n\t\tif (BAD_ADDR(addr))\n\t\t\treturn addr;\n\t}\n\treturn 0;\n}"
  },
  {
    "function_name": "aout_core_dump",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/binfmt_aout.c",
    "lines": "46-111",
    "snippet": "static int aout_core_dump(struct coredump_params *cprm)\n{\n\tmm_segment_t fs;\n\tint has_dumped = 0;\n\tvoid __user *dump_start;\n\tint dump_size;\n\tstruct user dump;\n#ifdef __alpha__\n#       define START_DATA(u)\t((void __user *)u.start_data)\n#else\n#\tdefine START_DATA(u)\t((void __user *)((u.u_tsize << PAGE_SHIFT) + \\\n\t\t\t\t u.start_code))\n#endif\n#       define START_STACK(u)   ((void __user *)u.start_stack)\n\n\tfs = get_fs();\n\tset_fs(KERNEL_DS);\n\thas_dumped = 1;\n       \tstrncpy(dump.u_comm, current->comm, sizeof(dump.u_comm));\n\tdump.u_ar0 = offsetof(struct user, regs);\n\tdump.signal = cprm->siginfo->si_signo;\n\taout_dump_thread(cprm->regs, &dump);\n\n/* If the size of the dump file exceeds the rlimit, then see what would happen\n   if we wrote the stack, but not the data area.  */\n\tif ((dump.u_dsize + dump.u_ssize+1) * PAGE_SIZE > cprm->limit)\n\t\tdump.u_dsize = 0;\n\n/* Make sure we have enough room to write the stack and data areas. */\n\tif ((dump.u_ssize + 1) * PAGE_SIZE > cprm->limit)\n\t\tdump.u_ssize = 0;\n\n/* make sure we actually have a data and stack area to dump */\n\tset_fs(USER_DS);\n\tif (!access_ok(VERIFY_READ, START_DATA(dump), dump.u_dsize << PAGE_SHIFT))\n\t\tdump.u_dsize = 0;\n\tif (!access_ok(VERIFY_READ, START_STACK(dump), dump.u_ssize << PAGE_SHIFT))\n\t\tdump.u_ssize = 0;\n\n\tset_fs(KERNEL_DS);\n/* struct user */\n\tif (!dump_emit(cprm, &dump, sizeof(dump)))\n\t\tgoto end_coredump;\n/* Now dump all of the user data.  Include malloced stuff as well */\n\tif (!dump_skip(cprm, PAGE_SIZE - sizeof(dump)))\n\t\tgoto end_coredump;\n/* now we start writing out the user space info */\n\tset_fs(USER_DS);\n/* Dump the data area */\n\tif (dump.u_dsize != 0) {\n\t\tdump_start = START_DATA(dump);\n\t\tdump_size = dump.u_dsize << PAGE_SHIFT;\n\t\tif (!dump_emit(cprm, dump_start, dump_size))\n\t\t\tgoto end_coredump;\n\t}\n/* Now prepare to dump the stack area */\n\tif (dump.u_ssize != 0) {\n\t\tdump_start = START_STACK(dump);\n\t\tdump_size = dump.u_ssize << PAGE_SHIFT;\n\t\tif (!dump_emit(cprm, dump_start, dump_size))\n\t\t\tgoto end_coredump;\n\t}\nend_coredump:\n\tset_fs(fs);\n\treturn has_dumped;\n}",
    "includes": [
      "#include <asm/a.out-core.h>",
      "#include <asm/cacheflush.h>",
      "#include <asm/uaccess.h>",
      "#include <linux/slab.h>",
      "#include <linux/coredump.h>",
      "#include <linux/init.h>",
      "#include <linux/personality.h>",
      "#include <linux/binfmts.h>",
      "#include <linux/user.h>",
      "#include <linux/ptrace.h>",
      "#include <linux/fcntl.h>",
      "#include <linux/stat.h>",
      "#include <linux/file.h>",
      "#include <linux/fs.h>",
      "#include <linux/string.h>",
      "#include <linux/signal.h>",
      "#include <linux/errno.h>",
      "#include <linux/a.out.h>",
      "#include <linux/mman.h>",
      "#include <linux/mm.h>",
      "#include <linux/kernel.h>",
      "#include <linux/time.h>",
      "#include <linux/module.h>"
    ],
    "macros_used": [
      "#define aout_core_dump NULL"
    ],
    "globals_used": [
      "static int load_aout_library(struct file*);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "set_fs",
          "args": [
            "fs"
          ],
          "line": 109
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dump_emit",
          "args": [
            "cprm",
            "dump_start",
            "dump_size"
          ],
          "line": 105
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "START_STACK",
          "args": [
            "dump"
          ],
          "line": 103
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dump_emit",
          "args": [
            "cprm",
            "dump_start",
            "dump_size"
          ],
          "line": 98
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "START_DATA",
          "args": [
            "dump"
          ],
          "line": 96
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "set_fs",
          "args": [
            "USER_DS"
          ],
          "line": 93
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dump_skip",
          "args": [
            "cprm",
            "PAGE_SIZE - sizeof(dump)"
          ],
          "line": 90
        },
        "resolved": true,
        "details": {
          "function_name": "dump_skip",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/coredump.c",
          "lines": "721-741",
          "snippet": "int dump_skip(struct coredump_params *cprm, size_t nr)\n{\n\tstatic char zeroes[PAGE_SIZE];\n\tstruct file *file = cprm->file;\n\tif (file->f_op->llseek && file->f_op->llseek != no_llseek) {\n\t\tif (cprm->written + nr > cprm->limit)\n\t\t\treturn 0;\n\t\tif (dump_interrupted() ||\n\t\t    file->f_op->llseek(file, nr, SEEK_CUR) < 0)\n\t\t\treturn 0;\n\t\tcprm->written += nr;\n\t\treturn 1;\n\t} else {\n\t\twhile (nr > PAGE_SIZE) {\n\t\t\tif (!dump_emit(cprm, zeroes, PAGE_SIZE))\n\t\t\t\treturn 0;\n\t\t\tnr -= PAGE_SIZE;\n\t\t}\n\t\treturn dump_emit(cprm, zeroes, nr);\n\t}\n}",
          "includes": [
            "#include <trace/events/sched.h>",
            "#include \"internal.h\"",
            "#include <trace/events/task.h>",
            "#include <asm/exec.h>",
            "#include <asm/tlb.h>",
            "#include <asm/mmu_context.h>",
            "#include <asm/uaccess.h>",
            "#include <linux/compat.h>",
            "#include <linux/oom.h>",
            "#include <linux/pipe_fs_i.h>",
            "#include <linux/fs_struct.h>",
            "#include <linux/fsnotify.h>",
            "#include <linux/kmod.h>",
            "#include <linux/tracehook.h>",
            "#include <linux/audit.h>",
            "#include <linux/cn_proc.h>",
            "#include <linux/tsacct_kern.h>",
            "#include <linux/syscalls.h>",
            "#include <linux/security.h>",
            "#include <linux/mount.h>",
            "#include <linux/namei.h>",
            "#include <linux/module.h>",
            "#include <linux/pid_namespace.h>",
            "#include <linux/utsname.h>",
            "#include <linux/coredump.h>",
            "#include <linux/binfmts.h>",
            "#include <linux/personality.h>",
            "#include <linux/key.h>",
            "#include <linux/spinlock.h>",
            "#include <linux/highmem.h>",
            "#include <linux/perf_event.h>",
            "#include <linux/pagemap.h>",
            "#include <linux/init.h>",
            "#include <linux/string.h>",
            "#include <linux/swap.h>",
            "#include <linux/fcntl.h>",
            "#include <linux/stat.h>",
            "#include <linux/mm.h>",
            "#include <linux/fdtable.h>",
            "#include <linux/file.h>",
            "#include <linux/slab.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <trace/events/sched.h>\n#include \"internal.h\"\n#include <trace/events/task.h>\n#include <asm/exec.h>\n#include <asm/tlb.h>\n#include <asm/mmu_context.h>\n#include <asm/uaccess.h>\n#include <linux/compat.h>\n#include <linux/oom.h>\n#include <linux/pipe_fs_i.h>\n#include <linux/fs_struct.h>\n#include <linux/fsnotify.h>\n#include <linux/kmod.h>\n#include <linux/tracehook.h>\n#include <linux/audit.h>\n#include <linux/cn_proc.h>\n#include <linux/tsacct_kern.h>\n#include <linux/syscalls.h>\n#include <linux/security.h>\n#include <linux/mount.h>\n#include <linux/namei.h>\n#include <linux/module.h>\n#include <linux/pid_namespace.h>\n#include <linux/utsname.h>\n#include <linux/coredump.h>\n#include <linux/binfmts.h>\n#include <linux/personality.h>\n#include <linux/key.h>\n#include <linux/spinlock.h>\n#include <linux/highmem.h>\n#include <linux/perf_event.h>\n#include <linux/pagemap.h>\n#include <linux/init.h>\n#include <linux/string.h>\n#include <linux/swap.h>\n#include <linux/fcntl.h>\n#include <linux/stat.h>\n#include <linux/mm.h>\n#include <linux/fdtable.h>\n#include <linux/file.h>\n#include <linux/slab.h>\n\nint dump_skip(struct coredump_params *cprm, size_t nr)\n{\n\tstatic char zeroes[PAGE_SIZE];\n\tstruct file *file = cprm->file;\n\tif (file->f_op->llseek && file->f_op->llseek != no_llseek) {\n\t\tif (cprm->written + nr > cprm->limit)\n\t\t\treturn 0;\n\t\tif (dump_interrupted() ||\n\t\t    file->f_op->llseek(file, nr, SEEK_CUR) < 0)\n\t\t\treturn 0;\n\t\tcprm->written += nr;\n\t\treturn 1;\n\t} else {\n\t\twhile (nr > PAGE_SIZE) {\n\t\t\tif (!dump_emit(cprm, zeroes, PAGE_SIZE))\n\t\t\t\treturn 0;\n\t\t\tnr -= PAGE_SIZE;\n\t\t}\n\t\treturn dump_emit(cprm, zeroes, nr);\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "dump_emit",
          "args": [
            "cprm",
            "&dump",
            "sizeof(dump)"
          ],
          "line": 87
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "set_fs",
          "args": [
            "KERNEL_DS"
          ],
          "line": 85
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "access_ok",
          "args": [
            "VERIFY_READ",
            "START_STACK(dump)",
            "dump.u_ssize << PAGE_SHIFT"
          ],
          "line": 82
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "START_STACK",
          "args": [
            "dump"
          ],
          "line": 82
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "access_ok",
          "args": [
            "VERIFY_READ",
            "START_DATA(dump)",
            "dump.u_dsize << PAGE_SHIFT"
          ],
          "line": 80
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "START_DATA",
          "args": [
            "dump"
          ],
          "line": 80
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "set_fs",
          "args": [
            "USER_DS"
          ],
          "line": 79
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "aout_dump_thread",
          "args": [
            "cprm->regs",
            "&dump"
          ],
          "line": 67
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strncpy",
          "args": [
            "dump.u_comm",
            "current->comm",
            "sizeof(dump.u_comm)"
          ],
          "line": 64
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "set_fs",
          "args": [
            "KERNEL_DS"
          ],
          "line": 62
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "get_fs",
          "args": [],
          "line": 61
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <asm/a.out-core.h>\n#include <asm/cacheflush.h>\n#include <asm/uaccess.h>\n#include <linux/slab.h>\n#include <linux/coredump.h>\n#include <linux/init.h>\n#include <linux/personality.h>\n#include <linux/binfmts.h>\n#include <linux/user.h>\n#include <linux/ptrace.h>\n#include <linux/fcntl.h>\n#include <linux/stat.h>\n#include <linux/file.h>\n#include <linux/fs.h>\n#include <linux/string.h>\n#include <linux/signal.h>\n#include <linux/errno.h>\n#include <linux/a.out.h>\n#include <linux/mman.h>\n#include <linux/mm.h>\n#include <linux/kernel.h>\n#include <linux/time.h>\n#include <linux/module.h>\n\n#define aout_core_dump NULL\n\nstatic int load_aout_library(struct file*);\n\nstatic int aout_core_dump(struct coredump_params *cprm)\n{\n\tmm_segment_t fs;\n\tint has_dumped = 0;\n\tvoid __user *dump_start;\n\tint dump_size;\n\tstruct user dump;\n#ifdef __alpha__\n#       define START_DATA(u)\t((void __user *)u.start_data)\n#else\n#\tdefine START_DATA(u)\t((void __user *)((u.u_tsize << PAGE_SHIFT) + \\\n\t\t\t\t u.start_code))\n#endif\n#       define START_STACK(u)   ((void __user *)u.start_stack)\n\n\tfs = get_fs();\n\tset_fs(KERNEL_DS);\n\thas_dumped = 1;\n       \tstrncpy(dump.u_comm, current->comm, sizeof(dump.u_comm));\n\tdump.u_ar0 = offsetof(struct user, regs);\n\tdump.signal = cprm->siginfo->si_signo;\n\taout_dump_thread(cprm->regs, &dump);\n\n/* If the size of the dump file exceeds the rlimit, then see what would happen\n   if we wrote the stack, but not the data area.  */\n\tif ((dump.u_dsize + dump.u_ssize+1) * PAGE_SIZE > cprm->limit)\n\t\tdump.u_dsize = 0;\n\n/* Make sure we have enough room to write the stack and data areas. */\n\tif ((dump.u_ssize + 1) * PAGE_SIZE > cprm->limit)\n\t\tdump.u_ssize = 0;\n\n/* make sure we actually have a data and stack area to dump */\n\tset_fs(USER_DS);\n\tif (!access_ok(VERIFY_READ, START_DATA(dump), dump.u_dsize << PAGE_SHIFT))\n\t\tdump.u_dsize = 0;\n\tif (!access_ok(VERIFY_READ, START_STACK(dump), dump.u_ssize << PAGE_SHIFT))\n\t\tdump.u_ssize = 0;\n\n\tset_fs(KERNEL_DS);\n/* struct user */\n\tif (!dump_emit(cprm, &dump, sizeof(dump)))\n\t\tgoto end_coredump;\n/* Now dump all of the user data.  Include malloced stuff as well */\n\tif (!dump_skip(cprm, PAGE_SIZE - sizeof(dump)))\n\t\tgoto end_coredump;\n/* now we start writing out the user space info */\n\tset_fs(USER_DS);\n/* Dump the data area */\n\tif (dump.u_dsize != 0) {\n\t\tdump_start = START_DATA(dump);\n\t\tdump_size = dump.u_dsize << PAGE_SHIFT;\n\t\tif (!dump_emit(cprm, dump_start, dump_size))\n\t\t\tgoto end_coredump;\n\t}\n/* Now prepare to dump the stack area */\n\tif (dump.u_ssize != 0) {\n\t\tdump_start = START_STACK(dump);\n\t\tdump_size = dump.u_ssize << PAGE_SHIFT;\n\t\tif (!dump_emit(cprm, dump_start, dump_size))\n\t\t\tgoto end_coredump;\n\t}\nend_coredump:\n\tset_fs(fs);\n\treturn has_dumped;\n}"
  }
]