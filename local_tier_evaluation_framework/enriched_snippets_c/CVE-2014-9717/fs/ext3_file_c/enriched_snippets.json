[
  {
    "function_name": "ext3_release_file",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/ext3/file.c",
    "lines": "31-49",
    "snippet": "static int ext3_release_file (struct inode * inode, struct file * filp)\n{\n\tif (ext3_test_inode_state(inode, EXT3_STATE_FLUSH_ON_CLOSE)) {\n\t\tfilemap_flush(inode->i_mapping);\n\t\text3_clear_inode_state(inode, EXT3_STATE_FLUSH_ON_CLOSE);\n\t}\n\t/* if we are the last writer on the inode, drop the block reservation */\n\tif ((filp->f_mode & FMODE_WRITE) &&\n\t\t\t(atomic_read(&inode->i_writecount) == 1))\n\t{\n\t\tmutex_lock(&EXT3_I(inode)->truncate_mutex);\n\t\text3_discard_reservation(inode);\n\t\tmutex_unlock(&EXT3_I(inode)->truncate_mutex);\n\t}\n\tif (is_dx(inode) && filp->private_data)\n\t\text3_htree_free_dir_info(filp->private_data);\n\n\treturn 0;\n}",
    "includes": [
      "#include \"acl.h\"",
      "#include \"xattr.h\"",
      "#include \"ext3.h\"",
      "#include <linux/quotaops.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "ext3_htree_free_dir_info",
          "args": [
            "filp->private_data"
          ],
          "line": 46
        },
        "resolved": true,
        "details": {
          "function_name": "ext3_htree_free_dir_info",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/ext3/dir.c",
          "lines": "337-341",
          "snippet": "void ext3_htree_free_dir_info(struct dir_private_info *p)\n{\n\tfree_rb_tree_fname(&p->root);\n\tkfree(p);\n}",
          "includes": [
            "#include \"ext3.h\"",
            "#include <linux/compat.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"ext3.h\"\n#include <linux/compat.h>\n\nvoid ext3_htree_free_dir_info(struct dir_private_info *p)\n{\n\tfree_rb_tree_fname(&p->root);\n\tkfree(p);\n}"
        }
      },
      {
        "call_info": {
          "callee": "is_dx",
          "args": [
            "inode"
          ],
          "line": 45
        },
        "resolved": true,
        "details": {
          "function_name": "is_dx_dir",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/ext3/dir.c",
          "lines": "49-60",
          "snippet": "static int is_dx_dir(struct inode *inode)\n{\n\tstruct super_block *sb = inode->i_sb;\n\n\tif (EXT3_HAS_COMPAT_FEATURE(inode->i_sb,\n\t\t     EXT3_FEATURE_COMPAT_DIR_INDEX) &&\n\t    ((EXT3_I(inode)->i_flags & EXT3_INDEX_FL) ||\n\t     ((inode->i_size >> sb->s_blocksize_bits) == 1)))\n\t\treturn 1;\n\n\treturn 0;\n}",
          "includes": [
            "#include \"ext3.h\"",
            "#include <linux/compat.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"ext3.h\"\n#include <linux/compat.h>\n\nstatic int is_dx_dir(struct inode *inode)\n{\n\tstruct super_block *sb = inode->i_sb;\n\n\tif (EXT3_HAS_COMPAT_FEATURE(inode->i_sb,\n\t\t     EXT3_FEATURE_COMPAT_DIR_INDEX) &&\n\t    ((EXT3_I(inode)->i_flags & EXT3_INDEX_FL) ||\n\t     ((inode->i_size >> sb->s_blocksize_bits) == 1)))\n\t\treturn 1;\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "mutex_unlock",
          "args": [
            "&EXT3_I(inode)->truncate_mutex"
          ],
          "line": 43
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "EXT3_I",
          "args": [
            "inode"
          ],
          "line": 43
        },
        "resolved": true,
        "details": {
          "function_name": "EXT3_I",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/ext3/ext3.h",
          "lines": "693-696",
          "snippet": "static inline struct ext3_inode_info *EXT3_I(struct inode *inode)\n{\n\treturn container_of(inode, struct ext3_inode_info, vfs_inode);\n}",
          "includes": [
            "#include <trace/events/ext3.h>",
            "#include <linux/blockgroup_lock.h>",
            "#include <linux/bug.h>",
            "#include <linux/magic.h>",
            "#include <linux/jbd.h>",
            "#include <linux/fs.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "extern void ext3_init_block_alloc_info(struct inode *);",
            "extern void ext3_free_inode (handle_t *, struct inode *);",
            "struct buffer_head * ext3_getblk (handle_t *, struct inode *, long, int, int *);",
            "struct buffer_head * ext3_bread (handle_t *, struct inode *, int, int, int *);",
            "extern void ext3_evict_inode (struct inode *);",
            "extern int  ext3_sync_inode (handle_t *, struct inode *);",
            "extern void ext3_discard_reservation (struct inode *);",
            "extern void ext3_dirty_inode(struct inode *, int);",
            "extern int ext3_change_inode_journal_flag(struct inode *, int);",
            "extern int ext3_can_truncate(struct inode *inode);",
            "extern void ext3_truncate(struct inode *inode);",
            "extern void ext3_set_inode_flags(struct inode *);",
            "extern void ext3_get_inode_flags(struct ext3_inode_info *);",
            "extern void ext3_set_aops(struct inode *inode);",
            "extern int ext3_orphan_add(handle_t *, struct inode *);",
            "extern int ext3_orphan_del(handle_t *, struct inode *);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <trace/events/ext3.h>\n#include <linux/blockgroup_lock.h>\n#include <linux/bug.h>\n#include <linux/magic.h>\n#include <linux/jbd.h>\n#include <linux/fs.h>\n\nextern void ext3_init_block_alloc_info(struct inode *);\nextern void ext3_free_inode (handle_t *, struct inode *);\nstruct buffer_head * ext3_getblk (handle_t *, struct inode *, long, int, int *);\nstruct buffer_head * ext3_bread (handle_t *, struct inode *, int, int, int *);\nextern void ext3_evict_inode (struct inode *);\nextern int  ext3_sync_inode (handle_t *, struct inode *);\nextern void ext3_discard_reservation (struct inode *);\nextern void ext3_dirty_inode(struct inode *, int);\nextern int ext3_change_inode_journal_flag(struct inode *, int);\nextern int ext3_can_truncate(struct inode *inode);\nextern void ext3_truncate(struct inode *inode);\nextern void ext3_set_inode_flags(struct inode *);\nextern void ext3_get_inode_flags(struct ext3_inode_info *);\nextern void ext3_set_aops(struct inode *inode);\nextern int ext3_orphan_add(handle_t *, struct inode *);\nextern int ext3_orphan_del(handle_t *, struct inode *);\n\nstatic inline struct ext3_inode_info *EXT3_I(struct inode *inode)\n{\n\treturn container_of(inode, struct ext3_inode_info, vfs_inode);\n}"
        }
      },
      {
        "call_info": {
          "callee": "ext3_discard_reservation",
          "args": [
            "inode"
          ],
          "line": 42
        },
        "resolved": true,
        "details": {
          "function_name": "ext3_discard_reservation",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/ext3/balloc.c",
          "lines": "461-480",
          "snippet": "void ext3_discard_reservation(struct inode *inode)\n{\n\tstruct ext3_inode_info *ei = EXT3_I(inode);\n\tstruct ext3_block_alloc_info *block_i = ei->i_block_alloc_info;\n\tstruct ext3_reserve_window_node *rsv;\n\tspinlock_t *rsv_lock = &EXT3_SB(inode->i_sb)->s_rsv_window_lock;\n\n\tif (!block_i)\n\t\treturn;\n\n\trsv = &block_i->rsv_window_node;\n\tif (!rsv_is_empty(&rsv->rsv_window)) {\n\t\tspin_lock(rsv_lock);\n\t\tif (!rsv_is_empty(&rsv->rsv_window)) {\n\t\t\ttrace_ext3_discard_reservation(inode, rsv);\n\t\t\trsv_window_remove(inode->i_sb, rsv);\n\t\t}\n\t\tspin_unlock(rsv_lock);\n\t}\n}",
          "includes": [
            "#include \"ext3.h\"",
            "#include <linux/blkdev.h>",
            "#include <linux/quotaops.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"ext3.h\"\n#include <linux/blkdev.h>\n#include <linux/quotaops.h>\n\nvoid ext3_discard_reservation(struct inode *inode)\n{\n\tstruct ext3_inode_info *ei = EXT3_I(inode);\n\tstruct ext3_block_alloc_info *block_i = ei->i_block_alloc_info;\n\tstruct ext3_reserve_window_node *rsv;\n\tspinlock_t *rsv_lock = &EXT3_SB(inode->i_sb)->s_rsv_window_lock;\n\n\tif (!block_i)\n\t\treturn;\n\n\trsv = &block_i->rsv_window_node;\n\tif (!rsv_is_empty(&rsv->rsv_window)) {\n\t\tspin_lock(rsv_lock);\n\t\tif (!rsv_is_empty(&rsv->rsv_window)) {\n\t\t\ttrace_ext3_discard_reservation(inode, rsv);\n\t\t\trsv_window_remove(inode->i_sb, rsv);\n\t\t}\n\t\tspin_unlock(rsv_lock);\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "mutex_lock",
          "args": [
            "&EXT3_I(inode)->truncate_mutex"
          ],
          "line": 41
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "atomic_read",
          "args": [
            "&inode->i_writecount"
          ],
          "line": 39
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ext3_clear_inode_state",
          "args": [
            "inode",
            "EXT3_STATE_FLUSH_ON_CLOSE"
          ],
          "line": 35
        },
        "resolved": true,
        "details": {
          "function_name": "ext3_clear_inode_state",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/ext3/ext3.h",
          "lines": "727-730",
          "snippet": "static inline void ext3_clear_inode_state(struct inode *inode, int bit)\n{\n\tclear_bit(bit, &EXT3_I(inode)->i_state_flags);\n}",
          "includes": [
            "#include <trace/events/ext3.h>",
            "#include <linux/blockgroup_lock.h>",
            "#include <linux/bug.h>",
            "#include <linux/magic.h>",
            "#include <linux/jbd.h>",
            "#include <linux/fs.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "extern void ext3_init_block_alloc_info(struct inode *);",
            "extern void ext3_free_inode (handle_t *, struct inode *);",
            "struct buffer_head * ext3_getblk (handle_t *, struct inode *, long, int, int *);",
            "struct buffer_head * ext3_bread (handle_t *, struct inode *, int, int, int *);",
            "extern void ext3_evict_inode (struct inode *);",
            "extern int  ext3_sync_inode (handle_t *, struct inode *);",
            "extern void ext3_discard_reservation (struct inode *);",
            "extern void ext3_dirty_inode(struct inode *, int);",
            "extern int ext3_change_inode_journal_flag(struct inode *, int);",
            "extern int ext3_can_truncate(struct inode *inode);",
            "extern void ext3_truncate(struct inode *inode);",
            "extern void ext3_set_inode_flags(struct inode *);",
            "extern void ext3_set_aops(struct inode *inode);",
            "extern int ext3_orphan_add(handle_t *, struct inode *);",
            "extern int ext3_orphan_del(handle_t *, struct inode *);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <trace/events/ext3.h>\n#include <linux/blockgroup_lock.h>\n#include <linux/bug.h>\n#include <linux/magic.h>\n#include <linux/jbd.h>\n#include <linux/fs.h>\n\nextern void ext3_init_block_alloc_info(struct inode *);\nextern void ext3_free_inode (handle_t *, struct inode *);\nstruct buffer_head * ext3_getblk (handle_t *, struct inode *, long, int, int *);\nstruct buffer_head * ext3_bread (handle_t *, struct inode *, int, int, int *);\nextern void ext3_evict_inode (struct inode *);\nextern int  ext3_sync_inode (handle_t *, struct inode *);\nextern void ext3_discard_reservation (struct inode *);\nextern void ext3_dirty_inode(struct inode *, int);\nextern int ext3_change_inode_journal_flag(struct inode *, int);\nextern int ext3_can_truncate(struct inode *inode);\nextern void ext3_truncate(struct inode *inode);\nextern void ext3_set_inode_flags(struct inode *);\nextern void ext3_set_aops(struct inode *inode);\nextern int ext3_orphan_add(handle_t *, struct inode *);\nextern int ext3_orphan_del(handle_t *, struct inode *);\n\nstatic inline void ext3_clear_inode_state(struct inode *inode, int bit)\n{\n\tclear_bit(bit, &EXT3_I(inode)->i_state_flags);\n}"
        }
      },
      {
        "call_info": {
          "callee": "filemap_flush",
          "args": [
            "inode->i_mapping"
          ],
          "line": 34
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ext3_test_inode_state",
          "args": [
            "inode",
            "EXT3_STATE_FLUSH_ON_CLOSE"
          ],
          "line": 33
        },
        "resolved": true,
        "details": {
          "function_name": "ext3_test_inode_state",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/ext3/ext3.h",
          "lines": "717-720",
          "snippet": "static inline int ext3_test_inode_state(struct inode *inode, int bit)\n{\n\treturn test_bit(bit, &EXT3_I(inode)->i_state_flags);\n}",
          "includes": [
            "#include <trace/events/ext3.h>",
            "#include <linux/blockgroup_lock.h>",
            "#include <linux/bug.h>",
            "#include <linux/magic.h>",
            "#include <linux/jbd.h>",
            "#include <linux/fs.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "extern void ext3_init_block_alloc_info(struct inode *);",
            "extern void ext3_free_inode (handle_t *, struct inode *);",
            "struct buffer_head * ext3_getblk (handle_t *, struct inode *, long, int, int *);",
            "struct buffer_head * ext3_bread (handle_t *, struct inode *, int, int, int *);",
            "extern void ext3_evict_inode (struct inode *);",
            "extern int  ext3_sync_inode (handle_t *, struct inode *);",
            "extern void ext3_discard_reservation (struct inode *);",
            "extern void ext3_dirty_inode(struct inode *, int);",
            "extern int ext3_change_inode_journal_flag(struct inode *, int);",
            "extern int ext3_can_truncate(struct inode *inode);",
            "extern void ext3_truncate(struct inode *inode);",
            "extern void ext3_set_inode_flags(struct inode *);",
            "extern void ext3_set_aops(struct inode *inode);",
            "extern int ext3_orphan_add(handle_t *, struct inode *);",
            "extern int ext3_orphan_del(handle_t *, struct inode *);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <trace/events/ext3.h>\n#include <linux/blockgroup_lock.h>\n#include <linux/bug.h>\n#include <linux/magic.h>\n#include <linux/jbd.h>\n#include <linux/fs.h>\n\nextern void ext3_init_block_alloc_info(struct inode *);\nextern void ext3_free_inode (handle_t *, struct inode *);\nstruct buffer_head * ext3_getblk (handle_t *, struct inode *, long, int, int *);\nstruct buffer_head * ext3_bread (handle_t *, struct inode *, int, int, int *);\nextern void ext3_evict_inode (struct inode *);\nextern int  ext3_sync_inode (handle_t *, struct inode *);\nextern void ext3_discard_reservation (struct inode *);\nextern void ext3_dirty_inode(struct inode *, int);\nextern int ext3_change_inode_journal_flag(struct inode *, int);\nextern int ext3_can_truncate(struct inode *inode);\nextern void ext3_truncate(struct inode *inode);\nextern void ext3_set_inode_flags(struct inode *);\nextern void ext3_set_aops(struct inode *inode);\nextern int ext3_orphan_add(handle_t *, struct inode *);\nextern int ext3_orphan_del(handle_t *, struct inode *);\n\nstatic inline int ext3_test_inode_state(struct inode *inode, int bit)\n{\n\treturn test_bit(bit, &EXT3_I(inode)->i_state_flags);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"acl.h\"\n#include \"xattr.h\"\n#include \"ext3.h\"\n#include <linux/quotaops.h>\n\nstatic int ext3_release_file (struct inode * inode, struct file * filp)\n{\n\tif (ext3_test_inode_state(inode, EXT3_STATE_FLUSH_ON_CLOSE)) {\n\t\tfilemap_flush(inode->i_mapping);\n\t\text3_clear_inode_state(inode, EXT3_STATE_FLUSH_ON_CLOSE);\n\t}\n\t/* if we are the last writer on the inode, drop the block reservation */\n\tif ((filp->f_mode & FMODE_WRITE) &&\n\t\t\t(atomic_read(&inode->i_writecount) == 1))\n\t{\n\t\tmutex_lock(&EXT3_I(inode)->truncate_mutex);\n\t\text3_discard_reservation(inode);\n\t\tmutex_unlock(&EXT3_I(inode)->truncate_mutex);\n\t}\n\tif (is_dx(inode) && filp->private_data)\n\t\text3_htree_free_dir_info(filp->private_data);\n\n\treturn 0;\n}"
  }
]