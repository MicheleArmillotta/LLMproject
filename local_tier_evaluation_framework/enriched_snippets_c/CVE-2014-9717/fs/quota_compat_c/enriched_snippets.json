[
  {
    "function_name": "sys32_quotactl",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/quota/compat.c",
    "lines": "43-118",
    "snippet": "asmlinkage long sys32_quotactl(unsigned int cmd, const char __user *special,\n\t\t\t\t\t\tqid_t id, void __user *addr)\n{\n\tunsigned int cmds;\n\tstruct if_dqblk __user *dqblk;\n\tstruct compat_if_dqblk __user *compat_dqblk;\n\tstruct fs_quota_stat __user *fsqstat;\n\tstruct compat_fs_quota_stat __user *compat_fsqstat;\n\tcompat_uint_t data;\n\tu16 xdata;\n\tlong ret;\n\n\tcmds = cmd >> SUBCMDSHIFT;\n\n\tswitch (cmds) {\n\tcase Q_GETQUOTA:\n\t\tdqblk = compat_alloc_user_space(sizeof(struct if_dqblk));\n\t\tcompat_dqblk = addr;\n\t\tret = sys_quotactl(cmd, special, id, dqblk);\n\t\tif (ret)\n\t\t\tbreak;\n\t\tif (copy_in_user(compat_dqblk, dqblk, sizeof(*compat_dqblk)) ||\n\t\t\tget_user(data, &dqblk->dqb_valid) ||\n\t\t\tput_user(data, &compat_dqblk->dqb_valid))\n\t\t\tret = -EFAULT;\n\t\tbreak;\n\tcase Q_SETQUOTA:\n\t\tdqblk = compat_alloc_user_space(sizeof(struct if_dqblk));\n\t\tcompat_dqblk = addr;\n\t\tret = -EFAULT;\n\t\tif (copy_in_user(dqblk, compat_dqblk, sizeof(*compat_dqblk)) ||\n\t\t\tget_user(data, &compat_dqblk->dqb_valid) ||\n\t\t\tput_user(data, &dqblk->dqb_valid))\n\t\t\tbreak;\n\t\tret = sys_quotactl(cmd, special, id, dqblk);\n\t\tbreak;\n\tcase Q_XGETQSTAT:\n\t\tfsqstat = compat_alloc_user_space(sizeof(struct fs_quota_stat));\n\t\tcompat_fsqstat = addr;\n\t\tret = sys_quotactl(cmd, special, id, fsqstat);\n\t\tif (ret)\n\t\t\tbreak;\n\t\tret = -EFAULT;\n\t\t/* Copying qs_version, qs_flags, qs_pad */\n\t\tif (copy_in_user(compat_fsqstat, fsqstat,\n\t\t\toffsetof(struct compat_fs_quota_stat, qs_uquota)))\n\t\t\tbreak;\n\t\t/* Copying qs_uquota */\n\t\tif (copy_in_user(&compat_fsqstat->qs_uquota,\n\t\t\t&fsqstat->qs_uquota,\n\t\t\tsizeof(compat_fsqstat->qs_uquota)) ||\n\t\t\tget_user(data, &fsqstat->qs_uquota.qfs_nextents) ||\n\t\t\tput_user(data, &compat_fsqstat->qs_uquota.qfs_nextents))\n\t\t\tbreak;\n\t\t/* Copying qs_gquota */\n\t\tif (copy_in_user(&compat_fsqstat->qs_gquota,\n\t\t\t&fsqstat->qs_gquota,\n\t\t\tsizeof(compat_fsqstat->qs_gquota)) ||\n\t\t\tget_user(data, &fsqstat->qs_gquota.qfs_nextents) ||\n\t\t\tput_user(data, &compat_fsqstat->qs_gquota.qfs_nextents))\n\t\t\tbreak;\n\t\t/* Copying the rest */\n\t\tif (copy_in_user(&compat_fsqstat->qs_incoredqs,\n\t\t\t&fsqstat->qs_incoredqs,\n\t\t\tsizeof(struct compat_fs_quota_stat) -\n\t\t\toffsetof(struct compat_fs_quota_stat, qs_incoredqs)) ||\n\t\t\tget_user(xdata, &fsqstat->qs_iwarnlimit) ||\n\t\t\tput_user(xdata, &compat_fsqstat->qs_iwarnlimit))\n\t\t\tbreak;\n\t\tret = 0;\n\t\tbreak;\n\tdefault:\n\t\tret = sys_quotactl(cmd, special, id, addr);\n\t}\n\treturn ret;\n}",
    "includes": [
      "#include <linux/quotaops.h>",
      "#include <linux/compat.h>",
      "#include <linux/syscalls.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "sys_quotactl",
          "args": [
            "cmd",
            "special",
            "id",
            "addr"
          ],
          "line": 115
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "put_user",
          "args": [
            "xdata",
            "&compat_fsqstat->qs_iwarnlimit"
          ],
          "line": 110
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "get_user",
          "args": [
            "xdata",
            "&fsqstat->qs_iwarnlimit"
          ],
          "line": 109
        },
        "resolved": true,
        "details": {
          "function_name": "get_user_arg_ptr",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/exec.c",
          "lines": "399-418",
          "snippet": "static const char __user *get_user_arg_ptr(struct user_arg_ptr argv, int nr)\n{\n\tconst char __user *native;\n\n#ifdef CONFIG_COMPAT\n\tif (unlikely(argv.is_compat)) {\n\t\tcompat_uptr_t compat;\n\n\t\tif (get_user(compat, argv.ptr.compat + nr))\n\t\t\treturn ERR_PTR(-EFAULT);\n\n\t\treturn compat_ptr(compat);\n\t}\n#endif\n\n\tif (get_user(native, argv.ptr.native + nr))\n\t\treturn ERR_PTR(-EFAULT);\n\n\treturn native;\n}",
          "includes": [
            "#include <trace/events/sched.h>",
            "#include \"internal.h\"",
            "#include <trace/events/task.h>",
            "#include <asm/tlb.h>",
            "#include <asm/mmu_context.h>",
            "#include <asm/uaccess.h>",
            "#include <linux/compat.h>",
            "#include <linux/oom.h>",
            "#include <linux/pipe_fs_i.h>",
            "#include <linux/fs_struct.h>",
            "#include <linux/fsnotify.h>",
            "#include <linux/kmod.h>",
            "#include <linux/tracehook.h>",
            "#include <linux/audit.h>",
            "#include <linux/cn_proc.h>",
            "#include <linux/tsacct_kern.h>",
            "#include <linux/syscalls.h>",
            "#include <linux/security.h>",
            "#include <linux/mount.h>",
            "#include <linux/namei.h>",
            "#include <linux/module.h>",
            "#include <linux/pid_namespace.h>",
            "#include <linux/utsname.h>",
            "#include <linux/binfmts.h>",
            "#include <linux/personality.h>",
            "#include <linux/key.h>",
            "#include <linux/spinlock.h>",
            "#include <linux/highmem.h>",
            "#include <linux/perf_event.h>",
            "#include <linux/pagemap.h>",
            "#include <linux/init.h>",
            "#include <linux/string.h>",
            "#include <linux/swap.h>",
            "#include <linux/fcntl.h>",
            "#include <linux/stat.h>",
            "#include <linux/vmacache.h>",
            "#include <linux/mm.h>",
            "#include <linux/fdtable.h>",
            "#include <linux/file.h>",
            "#include <linux/slab.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <trace/events/sched.h>\n#include \"internal.h\"\n#include <trace/events/task.h>\n#include <asm/tlb.h>\n#include <asm/mmu_context.h>\n#include <asm/uaccess.h>\n#include <linux/compat.h>\n#include <linux/oom.h>\n#include <linux/pipe_fs_i.h>\n#include <linux/fs_struct.h>\n#include <linux/fsnotify.h>\n#include <linux/kmod.h>\n#include <linux/tracehook.h>\n#include <linux/audit.h>\n#include <linux/cn_proc.h>\n#include <linux/tsacct_kern.h>\n#include <linux/syscalls.h>\n#include <linux/security.h>\n#include <linux/mount.h>\n#include <linux/namei.h>\n#include <linux/module.h>\n#include <linux/pid_namespace.h>\n#include <linux/utsname.h>\n#include <linux/binfmts.h>\n#include <linux/personality.h>\n#include <linux/key.h>\n#include <linux/spinlock.h>\n#include <linux/highmem.h>\n#include <linux/perf_event.h>\n#include <linux/pagemap.h>\n#include <linux/init.h>\n#include <linux/string.h>\n#include <linux/swap.h>\n#include <linux/fcntl.h>\n#include <linux/stat.h>\n#include <linux/vmacache.h>\n#include <linux/mm.h>\n#include <linux/fdtable.h>\n#include <linux/file.h>\n#include <linux/slab.h>\n\nstatic const char __user *get_user_arg_ptr(struct user_arg_ptr argv, int nr)\n{\n\tconst char __user *native;\n\n#ifdef CONFIG_COMPAT\n\tif (unlikely(argv.is_compat)) {\n\t\tcompat_uptr_t compat;\n\n\t\tif (get_user(compat, argv.ptr.compat + nr))\n\t\t\treturn ERR_PTR(-EFAULT);\n\n\t\treturn compat_ptr(compat);\n\t}\n#endif\n\n\tif (get_user(native, argv.ptr.native + nr))\n\t\treturn ERR_PTR(-EFAULT);\n\n\treturn native;\n}"
        }
      },
      {
        "call_info": {
          "callee": "copy_in_user",
          "args": [
            "&compat_fsqstat->qs_incoredqs",
            "&fsqstat->qs_incoredqs",
            "sizeof(struct compat_fs_quota_stat) -\n\t\t\toffsetof(struct compat_fs_quota_stat, qs_incoredqs)"
          ],
          "line": 105
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "put_user",
          "args": [
            "data",
            "&compat_fsqstat->qs_gquota.qfs_nextents"
          ],
          "line": 102
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "copy_in_user",
          "args": [
            "&compat_fsqstat->qs_gquota",
            "&fsqstat->qs_gquota",
            "sizeof(compat_fsqstat->qs_gquota)"
          ],
          "line": 98
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "put_user",
          "args": [
            "data",
            "&compat_fsqstat->qs_uquota.qfs_nextents"
          ],
          "line": 95
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "copy_in_user",
          "args": [
            "&compat_fsqstat->qs_uquota",
            "&fsqstat->qs_uquota",
            "sizeof(compat_fsqstat->qs_uquota)"
          ],
          "line": 91
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "copy_in_user",
          "args": [
            "compat_fsqstat",
            "fsqstat",
            "offsetof(struct compat_fs_quota_stat, qs_uquota)"
          ],
          "line": 87
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sys_quotactl",
          "args": [
            "cmd",
            "special",
            "id",
            "fsqstat"
          ],
          "line": 82
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "compat_alloc_user_space",
          "args": [
            "sizeof(struct fs_quota_stat)"
          ],
          "line": 80
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sys_quotactl",
          "args": [
            "cmd",
            "special",
            "id",
            "dqblk"
          ],
          "line": 77
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "put_user",
          "args": [
            "data",
            "&dqblk->dqb_valid"
          ],
          "line": 75
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "copy_in_user",
          "args": [
            "dqblk",
            "compat_dqblk",
            "sizeof(*compat_dqblk)"
          ],
          "line": 73
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "compat_alloc_user_space",
          "args": [
            "sizeof(struct if_dqblk)"
          ],
          "line": 70
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "put_user",
          "args": [
            "data",
            "&compat_dqblk->dqb_valid"
          ],
          "line": 66
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "copy_in_user",
          "args": [
            "compat_dqblk",
            "dqblk",
            "sizeof(*compat_dqblk)"
          ],
          "line": 64
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sys_quotactl",
          "args": [
            "cmd",
            "special",
            "id",
            "dqblk"
          ],
          "line": 61
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "compat_alloc_user_space",
          "args": [
            "sizeof(struct if_dqblk)"
          ],
          "line": 59
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <linux/quotaops.h>\n#include <linux/compat.h>\n#include <linux/syscalls.h>\n\nasmlinkage long sys32_quotactl(unsigned int cmd, const char __user *special,\n\t\t\t\t\t\tqid_t id, void __user *addr)\n{\n\tunsigned int cmds;\n\tstruct if_dqblk __user *dqblk;\n\tstruct compat_if_dqblk __user *compat_dqblk;\n\tstruct fs_quota_stat __user *fsqstat;\n\tstruct compat_fs_quota_stat __user *compat_fsqstat;\n\tcompat_uint_t data;\n\tu16 xdata;\n\tlong ret;\n\n\tcmds = cmd >> SUBCMDSHIFT;\n\n\tswitch (cmds) {\n\tcase Q_GETQUOTA:\n\t\tdqblk = compat_alloc_user_space(sizeof(struct if_dqblk));\n\t\tcompat_dqblk = addr;\n\t\tret = sys_quotactl(cmd, special, id, dqblk);\n\t\tif (ret)\n\t\t\tbreak;\n\t\tif (copy_in_user(compat_dqblk, dqblk, sizeof(*compat_dqblk)) ||\n\t\t\tget_user(data, &dqblk->dqb_valid) ||\n\t\t\tput_user(data, &compat_dqblk->dqb_valid))\n\t\t\tret = -EFAULT;\n\t\tbreak;\n\tcase Q_SETQUOTA:\n\t\tdqblk = compat_alloc_user_space(sizeof(struct if_dqblk));\n\t\tcompat_dqblk = addr;\n\t\tret = -EFAULT;\n\t\tif (copy_in_user(dqblk, compat_dqblk, sizeof(*compat_dqblk)) ||\n\t\t\tget_user(data, &compat_dqblk->dqb_valid) ||\n\t\t\tput_user(data, &dqblk->dqb_valid))\n\t\t\tbreak;\n\t\tret = sys_quotactl(cmd, special, id, dqblk);\n\t\tbreak;\n\tcase Q_XGETQSTAT:\n\t\tfsqstat = compat_alloc_user_space(sizeof(struct fs_quota_stat));\n\t\tcompat_fsqstat = addr;\n\t\tret = sys_quotactl(cmd, special, id, fsqstat);\n\t\tif (ret)\n\t\t\tbreak;\n\t\tret = -EFAULT;\n\t\t/* Copying qs_version, qs_flags, qs_pad */\n\t\tif (copy_in_user(compat_fsqstat, fsqstat,\n\t\t\toffsetof(struct compat_fs_quota_stat, qs_uquota)))\n\t\t\tbreak;\n\t\t/* Copying qs_uquota */\n\t\tif (copy_in_user(&compat_fsqstat->qs_uquota,\n\t\t\t&fsqstat->qs_uquota,\n\t\t\tsizeof(compat_fsqstat->qs_uquota)) ||\n\t\t\tget_user(data, &fsqstat->qs_uquota.qfs_nextents) ||\n\t\t\tput_user(data, &compat_fsqstat->qs_uquota.qfs_nextents))\n\t\t\tbreak;\n\t\t/* Copying qs_gquota */\n\t\tif (copy_in_user(&compat_fsqstat->qs_gquota,\n\t\t\t&fsqstat->qs_gquota,\n\t\t\tsizeof(compat_fsqstat->qs_gquota)) ||\n\t\t\tget_user(data, &fsqstat->qs_gquota.qfs_nextents) ||\n\t\t\tput_user(data, &compat_fsqstat->qs_gquota.qfs_nextents))\n\t\t\tbreak;\n\t\t/* Copying the rest */\n\t\tif (copy_in_user(&compat_fsqstat->qs_incoredqs,\n\t\t\t&fsqstat->qs_incoredqs,\n\t\t\tsizeof(struct compat_fs_quota_stat) -\n\t\t\toffsetof(struct compat_fs_quota_stat, qs_incoredqs)) ||\n\t\t\tget_user(xdata, &fsqstat->qs_iwarnlimit) ||\n\t\t\tput_user(xdata, &compat_fsqstat->qs_iwarnlimit))\n\t\t\tbreak;\n\t\tret = 0;\n\t\tbreak;\n\tdefault:\n\t\tret = sys_quotactl(cmd, special, id, addr);\n\t}\n\treturn ret;\n}"
  }
]