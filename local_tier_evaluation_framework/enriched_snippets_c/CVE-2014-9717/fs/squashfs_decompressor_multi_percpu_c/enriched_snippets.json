[
  {
    "function_name": "squashfs_max_decompressors",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/squashfs/decompressor_multi_percpu.c",
    "lines": "94-97",
    "snippet": "int squashfs_max_decompressors(void)\n{\n\treturn num_possible_cpus();\n}",
    "includes": [
      "#include \"squashfs.h\"",
      "#include \"decompressor.h\"",
      "#include \"squashfs_fs_sb.h\"",
      "#include \"squashfs_fs.h\"",
      "#include <linux/buffer_head.h>",
      "#include <linux/percpu.h>",
      "#include <linux/slab.h>",
      "#include <linux/types.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "num_possible_cpus",
          "args": [],
          "line": 96
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"squashfs.h\"\n#include \"decompressor.h\"\n#include \"squashfs_fs_sb.h\"\n#include \"squashfs_fs.h\"\n#include <linux/buffer_head.h>\n#include <linux/percpu.h>\n#include <linux/slab.h>\n#include <linux/types.h>\n\nint squashfs_max_decompressors(void)\n{\n\treturn num_possible_cpus();\n}"
  },
  {
    "function_name": "squashfs_decompress",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/squashfs/decompressor_multi_percpu.c",
    "lines": "77-92",
    "snippet": "int squashfs_decompress(struct squashfs_sb_info *msblk, struct buffer_head **bh,\n\tint b, int offset, int length, struct squashfs_page_actor *output)\n{\n\tstruct squashfs_stream __percpu *percpu =\n\t\t\t(struct squashfs_stream __percpu *) msblk->stream;\n\tstruct squashfs_stream *stream = get_cpu_ptr(percpu);\n\tint res = msblk->decompressor->decompress(msblk, stream->stream, bh, b,\n\t\toffset, length, output);\n\tput_cpu_ptr(stream);\n\n\tif (res < 0)\n\t\tERROR(\"%s decompression failed, data probably corrupt\\n\",\n\t\t\tmsblk->decompressor->name);\n\n\treturn res;\n}",
    "includes": [
      "#include \"squashfs.h\"",
      "#include \"decompressor.h\"",
      "#include \"squashfs_fs_sb.h\"",
      "#include \"squashfs_fs.h\"",
      "#include <linux/buffer_head.h>",
      "#include <linux/percpu.h>",
      "#include <linux/slab.h>",
      "#include <linux/types.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "ERROR",
          "args": [
            "\"%s decompression failed, data probably corrupt\\n\"",
            "msblk->decompressor->name"
          ],
          "line": 88
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "put_cpu_ptr",
          "args": [
            "stream"
          ],
          "line": 85
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "msblk->decompressor->decompress",
          "args": [
            "msblk",
            "stream->stream",
            "bh",
            "b",
            "offset",
            "length",
            "output"
          ],
          "line": 83
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "get_cpu_ptr",
          "args": [
            "percpu"
          ],
          "line": 82
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"squashfs.h\"\n#include \"decompressor.h\"\n#include \"squashfs_fs_sb.h\"\n#include \"squashfs_fs.h\"\n#include <linux/buffer_head.h>\n#include <linux/percpu.h>\n#include <linux/slab.h>\n#include <linux/types.h>\n\nint squashfs_decompress(struct squashfs_sb_info *msblk, struct buffer_head **bh,\n\tint b, int offset, int length, struct squashfs_page_actor *output)\n{\n\tstruct squashfs_stream __percpu *percpu =\n\t\t\t(struct squashfs_stream __percpu *) msblk->stream;\n\tstruct squashfs_stream *stream = get_cpu_ptr(percpu);\n\tint res = msblk->decompressor->decompress(msblk, stream->stream, bh, b,\n\t\toffset, length, output);\n\tput_cpu_ptr(stream);\n\n\tif (res < 0)\n\t\tERROR(\"%s decompression failed, data probably corrupt\\n\",\n\t\t\tmsblk->decompressor->name);\n\n\treturn res;\n}"
  },
  {
    "function_name": "squashfs_decompressor_destroy",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/squashfs/decompressor_multi_percpu.c",
    "lines": "61-75",
    "snippet": "void squashfs_decompressor_destroy(struct squashfs_sb_info *msblk)\n{\n\tstruct squashfs_stream __percpu *percpu =\n\t\t\t(struct squashfs_stream __percpu *) msblk->stream;\n\tstruct squashfs_stream *stream;\n\tint cpu;\n\n\tif (msblk->stream) {\n\t\tfor_each_possible_cpu(cpu) {\n\t\t\tstream = per_cpu_ptr(percpu, cpu);\n\t\t\tmsblk->decompressor->free(stream->stream);\n\t\t}\n\t\tfree_percpu(percpu);\n\t}\n}",
    "includes": [
      "#include \"squashfs.h\"",
      "#include \"decompressor.h\"",
      "#include \"squashfs_fs_sb.h\"",
      "#include \"squashfs_fs.h\"",
      "#include <linux/buffer_head.h>",
      "#include <linux/percpu.h>",
      "#include <linux/slab.h>",
      "#include <linux/types.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free_percpu",
          "args": [
            "percpu"
          ],
          "line": 73
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "msblk->decompressor->free",
          "args": [
            "stream->stream"
          ],
          "line": 71
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "per_cpu_ptr",
          "args": [
            "percpu",
            "cpu"
          ],
          "line": 70
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"squashfs.h\"\n#include \"decompressor.h\"\n#include \"squashfs_fs_sb.h\"\n#include \"squashfs_fs.h\"\n#include <linux/buffer_head.h>\n#include <linux/percpu.h>\n#include <linux/slab.h>\n#include <linux/types.h>\n\nvoid squashfs_decompressor_destroy(struct squashfs_sb_info *msblk)\n{\n\tstruct squashfs_stream __percpu *percpu =\n\t\t\t(struct squashfs_stream __percpu *) msblk->stream;\n\tstruct squashfs_stream *stream;\n\tint cpu;\n\n\tif (msblk->stream) {\n\t\tfor_each_possible_cpu(cpu) {\n\t\t\tstream = per_cpu_ptr(percpu, cpu);\n\t\t\tmsblk->decompressor->free(stream->stream);\n\t\t}\n\t\tfree_percpu(percpu);\n\t}\n}"
  },
  {
    "function_name": "squashfs_decompressor_create",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/squashfs/decompressor_multi_percpu.c",
    "lines": "28-59",
    "snippet": "void *squashfs_decompressor_create(struct squashfs_sb_info *msblk,\n\t\t\t\t\t\tvoid *comp_opts)\n{\n\tstruct squashfs_stream *stream;\n\tstruct squashfs_stream __percpu *percpu;\n\tint err, cpu;\n\n\tpercpu = alloc_percpu(struct squashfs_stream);\n\tif (percpu == NULL)\n\t\treturn ERR_PTR(-ENOMEM);\n\n\tfor_each_possible_cpu(cpu) {\n\t\tstream = per_cpu_ptr(percpu, cpu);\n\t\tstream->stream = msblk->decompressor->init(msblk, comp_opts);\n\t\tif (IS_ERR(stream->stream)) {\n\t\t\terr = PTR_ERR(stream->stream);\n\t\t\tgoto out;\n\t\t}\n\t}\n\n\tkfree(comp_opts);\n\treturn (__force void *) percpu;\n\nout:\n\tfor_each_possible_cpu(cpu) {\n\t\tstream = per_cpu_ptr(percpu, cpu);\n\t\tif (!IS_ERR_OR_NULL(stream->stream))\n\t\t\tmsblk->decompressor->free(stream->stream);\n\t}\n\tfree_percpu(percpu);\n\treturn ERR_PTR(err);\n}",
    "includes": [
      "#include \"squashfs.h\"",
      "#include \"decompressor.h\"",
      "#include \"squashfs_fs_sb.h\"",
      "#include \"squashfs_fs.h\"",
      "#include <linux/buffer_head.h>",
      "#include <linux/percpu.h>",
      "#include <linux/slab.h>",
      "#include <linux/types.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "ERR_PTR",
          "args": [
            "err"
          ],
          "line": 58
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "free_percpu",
          "args": [
            "percpu"
          ],
          "line": 57
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "msblk->decompressor->free",
          "args": [
            "stream->stream"
          ],
          "line": 55
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "IS_ERR_OR_NULL",
          "args": [
            "stream->stream"
          ],
          "line": 54
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "per_cpu_ptr",
          "args": [
            "percpu",
            "cpu"
          ],
          "line": 53
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kfree",
          "args": [
            "comp_opts"
          ],
          "line": 48
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "PTR_ERR",
          "args": [
            "stream->stream"
          ],
          "line": 43
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "IS_ERR",
          "args": [
            "stream->stream"
          ],
          "line": 42
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "msblk->decompressor->init",
          "args": [
            "msblk",
            "comp_opts"
          ],
          "line": 41
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "per_cpu_ptr",
          "args": [
            "percpu",
            "cpu"
          ],
          "line": 40
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ERR_PTR",
          "args": [
            "-ENOMEM"
          ],
          "line": 37
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "alloc_percpu",
          "args": [
            "structsquashfs_stream"
          ],
          "line": 35
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"squashfs.h\"\n#include \"decompressor.h\"\n#include \"squashfs_fs_sb.h\"\n#include \"squashfs_fs.h\"\n#include <linux/buffer_head.h>\n#include <linux/percpu.h>\n#include <linux/slab.h>\n#include <linux/types.h>\n\nvoid *squashfs_decompressor_create(struct squashfs_sb_info *msblk,\n\t\t\t\t\t\tvoid *comp_opts)\n{\n\tstruct squashfs_stream *stream;\n\tstruct squashfs_stream __percpu *percpu;\n\tint err, cpu;\n\n\tpercpu = alloc_percpu(struct squashfs_stream);\n\tif (percpu == NULL)\n\t\treturn ERR_PTR(-ENOMEM);\n\n\tfor_each_possible_cpu(cpu) {\n\t\tstream = per_cpu_ptr(percpu, cpu);\n\t\tstream->stream = msblk->decompressor->init(msblk, comp_opts);\n\t\tif (IS_ERR(stream->stream)) {\n\t\t\terr = PTR_ERR(stream->stream);\n\t\t\tgoto out;\n\t\t}\n\t}\n\n\tkfree(comp_opts);\n\treturn (__force void *) percpu;\n\nout:\n\tfor_each_possible_cpu(cpu) {\n\t\tstream = per_cpu_ptr(percpu, cpu);\n\t\tif (!IS_ERR_OR_NULL(stream->stream))\n\t\t\tmsblk->decompressor->free(stream->stream);\n\t}\n\tfree_percpu(percpu);\n\treturn ERR_PTR(err);\n}"
  }
]