[
  {
    "function_name": "pam_sm_setcred",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2022-28321/repo/modules/pam_rhosts/pam_rhosts.c",
    "lines": "137-142",
    "snippet": "int\npam_sm_setcred (pam_handle_t *pamh UNUSED, int flags UNUSED,\n\t\tint argc UNUSED, const char **argv UNUSED)\n{\n  return PAM_SUCCESS;\n}",
    "includes": [
      "#include \"pam_inline.h\"",
      "#include <security/pam_ext.h>",
      "#include <security/pam_modutil.h>",
      "#include <security/pam_modules.h>",
      "#include <syslog.h>",
      "#include <stdlib.h>",
      "#include <string.h>",
      "#include <netdb.h>",
      "#include <pwd.h>",
      "#include \"config.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"pam_inline.h\"\n#include <security/pam_ext.h>\n#include <security/pam_modutil.h>\n#include <security/pam_modules.h>\n#include <syslog.h>\n#include <stdlib.h>\n#include <string.h>\n#include <netdb.h>\n#include <pwd.h>\n#include \"config.h\"\n\nint\npam_sm_setcred (pam_handle_t *pamh UNUSED, int flags UNUSED,\n\t\tint argc UNUSED, const char **argv UNUSED)\n{\n  return PAM_SUCCESS;\n}"
  },
  {
    "function_name": "pam_sm_authenticate",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2022-28321/repo/modules/pam_rhosts/pam_rhosts.c",
    "lines": "48-134",
    "snippet": "int pam_sm_authenticate (pam_handle_t *pamh, int flags, int argc,\n\t\t\t const char **argv)\n{\n    const char *luser = NULL;\n    const char *ruser = NULL, *rhost = NULL;\n    const char *opt_superuser = NULL;\n    const void *c_void;\n    int opt_debug = 0;\n    int opt_silent;\n    int as_root;\n    int retval;\n\n    opt_silent = flags & PAM_SILENT;\n\n    while (argc-- > 0) {\n      const char *str;\n\n      if (strcmp(*argv, \"debug\") == 0)\n\topt_debug = 1;\n      else if (strcmp (*argv, \"silent\") == 0 || strcmp(*argv, \"suppress\") == 0)\n\topt_silent = 1;\n      else if ((str = pam_str_skip_prefix(*argv, \"superuser=\")) != NULL)\n\topt_superuser = str;\n      else\n\tpam_syslog(pamh, LOG_WARNING, \"unrecognized option '%s'\", *argv);\n\n      ++argv;\n    }\n\n    retval = pam_get_item (pamh, PAM_RHOST, &c_void);\n    if (retval != PAM_SUCCESS) {\n      pam_syslog(pamh, LOG_ERR, \"could not get the remote host name\");\n      return retval;\n    }\n    rhost = c_void;\n\n    retval = pam_get_item(pamh, PAM_RUSER, &c_void);\n    ruser = c_void;\n    if (retval != PAM_SUCCESS) {\n      pam_syslog(pamh, LOG_ERR, \"could not get the remote username\");\n      return retval;\n    }\n\n    retval = pam_get_user(pamh, &luser, NULL);\n    if (retval != PAM_SUCCESS) {\n      pam_syslog(pamh, LOG_NOTICE, \"cannot determine local user name: %s\",\n\t\t pam_strerror(pamh, retval));\n      return retval;\n    }\n\n    if (rhost == NULL || ruser == NULL)\n      return PAM_AUTH_ERR;\n\n    if (opt_superuser && strcmp(opt_superuser, luser) == 0)\n      as_root = 1;\n    else {\n      struct passwd *lpwd;\n\n      lpwd = pam_modutil_getpwnam(pamh, luser);\n      if (lpwd == NULL) {\n\tif (opt_debug)\n\t  /* don't print by default, could be the user's password */\n\t  pam_syslog(pamh, LOG_DEBUG,\n\t\t     \"user '%s' unknown to this system\", luser);\n\treturn PAM_USER_UNKNOWN;\n\n      }\n      as_root = (lpwd->pw_uid == 0);\n    }\n\n#ifdef HAVE_RUSEROK_AF\n    retval = ruserok_af (rhost, as_root, ruser, luser, PF_UNSPEC);\n#else\n    retval = ruserok (rhost, as_root, ruser, luser);\n#endif\n    if (retval != 0) {\n      if (!opt_silent || opt_debug)\n\tpam_syslog(pamh, LOG_WARNING, \"denied access to %s@%s as %s\",\n\t\t   ruser, rhost, luser);\n      return PAM_AUTH_ERR;\n    } else {\n      if (!opt_silent || opt_debug)\n\tpam_syslog(pamh, LOG_NOTICE, \"allowed access to %s@%s as %s\",\n\t\t   ruser, rhost, luser);\n      return PAM_SUCCESS;\n    }\n}",
    "includes": [
      "#include \"pam_inline.h\"",
      "#include <security/pam_ext.h>",
      "#include <security/pam_modutil.h>",
      "#include <security/pam_modules.h>",
      "#include <syslog.h>",
      "#include <stdlib.h>",
      "#include <string.h>",
      "#include <netdb.h>",
      "#include <pwd.h>",
      "#include \"config.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "pam_syslog",
          "args": [
            "pamh",
            "LOG_NOTICE",
            "\"allowed access to %s@%s as %s\"",
            "ruser",
            "rhost",
            "luser"
          ],
          "line": 130
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pam_syslog",
          "args": [
            "pamh",
            "LOG_WARNING",
            "\"denied access to %s@%s as %s\"",
            "ruser",
            "rhost",
            "luser"
          ],
          "line": 125
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ruserok",
          "args": [
            "rhost",
            "as_root",
            "ruser",
            "luser"
          ],
          "line": 121
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ruserok_af",
          "args": [
            "rhost",
            "as_root",
            "ruser",
            "luser",
            "PF_UNSPEC"
          ],
          "line": 119
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pam_syslog",
          "args": [
            "pamh",
            "LOG_DEBUG",
            "\"user '%s' unknown to this system\"",
            "luser"
          ],
          "line": 110
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pam_modutil_getpwnam",
          "args": [
            "pamh",
            "luser"
          ],
          "line": 106
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "opt_superuser",
            "luser"
          ],
          "line": 101
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pam_syslog",
          "args": [
            "pamh",
            "LOG_NOTICE",
            "\"cannot determine local user name: %s\"",
            "pam_strerror(pamh, retval)"
          ],
          "line": 93
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pam_strerror",
          "args": [
            "pamh",
            "retval"
          ],
          "line": 94
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pam_get_user",
          "args": [
            "pamh",
            "&luser",
            "NULL"
          ],
          "line": 91
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pam_syslog",
          "args": [
            "pamh",
            "LOG_ERR",
            "\"could not get the remote username\""
          ],
          "line": 87
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pam_get_item",
          "args": [
            "pamh",
            "PAM_RUSER",
            "&c_void"
          ],
          "line": 84
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pam_syslog",
          "args": [
            "pamh",
            "LOG_ERR",
            "\"could not get the remote host name\""
          ],
          "line": 79
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pam_get_item",
          "args": [
            "pamh",
            "PAM_RHOST",
            "&c_void"
          ],
          "line": 77
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pam_syslog",
          "args": [
            "pamh",
            "LOG_WARNING",
            "\"unrecognized option '%s'\"",
            "*argv"
          ],
          "line": 72
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pam_str_skip_prefix",
          "args": [
            "*argv",
            "\"superuser=\""
          ],
          "line": 69
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "*argv",
            "\"suppress\""
          ],
          "line": 67
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "*argv",
            "\"silent\""
          ],
          "line": 67
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "*argv",
            "\"debug\""
          ],
          "line": 65
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"pam_inline.h\"\n#include <security/pam_ext.h>\n#include <security/pam_modutil.h>\n#include <security/pam_modules.h>\n#include <syslog.h>\n#include <stdlib.h>\n#include <string.h>\n#include <netdb.h>\n#include <pwd.h>\n#include \"config.h\"\n\nint pam_sm_authenticate (pam_handle_t *pamh, int flags, int argc,\n\t\t\t const char **argv)\n{\n    const char *luser = NULL;\n    const char *ruser = NULL, *rhost = NULL;\n    const char *opt_superuser = NULL;\n    const void *c_void;\n    int opt_debug = 0;\n    int opt_silent;\n    int as_root;\n    int retval;\n\n    opt_silent = flags & PAM_SILENT;\n\n    while (argc-- > 0) {\n      const char *str;\n\n      if (strcmp(*argv, \"debug\") == 0)\n\topt_debug = 1;\n      else if (strcmp (*argv, \"silent\") == 0 || strcmp(*argv, \"suppress\") == 0)\n\topt_silent = 1;\n      else if ((str = pam_str_skip_prefix(*argv, \"superuser=\")) != NULL)\n\topt_superuser = str;\n      else\n\tpam_syslog(pamh, LOG_WARNING, \"unrecognized option '%s'\", *argv);\n\n      ++argv;\n    }\n\n    retval = pam_get_item (pamh, PAM_RHOST, &c_void);\n    if (retval != PAM_SUCCESS) {\n      pam_syslog(pamh, LOG_ERR, \"could not get the remote host name\");\n      return retval;\n    }\n    rhost = c_void;\n\n    retval = pam_get_item(pamh, PAM_RUSER, &c_void);\n    ruser = c_void;\n    if (retval != PAM_SUCCESS) {\n      pam_syslog(pamh, LOG_ERR, \"could not get the remote username\");\n      return retval;\n    }\n\n    retval = pam_get_user(pamh, &luser, NULL);\n    if (retval != PAM_SUCCESS) {\n      pam_syslog(pamh, LOG_NOTICE, \"cannot determine local user name: %s\",\n\t\t pam_strerror(pamh, retval));\n      return retval;\n    }\n\n    if (rhost == NULL || ruser == NULL)\n      return PAM_AUTH_ERR;\n\n    if (opt_superuser && strcmp(opt_superuser, luser) == 0)\n      as_root = 1;\n    else {\n      struct passwd *lpwd;\n\n      lpwd = pam_modutil_getpwnam(pamh, luser);\n      if (lpwd == NULL) {\n\tif (opt_debug)\n\t  /* don't print by default, could be the user's password */\n\t  pam_syslog(pamh, LOG_DEBUG,\n\t\t     \"user '%s' unknown to this system\", luser);\n\treturn PAM_USER_UNKNOWN;\n\n      }\n      as_root = (lpwd->pw_uid == 0);\n    }\n\n#ifdef HAVE_RUSEROK_AF\n    retval = ruserok_af (rhost, as_root, ruser, luser, PF_UNSPEC);\n#else\n    retval = ruserok (rhost, as_root, ruser, luser);\n#endif\n    if (retval != 0) {\n      if (!opt_silent || opt_debug)\n\tpam_syslog(pamh, LOG_WARNING, \"denied access to %s@%s as %s\",\n\t\t   ruser, rhost, luser);\n      return PAM_AUTH_ERR;\n    } else {\n      if (!opt_silent || opt_debug)\n\tpam_syslog(pamh, LOG_NOTICE, \"allowed access to %s@%s as %s\",\n\t\t   ruser, rhost, luser);\n      return PAM_SUCCESS;\n    }\n}"
  }
]