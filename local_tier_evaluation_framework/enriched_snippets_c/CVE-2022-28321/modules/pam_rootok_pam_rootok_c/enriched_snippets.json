[
  {
    "function_name": "pam_sm_chauthtok",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2022-28321/repo/modules/pam_rootok/pam_rootok.c",
    "lines": "162-171",
    "snippet": "int\npam_sm_chauthtok (pam_handle_t *pamh, int flags UNUSED,\n\t\t  int argc, const char **argv)\n{\n    int ctrl;\n\n    ctrl = _pam_parse(pamh, argc, argv);\n\n    return check_for_root (pamh, ctrl);\n}",
    "includes": [
      "#include <libaudit.h>",
      "#include <selinux/avc.h>",
      "#include <selinux/selinux.h>",
      "#include <security/pam_ext.h>",
      "#include <security/pam_modules.h>",
      "#include <string.h>",
      "#include <stdarg.h>",
      "#include <syslog.h>",
      "#include <unistd.h>",
      "#include <stdio.h>",
      "#include \"config.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "check_for_root",
          "args": [
            "pamh",
            "ctrl"
          ],
          "line": 170
        },
        "resolved": true,
        "details": {
          "function_name": "check_for_root",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2022-28321/repo/modules/pam_rootok/pam_rootok.c",
          "lines": "112-129",
          "snippet": "static int\ncheck_for_root (pam_handle_t *pamh, int ctrl)\n{\n    int retval = PAM_AUTH_ERR;\n\n    if (getuid() == 0)\n#ifdef WITH_SELINUX\n      if (selinux_check_root() == 0 || security_getenforce() == 0)\n#endif\n\tretval = PAM_SUCCESS;\n\n    if (ctrl & PAM_DEBUG_ARG) {\n       pam_syslog(pamh, LOG_DEBUG, \"root check %s\",\n\t          (retval==PAM_SUCCESS) ? \"succeeded\" : \"failed\");\n    }\n\n    return retval;\n}",
          "includes": [
            "#include <libaudit.h>",
            "#include <selinux/avc.h>",
            "#include <selinux/selinux.h>",
            "#include <security/pam_ext.h>",
            "#include <security/pam_modules.h>",
            "#include <string.h>",
            "#include <stdarg.h>",
            "#include <syslog.h>",
            "#include <unistd.h>",
            "#include <stdio.h>",
            "#include \"config.h\""
          ],
          "macros_used": [
            "#define PAM_DEBUG_ARG       01"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <libaudit.h>\n#include <selinux/avc.h>\n#include <selinux/selinux.h>\n#include <security/pam_ext.h>\n#include <security/pam_modules.h>\n#include <string.h>\n#include <stdarg.h>\n#include <syslog.h>\n#include <unistd.h>\n#include <stdio.h>\n#include \"config.h\"\n\n#define PAM_DEBUG_ARG       01\n\nstatic int\ncheck_for_root (pam_handle_t *pamh, int ctrl)\n{\n    int retval = PAM_AUTH_ERR;\n\n    if (getuid() == 0)\n#ifdef WITH_SELINUX\n      if (selinux_check_root() == 0 || security_getenforce() == 0)\n#endif\n\tretval = PAM_SUCCESS;\n\n    if (ctrl & PAM_DEBUG_ARG) {\n       pam_syslog(pamh, LOG_DEBUG, \"root check %s\",\n\t          (retval==PAM_SUCCESS) ? \"succeeded\" : \"failed\");\n    }\n\n    return retval;\n}"
        }
      },
      {
        "call_info": {
          "callee": "_pam_parse",
          "args": [
            "pamh",
            "argc",
            "argv"
          ],
          "line": 168
        },
        "resolved": true,
        "details": {
          "function_name": "_pam_parse",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2022-28321/repo/modules/pam_rootok/pam_rootok.c",
          "lines": "31-49",
          "snippet": "static int\n_pam_parse (const pam_handle_t *pamh, int argc, const char **argv)\n{\n    int ctrl=0;\n\n    /* step through arguments */\n    for (ctrl=0; argc-- > 0; ++argv) {\n\n\t/* generic options */\n\n\tif (!strcmp(*argv,\"debug\"))\n\t    ctrl |= PAM_DEBUG_ARG;\n\telse {\n\t    pam_syslog(pamh, LOG_ERR, \"unknown option: %s\", *argv);\n\t}\n    }\n\n    return ctrl;\n}",
          "includes": [
            "#include <libaudit.h>",
            "#include <selinux/avc.h>",
            "#include <selinux/selinux.h>",
            "#include <security/pam_ext.h>",
            "#include <security/pam_modules.h>",
            "#include <string.h>",
            "#include <stdarg.h>",
            "#include <syslog.h>",
            "#include <unistd.h>",
            "#include <stdio.h>",
            "#include \"config.h\""
          ],
          "macros_used": [
            "#define PAM_DEBUG_ARG       01"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <libaudit.h>\n#include <selinux/avc.h>\n#include <selinux/selinux.h>\n#include <security/pam_ext.h>\n#include <security/pam_modules.h>\n#include <string.h>\n#include <stdarg.h>\n#include <syslog.h>\n#include <unistd.h>\n#include <stdio.h>\n#include \"config.h\"\n\n#define PAM_DEBUG_ARG       01\n\nstatic int\n_pam_parse (const pam_handle_t *pamh, int argc, const char **argv)\n{\n    int ctrl=0;\n\n    /* step through arguments */\n    for (ctrl=0; argc-- > 0; ++argv) {\n\n\t/* generic options */\n\n\tif (!strcmp(*argv,\"debug\"))\n\t    ctrl |= PAM_DEBUG_ARG;\n\telse {\n\t    pam_syslog(pamh, LOG_ERR, \"unknown option: %s\", *argv);\n\t}\n    }\n\n    return ctrl;\n}"
        }
      }
    ],
    "contextual_snippet": "#include <libaudit.h>\n#include <selinux/avc.h>\n#include <selinux/selinux.h>\n#include <security/pam_ext.h>\n#include <security/pam_modules.h>\n#include <string.h>\n#include <stdarg.h>\n#include <syslog.h>\n#include <unistd.h>\n#include <stdio.h>\n#include \"config.h\"\n\nint\npam_sm_chauthtok (pam_handle_t *pamh, int flags UNUSED,\n\t\t  int argc, const char **argv)\n{\n    int ctrl;\n\n    ctrl = _pam_parse(pamh, argc, argv);\n\n    return check_for_root (pamh, ctrl);\n}"
  },
  {
    "function_name": "pam_sm_acct_mgmt",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2022-28321/repo/modules/pam_rootok/pam_rootok.c",
    "lines": "151-160",
    "snippet": "int\npam_sm_acct_mgmt (pam_handle_t *pamh, int flags UNUSED,\n\t\t  int argc, const char **argv)\n{\n    int ctrl;\n\n    ctrl = _pam_parse(pamh, argc, argv);\n\n    return check_for_root (pamh, ctrl);\n}",
    "includes": [
      "#include <libaudit.h>",
      "#include <selinux/avc.h>",
      "#include <selinux/selinux.h>",
      "#include <security/pam_ext.h>",
      "#include <security/pam_modules.h>",
      "#include <string.h>",
      "#include <stdarg.h>",
      "#include <syslog.h>",
      "#include <unistd.h>",
      "#include <stdio.h>",
      "#include \"config.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "check_for_root",
          "args": [
            "pamh",
            "ctrl"
          ],
          "line": 159
        },
        "resolved": true,
        "details": {
          "function_name": "check_for_root",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2022-28321/repo/modules/pam_rootok/pam_rootok.c",
          "lines": "112-129",
          "snippet": "static int\ncheck_for_root (pam_handle_t *pamh, int ctrl)\n{\n    int retval = PAM_AUTH_ERR;\n\n    if (getuid() == 0)\n#ifdef WITH_SELINUX\n      if (selinux_check_root() == 0 || security_getenforce() == 0)\n#endif\n\tretval = PAM_SUCCESS;\n\n    if (ctrl & PAM_DEBUG_ARG) {\n       pam_syslog(pamh, LOG_DEBUG, \"root check %s\",\n\t          (retval==PAM_SUCCESS) ? \"succeeded\" : \"failed\");\n    }\n\n    return retval;\n}",
          "includes": [
            "#include <libaudit.h>",
            "#include <selinux/avc.h>",
            "#include <selinux/selinux.h>",
            "#include <security/pam_ext.h>",
            "#include <security/pam_modules.h>",
            "#include <string.h>",
            "#include <stdarg.h>",
            "#include <syslog.h>",
            "#include <unistd.h>",
            "#include <stdio.h>",
            "#include \"config.h\""
          ],
          "macros_used": [
            "#define PAM_DEBUG_ARG       01"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <libaudit.h>\n#include <selinux/avc.h>\n#include <selinux/selinux.h>\n#include <security/pam_ext.h>\n#include <security/pam_modules.h>\n#include <string.h>\n#include <stdarg.h>\n#include <syslog.h>\n#include <unistd.h>\n#include <stdio.h>\n#include \"config.h\"\n\n#define PAM_DEBUG_ARG       01\n\nstatic int\ncheck_for_root (pam_handle_t *pamh, int ctrl)\n{\n    int retval = PAM_AUTH_ERR;\n\n    if (getuid() == 0)\n#ifdef WITH_SELINUX\n      if (selinux_check_root() == 0 || security_getenforce() == 0)\n#endif\n\tretval = PAM_SUCCESS;\n\n    if (ctrl & PAM_DEBUG_ARG) {\n       pam_syslog(pamh, LOG_DEBUG, \"root check %s\",\n\t          (retval==PAM_SUCCESS) ? \"succeeded\" : \"failed\");\n    }\n\n    return retval;\n}"
        }
      },
      {
        "call_info": {
          "callee": "_pam_parse",
          "args": [
            "pamh",
            "argc",
            "argv"
          ],
          "line": 157
        },
        "resolved": true,
        "details": {
          "function_name": "_pam_parse",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2022-28321/repo/modules/pam_rootok/pam_rootok.c",
          "lines": "31-49",
          "snippet": "static int\n_pam_parse (const pam_handle_t *pamh, int argc, const char **argv)\n{\n    int ctrl=0;\n\n    /* step through arguments */\n    for (ctrl=0; argc-- > 0; ++argv) {\n\n\t/* generic options */\n\n\tif (!strcmp(*argv,\"debug\"))\n\t    ctrl |= PAM_DEBUG_ARG;\n\telse {\n\t    pam_syslog(pamh, LOG_ERR, \"unknown option: %s\", *argv);\n\t}\n    }\n\n    return ctrl;\n}",
          "includes": [
            "#include <libaudit.h>",
            "#include <selinux/avc.h>",
            "#include <selinux/selinux.h>",
            "#include <security/pam_ext.h>",
            "#include <security/pam_modules.h>",
            "#include <string.h>",
            "#include <stdarg.h>",
            "#include <syslog.h>",
            "#include <unistd.h>",
            "#include <stdio.h>",
            "#include \"config.h\""
          ],
          "macros_used": [
            "#define PAM_DEBUG_ARG       01"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <libaudit.h>\n#include <selinux/avc.h>\n#include <selinux/selinux.h>\n#include <security/pam_ext.h>\n#include <security/pam_modules.h>\n#include <string.h>\n#include <stdarg.h>\n#include <syslog.h>\n#include <unistd.h>\n#include <stdio.h>\n#include \"config.h\"\n\n#define PAM_DEBUG_ARG       01\n\nstatic int\n_pam_parse (const pam_handle_t *pamh, int argc, const char **argv)\n{\n    int ctrl=0;\n\n    /* step through arguments */\n    for (ctrl=0; argc-- > 0; ++argv) {\n\n\t/* generic options */\n\n\tif (!strcmp(*argv,\"debug\"))\n\t    ctrl |= PAM_DEBUG_ARG;\n\telse {\n\t    pam_syslog(pamh, LOG_ERR, \"unknown option: %s\", *argv);\n\t}\n    }\n\n    return ctrl;\n}"
        }
      }
    ],
    "contextual_snippet": "#include <libaudit.h>\n#include <selinux/avc.h>\n#include <selinux/selinux.h>\n#include <security/pam_ext.h>\n#include <security/pam_modules.h>\n#include <string.h>\n#include <stdarg.h>\n#include <syslog.h>\n#include <unistd.h>\n#include <stdio.h>\n#include \"config.h\"\n\nint\npam_sm_acct_mgmt (pam_handle_t *pamh, int flags UNUSED,\n\t\t  int argc, const char **argv)\n{\n    int ctrl;\n\n    ctrl = _pam_parse(pamh, argc, argv);\n\n    return check_for_root (pamh, ctrl);\n}"
  },
  {
    "function_name": "pam_sm_setcred",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2022-28321/repo/modules/pam_rootok/pam_rootok.c",
    "lines": "144-149",
    "snippet": "int\npam_sm_setcred (pam_handle_t *pamh UNUSED, int flags UNUSED,\n\t\tint argc UNUSED, const char **argv UNUSED)\n{\n    return PAM_SUCCESS;\n}",
    "includes": [
      "#include <libaudit.h>",
      "#include <selinux/avc.h>",
      "#include <selinux/selinux.h>",
      "#include <security/pam_ext.h>",
      "#include <security/pam_modules.h>",
      "#include <string.h>",
      "#include <stdarg.h>",
      "#include <syslog.h>",
      "#include <unistd.h>",
      "#include <stdio.h>",
      "#include \"config.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include <libaudit.h>\n#include <selinux/avc.h>\n#include <selinux/selinux.h>\n#include <security/pam_ext.h>\n#include <security/pam_modules.h>\n#include <string.h>\n#include <stdarg.h>\n#include <syslog.h>\n#include <unistd.h>\n#include <stdio.h>\n#include \"config.h\"\n\nint\npam_sm_setcred (pam_handle_t *pamh UNUSED, int flags UNUSED,\n\t\tint argc UNUSED, const char **argv UNUSED)\n{\n    return PAM_SUCCESS;\n}"
  },
  {
    "function_name": "pam_sm_authenticate",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2022-28321/repo/modules/pam_rootok/pam_rootok.c",
    "lines": "133-142",
    "snippet": "int\npam_sm_authenticate (pam_handle_t *pamh, int flags UNUSED,\n\t\t     int argc, const char **argv)\n{\n    int ctrl;\n\n    ctrl = _pam_parse(pamh, argc, argv);\n\n    return check_for_root (pamh, ctrl);\n}",
    "includes": [
      "#include <libaudit.h>",
      "#include <selinux/avc.h>",
      "#include <selinux/selinux.h>",
      "#include <security/pam_ext.h>",
      "#include <security/pam_modules.h>",
      "#include <string.h>",
      "#include <stdarg.h>",
      "#include <syslog.h>",
      "#include <unistd.h>",
      "#include <stdio.h>",
      "#include \"config.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "check_for_root",
          "args": [
            "pamh",
            "ctrl"
          ],
          "line": 141
        },
        "resolved": true,
        "details": {
          "function_name": "check_for_root",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2022-28321/repo/modules/pam_rootok/pam_rootok.c",
          "lines": "112-129",
          "snippet": "static int\ncheck_for_root (pam_handle_t *pamh, int ctrl)\n{\n    int retval = PAM_AUTH_ERR;\n\n    if (getuid() == 0)\n#ifdef WITH_SELINUX\n      if (selinux_check_root() == 0 || security_getenforce() == 0)\n#endif\n\tretval = PAM_SUCCESS;\n\n    if (ctrl & PAM_DEBUG_ARG) {\n       pam_syslog(pamh, LOG_DEBUG, \"root check %s\",\n\t          (retval==PAM_SUCCESS) ? \"succeeded\" : \"failed\");\n    }\n\n    return retval;\n}",
          "includes": [
            "#include <libaudit.h>",
            "#include <selinux/avc.h>",
            "#include <selinux/selinux.h>",
            "#include <security/pam_ext.h>",
            "#include <security/pam_modules.h>",
            "#include <string.h>",
            "#include <stdarg.h>",
            "#include <syslog.h>",
            "#include <unistd.h>",
            "#include <stdio.h>",
            "#include \"config.h\""
          ],
          "macros_used": [
            "#define PAM_DEBUG_ARG       01"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <libaudit.h>\n#include <selinux/avc.h>\n#include <selinux/selinux.h>\n#include <security/pam_ext.h>\n#include <security/pam_modules.h>\n#include <string.h>\n#include <stdarg.h>\n#include <syslog.h>\n#include <unistd.h>\n#include <stdio.h>\n#include \"config.h\"\n\n#define PAM_DEBUG_ARG       01\n\nstatic int\ncheck_for_root (pam_handle_t *pamh, int ctrl)\n{\n    int retval = PAM_AUTH_ERR;\n\n    if (getuid() == 0)\n#ifdef WITH_SELINUX\n      if (selinux_check_root() == 0 || security_getenforce() == 0)\n#endif\n\tretval = PAM_SUCCESS;\n\n    if (ctrl & PAM_DEBUG_ARG) {\n       pam_syslog(pamh, LOG_DEBUG, \"root check %s\",\n\t          (retval==PAM_SUCCESS) ? \"succeeded\" : \"failed\");\n    }\n\n    return retval;\n}"
        }
      },
      {
        "call_info": {
          "callee": "_pam_parse",
          "args": [
            "pamh",
            "argc",
            "argv"
          ],
          "line": 139
        },
        "resolved": true,
        "details": {
          "function_name": "_pam_parse",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2022-28321/repo/modules/pam_rootok/pam_rootok.c",
          "lines": "31-49",
          "snippet": "static int\n_pam_parse (const pam_handle_t *pamh, int argc, const char **argv)\n{\n    int ctrl=0;\n\n    /* step through arguments */\n    for (ctrl=0; argc-- > 0; ++argv) {\n\n\t/* generic options */\n\n\tif (!strcmp(*argv,\"debug\"))\n\t    ctrl |= PAM_DEBUG_ARG;\n\telse {\n\t    pam_syslog(pamh, LOG_ERR, \"unknown option: %s\", *argv);\n\t}\n    }\n\n    return ctrl;\n}",
          "includes": [
            "#include <libaudit.h>",
            "#include <selinux/avc.h>",
            "#include <selinux/selinux.h>",
            "#include <security/pam_ext.h>",
            "#include <security/pam_modules.h>",
            "#include <string.h>",
            "#include <stdarg.h>",
            "#include <syslog.h>",
            "#include <unistd.h>",
            "#include <stdio.h>",
            "#include \"config.h\""
          ],
          "macros_used": [
            "#define PAM_DEBUG_ARG       01"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <libaudit.h>\n#include <selinux/avc.h>\n#include <selinux/selinux.h>\n#include <security/pam_ext.h>\n#include <security/pam_modules.h>\n#include <string.h>\n#include <stdarg.h>\n#include <syslog.h>\n#include <unistd.h>\n#include <stdio.h>\n#include \"config.h\"\n\n#define PAM_DEBUG_ARG       01\n\nstatic int\n_pam_parse (const pam_handle_t *pamh, int argc, const char **argv)\n{\n    int ctrl=0;\n\n    /* step through arguments */\n    for (ctrl=0; argc-- > 0; ++argv) {\n\n\t/* generic options */\n\n\tif (!strcmp(*argv,\"debug\"))\n\t    ctrl |= PAM_DEBUG_ARG;\n\telse {\n\t    pam_syslog(pamh, LOG_ERR, \"unknown option: %s\", *argv);\n\t}\n    }\n\n    return ctrl;\n}"
        }
      }
    ],
    "contextual_snippet": "#include <libaudit.h>\n#include <selinux/avc.h>\n#include <selinux/selinux.h>\n#include <security/pam_ext.h>\n#include <security/pam_modules.h>\n#include <string.h>\n#include <stdarg.h>\n#include <syslog.h>\n#include <unistd.h>\n#include <stdio.h>\n#include \"config.h\"\n\nint\npam_sm_authenticate (pam_handle_t *pamh, int flags UNUSED,\n\t\t     int argc, const char **argv)\n{\n    int ctrl;\n\n    ctrl = _pam_parse(pamh, argc, argv);\n\n    return check_for_root (pamh, ctrl);\n}"
  },
  {
    "function_name": "check_for_root",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2022-28321/repo/modules/pam_rootok/pam_rootok.c",
    "lines": "112-129",
    "snippet": "static int\ncheck_for_root (pam_handle_t *pamh, int ctrl)\n{\n    int retval = PAM_AUTH_ERR;\n\n    if (getuid() == 0)\n#ifdef WITH_SELINUX\n      if (selinux_check_root() == 0 || security_getenforce() == 0)\n#endif\n\tretval = PAM_SUCCESS;\n\n    if (ctrl & PAM_DEBUG_ARG) {\n       pam_syslog(pamh, LOG_DEBUG, \"root check %s\",\n\t          (retval==PAM_SUCCESS) ? \"succeeded\" : \"failed\");\n    }\n\n    return retval;\n}",
    "includes": [
      "#include <libaudit.h>",
      "#include <selinux/avc.h>",
      "#include <selinux/selinux.h>",
      "#include <security/pam_ext.h>",
      "#include <security/pam_modules.h>",
      "#include <string.h>",
      "#include <stdarg.h>",
      "#include <syslog.h>",
      "#include <unistd.h>",
      "#include <stdio.h>",
      "#include \"config.h\""
    ],
    "macros_used": [
      "#define PAM_DEBUG_ARG       01"
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "pam_syslog",
          "args": [
            "pamh",
            "LOG_DEBUG",
            "\"root check %s\"",
            "(retval==PAM_SUCCESS) ? \"succeeded\" : \"failed\""
          ],
          "line": 124
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "security_getenforce",
          "args": [],
          "line": 119
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "selinux_check_root",
          "args": [],
          "line": 119
        },
        "resolved": true,
        "details": {
          "function_name": "selinux_check_root",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2022-28321/repo/modules/pam_rootok/pam_rootok.c",
          "lines": "86-109",
          "snippet": "static int\nselinux_check_root (void)\n{\n    int status = -1;\n    char *user_context_raw;\n    union selinux_callback old_callback;\n\n    if (is_selinux_enabled() < 1)\n\treturn 0;\n\n    old_callback = selinux_get_callback(SELINUX_CB_LOG);\n    /* setup callbacks */\n    selinux_set_callback(SELINUX_CB_LOG, (union selinux_callback) &log_callback);\n    if ((status = getprevcon_raw(&user_context_raw)) < 0) {\n\tselinux_set_callback(SELINUX_CB_LOG, old_callback);\n\treturn status;\n    }\n\n    status = selinux_check_access(user_context_raw, user_context_raw, \"passwd\", \"rootok\", NULL);\n\n    selinux_set_callback(SELINUX_CB_LOG, old_callback);\n    freecon(user_context_raw);\n    return status;\n}",
          "includes": [
            "#include <libaudit.h>",
            "#include <selinux/avc.h>",
            "#include <selinux/selinux.h>",
            "#include <security/pam_ext.h>",
            "#include <security/pam_modules.h>",
            "#include <string.h>",
            "#include <stdarg.h>",
            "#include <syslog.h>",
            "#include <unistd.h>",
            "#include <stdio.h>",
            "#include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <libaudit.h>\n#include <selinux/avc.h>\n#include <selinux/selinux.h>\n#include <security/pam_ext.h>\n#include <security/pam_modules.h>\n#include <string.h>\n#include <stdarg.h>\n#include <syslog.h>\n#include <unistd.h>\n#include <stdio.h>\n#include \"config.h\"\n\nstatic int\nselinux_check_root (void)\n{\n    int status = -1;\n    char *user_context_raw;\n    union selinux_callback old_callback;\n\n    if (is_selinux_enabled() < 1)\n\treturn 0;\n\n    old_callback = selinux_get_callback(SELINUX_CB_LOG);\n    /* setup callbacks */\n    selinux_set_callback(SELINUX_CB_LOG, (union selinux_callback) &log_callback);\n    if ((status = getprevcon_raw(&user_context_raw)) < 0) {\n\tselinux_set_callback(SELINUX_CB_LOG, old_callback);\n\treturn status;\n    }\n\n    status = selinux_check_access(user_context_raw, user_context_raw, \"passwd\", \"rootok\", NULL);\n\n    selinux_set_callback(SELINUX_CB_LOG, old_callback);\n    freecon(user_context_raw);\n    return status;\n}"
        }
      },
      {
        "call_info": {
          "callee": "getuid",
          "args": [],
          "line": 117
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <libaudit.h>\n#include <selinux/avc.h>\n#include <selinux/selinux.h>\n#include <security/pam_ext.h>\n#include <security/pam_modules.h>\n#include <string.h>\n#include <stdarg.h>\n#include <syslog.h>\n#include <unistd.h>\n#include <stdio.h>\n#include \"config.h\"\n\n#define PAM_DEBUG_ARG       01\n\nstatic int\ncheck_for_root (pam_handle_t *pamh, int ctrl)\n{\n    int retval = PAM_AUTH_ERR;\n\n    if (getuid() == 0)\n#ifdef WITH_SELINUX\n      if (selinux_check_root() == 0 || security_getenforce() == 0)\n#endif\n\tretval = PAM_SUCCESS;\n\n    if (ctrl & PAM_DEBUG_ARG) {\n       pam_syslog(pamh, LOG_DEBUG, \"root check %s\",\n\t          (retval==PAM_SUCCESS) ? \"succeeded\" : \"failed\");\n    }\n\n    return retval;\n}"
  },
  {
    "function_name": "selinux_check_root",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2022-28321/repo/modules/pam_rootok/pam_rootok.c",
    "lines": "86-109",
    "snippet": "static int\nselinux_check_root (void)\n{\n    int status = -1;\n    char *user_context_raw;\n    union selinux_callback old_callback;\n\n    if (is_selinux_enabled() < 1)\n\treturn 0;\n\n    old_callback = selinux_get_callback(SELINUX_CB_LOG);\n    /* setup callbacks */\n    selinux_set_callback(SELINUX_CB_LOG, (union selinux_callback) &log_callback);\n    if ((status = getprevcon_raw(&user_context_raw)) < 0) {\n\tselinux_set_callback(SELINUX_CB_LOG, old_callback);\n\treturn status;\n    }\n\n    status = selinux_check_access(user_context_raw, user_context_raw, \"passwd\", \"rootok\", NULL);\n\n    selinux_set_callback(SELINUX_CB_LOG, old_callback);\n    freecon(user_context_raw);\n    return status;\n}",
    "includes": [
      "#include <libaudit.h>",
      "#include <selinux/avc.h>",
      "#include <selinux/selinux.h>",
      "#include <security/pam_ext.h>",
      "#include <security/pam_modules.h>",
      "#include <string.h>",
      "#include <stdarg.h>",
      "#include <syslog.h>",
      "#include <unistd.h>",
      "#include <stdio.h>",
      "#include \"config.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "freecon",
          "args": [
            "user_context_raw"
          ],
          "line": 107
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "selinux_set_callback",
          "args": [
            "SELINUX_CB_LOG",
            "old_callback"
          ],
          "line": 106
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "selinux_check_access",
          "args": [
            "user_context_raw",
            "user_context_raw",
            "\"passwd\"",
            "\"rootok\"",
            "NULL"
          ],
          "line": 104
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "selinux_set_callback",
          "args": [
            "SELINUX_CB_LOG",
            "old_callback"
          ],
          "line": 100
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "getprevcon_raw",
          "args": [
            "&user_context_raw"
          ],
          "line": 99
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "selinux_set_callback",
          "args": [
            "SELINUX_CB_LOG",
            "(union selinux_callback) &log_callback"
          ],
          "line": 98
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "selinux_get_callback",
          "args": [
            "SELINUX_CB_LOG"
          ],
          "line": 96
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "is_selinux_enabled",
          "args": [],
          "line": 93
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <libaudit.h>\n#include <selinux/avc.h>\n#include <selinux/selinux.h>\n#include <security/pam_ext.h>\n#include <security/pam_modules.h>\n#include <string.h>\n#include <stdarg.h>\n#include <syslog.h>\n#include <unistd.h>\n#include <stdio.h>\n#include \"config.h\"\n\nstatic int\nselinux_check_root (void)\n{\n    int status = -1;\n    char *user_context_raw;\n    union selinux_callback old_callback;\n\n    if (is_selinux_enabled() < 1)\n\treturn 0;\n\n    old_callback = selinux_get_callback(SELINUX_CB_LOG);\n    /* setup callbacks */\n    selinux_set_callback(SELINUX_CB_LOG, (union selinux_callback) &log_callback);\n    if ((status = getprevcon_raw(&user_context_raw)) < 0) {\n\tselinux_set_callback(SELINUX_CB_LOG, old_callback);\n\treturn status;\n    }\n\n    status = selinux_check_access(user_context_raw, user_context_raw, \"passwd\", \"rootok\", NULL);\n\n    selinux_set_callback(SELINUX_CB_LOG, old_callback);\n    freecon(user_context_raw);\n    return status;\n}"
  },
  {
    "function_name": "PAM_FORMAT",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2022-28321/repo/modules/pam_rootok/pam_rootok.c",
    "lines": "52-77",
    "snippet": "static int\nPAM_FORMAT((printf, 2, 3))\nlog_callback (int type UNUSED, const char *fmt, ...)\n{\n    va_list ap;\n\n#ifdef HAVE_LIBAUDIT\n    int audit_fd = audit_open();\n\n    if (audit_fd >= 0) {\n\tchar *buf;\n\tint ret;\n\n\tva_start(ap, fmt);\n\tret = vasprintf (&buf, fmt, ap);\n\tva_end(ap);\n\tif (ret < 0) {\n\t\treturn 0;\n\t}\n\taudit_log_user_avc_message(audit_fd, AUDIT_USER_AVC, buf, NULL, NULL,\n\t\t\t\t   NULL, 0);\n\taudit_close(audit_fd);\n\tfree(buf);\n\tva_end(ap);\n\treturn 0;\n    }",
    "includes": [
      "#include <libaudit.h>",
      "#include <selinux/avc.h>",
      "#include <selinux/selinux.h>",
      "#include <security/pam_ext.h>",
      "#include <security/pam_modules.h>",
      "#include <string.h>",
      "#include <stdarg.h>",
      "#include <syslog.h>",
      "#include <unistd.h>",
      "#include <stdio.h>",
      "#include \"config.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "va_end",
          "args": [
            "ap"
          ],
          "line": 75
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "free",
          "args": [
            "buf"
          ],
          "line": 74
        },
        "resolved": true,
        "details": {
          "function_name": "free_module_data",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2022-28321/repo/modules/pam_selinux/pam_selinux.c",
          "lines": "386-398",
          "snippet": "static void\nfree_module_data(module_data_t *data)\n{\n  free(data->tty_path);\n  freecon(data->prev_tty_context);\n  freecon(data->tty_context);\n  freecon(data->default_user_context);\n  freecon(data->prev_exec_context);\n  if (data->exec_context != data->default_user_context)\n    freecon(data->exec_context);\n  memset(data, 0, sizeof(*data));\n  free(data);\n}",
          "includes": [
            "#include <sys/select.h>",
            "#include <libaudit.h>",
            "#include <selinux/get_default_type.h>",
            "#include <selinux/context.h>",
            "#include <selinux/get_context_list.h>",
            "#include <selinux/selinux.h>",
            "#include \"pam_inline.h\"",
            "#include <security/pam_ext.h>",
            "#include <security/pam_modutil.h>",
            "#include <security/_pam_macros.h>",
            "#include <security/pam_modules.h>",
            "#include <syslog.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <pwd.h>",
            "#include <limits.h>",
            "#include <errno.h>",
            "#include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <sys/select.h>\n#include <libaudit.h>\n#include <selinux/get_default_type.h>\n#include <selinux/context.h>\n#include <selinux/get_context_list.h>\n#include <selinux/selinux.h>\n#include \"pam_inline.h\"\n#include <security/pam_ext.h>\n#include <security/pam_modutil.h>\n#include <security/_pam_macros.h>\n#include <security/pam_modules.h>\n#include <syslog.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <limits.h>\n#include <errno.h>\n#include \"config.h\"\n\nstatic void\nfree_module_data(module_data_t *data)\n{\n  free(data->tty_path);\n  freecon(data->prev_tty_context);\n  freecon(data->tty_context);\n  freecon(data->default_user_context);\n  freecon(data->prev_exec_context);\n  if (data->exec_context != data->default_user_context)\n    freecon(data->exec_context);\n  memset(data, 0, sizeof(*data));\n  free(data);\n}"
        }
      },
      {
        "call_info": {
          "callee": "audit_close",
          "args": [
            "audit_fd"
          ],
          "line": 73
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "audit_log_user_avc_message",
          "args": [
            "audit_fd",
            "AUDIT_USER_AVC",
            "buf",
            "NULL",
            "NULL",
            "NULL",
            "0"
          ],
          "line": 71
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "va_end",
          "args": [
            "ap"
          ],
          "line": 67
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "vasprintf",
          "args": [
            "&buf",
            "fmt",
            "ap"
          ],
          "line": 66
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "va_start",
          "args": [
            "ap",
            "fmt"
          ],
          "line": 65
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "audit_open",
          "args": [],
          "line": 59
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <libaudit.h>\n#include <selinux/avc.h>\n#include <selinux/selinux.h>\n#include <security/pam_ext.h>\n#include <security/pam_modules.h>\n#include <string.h>\n#include <stdarg.h>\n#include <syslog.h>\n#include <unistd.h>\n#include <stdio.h>\n#include \"config.h\"\n\nstatic int\nPAM_FORMAT((printf, 2, 3))\nlog_callback (int type UNUSED, const char *fmt, ...)\n{\n    va_list ap;\n\n#ifdef HAVE_LIBAUDIT\n    int audit_fd = audit_open();\n\n    if (audit_fd >= 0) {\n\tchar *buf;\n\tint ret;\n\n\tva_start(ap, fmt);\n\tret = vasprintf (&buf, fmt, ap);\n\tva_end(ap);\n\tif (ret < 0) {\n\t\treturn 0;\n\t}\n\taudit_log_user_avc_message(audit_fd, AUDIT_USER_AVC, buf, NULL, NULL,\n\t\t\t\t   NULL, 0);\n\taudit_close(audit_fd);\n\tfree(buf);\n\tva_end(ap);\n\treturn 0;\n    }"
  },
  {
    "function_name": "_pam_parse",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2022-28321/repo/modules/pam_rootok/pam_rootok.c",
    "lines": "31-49",
    "snippet": "static int\n_pam_parse (const pam_handle_t *pamh, int argc, const char **argv)\n{\n    int ctrl=0;\n\n    /* step through arguments */\n    for (ctrl=0; argc-- > 0; ++argv) {\n\n\t/* generic options */\n\n\tif (!strcmp(*argv,\"debug\"))\n\t    ctrl |= PAM_DEBUG_ARG;\n\telse {\n\t    pam_syslog(pamh, LOG_ERR, \"unknown option: %s\", *argv);\n\t}\n    }\n\n    return ctrl;\n}",
    "includes": [
      "#include <libaudit.h>",
      "#include <selinux/avc.h>",
      "#include <selinux/selinux.h>",
      "#include <security/pam_ext.h>",
      "#include <security/pam_modules.h>",
      "#include <string.h>",
      "#include <stdarg.h>",
      "#include <syslog.h>",
      "#include <unistd.h>",
      "#include <stdio.h>",
      "#include \"config.h\""
    ],
    "macros_used": [
      "#define PAM_DEBUG_ARG       01"
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "pam_syslog",
          "args": [
            "pamh",
            "LOG_ERR",
            "\"unknown option: %s\"",
            "*argv"
          ],
          "line": 44
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "*argv",
            "\"debug\""
          ],
          "line": 41
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <libaudit.h>\n#include <selinux/avc.h>\n#include <selinux/selinux.h>\n#include <security/pam_ext.h>\n#include <security/pam_modules.h>\n#include <string.h>\n#include <stdarg.h>\n#include <syslog.h>\n#include <unistd.h>\n#include <stdio.h>\n#include \"config.h\"\n\n#define PAM_DEBUG_ARG       01\n\nstatic int\n_pam_parse (const pam_handle_t *pamh, int argc, const char **argv)\n{\n    int ctrl=0;\n\n    /* step through arguments */\n    for (ctrl=0; argc-- > 0; ++argv) {\n\n\t/* generic options */\n\n\tif (!strcmp(*argv,\"debug\"))\n\t    ctrl |= PAM_DEBUG_ARG;\n\telse {\n\t    pam_syslog(pamh, LOG_ERR, \"unknown option: %s\", *argv);\n\t}\n    }\n\n    return ctrl;\n}"
  }
]