[
  {
    "function_name": "pam_sm_chauthtok",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2022-28321/repo/modules/pam_usertype/pam_usertype.c",
    "lines": "304-308",
    "snippet": "int\npam_sm_chauthtok(pam_handle_t *pamh, int flags, int argc, const char **argv)\n{\n\treturn pam_sm_authenticate(pamh, flags, argc, argv);\n}",
    "includes": [
      "#include <security/pam_ext.h>",
      "#include <security/pam_modutil.h>",
      "#include <security/pam_modules.h>",
      "#include <errno.h>",
      "#include <ctype.h>",
      "#include <pwd.h>",
      "#include <unistd.h>",
      "#include <syslog.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <sys/types.h>",
      "#include \"config.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "pam_sm_authenticate",
          "args": [
            "pamh",
            "flags",
            "argc",
            "argv"
          ],
          "line": 307
        },
        "resolved": true,
        "details": {
          "function_name": "pam_sm_authenticate",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2022-28321/repo/modules/pam_usertype/pam_usertype.c",
          "lines": "258-277",
          "snippet": "int\npam_sm_authenticate(pam_handle_t *pamh, int flags UNUSED,\n                    int argc, const char **argv)\n{\n    struct pam_usertype_opts opts;\n    uid_t uid = -1;\n    int ret;\n\n    ret = pam_usertype_parse_args(&opts, pamh, argc, argv);\n    if (ret != PAM_SUCCESS) {\n        return ret;\n    }\n\n    ret = pam_usertype_get_uid(&opts, pamh, &uid);\n    if (ret != PAM_SUCCESS) {\n        return ret;\n    }\n\n    return pam_usertype_evaluate(&opts, pamh, uid);\n}",
          "includes": [
            "#include <security/pam_ext.h>",
            "#include <security/pam_modutil.h>",
            "#include <security/pam_modules.h>",
            "#include <errno.h>",
            "#include <ctype.h>",
            "#include <pwd.h>",
            "#include <unistd.h>",
            "#include <syslog.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <sys/types.h>",
            "#include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <security/pam_ext.h>\n#include <security/pam_modutil.h>\n#include <security/pam_modules.h>\n#include <errno.h>\n#include <ctype.h>\n#include <pwd.h>\n#include <unistd.h>\n#include <syslog.h>\n#include <string.h>\n#include <stdlib.h>\n#include <sys/types.h>\n#include \"config.h\"\n\nint\npam_sm_authenticate(pam_handle_t *pamh, int flags UNUSED,\n                    int argc, const char **argv)\n{\n    struct pam_usertype_opts opts;\n    uid_t uid = -1;\n    int ret;\n\n    ret = pam_usertype_parse_args(&opts, pamh, argc, argv);\n    if (ret != PAM_SUCCESS) {\n        return ret;\n    }\n\n    ret = pam_usertype_get_uid(&opts, pamh, &uid);\n    if (ret != PAM_SUCCESS) {\n        return ret;\n    }\n\n    return pam_usertype_evaluate(&opts, pamh, uid);\n}"
        }
      }
    ],
    "contextual_snippet": "#include <security/pam_ext.h>\n#include <security/pam_modutil.h>\n#include <security/pam_modules.h>\n#include <errno.h>\n#include <ctype.h>\n#include <pwd.h>\n#include <unistd.h>\n#include <syslog.h>\n#include <string.h>\n#include <stdlib.h>\n#include <sys/types.h>\n#include \"config.h\"\n\nint\npam_sm_chauthtok(pam_handle_t *pamh, int flags, int argc, const char **argv)\n{\n\treturn pam_sm_authenticate(pamh, flags, argc, argv);\n}"
  },
  {
    "function_name": "pam_sm_close_session",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2022-28321/repo/modules/pam_usertype/pam_usertype.c",
    "lines": "298-302",
    "snippet": "int\npam_sm_close_session(pam_handle_t *pamh, int flags, int argc, const char **argv)\n{\n\treturn pam_sm_authenticate(pamh, flags, argc, argv);\n}",
    "includes": [
      "#include <security/pam_ext.h>",
      "#include <security/pam_modutil.h>",
      "#include <security/pam_modules.h>",
      "#include <errno.h>",
      "#include <ctype.h>",
      "#include <pwd.h>",
      "#include <unistd.h>",
      "#include <syslog.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <sys/types.h>",
      "#include \"config.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "pam_sm_authenticate",
          "args": [
            "pamh",
            "flags",
            "argc",
            "argv"
          ],
          "line": 301
        },
        "resolved": true,
        "details": {
          "function_name": "pam_sm_authenticate",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2022-28321/repo/modules/pam_usertype/pam_usertype.c",
          "lines": "258-277",
          "snippet": "int\npam_sm_authenticate(pam_handle_t *pamh, int flags UNUSED,\n                    int argc, const char **argv)\n{\n    struct pam_usertype_opts opts;\n    uid_t uid = -1;\n    int ret;\n\n    ret = pam_usertype_parse_args(&opts, pamh, argc, argv);\n    if (ret != PAM_SUCCESS) {\n        return ret;\n    }\n\n    ret = pam_usertype_get_uid(&opts, pamh, &uid);\n    if (ret != PAM_SUCCESS) {\n        return ret;\n    }\n\n    return pam_usertype_evaluate(&opts, pamh, uid);\n}",
          "includes": [
            "#include <security/pam_ext.h>",
            "#include <security/pam_modutil.h>",
            "#include <security/pam_modules.h>",
            "#include <errno.h>",
            "#include <ctype.h>",
            "#include <pwd.h>",
            "#include <unistd.h>",
            "#include <syslog.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <sys/types.h>",
            "#include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <security/pam_ext.h>\n#include <security/pam_modutil.h>\n#include <security/pam_modules.h>\n#include <errno.h>\n#include <ctype.h>\n#include <pwd.h>\n#include <unistd.h>\n#include <syslog.h>\n#include <string.h>\n#include <stdlib.h>\n#include <sys/types.h>\n#include \"config.h\"\n\nint\npam_sm_authenticate(pam_handle_t *pamh, int flags UNUSED,\n                    int argc, const char **argv)\n{\n    struct pam_usertype_opts opts;\n    uid_t uid = -1;\n    int ret;\n\n    ret = pam_usertype_parse_args(&opts, pamh, argc, argv);\n    if (ret != PAM_SUCCESS) {\n        return ret;\n    }\n\n    ret = pam_usertype_get_uid(&opts, pamh, &uid);\n    if (ret != PAM_SUCCESS) {\n        return ret;\n    }\n\n    return pam_usertype_evaluate(&opts, pamh, uid);\n}"
        }
      }
    ],
    "contextual_snippet": "#include <security/pam_ext.h>\n#include <security/pam_modutil.h>\n#include <security/pam_modules.h>\n#include <errno.h>\n#include <ctype.h>\n#include <pwd.h>\n#include <unistd.h>\n#include <syslog.h>\n#include <string.h>\n#include <stdlib.h>\n#include <sys/types.h>\n#include \"config.h\"\n\nint\npam_sm_close_session(pam_handle_t *pamh, int flags, int argc, const char **argv)\n{\n\treturn pam_sm_authenticate(pamh, flags, argc, argv);\n}"
  },
  {
    "function_name": "pam_sm_open_session",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2022-28321/repo/modules/pam_usertype/pam_usertype.c",
    "lines": "292-296",
    "snippet": "int\npam_sm_open_session(pam_handle_t *pamh, int flags, int argc, const char **argv)\n{\n\treturn pam_sm_authenticate(pamh, flags, argc, argv);\n}",
    "includes": [
      "#include <security/pam_ext.h>",
      "#include <security/pam_modutil.h>",
      "#include <security/pam_modules.h>",
      "#include <errno.h>",
      "#include <ctype.h>",
      "#include <pwd.h>",
      "#include <unistd.h>",
      "#include <syslog.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <sys/types.h>",
      "#include \"config.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "pam_sm_authenticate",
          "args": [
            "pamh",
            "flags",
            "argc",
            "argv"
          ],
          "line": 295
        },
        "resolved": true,
        "details": {
          "function_name": "pam_sm_authenticate",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2022-28321/repo/modules/pam_usertype/pam_usertype.c",
          "lines": "258-277",
          "snippet": "int\npam_sm_authenticate(pam_handle_t *pamh, int flags UNUSED,\n                    int argc, const char **argv)\n{\n    struct pam_usertype_opts opts;\n    uid_t uid = -1;\n    int ret;\n\n    ret = pam_usertype_parse_args(&opts, pamh, argc, argv);\n    if (ret != PAM_SUCCESS) {\n        return ret;\n    }\n\n    ret = pam_usertype_get_uid(&opts, pamh, &uid);\n    if (ret != PAM_SUCCESS) {\n        return ret;\n    }\n\n    return pam_usertype_evaluate(&opts, pamh, uid);\n}",
          "includes": [
            "#include <security/pam_ext.h>",
            "#include <security/pam_modutil.h>",
            "#include <security/pam_modules.h>",
            "#include <errno.h>",
            "#include <ctype.h>",
            "#include <pwd.h>",
            "#include <unistd.h>",
            "#include <syslog.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <sys/types.h>",
            "#include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <security/pam_ext.h>\n#include <security/pam_modutil.h>\n#include <security/pam_modules.h>\n#include <errno.h>\n#include <ctype.h>\n#include <pwd.h>\n#include <unistd.h>\n#include <syslog.h>\n#include <string.h>\n#include <stdlib.h>\n#include <sys/types.h>\n#include \"config.h\"\n\nint\npam_sm_authenticate(pam_handle_t *pamh, int flags UNUSED,\n                    int argc, const char **argv)\n{\n    struct pam_usertype_opts opts;\n    uid_t uid = -1;\n    int ret;\n\n    ret = pam_usertype_parse_args(&opts, pamh, argc, argv);\n    if (ret != PAM_SUCCESS) {\n        return ret;\n    }\n\n    ret = pam_usertype_get_uid(&opts, pamh, &uid);\n    if (ret != PAM_SUCCESS) {\n        return ret;\n    }\n\n    return pam_usertype_evaluate(&opts, pamh, uid);\n}"
        }
      }
    ],
    "contextual_snippet": "#include <security/pam_ext.h>\n#include <security/pam_modutil.h>\n#include <security/pam_modules.h>\n#include <errno.h>\n#include <ctype.h>\n#include <pwd.h>\n#include <unistd.h>\n#include <syslog.h>\n#include <string.h>\n#include <stdlib.h>\n#include <sys/types.h>\n#include \"config.h\"\n\nint\npam_sm_open_session(pam_handle_t *pamh, int flags, int argc, const char **argv)\n{\n\treturn pam_sm_authenticate(pamh, flags, argc, argv);\n}"
  },
  {
    "function_name": "pam_sm_acct_mgmt",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2022-28321/repo/modules/pam_usertype/pam_usertype.c",
    "lines": "286-290",
    "snippet": "int\npam_sm_acct_mgmt(pam_handle_t *pamh, int flags, int argc, const char **argv)\n{\n\treturn pam_sm_authenticate(pamh, flags, argc, argv);\n}",
    "includes": [
      "#include <security/pam_ext.h>",
      "#include <security/pam_modutil.h>",
      "#include <security/pam_modules.h>",
      "#include <errno.h>",
      "#include <ctype.h>",
      "#include <pwd.h>",
      "#include <unistd.h>",
      "#include <syslog.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <sys/types.h>",
      "#include \"config.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "pam_sm_authenticate",
          "args": [
            "pamh",
            "flags",
            "argc",
            "argv"
          ],
          "line": 289
        },
        "resolved": true,
        "details": {
          "function_name": "pam_sm_authenticate",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2022-28321/repo/modules/pam_usertype/pam_usertype.c",
          "lines": "258-277",
          "snippet": "int\npam_sm_authenticate(pam_handle_t *pamh, int flags UNUSED,\n                    int argc, const char **argv)\n{\n    struct pam_usertype_opts opts;\n    uid_t uid = -1;\n    int ret;\n\n    ret = pam_usertype_parse_args(&opts, pamh, argc, argv);\n    if (ret != PAM_SUCCESS) {\n        return ret;\n    }\n\n    ret = pam_usertype_get_uid(&opts, pamh, &uid);\n    if (ret != PAM_SUCCESS) {\n        return ret;\n    }\n\n    return pam_usertype_evaluate(&opts, pamh, uid);\n}",
          "includes": [
            "#include <security/pam_ext.h>",
            "#include <security/pam_modutil.h>",
            "#include <security/pam_modules.h>",
            "#include <errno.h>",
            "#include <ctype.h>",
            "#include <pwd.h>",
            "#include <unistd.h>",
            "#include <syslog.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <sys/types.h>",
            "#include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <security/pam_ext.h>\n#include <security/pam_modutil.h>\n#include <security/pam_modules.h>\n#include <errno.h>\n#include <ctype.h>\n#include <pwd.h>\n#include <unistd.h>\n#include <syslog.h>\n#include <string.h>\n#include <stdlib.h>\n#include <sys/types.h>\n#include \"config.h\"\n\nint\npam_sm_authenticate(pam_handle_t *pamh, int flags UNUSED,\n                    int argc, const char **argv)\n{\n    struct pam_usertype_opts opts;\n    uid_t uid = -1;\n    int ret;\n\n    ret = pam_usertype_parse_args(&opts, pamh, argc, argv);\n    if (ret != PAM_SUCCESS) {\n        return ret;\n    }\n\n    ret = pam_usertype_get_uid(&opts, pamh, &uid);\n    if (ret != PAM_SUCCESS) {\n        return ret;\n    }\n\n    return pam_usertype_evaluate(&opts, pamh, uid);\n}"
        }
      }
    ],
    "contextual_snippet": "#include <security/pam_ext.h>\n#include <security/pam_modutil.h>\n#include <security/pam_modules.h>\n#include <errno.h>\n#include <ctype.h>\n#include <pwd.h>\n#include <unistd.h>\n#include <syslog.h>\n#include <string.h>\n#include <stdlib.h>\n#include <sys/types.h>\n#include \"config.h\"\n\nint\npam_sm_acct_mgmt(pam_handle_t *pamh, int flags, int argc, const char **argv)\n{\n\treturn pam_sm_authenticate(pamh, flags, argc, argv);\n}"
  },
  {
    "function_name": "pam_sm_setcred",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2022-28321/repo/modules/pam_usertype/pam_usertype.c",
    "lines": "279-284",
    "snippet": "int\npam_sm_setcred(pam_handle_t *pamh UNUSED, int flags UNUSED,\n               int argc UNUSED, const char **argv UNUSED)\n{\n\treturn PAM_IGNORE;\n}",
    "includes": [
      "#include <security/pam_ext.h>",
      "#include <security/pam_modutil.h>",
      "#include <security/pam_modules.h>",
      "#include <errno.h>",
      "#include <ctype.h>",
      "#include <pwd.h>",
      "#include <unistd.h>",
      "#include <syslog.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <sys/types.h>",
      "#include \"config.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include <security/pam_ext.h>\n#include <security/pam_modutil.h>\n#include <security/pam_modules.h>\n#include <errno.h>\n#include <ctype.h>\n#include <pwd.h>\n#include <unistd.h>\n#include <syslog.h>\n#include <string.h>\n#include <stdlib.h>\n#include <sys/types.h>\n#include \"config.h\"\n\nint\npam_sm_setcred(pam_handle_t *pamh UNUSED, int flags UNUSED,\n               int argc UNUSED, const char **argv UNUSED)\n{\n\treturn PAM_IGNORE;\n}"
  },
  {
    "function_name": "pam_sm_authenticate",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2022-28321/repo/modules/pam_usertype/pam_usertype.c",
    "lines": "258-277",
    "snippet": "int\npam_sm_authenticate(pam_handle_t *pamh, int flags UNUSED,\n                    int argc, const char **argv)\n{\n    struct pam_usertype_opts opts;\n    uid_t uid = -1;\n    int ret;\n\n    ret = pam_usertype_parse_args(&opts, pamh, argc, argv);\n    if (ret != PAM_SUCCESS) {\n        return ret;\n    }\n\n    ret = pam_usertype_get_uid(&opts, pamh, &uid);\n    if (ret != PAM_SUCCESS) {\n        return ret;\n    }\n\n    return pam_usertype_evaluate(&opts, pamh, uid);\n}",
    "includes": [
      "#include <security/pam_ext.h>",
      "#include <security/pam_modutil.h>",
      "#include <security/pam_modules.h>",
      "#include <errno.h>",
      "#include <ctype.h>",
      "#include <pwd.h>",
      "#include <unistd.h>",
      "#include <syslog.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <sys/types.h>",
      "#include \"config.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "pam_usertype_evaluate",
          "args": [
            "&opts",
            "pamh",
            "uid"
          ],
          "line": 276
        },
        "resolved": true,
        "details": {
          "function_name": "pam_usertype_evaluate",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2022-28321/repo/modules/pam_usertype/pam_usertype.c",
          "lines": "235-249",
          "snippet": "static int\npam_usertype_evaluate(struct pam_usertype_opts *opts,\n                      pam_handle_t *pamh,\n                      uid_t uid)\n{\n    switch (opts->op) {\n    case OP_IS_SYSTEM:\n        return pam_usertype_is_system(pamh, uid);\n    case OP_IS_REGULAR:\n        return pam_usertype_is_regular(pamh, uid);\n    default:\n        pam_syslog(pamh, LOG_ERR, \"Unknown operation: %d\", opts->op);\n        return PAM_SERVICE_ERR;\n    }\n}",
          "includes": [
            "#include <security/pam_ext.h>",
            "#include <security/pam_modutil.h>",
            "#include <security/pam_modules.h>",
            "#include <errno.h>",
            "#include <ctype.h>",
            "#include <pwd.h>",
            "#include <unistd.h>",
            "#include <syslog.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <sys/types.h>",
            "#include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <security/pam_ext.h>\n#include <security/pam_modutil.h>\n#include <security/pam_modules.h>\n#include <errno.h>\n#include <ctype.h>\n#include <pwd.h>\n#include <unistd.h>\n#include <syslog.h>\n#include <string.h>\n#include <stdlib.h>\n#include <sys/types.h>\n#include \"config.h\"\n\nstatic int\npam_usertype_evaluate(struct pam_usertype_opts *opts,\n                      pam_handle_t *pamh,\n                      uid_t uid)\n{\n    switch (opts->op) {\n    case OP_IS_SYSTEM:\n        return pam_usertype_is_system(pamh, uid);\n    case OP_IS_REGULAR:\n        return pam_usertype_is_regular(pamh, uid);\n    default:\n        pam_syslog(pamh, LOG_ERR, \"Unknown operation: %d\", opts->op);\n        return PAM_SERVICE_ERR;\n    }\n}"
        }
      },
      {
        "call_info": {
          "callee": "pam_usertype_get_uid",
          "args": [
            "&opts",
            "pamh",
            "&uid"
          ],
          "line": 271
        },
        "resolved": true,
        "details": {
          "function_name": "pam_usertype_get_uid",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2022-28321/repo/modules/pam_usertype/pam_usertype.c",
          "lines": "104-151",
          "snippet": "static int\npam_usertype_get_uid(struct pam_usertype_opts *opts,\n                     pam_handle_t *pamh,\n                     uid_t *_uid)\n{\n    struct passwd *pwd;\n    const char *username;\n    int ret;\n\n    /* Get uid of user that runs the application. */\n    if (opts->use_uid) {\n        pwd = pam_modutil_getpwuid(pamh, getuid());\n        if (pwd == NULL) {\n            pam_syslog(pamh, LOG_ERR,\n                       \"error retrieving information about user %lu\",\n                       (unsigned long)getuid());\n            return PAM_USER_UNKNOWN;\n        }\n\n        *_uid = pwd->pw_uid;\n        return PAM_SUCCESS;\n    }\n\n    /* Get uid of user that is being authenticated. */\n    ret = pam_get_user(pamh, &username, NULL);\n    if (ret != PAM_SUCCESS) {\n        pam_syslog(pamh, LOG_NOTICE, \"cannot determine user name: %s\",\n                   pam_strerror(pamh, ret));\n        return ret == PAM_CONV_AGAIN ? PAM_INCOMPLETE : ret;\n    }\n\n    pwd = pam_modutil_getpwnam(pamh, username);\n    if (pwd == NULL) {\n        if (opts->audit) {\n            pam_syslog(pamh, LOG_NOTICE,\n                       \"error retrieving information about user %s\", username);\n        }\n\n        pam_modutil_getpwnam(pamh, \"root\");\n\n        return PAM_USER_UNKNOWN;\n    }\n    pam_modutil_getpwnam(pamh, \"pam_usertype_non_existent:\");\n\n    *_uid = pwd->pw_uid;\n\n    return PAM_SUCCESS;\n}",
          "includes": [
            "#include <security/pam_ext.h>",
            "#include <security/pam_modutil.h>",
            "#include <security/pam_modules.h>",
            "#include <errno.h>",
            "#include <ctype.h>",
            "#include <pwd.h>",
            "#include <unistd.h>",
            "#include <syslog.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <sys/types.h>",
            "#include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <security/pam_ext.h>\n#include <security/pam_modutil.h>\n#include <security/pam_modules.h>\n#include <errno.h>\n#include <ctype.h>\n#include <pwd.h>\n#include <unistd.h>\n#include <syslog.h>\n#include <string.h>\n#include <stdlib.h>\n#include <sys/types.h>\n#include \"config.h\"\n\nstatic int\npam_usertype_get_uid(struct pam_usertype_opts *opts,\n                     pam_handle_t *pamh,\n                     uid_t *_uid)\n{\n    struct passwd *pwd;\n    const char *username;\n    int ret;\n\n    /* Get uid of user that runs the application. */\n    if (opts->use_uid) {\n        pwd = pam_modutil_getpwuid(pamh, getuid());\n        if (pwd == NULL) {\n            pam_syslog(pamh, LOG_ERR,\n                       \"error retrieving information about user %lu\",\n                       (unsigned long)getuid());\n            return PAM_USER_UNKNOWN;\n        }\n\n        *_uid = pwd->pw_uid;\n        return PAM_SUCCESS;\n    }\n\n    /* Get uid of user that is being authenticated. */\n    ret = pam_get_user(pamh, &username, NULL);\n    if (ret != PAM_SUCCESS) {\n        pam_syslog(pamh, LOG_NOTICE, \"cannot determine user name: %s\",\n                   pam_strerror(pamh, ret));\n        return ret == PAM_CONV_AGAIN ? PAM_INCOMPLETE : ret;\n    }\n\n    pwd = pam_modutil_getpwnam(pamh, username);\n    if (pwd == NULL) {\n        if (opts->audit) {\n            pam_syslog(pamh, LOG_NOTICE,\n                       \"error retrieving information about user %s\", username);\n        }\n\n        pam_modutil_getpwnam(pamh, \"root\");\n\n        return PAM_USER_UNKNOWN;\n    }\n    pam_modutil_getpwnam(pamh, \"pam_usertype_non_existent:\");\n\n    *_uid = pwd->pw_uid;\n\n    return PAM_SUCCESS;\n}"
        }
      },
      {
        "call_info": {
          "callee": "pam_usertype_parse_args",
          "args": [
            "&opts",
            "pamh",
            "argc",
            "argv"
          ],
          "line": 266
        },
        "resolved": true,
        "details": {
          "function_name": "pam_usertype_parse_args",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2022-28321/repo/modules/pam_usertype/pam_usertype.c",
          "lines": "70-102",
          "snippet": "static int\npam_usertype_parse_args(struct pam_usertype_opts *opts,\n                        pam_handle_t *pamh,\n                        int argc,\n                        const char **argv)\n{\n    int i;\n\n    memset(opts, 0, sizeof(struct pam_usertype_opts));\n    opts->op = OP_SENTINEL;\n\n    for (i = 0; i < argc; i++) {\n        if (strcmp(argv[i], \"use_uid\") == 0) {\n            opts->use_uid = 1;\n        } else if (strcmp(argv[i], \"audit\") == 0) {\n            opts->audit = 1;\n        } else if (strcmp(argv[i], \"issystem\") == 0) {\n            opts->op = OP_IS_SYSTEM;\n        } else if (strcmp(argv[i], \"isregular\") == 0) {\n            opts->op = OP_IS_REGULAR;\n        } else {\n            pam_syslog(pamh, LOG_WARNING, \"Unknown argument: %s\", argv[i]);\n            /* Just continue. */\n        }\n    }\n\n    if (opts->op == OP_SENTINEL) {\n        pam_syslog(pamh, LOG_ERR, \"Operation not specified\");\n        return PAM_SERVICE_ERR;\n    }\n\n    return PAM_SUCCESS;\n}",
          "includes": [
            "#include <security/pam_ext.h>",
            "#include <security/pam_modutil.h>",
            "#include <security/pam_modules.h>",
            "#include <errno.h>",
            "#include <ctype.h>",
            "#include <pwd.h>",
            "#include <unistd.h>",
            "#include <syslog.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <sys/types.h>",
            "#include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <security/pam_ext.h>\n#include <security/pam_modutil.h>\n#include <security/pam_modules.h>\n#include <errno.h>\n#include <ctype.h>\n#include <pwd.h>\n#include <unistd.h>\n#include <syslog.h>\n#include <string.h>\n#include <stdlib.h>\n#include <sys/types.h>\n#include \"config.h\"\n\nstatic int\npam_usertype_parse_args(struct pam_usertype_opts *opts,\n                        pam_handle_t *pamh,\n                        int argc,\n                        const char **argv)\n{\n    int i;\n\n    memset(opts, 0, sizeof(struct pam_usertype_opts));\n    opts->op = OP_SENTINEL;\n\n    for (i = 0; i < argc; i++) {\n        if (strcmp(argv[i], \"use_uid\") == 0) {\n            opts->use_uid = 1;\n        } else if (strcmp(argv[i], \"audit\") == 0) {\n            opts->audit = 1;\n        } else if (strcmp(argv[i], \"issystem\") == 0) {\n            opts->op = OP_IS_SYSTEM;\n        } else if (strcmp(argv[i], \"isregular\") == 0) {\n            opts->op = OP_IS_REGULAR;\n        } else {\n            pam_syslog(pamh, LOG_WARNING, \"Unknown argument: %s\", argv[i]);\n            /* Just continue. */\n        }\n    }\n\n    if (opts->op == OP_SENTINEL) {\n        pam_syslog(pamh, LOG_ERR, \"Operation not specified\");\n        return PAM_SERVICE_ERR;\n    }\n\n    return PAM_SUCCESS;\n}"
        }
      }
    ],
    "contextual_snippet": "#include <security/pam_ext.h>\n#include <security/pam_modutil.h>\n#include <security/pam_modules.h>\n#include <errno.h>\n#include <ctype.h>\n#include <pwd.h>\n#include <unistd.h>\n#include <syslog.h>\n#include <string.h>\n#include <stdlib.h>\n#include <sys/types.h>\n#include \"config.h\"\n\nint\npam_sm_authenticate(pam_handle_t *pamh, int flags UNUSED,\n                    int argc, const char **argv)\n{\n    struct pam_usertype_opts opts;\n    uid_t uid = -1;\n    int ret;\n\n    ret = pam_usertype_parse_args(&opts, pamh, argc, argv);\n    if (ret != PAM_SUCCESS) {\n        return ret;\n    }\n\n    ret = pam_usertype_get_uid(&opts, pamh, &uid);\n    if (ret != PAM_SUCCESS) {\n        return ret;\n    }\n\n    return pam_usertype_evaluate(&opts, pamh, uid);\n}"
  },
  {
    "function_name": "pam_usertype_evaluate",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2022-28321/repo/modules/pam_usertype/pam_usertype.c",
    "lines": "235-249",
    "snippet": "static int\npam_usertype_evaluate(struct pam_usertype_opts *opts,\n                      pam_handle_t *pamh,\n                      uid_t uid)\n{\n    switch (opts->op) {\n    case OP_IS_SYSTEM:\n        return pam_usertype_is_system(pamh, uid);\n    case OP_IS_REGULAR:\n        return pam_usertype_is_regular(pamh, uid);\n    default:\n        pam_syslog(pamh, LOG_ERR, \"Unknown operation: %d\", opts->op);\n        return PAM_SERVICE_ERR;\n    }\n}",
    "includes": [
      "#include <security/pam_ext.h>",
      "#include <security/pam_modutil.h>",
      "#include <security/pam_modules.h>",
      "#include <errno.h>",
      "#include <ctype.h>",
      "#include <pwd.h>",
      "#include <unistd.h>",
      "#include <syslog.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <sys/types.h>",
      "#include \"config.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "pam_syslog",
          "args": [
            "pamh",
            "LOG_ERR",
            "\"Unknown operation: %d\"",
            "opts->op"
          ],
          "line": 246
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pam_usertype_is_regular",
          "args": [
            "pamh",
            "uid"
          ],
          "line": 244
        },
        "resolved": true,
        "details": {
          "function_name": "pam_usertype_is_regular",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2022-28321/repo/modules/pam_usertype/pam_usertype.c",
          "lines": "219-233",
          "snippet": "static int\npam_usertype_is_regular(pam_handle_t *pamh, uid_t uid)\n{\n    int ret;\n\n    ret = pam_usertype_is_system(pamh, uid);\n    switch (ret) {\n    case PAM_SUCCESS:\n        return PAM_AUTH_ERR;\n    case PAM_USER_UNKNOWN:\n        return PAM_USER_UNKNOWN;\n    default:\n        return PAM_SUCCESS;\n    }\n}",
          "includes": [
            "#include <security/pam_ext.h>",
            "#include <security/pam_modutil.h>",
            "#include <security/pam_modules.h>",
            "#include <errno.h>",
            "#include <ctype.h>",
            "#include <pwd.h>",
            "#include <unistd.h>",
            "#include <syslog.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <sys/types.h>",
            "#include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <security/pam_ext.h>\n#include <security/pam_modutil.h>\n#include <security/pam_modules.h>\n#include <errno.h>\n#include <ctype.h>\n#include <pwd.h>\n#include <unistd.h>\n#include <syslog.h>\n#include <string.h>\n#include <stdlib.h>\n#include <sys/types.h>\n#include \"config.h\"\n\nstatic int\npam_usertype_is_regular(pam_handle_t *pamh, uid_t uid)\n{\n    int ret;\n\n    ret = pam_usertype_is_system(pamh, uid);\n    switch (ret) {\n    case PAM_SUCCESS:\n        return PAM_AUTH_ERR;\n    case PAM_USER_UNKNOWN:\n        return PAM_USER_UNKNOWN;\n    default:\n        return PAM_SUCCESS;\n    }\n}"
        }
      },
      {
        "call_info": {
          "callee": "pam_usertype_is_system",
          "args": [
            "pamh",
            "uid"
          ],
          "line": 242
        },
        "resolved": true,
        "details": {
          "function_name": "pam_usertype_is_system",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2022-28321/repo/modules/pam_usertype/pam_usertype.c",
          "lines": "193-217",
          "snippet": "static int\npam_usertype_is_system(pam_handle_t *pamh, uid_t uid)\n{\n    uid_t uid_min;\n    uid_t sys_max;\n\n    if (uid == (uid_t)-1) {\n        pam_syslog(pamh, LOG_WARNING, \"invalid uid\");\n        return PAM_USER_UNKNOWN;\n    }\n\n    if (uid == PAM_USERTYPE_OVERFLOW_UID) {\n        /* nobody */\n        return PAM_SUCCESS;\n    }\n\n    uid_min = pam_usertype_get_id(pamh, \"UID_MIN\", PAM_USERTYPE_UIDMIN);\n    sys_max = pam_usertype_get_id(pamh, \"SYS_UID_MAX\", uid_min - 1);\n\n    if (uid <= sys_max && uid < uid_min) {\n        return PAM_SUCCESS;\n    }\n\n    return PAM_AUTH_ERR;\n}",
          "includes": [
            "#include <security/pam_ext.h>",
            "#include <security/pam_modutil.h>",
            "#include <security/pam_modules.h>",
            "#include <errno.h>",
            "#include <ctype.h>",
            "#include <pwd.h>",
            "#include <unistd.h>",
            "#include <syslog.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <sys/types.h>",
            "#include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <security/pam_ext.h>\n#include <security/pam_modutil.h>\n#include <security/pam_modules.h>\n#include <errno.h>\n#include <ctype.h>\n#include <pwd.h>\n#include <unistd.h>\n#include <syslog.h>\n#include <string.h>\n#include <stdlib.h>\n#include <sys/types.h>\n#include \"config.h\"\n\nstatic int\npam_usertype_is_system(pam_handle_t *pamh, uid_t uid)\n{\n    uid_t uid_min;\n    uid_t sys_max;\n\n    if (uid == (uid_t)-1) {\n        pam_syslog(pamh, LOG_WARNING, \"invalid uid\");\n        return PAM_USER_UNKNOWN;\n    }\n\n    if (uid == PAM_USERTYPE_OVERFLOW_UID) {\n        /* nobody */\n        return PAM_SUCCESS;\n    }\n\n    uid_min = pam_usertype_get_id(pamh, \"UID_MIN\", PAM_USERTYPE_UIDMIN);\n    sys_max = pam_usertype_get_id(pamh, \"SYS_UID_MAX\", uid_min - 1);\n\n    if (uid <= sys_max && uid < uid_min) {\n        return PAM_SUCCESS;\n    }\n\n    return PAM_AUTH_ERR;\n}"
        }
      }
    ],
    "contextual_snippet": "#include <security/pam_ext.h>\n#include <security/pam_modutil.h>\n#include <security/pam_modules.h>\n#include <errno.h>\n#include <ctype.h>\n#include <pwd.h>\n#include <unistd.h>\n#include <syslog.h>\n#include <string.h>\n#include <stdlib.h>\n#include <sys/types.h>\n#include \"config.h\"\n\nstatic int\npam_usertype_evaluate(struct pam_usertype_opts *opts,\n                      pam_handle_t *pamh,\n                      uid_t uid)\n{\n    switch (opts->op) {\n    case OP_IS_SYSTEM:\n        return pam_usertype_is_system(pamh, uid);\n    case OP_IS_REGULAR:\n        return pam_usertype_is_regular(pamh, uid);\n    default:\n        pam_syslog(pamh, LOG_ERR, \"Unknown operation: %d\", opts->op);\n        return PAM_SERVICE_ERR;\n    }\n}"
  },
  {
    "function_name": "pam_usertype_is_regular",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2022-28321/repo/modules/pam_usertype/pam_usertype.c",
    "lines": "219-233",
    "snippet": "static int\npam_usertype_is_regular(pam_handle_t *pamh, uid_t uid)\n{\n    int ret;\n\n    ret = pam_usertype_is_system(pamh, uid);\n    switch (ret) {\n    case PAM_SUCCESS:\n        return PAM_AUTH_ERR;\n    case PAM_USER_UNKNOWN:\n        return PAM_USER_UNKNOWN;\n    default:\n        return PAM_SUCCESS;\n    }\n}",
    "includes": [
      "#include <security/pam_ext.h>",
      "#include <security/pam_modutil.h>",
      "#include <security/pam_modules.h>",
      "#include <errno.h>",
      "#include <ctype.h>",
      "#include <pwd.h>",
      "#include <unistd.h>",
      "#include <syslog.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <sys/types.h>",
      "#include \"config.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "pam_usertype_is_system",
          "args": [
            "pamh",
            "uid"
          ],
          "line": 224
        },
        "resolved": true,
        "details": {
          "function_name": "pam_usertype_is_system",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2022-28321/repo/modules/pam_usertype/pam_usertype.c",
          "lines": "193-217",
          "snippet": "static int\npam_usertype_is_system(pam_handle_t *pamh, uid_t uid)\n{\n    uid_t uid_min;\n    uid_t sys_max;\n\n    if (uid == (uid_t)-1) {\n        pam_syslog(pamh, LOG_WARNING, \"invalid uid\");\n        return PAM_USER_UNKNOWN;\n    }\n\n    if (uid == PAM_USERTYPE_OVERFLOW_UID) {\n        /* nobody */\n        return PAM_SUCCESS;\n    }\n\n    uid_min = pam_usertype_get_id(pamh, \"UID_MIN\", PAM_USERTYPE_UIDMIN);\n    sys_max = pam_usertype_get_id(pamh, \"SYS_UID_MAX\", uid_min - 1);\n\n    if (uid <= sys_max && uid < uid_min) {\n        return PAM_SUCCESS;\n    }\n\n    return PAM_AUTH_ERR;\n}",
          "includes": [
            "#include <security/pam_ext.h>",
            "#include <security/pam_modutil.h>",
            "#include <security/pam_modules.h>",
            "#include <errno.h>",
            "#include <ctype.h>",
            "#include <pwd.h>",
            "#include <unistd.h>",
            "#include <syslog.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <sys/types.h>",
            "#include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <security/pam_ext.h>\n#include <security/pam_modutil.h>\n#include <security/pam_modules.h>\n#include <errno.h>\n#include <ctype.h>\n#include <pwd.h>\n#include <unistd.h>\n#include <syslog.h>\n#include <string.h>\n#include <stdlib.h>\n#include <sys/types.h>\n#include \"config.h\"\n\nstatic int\npam_usertype_is_system(pam_handle_t *pamh, uid_t uid)\n{\n    uid_t uid_min;\n    uid_t sys_max;\n\n    if (uid == (uid_t)-1) {\n        pam_syslog(pamh, LOG_WARNING, \"invalid uid\");\n        return PAM_USER_UNKNOWN;\n    }\n\n    if (uid == PAM_USERTYPE_OVERFLOW_UID) {\n        /* nobody */\n        return PAM_SUCCESS;\n    }\n\n    uid_min = pam_usertype_get_id(pamh, \"UID_MIN\", PAM_USERTYPE_UIDMIN);\n    sys_max = pam_usertype_get_id(pamh, \"SYS_UID_MAX\", uid_min - 1);\n\n    if (uid <= sys_max && uid < uid_min) {\n        return PAM_SUCCESS;\n    }\n\n    return PAM_AUTH_ERR;\n}"
        }
      }
    ],
    "contextual_snippet": "#include <security/pam_ext.h>\n#include <security/pam_modutil.h>\n#include <security/pam_modules.h>\n#include <errno.h>\n#include <ctype.h>\n#include <pwd.h>\n#include <unistd.h>\n#include <syslog.h>\n#include <string.h>\n#include <stdlib.h>\n#include <sys/types.h>\n#include \"config.h\"\n\nstatic int\npam_usertype_is_regular(pam_handle_t *pamh, uid_t uid)\n{\n    int ret;\n\n    ret = pam_usertype_is_system(pamh, uid);\n    switch (ret) {\n    case PAM_SUCCESS:\n        return PAM_AUTH_ERR;\n    case PAM_USER_UNKNOWN:\n        return PAM_USER_UNKNOWN;\n    default:\n        return PAM_SUCCESS;\n    }\n}"
  },
  {
    "function_name": "pam_usertype_is_system",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2022-28321/repo/modules/pam_usertype/pam_usertype.c",
    "lines": "193-217",
    "snippet": "static int\npam_usertype_is_system(pam_handle_t *pamh, uid_t uid)\n{\n    uid_t uid_min;\n    uid_t sys_max;\n\n    if (uid == (uid_t)-1) {\n        pam_syslog(pamh, LOG_WARNING, \"invalid uid\");\n        return PAM_USER_UNKNOWN;\n    }\n\n    if (uid == PAM_USERTYPE_OVERFLOW_UID) {\n        /* nobody */\n        return PAM_SUCCESS;\n    }\n\n    uid_min = pam_usertype_get_id(pamh, \"UID_MIN\", PAM_USERTYPE_UIDMIN);\n    sys_max = pam_usertype_get_id(pamh, \"SYS_UID_MAX\", uid_min - 1);\n\n    if (uid <= sys_max && uid < uid_min) {\n        return PAM_SUCCESS;\n    }\n\n    return PAM_AUTH_ERR;\n}",
    "includes": [
      "#include <security/pam_ext.h>",
      "#include <security/pam_modutil.h>",
      "#include <security/pam_modules.h>",
      "#include <errno.h>",
      "#include <ctype.h>",
      "#include <pwd.h>",
      "#include <unistd.h>",
      "#include <syslog.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <sys/types.h>",
      "#include \"config.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "pam_usertype_get_id",
          "args": [
            "pamh",
            "\"SYS_UID_MAX\"",
            "uid_min - 1"
          ],
          "line": 210
        },
        "resolved": true,
        "details": {
          "function_name": "pam_usertype_get_id",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2022-28321/repo/modules/pam_usertype/pam_usertype.c",
          "lines": "155-191",
          "snippet": "static uid_t\npam_usertype_get_id(pam_handle_t *pamh,\n                    const char *key,\n                    uid_t default_value)\n{\n    unsigned long ul;\n    char *value;\n    char *ep;\n    uid_t uid;\n\n    value = pam_modutil_search_key(pamh, LOGIN_DEFS, key);\n    if (value == NULL) {\n        return default_value;\n    }\n\n    /* taken from get_lastlog_uid_max() */\n    ep = value + strlen(value);\n    while (ep > value && isspace(*(--ep))) {\n        *ep = '\\0';\n    }\n\n    errno = 0;\n    ul = strtoul(value, &ep, 10);\n    if (!(ul >= MAX_UID_VALUE\n        || (uid_t)ul >= MAX_UID_VALUE\n        || (errno != 0 && ul == 0)\n        || value == ep\n        || *ep != '\\0')) {\n        uid = (uid_t)ul;\n    } else {\n        uid = default_value;\n    }\n\n    free(value);\n\n    return uid;\n}",
          "includes": [
            "#include <security/pam_ext.h>",
            "#include <security/pam_modutil.h>",
            "#include <security/pam_modules.h>",
            "#include <errno.h>",
            "#include <ctype.h>",
            "#include <pwd.h>",
            "#include <unistd.h>",
            "#include <syslog.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <sys/types.h>",
            "#include \"config.h\""
          ],
          "macros_used": [
            "#define MAX_UID_VALUE 0xFFFFFFFFUL",
            "#define LOGIN_DEFS \"/etc/login.defs\""
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <security/pam_ext.h>\n#include <security/pam_modutil.h>\n#include <security/pam_modules.h>\n#include <errno.h>\n#include <ctype.h>\n#include <pwd.h>\n#include <unistd.h>\n#include <syslog.h>\n#include <string.h>\n#include <stdlib.h>\n#include <sys/types.h>\n#include \"config.h\"\n\n#define MAX_UID_VALUE 0xFFFFFFFFUL\n#define LOGIN_DEFS \"/etc/login.defs\"\n\nstatic uid_t\npam_usertype_get_id(pam_handle_t *pamh,\n                    const char *key,\n                    uid_t default_value)\n{\n    unsigned long ul;\n    char *value;\n    char *ep;\n    uid_t uid;\n\n    value = pam_modutil_search_key(pamh, LOGIN_DEFS, key);\n    if (value == NULL) {\n        return default_value;\n    }\n\n    /* taken from get_lastlog_uid_max() */\n    ep = value + strlen(value);\n    while (ep > value && isspace(*(--ep))) {\n        *ep = '\\0';\n    }\n\n    errno = 0;\n    ul = strtoul(value, &ep, 10);\n    if (!(ul >= MAX_UID_VALUE\n        || (uid_t)ul >= MAX_UID_VALUE\n        || (errno != 0 && ul == 0)\n        || value == ep\n        || *ep != '\\0')) {\n        uid = (uid_t)ul;\n    } else {\n        uid = default_value;\n    }\n\n    free(value);\n\n    return uid;\n}"
        }
      },
      {
        "call_info": {
          "callee": "pam_syslog",
          "args": [
            "pamh",
            "LOG_WARNING",
            "\"invalid uid\""
          ],
          "line": 200
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <security/pam_ext.h>\n#include <security/pam_modutil.h>\n#include <security/pam_modules.h>\n#include <errno.h>\n#include <ctype.h>\n#include <pwd.h>\n#include <unistd.h>\n#include <syslog.h>\n#include <string.h>\n#include <stdlib.h>\n#include <sys/types.h>\n#include \"config.h\"\n\nstatic int\npam_usertype_is_system(pam_handle_t *pamh, uid_t uid)\n{\n    uid_t uid_min;\n    uid_t sys_max;\n\n    if (uid == (uid_t)-1) {\n        pam_syslog(pamh, LOG_WARNING, \"invalid uid\");\n        return PAM_USER_UNKNOWN;\n    }\n\n    if (uid == PAM_USERTYPE_OVERFLOW_UID) {\n        /* nobody */\n        return PAM_SUCCESS;\n    }\n\n    uid_min = pam_usertype_get_id(pamh, \"UID_MIN\", PAM_USERTYPE_UIDMIN);\n    sys_max = pam_usertype_get_id(pamh, \"SYS_UID_MAX\", uid_min - 1);\n\n    if (uid <= sys_max && uid < uid_min) {\n        return PAM_SUCCESS;\n    }\n\n    return PAM_AUTH_ERR;\n}"
  },
  {
    "function_name": "pam_usertype_get_id",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2022-28321/repo/modules/pam_usertype/pam_usertype.c",
    "lines": "155-191",
    "snippet": "static uid_t\npam_usertype_get_id(pam_handle_t *pamh,\n                    const char *key,\n                    uid_t default_value)\n{\n    unsigned long ul;\n    char *value;\n    char *ep;\n    uid_t uid;\n\n    value = pam_modutil_search_key(pamh, LOGIN_DEFS, key);\n    if (value == NULL) {\n        return default_value;\n    }\n\n    /* taken from get_lastlog_uid_max() */\n    ep = value + strlen(value);\n    while (ep > value && isspace(*(--ep))) {\n        *ep = '\\0';\n    }\n\n    errno = 0;\n    ul = strtoul(value, &ep, 10);\n    if (!(ul >= MAX_UID_VALUE\n        || (uid_t)ul >= MAX_UID_VALUE\n        || (errno != 0 && ul == 0)\n        || value == ep\n        || *ep != '\\0')) {\n        uid = (uid_t)ul;\n    } else {\n        uid = default_value;\n    }\n\n    free(value);\n\n    return uid;\n}",
    "includes": [
      "#include <security/pam_ext.h>",
      "#include <security/pam_modutil.h>",
      "#include <security/pam_modules.h>",
      "#include <errno.h>",
      "#include <ctype.h>",
      "#include <pwd.h>",
      "#include <unistd.h>",
      "#include <syslog.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <sys/types.h>",
      "#include \"config.h\""
    ],
    "macros_used": [
      "#define MAX_UID_VALUE 0xFFFFFFFFUL",
      "#define LOGIN_DEFS \"/etc/login.defs\""
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "value"
          ],
          "line": 188
        },
        "resolved": true,
        "details": {
          "function_name": "free_module_data",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2022-28321/repo/modules/pam_selinux/pam_selinux.c",
          "lines": "386-398",
          "snippet": "static void\nfree_module_data(module_data_t *data)\n{\n  free(data->tty_path);\n  freecon(data->prev_tty_context);\n  freecon(data->tty_context);\n  freecon(data->default_user_context);\n  freecon(data->prev_exec_context);\n  if (data->exec_context != data->default_user_context)\n    freecon(data->exec_context);\n  memset(data, 0, sizeof(*data));\n  free(data);\n}",
          "includes": [
            "#include <sys/select.h>",
            "#include <libaudit.h>",
            "#include <selinux/get_default_type.h>",
            "#include <selinux/context.h>",
            "#include <selinux/get_context_list.h>",
            "#include <selinux/selinux.h>",
            "#include \"pam_inline.h\"",
            "#include <security/pam_ext.h>",
            "#include <security/pam_modutil.h>",
            "#include <security/_pam_macros.h>",
            "#include <security/pam_modules.h>",
            "#include <syslog.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <pwd.h>",
            "#include <limits.h>",
            "#include <errno.h>",
            "#include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <sys/select.h>\n#include <libaudit.h>\n#include <selinux/get_default_type.h>\n#include <selinux/context.h>\n#include <selinux/get_context_list.h>\n#include <selinux/selinux.h>\n#include \"pam_inline.h\"\n#include <security/pam_ext.h>\n#include <security/pam_modutil.h>\n#include <security/_pam_macros.h>\n#include <security/pam_modules.h>\n#include <syslog.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <limits.h>\n#include <errno.h>\n#include \"config.h\"\n\nstatic void\nfree_module_data(module_data_t *data)\n{\n  free(data->tty_path);\n  freecon(data->prev_tty_context);\n  freecon(data->tty_context);\n  freecon(data->default_user_context);\n  freecon(data->prev_exec_context);\n  if (data->exec_context != data->default_user_context)\n    freecon(data->exec_context);\n  memset(data, 0, sizeof(*data));\n  free(data);\n}"
        }
      },
      {
        "call_info": {
          "callee": "strtoul",
          "args": [
            "value",
            "&ep",
            "10"
          ],
          "line": 177
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "isspace",
          "args": [
            "*(--ep)"
          ],
          "line": 172
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "value"
          ],
          "line": 171
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pam_modutil_search_key",
          "args": [
            "pamh",
            "LOGIN_DEFS",
            "key"
          ],
          "line": 165
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <security/pam_ext.h>\n#include <security/pam_modutil.h>\n#include <security/pam_modules.h>\n#include <errno.h>\n#include <ctype.h>\n#include <pwd.h>\n#include <unistd.h>\n#include <syslog.h>\n#include <string.h>\n#include <stdlib.h>\n#include <sys/types.h>\n#include \"config.h\"\n\n#define MAX_UID_VALUE 0xFFFFFFFFUL\n#define LOGIN_DEFS \"/etc/login.defs\"\n\nstatic uid_t\npam_usertype_get_id(pam_handle_t *pamh,\n                    const char *key,\n                    uid_t default_value)\n{\n    unsigned long ul;\n    char *value;\n    char *ep;\n    uid_t uid;\n\n    value = pam_modutil_search_key(pamh, LOGIN_DEFS, key);\n    if (value == NULL) {\n        return default_value;\n    }\n\n    /* taken from get_lastlog_uid_max() */\n    ep = value + strlen(value);\n    while (ep > value && isspace(*(--ep))) {\n        *ep = '\\0';\n    }\n\n    errno = 0;\n    ul = strtoul(value, &ep, 10);\n    if (!(ul >= MAX_UID_VALUE\n        || (uid_t)ul >= MAX_UID_VALUE\n        || (errno != 0 && ul == 0)\n        || value == ep\n        || *ep != '\\0')) {\n        uid = (uid_t)ul;\n    } else {\n        uid = default_value;\n    }\n\n    free(value);\n\n    return uid;\n}"
  },
  {
    "function_name": "pam_usertype_get_uid",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2022-28321/repo/modules/pam_usertype/pam_usertype.c",
    "lines": "104-151",
    "snippet": "static int\npam_usertype_get_uid(struct pam_usertype_opts *opts,\n                     pam_handle_t *pamh,\n                     uid_t *_uid)\n{\n    struct passwd *pwd;\n    const char *username;\n    int ret;\n\n    /* Get uid of user that runs the application. */\n    if (opts->use_uid) {\n        pwd = pam_modutil_getpwuid(pamh, getuid());\n        if (pwd == NULL) {\n            pam_syslog(pamh, LOG_ERR,\n                       \"error retrieving information about user %lu\",\n                       (unsigned long)getuid());\n            return PAM_USER_UNKNOWN;\n        }\n\n        *_uid = pwd->pw_uid;\n        return PAM_SUCCESS;\n    }\n\n    /* Get uid of user that is being authenticated. */\n    ret = pam_get_user(pamh, &username, NULL);\n    if (ret != PAM_SUCCESS) {\n        pam_syslog(pamh, LOG_NOTICE, \"cannot determine user name: %s\",\n                   pam_strerror(pamh, ret));\n        return ret == PAM_CONV_AGAIN ? PAM_INCOMPLETE : ret;\n    }\n\n    pwd = pam_modutil_getpwnam(pamh, username);\n    if (pwd == NULL) {\n        if (opts->audit) {\n            pam_syslog(pamh, LOG_NOTICE,\n                       \"error retrieving information about user %s\", username);\n        }\n\n        pam_modutil_getpwnam(pamh, \"root\");\n\n        return PAM_USER_UNKNOWN;\n    }\n    pam_modutil_getpwnam(pamh, \"pam_usertype_non_existent:\");\n\n    *_uid = pwd->pw_uid;\n\n    return PAM_SUCCESS;\n}",
    "includes": [
      "#include <security/pam_ext.h>",
      "#include <security/pam_modutil.h>",
      "#include <security/pam_modules.h>",
      "#include <errno.h>",
      "#include <ctype.h>",
      "#include <pwd.h>",
      "#include <unistd.h>",
      "#include <syslog.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <sys/types.h>",
      "#include \"config.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "pam_modutil_getpwnam",
          "args": [
            "pamh",
            "\"pam_usertype_non_existent:\""
          ],
          "line": 146
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pam_modutil_getpwnam",
          "args": [
            "pamh",
            "\"root\""
          ],
          "line": 142
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pam_syslog",
          "args": [
            "pamh",
            "LOG_NOTICE",
            "\"error retrieving information about user %s\"",
            "username"
          ],
          "line": 138
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pam_modutil_getpwnam",
          "args": [
            "pamh",
            "username"
          ],
          "line": 135
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pam_syslog",
          "args": [
            "pamh",
            "LOG_NOTICE",
            "\"cannot determine user name: %s\"",
            "pam_strerror(pamh, ret)"
          ],
          "line": 130
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pam_strerror",
          "args": [
            "pamh",
            "ret"
          ],
          "line": 131
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pam_get_user",
          "args": [
            "pamh",
            "&username",
            "NULL"
          ],
          "line": 128
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pam_syslog",
          "args": [
            "pamh",
            "LOG_ERR",
            "\"error retrieving information about user %lu\"",
            "(unsigned long)getuid()"
          ],
          "line": 117
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "getuid",
          "args": [],
          "line": 119
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pam_modutil_getpwuid",
          "args": [
            "pamh",
            "getuid()"
          ],
          "line": 115
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "getuid",
          "args": [],
          "line": 115
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <security/pam_ext.h>\n#include <security/pam_modutil.h>\n#include <security/pam_modules.h>\n#include <errno.h>\n#include <ctype.h>\n#include <pwd.h>\n#include <unistd.h>\n#include <syslog.h>\n#include <string.h>\n#include <stdlib.h>\n#include <sys/types.h>\n#include \"config.h\"\n\nstatic int\npam_usertype_get_uid(struct pam_usertype_opts *opts,\n                     pam_handle_t *pamh,\n                     uid_t *_uid)\n{\n    struct passwd *pwd;\n    const char *username;\n    int ret;\n\n    /* Get uid of user that runs the application. */\n    if (opts->use_uid) {\n        pwd = pam_modutil_getpwuid(pamh, getuid());\n        if (pwd == NULL) {\n            pam_syslog(pamh, LOG_ERR,\n                       \"error retrieving information about user %lu\",\n                       (unsigned long)getuid());\n            return PAM_USER_UNKNOWN;\n        }\n\n        *_uid = pwd->pw_uid;\n        return PAM_SUCCESS;\n    }\n\n    /* Get uid of user that is being authenticated. */\n    ret = pam_get_user(pamh, &username, NULL);\n    if (ret != PAM_SUCCESS) {\n        pam_syslog(pamh, LOG_NOTICE, \"cannot determine user name: %s\",\n                   pam_strerror(pamh, ret));\n        return ret == PAM_CONV_AGAIN ? PAM_INCOMPLETE : ret;\n    }\n\n    pwd = pam_modutil_getpwnam(pamh, username);\n    if (pwd == NULL) {\n        if (opts->audit) {\n            pam_syslog(pamh, LOG_NOTICE,\n                       \"error retrieving information about user %s\", username);\n        }\n\n        pam_modutil_getpwnam(pamh, \"root\");\n\n        return PAM_USER_UNKNOWN;\n    }\n    pam_modutil_getpwnam(pamh, \"pam_usertype_non_existent:\");\n\n    *_uid = pwd->pw_uid;\n\n    return PAM_SUCCESS;\n}"
  },
  {
    "function_name": "pam_usertype_parse_args",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2022-28321/repo/modules/pam_usertype/pam_usertype.c",
    "lines": "70-102",
    "snippet": "static int\npam_usertype_parse_args(struct pam_usertype_opts *opts,\n                        pam_handle_t *pamh,\n                        int argc,\n                        const char **argv)\n{\n    int i;\n\n    memset(opts, 0, sizeof(struct pam_usertype_opts));\n    opts->op = OP_SENTINEL;\n\n    for (i = 0; i < argc; i++) {\n        if (strcmp(argv[i], \"use_uid\") == 0) {\n            opts->use_uid = 1;\n        } else if (strcmp(argv[i], \"audit\") == 0) {\n            opts->audit = 1;\n        } else if (strcmp(argv[i], \"issystem\") == 0) {\n            opts->op = OP_IS_SYSTEM;\n        } else if (strcmp(argv[i], \"isregular\") == 0) {\n            opts->op = OP_IS_REGULAR;\n        } else {\n            pam_syslog(pamh, LOG_WARNING, \"Unknown argument: %s\", argv[i]);\n            /* Just continue. */\n        }\n    }\n\n    if (opts->op == OP_SENTINEL) {\n        pam_syslog(pamh, LOG_ERR, \"Operation not specified\");\n        return PAM_SERVICE_ERR;\n    }\n\n    return PAM_SUCCESS;\n}",
    "includes": [
      "#include <security/pam_ext.h>",
      "#include <security/pam_modutil.h>",
      "#include <security/pam_modules.h>",
      "#include <errno.h>",
      "#include <ctype.h>",
      "#include <pwd.h>",
      "#include <unistd.h>",
      "#include <syslog.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <sys/types.h>",
      "#include \"config.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "pam_syslog",
          "args": [
            "pamh",
            "LOG_ERR",
            "\"Operation not specified\""
          ],
          "line": 97
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pam_syslog",
          "args": [
            "pamh",
            "LOG_WARNING",
            "\"Unknown argument: %s\"",
            "argv[i]"
          ],
          "line": 91
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "argv[i]",
            "\"isregular\""
          ],
          "line": 88
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "argv[i]",
            "\"issystem\""
          ],
          "line": 86
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "argv[i]",
            "\"audit\""
          ],
          "line": 84
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "argv[i]",
            "\"use_uid\""
          ],
          "line": 82
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memset",
          "args": [
            "opts",
            "0",
            "sizeof(struct pam_usertype_opts)"
          ],
          "line": 78
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <security/pam_ext.h>\n#include <security/pam_modutil.h>\n#include <security/pam_modules.h>\n#include <errno.h>\n#include <ctype.h>\n#include <pwd.h>\n#include <unistd.h>\n#include <syslog.h>\n#include <string.h>\n#include <stdlib.h>\n#include <sys/types.h>\n#include \"config.h\"\n\nstatic int\npam_usertype_parse_args(struct pam_usertype_opts *opts,\n                        pam_handle_t *pamh,\n                        int argc,\n                        const char **argv)\n{\n    int i;\n\n    memset(opts, 0, sizeof(struct pam_usertype_opts));\n    opts->op = OP_SENTINEL;\n\n    for (i = 0; i < argc; i++) {\n        if (strcmp(argv[i], \"use_uid\") == 0) {\n            opts->use_uid = 1;\n        } else if (strcmp(argv[i], \"audit\") == 0) {\n            opts->audit = 1;\n        } else if (strcmp(argv[i], \"issystem\") == 0) {\n            opts->op = OP_IS_SYSTEM;\n        } else if (strcmp(argv[i], \"isregular\") == 0) {\n            opts->op = OP_IS_REGULAR;\n        } else {\n            pam_syslog(pamh, LOG_WARNING, \"Unknown argument: %s\", argv[i]);\n            /* Just continue. */\n        }\n    }\n\n    if (opts->op == OP_SENTINEL) {\n        pam_syslog(pamh, LOG_ERR, \"Operation not specified\");\n        return PAM_SERVICE_ERR;\n    }\n\n    return PAM_SUCCESS;\n}"
  }
]