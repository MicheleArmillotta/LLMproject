[
  {
    "function_name": "getuidname",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2022-28321/repo/modules/pam_unix/passverify.c",
    "lines": "1157-1171",
    "snippet": "char *\ngetuidname(uid_t uid)\n{\n        struct passwd *pw;\n        static char username[256];\n\n        pw = getpwuid(uid);\n        if (pw == NULL)\n                return NULL;\n\n        strncpy(username, pw->pw_name, sizeof(username));\n        username[sizeof(username) - 1] = '\\0';\n\n        return username;\n}",
    "includes": [
      "# include \"./lckpwdf.-c\"",
      "#include <security/pam_ext.h>",
      "#include <security/pam_modutil.h>",
      "#include <selinux/selinux.h>",
      "#include \"passverify.h\"",
      "#include \"bigcrypt.h\"",
      "#include \"md5.h\"",
      "#include \"pam_inline.h\"",
      "#include \"pam_cc_compat.h\"",
      "#include <crypt.h>",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <sys/time.h>",
      "#include <time.h>",
      "#include <errno.h>",
      "#include <signal.h>",
      "#include <stdarg.h>",
      "#include <syslog.h>",
      "#include <shadow.h>",
      "#include <pwd.h>",
      "#include <unistd.h>",
      "#include <sys/types.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include \"support.h\"",
      "#include <security/pam_modules.h>",
      "#include <security/_pam_macros.h>",
      "#include \"config.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "strncpy",
          "args": [
            "username",
            "pw->pw_name",
            "sizeof(username)"
          ],
          "line": 1167
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "getpwuid",
          "args": [
            "uid"
          ],
          "line": 1163
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "# include \"./lckpwdf.-c\"\n#include <security/pam_ext.h>\n#include <security/pam_modutil.h>\n#include <selinux/selinux.h>\n#include \"passverify.h\"\n#include \"bigcrypt.h\"\n#include \"md5.h\"\n#include \"pam_inline.h\"\n#include \"pam_cc_compat.h\"\n#include <crypt.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/time.h>\n#include <time.h>\n#include <errno.h>\n#include <signal.h>\n#include <stdarg.h>\n#include <syslog.h>\n#include <shadow.h>\n#include <pwd.h>\n#include <unistd.h>\n#include <sys/types.h>\n#include <string.h>\n#include <stdio.h>\n#include \"support.h\"\n#include <security/pam_modules.h>\n#include <security/_pam_macros.h>\n#include \"config.h\"\n\nchar *\ngetuidname(uid_t uid)\n{\n        struct passwd *pw;\n        static char username[256];\n\n        pw = getpwuid(uid);\n        if (pw == NULL)\n                return NULL;\n\n        strncpy(username, pw->pw_name, sizeof(username));\n        username[sizeof(username) - 1] = '\\0';\n\n        return username;\n}"
  },
  {
    "function_name": "setup_signals",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2022-28321/repo/modules/pam_unix/passverify.c",
    "lines": "1132-1155",
    "snippet": "void\nsetup_signals(void)\n{\n        struct sigaction action;        /* posix signal structure */\n\n        /*\n         * Setup signal handlers\n         */\n        (void) memset((void *) &action, 0, sizeof(action));\n        action.sa_handler = su_sighandler;\n#ifdef SA_RESETHAND\n        action.sa_flags = SA_RESETHAND;\n#endif\n        (void) sigaction(SIGILL, &action, NULL);\n        (void) sigaction(SIGTRAP, &action, NULL);\n        (void) sigaction(SIGBUS, &action, NULL);\n        (void) sigaction(SIGSEGV, &action, NULL);\n        action.sa_handler = SIG_IGN;\n        action.sa_flags = 0;\n        (void) sigaction(SIGTERM, &action, NULL);\n        (void) sigaction(SIGHUP, &action, NULL);\n        (void) sigaction(SIGINT, &action, NULL);\n        (void) sigaction(SIGQUIT, &action, NULL);\n}",
    "includes": [
      "# include \"./lckpwdf.-c\"",
      "#include <security/pam_ext.h>",
      "#include <security/pam_modutil.h>",
      "#include <selinux/selinux.h>",
      "#include \"passverify.h\"",
      "#include \"bigcrypt.h\"",
      "#include \"md5.h\"",
      "#include \"pam_inline.h\"",
      "#include \"pam_cc_compat.h\"",
      "#include <crypt.h>",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <sys/time.h>",
      "#include <time.h>",
      "#include <errno.h>",
      "#include <signal.h>",
      "#include <stdarg.h>",
      "#include <syslog.h>",
      "#include <shadow.h>",
      "#include <pwd.h>",
      "#include <unistd.h>",
      "#include <sys/types.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include \"support.h\"",
      "#include <security/pam_modules.h>",
      "#include <security/_pam_macros.h>",
      "#include \"config.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "sigaction",
          "args": [
            "SIGQUIT",
            "&action",
            "NULL"
          ],
          "line": 1154
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sigaction",
          "args": [
            "SIGINT",
            "&action",
            "NULL"
          ],
          "line": 1153
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sigaction",
          "args": [
            "SIGHUP",
            "&action",
            "NULL"
          ],
          "line": 1152
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sigaction",
          "args": [
            "SIGTERM",
            "&action",
            "NULL"
          ],
          "line": 1151
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sigaction",
          "args": [
            "SIGSEGV",
            "&action",
            "NULL"
          ],
          "line": 1148
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sigaction",
          "args": [
            "SIGBUS",
            "&action",
            "NULL"
          ],
          "line": 1147
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sigaction",
          "args": [
            "SIGTRAP",
            "&action",
            "NULL"
          ],
          "line": 1146
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sigaction",
          "args": [
            "SIGILL",
            "&action",
            "NULL"
          ],
          "line": 1145
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memset",
          "args": [
            "(void *) &action",
            "0",
            "sizeof(action)"
          ],
          "line": 1140
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "# include \"./lckpwdf.-c\"\n#include <security/pam_ext.h>\n#include <security/pam_modutil.h>\n#include <selinux/selinux.h>\n#include \"passverify.h\"\n#include \"bigcrypt.h\"\n#include \"md5.h\"\n#include \"pam_inline.h\"\n#include \"pam_cc_compat.h\"\n#include <crypt.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/time.h>\n#include <time.h>\n#include <errno.h>\n#include <signal.h>\n#include <stdarg.h>\n#include <syslog.h>\n#include <shadow.h>\n#include <pwd.h>\n#include <unistd.h>\n#include <sys/types.h>\n#include <string.h>\n#include <stdio.h>\n#include \"support.h\"\n#include <security/pam_modules.h>\n#include <security/_pam_macros.h>\n#include \"config.h\"\n\nvoid\nsetup_signals(void)\n{\n        struct sigaction action;        /* posix signal structure */\n\n        /*\n         * Setup signal handlers\n         */\n        (void) memset((void *) &action, 0, sizeof(action));\n        action.sa_handler = su_sighandler;\n#ifdef SA_RESETHAND\n        action.sa_flags = SA_RESETHAND;\n#endif\n        (void) sigaction(SIGILL, &action, NULL);\n        (void) sigaction(SIGTRAP, &action, NULL);\n        (void) sigaction(SIGBUS, &action, NULL);\n        (void) sigaction(SIGSEGV, &action, NULL);\n        action.sa_handler = SIG_IGN;\n        action.sa_flags = 0;\n        (void) sigaction(SIGTERM, &action, NULL);\n        (void) sigaction(SIGHUP, &action, NULL);\n        (void) sigaction(SIGINT, &action, NULL);\n        (void) sigaction(SIGQUIT, &action, NULL);\n}"
  },
  {
    "function_name": "helper_verify_password",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2022-28321/repo/modules/pam_unix/passverify.c",
    "lines": "1070-1100",
    "snippet": "int\nhelper_verify_password(const char *name, const char *p, int nullok)\n{\n\tstruct passwd *pwd = NULL;\n\tchar *hash = NULL;\n\tint retval;\n\n\tretval = get_pwd_hash(name, &pwd, &hash);\n\n\tif (pwd == NULL || hash == NULL) {\n\t\thelper_log_err(LOG_NOTICE, \"check pass; user unknown\");\n\t\tretval = PAM_USER_UNKNOWN;\n\t} else if (p[0] == '\\0' && nullok) {\n\t\tif (hash[0] == '\\0') {\n\t\t\tretval = PAM_SUCCESS;\n\t\t} else {\n\t\t\tretval = PAM_AUTH_ERR;\n\t\t}\n\t} else {\n\t\tretval = verify_pwd_hash(p, hash, nullok);\n\t}\n\n\tif (hash) {\n\t\t_pam_overwrite(hash);\n\t\t_pam_drop(hash);\n\t}\n\n\tp = NULL;\t\t/* no longer needed here */\n\n\treturn retval;\n}",
    "includes": [
      "# include \"./lckpwdf.-c\"",
      "#include <security/pam_ext.h>",
      "#include <security/pam_modutil.h>",
      "#include <selinux/selinux.h>",
      "#include \"passverify.h\"",
      "#include \"bigcrypt.h\"",
      "#include \"md5.h\"",
      "#include \"pam_inline.h\"",
      "#include \"pam_cc_compat.h\"",
      "#include <crypt.h>",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <sys/time.h>",
      "#include <time.h>",
      "#include <errno.h>",
      "#include <signal.h>",
      "#include <stdarg.h>",
      "#include <syslog.h>",
      "#include <shadow.h>",
      "#include <pwd.h>",
      "#include <unistd.h>",
      "#include <sys/types.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include \"support.h\"",
      "#include <security/pam_modules.h>",
      "#include <security/_pam_macros.h>",
      "#include \"config.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "int retval;",
      "PAMH_ARG_DECL(int get_account_info,\n\tconst char *name, struct passwd **pwd, struct spwd **spwdent)\n{\n\t/* UNIX passwords area */\n\t*pwd = pam_modutil_getpwnam(pamh, name);",
      "PAMH_ARG_DECL(int get_pwd_hash,\n\tconst char *name, struct passwd **pwd, char **hash)\n{\n\tint retval;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "_pam_drop",
          "args": [
            "hash"
          ],
          "line": 1094
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_pam_overwrite",
          "args": [
            "hash"
          ],
          "line": 1093
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "verify_pwd_hash",
          "args": [
            "p",
            "hash",
            "nullok"
          ],
          "line": 1089
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "helper_log_err",
          "args": [
            "LOG_NOTICE",
            "\"check pass; user unknown\""
          ],
          "line": 1080
        },
        "resolved": true,
        "details": {
          "function_name": "helper_log_err",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2022-28321/repo/modules/pam_pwhistory/opasswd.c",
          "lines": "91-101",
          "snippet": "void\nhelper_log_err(int err, const char *format, ...)\n{\n  va_list args;\n\n  va_start(args, format);\n  openlog(HELPER_COMPILE, LOG_CONS | LOG_PID, LOG_AUTHPRIV);\n  vsyslog(err, format, args);\n  va_end(args);\n  closelog();\n}",
          "includes": [
            "#include \"opasswd.h\"",
            "#include <security/pam_modules.h>",
            "#include <security/pam_ext.h>",
            "#include <security/pam_modutil.h>",
            "#include <crypt.h>",
            "#include <sys/stat.h>",
            "#include <stdarg.h>",
            "#include <syslog.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdio.h>",
            "#include <limits.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <ctype.h>",
            "#include <time.h>",
            "#include <shadow.h>",
            "#include <pwd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"opasswd.h\"\n#include <security/pam_modules.h>\n#include <security/pam_ext.h>\n#include <security/pam_modutil.h>\n#include <crypt.h>\n#include <sys/stat.h>\n#include <stdarg.h>\n#include <syslog.h>\n#include <stdlib.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <limits.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <ctype.h>\n#include <time.h>\n#include <shadow.h>\n#include <pwd.h>\n#include <config.h>\n\nvoid\nhelper_log_err(int err, const char *format, ...)\n{\n  va_list args;\n\n  va_start(args, format);\n  openlog(HELPER_COMPILE, LOG_CONS | LOG_PID, LOG_AUTHPRIV);\n  vsyslog(err, format, args);\n  va_end(args);\n  closelog();\n}"
        }
      },
      {
        "call_info": {
          "callee": "get_pwd_hash",
          "args": [
            "name",
            "&pwd",
            "&hash"
          ],
          "line": 1077
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "# include \"./lckpwdf.-c\"\n#include <security/pam_ext.h>\n#include <security/pam_modutil.h>\n#include <selinux/selinux.h>\n#include \"passverify.h\"\n#include \"bigcrypt.h\"\n#include \"md5.h\"\n#include \"pam_inline.h\"\n#include \"pam_cc_compat.h\"\n#include <crypt.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/time.h>\n#include <time.h>\n#include <errno.h>\n#include <signal.h>\n#include <stdarg.h>\n#include <syslog.h>\n#include <shadow.h>\n#include <pwd.h>\n#include <unistd.h>\n#include <sys/types.h>\n#include <string.h>\n#include <stdio.h>\n#include \"support.h\"\n#include <security/pam_modules.h>\n#include <security/_pam_macros.h>\n#include \"config.h\"\n\nint retval;\nPAMH_ARG_DECL(int get_account_info,\n\tconst char *name, struct passwd **pwd, struct spwd **spwdent)\n{\n\t/* UNIX passwords area */\n\t*pwd = pam_modutil_getpwnam(pamh, name);\nPAMH_ARG_DECL(int get_pwd_hash,\n\tconst char *name, struct passwd **pwd, char **hash)\n{\n\tint retval;\n\nint\nhelper_verify_password(const char *name, const char *p, int nullok)\n{\n\tstruct passwd *pwd = NULL;\n\tchar *hash = NULL;\n\tint retval;\n\n\tretval = get_pwd_hash(name, &pwd, &hash);\n\n\tif (pwd == NULL || hash == NULL) {\n\t\thelper_log_err(LOG_NOTICE, \"check pass; user unknown\");\n\t\tretval = PAM_USER_UNKNOWN;\n\t} else if (p[0] == '\\0' && nullok) {\n\t\tif (hash[0] == '\\0') {\n\t\t\tretval = PAM_SUCCESS;\n\t\t} else {\n\t\t\tretval = PAM_AUTH_ERR;\n\t\t}\n\t} else {\n\t\tretval = verify_pwd_hash(p, hash, nullok);\n\t}\n\n\tif (hash) {\n\t\t_pam_overwrite(hash);\n\t\t_pam_drop(hash);\n\t}\n\n\tp = NULL;\t\t/* no longer needed here */\n\n\treturn retval;\n}"
  },
  {
    "function_name": "save_old_password",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2022-28321/repo/modules/pam_unix/passverify.c",
    "lines": "619-796",
    "snippet": "int\nsave_old_password(pam_handle_t *pamh, const char *forwho, const char *oldpass,\n\t\t  int howmany)\n#endif\n{\n    static char buf[16384];\n    static char nbuf[16384];\n    char *s_luser, *s_uid, *s_npas, *s_pas, *pass;\n    int npas;\n    FILE *pwfile, *opwfile;\n    int err = 0;\n    int oldmask;\n    int found = 0;\n    struct passwd *pwd = NULL;\n    struct stat st;\n    size_t len = strlen(forwho);\n#ifdef WITH_SELINUX\n    char *prev_context_raw = NULL;\n#endif\n\n    if (howmany < 0) {\n\treturn PAM_SUCCESS;\n    }\n\n    if (oldpass == NULL) {\n\treturn PAM_SUCCESS;\n    }\n\n    oldmask = umask(077);\n\n#ifdef WITH_SELINUX\n    if (SELINUX_ENABLED) {\n      char *passwd_context_raw = NULL;\n      if (getfilecon_raw(\"/etc/passwd\",&passwd_context_raw)<0) {\n        return PAM_AUTHTOK_ERR;\n      };\n      if (getfscreatecon_raw(&prev_context_raw)<0) {\n        freecon(passwd_context_raw);\n        return PAM_AUTHTOK_ERR;\n      }\n      if (setfscreatecon_raw(passwd_context_raw)) {\n        freecon(passwd_context_raw);\n        freecon(prev_context_raw);\n        return PAM_AUTHTOK_ERR;\n      }\n      freecon(passwd_context_raw);\n    }\n#endif\n    pwfile = fopen(OPW_TMPFILE, \"w\");\n    umask(oldmask);\n    if (pwfile == NULL) {\n      err = 1;\n      goto done;\n    }\n\n    opwfile = fopen(OLD_PASSWORDS_FILE, \"r\");\n    if (opwfile == NULL) {\n\tfclose(pwfile);\n      err = 1;\n      goto done;\n    }\n\n    if (fstat(fileno(opwfile), &st) == -1) {\n\tfclose(opwfile);\n\tfclose(pwfile);\n\terr = 1;\n\tgoto done;\n    }\n\n    if (fchown(fileno(pwfile), st.st_uid, st.st_gid) == -1) {\n\tfclose(opwfile);\n\tfclose(pwfile);\n\terr = 1;\n\tgoto done;\n    }\n    if (fchmod(fileno(pwfile), st.st_mode) == -1) {\n\tfclose(opwfile);\n\tfclose(pwfile);\n\terr = 1;\n\tgoto done;\n    }\n\n    while (fgets(buf, 16380, opwfile)) {\n\tif (!strncmp(buf, forwho, len) && strchr(\":,\\n\", buf[len]) != NULL) {\n\t    char *sptr = NULL;\n\t    found = 1;\n\t    if (howmany == 0)\n\t\tcontinue;\n\t    buf[strlen(buf) - 1] = '\\0';\n\t    s_luser = strtok_r(buf, \":\", &sptr);\n\t    if (s_luser == NULL) {\n\t\tfound = 0;\n\t\tcontinue;\n\t    }\n\t    s_uid = strtok_r(NULL, \":\", &sptr);\n\t    if (s_uid == NULL) {\n\t\tfound = 0;\n\t\tcontinue;\n\t    }\n\t    s_npas = strtok_r(NULL, \":\", &sptr);\n\t    if (s_npas == NULL) {\n\t\tfound = 0;\n\t\tcontinue;\n\t    }\n\t    s_pas = strtok_r(NULL, \":\", &sptr);\n\t    npas = strtol(s_npas, NULL, 10) + 1;\n\t    while (npas > howmany && s_pas != NULL) {\n\t\ts_pas = strpbrk(s_pas, \",\");\n\t\tif (s_pas != NULL)\n\t\t    s_pas++;\n\t\tnpas--;\n\t    }\n\t    pass = crypt_md5_wrapper(oldpass);\n\t    if (s_pas == NULL)\n\t\tsnprintf(nbuf, sizeof(nbuf), \"%s:%s:%d:%s\\n\",\n\t\t\t s_luser, s_uid, npas, pass);\n\t    else\n\t\tsnprintf(nbuf, sizeof(nbuf),\"%s:%s:%d:%s,%s\\n\",\n\t\t\t s_luser, s_uid, npas, s_pas, pass);\n\t    _pam_delete(pass);\n\t    if (fputs(nbuf, pwfile) < 0) {\n\t\terr = 1;\n\t\tbreak;\n\t    }\n\t} else if (fputs(buf, pwfile) < 0) {\n\t    err = 1;\n\t    break;\n\t}\n    }\n    fclose(opwfile);\n\n    if (!found) {\n\tpwd = pam_modutil_getpwnam(pamh, forwho);\n\tif (pwd == NULL) {\n\t    err = 1;\n\t} else {\n\t    pass = crypt_md5_wrapper(oldpass);\n\t    snprintf(nbuf, sizeof(nbuf), \"%s:%lu:1:%s\\n\",\n\t\t     forwho, (unsigned long)pwd->pw_uid, pass);\n\t    _pam_delete(pass);\n\t    if (fputs(nbuf, pwfile) < 0) {\n\t\terr = 1;\n\t    }\n\t}\n    }\n\n    if (fflush(pwfile) || fsync(fileno(pwfile))) {\n\tD((\"fflush or fsync error writing entries to old passwords file: %m\"));\n\terr = 1;\n    }\n\n    if (fclose(pwfile)) {\n\tD((\"fclose error writing entries to old passwords file: %m\"));\n\terr = 1;\n    }\n\ndone:\n    if (!err) {\n\tif (rename(OPW_TMPFILE, OLD_PASSWORDS_FILE))\n\t    err = 1;\n    }\n#ifdef WITH_SELINUX\n    if (SELINUX_ENABLED) {\n      if (setfscreatecon_raw(prev_context_raw)) {\n        err = 1;\n      }\n      if (prev_context_raw)\n        freecon(prev_context_raw);\n      prev_context_raw = NULL;\n    }\n#endif\n    if (!err) {\n\treturn PAM_SUCCESS;\n    } else {\n\tunlink(OPW_TMPFILE);\n\treturn PAM_AUTHTOK_ERR;\n    }\n}",
    "includes": [
      "# include \"./lckpwdf.-c\"",
      "#include <security/pam_ext.h>",
      "#include <security/pam_modutil.h>",
      "#include <selinux/selinux.h>",
      "#include \"passverify.h\"",
      "#include \"bigcrypt.h\"",
      "#include \"md5.h\"",
      "#include \"pam_inline.h\"",
      "#include \"pam_cc_compat.h\"",
      "#include <crypt.h>",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <sys/time.h>",
      "#include <time.h>",
      "#include <errno.h>",
      "#include <signal.h>",
      "#include <stdarg.h>",
      "#include <syslog.h>",
      "#include <shadow.h>",
      "#include <pwd.h>",
      "#include <unistd.h>",
      "#include <sys/types.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include \"support.h\"",
      "#include <security/pam_modules.h>",
      "#include <security/_pam_macros.h>",
      "#include \"config.h\""
    ],
    "macros_used": [
      "#define OPW_TMPFILE             SCONFIGDIR \"/nopasswd\"",
      "#define SELINUX_ENABLED 0",
      "#define SELINUX_ENABLED (is_selinux_enabled()>0)"
    ],
    "globals_used": [
      "PAMH_ARG_DECL(int get_account_info,\n\tconst char *name, struct passwd **pwd, struct spwd **spwdent)\n{\n\t/* UNIX passwords area */\n\t*pwd = pam_modutil_getpwnam(pamh, name);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "unlink",
          "args": [
            "OPW_TMPFILE"
          ],
          "line": 793
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "freecon",
          "args": [
            "prev_context_raw"
          ],
          "line": 786
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "setfscreatecon_raw",
          "args": [
            "prev_context_raw"
          ],
          "line": 782
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rename",
          "args": [
            "OPW_TMPFILE",
            "OLD_PASSWORDS_FILE"
          ],
          "line": 777
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "D",
          "args": [
            "(\"fclose error writing entries to old passwords file: %m\")"
          ],
          "line": 771
        },
        "resolved": true,
        "details": {
          "function_name": "MD5Name",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2022-28321/repo/modules/pam_unix/md5.c",
          "lines": "53-62",
          "snippet": "void MD5Name(MD5Init)(struct MD5Context *ctx)\n{\n\tctx->buf.i[0] = 0x67452301U;\n\tctx->buf.i[1] = 0xefcdab89U;\n\tctx->buf.i[2] = 0x98badcfeU;\n\tctx->buf.i[3] = 0x10325476U;\n\n\tctx->bits[0] = 0;\n\tctx->bits[1] = 0;\n}",
          "includes": [
            "#include \"md5.h\"",
            "#include <string.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"md5.h\"\n#include <string.h>\n\nvoid MD5Name(MD5Init)(struct MD5Context *ctx)\n{\n\tctx->buf.i[0] = 0x67452301U;\n\tctx->buf.i[1] = 0xefcdab89U;\n\tctx->buf.i[2] = 0x98badcfeU;\n\tctx->buf.i[3] = 0x10325476U;\n\n\tctx->bits[0] = 0;\n\tctx->bits[1] = 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "fclose",
          "args": [
            "pwfile"
          ],
          "line": 770
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fsync",
          "args": [
            "fileno(pwfile)"
          ],
          "line": 765
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fileno",
          "args": [
            "pwfile"
          ],
          "line": 765
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fflush",
          "args": [
            "pwfile"
          ],
          "line": 765
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fputs",
          "args": [
            "nbuf",
            "pwfile"
          ],
          "line": 759
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_pam_delete",
          "args": [
            "pass"
          ],
          "line": 758
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "snprintf",
          "args": [
            "nbuf",
            "sizeof(nbuf)",
            "\"%s:%lu:1:%s\\n\"",
            "forwho",
            "(unsigned long)pwd->pw_uid",
            "pass"
          ],
          "line": 756
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "crypt_md5_wrapper",
          "args": [
            "oldpass"
          ],
          "line": 755
        },
        "resolved": true,
        "details": {
          "function_name": "crypt_md5_wrapper",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2022-28321/repo/modules/pam_unix/passverify.c",
          "lines": "404-418",
          "snippet": "char *\ncrypt_md5_wrapper(const char *pass_new)\n{\n        unsigned char result[16];\n        char *cp = (char *) result;\n\n        cp = stpcpy(cp, \"$1$\");      /* magic for the MD5 */\n\tcrypt_make_salt(cp, 8);\n\n        /* no longer need cleartext */\n        cp = Goodcrypt_md5(pass_new, (const char *) result);\n\tpass_new = NULL;\n\n        return cp;\n}",
          "includes": [
            "# include \"./lckpwdf.-c\"",
            "#include <security/pam_ext.h>",
            "#include <security/pam_modutil.h>",
            "#include <selinux/selinux.h>",
            "#include \"passverify.h\"",
            "#include \"bigcrypt.h\"",
            "#include \"md5.h\"",
            "#include \"pam_inline.h\"",
            "#include \"pam_cc_compat.h\"",
            "#include <crypt.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/time.h>",
            "#include <time.h>",
            "#include <errno.h>",
            "#include <signal.h>",
            "#include <stdarg.h>",
            "#include <syslog.h>",
            "#include <shadow.h>",
            "#include <pwd.h>",
            "#include <unistd.h>",
            "#include <sys/types.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include \"support.h\"",
            "#include <security/pam_modules.h>",
            "#include <security/_pam_macros.h>",
            "#include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include \"./lckpwdf.-c\"\n#include <security/pam_ext.h>\n#include <security/pam_modutil.h>\n#include <selinux/selinux.h>\n#include \"passverify.h\"\n#include \"bigcrypt.h\"\n#include \"md5.h\"\n#include \"pam_inline.h\"\n#include \"pam_cc_compat.h\"\n#include <crypt.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/time.h>\n#include <time.h>\n#include <errno.h>\n#include <signal.h>\n#include <stdarg.h>\n#include <syslog.h>\n#include <shadow.h>\n#include <pwd.h>\n#include <unistd.h>\n#include <sys/types.h>\n#include <string.h>\n#include <stdio.h>\n#include \"support.h\"\n#include <security/pam_modules.h>\n#include <security/_pam_macros.h>\n#include \"config.h\"\n\nchar *\ncrypt_md5_wrapper(const char *pass_new)\n{\n        unsigned char result[16];\n        char *cp = (char *) result;\n\n        cp = stpcpy(cp, \"$1$\");      /* magic for the MD5 */\n\tcrypt_make_salt(cp, 8);\n\n        /* no longer need cleartext */\n        cp = Goodcrypt_md5(pass_new, (const char *) result);\n\tpass_new = NULL;\n\n        return cp;\n}"
        }
      },
      {
        "call_info": {
          "callee": "pam_modutil_getpwnam",
          "args": [
            "pamh",
            "forwho"
          ],
          "line": 751
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fclose",
          "args": [
            "opwfile"
          ],
          "line": 748
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fputs",
          "args": [
            "buf",
            "pwfile"
          ],
          "line": 743
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fputs",
          "args": [
            "nbuf",
            "pwfile"
          ],
          "line": 739
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_pam_delete",
          "args": [
            "pass"
          ],
          "line": 738
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "snprintf",
          "args": [
            "nbuf",
            "sizeof(nbuf)",
            "\"%s:%s:%d:%s,%s\\n\"",
            "s_luser",
            "s_uid",
            "npas",
            "s_pas",
            "pass"
          ],
          "line": 736
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "snprintf",
          "args": [
            "nbuf",
            "sizeof(nbuf)",
            "\"%s:%s:%d:%s\\n\"",
            "s_luser",
            "s_uid",
            "npas",
            "pass"
          ],
          "line": 733
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strpbrk",
          "args": [
            "s_pas",
            "\",\""
          ],
          "line": 726
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strtol",
          "args": [
            "s_npas",
            "NULL",
            "10"
          ],
          "line": 724
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strtok_r",
          "args": [
            "NULL",
            "\":\"",
            "&sptr"
          ],
          "line": 723
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strtok_r",
          "args": [
            "NULL",
            "\":\"",
            "&sptr"
          ],
          "line": 718
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strtok_r",
          "args": [
            "NULL",
            "\":\"",
            "&sptr"
          ],
          "line": 713
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strtok_r",
          "args": [
            "buf",
            "\":\"",
            "&sptr"
          ],
          "line": 708
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "buf"
          ],
          "line": 707
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strchr",
          "args": [
            "\":,\\n\"",
            "buf[len]"
          ],
          "line": 702
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strncmp",
          "args": [
            "buf",
            "forwho",
            "len"
          ],
          "line": 702
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fgets",
          "args": [
            "buf",
            "16380",
            "opwfile"
          ],
          "line": 701
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fclose",
          "args": [
            "pwfile"
          ],
          "line": 696
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fclose",
          "args": [
            "opwfile"
          ],
          "line": 695
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fchmod",
          "args": [
            "fileno(pwfile)",
            "st.st_mode"
          ],
          "line": 694
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fileno",
          "args": [
            "pwfile"
          ],
          "line": 694
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fclose",
          "args": [
            "pwfile"
          ],
          "line": 690
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fclose",
          "args": [
            "opwfile"
          ],
          "line": 689
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fchown",
          "args": [
            "fileno(pwfile)",
            "st.st_uid",
            "st.st_gid"
          ],
          "line": 688
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fileno",
          "args": [
            "pwfile"
          ],
          "line": 688
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fclose",
          "args": [
            "pwfile"
          ],
          "line": 683
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fclose",
          "args": [
            "opwfile"
          ],
          "line": 682
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fstat",
          "args": [
            "fileno(opwfile)",
            "&st"
          ],
          "line": 681
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fileno",
          "args": [
            "opwfile"
          ],
          "line": 681
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fclose",
          "args": [
            "pwfile"
          ],
          "line": 676
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fopen",
          "args": [
            "OLD_PASSWORDS_FILE",
            "\"r\""
          ],
          "line": 674
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "umask",
          "args": [
            "oldmask"
          ],
          "line": 668
        },
        "resolved": true,
        "details": {
          "function_name": "set_umask",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2022-28321/repo/modules/pam_umask/pam_umask.c",
          "lines": "116-129",
          "snippet": "static void\nset_umask (const char *value)\n{\n  const char *value_orig = value;\n  mode_t mask;\n  char *endptr;\n\n  mask = strtoul (value, &endptr, 8) & 0777;\n  if (((mask == 0) && (value_orig == endptr)) ||\n      ((mask == UINT_MAX) && (errno == ERANGE)))\n    return;\n  umask (mask);\n  return;\n}",
          "includes": [
            "#include \"pam_inline.h\"",
            "#include <security/pam_ext.h>",
            "#include <security/pam_modutil.h>",
            "#include <security/pam_modules.h>",
            "#include <syslog.h>",
            "#include <sys/resource.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <stdarg.h>",
            "#include <string.h>",
            "#include <limits.h>",
            "#include <errno.h>",
            "#include <ctype.h>",
            "#include <stdio.h>",
            "#include <grp.h>",
            "#include <pwd.h>",
            "#include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"pam_inline.h\"\n#include <security/pam_ext.h>\n#include <security/pam_modutil.h>\n#include <security/pam_modules.h>\n#include <syslog.h>\n#include <sys/resource.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <stdarg.h>\n#include <string.h>\n#include <limits.h>\n#include <errno.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <grp.h>\n#include <pwd.h>\n#include \"config.h\"\n\nstatic void\nset_umask (const char *value)\n{\n  const char *value_orig = value;\n  mode_t mask;\n  char *endptr;\n\n  mask = strtoul (value, &endptr, 8) & 0777;\n  if (((mask == 0) && (value_orig == endptr)) ||\n      ((mask == UINT_MAX) && (errno == ERANGE)))\n    return;\n  umask (mask);\n  return;\n}"
        }
      },
      {
        "call_info": {
          "callee": "fopen",
          "args": [
            "OPW_TMPFILE",
            "\"w\""
          ],
          "line": 667
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "freecon",
          "args": [
            "passwd_context_raw"
          ],
          "line": 664
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "freecon",
          "args": [
            "prev_context_raw"
          ],
          "line": 661
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "freecon",
          "args": [
            "passwd_context_raw"
          ],
          "line": 660
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "setfscreatecon_raw",
          "args": [
            "passwd_context_raw"
          ],
          "line": 659
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "freecon",
          "args": [
            "passwd_context_raw"
          ],
          "line": 656
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "getfscreatecon_raw",
          "args": [
            "&prev_context_raw"
          ],
          "line": 655
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "getfilecon_raw",
          "args": [
            "\"/etc/passwd\"",
            "&passwd_context_raw"
          ],
          "line": 652
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "forwho"
          ],
          "line": 634
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "# include \"./lckpwdf.-c\"\n#include <security/pam_ext.h>\n#include <security/pam_modutil.h>\n#include <selinux/selinux.h>\n#include \"passverify.h\"\n#include \"bigcrypt.h\"\n#include \"md5.h\"\n#include \"pam_inline.h\"\n#include \"pam_cc_compat.h\"\n#include <crypt.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/time.h>\n#include <time.h>\n#include <errno.h>\n#include <signal.h>\n#include <stdarg.h>\n#include <syslog.h>\n#include <shadow.h>\n#include <pwd.h>\n#include <unistd.h>\n#include <sys/types.h>\n#include <string.h>\n#include <stdio.h>\n#include \"support.h\"\n#include <security/pam_modules.h>\n#include <security/_pam_macros.h>\n#include \"config.h\"\n\n#define OPW_TMPFILE             SCONFIGDIR \"/nopasswd\"\n#define SELINUX_ENABLED 0\n#define SELINUX_ENABLED (is_selinux_enabled()>0)\n\nPAMH_ARG_DECL(int get_account_info,\n\tconst char *name, struct passwd **pwd, struct spwd **spwdent)\n{\n\t/* UNIX passwords area */\n\t*pwd = pam_modutil_getpwnam(pamh, name);\n\nint\nsave_old_password(pam_handle_t *pamh, const char *forwho, const char *oldpass,\n\t\t  int howmany)\n#endif\n{\n    static char buf[16384];\n    static char nbuf[16384];\n    char *s_luser, *s_uid, *s_npas, *s_pas, *pass;\n    int npas;\n    FILE *pwfile, *opwfile;\n    int err = 0;\n    int oldmask;\n    int found = 0;\n    struct passwd *pwd = NULL;\n    struct stat st;\n    size_t len = strlen(forwho);\n#ifdef WITH_SELINUX\n    char *prev_context_raw = NULL;\n#endif\n\n    if (howmany < 0) {\n\treturn PAM_SUCCESS;\n    }\n\n    if (oldpass == NULL) {\n\treturn PAM_SUCCESS;\n    }\n\n    oldmask = umask(077);\n\n#ifdef WITH_SELINUX\n    if (SELINUX_ENABLED) {\n      char *passwd_context_raw = NULL;\n      if (getfilecon_raw(\"/etc/passwd\",&passwd_context_raw)<0) {\n        return PAM_AUTHTOK_ERR;\n      };\n      if (getfscreatecon_raw(&prev_context_raw)<0) {\n        freecon(passwd_context_raw);\n        return PAM_AUTHTOK_ERR;\n      }\n      if (setfscreatecon_raw(passwd_context_raw)) {\n        freecon(passwd_context_raw);\n        freecon(prev_context_raw);\n        return PAM_AUTHTOK_ERR;\n      }\n      freecon(passwd_context_raw);\n    }\n#endif\n    pwfile = fopen(OPW_TMPFILE, \"w\");\n    umask(oldmask);\n    if (pwfile == NULL) {\n      err = 1;\n      goto done;\n    }\n\n    opwfile = fopen(OLD_PASSWORDS_FILE, \"r\");\n    if (opwfile == NULL) {\n\tfclose(pwfile);\n      err = 1;\n      goto done;\n    }\n\n    if (fstat(fileno(opwfile), &st) == -1) {\n\tfclose(opwfile);\n\tfclose(pwfile);\n\terr = 1;\n\tgoto done;\n    }\n\n    if (fchown(fileno(pwfile), st.st_uid, st.st_gid) == -1) {\n\tfclose(opwfile);\n\tfclose(pwfile);\n\terr = 1;\n\tgoto done;\n    }\n    if (fchmod(fileno(pwfile), st.st_mode) == -1) {\n\tfclose(opwfile);\n\tfclose(pwfile);\n\terr = 1;\n\tgoto done;\n    }\n\n    while (fgets(buf, 16380, opwfile)) {\n\tif (!strncmp(buf, forwho, len) && strchr(\":,\\n\", buf[len]) != NULL) {\n\t    char *sptr = NULL;\n\t    found = 1;\n\t    if (howmany == 0)\n\t\tcontinue;\n\t    buf[strlen(buf) - 1] = '\\0';\n\t    s_luser = strtok_r(buf, \":\", &sptr);\n\t    if (s_luser == NULL) {\n\t\tfound = 0;\n\t\tcontinue;\n\t    }\n\t    s_uid = strtok_r(NULL, \":\", &sptr);\n\t    if (s_uid == NULL) {\n\t\tfound = 0;\n\t\tcontinue;\n\t    }\n\t    s_npas = strtok_r(NULL, \":\", &sptr);\n\t    if (s_npas == NULL) {\n\t\tfound = 0;\n\t\tcontinue;\n\t    }\n\t    s_pas = strtok_r(NULL, \":\", &sptr);\n\t    npas = strtol(s_npas, NULL, 10) + 1;\n\t    while (npas > howmany && s_pas != NULL) {\n\t\ts_pas = strpbrk(s_pas, \",\");\n\t\tif (s_pas != NULL)\n\t\t    s_pas++;\n\t\tnpas--;\n\t    }\n\t    pass = crypt_md5_wrapper(oldpass);\n\t    if (s_pas == NULL)\n\t\tsnprintf(nbuf, sizeof(nbuf), \"%s:%s:%d:%s\\n\",\n\t\t\t s_luser, s_uid, npas, pass);\n\t    else\n\t\tsnprintf(nbuf, sizeof(nbuf),\"%s:%s:%d:%s,%s\\n\",\n\t\t\t s_luser, s_uid, npas, s_pas, pass);\n\t    _pam_delete(pass);\n\t    if (fputs(nbuf, pwfile) < 0) {\n\t\terr = 1;\n\t\tbreak;\n\t    }\n\t} else if (fputs(buf, pwfile) < 0) {\n\t    err = 1;\n\t    break;\n\t}\n    }\n    fclose(opwfile);\n\n    if (!found) {\n\tpwd = pam_modutil_getpwnam(pamh, forwho);\n\tif (pwd == NULL) {\n\t    err = 1;\n\t} else {\n\t    pass = crypt_md5_wrapper(oldpass);\n\t    snprintf(nbuf, sizeof(nbuf), \"%s:%lu:1:%s\\n\",\n\t\t     forwho, (unsigned long)pwd->pw_uid, pass);\n\t    _pam_delete(pass);\n\t    if (fputs(nbuf, pwfile) < 0) {\n\t\terr = 1;\n\t    }\n\t}\n    }\n\n    if (fflush(pwfile) || fsync(fileno(pwfile))) {\n\tD((\"fflush or fsync error writing entries to old passwords file: %m\"));\n\terr = 1;\n    }\n\n    if (fclose(pwfile)) {\n\tD((\"fclose error writing entries to old passwords file: %m\"));\n\terr = 1;\n    }\n\ndone:\n    if (!err) {\n\tif (rename(OPW_TMPFILE, OLD_PASSWORDS_FILE))\n\t    err = 1;\n    }\n#ifdef WITH_SELINUX\n    if (SELINUX_ENABLED) {\n      if (setfscreatecon_raw(prev_context_raw)) {\n        err = 1;\n      }\n      if (prev_context_raw)\n        freecon(prev_context_raw);\n      prev_context_raw = NULL;\n    }\n#endif\n    if (!err) {\n\treturn PAM_SUCCESS;\n    } else {\n\tunlink(OPW_TMPFILE);\n\treturn PAM_AUTHTOK_ERR;\n    }\n}"
  },
  {
    "function_name": "unlock_pwdf",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2022-28321/repo/modules/pam_unix/passverify.c",
    "lines": "607-611",
    "snippet": "void\nunlock_pwdf(void)\n{\n\treturn;\n}",
    "includes": [
      "# include \"./lckpwdf.-c\"",
      "#include <security/pam_ext.h>",
      "#include <security/pam_modutil.h>",
      "#include <selinux/selinux.h>",
      "#include \"passverify.h\"",
      "#include \"bigcrypt.h\"",
      "#include \"md5.h\"",
      "#include \"pam_inline.h\"",
      "#include \"pam_cc_compat.h\"",
      "#include <crypt.h>",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <sys/time.h>",
      "#include <time.h>",
      "#include <errno.h>",
      "#include <signal.h>",
      "#include <stdarg.h>",
      "#include <syslog.h>",
      "#include <shadow.h>",
      "#include <pwd.h>",
      "#include <unistd.h>",
      "#include <sys/types.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include \"support.h\"",
      "#include <security/pam_modules.h>",
      "#include <security/_pam_macros.h>",
      "#include \"config.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "# include \"./lckpwdf.-c\"\n#include <security/pam_ext.h>\n#include <security/pam_modutil.h>\n#include <selinux/selinux.h>\n#include \"passverify.h\"\n#include \"bigcrypt.h\"\n#include \"md5.h\"\n#include \"pam_inline.h\"\n#include \"pam_cc_compat.h\"\n#include <crypt.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/time.h>\n#include <time.h>\n#include <errno.h>\n#include <signal.h>\n#include <stdarg.h>\n#include <syslog.h>\n#include <shadow.h>\n#include <pwd.h>\n#include <unistd.h>\n#include <sys/types.h>\n#include <string.h>\n#include <stdio.h>\n#include \"support.h\"\n#include <security/pam_modules.h>\n#include <security/_pam_macros.h>\n#include \"config.h\"\n\nvoid\nunlock_pwdf(void)\n{\n\treturn;\n}"
  },
  {
    "function_name": "lock_pwdf",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2022-28321/repo/modules/pam_unix/passverify.c",
    "lines": "601-605",
    "snippet": "int\nlock_pwdf(void)\n{\n\treturn PAM_SUCCESS;\n}",
    "includes": [
      "# include \"./lckpwdf.-c\"",
      "#include <security/pam_ext.h>",
      "#include <security/pam_modutil.h>",
      "#include <selinux/selinux.h>",
      "#include \"passverify.h\"",
      "#include \"bigcrypt.h\"",
      "#include \"md5.h\"",
      "#include \"pam_inline.h\"",
      "#include \"pam_cc_compat.h\"",
      "#include <crypt.h>",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <sys/time.h>",
      "#include <time.h>",
      "#include <errno.h>",
      "#include <signal.h>",
      "#include <stdarg.h>",
      "#include <syslog.h>",
      "#include <shadow.h>",
      "#include <pwd.h>",
      "#include <unistd.h>",
      "#include <sys/types.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include \"support.h\"",
      "#include <security/pam_modules.h>",
      "#include <security/_pam_macros.h>",
      "#include \"config.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "# include \"./lckpwdf.-c\"\n#include <security/pam_ext.h>\n#include <security/pam_modutil.h>\n#include <selinux/selinux.h>\n#include \"passverify.h\"\n#include \"bigcrypt.h\"\n#include \"md5.h\"\n#include \"pam_inline.h\"\n#include \"pam_cc_compat.h\"\n#include <crypt.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/time.h>\n#include <time.h>\n#include <errno.h>\n#include <signal.h>\n#include <stdarg.h>\n#include <syslog.h>\n#include <shadow.h>\n#include <pwd.h>\n#include <unistd.h>\n#include <sys/types.h>\n#include <string.h>\n#include <stdio.h>\n#include \"support.h\"\n#include <security/pam_modules.h>\n#include <security/_pam_macros.h>\n#include \"config.h\"\n\nint\nlock_pwdf(void)\n{\n\treturn PAM_SUCCESS;\n}"
  },
  {
    "function_name": "unlock_pwdf",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2022-28321/repo/modules/pam_unix/passverify.c",
    "lines": "590-599",
    "snippet": "void\nunlock_pwdf(void)\n{\n#ifndef HELPER_COMPILE\n        if (unix_selinux_confined()) {\n                return;\n        }\n#endif\n        ulckpwdf();\n}",
    "includes": [
      "# include \"./lckpwdf.-c\"",
      "#include <security/pam_ext.h>",
      "#include <security/pam_modutil.h>",
      "#include <selinux/selinux.h>",
      "#include \"passverify.h\"",
      "#include \"bigcrypt.h\"",
      "#include \"md5.h\"",
      "#include \"pam_inline.h\"",
      "#include \"pam_cc_compat.h\"",
      "#include <crypt.h>",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <sys/time.h>",
      "#include <time.h>",
      "#include <errno.h>",
      "#include <signal.h>",
      "#include <stdarg.h>",
      "#include <syslog.h>",
      "#include <shadow.h>",
      "#include <pwd.h>",
      "#include <unistd.h>",
      "#include <sys/types.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include \"support.h\"",
      "#include <security/pam_modules.h>",
      "#include <security/_pam_macros.h>",
      "#include \"config.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "ulckpwdf",
          "args": [],
          "line": 598
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "unix_selinux_confined",
          "args": [],
          "line": 594
        },
        "resolved": true,
        "details": {
          "function_name": "unix_selinux_confined",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2022-28321/repo/modules/pam_unix/passverify.c",
          "lines": "554-558",
          "snippet": "int\nunix_selinux_confined(void)\n{\n    return 0;\n}",
          "includes": [
            "# include \"./lckpwdf.-c\"",
            "#include <security/pam_ext.h>",
            "#include <security/pam_modutil.h>",
            "#include <selinux/selinux.h>",
            "#include \"passverify.h\"",
            "#include \"bigcrypt.h\"",
            "#include \"md5.h\"",
            "#include \"pam_inline.h\"",
            "#include \"pam_cc_compat.h\"",
            "#include <crypt.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/time.h>",
            "#include <time.h>",
            "#include <errno.h>",
            "#include <signal.h>",
            "#include <stdarg.h>",
            "#include <syslog.h>",
            "#include <shadow.h>",
            "#include <pwd.h>",
            "#include <unistd.h>",
            "#include <sys/types.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include \"support.h\"",
            "#include <security/pam_modules.h>",
            "#include <security/_pam_macros.h>",
            "#include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include \"./lckpwdf.-c\"\n#include <security/pam_ext.h>\n#include <security/pam_modutil.h>\n#include <selinux/selinux.h>\n#include \"passverify.h\"\n#include \"bigcrypt.h\"\n#include \"md5.h\"\n#include \"pam_inline.h\"\n#include \"pam_cc_compat.h\"\n#include <crypt.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/time.h>\n#include <time.h>\n#include <errno.h>\n#include <signal.h>\n#include <stdarg.h>\n#include <syslog.h>\n#include <shadow.h>\n#include <pwd.h>\n#include <unistd.h>\n#include <sys/types.h>\n#include <string.h>\n#include <stdio.h>\n#include \"support.h\"\n#include <security/pam_modules.h>\n#include <security/_pam_macros.h>\n#include \"config.h\"\n\nint\nunix_selinux_confined(void)\n{\n    return 0;\n}"
        }
      }
    ],
    "contextual_snippet": "# include \"./lckpwdf.-c\"\n#include <security/pam_ext.h>\n#include <security/pam_modutil.h>\n#include <selinux/selinux.h>\n#include \"passverify.h\"\n#include \"bigcrypt.h\"\n#include \"md5.h\"\n#include \"pam_inline.h\"\n#include \"pam_cc_compat.h\"\n#include <crypt.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/time.h>\n#include <time.h>\n#include <errno.h>\n#include <signal.h>\n#include <stdarg.h>\n#include <syslog.h>\n#include <shadow.h>\n#include <pwd.h>\n#include <unistd.h>\n#include <sys/types.h>\n#include <string.h>\n#include <stdio.h>\n#include \"support.h\"\n#include <security/pam_modules.h>\n#include <security/_pam_macros.h>\n#include \"config.h\"\n\nvoid\nunlock_pwdf(void)\n{\n#ifndef HELPER_COMPILE\n        if (unix_selinux_confined()) {\n                return;\n        }\n#endif\n        ulckpwdf();\n}"
  },
  {
    "function_name": "lock_pwdf",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2022-28321/repo/modules/pam_unix/passverify.c",
    "lines": "562-588",
    "snippet": "int\nlock_pwdf(void)\n{\n        int i;\n        int retval;\n\n#ifndef HELPER_COMPILE\n        if (unix_selinux_confined()) {\n                return PAM_SUCCESS;\n        }\n#endif\n        /* These values for the number of attempts and the sleep time\n           are, of course, completely arbitrary.\n           My reading of the PAM docs is that, once pam_chauthtok() has been\n           called with PAM_UPDATE_AUTHTOK, we are obliged to take any\n           reasonable steps to make sure the token is updated; so retrying\n           for 1/10 sec. isn't overdoing it. */\n        i=0;\n        while((retval = lckpwdf()) != 0 && i < 100) {\n                usleep(1000);\n                i++;\n        }\n        if(retval != 0) {\n                return PAM_AUTHTOK_LOCK_BUSY;\n        }\n        return PAM_SUCCESS;\n}",
    "includes": [
      "# include \"./lckpwdf.-c\"",
      "#include <security/pam_ext.h>",
      "#include <security/pam_modutil.h>",
      "#include <selinux/selinux.h>",
      "#include \"passverify.h\"",
      "#include \"bigcrypt.h\"",
      "#include \"md5.h\"",
      "#include \"pam_inline.h\"",
      "#include \"pam_cc_compat.h\"",
      "#include <crypt.h>",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <sys/time.h>",
      "#include <time.h>",
      "#include <errno.h>",
      "#include <signal.h>",
      "#include <stdarg.h>",
      "#include <syslog.h>",
      "#include <shadow.h>",
      "#include <pwd.h>",
      "#include <unistd.h>",
      "#include <sys/types.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include \"support.h\"",
      "#include <security/pam_modules.h>",
      "#include <security/_pam_macros.h>",
      "#include \"config.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "int retval;",
      "PAMH_ARG_DECL(int get_pwd_hash,\n\tconst char *name, struct passwd **pwd, char **hash)\n{\n\tint retval;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "usleep",
          "args": [
            "1000"
          ],
          "line": 581
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lckpwdf",
          "args": [],
          "line": 580
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "unix_selinux_confined",
          "args": [],
          "line": 569
        },
        "resolved": true,
        "details": {
          "function_name": "unix_selinux_confined",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2022-28321/repo/modules/pam_unix/passverify.c",
          "lines": "554-558",
          "snippet": "int\nunix_selinux_confined(void)\n{\n    return 0;\n}",
          "includes": [
            "# include \"./lckpwdf.-c\"",
            "#include <security/pam_ext.h>",
            "#include <security/pam_modutil.h>",
            "#include <selinux/selinux.h>",
            "#include \"passverify.h\"",
            "#include \"bigcrypt.h\"",
            "#include \"md5.h\"",
            "#include \"pam_inline.h\"",
            "#include \"pam_cc_compat.h\"",
            "#include <crypt.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/time.h>",
            "#include <time.h>",
            "#include <errno.h>",
            "#include <signal.h>",
            "#include <stdarg.h>",
            "#include <syslog.h>",
            "#include <shadow.h>",
            "#include <pwd.h>",
            "#include <unistd.h>",
            "#include <sys/types.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include \"support.h\"",
            "#include <security/pam_modules.h>",
            "#include <security/_pam_macros.h>",
            "#include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include \"./lckpwdf.-c\"\n#include <security/pam_ext.h>\n#include <security/pam_modutil.h>\n#include <selinux/selinux.h>\n#include \"passverify.h\"\n#include \"bigcrypt.h\"\n#include \"md5.h\"\n#include \"pam_inline.h\"\n#include \"pam_cc_compat.h\"\n#include <crypt.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/time.h>\n#include <time.h>\n#include <errno.h>\n#include <signal.h>\n#include <stdarg.h>\n#include <syslog.h>\n#include <shadow.h>\n#include <pwd.h>\n#include <unistd.h>\n#include <sys/types.h>\n#include <string.h>\n#include <stdio.h>\n#include \"support.h\"\n#include <security/pam_modules.h>\n#include <security/_pam_macros.h>\n#include \"config.h\"\n\nint\nunix_selinux_confined(void)\n{\n    return 0;\n}"
        }
      }
    ],
    "contextual_snippet": "# include \"./lckpwdf.-c\"\n#include <security/pam_ext.h>\n#include <security/pam_modutil.h>\n#include <selinux/selinux.h>\n#include \"passverify.h\"\n#include \"bigcrypt.h\"\n#include \"md5.h\"\n#include \"pam_inline.h\"\n#include \"pam_cc_compat.h\"\n#include <crypt.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/time.h>\n#include <time.h>\n#include <errno.h>\n#include <signal.h>\n#include <stdarg.h>\n#include <syslog.h>\n#include <shadow.h>\n#include <pwd.h>\n#include <unistd.h>\n#include <sys/types.h>\n#include <string.h>\n#include <stdio.h>\n#include \"support.h\"\n#include <security/pam_modules.h>\n#include <security/_pam_macros.h>\n#include \"config.h\"\n\nint retval;\nPAMH_ARG_DECL(int get_pwd_hash,\n\tconst char *name, struct passwd **pwd, char **hash)\n{\n\tint retval;\n\nint\nlock_pwdf(void)\n{\n        int i;\n        int retval;\n\n#ifndef HELPER_COMPILE\n        if (unix_selinux_confined()) {\n                return PAM_SUCCESS;\n        }\n#endif\n        /* These values for the number of attempts and the sleep time\n           are, of course, completely arbitrary.\n           My reading of the PAM docs is that, once pam_chauthtok() has been\n           called with PAM_UPDATE_AUTHTOK, we are obliged to take any\n           reasonable steps to make sure the token is updated; so retrying\n           for 1/10 sec. isn't overdoing it. */\n        i=0;\n        while((retval = lckpwdf()) != 0 && i < 100) {\n                usleep(1000);\n                i++;\n        }\n        if(retval != 0) {\n                return PAM_AUTHTOK_LOCK_BUSY;\n        }\n        return PAM_SUCCESS;\n}"
  },
  {
    "function_name": "unix_selinux_confined",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2022-28321/repo/modules/pam_unix/passverify.c",
    "lines": "554-558",
    "snippet": "int\nunix_selinux_confined(void)\n{\n    return 0;\n}",
    "includes": [
      "# include \"./lckpwdf.-c\"",
      "#include <security/pam_ext.h>",
      "#include <security/pam_modutil.h>",
      "#include <selinux/selinux.h>",
      "#include \"passverify.h\"",
      "#include \"bigcrypt.h\"",
      "#include \"md5.h\"",
      "#include \"pam_inline.h\"",
      "#include \"pam_cc_compat.h\"",
      "#include <crypt.h>",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <sys/time.h>",
      "#include <time.h>",
      "#include <errno.h>",
      "#include <signal.h>",
      "#include <stdarg.h>",
      "#include <syslog.h>",
      "#include <shadow.h>",
      "#include <pwd.h>",
      "#include <unistd.h>",
      "#include <sys/types.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include \"support.h\"",
      "#include <security/pam_modules.h>",
      "#include <security/_pam_macros.h>",
      "#include \"config.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "# include \"./lckpwdf.-c\"\n#include <security/pam_ext.h>\n#include <security/pam_modutil.h>\n#include <selinux/selinux.h>\n#include \"passverify.h\"\n#include \"bigcrypt.h\"\n#include \"md5.h\"\n#include \"pam_inline.h\"\n#include \"pam_cc_compat.h\"\n#include <crypt.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/time.h>\n#include <time.h>\n#include <errno.h>\n#include <signal.h>\n#include <stdarg.h>\n#include <syslog.h>\n#include <shadow.h>\n#include <pwd.h>\n#include <unistd.h>\n#include <sys/types.h>\n#include <string.h>\n#include <stdio.h>\n#include \"support.h\"\n#include <security/pam_modules.h>\n#include <security/_pam_macros.h>\n#include \"config.h\"\n\nint\nunix_selinux_confined(void)\n{\n    return 0;\n}"
  },
  {
    "function_name": "unix_selinux_confined",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2022-28321/repo/modules/pam_unix/passverify.c",
    "lines": "512-551",
    "snippet": "int\nunix_selinux_confined(void)\n{\n    static int confined = -1;\n    int fd;\n    char tempfile[]=\"/etc/.pwdXXXXXX\";\n\n    if (confined != -1)\n\treturn confined;\n\n    /* cannot be confined without SELinux enabled */\n    if (!SELINUX_ENABLED){\n\tconfined = 0;\n\treturn confined;\n    }\n\n    /* let's try opening shadow read only */\n    if ((fd=open(\"/etc/shadow\", O_RDONLY)) != -1) {\n        close(fd);\n        confined = 0;\n        return confined;\n    }\n\n    if (errno == EACCES) {\n\tconfined = 1;\n\treturn confined;\n    }\n\n    /* shadow opening failed because of other reasons let's try\n       creating a file in /etc */\n    if ((fd=mkstemp(tempfile)) != -1) {\n        unlink(tempfile);\n        close(fd);\n        confined = 0;\n        return confined;\n    }\n\n    confined = 1;\n    return confined;\n}",
    "includes": [
      "# include \"./lckpwdf.-c\"",
      "#include <security/pam_ext.h>",
      "#include <security/pam_modutil.h>",
      "#include <selinux/selinux.h>",
      "#include \"passverify.h\"",
      "#include \"bigcrypt.h\"",
      "#include \"md5.h\"",
      "#include \"pam_inline.h\"",
      "#include \"pam_cc_compat.h\"",
      "#include <crypt.h>",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <sys/time.h>",
      "#include <time.h>",
      "#include <errno.h>",
      "#include <signal.h>",
      "#include <stdarg.h>",
      "#include <syslog.h>",
      "#include <shadow.h>",
      "#include <pwd.h>",
      "#include <unistd.h>",
      "#include <sys/types.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include \"support.h\"",
      "#include <security/pam_modules.h>",
      "#include <security/_pam_macros.h>",
      "#include \"config.h\""
    ],
    "macros_used": [
      "#define SELINUX_ENABLED 0",
      "#define SELINUX_ENABLED (is_selinux_enabled()>0)"
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "close",
          "args": [
            "fd"
          ],
          "line": 544
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "unlink",
          "args": [
            "tempfile"
          ],
          "line": 543
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "mkstemp",
          "args": [
            "tempfile"
          ],
          "line": 542
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "close",
          "args": [
            "fd"
          ],
          "line": 530
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "open",
          "args": [
            "\"/etc/shadow\"",
            "O_RDONLY"
          ],
          "line": 529
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "# include \"./lckpwdf.-c\"\n#include <security/pam_ext.h>\n#include <security/pam_modutil.h>\n#include <selinux/selinux.h>\n#include \"passverify.h\"\n#include \"bigcrypt.h\"\n#include \"md5.h\"\n#include \"pam_inline.h\"\n#include \"pam_cc_compat.h\"\n#include <crypt.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/time.h>\n#include <time.h>\n#include <errno.h>\n#include <signal.h>\n#include <stdarg.h>\n#include <syslog.h>\n#include <shadow.h>\n#include <pwd.h>\n#include <unistd.h>\n#include <sys/types.h>\n#include <string.h>\n#include <stdio.h>\n#include \"support.h\"\n#include <security/pam_modules.h>\n#include <security/_pam_macros.h>\n#include \"config.h\"\n\n#define SELINUX_ENABLED 0\n#define SELINUX_ENABLED (is_selinux_enabled()>0)\n\nint\nunix_selinux_confined(void)\n{\n    static int confined = -1;\n    int fd;\n    char tempfile[]=\"/etc/.pwdXXXXXX\";\n\n    if (confined != -1)\n\treturn confined;\n\n    /* cannot be confined without SELinux enabled */\n    if (!SELINUX_ENABLED){\n\tconfined = 0;\n\treturn confined;\n    }\n\n    /* let's try opening shadow read only */\n    if ((fd=open(\"/etc/shadow\", O_RDONLY)) != -1) {\n        close(fd);\n        confined = 0;\n        return confined;\n    }\n\n    if (errno == EACCES) {\n\tconfined = 1;\n\treturn confined;\n    }\n\n    /* shadow opening failed because of other reasons let's try\n       creating a file in /etc */\n    if ((fd=mkstemp(tempfile)) != -1) {\n        unlink(tempfile);\n        close(fd);\n        confined = 0;\n        return confined;\n    }\n\n    confined = 1;\n    return confined;\n}"
  },
  {
    "function_name": "crypt_md5_wrapper",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2022-28321/repo/modules/pam_unix/passverify.c",
    "lines": "404-418",
    "snippet": "char *\ncrypt_md5_wrapper(const char *pass_new)\n{\n        unsigned char result[16];\n        char *cp = (char *) result;\n\n        cp = stpcpy(cp, \"$1$\");      /* magic for the MD5 */\n\tcrypt_make_salt(cp, 8);\n\n        /* no longer need cleartext */\n        cp = Goodcrypt_md5(pass_new, (const char *) result);\n\tpass_new = NULL;\n\n        return cp;\n}",
    "includes": [
      "# include \"./lckpwdf.-c\"",
      "#include <security/pam_ext.h>",
      "#include <security/pam_modutil.h>",
      "#include <selinux/selinux.h>",
      "#include \"passverify.h\"",
      "#include \"bigcrypt.h\"",
      "#include \"md5.h\"",
      "#include \"pam_inline.h\"",
      "#include \"pam_cc_compat.h\"",
      "#include <crypt.h>",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <sys/time.h>",
      "#include <time.h>",
      "#include <errno.h>",
      "#include <signal.h>",
      "#include <stdarg.h>",
      "#include <syslog.h>",
      "#include <shadow.h>",
      "#include <pwd.h>",
      "#include <unistd.h>",
      "#include <sys/types.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include \"support.h\"",
      "#include <security/pam_modules.h>",
      "#include <security/_pam_macros.h>",
      "#include \"config.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "Goodcrypt_md5",
          "args": [
            "pass_new",
            "(const char *) result"
          ],
          "line": 414
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "crypt_make_salt",
          "args": [
            "cp",
            "8"
          ],
          "line": 411
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "stpcpy",
          "args": [
            "cp",
            "\"$1$\""
          ],
          "line": 410
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "# include \"./lckpwdf.-c\"\n#include <security/pam_ext.h>\n#include <security/pam_modutil.h>\n#include <selinux/selinux.h>\n#include \"passverify.h\"\n#include \"bigcrypt.h\"\n#include \"md5.h\"\n#include \"pam_inline.h\"\n#include \"pam_cc_compat.h\"\n#include <crypt.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/time.h>\n#include <time.h>\n#include <errno.h>\n#include <signal.h>\n#include <stdarg.h>\n#include <syslog.h>\n#include <shadow.h>\n#include <pwd.h>\n#include <unistd.h>\n#include <sys/types.h>\n#include <string.h>\n#include <stdio.h>\n#include \"support.h\"\n#include <security/pam_modules.h>\n#include <security/_pam_macros.h>\n#include \"config.h\"\n\nchar *\ncrypt_md5_wrapper(const char *pass_new)\n{\n        unsigned char result[16];\n        char *cp = (char *) result;\n\n        cp = stpcpy(cp, \"$1$\");      /* magic for the MD5 */\n\tcrypt_make_salt(cp, 8);\n\n        /* no longer need cleartext */\n        cp = Goodcrypt_md5(pass_new, (const char *) result);\n\tpass_new = NULL;\n\n        return cp;\n}"
  },
  {
    "function_name": "i64c",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2022-28321/repo/modules/pam_unix/passverify.c",
    "lines": "342-360",
    "snippet": "static int\ni64c(int i)\n{\n        if (i < 0)\n                return ('.');\n        else if (i > 63)\n                return ('z');\n        if (i == 0)\n                return ('.');\n        if (i == 1)\n                return ('/');\n        if (i >= 2 && i <= 11)\n                return ('0' - 2 + i);\n        if (i >= 12 && i <= 37)\n                return ('A' - 12 + i);\n        if (i >= 38 && i <= 63)\n                return ('a' - 38 + i);\n        return ('\\0');\n}",
    "includes": [
      "# include \"./lckpwdf.-c\"",
      "#include <security/pam_ext.h>",
      "#include <security/pam_modutil.h>",
      "#include <selinux/selinux.h>",
      "#include \"passverify.h\"",
      "#include \"bigcrypt.h\"",
      "#include \"md5.h\"",
      "#include \"pam_inline.h\"",
      "#include \"pam_cc_compat.h\"",
      "#include <crypt.h>",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <sys/time.h>",
      "#include <time.h>",
      "#include <errno.h>",
      "#include <signal.h>",
      "#include <stdarg.h>",
      "#include <syslog.h>",
      "#include <shadow.h>",
      "#include <pwd.h>",
      "#include <unistd.h>",
      "#include <sys/types.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include \"support.h\"",
      "#include <security/pam_modules.h>",
      "#include <security/_pam_macros.h>",
      "#include \"config.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "# include \"./lckpwdf.-c\"\n#include <security/pam_ext.h>\n#include <security/pam_modutil.h>\n#include <selinux/selinux.h>\n#include \"passverify.h\"\n#include \"bigcrypt.h\"\n#include \"md5.h\"\n#include \"pam_inline.h\"\n#include \"pam_cc_compat.h\"\n#include <crypt.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/time.h>\n#include <time.h>\n#include <errno.h>\n#include <signal.h>\n#include <stdarg.h>\n#include <syslog.h>\n#include <shadow.h>\n#include <pwd.h>\n#include <unistd.h>\n#include <sys/types.h>\n#include <string.h>\n#include <stdio.h>\n#include \"support.h\"\n#include <security/pam_modules.h>\n#include <security/_pam_macros.h>\n#include \"config.h\"\n\nstatic int\ni64c(int i)\n{\n        if (i < 0)\n                return ('.');\n        else if (i > 63)\n                return ('z');\n        if (i == 0)\n                return ('.');\n        if (i == 1)\n                return ('/');\n        if (i >= 2 && i <= 11)\n                return ('0' - 2 + i);\n        if (i >= 12 && i <= 37)\n                return ('A' - 12 + i);\n        if (i >= 38 && i <= 63)\n                return ('a' - 38 + i);\n        return ('\\0');\n}"
  },
  {
    "function_name": "is_pwd_shadowed",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2022-28321/repo/modules/pam_unix/passverify.c",
    "lines": "176-190",
    "snippet": "int\nis_pwd_shadowed(const struct passwd *pwd)\n{\n\tif (pwd != NULL) {\n\t\tif (strcmp(pwd->pw_passwd, \"x\") == 0) {\n\t\t\treturn 1;\n\t\t}\n\t\tif ((pwd->pw_passwd[0] == '#') &&\n\t\t    (pwd->pw_passwd[1] == '#') &&\n\t\t    (strcmp(pwd->pw_name, pwd->pw_passwd + 2) == 0)) {\n\t\t\treturn 1;\n\t\t}\n\t}\n\treturn 0;\n}",
    "includes": [
      "# include \"./lckpwdf.-c\"",
      "#include <security/pam_ext.h>",
      "#include <security/pam_modutil.h>",
      "#include <selinux/selinux.h>",
      "#include \"passverify.h\"",
      "#include \"bigcrypt.h\"",
      "#include \"md5.h\"",
      "#include \"pam_inline.h\"",
      "#include \"pam_cc_compat.h\"",
      "#include <crypt.h>",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <sys/time.h>",
      "#include <time.h>",
      "#include <errno.h>",
      "#include <signal.h>",
      "#include <stdarg.h>",
      "#include <syslog.h>",
      "#include <shadow.h>",
      "#include <pwd.h>",
      "#include <unistd.h>",
      "#include <sys/types.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include \"support.h\"",
      "#include <security/pam_modules.h>",
      "#include <security/_pam_macros.h>",
      "#include \"config.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "PAMH_ARG_DECL(int get_account_info,\n\tconst char *name, struct passwd **pwd, struct spwd **spwdent)\n{\n\t/* UNIX passwords area */\n\t*pwd = pam_modutil_getpwnam(pamh, name);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "pwd->pw_name",
            "pwd->pw_passwd + 2"
          ],
          "line": 185
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "pwd->pw_passwd",
            "\"x\""
          ],
          "line": 180
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "# include \"./lckpwdf.-c\"\n#include <security/pam_ext.h>\n#include <security/pam_modutil.h>\n#include <selinux/selinux.h>\n#include \"passverify.h\"\n#include \"bigcrypt.h\"\n#include \"md5.h\"\n#include \"pam_inline.h\"\n#include \"pam_cc_compat.h\"\n#include <crypt.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/time.h>\n#include <time.h>\n#include <errno.h>\n#include <signal.h>\n#include <stdarg.h>\n#include <syslog.h>\n#include <shadow.h>\n#include <pwd.h>\n#include <unistd.h>\n#include <sys/types.h>\n#include <string.h>\n#include <stdio.h>\n#include \"support.h\"\n#include <security/pam_modules.h>\n#include <security/_pam_macros.h>\n#include \"config.h\"\n\nPAMH_ARG_DECL(int get_account_info,\n\tconst char *name, struct passwd **pwd, struct spwd **spwdent)\n{\n\t/* UNIX passwords area */\n\t*pwd = pam_modutil_getpwnam(pamh, name);\n\nint\nis_pwd_shadowed(const struct passwd *pwd)\n{\n\tif (pwd != NULL) {\n\t\tif (strcmp(pwd->pw_passwd, \"x\") == 0) {\n\t\t\treturn 1;\n\t\t}\n\t\tif ((pwd->pw_passwd[0] == '#') &&\n\t\t    (pwd->pw_passwd[1] == '#') &&\n\t\t    (strcmp(pwd->pw_name, pwd->pw_passwd + 2) == 0)) {\n\t\t\treturn 1;\n\t\t}\n\t}\n\treturn 0;\n}"
  },
  {
    "function_name": "strip_hpux_aging",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2022-28321/repo/modules/pam_unix/passverify.c",
    "lines": "52-66",
    "snippet": "static void\nstrip_hpux_aging(char *hash)\n{\n\tstatic const char valid[] = \"ABCDEFGHIJKLMNOPQRSTUVWXYZ\"\n\t\t\"abcdefghijklmnopqrstuvwxyz\"\n\t\t\"0123456789./\";\n\tif ((*hash != '$') && (strlen(hash) > 13)) {\n\t\tfor (hash += 13; *hash != '\\0'; hash++) {\n\t\t\tif (strchr(valid, *hash) == NULL) {\n\t\t\t\t*hash = '\\0';\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n}",
    "includes": [
      "# include \"./lckpwdf.-c\"",
      "#include <security/pam_ext.h>",
      "#include <security/pam_modutil.h>",
      "#include <selinux/selinux.h>",
      "#include \"passverify.h\"",
      "#include \"bigcrypt.h\"",
      "#include \"md5.h\"",
      "#include \"pam_inline.h\"",
      "#include \"pam_cc_compat.h\"",
      "#include <crypt.h>",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <sys/time.h>",
      "#include <time.h>",
      "#include <errno.h>",
      "#include <signal.h>",
      "#include <stdarg.h>",
      "#include <syslog.h>",
      "#include <shadow.h>",
      "#include <pwd.h>",
      "#include <unistd.h>",
      "#include <sys/types.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include \"support.h\"",
      "#include <security/pam_modules.h>",
      "#include <security/_pam_macros.h>",
      "#include \"config.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "strchr",
          "args": [
            "valid",
            "*hash"
          ],
          "line": 60
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "hash"
          ],
          "line": 58
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "# include \"./lckpwdf.-c\"\n#include <security/pam_ext.h>\n#include <security/pam_modutil.h>\n#include <selinux/selinux.h>\n#include \"passverify.h\"\n#include \"bigcrypt.h\"\n#include \"md5.h\"\n#include \"pam_inline.h\"\n#include \"pam_cc_compat.h\"\n#include <crypt.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/time.h>\n#include <time.h>\n#include <errno.h>\n#include <signal.h>\n#include <stdarg.h>\n#include <syslog.h>\n#include <shadow.h>\n#include <pwd.h>\n#include <unistd.h>\n#include <sys/types.h>\n#include <string.h>\n#include <stdio.h>\n#include \"support.h\"\n#include <security/pam_modules.h>\n#include <security/_pam_macros.h>\n#include \"config.h\"\n\nstatic void\nstrip_hpux_aging(char *hash)\n{\n\tstatic const char valid[] = \"ABCDEFGHIJKLMNOPQRSTUVWXYZ\"\n\t\t\"abcdefghijklmnopqrstuvwxyz\"\n\t\t\"0123456789./\";\n\tif ((*hash != '$') && (strlen(hash) > 13)) {\n\t\tfor (hash += 13; *hash != '\\0'; hash++) {\n\t\t\tif (strchr(valid, *hash) == NULL) {\n\t\t\t\t*hash = '\\0';\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n}"
  }
]