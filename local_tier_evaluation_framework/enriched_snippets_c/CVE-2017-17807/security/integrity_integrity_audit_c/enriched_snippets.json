[
  {
    "function_name": "integrity_audit_msg",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/integrity/integrity_audit.c",
    "lines": "31-65",
    "snippet": "void integrity_audit_msg(int audit_msgno, struct inode *inode,\n\t\t\t const unsigned char *fname, const char *op,\n\t\t\t const char *cause, int result, int audit_info)\n{\n\tstruct audit_buffer *ab;\n\tchar name[TASK_COMM_LEN];\n\n\tif (!integrity_audit_info && audit_info == 1)\t/* Skip info messages */\n\t\treturn;\n\n\tab = audit_log_start(current->audit_context, GFP_KERNEL, audit_msgno);\n\taudit_log_format(ab, \"pid=%d uid=%u auid=%u ses=%u\",\n\t\t\t task_pid_nr(current),\n\t\t\t from_kuid(&init_user_ns, current_cred()->uid),\n\t\t\t from_kuid(&init_user_ns, audit_get_loginuid(current)),\n\t\t\t audit_get_sessionid(current));\n\taudit_log_task_context(ab);\n\taudit_log_format(ab, \" op=\");\n\taudit_log_string(ab, op);\n\taudit_log_format(ab, \" cause=\");\n\taudit_log_string(ab, cause);\n\taudit_log_format(ab, \" comm=\");\n\taudit_log_untrustedstring(ab, get_task_comm(name, current));\n\tif (fname) {\n\t\taudit_log_format(ab, \" name=\");\n\t\taudit_log_untrustedstring(ab, fname);\n\t}\n\tif (inode) {\n\t\taudit_log_format(ab, \" dev=\");\n\t\taudit_log_untrustedstring(ab, inode->i_sb->s_id);\n\t\taudit_log_format(ab, \" ino=%lu\", inode->i_ino);\n\t}\n\taudit_log_format(ab, \" res=%d\", !result);\n\taudit_log_end(ab);\n}",
    "includes": [
      "#include \"integrity.h\"",
      "#include <linux/audit.h>",
      "#include <linux/gfp.h>",
      "#include <linux/fs.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static int integrity_audit_info;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "audit_log_end",
          "args": [
            "ab"
          ],
          "line": 64
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "audit_log_format",
          "args": [
            "ab",
            "\" res=%d\"",
            "!result"
          ],
          "line": 63
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "audit_log_format",
          "args": [
            "ab",
            "\" ino=%lu\"",
            "inode->i_ino"
          ],
          "line": 61
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "audit_log_untrustedstring",
          "args": [
            "ab",
            "inode->i_sb->s_id"
          ],
          "line": 60
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "audit_log_format",
          "args": [
            "ab",
            "\" dev=\""
          ],
          "line": 59
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "audit_log_untrustedstring",
          "args": [
            "ab",
            "fname"
          ],
          "line": 56
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "audit_log_format",
          "args": [
            "ab",
            "\" name=\""
          ],
          "line": 55
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "audit_log_untrustedstring",
          "args": [
            "ab",
            "get_task_comm(name, current)"
          ],
          "line": 53
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "get_task_comm",
          "args": [
            "name",
            "current"
          ],
          "line": 53
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "audit_log_format",
          "args": [
            "ab",
            "\" comm=\""
          ],
          "line": 52
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "audit_log_string",
          "args": [
            "ab",
            "cause"
          ],
          "line": 51
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "audit_log_format",
          "args": [
            "ab",
            "\" cause=\""
          ],
          "line": 50
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "audit_log_string",
          "args": [
            "ab",
            "op"
          ],
          "line": 49
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "audit_log_format",
          "args": [
            "ab",
            "\" op=\""
          ],
          "line": 48
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "audit_log_task_context",
          "args": [
            "ab"
          ],
          "line": 47
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "audit_log_format",
          "args": [
            "ab",
            "\"pid=%d uid=%u auid=%u ses=%u\"",
            "task_pid_nr(current)",
            "from_kuid(&init_user_ns, current_cred()->uid)",
            "from_kuid(&init_user_ns, audit_get_loginuid(current))",
            "audit_get_sessionid(current)"
          ],
          "line": 42
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "audit_get_sessionid",
          "args": [
            "current"
          ],
          "line": 46
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "from_kuid",
          "args": [
            "&init_user_ns",
            "audit_get_loginuid(current)"
          ],
          "line": 45
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "audit_get_loginuid",
          "args": [
            "current"
          ],
          "line": 45
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "from_kuid",
          "args": [
            "&init_user_ns",
            "current_cred()->uid"
          ],
          "line": 44
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "current_cred",
          "args": [],
          "line": 44
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "task_pid_nr",
          "args": [
            "current"
          ],
          "line": 43
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "audit_log_start",
          "args": [
            "current->audit_context",
            "GFP_KERNEL",
            "audit_msgno"
          ],
          "line": 41
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"integrity.h\"\n#include <linux/audit.h>\n#include <linux/gfp.h>\n#include <linux/fs.h>\n\nstatic int integrity_audit_info;\n\nvoid integrity_audit_msg(int audit_msgno, struct inode *inode,\n\t\t\t const unsigned char *fname, const char *op,\n\t\t\t const char *cause, int result, int audit_info)\n{\n\tstruct audit_buffer *ab;\n\tchar name[TASK_COMM_LEN];\n\n\tif (!integrity_audit_info && audit_info == 1)\t/* Skip info messages */\n\t\treturn;\n\n\tab = audit_log_start(current->audit_context, GFP_KERNEL, audit_msgno);\n\taudit_log_format(ab, \"pid=%d uid=%u auid=%u ses=%u\",\n\t\t\t task_pid_nr(current),\n\t\t\t from_kuid(&init_user_ns, current_cred()->uid),\n\t\t\t from_kuid(&init_user_ns, audit_get_loginuid(current)),\n\t\t\t audit_get_sessionid(current));\n\taudit_log_task_context(ab);\n\taudit_log_format(ab, \" op=\");\n\taudit_log_string(ab, op);\n\taudit_log_format(ab, \" cause=\");\n\taudit_log_string(ab, cause);\n\taudit_log_format(ab, \" comm=\");\n\taudit_log_untrustedstring(ab, get_task_comm(name, current));\n\tif (fname) {\n\t\taudit_log_format(ab, \" name=\");\n\t\taudit_log_untrustedstring(ab, fname);\n\t}\n\tif (inode) {\n\t\taudit_log_format(ab, \" dev=\");\n\t\taudit_log_untrustedstring(ab, inode->i_sb->s_id);\n\t\taudit_log_format(ab, \" ino=%lu\", inode->i_ino);\n\t}\n\taudit_log_format(ab, \" res=%d\", !result);\n\taudit_log_end(ab);\n}"
  },
  {
    "function_name": "integrity_audit_setup",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/integrity/integrity_audit.c",
    "lines": "21-28",
    "snippet": "static int __init integrity_audit_setup(char *str)\n{\n\tunsigned long audit;\n\n\tif (!kstrtoul(str, 0, &audit))\n\t\tintegrity_audit_info = audit ? 1 : 0;\n\treturn 1;\n}",
    "includes": [
      "#include \"integrity.h\"",
      "#include <linux/audit.h>",
      "#include <linux/gfp.h>",
      "#include <linux/fs.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static int integrity_audit_info;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "kstrtoul",
          "args": [
            "str",
            "0",
            "&audit"
          ],
          "line": 25
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"integrity.h\"\n#include <linux/audit.h>\n#include <linux/gfp.h>\n#include <linux/fs.h>\n\nstatic int integrity_audit_info;\n\nstatic int __init integrity_audit_setup(char *str)\n{\n\tunsigned long audit;\n\n\tif (!kstrtoul(str, 0, &audit))\n\t\tintegrity_audit_info = audit ? 1 : 0;\n\treturn 1;\n}"
  }
]