[
  {
    "function_name": "tomoyo_write_file",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/file.c",
    "lines": "993-1025",
    "snippet": "int tomoyo_write_file(struct tomoyo_acl_param *param)\n{\n\tu16 perm = 0;\n\tu8 type;\n\tconst char *operation = tomoyo_read_token(param);\n\tfor (type = 0; type < TOMOYO_MAX_PATH_OPERATION; type++)\n\t\tif (tomoyo_permstr(operation, tomoyo_path_keyword[type]))\n\t\t\tperm |= 1 << type;\n\tif (perm)\n\t\treturn tomoyo_update_path_acl(perm, param);\n\tfor (type = 0; type < TOMOYO_MAX_PATH2_OPERATION; type++)\n\t\tif (tomoyo_permstr(operation,\n\t\t\t\t   tomoyo_mac_keywords[tomoyo_pp2mac[type]]))\n\t\t\tperm |= 1 << type;\n\tif (perm)\n\t\treturn tomoyo_update_path2_acl(perm, param);\n\tfor (type = 0; type < TOMOYO_MAX_PATH_NUMBER_OPERATION; type++)\n\t\tif (tomoyo_permstr(operation,\n\t\t\t\t   tomoyo_mac_keywords[tomoyo_pn2mac[type]]))\n\t\t\tperm |= 1 << type;\n\tif (perm)\n\t\treturn tomoyo_update_path_number_acl(perm, param);\n\tfor (type = 0; type < TOMOYO_MAX_MKDEV_OPERATION; type++)\n\t\tif (tomoyo_permstr(operation,\n\t\t\t\t   tomoyo_mac_keywords[tomoyo_pnnn2mac[type]]))\n\t\t\tperm |= 1 << type;\n\tif (perm)\n\t\treturn tomoyo_update_mkdev_acl(perm, param);\n\tif (tomoyo_permstr(operation,\n\t\t\t   tomoyo_mac_keywords[TOMOYO_MAC_FILE_MOUNT]))\n\t\treturn tomoyo_update_mount_acl(param);\n\treturn -EINVAL;\n}",
    "includes": [
      "#include <linux/slab.h>",
      "#include \"common.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "const u8 tomoyo_pnnn2mac[TOMOYO_MAX_MKDEV_OPERATION] = {\n\t[TOMOYO_TYPE_MKBLOCK] = TOMOYO_MAC_FILE_MKBLOCK,\n\t[TOMOYO_TYPE_MKCHAR]  = TOMOYO_MAC_FILE_MKCHAR,\n};",
      "const u8 tomoyo_pp2mac[TOMOYO_MAX_PATH2_OPERATION] = {\n\t[TOMOYO_TYPE_LINK]       = TOMOYO_MAC_FILE_LINK,\n\t[TOMOYO_TYPE_RENAME]     = TOMOYO_MAC_FILE_RENAME,\n\t[TOMOYO_TYPE_PIVOT_ROOT] = TOMOYO_MAC_FILE_PIVOT_ROOT,\n};",
      "const u8 tomoyo_pn2mac[TOMOYO_MAX_PATH_NUMBER_OPERATION] = {\n\t[TOMOYO_TYPE_CREATE] = TOMOYO_MAC_FILE_CREATE,\n\t[TOMOYO_TYPE_MKDIR]  = TOMOYO_MAC_FILE_MKDIR,\n\t[TOMOYO_TYPE_MKFIFO] = TOMOYO_MAC_FILE_MKFIFO,\n\t[TOMOYO_TYPE_MKSOCK] = TOMOYO_MAC_FILE_MKSOCK,\n\t[TOMOYO_TYPE_IOCTL]  = TOMOYO_MAC_FILE_IOCTL,\n\t[TOMOYO_TYPE_CHMOD]  = TOMOYO_MAC_FILE_CHMOD,\n\t[TOMOYO_TYPE_CHOWN]  = TOMOYO_MAC_FILE_CHOWN,\n\t[TOMOYO_TYPE_CHGRP]  = TOMOYO_MAC_FILE_CHGRP,\n};"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "tomoyo_update_mount_acl",
          "args": [
            "param"
          ],
          "line": 1023
        },
        "resolved": true,
        "details": {
          "function_name": "tomoyo_update_mount_acl",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/file.c",
          "lines": "965-982",
          "snippet": "static int tomoyo_update_mount_acl(struct tomoyo_acl_param *param)\n{\n\tstruct tomoyo_mount_acl e = { .head.type = TOMOYO_TYPE_MOUNT_ACL };\n\tint error;\n\tif (!tomoyo_parse_name_union(param, &e.dev_name) ||\n\t    !tomoyo_parse_name_union(param, &e.dir_name) ||\n\t    !tomoyo_parse_name_union(param, &e.fs_type) ||\n\t    !tomoyo_parse_number_union(param, &e.flags))\n\t\terror = -EINVAL;\n\telse\n\t\terror = tomoyo_update_domain(&e.head, sizeof(e), param,\n\t\t\t\t\t     tomoyo_same_mount_acl, NULL);\n\ttomoyo_put_name_union(&e.dev_name);\n\ttomoyo_put_name_union(&e.dir_name);\n\ttomoyo_put_name_union(&e.fs_type);\n\ttomoyo_put_number_union(&e.flags);\n\treturn error;\n}",
          "includes": [
            "#include <linux/slab.h>",
            "#include \"common.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/slab.h>\n#include \"common.h\"\n\nstatic int tomoyo_update_mount_acl(struct tomoyo_acl_param *param)\n{\n\tstruct tomoyo_mount_acl e = { .head.type = TOMOYO_TYPE_MOUNT_ACL };\n\tint error;\n\tif (!tomoyo_parse_name_union(param, &e.dev_name) ||\n\t    !tomoyo_parse_name_union(param, &e.dir_name) ||\n\t    !tomoyo_parse_name_union(param, &e.fs_type) ||\n\t    !tomoyo_parse_number_union(param, &e.flags))\n\t\terror = -EINVAL;\n\telse\n\t\terror = tomoyo_update_domain(&e.head, sizeof(e), param,\n\t\t\t\t\t     tomoyo_same_mount_acl, NULL);\n\ttomoyo_put_name_union(&e.dev_name);\n\ttomoyo_put_name_union(&e.dir_name);\n\ttomoyo_put_name_union(&e.fs_type);\n\ttomoyo_put_number_union(&e.flags);\n\treturn error;\n}"
        }
      },
      {
        "call_info": {
          "callee": "tomoyo_permstr",
          "args": [
            "operation",
            "tomoyo_mac_keywords[TOMOYO_MAC_FILE_MOUNT]"
          ],
          "line": 1021
        },
        "resolved": true,
        "details": {
          "function_name": "tomoyo_permstr",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/util.c",
          "lines": "113-119",
          "snippet": "bool tomoyo_permstr(const char *string, const char *keyword)\n{\n\tconst char *cp = strstr(string, keyword);\n\tif (cp)\n\t\treturn cp == string || *(cp - 1) == '/';\n\treturn false;\n}",
          "includes": [
            "#include \"common.h\"",
            "#include <linux/rculist.h>",
            "#include <linux/slab.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common.h\"\n#include <linux/rculist.h>\n#include <linux/slab.h>\n\nbool tomoyo_permstr(const char *string, const char *keyword)\n{\n\tconst char *cp = strstr(string, keyword);\n\tif (cp)\n\t\treturn cp == string || *(cp - 1) == '/';\n\treturn false;\n}"
        }
      },
      {
        "call_info": {
          "callee": "tomoyo_update_mkdev_acl",
          "args": [
            "perm",
            "param"
          ],
          "line": 1020
        },
        "resolved": true,
        "details": {
          "function_name": "tomoyo_update_mkdev_acl",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/file.c",
          "lines": "452-474",
          "snippet": "static int tomoyo_update_mkdev_acl(const u8 perm,\n\t\t\t\t   struct tomoyo_acl_param *param)\n{\n\tstruct tomoyo_mkdev_acl e = {\n\t\t.head.type = TOMOYO_TYPE_MKDEV_ACL,\n\t\t.perm = perm\n\t};\n\tint error;\n\tif (!tomoyo_parse_name_union(param, &e.name) ||\n\t    !tomoyo_parse_number_union(param, &e.mode) ||\n\t    !tomoyo_parse_number_union(param, &e.major) ||\n\t    !tomoyo_parse_number_union(param, &e.minor))\n\t\terror = -EINVAL;\n\telse\n\t\terror = tomoyo_update_domain(&e.head, sizeof(e), param,\n\t\t\t\t\t     tomoyo_same_mkdev_acl,\n\t\t\t\t\t     tomoyo_merge_mkdev_acl);\n\ttomoyo_put_name_union(&e.name);\n\ttomoyo_put_number_union(&e.mode);\n\ttomoyo_put_number_union(&e.major);\n\ttomoyo_put_number_union(&e.minor);\n\treturn error;\n}",
          "includes": [
            "#include <linux/slab.h>",
            "#include \"common.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/slab.h>\n#include \"common.h\"\n\nstatic int tomoyo_update_mkdev_acl(const u8 perm,\n\t\t\t\t   struct tomoyo_acl_param *param)\n{\n\tstruct tomoyo_mkdev_acl e = {\n\t\t.head.type = TOMOYO_TYPE_MKDEV_ACL,\n\t\t.perm = perm\n\t};\n\tint error;\n\tif (!tomoyo_parse_name_union(param, &e.name) ||\n\t    !tomoyo_parse_number_union(param, &e.mode) ||\n\t    !tomoyo_parse_number_union(param, &e.major) ||\n\t    !tomoyo_parse_number_union(param, &e.minor))\n\t\terror = -EINVAL;\n\telse\n\t\terror = tomoyo_update_domain(&e.head, sizeof(e), param,\n\t\t\t\t\t     tomoyo_same_mkdev_acl,\n\t\t\t\t\t     tomoyo_merge_mkdev_acl);\n\ttomoyo_put_name_union(&e.name);\n\ttomoyo_put_number_union(&e.mode);\n\ttomoyo_put_number_union(&e.major);\n\ttomoyo_put_number_union(&e.minor);\n\treturn error;\n}"
        }
      },
      {
        "call_info": {
          "callee": "tomoyo_update_path_number_acl",
          "args": [
            "perm",
            "param"
          ],
          "line": 1014
        },
        "resolved": true,
        "details": {
          "function_name": "tomoyo_update_path_number_acl",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/file.c",
          "lines": "662-680",
          "snippet": "static int tomoyo_update_path_number_acl(const u8 perm,\n\t\t\t\t\t struct tomoyo_acl_param *param)\n{\n\tstruct tomoyo_path_number_acl e = {\n\t\t.head.type = TOMOYO_TYPE_PATH_NUMBER_ACL,\n\t\t.perm = perm\n\t};\n\tint error;\n\tif (!tomoyo_parse_name_union(param, &e.name) ||\n\t    !tomoyo_parse_number_union(param, &e.number))\n\t\terror = -EINVAL;\n\telse\n\t\terror = tomoyo_update_domain(&e.head, sizeof(e), param,\n\t\t\t\t\t     tomoyo_same_path_number_acl,\n\t\t\t\t\t     tomoyo_merge_path_number_acl);\n\ttomoyo_put_name_union(&e.name);\n\ttomoyo_put_number_union(&e.number);\n\treturn error;\n}",
          "includes": [
            "#include <linux/slab.h>",
            "#include \"common.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/slab.h>\n#include \"common.h\"\n\nstatic int tomoyo_update_path_number_acl(const u8 perm,\n\t\t\t\t\t struct tomoyo_acl_param *param)\n{\n\tstruct tomoyo_path_number_acl e = {\n\t\t.head.type = TOMOYO_TYPE_PATH_NUMBER_ACL,\n\t\t.perm = perm\n\t};\n\tint error;\n\tif (!tomoyo_parse_name_union(param, &e.name) ||\n\t    !tomoyo_parse_number_union(param, &e.number))\n\t\terror = -EINVAL;\n\telse\n\t\terror = tomoyo_update_domain(&e.head, sizeof(e), param,\n\t\t\t\t\t     tomoyo_same_path_number_acl,\n\t\t\t\t\t     tomoyo_merge_path_number_acl);\n\ttomoyo_put_name_union(&e.name);\n\ttomoyo_put_number_union(&e.number);\n\treturn error;\n}"
        }
      },
      {
        "call_info": {
          "callee": "tomoyo_update_path2_acl",
          "args": [
            "perm",
            "param"
          ],
          "line": 1008
        },
        "resolved": true,
        "details": {
          "function_name": "tomoyo_update_path2_acl",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/file.c",
          "lines": "528-546",
          "snippet": "static int tomoyo_update_path2_acl(const u8 perm,\n\t\t\t\t   struct tomoyo_acl_param *param)\n{\n\tstruct tomoyo_path2_acl e = {\n\t\t.head.type = TOMOYO_TYPE_PATH2_ACL,\n\t\t.perm = perm\n\t};\n\tint error;\n\tif (!tomoyo_parse_name_union(param, &e.name1) ||\n\t    !tomoyo_parse_name_union(param, &e.name2))\n\t\terror = -EINVAL;\n\telse\n\t\terror = tomoyo_update_domain(&e.head, sizeof(e), param,\n\t\t\t\t\t     tomoyo_same_path2_acl,\n\t\t\t\t\t     tomoyo_merge_path2_acl);\n\ttomoyo_put_name_union(&e.name1);\n\ttomoyo_put_name_union(&e.name2);\n\treturn error;\n}",
          "includes": [
            "#include <linux/slab.h>",
            "#include \"common.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/slab.h>\n#include \"common.h\"\n\nstatic int tomoyo_update_path2_acl(const u8 perm,\n\t\t\t\t   struct tomoyo_acl_param *param)\n{\n\tstruct tomoyo_path2_acl e = {\n\t\t.head.type = TOMOYO_TYPE_PATH2_ACL,\n\t\t.perm = perm\n\t};\n\tint error;\n\tif (!tomoyo_parse_name_union(param, &e.name1) ||\n\t    !tomoyo_parse_name_union(param, &e.name2))\n\t\terror = -EINVAL;\n\telse\n\t\terror = tomoyo_update_domain(&e.head, sizeof(e), param,\n\t\t\t\t\t     tomoyo_same_path2_acl,\n\t\t\t\t\t     tomoyo_merge_path2_acl);\n\ttomoyo_put_name_union(&e.name1);\n\ttomoyo_put_name_union(&e.name2);\n\treturn error;\n}"
        }
      },
      {
        "call_info": {
          "callee": "tomoyo_update_path_acl",
          "args": [
            "perm",
            "param"
          ],
          "line": 1002
        },
        "resolved": true,
        "details": {
          "function_name": "tomoyo_update_path_acl",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/file.c",
          "lines": "379-395",
          "snippet": "static int tomoyo_update_path_acl(const u16 perm,\n\t\t\t\t  struct tomoyo_acl_param *param)\n{\n\tstruct tomoyo_path_acl e = {\n\t\t.head.type = TOMOYO_TYPE_PATH_ACL,\n\t\t.perm = perm\n\t};\n\tint error;\n\tif (!tomoyo_parse_name_union(param, &e.name))\n\t\terror = -EINVAL;\n\telse\n\t\terror = tomoyo_update_domain(&e.head, sizeof(e), param,\n\t\t\t\t\t     tomoyo_same_path_acl,\n\t\t\t\t\t     tomoyo_merge_path_acl);\n\ttomoyo_put_name_union(&e.name);\n\treturn error;\n}",
          "includes": [
            "#include <linux/slab.h>",
            "#include \"common.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/slab.h>\n#include \"common.h\"\n\nstatic int tomoyo_update_path_acl(const u16 perm,\n\t\t\t\t  struct tomoyo_acl_param *param)\n{\n\tstruct tomoyo_path_acl e = {\n\t\t.head.type = TOMOYO_TYPE_PATH_ACL,\n\t\t.perm = perm\n\t};\n\tint error;\n\tif (!tomoyo_parse_name_union(param, &e.name))\n\t\terror = -EINVAL;\n\telse\n\t\terror = tomoyo_update_domain(&e.head, sizeof(e), param,\n\t\t\t\t\t     tomoyo_same_path_acl,\n\t\t\t\t\t     tomoyo_merge_path_acl);\n\ttomoyo_put_name_union(&e.name);\n\treturn error;\n}"
        }
      },
      {
        "call_info": {
          "callee": "tomoyo_read_token",
          "args": [
            "param"
          ],
          "line": 997
        },
        "resolved": true,
        "details": {
          "function_name": "tomoyo_read_token",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/util.c",
          "lines": "131-141",
          "snippet": "char *tomoyo_read_token(struct tomoyo_acl_param *param)\n{\n\tchar *pos = param->data;\n\tchar *del = strchr(pos, ' ');\n\tif (del)\n\t\t*del++ = '\\0';\n\telse\n\t\tdel = pos + strlen(pos);\n\tparam->data = del;\n\treturn pos;\n}",
          "includes": [
            "#include \"common.h\"",
            "#include <linux/rculist.h>",
            "#include <linux/slab.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common.h\"\n#include <linux/rculist.h>\n#include <linux/slab.h>\n\nchar *tomoyo_read_token(struct tomoyo_acl_param *param)\n{\n\tchar *pos = param->data;\n\tchar *del = strchr(pos, ' ');\n\tif (del)\n\t\t*del++ = '\\0';\n\telse\n\t\tdel = pos + strlen(pos);\n\tparam->data = del;\n\treturn pos;\n}"
        }
      }
    ],
    "contextual_snippet": "#include <linux/slab.h>\n#include \"common.h\"\n\nconst u8 tomoyo_pnnn2mac[TOMOYO_MAX_MKDEV_OPERATION] = {\n\t[TOMOYO_TYPE_MKBLOCK] = TOMOYO_MAC_FILE_MKBLOCK,\n\t[TOMOYO_TYPE_MKCHAR]  = TOMOYO_MAC_FILE_MKCHAR,\n};\nconst u8 tomoyo_pp2mac[TOMOYO_MAX_PATH2_OPERATION] = {\n\t[TOMOYO_TYPE_LINK]       = TOMOYO_MAC_FILE_LINK,\n\t[TOMOYO_TYPE_RENAME]     = TOMOYO_MAC_FILE_RENAME,\n\t[TOMOYO_TYPE_PIVOT_ROOT] = TOMOYO_MAC_FILE_PIVOT_ROOT,\n};\nconst u8 tomoyo_pn2mac[TOMOYO_MAX_PATH_NUMBER_OPERATION] = {\n\t[TOMOYO_TYPE_CREATE] = TOMOYO_MAC_FILE_CREATE,\n\t[TOMOYO_TYPE_MKDIR]  = TOMOYO_MAC_FILE_MKDIR,\n\t[TOMOYO_TYPE_MKFIFO] = TOMOYO_MAC_FILE_MKFIFO,\n\t[TOMOYO_TYPE_MKSOCK] = TOMOYO_MAC_FILE_MKSOCK,\n\t[TOMOYO_TYPE_IOCTL]  = TOMOYO_MAC_FILE_IOCTL,\n\t[TOMOYO_TYPE_CHMOD]  = TOMOYO_MAC_FILE_CHMOD,\n\t[TOMOYO_TYPE_CHOWN]  = TOMOYO_MAC_FILE_CHOWN,\n\t[TOMOYO_TYPE_CHGRP]  = TOMOYO_MAC_FILE_CHGRP,\n};\n\nint tomoyo_write_file(struct tomoyo_acl_param *param)\n{\n\tu16 perm = 0;\n\tu8 type;\n\tconst char *operation = tomoyo_read_token(param);\n\tfor (type = 0; type < TOMOYO_MAX_PATH_OPERATION; type++)\n\t\tif (tomoyo_permstr(operation, tomoyo_path_keyword[type]))\n\t\t\tperm |= 1 << type;\n\tif (perm)\n\t\treturn tomoyo_update_path_acl(perm, param);\n\tfor (type = 0; type < TOMOYO_MAX_PATH2_OPERATION; type++)\n\t\tif (tomoyo_permstr(operation,\n\t\t\t\t   tomoyo_mac_keywords[tomoyo_pp2mac[type]]))\n\t\t\tperm |= 1 << type;\n\tif (perm)\n\t\treturn tomoyo_update_path2_acl(perm, param);\n\tfor (type = 0; type < TOMOYO_MAX_PATH_NUMBER_OPERATION; type++)\n\t\tif (tomoyo_permstr(operation,\n\t\t\t\t   tomoyo_mac_keywords[tomoyo_pn2mac[type]]))\n\t\t\tperm |= 1 << type;\n\tif (perm)\n\t\treturn tomoyo_update_path_number_acl(perm, param);\n\tfor (type = 0; type < TOMOYO_MAX_MKDEV_OPERATION; type++)\n\t\tif (tomoyo_permstr(operation,\n\t\t\t\t   tomoyo_mac_keywords[tomoyo_pnnn2mac[type]]))\n\t\t\tperm |= 1 << type;\n\tif (perm)\n\t\treturn tomoyo_update_mkdev_acl(perm, param);\n\tif (tomoyo_permstr(operation,\n\t\t\t   tomoyo_mac_keywords[TOMOYO_MAC_FILE_MOUNT]))\n\t\treturn tomoyo_update_mount_acl(param);\n\treturn -EINVAL;\n}"
  },
  {
    "function_name": "tomoyo_update_mount_acl",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/file.c",
    "lines": "965-982",
    "snippet": "static int tomoyo_update_mount_acl(struct tomoyo_acl_param *param)\n{\n\tstruct tomoyo_mount_acl e = { .head.type = TOMOYO_TYPE_MOUNT_ACL };\n\tint error;\n\tif (!tomoyo_parse_name_union(param, &e.dev_name) ||\n\t    !tomoyo_parse_name_union(param, &e.dir_name) ||\n\t    !tomoyo_parse_name_union(param, &e.fs_type) ||\n\t    !tomoyo_parse_number_union(param, &e.flags))\n\t\terror = -EINVAL;\n\telse\n\t\terror = tomoyo_update_domain(&e.head, sizeof(e), param,\n\t\t\t\t\t     tomoyo_same_mount_acl, NULL);\n\ttomoyo_put_name_union(&e.dev_name);\n\ttomoyo_put_name_union(&e.dir_name);\n\ttomoyo_put_name_union(&e.fs_type);\n\ttomoyo_put_number_union(&e.flags);\n\treturn error;\n}",
    "includes": [
      "#include <linux/slab.h>",
      "#include \"common.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "tomoyo_put_number_union",
          "args": [
            "&e.flags"
          ],
          "line": 980
        },
        "resolved": true,
        "details": {
          "function_name": "tomoyo_put_number_union",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/file.c",
          "lines": "99-102",
          "snippet": "void tomoyo_put_number_union(struct tomoyo_number_union *ptr)\n{\n\ttomoyo_put_group(ptr->group);\n}",
          "includes": [
            "#include <linux/slab.h>",
            "#include \"common.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/slab.h>\n#include \"common.h\"\n\nvoid tomoyo_put_number_union(struct tomoyo_number_union *ptr)\n{\n\ttomoyo_put_group(ptr->group);\n}"
        }
      },
      {
        "call_info": {
          "callee": "tomoyo_put_name_union",
          "args": [
            "&e.fs_type"
          ],
          "line": 979
        },
        "resolved": true,
        "details": {
          "function_name": "tomoyo_put_name_union",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/file.c",
          "lines": "67-71",
          "snippet": "void tomoyo_put_name_union(struct tomoyo_name_union *ptr)\n{\n\ttomoyo_put_group(ptr->group);\n\ttomoyo_put_name(ptr->filename);\n}",
          "includes": [
            "#include <linux/slab.h>",
            "#include \"common.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/slab.h>\n#include \"common.h\"\n\nvoid tomoyo_put_name_union(struct tomoyo_name_union *ptr)\n{\n\ttomoyo_put_group(ptr->group);\n\ttomoyo_put_name(ptr->filename);\n}"
        }
      },
      {
        "call_info": {
          "callee": "tomoyo_update_domain",
          "args": [
            "&e.head",
            "sizeof(e)",
            "param",
            "tomoyo_same_mount_acl",
            "NULL"
          ],
          "line": 975
        },
        "resolved": true,
        "details": {
          "function_name": "tomoyo_update_domain",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/domain.c",
          "lines": "91-147",
          "snippet": "int tomoyo_update_domain(struct tomoyo_acl_info *new_entry, const int size,\n\t\t\t struct tomoyo_acl_param *param,\n\t\t\t bool (*check_duplicate) (const struct tomoyo_acl_info\n\t\t\t\t\t\t  *,\n\t\t\t\t\t\t  const struct tomoyo_acl_info\n\t\t\t\t\t\t  *),\n\t\t\t bool (*merge_duplicate) (struct tomoyo_acl_info *,\n\t\t\t\t\t\t  struct tomoyo_acl_info *,\n\t\t\t\t\t\t  const bool))\n{\n\tconst bool is_delete = param->is_delete;\n\tint error = is_delete ? -ENOENT : -ENOMEM;\n\tstruct tomoyo_acl_info *entry;\n\tstruct list_head * const list = param->list;\n\n\tif (param->data[0]) {\n\t\tnew_entry->cond = tomoyo_get_condition(param);\n\t\tif (!new_entry->cond)\n\t\t\treturn -EINVAL;\n\t\t/*\n\t\t * Domain transition preference is allowed for only\n\t\t * \"file execute\" entries.\n\t\t */\n\t\tif (new_entry->cond->transit &&\n\t\t    !(new_entry->type == TOMOYO_TYPE_PATH_ACL &&\n\t\t      container_of(new_entry, struct tomoyo_path_acl, head)\n\t\t      ->perm == 1 << TOMOYO_TYPE_EXECUTE))\n\t\t\tgoto out;\n\t}\n\tif (mutex_lock_interruptible(&tomoyo_policy_lock))\n\t\tgoto out;\n\tlist_for_each_entry_rcu(entry, list, list) {\n\t\tif (entry->is_deleted == TOMOYO_GC_IN_PROGRESS)\n\t\t\tcontinue;\n\t\tif (!tomoyo_same_acl_head(entry, new_entry) ||\n\t\t    !check_duplicate(entry, new_entry))\n\t\t\tcontinue;\n\t\tif (merge_duplicate)\n\t\t\tentry->is_deleted = merge_duplicate(entry, new_entry,\n\t\t\t\t\t\t\t    is_delete);\n\t\telse\n\t\t\tentry->is_deleted = is_delete;\n\t\terror = 0;\n\t\tbreak;\n\t}\n\tif (error && !is_delete) {\n\t\tentry = tomoyo_commit_ok(new_entry, size);\n\t\tif (entry) {\n\t\t\tlist_add_tail_rcu(&entry->list, list);\n\t\t\terror = 0;\n\t\t}\n\t}\n\tmutex_unlock(&tomoyo_policy_lock);\nout:\n\ttomoyo_put_condition(new_entry->cond);\n\treturn error;\n}",
          "includes": [
            "#include <linux/rculist.h>",
            "#include <linux/slab.h>",
            "#include <linux/binfmts.h>",
            "#include \"common.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/rculist.h>\n#include <linux/slab.h>\n#include <linux/binfmts.h>\n#include \"common.h\"\n\nint tomoyo_update_domain(struct tomoyo_acl_info *new_entry, const int size,\n\t\t\t struct tomoyo_acl_param *param,\n\t\t\t bool (*check_duplicate) (const struct tomoyo_acl_info\n\t\t\t\t\t\t  *,\n\t\t\t\t\t\t  const struct tomoyo_acl_info\n\t\t\t\t\t\t  *),\n\t\t\t bool (*merge_duplicate) (struct tomoyo_acl_info *,\n\t\t\t\t\t\t  struct tomoyo_acl_info *,\n\t\t\t\t\t\t  const bool))\n{\n\tconst bool is_delete = param->is_delete;\n\tint error = is_delete ? -ENOENT : -ENOMEM;\n\tstruct tomoyo_acl_info *entry;\n\tstruct list_head * const list = param->list;\n\n\tif (param->data[0]) {\n\t\tnew_entry->cond = tomoyo_get_condition(param);\n\t\tif (!new_entry->cond)\n\t\t\treturn -EINVAL;\n\t\t/*\n\t\t * Domain transition preference is allowed for only\n\t\t * \"file execute\" entries.\n\t\t */\n\t\tif (new_entry->cond->transit &&\n\t\t    !(new_entry->type == TOMOYO_TYPE_PATH_ACL &&\n\t\t      container_of(new_entry, struct tomoyo_path_acl, head)\n\t\t      ->perm == 1 << TOMOYO_TYPE_EXECUTE))\n\t\t\tgoto out;\n\t}\n\tif (mutex_lock_interruptible(&tomoyo_policy_lock))\n\t\tgoto out;\n\tlist_for_each_entry_rcu(entry, list, list) {\n\t\tif (entry->is_deleted == TOMOYO_GC_IN_PROGRESS)\n\t\t\tcontinue;\n\t\tif (!tomoyo_same_acl_head(entry, new_entry) ||\n\t\t    !check_duplicate(entry, new_entry))\n\t\t\tcontinue;\n\t\tif (merge_duplicate)\n\t\t\tentry->is_deleted = merge_duplicate(entry, new_entry,\n\t\t\t\t\t\t\t    is_delete);\n\t\telse\n\t\t\tentry->is_deleted = is_delete;\n\t\terror = 0;\n\t\tbreak;\n\t}\n\tif (error && !is_delete) {\n\t\tentry = tomoyo_commit_ok(new_entry, size);\n\t\tif (entry) {\n\t\t\tlist_add_tail_rcu(&entry->list, list);\n\t\t\terror = 0;\n\t\t}\n\t}\n\tmutex_unlock(&tomoyo_policy_lock);\nout:\n\ttomoyo_put_condition(new_entry->cond);\n\treturn error;\n}"
        }
      },
      {
        "call_info": {
          "callee": "tomoyo_parse_number_union",
          "args": [
            "param",
            "&e.flags"
          ],
          "line": 972
        },
        "resolved": true,
        "details": {
          "function_name": "tomoyo_parse_number_union",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/util.c",
          "lines": "263-294",
          "snippet": "bool tomoyo_parse_number_union(struct tomoyo_acl_param *param,\n\t\t\t       struct tomoyo_number_union *ptr)\n{\n\tchar *data;\n\tu8 type;\n\tunsigned long v;\n\tmemset(ptr, 0, sizeof(*ptr));\n\tif (param->data[0] == '@') {\n\t\tparam->data++;\n\t\tptr->group = tomoyo_get_group(param, TOMOYO_NUMBER_GROUP);\n\t\treturn ptr->group != NULL;\n\t}\n\tdata = tomoyo_read_token(param);\n\ttype = tomoyo_parse_ulong(&v, &data);\n\tif (type == TOMOYO_VALUE_TYPE_INVALID)\n\t\treturn false;\n\tptr->values[0] = v;\n\tptr->value_type[0] = type;\n\tif (!*data) {\n\t\tptr->values[1] = v;\n\t\tptr->value_type[1] = type;\n\t\treturn true;\n\t}\n\tif (*data++ != '-')\n\t\treturn false;\n\ttype = tomoyo_parse_ulong(&v, &data);\n\tif (type == TOMOYO_VALUE_TYPE_INVALID || *data || ptr->values[0] > v)\n\t\treturn false;\n\tptr->values[1] = v;\n\tptr->value_type[1] = type;\n\treturn true;\n}",
          "includes": [
            "#include \"common.h\"",
            "#include <linux/rculist.h>",
            "#include <linux/slab.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common.h\"\n#include <linux/rculist.h>\n#include <linux/slab.h>\n\nbool tomoyo_parse_number_union(struct tomoyo_acl_param *param,\n\t\t\t       struct tomoyo_number_union *ptr)\n{\n\tchar *data;\n\tu8 type;\n\tunsigned long v;\n\tmemset(ptr, 0, sizeof(*ptr));\n\tif (param->data[0] == '@') {\n\t\tparam->data++;\n\t\tptr->group = tomoyo_get_group(param, TOMOYO_NUMBER_GROUP);\n\t\treturn ptr->group != NULL;\n\t}\n\tdata = tomoyo_read_token(param);\n\ttype = tomoyo_parse_ulong(&v, &data);\n\tif (type == TOMOYO_VALUE_TYPE_INVALID)\n\t\treturn false;\n\tptr->values[0] = v;\n\tptr->value_type[0] = type;\n\tif (!*data) {\n\t\tptr->values[1] = v;\n\t\tptr->value_type[1] = type;\n\t\treturn true;\n\t}\n\tif (*data++ != '-')\n\t\treturn false;\n\ttype = tomoyo_parse_ulong(&v, &data);\n\tif (type == TOMOYO_VALUE_TYPE_INVALID || *data || ptr->values[0] > v)\n\t\treturn false;\n\tptr->values[1] = v;\n\tptr->value_type[1] = type;\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "tomoyo_parse_name_union",
          "args": [
            "param",
            "&e.fs_type"
          ],
          "line": 971
        },
        "resolved": true,
        "details": {
          "function_name": "tomoyo_parse_name_union_quoted",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/condition.c",
          "lines": "269-277",
          "snippet": "static bool tomoyo_parse_name_union_quoted(struct tomoyo_acl_param *param,\n\t\t\t\t\t   struct tomoyo_name_union *ptr)\n{\n\tchar *filename = param->data;\n\tif (*filename == '@')\n\t\treturn tomoyo_parse_name_union(param, ptr);\n\tptr->filename = tomoyo_get_dqword(filename);\n\treturn ptr->filename != NULL;\n}",
          "includes": [
            "#include <linux/slab.h>",
            "#include \"common.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/slab.h>\n#include \"common.h\"\n\nstatic bool tomoyo_parse_name_union_quoted(struct tomoyo_acl_param *param,\n\t\t\t\t\t   struct tomoyo_name_union *ptr)\n{\n\tchar *filename = param->data;\n\tif (*filename == '@')\n\t\treturn tomoyo_parse_name_union(param, ptr);\n\tptr->filename = tomoyo_get_dqword(filename);\n\treturn ptr->filename != NULL;\n}"
        }
      }
    ],
    "contextual_snippet": "#include <linux/slab.h>\n#include \"common.h\"\n\nstatic int tomoyo_update_mount_acl(struct tomoyo_acl_param *param)\n{\n\tstruct tomoyo_mount_acl e = { .head.type = TOMOYO_TYPE_MOUNT_ACL };\n\tint error;\n\tif (!tomoyo_parse_name_union(param, &e.dev_name) ||\n\t    !tomoyo_parse_name_union(param, &e.dir_name) ||\n\t    !tomoyo_parse_name_union(param, &e.fs_type) ||\n\t    !tomoyo_parse_number_union(param, &e.flags))\n\t\terror = -EINVAL;\n\telse\n\t\terror = tomoyo_update_domain(&e.head, sizeof(e), param,\n\t\t\t\t\t     tomoyo_same_mount_acl, NULL);\n\ttomoyo_put_name_union(&e.dev_name);\n\ttomoyo_put_name_union(&e.dir_name);\n\ttomoyo_put_name_union(&e.fs_type);\n\ttomoyo_put_number_union(&e.flags);\n\treturn error;\n}"
  },
  {
    "function_name": "tomoyo_same_mount_acl",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/file.c",
    "lines": "945-954",
    "snippet": "static bool tomoyo_same_mount_acl(const struct tomoyo_acl_info *a,\n\t\t\t\t  const struct tomoyo_acl_info *b)\n{\n\tconst struct tomoyo_mount_acl *p1 = container_of(a, typeof(*p1), head);\n\tconst struct tomoyo_mount_acl *p2 = container_of(b, typeof(*p2), head);\n\treturn tomoyo_same_name_union(&p1->dev_name, &p2->dev_name) &&\n\t\ttomoyo_same_name_union(&p1->dir_name, &p2->dir_name) &&\n\t\ttomoyo_same_name_union(&p1->fs_type, &p2->fs_type) &&\n\t\ttomoyo_same_number_union(&p1->flags, &p2->flags);\n}",
    "includes": [
      "#include <linux/slab.h>",
      "#include \"common.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "tomoyo_same_number_union",
          "args": [
            "&p1->flags",
            "&p2->flags"
          ],
          "line": 953
        },
        "resolved": true,
        "details": {
          "function_name": "tomoyo_same_number_union",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/common.h",
          "lines": "1244-1250",
          "snippet": "static inline bool tomoyo_same_number_union\n(const struct tomoyo_number_union *a, const struct tomoyo_number_union *b)\n{\n\treturn a->values[0] == b->values[0] && a->values[1] == b->values[1] &&\n\t\ta->group == b->group && a->value_type[0] == b->value_type[0] &&\n\t\ta->value_type[1] == b->value_type[1];\n}",
          "includes": [
            "#include <net/udp.h>",
            "#include <net/ipv6.h>",
            "#include <net/ip.h>",
            "#include <net/af_unix.h>",
            "#include <net/sock.h>",
            "#include <linux/un.h>",
            "#include <linux/in6.h>",
            "#include <linux/in.h>",
            "#include <linux/inet.h>",
            "#include <linux/net.h>",
            "#include <linux/highmem.h>",
            "#include <linux/binfmts.h>",
            "#include <linux/poll.h>",
            "#include <linux/cred.h>",
            "#include <linux/list.h>",
            "#include <linux/mount.h>",
            "#include <linux/namei.h>",
            "#include <linux/sched.h>",
            "#include <linux/fs.h>",
            "#include <linux/kmod.h>",
            "#include <linux/file.h>",
            "#include <linux/mm.h>",
            "#include <linux/string.h>",
            "#include <linux/ctype.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <net/udp.h>\n#include <net/ipv6.h>\n#include <net/ip.h>\n#include <net/af_unix.h>\n#include <net/sock.h>\n#include <linux/un.h>\n#include <linux/in6.h>\n#include <linux/in.h>\n#include <linux/inet.h>\n#include <linux/net.h>\n#include <linux/highmem.h>\n#include <linux/binfmts.h>\n#include <linux/poll.h>\n#include <linux/cred.h>\n#include <linux/list.h>\n#include <linux/mount.h>\n#include <linux/namei.h>\n#include <linux/sched.h>\n#include <linux/fs.h>\n#include <linux/kmod.h>\n#include <linux/file.h>\n#include <linux/mm.h>\n#include <linux/string.h>\n#include <linux/ctype.h>\n\nstatic inline bool tomoyo_same_number_union\n(const struct tomoyo_number_union *a, const struct tomoyo_number_union *b)\n{\n\treturn a->values[0] == b->values[0] && a->values[1] == b->values[1] &&\n\t\ta->group == b->group && a->value_type[0] == b->value_type[0] &&\n\t\ta->value_type[1] == b->value_type[1];\n}"
        }
      },
      {
        "call_info": {
          "callee": "tomoyo_same_name_union",
          "args": [
            "&p1->fs_type",
            "&p2->fs_type"
          ],
          "line": 952
        },
        "resolved": true,
        "details": {
          "function_name": "tomoyo_same_name_union",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/common.h",
          "lines": "1230-1234",
          "snippet": "static inline bool tomoyo_same_name_union\n(const struct tomoyo_name_union *a, const struct tomoyo_name_union *b)\n{\n\treturn a->filename == b->filename && a->group == b->group;\n}",
          "includes": [
            "#include <net/udp.h>",
            "#include <net/ipv6.h>",
            "#include <net/ip.h>",
            "#include <net/af_unix.h>",
            "#include <net/sock.h>",
            "#include <linux/un.h>",
            "#include <linux/in6.h>",
            "#include <linux/in.h>",
            "#include <linux/inet.h>",
            "#include <linux/net.h>",
            "#include <linux/highmem.h>",
            "#include <linux/binfmts.h>",
            "#include <linux/poll.h>",
            "#include <linux/cred.h>",
            "#include <linux/list.h>",
            "#include <linux/mount.h>",
            "#include <linux/namei.h>",
            "#include <linux/sched.h>",
            "#include <linux/fs.h>",
            "#include <linux/kmod.h>",
            "#include <linux/file.h>",
            "#include <linux/mm.h>",
            "#include <linux/string.h>",
            "#include <linux/ctype.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <net/udp.h>\n#include <net/ipv6.h>\n#include <net/ip.h>\n#include <net/af_unix.h>\n#include <net/sock.h>\n#include <linux/un.h>\n#include <linux/in6.h>\n#include <linux/in.h>\n#include <linux/inet.h>\n#include <linux/net.h>\n#include <linux/highmem.h>\n#include <linux/binfmts.h>\n#include <linux/poll.h>\n#include <linux/cred.h>\n#include <linux/list.h>\n#include <linux/mount.h>\n#include <linux/namei.h>\n#include <linux/sched.h>\n#include <linux/fs.h>\n#include <linux/kmod.h>\n#include <linux/file.h>\n#include <linux/mm.h>\n#include <linux/string.h>\n#include <linux/ctype.h>\n\nstatic inline bool tomoyo_same_name_union\n(const struct tomoyo_name_union *a, const struct tomoyo_name_union *b)\n{\n\treturn a->filename == b->filename && a->group == b->group;\n}"
        }
      },
      {
        "call_info": {
          "callee": "container_of",
          "args": [
            "b",
            "typeof(*p2)",
            "head"
          ],
          "line": 949
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "typeof",
          "args": [
            "*p2"
          ],
          "line": 949
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "container_of",
          "args": [
            "a",
            "typeof(*p1)",
            "head"
          ],
          "line": 948
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "typeof",
          "args": [
            "*p1"
          ],
          "line": 948
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <linux/slab.h>\n#include \"common.h\"\n\nstatic bool tomoyo_same_mount_acl(const struct tomoyo_acl_info *a,\n\t\t\t\t  const struct tomoyo_acl_info *b)\n{\n\tconst struct tomoyo_mount_acl *p1 = container_of(a, typeof(*p1), head);\n\tconst struct tomoyo_mount_acl *p2 = container_of(b, typeof(*p2), head);\n\treturn tomoyo_same_name_union(&p1->dev_name, &p2->dev_name) &&\n\t\ttomoyo_same_name_union(&p1->dir_name, &p2->dir_name) &&\n\t\ttomoyo_same_name_union(&p1->fs_type, &p2->fs_type) &&\n\t\ttomoyo_same_number_union(&p1->flags, &p2->flags);\n}"
  },
  {
    "function_name": "tomoyo_path2_perm",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/file.c",
    "lines": "886-935",
    "snippet": "int tomoyo_path2_perm(const u8 operation, const struct path *path1,\n\t\t      const struct path *path2)\n{\n\tint error = -ENOMEM;\n\tstruct tomoyo_path_info buf1;\n\tstruct tomoyo_path_info buf2;\n\tstruct tomoyo_request_info r;\n\tstruct tomoyo_obj_info obj = {\n\t\t.path1 = { .mnt = path1->mnt, .dentry = path1->dentry },\n\t\t.path2 = { .mnt = path2->mnt, .dentry = path2->dentry }\n\t};\n\tint idx;\n\n\tif (tomoyo_init_request_info(&r, NULL, tomoyo_pp2mac[operation])\n\t    == TOMOYO_CONFIG_DISABLED)\n\t\treturn 0;\n\tbuf1.name = NULL;\n\tbuf2.name = NULL;\n\tidx = tomoyo_read_lock();\n\tif (!tomoyo_get_realpath(&buf1, path1) ||\n\t    !tomoyo_get_realpath(&buf2, path2))\n\t\tgoto out;\n\tswitch (operation) {\n\tcase TOMOYO_TYPE_RENAME:\n\tcase TOMOYO_TYPE_LINK:\n\t\tif (!d_is_dir(path1->dentry))\n\t\t\tbreak;\n\t\t/* fall through */\n\tcase TOMOYO_TYPE_PIVOT_ROOT:\n\t\ttomoyo_add_slash(&buf1);\n\t\ttomoyo_add_slash(&buf2);\n\t\tbreak;\n\t}\n\tr.obj = &obj;\n\tr.param_type = TOMOYO_TYPE_PATH2_ACL;\n\tr.param.path2.operation = operation;\n\tr.param.path2.filename1 = &buf1;\n\tr.param.path2.filename2 = &buf2;\n\tdo {\n\t\ttomoyo_check_acl(&r, tomoyo_check_path2_acl);\n\t\terror = tomoyo_audit_path2_log(&r);\n\t} while (error == TOMOYO_RETRY_REQUEST);\n out:\n\tkfree(buf1.name);\n\tkfree(buf2.name);\n\ttomoyo_read_unlock(idx);\n\tif (r.mode != TOMOYO_CONFIG_ENFORCING)\n\t\terror = 0;\n\treturn error;\n}",
    "includes": [
      "#include <linux/slab.h>",
      "#include \"common.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "const u8 tomoyo_pp2mac[TOMOYO_MAX_PATH2_OPERATION] = {\n\t[TOMOYO_TYPE_LINK]       = TOMOYO_MAC_FILE_LINK,\n\t[TOMOYO_TYPE_RENAME]     = TOMOYO_MAC_FILE_RENAME,\n\t[TOMOYO_TYPE_PIVOT_ROOT] = TOMOYO_MAC_FILE_PIVOT_ROOT,\n};"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "tomoyo_read_unlock",
          "args": [
            "idx"
          ],
          "line": 931
        },
        "resolved": true,
        "details": {
          "function_name": "tomoyo_read_unlock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/common.h",
          "lines": "1108-1111",
          "snippet": "static inline void tomoyo_read_unlock(int idx)\n{\n\tsrcu_read_unlock(&tomoyo_ss, idx);\n}",
          "includes": [
            "#include <net/udp.h>",
            "#include <net/ipv6.h>",
            "#include <net/ip.h>",
            "#include <net/af_unix.h>",
            "#include <net/sock.h>",
            "#include <linux/un.h>",
            "#include <linux/in6.h>",
            "#include <linux/in.h>",
            "#include <linux/inet.h>",
            "#include <linux/net.h>",
            "#include <linux/highmem.h>",
            "#include <linux/binfmts.h>",
            "#include <linux/poll.h>",
            "#include <linux/cred.h>",
            "#include <linux/list.h>",
            "#include <linux/mount.h>",
            "#include <linux/namei.h>",
            "#include <linux/sched.h>",
            "#include <linux/fs.h>",
            "#include <linux/kmod.h>",
            "#include <linux/file.h>",
            "#include <linux/mm.h>",
            "#include <linux/string.h>",
            "#include <linux/ctype.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <net/udp.h>\n#include <net/ipv6.h>\n#include <net/ip.h>\n#include <net/af_unix.h>\n#include <net/sock.h>\n#include <linux/un.h>\n#include <linux/in6.h>\n#include <linux/in.h>\n#include <linux/inet.h>\n#include <linux/net.h>\n#include <linux/highmem.h>\n#include <linux/binfmts.h>\n#include <linux/poll.h>\n#include <linux/cred.h>\n#include <linux/list.h>\n#include <linux/mount.h>\n#include <linux/namei.h>\n#include <linux/sched.h>\n#include <linux/fs.h>\n#include <linux/kmod.h>\n#include <linux/file.h>\n#include <linux/mm.h>\n#include <linux/string.h>\n#include <linux/ctype.h>\n\nstatic inline void tomoyo_read_unlock(int idx)\n{\n\tsrcu_read_unlock(&tomoyo_ss, idx);\n}"
        }
      },
      {
        "call_info": {
          "callee": "kfree",
          "args": [
            "buf2.name"
          ],
          "line": 930
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kfree",
          "args": [
            "buf1.name"
          ],
          "line": 929
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "tomoyo_audit_path2_log",
          "args": [
            "&r"
          ],
          "line": 926
        },
        "resolved": true,
        "details": {
          "function_name": "tomoyo_audit_path2_log",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/file.c",
          "lines": "180-186",
          "snippet": "static int tomoyo_audit_path2_log(struct tomoyo_request_info *r)\n{\n\treturn tomoyo_supervisor(r, \"file %s %s %s\\n\", tomoyo_mac_keywords\n\t\t\t\t [tomoyo_pp2mac[r->param.path2.operation]],\n\t\t\t\t r->param.path2.filename1->name,\n\t\t\t\t r->param.path2.filename2->name);\n}",
          "includes": [
            "#include <linux/slab.h>",
            "#include \"common.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "const u8 tomoyo_pp2mac[TOMOYO_MAX_PATH2_OPERATION] = {\n\t[TOMOYO_TYPE_LINK]       = TOMOYO_MAC_FILE_LINK,\n\t[TOMOYO_TYPE_RENAME]     = TOMOYO_MAC_FILE_RENAME,\n\t[TOMOYO_TYPE_PIVOT_ROOT] = TOMOYO_MAC_FILE_PIVOT_ROOT,\n};"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <linux/slab.h>\n#include \"common.h\"\n\nconst u8 tomoyo_pp2mac[TOMOYO_MAX_PATH2_OPERATION] = {\n\t[TOMOYO_TYPE_LINK]       = TOMOYO_MAC_FILE_LINK,\n\t[TOMOYO_TYPE_RENAME]     = TOMOYO_MAC_FILE_RENAME,\n\t[TOMOYO_TYPE_PIVOT_ROOT] = TOMOYO_MAC_FILE_PIVOT_ROOT,\n};\n\nstatic int tomoyo_audit_path2_log(struct tomoyo_request_info *r)\n{\n\treturn tomoyo_supervisor(r, \"file %s %s %s\\n\", tomoyo_mac_keywords\n\t\t\t\t [tomoyo_pp2mac[r->param.path2.operation]],\n\t\t\t\t r->param.path2.filename1->name,\n\t\t\t\t r->param.path2.filename2->name);\n}"
        }
      },
      {
        "call_info": {
          "callee": "tomoyo_check_acl",
          "args": [
            "&r",
            "tomoyo_check_path2_acl"
          ],
          "line": 925
        },
        "resolved": true,
        "details": {
          "function_name": "tomoyo_check_acl",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/domain.c",
          "lines": "159-186",
          "snippet": "void tomoyo_check_acl(struct tomoyo_request_info *r,\n\t\t      bool (*check_entry) (struct tomoyo_request_info *,\n\t\t\t\t\t   const struct tomoyo_acl_info *))\n{\n\tconst struct tomoyo_domain_info *domain = r->domain;\n\tstruct tomoyo_acl_info *ptr;\n\tbool retried = false;\n\tconst struct list_head *list = &domain->acl_info_list;\n\nretry:\n\tlist_for_each_entry_rcu(ptr, list, list) {\n\t\tif (ptr->is_deleted || ptr->type != r->param_type)\n\t\t\tcontinue;\n\t\tif (!check_entry(r, ptr))\n\t\t\tcontinue;\n\t\tif (!tomoyo_condition(r, ptr->cond))\n\t\t\tcontinue;\n\t\tr->matched_acl = ptr;\n\t\tr->granted = true;\n\t\treturn;\n\t}\n\tif (!retried) {\n\t\tretried = true;\n\t\tlist = &domain->ns->acl_group[domain->group];\n\t\tgoto retry;\n\t}\n\tr->granted = false;\n}",
          "includes": [
            "#include <linux/rculist.h>",
            "#include <linux/slab.h>",
            "#include <linux/binfmts.h>",
            "#include \"common.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/rculist.h>\n#include <linux/slab.h>\n#include <linux/binfmts.h>\n#include \"common.h\"\n\nvoid tomoyo_check_acl(struct tomoyo_request_info *r,\n\t\t      bool (*check_entry) (struct tomoyo_request_info *,\n\t\t\t\t\t   const struct tomoyo_acl_info *))\n{\n\tconst struct tomoyo_domain_info *domain = r->domain;\n\tstruct tomoyo_acl_info *ptr;\n\tbool retried = false;\n\tconst struct list_head *list = &domain->acl_info_list;\n\nretry:\n\tlist_for_each_entry_rcu(ptr, list, list) {\n\t\tif (ptr->is_deleted || ptr->type != r->param_type)\n\t\t\tcontinue;\n\t\tif (!check_entry(r, ptr))\n\t\t\tcontinue;\n\t\tif (!tomoyo_condition(r, ptr->cond))\n\t\t\tcontinue;\n\t\tr->matched_acl = ptr;\n\t\tr->granted = true;\n\t\treturn;\n\t}\n\tif (!retried) {\n\t\tretried = true;\n\t\tlist = &domain->ns->acl_group[domain->group];\n\t\tgoto retry;\n\t}\n\tr->granted = false;\n}"
        }
      },
      {
        "call_info": {
          "callee": "tomoyo_add_slash",
          "args": [
            "&buf2"
          ],
          "line": 916
        },
        "resolved": true,
        "details": {
          "function_name": "tomoyo_add_slash",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/file.c",
          "lines": "130-139",
          "snippet": "static void tomoyo_add_slash(struct tomoyo_path_info *buf)\n{\n\tif (buf->is_dir)\n\t\treturn;\n\t/*\n\t * This is OK because tomoyo_encode() reserves space for appending \"/\".\n\t */\n\tstrcat((char *) buf->name, \"/\");\n\ttomoyo_fill_path_info(buf);\n}",
          "includes": [
            "#include <linux/slab.h>",
            "#include \"common.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/slab.h>\n#include \"common.h\"\n\nstatic void tomoyo_add_slash(struct tomoyo_path_info *buf)\n{\n\tif (buf->is_dir)\n\t\treturn;\n\t/*\n\t * This is OK because tomoyo_encode() reserves space for appending \"/\".\n\t */\n\tstrcat((char *) buf->name, \"/\");\n\ttomoyo_fill_path_info(buf);\n}"
        }
      },
      {
        "call_info": {
          "callee": "d_is_dir",
          "args": [
            "path1->dentry"
          ],
          "line": 911
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "tomoyo_get_realpath",
          "args": [
            "&buf2",
            "path2"
          ],
          "line": 906
        },
        "resolved": true,
        "details": {
          "function_name": "tomoyo_get_realpath",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/file.c",
          "lines": "149-157",
          "snippet": "static bool tomoyo_get_realpath(struct tomoyo_path_info *buf, const struct path *path)\n{\n\tbuf->name = tomoyo_realpath_from_path(path);\n\tif (buf->name) {\n\t\ttomoyo_fill_path_info(buf);\n\t\treturn true;\n\t}\n\treturn false;\n}",
          "includes": [
            "#include <linux/slab.h>",
            "#include \"common.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/slab.h>\n#include \"common.h\"\n\nstatic bool tomoyo_get_realpath(struct tomoyo_path_info *buf, const struct path *path)\n{\n\tbuf->name = tomoyo_realpath_from_path(path);\n\tif (buf->name) {\n\t\ttomoyo_fill_path_info(buf);\n\t\treturn true;\n\t}\n\treturn false;\n}"
        }
      },
      {
        "call_info": {
          "callee": "tomoyo_read_lock",
          "args": [],
          "line": 904
        },
        "resolved": true,
        "details": {
          "function_name": "tomoyo_read_lock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/common.h",
          "lines": "1096-1099",
          "snippet": "static inline int tomoyo_read_lock(void)\n{\n\treturn srcu_read_lock(&tomoyo_ss);\n}",
          "includes": [
            "#include <net/udp.h>",
            "#include <net/ipv6.h>",
            "#include <net/ip.h>",
            "#include <net/af_unix.h>",
            "#include <net/sock.h>",
            "#include <linux/un.h>",
            "#include <linux/in6.h>",
            "#include <linux/in.h>",
            "#include <linux/inet.h>",
            "#include <linux/net.h>",
            "#include <linux/highmem.h>",
            "#include <linux/binfmts.h>",
            "#include <linux/poll.h>",
            "#include <linux/cred.h>",
            "#include <linux/list.h>",
            "#include <linux/mount.h>",
            "#include <linux/namei.h>",
            "#include <linux/sched.h>",
            "#include <linux/fs.h>",
            "#include <linux/kmod.h>",
            "#include <linux/file.h>",
            "#include <linux/mm.h>",
            "#include <linux/string.h>",
            "#include <linux/ctype.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <net/udp.h>\n#include <net/ipv6.h>\n#include <net/ip.h>\n#include <net/af_unix.h>\n#include <net/sock.h>\n#include <linux/un.h>\n#include <linux/in6.h>\n#include <linux/in.h>\n#include <linux/inet.h>\n#include <linux/net.h>\n#include <linux/highmem.h>\n#include <linux/binfmts.h>\n#include <linux/poll.h>\n#include <linux/cred.h>\n#include <linux/list.h>\n#include <linux/mount.h>\n#include <linux/namei.h>\n#include <linux/sched.h>\n#include <linux/fs.h>\n#include <linux/kmod.h>\n#include <linux/file.h>\n#include <linux/mm.h>\n#include <linux/string.h>\n#include <linux/ctype.h>\n\nstatic inline int tomoyo_read_lock(void)\n{\n\treturn srcu_read_lock(&tomoyo_ss);\n}"
        }
      },
      {
        "call_info": {
          "callee": "tomoyo_init_request_info",
          "args": [
            "&r",
            "NULL",
            "tomoyo_pp2mac[operation]"
          ],
          "line": 899
        },
        "resolved": true,
        "details": {
          "function_name": "tomoyo_init_request_info",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/util.c",
          "lines": "984-997",
          "snippet": "int tomoyo_init_request_info(struct tomoyo_request_info *r,\n\t\t\t     struct tomoyo_domain_info *domain, const u8 index)\n{\n\tu8 profile;\n\tmemset(r, 0, sizeof(*r));\n\tif (!domain)\n\t\tdomain = tomoyo_domain();\n\tr->domain = domain;\n\tprofile = domain->profile;\n\tr->profile = profile;\n\tr->type = index;\n\tr->mode = tomoyo_get_mode(domain->ns, profile, index);\n\treturn r->mode;\n}",
          "includes": [
            "#include \"common.h\"",
            "#include <linux/rculist.h>",
            "#include <linux/slab.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common.h\"\n#include <linux/rculist.h>\n#include <linux/slab.h>\n\nint tomoyo_init_request_info(struct tomoyo_request_info *r,\n\t\t\t     struct tomoyo_domain_info *domain, const u8 index)\n{\n\tu8 profile;\n\tmemset(r, 0, sizeof(*r));\n\tif (!domain)\n\t\tdomain = tomoyo_domain();\n\tr->domain = domain;\n\tprofile = domain->profile;\n\tr->profile = profile;\n\tr->type = index;\n\tr->mode = tomoyo_get_mode(domain->ns, profile, index);\n\treturn r->mode;\n}"
        }
      }
    ],
    "contextual_snippet": "#include <linux/slab.h>\n#include \"common.h\"\n\nconst u8 tomoyo_pp2mac[TOMOYO_MAX_PATH2_OPERATION] = {\n\t[TOMOYO_TYPE_LINK]       = TOMOYO_MAC_FILE_LINK,\n\t[TOMOYO_TYPE_RENAME]     = TOMOYO_MAC_FILE_RENAME,\n\t[TOMOYO_TYPE_PIVOT_ROOT] = TOMOYO_MAC_FILE_PIVOT_ROOT,\n};\n\nint tomoyo_path2_perm(const u8 operation, const struct path *path1,\n\t\t      const struct path *path2)\n{\n\tint error = -ENOMEM;\n\tstruct tomoyo_path_info buf1;\n\tstruct tomoyo_path_info buf2;\n\tstruct tomoyo_request_info r;\n\tstruct tomoyo_obj_info obj = {\n\t\t.path1 = { .mnt = path1->mnt, .dentry = path1->dentry },\n\t\t.path2 = { .mnt = path2->mnt, .dentry = path2->dentry }\n\t};\n\tint idx;\n\n\tif (tomoyo_init_request_info(&r, NULL, tomoyo_pp2mac[operation])\n\t    == TOMOYO_CONFIG_DISABLED)\n\t\treturn 0;\n\tbuf1.name = NULL;\n\tbuf2.name = NULL;\n\tidx = tomoyo_read_lock();\n\tif (!tomoyo_get_realpath(&buf1, path1) ||\n\t    !tomoyo_get_realpath(&buf2, path2))\n\t\tgoto out;\n\tswitch (operation) {\n\tcase TOMOYO_TYPE_RENAME:\n\tcase TOMOYO_TYPE_LINK:\n\t\tif (!d_is_dir(path1->dentry))\n\t\t\tbreak;\n\t\t/* fall through */\n\tcase TOMOYO_TYPE_PIVOT_ROOT:\n\t\ttomoyo_add_slash(&buf1);\n\t\ttomoyo_add_slash(&buf2);\n\t\tbreak;\n\t}\n\tr.obj = &obj;\n\tr.param_type = TOMOYO_TYPE_PATH2_ACL;\n\tr.param.path2.operation = operation;\n\tr.param.path2.filename1 = &buf1;\n\tr.param.path2.filename2 = &buf2;\n\tdo {\n\t\ttomoyo_check_acl(&r, tomoyo_check_path2_acl);\n\t\terror = tomoyo_audit_path2_log(&r);\n\t} while (error == TOMOYO_RETRY_REQUEST);\n out:\n\tkfree(buf1.name);\n\tkfree(buf2.name);\n\ttomoyo_read_unlock(idx);\n\tif (r.mode != TOMOYO_CONFIG_ENFORCING)\n\t\terror = 0;\n\treturn error;\n}"
  },
  {
    "function_name": "tomoyo_mkdev_perm",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/file.c",
    "lines": "842-875",
    "snippet": "int tomoyo_mkdev_perm(const u8 operation, const struct path *path,\n\t\t      const unsigned int mode, unsigned int dev)\n{\n\tstruct tomoyo_request_info r;\n\tstruct tomoyo_obj_info obj = {\n\t\t.path1 = { .mnt = path->mnt, .dentry = path->dentry },\n\t};\n\tint error = -ENOMEM;\n\tstruct tomoyo_path_info buf;\n\tint idx;\n\n\tif (tomoyo_init_request_info(&r, NULL, tomoyo_pnnn2mac[operation])\n\t    == TOMOYO_CONFIG_DISABLED)\n\t\treturn 0;\n\tidx = tomoyo_read_lock();\n\terror = -ENOMEM;\n\tif (tomoyo_get_realpath(&buf, path)) {\n\t\tr.obj = &obj;\n\t\tdev = new_decode_dev(dev);\n\t\tr.param_type = TOMOYO_TYPE_MKDEV_ACL;\n\t\tr.param.mkdev.filename = &buf;\n\t\tr.param.mkdev.operation = operation;\n\t\tr.param.mkdev.mode = mode;\n\t\tr.param.mkdev.major = MAJOR(dev);\n\t\tr.param.mkdev.minor = MINOR(dev);\n\t\ttomoyo_check_acl(&r, tomoyo_check_mkdev_acl);\n\t\terror = tomoyo_audit_mkdev_log(&r);\n\t\tkfree(buf.name);\n\t}\n\ttomoyo_read_unlock(idx);\n\tif (r.mode != TOMOYO_CONFIG_ENFORCING)\n\t\terror = 0;\n\treturn error;\n}",
    "includes": [
      "#include <linux/slab.h>",
      "#include \"common.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "const u8 tomoyo_pnnn2mac[TOMOYO_MAX_MKDEV_OPERATION] = {\n\t[TOMOYO_TYPE_MKBLOCK] = TOMOYO_MAC_FILE_MKBLOCK,\n\t[TOMOYO_TYPE_MKCHAR]  = TOMOYO_MAC_FILE_MKCHAR,\n};"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "tomoyo_read_unlock",
          "args": [
            "idx"
          ],
          "line": 871
        },
        "resolved": true,
        "details": {
          "function_name": "tomoyo_read_unlock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/common.h",
          "lines": "1108-1111",
          "snippet": "static inline void tomoyo_read_unlock(int idx)\n{\n\tsrcu_read_unlock(&tomoyo_ss, idx);\n}",
          "includes": [
            "#include <net/udp.h>",
            "#include <net/ipv6.h>",
            "#include <net/ip.h>",
            "#include <net/af_unix.h>",
            "#include <net/sock.h>",
            "#include <linux/un.h>",
            "#include <linux/in6.h>",
            "#include <linux/in.h>",
            "#include <linux/inet.h>",
            "#include <linux/net.h>",
            "#include <linux/highmem.h>",
            "#include <linux/binfmts.h>",
            "#include <linux/poll.h>",
            "#include <linux/cred.h>",
            "#include <linux/list.h>",
            "#include <linux/mount.h>",
            "#include <linux/namei.h>",
            "#include <linux/sched.h>",
            "#include <linux/fs.h>",
            "#include <linux/kmod.h>",
            "#include <linux/file.h>",
            "#include <linux/mm.h>",
            "#include <linux/string.h>",
            "#include <linux/ctype.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <net/udp.h>\n#include <net/ipv6.h>\n#include <net/ip.h>\n#include <net/af_unix.h>\n#include <net/sock.h>\n#include <linux/un.h>\n#include <linux/in6.h>\n#include <linux/in.h>\n#include <linux/inet.h>\n#include <linux/net.h>\n#include <linux/highmem.h>\n#include <linux/binfmts.h>\n#include <linux/poll.h>\n#include <linux/cred.h>\n#include <linux/list.h>\n#include <linux/mount.h>\n#include <linux/namei.h>\n#include <linux/sched.h>\n#include <linux/fs.h>\n#include <linux/kmod.h>\n#include <linux/file.h>\n#include <linux/mm.h>\n#include <linux/string.h>\n#include <linux/ctype.h>\n\nstatic inline void tomoyo_read_unlock(int idx)\n{\n\tsrcu_read_unlock(&tomoyo_ss, idx);\n}"
        }
      },
      {
        "call_info": {
          "callee": "kfree",
          "args": [
            "buf.name"
          ],
          "line": 869
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "tomoyo_audit_mkdev_log",
          "args": [
            "&r"
          ],
          "line": 868
        },
        "resolved": true,
        "details": {
          "function_name": "tomoyo_audit_mkdev_log",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/file.c",
          "lines": "195-203",
          "snippet": "static int tomoyo_audit_mkdev_log(struct tomoyo_request_info *r)\n{\n\treturn tomoyo_supervisor(r, \"file %s %s 0%o %u %u\\n\",\n\t\t\t\t tomoyo_mac_keywords\n\t\t\t\t [tomoyo_pnnn2mac[r->param.mkdev.operation]],\n\t\t\t\t r->param.mkdev.filename->name,\n\t\t\t\t r->param.mkdev.mode, r->param.mkdev.major,\n\t\t\t\t r->param.mkdev.minor);\n}",
          "includes": [
            "#include <linux/slab.h>",
            "#include \"common.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "const u8 tomoyo_pnnn2mac[TOMOYO_MAX_MKDEV_OPERATION] = {\n\t[TOMOYO_TYPE_MKBLOCK] = TOMOYO_MAC_FILE_MKBLOCK,\n\t[TOMOYO_TYPE_MKCHAR]  = TOMOYO_MAC_FILE_MKCHAR,\n};"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <linux/slab.h>\n#include \"common.h\"\n\nconst u8 tomoyo_pnnn2mac[TOMOYO_MAX_MKDEV_OPERATION] = {\n\t[TOMOYO_TYPE_MKBLOCK] = TOMOYO_MAC_FILE_MKBLOCK,\n\t[TOMOYO_TYPE_MKCHAR]  = TOMOYO_MAC_FILE_MKCHAR,\n};\n\nstatic int tomoyo_audit_mkdev_log(struct tomoyo_request_info *r)\n{\n\treturn tomoyo_supervisor(r, \"file %s %s 0%o %u %u\\n\",\n\t\t\t\t tomoyo_mac_keywords\n\t\t\t\t [tomoyo_pnnn2mac[r->param.mkdev.operation]],\n\t\t\t\t r->param.mkdev.filename->name,\n\t\t\t\t r->param.mkdev.mode, r->param.mkdev.major,\n\t\t\t\t r->param.mkdev.minor);\n}"
        }
      },
      {
        "call_info": {
          "callee": "tomoyo_check_acl",
          "args": [
            "&r",
            "tomoyo_check_mkdev_acl"
          ],
          "line": 867
        },
        "resolved": true,
        "details": {
          "function_name": "tomoyo_check_acl",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/domain.c",
          "lines": "159-186",
          "snippet": "void tomoyo_check_acl(struct tomoyo_request_info *r,\n\t\t      bool (*check_entry) (struct tomoyo_request_info *,\n\t\t\t\t\t   const struct tomoyo_acl_info *))\n{\n\tconst struct tomoyo_domain_info *domain = r->domain;\n\tstruct tomoyo_acl_info *ptr;\n\tbool retried = false;\n\tconst struct list_head *list = &domain->acl_info_list;\n\nretry:\n\tlist_for_each_entry_rcu(ptr, list, list) {\n\t\tif (ptr->is_deleted || ptr->type != r->param_type)\n\t\t\tcontinue;\n\t\tif (!check_entry(r, ptr))\n\t\t\tcontinue;\n\t\tif (!tomoyo_condition(r, ptr->cond))\n\t\t\tcontinue;\n\t\tr->matched_acl = ptr;\n\t\tr->granted = true;\n\t\treturn;\n\t}\n\tif (!retried) {\n\t\tretried = true;\n\t\tlist = &domain->ns->acl_group[domain->group];\n\t\tgoto retry;\n\t}\n\tr->granted = false;\n}",
          "includes": [
            "#include <linux/rculist.h>",
            "#include <linux/slab.h>",
            "#include <linux/binfmts.h>",
            "#include \"common.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/rculist.h>\n#include <linux/slab.h>\n#include <linux/binfmts.h>\n#include \"common.h\"\n\nvoid tomoyo_check_acl(struct tomoyo_request_info *r,\n\t\t      bool (*check_entry) (struct tomoyo_request_info *,\n\t\t\t\t\t   const struct tomoyo_acl_info *))\n{\n\tconst struct tomoyo_domain_info *domain = r->domain;\n\tstruct tomoyo_acl_info *ptr;\n\tbool retried = false;\n\tconst struct list_head *list = &domain->acl_info_list;\n\nretry:\n\tlist_for_each_entry_rcu(ptr, list, list) {\n\t\tif (ptr->is_deleted || ptr->type != r->param_type)\n\t\t\tcontinue;\n\t\tif (!check_entry(r, ptr))\n\t\t\tcontinue;\n\t\tif (!tomoyo_condition(r, ptr->cond))\n\t\t\tcontinue;\n\t\tr->matched_acl = ptr;\n\t\tr->granted = true;\n\t\treturn;\n\t}\n\tif (!retried) {\n\t\tretried = true;\n\t\tlist = &domain->ns->acl_group[domain->group];\n\t\tgoto retry;\n\t}\n\tr->granted = false;\n}"
        }
      },
      {
        "call_info": {
          "callee": "MINOR",
          "args": [
            "dev"
          ],
          "line": 866
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "MAJOR",
          "args": [
            "dev"
          ],
          "line": 865
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "new_decode_dev",
          "args": [
            "dev"
          ],
          "line": 860
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "tomoyo_get_realpath",
          "args": [
            "&buf",
            "path"
          ],
          "line": 858
        },
        "resolved": true,
        "details": {
          "function_name": "tomoyo_get_realpath",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/file.c",
          "lines": "149-157",
          "snippet": "static bool tomoyo_get_realpath(struct tomoyo_path_info *buf, const struct path *path)\n{\n\tbuf->name = tomoyo_realpath_from_path(path);\n\tif (buf->name) {\n\t\ttomoyo_fill_path_info(buf);\n\t\treturn true;\n\t}\n\treturn false;\n}",
          "includes": [
            "#include <linux/slab.h>",
            "#include \"common.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/slab.h>\n#include \"common.h\"\n\nstatic bool tomoyo_get_realpath(struct tomoyo_path_info *buf, const struct path *path)\n{\n\tbuf->name = tomoyo_realpath_from_path(path);\n\tif (buf->name) {\n\t\ttomoyo_fill_path_info(buf);\n\t\treturn true;\n\t}\n\treturn false;\n}"
        }
      },
      {
        "call_info": {
          "callee": "tomoyo_read_lock",
          "args": [],
          "line": 856
        },
        "resolved": true,
        "details": {
          "function_name": "tomoyo_read_lock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/common.h",
          "lines": "1096-1099",
          "snippet": "static inline int tomoyo_read_lock(void)\n{\n\treturn srcu_read_lock(&tomoyo_ss);\n}",
          "includes": [
            "#include <net/udp.h>",
            "#include <net/ipv6.h>",
            "#include <net/ip.h>",
            "#include <net/af_unix.h>",
            "#include <net/sock.h>",
            "#include <linux/un.h>",
            "#include <linux/in6.h>",
            "#include <linux/in.h>",
            "#include <linux/inet.h>",
            "#include <linux/net.h>",
            "#include <linux/highmem.h>",
            "#include <linux/binfmts.h>",
            "#include <linux/poll.h>",
            "#include <linux/cred.h>",
            "#include <linux/list.h>",
            "#include <linux/mount.h>",
            "#include <linux/namei.h>",
            "#include <linux/sched.h>",
            "#include <linux/fs.h>",
            "#include <linux/kmod.h>",
            "#include <linux/file.h>",
            "#include <linux/mm.h>",
            "#include <linux/string.h>",
            "#include <linux/ctype.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <net/udp.h>\n#include <net/ipv6.h>\n#include <net/ip.h>\n#include <net/af_unix.h>\n#include <net/sock.h>\n#include <linux/un.h>\n#include <linux/in6.h>\n#include <linux/in.h>\n#include <linux/inet.h>\n#include <linux/net.h>\n#include <linux/highmem.h>\n#include <linux/binfmts.h>\n#include <linux/poll.h>\n#include <linux/cred.h>\n#include <linux/list.h>\n#include <linux/mount.h>\n#include <linux/namei.h>\n#include <linux/sched.h>\n#include <linux/fs.h>\n#include <linux/kmod.h>\n#include <linux/file.h>\n#include <linux/mm.h>\n#include <linux/string.h>\n#include <linux/ctype.h>\n\nstatic inline int tomoyo_read_lock(void)\n{\n\treturn srcu_read_lock(&tomoyo_ss);\n}"
        }
      },
      {
        "call_info": {
          "callee": "tomoyo_init_request_info",
          "args": [
            "&r",
            "NULL",
            "tomoyo_pnnn2mac[operation]"
          ],
          "line": 853
        },
        "resolved": true,
        "details": {
          "function_name": "tomoyo_init_request_info",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/util.c",
          "lines": "984-997",
          "snippet": "int tomoyo_init_request_info(struct tomoyo_request_info *r,\n\t\t\t     struct tomoyo_domain_info *domain, const u8 index)\n{\n\tu8 profile;\n\tmemset(r, 0, sizeof(*r));\n\tif (!domain)\n\t\tdomain = tomoyo_domain();\n\tr->domain = domain;\n\tprofile = domain->profile;\n\tr->profile = profile;\n\tr->type = index;\n\tr->mode = tomoyo_get_mode(domain->ns, profile, index);\n\treturn r->mode;\n}",
          "includes": [
            "#include \"common.h\"",
            "#include <linux/rculist.h>",
            "#include <linux/slab.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common.h\"\n#include <linux/rculist.h>\n#include <linux/slab.h>\n\nint tomoyo_init_request_info(struct tomoyo_request_info *r,\n\t\t\t     struct tomoyo_domain_info *domain, const u8 index)\n{\n\tu8 profile;\n\tmemset(r, 0, sizeof(*r));\n\tif (!domain)\n\t\tdomain = tomoyo_domain();\n\tr->domain = domain;\n\tprofile = domain->profile;\n\tr->profile = profile;\n\tr->type = index;\n\tr->mode = tomoyo_get_mode(domain->ns, profile, index);\n\treturn r->mode;\n}"
        }
      }
    ],
    "contextual_snippet": "#include <linux/slab.h>\n#include \"common.h\"\n\nconst u8 tomoyo_pnnn2mac[TOMOYO_MAX_MKDEV_OPERATION] = {\n\t[TOMOYO_TYPE_MKBLOCK] = TOMOYO_MAC_FILE_MKBLOCK,\n\t[TOMOYO_TYPE_MKCHAR]  = TOMOYO_MAC_FILE_MKCHAR,\n};\n\nint tomoyo_mkdev_perm(const u8 operation, const struct path *path,\n\t\t      const unsigned int mode, unsigned int dev)\n{\n\tstruct tomoyo_request_info r;\n\tstruct tomoyo_obj_info obj = {\n\t\t.path1 = { .mnt = path->mnt, .dentry = path->dentry },\n\t};\n\tint error = -ENOMEM;\n\tstruct tomoyo_path_info buf;\n\tint idx;\n\n\tif (tomoyo_init_request_info(&r, NULL, tomoyo_pnnn2mac[operation])\n\t    == TOMOYO_CONFIG_DISABLED)\n\t\treturn 0;\n\tidx = tomoyo_read_lock();\n\terror = -ENOMEM;\n\tif (tomoyo_get_realpath(&buf, path)) {\n\t\tr.obj = &obj;\n\t\tdev = new_decode_dev(dev);\n\t\tr.param_type = TOMOYO_TYPE_MKDEV_ACL;\n\t\tr.param.mkdev.filename = &buf;\n\t\tr.param.mkdev.operation = operation;\n\t\tr.param.mkdev.mode = mode;\n\t\tr.param.mkdev.major = MAJOR(dev);\n\t\tr.param.mkdev.minor = MINOR(dev);\n\t\ttomoyo_check_acl(&r, tomoyo_check_mkdev_acl);\n\t\terror = tomoyo_audit_mkdev_log(&r);\n\t\tkfree(buf.name);\n\t}\n\ttomoyo_read_unlock(idx);\n\tif (r.mode != TOMOYO_CONFIG_ENFORCING)\n\t\terror = 0;\n\treturn error;\n}"
  },
  {
    "function_name": "tomoyo_path_perm",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/file.c",
    "lines": "786-830",
    "snippet": "int tomoyo_path_perm(const u8 operation, const struct path *path, const char *target)\n{\n\tstruct tomoyo_request_info r;\n\tstruct tomoyo_obj_info obj = {\n\t\t.path1 = { .mnt = path->mnt, .dentry = path->dentry },\n\t};\n\tint error;\n\tstruct tomoyo_path_info buf;\n\tbool is_enforce;\n\tstruct tomoyo_path_info symlink_target;\n\tint idx;\n\n\tif (tomoyo_init_request_info(&r, NULL, tomoyo_p2mac[operation])\n\t    == TOMOYO_CONFIG_DISABLED)\n\t\treturn 0;\n\tis_enforce = (r.mode == TOMOYO_CONFIG_ENFORCING);\n\terror = -ENOMEM;\n\tbuf.name = NULL;\n\tidx = tomoyo_read_lock();\n\tif (!tomoyo_get_realpath(&buf, path))\n\t\tgoto out;\n\tr.obj = &obj;\n\tswitch (operation) {\n\tcase TOMOYO_TYPE_RMDIR:\n\tcase TOMOYO_TYPE_CHROOT:\n\t\ttomoyo_add_slash(&buf);\n\t\tbreak;\n\tcase TOMOYO_TYPE_SYMLINK:\n\t\tsymlink_target.name = tomoyo_encode(target);\n\t\tif (!symlink_target.name)\n\t\t\tgoto out;\n\t\ttomoyo_fill_path_info(&symlink_target);\n\t\tobj.symlink_target = &symlink_target;\n\t\tbreak;\n\t}\n\terror = tomoyo_path_permission(&r, operation, &buf);\n\tif (operation == TOMOYO_TYPE_SYMLINK)\n\t\tkfree(symlink_target.name);\n out:\n\tkfree(buf.name);\n\ttomoyo_read_unlock(idx);\n\tif (!is_enforce)\n\t\terror = 0;\n\treturn error;\n}",
    "includes": [
      "#include <linux/slab.h>",
      "#include \"common.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "static const u8 tomoyo_p2mac[TOMOYO_MAX_PATH_OPERATION] = {\n\t[TOMOYO_TYPE_EXECUTE]    = TOMOYO_MAC_FILE_EXECUTE,\n\t[TOMOYO_TYPE_READ]       = TOMOYO_MAC_FILE_OPEN,\n\t[TOMOYO_TYPE_WRITE]      = TOMOYO_MAC_FILE_OPEN,\n\t[TOMOYO_TYPE_APPEND]     = TOMOYO_MAC_FILE_OPEN,\n\t[TOMOYO_TYPE_UNLINK]     = TOMOYO_MAC_FILE_UNLINK,\n\t[TOMOYO_TYPE_GETATTR]    = TOMOYO_MAC_FILE_GETATTR,\n\t[TOMOYO_TYPE_RMDIR]      = TOMOYO_MAC_FILE_RMDIR,\n\t[TOMOYO_TYPE_TRUNCATE]   = TOMOYO_MAC_FILE_TRUNCATE,\n\t[TOMOYO_TYPE_SYMLINK]    = TOMOYO_MAC_FILE_SYMLINK,\n\t[TOMOYO_TYPE_CHROOT]     = TOMOYO_MAC_FILE_CHROOT,\n\t[TOMOYO_TYPE_UMOUNT]     = TOMOYO_MAC_FILE_UMOUNT,\n};"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "tomoyo_read_unlock",
          "args": [
            "idx"
          ],
          "line": 826
        },
        "resolved": true,
        "details": {
          "function_name": "tomoyo_read_unlock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/common.h",
          "lines": "1108-1111",
          "snippet": "static inline void tomoyo_read_unlock(int idx)\n{\n\tsrcu_read_unlock(&tomoyo_ss, idx);\n}",
          "includes": [
            "#include <net/udp.h>",
            "#include <net/ipv6.h>",
            "#include <net/ip.h>",
            "#include <net/af_unix.h>",
            "#include <net/sock.h>",
            "#include <linux/un.h>",
            "#include <linux/in6.h>",
            "#include <linux/in.h>",
            "#include <linux/inet.h>",
            "#include <linux/net.h>",
            "#include <linux/highmem.h>",
            "#include <linux/binfmts.h>",
            "#include <linux/poll.h>",
            "#include <linux/cred.h>",
            "#include <linux/list.h>",
            "#include <linux/mount.h>",
            "#include <linux/namei.h>",
            "#include <linux/sched.h>",
            "#include <linux/fs.h>",
            "#include <linux/kmod.h>",
            "#include <linux/file.h>",
            "#include <linux/mm.h>",
            "#include <linux/string.h>",
            "#include <linux/ctype.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <net/udp.h>\n#include <net/ipv6.h>\n#include <net/ip.h>\n#include <net/af_unix.h>\n#include <net/sock.h>\n#include <linux/un.h>\n#include <linux/in6.h>\n#include <linux/in.h>\n#include <linux/inet.h>\n#include <linux/net.h>\n#include <linux/highmem.h>\n#include <linux/binfmts.h>\n#include <linux/poll.h>\n#include <linux/cred.h>\n#include <linux/list.h>\n#include <linux/mount.h>\n#include <linux/namei.h>\n#include <linux/sched.h>\n#include <linux/fs.h>\n#include <linux/kmod.h>\n#include <linux/file.h>\n#include <linux/mm.h>\n#include <linux/string.h>\n#include <linux/ctype.h>\n\nstatic inline void tomoyo_read_unlock(int idx)\n{\n\tsrcu_read_unlock(&tomoyo_ss, idx);\n}"
        }
      },
      {
        "call_info": {
          "callee": "kfree",
          "args": [
            "buf.name"
          ],
          "line": 825
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kfree",
          "args": [
            "symlink_target.name"
          ],
          "line": 823
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "tomoyo_path_permission",
          "args": [
            "&r",
            "operation",
            "&buf"
          ],
          "line": 821
        },
        "resolved": true,
        "details": {
          "function_name": "tomoyo_path_permission",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/file.c",
          "lines": "559-576",
          "snippet": "static int tomoyo_path_permission(struct tomoyo_request_info *r, u8 operation,\n\t\t\t\t  const struct tomoyo_path_info *filename)\n{\n\tint error;\n\n\tr->type = tomoyo_p2mac[operation];\n\tr->mode = tomoyo_get_mode(r->domain->ns, r->profile, r->type);\n\tif (r->mode == TOMOYO_CONFIG_DISABLED)\n\t\treturn 0;\n\tr->param_type = TOMOYO_TYPE_PATH_ACL;\n\tr->param.path.filename = filename;\n\tr->param.path.operation = operation;\n\tdo {\n\t\ttomoyo_check_acl(r, tomoyo_check_path_acl);\n\t\terror = tomoyo_audit_path_log(r);\n\t} while (error == TOMOYO_RETRY_REQUEST);\n\treturn error;\n}",
          "includes": [
            "#include <linux/slab.h>",
            "#include \"common.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static const u8 tomoyo_p2mac[TOMOYO_MAX_PATH_OPERATION] = {\n\t[TOMOYO_TYPE_EXECUTE]    = TOMOYO_MAC_FILE_EXECUTE,\n\t[TOMOYO_TYPE_READ]       = TOMOYO_MAC_FILE_OPEN,\n\t[TOMOYO_TYPE_WRITE]      = TOMOYO_MAC_FILE_OPEN,\n\t[TOMOYO_TYPE_APPEND]     = TOMOYO_MAC_FILE_OPEN,\n\t[TOMOYO_TYPE_UNLINK]     = TOMOYO_MAC_FILE_UNLINK,\n\t[TOMOYO_TYPE_GETATTR]    = TOMOYO_MAC_FILE_GETATTR,\n\t[TOMOYO_TYPE_RMDIR]      = TOMOYO_MAC_FILE_RMDIR,\n\t[TOMOYO_TYPE_TRUNCATE]   = TOMOYO_MAC_FILE_TRUNCATE,\n\t[TOMOYO_TYPE_SYMLINK]    = TOMOYO_MAC_FILE_SYMLINK,\n\t[TOMOYO_TYPE_CHROOT]     = TOMOYO_MAC_FILE_CHROOT,\n\t[TOMOYO_TYPE_UMOUNT]     = TOMOYO_MAC_FILE_UMOUNT,\n};"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <linux/slab.h>\n#include \"common.h\"\n\nstatic const u8 tomoyo_p2mac[TOMOYO_MAX_PATH_OPERATION] = {\n\t[TOMOYO_TYPE_EXECUTE]    = TOMOYO_MAC_FILE_EXECUTE,\n\t[TOMOYO_TYPE_READ]       = TOMOYO_MAC_FILE_OPEN,\n\t[TOMOYO_TYPE_WRITE]      = TOMOYO_MAC_FILE_OPEN,\n\t[TOMOYO_TYPE_APPEND]     = TOMOYO_MAC_FILE_OPEN,\n\t[TOMOYO_TYPE_UNLINK]     = TOMOYO_MAC_FILE_UNLINK,\n\t[TOMOYO_TYPE_GETATTR]    = TOMOYO_MAC_FILE_GETATTR,\n\t[TOMOYO_TYPE_RMDIR]      = TOMOYO_MAC_FILE_RMDIR,\n\t[TOMOYO_TYPE_TRUNCATE]   = TOMOYO_MAC_FILE_TRUNCATE,\n\t[TOMOYO_TYPE_SYMLINK]    = TOMOYO_MAC_FILE_SYMLINK,\n\t[TOMOYO_TYPE_CHROOT]     = TOMOYO_MAC_FILE_CHROOT,\n\t[TOMOYO_TYPE_UMOUNT]     = TOMOYO_MAC_FILE_UMOUNT,\n};\n\nstatic int tomoyo_path_permission(struct tomoyo_request_info *r, u8 operation,\n\t\t\t\t  const struct tomoyo_path_info *filename)\n{\n\tint error;\n\n\tr->type = tomoyo_p2mac[operation];\n\tr->mode = tomoyo_get_mode(r->domain->ns, r->profile, r->type);\n\tif (r->mode == TOMOYO_CONFIG_DISABLED)\n\t\treturn 0;\n\tr->param_type = TOMOYO_TYPE_PATH_ACL;\n\tr->param.path.filename = filename;\n\tr->param.path.operation = operation;\n\tdo {\n\t\ttomoyo_check_acl(r, tomoyo_check_path_acl);\n\t\terror = tomoyo_audit_path_log(r);\n\t} while (error == TOMOYO_RETRY_REQUEST);\n\treturn error;\n}"
        }
      },
      {
        "call_info": {
          "callee": "tomoyo_fill_path_info",
          "args": [
            "&symlink_target"
          ],
          "line": 817
        },
        "resolved": true,
        "details": {
          "function_name": "tomoyo_fill_path_info",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/util.c",
          "lines": "643-652",
          "snippet": "void tomoyo_fill_path_info(struct tomoyo_path_info *ptr)\n{\n\tconst char *name = ptr->name;\n\tconst int len = strlen(name);\n\n\tptr->const_len = tomoyo_const_part_length(name);\n\tptr->is_dir = len && (name[len - 1] == '/');\n\tptr->is_patterned = (ptr->const_len < len);\n\tptr->hash = full_name_hash(NULL, name, len);\n}",
          "includes": [
            "#include \"common.h\"",
            "#include <linux/rculist.h>",
            "#include <linux/slab.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common.h\"\n#include <linux/rculist.h>\n#include <linux/slab.h>\n\nvoid tomoyo_fill_path_info(struct tomoyo_path_info *ptr)\n{\n\tconst char *name = ptr->name;\n\tconst int len = strlen(name);\n\n\tptr->const_len = tomoyo_const_part_length(name);\n\tptr->is_dir = len && (name[len - 1] == '/');\n\tptr->is_patterned = (ptr->const_len < len);\n\tptr->hash = full_name_hash(NULL, name, len);\n}"
        }
      },
      {
        "call_info": {
          "callee": "tomoyo_encode",
          "args": [
            "target"
          ],
          "line": 814
        },
        "resolved": true,
        "details": {
          "function_name": "tomoyo_encode",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/realpath.c",
          "lines": "77-80",
          "snippet": "char *tomoyo_encode(const char *str)\n{\n\treturn str ? tomoyo_encode2(str, strlen(str)) : NULL;\n}",
          "includes": [
            "#include <linux/magic.h>",
            "#include \"common.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/magic.h>\n#include \"common.h\"\n\nchar *tomoyo_encode(const char *str)\n{\n\treturn str ? tomoyo_encode2(str, strlen(str)) : NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "tomoyo_add_slash",
          "args": [
            "&buf"
          ],
          "line": 811
        },
        "resolved": true,
        "details": {
          "function_name": "tomoyo_add_slash",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/file.c",
          "lines": "130-139",
          "snippet": "static void tomoyo_add_slash(struct tomoyo_path_info *buf)\n{\n\tif (buf->is_dir)\n\t\treturn;\n\t/*\n\t * This is OK because tomoyo_encode() reserves space for appending \"/\".\n\t */\n\tstrcat((char *) buf->name, \"/\");\n\ttomoyo_fill_path_info(buf);\n}",
          "includes": [
            "#include <linux/slab.h>",
            "#include \"common.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/slab.h>\n#include \"common.h\"\n\nstatic void tomoyo_add_slash(struct tomoyo_path_info *buf)\n{\n\tif (buf->is_dir)\n\t\treturn;\n\t/*\n\t * This is OK because tomoyo_encode() reserves space for appending \"/\".\n\t */\n\tstrcat((char *) buf->name, \"/\");\n\ttomoyo_fill_path_info(buf);\n}"
        }
      },
      {
        "call_info": {
          "callee": "tomoyo_get_realpath",
          "args": [
            "&buf",
            "path"
          ],
          "line": 805
        },
        "resolved": true,
        "details": {
          "function_name": "tomoyo_get_realpath",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/file.c",
          "lines": "149-157",
          "snippet": "static bool tomoyo_get_realpath(struct tomoyo_path_info *buf, const struct path *path)\n{\n\tbuf->name = tomoyo_realpath_from_path(path);\n\tif (buf->name) {\n\t\ttomoyo_fill_path_info(buf);\n\t\treturn true;\n\t}\n\treturn false;\n}",
          "includes": [
            "#include <linux/slab.h>",
            "#include \"common.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/slab.h>\n#include \"common.h\"\n\nstatic bool tomoyo_get_realpath(struct tomoyo_path_info *buf, const struct path *path)\n{\n\tbuf->name = tomoyo_realpath_from_path(path);\n\tif (buf->name) {\n\t\ttomoyo_fill_path_info(buf);\n\t\treturn true;\n\t}\n\treturn false;\n}"
        }
      },
      {
        "call_info": {
          "callee": "tomoyo_read_lock",
          "args": [],
          "line": 804
        },
        "resolved": true,
        "details": {
          "function_name": "tomoyo_read_lock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/common.h",
          "lines": "1096-1099",
          "snippet": "static inline int tomoyo_read_lock(void)\n{\n\treturn srcu_read_lock(&tomoyo_ss);\n}",
          "includes": [
            "#include <net/udp.h>",
            "#include <net/ipv6.h>",
            "#include <net/ip.h>",
            "#include <net/af_unix.h>",
            "#include <net/sock.h>",
            "#include <linux/un.h>",
            "#include <linux/in6.h>",
            "#include <linux/in.h>",
            "#include <linux/inet.h>",
            "#include <linux/net.h>",
            "#include <linux/highmem.h>",
            "#include <linux/binfmts.h>",
            "#include <linux/poll.h>",
            "#include <linux/cred.h>",
            "#include <linux/list.h>",
            "#include <linux/mount.h>",
            "#include <linux/namei.h>",
            "#include <linux/sched.h>",
            "#include <linux/fs.h>",
            "#include <linux/kmod.h>",
            "#include <linux/file.h>",
            "#include <linux/mm.h>",
            "#include <linux/string.h>",
            "#include <linux/ctype.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <net/udp.h>\n#include <net/ipv6.h>\n#include <net/ip.h>\n#include <net/af_unix.h>\n#include <net/sock.h>\n#include <linux/un.h>\n#include <linux/in6.h>\n#include <linux/in.h>\n#include <linux/inet.h>\n#include <linux/net.h>\n#include <linux/highmem.h>\n#include <linux/binfmts.h>\n#include <linux/poll.h>\n#include <linux/cred.h>\n#include <linux/list.h>\n#include <linux/mount.h>\n#include <linux/namei.h>\n#include <linux/sched.h>\n#include <linux/fs.h>\n#include <linux/kmod.h>\n#include <linux/file.h>\n#include <linux/mm.h>\n#include <linux/string.h>\n#include <linux/ctype.h>\n\nstatic inline int tomoyo_read_lock(void)\n{\n\treturn srcu_read_lock(&tomoyo_ss);\n}"
        }
      },
      {
        "call_info": {
          "callee": "tomoyo_init_request_info",
          "args": [
            "&r",
            "NULL",
            "tomoyo_p2mac[operation]"
          ],
          "line": 798
        },
        "resolved": true,
        "details": {
          "function_name": "tomoyo_init_request_info",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/util.c",
          "lines": "984-997",
          "snippet": "int tomoyo_init_request_info(struct tomoyo_request_info *r,\n\t\t\t     struct tomoyo_domain_info *domain, const u8 index)\n{\n\tu8 profile;\n\tmemset(r, 0, sizeof(*r));\n\tif (!domain)\n\t\tdomain = tomoyo_domain();\n\tr->domain = domain;\n\tprofile = domain->profile;\n\tr->profile = profile;\n\tr->type = index;\n\tr->mode = tomoyo_get_mode(domain->ns, profile, index);\n\treturn r->mode;\n}",
          "includes": [
            "#include \"common.h\"",
            "#include <linux/rculist.h>",
            "#include <linux/slab.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common.h\"\n#include <linux/rculist.h>\n#include <linux/slab.h>\n\nint tomoyo_init_request_info(struct tomoyo_request_info *r,\n\t\t\t     struct tomoyo_domain_info *domain, const u8 index)\n{\n\tu8 profile;\n\tmemset(r, 0, sizeof(*r));\n\tif (!domain)\n\t\tdomain = tomoyo_domain();\n\tr->domain = domain;\n\tprofile = domain->profile;\n\tr->profile = profile;\n\tr->type = index;\n\tr->mode = tomoyo_get_mode(domain->ns, profile, index);\n\treturn r->mode;\n}"
        }
      }
    ],
    "contextual_snippet": "#include <linux/slab.h>\n#include \"common.h\"\n\nstatic const u8 tomoyo_p2mac[TOMOYO_MAX_PATH_OPERATION] = {\n\t[TOMOYO_TYPE_EXECUTE]    = TOMOYO_MAC_FILE_EXECUTE,\n\t[TOMOYO_TYPE_READ]       = TOMOYO_MAC_FILE_OPEN,\n\t[TOMOYO_TYPE_WRITE]      = TOMOYO_MAC_FILE_OPEN,\n\t[TOMOYO_TYPE_APPEND]     = TOMOYO_MAC_FILE_OPEN,\n\t[TOMOYO_TYPE_UNLINK]     = TOMOYO_MAC_FILE_UNLINK,\n\t[TOMOYO_TYPE_GETATTR]    = TOMOYO_MAC_FILE_GETATTR,\n\t[TOMOYO_TYPE_RMDIR]      = TOMOYO_MAC_FILE_RMDIR,\n\t[TOMOYO_TYPE_TRUNCATE]   = TOMOYO_MAC_FILE_TRUNCATE,\n\t[TOMOYO_TYPE_SYMLINK]    = TOMOYO_MAC_FILE_SYMLINK,\n\t[TOMOYO_TYPE_CHROOT]     = TOMOYO_MAC_FILE_CHROOT,\n\t[TOMOYO_TYPE_UMOUNT]     = TOMOYO_MAC_FILE_UMOUNT,\n};\n\nint tomoyo_path_perm(const u8 operation, const struct path *path, const char *target)\n{\n\tstruct tomoyo_request_info r;\n\tstruct tomoyo_obj_info obj = {\n\t\t.path1 = { .mnt = path->mnt, .dentry = path->dentry },\n\t};\n\tint error;\n\tstruct tomoyo_path_info buf;\n\tbool is_enforce;\n\tstruct tomoyo_path_info symlink_target;\n\tint idx;\n\n\tif (tomoyo_init_request_info(&r, NULL, tomoyo_p2mac[operation])\n\t    == TOMOYO_CONFIG_DISABLED)\n\t\treturn 0;\n\tis_enforce = (r.mode == TOMOYO_CONFIG_ENFORCING);\n\terror = -ENOMEM;\n\tbuf.name = NULL;\n\tidx = tomoyo_read_lock();\n\tif (!tomoyo_get_realpath(&buf, path))\n\t\tgoto out;\n\tr.obj = &obj;\n\tswitch (operation) {\n\tcase TOMOYO_TYPE_RMDIR:\n\tcase TOMOYO_TYPE_CHROOT:\n\t\ttomoyo_add_slash(&buf);\n\t\tbreak;\n\tcase TOMOYO_TYPE_SYMLINK:\n\t\tsymlink_target.name = tomoyo_encode(target);\n\t\tif (!symlink_target.name)\n\t\t\tgoto out;\n\t\ttomoyo_fill_path_info(&symlink_target);\n\t\tobj.symlink_target = &symlink_target;\n\t\tbreak;\n\t}\n\terror = tomoyo_path_permission(&r, operation, &buf);\n\tif (operation == TOMOYO_TYPE_SYMLINK)\n\t\tkfree(symlink_target.name);\n out:\n\tkfree(buf.name);\n\ttomoyo_read_unlock(idx);\n\tif (!is_enforce)\n\t\terror = 0;\n\treturn error;\n}"
  },
  {
    "function_name": "tomoyo_check_open_permission",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/file.c",
    "lines": "736-774",
    "snippet": "int tomoyo_check_open_permission(struct tomoyo_domain_info *domain,\n\t\t\t\t const struct path *path, const int flag)\n{\n\tconst u8 acc_mode = ACC_MODE(flag);\n\tint error = 0;\n\tstruct tomoyo_path_info buf;\n\tstruct tomoyo_request_info r;\n\tstruct tomoyo_obj_info obj = {\n\t\t.path1 = { .mnt = path->mnt, .dentry = path->dentry },\n\t};\n\tint idx;\n\n\tbuf.name = NULL;\n\tr.mode = TOMOYO_CONFIG_DISABLED;\n\tidx = tomoyo_read_lock();\n\tif (acc_mode &&\n\t    tomoyo_init_request_info(&r, domain, TOMOYO_MAC_FILE_OPEN)\n\t    != TOMOYO_CONFIG_DISABLED) {\n\t\tif (!tomoyo_get_realpath(&buf, path)) {\n\t\t\terror = -ENOMEM;\n\t\t\tgoto out;\n\t\t}\n\t\tr.obj = &obj;\n\t\tif (acc_mode & MAY_READ)\n\t\t\terror = tomoyo_path_permission(&r, TOMOYO_TYPE_READ,\n\t\t\t\t\t\t       &buf);\n\t\tif (!error && (acc_mode & MAY_WRITE))\n\t\t\terror = tomoyo_path_permission(&r, (flag & O_APPEND) ?\n\t\t\t\t\t\t       TOMOYO_TYPE_APPEND :\n\t\t\t\t\t\t       TOMOYO_TYPE_WRITE,\n\t\t\t\t\t\t       &buf);\n\t}\n out:\n\tkfree(buf.name);\n\ttomoyo_read_unlock(idx);\n\tif (r.mode != TOMOYO_CONFIG_ENFORCING)\n\t\terror = 0;\n\treturn error;\n}",
    "includes": [
      "#include <linux/slab.h>",
      "#include \"common.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "tomoyo_read_unlock",
          "args": [
            "idx"
          ],
          "line": 770
        },
        "resolved": true,
        "details": {
          "function_name": "tomoyo_read_unlock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/common.h",
          "lines": "1108-1111",
          "snippet": "static inline void tomoyo_read_unlock(int idx)\n{\n\tsrcu_read_unlock(&tomoyo_ss, idx);\n}",
          "includes": [
            "#include <net/udp.h>",
            "#include <net/ipv6.h>",
            "#include <net/ip.h>",
            "#include <net/af_unix.h>",
            "#include <net/sock.h>",
            "#include <linux/un.h>",
            "#include <linux/in6.h>",
            "#include <linux/in.h>",
            "#include <linux/inet.h>",
            "#include <linux/net.h>",
            "#include <linux/highmem.h>",
            "#include <linux/binfmts.h>",
            "#include <linux/poll.h>",
            "#include <linux/cred.h>",
            "#include <linux/list.h>",
            "#include <linux/mount.h>",
            "#include <linux/namei.h>",
            "#include <linux/sched.h>",
            "#include <linux/fs.h>",
            "#include <linux/kmod.h>",
            "#include <linux/file.h>",
            "#include <linux/mm.h>",
            "#include <linux/string.h>",
            "#include <linux/ctype.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <net/udp.h>\n#include <net/ipv6.h>\n#include <net/ip.h>\n#include <net/af_unix.h>\n#include <net/sock.h>\n#include <linux/un.h>\n#include <linux/in6.h>\n#include <linux/in.h>\n#include <linux/inet.h>\n#include <linux/net.h>\n#include <linux/highmem.h>\n#include <linux/binfmts.h>\n#include <linux/poll.h>\n#include <linux/cred.h>\n#include <linux/list.h>\n#include <linux/mount.h>\n#include <linux/namei.h>\n#include <linux/sched.h>\n#include <linux/fs.h>\n#include <linux/kmod.h>\n#include <linux/file.h>\n#include <linux/mm.h>\n#include <linux/string.h>\n#include <linux/ctype.h>\n\nstatic inline void tomoyo_read_unlock(int idx)\n{\n\tsrcu_read_unlock(&tomoyo_ss, idx);\n}"
        }
      },
      {
        "call_info": {
          "callee": "kfree",
          "args": [
            "buf.name"
          ],
          "line": 769
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "tomoyo_path_permission",
          "args": [
            "&r",
            "(flag & O_APPEND) ?\n\t\t\t\t\t\t       TOMOYO_TYPE_APPEND :\n\t\t\t\t\t\t       TOMOYO_TYPE_WRITE",
            "&buf"
          ],
          "line": 763
        },
        "resolved": true,
        "details": {
          "function_name": "tomoyo_path_permission",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/file.c",
          "lines": "559-576",
          "snippet": "static int tomoyo_path_permission(struct tomoyo_request_info *r, u8 operation,\n\t\t\t\t  const struct tomoyo_path_info *filename)\n{\n\tint error;\n\n\tr->type = tomoyo_p2mac[operation];\n\tr->mode = tomoyo_get_mode(r->domain->ns, r->profile, r->type);\n\tif (r->mode == TOMOYO_CONFIG_DISABLED)\n\t\treturn 0;\n\tr->param_type = TOMOYO_TYPE_PATH_ACL;\n\tr->param.path.filename = filename;\n\tr->param.path.operation = operation;\n\tdo {\n\t\ttomoyo_check_acl(r, tomoyo_check_path_acl);\n\t\terror = tomoyo_audit_path_log(r);\n\t} while (error == TOMOYO_RETRY_REQUEST);\n\treturn error;\n}",
          "includes": [
            "#include <linux/slab.h>",
            "#include \"common.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static const u8 tomoyo_p2mac[TOMOYO_MAX_PATH_OPERATION] = {\n\t[TOMOYO_TYPE_EXECUTE]    = TOMOYO_MAC_FILE_EXECUTE,\n\t[TOMOYO_TYPE_READ]       = TOMOYO_MAC_FILE_OPEN,\n\t[TOMOYO_TYPE_WRITE]      = TOMOYO_MAC_FILE_OPEN,\n\t[TOMOYO_TYPE_APPEND]     = TOMOYO_MAC_FILE_OPEN,\n\t[TOMOYO_TYPE_UNLINK]     = TOMOYO_MAC_FILE_UNLINK,\n\t[TOMOYO_TYPE_GETATTR]    = TOMOYO_MAC_FILE_GETATTR,\n\t[TOMOYO_TYPE_RMDIR]      = TOMOYO_MAC_FILE_RMDIR,\n\t[TOMOYO_TYPE_TRUNCATE]   = TOMOYO_MAC_FILE_TRUNCATE,\n\t[TOMOYO_TYPE_SYMLINK]    = TOMOYO_MAC_FILE_SYMLINK,\n\t[TOMOYO_TYPE_CHROOT]     = TOMOYO_MAC_FILE_CHROOT,\n\t[TOMOYO_TYPE_UMOUNT]     = TOMOYO_MAC_FILE_UMOUNT,\n};"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <linux/slab.h>\n#include \"common.h\"\n\nstatic const u8 tomoyo_p2mac[TOMOYO_MAX_PATH_OPERATION] = {\n\t[TOMOYO_TYPE_EXECUTE]    = TOMOYO_MAC_FILE_EXECUTE,\n\t[TOMOYO_TYPE_READ]       = TOMOYO_MAC_FILE_OPEN,\n\t[TOMOYO_TYPE_WRITE]      = TOMOYO_MAC_FILE_OPEN,\n\t[TOMOYO_TYPE_APPEND]     = TOMOYO_MAC_FILE_OPEN,\n\t[TOMOYO_TYPE_UNLINK]     = TOMOYO_MAC_FILE_UNLINK,\n\t[TOMOYO_TYPE_GETATTR]    = TOMOYO_MAC_FILE_GETATTR,\n\t[TOMOYO_TYPE_RMDIR]      = TOMOYO_MAC_FILE_RMDIR,\n\t[TOMOYO_TYPE_TRUNCATE]   = TOMOYO_MAC_FILE_TRUNCATE,\n\t[TOMOYO_TYPE_SYMLINK]    = TOMOYO_MAC_FILE_SYMLINK,\n\t[TOMOYO_TYPE_CHROOT]     = TOMOYO_MAC_FILE_CHROOT,\n\t[TOMOYO_TYPE_UMOUNT]     = TOMOYO_MAC_FILE_UMOUNT,\n};\n\nstatic int tomoyo_path_permission(struct tomoyo_request_info *r, u8 operation,\n\t\t\t\t  const struct tomoyo_path_info *filename)\n{\n\tint error;\n\n\tr->type = tomoyo_p2mac[operation];\n\tr->mode = tomoyo_get_mode(r->domain->ns, r->profile, r->type);\n\tif (r->mode == TOMOYO_CONFIG_DISABLED)\n\t\treturn 0;\n\tr->param_type = TOMOYO_TYPE_PATH_ACL;\n\tr->param.path.filename = filename;\n\tr->param.path.operation = operation;\n\tdo {\n\t\ttomoyo_check_acl(r, tomoyo_check_path_acl);\n\t\terror = tomoyo_audit_path_log(r);\n\t} while (error == TOMOYO_RETRY_REQUEST);\n\treturn error;\n}"
        }
      },
      {
        "call_info": {
          "callee": "tomoyo_get_realpath",
          "args": [
            "&buf",
            "path"
          ],
          "line": 754
        },
        "resolved": true,
        "details": {
          "function_name": "tomoyo_get_realpath",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/file.c",
          "lines": "149-157",
          "snippet": "static bool tomoyo_get_realpath(struct tomoyo_path_info *buf, const struct path *path)\n{\n\tbuf->name = tomoyo_realpath_from_path(path);\n\tif (buf->name) {\n\t\ttomoyo_fill_path_info(buf);\n\t\treturn true;\n\t}\n\treturn false;\n}",
          "includes": [
            "#include <linux/slab.h>",
            "#include \"common.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/slab.h>\n#include \"common.h\"\n\nstatic bool tomoyo_get_realpath(struct tomoyo_path_info *buf, const struct path *path)\n{\n\tbuf->name = tomoyo_realpath_from_path(path);\n\tif (buf->name) {\n\t\ttomoyo_fill_path_info(buf);\n\t\treturn true;\n\t}\n\treturn false;\n}"
        }
      },
      {
        "call_info": {
          "callee": "tomoyo_init_request_info",
          "args": [
            "&r",
            "domain",
            "TOMOYO_MAC_FILE_OPEN"
          ],
          "line": 752
        },
        "resolved": true,
        "details": {
          "function_name": "tomoyo_init_request_info",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/util.c",
          "lines": "984-997",
          "snippet": "int tomoyo_init_request_info(struct tomoyo_request_info *r,\n\t\t\t     struct tomoyo_domain_info *domain, const u8 index)\n{\n\tu8 profile;\n\tmemset(r, 0, sizeof(*r));\n\tif (!domain)\n\t\tdomain = tomoyo_domain();\n\tr->domain = domain;\n\tprofile = domain->profile;\n\tr->profile = profile;\n\tr->type = index;\n\tr->mode = tomoyo_get_mode(domain->ns, profile, index);\n\treturn r->mode;\n}",
          "includes": [
            "#include \"common.h\"",
            "#include <linux/rculist.h>",
            "#include <linux/slab.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common.h\"\n#include <linux/rculist.h>\n#include <linux/slab.h>\n\nint tomoyo_init_request_info(struct tomoyo_request_info *r,\n\t\t\t     struct tomoyo_domain_info *domain, const u8 index)\n{\n\tu8 profile;\n\tmemset(r, 0, sizeof(*r));\n\tif (!domain)\n\t\tdomain = tomoyo_domain();\n\tr->domain = domain;\n\tprofile = domain->profile;\n\tr->profile = profile;\n\tr->type = index;\n\tr->mode = tomoyo_get_mode(domain->ns, profile, index);\n\treturn r->mode;\n}"
        }
      },
      {
        "call_info": {
          "callee": "tomoyo_read_lock",
          "args": [],
          "line": 750
        },
        "resolved": true,
        "details": {
          "function_name": "tomoyo_read_lock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/common.h",
          "lines": "1096-1099",
          "snippet": "static inline int tomoyo_read_lock(void)\n{\n\treturn srcu_read_lock(&tomoyo_ss);\n}",
          "includes": [
            "#include <net/udp.h>",
            "#include <net/ipv6.h>",
            "#include <net/ip.h>",
            "#include <net/af_unix.h>",
            "#include <net/sock.h>",
            "#include <linux/un.h>",
            "#include <linux/in6.h>",
            "#include <linux/in.h>",
            "#include <linux/inet.h>",
            "#include <linux/net.h>",
            "#include <linux/highmem.h>",
            "#include <linux/binfmts.h>",
            "#include <linux/poll.h>",
            "#include <linux/cred.h>",
            "#include <linux/list.h>",
            "#include <linux/mount.h>",
            "#include <linux/namei.h>",
            "#include <linux/sched.h>",
            "#include <linux/fs.h>",
            "#include <linux/kmod.h>",
            "#include <linux/file.h>",
            "#include <linux/mm.h>",
            "#include <linux/string.h>",
            "#include <linux/ctype.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <net/udp.h>\n#include <net/ipv6.h>\n#include <net/ip.h>\n#include <net/af_unix.h>\n#include <net/sock.h>\n#include <linux/un.h>\n#include <linux/in6.h>\n#include <linux/in.h>\n#include <linux/inet.h>\n#include <linux/net.h>\n#include <linux/highmem.h>\n#include <linux/binfmts.h>\n#include <linux/poll.h>\n#include <linux/cred.h>\n#include <linux/list.h>\n#include <linux/mount.h>\n#include <linux/namei.h>\n#include <linux/sched.h>\n#include <linux/fs.h>\n#include <linux/kmod.h>\n#include <linux/file.h>\n#include <linux/mm.h>\n#include <linux/string.h>\n#include <linux/ctype.h>\n\nstatic inline int tomoyo_read_lock(void)\n{\n\treturn srcu_read_lock(&tomoyo_ss);\n}"
        }
      },
      {
        "call_info": {
          "callee": "ACC_MODE",
          "args": [
            "flag"
          ],
          "line": 739
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <linux/slab.h>\n#include \"common.h\"\n\nint tomoyo_check_open_permission(struct tomoyo_domain_info *domain,\n\t\t\t\t const struct path *path, const int flag)\n{\n\tconst u8 acc_mode = ACC_MODE(flag);\n\tint error = 0;\n\tstruct tomoyo_path_info buf;\n\tstruct tomoyo_request_info r;\n\tstruct tomoyo_obj_info obj = {\n\t\t.path1 = { .mnt = path->mnt, .dentry = path->dentry },\n\t};\n\tint idx;\n\n\tbuf.name = NULL;\n\tr.mode = TOMOYO_CONFIG_DISABLED;\n\tidx = tomoyo_read_lock();\n\tif (acc_mode &&\n\t    tomoyo_init_request_info(&r, domain, TOMOYO_MAC_FILE_OPEN)\n\t    != TOMOYO_CONFIG_DISABLED) {\n\t\tif (!tomoyo_get_realpath(&buf, path)) {\n\t\t\terror = -ENOMEM;\n\t\t\tgoto out;\n\t\t}\n\t\tr.obj = &obj;\n\t\tif (acc_mode & MAY_READ)\n\t\t\terror = tomoyo_path_permission(&r, TOMOYO_TYPE_READ,\n\t\t\t\t\t\t       &buf);\n\t\tif (!error && (acc_mode & MAY_WRITE))\n\t\t\terror = tomoyo_path_permission(&r, (flag & O_APPEND) ?\n\t\t\t\t\t\t       TOMOYO_TYPE_APPEND :\n\t\t\t\t\t\t       TOMOYO_TYPE_WRITE,\n\t\t\t\t\t\t       &buf);\n\t}\n out:\n\tkfree(buf.name);\n\ttomoyo_read_unlock(idx);\n\tif (r.mode != TOMOYO_CONFIG_ENFORCING)\n\t\terror = 0;\n\treturn error;\n}"
  },
  {
    "function_name": "tomoyo_path_number_perm",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/file.c",
    "lines": "691-725",
    "snippet": "int tomoyo_path_number_perm(const u8 type, const struct path *path,\n\t\t\t    unsigned long number)\n{\n\tstruct tomoyo_request_info r;\n\tstruct tomoyo_obj_info obj = {\n\t\t.path1 = { .mnt = path->mnt, .dentry = path->dentry },\n\t};\n\tint error = -ENOMEM;\n\tstruct tomoyo_path_info buf;\n\tint idx;\n\n\tif (tomoyo_init_request_info(&r, NULL, tomoyo_pn2mac[type])\n\t    == TOMOYO_CONFIG_DISABLED || !path->dentry)\n\t\treturn 0;\n\tidx = tomoyo_read_lock();\n\tif (!tomoyo_get_realpath(&buf, path))\n\t\tgoto out;\n\tr.obj = &obj;\n\tif (type == TOMOYO_TYPE_MKDIR)\n\t\ttomoyo_add_slash(&buf);\n\tr.param_type = TOMOYO_TYPE_PATH_NUMBER_ACL;\n\tr.param.path_number.operation = type;\n\tr.param.path_number.filename = &buf;\n\tr.param.path_number.number = number;\n\tdo {\n\t\ttomoyo_check_acl(&r, tomoyo_check_path_number_acl);\n\t\terror = tomoyo_audit_path_number_log(&r);\n\t} while (error == TOMOYO_RETRY_REQUEST);\n\tkfree(buf.name);\n out:\n\ttomoyo_read_unlock(idx);\n\tif (r.mode != TOMOYO_CONFIG_ENFORCING)\n\t\terror = 0;\n\treturn error;\n}",
    "includes": [
      "#include <linux/slab.h>",
      "#include \"common.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "const u8 tomoyo_pn2mac[TOMOYO_MAX_PATH_NUMBER_OPERATION] = {\n\t[TOMOYO_TYPE_CREATE] = TOMOYO_MAC_FILE_CREATE,\n\t[TOMOYO_TYPE_MKDIR]  = TOMOYO_MAC_FILE_MKDIR,\n\t[TOMOYO_TYPE_MKFIFO] = TOMOYO_MAC_FILE_MKFIFO,\n\t[TOMOYO_TYPE_MKSOCK] = TOMOYO_MAC_FILE_MKSOCK,\n\t[TOMOYO_TYPE_IOCTL]  = TOMOYO_MAC_FILE_IOCTL,\n\t[TOMOYO_TYPE_CHMOD]  = TOMOYO_MAC_FILE_CHMOD,\n\t[TOMOYO_TYPE_CHOWN]  = TOMOYO_MAC_FILE_CHOWN,\n\t[TOMOYO_TYPE_CHGRP]  = TOMOYO_MAC_FILE_CHGRP,\n};"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "tomoyo_read_unlock",
          "args": [
            "idx"
          ],
          "line": 721
        },
        "resolved": true,
        "details": {
          "function_name": "tomoyo_read_unlock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/common.h",
          "lines": "1108-1111",
          "snippet": "static inline void tomoyo_read_unlock(int idx)\n{\n\tsrcu_read_unlock(&tomoyo_ss, idx);\n}",
          "includes": [
            "#include <net/udp.h>",
            "#include <net/ipv6.h>",
            "#include <net/ip.h>",
            "#include <net/af_unix.h>",
            "#include <net/sock.h>",
            "#include <linux/un.h>",
            "#include <linux/in6.h>",
            "#include <linux/in.h>",
            "#include <linux/inet.h>",
            "#include <linux/net.h>",
            "#include <linux/highmem.h>",
            "#include <linux/binfmts.h>",
            "#include <linux/poll.h>",
            "#include <linux/cred.h>",
            "#include <linux/list.h>",
            "#include <linux/mount.h>",
            "#include <linux/namei.h>",
            "#include <linux/sched.h>",
            "#include <linux/fs.h>",
            "#include <linux/kmod.h>",
            "#include <linux/file.h>",
            "#include <linux/mm.h>",
            "#include <linux/string.h>",
            "#include <linux/ctype.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <net/udp.h>\n#include <net/ipv6.h>\n#include <net/ip.h>\n#include <net/af_unix.h>\n#include <net/sock.h>\n#include <linux/un.h>\n#include <linux/in6.h>\n#include <linux/in.h>\n#include <linux/inet.h>\n#include <linux/net.h>\n#include <linux/highmem.h>\n#include <linux/binfmts.h>\n#include <linux/poll.h>\n#include <linux/cred.h>\n#include <linux/list.h>\n#include <linux/mount.h>\n#include <linux/namei.h>\n#include <linux/sched.h>\n#include <linux/fs.h>\n#include <linux/kmod.h>\n#include <linux/file.h>\n#include <linux/mm.h>\n#include <linux/string.h>\n#include <linux/ctype.h>\n\nstatic inline void tomoyo_read_unlock(int idx)\n{\n\tsrcu_read_unlock(&tomoyo_ss, idx);\n}"
        }
      },
      {
        "call_info": {
          "callee": "kfree",
          "args": [
            "buf.name"
          ],
          "line": 719
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "tomoyo_audit_path_number_log",
          "args": [
            "&r"
          ],
          "line": 717
        },
        "resolved": true,
        "details": {
          "function_name": "tomoyo_audit_path_number_log",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/file.c",
          "lines": "212-237",
          "snippet": "static int tomoyo_audit_path_number_log(struct tomoyo_request_info *r)\n{\n\tconst u8 type = r->param.path_number.operation;\n\tu8 radix;\n\tchar buffer[64];\n\tswitch (type) {\n\tcase TOMOYO_TYPE_CREATE:\n\tcase TOMOYO_TYPE_MKDIR:\n\tcase TOMOYO_TYPE_MKFIFO:\n\tcase TOMOYO_TYPE_MKSOCK:\n\tcase TOMOYO_TYPE_CHMOD:\n\t\tradix = TOMOYO_VALUE_TYPE_OCTAL;\n\t\tbreak;\n\tcase TOMOYO_TYPE_IOCTL:\n\t\tradix = TOMOYO_VALUE_TYPE_HEXADECIMAL;\n\t\tbreak;\n\tdefault:\n\t\tradix = TOMOYO_VALUE_TYPE_DECIMAL;\n\t\tbreak;\n\t}\n\ttomoyo_print_ulong(buffer, sizeof(buffer), r->param.path_number.number,\n\t\t\t   radix);\n\treturn tomoyo_supervisor(r, \"file %s %s %s\\n\", tomoyo_mac_keywords\n\t\t\t\t [tomoyo_pn2mac[type]],\n\t\t\t\t r->param.path_number.filename->name, buffer);\n}",
          "includes": [
            "#include <linux/slab.h>",
            "#include \"common.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "const u8 tomoyo_pn2mac[TOMOYO_MAX_PATH_NUMBER_OPERATION] = {\n\t[TOMOYO_TYPE_CREATE] = TOMOYO_MAC_FILE_CREATE,\n\t[TOMOYO_TYPE_MKDIR]  = TOMOYO_MAC_FILE_MKDIR,\n\t[TOMOYO_TYPE_MKFIFO] = TOMOYO_MAC_FILE_MKFIFO,\n\t[TOMOYO_TYPE_MKSOCK] = TOMOYO_MAC_FILE_MKSOCK,\n\t[TOMOYO_TYPE_IOCTL]  = TOMOYO_MAC_FILE_IOCTL,\n\t[TOMOYO_TYPE_CHMOD]  = TOMOYO_MAC_FILE_CHMOD,\n\t[TOMOYO_TYPE_CHOWN]  = TOMOYO_MAC_FILE_CHOWN,\n\t[TOMOYO_TYPE_CHGRP]  = TOMOYO_MAC_FILE_CHGRP,\n};"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <linux/slab.h>\n#include \"common.h\"\n\nconst u8 tomoyo_pn2mac[TOMOYO_MAX_PATH_NUMBER_OPERATION] = {\n\t[TOMOYO_TYPE_CREATE] = TOMOYO_MAC_FILE_CREATE,\n\t[TOMOYO_TYPE_MKDIR]  = TOMOYO_MAC_FILE_MKDIR,\n\t[TOMOYO_TYPE_MKFIFO] = TOMOYO_MAC_FILE_MKFIFO,\n\t[TOMOYO_TYPE_MKSOCK] = TOMOYO_MAC_FILE_MKSOCK,\n\t[TOMOYO_TYPE_IOCTL]  = TOMOYO_MAC_FILE_IOCTL,\n\t[TOMOYO_TYPE_CHMOD]  = TOMOYO_MAC_FILE_CHMOD,\n\t[TOMOYO_TYPE_CHOWN]  = TOMOYO_MAC_FILE_CHOWN,\n\t[TOMOYO_TYPE_CHGRP]  = TOMOYO_MAC_FILE_CHGRP,\n};\n\nstatic int tomoyo_audit_path_number_log(struct tomoyo_request_info *r)\n{\n\tconst u8 type = r->param.path_number.operation;\n\tu8 radix;\n\tchar buffer[64];\n\tswitch (type) {\n\tcase TOMOYO_TYPE_CREATE:\n\tcase TOMOYO_TYPE_MKDIR:\n\tcase TOMOYO_TYPE_MKFIFO:\n\tcase TOMOYO_TYPE_MKSOCK:\n\tcase TOMOYO_TYPE_CHMOD:\n\t\tradix = TOMOYO_VALUE_TYPE_OCTAL;\n\t\tbreak;\n\tcase TOMOYO_TYPE_IOCTL:\n\t\tradix = TOMOYO_VALUE_TYPE_HEXADECIMAL;\n\t\tbreak;\n\tdefault:\n\t\tradix = TOMOYO_VALUE_TYPE_DECIMAL;\n\t\tbreak;\n\t}\n\ttomoyo_print_ulong(buffer, sizeof(buffer), r->param.path_number.number,\n\t\t\t   radix);\n\treturn tomoyo_supervisor(r, \"file %s %s %s\\n\", tomoyo_mac_keywords\n\t\t\t\t [tomoyo_pn2mac[type]],\n\t\t\t\t r->param.path_number.filename->name, buffer);\n}"
        }
      },
      {
        "call_info": {
          "callee": "tomoyo_check_acl",
          "args": [
            "&r",
            "tomoyo_check_path_number_acl"
          ],
          "line": 716
        },
        "resolved": true,
        "details": {
          "function_name": "tomoyo_check_acl",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/domain.c",
          "lines": "159-186",
          "snippet": "void tomoyo_check_acl(struct tomoyo_request_info *r,\n\t\t      bool (*check_entry) (struct tomoyo_request_info *,\n\t\t\t\t\t   const struct tomoyo_acl_info *))\n{\n\tconst struct tomoyo_domain_info *domain = r->domain;\n\tstruct tomoyo_acl_info *ptr;\n\tbool retried = false;\n\tconst struct list_head *list = &domain->acl_info_list;\n\nretry:\n\tlist_for_each_entry_rcu(ptr, list, list) {\n\t\tif (ptr->is_deleted || ptr->type != r->param_type)\n\t\t\tcontinue;\n\t\tif (!check_entry(r, ptr))\n\t\t\tcontinue;\n\t\tif (!tomoyo_condition(r, ptr->cond))\n\t\t\tcontinue;\n\t\tr->matched_acl = ptr;\n\t\tr->granted = true;\n\t\treturn;\n\t}\n\tif (!retried) {\n\t\tretried = true;\n\t\tlist = &domain->ns->acl_group[domain->group];\n\t\tgoto retry;\n\t}\n\tr->granted = false;\n}",
          "includes": [
            "#include <linux/rculist.h>",
            "#include <linux/slab.h>",
            "#include <linux/binfmts.h>",
            "#include \"common.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/rculist.h>\n#include <linux/slab.h>\n#include <linux/binfmts.h>\n#include \"common.h\"\n\nvoid tomoyo_check_acl(struct tomoyo_request_info *r,\n\t\t      bool (*check_entry) (struct tomoyo_request_info *,\n\t\t\t\t\t   const struct tomoyo_acl_info *))\n{\n\tconst struct tomoyo_domain_info *domain = r->domain;\n\tstruct tomoyo_acl_info *ptr;\n\tbool retried = false;\n\tconst struct list_head *list = &domain->acl_info_list;\n\nretry:\n\tlist_for_each_entry_rcu(ptr, list, list) {\n\t\tif (ptr->is_deleted || ptr->type != r->param_type)\n\t\t\tcontinue;\n\t\tif (!check_entry(r, ptr))\n\t\t\tcontinue;\n\t\tif (!tomoyo_condition(r, ptr->cond))\n\t\t\tcontinue;\n\t\tr->matched_acl = ptr;\n\t\tr->granted = true;\n\t\treturn;\n\t}\n\tif (!retried) {\n\t\tretried = true;\n\t\tlist = &domain->ns->acl_group[domain->group];\n\t\tgoto retry;\n\t}\n\tr->granted = false;\n}"
        }
      },
      {
        "call_info": {
          "callee": "tomoyo_add_slash",
          "args": [
            "&buf"
          ],
          "line": 710
        },
        "resolved": true,
        "details": {
          "function_name": "tomoyo_add_slash",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/file.c",
          "lines": "130-139",
          "snippet": "static void tomoyo_add_slash(struct tomoyo_path_info *buf)\n{\n\tif (buf->is_dir)\n\t\treturn;\n\t/*\n\t * This is OK because tomoyo_encode() reserves space for appending \"/\".\n\t */\n\tstrcat((char *) buf->name, \"/\");\n\ttomoyo_fill_path_info(buf);\n}",
          "includes": [
            "#include <linux/slab.h>",
            "#include \"common.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/slab.h>\n#include \"common.h\"\n\nstatic void tomoyo_add_slash(struct tomoyo_path_info *buf)\n{\n\tif (buf->is_dir)\n\t\treturn;\n\t/*\n\t * This is OK because tomoyo_encode() reserves space for appending \"/\".\n\t */\n\tstrcat((char *) buf->name, \"/\");\n\ttomoyo_fill_path_info(buf);\n}"
        }
      },
      {
        "call_info": {
          "callee": "tomoyo_get_realpath",
          "args": [
            "&buf",
            "path"
          ],
          "line": 706
        },
        "resolved": true,
        "details": {
          "function_name": "tomoyo_get_realpath",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/file.c",
          "lines": "149-157",
          "snippet": "static bool tomoyo_get_realpath(struct tomoyo_path_info *buf, const struct path *path)\n{\n\tbuf->name = tomoyo_realpath_from_path(path);\n\tif (buf->name) {\n\t\ttomoyo_fill_path_info(buf);\n\t\treturn true;\n\t}\n\treturn false;\n}",
          "includes": [
            "#include <linux/slab.h>",
            "#include \"common.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/slab.h>\n#include \"common.h\"\n\nstatic bool tomoyo_get_realpath(struct tomoyo_path_info *buf, const struct path *path)\n{\n\tbuf->name = tomoyo_realpath_from_path(path);\n\tif (buf->name) {\n\t\ttomoyo_fill_path_info(buf);\n\t\treturn true;\n\t}\n\treturn false;\n}"
        }
      },
      {
        "call_info": {
          "callee": "tomoyo_read_lock",
          "args": [],
          "line": 705
        },
        "resolved": true,
        "details": {
          "function_name": "tomoyo_read_lock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/common.h",
          "lines": "1096-1099",
          "snippet": "static inline int tomoyo_read_lock(void)\n{\n\treturn srcu_read_lock(&tomoyo_ss);\n}",
          "includes": [
            "#include <net/udp.h>",
            "#include <net/ipv6.h>",
            "#include <net/ip.h>",
            "#include <net/af_unix.h>",
            "#include <net/sock.h>",
            "#include <linux/un.h>",
            "#include <linux/in6.h>",
            "#include <linux/in.h>",
            "#include <linux/inet.h>",
            "#include <linux/net.h>",
            "#include <linux/highmem.h>",
            "#include <linux/binfmts.h>",
            "#include <linux/poll.h>",
            "#include <linux/cred.h>",
            "#include <linux/list.h>",
            "#include <linux/mount.h>",
            "#include <linux/namei.h>",
            "#include <linux/sched.h>",
            "#include <linux/fs.h>",
            "#include <linux/kmod.h>",
            "#include <linux/file.h>",
            "#include <linux/mm.h>",
            "#include <linux/string.h>",
            "#include <linux/ctype.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <net/udp.h>\n#include <net/ipv6.h>\n#include <net/ip.h>\n#include <net/af_unix.h>\n#include <net/sock.h>\n#include <linux/un.h>\n#include <linux/in6.h>\n#include <linux/in.h>\n#include <linux/inet.h>\n#include <linux/net.h>\n#include <linux/highmem.h>\n#include <linux/binfmts.h>\n#include <linux/poll.h>\n#include <linux/cred.h>\n#include <linux/list.h>\n#include <linux/mount.h>\n#include <linux/namei.h>\n#include <linux/sched.h>\n#include <linux/fs.h>\n#include <linux/kmod.h>\n#include <linux/file.h>\n#include <linux/mm.h>\n#include <linux/string.h>\n#include <linux/ctype.h>\n\nstatic inline int tomoyo_read_lock(void)\n{\n\treturn srcu_read_lock(&tomoyo_ss);\n}"
        }
      },
      {
        "call_info": {
          "callee": "tomoyo_init_request_info",
          "args": [
            "&r",
            "NULL",
            "tomoyo_pn2mac[type]"
          ],
          "line": 702
        },
        "resolved": true,
        "details": {
          "function_name": "tomoyo_init_request_info",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/util.c",
          "lines": "984-997",
          "snippet": "int tomoyo_init_request_info(struct tomoyo_request_info *r,\n\t\t\t     struct tomoyo_domain_info *domain, const u8 index)\n{\n\tu8 profile;\n\tmemset(r, 0, sizeof(*r));\n\tif (!domain)\n\t\tdomain = tomoyo_domain();\n\tr->domain = domain;\n\tprofile = domain->profile;\n\tr->profile = profile;\n\tr->type = index;\n\tr->mode = tomoyo_get_mode(domain->ns, profile, index);\n\treturn r->mode;\n}",
          "includes": [
            "#include \"common.h\"",
            "#include <linux/rculist.h>",
            "#include <linux/slab.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common.h\"\n#include <linux/rculist.h>\n#include <linux/slab.h>\n\nint tomoyo_init_request_info(struct tomoyo_request_info *r,\n\t\t\t     struct tomoyo_domain_info *domain, const u8 index)\n{\n\tu8 profile;\n\tmemset(r, 0, sizeof(*r));\n\tif (!domain)\n\t\tdomain = tomoyo_domain();\n\tr->domain = domain;\n\tprofile = domain->profile;\n\tr->profile = profile;\n\tr->type = index;\n\tr->mode = tomoyo_get_mode(domain->ns, profile, index);\n\treturn r->mode;\n}"
        }
      }
    ],
    "contextual_snippet": "#include <linux/slab.h>\n#include \"common.h\"\n\nconst u8 tomoyo_pn2mac[TOMOYO_MAX_PATH_NUMBER_OPERATION] = {\n\t[TOMOYO_TYPE_CREATE] = TOMOYO_MAC_FILE_CREATE,\n\t[TOMOYO_TYPE_MKDIR]  = TOMOYO_MAC_FILE_MKDIR,\n\t[TOMOYO_TYPE_MKFIFO] = TOMOYO_MAC_FILE_MKFIFO,\n\t[TOMOYO_TYPE_MKSOCK] = TOMOYO_MAC_FILE_MKSOCK,\n\t[TOMOYO_TYPE_IOCTL]  = TOMOYO_MAC_FILE_IOCTL,\n\t[TOMOYO_TYPE_CHMOD]  = TOMOYO_MAC_FILE_CHMOD,\n\t[TOMOYO_TYPE_CHOWN]  = TOMOYO_MAC_FILE_CHOWN,\n\t[TOMOYO_TYPE_CHGRP]  = TOMOYO_MAC_FILE_CHGRP,\n};\n\nint tomoyo_path_number_perm(const u8 type, const struct path *path,\n\t\t\t    unsigned long number)\n{\n\tstruct tomoyo_request_info r;\n\tstruct tomoyo_obj_info obj = {\n\t\t.path1 = { .mnt = path->mnt, .dentry = path->dentry },\n\t};\n\tint error = -ENOMEM;\n\tstruct tomoyo_path_info buf;\n\tint idx;\n\n\tif (tomoyo_init_request_info(&r, NULL, tomoyo_pn2mac[type])\n\t    == TOMOYO_CONFIG_DISABLED || !path->dentry)\n\t\treturn 0;\n\tidx = tomoyo_read_lock();\n\tif (!tomoyo_get_realpath(&buf, path))\n\t\tgoto out;\n\tr.obj = &obj;\n\tif (type == TOMOYO_TYPE_MKDIR)\n\t\ttomoyo_add_slash(&buf);\n\tr.param_type = TOMOYO_TYPE_PATH_NUMBER_ACL;\n\tr.param.path_number.operation = type;\n\tr.param.path_number.filename = &buf;\n\tr.param.path_number.number = number;\n\tdo {\n\t\ttomoyo_check_acl(&r, tomoyo_check_path_number_acl);\n\t\terror = tomoyo_audit_path_number_log(&r);\n\t} while (error == TOMOYO_RETRY_REQUEST);\n\tkfree(buf.name);\n out:\n\ttomoyo_read_unlock(idx);\n\tif (r.mode != TOMOYO_CONFIG_ENFORCING)\n\t\terror = 0;\n\treturn error;\n}"
  },
  {
    "function_name": "tomoyo_update_path_number_acl",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/file.c",
    "lines": "662-680",
    "snippet": "static int tomoyo_update_path_number_acl(const u8 perm,\n\t\t\t\t\t struct tomoyo_acl_param *param)\n{\n\tstruct tomoyo_path_number_acl e = {\n\t\t.head.type = TOMOYO_TYPE_PATH_NUMBER_ACL,\n\t\t.perm = perm\n\t};\n\tint error;\n\tif (!tomoyo_parse_name_union(param, &e.name) ||\n\t    !tomoyo_parse_number_union(param, &e.number))\n\t\terror = -EINVAL;\n\telse\n\t\terror = tomoyo_update_domain(&e.head, sizeof(e), param,\n\t\t\t\t\t     tomoyo_same_path_number_acl,\n\t\t\t\t\t     tomoyo_merge_path_number_acl);\n\ttomoyo_put_name_union(&e.name);\n\ttomoyo_put_number_union(&e.number);\n\treturn error;\n}",
    "includes": [
      "#include <linux/slab.h>",
      "#include \"common.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "tomoyo_put_number_union",
          "args": [
            "&e.number"
          ],
          "line": 678
        },
        "resolved": true,
        "details": {
          "function_name": "tomoyo_put_number_union",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/file.c",
          "lines": "99-102",
          "snippet": "void tomoyo_put_number_union(struct tomoyo_number_union *ptr)\n{\n\ttomoyo_put_group(ptr->group);\n}",
          "includes": [
            "#include <linux/slab.h>",
            "#include \"common.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/slab.h>\n#include \"common.h\"\n\nvoid tomoyo_put_number_union(struct tomoyo_number_union *ptr)\n{\n\ttomoyo_put_group(ptr->group);\n}"
        }
      },
      {
        "call_info": {
          "callee": "tomoyo_put_name_union",
          "args": [
            "&e.name"
          ],
          "line": 677
        },
        "resolved": true,
        "details": {
          "function_name": "tomoyo_put_name_union",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/file.c",
          "lines": "67-71",
          "snippet": "void tomoyo_put_name_union(struct tomoyo_name_union *ptr)\n{\n\ttomoyo_put_group(ptr->group);\n\ttomoyo_put_name(ptr->filename);\n}",
          "includes": [
            "#include <linux/slab.h>",
            "#include \"common.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/slab.h>\n#include \"common.h\"\n\nvoid tomoyo_put_name_union(struct tomoyo_name_union *ptr)\n{\n\ttomoyo_put_group(ptr->group);\n\ttomoyo_put_name(ptr->filename);\n}"
        }
      },
      {
        "call_info": {
          "callee": "tomoyo_update_domain",
          "args": [
            "&e.head",
            "sizeof(e)",
            "param",
            "tomoyo_same_path_number_acl",
            "tomoyo_merge_path_number_acl"
          ],
          "line": 674
        },
        "resolved": true,
        "details": {
          "function_name": "tomoyo_update_domain",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/domain.c",
          "lines": "91-147",
          "snippet": "int tomoyo_update_domain(struct tomoyo_acl_info *new_entry, const int size,\n\t\t\t struct tomoyo_acl_param *param,\n\t\t\t bool (*check_duplicate) (const struct tomoyo_acl_info\n\t\t\t\t\t\t  *,\n\t\t\t\t\t\t  const struct tomoyo_acl_info\n\t\t\t\t\t\t  *),\n\t\t\t bool (*merge_duplicate) (struct tomoyo_acl_info *,\n\t\t\t\t\t\t  struct tomoyo_acl_info *,\n\t\t\t\t\t\t  const bool))\n{\n\tconst bool is_delete = param->is_delete;\n\tint error = is_delete ? -ENOENT : -ENOMEM;\n\tstruct tomoyo_acl_info *entry;\n\tstruct list_head * const list = param->list;\n\n\tif (param->data[0]) {\n\t\tnew_entry->cond = tomoyo_get_condition(param);\n\t\tif (!new_entry->cond)\n\t\t\treturn -EINVAL;\n\t\t/*\n\t\t * Domain transition preference is allowed for only\n\t\t * \"file execute\" entries.\n\t\t */\n\t\tif (new_entry->cond->transit &&\n\t\t    !(new_entry->type == TOMOYO_TYPE_PATH_ACL &&\n\t\t      container_of(new_entry, struct tomoyo_path_acl, head)\n\t\t      ->perm == 1 << TOMOYO_TYPE_EXECUTE))\n\t\t\tgoto out;\n\t}\n\tif (mutex_lock_interruptible(&tomoyo_policy_lock))\n\t\tgoto out;\n\tlist_for_each_entry_rcu(entry, list, list) {\n\t\tif (entry->is_deleted == TOMOYO_GC_IN_PROGRESS)\n\t\t\tcontinue;\n\t\tif (!tomoyo_same_acl_head(entry, new_entry) ||\n\t\t    !check_duplicate(entry, new_entry))\n\t\t\tcontinue;\n\t\tif (merge_duplicate)\n\t\t\tentry->is_deleted = merge_duplicate(entry, new_entry,\n\t\t\t\t\t\t\t    is_delete);\n\t\telse\n\t\t\tentry->is_deleted = is_delete;\n\t\terror = 0;\n\t\tbreak;\n\t}\n\tif (error && !is_delete) {\n\t\tentry = tomoyo_commit_ok(new_entry, size);\n\t\tif (entry) {\n\t\t\tlist_add_tail_rcu(&entry->list, list);\n\t\t\terror = 0;\n\t\t}\n\t}\n\tmutex_unlock(&tomoyo_policy_lock);\nout:\n\ttomoyo_put_condition(new_entry->cond);\n\treturn error;\n}",
          "includes": [
            "#include <linux/rculist.h>",
            "#include <linux/slab.h>",
            "#include <linux/binfmts.h>",
            "#include \"common.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/rculist.h>\n#include <linux/slab.h>\n#include <linux/binfmts.h>\n#include \"common.h\"\n\nint tomoyo_update_domain(struct tomoyo_acl_info *new_entry, const int size,\n\t\t\t struct tomoyo_acl_param *param,\n\t\t\t bool (*check_duplicate) (const struct tomoyo_acl_info\n\t\t\t\t\t\t  *,\n\t\t\t\t\t\t  const struct tomoyo_acl_info\n\t\t\t\t\t\t  *),\n\t\t\t bool (*merge_duplicate) (struct tomoyo_acl_info *,\n\t\t\t\t\t\t  struct tomoyo_acl_info *,\n\t\t\t\t\t\t  const bool))\n{\n\tconst bool is_delete = param->is_delete;\n\tint error = is_delete ? -ENOENT : -ENOMEM;\n\tstruct tomoyo_acl_info *entry;\n\tstruct list_head * const list = param->list;\n\n\tif (param->data[0]) {\n\t\tnew_entry->cond = tomoyo_get_condition(param);\n\t\tif (!new_entry->cond)\n\t\t\treturn -EINVAL;\n\t\t/*\n\t\t * Domain transition preference is allowed for only\n\t\t * \"file execute\" entries.\n\t\t */\n\t\tif (new_entry->cond->transit &&\n\t\t    !(new_entry->type == TOMOYO_TYPE_PATH_ACL &&\n\t\t      container_of(new_entry, struct tomoyo_path_acl, head)\n\t\t      ->perm == 1 << TOMOYO_TYPE_EXECUTE))\n\t\t\tgoto out;\n\t}\n\tif (mutex_lock_interruptible(&tomoyo_policy_lock))\n\t\tgoto out;\n\tlist_for_each_entry_rcu(entry, list, list) {\n\t\tif (entry->is_deleted == TOMOYO_GC_IN_PROGRESS)\n\t\t\tcontinue;\n\t\tif (!tomoyo_same_acl_head(entry, new_entry) ||\n\t\t    !check_duplicate(entry, new_entry))\n\t\t\tcontinue;\n\t\tif (merge_duplicate)\n\t\t\tentry->is_deleted = merge_duplicate(entry, new_entry,\n\t\t\t\t\t\t\t    is_delete);\n\t\telse\n\t\t\tentry->is_deleted = is_delete;\n\t\terror = 0;\n\t\tbreak;\n\t}\n\tif (error && !is_delete) {\n\t\tentry = tomoyo_commit_ok(new_entry, size);\n\t\tif (entry) {\n\t\t\tlist_add_tail_rcu(&entry->list, list);\n\t\t\terror = 0;\n\t\t}\n\t}\n\tmutex_unlock(&tomoyo_policy_lock);\nout:\n\ttomoyo_put_condition(new_entry->cond);\n\treturn error;\n}"
        }
      },
      {
        "call_info": {
          "callee": "tomoyo_parse_number_union",
          "args": [
            "param",
            "&e.number"
          ],
          "line": 671
        },
        "resolved": true,
        "details": {
          "function_name": "tomoyo_parse_number_union",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/util.c",
          "lines": "263-294",
          "snippet": "bool tomoyo_parse_number_union(struct tomoyo_acl_param *param,\n\t\t\t       struct tomoyo_number_union *ptr)\n{\n\tchar *data;\n\tu8 type;\n\tunsigned long v;\n\tmemset(ptr, 0, sizeof(*ptr));\n\tif (param->data[0] == '@') {\n\t\tparam->data++;\n\t\tptr->group = tomoyo_get_group(param, TOMOYO_NUMBER_GROUP);\n\t\treturn ptr->group != NULL;\n\t}\n\tdata = tomoyo_read_token(param);\n\ttype = tomoyo_parse_ulong(&v, &data);\n\tif (type == TOMOYO_VALUE_TYPE_INVALID)\n\t\treturn false;\n\tptr->values[0] = v;\n\tptr->value_type[0] = type;\n\tif (!*data) {\n\t\tptr->values[1] = v;\n\t\tptr->value_type[1] = type;\n\t\treturn true;\n\t}\n\tif (*data++ != '-')\n\t\treturn false;\n\ttype = tomoyo_parse_ulong(&v, &data);\n\tif (type == TOMOYO_VALUE_TYPE_INVALID || *data || ptr->values[0] > v)\n\t\treturn false;\n\tptr->values[1] = v;\n\tptr->value_type[1] = type;\n\treturn true;\n}",
          "includes": [
            "#include \"common.h\"",
            "#include <linux/rculist.h>",
            "#include <linux/slab.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common.h\"\n#include <linux/rculist.h>\n#include <linux/slab.h>\n\nbool tomoyo_parse_number_union(struct tomoyo_acl_param *param,\n\t\t\t       struct tomoyo_number_union *ptr)\n{\n\tchar *data;\n\tu8 type;\n\tunsigned long v;\n\tmemset(ptr, 0, sizeof(*ptr));\n\tif (param->data[0] == '@') {\n\t\tparam->data++;\n\t\tptr->group = tomoyo_get_group(param, TOMOYO_NUMBER_GROUP);\n\t\treturn ptr->group != NULL;\n\t}\n\tdata = tomoyo_read_token(param);\n\ttype = tomoyo_parse_ulong(&v, &data);\n\tif (type == TOMOYO_VALUE_TYPE_INVALID)\n\t\treturn false;\n\tptr->values[0] = v;\n\tptr->value_type[0] = type;\n\tif (!*data) {\n\t\tptr->values[1] = v;\n\t\tptr->value_type[1] = type;\n\t\treturn true;\n\t}\n\tif (*data++ != '-')\n\t\treturn false;\n\ttype = tomoyo_parse_ulong(&v, &data);\n\tif (type == TOMOYO_VALUE_TYPE_INVALID || *data || ptr->values[0] > v)\n\t\treturn false;\n\tptr->values[1] = v;\n\tptr->value_type[1] = type;\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "tomoyo_parse_name_union",
          "args": [
            "param",
            "&e.name"
          ],
          "line": 670
        },
        "resolved": true,
        "details": {
          "function_name": "tomoyo_parse_name_union_quoted",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/condition.c",
          "lines": "269-277",
          "snippet": "static bool tomoyo_parse_name_union_quoted(struct tomoyo_acl_param *param,\n\t\t\t\t\t   struct tomoyo_name_union *ptr)\n{\n\tchar *filename = param->data;\n\tif (*filename == '@')\n\t\treturn tomoyo_parse_name_union(param, ptr);\n\tptr->filename = tomoyo_get_dqword(filename);\n\treturn ptr->filename != NULL;\n}",
          "includes": [
            "#include <linux/slab.h>",
            "#include \"common.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/slab.h>\n#include \"common.h\"\n\nstatic bool tomoyo_parse_name_union_quoted(struct tomoyo_acl_param *param,\n\t\t\t\t\t   struct tomoyo_name_union *ptr)\n{\n\tchar *filename = param->data;\n\tif (*filename == '@')\n\t\treturn tomoyo_parse_name_union(param, ptr);\n\tptr->filename = tomoyo_get_dqword(filename);\n\treturn ptr->filename != NULL;\n}"
        }
      }
    ],
    "contextual_snippet": "#include <linux/slab.h>\n#include \"common.h\"\n\nstatic int tomoyo_update_path_number_acl(const u8 perm,\n\t\t\t\t\t struct tomoyo_acl_param *param)\n{\n\tstruct tomoyo_path_number_acl e = {\n\t\t.head.type = TOMOYO_TYPE_PATH_NUMBER_ACL,\n\t\t.perm = perm\n\t};\n\tint error;\n\tif (!tomoyo_parse_name_union(param, &e.name) ||\n\t    !tomoyo_parse_number_union(param, &e.number))\n\t\terror = -EINVAL;\n\telse\n\t\terror = tomoyo_update_domain(&e.head, sizeof(e), param,\n\t\t\t\t\t     tomoyo_same_path_number_acl,\n\t\t\t\t\t     tomoyo_merge_path_number_acl);\n\ttomoyo_put_name_union(&e.name);\n\ttomoyo_put_number_union(&e.number);\n\treturn error;\n}"
  },
  {
    "function_name": "tomoyo_merge_path_number_acl",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/file.c",
    "lines": "637-652",
    "snippet": "static bool tomoyo_merge_path_number_acl(struct tomoyo_acl_info *a,\n\t\t\t\t\t struct tomoyo_acl_info *b,\n\t\t\t\t\t const bool is_delete)\n{\n\tu8 * const a_perm = &container_of(a, struct tomoyo_path_number_acl,\n\t\t\t\t\t  head)->perm;\n\tu8 perm = *a_perm;\n\tconst u8 b_perm = container_of(b, struct tomoyo_path_number_acl, head)\n\t\t->perm;\n\tif (is_delete)\n\t\tperm &= ~b_perm;\n\telse\n\t\tperm |= b_perm;\n\t*a_perm = perm;\n\treturn !perm;\n}",
    "includes": [
      "#include <linux/slab.h>",
      "#include \"common.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "container_of",
          "args": [
            "b",
            "structtomoyo_path_number_acl",
            "head"
          ],
          "line": 644
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "container_of",
          "args": [
            "a",
            "structtomoyo_path_number_acl",
            "head"
          ],
          "line": 641
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <linux/slab.h>\n#include \"common.h\"\n\nstatic bool tomoyo_merge_path_number_acl(struct tomoyo_acl_info *a,\n\t\t\t\t\t struct tomoyo_acl_info *b,\n\t\t\t\t\t const bool is_delete)\n{\n\tu8 * const a_perm = &container_of(a, struct tomoyo_path_number_acl,\n\t\t\t\t\t  head)->perm;\n\tu8 perm = *a_perm;\n\tconst u8 b_perm = container_of(b, struct tomoyo_path_number_acl, head)\n\t\t->perm;\n\tif (is_delete)\n\t\tperm &= ~b_perm;\n\telse\n\t\tperm |= b_perm;\n\t*a_perm = perm;\n\treturn !perm;\n}"
  },
  {
    "function_name": "tomoyo_same_path_number_acl",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/file.c",
    "lines": "617-626",
    "snippet": "static bool tomoyo_same_path_number_acl(const struct tomoyo_acl_info *a,\n\t\t\t\t\tconst struct tomoyo_acl_info *b)\n{\n\tconst struct tomoyo_path_number_acl *p1 = container_of(a, typeof(*p1),\n\t\t\t\t\t\t\t       head);\n\tconst struct tomoyo_path_number_acl *p2 = container_of(b, typeof(*p2),\n\t\t\t\t\t\t\t       head);\n\treturn tomoyo_same_name_union(&p1->name, &p2->name) &&\n\t\ttomoyo_same_number_union(&p1->number, &p2->number);\n}",
    "includes": [
      "#include <linux/slab.h>",
      "#include \"common.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "tomoyo_same_number_union",
          "args": [
            "&p1->number",
            "&p2->number"
          ],
          "line": 625
        },
        "resolved": true,
        "details": {
          "function_name": "tomoyo_same_number_union",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/common.h",
          "lines": "1244-1250",
          "snippet": "static inline bool tomoyo_same_number_union\n(const struct tomoyo_number_union *a, const struct tomoyo_number_union *b)\n{\n\treturn a->values[0] == b->values[0] && a->values[1] == b->values[1] &&\n\t\ta->group == b->group && a->value_type[0] == b->value_type[0] &&\n\t\ta->value_type[1] == b->value_type[1];\n}",
          "includes": [
            "#include <net/udp.h>",
            "#include <net/ipv6.h>",
            "#include <net/ip.h>",
            "#include <net/af_unix.h>",
            "#include <net/sock.h>",
            "#include <linux/un.h>",
            "#include <linux/in6.h>",
            "#include <linux/in.h>",
            "#include <linux/inet.h>",
            "#include <linux/net.h>",
            "#include <linux/highmem.h>",
            "#include <linux/binfmts.h>",
            "#include <linux/poll.h>",
            "#include <linux/cred.h>",
            "#include <linux/list.h>",
            "#include <linux/mount.h>",
            "#include <linux/namei.h>",
            "#include <linux/sched.h>",
            "#include <linux/fs.h>",
            "#include <linux/kmod.h>",
            "#include <linux/file.h>",
            "#include <linux/mm.h>",
            "#include <linux/string.h>",
            "#include <linux/ctype.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <net/udp.h>\n#include <net/ipv6.h>\n#include <net/ip.h>\n#include <net/af_unix.h>\n#include <net/sock.h>\n#include <linux/un.h>\n#include <linux/in6.h>\n#include <linux/in.h>\n#include <linux/inet.h>\n#include <linux/net.h>\n#include <linux/highmem.h>\n#include <linux/binfmts.h>\n#include <linux/poll.h>\n#include <linux/cred.h>\n#include <linux/list.h>\n#include <linux/mount.h>\n#include <linux/namei.h>\n#include <linux/sched.h>\n#include <linux/fs.h>\n#include <linux/kmod.h>\n#include <linux/file.h>\n#include <linux/mm.h>\n#include <linux/string.h>\n#include <linux/ctype.h>\n\nstatic inline bool tomoyo_same_number_union\n(const struct tomoyo_number_union *a, const struct tomoyo_number_union *b)\n{\n\treturn a->values[0] == b->values[0] && a->values[1] == b->values[1] &&\n\t\ta->group == b->group && a->value_type[0] == b->value_type[0] &&\n\t\ta->value_type[1] == b->value_type[1];\n}"
        }
      },
      {
        "call_info": {
          "callee": "tomoyo_same_name_union",
          "args": [
            "&p1->name",
            "&p2->name"
          ],
          "line": 624
        },
        "resolved": true,
        "details": {
          "function_name": "tomoyo_same_name_union",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/common.h",
          "lines": "1230-1234",
          "snippet": "static inline bool tomoyo_same_name_union\n(const struct tomoyo_name_union *a, const struct tomoyo_name_union *b)\n{\n\treturn a->filename == b->filename && a->group == b->group;\n}",
          "includes": [
            "#include <net/udp.h>",
            "#include <net/ipv6.h>",
            "#include <net/ip.h>",
            "#include <net/af_unix.h>",
            "#include <net/sock.h>",
            "#include <linux/un.h>",
            "#include <linux/in6.h>",
            "#include <linux/in.h>",
            "#include <linux/inet.h>",
            "#include <linux/net.h>",
            "#include <linux/highmem.h>",
            "#include <linux/binfmts.h>",
            "#include <linux/poll.h>",
            "#include <linux/cred.h>",
            "#include <linux/list.h>",
            "#include <linux/mount.h>",
            "#include <linux/namei.h>",
            "#include <linux/sched.h>",
            "#include <linux/fs.h>",
            "#include <linux/kmod.h>",
            "#include <linux/file.h>",
            "#include <linux/mm.h>",
            "#include <linux/string.h>",
            "#include <linux/ctype.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <net/udp.h>\n#include <net/ipv6.h>\n#include <net/ip.h>\n#include <net/af_unix.h>\n#include <net/sock.h>\n#include <linux/un.h>\n#include <linux/in6.h>\n#include <linux/in.h>\n#include <linux/inet.h>\n#include <linux/net.h>\n#include <linux/highmem.h>\n#include <linux/binfmts.h>\n#include <linux/poll.h>\n#include <linux/cred.h>\n#include <linux/list.h>\n#include <linux/mount.h>\n#include <linux/namei.h>\n#include <linux/sched.h>\n#include <linux/fs.h>\n#include <linux/kmod.h>\n#include <linux/file.h>\n#include <linux/mm.h>\n#include <linux/string.h>\n#include <linux/ctype.h>\n\nstatic inline bool tomoyo_same_name_union\n(const struct tomoyo_name_union *a, const struct tomoyo_name_union *b)\n{\n\treturn a->filename == b->filename && a->group == b->group;\n}"
        }
      },
      {
        "call_info": {
          "callee": "container_of",
          "args": [
            "b",
            "typeof(*p2)",
            "head"
          ],
          "line": 622
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "typeof",
          "args": [
            "*p2"
          ],
          "line": 622
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "container_of",
          "args": [
            "a",
            "typeof(*p1)",
            "head"
          ],
          "line": 620
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "typeof",
          "args": [
            "*p1"
          ],
          "line": 620
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <linux/slab.h>\n#include \"common.h\"\n\nstatic bool tomoyo_same_path_number_acl(const struct tomoyo_acl_info *a,\n\t\t\t\t\tconst struct tomoyo_acl_info *b)\n{\n\tconst struct tomoyo_path_number_acl *p1 = container_of(a, typeof(*p1),\n\t\t\t\t\t\t\t       head);\n\tconst struct tomoyo_path_number_acl *p2 = container_of(b, typeof(*p2),\n\t\t\t\t\t\t\t       head);\n\treturn tomoyo_same_name_union(&p1->name, &p2->name) &&\n\t\ttomoyo_same_number_union(&p1->number, &p2->number);\n}"
  },
  {
    "function_name": "tomoyo_execute_permission",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/file.c",
    "lines": "588-607",
    "snippet": "int tomoyo_execute_permission(struct tomoyo_request_info *r,\n\t\t\t      const struct tomoyo_path_info *filename)\n{\n\t/*\n\t * Unlike other permission checks, this check is done regardless of\n\t * profile mode settings in order to check for domain transition\n\t * preference.\n\t */\n\tr->type = TOMOYO_MAC_FILE_EXECUTE;\n\tr->mode = tomoyo_get_mode(r->domain->ns, r->profile, r->type);\n\tr->param_type = TOMOYO_TYPE_PATH_ACL;\n\tr->param.path.filename = filename;\n\tr->param.path.operation = TOMOYO_TYPE_EXECUTE;\n\ttomoyo_check_acl(r, tomoyo_check_path_acl);\n\tr->ee->transition = r->matched_acl && r->matched_acl->cond ?\n\t\tr->matched_acl->cond->transit : NULL;\n\tif (r->mode != TOMOYO_CONFIG_DISABLED)\n\t\treturn tomoyo_audit_path_log(r);\n\treturn 0;\n}",
    "includes": [
      "#include <linux/slab.h>",
      "#include \"common.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "tomoyo_audit_path_log",
          "args": [
            "r"
          ],
          "line": 605
        },
        "resolved": true,
        "details": {
          "function_name": "tomoyo_audit_path_log",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/file.c",
          "lines": "166-171",
          "snippet": "static int tomoyo_audit_path_log(struct tomoyo_request_info *r)\n{\n\treturn tomoyo_supervisor(r, \"file %s %s\\n\", tomoyo_path_keyword\n\t\t\t\t [r->param.path.operation],\n\t\t\t\t r->param.path.filename->name);\n}",
          "includes": [
            "#include <linux/slab.h>",
            "#include \"common.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/slab.h>\n#include \"common.h\"\n\nstatic int tomoyo_audit_path_log(struct tomoyo_request_info *r)\n{\n\treturn tomoyo_supervisor(r, \"file %s %s\\n\", tomoyo_path_keyword\n\t\t\t\t [r->param.path.operation],\n\t\t\t\t r->param.path.filename->name);\n}"
        }
      },
      {
        "call_info": {
          "callee": "tomoyo_check_acl",
          "args": [
            "r",
            "tomoyo_check_path_acl"
          ],
          "line": 601
        },
        "resolved": true,
        "details": {
          "function_name": "tomoyo_check_acl",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/domain.c",
          "lines": "159-186",
          "snippet": "void tomoyo_check_acl(struct tomoyo_request_info *r,\n\t\t      bool (*check_entry) (struct tomoyo_request_info *,\n\t\t\t\t\t   const struct tomoyo_acl_info *))\n{\n\tconst struct tomoyo_domain_info *domain = r->domain;\n\tstruct tomoyo_acl_info *ptr;\n\tbool retried = false;\n\tconst struct list_head *list = &domain->acl_info_list;\n\nretry:\n\tlist_for_each_entry_rcu(ptr, list, list) {\n\t\tif (ptr->is_deleted || ptr->type != r->param_type)\n\t\t\tcontinue;\n\t\tif (!check_entry(r, ptr))\n\t\t\tcontinue;\n\t\tif (!tomoyo_condition(r, ptr->cond))\n\t\t\tcontinue;\n\t\tr->matched_acl = ptr;\n\t\tr->granted = true;\n\t\treturn;\n\t}\n\tif (!retried) {\n\t\tretried = true;\n\t\tlist = &domain->ns->acl_group[domain->group];\n\t\tgoto retry;\n\t}\n\tr->granted = false;\n}",
          "includes": [
            "#include <linux/rculist.h>",
            "#include <linux/slab.h>",
            "#include <linux/binfmts.h>",
            "#include \"common.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/rculist.h>\n#include <linux/slab.h>\n#include <linux/binfmts.h>\n#include \"common.h\"\n\nvoid tomoyo_check_acl(struct tomoyo_request_info *r,\n\t\t      bool (*check_entry) (struct tomoyo_request_info *,\n\t\t\t\t\t   const struct tomoyo_acl_info *))\n{\n\tconst struct tomoyo_domain_info *domain = r->domain;\n\tstruct tomoyo_acl_info *ptr;\n\tbool retried = false;\n\tconst struct list_head *list = &domain->acl_info_list;\n\nretry:\n\tlist_for_each_entry_rcu(ptr, list, list) {\n\t\tif (ptr->is_deleted || ptr->type != r->param_type)\n\t\t\tcontinue;\n\t\tif (!check_entry(r, ptr))\n\t\t\tcontinue;\n\t\tif (!tomoyo_condition(r, ptr->cond))\n\t\t\tcontinue;\n\t\tr->matched_acl = ptr;\n\t\tr->granted = true;\n\t\treturn;\n\t}\n\tif (!retried) {\n\t\tretried = true;\n\t\tlist = &domain->ns->acl_group[domain->group];\n\t\tgoto retry;\n\t}\n\tr->granted = false;\n}"
        }
      },
      {
        "call_info": {
          "callee": "tomoyo_get_mode",
          "args": [
            "r->domain->ns",
            "r->profile",
            "r->type"
          ],
          "line": 597
        },
        "resolved": true,
        "details": {
          "function_name": "tomoyo_get_mode",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/util.c",
          "lines": "957-973",
          "snippet": "int tomoyo_get_mode(const struct tomoyo_policy_namespace *ns, const u8 profile,\n\t\t    const u8 index)\n{\n\tu8 mode;\n\tstruct tomoyo_profile *p;\n\n\tif (!tomoyo_policy_loaded)\n\t\treturn TOMOYO_CONFIG_DISABLED;\n\tp = tomoyo_profile(ns, profile);\n\tmode = p->config[index];\n\tif (mode == TOMOYO_CONFIG_USE_DEFAULT)\n\t\tmode = p->config[tomoyo_index2category[index]\n\t\t\t\t + TOMOYO_MAX_MAC_INDEX];\n\tif (mode == TOMOYO_CONFIG_USE_DEFAULT)\n\t\tmode = p->default_config;\n\treturn mode & 3;\n}",
          "includes": [
            "#include \"common.h\"",
            "#include <linux/rculist.h>",
            "#include <linux/slab.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "bool tomoyo_policy_loaded;",
            "const u8 tomoyo_index2category[TOMOYO_MAX_MAC_INDEX] = {\n\t/* CONFIG::file group */\n\t[TOMOYO_MAC_FILE_EXECUTE]    = TOMOYO_MAC_CATEGORY_FILE,\n\t[TOMOYO_MAC_FILE_OPEN]       = TOMOYO_MAC_CATEGORY_FILE,\n\t[TOMOYO_MAC_FILE_CREATE]     = TOMOYO_MAC_CATEGORY_FILE,\n\t[TOMOYO_MAC_FILE_UNLINK]     = TOMOYO_MAC_CATEGORY_FILE,\n\t[TOMOYO_MAC_FILE_GETATTR]    = TOMOYO_MAC_CATEGORY_FILE,\n\t[TOMOYO_MAC_FILE_MKDIR]      = TOMOYO_MAC_CATEGORY_FILE,\n\t[TOMOYO_MAC_FILE_RMDIR]      = TOMOYO_MAC_CATEGORY_FILE,\n\t[TOMOYO_MAC_FILE_MKFIFO]     = TOMOYO_MAC_CATEGORY_FILE,\n\t[TOMOYO_MAC_FILE_MKSOCK]     = TOMOYO_MAC_CATEGORY_FILE,\n\t[TOMOYO_MAC_FILE_TRUNCATE]   = TOMOYO_MAC_CATEGORY_FILE,\n\t[TOMOYO_MAC_FILE_SYMLINK]    = TOMOYO_MAC_CATEGORY_FILE,\n\t[TOMOYO_MAC_FILE_MKBLOCK]    = TOMOYO_MAC_CATEGORY_FILE,\n\t[TOMOYO_MAC_FILE_MKCHAR]     = TOMOYO_MAC_CATEGORY_FILE,\n\t[TOMOYO_MAC_FILE_LINK]       = TOMOYO_MAC_CATEGORY_FILE,\n\t[TOMOYO_MAC_FILE_RENAME]     = TOMOYO_MAC_CATEGORY_FILE,\n\t[TOMOYO_MAC_FILE_CHMOD]      = TOMOYO_MAC_CATEGORY_FILE,\n\t[TOMOYO_MAC_FILE_CHOWN]      = TOMOYO_MAC_CATEGORY_FILE,\n\t[TOMOYO_MAC_FILE_CHGRP]      = TOMOYO_MAC_CATEGORY_FILE,\n\t[TOMOYO_MAC_FILE_IOCTL]      = TOMOYO_MAC_CATEGORY_FILE,\n\t[TOMOYO_MAC_FILE_CHROOT]     = TOMOYO_MAC_CATEGORY_FILE,\n\t[TOMOYO_MAC_FILE_MOUNT]      = TOMOYO_MAC_CATEGORY_FILE,\n\t[TOMOYO_MAC_FILE_UMOUNT]     = TOMOYO_MAC_CATEGORY_FILE,\n\t[TOMOYO_MAC_FILE_PIVOT_ROOT] = TOMOYO_MAC_CATEGORY_FILE,\n\t/* CONFIG::network group */\n\t[TOMOYO_MAC_NETWORK_INET_STREAM_BIND]       =\n\tTOMOYO_MAC_CATEGORY_NETWORK,\n\t[TOMOYO_MAC_NETWORK_INET_STREAM_LISTEN]     =\n\tTOMOYO_MAC_CATEGORY_NETWORK,\n\t[TOMOYO_MAC_NETWORK_INET_STREAM_CONNECT]    =\n\tTOMOYO_MAC_CATEGORY_NETWORK,\n\t[TOMOYO_MAC_NETWORK_INET_DGRAM_BIND]        =\n\tTOMOYO_MAC_CATEGORY_NETWORK,\n\t[TOMOYO_MAC_NETWORK_INET_DGRAM_SEND]        =\n\tTOMOYO_MAC_CATEGORY_NETWORK,\n\t[TOMOYO_MAC_NETWORK_INET_RAW_BIND]          =\n\tTOMOYO_MAC_CATEGORY_NETWORK,\n\t[TOMOYO_MAC_NETWORK_INET_RAW_SEND]          =\n\tTOMOYO_MAC_CATEGORY_NETWORK,\n\t[TOMOYO_MAC_NETWORK_UNIX_STREAM_BIND]       =\n\tTOMOYO_MAC_CATEGORY_NETWORK,\n\t[TOMOYO_MAC_NETWORK_UNIX_STREAM_LISTEN]     =\n\tTOMOYO_MAC_CATEGORY_NETWORK,\n\t[TOMOYO_MAC_NETWORK_UNIX_STREAM_CONNECT]    =\n\tTOMOYO_MAC_CATEGORY_NETWORK,\n\t[TOMOYO_MAC_NETWORK_UNIX_DGRAM_BIND]        =\n\tTOMOYO_MAC_CATEGORY_NETWORK,\n\t[TOMOYO_MAC_NETWORK_UNIX_DGRAM_SEND]        =\n\tTOMOYO_MAC_CATEGORY_NETWORK,\n\t[TOMOYO_MAC_NETWORK_UNIX_SEQPACKET_BIND]    =\n\tTOMOYO_MAC_CATEGORY_NETWORK,\n\t[TOMOYO_MAC_NETWORK_UNIX_SEQPACKET_LISTEN]  =\n\tTOMOYO_MAC_CATEGORY_NETWORK,\n\t[TOMOYO_MAC_NETWORK_UNIX_SEQPACKET_CONNECT] =\n\tTOMOYO_MAC_CATEGORY_NETWORK,\n\t/* CONFIG::misc group */\n\t[TOMOYO_MAC_ENVIRON]         = TOMOYO_MAC_CATEGORY_MISC,\n};"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"common.h\"\n#include <linux/rculist.h>\n#include <linux/slab.h>\n\nbool tomoyo_policy_loaded;\nconst u8 tomoyo_index2category[TOMOYO_MAX_MAC_INDEX] = {\n\t/* CONFIG::file group */\n\t[TOMOYO_MAC_FILE_EXECUTE]    = TOMOYO_MAC_CATEGORY_FILE,\n\t[TOMOYO_MAC_FILE_OPEN]       = TOMOYO_MAC_CATEGORY_FILE,\n\t[TOMOYO_MAC_FILE_CREATE]     = TOMOYO_MAC_CATEGORY_FILE,\n\t[TOMOYO_MAC_FILE_UNLINK]     = TOMOYO_MAC_CATEGORY_FILE,\n\t[TOMOYO_MAC_FILE_GETATTR]    = TOMOYO_MAC_CATEGORY_FILE,\n\t[TOMOYO_MAC_FILE_MKDIR]      = TOMOYO_MAC_CATEGORY_FILE,\n\t[TOMOYO_MAC_FILE_RMDIR]      = TOMOYO_MAC_CATEGORY_FILE,\n\t[TOMOYO_MAC_FILE_MKFIFO]     = TOMOYO_MAC_CATEGORY_FILE,\n\t[TOMOYO_MAC_FILE_MKSOCK]     = TOMOYO_MAC_CATEGORY_FILE,\n\t[TOMOYO_MAC_FILE_TRUNCATE]   = TOMOYO_MAC_CATEGORY_FILE,\n\t[TOMOYO_MAC_FILE_SYMLINK]    = TOMOYO_MAC_CATEGORY_FILE,\n\t[TOMOYO_MAC_FILE_MKBLOCK]    = TOMOYO_MAC_CATEGORY_FILE,\n\t[TOMOYO_MAC_FILE_MKCHAR]     = TOMOYO_MAC_CATEGORY_FILE,\n\t[TOMOYO_MAC_FILE_LINK]       = TOMOYO_MAC_CATEGORY_FILE,\n\t[TOMOYO_MAC_FILE_RENAME]     = TOMOYO_MAC_CATEGORY_FILE,\n\t[TOMOYO_MAC_FILE_CHMOD]      = TOMOYO_MAC_CATEGORY_FILE,\n\t[TOMOYO_MAC_FILE_CHOWN]      = TOMOYO_MAC_CATEGORY_FILE,\n\t[TOMOYO_MAC_FILE_CHGRP]      = TOMOYO_MAC_CATEGORY_FILE,\n\t[TOMOYO_MAC_FILE_IOCTL]      = TOMOYO_MAC_CATEGORY_FILE,\n\t[TOMOYO_MAC_FILE_CHROOT]     = TOMOYO_MAC_CATEGORY_FILE,\n\t[TOMOYO_MAC_FILE_MOUNT]      = TOMOYO_MAC_CATEGORY_FILE,\n\t[TOMOYO_MAC_FILE_UMOUNT]     = TOMOYO_MAC_CATEGORY_FILE,\n\t[TOMOYO_MAC_FILE_PIVOT_ROOT] = TOMOYO_MAC_CATEGORY_FILE,\n\t/* CONFIG::network group */\n\t[TOMOYO_MAC_NETWORK_INET_STREAM_BIND]       =\n\tTOMOYO_MAC_CATEGORY_NETWORK,\n\t[TOMOYO_MAC_NETWORK_INET_STREAM_LISTEN]     =\n\tTOMOYO_MAC_CATEGORY_NETWORK,\n\t[TOMOYO_MAC_NETWORK_INET_STREAM_CONNECT]    =\n\tTOMOYO_MAC_CATEGORY_NETWORK,\n\t[TOMOYO_MAC_NETWORK_INET_DGRAM_BIND]        =\n\tTOMOYO_MAC_CATEGORY_NETWORK,\n\t[TOMOYO_MAC_NETWORK_INET_DGRAM_SEND]        =\n\tTOMOYO_MAC_CATEGORY_NETWORK,\n\t[TOMOYO_MAC_NETWORK_INET_RAW_BIND]          =\n\tTOMOYO_MAC_CATEGORY_NETWORK,\n\t[TOMOYO_MAC_NETWORK_INET_RAW_SEND]          =\n\tTOMOYO_MAC_CATEGORY_NETWORK,\n\t[TOMOYO_MAC_NETWORK_UNIX_STREAM_BIND]       =\n\tTOMOYO_MAC_CATEGORY_NETWORK,\n\t[TOMOYO_MAC_NETWORK_UNIX_STREAM_LISTEN]     =\n\tTOMOYO_MAC_CATEGORY_NETWORK,\n\t[TOMOYO_MAC_NETWORK_UNIX_STREAM_CONNECT]    =\n\tTOMOYO_MAC_CATEGORY_NETWORK,\n\t[TOMOYO_MAC_NETWORK_UNIX_DGRAM_BIND]        =\n\tTOMOYO_MAC_CATEGORY_NETWORK,\n\t[TOMOYO_MAC_NETWORK_UNIX_DGRAM_SEND]        =\n\tTOMOYO_MAC_CATEGORY_NETWORK,\n\t[TOMOYO_MAC_NETWORK_UNIX_SEQPACKET_BIND]    =\n\tTOMOYO_MAC_CATEGORY_NETWORK,\n\t[TOMOYO_MAC_NETWORK_UNIX_SEQPACKET_LISTEN]  =\n\tTOMOYO_MAC_CATEGORY_NETWORK,\n\t[TOMOYO_MAC_NETWORK_UNIX_SEQPACKET_CONNECT] =\n\tTOMOYO_MAC_CATEGORY_NETWORK,\n\t/* CONFIG::misc group */\n\t[TOMOYO_MAC_ENVIRON]         = TOMOYO_MAC_CATEGORY_MISC,\n};\n\nint tomoyo_get_mode(const struct tomoyo_policy_namespace *ns, const u8 profile,\n\t\t    const u8 index)\n{\n\tu8 mode;\n\tstruct tomoyo_profile *p;\n\n\tif (!tomoyo_policy_loaded)\n\t\treturn TOMOYO_CONFIG_DISABLED;\n\tp = tomoyo_profile(ns, profile);\n\tmode = p->config[index];\n\tif (mode == TOMOYO_CONFIG_USE_DEFAULT)\n\t\tmode = p->config[tomoyo_index2category[index]\n\t\t\t\t + TOMOYO_MAX_MAC_INDEX];\n\tif (mode == TOMOYO_CONFIG_USE_DEFAULT)\n\t\tmode = p->default_config;\n\treturn mode & 3;\n}"
        }
      }
    ],
    "contextual_snippet": "#include <linux/slab.h>\n#include \"common.h\"\n\nint tomoyo_execute_permission(struct tomoyo_request_info *r,\n\t\t\t      const struct tomoyo_path_info *filename)\n{\n\t/*\n\t * Unlike other permission checks, this check is done regardless of\n\t * profile mode settings in order to check for domain transition\n\t * preference.\n\t */\n\tr->type = TOMOYO_MAC_FILE_EXECUTE;\n\tr->mode = tomoyo_get_mode(r->domain->ns, r->profile, r->type);\n\tr->param_type = TOMOYO_TYPE_PATH_ACL;\n\tr->param.path.filename = filename;\n\tr->param.path.operation = TOMOYO_TYPE_EXECUTE;\n\ttomoyo_check_acl(r, tomoyo_check_path_acl);\n\tr->ee->transition = r->matched_acl && r->matched_acl->cond ?\n\t\tr->matched_acl->cond->transit : NULL;\n\tif (r->mode != TOMOYO_CONFIG_DISABLED)\n\t\treturn tomoyo_audit_path_log(r);\n\treturn 0;\n}"
  },
  {
    "function_name": "tomoyo_path_permission",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/file.c",
    "lines": "559-576",
    "snippet": "static int tomoyo_path_permission(struct tomoyo_request_info *r, u8 operation,\n\t\t\t\t  const struct tomoyo_path_info *filename)\n{\n\tint error;\n\n\tr->type = tomoyo_p2mac[operation];\n\tr->mode = tomoyo_get_mode(r->domain->ns, r->profile, r->type);\n\tif (r->mode == TOMOYO_CONFIG_DISABLED)\n\t\treturn 0;\n\tr->param_type = TOMOYO_TYPE_PATH_ACL;\n\tr->param.path.filename = filename;\n\tr->param.path.operation = operation;\n\tdo {\n\t\ttomoyo_check_acl(r, tomoyo_check_path_acl);\n\t\terror = tomoyo_audit_path_log(r);\n\t} while (error == TOMOYO_RETRY_REQUEST);\n\treturn error;\n}",
    "includes": [
      "#include <linux/slab.h>",
      "#include \"common.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "static const u8 tomoyo_p2mac[TOMOYO_MAX_PATH_OPERATION] = {\n\t[TOMOYO_TYPE_EXECUTE]    = TOMOYO_MAC_FILE_EXECUTE,\n\t[TOMOYO_TYPE_READ]       = TOMOYO_MAC_FILE_OPEN,\n\t[TOMOYO_TYPE_WRITE]      = TOMOYO_MAC_FILE_OPEN,\n\t[TOMOYO_TYPE_APPEND]     = TOMOYO_MAC_FILE_OPEN,\n\t[TOMOYO_TYPE_UNLINK]     = TOMOYO_MAC_FILE_UNLINK,\n\t[TOMOYO_TYPE_GETATTR]    = TOMOYO_MAC_FILE_GETATTR,\n\t[TOMOYO_TYPE_RMDIR]      = TOMOYO_MAC_FILE_RMDIR,\n\t[TOMOYO_TYPE_TRUNCATE]   = TOMOYO_MAC_FILE_TRUNCATE,\n\t[TOMOYO_TYPE_SYMLINK]    = TOMOYO_MAC_FILE_SYMLINK,\n\t[TOMOYO_TYPE_CHROOT]     = TOMOYO_MAC_FILE_CHROOT,\n\t[TOMOYO_TYPE_UMOUNT]     = TOMOYO_MAC_FILE_UMOUNT,\n};"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "tomoyo_audit_path_log",
          "args": [
            "r"
          ],
          "line": 573
        },
        "resolved": true,
        "details": {
          "function_name": "tomoyo_audit_path_log",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/file.c",
          "lines": "166-171",
          "snippet": "static int tomoyo_audit_path_log(struct tomoyo_request_info *r)\n{\n\treturn tomoyo_supervisor(r, \"file %s %s\\n\", tomoyo_path_keyword\n\t\t\t\t [r->param.path.operation],\n\t\t\t\t r->param.path.filename->name);\n}",
          "includes": [
            "#include <linux/slab.h>",
            "#include \"common.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/slab.h>\n#include \"common.h\"\n\nstatic int tomoyo_audit_path_log(struct tomoyo_request_info *r)\n{\n\treturn tomoyo_supervisor(r, \"file %s %s\\n\", tomoyo_path_keyword\n\t\t\t\t [r->param.path.operation],\n\t\t\t\t r->param.path.filename->name);\n}"
        }
      },
      {
        "call_info": {
          "callee": "tomoyo_check_acl",
          "args": [
            "r",
            "tomoyo_check_path_acl"
          ],
          "line": 572
        },
        "resolved": true,
        "details": {
          "function_name": "tomoyo_check_acl",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/domain.c",
          "lines": "159-186",
          "snippet": "void tomoyo_check_acl(struct tomoyo_request_info *r,\n\t\t      bool (*check_entry) (struct tomoyo_request_info *,\n\t\t\t\t\t   const struct tomoyo_acl_info *))\n{\n\tconst struct tomoyo_domain_info *domain = r->domain;\n\tstruct tomoyo_acl_info *ptr;\n\tbool retried = false;\n\tconst struct list_head *list = &domain->acl_info_list;\n\nretry:\n\tlist_for_each_entry_rcu(ptr, list, list) {\n\t\tif (ptr->is_deleted || ptr->type != r->param_type)\n\t\t\tcontinue;\n\t\tif (!check_entry(r, ptr))\n\t\t\tcontinue;\n\t\tif (!tomoyo_condition(r, ptr->cond))\n\t\t\tcontinue;\n\t\tr->matched_acl = ptr;\n\t\tr->granted = true;\n\t\treturn;\n\t}\n\tif (!retried) {\n\t\tretried = true;\n\t\tlist = &domain->ns->acl_group[domain->group];\n\t\tgoto retry;\n\t}\n\tr->granted = false;\n}",
          "includes": [
            "#include <linux/rculist.h>",
            "#include <linux/slab.h>",
            "#include <linux/binfmts.h>",
            "#include \"common.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/rculist.h>\n#include <linux/slab.h>\n#include <linux/binfmts.h>\n#include \"common.h\"\n\nvoid tomoyo_check_acl(struct tomoyo_request_info *r,\n\t\t      bool (*check_entry) (struct tomoyo_request_info *,\n\t\t\t\t\t   const struct tomoyo_acl_info *))\n{\n\tconst struct tomoyo_domain_info *domain = r->domain;\n\tstruct tomoyo_acl_info *ptr;\n\tbool retried = false;\n\tconst struct list_head *list = &domain->acl_info_list;\n\nretry:\n\tlist_for_each_entry_rcu(ptr, list, list) {\n\t\tif (ptr->is_deleted || ptr->type != r->param_type)\n\t\t\tcontinue;\n\t\tif (!check_entry(r, ptr))\n\t\t\tcontinue;\n\t\tif (!tomoyo_condition(r, ptr->cond))\n\t\t\tcontinue;\n\t\tr->matched_acl = ptr;\n\t\tr->granted = true;\n\t\treturn;\n\t}\n\tif (!retried) {\n\t\tretried = true;\n\t\tlist = &domain->ns->acl_group[domain->group];\n\t\tgoto retry;\n\t}\n\tr->granted = false;\n}"
        }
      },
      {
        "call_info": {
          "callee": "tomoyo_get_mode",
          "args": [
            "r->domain->ns",
            "r->profile",
            "r->type"
          ],
          "line": 565
        },
        "resolved": true,
        "details": {
          "function_name": "tomoyo_get_mode",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/util.c",
          "lines": "957-973",
          "snippet": "int tomoyo_get_mode(const struct tomoyo_policy_namespace *ns, const u8 profile,\n\t\t    const u8 index)\n{\n\tu8 mode;\n\tstruct tomoyo_profile *p;\n\n\tif (!tomoyo_policy_loaded)\n\t\treturn TOMOYO_CONFIG_DISABLED;\n\tp = tomoyo_profile(ns, profile);\n\tmode = p->config[index];\n\tif (mode == TOMOYO_CONFIG_USE_DEFAULT)\n\t\tmode = p->config[tomoyo_index2category[index]\n\t\t\t\t + TOMOYO_MAX_MAC_INDEX];\n\tif (mode == TOMOYO_CONFIG_USE_DEFAULT)\n\t\tmode = p->default_config;\n\treturn mode & 3;\n}",
          "includes": [
            "#include \"common.h\"",
            "#include <linux/rculist.h>",
            "#include <linux/slab.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "bool tomoyo_policy_loaded;",
            "const u8 tomoyo_index2category[TOMOYO_MAX_MAC_INDEX] = {\n\t/* CONFIG::file group */\n\t[TOMOYO_MAC_FILE_EXECUTE]    = TOMOYO_MAC_CATEGORY_FILE,\n\t[TOMOYO_MAC_FILE_OPEN]       = TOMOYO_MAC_CATEGORY_FILE,\n\t[TOMOYO_MAC_FILE_CREATE]     = TOMOYO_MAC_CATEGORY_FILE,\n\t[TOMOYO_MAC_FILE_UNLINK]     = TOMOYO_MAC_CATEGORY_FILE,\n\t[TOMOYO_MAC_FILE_GETATTR]    = TOMOYO_MAC_CATEGORY_FILE,\n\t[TOMOYO_MAC_FILE_MKDIR]      = TOMOYO_MAC_CATEGORY_FILE,\n\t[TOMOYO_MAC_FILE_RMDIR]      = TOMOYO_MAC_CATEGORY_FILE,\n\t[TOMOYO_MAC_FILE_MKFIFO]     = TOMOYO_MAC_CATEGORY_FILE,\n\t[TOMOYO_MAC_FILE_MKSOCK]     = TOMOYO_MAC_CATEGORY_FILE,\n\t[TOMOYO_MAC_FILE_TRUNCATE]   = TOMOYO_MAC_CATEGORY_FILE,\n\t[TOMOYO_MAC_FILE_SYMLINK]    = TOMOYO_MAC_CATEGORY_FILE,\n\t[TOMOYO_MAC_FILE_MKBLOCK]    = TOMOYO_MAC_CATEGORY_FILE,\n\t[TOMOYO_MAC_FILE_MKCHAR]     = TOMOYO_MAC_CATEGORY_FILE,\n\t[TOMOYO_MAC_FILE_LINK]       = TOMOYO_MAC_CATEGORY_FILE,\n\t[TOMOYO_MAC_FILE_RENAME]     = TOMOYO_MAC_CATEGORY_FILE,\n\t[TOMOYO_MAC_FILE_CHMOD]      = TOMOYO_MAC_CATEGORY_FILE,\n\t[TOMOYO_MAC_FILE_CHOWN]      = TOMOYO_MAC_CATEGORY_FILE,\n\t[TOMOYO_MAC_FILE_CHGRP]      = TOMOYO_MAC_CATEGORY_FILE,\n\t[TOMOYO_MAC_FILE_IOCTL]      = TOMOYO_MAC_CATEGORY_FILE,\n\t[TOMOYO_MAC_FILE_CHROOT]     = TOMOYO_MAC_CATEGORY_FILE,\n\t[TOMOYO_MAC_FILE_MOUNT]      = TOMOYO_MAC_CATEGORY_FILE,\n\t[TOMOYO_MAC_FILE_UMOUNT]     = TOMOYO_MAC_CATEGORY_FILE,\n\t[TOMOYO_MAC_FILE_PIVOT_ROOT] = TOMOYO_MAC_CATEGORY_FILE,\n\t/* CONFIG::network group */\n\t[TOMOYO_MAC_NETWORK_INET_STREAM_BIND]       =\n\tTOMOYO_MAC_CATEGORY_NETWORK,\n\t[TOMOYO_MAC_NETWORK_INET_STREAM_LISTEN]     =\n\tTOMOYO_MAC_CATEGORY_NETWORK,\n\t[TOMOYO_MAC_NETWORK_INET_STREAM_CONNECT]    =\n\tTOMOYO_MAC_CATEGORY_NETWORK,\n\t[TOMOYO_MAC_NETWORK_INET_DGRAM_BIND]        =\n\tTOMOYO_MAC_CATEGORY_NETWORK,\n\t[TOMOYO_MAC_NETWORK_INET_DGRAM_SEND]        =\n\tTOMOYO_MAC_CATEGORY_NETWORK,\n\t[TOMOYO_MAC_NETWORK_INET_RAW_BIND]          =\n\tTOMOYO_MAC_CATEGORY_NETWORK,\n\t[TOMOYO_MAC_NETWORK_INET_RAW_SEND]          =\n\tTOMOYO_MAC_CATEGORY_NETWORK,\n\t[TOMOYO_MAC_NETWORK_UNIX_STREAM_BIND]       =\n\tTOMOYO_MAC_CATEGORY_NETWORK,\n\t[TOMOYO_MAC_NETWORK_UNIX_STREAM_LISTEN]     =\n\tTOMOYO_MAC_CATEGORY_NETWORK,\n\t[TOMOYO_MAC_NETWORK_UNIX_STREAM_CONNECT]    =\n\tTOMOYO_MAC_CATEGORY_NETWORK,\n\t[TOMOYO_MAC_NETWORK_UNIX_DGRAM_BIND]        =\n\tTOMOYO_MAC_CATEGORY_NETWORK,\n\t[TOMOYO_MAC_NETWORK_UNIX_DGRAM_SEND]        =\n\tTOMOYO_MAC_CATEGORY_NETWORK,\n\t[TOMOYO_MAC_NETWORK_UNIX_SEQPACKET_BIND]    =\n\tTOMOYO_MAC_CATEGORY_NETWORK,\n\t[TOMOYO_MAC_NETWORK_UNIX_SEQPACKET_LISTEN]  =\n\tTOMOYO_MAC_CATEGORY_NETWORK,\n\t[TOMOYO_MAC_NETWORK_UNIX_SEQPACKET_CONNECT] =\n\tTOMOYO_MAC_CATEGORY_NETWORK,\n\t/* CONFIG::misc group */\n\t[TOMOYO_MAC_ENVIRON]         = TOMOYO_MAC_CATEGORY_MISC,\n};"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"common.h\"\n#include <linux/rculist.h>\n#include <linux/slab.h>\n\nbool tomoyo_policy_loaded;\nconst u8 tomoyo_index2category[TOMOYO_MAX_MAC_INDEX] = {\n\t/* CONFIG::file group */\n\t[TOMOYO_MAC_FILE_EXECUTE]    = TOMOYO_MAC_CATEGORY_FILE,\n\t[TOMOYO_MAC_FILE_OPEN]       = TOMOYO_MAC_CATEGORY_FILE,\n\t[TOMOYO_MAC_FILE_CREATE]     = TOMOYO_MAC_CATEGORY_FILE,\n\t[TOMOYO_MAC_FILE_UNLINK]     = TOMOYO_MAC_CATEGORY_FILE,\n\t[TOMOYO_MAC_FILE_GETATTR]    = TOMOYO_MAC_CATEGORY_FILE,\n\t[TOMOYO_MAC_FILE_MKDIR]      = TOMOYO_MAC_CATEGORY_FILE,\n\t[TOMOYO_MAC_FILE_RMDIR]      = TOMOYO_MAC_CATEGORY_FILE,\n\t[TOMOYO_MAC_FILE_MKFIFO]     = TOMOYO_MAC_CATEGORY_FILE,\n\t[TOMOYO_MAC_FILE_MKSOCK]     = TOMOYO_MAC_CATEGORY_FILE,\n\t[TOMOYO_MAC_FILE_TRUNCATE]   = TOMOYO_MAC_CATEGORY_FILE,\n\t[TOMOYO_MAC_FILE_SYMLINK]    = TOMOYO_MAC_CATEGORY_FILE,\n\t[TOMOYO_MAC_FILE_MKBLOCK]    = TOMOYO_MAC_CATEGORY_FILE,\n\t[TOMOYO_MAC_FILE_MKCHAR]     = TOMOYO_MAC_CATEGORY_FILE,\n\t[TOMOYO_MAC_FILE_LINK]       = TOMOYO_MAC_CATEGORY_FILE,\n\t[TOMOYO_MAC_FILE_RENAME]     = TOMOYO_MAC_CATEGORY_FILE,\n\t[TOMOYO_MAC_FILE_CHMOD]      = TOMOYO_MAC_CATEGORY_FILE,\n\t[TOMOYO_MAC_FILE_CHOWN]      = TOMOYO_MAC_CATEGORY_FILE,\n\t[TOMOYO_MAC_FILE_CHGRP]      = TOMOYO_MAC_CATEGORY_FILE,\n\t[TOMOYO_MAC_FILE_IOCTL]      = TOMOYO_MAC_CATEGORY_FILE,\n\t[TOMOYO_MAC_FILE_CHROOT]     = TOMOYO_MAC_CATEGORY_FILE,\n\t[TOMOYO_MAC_FILE_MOUNT]      = TOMOYO_MAC_CATEGORY_FILE,\n\t[TOMOYO_MAC_FILE_UMOUNT]     = TOMOYO_MAC_CATEGORY_FILE,\n\t[TOMOYO_MAC_FILE_PIVOT_ROOT] = TOMOYO_MAC_CATEGORY_FILE,\n\t/* CONFIG::network group */\n\t[TOMOYO_MAC_NETWORK_INET_STREAM_BIND]       =\n\tTOMOYO_MAC_CATEGORY_NETWORK,\n\t[TOMOYO_MAC_NETWORK_INET_STREAM_LISTEN]     =\n\tTOMOYO_MAC_CATEGORY_NETWORK,\n\t[TOMOYO_MAC_NETWORK_INET_STREAM_CONNECT]    =\n\tTOMOYO_MAC_CATEGORY_NETWORK,\n\t[TOMOYO_MAC_NETWORK_INET_DGRAM_BIND]        =\n\tTOMOYO_MAC_CATEGORY_NETWORK,\n\t[TOMOYO_MAC_NETWORK_INET_DGRAM_SEND]        =\n\tTOMOYO_MAC_CATEGORY_NETWORK,\n\t[TOMOYO_MAC_NETWORK_INET_RAW_BIND]          =\n\tTOMOYO_MAC_CATEGORY_NETWORK,\n\t[TOMOYO_MAC_NETWORK_INET_RAW_SEND]          =\n\tTOMOYO_MAC_CATEGORY_NETWORK,\n\t[TOMOYO_MAC_NETWORK_UNIX_STREAM_BIND]       =\n\tTOMOYO_MAC_CATEGORY_NETWORK,\n\t[TOMOYO_MAC_NETWORK_UNIX_STREAM_LISTEN]     =\n\tTOMOYO_MAC_CATEGORY_NETWORK,\n\t[TOMOYO_MAC_NETWORK_UNIX_STREAM_CONNECT]    =\n\tTOMOYO_MAC_CATEGORY_NETWORK,\n\t[TOMOYO_MAC_NETWORK_UNIX_DGRAM_BIND]        =\n\tTOMOYO_MAC_CATEGORY_NETWORK,\n\t[TOMOYO_MAC_NETWORK_UNIX_DGRAM_SEND]        =\n\tTOMOYO_MAC_CATEGORY_NETWORK,\n\t[TOMOYO_MAC_NETWORK_UNIX_SEQPACKET_BIND]    =\n\tTOMOYO_MAC_CATEGORY_NETWORK,\n\t[TOMOYO_MAC_NETWORK_UNIX_SEQPACKET_LISTEN]  =\n\tTOMOYO_MAC_CATEGORY_NETWORK,\n\t[TOMOYO_MAC_NETWORK_UNIX_SEQPACKET_CONNECT] =\n\tTOMOYO_MAC_CATEGORY_NETWORK,\n\t/* CONFIG::misc group */\n\t[TOMOYO_MAC_ENVIRON]         = TOMOYO_MAC_CATEGORY_MISC,\n};\n\nint tomoyo_get_mode(const struct tomoyo_policy_namespace *ns, const u8 profile,\n\t\t    const u8 index)\n{\n\tu8 mode;\n\tstruct tomoyo_profile *p;\n\n\tif (!tomoyo_policy_loaded)\n\t\treturn TOMOYO_CONFIG_DISABLED;\n\tp = tomoyo_profile(ns, profile);\n\tmode = p->config[index];\n\tif (mode == TOMOYO_CONFIG_USE_DEFAULT)\n\t\tmode = p->config[tomoyo_index2category[index]\n\t\t\t\t + TOMOYO_MAX_MAC_INDEX];\n\tif (mode == TOMOYO_CONFIG_USE_DEFAULT)\n\t\tmode = p->default_config;\n\treturn mode & 3;\n}"
        }
      }
    ],
    "contextual_snippet": "#include <linux/slab.h>\n#include \"common.h\"\n\nstatic const u8 tomoyo_p2mac[TOMOYO_MAX_PATH_OPERATION] = {\n\t[TOMOYO_TYPE_EXECUTE]    = TOMOYO_MAC_FILE_EXECUTE,\n\t[TOMOYO_TYPE_READ]       = TOMOYO_MAC_FILE_OPEN,\n\t[TOMOYO_TYPE_WRITE]      = TOMOYO_MAC_FILE_OPEN,\n\t[TOMOYO_TYPE_APPEND]     = TOMOYO_MAC_FILE_OPEN,\n\t[TOMOYO_TYPE_UNLINK]     = TOMOYO_MAC_FILE_UNLINK,\n\t[TOMOYO_TYPE_GETATTR]    = TOMOYO_MAC_FILE_GETATTR,\n\t[TOMOYO_TYPE_RMDIR]      = TOMOYO_MAC_FILE_RMDIR,\n\t[TOMOYO_TYPE_TRUNCATE]   = TOMOYO_MAC_FILE_TRUNCATE,\n\t[TOMOYO_TYPE_SYMLINK]    = TOMOYO_MAC_FILE_SYMLINK,\n\t[TOMOYO_TYPE_CHROOT]     = TOMOYO_MAC_FILE_CHROOT,\n\t[TOMOYO_TYPE_UMOUNT]     = TOMOYO_MAC_FILE_UMOUNT,\n};\n\nstatic int tomoyo_path_permission(struct tomoyo_request_info *r, u8 operation,\n\t\t\t\t  const struct tomoyo_path_info *filename)\n{\n\tint error;\n\n\tr->type = tomoyo_p2mac[operation];\n\tr->mode = tomoyo_get_mode(r->domain->ns, r->profile, r->type);\n\tif (r->mode == TOMOYO_CONFIG_DISABLED)\n\t\treturn 0;\n\tr->param_type = TOMOYO_TYPE_PATH_ACL;\n\tr->param.path.filename = filename;\n\tr->param.path.operation = operation;\n\tdo {\n\t\ttomoyo_check_acl(r, tomoyo_check_path_acl);\n\t\terror = tomoyo_audit_path_log(r);\n\t} while (error == TOMOYO_RETRY_REQUEST);\n\treturn error;\n}"
  },
  {
    "function_name": "tomoyo_update_path2_acl",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/file.c",
    "lines": "528-546",
    "snippet": "static int tomoyo_update_path2_acl(const u8 perm,\n\t\t\t\t   struct tomoyo_acl_param *param)\n{\n\tstruct tomoyo_path2_acl e = {\n\t\t.head.type = TOMOYO_TYPE_PATH2_ACL,\n\t\t.perm = perm\n\t};\n\tint error;\n\tif (!tomoyo_parse_name_union(param, &e.name1) ||\n\t    !tomoyo_parse_name_union(param, &e.name2))\n\t\terror = -EINVAL;\n\telse\n\t\terror = tomoyo_update_domain(&e.head, sizeof(e), param,\n\t\t\t\t\t     tomoyo_same_path2_acl,\n\t\t\t\t\t     tomoyo_merge_path2_acl);\n\ttomoyo_put_name_union(&e.name1);\n\ttomoyo_put_name_union(&e.name2);\n\treturn error;\n}",
    "includes": [
      "#include <linux/slab.h>",
      "#include \"common.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "tomoyo_put_name_union",
          "args": [
            "&e.name2"
          ],
          "line": 544
        },
        "resolved": true,
        "details": {
          "function_name": "tomoyo_put_name_union",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/file.c",
          "lines": "67-71",
          "snippet": "void tomoyo_put_name_union(struct tomoyo_name_union *ptr)\n{\n\ttomoyo_put_group(ptr->group);\n\ttomoyo_put_name(ptr->filename);\n}",
          "includes": [
            "#include <linux/slab.h>",
            "#include \"common.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/slab.h>\n#include \"common.h\"\n\nvoid tomoyo_put_name_union(struct tomoyo_name_union *ptr)\n{\n\ttomoyo_put_group(ptr->group);\n\ttomoyo_put_name(ptr->filename);\n}"
        }
      },
      {
        "call_info": {
          "callee": "tomoyo_update_domain",
          "args": [
            "&e.head",
            "sizeof(e)",
            "param",
            "tomoyo_same_path2_acl",
            "tomoyo_merge_path2_acl"
          ],
          "line": 540
        },
        "resolved": true,
        "details": {
          "function_name": "tomoyo_update_domain",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/domain.c",
          "lines": "91-147",
          "snippet": "int tomoyo_update_domain(struct tomoyo_acl_info *new_entry, const int size,\n\t\t\t struct tomoyo_acl_param *param,\n\t\t\t bool (*check_duplicate) (const struct tomoyo_acl_info\n\t\t\t\t\t\t  *,\n\t\t\t\t\t\t  const struct tomoyo_acl_info\n\t\t\t\t\t\t  *),\n\t\t\t bool (*merge_duplicate) (struct tomoyo_acl_info *,\n\t\t\t\t\t\t  struct tomoyo_acl_info *,\n\t\t\t\t\t\t  const bool))\n{\n\tconst bool is_delete = param->is_delete;\n\tint error = is_delete ? -ENOENT : -ENOMEM;\n\tstruct tomoyo_acl_info *entry;\n\tstruct list_head * const list = param->list;\n\n\tif (param->data[0]) {\n\t\tnew_entry->cond = tomoyo_get_condition(param);\n\t\tif (!new_entry->cond)\n\t\t\treturn -EINVAL;\n\t\t/*\n\t\t * Domain transition preference is allowed for only\n\t\t * \"file execute\" entries.\n\t\t */\n\t\tif (new_entry->cond->transit &&\n\t\t    !(new_entry->type == TOMOYO_TYPE_PATH_ACL &&\n\t\t      container_of(new_entry, struct tomoyo_path_acl, head)\n\t\t      ->perm == 1 << TOMOYO_TYPE_EXECUTE))\n\t\t\tgoto out;\n\t}\n\tif (mutex_lock_interruptible(&tomoyo_policy_lock))\n\t\tgoto out;\n\tlist_for_each_entry_rcu(entry, list, list) {\n\t\tif (entry->is_deleted == TOMOYO_GC_IN_PROGRESS)\n\t\t\tcontinue;\n\t\tif (!tomoyo_same_acl_head(entry, new_entry) ||\n\t\t    !check_duplicate(entry, new_entry))\n\t\t\tcontinue;\n\t\tif (merge_duplicate)\n\t\t\tentry->is_deleted = merge_duplicate(entry, new_entry,\n\t\t\t\t\t\t\t    is_delete);\n\t\telse\n\t\t\tentry->is_deleted = is_delete;\n\t\terror = 0;\n\t\tbreak;\n\t}\n\tif (error && !is_delete) {\n\t\tentry = tomoyo_commit_ok(new_entry, size);\n\t\tif (entry) {\n\t\t\tlist_add_tail_rcu(&entry->list, list);\n\t\t\terror = 0;\n\t\t}\n\t}\n\tmutex_unlock(&tomoyo_policy_lock);\nout:\n\ttomoyo_put_condition(new_entry->cond);\n\treturn error;\n}",
          "includes": [
            "#include <linux/rculist.h>",
            "#include <linux/slab.h>",
            "#include <linux/binfmts.h>",
            "#include \"common.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/rculist.h>\n#include <linux/slab.h>\n#include <linux/binfmts.h>\n#include \"common.h\"\n\nint tomoyo_update_domain(struct tomoyo_acl_info *new_entry, const int size,\n\t\t\t struct tomoyo_acl_param *param,\n\t\t\t bool (*check_duplicate) (const struct tomoyo_acl_info\n\t\t\t\t\t\t  *,\n\t\t\t\t\t\t  const struct tomoyo_acl_info\n\t\t\t\t\t\t  *),\n\t\t\t bool (*merge_duplicate) (struct tomoyo_acl_info *,\n\t\t\t\t\t\t  struct tomoyo_acl_info *,\n\t\t\t\t\t\t  const bool))\n{\n\tconst bool is_delete = param->is_delete;\n\tint error = is_delete ? -ENOENT : -ENOMEM;\n\tstruct tomoyo_acl_info *entry;\n\tstruct list_head * const list = param->list;\n\n\tif (param->data[0]) {\n\t\tnew_entry->cond = tomoyo_get_condition(param);\n\t\tif (!new_entry->cond)\n\t\t\treturn -EINVAL;\n\t\t/*\n\t\t * Domain transition preference is allowed for only\n\t\t * \"file execute\" entries.\n\t\t */\n\t\tif (new_entry->cond->transit &&\n\t\t    !(new_entry->type == TOMOYO_TYPE_PATH_ACL &&\n\t\t      container_of(new_entry, struct tomoyo_path_acl, head)\n\t\t      ->perm == 1 << TOMOYO_TYPE_EXECUTE))\n\t\t\tgoto out;\n\t}\n\tif (mutex_lock_interruptible(&tomoyo_policy_lock))\n\t\tgoto out;\n\tlist_for_each_entry_rcu(entry, list, list) {\n\t\tif (entry->is_deleted == TOMOYO_GC_IN_PROGRESS)\n\t\t\tcontinue;\n\t\tif (!tomoyo_same_acl_head(entry, new_entry) ||\n\t\t    !check_duplicate(entry, new_entry))\n\t\t\tcontinue;\n\t\tif (merge_duplicate)\n\t\t\tentry->is_deleted = merge_duplicate(entry, new_entry,\n\t\t\t\t\t\t\t    is_delete);\n\t\telse\n\t\t\tentry->is_deleted = is_delete;\n\t\terror = 0;\n\t\tbreak;\n\t}\n\tif (error && !is_delete) {\n\t\tentry = tomoyo_commit_ok(new_entry, size);\n\t\tif (entry) {\n\t\t\tlist_add_tail_rcu(&entry->list, list);\n\t\t\terror = 0;\n\t\t}\n\t}\n\tmutex_unlock(&tomoyo_policy_lock);\nout:\n\ttomoyo_put_condition(new_entry->cond);\n\treturn error;\n}"
        }
      },
      {
        "call_info": {
          "callee": "tomoyo_parse_name_union",
          "args": [
            "param",
            "&e.name2"
          ],
          "line": 537
        },
        "resolved": true,
        "details": {
          "function_name": "tomoyo_parse_name_union_quoted",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/condition.c",
          "lines": "269-277",
          "snippet": "static bool tomoyo_parse_name_union_quoted(struct tomoyo_acl_param *param,\n\t\t\t\t\t   struct tomoyo_name_union *ptr)\n{\n\tchar *filename = param->data;\n\tif (*filename == '@')\n\t\treturn tomoyo_parse_name_union(param, ptr);\n\tptr->filename = tomoyo_get_dqword(filename);\n\treturn ptr->filename != NULL;\n}",
          "includes": [
            "#include <linux/slab.h>",
            "#include \"common.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/slab.h>\n#include \"common.h\"\n\nstatic bool tomoyo_parse_name_union_quoted(struct tomoyo_acl_param *param,\n\t\t\t\t\t   struct tomoyo_name_union *ptr)\n{\n\tchar *filename = param->data;\n\tif (*filename == '@')\n\t\treturn tomoyo_parse_name_union(param, ptr);\n\tptr->filename = tomoyo_get_dqword(filename);\n\treturn ptr->filename != NULL;\n}"
        }
      }
    ],
    "contextual_snippet": "#include <linux/slab.h>\n#include \"common.h\"\n\nstatic int tomoyo_update_path2_acl(const u8 perm,\n\t\t\t\t   struct tomoyo_acl_param *param)\n{\n\tstruct tomoyo_path2_acl e = {\n\t\t.head.type = TOMOYO_TYPE_PATH2_ACL,\n\t\t.perm = perm\n\t};\n\tint error;\n\tif (!tomoyo_parse_name_union(param, &e.name1) ||\n\t    !tomoyo_parse_name_union(param, &e.name2))\n\t\terror = -EINVAL;\n\telse\n\t\terror = tomoyo_update_domain(&e.head, sizeof(e), param,\n\t\t\t\t\t     tomoyo_same_path2_acl,\n\t\t\t\t\t     tomoyo_merge_path2_acl);\n\ttomoyo_put_name_union(&e.name1);\n\ttomoyo_put_name_union(&e.name2);\n\treturn error;\n}"
  },
  {
    "function_name": "tomoyo_merge_path2_acl",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/file.c",
    "lines": "502-516",
    "snippet": "static bool tomoyo_merge_path2_acl(struct tomoyo_acl_info *a,\n\t\t\t\t   struct tomoyo_acl_info *b,\n\t\t\t\t   const bool is_delete)\n{\n\tu8 * const a_perm = &container_of(a, struct tomoyo_path2_acl, head)\n\t\t->perm;\n\tu8 perm = *a_perm;\n\tconst u8 b_perm = container_of(b, struct tomoyo_path2_acl, head)->perm;\n\tif (is_delete)\n\t\tperm &= ~b_perm;\n\telse\n\t\tperm |= b_perm;\n\t*a_perm = perm;\n\treturn !perm;\n}",
    "includes": [
      "#include <linux/slab.h>",
      "#include \"common.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "container_of",
          "args": [
            "b",
            "structtomoyo_path2_acl",
            "head"
          ],
          "line": 509
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "container_of",
          "args": [
            "a",
            "structtomoyo_path2_acl",
            "head"
          ],
          "line": 506
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <linux/slab.h>\n#include \"common.h\"\n\nstatic bool tomoyo_merge_path2_acl(struct tomoyo_acl_info *a,\n\t\t\t\t   struct tomoyo_acl_info *b,\n\t\t\t\t   const bool is_delete)\n{\n\tu8 * const a_perm = &container_of(a, struct tomoyo_path2_acl, head)\n\t\t->perm;\n\tu8 perm = *a_perm;\n\tconst u8 b_perm = container_of(b, struct tomoyo_path2_acl, head)->perm;\n\tif (is_delete)\n\t\tperm &= ~b_perm;\n\telse\n\t\tperm |= b_perm;\n\t*a_perm = perm;\n\treturn !perm;\n}"
  },
  {
    "function_name": "tomoyo_same_path2_acl",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/file.c",
    "lines": "484-491",
    "snippet": "static bool tomoyo_same_path2_acl(const struct tomoyo_acl_info *a,\n\t\t\t\t  const struct tomoyo_acl_info *b)\n{\n\tconst struct tomoyo_path2_acl *p1 = container_of(a, typeof(*p1), head);\n\tconst struct tomoyo_path2_acl *p2 = container_of(b, typeof(*p2), head);\n\treturn tomoyo_same_name_union(&p1->name1, &p2->name1) &&\n\t\ttomoyo_same_name_union(&p1->name2, &p2->name2);\n}",
    "includes": [
      "#include <linux/slab.h>",
      "#include \"common.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "tomoyo_same_name_union",
          "args": [
            "&p1->name2",
            "&p2->name2"
          ],
          "line": 490
        },
        "resolved": true,
        "details": {
          "function_name": "tomoyo_same_name_union",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/common.h",
          "lines": "1230-1234",
          "snippet": "static inline bool tomoyo_same_name_union\n(const struct tomoyo_name_union *a, const struct tomoyo_name_union *b)\n{\n\treturn a->filename == b->filename && a->group == b->group;\n}",
          "includes": [
            "#include <net/udp.h>",
            "#include <net/ipv6.h>",
            "#include <net/ip.h>",
            "#include <net/af_unix.h>",
            "#include <net/sock.h>",
            "#include <linux/un.h>",
            "#include <linux/in6.h>",
            "#include <linux/in.h>",
            "#include <linux/inet.h>",
            "#include <linux/net.h>",
            "#include <linux/highmem.h>",
            "#include <linux/binfmts.h>",
            "#include <linux/poll.h>",
            "#include <linux/cred.h>",
            "#include <linux/list.h>",
            "#include <linux/mount.h>",
            "#include <linux/namei.h>",
            "#include <linux/sched.h>",
            "#include <linux/fs.h>",
            "#include <linux/kmod.h>",
            "#include <linux/file.h>",
            "#include <linux/mm.h>",
            "#include <linux/string.h>",
            "#include <linux/ctype.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <net/udp.h>\n#include <net/ipv6.h>\n#include <net/ip.h>\n#include <net/af_unix.h>\n#include <net/sock.h>\n#include <linux/un.h>\n#include <linux/in6.h>\n#include <linux/in.h>\n#include <linux/inet.h>\n#include <linux/net.h>\n#include <linux/highmem.h>\n#include <linux/binfmts.h>\n#include <linux/poll.h>\n#include <linux/cred.h>\n#include <linux/list.h>\n#include <linux/mount.h>\n#include <linux/namei.h>\n#include <linux/sched.h>\n#include <linux/fs.h>\n#include <linux/kmod.h>\n#include <linux/file.h>\n#include <linux/mm.h>\n#include <linux/string.h>\n#include <linux/ctype.h>\n\nstatic inline bool tomoyo_same_name_union\n(const struct tomoyo_name_union *a, const struct tomoyo_name_union *b)\n{\n\treturn a->filename == b->filename && a->group == b->group;\n}"
        }
      },
      {
        "call_info": {
          "callee": "container_of",
          "args": [
            "b",
            "typeof(*p2)",
            "head"
          ],
          "line": 488
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "typeof",
          "args": [
            "*p2"
          ],
          "line": 488
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "container_of",
          "args": [
            "a",
            "typeof(*p1)",
            "head"
          ],
          "line": 487
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "typeof",
          "args": [
            "*p1"
          ],
          "line": 487
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <linux/slab.h>\n#include \"common.h\"\n\nstatic bool tomoyo_same_path2_acl(const struct tomoyo_acl_info *a,\n\t\t\t\t  const struct tomoyo_acl_info *b)\n{\n\tconst struct tomoyo_path2_acl *p1 = container_of(a, typeof(*p1), head);\n\tconst struct tomoyo_path2_acl *p2 = container_of(b, typeof(*p2), head);\n\treturn tomoyo_same_name_union(&p1->name1, &p2->name1) &&\n\t\ttomoyo_same_name_union(&p1->name2, &p2->name2);\n}"
  },
  {
    "function_name": "tomoyo_update_mkdev_acl",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/file.c",
    "lines": "452-474",
    "snippet": "static int tomoyo_update_mkdev_acl(const u8 perm,\n\t\t\t\t   struct tomoyo_acl_param *param)\n{\n\tstruct tomoyo_mkdev_acl e = {\n\t\t.head.type = TOMOYO_TYPE_MKDEV_ACL,\n\t\t.perm = perm\n\t};\n\tint error;\n\tif (!tomoyo_parse_name_union(param, &e.name) ||\n\t    !tomoyo_parse_number_union(param, &e.mode) ||\n\t    !tomoyo_parse_number_union(param, &e.major) ||\n\t    !tomoyo_parse_number_union(param, &e.minor))\n\t\terror = -EINVAL;\n\telse\n\t\terror = tomoyo_update_domain(&e.head, sizeof(e), param,\n\t\t\t\t\t     tomoyo_same_mkdev_acl,\n\t\t\t\t\t     tomoyo_merge_mkdev_acl);\n\ttomoyo_put_name_union(&e.name);\n\ttomoyo_put_number_union(&e.mode);\n\ttomoyo_put_number_union(&e.major);\n\ttomoyo_put_number_union(&e.minor);\n\treturn error;\n}",
    "includes": [
      "#include <linux/slab.h>",
      "#include \"common.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "tomoyo_put_number_union",
          "args": [
            "&e.minor"
          ],
          "line": 472
        },
        "resolved": true,
        "details": {
          "function_name": "tomoyo_put_number_union",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/file.c",
          "lines": "99-102",
          "snippet": "void tomoyo_put_number_union(struct tomoyo_number_union *ptr)\n{\n\ttomoyo_put_group(ptr->group);\n}",
          "includes": [
            "#include <linux/slab.h>",
            "#include \"common.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/slab.h>\n#include \"common.h\"\n\nvoid tomoyo_put_number_union(struct tomoyo_number_union *ptr)\n{\n\ttomoyo_put_group(ptr->group);\n}"
        }
      },
      {
        "call_info": {
          "callee": "tomoyo_put_name_union",
          "args": [
            "&e.name"
          ],
          "line": 469
        },
        "resolved": true,
        "details": {
          "function_name": "tomoyo_put_name_union",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/file.c",
          "lines": "67-71",
          "snippet": "void tomoyo_put_name_union(struct tomoyo_name_union *ptr)\n{\n\ttomoyo_put_group(ptr->group);\n\ttomoyo_put_name(ptr->filename);\n}",
          "includes": [
            "#include <linux/slab.h>",
            "#include \"common.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/slab.h>\n#include \"common.h\"\n\nvoid tomoyo_put_name_union(struct tomoyo_name_union *ptr)\n{\n\ttomoyo_put_group(ptr->group);\n\ttomoyo_put_name(ptr->filename);\n}"
        }
      },
      {
        "call_info": {
          "callee": "tomoyo_update_domain",
          "args": [
            "&e.head",
            "sizeof(e)",
            "param",
            "tomoyo_same_mkdev_acl",
            "tomoyo_merge_mkdev_acl"
          ],
          "line": 466
        },
        "resolved": true,
        "details": {
          "function_name": "tomoyo_update_domain",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/domain.c",
          "lines": "91-147",
          "snippet": "int tomoyo_update_domain(struct tomoyo_acl_info *new_entry, const int size,\n\t\t\t struct tomoyo_acl_param *param,\n\t\t\t bool (*check_duplicate) (const struct tomoyo_acl_info\n\t\t\t\t\t\t  *,\n\t\t\t\t\t\t  const struct tomoyo_acl_info\n\t\t\t\t\t\t  *),\n\t\t\t bool (*merge_duplicate) (struct tomoyo_acl_info *,\n\t\t\t\t\t\t  struct tomoyo_acl_info *,\n\t\t\t\t\t\t  const bool))\n{\n\tconst bool is_delete = param->is_delete;\n\tint error = is_delete ? -ENOENT : -ENOMEM;\n\tstruct tomoyo_acl_info *entry;\n\tstruct list_head * const list = param->list;\n\n\tif (param->data[0]) {\n\t\tnew_entry->cond = tomoyo_get_condition(param);\n\t\tif (!new_entry->cond)\n\t\t\treturn -EINVAL;\n\t\t/*\n\t\t * Domain transition preference is allowed for only\n\t\t * \"file execute\" entries.\n\t\t */\n\t\tif (new_entry->cond->transit &&\n\t\t    !(new_entry->type == TOMOYO_TYPE_PATH_ACL &&\n\t\t      container_of(new_entry, struct tomoyo_path_acl, head)\n\t\t      ->perm == 1 << TOMOYO_TYPE_EXECUTE))\n\t\t\tgoto out;\n\t}\n\tif (mutex_lock_interruptible(&tomoyo_policy_lock))\n\t\tgoto out;\n\tlist_for_each_entry_rcu(entry, list, list) {\n\t\tif (entry->is_deleted == TOMOYO_GC_IN_PROGRESS)\n\t\t\tcontinue;\n\t\tif (!tomoyo_same_acl_head(entry, new_entry) ||\n\t\t    !check_duplicate(entry, new_entry))\n\t\t\tcontinue;\n\t\tif (merge_duplicate)\n\t\t\tentry->is_deleted = merge_duplicate(entry, new_entry,\n\t\t\t\t\t\t\t    is_delete);\n\t\telse\n\t\t\tentry->is_deleted = is_delete;\n\t\terror = 0;\n\t\tbreak;\n\t}\n\tif (error && !is_delete) {\n\t\tentry = tomoyo_commit_ok(new_entry, size);\n\t\tif (entry) {\n\t\t\tlist_add_tail_rcu(&entry->list, list);\n\t\t\terror = 0;\n\t\t}\n\t}\n\tmutex_unlock(&tomoyo_policy_lock);\nout:\n\ttomoyo_put_condition(new_entry->cond);\n\treturn error;\n}",
          "includes": [
            "#include <linux/rculist.h>",
            "#include <linux/slab.h>",
            "#include <linux/binfmts.h>",
            "#include \"common.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/rculist.h>\n#include <linux/slab.h>\n#include <linux/binfmts.h>\n#include \"common.h\"\n\nint tomoyo_update_domain(struct tomoyo_acl_info *new_entry, const int size,\n\t\t\t struct tomoyo_acl_param *param,\n\t\t\t bool (*check_duplicate) (const struct tomoyo_acl_info\n\t\t\t\t\t\t  *,\n\t\t\t\t\t\t  const struct tomoyo_acl_info\n\t\t\t\t\t\t  *),\n\t\t\t bool (*merge_duplicate) (struct tomoyo_acl_info *,\n\t\t\t\t\t\t  struct tomoyo_acl_info *,\n\t\t\t\t\t\t  const bool))\n{\n\tconst bool is_delete = param->is_delete;\n\tint error = is_delete ? -ENOENT : -ENOMEM;\n\tstruct tomoyo_acl_info *entry;\n\tstruct list_head * const list = param->list;\n\n\tif (param->data[0]) {\n\t\tnew_entry->cond = tomoyo_get_condition(param);\n\t\tif (!new_entry->cond)\n\t\t\treturn -EINVAL;\n\t\t/*\n\t\t * Domain transition preference is allowed for only\n\t\t * \"file execute\" entries.\n\t\t */\n\t\tif (new_entry->cond->transit &&\n\t\t    !(new_entry->type == TOMOYO_TYPE_PATH_ACL &&\n\t\t      container_of(new_entry, struct tomoyo_path_acl, head)\n\t\t      ->perm == 1 << TOMOYO_TYPE_EXECUTE))\n\t\t\tgoto out;\n\t}\n\tif (mutex_lock_interruptible(&tomoyo_policy_lock))\n\t\tgoto out;\n\tlist_for_each_entry_rcu(entry, list, list) {\n\t\tif (entry->is_deleted == TOMOYO_GC_IN_PROGRESS)\n\t\t\tcontinue;\n\t\tif (!tomoyo_same_acl_head(entry, new_entry) ||\n\t\t    !check_duplicate(entry, new_entry))\n\t\t\tcontinue;\n\t\tif (merge_duplicate)\n\t\t\tentry->is_deleted = merge_duplicate(entry, new_entry,\n\t\t\t\t\t\t\t    is_delete);\n\t\telse\n\t\t\tentry->is_deleted = is_delete;\n\t\terror = 0;\n\t\tbreak;\n\t}\n\tif (error && !is_delete) {\n\t\tentry = tomoyo_commit_ok(new_entry, size);\n\t\tif (entry) {\n\t\t\tlist_add_tail_rcu(&entry->list, list);\n\t\t\terror = 0;\n\t\t}\n\t}\n\tmutex_unlock(&tomoyo_policy_lock);\nout:\n\ttomoyo_put_condition(new_entry->cond);\n\treturn error;\n}"
        }
      },
      {
        "call_info": {
          "callee": "tomoyo_parse_number_union",
          "args": [
            "param",
            "&e.minor"
          ],
          "line": 463
        },
        "resolved": true,
        "details": {
          "function_name": "tomoyo_parse_number_union",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/util.c",
          "lines": "263-294",
          "snippet": "bool tomoyo_parse_number_union(struct tomoyo_acl_param *param,\n\t\t\t       struct tomoyo_number_union *ptr)\n{\n\tchar *data;\n\tu8 type;\n\tunsigned long v;\n\tmemset(ptr, 0, sizeof(*ptr));\n\tif (param->data[0] == '@') {\n\t\tparam->data++;\n\t\tptr->group = tomoyo_get_group(param, TOMOYO_NUMBER_GROUP);\n\t\treturn ptr->group != NULL;\n\t}\n\tdata = tomoyo_read_token(param);\n\ttype = tomoyo_parse_ulong(&v, &data);\n\tif (type == TOMOYO_VALUE_TYPE_INVALID)\n\t\treturn false;\n\tptr->values[0] = v;\n\tptr->value_type[0] = type;\n\tif (!*data) {\n\t\tptr->values[1] = v;\n\t\tptr->value_type[1] = type;\n\t\treturn true;\n\t}\n\tif (*data++ != '-')\n\t\treturn false;\n\ttype = tomoyo_parse_ulong(&v, &data);\n\tif (type == TOMOYO_VALUE_TYPE_INVALID || *data || ptr->values[0] > v)\n\t\treturn false;\n\tptr->values[1] = v;\n\tptr->value_type[1] = type;\n\treturn true;\n}",
          "includes": [
            "#include \"common.h\"",
            "#include <linux/rculist.h>",
            "#include <linux/slab.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common.h\"\n#include <linux/rculist.h>\n#include <linux/slab.h>\n\nbool tomoyo_parse_number_union(struct tomoyo_acl_param *param,\n\t\t\t       struct tomoyo_number_union *ptr)\n{\n\tchar *data;\n\tu8 type;\n\tunsigned long v;\n\tmemset(ptr, 0, sizeof(*ptr));\n\tif (param->data[0] == '@') {\n\t\tparam->data++;\n\t\tptr->group = tomoyo_get_group(param, TOMOYO_NUMBER_GROUP);\n\t\treturn ptr->group != NULL;\n\t}\n\tdata = tomoyo_read_token(param);\n\ttype = tomoyo_parse_ulong(&v, &data);\n\tif (type == TOMOYO_VALUE_TYPE_INVALID)\n\t\treturn false;\n\tptr->values[0] = v;\n\tptr->value_type[0] = type;\n\tif (!*data) {\n\t\tptr->values[1] = v;\n\t\tptr->value_type[1] = type;\n\t\treturn true;\n\t}\n\tif (*data++ != '-')\n\t\treturn false;\n\ttype = tomoyo_parse_ulong(&v, &data);\n\tif (type == TOMOYO_VALUE_TYPE_INVALID || *data || ptr->values[0] > v)\n\t\treturn false;\n\tptr->values[1] = v;\n\tptr->value_type[1] = type;\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "tomoyo_parse_name_union",
          "args": [
            "param",
            "&e.name"
          ],
          "line": 460
        },
        "resolved": true,
        "details": {
          "function_name": "tomoyo_parse_name_union_quoted",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/condition.c",
          "lines": "269-277",
          "snippet": "static bool tomoyo_parse_name_union_quoted(struct tomoyo_acl_param *param,\n\t\t\t\t\t   struct tomoyo_name_union *ptr)\n{\n\tchar *filename = param->data;\n\tif (*filename == '@')\n\t\treturn tomoyo_parse_name_union(param, ptr);\n\tptr->filename = tomoyo_get_dqword(filename);\n\treturn ptr->filename != NULL;\n}",
          "includes": [
            "#include <linux/slab.h>",
            "#include \"common.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/slab.h>\n#include \"common.h\"\n\nstatic bool tomoyo_parse_name_union_quoted(struct tomoyo_acl_param *param,\n\t\t\t\t\t   struct tomoyo_name_union *ptr)\n{\n\tchar *filename = param->data;\n\tif (*filename == '@')\n\t\treturn tomoyo_parse_name_union(param, ptr);\n\tptr->filename = tomoyo_get_dqword(filename);\n\treturn ptr->filename != NULL;\n}"
        }
      }
    ],
    "contextual_snippet": "#include <linux/slab.h>\n#include \"common.h\"\n\nstatic int tomoyo_update_mkdev_acl(const u8 perm,\n\t\t\t\t   struct tomoyo_acl_param *param)\n{\n\tstruct tomoyo_mkdev_acl e = {\n\t\t.head.type = TOMOYO_TYPE_MKDEV_ACL,\n\t\t.perm = perm\n\t};\n\tint error;\n\tif (!tomoyo_parse_name_union(param, &e.name) ||\n\t    !tomoyo_parse_number_union(param, &e.mode) ||\n\t    !tomoyo_parse_number_union(param, &e.major) ||\n\t    !tomoyo_parse_number_union(param, &e.minor))\n\t\terror = -EINVAL;\n\telse\n\t\terror = tomoyo_update_domain(&e.head, sizeof(e), param,\n\t\t\t\t\t     tomoyo_same_mkdev_acl,\n\t\t\t\t\t     tomoyo_merge_mkdev_acl);\n\ttomoyo_put_name_union(&e.name);\n\ttomoyo_put_number_union(&e.mode);\n\ttomoyo_put_number_union(&e.major);\n\ttomoyo_put_number_union(&e.minor);\n\treturn error;\n}"
  },
  {
    "function_name": "tomoyo_merge_mkdev_acl",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/file.c",
    "lines": "425-440",
    "snippet": "static bool tomoyo_merge_mkdev_acl(struct tomoyo_acl_info *a,\n\t\t\t\t   struct tomoyo_acl_info *b,\n\t\t\t\t   const bool is_delete)\n{\n\tu8 *const a_perm = &container_of(a, struct tomoyo_mkdev_acl,\n\t\t\t\t\t head)->perm;\n\tu8 perm = *a_perm;\n\tconst u8 b_perm = container_of(b, struct tomoyo_mkdev_acl, head)\n\t\t->perm;\n\tif (is_delete)\n\t\tperm &= ~b_perm;\n\telse\n\t\tperm |= b_perm;\n\t*a_perm = perm;\n\treturn !perm;\n}",
    "includes": [
      "#include <linux/slab.h>",
      "#include \"common.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "container_of",
          "args": [
            "b",
            "structtomoyo_mkdev_acl",
            "head"
          ],
          "line": 432
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "container_of",
          "args": [
            "a",
            "structtomoyo_mkdev_acl",
            "head"
          ],
          "line": 429
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <linux/slab.h>\n#include \"common.h\"\n\nstatic bool tomoyo_merge_mkdev_acl(struct tomoyo_acl_info *a,\n\t\t\t\t   struct tomoyo_acl_info *b,\n\t\t\t\t   const bool is_delete)\n{\n\tu8 *const a_perm = &container_of(a, struct tomoyo_mkdev_acl,\n\t\t\t\t\t head)->perm;\n\tu8 perm = *a_perm;\n\tconst u8 b_perm = container_of(b, struct tomoyo_mkdev_acl, head)\n\t\t->perm;\n\tif (is_delete)\n\t\tperm &= ~b_perm;\n\telse\n\t\tperm |= b_perm;\n\t*a_perm = perm;\n\treturn !perm;\n}"
  },
  {
    "function_name": "tomoyo_same_mkdev_acl",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/file.c",
    "lines": "405-414",
    "snippet": "static bool tomoyo_same_mkdev_acl(const struct tomoyo_acl_info *a,\n\t\t\t\t\t const struct tomoyo_acl_info *b)\n{\n\tconst struct tomoyo_mkdev_acl *p1 = container_of(a, typeof(*p1), head);\n\tconst struct tomoyo_mkdev_acl *p2 = container_of(b, typeof(*p2), head);\n\treturn tomoyo_same_name_union(&p1->name, &p2->name) &&\n\t\ttomoyo_same_number_union(&p1->mode, &p2->mode) &&\n\t\ttomoyo_same_number_union(&p1->major, &p2->major) &&\n\t\ttomoyo_same_number_union(&p1->minor, &p2->minor);\n}",
    "includes": [
      "#include <linux/slab.h>",
      "#include \"common.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "tomoyo_same_number_union",
          "args": [
            "&p1->minor",
            "&p2->minor"
          ],
          "line": 413
        },
        "resolved": true,
        "details": {
          "function_name": "tomoyo_same_number_union",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/common.h",
          "lines": "1244-1250",
          "snippet": "static inline bool tomoyo_same_number_union\n(const struct tomoyo_number_union *a, const struct tomoyo_number_union *b)\n{\n\treturn a->values[0] == b->values[0] && a->values[1] == b->values[1] &&\n\t\ta->group == b->group && a->value_type[0] == b->value_type[0] &&\n\t\ta->value_type[1] == b->value_type[1];\n}",
          "includes": [
            "#include <net/udp.h>",
            "#include <net/ipv6.h>",
            "#include <net/ip.h>",
            "#include <net/af_unix.h>",
            "#include <net/sock.h>",
            "#include <linux/un.h>",
            "#include <linux/in6.h>",
            "#include <linux/in.h>",
            "#include <linux/inet.h>",
            "#include <linux/net.h>",
            "#include <linux/highmem.h>",
            "#include <linux/binfmts.h>",
            "#include <linux/poll.h>",
            "#include <linux/cred.h>",
            "#include <linux/list.h>",
            "#include <linux/mount.h>",
            "#include <linux/namei.h>",
            "#include <linux/sched.h>",
            "#include <linux/fs.h>",
            "#include <linux/kmod.h>",
            "#include <linux/file.h>",
            "#include <linux/mm.h>",
            "#include <linux/string.h>",
            "#include <linux/ctype.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <net/udp.h>\n#include <net/ipv6.h>\n#include <net/ip.h>\n#include <net/af_unix.h>\n#include <net/sock.h>\n#include <linux/un.h>\n#include <linux/in6.h>\n#include <linux/in.h>\n#include <linux/inet.h>\n#include <linux/net.h>\n#include <linux/highmem.h>\n#include <linux/binfmts.h>\n#include <linux/poll.h>\n#include <linux/cred.h>\n#include <linux/list.h>\n#include <linux/mount.h>\n#include <linux/namei.h>\n#include <linux/sched.h>\n#include <linux/fs.h>\n#include <linux/kmod.h>\n#include <linux/file.h>\n#include <linux/mm.h>\n#include <linux/string.h>\n#include <linux/ctype.h>\n\nstatic inline bool tomoyo_same_number_union\n(const struct tomoyo_number_union *a, const struct tomoyo_number_union *b)\n{\n\treturn a->values[0] == b->values[0] && a->values[1] == b->values[1] &&\n\t\ta->group == b->group && a->value_type[0] == b->value_type[0] &&\n\t\ta->value_type[1] == b->value_type[1];\n}"
        }
      },
      {
        "call_info": {
          "callee": "tomoyo_same_name_union",
          "args": [
            "&p1->name",
            "&p2->name"
          ],
          "line": 410
        },
        "resolved": true,
        "details": {
          "function_name": "tomoyo_same_name_union",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/common.h",
          "lines": "1230-1234",
          "snippet": "static inline bool tomoyo_same_name_union\n(const struct tomoyo_name_union *a, const struct tomoyo_name_union *b)\n{\n\treturn a->filename == b->filename && a->group == b->group;\n}",
          "includes": [
            "#include <net/udp.h>",
            "#include <net/ipv6.h>",
            "#include <net/ip.h>",
            "#include <net/af_unix.h>",
            "#include <net/sock.h>",
            "#include <linux/un.h>",
            "#include <linux/in6.h>",
            "#include <linux/in.h>",
            "#include <linux/inet.h>",
            "#include <linux/net.h>",
            "#include <linux/highmem.h>",
            "#include <linux/binfmts.h>",
            "#include <linux/poll.h>",
            "#include <linux/cred.h>",
            "#include <linux/list.h>",
            "#include <linux/mount.h>",
            "#include <linux/namei.h>",
            "#include <linux/sched.h>",
            "#include <linux/fs.h>",
            "#include <linux/kmod.h>",
            "#include <linux/file.h>",
            "#include <linux/mm.h>",
            "#include <linux/string.h>",
            "#include <linux/ctype.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <net/udp.h>\n#include <net/ipv6.h>\n#include <net/ip.h>\n#include <net/af_unix.h>\n#include <net/sock.h>\n#include <linux/un.h>\n#include <linux/in6.h>\n#include <linux/in.h>\n#include <linux/inet.h>\n#include <linux/net.h>\n#include <linux/highmem.h>\n#include <linux/binfmts.h>\n#include <linux/poll.h>\n#include <linux/cred.h>\n#include <linux/list.h>\n#include <linux/mount.h>\n#include <linux/namei.h>\n#include <linux/sched.h>\n#include <linux/fs.h>\n#include <linux/kmod.h>\n#include <linux/file.h>\n#include <linux/mm.h>\n#include <linux/string.h>\n#include <linux/ctype.h>\n\nstatic inline bool tomoyo_same_name_union\n(const struct tomoyo_name_union *a, const struct tomoyo_name_union *b)\n{\n\treturn a->filename == b->filename && a->group == b->group;\n}"
        }
      },
      {
        "call_info": {
          "callee": "container_of",
          "args": [
            "b",
            "typeof(*p2)",
            "head"
          ],
          "line": 409
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "typeof",
          "args": [
            "*p2"
          ],
          "line": 409
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "container_of",
          "args": [
            "a",
            "typeof(*p1)",
            "head"
          ],
          "line": 408
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "typeof",
          "args": [
            "*p1"
          ],
          "line": 408
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <linux/slab.h>\n#include \"common.h\"\n\nstatic bool tomoyo_same_mkdev_acl(const struct tomoyo_acl_info *a,\n\t\t\t\t\t const struct tomoyo_acl_info *b)\n{\n\tconst struct tomoyo_mkdev_acl *p1 = container_of(a, typeof(*p1), head);\n\tconst struct tomoyo_mkdev_acl *p2 = container_of(b, typeof(*p2), head);\n\treturn tomoyo_same_name_union(&p1->name, &p2->name) &&\n\t\ttomoyo_same_number_union(&p1->mode, &p2->mode) &&\n\t\ttomoyo_same_number_union(&p1->major, &p2->major) &&\n\t\ttomoyo_same_number_union(&p1->minor, &p2->minor);\n}"
  },
  {
    "function_name": "tomoyo_update_path_acl",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/file.c",
    "lines": "379-395",
    "snippet": "static int tomoyo_update_path_acl(const u16 perm,\n\t\t\t\t  struct tomoyo_acl_param *param)\n{\n\tstruct tomoyo_path_acl e = {\n\t\t.head.type = TOMOYO_TYPE_PATH_ACL,\n\t\t.perm = perm\n\t};\n\tint error;\n\tif (!tomoyo_parse_name_union(param, &e.name))\n\t\terror = -EINVAL;\n\telse\n\t\terror = tomoyo_update_domain(&e.head, sizeof(e), param,\n\t\t\t\t\t     tomoyo_same_path_acl,\n\t\t\t\t\t     tomoyo_merge_path_acl);\n\ttomoyo_put_name_union(&e.name);\n\treturn error;\n}",
    "includes": [
      "#include <linux/slab.h>",
      "#include \"common.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "tomoyo_put_name_union",
          "args": [
            "&e.name"
          ],
          "line": 393
        },
        "resolved": true,
        "details": {
          "function_name": "tomoyo_put_name_union",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/file.c",
          "lines": "67-71",
          "snippet": "void tomoyo_put_name_union(struct tomoyo_name_union *ptr)\n{\n\ttomoyo_put_group(ptr->group);\n\ttomoyo_put_name(ptr->filename);\n}",
          "includes": [
            "#include <linux/slab.h>",
            "#include \"common.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/slab.h>\n#include \"common.h\"\n\nvoid tomoyo_put_name_union(struct tomoyo_name_union *ptr)\n{\n\ttomoyo_put_group(ptr->group);\n\ttomoyo_put_name(ptr->filename);\n}"
        }
      },
      {
        "call_info": {
          "callee": "tomoyo_update_domain",
          "args": [
            "&e.head",
            "sizeof(e)",
            "param",
            "tomoyo_same_path_acl",
            "tomoyo_merge_path_acl"
          ],
          "line": 390
        },
        "resolved": true,
        "details": {
          "function_name": "tomoyo_update_domain",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/domain.c",
          "lines": "91-147",
          "snippet": "int tomoyo_update_domain(struct tomoyo_acl_info *new_entry, const int size,\n\t\t\t struct tomoyo_acl_param *param,\n\t\t\t bool (*check_duplicate) (const struct tomoyo_acl_info\n\t\t\t\t\t\t  *,\n\t\t\t\t\t\t  const struct tomoyo_acl_info\n\t\t\t\t\t\t  *),\n\t\t\t bool (*merge_duplicate) (struct tomoyo_acl_info *,\n\t\t\t\t\t\t  struct tomoyo_acl_info *,\n\t\t\t\t\t\t  const bool))\n{\n\tconst bool is_delete = param->is_delete;\n\tint error = is_delete ? -ENOENT : -ENOMEM;\n\tstruct tomoyo_acl_info *entry;\n\tstruct list_head * const list = param->list;\n\n\tif (param->data[0]) {\n\t\tnew_entry->cond = tomoyo_get_condition(param);\n\t\tif (!new_entry->cond)\n\t\t\treturn -EINVAL;\n\t\t/*\n\t\t * Domain transition preference is allowed for only\n\t\t * \"file execute\" entries.\n\t\t */\n\t\tif (new_entry->cond->transit &&\n\t\t    !(new_entry->type == TOMOYO_TYPE_PATH_ACL &&\n\t\t      container_of(new_entry, struct tomoyo_path_acl, head)\n\t\t      ->perm == 1 << TOMOYO_TYPE_EXECUTE))\n\t\t\tgoto out;\n\t}\n\tif (mutex_lock_interruptible(&tomoyo_policy_lock))\n\t\tgoto out;\n\tlist_for_each_entry_rcu(entry, list, list) {\n\t\tif (entry->is_deleted == TOMOYO_GC_IN_PROGRESS)\n\t\t\tcontinue;\n\t\tif (!tomoyo_same_acl_head(entry, new_entry) ||\n\t\t    !check_duplicate(entry, new_entry))\n\t\t\tcontinue;\n\t\tif (merge_duplicate)\n\t\t\tentry->is_deleted = merge_duplicate(entry, new_entry,\n\t\t\t\t\t\t\t    is_delete);\n\t\telse\n\t\t\tentry->is_deleted = is_delete;\n\t\terror = 0;\n\t\tbreak;\n\t}\n\tif (error && !is_delete) {\n\t\tentry = tomoyo_commit_ok(new_entry, size);\n\t\tif (entry) {\n\t\t\tlist_add_tail_rcu(&entry->list, list);\n\t\t\terror = 0;\n\t\t}\n\t}\n\tmutex_unlock(&tomoyo_policy_lock);\nout:\n\ttomoyo_put_condition(new_entry->cond);\n\treturn error;\n}",
          "includes": [
            "#include <linux/rculist.h>",
            "#include <linux/slab.h>",
            "#include <linux/binfmts.h>",
            "#include \"common.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/rculist.h>\n#include <linux/slab.h>\n#include <linux/binfmts.h>\n#include \"common.h\"\n\nint tomoyo_update_domain(struct tomoyo_acl_info *new_entry, const int size,\n\t\t\t struct tomoyo_acl_param *param,\n\t\t\t bool (*check_duplicate) (const struct tomoyo_acl_info\n\t\t\t\t\t\t  *,\n\t\t\t\t\t\t  const struct tomoyo_acl_info\n\t\t\t\t\t\t  *),\n\t\t\t bool (*merge_duplicate) (struct tomoyo_acl_info *,\n\t\t\t\t\t\t  struct tomoyo_acl_info *,\n\t\t\t\t\t\t  const bool))\n{\n\tconst bool is_delete = param->is_delete;\n\tint error = is_delete ? -ENOENT : -ENOMEM;\n\tstruct tomoyo_acl_info *entry;\n\tstruct list_head * const list = param->list;\n\n\tif (param->data[0]) {\n\t\tnew_entry->cond = tomoyo_get_condition(param);\n\t\tif (!new_entry->cond)\n\t\t\treturn -EINVAL;\n\t\t/*\n\t\t * Domain transition preference is allowed for only\n\t\t * \"file execute\" entries.\n\t\t */\n\t\tif (new_entry->cond->transit &&\n\t\t    !(new_entry->type == TOMOYO_TYPE_PATH_ACL &&\n\t\t      container_of(new_entry, struct tomoyo_path_acl, head)\n\t\t      ->perm == 1 << TOMOYO_TYPE_EXECUTE))\n\t\t\tgoto out;\n\t}\n\tif (mutex_lock_interruptible(&tomoyo_policy_lock))\n\t\tgoto out;\n\tlist_for_each_entry_rcu(entry, list, list) {\n\t\tif (entry->is_deleted == TOMOYO_GC_IN_PROGRESS)\n\t\t\tcontinue;\n\t\tif (!tomoyo_same_acl_head(entry, new_entry) ||\n\t\t    !check_duplicate(entry, new_entry))\n\t\t\tcontinue;\n\t\tif (merge_duplicate)\n\t\t\tentry->is_deleted = merge_duplicate(entry, new_entry,\n\t\t\t\t\t\t\t    is_delete);\n\t\telse\n\t\t\tentry->is_deleted = is_delete;\n\t\terror = 0;\n\t\tbreak;\n\t}\n\tif (error && !is_delete) {\n\t\tentry = tomoyo_commit_ok(new_entry, size);\n\t\tif (entry) {\n\t\t\tlist_add_tail_rcu(&entry->list, list);\n\t\t\terror = 0;\n\t\t}\n\t}\n\tmutex_unlock(&tomoyo_policy_lock);\nout:\n\ttomoyo_put_condition(new_entry->cond);\n\treturn error;\n}"
        }
      },
      {
        "call_info": {
          "callee": "tomoyo_parse_name_union",
          "args": [
            "param",
            "&e.name"
          ],
          "line": 387
        },
        "resolved": true,
        "details": {
          "function_name": "tomoyo_parse_name_union_quoted",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/condition.c",
          "lines": "269-277",
          "snippet": "static bool tomoyo_parse_name_union_quoted(struct tomoyo_acl_param *param,\n\t\t\t\t\t   struct tomoyo_name_union *ptr)\n{\n\tchar *filename = param->data;\n\tif (*filename == '@')\n\t\treturn tomoyo_parse_name_union(param, ptr);\n\tptr->filename = tomoyo_get_dqword(filename);\n\treturn ptr->filename != NULL;\n}",
          "includes": [
            "#include <linux/slab.h>",
            "#include \"common.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/slab.h>\n#include \"common.h\"\n\nstatic bool tomoyo_parse_name_union_quoted(struct tomoyo_acl_param *param,\n\t\t\t\t\t   struct tomoyo_name_union *ptr)\n{\n\tchar *filename = param->data;\n\tif (*filename == '@')\n\t\treturn tomoyo_parse_name_union(param, ptr);\n\tptr->filename = tomoyo_get_dqword(filename);\n\treturn ptr->filename != NULL;\n}"
        }
      }
    ],
    "contextual_snippet": "#include <linux/slab.h>\n#include \"common.h\"\n\nstatic int tomoyo_update_path_acl(const u16 perm,\n\t\t\t\t  struct tomoyo_acl_param *param)\n{\n\tstruct tomoyo_path_acl e = {\n\t\t.head.type = TOMOYO_TYPE_PATH_ACL,\n\t\t.perm = perm\n\t};\n\tint error;\n\tif (!tomoyo_parse_name_union(param, &e.name))\n\t\terror = -EINVAL;\n\telse\n\t\terror = tomoyo_update_domain(&e.head, sizeof(e), param,\n\t\t\t\t\t     tomoyo_same_path_acl,\n\t\t\t\t\t     tomoyo_merge_path_acl);\n\ttomoyo_put_name_union(&e.name);\n\treturn error;\n}"
  },
  {
    "function_name": "tomoyo_merge_path_acl",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/file.c",
    "lines": "353-367",
    "snippet": "static bool tomoyo_merge_path_acl(struct tomoyo_acl_info *a,\n\t\t\t\t  struct tomoyo_acl_info *b,\n\t\t\t\t  const bool is_delete)\n{\n\tu16 * const a_perm = &container_of(a, struct tomoyo_path_acl, head)\n\t\t->perm;\n\tu16 perm = *a_perm;\n\tconst u16 b_perm = container_of(b, struct tomoyo_path_acl, head)->perm;\n\tif (is_delete)\n\t\tperm &= ~b_perm;\n\telse\n\t\tperm |= b_perm;\n\t*a_perm = perm;\n\treturn !perm;\n}",
    "includes": [
      "#include <linux/slab.h>",
      "#include \"common.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "container_of",
          "args": [
            "b",
            "structtomoyo_path_acl",
            "head"
          ],
          "line": 360
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "container_of",
          "args": [
            "a",
            "structtomoyo_path_acl",
            "head"
          ],
          "line": 357
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <linux/slab.h>\n#include \"common.h\"\n\nstatic bool tomoyo_merge_path_acl(struct tomoyo_acl_info *a,\n\t\t\t\t  struct tomoyo_acl_info *b,\n\t\t\t\t  const bool is_delete)\n{\n\tu16 * const a_perm = &container_of(a, struct tomoyo_path_acl, head)\n\t\t->perm;\n\tu16 perm = *a_perm;\n\tconst u16 b_perm = container_of(b, struct tomoyo_path_acl, head)->perm;\n\tif (is_delete)\n\t\tperm &= ~b_perm;\n\telse\n\t\tperm |= b_perm;\n\t*a_perm = perm;\n\treturn !perm;\n}"
  },
  {
    "function_name": "tomoyo_same_path_acl",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/file.c",
    "lines": "336-342",
    "snippet": "static bool tomoyo_same_path_acl(const struct tomoyo_acl_info *a,\n\t\t\t\t const struct tomoyo_acl_info *b)\n{\n\tconst struct tomoyo_path_acl *p1 = container_of(a, typeof(*p1), head);\n\tconst struct tomoyo_path_acl *p2 = container_of(b, typeof(*p2), head);\n\treturn tomoyo_same_name_union(&p1->name, &p2->name);\n}",
    "includes": [
      "#include <linux/slab.h>",
      "#include \"common.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "tomoyo_same_name_union",
          "args": [
            "&p1->name",
            "&p2->name"
          ],
          "line": 341
        },
        "resolved": true,
        "details": {
          "function_name": "tomoyo_same_name_union",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/common.h",
          "lines": "1230-1234",
          "snippet": "static inline bool tomoyo_same_name_union\n(const struct tomoyo_name_union *a, const struct tomoyo_name_union *b)\n{\n\treturn a->filename == b->filename && a->group == b->group;\n}",
          "includes": [
            "#include <net/udp.h>",
            "#include <net/ipv6.h>",
            "#include <net/ip.h>",
            "#include <net/af_unix.h>",
            "#include <net/sock.h>",
            "#include <linux/un.h>",
            "#include <linux/in6.h>",
            "#include <linux/in.h>",
            "#include <linux/inet.h>",
            "#include <linux/net.h>",
            "#include <linux/highmem.h>",
            "#include <linux/binfmts.h>",
            "#include <linux/poll.h>",
            "#include <linux/cred.h>",
            "#include <linux/list.h>",
            "#include <linux/mount.h>",
            "#include <linux/namei.h>",
            "#include <linux/sched.h>",
            "#include <linux/fs.h>",
            "#include <linux/kmod.h>",
            "#include <linux/file.h>",
            "#include <linux/mm.h>",
            "#include <linux/string.h>",
            "#include <linux/ctype.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <net/udp.h>\n#include <net/ipv6.h>\n#include <net/ip.h>\n#include <net/af_unix.h>\n#include <net/sock.h>\n#include <linux/un.h>\n#include <linux/in6.h>\n#include <linux/in.h>\n#include <linux/inet.h>\n#include <linux/net.h>\n#include <linux/highmem.h>\n#include <linux/binfmts.h>\n#include <linux/poll.h>\n#include <linux/cred.h>\n#include <linux/list.h>\n#include <linux/mount.h>\n#include <linux/namei.h>\n#include <linux/sched.h>\n#include <linux/fs.h>\n#include <linux/kmod.h>\n#include <linux/file.h>\n#include <linux/mm.h>\n#include <linux/string.h>\n#include <linux/ctype.h>\n\nstatic inline bool tomoyo_same_name_union\n(const struct tomoyo_name_union *a, const struct tomoyo_name_union *b)\n{\n\treturn a->filename == b->filename && a->group == b->group;\n}"
        }
      },
      {
        "call_info": {
          "callee": "container_of",
          "args": [
            "b",
            "typeof(*p2)",
            "head"
          ],
          "line": 340
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "typeof",
          "args": [
            "*p2"
          ],
          "line": 340
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "container_of",
          "args": [
            "a",
            "typeof(*p1)",
            "head"
          ],
          "line": 339
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "typeof",
          "args": [
            "*p1"
          ],
          "line": 339
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <linux/slab.h>\n#include \"common.h\"\n\nstatic bool tomoyo_same_path_acl(const struct tomoyo_acl_info *a,\n\t\t\t\t const struct tomoyo_acl_info *b)\n{\n\tconst struct tomoyo_path_acl *p1 = container_of(a, typeof(*p1), head);\n\tconst struct tomoyo_path_acl *p2 = container_of(b, typeof(*p2), head);\n\treturn tomoyo_same_name_union(&p1->name, &p2->name);\n}"
  },
  {
    "function_name": "tomoyo_check_mkdev_acl",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/file.c",
    "lines": "312-326",
    "snippet": "static bool tomoyo_check_mkdev_acl(struct tomoyo_request_info *r,\n\t\t\t\t   const struct tomoyo_acl_info *ptr)\n{\n\tconst struct tomoyo_mkdev_acl *acl =\n\t\tcontainer_of(ptr, typeof(*acl), head);\n\treturn (acl->perm & (1 << r->param.mkdev.operation)) &&\n\t\ttomoyo_compare_number_union(r->param.mkdev.mode,\n\t\t\t\t\t    &acl->mode) &&\n\t\ttomoyo_compare_number_union(r->param.mkdev.major,\n\t\t\t\t\t    &acl->major) &&\n\t\ttomoyo_compare_number_union(r->param.mkdev.minor,\n\t\t\t\t\t    &acl->minor) &&\n\t\ttomoyo_compare_name_union(r->param.mkdev.filename,\n\t\t\t\t\t  &acl->name);\n}",
    "includes": [
      "#include <linux/slab.h>",
      "#include \"common.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "tomoyo_compare_name_union",
          "args": [
            "r->param.mkdev.filename",
            "&acl->name"
          ],
          "line": 324
        },
        "resolved": true,
        "details": {
          "function_name": "tomoyo_compare_name_union",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/file.c",
          "lines": "81-90",
          "snippet": "const struct tomoyo_path_info *\ntomoyo_compare_name_union(const struct tomoyo_path_info *name,\n\t\t\t  const struct tomoyo_name_union *ptr)\n{\n\tif (ptr->group)\n\t\treturn tomoyo_path_matches_group(name, ptr->group);\n\tif (tomoyo_path_matches_pattern(name, ptr->filename))\n\t\treturn ptr->filename;\n\treturn NULL;\n}",
          "includes": [
            "#include <linux/slab.h>",
            "#include \"common.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/slab.h>\n#include \"common.h\"\n\nconst struct tomoyo_path_info *\ntomoyo_compare_name_union(const struct tomoyo_path_info *name,\n\t\t\t  const struct tomoyo_name_union *ptr)\n{\n\tif (ptr->group)\n\t\treturn tomoyo_path_matches_group(name, ptr->group);\n\tif (tomoyo_path_matches_pattern(name, ptr->filename))\n\t\treturn ptr->filename;\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "tomoyo_compare_number_union",
          "args": [
            "r->param.mkdev.minor",
            "&acl->minor"
          ],
          "line": 322
        },
        "resolved": true,
        "details": {
          "function_name": "tomoyo_compare_number_union",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/file.c",
          "lines": "112-118",
          "snippet": "bool tomoyo_compare_number_union(const unsigned long value,\n\t\t\t\t const struct tomoyo_number_union *ptr)\n{\n\tif (ptr->group)\n\t\treturn tomoyo_number_matches_group(value, value, ptr->group);\n\treturn value >= ptr->values[0] && value <= ptr->values[1];\n}",
          "includes": [
            "#include <linux/slab.h>",
            "#include \"common.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/slab.h>\n#include \"common.h\"\n\nbool tomoyo_compare_number_union(const unsigned long value,\n\t\t\t\t const struct tomoyo_number_union *ptr)\n{\n\tif (ptr->group)\n\t\treturn tomoyo_number_matches_group(value, value, ptr->group);\n\treturn value >= ptr->values[0] && value <= ptr->values[1];\n}"
        }
      },
      {
        "call_info": {
          "callee": "container_of",
          "args": [
            "ptr",
            "typeof(*acl)",
            "head"
          ],
          "line": 316
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "typeof",
          "args": [
            "*acl"
          ],
          "line": 316
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <linux/slab.h>\n#include \"common.h\"\n\nstatic bool tomoyo_check_mkdev_acl(struct tomoyo_request_info *r,\n\t\t\t\t   const struct tomoyo_acl_info *ptr)\n{\n\tconst struct tomoyo_mkdev_acl *acl =\n\t\tcontainer_of(ptr, typeof(*acl), head);\n\treturn (acl->perm & (1 << r->param.mkdev.operation)) &&\n\t\ttomoyo_compare_number_union(r->param.mkdev.mode,\n\t\t\t\t\t    &acl->mode) &&\n\t\ttomoyo_compare_number_union(r->param.mkdev.major,\n\t\t\t\t\t    &acl->major) &&\n\t\ttomoyo_compare_number_union(r->param.mkdev.minor,\n\t\t\t\t\t    &acl->minor) &&\n\t\ttomoyo_compare_name_union(r->param.mkdev.filename,\n\t\t\t\t\t  &acl->name);\n}"
  },
  {
    "function_name": "tomoyo_check_path2_acl",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/file.c",
    "lines": "293-302",
    "snippet": "static bool tomoyo_check_path2_acl(struct tomoyo_request_info *r,\n\t\t\t\t   const struct tomoyo_acl_info *ptr)\n{\n\tconst struct tomoyo_path2_acl *acl =\n\t\tcontainer_of(ptr, typeof(*acl), head);\n\treturn (acl->perm & (1 << r->param.path2.operation)) &&\n\t\ttomoyo_compare_name_union(r->param.path2.filename1, &acl->name1)\n\t\t&& tomoyo_compare_name_union(r->param.path2.filename2,\n\t\t\t\t\t     &acl->name2);\n}",
    "includes": [
      "#include <linux/slab.h>",
      "#include \"common.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "tomoyo_compare_name_union",
          "args": [
            "r->param.path2.filename2",
            "&acl->name2"
          ],
          "line": 300
        },
        "resolved": true,
        "details": {
          "function_name": "tomoyo_compare_name_union",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/file.c",
          "lines": "81-90",
          "snippet": "const struct tomoyo_path_info *\ntomoyo_compare_name_union(const struct tomoyo_path_info *name,\n\t\t\t  const struct tomoyo_name_union *ptr)\n{\n\tif (ptr->group)\n\t\treturn tomoyo_path_matches_group(name, ptr->group);\n\tif (tomoyo_path_matches_pattern(name, ptr->filename))\n\t\treturn ptr->filename;\n\treturn NULL;\n}",
          "includes": [
            "#include <linux/slab.h>",
            "#include \"common.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/slab.h>\n#include \"common.h\"\n\nconst struct tomoyo_path_info *\ntomoyo_compare_name_union(const struct tomoyo_path_info *name,\n\t\t\t  const struct tomoyo_name_union *ptr)\n{\n\tif (ptr->group)\n\t\treturn tomoyo_path_matches_group(name, ptr->group);\n\tif (tomoyo_path_matches_pattern(name, ptr->filename))\n\t\treturn ptr->filename;\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "container_of",
          "args": [
            "ptr",
            "typeof(*acl)",
            "head"
          ],
          "line": 297
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "typeof",
          "args": [
            "*acl"
          ],
          "line": 297
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <linux/slab.h>\n#include \"common.h\"\n\nstatic bool tomoyo_check_path2_acl(struct tomoyo_request_info *r,\n\t\t\t\t   const struct tomoyo_acl_info *ptr)\n{\n\tconst struct tomoyo_path2_acl *acl =\n\t\tcontainer_of(ptr, typeof(*acl), head);\n\treturn (acl->perm & (1 << r->param.path2.operation)) &&\n\t\ttomoyo_compare_name_union(r->param.path2.filename1, &acl->name1)\n\t\t&& tomoyo_compare_name_union(r->param.path2.filename2,\n\t\t\t\t\t     &acl->name2);\n}"
  },
  {
    "function_name": "tomoyo_check_path_number_acl",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/file.c",
    "lines": "273-283",
    "snippet": "static bool tomoyo_check_path_number_acl(struct tomoyo_request_info *r,\n\t\t\t\t\t const struct tomoyo_acl_info *ptr)\n{\n\tconst struct tomoyo_path_number_acl *acl =\n\t\tcontainer_of(ptr, typeof(*acl), head);\n\treturn (acl->perm & (1 << r->param.path_number.operation)) &&\n\t\ttomoyo_compare_number_union(r->param.path_number.number,\n\t\t\t\t\t    &acl->number) &&\n\t\ttomoyo_compare_name_union(r->param.path_number.filename,\n\t\t\t\t\t  &acl->name);\n}",
    "includes": [
      "#include <linux/slab.h>",
      "#include \"common.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "tomoyo_compare_name_union",
          "args": [
            "r->param.path_number.filename",
            "&acl->name"
          ],
          "line": 281
        },
        "resolved": true,
        "details": {
          "function_name": "tomoyo_compare_name_union",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/file.c",
          "lines": "81-90",
          "snippet": "const struct tomoyo_path_info *\ntomoyo_compare_name_union(const struct tomoyo_path_info *name,\n\t\t\t  const struct tomoyo_name_union *ptr)\n{\n\tif (ptr->group)\n\t\treturn tomoyo_path_matches_group(name, ptr->group);\n\tif (tomoyo_path_matches_pattern(name, ptr->filename))\n\t\treturn ptr->filename;\n\treturn NULL;\n}",
          "includes": [
            "#include <linux/slab.h>",
            "#include \"common.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/slab.h>\n#include \"common.h\"\n\nconst struct tomoyo_path_info *\ntomoyo_compare_name_union(const struct tomoyo_path_info *name,\n\t\t\t  const struct tomoyo_name_union *ptr)\n{\n\tif (ptr->group)\n\t\treturn tomoyo_path_matches_group(name, ptr->group);\n\tif (tomoyo_path_matches_pattern(name, ptr->filename))\n\t\treturn ptr->filename;\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "tomoyo_compare_number_union",
          "args": [
            "r->param.path_number.number",
            "&acl->number"
          ],
          "line": 279
        },
        "resolved": true,
        "details": {
          "function_name": "tomoyo_compare_number_union",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/file.c",
          "lines": "112-118",
          "snippet": "bool tomoyo_compare_number_union(const unsigned long value,\n\t\t\t\t const struct tomoyo_number_union *ptr)\n{\n\tif (ptr->group)\n\t\treturn tomoyo_number_matches_group(value, value, ptr->group);\n\treturn value >= ptr->values[0] && value <= ptr->values[1];\n}",
          "includes": [
            "#include <linux/slab.h>",
            "#include \"common.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/slab.h>\n#include \"common.h\"\n\nbool tomoyo_compare_number_union(const unsigned long value,\n\t\t\t\t const struct tomoyo_number_union *ptr)\n{\n\tif (ptr->group)\n\t\treturn tomoyo_number_matches_group(value, value, ptr->group);\n\treturn value >= ptr->values[0] && value <= ptr->values[1];\n}"
        }
      },
      {
        "call_info": {
          "callee": "container_of",
          "args": [
            "ptr",
            "typeof(*acl)",
            "head"
          ],
          "line": 277
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "typeof",
          "args": [
            "*acl"
          ],
          "line": 277
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <linux/slab.h>\n#include \"common.h\"\n\nstatic bool tomoyo_check_path_number_acl(struct tomoyo_request_info *r,\n\t\t\t\t\t const struct tomoyo_acl_info *ptr)\n{\n\tconst struct tomoyo_path_number_acl *acl =\n\t\tcontainer_of(ptr, typeof(*acl), head);\n\treturn (acl->perm & (1 << r->param.path_number.operation)) &&\n\t\ttomoyo_compare_number_union(r->param.path_number.number,\n\t\t\t\t\t    &acl->number) &&\n\t\ttomoyo_compare_name_union(r->param.path_number.filename,\n\t\t\t\t\t  &acl->name);\n}"
  },
  {
    "function_name": "tomoyo_check_path_acl",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/file.c",
    "lines": "251-263",
    "snippet": "static bool tomoyo_check_path_acl(struct tomoyo_request_info *r,\n\t\t\t\t  const struct tomoyo_acl_info *ptr)\n{\n\tconst struct tomoyo_path_acl *acl = container_of(ptr, typeof(*acl),\n\t\t\t\t\t\t\t head);\n\tif (acl->perm & (1 << r->param.path.operation)) {\n\t\tr->param.path.matched_path =\n\t\t\ttomoyo_compare_name_union(r->param.path.filename,\n\t\t\t\t\t\t  &acl->name);\n\t\treturn r->param.path.matched_path != NULL;\n\t}\n\treturn false;\n}",
    "includes": [
      "#include <linux/slab.h>",
      "#include \"common.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "tomoyo_compare_name_union",
          "args": [
            "r->param.path.filename",
            "&acl->name"
          ],
          "line": 258
        },
        "resolved": true,
        "details": {
          "function_name": "tomoyo_compare_name_union",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/file.c",
          "lines": "81-90",
          "snippet": "const struct tomoyo_path_info *\ntomoyo_compare_name_union(const struct tomoyo_path_info *name,\n\t\t\t  const struct tomoyo_name_union *ptr)\n{\n\tif (ptr->group)\n\t\treturn tomoyo_path_matches_group(name, ptr->group);\n\tif (tomoyo_path_matches_pattern(name, ptr->filename))\n\t\treturn ptr->filename;\n\treturn NULL;\n}",
          "includes": [
            "#include <linux/slab.h>",
            "#include \"common.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/slab.h>\n#include \"common.h\"\n\nconst struct tomoyo_path_info *\ntomoyo_compare_name_union(const struct tomoyo_path_info *name,\n\t\t\t  const struct tomoyo_name_union *ptr)\n{\n\tif (ptr->group)\n\t\treturn tomoyo_path_matches_group(name, ptr->group);\n\tif (tomoyo_path_matches_pattern(name, ptr->filename))\n\t\treturn ptr->filename;\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "container_of",
          "args": [
            "ptr",
            "typeof(*acl)",
            "head"
          ],
          "line": 254
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "typeof",
          "args": [
            "*acl"
          ],
          "line": 254
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <linux/slab.h>\n#include \"common.h\"\n\nstatic bool tomoyo_check_path_acl(struct tomoyo_request_info *r,\n\t\t\t\t  const struct tomoyo_acl_info *ptr)\n{\n\tconst struct tomoyo_path_acl *acl = container_of(ptr, typeof(*acl),\n\t\t\t\t\t\t\t head);\n\tif (acl->perm & (1 << r->param.path.operation)) {\n\t\tr->param.path.matched_path =\n\t\t\ttomoyo_compare_name_union(r->param.path.filename,\n\t\t\t\t\t\t  &acl->name);\n\t\treturn r->param.path.matched_path != NULL;\n\t}\n\treturn false;\n}"
  },
  {
    "function_name": "tomoyo_audit_path_number_log",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/file.c",
    "lines": "212-237",
    "snippet": "static int tomoyo_audit_path_number_log(struct tomoyo_request_info *r)\n{\n\tconst u8 type = r->param.path_number.operation;\n\tu8 radix;\n\tchar buffer[64];\n\tswitch (type) {\n\tcase TOMOYO_TYPE_CREATE:\n\tcase TOMOYO_TYPE_MKDIR:\n\tcase TOMOYO_TYPE_MKFIFO:\n\tcase TOMOYO_TYPE_MKSOCK:\n\tcase TOMOYO_TYPE_CHMOD:\n\t\tradix = TOMOYO_VALUE_TYPE_OCTAL;\n\t\tbreak;\n\tcase TOMOYO_TYPE_IOCTL:\n\t\tradix = TOMOYO_VALUE_TYPE_HEXADECIMAL;\n\t\tbreak;\n\tdefault:\n\t\tradix = TOMOYO_VALUE_TYPE_DECIMAL;\n\t\tbreak;\n\t}\n\ttomoyo_print_ulong(buffer, sizeof(buffer), r->param.path_number.number,\n\t\t\t   radix);\n\treturn tomoyo_supervisor(r, \"file %s %s %s\\n\", tomoyo_mac_keywords\n\t\t\t\t [tomoyo_pn2mac[type]],\n\t\t\t\t r->param.path_number.filename->name, buffer);\n}",
    "includes": [
      "#include <linux/slab.h>",
      "#include \"common.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "const u8 tomoyo_pn2mac[TOMOYO_MAX_PATH_NUMBER_OPERATION] = {\n\t[TOMOYO_TYPE_CREATE] = TOMOYO_MAC_FILE_CREATE,\n\t[TOMOYO_TYPE_MKDIR]  = TOMOYO_MAC_FILE_MKDIR,\n\t[TOMOYO_TYPE_MKFIFO] = TOMOYO_MAC_FILE_MKFIFO,\n\t[TOMOYO_TYPE_MKSOCK] = TOMOYO_MAC_FILE_MKSOCK,\n\t[TOMOYO_TYPE_IOCTL]  = TOMOYO_MAC_FILE_IOCTL,\n\t[TOMOYO_TYPE_CHMOD]  = TOMOYO_MAC_FILE_CHMOD,\n\t[TOMOYO_TYPE_CHOWN]  = TOMOYO_MAC_FILE_CHOWN,\n\t[TOMOYO_TYPE_CHGRP]  = TOMOYO_MAC_FILE_CHGRP,\n};"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "tomoyo_supervisor",
          "args": [
            "r",
            "\"file %s %s %s\\n\"",
            "tomoyo_mac_keywords\n\t\t\t\t [tomoyo_pn2mac[type]]",
            "r->param.path_number.filename->name",
            "buffer"
          ],
          "line": 234
        },
        "resolved": true,
        "details": {
          "function_name": "tomoyo_supervisor",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/common.c",
          "lines": "1996-2088",
          "snippet": "int tomoyo_supervisor(struct tomoyo_request_info *r, const char *fmt, ...)\n{\n\tva_list args;\n\tint error;\n\tint len;\n\tstatic unsigned int tomoyo_serial;\n\tstruct tomoyo_query entry = { };\n\tbool quota_exceeded = false;\n\tva_start(args, fmt);\n\tlen = vsnprintf((char *) &len, 1, fmt, args) + 1;\n\tva_end(args);\n\t/* Write /sys/kernel/security/tomoyo/audit. */\n\tva_start(args, fmt);\n\ttomoyo_write_log2(r, len, fmt, args);\n\tva_end(args);\n\t/* Nothing more to do if granted. */\n\tif (r->granted)\n\t\treturn 0;\n\tif (r->mode)\n\t\ttomoyo_update_stat(r->mode);\n\tswitch (r->mode) {\n\tcase TOMOYO_CONFIG_ENFORCING:\n\t\terror = -EPERM;\n\t\tif (atomic_read(&tomoyo_query_observers))\n\t\t\tbreak;\n\t\tgoto out;\n\tcase TOMOYO_CONFIG_LEARNING:\n\t\terror = 0;\n\t\t/* Check max_learning_entry parameter. */\n\t\tif (tomoyo_domain_quota_is_ok(r))\n\t\t\tbreak;\n\t\t/* fall through */\n\tdefault:\n\t\treturn 0;\n\t}\n\t/* Get message. */\n\tva_start(args, fmt);\n\tentry.query = tomoyo_init_log(r, len, fmt, args);\n\tva_end(args);\n\tif (!entry.query)\n\t\tgoto out;\n\tentry.query_len = strlen(entry.query) + 1;\n\tif (!error) {\n\t\ttomoyo_add_entry(r->domain, entry.query);\n\t\tgoto out;\n\t}\n\tlen = tomoyo_round2(entry.query_len);\n\tentry.domain = r->domain;\n\tspin_lock(&tomoyo_query_list_lock);\n\tif (tomoyo_memory_quota[TOMOYO_MEMORY_QUERY] &&\n\t    tomoyo_memory_used[TOMOYO_MEMORY_QUERY] + len\n\t    >= tomoyo_memory_quota[TOMOYO_MEMORY_QUERY]) {\n\t\tquota_exceeded = true;\n\t} else {\n\t\tentry.serial = tomoyo_serial++;\n\t\tentry.retry = r->retry;\n\t\ttomoyo_memory_used[TOMOYO_MEMORY_QUERY] += len;\n\t\tlist_add_tail(&entry.list, &tomoyo_query_list);\n\t}\n\tspin_unlock(&tomoyo_query_list_lock);\n\tif (quota_exceeded)\n\t\tgoto out;\n\t/* Give 10 seconds for supervisor's opinion. */\n\twhile (entry.timer < 10) {\n\t\twake_up_all(&tomoyo_query_wait);\n\t\tif (wait_event_interruptible_timeout\n\t\t    (tomoyo_answer_wait, entry.answer ||\n\t\t     !atomic_read(&tomoyo_query_observers), HZ))\n\t\t\tbreak;\n\t\telse\n\t\t\tentry.timer++;\n\t}\n\tspin_lock(&tomoyo_query_list_lock);\n\tlist_del(&entry.list);\n\ttomoyo_memory_used[TOMOYO_MEMORY_QUERY] -= len;\n\tspin_unlock(&tomoyo_query_list_lock);\n\tswitch (entry.answer) {\n\tcase 3: /* Asked to retry by administrator. */\n\t\terror = TOMOYO_RETRY_REQUEST;\n\t\tr->retry++;\n\t\tbreak;\n\tcase 1:\n\t\t/* Granted by administrator. */\n\t\terror = 0;\n\t\tbreak;\n\tdefault:\n\t\t/* Timed out or rejected by administrator. */\n\t\tbreak;\n\t}\nout:\n\tkfree(entry.query);\n\treturn error;\n}",
          "includes": [
            "#include \"builtin-policy.h\"",
            "#include \"common.h\"",
            "#include <linux/security.h>",
            "#include <linux/slab.h>",
            "#include <linux/uaccess.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static struct tomoyo_domain_info *tomoyo_find_domain_by_qid\n(unsigned int serial);",
            "static DECLARE_WAIT_QUEUE_HEAD(tomoyo_query_wait);",
            "static DECLARE_WAIT_QUEUE_HEAD(tomoyo_answer_wait);",
            "static LIST_HEAD(tomoyo_query_list);",
            "static DEFINE_SPINLOCK(tomoyo_query_list_lock);",
            "static atomic_t tomoyo_query_observers = ATOMIC_INIT(0);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"builtin-policy.h\"\n#include \"common.h\"\n#include <linux/security.h>\n#include <linux/slab.h>\n#include <linux/uaccess.h>\n\nstatic struct tomoyo_domain_info *tomoyo_find_domain_by_qid\n(unsigned int serial);\nstatic DECLARE_WAIT_QUEUE_HEAD(tomoyo_query_wait);\nstatic DECLARE_WAIT_QUEUE_HEAD(tomoyo_answer_wait);\nstatic LIST_HEAD(tomoyo_query_list);\nstatic DEFINE_SPINLOCK(tomoyo_query_list_lock);\nstatic atomic_t tomoyo_query_observers = ATOMIC_INIT(0);\n\nint tomoyo_supervisor(struct tomoyo_request_info *r, const char *fmt, ...)\n{\n\tva_list args;\n\tint error;\n\tint len;\n\tstatic unsigned int tomoyo_serial;\n\tstruct tomoyo_query entry = { };\n\tbool quota_exceeded = false;\n\tva_start(args, fmt);\n\tlen = vsnprintf((char *) &len, 1, fmt, args) + 1;\n\tva_end(args);\n\t/* Write /sys/kernel/security/tomoyo/audit. */\n\tva_start(args, fmt);\n\ttomoyo_write_log2(r, len, fmt, args);\n\tva_end(args);\n\t/* Nothing more to do if granted. */\n\tif (r->granted)\n\t\treturn 0;\n\tif (r->mode)\n\t\ttomoyo_update_stat(r->mode);\n\tswitch (r->mode) {\n\tcase TOMOYO_CONFIG_ENFORCING:\n\t\terror = -EPERM;\n\t\tif (atomic_read(&tomoyo_query_observers))\n\t\t\tbreak;\n\t\tgoto out;\n\tcase TOMOYO_CONFIG_LEARNING:\n\t\terror = 0;\n\t\t/* Check max_learning_entry parameter. */\n\t\tif (tomoyo_domain_quota_is_ok(r))\n\t\t\tbreak;\n\t\t/* fall through */\n\tdefault:\n\t\treturn 0;\n\t}\n\t/* Get message. */\n\tva_start(args, fmt);\n\tentry.query = tomoyo_init_log(r, len, fmt, args);\n\tva_end(args);\n\tif (!entry.query)\n\t\tgoto out;\n\tentry.query_len = strlen(entry.query) + 1;\n\tif (!error) {\n\t\ttomoyo_add_entry(r->domain, entry.query);\n\t\tgoto out;\n\t}\n\tlen = tomoyo_round2(entry.query_len);\n\tentry.domain = r->domain;\n\tspin_lock(&tomoyo_query_list_lock);\n\tif (tomoyo_memory_quota[TOMOYO_MEMORY_QUERY] &&\n\t    tomoyo_memory_used[TOMOYO_MEMORY_QUERY] + len\n\t    >= tomoyo_memory_quota[TOMOYO_MEMORY_QUERY]) {\n\t\tquota_exceeded = true;\n\t} else {\n\t\tentry.serial = tomoyo_serial++;\n\t\tentry.retry = r->retry;\n\t\ttomoyo_memory_used[TOMOYO_MEMORY_QUERY] += len;\n\t\tlist_add_tail(&entry.list, &tomoyo_query_list);\n\t}\n\tspin_unlock(&tomoyo_query_list_lock);\n\tif (quota_exceeded)\n\t\tgoto out;\n\t/* Give 10 seconds for supervisor's opinion. */\n\twhile (entry.timer < 10) {\n\t\twake_up_all(&tomoyo_query_wait);\n\t\tif (wait_event_interruptible_timeout\n\t\t    (tomoyo_answer_wait, entry.answer ||\n\t\t     !atomic_read(&tomoyo_query_observers), HZ))\n\t\t\tbreak;\n\t\telse\n\t\t\tentry.timer++;\n\t}\n\tspin_lock(&tomoyo_query_list_lock);\n\tlist_del(&entry.list);\n\ttomoyo_memory_used[TOMOYO_MEMORY_QUERY] -= len;\n\tspin_unlock(&tomoyo_query_list_lock);\n\tswitch (entry.answer) {\n\tcase 3: /* Asked to retry by administrator. */\n\t\terror = TOMOYO_RETRY_REQUEST;\n\t\tr->retry++;\n\t\tbreak;\n\tcase 1:\n\t\t/* Granted by administrator. */\n\t\terror = 0;\n\t\tbreak;\n\tdefault:\n\t\t/* Timed out or rejected by administrator. */\n\t\tbreak;\n\t}\nout:\n\tkfree(entry.query);\n\treturn error;\n}"
        }
      },
      {
        "call_info": {
          "callee": "tomoyo_print_ulong",
          "args": [
            "buffer",
            "sizeof(buffer)",
            "r->param.path_number.number",
            "radix"
          ],
          "line": 232
        },
        "resolved": true,
        "details": {
          "function_name": "tomoyo_print_ulong",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/util.c",
          "lines": "218-229",
          "snippet": "void tomoyo_print_ulong(char *buffer, const int buffer_len,\n\t\t\tconst unsigned long value, const u8 type)\n{\n\tif (type == TOMOYO_VALUE_TYPE_DECIMAL)\n\t\tsnprintf(buffer, buffer_len, \"%lu\", value);\n\telse if (type == TOMOYO_VALUE_TYPE_OCTAL)\n\t\tsnprintf(buffer, buffer_len, \"0%lo\", value);\n\telse if (type == TOMOYO_VALUE_TYPE_HEXADECIMAL)\n\t\tsnprintf(buffer, buffer_len, \"0x%lX\", value);\n\telse\n\t\tsnprintf(buffer, buffer_len, \"type(%u)\", type);\n}",
          "includes": [
            "#include \"common.h\"",
            "#include <linux/rculist.h>",
            "#include <linux/slab.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common.h\"\n#include <linux/rculist.h>\n#include <linux/slab.h>\n\nvoid tomoyo_print_ulong(char *buffer, const int buffer_len,\n\t\t\tconst unsigned long value, const u8 type)\n{\n\tif (type == TOMOYO_VALUE_TYPE_DECIMAL)\n\t\tsnprintf(buffer, buffer_len, \"%lu\", value);\n\telse if (type == TOMOYO_VALUE_TYPE_OCTAL)\n\t\tsnprintf(buffer, buffer_len, \"0%lo\", value);\n\telse if (type == TOMOYO_VALUE_TYPE_HEXADECIMAL)\n\t\tsnprintf(buffer, buffer_len, \"0x%lX\", value);\n\telse\n\t\tsnprintf(buffer, buffer_len, \"type(%u)\", type);\n}"
        }
      }
    ],
    "contextual_snippet": "#include <linux/slab.h>\n#include \"common.h\"\n\nconst u8 tomoyo_pn2mac[TOMOYO_MAX_PATH_NUMBER_OPERATION] = {\n\t[TOMOYO_TYPE_CREATE] = TOMOYO_MAC_FILE_CREATE,\n\t[TOMOYO_TYPE_MKDIR]  = TOMOYO_MAC_FILE_MKDIR,\n\t[TOMOYO_TYPE_MKFIFO] = TOMOYO_MAC_FILE_MKFIFO,\n\t[TOMOYO_TYPE_MKSOCK] = TOMOYO_MAC_FILE_MKSOCK,\n\t[TOMOYO_TYPE_IOCTL]  = TOMOYO_MAC_FILE_IOCTL,\n\t[TOMOYO_TYPE_CHMOD]  = TOMOYO_MAC_FILE_CHMOD,\n\t[TOMOYO_TYPE_CHOWN]  = TOMOYO_MAC_FILE_CHOWN,\n\t[TOMOYO_TYPE_CHGRP]  = TOMOYO_MAC_FILE_CHGRP,\n};\n\nstatic int tomoyo_audit_path_number_log(struct tomoyo_request_info *r)\n{\n\tconst u8 type = r->param.path_number.operation;\n\tu8 radix;\n\tchar buffer[64];\n\tswitch (type) {\n\tcase TOMOYO_TYPE_CREATE:\n\tcase TOMOYO_TYPE_MKDIR:\n\tcase TOMOYO_TYPE_MKFIFO:\n\tcase TOMOYO_TYPE_MKSOCK:\n\tcase TOMOYO_TYPE_CHMOD:\n\t\tradix = TOMOYO_VALUE_TYPE_OCTAL;\n\t\tbreak;\n\tcase TOMOYO_TYPE_IOCTL:\n\t\tradix = TOMOYO_VALUE_TYPE_HEXADECIMAL;\n\t\tbreak;\n\tdefault:\n\t\tradix = TOMOYO_VALUE_TYPE_DECIMAL;\n\t\tbreak;\n\t}\n\ttomoyo_print_ulong(buffer, sizeof(buffer), r->param.path_number.number,\n\t\t\t   radix);\n\treturn tomoyo_supervisor(r, \"file %s %s %s\\n\", tomoyo_mac_keywords\n\t\t\t\t [tomoyo_pn2mac[type]],\n\t\t\t\t r->param.path_number.filename->name, buffer);\n}"
  },
  {
    "function_name": "tomoyo_audit_mkdev_log",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/file.c",
    "lines": "195-203",
    "snippet": "static int tomoyo_audit_mkdev_log(struct tomoyo_request_info *r)\n{\n\treturn tomoyo_supervisor(r, \"file %s %s 0%o %u %u\\n\",\n\t\t\t\t tomoyo_mac_keywords\n\t\t\t\t [tomoyo_pnnn2mac[r->param.mkdev.operation]],\n\t\t\t\t r->param.mkdev.filename->name,\n\t\t\t\t r->param.mkdev.mode, r->param.mkdev.major,\n\t\t\t\t r->param.mkdev.minor);\n}",
    "includes": [
      "#include <linux/slab.h>",
      "#include \"common.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "const u8 tomoyo_pnnn2mac[TOMOYO_MAX_MKDEV_OPERATION] = {\n\t[TOMOYO_TYPE_MKBLOCK] = TOMOYO_MAC_FILE_MKBLOCK,\n\t[TOMOYO_TYPE_MKCHAR]  = TOMOYO_MAC_FILE_MKCHAR,\n};"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "tomoyo_supervisor",
          "args": [
            "r",
            "\"file %s %s 0%o %u %u\\n\"",
            "tomoyo_mac_keywords\n\t\t\t\t [tomoyo_pnnn2mac[r->param.mkdev.operation]]",
            "r->param.mkdev.filename->name",
            "r->param.mkdev.mode",
            "r->param.mkdev.major",
            "r->param.mkdev.minor"
          ],
          "line": 197
        },
        "resolved": true,
        "details": {
          "function_name": "tomoyo_supervisor",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/common.c",
          "lines": "1996-2088",
          "snippet": "int tomoyo_supervisor(struct tomoyo_request_info *r, const char *fmt, ...)\n{\n\tva_list args;\n\tint error;\n\tint len;\n\tstatic unsigned int tomoyo_serial;\n\tstruct tomoyo_query entry = { };\n\tbool quota_exceeded = false;\n\tva_start(args, fmt);\n\tlen = vsnprintf((char *) &len, 1, fmt, args) + 1;\n\tva_end(args);\n\t/* Write /sys/kernel/security/tomoyo/audit. */\n\tva_start(args, fmt);\n\ttomoyo_write_log2(r, len, fmt, args);\n\tva_end(args);\n\t/* Nothing more to do if granted. */\n\tif (r->granted)\n\t\treturn 0;\n\tif (r->mode)\n\t\ttomoyo_update_stat(r->mode);\n\tswitch (r->mode) {\n\tcase TOMOYO_CONFIG_ENFORCING:\n\t\terror = -EPERM;\n\t\tif (atomic_read(&tomoyo_query_observers))\n\t\t\tbreak;\n\t\tgoto out;\n\tcase TOMOYO_CONFIG_LEARNING:\n\t\terror = 0;\n\t\t/* Check max_learning_entry parameter. */\n\t\tif (tomoyo_domain_quota_is_ok(r))\n\t\t\tbreak;\n\t\t/* fall through */\n\tdefault:\n\t\treturn 0;\n\t}\n\t/* Get message. */\n\tva_start(args, fmt);\n\tentry.query = tomoyo_init_log(r, len, fmt, args);\n\tva_end(args);\n\tif (!entry.query)\n\t\tgoto out;\n\tentry.query_len = strlen(entry.query) + 1;\n\tif (!error) {\n\t\ttomoyo_add_entry(r->domain, entry.query);\n\t\tgoto out;\n\t}\n\tlen = tomoyo_round2(entry.query_len);\n\tentry.domain = r->domain;\n\tspin_lock(&tomoyo_query_list_lock);\n\tif (tomoyo_memory_quota[TOMOYO_MEMORY_QUERY] &&\n\t    tomoyo_memory_used[TOMOYO_MEMORY_QUERY] + len\n\t    >= tomoyo_memory_quota[TOMOYO_MEMORY_QUERY]) {\n\t\tquota_exceeded = true;\n\t} else {\n\t\tentry.serial = tomoyo_serial++;\n\t\tentry.retry = r->retry;\n\t\ttomoyo_memory_used[TOMOYO_MEMORY_QUERY] += len;\n\t\tlist_add_tail(&entry.list, &tomoyo_query_list);\n\t}\n\tspin_unlock(&tomoyo_query_list_lock);\n\tif (quota_exceeded)\n\t\tgoto out;\n\t/* Give 10 seconds for supervisor's opinion. */\n\twhile (entry.timer < 10) {\n\t\twake_up_all(&tomoyo_query_wait);\n\t\tif (wait_event_interruptible_timeout\n\t\t    (tomoyo_answer_wait, entry.answer ||\n\t\t     !atomic_read(&tomoyo_query_observers), HZ))\n\t\t\tbreak;\n\t\telse\n\t\t\tentry.timer++;\n\t}\n\tspin_lock(&tomoyo_query_list_lock);\n\tlist_del(&entry.list);\n\ttomoyo_memory_used[TOMOYO_MEMORY_QUERY] -= len;\n\tspin_unlock(&tomoyo_query_list_lock);\n\tswitch (entry.answer) {\n\tcase 3: /* Asked to retry by administrator. */\n\t\terror = TOMOYO_RETRY_REQUEST;\n\t\tr->retry++;\n\t\tbreak;\n\tcase 1:\n\t\t/* Granted by administrator. */\n\t\terror = 0;\n\t\tbreak;\n\tdefault:\n\t\t/* Timed out or rejected by administrator. */\n\t\tbreak;\n\t}\nout:\n\tkfree(entry.query);\n\treturn error;\n}",
          "includes": [
            "#include \"builtin-policy.h\"",
            "#include \"common.h\"",
            "#include <linux/security.h>",
            "#include <linux/slab.h>",
            "#include <linux/uaccess.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static struct tomoyo_domain_info *tomoyo_find_domain_by_qid\n(unsigned int serial);",
            "static DECLARE_WAIT_QUEUE_HEAD(tomoyo_query_wait);",
            "static DECLARE_WAIT_QUEUE_HEAD(tomoyo_answer_wait);",
            "static LIST_HEAD(tomoyo_query_list);",
            "static DEFINE_SPINLOCK(tomoyo_query_list_lock);",
            "static atomic_t tomoyo_query_observers = ATOMIC_INIT(0);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"builtin-policy.h\"\n#include \"common.h\"\n#include <linux/security.h>\n#include <linux/slab.h>\n#include <linux/uaccess.h>\n\nstatic struct tomoyo_domain_info *tomoyo_find_domain_by_qid\n(unsigned int serial);\nstatic DECLARE_WAIT_QUEUE_HEAD(tomoyo_query_wait);\nstatic DECLARE_WAIT_QUEUE_HEAD(tomoyo_answer_wait);\nstatic LIST_HEAD(tomoyo_query_list);\nstatic DEFINE_SPINLOCK(tomoyo_query_list_lock);\nstatic atomic_t tomoyo_query_observers = ATOMIC_INIT(0);\n\nint tomoyo_supervisor(struct tomoyo_request_info *r, const char *fmt, ...)\n{\n\tva_list args;\n\tint error;\n\tint len;\n\tstatic unsigned int tomoyo_serial;\n\tstruct tomoyo_query entry = { };\n\tbool quota_exceeded = false;\n\tva_start(args, fmt);\n\tlen = vsnprintf((char *) &len, 1, fmt, args) + 1;\n\tva_end(args);\n\t/* Write /sys/kernel/security/tomoyo/audit. */\n\tva_start(args, fmt);\n\ttomoyo_write_log2(r, len, fmt, args);\n\tva_end(args);\n\t/* Nothing more to do if granted. */\n\tif (r->granted)\n\t\treturn 0;\n\tif (r->mode)\n\t\ttomoyo_update_stat(r->mode);\n\tswitch (r->mode) {\n\tcase TOMOYO_CONFIG_ENFORCING:\n\t\terror = -EPERM;\n\t\tif (atomic_read(&tomoyo_query_observers))\n\t\t\tbreak;\n\t\tgoto out;\n\tcase TOMOYO_CONFIG_LEARNING:\n\t\terror = 0;\n\t\t/* Check max_learning_entry parameter. */\n\t\tif (tomoyo_domain_quota_is_ok(r))\n\t\t\tbreak;\n\t\t/* fall through */\n\tdefault:\n\t\treturn 0;\n\t}\n\t/* Get message. */\n\tva_start(args, fmt);\n\tentry.query = tomoyo_init_log(r, len, fmt, args);\n\tva_end(args);\n\tif (!entry.query)\n\t\tgoto out;\n\tentry.query_len = strlen(entry.query) + 1;\n\tif (!error) {\n\t\ttomoyo_add_entry(r->domain, entry.query);\n\t\tgoto out;\n\t}\n\tlen = tomoyo_round2(entry.query_len);\n\tentry.domain = r->domain;\n\tspin_lock(&tomoyo_query_list_lock);\n\tif (tomoyo_memory_quota[TOMOYO_MEMORY_QUERY] &&\n\t    tomoyo_memory_used[TOMOYO_MEMORY_QUERY] + len\n\t    >= tomoyo_memory_quota[TOMOYO_MEMORY_QUERY]) {\n\t\tquota_exceeded = true;\n\t} else {\n\t\tentry.serial = tomoyo_serial++;\n\t\tentry.retry = r->retry;\n\t\ttomoyo_memory_used[TOMOYO_MEMORY_QUERY] += len;\n\t\tlist_add_tail(&entry.list, &tomoyo_query_list);\n\t}\n\tspin_unlock(&tomoyo_query_list_lock);\n\tif (quota_exceeded)\n\t\tgoto out;\n\t/* Give 10 seconds for supervisor's opinion. */\n\twhile (entry.timer < 10) {\n\t\twake_up_all(&tomoyo_query_wait);\n\t\tif (wait_event_interruptible_timeout\n\t\t    (tomoyo_answer_wait, entry.answer ||\n\t\t     !atomic_read(&tomoyo_query_observers), HZ))\n\t\t\tbreak;\n\t\telse\n\t\t\tentry.timer++;\n\t}\n\tspin_lock(&tomoyo_query_list_lock);\n\tlist_del(&entry.list);\n\ttomoyo_memory_used[TOMOYO_MEMORY_QUERY] -= len;\n\tspin_unlock(&tomoyo_query_list_lock);\n\tswitch (entry.answer) {\n\tcase 3: /* Asked to retry by administrator. */\n\t\terror = TOMOYO_RETRY_REQUEST;\n\t\tr->retry++;\n\t\tbreak;\n\tcase 1:\n\t\t/* Granted by administrator. */\n\t\terror = 0;\n\t\tbreak;\n\tdefault:\n\t\t/* Timed out or rejected by administrator. */\n\t\tbreak;\n\t}\nout:\n\tkfree(entry.query);\n\treturn error;\n}"
        }
      }
    ],
    "contextual_snippet": "#include <linux/slab.h>\n#include \"common.h\"\n\nconst u8 tomoyo_pnnn2mac[TOMOYO_MAX_MKDEV_OPERATION] = {\n\t[TOMOYO_TYPE_MKBLOCK] = TOMOYO_MAC_FILE_MKBLOCK,\n\t[TOMOYO_TYPE_MKCHAR]  = TOMOYO_MAC_FILE_MKCHAR,\n};\n\nstatic int tomoyo_audit_mkdev_log(struct tomoyo_request_info *r)\n{\n\treturn tomoyo_supervisor(r, \"file %s %s 0%o %u %u\\n\",\n\t\t\t\t tomoyo_mac_keywords\n\t\t\t\t [tomoyo_pnnn2mac[r->param.mkdev.operation]],\n\t\t\t\t r->param.mkdev.filename->name,\n\t\t\t\t r->param.mkdev.mode, r->param.mkdev.major,\n\t\t\t\t r->param.mkdev.minor);\n}"
  },
  {
    "function_name": "tomoyo_audit_path2_log",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/file.c",
    "lines": "180-186",
    "snippet": "static int tomoyo_audit_path2_log(struct tomoyo_request_info *r)\n{\n\treturn tomoyo_supervisor(r, \"file %s %s %s\\n\", tomoyo_mac_keywords\n\t\t\t\t [tomoyo_pp2mac[r->param.path2.operation]],\n\t\t\t\t r->param.path2.filename1->name,\n\t\t\t\t r->param.path2.filename2->name);\n}",
    "includes": [
      "#include <linux/slab.h>",
      "#include \"common.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "const u8 tomoyo_pp2mac[TOMOYO_MAX_PATH2_OPERATION] = {\n\t[TOMOYO_TYPE_LINK]       = TOMOYO_MAC_FILE_LINK,\n\t[TOMOYO_TYPE_RENAME]     = TOMOYO_MAC_FILE_RENAME,\n\t[TOMOYO_TYPE_PIVOT_ROOT] = TOMOYO_MAC_FILE_PIVOT_ROOT,\n};"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "tomoyo_supervisor",
          "args": [
            "r",
            "\"file %s %s %s\\n\"",
            "tomoyo_mac_keywords\n\t\t\t\t [tomoyo_pp2mac[r->param.path2.operation]]",
            "r->param.path2.filename1->name",
            "r->param.path2.filename2->name"
          ],
          "line": 182
        },
        "resolved": true,
        "details": {
          "function_name": "tomoyo_supervisor",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/common.c",
          "lines": "1996-2088",
          "snippet": "int tomoyo_supervisor(struct tomoyo_request_info *r, const char *fmt, ...)\n{\n\tva_list args;\n\tint error;\n\tint len;\n\tstatic unsigned int tomoyo_serial;\n\tstruct tomoyo_query entry = { };\n\tbool quota_exceeded = false;\n\tva_start(args, fmt);\n\tlen = vsnprintf((char *) &len, 1, fmt, args) + 1;\n\tva_end(args);\n\t/* Write /sys/kernel/security/tomoyo/audit. */\n\tva_start(args, fmt);\n\ttomoyo_write_log2(r, len, fmt, args);\n\tva_end(args);\n\t/* Nothing more to do if granted. */\n\tif (r->granted)\n\t\treturn 0;\n\tif (r->mode)\n\t\ttomoyo_update_stat(r->mode);\n\tswitch (r->mode) {\n\tcase TOMOYO_CONFIG_ENFORCING:\n\t\terror = -EPERM;\n\t\tif (atomic_read(&tomoyo_query_observers))\n\t\t\tbreak;\n\t\tgoto out;\n\tcase TOMOYO_CONFIG_LEARNING:\n\t\terror = 0;\n\t\t/* Check max_learning_entry parameter. */\n\t\tif (tomoyo_domain_quota_is_ok(r))\n\t\t\tbreak;\n\t\t/* fall through */\n\tdefault:\n\t\treturn 0;\n\t}\n\t/* Get message. */\n\tva_start(args, fmt);\n\tentry.query = tomoyo_init_log(r, len, fmt, args);\n\tva_end(args);\n\tif (!entry.query)\n\t\tgoto out;\n\tentry.query_len = strlen(entry.query) + 1;\n\tif (!error) {\n\t\ttomoyo_add_entry(r->domain, entry.query);\n\t\tgoto out;\n\t}\n\tlen = tomoyo_round2(entry.query_len);\n\tentry.domain = r->domain;\n\tspin_lock(&tomoyo_query_list_lock);\n\tif (tomoyo_memory_quota[TOMOYO_MEMORY_QUERY] &&\n\t    tomoyo_memory_used[TOMOYO_MEMORY_QUERY] + len\n\t    >= tomoyo_memory_quota[TOMOYO_MEMORY_QUERY]) {\n\t\tquota_exceeded = true;\n\t} else {\n\t\tentry.serial = tomoyo_serial++;\n\t\tentry.retry = r->retry;\n\t\ttomoyo_memory_used[TOMOYO_MEMORY_QUERY] += len;\n\t\tlist_add_tail(&entry.list, &tomoyo_query_list);\n\t}\n\tspin_unlock(&tomoyo_query_list_lock);\n\tif (quota_exceeded)\n\t\tgoto out;\n\t/* Give 10 seconds for supervisor's opinion. */\n\twhile (entry.timer < 10) {\n\t\twake_up_all(&tomoyo_query_wait);\n\t\tif (wait_event_interruptible_timeout\n\t\t    (tomoyo_answer_wait, entry.answer ||\n\t\t     !atomic_read(&tomoyo_query_observers), HZ))\n\t\t\tbreak;\n\t\telse\n\t\t\tentry.timer++;\n\t}\n\tspin_lock(&tomoyo_query_list_lock);\n\tlist_del(&entry.list);\n\ttomoyo_memory_used[TOMOYO_MEMORY_QUERY] -= len;\n\tspin_unlock(&tomoyo_query_list_lock);\n\tswitch (entry.answer) {\n\tcase 3: /* Asked to retry by administrator. */\n\t\terror = TOMOYO_RETRY_REQUEST;\n\t\tr->retry++;\n\t\tbreak;\n\tcase 1:\n\t\t/* Granted by administrator. */\n\t\terror = 0;\n\t\tbreak;\n\tdefault:\n\t\t/* Timed out or rejected by administrator. */\n\t\tbreak;\n\t}\nout:\n\tkfree(entry.query);\n\treturn error;\n}",
          "includes": [
            "#include \"builtin-policy.h\"",
            "#include \"common.h\"",
            "#include <linux/security.h>",
            "#include <linux/slab.h>",
            "#include <linux/uaccess.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static struct tomoyo_domain_info *tomoyo_find_domain_by_qid\n(unsigned int serial);",
            "static DECLARE_WAIT_QUEUE_HEAD(tomoyo_query_wait);",
            "static DECLARE_WAIT_QUEUE_HEAD(tomoyo_answer_wait);",
            "static LIST_HEAD(tomoyo_query_list);",
            "static DEFINE_SPINLOCK(tomoyo_query_list_lock);",
            "static atomic_t tomoyo_query_observers = ATOMIC_INIT(0);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"builtin-policy.h\"\n#include \"common.h\"\n#include <linux/security.h>\n#include <linux/slab.h>\n#include <linux/uaccess.h>\n\nstatic struct tomoyo_domain_info *tomoyo_find_domain_by_qid\n(unsigned int serial);\nstatic DECLARE_WAIT_QUEUE_HEAD(tomoyo_query_wait);\nstatic DECLARE_WAIT_QUEUE_HEAD(tomoyo_answer_wait);\nstatic LIST_HEAD(tomoyo_query_list);\nstatic DEFINE_SPINLOCK(tomoyo_query_list_lock);\nstatic atomic_t tomoyo_query_observers = ATOMIC_INIT(0);\n\nint tomoyo_supervisor(struct tomoyo_request_info *r, const char *fmt, ...)\n{\n\tva_list args;\n\tint error;\n\tint len;\n\tstatic unsigned int tomoyo_serial;\n\tstruct tomoyo_query entry = { };\n\tbool quota_exceeded = false;\n\tva_start(args, fmt);\n\tlen = vsnprintf((char *) &len, 1, fmt, args) + 1;\n\tva_end(args);\n\t/* Write /sys/kernel/security/tomoyo/audit. */\n\tva_start(args, fmt);\n\ttomoyo_write_log2(r, len, fmt, args);\n\tva_end(args);\n\t/* Nothing more to do if granted. */\n\tif (r->granted)\n\t\treturn 0;\n\tif (r->mode)\n\t\ttomoyo_update_stat(r->mode);\n\tswitch (r->mode) {\n\tcase TOMOYO_CONFIG_ENFORCING:\n\t\terror = -EPERM;\n\t\tif (atomic_read(&tomoyo_query_observers))\n\t\t\tbreak;\n\t\tgoto out;\n\tcase TOMOYO_CONFIG_LEARNING:\n\t\terror = 0;\n\t\t/* Check max_learning_entry parameter. */\n\t\tif (tomoyo_domain_quota_is_ok(r))\n\t\t\tbreak;\n\t\t/* fall through */\n\tdefault:\n\t\treturn 0;\n\t}\n\t/* Get message. */\n\tva_start(args, fmt);\n\tentry.query = tomoyo_init_log(r, len, fmt, args);\n\tva_end(args);\n\tif (!entry.query)\n\t\tgoto out;\n\tentry.query_len = strlen(entry.query) + 1;\n\tif (!error) {\n\t\ttomoyo_add_entry(r->domain, entry.query);\n\t\tgoto out;\n\t}\n\tlen = tomoyo_round2(entry.query_len);\n\tentry.domain = r->domain;\n\tspin_lock(&tomoyo_query_list_lock);\n\tif (tomoyo_memory_quota[TOMOYO_MEMORY_QUERY] &&\n\t    tomoyo_memory_used[TOMOYO_MEMORY_QUERY] + len\n\t    >= tomoyo_memory_quota[TOMOYO_MEMORY_QUERY]) {\n\t\tquota_exceeded = true;\n\t} else {\n\t\tentry.serial = tomoyo_serial++;\n\t\tentry.retry = r->retry;\n\t\ttomoyo_memory_used[TOMOYO_MEMORY_QUERY] += len;\n\t\tlist_add_tail(&entry.list, &tomoyo_query_list);\n\t}\n\tspin_unlock(&tomoyo_query_list_lock);\n\tif (quota_exceeded)\n\t\tgoto out;\n\t/* Give 10 seconds for supervisor's opinion. */\n\twhile (entry.timer < 10) {\n\t\twake_up_all(&tomoyo_query_wait);\n\t\tif (wait_event_interruptible_timeout\n\t\t    (tomoyo_answer_wait, entry.answer ||\n\t\t     !atomic_read(&tomoyo_query_observers), HZ))\n\t\t\tbreak;\n\t\telse\n\t\t\tentry.timer++;\n\t}\n\tspin_lock(&tomoyo_query_list_lock);\n\tlist_del(&entry.list);\n\ttomoyo_memory_used[TOMOYO_MEMORY_QUERY] -= len;\n\tspin_unlock(&tomoyo_query_list_lock);\n\tswitch (entry.answer) {\n\tcase 3: /* Asked to retry by administrator. */\n\t\terror = TOMOYO_RETRY_REQUEST;\n\t\tr->retry++;\n\t\tbreak;\n\tcase 1:\n\t\t/* Granted by administrator. */\n\t\terror = 0;\n\t\tbreak;\n\tdefault:\n\t\t/* Timed out or rejected by administrator. */\n\t\tbreak;\n\t}\nout:\n\tkfree(entry.query);\n\treturn error;\n}"
        }
      }
    ],
    "contextual_snippet": "#include <linux/slab.h>\n#include \"common.h\"\n\nconst u8 tomoyo_pp2mac[TOMOYO_MAX_PATH2_OPERATION] = {\n\t[TOMOYO_TYPE_LINK]       = TOMOYO_MAC_FILE_LINK,\n\t[TOMOYO_TYPE_RENAME]     = TOMOYO_MAC_FILE_RENAME,\n\t[TOMOYO_TYPE_PIVOT_ROOT] = TOMOYO_MAC_FILE_PIVOT_ROOT,\n};\n\nstatic int tomoyo_audit_path2_log(struct tomoyo_request_info *r)\n{\n\treturn tomoyo_supervisor(r, \"file %s %s %s\\n\", tomoyo_mac_keywords\n\t\t\t\t [tomoyo_pp2mac[r->param.path2.operation]],\n\t\t\t\t r->param.path2.filename1->name,\n\t\t\t\t r->param.path2.filename2->name);\n}"
  },
  {
    "function_name": "tomoyo_audit_path_log",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/file.c",
    "lines": "166-171",
    "snippet": "static int tomoyo_audit_path_log(struct tomoyo_request_info *r)\n{\n\treturn tomoyo_supervisor(r, \"file %s %s\\n\", tomoyo_path_keyword\n\t\t\t\t [r->param.path.operation],\n\t\t\t\t r->param.path.filename->name);\n}",
    "includes": [
      "#include <linux/slab.h>",
      "#include \"common.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "tomoyo_supervisor",
          "args": [
            "r",
            "\"file %s %s\\n\"",
            "tomoyo_path_keyword\n\t\t\t\t [r->param.path.operation]",
            "r->param.path.filename->name"
          ],
          "line": 168
        },
        "resolved": true,
        "details": {
          "function_name": "tomoyo_supervisor",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/common.c",
          "lines": "1996-2088",
          "snippet": "int tomoyo_supervisor(struct tomoyo_request_info *r, const char *fmt, ...)\n{\n\tva_list args;\n\tint error;\n\tint len;\n\tstatic unsigned int tomoyo_serial;\n\tstruct tomoyo_query entry = { };\n\tbool quota_exceeded = false;\n\tva_start(args, fmt);\n\tlen = vsnprintf((char *) &len, 1, fmt, args) + 1;\n\tva_end(args);\n\t/* Write /sys/kernel/security/tomoyo/audit. */\n\tva_start(args, fmt);\n\ttomoyo_write_log2(r, len, fmt, args);\n\tva_end(args);\n\t/* Nothing more to do if granted. */\n\tif (r->granted)\n\t\treturn 0;\n\tif (r->mode)\n\t\ttomoyo_update_stat(r->mode);\n\tswitch (r->mode) {\n\tcase TOMOYO_CONFIG_ENFORCING:\n\t\terror = -EPERM;\n\t\tif (atomic_read(&tomoyo_query_observers))\n\t\t\tbreak;\n\t\tgoto out;\n\tcase TOMOYO_CONFIG_LEARNING:\n\t\terror = 0;\n\t\t/* Check max_learning_entry parameter. */\n\t\tif (tomoyo_domain_quota_is_ok(r))\n\t\t\tbreak;\n\t\t/* fall through */\n\tdefault:\n\t\treturn 0;\n\t}\n\t/* Get message. */\n\tva_start(args, fmt);\n\tentry.query = tomoyo_init_log(r, len, fmt, args);\n\tva_end(args);\n\tif (!entry.query)\n\t\tgoto out;\n\tentry.query_len = strlen(entry.query) + 1;\n\tif (!error) {\n\t\ttomoyo_add_entry(r->domain, entry.query);\n\t\tgoto out;\n\t}\n\tlen = tomoyo_round2(entry.query_len);\n\tentry.domain = r->domain;\n\tspin_lock(&tomoyo_query_list_lock);\n\tif (tomoyo_memory_quota[TOMOYO_MEMORY_QUERY] &&\n\t    tomoyo_memory_used[TOMOYO_MEMORY_QUERY] + len\n\t    >= tomoyo_memory_quota[TOMOYO_MEMORY_QUERY]) {\n\t\tquota_exceeded = true;\n\t} else {\n\t\tentry.serial = tomoyo_serial++;\n\t\tentry.retry = r->retry;\n\t\ttomoyo_memory_used[TOMOYO_MEMORY_QUERY] += len;\n\t\tlist_add_tail(&entry.list, &tomoyo_query_list);\n\t}\n\tspin_unlock(&tomoyo_query_list_lock);\n\tif (quota_exceeded)\n\t\tgoto out;\n\t/* Give 10 seconds for supervisor's opinion. */\n\twhile (entry.timer < 10) {\n\t\twake_up_all(&tomoyo_query_wait);\n\t\tif (wait_event_interruptible_timeout\n\t\t    (tomoyo_answer_wait, entry.answer ||\n\t\t     !atomic_read(&tomoyo_query_observers), HZ))\n\t\t\tbreak;\n\t\telse\n\t\t\tentry.timer++;\n\t}\n\tspin_lock(&tomoyo_query_list_lock);\n\tlist_del(&entry.list);\n\ttomoyo_memory_used[TOMOYO_MEMORY_QUERY] -= len;\n\tspin_unlock(&tomoyo_query_list_lock);\n\tswitch (entry.answer) {\n\tcase 3: /* Asked to retry by administrator. */\n\t\terror = TOMOYO_RETRY_REQUEST;\n\t\tr->retry++;\n\t\tbreak;\n\tcase 1:\n\t\t/* Granted by administrator. */\n\t\terror = 0;\n\t\tbreak;\n\tdefault:\n\t\t/* Timed out or rejected by administrator. */\n\t\tbreak;\n\t}\nout:\n\tkfree(entry.query);\n\treturn error;\n}",
          "includes": [
            "#include \"builtin-policy.h\"",
            "#include \"common.h\"",
            "#include <linux/security.h>",
            "#include <linux/slab.h>",
            "#include <linux/uaccess.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static struct tomoyo_domain_info *tomoyo_find_domain_by_qid\n(unsigned int serial);",
            "static DECLARE_WAIT_QUEUE_HEAD(tomoyo_query_wait);",
            "static DECLARE_WAIT_QUEUE_HEAD(tomoyo_answer_wait);",
            "static LIST_HEAD(tomoyo_query_list);",
            "static DEFINE_SPINLOCK(tomoyo_query_list_lock);",
            "static atomic_t tomoyo_query_observers = ATOMIC_INIT(0);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"builtin-policy.h\"\n#include \"common.h\"\n#include <linux/security.h>\n#include <linux/slab.h>\n#include <linux/uaccess.h>\n\nstatic struct tomoyo_domain_info *tomoyo_find_domain_by_qid\n(unsigned int serial);\nstatic DECLARE_WAIT_QUEUE_HEAD(tomoyo_query_wait);\nstatic DECLARE_WAIT_QUEUE_HEAD(tomoyo_answer_wait);\nstatic LIST_HEAD(tomoyo_query_list);\nstatic DEFINE_SPINLOCK(tomoyo_query_list_lock);\nstatic atomic_t tomoyo_query_observers = ATOMIC_INIT(0);\n\nint tomoyo_supervisor(struct tomoyo_request_info *r, const char *fmt, ...)\n{\n\tva_list args;\n\tint error;\n\tint len;\n\tstatic unsigned int tomoyo_serial;\n\tstruct tomoyo_query entry = { };\n\tbool quota_exceeded = false;\n\tva_start(args, fmt);\n\tlen = vsnprintf((char *) &len, 1, fmt, args) + 1;\n\tva_end(args);\n\t/* Write /sys/kernel/security/tomoyo/audit. */\n\tva_start(args, fmt);\n\ttomoyo_write_log2(r, len, fmt, args);\n\tva_end(args);\n\t/* Nothing more to do if granted. */\n\tif (r->granted)\n\t\treturn 0;\n\tif (r->mode)\n\t\ttomoyo_update_stat(r->mode);\n\tswitch (r->mode) {\n\tcase TOMOYO_CONFIG_ENFORCING:\n\t\terror = -EPERM;\n\t\tif (atomic_read(&tomoyo_query_observers))\n\t\t\tbreak;\n\t\tgoto out;\n\tcase TOMOYO_CONFIG_LEARNING:\n\t\terror = 0;\n\t\t/* Check max_learning_entry parameter. */\n\t\tif (tomoyo_domain_quota_is_ok(r))\n\t\t\tbreak;\n\t\t/* fall through */\n\tdefault:\n\t\treturn 0;\n\t}\n\t/* Get message. */\n\tva_start(args, fmt);\n\tentry.query = tomoyo_init_log(r, len, fmt, args);\n\tva_end(args);\n\tif (!entry.query)\n\t\tgoto out;\n\tentry.query_len = strlen(entry.query) + 1;\n\tif (!error) {\n\t\ttomoyo_add_entry(r->domain, entry.query);\n\t\tgoto out;\n\t}\n\tlen = tomoyo_round2(entry.query_len);\n\tentry.domain = r->domain;\n\tspin_lock(&tomoyo_query_list_lock);\n\tif (tomoyo_memory_quota[TOMOYO_MEMORY_QUERY] &&\n\t    tomoyo_memory_used[TOMOYO_MEMORY_QUERY] + len\n\t    >= tomoyo_memory_quota[TOMOYO_MEMORY_QUERY]) {\n\t\tquota_exceeded = true;\n\t} else {\n\t\tentry.serial = tomoyo_serial++;\n\t\tentry.retry = r->retry;\n\t\ttomoyo_memory_used[TOMOYO_MEMORY_QUERY] += len;\n\t\tlist_add_tail(&entry.list, &tomoyo_query_list);\n\t}\n\tspin_unlock(&tomoyo_query_list_lock);\n\tif (quota_exceeded)\n\t\tgoto out;\n\t/* Give 10 seconds for supervisor's opinion. */\n\twhile (entry.timer < 10) {\n\t\twake_up_all(&tomoyo_query_wait);\n\t\tif (wait_event_interruptible_timeout\n\t\t    (tomoyo_answer_wait, entry.answer ||\n\t\t     !atomic_read(&tomoyo_query_observers), HZ))\n\t\t\tbreak;\n\t\telse\n\t\t\tentry.timer++;\n\t}\n\tspin_lock(&tomoyo_query_list_lock);\n\tlist_del(&entry.list);\n\ttomoyo_memory_used[TOMOYO_MEMORY_QUERY] -= len;\n\tspin_unlock(&tomoyo_query_list_lock);\n\tswitch (entry.answer) {\n\tcase 3: /* Asked to retry by administrator. */\n\t\terror = TOMOYO_RETRY_REQUEST;\n\t\tr->retry++;\n\t\tbreak;\n\tcase 1:\n\t\t/* Granted by administrator. */\n\t\terror = 0;\n\t\tbreak;\n\tdefault:\n\t\t/* Timed out or rejected by administrator. */\n\t\tbreak;\n\t}\nout:\n\tkfree(entry.query);\n\treturn error;\n}"
        }
      }
    ],
    "contextual_snippet": "#include <linux/slab.h>\n#include \"common.h\"\n\nstatic int tomoyo_audit_path_log(struct tomoyo_request_info *r)\n{\n\treturn tomoyo_supervisor(r, \"file %s %s\\n\", tomoyo_path_keyword\n\t\t\t\t [r->param.path.operation],\n\t\t\t\t r->param.path.filename->name);\n}"
  },
  {
    "function_name": "tomoyo_get_realpath",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/file.c",
    "lines": "149-157",
    "snippet": "static bool tomoyo_get_realpath(struct tomoyo_path_info *buf, const struct path *path)\n{\n\tbuf->name = tomoyo_realpath_from_path(path);\n\tif (buf->name) {\n\t\ttomoyo_fill_path_info(buf);\n\t\treturn true;\n\t}\n\treturn false;\n}",
    "includes": [
      "#include <linux/slab.h>",
      "#include \"common.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "tomoyo_fill_path_info",
          "args": [
            "buf"
          ],
          "line": 153
        },
        "resolved": true,
        "details": {
          "function_name": "tomoyo_fill_path_info",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/util.c",
          "lines": "643-652",
          "snippet": "void tomoyo_fill_path_info(struct tomoyo_path_info *ptr)\n{\n\tconst char *name = ptr->name;\n\tconst int len = strlen(name);\n\n\tptr->const_len = tomoyo_const_part_length(name);\n\tptr->is_dir = len && (name[len - 1] == '/');\n\tptr->is_patterned = (ptr->const_len < len);\n\tptr->hash = full_name_hash(NULL, name, len);\n}",
          "includes": [
            "#include \"common.h\"",
            "#include <linux/rculist.h>",
            "#include <linux/slab.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common.h\"\n#include <linux/rculist.h>\n#include <linux/slab.h>\n\nvoid tomoyo_fill_path_info(struct tomoyo_path_info *ptr)\n{\n\tconst char *name = ptr->name;\n\tconst int len = strlen(name);\n\n\tptr->const_len = tomoyo_const_part_length(name);\n\tptr->is_dir = len && (name[len - 1] == '/');\n\tptr->is_patterned = (ptr->const_len < len);\n\tptr->hash = full_name_hash(NULL, name, len);\n}"
        }
      },
      {
        "call_info": {
          "callee": "tomoyo_realpath_from_path",
          "args": [
            "path"
          ],
          "line": 151
        },
        "resolved": true,
        "details": {
          "function_name": "tomoyo_realpath_from_path",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/realpath.c",
          "lines": "251-311",
          "snippet": "char *tomoyo_realpath_from_path(const struct path *path)\n{\n\tchar *buf = NULL;\n\tchar *name = NULL;\n\tunsigned int buf_len = PAGE_SIZE / 2;\n\tstruct dentry *dentry = path->dentry;\n\tstruct super_block *sb;\n\tif (!dentry)\n\t\treturn NULL;\n\tsb = dentry->d_sb;\n\twhile (1) {\n\t\tchar *pos;\n\t\tstruct inode *inode;\n\t\tbuf_len <<= 1;\n\t\tkfree(buf);\n\t\tbuf = kmalloc(buf_len, GFP_NOFS);\n\t\tif (!buf)\n\t\t\tbreak;\n\t\t/* To make sure that pos is '\\0' terminated. */\n\t\tbuf[buf_len - 1] = '\\0';\n\t\t/* Get better name for socket. */\n\t\tif (sb->s_magic == SOCKFS_MAGIC) {\n\t\t\tpos = tomoyo_get_socket_name(path, buf, buf_len - 1);\n\t\t\tgoto encode;\n\t\t}\n\t\t/* For \"pipe:[\\$]\". */\n\t\tif (dentry->d_op && dentry->d_op->d_dname) {\n\t\t\tpos = dentry->d_op->d_dname(dentry, buf, buf_len - 1);\n\t\t\tgoto encode;\n\t\t}\n\t\tinode = d_backing_inode(sb->s_root);\n\t\t/*\n\t\t * Get local name for filesystems without rename() operation\n\t\t * or dentry without vfsmount.\n\t\t */\n\t\tif (!path->mnt ||\n\t\t    (!inode->i_op->rename))\n\t\t\tpos = tomoyo_get_local_path(path->dentry, buf,\n\t\t\t\t\t\t    buf_len - 1);\n\t\t/* Get absolute name for the rest. */\n\t\telse {\n\t\t\tpos = tomoyo_get_absolute_path(path, buf, buf_len - 1);\n\t\t\t/*\n\t\t\t * Fall back to local name if absolute name is not\n\t\t\t * available.\n\t\t\t */\n\t\t\tif (pos == ERR_PTR(-EINVAL))\n\t\t\t\tpos = tomoyo_get_local_path(path->dentry, buf,\n\t\t\t\t\t\t\t    buf_len - 1);\n\t\t}\nencode:\n\t\tif (IS_ERR(pos))\n\t\t\tcontinue;\n\t\tname = tomoyo_encode(pos);\n\t\tbreak;\n\t}\n\tkfree(buf);\n\tif (!name)\n\t\ttomoyo_warn_oom(__func__);\n\treturn name;\n}",
          "includes": [
            "#include <linux/magic.h>",
            "#include \"common.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/magic.h>\n#include \"common.h\"\n\nchar *tomoyo_realpath_from_path(const struct path *path)\n{\n\tchar *buf = NULL;\n\tchar *name = NULL;\n\tunsigned int buf_len = PAGE_SIZE / 2;\n\tstruct dentry *dentry = path->dentry;\n\tstruct super_block *sb;\n\tif (!dentry)\n\t\treturn NULL;\n\tsb = dentry->d_sb;\n\twhile (1) {\n\t\tchar *pos;\n\t\tstruct inode *inode;\n\t\tbuf_len <<= 1;\n\t\tkfree(buf);\n\t\tbuf = kmalloc(buf_len, GFP_NOFS);\n\t\tif (!buf)\n\t\t\tbreak;\n\t\t/* To make sure that pos is '\\0' terminated. */\n\t\tbuf[buf_len - 1] = '\\0';\n\t\t/* Get better name for socket. */\n\t\tif (sb->s_magic == SOCKFS_MAGIC) {\n\t\t\tpos = tomoyo_get_socket_name(path, buf, buf_len - 1);\n\t\t\tgoto encode;\n\t\t}\n\t\t/* For \"pipe:[\\$]\". */\n\t\tif (dentry->d_op && dentry->d_op->d_dname) {\n\t\t\tpos = dentry->d_op->d_dname(dentry, buf, buf_len - 1);\n\t\t\tgoto encode;\n\t\t}\n\t\tinode = d_backing_inode(sb->s_root);\n\t\t/*\n\t\t * Get local name for filesystems without rename() operation\n\t\t * or dentry without vfsmount.\n\t\t */\n\t\tif (!path->mnt ||\n\t\t    (!inode->i_op->rename))\n\t\t\tpos = tomoyo_get_local_path(path->dentry, buf,\n\t\t\t\t\t\t    buf_len - 1);\n\t\t/* Get absolute name for the rest. */\n\t\telse {\n\t\t\tpos = tomoyo_get_absolute_path(path, buf, buf_len - 1);\n\t\t\t/*\n\t\t\t * Fall back to local name if absolute name is not\n\t\t\t * available.\n\t\t\t */\n\t\t\tif (pos == ERR_PTR(-EINVAL))\n\t\t\t\tpos = tomoyo_get_local_path(path->dentry, buf,\n\t\t\t\t\t\t\t    buf_len - 1);\n\t\t}\nencode:\n\t\tif (IS_ERR(pos))\n\t\t\tcontinue;\n\t\tname = tomoyo_encode(pos);\n\t\tbreak;\n\t}\n\tkfree(buf);\n\tif (!name)\n\t\ttomoyo_warn_oom(__func__);\n\treturn name;\n}"
        }
      }
    ],
    "contextual_snippet": "#include <linux/slab.h>\n#include \"common.h\"\n\nstatic bool tomoyo_get_realpath(struct tomoyo_path_info *buf, const struct path *path)\n{\n\tbuf->name = tomoyo_realpath_from_path(path);\n\tif (buf->name) {\n\t\ttomoyo_fill_path_info(buf);\n\t\treturn true;\n\t}\n\treturn false;\n}"
  },
  {
    "function_name": "tomoyo_add_slash",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/file.c",
    "lines": "130-139",
    "snippet": "static void tomoyo_add_slash(struct tomoyo_path_info *buf)\n{\n\tif (buf->is_dir)\n\t\treturn;\n\t/*\n\t * This is OK because tomoyo_encode() reserves space for appending \"/\".\n\t */\n\tstrcat((char *) buf->name, \"/\");\n\ttomoyo_fill_path_info(buf);\n}",
    "includes": [
      "#include <linux/slab.h>",
      "#include \"common.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "tomoyo_fill_path_info",
          "args": [
            "buf"
          ],
          "line": 138
        },
        "resolved": true,
        "details": {
          "function_name": "tomoyo_fill_path_info",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/util.c",
          "lines": "643-652",
          "snippet": "void tomoyo_fill_path_info(struct tomoyo_path_info *ptr)\n{\n\tconst char *name = ptr->name;\n\tconst int len = strlen(name);\n\n\tptr->const_len = tomoyo_const_part_length(name);\n\tptr->is_dir = len && (name[len - 1] == '/');\n\tptr->is_patterned = (ptr->const_len < len);\n\tptr->hash = full_name_hash(NULL, name, len);\n}",
          "includes": [
            "#include \"common.h\"",
            "#include <linux/rculist.h>",
            "#include <linux/slab.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common.h\"\n#include <linux/rculist.h>\n#include <linux/slab.h>\n\nvoid tomoyo_fill_path_info(struct tomoyo_path_info *ptr)\n{\n\tconst char *name = ptr->name;\n\tconst int len = strlen(name);\n\n\tptr->const_len = tomoyo_const_part_length(name);\n\tptr->is_dir = len && (name[len - 1] == '/');\n\tptr->is_patterned = (ptr->const_len < len);\n\tptr->hash = full_name_hash(NULL, name, len);\n}"
        }
      },
      {
        "call_info": {
          "callee": "strcat",
          "args": [
            "(char *) buf->name",
            "\"/\""
          ],
          "line": 137
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <linux/slab.h>\n#include \"common.h\"\n\nstatic void tomoyo_add_slash(struct tomoyo_path_info *buf)\n{\n\tif (buf->is_dir)\n\t\treturn;\n\t/*\n\t * This is OK because tomoyo_encode() reserves space for appending \"/\".\n\t */\n\tstrcat((char *) buf->name, \"/\");\n\ttomoyo_fill_path_info(buf);\n}"
  },
  {
    "function_name": "tomoyo_compare_number_union",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/file.c",
    "lines": "112-118",
    "snippet": "bool tomoyo_compare_number_union(const unsigned long value,\n\t\t\t\t const struct tomoyo_number_union *ptr)\n{\n\tif (ptr->group)\n\t\treturn tomoyo_number_matches_group(value, value, ptr->group);\n\treturn value >= ptr->values[0] && value <= ptr->values[1];\n}",
    "includes": [
      "#include <linux/slab.h>",
      "#include \"common.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "tomoyo_number_matches_group",
          "args": [
            "value",
            "value",
            "ptr->group"
          ],
          "line": 116
        },
        "resolved": true,
        "details": {
          "function_name": "tomoyo_number_matches_group",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/group.c",
          "lines": "153-169",
          "snippet": "bool tomoyo_number_matches_group(const unsigned long min,\n\t\t\t\t const unsigned long max,\n\t\t\t\t const struct tomoyo_group *group)\n{\n\tstruct tomoyo_number_group *member;\n\tbool matched = false;\n\tlist_for_each_entry_rcu(member, &group->member_list, head.list) {\n\t\tif (member->head.is_deleted)\n\t\t\tcontinue;\n\t\tif (min > member->number.values[1] ||\n\t\t    max < member->number.values[0])\n\t\t\tcontinue;\n\t\tmatched = true;\n\t\tbreak;\n\t}\n\treturn matched;\n}",
          "includes": [
            "#include \"common.h\"",
            "#include <linux/rculist.h>",
            "#include <linux/slab.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common.h\"\n#include <linux/rculist.h>\n#include <linux/slab.h>\n\nbool tomoyo_number_matches_group(const unsigned long min,\n\t\t\t\t const unsigned long max,\n\t\t\t\t const struct tomoyo_group *group)\n{\n\tstruct tomoyo_number_group *member;\n\tbool matched = false;\n\tlist_for_each_entry_rcu(member, &group->member_list, head.list) {\n\t\tif (member->head.is_deleted)\n\t\t\tcontinue;\n\t\tif (min > member->number.values[1] ||\n\t\t    max < member->number.values[0])\n\t\t\tcontinue;\n\t\tmatched = true;\n\t\tbreak;\n\t}\n\treturn matched;\n}"
        }
      }
    ],
    "contextual_snippet": "#include <linux/slab.h>\n#include \"common.h\"\n\nbool tomoyo_compare_number_union(const unsigned long value,\n\t\t\t\t const struct tomoyo_number_union *ptr)\n{\n\tif (ptr->group)\n\t\treturn tomoyo_number_matches_group(value, value, ptr->group);\n\treturn value >= ptr->values[0] && value <= ptr->values[1];\n}"
  },
  {
    "function_name": "tomoyo_put_number_union",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/file.c",
    "lines": "99-102",
    "snippet": "void tomoyo_put_number_union(struct tomoyo_number_union *ptr)\n{\n\ttomoyo_put_group(ptr->group);\n}",
    "includes": [
      "#include <linux/slab.h>",
      "#include \"common.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "tomoyo_put_group",
          "args": [
            "ptr->group"
          ],
          "line": 101
        },
        "resolved": true,
        "details": {
          "function_name": "tomoyo_put_group",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/common.h",
          "lines": "1193-1197",
          "snippet": "static inline void tomoyo_put_group(struct tomoyo_group *group)\n{\n\tif (group)\n\t\tatomic_dec(&group->head.users);\n}",
          "includes": [
            "#include <net/udp.h>",
            "#include <net/ipv6.h>",
            "#include <net/ip.h>",
            "#include <net/af_unix.h>",
            "#include <net/sock.h>",
            "#include <linux/un.h>",
            "#include <linux/in6.h>",
            "#include <linux/in.h>",
            "#include <linux/inet.h>",
            "#include <linux/net.h>",
            "#include <linux/highmem.h>",
            "#include <linux/binfmts.h>",
            "#include <linux/poll.h>",
            "#include <linux/cred.h>",
            "#include <linux/list.h>",
            "#include <linux/mount.h>",
            "#include <linux/namei.h>",
            "#include <linux/sched.h>",
            "#include <linux/fs.h>",
            "#include <linux/kmod.h>",
            "#include <linux/file.h>",
            "#include <linux/mm.h>",
            "#include <linux/string.h>",
            "#include <linux/ctype.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <net/udp.h>\n#include <net/ipv6.h>\n#include <net/ip.h>\n#include <net/af_unix.h>\n#include <net/sock.h>\n#include <linux/un.h>\n#include <linux/in6.h>\n#include <linux/in.h>\n#include <linux/inet.h>\n#include <linux/net.h>\n#include <linux/highmem.h>\n#include <linux/binfmts.h>\n#include <linux/poll.h>\n#include <linux/cred.h>\n#include <linux/list.h>\n#include <linux/mount.h>\n#include <linux/namei.h>\n#include <linux/sched.h>\n#include <linux/fs.h>\n#include <linux/kmod.h>\n#include <linux/file.h>\n#include <linux/mm.h>\n#include <linux/string.h>\n#include <linux/ctype.h>\n\nstatic inline void tomoyo_put_group(struct tomoyo_group *group)\n{\n\tif (group)\n\t\tatomic_dec(&group->head.users);\n}"
        }
      }
    ],
    "contextual_snippet": "#include <linux/slab.h>\n#include \"common.h\"\n\nvoid tomoyo_put_number_union(struct tomoyo_number_union *ptr)\n{\n\ttomoyo_put_group(ptr->group);\n}"
  },
  {
    "function_name": "tomoyo_compare_name_union",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/file.c",
    "lines": "81-90",
    "snippet": "const struct tomoyo_path_info *\ntomoyo_compare_name_union(const struct tomoyo_path_info *name,\n\t\t\t  const struct tomoyo_name_union *ptr)\n{\n\tif (ptr->group)\n\t\treturn tomoyo_path_matches_group(name, ptr->group);\n\tif (tomoyo_path_matches_pattern(name, ptr->filename))\n\t\treturn ptr->filename;\n\treturn NULL;\n}",
    "includes": [
      "#include <linux/slab.h>",
      "#include \"common.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "tomoyo_path_matches_pattern",
          "args": [
            "name",
            "ptr->filename"
          ],
          "line": 87
        },
        "resolved": true,
        "details": {
          "function_name": "tomoyo_path_matches_pattern",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/util.c",
          "lines": "902-921",
          "snippet": "bool tomoyo_path_matches_pattern(const struct tomoyo_path_info *filename,\n\t\t\t\t const struct tomoyo_path_info *pattern)\n{\n\tconst char *f = filename->name;\n\tconst char *p = pattern->name;\n\tconst int len = pattern->const_len;\n\n\t/* If @pattern doesn't contain pattern, I can use strcmp(). */\n\tif (!pattern->is_patterned)\n\t\treturn !tomoyo_pathcmp(filename, pattern);\n\t/* Don't compare directory and non-directory. */\n\tif (filename->is_dir != pattern->is_dir)\n\t\treturn false;\n\t/* Compare the initial length without patterns. */\n\tif (strncmp(f, p, len))\n\t\treturn false;\n\tf += len;\n\tp += len;\n\treturn tomoyo_path_matches_pattern2(f, p);\n}",
          "includes": [
            "#include \"common.h\"",
            "#include <linux/rculist.h>",
            "#include <linux/slab.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common.h\"\n#include <linux/rculist.h>\n#include <linux/slab.h>\n\nbool tomoyo_path_matches_pattern(const struct tomoyo_path_info *filename,\n\t\t\t\t const struct tomoyo_path_info *pattern)\n{\n\tconst char *f = filename->name;\n\tconst char *p = pattern->name;\n\tconst int len = pattern->const_len;\n\n\t/* If @pattern doesn't contain pattern, I can use strcmp(). */\n\tif (!pattern->is_patterned)\n\t\treturn !tomoyo_pathcmp(filename, pattern);\n\t/* Don't compare directory and non-directory. */\n\tif (filename->is_dir != pattern->is_dir)\n\t\treturn false;\n\t/* Compare the initial length without patterns. */\n\tif (strncmp(f, p, len))\n\t\treturn false;\n\tf += len;\n\tp += len;\n\treturn tomoyo_path_matches_pattern2(f, p);\n}"
        }
      },
      {
        "call_info": {
          "callee": "tomoyo_path_matches_group",
          "args": [
            "name",
            "ptr->group"
          ],
          "line": 86
        },
        "resolved": true,
        "details": {
          "function_name": "tomoyo_path_matches_group",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/group.c",
          "lines": "127-140",
          "snippet": "const struct tomoyo_path_info *\ntomoyo_path_matches_group(const struct tomoyo_path_info *pathname,\n\t\t\t  const struct tomoyo_group *group)\n{\n\tstruct tomoyo_path_group *member;\n\tlist_for_each_entry_rcu(member, &group->member_list, head.list) {\n\t\tif (member->head.is_deleted)\n\t\t\tcontinue;\n\t\tif (!tomoyo_path_matches_pattern(pathname, member->member_name))\n\t\t\tcontinue;\n\t\treturn member->member_name;\n\t}\n\treturn NULL;\n}",
          "includes": [
            "#include \"common.h\"",
            "#include <linux/rculist.h>",
            "#include <linux/slab.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common.h\"\n#include <linux/rculist.h>\n#include <linux/slab.h>\n\nconst struct tomoyo_path_info *\ntomoyo_path_matches_group(const struct tomoyo_path_info *pathname,\n\t\t\t  const struct tomoyo_group *group)\n{\n\tstruct tomoyo_path_group *member;\n\tlist_for_each_entry_rcu(member, &group->member_list, head.list) {\n\t\tif (member->head.is_deleted)\n\t\t\tcontinue;\n\t\tif (!tomoyo_path_matches_pattern(pathname, member->member_name))\n\t\t\tcontinue;\n\t\treturn member->member_name;\n\t}\n\treturn NULL;\n}"
        }
      }
    ],
    "contextual_snippet": "#include <linux/slab.h>\n#include \"common.h\"\n\nconst struct tomoyo_path_info *\ntomoyo_compare_name_union(const struct tomoyo_path_info *name,\n\t\t\t  const struct tomoyo_name_union *ptr)\n{\n\tif (ptr->group)\n\t\treturn tomoyo_path_matches_group(name, ptr->group);\n\tif (tomoyo_path_matches_pattern(name, ptr->filename))\n\t\treturn ptr->filename;\n\treturn NULL;\n}"
  },
  {
    "function_name": "tomoyo_put_name_union",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/file.c",
    "lines": "67-71",
    "snippet": "void tomoyo_put_name_union(struct tomoyo_name_union *ptr)\n{\n\ttomoyo_put_group(ptr->group);\n\ttomoyo_put_name(ptr->filename);\n}",
    "includes": [
      "#include <linux/slab.h>",
      "#include \"common.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "tomoyo_put_name",
          "args": [
            "ptr->filename"
          ],
          "line": 70
        },
        "resolved": true,
        "details": {
          "function_name": "tomoyo_put_name_union",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/file.c",
          "lines": "67-71",
          "snippet": "void tomoyo_put_name_union(struct tomoyo_name_union *ptr)\n{\n\ttomoyo_put_group(ptr->group);\n\ttomoyo_put_name(ptr->filename);\n}",
          "note": "cyclic_reference_detected"
        }
      },
      {
        "call_info": {
          "callee": "tomoyo_put_group",
          "args": [
            "ptr->group"
          ],
          "line": 69
        },
        "resolved": true,
        "details": {
          "function_name": "tomoyo_put_group",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/common.h",
          "lines": "1193-1197",
          "snippet": "static inline void tomoyo_put_group(struct tomoyo_group *group)\n{\n\tif (group)\n\t\tatomic_dec(&group->head.users);\n}",
          "includes": [
            "#include <net/udp.h>",
            "#include <net/ipv6.h>",
            "#include <net/ip.h>",
            "#include <net/af_unix.h>",
            "#include <net/sock.h>",
            "#include <linux/un.h>",
            "#include <linux/in6.h>",
            "#include <linux/in.h>",
            "#include <linux/inet.h>",
            "#include <linux/net.h>",
            "#include <linux/highmem.h>",
            "#include <linux/binfmts.h>",
            "#include <linux/poll.h>",
            "#include <linux/cred.h>",
            "#include <linux/list.h>",
            "#include <linux/mount.h>",
            "#include <linux/namei.h>",
            "#include <linux/sched.h>",
            "#include <linux/fs.h>",
            "#include <linux/kmod.h>",
            "#include <linux/file.h>",
            "#include <linux/mm.h>",
            "#include <linux/string.h>",
            "#include <linux/ctype.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <net/udp.h>\n#include <net/ipv6.h>\n#include <net/ip.h>\n#include <net/af_unix.h>\n#include <net/sock.h>\n#include <linux/un.h>\n#include <linux/in6.h>\n#include <linux/in.h>\n#include <linux/inet.h>\n#include <linux/net.h>\n#include <linux/highmem.h>\n#include <linux/binfmts.h>\n#include <linux/poll.h>\n#include <linux/cred.h>\n#include <linux/list.h>\n#include <linux/mount.h>\n#include <linux/namei.h>\n#include <linux/sched.h>\n#include <linux/fs.h>\n#include <linux/kmod.h>\n#include <linux/file.h>\n#include <linux/mm.h>\n#include <linux/string.h>\n#include <linux/ctype.h>\n\nstatic inline void tomoyo_put_group(struct tomoyo_group *group)\n{\n\tif (group)\n\t\tatomic_dec(&group->head.users);\n}"
        }
      }
    ],
    "contextual_snippet": "#include <linux/slab.h>\n#include \"common.h\"\n\nvoid tomoyo_put_name_union(struct tomoyo_name_union *ptr)\n{\n\ttomoyo_put_group(ptr->group);\n\ttomoyo_put_name(ptr->filename);\n}"
  }
]