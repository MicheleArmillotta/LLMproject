[
  {
    "function_name": "symtab_init",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/selinux/ss/symtab.c",
    "lines": "36-43",
    "snippet": "int symtab_init(struct symtab *s, unsigned int size)\n{\n\ts->table = hashtab_create(symhash, symcmp, size);\n\tif (!s->table)\n\t\treturn -ENOMEM;\n\ts->nprim = 0;\n\treturn 0;\n}",
    "includes": [
      "#include \"symtab.h\"",
      "#include <linux/errno.h>",
      "#include <linux/string.h>",
      "#include <linux/kernel.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "hashtab_create",
          "args": [
            "symhash",
            "symcmp",
            "size"
          ],
          "line": 38
        },
        "resolved": true,
        "details": {
          "function_name": "hashtab_create",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/selinux/ss/hashtab.c",
          "lines": "15-40",
          "snippet": "struct hashtab *hashtab_create(u32 (*hash_value)(struct hashtab *h, const void *key),\n\t\t\t       int (*keycmp)(struct hashtab *h, const void *key1, const void *key2),\n\t\t\t       u32 size)\n{\n\tstruct hashtab *p;\n\tu32 i;\n\n\tp = kzalloc(sizeof(*p), GFP_KERNEL);\n\tif (!p)\n\t\treturn p;\n\n\tp->size = size;\n\tp->nel = 0;\n\tp->hash_value = hash_value;\n\tp->keycmp = keycmp;\n\tp->htable = kmalloc_array(size, sizeof(*p->htable), GFP_KERNEL);\n\tif (!p->htable) {\n\t\tkfree(p);\n\t\treturn NULL;\n\t}\n\n\tfor (i = 0; i < size; i++)\n\t\tp->htable[i] = NULL;\n\n\treturn p;\n}",
          "includes": [
            "#include \"hashtab.h\"",
            "#include <linux/sched.h>",
            "#include <linux/errno.h>",
            "#include <linux/slab.h>",
            "#include <linux/kernel.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"hashtab.h\"\n#include <linux/sched.h>\n#include <linux/errno.h>\n#include <linux/slab.h>\n#include <linux/kernel.h>\n\nstruct hashtab *hashtab_create(u32 (*hash_value)(struct hashtab *h, const void *key),\n\t\t\t       int (*keycmp)(struct hashtab *h, const void *key1, const void *key2),\n\t\t\t       u32 size)\n{\n\tstruct hashtab *p;\n\tu32 i;\n\n\tp = kzalloc(sizeof(*p), GFP_KERNEL);\n\tif (!p)\n\t\treturn p;\n\n\tp->size = size;\n\tp->nel = 0;\n\tp->hash_value = hash_value;\n\tp->keycmp = keycmp;\n\tp->htable = kmalloc_array(size, sizeof(*p->htable), GFP_KERNEL);\n\tif (!p->htable) {\n\t\tkfree(p);\n\t\treturn NULL;\n\t}\n\n\tfor (i = 0; i < size; i++)\n\t\tp->htable[i] = NULL;\n\n\treturn p;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"symtab.h\"\n#include <linux/errno.h>\n#include <linux/string.h>\n#include <linux/kernel.h>\n\nint symtab_init(struct symtab *s, unsigned int size)\n{\n\ts->table = hashtab_create(symhash, symcmp, size);\n\tif (!s->table)\n\t\treturn -ENOMEM;\n\ts->nprim = 0;\n\treturn 0;\n}"
  },
  {
    "function_name": "symcmp",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/selinux/ss/symtab.c",
    "lines": "26-33",
    "snippet": "static int symcmp(struct hashtab *h, const void *key1, const void *key2)\n{\n\tconst char *keyp1, *keyp2;\n\n\tkeyp1 = key1;\n\tkeyp2 = key2;\n\treturn strcmp(keyp1, keyp2);\n}",
    "includes": [
      "#include \"symtab.h\"",
      "#include <linux/errno.h>",
      "#include <linux/string.h>",
      "#include <linux/kernel.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "keyp1",
            "keyp2"
          ],
          "line": 32
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"symtab.h\"\n#include <linux/errno.h>\n#include <linux/string.h>\n#include <linux/kernel.h>\n\nstatic int symcmp(struct hashtab *h, const void *key1, const void *key2)\n{\n\tconst char *keyp1, *keyp2;\n\n\tkeyp1 = key1;\n\tkeyp2 = key2;\n\treturn strcmp(keyp1, keyp2);\n}"
  },
  {
    "function_name": "symhash",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/selinux/ss/symtab.c",
    "lines": "12-24",
    "snippet": "static unsigned int symhash(struct hashtab *h, const void *key)\n{\n\tconst char *p, *keyp;\n\tunsigned int size;\n\tunsigned int val;\n\n\tval = 0;\n\tkeyp = key;\n\tsize = strlen(keyp);\n\tfor (p = keyp; (p - keyp) < size; p++)\n\t\tval = (val << 4 | (val >> (8*sizeof(unsigned int)-4))) ^ (*p);\n\treturn val & (h->size - 1);\n}",
    "includes": [
      "#include \"symtab.h\"",
      "#include <linux/errno.h>",
      "#include <linux/string.h>",
      "#include <linux/kernel.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "keyp"
          ],
          "line": 20
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"symtab.h\"\n#include <linux/errno.h>\n#include <linux/string.h>\n#include <linux/kernel.h>\n\nstatic unsigned int symhash(struct hashtab *h, const void *key)\n{\n\tconst char *p, *keyp;\n\tunsigned int size;\n\tunsigned int val;\n\n\tval = 0;\n\tkeyp = key;\n\tsize = strlen(keyp);\n\tfor (p = keyp; (p - keyp) < size; p++)\n\t\tval = (val << 4 | (val >> (8*sizeof(unsigned int)-4))) ^ (*p);\n\treturn val & (h->size - 1);\n}"
  }
]