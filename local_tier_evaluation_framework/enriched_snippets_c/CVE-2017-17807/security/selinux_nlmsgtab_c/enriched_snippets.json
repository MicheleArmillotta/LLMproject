[
  {
    "function_name": "selinux_nlmsg_lookup",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/selinux/nlmsgtab.c",
    "lines": "155-197",
    "snippet": "int selinux_nlmsg_lookup(u16 sclass, u16 nlmsg_type, u32 *perm)\n{\n\tint err = 0;\n\n\tswitch (sclass) {\n\tcase SECCLASS_NETLINK_ROUTE_SOCKET:\n\t\t/* RTM_MAX always point to RTM_SETxxxx, ie RTM_NEWxxx + 3 */\n\t\tBUILD_BUG_ON(RTM_MAX != (RTM_NEWCACHEREPORT + 3));\n\t\terr = nlmsg_perm(nlmsg_type, perm, nlmsg_route_perms,\n\t\t\t\t sizeof(nlmsg_route_perms));\n\t\tbreak;\n\n\tcase SECCLASS_NETLINK_TCPDIAG_SOCKET:\n\t\terr = nlmsg_perm(nlmsg_type, perm, nlmsg_tcpdiag_perms,\n\t\t\t\t sizeof(nlmsg_tcpdiag_perms));\n\t\tbreak;\n\n\tcase SECCLASS_NETLINK_XFRM_SOCKET:\n\t\tBUILD_BUG_ON(XFRM_MSG_MAX != XFRM_MSG_MAPPING);\n\t\terr = nlmsg_perm(nlmsg_type, perm, nlmsg_xfrm_perms,\n\t\t\t\t sizeof(nlmsg_xfrm_perms));\n\t\tbreak;\n\n\tcase SECCLASS_NETLINK_AUDIT_SOCKET:\n\t\tif ((nlmsg_type >= AUDIT_FIRST_USER_MSG &&\n\t\t     nlmsg_type <= AUDIT_LAST_USER_MSG) ||\n\t\t    (nlmsg_type >= AUDIT_FIRST_USER_MSG2 &&\n\t\t     nlmsg_type <= AUDIT_LAST_USER_MSG2)) {\n\t\t\t*perm = NETLINK_AUDIT_SOCKET__NLMSG_RELAY;\n\t\t} else {\n\t\t\terr = nlmsg_perm(nlmsg_type, perm, nlmsg_audit_perms,\n\t\t\t\t\t sizeof(nlmsg_audit_perms));\n\t\t}\n\t\tbreak;\n\n\t/* No messaging from userspace, or class unknown/unhandled */\n\tdefault:\n\t\terr = -ENOENT;\n\t\tbreak;\n\t}\n\n\treturn err;\n}",
    "includes": [
      "#include \"security.h\"",
      "#include \"av_permissions.h\"",
      "#include \"flask.h\"",
      "#include <linux/sock_diag.h>",
      "#include <linux/audit.h>",
      "#include <linux/xfrm.h>",
      "#include <linux/inet_diag.h>",
      "#include <linux/if.h>",
      "#include <linux/rtnetlink.h>",
      "#include <linux/netlink.h>",
      "#include <linux/kernel.h>",
      "#include <linux/types.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static const struct nlmsg_perm nlmsg_route_perms[] =\n{\n\t{ RTM_NEWLINK,\t\tNETLINK_ROUTE_SOCKET__NLMSG_WRITE },\n\t{ RTM_DELLINK,\t\tNETLINK_ROUTE_SOCKET__NLMSG_WRITE },\n\t{ RTM_GETLINK,\t\tNETLINK_ROUTE_SOCKET__NLMSG_READ  },\n\t{ RTM_SETLINK,\t\tNETLINK_ROUTE_SOCKET__NLMSG_WRITE },\n\t{ RTM_NEWADDR,\t\tNETLINK_ROUTE_SOCKET__NLMSG_WRITE },\n\t{ RTM_DELADDR,\t\tNETLINK_ROUTE_SOCKET__NLMSG_WRITE },\n\t{ RTM_GETADDR,\t\tNETLINK_ROUTE_SOCKET__NLMSG_READ  },\n\t{ RTM_NEWROUTE,\t\tNETLINK_ROUTE_SOCKET__NLMSG_WRITE },\n\t{ RTM_DELROUTE,\t\tNETLINK_ROUTE_SOCKET__NLMSG_WRITE },\n\t{ RTM_GETROUTE,\t\tNETLINK_ROUTE_SOCKET__NLMSG_READ  },\n\t{ RTM_NEWNEIGH,\t\tNETLINK_ROUTE_SOCKET__NLMSG_WRITE },\n\t{ RTM_DELNEIGH,\t\tNETLINK_ROUTE_SOCKET__NLMSG_WRITE },\n\t{ RTM_GETNEIGH,\t\tNETLINK_ROUTE_SOCKET__NLMSG_READ  },\n\t{ RTM_NEWRULE,\t\tNETLINK_ROUTE_SOCKET__NLMSG_WRITE },\n\t{ RTM_DELRULE,\t\tNETLINK_ROUTE_SOCKET__NLMSG_WRITE },\n\t{ RTM_GETRULE,\t\tNETLINK_ROUTE_SOCKET__NLMSG_READ  },\n\t{ RTM_NEWQDISC,\t\tNETLINK_ROUTE_SOCKET__NLMSG_WRITE },\n\t{ RTM_DELQDISC,\t\tNETLINK_ROUTE_SOCKET__NLMSG_WRITE },\n\t{ RTM_GETQDISC,\t\tNETLINK_ROUTE_SOCKET__NLMSG_READ  },\n\t{ RTM_NEWTCLASS,\tNETLINK_ROUTE_SOCKET__NLMSG_WRITE },\n\t{ RTM_DELTCLASS,\tNETLINK_ROUTE_SOCKET__NLMSG_WRITE },\n\t{ RTM_GETTCLASS,\tNETLINK_ROUTE_SOCKET__NLMSG_READ  },\n\t{ RTM_NEWTFILTER,\tNETLINK_ROUTE_SOCKET__NLMSG_WRITE },\n\t{ RTM_DELTFILTER,\tNETLINK_ROUTE_SOCKET__NLMSG_WRITE },\n\t{ RTM_GETTFILTER,\tNETLINK_ROUTE_SOCKET__NLMSG_READ  },\n\t{ RTM_NEWACTION,\tNETLINK_ROUTE_SOCKET__NLMSG_WRITE },\n\t{ RTM_DELACTION,\tNETLINK_ROUTE_SOCKET__NLMSG_WRITE },\n\t{ RTM_GETACTION,\tNETLINK_ROUTE_SOCKET__NLMSG_READ  },\n\t{ RTM_NEWPREFIX,\tNETLINK_ROUTE_SOCKET__NLMSG_WRITE },\n\t{ RTM_GETMULTICAST,\tNETLINK_ROUTE_SOCKET__NLMSG_READ  },\n\t{ RTM_GETANYCAST,\tNETLINK_ROUTE_SOCKET__NLMSG_READ  },\n\t{ RTM_GETNEIGHTBL,\tNETLINK_ROUTE_SOCKET__NLMSG_READ  },\n\t{ RTM_SETNEIGHTBL,\tNETLINK_ROUTE_SOCKET__NLMSG_WRITE },\n\t{ RTM_NEWADDRLABEL,\tNETLINK_ROUTE_SOCKET__NLMSG_WRITE },\n\t{ RTM_DELADDRLABEL,\tNETLINK_ROUTE_SOCKET__NLMSG_WRITE },\n\t{ RTM_GETADDRLABEL,\tNETLINK_ROUTE_SOCKET__NLMSG_READ  },\n\t{ RTM_GETDCB,\t\tNETLINK_ROUTE_SOCKET__NLMSG_READ  },\n\t{ RTM_SETDCB,\t\tNETLINK_ROUTE_SOCKET__NLMSG_WRITE },\n\t{ RTM_NEWNETCONF,\tNETLINK_ROUTE_SOCKET__NLMSG_WRITE },\n\t{ RTM_DELNETCONF,\tNETLINK_ROUTE_SOCKET__NLMSG_WRITE },\n\t{ RTM_GETNETCONF,\tNETLINK_ROUTE_SOCKET__NLMSG_READ  },\n\t{ RTM_NEWMDB,\t\tNETLINK_ROUTE_SOCKET__NLMSG_WRITE },\n\t{ RTM_DELMDB,\t\tNETLINK_ROUTE_SOCKET__NLMSG_WRITE  },\n\t{ RTM_GETMDB,\t\tNETLINK_ROUTE_SOCKET__NLMSG_READ  },\n\t{ RTM_NEWNSID,\t\tNETLINK_ROUTE_SOCKET__NLMSG_WRITE },\n\t{ RTM_DELNSID,\t\tNETLINK_ROUTE_SOCKET__NLMSG_READ  },\n\t{ RTM_GETNSID,\t\tNETLINK_ROUTE_SOCKET__NLMSG_READ  },\n\t{ RTM_NEWSTATS,\t\tNETLINK_ROUTE_SOCKET__NLMSG_READ },\n\t{ RTM_GETSTATS,\t\tNETLINK_ROUTE_SOCKET__NLMSG_READ  },\n\t{ RTM_NEWCACHEREPORT,\tNETLINK_ROUTE_SOCKET__NLMSG_READ },\n};",
      "static const struct nlmsg_perm nlmsg_tcpdiag_perms[] =\n{\n\t{ TCPDIAG_GETSOCK,\tNETLINK_TCPDIAG_SOCKET__NLMSG_READ },\n\t{ DCCPDIAG_GETSOCK,\tNETLINK_TCPDIAG_SOCKET__NLMSG_READ },\n\t{ SOCK_DIAG_BY_FAMILY,\tNETLINK_TCPDIAG_SOCKET__NLMSG_READ },\n\t{ SOCK_DESTROY,\t\tNETLINK_TCPDIAG_SOCKET__NLMSG_WRITE },\n};",
      "static const struct nlmsg_perm nlmsg_xfrm_perms[] =\n{\n\t{ XFRM_MSG_NEWSA,\tNETLINK_XFRM_SOCKET__NLMSG_WRITE },\n\t{ XFRM_MSG_DELSA,\tNETLINK_XFRM_SOCKET__NLMSG_WRITE },\n\t{ XFRM_MSG_GETSA,\tNETLINK_XFRM_SOCKET__NLMSG_READ  },\n\t{ XFRM_MSG_NEWPOLICY,\tNETLINK_XFRM_SOCKET__NLMSG_WRITE },\n\t{ XFRM_MSG_DELPOLICY,\tNETLINK_XFRM_SOCKET__NLMSG_WRITE },\n\t{ XFRM_MSG_GETPOLICY,\tNETLINK_XFRM_SOCKET__NLMSG_READ  },\n\t{ XFRM_MSG_ALLOCSPI,\tNETLINK_XFRM_SOCKET__NLMSG_WRITE },\n\t{ XFRM_MSG_ACQUIRE,\tNETLINK_XFRM_SOCKET__NLMSG_WRITE },\n\t{ XFRM_MSG_EXPIRE,\tNETLINK_XFRM_SOCKET__NLMSG_WRITE },\n\t{ XFRM_MSG_UPDPOLICY,\tNETLINK_XFRM_SOCKET__NLMSG_WRITE },\n\t{ XFRM_MSG_UPDSA,\tNETLINK_XFRM_SOCKET__NLMSG_WRITE },\n\t{ XFRM_MSG_POLEXPIRE,\tNETLINK_XFRM_SOCKET__NLMSG_WRITE },\n\t{ XFRM_MSG_FLUSHSA,\tNETLINK_XFRM_SOCKET__NLMSG_WRITE },\n\t{ XFRM_MSG_FLUSHPOLICY,\tNETLINK_XFRM_SOCKET__NLMSG_WRITE },\n\t{ XFRM_MSG_NEWAE,\tNETLINK_XFRM_SOCKET__NLMSG_WRITE },\n\t{ XFRM_MSG_GETAE,\tNETLINK_XFRM_SOCKET__NLMSG_READ  },\n\t{ XFRM_MSG_REPORT,\tNETLINK_XFRM_SOCKET__NLMSG_READ  },\n\t{ XFRM_MSG_MIGRATE,\tNETLINK_XFRM_SOCKET__NLMSG_WRITE },\n\t{ XFRM_MSG_NEWSADINFO,\tNETLINK_XFRM_SOCKET__NLMSG_READ  },\n\t{ XFRM_MSG_GETSADINFO,\tNETLINK_XFRM_SOCKET__NLMSG_READ  },\n\t{ XFRM_MSG_NEWSPDINFO,\tNETLINK_XFRM_SOCKET__NLMSG_WRITE },\n\t{ XFRM_MSG_GETSPDINFO,\tNETLINK_XFRM_SOCKET__NLMSG_READ  },\n\t{ XFRM_MSG_MAPPING,\tNETLINK_XFRM_SOCKET__NLMSG_READ  },\n};",
      "static const struct nlmsg_perm nlmsg_audit_perms[] =\n{\n\t{ AUDIT_GET,\t\tNETLINK_AUDIT_SOCKET__NLMSG_READ     },\n\t{ AUDIT_SET,\t\tNETLINK_AUDIT_SOCKET__NLMSG_WRITE    },\n\t{ AUDIT_LIST,\t\tNETLINK_AUDIT_SOCKET__NLMSG_READPRIV },\n\t{ AUDIT_ADD,\t\tNETLINK_AUDIT_SOCKET__NLMSG_WRITE    },\n\t{ AUDIT_DEL,\t\tNETLINK_AUDIT_SOCKET__NLMSG_WRITE    },\n\t{ AUDIT_LIST_RULES,\tNETLINK_AUDIT_SOCKET__NLMSG_READPRIV },\n\t{ AUDIT_ADD_RULE,\tNETLINK_AUDIT_SOCKET__NLMSG_WRITE    },\n\t{ AUDIT_DEL_RULE,\tNETLINK_AUDIT_SOCKET__NLMSG_WRITE    },\n\t{ AUDIT_USER,\t\tNETLINK_AUDIT_SOCKET__NLMSG_RELAY    },\n\t{ AUDIT_SIGNAL_INFO,\tNETLINK_AUDIT_SOCKET__NLMSG_READ     },\n\t{ AUDIT_TRIM,\t\tNETLINK_AUDIT_SOCKET__NLMSG_WRITE    },\n\t{ AUDIT_MAKE_EQUIV,\tNETLINK_AUDIT_SOCKET__NLMSG_WRITE    },\n\t{ AUDIT_TTY_GET,\tNETLINK_AUDIT_SOCKET__NLMSG_READ     },\n\t{ AUDIT_TTY_SET,\tNETLINK_AUDIT_SOCKET__NLMSG_TTY_AUDIT\t},\n\t{ AUDIT_GET_FEATURE,\tNETLINK_AUDIT_SOCKET__NLMSG_READ     },\n\t{ AUDIT_SET_FEATURE,\tNETLINK_AUDIT_SOCKET__NLMSG_WRITE    },\n};"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "nlmsg_perm",
          "args": [
            "nlmsg_type",
            "perm",
            "nlmsg_audit_perms",
            "sizeof(nlmsg_audit_perms)"
          ],
          "line": 185
        },
        "resolved": true,
        "details": {
          "function_name": "nlmsg_perm",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/selinux/nlmsgtab.c",
          "lines": "141-153",
          "snippet": "static int nlmsg_perm(u16 nlmsg_type, u32 *perm, const struct nlmsg_perm *tab, size_t tabsize)\n{\n\tint i, err = -EINVAL;\n\n\tfor (i = 0; i < tabsize/sizeof(struct nlmsg_perm); i++)\n\t\tif (nlmsg_type == tab[i].nlmsg_type) {\n\t\t\t*perm = tab[i].perm;\n\t\t\terr = 0;\n\t\t\tbreak;\n\t\t}\n\n\treturn err;\n}",
          "includes": [
            "#include \"security.h\"",
            "#include \"av_permissions.h\"",
            "#include \"flask.h\"",
            "#include <linux/sock_diag.h>",
            "#include <linux/audit.h>",
            "#include <linux/xfrm.h>",
            "#include <linux/inet_diag.h>",
            "#include <linux/if.h>",
            "#include <linux/rtnetlink.h>",
            "#include <linux/netlink.h>",
            "#include <linux/kernel.h>",
            "#include <linux/types.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"security.h\"\n#include \"av_permissions.h\"\n#include \"flask.h\"\n#include <linux/sock_diag.h>\n#include <linux/audit.h>\n#include <linux/xfrm.h>\n#include <linux/inet_diag.h>\n#include <linux/if.h>\n#include <linux/rtnetlink.h>\n#include <linux/netlink.h>\n#include <linux/kernel.h>\n#include <linux/types.h>\n\nstatic int nlmsg_perm(u16 nlmsg_type, u32 *perm, const struct nlmsg_perm *tab, size_t tabsize)\n{\n\tint i, err = -EINVAL;\n\n\tfor (i = 0; i < tabsize/sizeof(struct nlmsg_perm); i++)\n\t\tif (nlmsg_type == tab[i].nlmsg_type) {\n\t\t\t*perm = tab[i].perm;\n\t\t\terr = 0;\n\t\t\tbreak;\n\t\t}\n\n\treturn err;\n}"
        }
      },
      {
        "call_info": {
          "callee": "BUILD_BUG_ON",
          "args": [
            "XFRM_MSG_MAX != XFRM_MSG_MAPPING"
          ],
          "line": 173
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "BUILD_BUG_ON",
          "args": [
            "RTM_MAX != (RTM_NEWCACHEREPORT + 3)"
          ],
          "line": 162
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"security.h\"\n#include \"av_permissions.h\"\n#include \"flask.h\"\n#include <linux/sock_diag.h>\n#include <linux/audit.h>\n#include <linux/xfrm.h>\n#include <linux/inet_diag.h>\n#include <linux/if.h>\n#include <linux/rtnetlink.h>\n#include <linux/netlink.h>\n#include <linux/kernel.h>\n#include <linux/types.h>\n\nstatic const struct nlmsg_perm nlmsg_route_perms[] =\n{\n\t{ RTM_NEWLINK,\t\tNETLINK_ROUTE_SOCKET__NLMSG_WRITE },\n\t{ RTM_DELLINK,\t\tNETLINK_ROUTE_SOCKET__NLMSG_WRITE },\n\t{ RTM_GETLINK,\t\tNETLINK_ROUTE_SOCKET__NLMSG_READ  },\n\t{ RTM_SETLINK,\t\tNETLINK_ROUTE_SOCKET__NLMSG_WRITE },\n\t{ RTM_NEWADDR,\t\tNETLINK_ROUTE_SOCKET__NLMSG_WRITE },\n\t{ RTM_DELADDR,\t\tNETLINK_ROUTE_SOCKET__NLMSG_WRITE },\n\t{ RTM_GETADDR,\t\tNETLINK_ROUTE_SOCKET__NLMSG_READ  },\n\t{ RTM_NEWROUTE,\t\tNETLINK_ROUTE_SOCKET__NLMSG_WRITE },\n\t{ RTM_DELROUTE,\t\tNETLINK_ROUTE_SOCKET__NLMSG_WRITE },\n\t{ RTM_GETROUTE,\t\tNETLINK_ROUTE_SOCKET__NLMSG_READ  },\n\t{ RTM_NEWNEIGH,\t\tNETLINK_ROUTE_SOCKET__NLMSG_WRITE },\n\t{ RTM_DELNEIGH,\t\tNETLINK_ROUTE_SOCKET__NLMSG_WRITE },\n\t{ RTM_GETNEIGH,\t\tNETLINK_ROUTE_SOCKET__NLMSG_READ  },\n\t{ RTM_NEWRULE,\t\tNETLINK_ROUTE_SOCKET__NLMSG_WRITE },\n\t{ RTM_DELRULE,\t\tNETLINK_ROUTE_SOCKET__NLMSG_WRITE },\n\t{ RTM_GETRULE,\t\tNETLINK_ROUTE_SOCKET__NLMSG_READ  },\n\t{ RTM_NEWQDISC,\t\tNETLINK_ROUTE_SOCKET__NLMSG_WRITE },\n\t{ RTM_DELQDISC,\t\tNETLINK_ROUTE_SOCKET__NLMSG_WRITE },\n\t{ RTM_GETQDISC,\t\tNETLINK_ROUTE_SOCKET__NLMSG_READ  },\n\t{ RTM_NEWTCLASS,\tNETLINK_ROUTE_SOCKET__NLMSG_WRITE },\n\t{ RTM_DELTCLASS,\tNETLINK_ROUTE_SOCKET__NLMSG_WRITE },\n\t{ RTM_GETTCLASS,\tNETLINK_ROUTE_SOCKET__NLMSG_READ  },\n\t{ RTM_NEWTFILTER,\tNETLINK_ROUTE_SOCKET__NLMSG_WRITE },\n\t{ RTM_DELTFILTER,\tNETLINK_ROUTE_SOCKET__NLMSG_WRITE },\n\t{ RTM_GETTFILTER,\tNETLINK_ROUTE_SOCKET__NLMSG_READ  },\n\t{ RTM_NEWACTION,\tNETLINK_ROUTE_SOCKET__NLMSG_WRITE },\n\t{ RTM_DELACTION,\tNETLINK_ROUTE_SOCKET__NLMSG_WRITE },\n\t{ RTM_GETACTION,\tNETLINK_ROUTE_SOCKET__NLMSG_READ  },\n\t{ RTM_NEWPREFIX,\tNETLINK_ROUTE_SOCKET__NLMSG_WRITE },\n\t{ RTM_GETMULTICAST,\tNETLINK_ROUTE_SOCKET__NLMSG_READ  },\n\t{ RTM_GETANYCAST,\tNETLINK_ROUTE_SOCKET__NLMSG_READ  },\n\t{ RTM_GETNEIGHTBL,\tNETLINK_ROUTE_SOCKET__NLMSG_READ  },\n\t{ RTM_SETNEIGHTBL,\tNETLINK_ROUTE_SOCKET__NLMSG_WRITE },\n\t{ RTM_NEWADDRLABEL,\tNETLINK_ROUTE_SOCKET__NLMSG_WRITE },\n\t{ RTM_DELADDRLABEL,\tNETLINK_ROUTE_SOCKET__NLMSG_WRITE },\n\t{ RTM_GETADDRLABEL,\tNETLINK_ROUTE_SOCKET__NLMSG_READ  },\n\t{ RTM_GETDCB,\t\tNETLINK_ROUTE_SOCKET__NLMSG_READ  },\n\t{ RTM_SETDCB,\t\tNETLINK_ROUTE_SOCKET__NLMSG_WRITE },\n\t{ RTM_NEWNETCONF,\tNETLINK_ROUTE_SOCKET__NLMSG_WRITE },\n\t{ RTM_DELNETCONF,\tNETLINK_ROUTE_SOCKET__NLMSG_WRITE },\n\t{ RTM_GETNETCONF,\tNETLINK_ROUTE_SOCKET__NLMSG_READ  },\n\t{ RTM_NEWMDB,\t\tNETLINK_ROUTE_SOCKET__NLMSG_WRITE },\n\t{ RTM_DELMDB,\t\tNETLINK_ROUTE_SOCKET__NLMSG_WRITE  },\n\t{ RTM_GETMDB,\t\tNETLINK_ROUTE_SOCKET__NLMSG_READ  },\n\t{ RTM_NEWNSID,\t\tNETLINK_ROUTE_SOCKET__NLMSG_WRITE },\n\t{ RTM_DELNSID,\t\tNETLINK_ROUTE_SOCKET__NLMSG_READ  },\n\t{ RTM_GETNSID,\t\tNETLINK_ROUTE_SOCKET__NLMSG_READ  },\n\t{ RTM_NEWSTATS,\t\tNETLINK_ROUTE_SOCKET__NLMSG_READ },\n\t{ RTM_GETSTATS,\t\tNETLINK_ROUTE_SOCKET__NLMSG_READ  },\n\t{ RTM_NEWCACHEREPORT,\tNETLINK_ROUTE_SOCKET__NLMSG_READ },\n};\nstatic const struct nlmsg_perm nlmsg_tcpdiag_perms[] =\n{\n\t{ TCPDIAG_GETSOCK,\tNETLINK_TCPDIAG_SOCKET__NLMSG_READ },\n\t{ DCCPDIAG_GETSOCK,\tNETLINK_TCPDIAG_SOCKET__NLMSG_READ },\n\t{ SOCK_DIAG_BY_FAMILY,\tNETLINK_TCPDIAG_SOCKET__NLMSG_READ },\n\t{ SOCK_DESTROY,\t\tNETLINK_TCPDIAG_SOCKET__NLMSG_WRITE },\n};\nstatic const struct nlmsg_perm nlmsg_xfrm_perms[] =\n{\n\t{ XFRM_MSG_NEWSA,\tNETLINK_XFRM_SOCKET__NLMSG_WRITE },\n\t{ XFRM_MSG_DELSA,\tNETLINK_XFRM_SOCKET__NLMSG_WRITE },\n\t{ XFRM_MSG_GETSA,\tNETLINK_XFRM_SOCKET__NLMSG_READ  },\n\t{ XFRM_MSG_NEWPOLICY,\tNETLINK_XFRM_SOCKET__NLMSG_WRITE },\n\t{ XFRM_MSG_DELPOLICY,\tNETLINK_XFRM_SOCKET__NLMSG_WRITE },\n\t{ XFRM_MSG_GETPOLICY,\tNETLINK_XFRM_SOCKET__NLMSG_READ  },\n\t{ XFRM_MSG_ALLOCSPI,\tNETLINK_XFRM_SOCKET__NLMSG_WRITE },\n\t{ XFRM_MSG_ACQUIRE,\tNETLINK_XFRM_SOCKET__NLMSG_WRITE },\n\t{ XFRM_MSG_EXPIRE,\tNETLINK_XFRM_SOCKET__NLMSG_WRITE },\n\t{ XFRM_MSG_UPDPOLICY,\tNETLINK_XFRM_SOCKET__NLMSG_WRITE },\n\t{ XFRM_MSG_UPDSA,\tNETLINK_XFRM_SOCKET__NLMSG_WRITE },\n\t{ XFRM_MSG_POLEXPIRE,\tNETLINK_XFRM_SOCKET__NLMSG_WRITE },\n\t{ XFRM_MSG_FLUSHSA,\tNETLINK_XFRM_SOCKET__NLMSG_WRITE },\n\t{ XFRM_MSG_FLUSHPOLICY,\tNETLINK_XFRM_SOCKET__NLMSG_WRITE },\n\t{ XFRM_MSG_NEWAE,\tNETLINK_XFRM_SOCKET__NLMSG_WRITE },\n\t{ XFRM_MSG_GETAE,\tNETLINK_XFRM_SOCKET__NLMSG_READ  },\n\t{ XFRM_MSG_REPORT,\tNETLINK_XFRM_SOCKET__NLMSG_READ  },\n\t{ XFRM_MSG_MIGRATE,\tNETLINK_XFRM_SOCKET__NLMSG_WRITE },\n\t{ XFRM_MSG_NEWSADINFO,\tNETLINK_XFRM_SOCKET__NLMSG_READ  },\n\t{ XFRM_MSG_GETSADINFO,\tNETLINK_XFRM_SOCKET__NLMSG_READ  },\n\t{ XFRM_MSG_NEWSPDINFO,\tNETLINK_XFRM_SOCKET__NLMSG_WRITE },\n\t{ XFRM_MSG_GETSPDINFO,\tNETLINK_XFRM_SOCKET__NLMSG_READ  },\n\t{ XFRM_MSG_MAPPING,\tNETLINK_XFRM_SOCKET__NLMSG_READ  },\n};\nstatic const struct nlmsg_perm nlmsg_audit_perms[] =\n{\n\t{ AUDIT_GET,\t\tNETLINK_AUDIT_SOCKET__NLMSG_READ     },\n\t{ AUDIT_SET,\t\tNETLINK_AUDIT_SOCKET__NLMSG_WRITE    },\n\t{ AUDIT_LIST,\t\tNETLINK_AUDIT_SOCKET__NLMSG_READPRIV },\n\t{ AUDIT_ADD,\t\tNETLINK_AUDIT_SOCKET__NLMSG_WRITE    },\n\t{ AUDIT_DEL,\t\tNETLINK_AUDIT_SOCKET__NLMSG_WRITE    },\n\t{ AUDIT_LIST_RULES,\tNETLINK_AUDIT_SOCKET__NLMSG_READPRIV },\n\t{ AUDIT_ADD_RULE,\tNETLINK_AUDIT_SOCKET__NLMSG_WRITE    },\n\t{ AUDIT_DEL_RULE,\tNETLINK_AUDIT_SOCKET__NLMSG_WRITE    },\n\t{ AUDIT_USER,\t\tNETLINK_AUDIT_SOCKET__NLMSG_RELAY    },\n\t{ AUDIT_SIGNAL_INFO,\tNETLINK_AUDIT_SOCKET__NLMSG_READ     },\n\t{ AUDIT_TRIM,\t\tNETLINK_AUDIT_SOCKET__NLMSG_WRITE    },\n\t{ AUDIT_MAKE_EQUIV,\tNETLINK_AUDIT_SOCKET__NLMSG_WRITE    },\n\t{ AUDIT_TTY_GET,\tNETLINK_AUDIT_SOCKET__NLMSG_READ     },\n\t{ AUDIT_TTY_SET,\tNETLINK_AUDIT_SOCKET__NLMSG_TTY_AUDIT\t},\n\t{ AUDIT_GET_FEATURE,\tNETLINK_AUDIT_SOCKET__NLMSG_READ     },\n\t{ AUDIT_SET_FEATURE,\tNETLINK_AUDIT_SOCKET__NLMSG_WRITE    },\n};\n\nint selinux_nlmsg_lookup(u16 sclass, u16 nlmsg_type, u32 *perm)\n{\n\tint err = 0;\n\n\tswitch (sclass) {\n\tcase SECCLASS_NETLINK_ROUTE_SOCKET:\n\t\t/* RTM_MAX always point to RTM_SETxxxx, ie RTM_NEWxxx + 3 */\n\t\tBUILD_BUG_ON(RTM_MAX != (RTM_NEWCACHEREPORT + 3));\n\t\terr = nlmsg_perm(nlmsg_type, perm, nlmsg_route_perms,\n\t\t\t\t sizeof(nlmsg_route_perms));\n\t\tbreak;\n\n\tcase SECCLASS_NETLINK_TCPDIAG_SOCKET:\n\t\terr = nlmsg_perm(nlmsg_type, perm, nlmsg_tcpdiag_perms,\n\t\t\t\t sizeof(nlmsg_tcpdiag_perms));\n\t\tbreak;\n\n\tcase SECCLASS_NETLINK_XFRM_SOCKET:\n\t\tBUILD_BUG_ON(XFRM_MSG_MAX != XFRM_MSG_MAPPING);\n\t\terr = nlmsg_perm(nlmsg_type, perm, nlmsg_xfrm_perms,\n\t\t\t\t sizeof(nlmsg_xfrm_perms));\n\t\tbreak;\n\n\tcase SECCLASS_NETLINK_AUDIT_SOCKET:\n\t\tif ((nlmsg_type >= AUDIT_FIRST_USER_MSG &&\n\t\t     nlmsg_type <= AUDIT_LAST_USER_MSG) ||\n\t\t    (nlmsg_type >= AUDIT_FIRST_USER_MSG2 &&\n\t\t     nlmsg_type <= AUDIT_LAST_USER_MSG2)) {\n\t\t\t*perm = NETLINK_AUDIT_SOCKET__NLMSG_RELAY;\n\t\t} else {\n\t\t\terr = nlmsg_perm(nlmsg_type, perm, nlmsg_audit_perms,\n\t\t\t\t\t sizeof(nlmsg_audit_perms));\n\t\t}\n\t\tbreak;\n\n\t/* No messaging from userspace, or class unknown/unhandled */\n\tdefault:\n\t\terr = -ENOENT;\n\t\tbreak;\n\t}\n\n\treturn err;\n}"
  },
  {
    "function_name": "nlmsg_perm",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/selinux/nlmsgtab.c",
    "lines": "141-153",
    "snippet": "static int nlmsg_perm(u16 nlmsg_type, u32 *perm, const struct nlmsg_perm *tab, size_t tabsize)\n{\n\tint i, err = -EINVAL;\n\n\tfor (i = 0; i < tabsize/sizeof(struct nlmsg_perm); i++)\n\t\tif (nlmsg_type == tab[i].nlmsg_type) {\n\t\t\t*perm = tab[i].perm;\n\t\t\terr = 0;\n\t\t\tbreak;\n\t\t}\n\n\treturn err;\n}",
    "includes": [
      "#include \"security.h\"",
      "#include \"av_permissions.h\"",
      "#include \"flask.h\"",
      "#include <linux/sock_diag.h>",
      "#include <linux/audit.h>",
      "#include <linux/xfrm.h>",
      "#include <linux/inet_diag.h>",
      "#include <linux/if.h>",
      "#include <linux/rtnetlink.h>",
      "#include <linux/netlink.h>",
      "#include <linux/kernel.h>",
      "#include <linux/types.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"security.h\"\n#include \"av_permissions.h\"\n#include \"flask.h\"\n#include <linux/sock_diag.h>\n#include <linux/audit.h>\n#include <linux/xfrm.h>\n#include <linux/inet_diag.h>\n#include <linux/if.h>\n#include <linux/rtnetlink.h>\n#include <linux/netlink.h>\n#include <linux/kernel.h>\n#include <linux/types.h>\n\nstatic int nlmsg_perm(u16 nlmsg_type, u32 *perm, const struct nlmsg_perm *tab, size_t tabsize)\n{\n\tint i, err = -EINVAL;\n\n\tfor (i = 0; i < tabsize/sizeof(struct nlmsg_perm); i++)\n\t\tif (nlmsg_type == tab[i].nlmsg_type) {\n\t\t\t*perm = tab[i].perm;\n\t\t\terr = 0;\n\t\t\tbreak;\n\t\t}\n\n\treturn err;\n}"
  }
]