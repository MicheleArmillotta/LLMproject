[
  {
    "function_name": "common_lsm_audit",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/lsm_audit.c",
    "lines": "441-465",
    "snippet": "void common_lsm_audit(struct common_audit_data *a,\n\tvoid (*pre_audit)(struct audit_buffer *, void *),\n\tvoid (*post_audit)(struct audit_buffer *, void *))\n{\n\tstruct audit_buffer *ab;\n\n\tif (a == NULL)\n\t\treturn;\n\t/* we use GFP_ATOMIC so we won't sleep */\n\tab = audit_log_start(current->audit_context, GFP_ATOMIC | __GFP_NOWARN,\n\t\t\t     AUDIT_AVC);\n\n\tif (ab == NULL)\n\t\treturn;\n\n\tif (pre_audit)\n\t\tpre_audit(ab, a);\n\n\tdump_common_audit_data(ab, a);\n\n\tif (post_audit)\n\t\tpost_audit(ab, a);\n\n\taudit_log_end(ab);\n}",
    "includes": [
      "#include <linux/lsm_audit.h>",
      "#include <linux/sctp.h>",
      "#include <linux/dccp.h>",
      "#include <linux/udp.h>",
      "#include <linux/tcp.h>",
      "#include <net/ipv6.h>",
      "#include <net/ip.h>",
      "#include <linux/ip.h>",
      "#include <linux/ipv6.h>",
      "#include <linux/audit.h>",
      "#include <net/af_unix.h>",
      "#include <linux/un.h>",
      "#include <net/sock.h>",
      "#include <linux/init.h>",
      "#include <linux/fs.h>",
      "#include <linux/gfp.h>",
      "#include <linux/kernel.h>",
      "#include <linux/stddef.h>",
      "#include <linux/types.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "audit_log_end",
          "args": [
            "ab"
          ],
          "line": 464
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "post_audit",
          "args": [
            "ab",
            "a"
          ],
          "line": 462
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dump_common_audit_data",
          "args": [
            "ab",
            "a"
          ],
          "line": 459
        },
        "resolved": true,
        "details": {
          "function_name": "dump_common_audit_data",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/lsm_audit.c",
          "lines": "211-430",
          "snippet": "static void dump_common_audit_data(struct audit_buffer *ab,\n\t\t\t\t   struct common_audit_data *a)\n{\n\tchar comm[sizeof(current->comm)];\n\n\t/*\n\t * To keep stack sizes in check force programers to notice if they\n\t * start making this union too large!  See struct lsm_network_audit\n\t * as an example of how to deal with large data.\n\t */\n\tBUILD_BUG_ON(sizeof(a->u) > sizeof(void *)*2);\n\n\taudit_log_format(ab, \" pid=%d comm=\", task_tgid_nr(current));\n\taudit_log_untrustedstring(ab, memcpy(comm, current->comm, sizeof(comm)));\n\n\tswitch (a->type) {\n\tcase LSM_AUDIT_DATA_NONE:\n\t\treturn;\n\tcase LSM_AUDIT_DATA_IPC:\n\t\taudit_log_format(ab, \" key=%d \", a->u.ipc_id);\n\t\tbreak;\n\tcase LSM_AUDIT_DATA_CAP:\n\t\taudit_log_format(ab, \" capability=%d \", a->u.cap);\n\t\tbreak;\n\tcase LSM_AUDIT_DATA_PATH: {\n\t\tstruct inode *inode;\n\n\t\taudit_log_d_path(ab, \" path=\", &a->u.path);\n\n\t\tinode = d_backing_inode(a->u.path.dentry);\n\t\tif (inode) {\n\t\t\taudit_log_format(ab, \" dev=\");\n\t\t\taudit_log_untrustedstring(ab, inode->i_sb->s_id);\n\t\t\taudit_log_format(ab, \" ino=%lu\", inode->i_ino);\n\t\t}\n\t\tbreak;\n\t}\n\tcase LSM_AUDIT_DATA_FILE: {\n\t\tstruct inode *inode;\n\n\t\taudit_log_d_path(ab, \" path=\", &a->u.file->f_path);\n\n\t\tinode = file_inode(a->u.file);\n\t\tif (inode) {\n\t\t\taudit_log_format(ab, \" dev=\");\n\t\t\taudit_log_untrustedstring(ab, inode->i_sb->s_id);\n\t\t\taudit_log_format(ab, \" ino=%lu\", inode->i_ino);\n\t\t}\n\t\tbreak;\n\t}\n\tcase LSM_AUDIT_DATA_IOCTL_OP: {\n\t\tstruct inode *inode;\n\n\t\taudit_log_d_path(ab, \" path=\", &a->u.op->path);\n\n\t\tinode = a->u.op->path.dentry->d_inode;\n\t\tif (inode) {\n\t\t\taudit_log_format(ab, \" dev=\");\n\t\t\taudit_log_untrustedstring(ab, inode->i_sb->s_id);\n\t\t\taudit_log_format(ab, \" ino=%lu\", inode->i_ino);\n\t\t}\n\n\t\taudit_log_format(ab, \" ioctlcmd=0x%hx\", a->u.op->cmd);\n\t\tbreak;\n\t}\n\tcase LSM_AUDIT_DATA_DENTRY: {\n\t\tstruct inode *inode;\n\n\t\taudit_log_format(ab, \" name=\");\n\t\taudit_log_untrustedstring(ab, a->u.dentry->d_name.name);\n\n\t\tinode = d_backing_inode(a->u.dentry);\n\t\tif (inode) {\n\t\t\taudit_log_format(ab, \" dev=\");\n\t\t\taudit_log_untrustedstring(ab, inode->i_sb->s_id);\n\t\t\taudit_log_format(ab, \" ino=%lu\", inode->i_ino);\n\t\t}\n\t\tbreak;\n\t}\n\tcase LSM_AUDIT_DATA_INODE: {\n\t\tstruct dentry *dentry;\n\t\tstruct inode *inode;\n\n\t\tinode = a->u.inode;\n\t\tdentry = d_find_alias(inode);\n\t\tif (dentry) {\n\t\t\taudit_log_format(ab, \" name=\");\n\t\t\taudit_log_untrustedstring(ab,\n\t\t\t\t\t dentry->d_name.name);\n\t\t\tdput(dentry);\n\t\t}\n\t\taudit_log_format(ab, \" dev=\");\n\t\taudit_log_untrustedstring(ab, inode->i_sb->s_id);\n\t\taudit_log_format(ab, \" ino=%lu\", inode->i_ino);\n\t\tbreak;\n\t}\n\tcase LSM_AUDIT_DATA_TASK: {\n\t\tstruct task_struct *tsk = a->u.tsk;\n\t\tif (tsk) {\n\t\t\tpid_t pid = task_tgid_nr(tsk);\n\t\t\tif (pid) {\n\t\t\t\tchar comm[sizeof(tsk->comm)];\n\t\t\t\taudit_log_format(ab, \" opid=%d ocomm=\", pid);\n\t\t\t\taudit_log_untrustedstring(ab,\n\t\t\t\t    memcpy(comm, tsk->comm, sizeof(comm)));\n\t\t\t}\n\t\t}\n\t\tbreak;\n\t}\n\tcase LSM_AUDIT_DATA_NET:\n\t\tif (a->u.net->sk) {\n\t\t\tstruct sock *sk = a->u.net->sk;\n\t\t\tstruct unix_sock *u;\n\t\t\tint len = 0;\n\t\t\tchar *p = NULL;\n\n\t\t\tswitch (sk->sk_family) {\n\t\t\tcase AF_INET: {\n\t\t\t\tstruct inet_sock *inet = inet_sk(sk);\n\n\t\t\t\tprint_ipv4_addr(ab, inet->inet_rcv_saddr,\n\t\t\t\t\t\tinet->inet_sport,\n\t\t\t\t\t\t\"laddr\", \"lport\");\n\t\t\t\tprint_ipv4_addr(ab, inet->inet_daddr,\n\t\t\t\t\t\tinet->inet_dport,\n\t\t\t\t\t\t\"faddr\", \"fport\");\n\t\t\t\tbreak;\n\t\t\t}\n#if IS_ENABLED(CONFIG_IPV6)\n\t\t\tcase AF_INET6: {\n\t\t\t\tstruct inet_sock *inet = inet_sk(sk);\n\n\t\t\t\tprint_ipv6_addr(ab, &sk->sk_v6_rcv_saddr,\n\t\t\t\t\t\tinet->inet_sport,\n\t\t\t\t\t\t\"laddr\", \"lport\");\n\t\t\t\tprint_ipv6_addr(ab, &sk->sk_v6_daddr,\n\t\t\t\t\t\tinet->inet_dport,\n\t\t\t\t\t\t\"faddr\", \"fport\");\n\t\t\t\tbreak;\n\t\t\t}\n#endif\n\t\t\tcase AF_UNIX:\n\t\t\t\tu = unix_sk(sk);\n\t\t\t\tif (u->path.dentry) {\n\t\t\t\t\taudit_log_d_path(ab, \" path=\", &u->path);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tif (!u->addr)\n\t\t\t\t\tbreak;\n\t\t\t\tlen = u->addr->len-sizeof(short);\n\t\t\t\tp = &u->addr->name->sun_path[0];\n\t\t\t\taudit_log_format(ab, \" path=\");\n\t\t\t\tif (*p)\n\t\t\t\t\taudit_log_untrustedstring(ab, p);\n\t\t\t\telse\n\t\t\t\t\taudit_log_n_hex(ab, p, len);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tswitch (a->u.net->family) {\n\t\tcase AF_INET:\n\t\t\tprint_ipv4_addr(ab, a->u.net->v4info.saddr,\n\t\t\t\t\ta->u.net->sport,\n\t\t\t\t\t\"saddr\", \"src\");\n\t\t\tprint_ipv4_addr(ab, a->u.net->v4info.daddr,\n\t\t\t\t\ta->u.net->dport,\n\t\t\t\t\t\"daddr\", \"dest\");\n\t\t\tbreak;\n\t\tcase AF_INET6:\n\t\t\tprint_ipv6_addr(ab, &a->u.net->v6info.saddr,\n\t\t\t\t\ta->u.net->sport,\n\t\t\t\t\t\"saddr\", \"src\");\n\t\t\tprint_ipv6_addr(ab, &a->u.net->v6info.daddr,\n\t\t\t\t\ta->u.net->dport,\n\t\t\t\t\t\"daddr\", \"dest\");\n\t\t\tbreak;\n\t\t}\n\t\tif (a->u.net->netif > 0) {\n\t\t\tstruct net_device *dev;\n\n\t\t\t/* NOTE: we always use init's namespace */\n\t\t\tdev = dev_get_by_index(&init_net, a->u.net->netif);\n\t\t\tif (dev) {\n\t\t\t\taudit_log_format(ab, \" netif=%s\", dev->name);\n\t\t\t\tdev_put(dev);\n\t\t\t}\n\t\t}\n\t\tbreak;\n#ifdef CONFIG_KEYS\n\tcase LSM_AUDIT_DATA_KEY:\n\t\taudit_log_format(ab, \" key_serial=%u\", a->u.key_struct.key);\n\t\tif (a->u.key_struct.key_desc) {\n\t\t\taudit_log_format(ab, \" key_desc=\");\n\t\t\taudit_log_untrustedstring(ab, a->u.key_struct.key_desc);\n\t\t}\n\t\tbreak;\n#endif\n\tcase LSM_AUDIT_DATA_KMOD:\n\t\taudit_log_format(ab, \" kmod=\");\n\t\taudit_log_untrustedstring(ab, a->u.kmod_name);\n\t\tbreak;\n\tcase LSM_AUDIT_DATA_IBPKEY: {\n\t\tstruct in6_addr sbn_pfx;\n\n\t\tmemset(&sbn_pfx.s6_addr, 0,\n\t\t       sizeof(sbn_pfx.s6_addr));\n\t\tmemcpy(&sbn_pfx.s6_addr, &a->u.ibpkey->subnet_prefix,\n\t\t       sizeof(a->u.ibpkey->subnet_prefix));\n\t\taudit_log_format(ab, \" pkey=0x%x subnet_prefix=%pI6c\",\n\t\t\t\t a->u.ibpkey->pkey, &sbn_pfx);\n\t\tbreak;\n\t}\n\tcase LSM_AUDIT_DATA_IBENDPORT:\n\t\taudit_log_format(ab, \" device=%s port_num=%u\",\n\t\t\t\t a->u.ibendport->dev_name,\n\t\t\t\t a->u.ibendport->port);\n\t\tbreak;\n\t} /* switch (a->type) */\n}",
          "includes": [
            "#include <linux/lsm_audit.h>",
            "#include <linux/sctp.h>",
            "#include <linux/dccp.h>",
            "#include <linux/udp.h>",
            "#include <linux/tcp.h>",
            "#include <net/ipv6.h>",
            "#include <net/ip.h>",
            "#include <linux/ip.h>",
            "#include <linux/ipv6.h>",
            "#include <linux/audit.h>",
            "#include <net/af_unix.h>",
            "#include <linux/un.h>",
            "#include <net/sock.h>",
            "#include <linux/init.h>",
            "#include <linux/fs.h>",
            "#include <linux/gfp.h>",
            "#include <linux/kernel.h>",
            "#include <linux/stddef.h>",
            "#include <linux/types.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/lsm_audit.h>\n#include <linux/sctp.h>\n#include <linux/dccp.h>\n#include <linux/udp.h>\n#include <linux/tcp.h>\n#include <net/ipv6.h>\n#include <net/ip.h>\n#include <linux/ip.h>\n#include <linux/ipv6.h>\n#include <linux/audit.h>\n#include <net/af_unix.h>\n#include <linux/un.h>\n#include <net/sock.h>\n#include <linux/init.h>\n#include <linux/fs.h>\n#include <linux/gfp.h>\n#include <linux/kernel.h>\n#include <linux/stddef.h>\n#include <linux/types.h>\n\nstatic void dump_common_audit_data(struct audit_buffer *ab,\n\t\t\t\t   struct common_audit_data *a)\n{\n\tchar comm[sizeof(current->comm)];\n\n\t/*\n\t * To keep stack sizes in check force programers to notice if they\n\t * start making this union too large!  See struct lsm_network_audit\n\t * as an example of how to deal with large data.\n\t */\n\tBUILD_BUG_ON(sizeof(a->u) > sizeof(void *)*2);\n\n\taudit_log_format(ab, \" pid=%d comm=\", task_tgid_nr(current));\n\taudit_log_untrustedstring(ab, memcpy(comm, current->comm, sizeof(comm)));\n\n\tswitch (a->type) {\n\tcase LSM_AUDIT_DATA_NONE:\n\t\treturn;\n\tcase LSM_AUDIT_DATA_IPC:\n\t\taudit_log_format(ab, \" key=%d \", a->u.ipc_id);\n\t\tbreak;\n\tcase LSM_AUDIT_DATA_CAP:\n\t\taudit_log_format(ab, \" capability=%d \", a->u.cap);\n\t\tbreak;\n\tcase LSM_AUDIT_DATA_PATH: {\n\t\tstruct inode *inode;\n\n\t\taudit_log_d_path(ab, \" path=\", &a->u.path);\n\n\t\tinode = d_backing_inode(a->u.path.dentry);\n\t\tif (inode) {\n\t\t\taudit_log_format(ab, \" dev=\");\n\t\t\taudit_log_untrustedstring(ab, inode->i_sb->s_id);\n\t\t\taudit_log_format(ab, \" ino=%lu\", inode->i_ino);\n\t\t}\n\t\tbreak;\n\t}\n\tcase LSM_AUDIT_DATA_FILE: {\n\t\tstruct inode *inode;\n\n\t\taudit_log_d_path(ab, \" path=\", &a->u.file->f_path);\n\n\t\tinode = file_inode(a->u.file);\n\t\tif (inode) {\n\t\t\taudit_log_format(ab, \" dev=\");\n\t\t\taudit_log_untrustedstring(ab, inode->i_sb->s_id);\n\t\t\taudit_log_format(ab, \" ino=%lu\", inode->i_ino);\n\t\t}\n\t\tbreak;\n\t}\n\tcase LSM_AUDIT_DATA_IOCTL_OP: {\n\t\tstruct inode *inode;\n\n\t\taudit_log_d_path(ab, \" path=\", &a->u.op->path);\n\n\t\tinode = a->u.op->path.dentry->d_inode;\n\t\tif (inode) {\n\t\t\taudit_log_format(ab, \" dev=\");\n\t\t\taudit_log_untrustedstring(ab, inode->i_sb->s_id);\n\t\t\taudit_log_format(ab, \" ino=%lu\", inode->i_ino);\n\t\t}\n\n\t\taudit_log_format(ab, \" ioctlcmd=0x%hx\", a->u.op->cmd);\n\t\tbreak;\n\t}\n\tcase LSM_AUDIT_DATA_DENTRY: {\n\t\tstruct inode *inode;\n\n\t\taudit_log_format(ab, \" name=\");\n\t\taudit_log_untrustedstring(ab, a->u.dentry->d_name.name);\n\n\t\tinode = d_backing_inode(a->u.dentry);\n\t\tif (inode) {\n\t\t\taudit_log_format(ab, \" dev=\");\n\t\t\taudit_log_untrustedstring(ab, inode->i_sb->s_id);\n\t\t\taudit_log_format(ab, \" ino=%lu\", inode->i_ino);\n\t\t}\n\t\tbreak;\n\t}\n\tcase LSM_AUDIT_DATA_INODE: {\n\t\tstruct dentry *dentry;\n\t\tstruct inode *inode;\n\n\t\tinode = a->u.inode;\n\t\tdentry = d_find_alias(inode);\n\t\tif (dentry) {\n\t\t\taudit_log_format(ab, \" name=\");\n\t\t\taudit_log_untrustedstring(ab,\n\t\t\t\t\t dentry->d_name.name);\n\t\t\tdput(dentry);\n\t\t}\n\t\taudit_log_format(ab, \" dev=\");\n\t\taudit_log_untrustedstring(ab, inode->i_sb->s_id);\n\t\taudit_log_format(ab, \" ino=%lu\", inode->i_ino);\n\t\tbreak;\n\t}\n\tcase LSM_AUDIT_DATA_TASK: {\n\t\tstruct task_struct *tsk = a->u.tsk;\n\t\tif (tsk) {\n\t\t\tpid_t pid = task_tgid_nr(tsk);\n\t\t\tif (pid) {\n\t\t\t\tchar comm[sizeof(tsk->comm)];\n\t\t\t\taudit_log_format(ab, \" opid=%d ocomm=\", pid);\n\t\t\t\taudit_log_untrustedstring(ab,\n\t\t\t\t    memcpy(comm, tsk->comm, sizeof(comm)));\n\t\t\t}\n\t\t}\n\t\tbreak;\n\t}\n\tcase LSM_AUDIT_DATA_NET:\n\t\tif (a->u.net->sk) {\n\t\t\tstruct sock *sk = a->u.net->sk;\n\t\t\tstruct unix_sock *u;\n\t\t\tint len = 0;\n\t\t\tchar *p = NULL;\n\n\t\t\tswitch (sk->sk_family) {\n\t\t\tcase AF_INET: {\n\t\t\t\tstruct inet_sock *inet = inet_sk(sk);\n\n\t\t\t\tprint_ipv4_addr(ab, inet->inet_rcv_saddr,\n\t\t\t\t\t\tinet->inet_sport,\n\t\t\t\t\t\t\"laddr\", \"lport\");\n\t\t\t\tprint_ipv4_addr(ab, inet->inet_daddr,\n\t\t\t\t\t\tinet->inet_dport,\n\t\t\t\t\t\t\"faddr\", \"fport\");\n\t\t\t\tbreak;\n\t\t\t}\n#if IS_ENABLED(CONFIG_IPV6)\n\t\t\tcase AF_INET6: {\n\t\t\t\tstruct inet_sock *inet = inet_sk(sk);\n\n\t\t\t\tprint_ipv6_addr(ab, &sk->sk_v6_rcv_saddr,\n\t\t\t\t\t\tinet->inet_sport,\n\t\t\t\t\t\t\"laddr\", \"lport\");\n\t\t\t\tprint_ipv6_addr(ab, &sk->sk_v6_daddr,\n\t\t\t\t\t\tinet->inet_dport,\n\t\t\t\t\t\t\"faddr\", \"fport\");\n\t\t\t\tbreak;\n\t\t\t}\n#endif\n\t\t\tcase AF_UNIX:\n\t\t\t\tu = unix_sk(sk);\n\t\t\t\tif (u->path.dentry) {\n\t\t\t\t\taudit_log_d_path(ab, \" path=\", &u->path);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tif (!u->addr)\n\t\t\t\t\tbreak;\n\t\t\t\tlen = u->addr->len-sizeof(short);\n\t\t\t\tp = &u->addr->name->sun_path[0];\n\t\t\t\taudit_log_format(ab, \" path=\");\n\t\t\t\tif (*p)\n\t\t\t\t\taudit_log_untrustedstring(ab, p);\n\t\t\t\telse\n\t\t\t\t\taudit_log_n_hex(ab, p, len);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tswitch (a->u.net->family) {\n\t\tcase AF_INET:\n\t\t\tprint_ipv4_addr(ab, a->u.net->v4info.saddr,\n\t\t\t\t\ta->u.net->sport,\n\t\t\t\t\t\"saddr\", \"src\");\n\t\t\tprint_ipv4_addr(ab, a->u.net->v4info.daddr,\n\t\t\t\t\ta->u.net->dport,\n\t\t\t\t\t\"daddr\", \"dest\");\n\t\t\tbreak;\n\t\tcase AF_INET6:\n\t\t\tprint_ipv6_addr(ab, &a->u.net->v6info.saddr,\n\t\t\t\t\ta->u.net->sport,\n\t\t\t\t\t\"saddr\", \"src\");\n\t\t\tprint_ipv6_addr(ab, &a->u.net->v6info.daddr,\n\t\t\t\t\ta->u.net->dport,\n\t\t\t\t\t\"daddr\", \"dest\");\n\t\t\tbreak;\n\t\t}\n\t\tif (a->u.net->netif > 0) {\n\t\t\tstruct net_device *dev;\n\n\t\t\t/* NOTE: we always use init's namespace */\n\t\t\tdev = dev_get_by_index(&init_net, a->u.net->netif);\n\t\t\tif (dev) {\n\t\t\t\taudit_log_format(ab, \" netif=%s\", dev->name);\n\t\t\t\tdev_put(dev);\n\t\t\t}\n\t\t}\n\t\tbreak;\n#ifdef CONFIG_KEYS\n\tcase LSM_AUDIT_DATA_KEY:\n\t\taudit_log_format(ab, \" key_serial=%u\", a->u.key_struct.key);\n\t\tif (a->u.key_struct.key_desc) {\n\t\t\taudit_log_format(ab, \" key_desc=\");\n\t\t\taudit_log_untrustedstring(ab, a->u.key_struct.key_desc);\n\t\t}\n\t\tbreak;\n#endif\n\tcase LSM_AUDIT_DATA_KMOD:\n\t\taudit_log_format(ab, \" kmod=\");\n\t\taudit_log_untrustedstring(ab, a->u.kmod_name);\n\t\tbreak;\n\tcase LSM_AUDIT_DATA_IBPKEY: {\n\t\tstruct in6_addr sbn_pfx;\n\n\t\tmemset(&sbn_pfx.s6_addr, 0,\n\t\t       sizeof(sbn_pfx.s6_addr));\n\t\tmemcpy(&sbn_pfx.s6_addr, &a->u.ibpkey->subnet_prefix,\n\t\t       sizeof(a->u.ibpkey->subnet_prefix));\n\t\taudit_log_format(ab, \" pkey=0x%x subnet_prefix=%pI6c\",\n\t\t\t\t a->u.ibpkey->pkey, &sbn_pfx);\n\t\tbreak;\n\t}\n\tcase LSM_AUDIT_DATA_IBENDPORT:\n\t\taudit_log_format(ab, \" device=%s port_num=%u\",\n\t\t\t\t a->u.ibendport->dev_name,\n\t\t\t\t a->u.ibendport->port);\n\t\tbreak;\n\t} /* switch (a->type) */\n}"
        }
      },
      {
        "call_info": {
          "callee": "pre_audit",
          "args": [
            "ab",
            "a"
          ],
          "line": 457
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "audit_log_start",
          "args": [
            "current->audit_context",
            "GFP_ATOMIC | __GFP_NOWARN",
            "AUDIT_AVC"
          ],
          "line": 450
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <linux/lsm_audit.h>\n#include <linux/sctp.h>\n#include <linux/dccp.h>\n#include <linux/udp.h>\n#include <linux/tcp.h>\n#include <net/ipv6.h>\n#include <net/ip.h>\n#include <linux/ip.h>\n#include <linux/ipv6.h>\n#include <linux/audit.h>\n#include <net/af_unix.h>\n#include <linux/un.h>\n#include <net/sock.h>\n#include <linux/init.h>\n#include <linux/fs.h>\n#include <linux/gfp.h>\n#include <linux/kernel.h>\n#include <linux/stddef.h>\n#include <linux/types.h>\n\nvoid common_lsm_audit(struct common_audit_data *a,\n\tvoid (*pre_audit)(struct audit_buffer *, void *),\n\tvoid (*post_audit)(struct audit_buffer *, void *))\n{\n\tstruct audit_buffer *ab;\n\n\tif (a == NULL)\n\t\treturn;\n\t/* we use GFP_ATOMIC so we won't sleep */\n\tab = audit_log_start(current->audit_context, GFP_ATOMIC | __GFP_NOWARN,\n\t\t\t     AUDIT_AVC);\n\n\tif (ab == NULL)\n\t\treturn;\n\n\tif (pre_audit)\n\t\tpre_audit(ab, a);\n\n\tdump_common_audit_data(ab, a);\n\n\tif (post_audit)\n\t\tpost_audit(ab, a);\n\n\taudit_log_end(ab);\n}"
  },
  {
    "function_name": "dump_common_audit_data",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/lsm_audit.c",
    "lines": "211-430",
    "snippet": "static void dump_common_audit_data(struct audit_buffer *ab,\n\t\t\t\t   struct common_audit_data *a)\n{\n\tchar comm[sizeof(current->comm)];\n\n\t/*\n\t * To keep stack sizes in check force programers to notice if they\n\t * start making this union too large!  See struct lsm_network_audit\n\t * as an example of how to deal with large data.\n\t */\n\tBUILD_BUG_ON(sizeof(a->u) > sizeof(void *)*2);\n\n\taudit_log_format(ab, \" pid=%d comm=\", task_tgid_nr(current));\n\taudit_log_untrustedstring(ab, memcpy(comm, current->comm, sizeof(comm)));\n\n\tswitch (a->type) {\n\tcase LSM_AUDIT_DATA_NONE:\n\t\treturn;\n\tcase LSM_AUDIT_DATA_IPC:\n\t\taudit_log_format(ab, \" key=%d \", a->u.ipc_id);\n\t\tbreak;\n\tcase LSM_AUDIT_DATA_CAP:\n\t\taudit_log_format(ab, \" capability=%d \", a->u.cap);\n\t\tbreak;\n\tcase LSM_AUDIT_DATA_PATH: {\n\t\tstruct inode *inode;\n\n\t\taudit_log_d_path(ab, \" path=\", &a->u.path);\n\n\t\tinode = d_backing_inode(a->u.path.dentry);\n\t\tif (inode) {\n\t\t\taudit_log_format(ab, \" dev=\");\n\t\t\taudit_log_untrustedstring(ab, inode->i_sb->s_id);\n\t\t\taudit_log_format(ab, \" ino=%lu\", inode->i_ino);\n\t\t}\n\t\tbreak;\n\t}\n\tcase LSM_AUDIT_DATA_FILE: {\n\t\tstruct inode *inode;\n\n\t\taudit_log_d_path(ab, \" path=\", &a->u.file->f_path);\n\n\t\tinode = file_inode(a->u.file);\n\t\tif (inode) {\n\t\t\taudit_log_format(ab, \" dev=\");\n\t\t\taudit_log_untrustedstring(ab, inode->i_sb->s_id);\n\t\t\taudit_log_format(ab, \" ino=%lu\", inode->i_ino);\n\t\t}\n\t\tbreak;\n\t}\n\tcase LSM_AUDIT_DATA_IOCTL_OP: {\n\t\tstruct inode *inode;\n\n\t\taudit_log_d_path(ab, \" path=\", &a->u.op->path);\n\n\t\tinode = a->u.op->path.dentry->d_inode;\n\t\tif (inode) {\n\t\t\taudit_log_format(ab, \" dev=\");\n\t\t\taudit_log_untrustedstring(ab, inode->i_sb->s_id);\n\t\t\taudit_log_format(ab, \" ino=%lu\", inode->i_ino);\n\t\t}\n\n\t\taudit_log_format(ab, \" ioctlcmd=0x%hx\", a->u.op->cmd);\n\t\tbreak;\n\t}\n\tcase LSM_AUDIT_DATA_DENTRY: {\n\t\tstruct inode *inode;\n\n\t\taudit_log_format(ab, \" name=\");\n\t\taudit_log_untrustedstring(ab, a->u.dentry->d_name.name);\n\n\t\tinode = d_backing_inode(a->u.dentry);\n\t\tif (inode) {\n\t\t\taudit_log_format(ab, \" dev=\");\n\t\t\taudit_log_untrustedstring(ab, inode->i_sb->s_id);\n\t\t\taudit_log_format(ab, \" ino=%lu\", inode->i_ino);\n\t\t}\n\t\tbreak;\n\t}\n\tcase LSM_AUDIT_DATA_INODE: {\n\t\tstruct dentry *dentry;\n\t\tstruct inode *inode;\n\n\t\tinode = a->u.inode;\n\t\tdentry = d_find_alias(inode);\n\t\tif (dentry) {\n\t\t\taudit_log_format(ab, \" name=\");\n\t\t\taudit_log_untrustedstring(ab,\n\t\t\t\t\t dentry->d_name.name);\n\t\t\tdput(dentry);\n\t\t}\n\t\taudit_log_format(ab, \" dev=\");\n\t\taudit_log_untrustedstring(ab, inode->i_sb->s_id);\n\t\taudit_log_format(ab, \" ino=%lu\", inode->i_ino);\n\t\tbreak;\n\t}\n\tcase LSM_AUDIT_DATA_TASK: {\n\t\tstruct task_struct *tsk = a->u.tsk;\n\t\tif (tsk) {\n\t\t\tpid_t pid = task_tgid_nr(tsk);\n\t\t\tif (pid) {\n\t\t\t\tchar comm[sizeof(tsk->comm)];\n\t\t\t\taudit_log_format(ab, \" opid=%d ocomm=\", pid);\n\t\t\t\taudit_log_untrustedstring(ab,\n\t\t\t\t    memcpy(comm, tsk->comm, sizeof(comm)));\n\t\t\t}\n\t\t}\n\t\tbreak;\n\t}\n\tcase LSM_AUDIT_DATA_NET:\n\t\tif (a->u.net->sk) {\n\t\t\tstruct sock *sk = a->u.net->sk;\n\t\t\tstruct unix_sock *u;\n\t\t\tint len = 0;\n\t\t\tchar *p = NULL;\n\n\t\t\tswitch (sk->sk_family) {\n\t\t\tcase AF_INET: {\n\t\t\t\tstruct inet_sock *inet = inet_sk(sk);\n\n\t\t\t\tprint_ipv4_addr(ab, inet->inet_rcv_saddr,\n\t\t\t\t\t\tinet->inet_sport,\n\t\t\t\t\t\t\"laddr\", \"lport\");\n\t\t\t\tprint_ipv4_addr(ab, inet->inet_daddr,\n\t\t\t\t\t\tinet->inet_dport,\n\t\t\t\t\t\t\"faddr\", \"fport\");\n\t\t\t\tbreak;\n\t\t\t}\n#if IS_ENABLED(CONFIG_IPV6)\n\t\t\tcase AF_INET6: {\n\t\t\t\tstruct inet_sock *inet = inet_sk(sk);\n\n\t\t\t\tprint_ipv6_addr(ab, &sk->sk_v6_rcv_saddr,\n\t\t\t\t\t\tinet->inet_sport,\n\t\t\t\t\t\t\"laddr\", \"lport\");\n\t\t\t\tprint_ipv6_addr(ab, &sk->sk_v6_daddr,\n\t\t\t\t\t\tinet->inet_dport,\n\t\t\t\t\t\t\"faddr\", \"fport\");\n\t\t\t\tbreak;\n\t\t\t}\n#endif\n\t\t\tcase AF_UNIX:\n\t\t\t\tu = unix_sk(sk);\n\t\t\t\tif (u->path.dentry) {\n\t\t\t\t\taudit_log_d_path(ab, \" path=\", &u->path);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tif (!u->addr)\n\t\t\t\t\tbreak;\n\t\t\t\tlen = u->addr->len-sizeof(short);\n\t\t\t\tp = &u->addr->name->sun_path[0];\n\t\t\t\taudit_log_format(ab, \" path=\");\n\t\t\t\tif (*p)\n\t\t\t\t\taudit_log_untrustedstring(ab, p);\n\t\t\t\telse\n\t\t\t\t\taudit_log_n_hex(ab, p, len);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tswitch (a->u.net->family) {\n\t\tcase AF_INET:\n\t\t\tprint_ipv4_addr(ab, a->u.net->v4info.saddr,\n\t\t\t\t\ta->u.net->sport,\n\t\t\t\t\t\"saddr\", \"src\");\n\t\t\tprint_ipv4_addr(ab, a->u.net->v4info.daddr,\n\t\t\t\t\ta->u.net->dport,\n\t\t\t\t\t\"daddr\", \"dest\");\n\t\t\tbreak;\n\t\tcase AF_INET6:\n\t\t\tprint_ipv6_addr(ab, &a->u.net->v6info.saddr,\n\t\t\t\t\ta->u.net->sport,\n\t\t\t\t\t\"saddr\", \"src\");\n\t\t\tprint_ipv6_addr(ab, &a->u.net->v6info.daddr,\n\t\t\t\t\ta->u.net->dport,\n\t\t\t\t\t\"daddr\", \"dest\");\n\t\t\tbreak;\n\t\t}\n\t\tif (a->u.net->netif > 0) {\n\t\t\tstruct net_device *dev;\n\n\t\t\t/* NOTE: we always use init's namespace */\n\t\t\tdev = dev_get_by_index(&init_net, a->u.net->netif);\n\t\t\tif (dev) {\n\t\t\t\taudit_log_format(ab, \" netif=%s\", dev->name);\n\t\t\t\tdev_put(dev);\n\t\t\t}\n\t\t}\n\t\tbreak;\n#ifdef CONFIG_KEYS\n\tcase LSM_AUDIT_DATA_KEY:\n\t\taudit_log_format(ab, \" key_serial=%u\", a->u.key_struct.key);\n\t\tif (a->u.key_struct.key_desc) {\n\t\t\taudit_log_format(ab, \" key_desc=\");\n\t\t\taudit_log_untrustedstring(ab, a->u.key_struct.key_desc);\n\t\t}\n\t\tbreak;\n#endif\n\tcase LSM_AUDIT_DATA_KMOD:\n\t\taudit_log_format(ab, \" kmod=\");\n\t\taudit_log_untrustedstring(ab, a->u.kmod_name);\n\t\tbreak;\n\tcase LSM_AUDIT_DATA_IBPKEY: {\n\t\tstruct in6_addr sbn_pfx;\n\n\t\tmemset(&sbn_pfx.s6_addr, 0,\n\t\t       sizeof(sbn_pfx.s6_addr));\n\t\tmemcpy(&sbn_pfx.s6_addr, &a->u.ibpkey->subnet_prefix,\n\t\t       sizeof(a->u.ibpkey->subnet_prefix));\n\t\taudit_log_format(ab, \" pkey=0x%x subnet_prefix=%pI6c\",\n\t\t\t\t a->u.ibpkey->pkey, &sbn_pfx);\n\t\tbreak;\n\t}\n\tcase LSM_AUDIT_DATA_IBENDPORT:\n\t\taudit_log_format(ab, \" device=%s port_num=%u\",\n\t\t\t\t a->u.ibendport->dev_name,\n\t\t\t\t a->u.ibendport->port);\n\t\tbreak;\n\t} /* switch (a->type) */\n}",
    "includes": [
      "#include <linux/lsm_audit.h>",
      "#include <linux/sctp.h>",
      "#include <linux/dccp.h>",
      "#include <linux/udp.h>",
      "#include <linux/tcp.h>",
      "#include <net/ipv6.h>",
      "#include <net/ip.h>",
      "#include <linux/ip.h>",
      "#include <linux/ipv6.h>",
      "#include <linux/audit.h>",
      "#include <net/af_unix.h>",
      "#include <linux/un.h>",
      "#include <net/sock.h>",
      "#include <linux/init.h>",
      "#include <linux/fs.h>",
      "#include <linux/gfp.h>",
      "#include <linux/kernel.h>",
      "#include <linux/stddef.h>",
      "#include <linux/types.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "audit_log_format",
          "args": [
            "ab",
            "\" device=%s port_num=%u\"",
            "a->u.ibendport->dev_name",
            "a->u.ibendport->port"
          ],
          "line": 425
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "audit_log_format",
          "args": [
            "ab",
            "\" pkey=0x%x subnet_prefix=%pI6c\"",
            "a->u.ibpkey->pkey",
            "&sbn_pfx"
          ],
          "line": 420
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memcpy",
          "args": [
            "&sbn_pfx.s6_addr",
            "&a->u.ibpkey->subnet_prefix",
            "sizeof(a->u.ibpkey->subnet_prefix)"
          ],
          "line": 418
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memset",
          "args": [
            "&sbn_pfx.s6_addr",
            "0",
            "sizeof(sbn_pfx.s6_addr)"
          ],
          "line": 416
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "audit_log_untrustedstring",
          "args": [
            "ab",
            "a->u.kmod_name"
          ],
          "line": 411
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "audit_log_format",
          "args": [
            "ab",
            "\" kmod=\""
          ],
          "line": 410
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "audit_log_untrustedstring",
          "args": [
            "ab",
            "a->u.key_struct.key_desc"
          ],
          "line": 405
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "audit_log_format",
          "args": [
            "ab",
            "\" key_desc=\""
          ],
          "line": 404
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "audit_log_format",
          "args": [
            "ab",
            "\" key_serial=%u\"",
            "a->u.key_struct.key"
          ],
          "line": 402
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dev_put",
          "args": [
            "dev"
          ],
          "line": 396
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "audit_log_format",
          "args": [
            "ab",
            "\" netif=%s\"",
            "dev->name"
          ],
          "line": 395
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dev_get_by_index",
          "args": [
            "&init_net",
            "a->u.net->netif"
          ],
          "line": 393
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "print_ipv6_addr",
          "args": [
            "ab",
            "&a->u.net->v6info.daddr",
            "a->u.net->dport",
            "\"daddr\"",
            "\"dest\""
          ],
          "line": 384
        },
        "resolved": true,
        "details": {
          "function_name": "print_ipv6_addr",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/lsm_audit.c",
          "lines": "187-195",
          "snippet": "static inline void print_ipv6_addr(struct audit_buffer *ab,\n\t\t\t\t   struct in6_addr *addr, __be16 port,\n\t\t\t\t   char *name1, char *name2)\n{\n\tif (!ipv6_addr_any(addr))\n\t\taudit_log_format(ab, \" %s=%pI6c\", name1, addr);\n\tif (port)\n\t\taudit_log_format(ab, \" %s=%d\", name2, ntohs(port));\n}",
          "includes": [
            "#include <linux/lsm_audit.h>",
            "#include <linux/sctp.h>",
            "#include <linux/dccp.h>",
            "#include <linux/udp.h>",
            "#include <linux/tcp.h>",
            "#include <net/ipv6.h>",
            "#include <net/ip.h>",
            "#include <linux/ip.h>",
            "#include <linux/ipv6.h>",
            "#include <linux/audit.h>",
            "#include <net/af_unix.h>",
            "#include <linux/un.h>",
            "#include <net/sock.h>",
            "#include <linux/init.h>",
            "#include <linux/fs.h>",
            "#include <linux/gfp.h>",
            "#include <linux/kernel.h>",
            "#include <linux/stddef.h>",
            "#include <linux/types.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/lsm_audit.h>\n#include <linux/sctp.h>\n#include <linux/dccp.h>\n#include <linux/udp.h>\n#include <linux/tcp.h>\n#include <net/ipv6.h>\n#include <net/ip.h>\n#include <linux/ip.h>\n#include <linux/ipv6.h>\n#include <linux/audit.h>\n#include <net/af_unix.h>\n#include <linux/un.h>\n#include <net/sock.h>\n#include <linux/init.h>\n#include <linux/fs.h>\n#include <linux/gfp.h>\n#include <linux/kernel.h>\n#include <linux/stddef.h>\n#include <linux/types.h>\n\nstatic inline void print_ipv6_addr(struct audit_buffer *ab,\n\t\t\t\t   struct in6_addr *addr, __be16 port,\n\t\t\t\t   char *name1, char *name2)\n{\n\tif (!ipv6_addr_any(addr))\n\t\taudit_log_format(ab, \" %s=%pI6c\", name1, addr);\n\tif (port)\n\t\taudit_log_format(ab, \" %s=%d\", name2, ntohs(port));\n}"
        }
      },
      {
        "call_info": {
          "callee": "print_ipv4_addr",
          "args": [
            "ab",
            "a->u.net->v4info.daddr",
            "a->u.net->dport",
            "\"daddr\"",
            "\"dest\""
          ],
          "line": 376
        },
        "resolved": true,
        "details": {
          "function_name": "print_ipv4_addr",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/lsm_audit.c",
          "lines": "197-204",
          "snippet": "static inline void print_ipv4_addr(struct audit_buffer *ab, __be32 addr,\n\t\t\t\t   __be16 port, char *name1, char *name2)\n{\n\tif (addr)\n\t\taudit_log_format(ab, \" %s=%pI4\", name1, &addr);\n\tif (port)\n\t\taudit_log_format(ab, \" %s=%d\", name2, ntohs(port));\n}",
          "includes": [
            "#include <linux/lsm_audit.h>",
            "#include <linux/sctp.h>",
            "#include <linux/dccp.h>",
            "#include <linux/udp.h>",
            "#include <linux/tcp.h>",
            "#include <net/ipv6.h>",
            "#include <net/ip.h>",
            "#include <linux/ip.h>",
            "#include <linux/ipv6.h>",
            "#include <linux/audit.h>",
            "#include <net/af_unix.h>",
            "#include <linux/un.h>",
            "#include <net/sock.h>",
            "#include <linux/init.h>",
            "#include <linux/fs.h>",
            "#include <linux/gfp.h>",
            "#include <linux/kernel.h>",
            "#include <linux/stddef.h>",
            "#include <linux/types.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/lsm_audit.h>\n#include <linux/sctp.h>\n#include <linux/dccp.h>\n#include <linux/udp.h>\n#include <linux/tcp.h>\n#include <net/ipv6.h>\n#include <net/ip.h>\n#include <linux/ip.h>\n#include <linux/ipv6.h>\n#include <linux/audit.h>\n#include <net/af_unix.h>\n#include <linux/un.h>\n#include <net/sock.h>\n#include <linux/init.h>\n#include <linux/fs.h>\n#include <linux/gfp.h>\n#include <linux/kernel.h>\n#include <linux/stddef.h>\n#include <linux/types.h>\n\nstatic inline void print_ipv4_addr(struct audit_buffer *ab, __be32 addr,\n\t\t\t\t   __be16 port, char *name1, char *name2)\n{\n\tif (addr)\n\t\taudit_log_format(ab, \" %s=%pI4\", name1, &addr);\n\tif (port)\n\t\taudit_log_format(ab, \" %s=%d\", name2, ntohs(port));\n}"
        }
      },
      {
        "call_info": {
          "callee": "audit_log_n_hex",
          "args": [
            "ab",
            "p",
            "len"
          ],
          "line": 366
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "audit_log_untrustedstring",
          "args": [
            "ab",
            "p"
          ],
          "line": 364
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "audit_log_format",
          "args": [
            "ab",
            "\" path=\""
          ],
          "line": 362
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "audit_log_d_path",
          "args": [
            "ab",
            "\" path=\"",
            "&u->path"
          ],
          "line": 355
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "unix_sk",
          "args": [
            "sk"
          ],
          "line": 353
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "inet_sk",
          "args": [
            "sk"
          ],
          "line": 341
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "IS_ENABLED",
          "args": [
            "CONFIG_IPV6"
          ],
          "line": 339
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "inet_sk",
          "args": [
            "sk"
          ],
          "line": 329
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "audit_log_untrustedstring",
          "args": [
            "ab",
            "memcpy(comm, tsk->comm, sizeof(comm))"
          ],
          "line": 314
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memcpy",
          "args": [
            "comm",
            "tsk->comm",
            "sizeof(comm)"
          ],
          "line": 315
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "audit_log_format",
          "args": [
            "ab",
            "\" opid=%d ocomm=\"",
            "pid"
          ],
          "line": 313
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "task_tgid_nr",
          "args": [
            "tsk"
          ],
          "line": 310
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "audit_log_format",
          "args": [
            "ab",
            "\" ino=%lu\"",
            "inode->i_ino"
          ],
          "line": 304
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "audit_log_untrustedstring",
          "args": [
            "ab",
            "inode->i_sb->s_id"
          ],
          "line": 303
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "audit_log_format",
          "args": [
            "ab",
            "\" dev=\""
          ],
          "line": 302
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dput",
          "args": [
            "dentry"
          ],
          "line": 300
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "audit_log_untrustedstring",
          "args": [
            "ab",
            "dentry->d_name.name"
          ],
          "line": 298
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "audit_log_format",
          "args": [
            "ab",
            "\" name=\""
          ],
          "line": 297
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "d_find_alias",
          "args": [
            "inode"
          ],
          "line": 295
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "audit_log_format",
          "args": [
            "ab",
            "\" ino=%lu\"",
            "inode->i_ino"
          ],
          "line": 286
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "audit_log_untrustedstring",
          "args": [
            "ab",
            "inode->i_sb->s_id"
          ],
          "line": 285
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "audit_log_format",
          "args": [
            "ab",
            "\" dev=\""
          ],
          "line": 284
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "d_backing_inode",
          "args": [
            "a->u.dentry"
          ],
          "line": 282
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "audit_log_untrustedstring",
          "args": [
            "ab",
            "a->u.dentry->d_name.name"
          ],
          "line": 280
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "audit_log_format",
          "args": [
            "ab",
            "\" name=\""
          ],
          "line": 279
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "audit_log_format",
          "args": [
            "ab",
            "\" ioctlcmd=0x%hx\"",
            "a->u.op->cmd"
          ],
          "line": 273
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "audit_log_format",
          "args": [
            "ab",
            "\" ino=%lu\"",
            "inode->i_ino"
          ],
          "line": 270
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "audit_log_untrustedstring",
          "args": [
            "ab",
            "inode->i_sb->s_id"
          ],
          "line": 269
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "audit_log_format",
          "args": [
            "ab",
            "\" dev=\""
          ],
          "line": 268
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "audit_log_d_path",
          "args": [
            "ab",
            "\" path=\"",
            "&a->u.op->path"
          ],
          "line": 264
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "audit_log_format",
          "args": [
            "ab",
            "\" ino=%lu\"",
            "inode->i_ino"
          ],
          "line": 257
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "audit_log_untrustedstring",
          "args": [
            "ab",
            "inode->i_sb->s_id"
          ],
          "line": 256
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "audit_log_format",
          "args": [
            "ab",
            "\" dev=\""
          ],
          "line": 255
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "file_inode",
          "args": [
            "a->u.file"
          ],
          "line": 253
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "audit_log_d_path",
          "args": [
            "ab",
            "\" path=\"",
            "&a->u.file->f_path"
          ],
          "line": 251
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "audit_log_format",
          "args": [
            "ab",
            "\" ino=%lu\"",
            "inode->i_ino"
          ],
          "line": 244
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "audit_log_untrustedstring",
          "args": [
            "ab",
            "inode->i_sb->s_id"
          ],
          "line": 243
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "audit_log_format",
          "args": [
            "ab",
            "\" dev=\""
          ],
          "line": 242
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "d_backing_inode",
          "args": [
            "a->u.path.dentry"
          ],
          "line": 240
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "audit_log_d_path",
          "args": [
            "ab",
            "\" path=\"",
            "&a->u.path"
          ],
          "line": 238
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "audit_log_format",
          "args": [
            "ab",
            "\" capability=%d \"",
            "a->u.cap"
          ],
          "line": 233
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "audit_log_format",
          "args": [
            "ab",
            "\" key=%d \"",
            "a->u.ipc_id"
          ],
          "line": 230
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "audit_log_untrustedstring",
          "args": [
            "ab",
            "memcpy(comm, current->comm, sizeof(comm))"
          ],
          "line": 224
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memcpy",
          "args": [
            "comm",
            "current->comm",
            "sizeof(comm)"
          ],
          "line": 224
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "audit_log_format",
          "args": [
            "ab",
            "\" pid=%d comm=\"",
            "task_tgid_nr(current)"
          ],
          "line": 223
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "task_tgid_nr",
          "args": [
            "current"
          ],
          "line": 223
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "BUILD_BUG_ON",
          "args": [
            "sizeof(a->u) > sizeof(void *)*2"
          ],
          "line": 221
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <linux/lsm_audit.h>\n#include <linux/sctp.h>\n#include <linux/dccp.h>\n#include <linux/udp.h>\n#include <linux/tcp.h>\n#include <net/ipv6.h>\n#include <net/ip.h>\n#include <linux/ip.h>\n#include <linux/ipv6.h>\n#include <linux/audit.h>\n#include <net/af_unix.h>\n#include <linux/un.h>\n#include <net/sock.h>\n#include <linux/init.h>\n#include <linux/fs.h>\n#include <linux/gfp.h>\n#include <linux/kernel.h>\n#include <linux/stddef.h>\n#include <linux/types.h>\n\nstatic void dump_common_audit_data(struct audit_buffer *ab,\n\t\t\t\t   struct common_audit_data *a)\n{\n\tchar comm[sizeof(current->comm)];\n\n\t/*\n\t * To keep stack sizes in check force programers to notice if they\n\t * start making this union too large!  See struct lsm_network_audit\n\t * as an example of how to deal with large data.\n\t */\n\tBUILD_BUG_ON(sizeof(a->u) > sizeof(void *)*2);\n\n\taudit_log_format(ab, \" pid=%d comm=\", task_tgid_nr(current));\n\taudit_log_untrustedstring(ab, memcpy(comm, current->comm, sizeof(comm)));\n\n\tswitch (a->type) {\n\tcase LSM_AUDIT_DATA_NONE:\n\t\treturn;\n\tcase LSM_AUDIT_DATA_IPC:\n\t\taudit_log_format(ab, \" key=%d \", a->u.ipc_id);\n\t\tbreak;\n\tcase LSM_AUDIT_DATA_CAP:\n\t\taudit_log_format(ab, \" capability=%d \", a->u.cap);\n\t\tbreak;\n\tcase LSM_AUDIT_DATA_PATH: {\n\t\tstruct inode *inode;\n\n\t\taudit_log_d_path(ab, \" path=\", &a->u.path);\n\n\t\tinode = d_backing_inode(a->u.path.dentry);\n\t\tif (inode) {\n\t\t\taudit_log_format(ab, \" dev=\");\n\t\t\taudit_log_untrustedstring(ab, inode->i_sb->s_id);\n\t\t\taudit_log_format(ab, \" ino=%lu\", inode->i_ino);\n\t\t}\n\t\tbreak;\n\t}\n\tcase LSM_AUDIT_DATA_FILE: {\n\t\tstruct inode *inode;\n\n\t\taudit_log_d_path(ab, \" path=\", &a->u.file->f_path);\n\n\t\tinode = file_inode(a->u.file);\n\t\tif (inode) {\n\t\t\taudit_log_format(ab, \" dev=\");\n\t\t\taudit_log_untrustedstring(ab, inode->i_sb->s_id);\n\t\t\taudit_log_format(ab, \" ino=%lu\", inode->i_ino);\n\t\t}\n\t\tbreak;\n\t}\n\tcase LSM_AUDIT_DATA_IOCTL_OP: {\n\t\tstruct inode *inode;\n\n\t\taudit_log_d_path(ab, \" path=\", &a->u.op->path);\n\n\t\tinode = a->u.op->path.dentry->d_inode;\n\t\tif (inode) {\n\t\t\taudit_log_format(ab, \" dev=\");\n\t\t\taudit_log_untrustedstring(ab, inode->i_sb->s_id);\n\t\t\taudit_log_format(ab, \" ino=%lu\", inode->i_ino);\n\t\t}\n\n\t\taudit_log_format(ab, \" ioctlcmd=0x%hx\", a->u.op->cmd);\n\t\tbreak;\n\t}\n\tcase LSM_AUDIT_DATA_DENTRY: {\n\t\tstruct inode *inode;\n\n\t\taudit_log_format(ab, \" name=\");\n\t\taudit_log_untrustedstring(ab, a->u.dentry->d_name.name);\n\n\t\tinode = d_backing_inode(a->u.dentry);\n\t\tif (inode) {\n\t\t\taudit_log_format(ab, \" dev=\");\n\t\t\taudit_log_untrustedstring(ab, inode->i_sb->s_id);\n\t\t\taudit_log_format(ab, \" ino=%lu\", inode->i_ino);\n\t\t}\n\t\tbreak;\n\t}\n\tcase LSM_AUDIT_DATA_INODE: {\n\t\tstruct dentry *dentry;\n\t\tstruct inode *inode;\n\n\t\tinode = a->u.inode;\n\t\tdentry = d_find_alias(inode);\n\t\tif (dentry) {\n\t\t\taudit_log_format(ab, \" name=\");\n\t\t\taudit_log_untrustedstring(ab,\n\t\t\t\t\t dentry->d_name.name);\n\t\t\tdput(dentry);\n\t\t}\n\t\taudit_log_format(ab, \" dev=\");\n\t\taudit_log_untrustedstring(ab, inode->i_sb->s_id);\n\t\taudit_log_format(ab, \" ino=%lu\", inode->i_ino);\n\t\tbreak;\n\t}\n\tcase LSM_AUDIT_DATA_TASK: {\n\t\tstruct task_struct *tsk = a->u.tsk;\n\t\tif (tsk) {\n\t\t\tpid_t pid = task_tgid_nr(tsk);\n\t\t\tif (pid) {\n\t\t\t\tchar comm[sizeof(tsk->comm)];\n\t\t\t\taudit_log_format(ab, \" opid=%d ocomm=\", pid);\n\t\t\t\taudit_log_untrustedstring(ab,\n\t\t\t\t    memcpy(comm, tsk->comm, sizeof(comm)));\n\t\t\t}\n\t\t}\n\t\tbreak;\n\t}\n\tcase LSM_AUDIT_DATA_NET:\n\t\tif (a->u.net->sk) {\n\t\t\tstruct sock *sk = a->u.net->sk;\n\t\t\tstruct unix_sock *u;\n\t\t\tint len = 0;\n\t\t\tchar *p = NULL;\n\n\t\t\tswitch (sk->sk_family) {\n\t\t\tcase AF_INET: {\n\t\t\t\tstruct inet_sock *inet = inet_sk(sk);\n\n\t\t\t\tprint_ipv4_addr(ab, inet->inet_rcv_saddr,\n\t\t\t\t\t\tinet->inet_sport,\n\t\t\t\t\t\t\"laddr\", \"lport\");\n\t\t\t\tprint_ipv4_addr(ab, inet->inet_daddr,\n\t\t\t\t\t\tinet->inet_dport,\n\t\t\t\t\t\t\"faddr\", \"fport\");\n\t\t\t\tbreak;\n\t\t\t}\n#if IS_ENABLED(CONFIG_IPV6)\n\t\t\tcase AF_INET6: {\n\t\t\t\tstruct inet_sock *inet = inet_sk(sk);\n\n\t\t\t\tprint_ipv6_addr(ab, &sk->sk_v6_rcv_saddr,\n\t\t\t\t\t\tinet->inet_sport,\n\t\t\t\t\t\t\"laddr\", \"lport\");\n\t\t\t\tprint_ipv6_addr(ab, &sk->sk_v6_daddr,\n\t\t\t\t\t\tinet->inet_dport,\n\t\t\t\t\t\t\"faddr\", \"fport\");\n\t\t\t\tbreak;\n\t\t\t}\n#endif\n\t\t\tcase AF_UNIX:\n\t\t\t\tu = unix_sk(sk);\n\t\t\t\tif (u->path.dentry) {\n\t\t\t\t\taudit_log_d_path(ab, \" path=\", &u->path);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tif (!u->addr)\n\t\t\t\t\tbreak;\n\t\t\t\tlen = u->addr->len-sizeof(short);\n\t\t\t\tp = &u->addr->name->sun_path[0];\n\t\t\t\taudit_log_format(ab, \" path=\");\n\t\t\t\tif (*p)\n\t\t\t\t\taudit_log_untrustedstring(ab, p);\n\t\t\t\telse\n\t\t\t\t\taudit_log_n_hex(ab, p, len);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tswitch (a->u.net->family) {\n\t\tcase AF_INET:\n\t\t\tprint_ipv4_addr(ab, a->u.net->v4info.saddr,\n\t\t\t\t\ta->u.net->sport,\n\t\t\t\t\t\"saddr\", \"src\");\n\t\t\tprint_ipv4_addr(ab, a->u.net->v4info.daddr,\n\t\t\t\t\ta->u.net->dport,\n\t\t\t\t\t\"daddr\", \"dest\");\n\t\t\tbreak;\n\t\tcase AF_INET6:\n\t\t\tprint_ipv6_addr(ab, &a->u.net->v6info.saddr,\n\t\t\t\t\ta->u.net->sport,\n\t\t\t\t\t\"saddr\", \"src\");\n\t\t\tprint_ipv6_addr(ab, &a->u.net->v6info.daddr,\n\t\t\t\t\ta->u.net->dport,\n\t\t\t\t\t\"daddr\", \"dest\");\n\t\t\tbreak;\n\t\t}\n\t\tif (a->u.net->netif > 0) {\n\t\t\tstruct net_device *dev;\n\n\t\t\t/* NOTE: we always use init's namespace */\n\t\t\tdev = dev_get_by_index(&init_net, a->u.net->netif);\n\t\t\tif (dev) {\n\t\t\t\taudit_log_format(ab, \" netif=%s\", dev->name);\n\t\t\t\tdev_put(dev);\n\t\t\t}\n\t\t}\n\t\tbreak;\n#ifdef CONFIG_KEYS\n\tcase LSM_AUDIT_DATA_KEY:\n\t\taudit_log_format(ab, \" key_serial=%u\", a->u.key_struct.key);\n\t\tif (a->u.key_struct.key_desc) {\n\t\t\taudit_log_format(ab, \" key_desc=\");\n\t\t\taudit_log_untrustedstring(ab, a->u.key_struct.key_desc);\n\t\t}\n\t\tbreak;\n#endif\n\tcase LSM_AUDIT_DATA_KMOD:\n\t\taudit_log_format(ab, \" kmod=\");\n\t\taudit_log_untrustedstring(ab, a->u.kmod_name);\n\t\tbreak;\n\tcase LSM_AUDIT_DATA_IBPKEY: {\n\t\tstruct in6_addr sbn_pfx;\n\n\t\tmemset(&sbn_pfx.s6_addr, 0,\n\t\t       sizeof(sbn_pfx.s6_addr));\n\t\tmemcpy(&sbn_pfx.s6_addr, &a->u.ibpkey->subnet_prefix,\n\t\t       sizeof(a->u.ibpkey->subnet_prefix));\n\t\taudit_log_format(ab, \" pkey=0x%x subnet_prefix=%pI6c\",\n\t\t\t\t a->u.ibpkey->pkey, &sbn_pfx);\n\t\tbreak;\n\t}\n\tcase LSM_AUDIT_DATA_IBENDPORT:\n\t\taudit_log_format(ab, \" device=%s port_num=%u\",\n\t\t\t\t a->u.ibendport->dev_name,\n\t\t\t\t a->u.ibendport->port);\n\t\tbreak;\n\t} /* switch (a->type) */\n}"
  },
  {
    "function_name": "print_ipv4_addr",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/lsm_audit.c",
    "lines": "197-204",
    "snippet": "static inline void print_ipv4_addr(struct audit_buffer *ab, __be32 addr,\n\t\t\t\t   __be16 port, char *name1, char *name2)\n{\n\tif (addr)\n\t\taudit_log_format(ab, \" %s=%pI4\", name1, &addr);\n\tif (port)\n\t\taudit_log_format(ab, \" %s=%d\", name2, ntohs(port));\n}",
    "includes": [
      "#include <linux/lsm_audit.h>",
      "#include <linux/sctp.h>",
      "#include <linux/dccp.h>",
      "#include <linux/udp.h>",
      "#include <linux/tcp.h>",
      "#include <net/ipv6.h>",
      "#include <net/ip.h>",
      "#include <linux/ip.h>",
      "#include <linux/ipv6.h>",
      "#include <linux/audit.h>",
      "#include <net/af_unix.h>",
      "#include <linux/un.h>",
      "#include <net/sock.h>",
      "#include <linux/init.h>",
      "#include <linux/fs.h>",
      "#include <linux/gfp.h>",
      "#include <linux/kernel.h>",
      "#include <linux/stddef.h>",
      "#include <linux/types.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "audit_log_format",
          "args": [
            "ab",
            "\" %s=%d\"",
            "name2",
            "ntohs(port)"
          ],
          "line": 203
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ntohs",
          "args": [
            "port"
          ],
          "line": 203
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "audit_log_format",
          "args": [
            "ab",
            "\" %s=%pI4\"",
            "name1",
            "&addr"
          ],
          "line": 201
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <linux/lsm_audit.h>\n#include <linux/sctp.h>\n#include <linux/dccp.h>\n#include <linux/udp.h>\n#include <linux/tcp.h>\n#include <net/ipv6.h>\n#include <net/ip.h>\n#include <linux/ip.h>\n#include <linux/ipv6.h>\n#include <linux/audit.h>\n#include <net/af_unix.h>\n#include <linux/un.h>\n#include <net/sock.h>\n#include <linux/init.h>\n#include <linux/fs.h>\n#include <linux/gfp.h>\n#include <linux/kernel.h>\n#include <linux/stddef.h>\n#include <linux/types.h>\n\nstatic inline void print_ipv4_addr(struct audit_buffer *ab, __be32 addr,\n\t\t\t\t   __be16 port, char *name1, char *name2)\n{\n\tif (addr)\n\t\taudit_log_format(ab, \" %s=%pI4\", name1, &addr);\n\tif (port)\n\t\taudit_log_format(ab, \" %s=%d\", name2, ntohs(port));\n}"
  },
  {
    "function_name": "print_ipv6_addr",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/lsm_audit.c",
    "lines": "187-195",
    "snippet": "static inline void print_ipv6_addr(struct audit_buffer *ab,\n\t\t\t\t   struct in6_addr *addr, __be16 port,\n\t\t\t\t   char *name1, char *name2)\n{\n\tif (!ipv6_addr_any(addr))\n\t\taudit_log_format(ab, \" %s=%pI6c\", name1, addr);\n\tif (port)\n\t\taudit_log_format(ab, \" %s=%d\", name2, ntohs(port));\n}",
    "includes": [
      "#include <linux/lsm_audit.h>",
      "#include <linux/sctp.h>",
      "#include <linux/dccp.h>",
      "#include <linux/udp.h>",
      "#include <linux/tcp.h>",
      "#include <net/ipv6.h>",
      "#include <net/ip.h>",
      "#include <linux/ip.h>",
      "#include <linux/ipv6.h>",
      "#include <linux/audit.h>",
      "#include <net/af_unix.h>",
      "#include <linux/un.h>",
      "#include <net/sock.h>",
      "#include <linux/init.h>",
      "#include <linux/fs.h>",
      "#include <linux/gfp.h>",
      "#include <linux/kernel.h>",
      "#include <linux/stddef.h>",
      "#include <linux/types.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "audit_log_format",
          "args": [
            "ab",
            "\" %s=%d\"",
            "name2",
            "ntohs(port)"
          ],
          "line": 194
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ntohs",
          "args": [
            "port"
          ],
          "line": 194
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "audit_log_format",
          "args": [
            "ab",
            "\" %s=%pI6c\"",
            "name1",
            "addr"
          ],
          "line": 192
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ipv6_addr_any",
          "args": [
            "addr"
          ],
          "line": 191
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <linux/lsm_audit.h>\n#include <linux/sctp.h>\n#include <linux/dccp.h>\n#include <linux/udp.h>\n#include <linux/tcp.h>\n#include <net/ipv6.h>\n#include <net/ip.h>\n#include <linux/ip.h>\n#include <linux/ipv6.h>\n#include <linux/audit.h>\n#include <net/af_unix.h>\n#include <linux/un.h>\n#include <net/sock.h>\n#include <linux/init.h>\n#include <linux/fs.h>\n#include <linux/gfp.h>\n#include <linux/kernel.h>\n#include <linux/stddef.h>\n#include <linux/types.h>\n\nstatic inline void print_ipv6_addr(struct audit_buffer *ab,\n\t\t\t\t   struct in6_addr *addr, __be16 port,\n\t\t\t\t   char *name1, char *name2)\n{\n\tif (!ipv6_addr_any(addr))\n\t\taudit_log_format(ab, \" %s=%pI6c\", name1, addr);\n\tif (port)\n\t\taudit_log_format(ab, \" %s=%d\", name2, ntohs(port));\n}"
  },
  {
    "function_name": "ipv6_skb_to_auditdata",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/lsm_audit.c",
    "lines": "111-183",
    "snippet": "int ipv6_skb_to_auditdata(struct sk_buff *skb,\n\t\tstruct common_audit_data *ad, u8 *proto)\n{\n\tint offset, ret = 0;\n\tstruct ipv6hdr *ip6;\n\tu8 nexthdr;\n\t__be16 frag_off;\n\n\tip6 = ipv6_hdr(skb);\n\tif (ip6 == NULL)\n\t\treturn -EINVAL;\n\tad->u.net->v6info.saddr = ip6->saddr;\n\tad->u.net->v6info.daddr = ip6->daddr;\n\tret = 0;\n\t/* IPv6 can have several extension header before the Transport header\n\t * skip them */\n\toffset = skb_network_offset(skb);\n\toffset += sizeof(*ip6);\n\tnexthdr = ip6->nexthdr;\n\toffset = ipv6_skip_exthdr(skb, offset, &nexthdr, &frag_off);\n\tif (offset < 0)\n\t\treturn 0;\n\tif (proto)\n\t\t*proto = nexthdr;\n\tswitch (nexthdr) {\n\tcase IPPROTO_TCP: {\n\t\tstruct tcphdr _tcph, *th;\n\n\t\tth = skb_header_pointer(skb, offset, sizeof(_tcph), &_tcph);\n\t\tif (th == NULL)\n\t\t\tbreak;\n\n\t\tad->u.net->sport = th->source;\n\t\tad->u.net->dport = th->dest;\n\t\tbreak;\n\t}\n\tcase IPPROTO_UDP: {\n\t\tstruct udphdr _udph, *uh;\n\n\t\tuh = skb_header_pointer(skb, offset, sizeof(_udph), &_udph);\n\t\tif (uh == NULL)\n\t\t\tbreak;\n\n\t\tad->u.net->sport = uh->source;\n\t\tad->u.net->dport = uh->dest;\n\t\tbreak;\n\t}\n\tcase IPPROTO_DCCP: {\n\t\tstruct dccp_hdr _dccph, *dh;\n\n\t\tdh = skb_header_pointer(skb, offset, sizeof(_dccph), &_dccph);\n\t\tif (dh == NULL)\n\t\t\tbreak;\n\n\t\tad->u.net->sport = dh->dccph_sport;\n\t\tad->u.net->dport = dh->dccph_dport;\n\t\tbreak;\n\t}\n\tcase IPPROTO_SCTP: {\n\t\tstruct sctphdr _sctph, *sh;\n\n\t\tsh = skb_header_pointer(skb, offset, sizeof(_sctph), &_sctph);\n\t\tif (sh == NULL)\n\t\t\tbreak;\n\t\tad->u.net->sport = sh->source;\n\t\tad->u.net->dport = sh->dest;\n\t\tbreak;\n\t}\n\tdefault:\n\t\tret = -EINVAL;\n\t}\n\treturn ret;\n}",
    "includes": [
      "#include <linux/lsm_audit.h>",
      "#include <linux/sctp.h>",
      "#include <linux/dccp.h>",
      "#include <linux/udp.h>",
      "#include <linux/tcp.h>",
      "#include <net/ipv6.h>",
      "#include <net/ip.h>",
      "#include <linux/ip.h>",
      "#include <linux/ipv6.h>",
      "#include <linux/audit.h>",
      "#include <net/af_unix.h>",
      "#include <linux/un.h>",
      "#include <net/sock.h>",
      "#include <linux/init.h>",
      "#include <linux/fs.h>",
      "#include <linux/gfp.h>",
      "#include <linux/kernel.h>",
      "#include <linux/stddef.h>",
      "#include <linux/types.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "skb_header_pointer",
          "args": [
            "skb",
            "offset",
            "sizeof(_sctph)",
            "&_sctph"
          ],
          "line": 172
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "skb_header_pointer",
          "args": [
            "skb",
            "offset",
            "sizeof(_dccph)",
            "&_dccph"
          ],
          "line": 161
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "skb_header_pointer",
          "args": [
            "skb",
            "offset",
            "sizeof(_udph)",
            "&_udph"
          ],
          "line": 150
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "skb_header_pointer",
          "args": [
            "skb",
            "offset",
            "sizeof(_tcph)",
            "&_tcph"
          ],
          "line": 139
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ipv6_skip_exthdr",
          "args": [
            "skb",
            "offset",
            "&nexthdr",
            "&frag_off"
          ],
          "line": 130
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "skb_network_offset",
          "args": [
            "skb"
          ],
          "line": 127
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ipv6_hdr",
          "args": [
            "skb"
          ],
          "line": 119
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <linux/lsm_audit.h>\n#include <linux/sctp.h>\n#include <linux/dccp.h>\n#include <linux/udp.h>\n#include <linux/tcp.h>\n#include <net/ipv6.h>\n#include <net/ip.h>\n#include <linux/ip.h>\n#include <linux/ipv6.h>\n#include <linux/audit.h>\n#include <net/af_unix.h>\n#include <linux/un.h>\n#include <net/sock.h>\n#include <linux/init.h>\n#include <linux/fs.h>\n#include <linux/gfp.h>\n#include <linux/kernel.h>\n#include <linux/stddef.h>\n#include <linux/types.h>\n\nint ipv6_skb_to_auditdata(struct sk_buff *skb,\n\t\tstruct common_audit_data *ad, u8 *proto)\n{\n\tint offset, ret = 0;\n\tstruct ipv6hdr *ip6;\n\tu8 nexthdr;\n\t__be16 frag_off;\n\n\tip6 = ipv6_hdr(skb);\n\tif (ip6 == NULL)\n\t\treturn -EINVAL;\n\tad->u.net->v6info.saddr = ip6->saddr;\n\tad->u.net->v6info.daddr = ip6->daddr;\n\tret = 0;\n\t/* IPv6 can have several extension header before the Transport header\n\t * skip them */\n\toffset = skb_network_offset(skb);\n\toffset += sizeof(*ip6);\n\tnexthdr = ip6->nexthdr;\n\toffset = ipv6_skip_exthdr(skb, offset, &nexthdr, &frag_off);\n\tif (offset < 0)\n\t\treturn 0;\n\tif (proto)\n\t\t*proto = nexthdr;\n\tswitch (nexthdr) {\n\tcase IPPROTO_TCP: {\n\t\tstruct tcphdr _tcph, *th;\n\n\t\tth = skb_header_pointer(skb, offset, sizeof(_tcph), &_tcph);\n\t\tif (th == NULL)\n\t\t\tbreak;\n\n\t\tad->u.net->sport = th->source;\n\t\tad->u.net->dport = th->dest;\n\t\tbreak;\n\t}\n\tcase IPPROTO_UDP: {\n\t\tstruct udphdr _udph, *uh;\n\n\t\tuh = skb_header_pointer(skb, offset, sizeof(_udph), &_udph);\n\t\tif (uh == NULL)\n\t\t\tbreak;\n\n\t\tad->u.net->sport = uh->source;\n\t\tad->u.net->dport = uh->dest;\n\t\tbreak;\n\t}\n\tcase IPPROTO_DCCP: {\n\t\tstruct dccp_hdr _dccph, *dh;\n\n\t\tdh = skb_header_pointer(skb, offset, sizeof(_dccph), &_dccph);\n\t\tif (dh == NULL)\n\t\t\tbreak;\n\n\t\tad->u.net->sport = dh->dccph_sport;\n\t\tad->u.net->dport = dh->dccph_dport;\n\t\tbreak;\n\t}\n\tcase IPPROTO_SCTP: {\n\t\tstruct sctphdr _sctph, *sh;\n\n\t\tsh = skb_header_pointer(skb, offset, sizeof(_sctph), &_sctph);\n\t\tif (sh == NULL)\n\t\t\tbreak;\n\t\tad->u.net->sport = sh->source;\n\t\tad->u.net->dport = sh->dest;\n\t\tbreak;\n\t}\n\tdefault:\n\t\tret = -EINVAL;\n\t}\n\treturn ret;\n}"
  },
  {
    "function_name": "ipv4_skb_to_auditdata",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/lsm_audit.c",
    "lines": "42-101",
    "snippet": "int ipv4_skb_to_auditdata(struct sk_buff *skb,\n\t\tstruct common_audit_data *ad, u8 *proto)\n{\n\tint ret = 0;\n\tstruct iphdr *ih;\n\n\tih = ip_hdr(skb);\n\tif (ih == NULL)\n\t\treturn -EINVAL;\n\n\tad->u.net->v4info.saddr = ih->saddr;\n\tad->u.net->v4info.daddr = ih->daddr;\n\n\tif (proto)\n\t\t*proto = ih->protocol;\n\t/* non initial fragment */\n\tif (ntohs(ih->frag_off) & IP_OFFSET)\n\t\treturn 0;\n\n\tswitch (ih->protocol) {\n\tcase IPPROTO_TCP: {\n\t\tstruct tcphdr *th = tcp_hdr(skb);\n\t\tif (th == NULL)\n\t\t\tbreak;\n\n\t\tad->u.net->sport = th->source;\n\t\tad->u.net->dport = th->dest;\n\t\tbreak;\n\t}\n\tcase IPPROTO_UDP: {\n\t\tstruct udphdr *uh = udp_hdr(skb);\n\t\tif (uh == NULL)\n\t\t\tbreak;\n\n\t\tad->u.net->sport = uh->source;\n\t\tad->u.net->dport = uh->dest;\n\t\tbreak;\n\t}\n\tcase IPPROTO_DCCP: {\n\t\tstruct dccp_hdr *dh = dccp_hdr(skb);\n\t\tif (dh == NULL)\n\t\t\tbreak;\n\n\t\tad->u.net->sport = dh->dccph_sport;\n\t\tad->u.net->dport = dh->dccph_dport;\n\t\tbreak;\n\t}\n\tcase IPPROTO_SCTP: {\n\t\tstruct sctphdr *sh = sctp_hdr(skb);\n\t\tif (sh == NULL)\n\t\t\tbreak;\n\t\tad->u.net->sport = sh->source;\n\t\tad->u.net->dport = sh->dest;\n\t\tbreak;\n\t}\n\tdefault:\n\t\tret = -EINVAL;\n\t}\n\treturn ret;\n}",
    "includes": [
      "#include <linux/lsm_audit.h>",
      "#include <linux/sctp.h>",
      "#include <linux/dccp.h>",
      "#include <linux/udp.h>",
      "#include <linux/tcp.h>",
      "#include <net/ipv6.h>",
      "#include <net/ip.h>",
      "#include <linux/ip.h>",
      "#include <linux/ipv6.h>",
      "#include <linux/audit.h>",
      "#include <net/af_unix.h>",
      "#include <linux/un.h>",
      "#include <net/sock.h>",
      "#include <linux/init.h>",
      "#include <linux/fs.h>",
      "#include <linux/gfp.h>",
      "#include <linux/kernel.h>",
      "#include <linux/stddef.h>",
      "#include <linux/types.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "sctp_hdr",
          "args": [
            "skb"
          ],
          "line": 90
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dccp_hdr",
          "args": [
            "skb"
          ],
          "line": 81
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "udp_hdr",
          "args": [
            "skb"
          ],
          "line": 72
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "tcp_hdr",
          "args": [
            "skb"
          ],
          "line": 63
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ntohs",
          "args": [
            "ih->frag_off"
          ],
          "line": 58
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ip_hdr",
          "args": [
            "skb"
          ],
          "line": 48
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <linux/lsm_audit.h>\n#include <linux/sctp.h>\n#include <linux/dccp.h>\n#include <linux/udp.h>\n#include <linux/tcp.h>\n#include <net/ipv6.h>\n#include <net/ip.h>\n#include <linux/ip.h>\n#include <linux/ipv6.h>\n#include <linux/audit.h>\n#include <net/af_unix.h>\n#include <linux/un.h>\n#include <net/sock.h>\n#include <linux/init.h>\n#include <linux/fs.h>\n#include <linux/gfp.h>\n#include <linux/kernel.h>\n#include <linux/stddef.h>\n#include <linux/types.h>\n\nint ipv4_skb_to_auditdata(struct sk_buff *skb,\n\t\tstruct common_audit_data *ad, u8 *proto)\n{\n\tint ret = 0;\n\tstruct iphdr *ih;\n\n\tih = ip_hdr(skb);\n\tif (ih == NULL)\n\t\treturn -EINVAL;\n\n\tad->u.net->v4info.saddr = ih->saddr;\n\tad->u.net->v4info.daddr = ih->daddr;\n\n\tif (proto)\n\t\t*proto = ih->protocol;\n\t/* non initial fragment */\n\tif (ntohs(ih->frag_off) & IP_OFFSET)\n\t\treturn 0;\n\n\tswitch (ih->protocol) {\n\tcase IPPROTO_TCP: {\n\t\tstruct tcphdr *th = tcp_hdr(skb);\n\t\tif (th == NULL)\n\t\t\tbreak;\n\n\t\tad->u.net->sport = th->source;\n\t\tad->u.net->dport = th->dest;\n\t\tbreak;\n\t}\n\tcase IPPROTO_UDP: {\n\t\tstruct udphdr *uh = udp_hdr(skb);\n\t\tif (uh == NULL)\n\t\t\tbreak;\n\n\t\tad->u.net->sport = uh->source;\n\t\tad->u.net->dport = uh->dest;\n\t\tbreak;\n\t}\n\tcase IPPROTO_DCCP: {\n\t\tstruct dccp_hdr *dh = dccp_hdr(skb);\n\t\tif (dh == NULL)\n\t\t\tbreak;\n\n\t\tad->u.net->sport = dh->dccph_sport;\n\t\tad->u.net->dport = dh->dccph_dport;\n\t\tbreak;\n\t}\n\tcase IPPROTO_SCTP: {\n\t\tstruct sctphdr *sh = sctp_hdr(skb);\n\t\tif (sh == NULL)\n\t\t\tbreak;\n\t\tad->u.net->sport = sh->source;\n\t\tad->u.net->dport = sh->dest;\n\t\tbreak;\n\t}\n\tdefault:\n\t\tret = -EINVAL;\n\t}\n\treturn ret;\n}"
  }
]