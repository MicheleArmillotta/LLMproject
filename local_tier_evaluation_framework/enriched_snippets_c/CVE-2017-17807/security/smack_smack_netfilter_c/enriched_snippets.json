[
  {
    "function_name": "smack_nf_ip_init",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/smack/smack_netfilter.c",
    "lines": "94-101",
    "snippet": "static int __init smack_nf_ip_init(void)\n{\n\tif (smack_enabled == 0)\n\t\treturn 0;\n\n\tprintk(KERN_DEBUG \"Smack: Registering netfilter hooks\\n\");\n\treturn register_pernet_subsys(&smack_net_ops);\n}",
    "includes": [
      "#include \"smack.h\"",
      "#include <net/net_namespace.h>",
      "#include <net/inet_sock.h>",
      "#include <linux/netdevice.h>",
      "#include <linux/netfilter_ipv6.h>",
      "#include <linux/netfilter_ipv4.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static struct pernet_operations smack_net_ops = {\n\t.init = smack_nf_register,\n\t.exit = smack_nf_unregister,\n};"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "register_pernet_subsys",
          "args": [
            "&smack_net_ops"
          ],
          "line": 100
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "printk",
          "args": [
            "KERN_DEBUG \"Smack: Registering netfilter hooks\\n\""
          ],
          "line": 99
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"smack.h\"\n#include <net/net_namespace.h>\n#include <net/inet_sock.h>\n#include <linux/netdevice.h>\n#include <linux/netfilter_ipv6.h>\n#include <linux/netfilter_ipv4.h>\n\nstatic struct pernet_operations smack_net_ops = {\n\t.init = smack_nf_register,\n\t.exit = smack_nf_unregister,\n};\n\nstatic int __init smack_nf_ip_init(void)\n{\n\tif (smack_enabled == 0)\n\t\treturn 0;\n\n\tprintk(KERN_DEBUG \"Smack: Registering netfilter hooks\\n\");\n\treturn register_pernet_subsys(&smack_net_ops);\n}"
  },
  {
    "function_name": "smack_nf_unregister",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/smack/smack_netfilter.c",
    "lines": "84-87",
    "snippet": "static void __net_exit smack_nf_unregister(struct net *net)\n{\n\tnf_unregister_net_hooks(net, smack_nf_ops, ARRAY_SIZE(smack_nf_ops));\n}",
    "includes": [
      "#include \"smack.h\"",
      "#include <net/net_namespace.h>",
      "#include <net/inet_sock.h>",
      "#include <linux/netdevice.h>",
      "#include <linux/netfilter_ipv6.h>",
      "#include <linux/netfilter_ipv4.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static const struct nf_hook_ops smack_nf_ops[] = {\n\t{\n\t\t.hook =\t\tsmack_ipv4_output,\n\t\t.pf =\t\tNFPROTO_IPV4,\n\t\t.hooknum =\tNF_INET_LOCAL_OUT,\n\t\t.priority =\tNF_IP_PRI_SELINUX_FIRST,\n\t},\n#if IS_ENABLED(CONFIG_IPV6)\n\t{\n\t\t.hook =\t\tsmack_ipv6_output,\n\t\t.pf =\t\tNFPROTO_IPV6,\n\t\t.hooknum =\tNF_INET_LOCAL_OUT,\n\t\t.priority =\tNF_IP6_PRI_SELINUX_FIRST,\n\t},\n#endif\t/* IPV6 */\n};"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "nf_unregister_net_hooks",
          "args": [
            "net",
            "smack_nf_ops",
            "ARRAY_SIZE(smack_nf_ops)"
          ],
          "line": 86
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ARRAY_SIZE",
          "args": [
            "smack_nf_ops"
          ],
          "line": 86
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"smack.h\"\n#include <net/net_namespace.h>\n#include <net/inet_sock.h>\n#include <linux/netdevice.h>\n#include <linux/netfilter_ipv6.h>\n#include <linux/netfilter_ipv4.h>\n\nstatic const struct nf_hook_ops smack_nf_ops[] = {\n\t{\n\t\t.hook =\t\tsmack_ipv4_output,\n\t\t.pf =\t\tNFPROTO_IPV4,\n\t\t.hooknum =\tNF_INET_LOCAL_OUT,\n\t\t.priority =\tNF_IP_PRI_SELINUX_FIRST,\n\t},\n#if IS_ENABLED(CONFIG_IPV6)\n\t{\n\t\t.hook =\t\tsmack_ipv6_output,\n\t\t.pf =\t\tNFPROTO_IPV6,\n\t\t.hooknum =\tNF_INET_LOCAL_OUT,\n\t\t.priority =\tNF_IP6_PRI_SELINUX_FIRST,\n\t},\n#endif\t/* IPV6 */\n};\n\nstatic void __net_exit smack_nf_unregister(struct net *net)\n{\n\tnf_unregister_net_hooks(net, smack_nf_ops, ARRAY_SIZE(smack_nf_ops));\n}"
  },
  {
    "function_name": "smack_nf_register",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/smack/smack_netfilter.c",
    "lines": "78-82",
    "snippet": "static int __net_init smack_nf_register(struct net *net)\n{\n\treturn nf_register_net_hooks(net, smack_nf_ops,\n\t\t\t\t     ARRAY_SIZE(smack_nf_ops));\n}",
    "includes": [
      "#include \"smack.h\"",
      "#include <net/net_namespace.h>",
      "#include <net/inet_sock.h>",
      "#include <linux/netdevice.h>",
      "#include <linux/netfilter_ipv6.h>",
      "#include <linux/netfilter_ipv4.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static const struct nf_hook_ops smack_nf_ops[] = {\n\t{\n\t\t.hook =\t\tsmack_ipv4_output,\n\t\t.pf =\t\tNFPROTO_IPV4,\n\t\t.hooknum =\tNF_INET_LOCAL_OUT,\n\t\t.priority =\tNF_IP_PRI_SELINUX_FIRST,\n\t},\n#if IS_ENABLED(CONFIG_IPV6)\n\t{\n\t\t.hook =\t\tsmack_ipv6_output,\n\t\t.pf =\t\tNFPROTO_IPV6,\n\t\t.hooknum =\tNF_INET_LOCAL_OUT,\n\t\t.priority =\tNF_IP6_PRI_SELINUX_FIRST,\n\t},\n#endif\t/* IPV6 */\n};"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "nf_register_net_hooks",
          "args": [
            "net",
            "smack_nf_ops",
            "ARRAY_SIZE(smack_nf_ops)"
          ],
          "line": 80
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ARRAY_SIZE",
          "args": [
            "smack_nf_ops"
          ],
          "line": 81
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"smack.h\"\n#include <net/net_namespace.h>\n#include <net/inet_sock.h>\n#include <linux/netdevice.h>\n#include <linux/netfilter_ipv6.h>\n#include <linux/netfilter_ipv4.h>\n\nstatic const struct nf_hook_ops smack_nf_ops[] = {\n\t{\n\t\t.hook =\t\tsmack_ipv4_output,\n\t\t.pf =\t\tNFPROTO_IPV4,\n\t\t.hooknum =\tNF_INET_LOCAL_OUT,\n\t\t.priority =\tNF_IP_PRI_SELINUX_FIRST,\n\t},\n#if IS_ENABLED(CONFIG_IPV6)\n\t{\n\t\t.hook =\t\tsmack_ipv6_output,\n\t\t.pf =\t\tNFPROTO_IPV6,\n\t\t.hooknum =\tNF_INET_LOCAL_OUT,\n\t\t.priority =\tNF_IP6_PRI_SELINUX_FIRST,\n\t},\n#endif\t/* IPV6 */\n};\n\nstatic int __net_init smack_nf_register(struct net *net)\n{\n\treturn nf_register_net_hooks(net, smack_nf_ops,\n\t\t\t\t     ARRAY_SIZE(smack_nf_ops));\n}"
  },
  {
    "function_name": "smack_ipv4_output",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/smack/smack_netfilter.c",
    "lines": "44-59",
    "snippet": "static unsigned int smack_ipv4_output(void *priv,\n\t\t\t\t\tstruct sk_buff *skb,\n\t\t\t\t\tconst struct nf_hook_state *state)\n{\n\tstruct sock *sk = skb_to_full_sk(skb);\n\tstruct socket_smack *ssp;\n\tstruct smack_known *skp;\n\n\tif (sk && sk->sk_security) {\n\t\tssp = sk->sk_security;\n\t\tskp = ssp->smk_out;\n\t\tskb->secmark = skp->smk_secid;\n\t}\n\n\treturn NF_ACCEPT;\n}",
    "includes": [
      "#include \"smack.h\"",
      "#include <net/net_namespace.h>",
      "#include <net/inet_sock.h>",
      "#include <linux/netdevice.h>",
      "#include <linux/netfilter_ipv6.h>",
      "#include <linux/netfilter_ipv4.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "skb_to_full_sk",
          "args": [
            "skb"
          ],
          "line": 48
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"smack.h\"\n#include <net/net_namespace.h>\n#include <net/inet_sock.h>\n#include <linux/netdevice.h>\n#include <linux/netfilter_ipv6.h>\n#include <linux/netfilter_ipv4.h>\n\nstatic unsigned int smack_ipv4_output(void *priv,\n\t\t\t\t\tstruct sk_buff *skb,\n\t\t\t\t\tconst struct nf_hook_state *state)\n{\n\tstruct sock *sk = skb_to_full_sk(skb);\n\tstruct socket_smack *ssp;\n\tstruct smack_known *skp;\n\n\tif (sk && sk->sk_security) {\n\t\tssp = sk->sk_security;\n\t\tskp = ssp->smk_out;\n\t\tskb->secmark = skp->smk_secid;\n\t}\n\n\treturn NF_ACCEPT;\n}"
  },
  {
    "function_name": "smack_ipv6_output",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/smack/smack_netfilter.c",
    "lines": "26-41",
    "snippet": "static unsigned int smack_ipv6_output(void *priv,\n\t\t\t\t\tstruct sk_buff *skb,\n\t\t\t\t\tconst struct nf_hook_state *state)\n{\n\tstruct sock *sk = skb_to_full_sk(skb);\n\tstruct socket_smack *ssp;\n\tstruct smack_known *skp;\n\n\tif (sk && sk->sk_security) {\n\t\tssp = sk->sk_security;\n\t\tskp = ssp->smk_out;\n\t\tskb->secmark = skp->smk_secid;\n\t}\n\n\treturn NF_ACCEPT;\n}",
    "includes": [
      "#include \"smack.h\"",
      "#include <net/net_namespace.h>",
      "#include <net/inet_sock.h>",
      "#include <linux/netdevice.h>",
      "#include <linux/netfilter_ipv6.h>",
      "#include <linux/netfilter_ipv4.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "skb_to_full_sk",
          "args": [
            "skb"
          ],
          "line": 30
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"smack.h\"\n#include <net/net_namespace.h>\n#include <net/inet_sock.h>\n#include <linux/netdevice.h>\n#include <linux/netfilter_ipv6.h>\n#include <linux/netfilter_ipv4.h>\n\nstatic unsigned int smack_ipv6_output(void *priv,\n\t\t\t\t\tstruct sk_buff *skb,\n\t\t\t\t\tconst struct nf_hook_state *state)\n{\n\tstruct sock *sk = skb_to_full_sk(skb);\n\tstruct socket_smack *ssp;\n\tstruct smack_known *skp;\n\n\tif (sk && sk->sk_security) {\n\t\tssp = sk->sk_security;\n\t\tskp = ssp->smk_out;\n\t\tskb->secmark = skp->smk_secid;\n\t}\n\n\treturn NF_ACCEPT;\n}"
  }
]