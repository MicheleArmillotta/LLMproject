[
  {
    "function_name": "aa_policy_destroy",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/lib.c",
    "lines": "510-517",
    "snippet": "void aa_policy_destroy(struct aa_policy *policy)\n{\n\tAA_BUG(on_list_rcu(&policy->profiles));\n\tAA_BUG(on_list_rcu(&policy->list));\n\n\t/* don't free name as its a subset of hname */\n\taa_put_str(policy->hname);\n}",
    "includes": [
      "#include \"include/policy.h\"",
      "#include \"include/perms.h\"",
      "#include \"include/lib.h\"",
      "#include \"include/apparmor.h\"",
      "#include \"include/audit.h\"",
      "#include <linux/vmalloc.h>",
      "#include <linux/string.h>",
      "#include <linux/slab.h>",
      "#include <linux/mm.h>",
      "#include <linux/ctype.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "aa_put_str",
          "args": [
            "policy->hname"
          ],
          "line": 516
        },
        "resolved": true,
        "details": {
          "function_name": "aa_put_str",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/include/lib.h",
          "lines": "115-119",
          "snippet": "static inline void aa_put_str(__counted char *str)\n{\n\tif (str)\n\t\tkref_put(&str_to_counted(str)->count, aa_str_kref);\n}",
          "includes": [
            "#include \"match.h\"",
            "#include <linux/fs.h>",
            "#include <linux/slab.h>"
          ],
          "macros_used": [
            "#define __counted\t/* atm just a notation */"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"match.h\"\n#include <linux/fs.h>\n#include <linux/slab.h>\n\n#define __counted\t/* atm just a notation */\n\nstatic inline void aa_put_str(__counted char *str)\n{\n\tif (str)\n\t\tkref_put(&str_to_counted(str)->count, aa_str_kref);\n}"
        }
      },
      {
        "call_info": {
          "callee": "AA_BUG",
          "args": [
            "on_list_rcu(&policy->list)"
          ],
          "line": 513
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "on_list_rcu",
          "args": [
            "&policy->list"
          ],
          "line": 513
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "AA_BUG",
          "args": [
            "on_list_rcu(&policy->profiles)"
          ],
          "line": 512
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "on_list_rcu",
          "args": [
            "&policy->profiles"
          ],
          "line": 512
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"include/policy.h\"\n#include \"include/perms.h\"\n#include \"include/lib.h\"\n#include \"include/apparmor.h\"\n#include \"include/audit.h\"\n#include <linux/vmalloc.h>\n#include <linux/string.h>\n#include <linux/slab.h>\n#include <linux/mm.h>\n#include <linux/ctype.h>\n\nvoid aa_policy_destroy(struct aa_policy *policy)\n{\n\tAA_BUG(on_list_rcu(&policy->profiles));\n\tAA_BUG(on_list_rcu(&policy->list));\n\n\t/* don't free name as its a subset of hname */\n\taa_put_str(policy->hname);\n}"
  },
  {
    "function_name": "aa_policy_init",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/lib.c",
    "lines": "480-504",
    "snippet": "bool aa_policy_init(struct aa_policy *policy, const char *prefix,\n\t\t    const char *name, gfp_t gfp)\n{\n\tchar *hname;\n\n\t/* freed by policy_free */\n\tif (prefix) {\n\t\thname = aa_str_alloc(strlen(prefix) + strlen(name) + 3, gfp);\n\t\tif (hname)\n\t\t\tsprintf(hname, \"%s//%s\", prefix, name);\n\t} else {\n\t\thname = aa_str_alloc(strlen(name) + 1, gfp);\n\t\tif (hname)\n\t\t\tstrcpy(hname, name);\n\t}\n\tif (!hname)\n\t\treturn false;\n\tpolicy->hname = hname;\n\t/* base.name is a substring of fqname */\n\tpolicy->name = basename(policy->hname);\n\tINIT_LIST_HEAD(&policy->list);\n\tINIT_LIST_HEAD(&policy->profiles);\n\n\treturn true;\n}",
    "includes": [
      "#include \"include/policy.h\"",
      "#include \"include/perms.h\"",
      "#include \"include/lib.h\"",
      "#include \"include/apparmor.h\"",
      "#include \"include/audit.h\"",
      "#include <linux/vmalloc.h>",
      "#include <linux/string.h>",
      "#include <linux/slab.h>",
      "#include <linux/mm.h>",
      "#include <linux/ctype.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "INIT_LIST_HEAD",
          "args": [
            "&policy->profiles"
          ],
          "line": 501
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "INIT_LIST_HEAD",
          "args": [
            "&policy->list"
          ],
          "line": 500
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "basename",
          "args": [
            "policy->hname"
          ],
          "line": 499
        },
        "resolved": true,
        "details": {
          "function_name": "basename",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/include/lib.h",
          "lines": "141-150",
          "snippet": "static inline const char *basename(const char *hname)\n{\n\tchar *split;\n\n\thname = strim((char *)hname);\n\tfor (split = strstr(hname, \"//\"); split; split = strstr(hname, \"//\"))\n\t\thname = split + 2;\n\n\treturn hname;\n}",
          "includes": [
            "#include \"match.h\"",
            "#include <linux/fs.h>",
            "#include <linux/slab.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"match.h\"\n#include <linux/fs.h>\n#include <linux/slab.h>\n\nstatic inline const char *basename(const char *hname)\n{\n\tchar *split;\n\n\thname = strim((char *)hname);\n\tfor (split = strstr(hname, \"//\"); split; split = strstr(hname, \"//\"))\n\t\thname = split + 2;\n\n\treturn hname;\n}"
        }
      },
      {
        "call_info": {
          "callee": "strcpy",
          "args": [
            "hname",
            "name"
          ],
          "line": 493
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "aa_str_alloc",
          "args": [
            "strlen(name) + 1",
            "gfp"
          ],
          "line": 491
        },
        "resolved": true,
        "details": {
          "function_name": "aa_str_alloc",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/lib.c",
          "lines": "137-147",
          "snippet": "__counted char *aa_str_alloc(int size, gfp_t gfp)\n{\n\tstruct counted_str *str;\n\n\tstr = kmalloc(sizeof(struct counted_str) + size, gfp);\n\tif (!str)\n\t\treturn NULL;\n\n\tkref_init(&str->count);\n\treturn str->name;\n}",
          "includes": [
            "#include \"include/policy.h\"",
            "#include \"include/perms.h\"",
            "#include \"include/lib.h\"",
            "#include \"include/apparmor.h\"",
            "#include \"include/audit.h\"",
            "#include <linux/vmalloc.h>",
            "#include <linux/string.h>",
            "#include <linux/slab.h>",
            "#include <linux/mm.h>",
            "#include <linux/ctype.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"include/policy.h\"\n#include \"include/perms.h\"\n#include \"include/lib.h\"\n#include \"include/apparmor.h\"\n#include \"include/audit.h\"\n#include <linux/vmalloc.h>\n#include <linux/string.h>\n#include <linux/slab.h>\n#include <linux/mm.h>\n#include <linux/ctype.h>\n\n__counted char *aa_str_alloc(int size, gfp_t gfp)\n{\n\tstruct counted_str *str;\n\n\tstr = kmalloc(sizeof(struct counted_str) + size, gfp);\n\tif (!str)\n\t\treturn NULL;\n\n\tkref_init(&str->count);\n\treturn str->name;\n}"
        }
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "name"
          ],
          "line": 491
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sprintf",
          "args": [
            "hname",
            "\"%s//%s\"",
            "prefix",
            "name"
          ],
          "line": 489
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "name"
          ],
          "line": 487
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "prefix"
          ],
          "line": 487
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"include/policy.h\"\n#include \"include/perms.h\"\n#include \"include/lib.h\"\n#include \"include/apparmor.h\"\n#include \"include/audit.h\"\n#include <linux/vmalloc.h>\n#include <linux/string.h>\n#include <linux/slab.h>\n#include <linux/mm.h>\n#include <linux/ctype.h>\n\nbool aa_policy_init(struct aa_policy *policy, const char *prefix,\n\t\t    const char *name, gfp_t gfp)\n{\n\tchar *hname;\n\n\t/* freed by policy_free */\n\tif (prefix) {\n\t\thname = aa_str_alloc(strlen(prefix) + strlen(name) + 3, gfp);\n\t\tif (hname)\n\t\t\tsprintf(hname, \"%s//%s\", prefix, name);\n\t} else {\n\t\thname = aa_str_alloc(strlen(name) + 1, gfp);\n\t\tif (hname)\n\t\t\tstrcpy(hname, name);\n\t}\n\tif (!hname)\n\t\treturn false;\n\tpolicy->hname = hname;\n\t/* base.name is a substring of fqname */\n\tpolicy->name = basename(policy->hname);\n\tINIT_LIST_HEAD(&policy->list);\n\tINIT_LIST_HEAD(&policy->profiles);\n\n\treturn true;\n}"
  },
  {
    "function_name": "aa_check_perms",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/lib.c",
    "lines": "421-466",
    "snippet": "int aa_check_perms(struct aa_profile *profile, struct aa_perms *perms,\n\t\t   u32 request, struct common_audit_data *sa,\n\t\t   void (*cb)(struct audit_buffer *, void *))\n{\n\tint type, error;\n\tu32 denied = request & (~perms->allow | perms->deny);\n\n\tif (likely(!denied)) {\n\t\t/* mask off perms that are not being force audited */\n\t\trequest &= perms->audit;\n\t\tif (!request || !sa)\n\t\t\treturn 0;\n\n\t\ttype = AUDIT_APPARMOR_AUDIT;\n\t\terror = 0;\n\t} else {\n\t\terror = -EACCES;\n\n\t\tif (denied & perms->kill)\n\t\t\ttype = AUDIT_APPARMOR_KILL;\n\t\telse if (denied == (denied & perms->complain))\n\t\t\ttype = AUDIT_APPARMOR_ALLOWED;\n\t\telse\n\t\t\ttype = AUDIT_APPARMOR_DENIED;\n\n\t\tif (denied == (denied & perms->hide))\n\t\t\terror = -ENOENT;\n\n\t\tdenied &= ~perms->quiet;\n\t\tif (!sa || !denied)\n\t\t\treturn error;\n\t}\n\n\tif (sa) {\n\t\taad(sa)->label = &profile->label;\n\t\taad(sa)->request = request;\n\t\taad(sa)->denied = denied;\n\t\taad(sa)->error = error;\n\t\taa_audit_msg(type, sa, cb);\n\t}\n\n\tif (type == AUDIT_APPARMOR_ALLOWED)\n\t\terror = 0;\n\n\treturn error;\n}",
    "includes": [
      "#include \"include/policy.h\"",
      "#include \"include/perms.h\"",
      "#include \"include/lib.h\"",
      "#include \"include/apparmor.h\"",
      "#include \"include/audit.h\"",
      "#include <linux/vmalloc.h>",
      "#include <linux/string.h>",
      "#include <linux/slab.h>",
      "#include <linux/mm.h>",
      "#include <linux/ctype.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "aa_audit_msg",
          "args": [
            "type",
            "sa",
            "cb"
          ],
          "line": 459
        },
        "resolved": true,
        "details": {
          "function_name": "aa_audit_msg",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/audit.c",
          "lines": "111-116",
          "snippet": "void aa_audit_msg(int type, struct common_audit_data *sa,\n\t\t  void (*cb) (struct audit_buffer *, void *))\n{\n\taad(sa)->type = type;\n\tcommon_lsm_audit(sa, audit_pre, cb);\n}",
          "includes": [
            "#include \"include/policy_ns.h\"",
            "#include \"include/policy.h\"",
            "#include \"include/audit.h\"",
            "#include \"include/apparmor.h\"",
            "#include <linux/socket.h>",
            "#include <linux/audit.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"include/policy_ns.h\"\n#include \"include/policy.h\"\n#include \"include/audit.h\"\n#include \"include/apparmor.h\"\n#include <linux/socket.h>\n#include <linux/audit.h>\n\nvoid aa_audit_msg(int type, struct common_audit_data *sa,\n\t\t  void (*cb) (struct audit_buffer *, void *))\n{\n\taad(sa)->type = type;\n\tcommon_lsm_audit(sa, audit_pre, cb);\n}"
        }
      },
      {
        "call_info": {
          "callee": "aad",
          "args": [
            "sa"
          ],
          "line": 458
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "aad",
          "args": [
            "sa"
          ],
          "line": 457
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "aad",
          "args": [
            "sa"
          ],
          "line": 456
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "aad",
          "args": [
            "sa"
          ],
          "line": 455
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "likely",
          "args": [
            "!denied"
          ],
          "line": 428
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"include/policy.h\"\n#include \"include/perms.h\"\n#include \"include/lib.h\"\n#include \"include/apparmor.h\"\n#include \"include/audit.h\"\n#include <linux/vmalloc.h>\n#include <linux/string.h>\n#include <linux/slab.h>\n#include <linux/mm.h>\n#include <linux/ctype.h>\n\nint aa_check_perms(struct aa_profile *profile, struct aa_perms *perms,\n\t\t   u32 request, struct common_audit_data *sa,\n\t\t   void (*cb)(struct audit_buffer *, void *))\n{\n\tint type, error;\n\tu32 denied = request & (~perms->allow | perms->deny);\n\n\tif (likely(!denied)) {\n\t\t/* mask off perms that are not being force audited */\n\t\trequest &= perms->audit;\n\t\tif (!request || !sa)\n\t\t\treturn 0;\n\n\t\ttype = AUDIT_APPARMOR_AUDIT;\n\t\terror = 0;\n\t} else {\n\t\terror = -EACCES;\n\n\t\tif (denied & perms->kill)\n\t\t\ttype = AUDIT_APPARMOR_KILL;\n\t\telse if (denied == (denied & perms->complain))\n\t\t\ttype = AUDIT_APPARMOR_ALLOWED;\n\t\telse\n\t\t\ttype = AUDIT_APPARMOR_DENIED;\n\n\t\tif (denied == (denied & perms->hide))\n\t\t\terror = -ENOENT;\n\n\t\tdenied &= ~perms->quiet;\n\t\tif (!sa || !denied)\n\t\t\treturn error;\n\t}\n\n\tif (sa) {\n\t\taad(sa)->label = &profile->label;\n\t\taad(sa)->request = request;\n\t\taad(sa)->denied = denied;\n\t\taad(sa)->error = error;\n\t\taa_audit_msg(type, sa, cb);\n\t}\n\n\tif (type == AUDIT_APPARMOR_ALLOWED)\n\t\terror = 0;\n\n\treturn error;\n}"
  },
  {
    "function_name": "aa_profile_label_perm",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/lib.c",
    "lines": "387-401",
    "snippet": "int aa_profile_label_perm(struct aa_profile *profile, struct aa_profile *target,\n\t\t\t  u32 request, int type, u32 *deny,\n\t\t\t  struct common_audit_data *sa)\n{\n\tstruct aa_perms perms;\n\n\taad(sa)->label = &profile->label;\n\taad(sa)->peer = &target->label;\n\taad(sa)->request = request;\n\n\taa_profile_match_label(profile, &target->label, type, request, &perms);\n\taa_apply_modes_to_perms(profile, &perms);\n\t*deny |= request & perms.deny;\n\treturn aa_check_perms(profile, &perms, request, sa, aa_audit_perms_cb);\n}",
    "includes": [
      "#include \"include/policy.h\"",
      "#include \"include/perms.h\"",
      "#include \"include/lib.h\"",
      "#include \"include/apparmor.h\"",
      "#include \"include/audit.h\"",
      "#include <linux/vmalloc.h>",
      "#include <linux/string.h>",
      "#include <linux/slab.h>",
      "#include <linux/mm.h>",
      "#include <linux/ctype.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "aa_check_perms",
          "args": [
            "profile",
            "&perms",
            "request",
            "sa",
            "aa_audit_perms_cb"
          ],
          "line": 400
        },
        "resolved": true,
        "details": {
          "function_name": "aa_check_perms",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/lib.c",
          "lines": "421-466",
          "snippet": "int aa_check_perms(struct aa_profile *profile, struct aa_perms *perms,\n\t\t   u32 request, struct common_audit_data *sa,\n\t\t   void (*cb)(struct audit_buffer *, void *))\n{\n\tint type, error;\n\tu32 denied = request & (~perms->allow | perms->deny);\n\n\tif (likely(!denied)) {\n\t\t/* mask off perms that are not being force audited */\n\t\trequest &= perms->audit;\n\t\tif (!request || !sa)\n\t\t\treturn 0;\n\n\t\ttype = AUDIT_APPARMOR_AUDIT;\n\t\terror = 0;\n\t} else {\n\t\terror = -EACCES;\n\n\t\tif (denied & perms->kill)\n\t\t\ttype = AUDIT_APPARMOR_KILL;\n\t\telse if (denied == (denied & perms->complain))\n\t\t\ttype = AUDIT_APPARMOR_ALLOWED;\n\t\telse\n\t\t\ttype = AUDIT_APPARMOR_DENIED;\n\n\t\tif (denied == (denied & perms->hide))\n\t\t\terror = -ENOENT;\n\n\t\tdenied &= ~perms->quiet;\n\t\tif (!sa || !denied)\n\t\t\treturn error;\n\t}\n\n\tif (sa) {\n\t\taad(sa)->label = &profile->label;\n\t\taad(sa)->request = request;\n\t\taad(sa)->denied = denied;\n\t\taad(sa)->error = error;\n\t\taa_audit_msg(type, sa, cb);\n\t}\n\n\tif (type == AUDIT_APPARMOR_ALLOWED)\n\t\terror = 0;\n\n\treturn error;\n}",
          "includes": [
            "#include \"include/policy.h\"",
            "#include \"include/perms.h\"",
            "#include \"include/lib.h\"",
            "#include \"include/apparmor.h\"",
            "#include \"include/audit.h\"",
            "#include <linux/vmalloc.h>",
            "#include <linux/string.h>",
            "#include <linux/slab.h>",
            "#include <linux/mm.h>",
            "#include <linux/ctype.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"include/policy.h\"\n#include \"include/perms.h\"\n#include \"include/lib.h\"\n#include \"include/apparmor.h\"\n#include \"include/audit.h\"\n#include <linux/vmalloc.h>\n#include <linux/string.h>\n#include <linux/slab.h>\n#include <linux/mm.h>\n#include <linux/ctype.h>\n\nint aa_check_perms(struct aa_profile *profile, struct aa_perms *perms,\n\t\t   u32 request, struct common_audit_data *sa,\n\t\t   void (*cb)(struct audit_buffer *, void *))\n{\n\tint type, error;\n\tu32 denied = request & (~perms->allow | perms->deny);\n\n\tif (likely(!denied)) {\n\t\t/* mask off perms that are not being force audited */\n\t\trequest &= perms->audit;\n\t\tif (!request || !sa)\n\t\t\treturn 0;\n\n\t\ttype = AUDIT_APPARMOR_AUDIT;\n\t\terror = 0;\n\t} else {\n\t\terror = -EACCES;\n\n\t\tif (denied & perms->kill)\n\t\t\ttype = AUDIT_APPARMOR_KILL;\n\t\telse if (denied == (denied & perms->complain))\n\t\t\ttype = AUDIT_APPARMOR_ALLOWED;\n\t\telse\n\t\t\ttype = AUDIT_APPARMOR_DENIED;\n\n\t\tif (denied == (denied & perms->hide))\n\t\t\terror = -ENOENT;\n\n\t\tdenied &= ~perms->quiet;\n\t\tif (!sa || !denied)\n\t\t\treturn error;\n\t}\n\n\tif (sa) {\n\t\taad(sa)->label = &profile->label;\n\t\taad(sa)->request = request;\n\t\taad(sa)->denied = denied;\n\t\taad(sa)->error = error;\n\t\taa_audit_msg(type, sa, cb);\n\t}\n\n\tif (type == AUDIT_APPARMOR_ALLOWED)\n\t\terror = 0;\n\n\treturn error;\n}"
        }
      },
      {
        "call_info": {
          "callee": "aa_apply_modes_to_perms",
          "args": [
            "profile",
            "&perms"
          ],
          "line": 398
        },
        "resolved": true,
        "details": {
          "function_name": "aa_apply_modes_to_perms",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/lib.c",
          "lines": "282-308",
          "snippet": "void aa_apply_modes_to_perms(struct aa_profile *profile, struct aa_perms *perms)\n{\n\tswitch (AUDIT_MODE(profile)) {\n\tcase AUDIT_ALL:\n\t\tperms->audit = ALL_PERMS_MASK;\n\t\t/* fall through */\n\tcase AUDIT_NOQUIET:\n\t\tperms->quiet = 0;\n\t\tbreak;\n\tcase AUDIT_QUIET:\n\t\tperms->audit = 0;\n\t\t/* fall through */\n\tcase AUDIT_QUIET_DENIED:\n\t\tperms->quiet = ALL_PERMS_MASK;\n\t\tbreak;\n\t}\n\n\tif (KILL_MODE(profile))\n\t\tperms->kill = ALL_PERMS_MASK;\n\telse if (COMPLAIN_MODE(profile))\n\t\tperms->complain = ALL_PERMS_MASK;\n/*\n *  TODO:\n *\telse if (PROMPT_MODE(profile))\n *\t\tperms->prompt = ALL_PERMS_MASK;\n */\n}",
          "includes": [
            "#include \"include/policy.h\"",
            "#include \"include/perms.h\"",
            "#include \"include/lib.h\"",
            "#include \"include/apparmor.h\"",
            "#include \"include/audit.h\"",
            "#include <linux/vmalloc.h>",
            "#include <linux/string.h>",
            "#include <linux/slab.h>",
            "#include <linux/mm.h>",
            "#include <linux/ctype.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"include/policy.h\"\n#include \"include/perms.h\"\n#include \"include/lib.h\"\n#include \"include/apparmor.h\"\n#include \"include/audit.h\"\n#include <linux/vmalloc.h>\n#include <linux/string.h>\n#include <linux/slab.h>\n#include <linux/mm.h>\n#include <linux/ctype.h>\n\nvoid aa_apply_modes_to_perms(struct aa_profile *profile, struct aa_perms *perms)\n{\n\tswitch (AUDIT_MODE(profile)) {\n\tcase AUDIT_ALL:\n\t\tperms->audit = ALL_PERMS_MASK;\n\t\t/* fall through */\n\tcase AUDIT_NOQUIET:\n\t\tperms->quiet = 0;\n\t\tbreak;\n\tcase AUDIT_QUIET:\n\t\tperms->audit = 0;\n\t\t/* fall through */\n\tcase AUDIT_QUIET_DENIED:\n\t\tperms->quiet = ALL_PERMS_MASK;\n\t\tbreak;\n\t}\n\n\tif (KILL_MODE(profile))\n\t\tperms->kill = ALL_PERMS_MASK;\n\telse if (COMPLAIN_MODE(profile))\n\t\tperms->complain = ALL_PERMS_MASK;\n/*\n *  TODO:\n *\telse if (PROMPT_MODE(profile))\n *\t\tperms->prompt = ALL_PERMS_MASK;\n */\n}"
        }
      },
      {
        "call_info": {
          "callee": "aa_profile_match_label",
          "args": [
            "profile",
            "&target->label",
            "type",
            "request",
            "&perms"
          ],
          "line": 397
        },
        "resolved": true,
        "details": {
          "function_name": "aa_profile_match_label",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/lib.c",
          "lines": "373-383",
          "snippet": "void aa_profile_match_label(struct aa_profile *profile, struct aa_label *label,\n\t\t\t    int type, u32 request, struct aa_perms *perms)\n{\n\t/* TODO: doesn't yet handle extended types */\n\tunsigned int state;\n\n\tstate = aa_dfa_next(profile->policy.dfa,\n\t\t\t    profile->policy.start[AA_CLASS_LABEL],\n\t\t\t    type);\n\taa_label_match(profile, label, state, false, request, perms);\n}",
          "includes": [
            "#include \"include/policy.h\"",
            "#include \"include/perms.h\"",
            "#include \"include/lib.h\"",
            "#include \"include/apparmor.h\"",
            "#include \"include/audit.h\"",
            "#include <linux/vmalloc.h>",
            "#include <linux/string.h>",
            "#include <linux/slab.h>",
            "#include <linux/mm.h>",
            "#include <linux/ctype.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"include/policy.h\"\n#include \"include/perms.h\"\n#include \"include/lib.h\"\n#include \"include/apparmor.h\"\n#include \"include/audit.h\"\n#include <linux/vmalloc.h>\n#include <linux/string.h>\n#include <linux/slab.h>\n#include <linux/mm.h>\n#include <linux/ctype.h>\n\nvoid aa_profile_match_label(struct aa_profile *profile, struct aa_label *label,\n\t\t\t    int type, u32 request, struct aa_perms *perms)\n{\n\t/* TODO: doesn't yet handle extended types */\n\tunsigned int state;\n\n\tstate = aa_dfa_next(profile->policy.dfa,\n\t\t\t    profile->policy.start[AA_CLASS_LABEL],\n\t\t\t    type);\n\taa_label_match(profile, label, state, false, request, perms);\n}"
        }
      },
      {
        "call_info": {
          "callee": "aad",
          "args": [
            "sa"
          ],
          "line": 395
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "aad",
          "args": [
            "sa"
          ],
          "line": 394
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "aad",
          "args": [
            "sa"
          ],
          "line": 393
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"include/policy.h\"\n#include \"include/perms.h\"\n#include \"include/lib.h\"\n#include \"include/apparmor.h\"\n#include \"include/audit.h\"\n#include <linux/vmalloc.h>\n#include <linux/string.h>\n#include <linux/slab.h>\n#include <linux/mm.h>\n#include <linux/ctype.h>\n\nint aa_profile_label_perm(struct aa_profile *profile, struct aa_profile *target,\n\t\t\t  u32 request, int type, u32 *deny,\n\t\t\t  struct common_audit_data *sa)\n{\n\tstruct aa_perms perms;\n\n\taad(sa)->label = &profile->label;\n\taad(sa)->peer = &target->label;\n\taad(sa)->request = request;\n\n\taa_profile_match_label(profile, &target->label, type, request, &perms);\n\taa_apply_modes_to_perms(profile, &perms);\n\t*deny |= request & perms.deny;\n\treturn aa_check_perms(profile, &perms, request, sa, aa_audit_perms_cb);\n}"
  },
  {
    "function_name": "aa_profile_match_label",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/lib.c",
    "lines": "373-383",
    "snippet": "void aa_profile_match_label(struct aa_profile *profile, struct aa_label *label,\n\t\t\t    int type, u32 request, struct aa_perms *perms)\n{\n\t/* TODO: doesn't yet handle extended types */\n\tunsigned int state;\n\n\tstate = aa_dfa_next(profile->policy.dfa,\n\t\t\t    profile->policy.start[AA_CLASS_LABEL],\n\t\t\t    type);\n\taa_label_match(profile, label, state, false, request, perms);\n}",
    "includes": [
      "#include \"include/policy.h\"",
      "#include \"include/perms.h\"",
      "#include \"include/lib.h\"",
      "#include \"include/apparmor.h\"",
      "#include \"include/audit.h\"",
      "#include <linux/vmalloc.h>",
      "#include <linux/string.h>",
      "#include <linux/slab.h>",
      "#include <linux/mm.h>",
      "#include <linux/ctype.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "aa_label_match",
          "args": [
            "profile",
            "label",
            "state",
            "false",
            "request",
            "perms"
          ],
          "line": 382
        },
        "resolved": true,
        "details": {
          "function_name": "aa_label_match",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/label.c",
          "lines": "1395-1407",
          "snippet": "int aa_label_match(struct aa_profile *profile, struct aa_label *label,\n\t\t   unsigned int state, bool subns, u32 request,\n\t\t   struct aa_perms *perms)\n{\n\tint error = label_compound_match(profile, label, state, subns, request,\n\t\t\t\t\t perms);\n\tif (!error)\n\t\treturn error;\n\n\t*perms = allperms;\n\treturn label_components_match(profile, label, state, subns, request,\n\t\t\t\t      perms);\n}",
          "includes": [
            "#include \"include/secid.h\"",
            "#include \"include/policy.h\"",
            "#include \"include/label.h\"",
            "#include \"include/context.h\"",
            "#include \"include/apparmor.h\"",
            "#include <linux/sort.h>",
            "#include <linux/seq_file.h>",
            "#include <linux/audit.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"include/secid.h\"\n#include \"include/policy.h\"\n#include \"include/label.h\"\n#include \"include/context.h\"\n#include \"include/apparmor.h\"\n#include <linux/sort.h>\n#include <linux/seq_file.h>\n#include <linux/audit.h>\n\nint aa_label_match(struct aa_profile *profile, struct aa_label *label,\n\t\t   unsigned int state, bool subns, u32 request,\n\t\t   struct aa_perms *perms)\n{\n\tint error = label_compound_match(profile, label, state, subns, request,\n\t\t\t\t\t perms);\n\tif (!error)\n\t\treturn error;\n\n\t*perms = allperms;\n\treturn label_components_match(profile, label, state, subns, request,\n\t\t\t\t      perms);\n}"
        }
      },
      {
        "call_info": {
          "callee": "aa_dfa_next",
          "args": [
            "profile->policy.dfa",
            "profile->policy.start[AA_CLASS_LABEL]",
            "type"
          ],
          "line": 379
        },
        "resolved": true,
        "details": {
          "function_name": "aa_dfa_next",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/match.c",
          "lines": "429-459",
          "snippet": "unsigned int aa_dfa_next(struct aa_dfa *dfa, unsigned int state,\n\t\t\t  const char c)\n{\n\tu16 *def = DEFAULT_TABLE(dfa);\n\tu32 *base = BASE_TABLE(dfa);\n\tu16 *next = NEXT_TABLE(dfa);\n\tu16 *check = CHECK_TABLE(dfa);\n\tunsigned int pos;\n\n\t/* current state is <state>, matching character *str */\n\tif (dfa->tables[YYTD_ID_EC]) {\n\t\t/* Equivalence class table defined */\n\t\tu8 *equiv = EQUIV_TABLE(dfa);\n\t\t/* default is direct to next state */\n\n\t\tpos = base_idx(base[state]) + equiv[(u8) c];\n\t\tif (check[pos] == state)\n\t\t\tstate = next[pos];\n\t\telse\n\t\t\tstate = def[state];\n\t} else {\n\t\t/* default is direct to next state */\n\t\tpos = base_idx(base[state]) + (u8) c;\n\t\tif (check[pos] == state)\n\t\t\tstate = next[pos];\n\t\telse\n\t\t\tstate = def[state];\n\t}\n\n\treturn state;\n}",
          "includes": [
            "#include \"include/match.h\"",
            "#include \"include/lib.h\"",
            "#include <linux/kref.h>",
            "#include <linux/err.h>",
            "#include <linux/vmalloc.h>",
            "#include <linux/slab.h>",
            "#include <linux/mm.h>",
            "#include <linux/kernel.h>",
            "#include <linux/errno.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"include/match.h\"\n#include \"include/lib.h\"\n#include <linux/kref.h>\n#include <linux/err.h>\n#include <linux/vmalloc.h>\n#include <linux/slab.h>\n#include <linux/mm.h>\n#include <linux/kernel.h>\n#include <linux/errno.h>\n\nunsigned int aa_dfa_next(struct aa_dfa *dfa, unsigned int state,\n\t\t\t  const char c)\n{\n\tu16 *def = DEFAULT_TABLE(dfa);\n\tu32 *base = BASE_TABLE(dfa);\n\tu16 *next = NEXT_TABLE(dfa);\n\tu16 *check = CHECK_TABLE(dfa);\n\tunsigned int pos;\n\n\t/* current state is <state>, matching character *str */\n\tif (dfa->tables[YYTD_ID_EC]) {\n\t\t/* Equivalence class table defined */\n\t\tu8 *equiv = EQUIV_TABLE(dfa);\n\t\t/* default is direct to next state */\n\n\t\tpos = base_idx(base[state]) + equiv[(u8) c];\n\t\tif (check[pos] == state)\n\t\t\tstate = next[pos];\n\t\telse\n\t\t\tstate = def[state];\n\t} else {\n\t\t/* default is direct to next state */\n\t\tpos = base_idx(base[state]) + (u8) c;\n\t\tif (check[pos] == state)\n\t\t\tstate = next[pos];\n\t\telse\n\t\t\tstate = def[state];\n\t}\n\n\treturn state;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"include/policy.h\"\n#include \"include/perms.h\"\n#include \"include/lib.h\"\n#include \"include/apparmor.h\"\n#include \"include/audit.h\"\n#include <linux/vmalloc.h>\n#include <linux/string.h>\n#include <linux/slab.h>\n#include <linux/mm.h>\n#include <linux/ctype.h>\n\nvoid aa_profile_match_label(struct aa_profile *profile, struct aa_label *label,\n\t\t\t    int type, u32 request, struct aa_perms *perms)\n{\n\t/* TODO: doesn't yet handle extended types */\n\tunsigned int state;\n\n\tstate = aa_dfa_next(profile->policy.dfa,\n\t\t\t    profile->policy.start[AA_CLASS_LABEL],\n\t\t\t    type);\n\taa_label_match(profile, label, state, false, request, perms);\n}"
  },
  {
    "function_name": "aa_perms_accum",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/lib.c",
    "lines": "359-371",
    "snippet": "void aa_perms_accum(struct aa_perms *accum, struct aa_perms *addend)\n{\n\taccum->deny |= addend->deny;\n\taccum->allow &= addend->allow & ~accum->deny;\n\taccum->audit |= addend->audit & accum->allow;\n\taccum->quiet &= addend->quiet & ~accum->allow;\n\taccum->kill |= addend->kill & ~accum->allow;\n\taccum->stop |= addend->stop & ~accum->allow;\n\taccum->complain |= addend->complain & ~accum->allow & ~accum->deny;\n\taccum->cond |= addend->cond & ~accum->allow & ~accum->deny;\n\taccum->hide &= addend->hide & ~accum->allow;\n\taccum->prompt |= addend->prompt & ~accum->allow & ~accum->deny;\n}",
    "includes": [
      "#include \"include/policy.h\"",
      "#include \"include/perms.h\"",
      "#include \"include/lib.h\"",
      "#include \"include/apparmor.h\"",
      "#include \"include/audit.h\"",
      "#include <linux/vmalloc.h>",
      "#include <linux/string.h>",
      "#include <linux/slab.h>",
      "#include <linux/mm.h>",
      "#include <linux/ctype.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"include/policy.h\"\n#include \"include/perms.h\"\n#include \"include/lib.h\"\n#include \"include/apparmor.h\"\n#include \"include/audit.h\"\n#include <linux/vmalloc.h>\n#include <linux/string.h>\n#include <linux/slab.h>\n#include <linux/mm.h>\n#include <linux/ctype.h>\n\nvoid aa_perms_accum(struct aa_perms *accum, struct aa_perms *addend)\n{\n\taccum->deny |= addend->deny;\n\taccum->allow &= addend->allow & ~accum->deny;\n\taccum->audit |= addend->audit & accum->allow;\n\taccum->quiet &= addend->quiet & ~accum->allow;\n\taccum->kill |= addend->kill & ~accum->allow;\n\taccum->stop |= addend->stop & ~accum->allow;\n\taccum->complain |= addend->complain & ~accum->allow & ~accum->deny;\n\taccum->cond |= addend->cond & ~accum->allow & ~accum->deny;\n\taccum->hide &= addend->hide & ~accum->allow;\n\taccum->prompt |= addend->prompt & ~accum->allow & ~accum->deny;\n}"
  },
  {
    "function_name": "aa_perms_accum_raw",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/lib.c",
    "lines": "340-352",
    "snippet": "void aa_perms_accum_raw(struct aa_perms *accum, struct aa_perms *addend)\n{\n\taccum->deny |= addend->deny;\n\taccum->allow &= addend->allow & ~addend->deny;\n\taccum->audit |= addend->audit & addend->allow;\n\taccum->quiet &= addend->quiet & ~addend->allow;\n\taccum->kill |= addend->kill & ~addend->allow;\n\taccum->stop |= addend->stop & ~addend->allow;\n\taccum->complain |= addend->complain & ~addend->allow & ~addend->deny;\n\taccum->cond |= addend->cond & ~addend->allow & ~addend->deny;\n\taccum->hide &= addend->hide & ~addend->allow;\n\taccum->prompt |= addend->prompt & ~addend->allow & ~addend->deny;\n}",
    "includes": [
      "#include \"include/policy.h\"",
      "#include \"include/perms.h\"",
      "#include \"include/lib.h\"",
      "#include \"include/apparmor.h\"",
      "#include \"include/audit.h\"",
      "#include <linux/vmalloc.h>",
      "#include <linux/string.h>",
      "#include <linux/slab.h>",
      "#include <linux/mm.h>",
      "#include <linux/ctype.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"include/policy.h\"\n#include \"include/perms.h\"\n#include \"include/lib.h\"\n#include \"include/apparmor.h\"\n#include \"include/audit.h\"\n#include <linux/vmalloc.h>\n#include <linux/string.h>\n#include <linux/slab.h>\n#include <linux/mm.h>\n#include <linux/ctype.h>\n\nvoid aa_perms_accum_raw(struct aa_perms *accum, struct aa_perms *addend)\n{\n\taccum->deny |= addend->deny;\n\taccum->allow &= addend->allow & ~addend->deny;\n\taccum->audit |= addend->audit & addend->allow;\n\taccum->quiet &= addend->quiet & ~addend->allow;\n\taccum->kill |= addend->kill & ~addend->allow;\n\taccum->stop |= addend->stop & ~addend->allow;\n\taccum->complain |= addend->complain & ~addend->allow & ~addend->deny;\n\taccum->cond |= addend->cond & ~addend->allow & ~addend->deny;\n\taccum->hide &= addend->hide & ~addend->allow;\n\taccum->prompt |= addend->prompt & ~addend->allow & ~addend->deny;\n}"
  },
  {
    "function_name": "aa_compute_perms",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/lib.c",
    "lines": "317-333",
    "snippet": "void aa_compute_perms(struct aa_dfa *dfa, unsigned int state,\n\t\t      struct aa_perms *perms)\n{\n\t*perms = (struct aa_perms) {\n\t\t.allow = dfa_user_allow(dfa, state),\n\t\t.audit = dfa_user_audit(dfa, state),\n\t\t.quiet = dfa_user_quiet(dfa, state),\n\t};\n\n\t/* for v5 perm mapping in the policydb, the other set is used\n\t * to extend the general perm set\n\t */\n\tperms->allow |= map_other(dfa_other_allow(dfa, state));\n\tperms->audit |= map_other(dfa_other_audit(dfa, state));\n\tperms->quiet |= map_other(dfa_other_quiet(dfa, state));\n//\tperms->xindex = dfa_user_xindex(dfa, state);\n}",
    "includes": [
      "#include \"include/policy.h\"",
      "#include \"include/perms.h\"",
      "#include \"include/lib.h\"",
      "#include \"include/apparmor.h\"",
      "#include \"include/audit.h\"",
      "#include <linux/vmalloc.h>",
      "#include <linux/string.h>",
      "#include <linux/slab.h>",
      "#include <linux/mm.h>",
      "#include <linux/ctype.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "map_other",
          "args": [
            "dfa_other_quiet(dfa, state)"
          ],
          "line": 331
        },
        "resolved": true,
        "details": {
          "function_name": "map_other",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/lib.c",
          "lines": "310-315",
          "snippet": "static u32 map_other(u32 x)\n{\n\treturn ((x & 0x3) << 8) |\t/* SETATTR/GETATTR */\n\t\t((x & 0x1c) << 18) |\t/* ACCEPT/BIND/LISTEN */\n\t\t((x & 0x60) << 19);\t/* SETOPT/GETOPT */\n}",
          "includes": [
            "#include \"include/policy.h\"",
            "#include \"include/perms.h\"",
            "#include \"include/lib.h\"",
            "#include \"include/apparmor.h\"",
            "#include \"include/audit.h\"",
            "#include <linux/vmalloc.h>",
            "#include <linux/string.h>",
            "#include <linux/slab.h>",
            "#include <linux/mm.h>",
            "#include <linux/ctype.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"include/policy.h\"\n#include \"include/perms.h\"\n#include \"include/lib.h\"\n#include \"include/apparmor.h\"\n#include \"include/audit.h\"\n#include <linux/vmalloc.h>\n#include <linux/string.h>\n#include <linux/slab.h>\n#include <linux/mm.h>\n#include <linux/ctype.h>\n\nstatic u32 map_other(u32 x)\n{\n\treturn ((x & 0x3) << 8) |\t/* SETATTR/GETATTR */\n\t\t((x & 0x1c) << 18) |\t/* ACCEPT/BIND/LISTEN */\n\t\t((x & 0x60) << 19);\t/* SETOPT/GETOPT */\n}"
        }
      },
      {
        "call_info": {
          "callee": "dfa_other_quiet",
          "args": [
            "dfa",
            "state"
          ],
          "line": 331
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dfa_other_audit",
          "args": [
            "dfa",
            "state"
          ],
          "line": 330
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dfa_other_allow",
          "args": [
            "dfa",
            "state"
          ],
          "line": 329
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dfa_user_quiet",
          "args": [
            "dfa",
            "state"
          ],
          "line": 323
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dfa_user_audit",
          "args": [
            "dfa",
            "state"
          ],
          "line": 322
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dfa_user_allow",
          "args": [
            "dfa",
            "state"
          ],
          "line": 321
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"include/policy.h\"\n#include \"include/perms.h\"\n#include \"include/lib.h\"\n#include \"include/apparmor.h\"\n#include \"include/audit.h\"\n#include <linux/vmalloc.h>\n#include <linux/string.h>\n#include <linux/slab.h>\n#include <linux/mm.h>\n#include <linux/ctype.h>\n\nvoid aa_compute_perms(struct aa_dfa *dfa, unsigned int state,\n\t\t      struct aa_perms *perms)\n{\n\t*perms = (struct aa_perms) {\n\t\t.allow = dfa_user_allow(dfa, state),\n\t\t.audit = dfa_user_audit(dfa, state),\n\t\t.quiet = dfa_user_quiet(dfa, state),\n\t};\n\n\t/* for v5 perm mapping in the policydb, the other set is used\n\t * to extend the general perm set\n\t */\n\tperms->allow |= map_other(dfa_other_allow(dfa, state));\n\tperms->audit |= map_other(dfa_other_audit(dfa, state));\n\tperms->quiet |= map_other(dfa_other_quiet(dfa, state));\n//\tperms->xindex = dfa_user_xindex(dfa, state);\n}"
  },
  {
    "function_name": "map_other",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/lib.c",
    "lines": "310-315",
    "snippet": "static u32 map_other(u32 x)\n{\n\treturn ((x & 0x3) << 8) |\t/* SETATTR/GETATTR */\n\t\t((x & 0x1c) << 18) |\t/* ACCEPT/BIND/LISTEN */\n\t\t((x & 0x60) << 19);\t/* SETOPT/GETOPT */\n}",
    "includes": [
      "#include \"include/policy.h\"",
      "#include \"include/perms.h\"",
      "#include \"include/lib.h\"",
      "#include \"include/apparmor.h\"",
      "#include \"include/audit.h\"",
      "#include <linux/vmalloc.h>",
      "#include <linux/string.h>",
      "#include <linux/slab.h>",
      "#include <linux/mm.h>",
      "#include <linux/ctype.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"include/policy.h\"\n#include \"include/perms.h\"\n#include \"include/lib.h\"\n#include \"include/apparmor.h\"\n#include \"include/audit.h\"\n#include <linux/vmalloc.h>\n#include <linux/string.h>\n#include <linux/slab.h>\n#include <linux/mm.h>\n#include <linux/ctype.h>\n\nstatic u32 map_other(u32 x)\n{\n\treturn ((x & 0x3) << 8) |\t/* SETATTR/GETATTR */\n\t\t((x & 0x1c) << 18) |\t/* ACCEPT/BIND/LISTEN */\n\t\t((x & 0x60) << 19);\t/* SETOPT/GETOPT */\n}"
  },
  {
    "function_name": "aa_apply_modes_to_perms",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/lib.c",
    "lines": "282-308",
    "snippet": "void aa_apply_modes_to_perms(struct aa_profile *profile, struct aa_perms *perms)\n{\n\tswitch (AUDIT_MODE(profile)) {\n\tcase AUDIT_ALL:\n\t\tperms->audit = ALL_PERMS_MASK;\n\t\t/* fall through */\n\tcase AUDIT_NOQUIET:\n\t\tperms->quiet = 0;\n\t\tbreak;\n\tcase AUDIT_QUIET:\n\t\tperms->audit = 0;\n\t\t/* fall through */\n\tcase AUDIT_QUIET_DENIED:\n\t\tperms->quiet = ALL_PERMS_MASK;\n\t\tbreak;\n\t}\n\n\tif (KILL_MODE(profile))\n\t\tperms->kill = ALL_PERMS_MASK;\n\telse if (COMPLAIN_MODE(profile))\n\t\tperms->complain = ALL_PERMS_MASK;\n/*\n *  TODO:\n *\telse if (PROMPT_MODE(profile))\n *\t\tperms->prompt = ALL_PERMS_MASK;\n */\n}",
    "includes": [
      "#include \"include/policy.h\"",
      "#include \"include/perms.h\"",
      "#include \"include/lib.h\"",
      "#include \"include/apparmor.h\"",
      "#include \"include/audit.h\"",
      "#include <linux/vmalloc.h>",
      "#include <linux/string.h>",
      "#include <linux/slab.h>",
      "#include <linux/mm.h>",
      "#include <linux/ctype.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "COMPLAIN_MODE",
          "args": [
            "profile"
          ],
          "line": 301
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "KILL_MODE",
          "args": [
            "profile"
          ],
          "line": 299
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "AUDIT_MODE",
          "args": [
            "profile"
          ],
          "line": 284
        },
        "resolved": true,
        "details": {
          "function_name": "AUDIT_MODE",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/include/policy.h",
          "lines": "283-289",
          "snippet": "static inline int AUDIT_MODE(struct aa_profile *profile)\n{\n\tif (aa_g_audit != AUDIT_NORMAL)\n\t\treturn aa_g_audit;\n\n\treturn profile->audit;\n}",
          "includes": [
            "#include \"resource.h\"",
            "#include \"perms.h\"",
            "#include \"label.h\"",
            "#include \"lib.h\"",
            "#include \"file.h\"",
            "#include \"domain.h\"",
            "#include \"capability.h\"",
            "#include \"audit.h\"",
            "#include \"apparmor.h\"",
            "#include <linux/socket.h>",
            "#include <linux/slab.h>",
            "#include <linux/sched.h>",
            "#include <linux/rhashtable.h>",
            "#include <linux/kref.h>",
            "#include <linux/cred.h>",
            "#include <linux/capability.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"resource.h\"\n#include \"perms.h\"\n#include \"label.h\"\n#include \"lib.h\"\n#include \"file.h\"\n#include \"domain.h\"\n#include \"capability.h\"\n#include \"audit.h\"\n#include \"apparmor.h\"\n#include <linux/socket.h>\n#include <linux/slab.h>\n#include <linux/sched.h>\n#include <linux/rhashtable.h>\n#include <linux/kref.h>\n#include <linux/cred.h>\n#include <linux/capability.h>\n\nstatic inline int AUDIT_MODE(struct aa_profile *profile)\n{\n\tif (aa_g_audit != AUDIT_NORMAL)\n\t\treturn aa_g_audit;\n\n\treturn profile->audit;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"include/policy.h\"\n#include \"include/perms.h\"\n#include \"include/lib.h\"\n#include \"include/apparmor.h\"\n#include \"include/audit.h\"\n#include <linux/vmalloc.h>\n#include <linux/string.h>\n#include <linux/slab.h>\n#include <linux/mm.h>\n#include <linux/ctype.h>\n\nvoid aa_apply_modes_to_perms(struct aa_profile *profile, struct aa_perms *perms)\n{\n\tswitch (AUDIT_MODE(profile)) {\n\tcase AUDIT_ALL:\n\t\tperms->audit = ALL_PERMS_MASK;\n\t\t/* fall through */\n\tcase AUDIT_NOQUIET:\n\t\tperms->quiet = 0;\n\t\tbreak;\n\tcase AUDIT_QUIET:\n\t\tperms->audit = 0;\n\t\t/* fall through */\n\tcase AUDIT_QUIET_DENIED:\n\t\tperms->quiet = ALL_PERMS_MASK;\n\t\tbreak;\n\t}\n\n\tif (KILL_MODE(profile))\n\t\tperms->kill = ALL_PERMS_MASK;\n\telse if (COMPLAIN_MODE(profile))\n\t\tperms->complain = ALL_PERMS_MASK;\n/*\n *  TODO:\n *\telse if (PROMPT_MODE(profile))\n *\t\tperms->prompt = ALL_PERMS_MASK;\n */\n}"
  },
  {
    "function_name": "aa_audit_perms_cb",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/lib.c",
    "lines": "254-273",
    "snippet": "static void aa_audit_perms_cb(struct audit_buffer *ab, void *va)\n{\n\tstruct common_audit_data *sa = va;\n\n\tif (aad(sa)->request) {\n\t\taudit_log_format(ab, \" requested_mask=\");\n\t\taa_audit_perm_mask(ab, aad(sa)->request, aa_file_perm_chrs,\n\t\t\t\t   PERMS_CHRS_MASK, aa_file_perm_names,\n\t\t\t\t   PERMS_NAMES_MASK);\n\t}\n\tif (aad(sa)->denied) {\n\t\taudit_log_format(ab, \"denied_mask=\");\n\t\taa_audit_perm_mask(ab, aad(sa)->denied, aa_file_perm_chrs,\n\t\t\t\t   PERMS_CHRS_MASK, aa_file_perm_names,\n\t\t\t\t   PERMS_NAMES_MASK);\n\t}\n\taudit_log_format(ab, \" peer=\");\n\taa_label_xaudit(ab, labels_ns(aad(sa)->label), aad(sa)->peer,\n\t\t\t\t      FLAGS_NONE, GFP_ATOMIC);\n}",
    "includes": [
      "#include \"include/policy.h\"",
      "#include \"include/perms.h\"",
      "#include \"include/lib.h\"",
      "#include \"include/apparmor.h\"",
      "#include \"include/audit.h\"",
      "#include <linux/vmalloc.h>",
      "#include <linux/string.h>",
      "#include <linux/slab.h>",
      "#include <linux/mm.h>",
      "#include <linux/ctype.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "const char aa_file_perm_chrs[] = \"xwracd         km l     \";",
      "const char *aa_file_perm_names[] = {\n\t\"exec\",\n\t\"write\",\n\t\"read\",\n\t\"append\",\n\n\t\"create\",\n\t\"delete\",\n\t\"open\",\n\t\"rename\",\n\n\t\"setattr\",\n\t\"getattr\",\n\t\"setcred\",\n\t\"getcred\",\n\n\t\"chmod\",\n\t\"chown\",\n\t\"chgrp\",\n\t\"lock\",\n\n\t\"mmap\",\n\t\"mprot\",\n\t\"link\",\n\t\"snapshot\",\n\n\t\"unknown\",\n\t\"unknown\",\n\t\"unknown\",\n\t\"unknown\",\n\n\t\"unknown\",\n\t\"unknown\",\n\t\"unknown\",\n\t\"unknown\",\n\n\t\"stack\",\n\t\"change_onexec\",\n\t\"change_profile\",\n\t\"change_hat\",\n};"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "aa_label_xaudit",
          "args": [
            "ab",
            "labels_ns(aad(sa)->label)",
            "aad(sa)->peer",
            "FLAGS_NONE",
            "GFP_ATOMIC"
          ],
          "line": 271
        },
        "resolved": true,
        "details": {
          "function_name": "aa_label_xaudit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/label.c",
          "lines": "1710-1738",
          "snippet": "void aa_label_xaudit(struct audit_buffer *ab, struct aa_ns *ns,\n\t\t     struct aa_label *label, int flags, gfp_t gfp)\n{\n\tconst char *str;\n\tchar *name = NULL;\n\tint len;\n\n\tAA_BUG(!ab);\n\tAA_BUG(!label);\n\n\tif (!use_label_hname(ns, label, flags) ||\n\t    display_mode(ns, label, flags)) {\n\t\tlen  = aa_label_asxprint(&name, ns, label, flags, gfp);\n\t\tif (len == -1) {\n\t\t\tAA_DEBUG(\"label print error\");\n\t\t\treturn;\n\t\t}\n\t\tstr = name;\n\t} else {\n\t\tstr = (char *) label->hname;\n\t\tlen = strlen(str);\n\t}\n\tif (audit_string_contains_control(str, len))\n\t\taudit_log_n_hex(ab, str, len);\n\telse\n\t\taudit_log_n_string(ab, str, len);\n\n\tkfree(name);\n}",
          "includes": [
            "#include \"include/secid.h\"",
            "#include \"include/policy.h\"",
            "#include \"include/label.h\"",
            "#include \"include/context.h\"",
            "#include \"include/apparmor.h\"",
            "#include <linux/sort.h>",
            "#include <linux/seq_file.h>",
            "#include <linux/audit.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"include/secid.h\"\n#include \"include/policy.h\"\n#include \"include/label.h\"\n#include \"include/context.h\"\n#include \"include/apparmor.h\"\n#include <linux/sort.h>\n#include <linux/seq_file.h>\n#include <linux/audit.h>\n\nvoid aa_label_xaudit(struct audit_buffer *ab, struct aa_ns *ns,\n\t\t     struct aa_label *label, int flags, gfp_t gfp)\n{\n\tconst char *str;\n\tchar *name = NULL;\n\tint len;\n\n\tAA_BUG(!ab);\n\tAA_BUG(!label);\n\n\tif (!use_label_hname(ns, label, flags) ||\n\t    display_mode(ns, label, flags)) {\n\t\tlen  = aa_label_asxprint(&name, ns, label, flags, gfp);\n\t\tif (len == -1) {\n\t\t\tAA_DEBUG(\"label print error\");\n\t\t\treturn;\n\t\t}\n\t\tstr = name;\n\t} else {\n\t\tstr = (char *) label->hname;\n\t\tlen = strlen(str);\n\t}\n\tif (audit_string_contains_control(str, len))\n\t\taudit_log_n_hex(ab, str, len);\n\telse\n\t\taudit_log_n_string(ab, str, len);\n\n\tkfree(name);\n}"
        }
      },
      {
        "call_info": {
          "callee": "aad",
          "args": [
            "sa"
          ],
          "line": 271
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "labels_ns",
          "args": [
            "aad(sa)->label"
          ],
          "line": 271
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "aad",
          "args": [
            "sa"
          ],
          "line": 271
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "audit_log_format",
          "args": [
            "ab",
            "\" peer=\""
          ],
          "line": 270
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "aa_audit_perm_mask",
          "args": [
            "ab",
            "aad(sa)->denied",
            "aa_file_perm_chrs",
            "PERMS_CHRS_MASK",
            "aa_file_perm_names",
            "PERMS_NAMES_MASK"
          ],
          "line": 266
        },
        "resolved": true,
        "details": {
          "function_name": "aa_audit_perm_mask",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/lib.c",
          "lines": "231-247",
          "snippet": "void aa_audit_perm_mask(struct audit_buffer *ab, u32 mask, const char *chrs,\n\t\t\tu32 chrsmask, const char **names, u32 namesmask)\n{\n\tchar str[33];\n\n\taudit_log_format(ab, \"\\\"\");\n\tif ((mask & chrsmask) && chrs) {\n\t\taa_perm_mask_to_str(str, chrs, mask & chrsmask);\n\t\tmask &= ~chrsmask;\n\t\taudit_log_format(ab, \"%s\", str);\n\t\tif (mask & namesmask)\n\t\t\taudit_log_format(ab, \" \");\n\t}\n\tif ((mask & namesmask) && names)\n\t\taa_audit_perm_names(ab, names, mask & namesmask);\n\taudit_log_format(ab, \"\\\"\");\n}",
          "includes": [
            "#include \"include/policy.h\"",
            "#include \"include/perms.h\"",
            "#include \"include/lib.h\"",
            "#include \"include/apparmor.h\"",
            "#include \"include/audit.h\"",
            "#include <linux/vmalloc.h>",
            "#include <linux/string.h>",
            "#include <linux/slab.h>",
            "#include <linux/mm.h>",
            "#include <linux/ctype.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"include/policy.h\"\n#include \"include/perms.h\"\n#include \"include/lib.h\"\n#include \"include/apparmor.h\"\n#include \"include/audit.h\"\n#include <linux/vmalloc.h>\n#include <linux/string.h>\n#include <linux/slab.h>\n#include <linux/mm.h>\n#include <linux/ctype.h>\n\nvoid aa_audit_perm_mask(struct audit_buffer *ab, u32 mask, const char *chrs,\n\t\t\tu32 chrsmask, const char **names, u32 namesmask)\n{\n\tchar str[33];\n\n\taudit_log_format(ab, \"\\\"\");\n\tif ((mask & chrsmask) && chrs) {\n\t\taa_perm_mask_to_str(str, chrs, mask & chrsmask);\n\t\tmask &= ~chrsmask;\n\t\taudit_log_format(ab, \"%s\", str);\n\t\tif (mask & namesmask)\n\t\t\taudit_log_format(ab, \" \");\n\t}\n\tif ((mask & namesmask) && names)\n\t\taa_audit_perm_names(ab, names, mask & namesmask);\n\taudit_log_format(ab, \"\\\"\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "aad",
          "args": [
            "sa"
          ],
          "line": 266
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "audit_log_format",
          "args": [
            "ab",
            "\"denied_mask=\""
          ],
          "line": 265
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "aad",
          "args": [
            "sa"
          ],
          "line": 264
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "aad",
          "args": [
            "sa"
          ],
          "line": 260
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "audit_log_format",
          "args": [
            "ab",
            "\" requested_mask=\""
          ],
          "line": 259
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "aad",
          "args": [
            "sa"
          ],
          "line": 258
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"include/policy.h\"\n#include \"include/perms.h\"\n#include \"include/lib.h\"\n#include \"include/apparmor.h\"\n#include \"include/audit.h\"\n#include <linux/vmalloc.h>\n#include <linux/string.h>\n#include <linux/slab.h>\n#include <linux/mm.h>\n#include <linux/ctype.h>\n\nconst char aa_file_perm_chrs[] = \"xwracd         km l     \";\nconst char *aa_file_perm_names[] = {\n\t\"exec\",\n\t\"write\",\n\t\"read\",\n\t\"append\",\n\n\t\"create\",\n\t\"delete\",\n\t\"open\",\n\t\"rename\",\n\n\t\"setattr\",\n\t\"getattr\",\n\t\"setcred\",\n\t\"getcred\",\n\n\t\"chmod\",\n\t\"chown\",\n\t\"chgrp\",\n\t\"lock\",\n\n\t\"mmap\",\n\t\"mprot\",\n\t\"link\",\n\t\"snapshot\",\n\n\t\"unknown\",\n\t\"unknown\",\n\t\"unknown\",\n\t\"unknown\",\n\n\t\"unknown\",\n\t\"unknown\",\n\t\"unknown\",\n\t\"unknown\",\n\n\t\"stack\",\n\t\"change_onexec\",\n\t\"change_profile\",\n\t\"change_hat\",\n};\n\nstatic void aa_audit_perms_cb(struct audit_buffer *ab, void *va)\n{\n\tstruct common_audit_data *sa = va;\n\n\tif (aad(sa)->request) {\n\t\taudit_log_format(ab, \" requested_mask=\");\n\t\taa_audit_perm_mask(ab, aad(sa)->request, aa_file_perm_chrs,\n\t\t\t\t   PERMS_CHRS_MASK, aa_file_perm_names,\n\t\t\t\t   PERMS_NAMES_MASK);\n\t}\n\tif (aad(sa)->denied) {\n\t\taudit_log_format(ab, \"denied_mask=\");\n\t\taa_audit_perm_mask(ab, aad(sa)->denied, aa_file_perm_chrs,\n\t\t\t\t   PERMS_CHRS_MASK, aa_file_perm_names,\n\t\t\t\t   PERMS_NAMES_MASK);\n\t}\n\taudit_log_format(ab, \" peer=\");\n\taa_label_xaudit(ab, labels_ns(aad(sa)->label), aad(sa)->peer,\n\t\t\t\t      FLAGS_NONE, GFP_ATOMIC);\n}"
  },
  {
    "function_name": "aa_audit_perm_mask",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/lib.c",
    "lines": "231-247",
    "snippet": "void aa_audit_perm_mask(struct audit_buffer *ab, u32 mask, const char *chrs,\n\t\t\tu32 chrsmask, const char **names, u32 namesmask)\n{\n\tchar str[33];\n\n\taudit_log_format(ab, \"\\\"\");\n\tif ((mask & chrsmask) && chrs) {\n\t\taa_perm_mask_to_str(str, chrs, mask & chrsmask);\n\t\tmask &= ~chrsmask;\n\t\taudit_log_format(ab, \"%s\", str);\n\t\tif (mask & namesmask)\n\t\t\taudit_log_format(ab, \" \");\n\t}\n\tif ((mask & namesmask) && names)\n\t\taa_audit_perm_names(ab, names, mask & namesmask);\n\taudit_log_format(ab, \"\\\"\");\n}",
    "includes": [
      "#include \"include/policy.h\"",
      "#include \"include/perms.h\"",
      "#include \"include/lib.h\"",
      "#include \"include/apparmor.h\"",
      "#include \"include/audit.h\"",
      "#include <linux/vmalloc.h>",
      "#include <linux/string.h>",
      "#include <linux/slab.h>",
      "#include <linux/mm.h>",
      "#include <linux/ctype.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "audit_log_format",
          "args": [
            "ab",
            "\"\\\"\""
          ],
          "line": 246
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "aa_audit_perm_names",
          "args": [
            "ab",
            "names",
            "mask & namesmask"
          ],
          "line": 245
        },
        "resolved": true,
        "details": {
          "function_name": "aa_audit_perm_names",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/lib.c",
          "lines": "214-229",
          "snippet": "void aa_audit_perm_names(struct audit_buffer *ab, const char **names, u32 mask)\n{\n\tconst char *fmt = \"%s\";\n\tunsigned int i, perm = 1;\n\tbool prev = false;\n\n\tfor (i = 0; i < 32; perm <<= 1, i++) {\n\t\tif (mask & perm) {\n\t\t\taudit_log_format(ab, fmt, names[i]);\n\t\t\tif (!prev) {\n\t\t\t\tprev = true;\n\t\t\t\tfmt = \" %s\";\n\t\t\t}\n\t\t}\n\t}\n}",
          "includes": [
            "#include \"include/policy.h\"",
            "#include \"include/perms.h\"",
            "#include \"include/lib.h\"",
            "#include \"include/apparmor.h\"",
            "#include \"include/audit.h\"",
            "#include <linux/vmalloc.h>",
            "#include <linux/string.h>",
            "#include <linux/slab.h>",
            "#include <linux/mm.h>",
            "#include <linux/ctype.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"include/policy.h\"\n#include \"include/perms.h\"\n#include \"include/lib.h\"\n#include \"include/apparmor.h\"\n#include \"include/audit.h\"\n#include <linux/vmalloc.h>\n#include <linux/string.h>\n#include <linux/slab.h>\n#include <linux/mm.h>\n#include <linux/ctype.h>\n\nvoid aa_audit_perm_names(struct audit_buffer *ab, const char **names, u32 mask)\n{\n\tconst char *fmt = \"%s\";\n\tunsigned int i, perm = 1;\n\tbool prev = false;\n\n\tfor (i = 0; i < 32; perm <<= 1, i++) {\n\t\tif (mask & perm) {\n\t\t\taudit_log_format(ab, fmt, names[i]);\n\t\t\tif (!prev) {\n\t\t\t\tprev = true;\n\t\t\t\tfmt = \" %s\";\n\t\t\t}\n\t\t}\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "audit_log_format",
          "args": [
            "ab",
            "\" \""
          ],
          "line": 242
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "audit_log_format",
          "args": [
            "ab",
            "\"%s\"",
            "str"
          ],
          "line": 240
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "aa_perm_mask_to_str",
          "args": [
            "str",
            "chrs",
            "mask & chrsmask"
          ],
          "line": 238
        },
        "resolved": true,
        "details": {
          "function_name": "aa_perm_mask_to_str",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/lib.c",
          "lines": "203-212",
          "snippet": "void aa_perm_mask_to_str(char *str, const char *chrs, u32 mask)\n{\n\tunsigned int i, perm = 1;\n\n\tfor (i = 0; i < 32; perm <<= 1, i++) {\n\t\tif (mask & perm)\n\t\t\t*str++ = chrs[i];\n\t}\n\t*str = '\\0';\n}",
          "includes": [
            "#include \"include/policy.h\"",
            "#include \"include/perms.h\"",
            "#include \"include/lib.h\"",
            "#include \"include/apparmor.h\"",
            "#include \"include/audit.h\"",
            "#include <linux/vmalloc.h>",
            "#include <linux/string.h>",
            "#include <linux/slab.h>",
            "#include <linux/mm.h>",
            "#include <linux/ctype.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"include/policy.h\"\n#include \"include/perms.h\"\n#include \"include/lib.h\"\n#include \"include/apparmor.h\"\n#include \"include/audit.h\"\n#include <linux/vmalloc.h>\n#include <linux/string.h>\n#include <linux/slab.h>\n#include <linux/mm.h>\n#include <linux/ctype.h>\n\nvoid aa_perm_mask_to_str(char *str, const char *chrs, u32 mask)\n{\n\tunsigned int i, perm = 1;\n\n\tfor (i = 0; i < 32; perm <<= 1, i++) {\n\t\tif (mask & perm)\n\t\t\t*str++ = chrs[i];\n\t}\n\t*str = '\\0';\n}"
        }
      },
      {
        "call_info": {
          "callee": "audit_log_format",
          "args": [
            "ab",
            "\"\\\"\""
          ],
          "line": 236
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"include/policy.h\"\n#include \"include/perms.h\"\n#include \"include/lib.h\"\n#include \"include/apparmor.h\"\n#include \"include/audit.h\"\n#include <linux/vmalloc.h>\n#include <linux/string.h>\n#include <linux/slab.h>\n#include <linux/mm.h>\n#include <linux/ctype.h>\n\nvoid aa_audit_perm_mask(struct audit_buffer *ab, u32 mask, const char *chrs,\n\t\t\tu32 chrsmask, const char **names, u32 namesmask)\n{\n\tchar str[33];\n\n\taudit_log_format(ab, \"\\\"\");\n\tif ((mask & chrsmask) && chrs) {\n\t\taa_perm_mask_to_str(str, chrs, mask & chrsmask);\n\t\tmask &= ~chrsmask;\n\t\taudit_log_format(ab, \"%s\", str);\n\t\tif (mask & namesmask)\n\t\t\taudit_log_format(ab, \" \");\n\t}\n\tif ((mask & namesmask) && names)\n\t\taa_audit_perm_names(ab, names, mask & namesmask);\n\taudit_log_format(ab, \"\\\"\");\n}"
  },
  {
    "function_name": "aa_audit_perm_names",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/lib.c",
    "lines": "214-229",
    "snippet": "void aa_audit_perm_names(struct audit_buffer *ab, const char **names, u32 mask)\n{\n\tconst char *fmt = \"%s\";\n\tunsigned int i, perm = 1;\n\tbool prev = false;\n\n\tfor (i = 0; i < 32; perm <<= 1, i++) {\n\t\tif (mask & perm) {\n\t\t\taudit_log_format(ab, fmt, names[i]);\n\t\t\tif (!prev) {\n\t\t\t\tprev = true;\n\t\t\t\tfmt = \" %s\";\n\t\t\t}\n\t\t}\n\t}\n}",
    "includes": [
      "#include \"include/policy.h\"",
      "#include \"include/perms.h\"",
      "#include \"include/lib.h\"",
      "#include \"include/apparmor.h\"",
      "#include \"include/audit.h\"",
      "#include <linux/vmalloc.h>",
      "#include <linux/string.h>",
      "#include <linux/slab.h>",
      "#include <linux/mm.h>",
      "#include <linux/ctype.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "audit_log_format",
          "args": [
            "ab",
            "fmt",
            "names[i]"
          ],
          "line": 222
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"include/policy.h\"\n#include \"include/perms.h\"\n#include \"include/lib.h\"\n#include \"include/apparmor.h\"\n#include \"include/audit.h\"\n#include <linux/vmalloc.h>\n#include <linux/string.h>\n#include <linux/slab.h>\n#include <linux/mm.h>\n#include <linux/ctype.h>\n\nvoid aa_audit_perm_names(struct audit_buffer *ab, const char **names, u32 mask)\n{\n\tconst char *fmt = \"%s\";\n\tunsigned int i, perm = 1;\n\tbool prev = false;\n\n\tfor (i = 0; i < 32; perm <<= 1, i++) {\n\t\tif (mask & perm) {\n\t\t\taudit_log_format(ab, fmt, names[i]);\n\t\t\tif (!prev) {\n\t\t\t\tprev = true;\n\t\t\t\tfmt = \" %s\";\n\t\t\t}\n\t\t}\n\t}\n}"
  },
  {
    "function_name": "aa_perm_mask_to_str",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/lib.c",
    "lines": "203-212",
    "snippet": "void aa_perm_mask_to_str(char *str, const char *chrs, u32 mask)\n{\n\tunsigned int i, perm = 1;\n\n\tfor (i = 0; i < 32; perm <<= 1, i++) {\n\t\tif (mask & perm)\n\t\t\t*str++ = chrs[i];\n\t}\n\t*str = '\\0';\n}",
    "includes": [
      "#include \"include/policy.h\"",
      "#include \"include/perms.h\"",
      "#include \"include/lib.h\"",
      "#include \"include/apparmor.h\"",
      "#include \"include/audit.h\"",
      "#include <linux/vmalloc.h>",
      "#include <linux/string.h>",
      "#include <linux/slab.h>",
      "#include <linux/mm.h>",
      "#include <linux/ctype.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"include/policy.h\"\n#include \"include/perms.h\"\n#include \"include/lib.h\"\n#include \"include/apparmor.h\"\n#include \"include/audit.h\"\n#include <linux/vmalloc.h>\n#include <linux/string.h>\n#include <linux/slab.h>\n#include <linux/mm.h>\n#include <linux/ctype.h>\n\nvoid aa_perm_mask_to_str(char *str, const char *chrs, u32 mask)\n{\n\tunsigned int i, perm = 1;\n\n\tfor (i = 0; i < 32; perm <<= 1, i++) {\n\t\tif (mask & perm)\n\t\t\t*str++ = chrs[i];\n\t}\n\t*str = '\\0';\n}"
  },
  {
    "function_name": "aa_str_kref",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/lib.c",
    "lines": "149-152",
    "snippet": "void aa_str_kref(struct kref *kref)\n{\n\tkfree(container_of(kref, struct counted_str, count));\n}",
    "includes": [
      "#include \"include/policy.h\"",
      "#include \"include/perms.h\"",
      "#include \"include/lib.h\"",
      "#include \"include/apparmor.h\"",
      "#include \"include/audit.h\"",
      "#include <linux/vmalloc.h>",
      "#include <linux/string.h>",
      "#include <linux/slab.h>",
      "#include <linux/mm.h>",
      "#include <linux/ctype.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"include/policy.h\"\n#include \"include/perms.h\"\n#include \"include/lib.h\"\n#include \"include/apparmor.h\"\n#include \"include/audit.h\"\n#include <linux/vmalloc.h>\n#include <linux/string.h>\n#include <linux/slab.h>\n#include <linux/mm.h>\n#include <linux/ctype.h>\n\nvoid aa_str_kref(struct kref *kref)\n{\n\tkfree(container_of(kref, struct counted_str, count));\n}"
  },
  {
    "function_name": "aa_str_alloc",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/lib.c",
    "lines": "137-147",
    "snippet": "__counted char *aa_str_alloc(int size, gfp_t gfp)\n{\n\tstruct counted_str *str;\n\n\tstr = kmalloc(sizeof(struct counted_str) + size, gfp);\n\tif (!str)\n\t\treturn NULL;\n\n\tkref_init(&str->count);\n\treturn str->name;\n}",
    "includes": [
      "#include \"include/policy.h\"",
      "#include \"include/perms.h\"",
      "#include \"include/lib.h\"",
      "#include \"include/apparmor.h\"",
      "#include \"include/audit.h\"",
      "#include <linux/vmalloc.h>",
      "#include <linux/string.h>",
      "#include <linux/slab.h>",
      "#include <linux/mm.h>",
      "#include <linux/ctype.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "kref_init",
          "args": [
            "&str->count"
          ],
          "line": 145
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kmalloc",
          "args": [
            "sizeof(struct counted_str) + size",
            "gfp"
          ],
          "line": 141
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"include/policy.h\"\n#include \"include/perms.h\"\n#include \"include/lib.h\"\n#include \"include/apparmor.h\"\n#include \"include/audit.h\"\n#include <linux/vmalloc.h>\n#include <linux/string.h>\n#include <linux/slab.h>\n#include <linux/mm.h>\n#include <linux/ctype.h>\n\n__counted char *aa_str_alloc(int size, gfp_t gfp)\n{\n\tstruct counted_str *str;\n\n\tstr = kmalloc(sizeof(struct counted_str) + size, gfp);\n\tif (!str)\n\t\treturn NULL;\n\n\tkref_init(&str->count);\n\treturn str->name;\n}"
  },
  {
    "function_name": "aa_info_message",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/lib.c",
    "lines": "126-135",
    "snippet": "void aa_info_message(const char *str)\n{\n\tif (audit_enabled) {\n\t\tDEFINE_AUDIT_DATA(sa, LSM_AUDIT_DATA_NONE, NULL);\n\n\t\taad(&sa)->info = str;\n\t\taa_audit_msg(AUDIT_APPARMOR_STATUS, &sa, NULL);\n\t}\n\tprintk(KERN_INFO \"AppArmor: %s\\n\", str);\n}",
    "includes": [
      "#include \"include/policy.h\"",
      "#include \"include/perms.h\"",
      "#include \"include/lib.h\"",
      "#include \"include/apparmor.h\"",
      "#include \"include/audit.h\"",
      "#include <linux/vmalloc.h>",
      "#include <linux/string.h>",
      "#include <linux/slab.h>",
      "#include <linux/mm.h>",
      "#include <linux/ctype.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "printk",
          "args": [
            "KERN_INFO \"AppArmor: %s\\n\"",
            "str"
          ],
          "line": 134
        },
        "resolved": true,
        "details": {
          "function_name": "aa_label_printk",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/label.c",
          "lines": "1803-1809",
          "snippet": "void aa_label_printk(struct aa_label *label, gfp_t gfp)\n{\n\tstruct aa_ns *ns = aa_get_current_ns();\n\n\taa_label_xprintk(ns, label, FLAG_VIEW_SUBNS, gfp);\n\taa_put_ns(ns);\n}",
          "includes": [
            "#include \"include/secid.h\"",
            "#include \"include/policy.h\"",
            "#include \"include/label.h\"",
            "#include \"include/context.h\"",
            "#include \"include/apparmor.h\"",
            "#include <linux/sort.h>",
            "#include <linux/seq_file.h>",
            "#include <linux/audit.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"include/secid.h\"\n#include \"include/policy.h\"\n#include \"include/label.h\"\n#include \"include/context.h\"\n#include \"include/apparmor.h\"\n#include <linux/sort.h>\n#include <linux/seq_file.h>\n#include <linux/audit.h>\n\nvoid aa_label_printk(struct aa_label *label, gfp_t gfp)\n{\n\tstruct aa_ns *ns = aa_get_current_ns();\n\n\taa_label_xprintk(ns, label, FLAG_VIEW_SUBNS, gfp);\n\taa_put_ns(ns);\n}"
        }
      },
      {
        "call_info": {
          "callee": "aa_audit_msg",
          "args": [
            "AUDIT_APPARMOR_STATUS",
            "&sa",
            "NULL"
          ],
          "line": 132
        },
        "resolved": true,
        "details": {
          "function_name": "aa_audit_msg",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/audit.c",
          "lines": "111-116",
          "snippet": "void aa_audit_msg(int type, struct common_audit_data *sa,\n\t\t  void (*cb) (struct audit_buffer *, void *))\n{\n\taad(sa)->type = type;\n\tcommon_lsm_audit(sa, audit_pre, cb);\n}",
          "includes": [
            "#include \"include/policy_ns.h\"",
            "#include \"include/policy.h\"",
            "#include \"include/audit.h\"",
            "#include \"include/apparmor.h\"",
            "#include <linux/socket.h>",
            "#include <linux/audit.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"include/policy_ns.h\"\n#include \"include/policy.h\"\n#include \"include/audit.h\"\n#include \"include/apparmor.h\"\n#include <linux/socket.h>\n#include <linux/audit.h>\n\nvoid aa_audit_msg(int type, struct common_audit_data *sa,\n\t\t  void (*cb) (struct audit_buffer *, void *))\n{\n\taad(sa)->type = type;\n\tcommon_lsm_audit(sa, audit_pre, cb);\n}"
        }
      },
      {
        "call_info": {
          "callee": "aad",
          "args": [
            "&sa"
          ],
          "line": 131
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DEFINE_AUDIT_DATA",
          "args": [
            "sa",
            "LSM_AUDIT_DATA_NONE",
            "NULL"
          ],
          "line": 129
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"include/policy.h\"\n#include \"include/perms.h\"\n#include \"include/lib.h\"\n#include \"include/apparmor.h\"\n#include \"include/audit.h\"\n#include <linux/vmalloc.h>\n#include <linux/string.h>\n#include <linux/slab.h>\n#include <linux/mm.h>\n#include <linux/ctype.h>\n\nvoid aa_info_message(const char *str)\n{\n\tif (audit_enabled) {\n\t\tDEFINE_AUDIT_DATA(sa, LSM_AUDIT_DATA_NONE, NULL);\n\n\t\taad(&sa)->info = str;\n\t\taa_audit_msg(AUDIT_APPARMOR_STATUS, &sa, NULL);\n\t}\n\tprintk(KERN_INFO \"AppArmor: %s\\n\", str);\n}"
  },
  {
    "function_name": "aa_splitn_fqname",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/lib.c",
    "lines": "87-120",
    "snippet": "const char *aa_splitn_fqname(const char *fqname, size_t n, const char **ns_name,\n\t\t\t     size_t *ns_len)\n{\n\tconst char *end = fqname + n;\n\tconst char *name = skipn_spaces(fqname, n);\n\n\tif (!name)\n\t\treturn NULL;\n\t*ns_name = NULL;\n\t*ns_len = 0;\n\tif (name[0] == ':') {\n\t\tchar *split = strnchr(&name[1], end - &name[1], ':');\n\t\t*ns_name = skipn_spaces(&name[1], end - &name[1]);\n\t\tif (!*ns_name)\n\t\t\treturn NULL;\n\t\tif (split) {\n\t\t\t*ns_len = split - *ns_name;\n\t\t\tif (*ns_len == 0)\n\t\t\t\t*ns_name = NULL;\n\t\t\tsplit++;\n\t\t\tif (end - split > 1 && strncmp(split, \"//\", 2) == 0)\n\t\t\t\tsplit += 2;\n\t\t\tname = skipn_spaces(split, end - split);\n\t\t} else {\n\t\t\t/* a ns name without a following profile is allowed */\n\t\t\tname = NULL;\n\t\t\t*ns_len = end - *ns_name;\n\t\t}\n\t}\n\tif (name && *name == 0)\n\t\tname = NULL;\n\n\treturn name;\n}",
    "includes": [
      "#include \"include/policy.h\"",
      "#include \"include/perms.h\"",
      "#include \"include/lib.h\"",
      "#include \"include/apparmor.h\"",
      "#include \"include/audit.h\"",
      "#include <linux/vmalloc.h>",
      "#include <linux/string.h>",
      "#include <linux/slab.h>",
      "#include <linux/mm.h>",
      "#include <linux/ctype.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "skipn_spaces",
          "args": [
            "split",
            "end - split"
          ],
          "line": 109
        },
        "resolved": true,
        "details": {
          "function_name": "skipn_spaces",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/lib.c",
          "lines": "78-85",
          "snippet": "const char *skipn_spaces(const char *str, size_t n)\n{\n\tfor (; n && isspace(*str); --n)\n\t\t++str;\n\tif (n)\n\t\treturn (char *)str;\n\treturn NULL;\n}",
          "includes": [
            "#include \"include/policy.h\"",
            "#include \"include/perms.h\"",
            "#include \"include/lib.h\"",
            "#include \"include/apparmor.h\"",
            "#include \"include/audit.h\"",
            "#include <linux/vmalloc.h>",
            "#include <linux/string.h>",
            "#include <linux/slab.h>",
            "#include <linux/mm.h>",
            "#include <linux/ctype.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"include/policy.h\"\n#include \"include/perms.h\"\n#include \"include/lib.h\"\n#include \"include/apparmor.h\"\n#include \"include/audit.h\"\n#include <linux/vmalloc.h>\n#include <linux/string.h>\n#include <linux/slab.h>\n#include <linux/mm.h>\n#include <linux/ctype.h>\n\nconst char *skipn_spaces(const char *str, size_t n)\n{\n\tfor (; n && isspace(*str); --n)\n\t\t++str;\n\tif (n)\n\t\treturn (char *)str;\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "strncmp",
          "args": [
            "split",
            "\"//\"",
            "2"
          ],
          "line": 107
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strnchr",
          "args": [
            "&name[1]",
            "end - &name[1]",
            "':'"
          ],
          "line": 98
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"include/policy.h\"\n#include \"include/perms.h\"\n#include \"include/lib.h\"\n#include \"include/apparmor.h\"\n#include \"include/audit.h\"\n#include <linux/vmalloc.h>\n#include <linux/string.h>\n#include <linux/slab.h>\n#include <linux/mm.h>\n#include <linux/ctype.h>\n\nconst char *aa_splitn_fqname(const char *fqname, size_t n, const char **ns_name,\n\t\t\t     size_t *ns_len)\n{\n\tconst char *end = fqname + n;\n\tconst char *name = skipn_spaces(fqname, n);\n\n\tif (!name)\n\t\treturn NULL;\n\t*ns_name = NULL;\n\t*ns_len = 0;\n\tif (name[0] == ':') {\n\t\tchar *split = strnchr(&name[1], end - &name[1], ':');\n\t\t*ns_name = skipn_spaces(&name[1], end - &name[1]);\n\t\tif (!*ns_name)\n\t\t\treturn NULL;\n\t\tif (split) {\n\t\t\t*ns_len = split - *ns_name;\n\t\t\tif (*ns_len == 0)\n\t\t\t\t*ns_name = NULL;\n\t\t\tsplit++;\n\t\t\tif (end - split > 1 && strncmp(split, \"//\", 2) == 0)\n\t\t\t\tsplit += 2;\n\t\t\tname = skipn_spaces(split, end - split);\n\t\t} else {\n\t\t\t/* a ns name without a following profile is allowed */\n\t\t\tname = NULL;\n\t\t\t*ns_len = end - *ns_name;\n\t\t}\n\t}\n\tif (name && *name == 0)\n\t\tname = NULL;\n\n\treturn name;\n}"
  },
  {
    "function_name": "skipn_spaces",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/lib.c",
    "lines": "78-85",
    "snippet": "const char *skipn_spaces(const char *str, size_t n)\n{\n\tfor (; n && isspace(*str); --n)\n\t\t++str;\n\tif (n)\n\t\treturn (char *)str;\n\treturn NULL;\n}",
    "includes": [
      "#include \"include/policy.h\"",
      "#include \"include/perms.h\"",
      "#include \"include/lib.h\"",
      "#include \"include/apparmor.h\"",
      "#include \"include/audit.h\"",
      "#include <linux/vmalloc.h>",
      "#include <linux/string.h>",
      "#include <linux/slab.h>",
      "#include <linux/mm.h>",
      "#include <linux/ctype.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "isspace",
          "args": [
            "*str"
          ],
          "line": 80
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"include/policy.h\"\n#include \"include/perms.h\"\n#include \"include/lib.h\"\n#include \"include/apparmor.h\"\n#include \"include/audit.h\"\n#include <linux/vmalloc.h>\n#include <linux/string.h>\n#include <linux/slab.h>\n#include <linux/mm.h>\n#include <linux/ctype.h>\n\nconst char *skipn_spaces(const char *str, size_t n)\n{\n\tfor (; n && isspace(*str); --n)\n\t\t++str;\n\tif (n)\n\t\treturn (char *)str;\n\treturn NULL;\n}"
  },
  {
    "function_name": "aa_split_fqname",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/lib.c",
    "lines": "46-68",
    "snippet": "char *aa_split_fqname(char *fqname, char **ns_name)\n{\n\tchar *name = strim(fqname);\n\n\t*ns_name = NULL;\n\tif (name[0] == ':') {\n\t\tchar *split = strchr(&name[1], ':');\n\t\t*ns_name = skip_spaces(&name[1]);\n\t\tif (split) {\n\t\t\t/* overwrite ':' with \\0 */\n\t\t\t*split++ = 0;\n\t\t\tif (strncmp(split, \"//\", 2) == 0)\n\t\t\t\tsplit += 2;\n\t\t\tname = skip_spaces(split);\n\t\t} else\n\t\t\t/* a ns name without a following profile is allowed */\n\t\t\tname = NULL;\n\t}\n\tif (name && *name == 0)\n\t\tname = NULL;\n\n\treturn name;\n}",
    "includes": [
      "#include \"include/policy.h\"",
      "#include \"include/perms.h\"",
      "#include \"include/lib.h\"",
      "#include \"include/apparmor.h\"",
      "#include \"include/audit.h\"",
      "#include <linux/vmalloc.h>",
      "#include <linux/string.h>",
      "#include <linux/slab.h>",
      "#include <linux/mm.h>",
      "#include <linux/ctype.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "skip_spaces",
          "args": [
            "split"
          ],
          "line": 59
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strncmp",
          "args": [
            "split",
            "\"//\"",
            "2"
          ],
          "line": 57
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "skip_spaces",
          "args": [
            "&name[1]"
          ],
          "line": 53
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strchr",
          "args": [
            "&name[1]",
            "':'"
          ],
          "line": 52
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strim",
          "args": [
            "fqname"
          ],
          "line": 48
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"include/policy.h\"\n#include \"include/perms.h\"\n#include \"include/lib.h\"\n#include \"include/apparmor.h\"\n#include \"include/audit.h\"\n#include <linux/vmalloc.h>\n#include <linux/string.h>\n#include <linux/slab.h>\n#include <linux/mm.h>\n#include <linux/ctype.h>\n\nchar *aa_split_fqname(char *fqname, char **ns_name)\n{\n\tchar *name = strim(fqname);\n\n\t*ns_name = NULL;\n\tif (name[0] == ':') {\n\t\tchar *split = strchr(&name[1], ':');\n\t\t*ns_name = skip_spaces(&name[1]);\n\t\tif (split) {\n\t\t\t/* overwrite ':' with \\0 */\n\t\t\t*split++ = 0;\n\t\t\tif (strncmp(split, \"//\", 2) == 0)\n\t\t\t\tsplit += 2;\n\t\t\tname = skip_spaces(split);\n\t\t} else\n\t\t\t/* a ns name without a following profile is allowed */\n\t\t\tname = NULL;\n\t}\n\tif (name && *name == 0)\n\t\tname = NULL;\n\n\treturn name;\n}"
  }
]