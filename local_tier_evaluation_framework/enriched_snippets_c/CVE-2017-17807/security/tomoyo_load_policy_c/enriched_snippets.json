[
  {
    "function_name": "tomoyo_load_policy",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/load_policy.c",
    "lines": "84-108",
    "snippet": "void tomoyo_load_policy(const char *filename)\n{\n\tstatic bool done;\n\tchar *argv[2];\n\tchar *envp[3];\n\n\tif (tomoyo_policy_loaded || done)\n\t\treturn;\n\tif (!tomoyo_trigger)\n\t\ttomoyo_trigger = CONFIG_SECURITY_TOMOYO_ACTIVATION_TRIGGER;\n\tif (strcmp(filename, tomoyo_trigger))\n\t\treturn;\n\tif (!tomoyo_policy_loader_exists())\n\t\treturn;\n\tdone = true;\n\tprintk(KERN_INFO \"Calling %s to load policy. Please wait.\\n\",\n\t       tomoyo_loader);\n\targv[0] = (char *) tomoyo_loader;\n\targv[1] = NULL;\n\tenvp[0] = \"HOME=/\";\n\tenvp[1] = \"PATH=/sbin:/bin:/usr/sbin:/usr/bin\";\n\tenvp[2] = NULL;\n\tcall_usermodehelper(argv[0], argv, envp, UMH_WAIT_PROC);\n\ttomoyo_check_profile();\n}",
    "includes": [
      "#include \"common.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "tomoyo_check_profile",
          "args": [],
          "line": 107
        },
        "resolved": true,
        "details": {
          "function_name": "tomoyo_check_profile",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/common.c",
          "lines": "2699-2727",
          "snippet": "void tomoyo_check_profile(void)\n{\n\tstruct tomoyo_domain_info *domain;\n\tconst int idx = tomoyo_read_lock();\n\ttomoyo_policy_loaded = true;\n\tprintk(KERN_INFO \"TOMOYO: 2.5.0\\n\");\n\tlist_for_each_entry_rcu(domain, &tomoyo_domain_list, list) {\n\t\tconst u8 profile = domain->profile;\n\t\tconst struct tomoyo_policy_namespace *ns = domain->ns;\n\t\tif (ns->profile_version != 20110903)\n\t\t\tprintk(KERN_ERR\n\t\t\t       \"Profile version %u is not supported.\\n\",\n\t\t\t       ns->profile_version);\n\t\telse if (!ns->profile_ptr[profile])\n\t\t\tprintk(KERN_ERR\n\t\t\t       \"Profile %u (used by '%s') is not defined.\\n\",\n\t\t\t       profile, domain->domainname->name);\n\t\telse\n\t\t\tcontinue;\n\t\tprintk(KERN_ERR\n\t\t       \"Userland tools for TOMOYO 2.5 must be installed and \"\n\t\t       \"policy must be initialized.\\n\");\n\t\tprintk(KERN_ERR \"Please see http://tomoyo.sourceforge.jp/2.5/ \"\n\t\t       \"for more information.\\n\");\n\t\tpanic(\"STOP!\");\n\t}\n\ttomoyo_read_unlock(idx);\n\tprintk(KERN_INFO \"Mandatory Access Control activated.\\n\");\n}",
          "includes": [
            "#include \"builtin-policy.h\"",
            "#include \"common.h\"",
            "#include <linux/security.h>",
            "#include <linux/slab.h>",
            "#include <linux/uaccess.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"builtin-policy.h\"\n#include \"common.h\"\n#include <linux/security.h>\n#include <linux/slab.h>\n#include <linux/uaccess.h>\n\nvoid tomoyo_check_profile(void)\n{\n\tstruct tomoyo_domain_info *domain;\n\tconst int idx = tomoyo_read_lock();\n\ttomoyo_policy_loaded = true;\n\tprintk(KERN_INFO \"TOMOYO: 2.5.0\\n\");\n\tlist_for_each_entry_rcu(domain, &tomoyo_domain_list, list) {\n\t\tconst u8 profile = domain->profile;\n\t\tconst struct tomoyo_policy_namespace *ns = domain->ns;\n\t\tif (ns->profile_version != 20110903)\n\t\t\tprintk(KERN_ERR\n\t\t\t       \"Profile version %u is not supported.\\n\",\n\t\t\t       ns->profile_version);\n\t\telse if (!ns->profile_ptr[profile])\n\t\t\tprintk(KERN_ERR\n\t\t\t       \"Profile %u (used by '%s') is not defined.\\n\",\n\t\t\t       profile, domain->domainname->name);\n\t\telse\n\t\t\tcontinue;\n\t\tprintk(KERN_ERR\n\t\t       \"Userland tools for TOMOYO 2.5 must be installed and \"\n\t\t       \"policy must be initialized.\\n\");\n\t\tprintk(KERN_ERR \"Please see http://tomoyo.sourceforge.jp/2.5/ \"\n\t\t       \"for more information.\\n\");\n\t\tpanic(\"STOP!\");\n\t}\n\ttomoyo_read_unlock(idx);\n\tprintk(KERN_INFO \"Mandatory Access Control activated.\\n\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "call_usermodehelper",
          "args": [
            "argv[0]",
            "argv",
            "envp",
            "UMH_WAIT_PROC"
          ],
          "line": 106
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "printk",
          "args": [
            "KERN_INFO \"Calling %s to load policy. Please wait.\\n\"",
            "tomoyo_loader"
          ],
          "line": 99
        },
        "resolved": true,
        "details": {
          "function_name": "aa_label_printk",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/label.c",
          "lines": "1803-1809",
          "snippet": "void aa_label_printk(struct aa_label *label, gfp_t gfp)\n{\n\tstruct aa_ns *ns = aa_get_current_ns();\n\n\taa_label_xprintk(ns, label, FLAG_VIEW_SUBNS, gfp);\n\taa_put_ns(ns);\n}",
          "includes": [
            "#include \"include/secid.h\"",
            "#include \"include/policy.h\"",
            "#include \"include/label.h\"",
            "#include \"include/context.h\"",
            "#include \"include/apparmor.h\"",
            "#include <linux/sort.h>",
            "#include <linux/seq_file.h>",
            "#include <linux/audit.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"include/secid.h\"\n#include \"include/policy.h\"\n#include \"include/label.h\"\n#include \"include/context.h\"\n#include \"include/apparmor.h\"\n#include <linux/sort.h>\n#include <linux/seq_file.h>\n#include <linux/audit.h>\n\nvoid aa_label_printk(struct aa_label *label, gfp_t gfp)\n{\n\tstruct aa_ns *ns = aa_get_current_ns();\n\n\taa_label_xprintk(ns, label, FLAG_VIEW_SUBNS, gfp);\n\taa_put_ns(ns);\n}"
        }
      },
      {
        "call_info": {
          "callee": "tomoyo_policy_loader_exists",
          "args": [],
          "line": 96
        },
        "resolved": true,
        "details": {
          "function_name": "tomoyo_policy_loader_exists",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/load_policy.c",
          "lines": "37-49",
          "snippet": "static bool tomoyo_policy_loader_exists(void)\n{\n\tstruct path path;\n\tif (!tomoyo_loader)\n\t\ttomoyo_loader = CONFIG_SECURITY_TOMOYO_POLICY_LOADER;\n\tif (kern_path(tomoyo_loader, LOOKUP_FOLLOW, &path)) {\n\t\tprintk(KERN_INFO \"Not activating Mandatory Access Control \"\n\t\t       \"as %s does not exist.\\n\", tomoyo_loader);\n\t\treturn false;\n\t}\n\tpath_put(&path);\n\treturn true;\n}",
          "includes": [
            "#include \"common.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common.h\"\n\nstatic bool tomoyo_policy_loader_exists(void)\n{\n\tstruct path path;\n\tif (!tomoyo_loader)\n\t\ttomoyo_loader = CONFIG_SECURITY_TOMOYO_POLICY_LOADER;\n\tif (kern_path(tomoyo_loader, LOOKUP_FOLLOW, &path)) {\n\t\tprintk(KERN_INFO \"Not activating Mandatory Access Control \"\n\t\t       \"as %s does not exist.\\n\", tomoyo_loader);\n\t\treturn false;\n\t}\n\tpath_put(&path);\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "filename",
            "tomoyo_trigger"
          ],
          "line": 94
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"common.h\"\n\nvoid tomoyo_load_policy(const char *filename)\n{\n\tstatic bool done;\n\tchar *argv[2];\n\tchar *envp[3];\n\n\tif (tomoyo_policy_loaded || done)\n\t\treturn;\n\tif (!tomoyo_trigger)\n\t\ttomoyo_trigger = CONFIG_SECURITY_TOMOYO_ACTIVATION_TRIGGER;\n\tif (strcmp(filename, tomoyo_trigger))\n\t\treturn;\n\tif (!tomoyo_policy_loader_exists())\n\t\treturn;\n\tdone = true;\n\tprintk(KERN_INFO \"Calling %s to load policy. Please wait.\\n\",\n\t       tomoyo_loader);\n\targv[0] = (char *) tomoyo_loader;\n\targv[1] = NULL;\n\tenvp[0] = \"HOME=/\";\n\tenvp[1] = \"PATH=/sbin:/bin:/usr/sbin:/usr/bin\";\n\tenvp[2] = NULL;\n\tcall_usermodehelper(argv[0], argv, envp, UMH_WAIT_PROC);\n\ttomoyo_check_profile();\n}"
  },
  {
    "function_name": "tomoyo_trigger_setup",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/load_policy.c",
    "lines": "63-67",
    "snippet": "static int __init tomoyo_trigger_setup(char *str)\n{\n\ttomoyo_trigger = str;\n\treturn 0;\n}",
    "includes": [
      "#include \"common.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"common.h\"\n\nstatic int __init tomoyo_trigger_setup(char *str)\n{\n\ttomoyo_trigger = str;\n\treturn 0;\n}"
  },
  {
    "function_name": "tomoyo_policy_loader_exists",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/load_policy.c",
    "lines": "37-49",
    "snippet": "static bool tomoyo_policy_loader_exists(void)\n{\n\tstruct path path;\n\tif (!tomoyo_loader)\n\t\ttomoyo_loader = CONFIG_SECURITY_TOMOYO_POLICY_LOADER;\n\tif (kern_path(tomoyo_loader, LOOKUP_FOLLOW, &path)) {\n\t\tprintk(KERN_INFO \"Not activating Mandatory Access Control \"\n\t\t       \"as %s does not exist.\\n\", tomoyo_loader);\n\t\treturn false;\n\t}\n\tpath_put(&path);\n\treturn true;\n}",
    "includes": [
      "#include \"common.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "path_put",
          "args": [
            "&path"
          ],
          "line": 47
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "printk",
          "args": [
            "KERN_INFO \"Not activating Mandatory Access Control \"\n\t\t       \"as %s does not exist.\\n\"",
            "tomoyo_loader"
          ],
          "line": 43
        },
        "resolved": true,
        "details": {
          "function_name": "aa_label_printk",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/label.c",
          "lines": "1803-1809",
          "snippet": "void aa_label_printk(struct aa_label *label, gfp_t gfp)\n{\n\tstruct aa_ns *ns = aa_get_current_ns();\n\n\taa_label_xprintk(ns, label, FLAG_VIEW_SUBNS, gfp);\n\taa_put_ns(ns);\n}",
          "includes": [
            "#include \"include/secid.h\"",
            "#include \"include/policy.h\"",
            "#include \"include/label.h\"",
            "#include \"include/context.h\"",
            "#include \"include/apparmor.h\"",
            "#include <linux/sort.h>",
            "#include <linux/seq_file.h>",
            "#include <linux/audit.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"include/secid.h\"\n#include \"include/policy.h\"\n#include \"include/label.h\"\n#include \"include/context.h\"\n#include \"include/apparmor.h\"\n#include <linux/sort.h>\n#include <linux/seq_file.h>\n#include <linux/audit.h>\n\nvoid aa_label_printk(struct aa_label *label, gfp_t gfp)\n{\n\tstruct aa_ns *ns = aa_get_current_ns();\n\n\taa_label_xprintk(ns, label, FLAG_VIEW_SUBNS, gfp);\n\taa_put_ns(ns);\n}"
        }
      },
      {
        "call_info": {
          "callee": "kern_path",
          "args": [
            "tomoyo_loader",
            "LOOKUP_FOLLOW",
            "&path"
          ],
          "line": 42
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"common.h\"\n\nstatic bool tomoyo_policy_loader_exists(void)\n{\n\tstruct path path;\n\tif (!tomoyo_loader)\n\t\ttomoyo_loader = CONFIG_SECURITY_TOMOYO_POLICY_LOADER;\n\tif (kern_path(tomoyo_loader, LOOKUP_FOLLOW, &path)) {\n\t\tprintk(KERN_INFO \"Not activating Mandatory Access Control \"\n\t\t       \"as %s does not exist.\\n\", tomoyo_loader);\n\t\treturn false;\n\t}\n\tpath_put(&path);\n\treturn true;\n}"
  },
  {
    "function_name": "tomoyo_loader_setup",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/tomoyo/load_policy.c",
    "lines": "24-28",
    "snippet": "static int __init tomoyo_loader_setup(char *str)\n{\n\ttomoyo_loader = str;\n\treturn 0;\n}",
    "includes": [
      "#include \"common.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"common.h\"\n\nstatic int __init tomoyo_loader_setup(char *str)\n{\n\ttomoyo_loader = str;\n\treturn 0;\n}"
  }
]