[
  {
    "function_name": "ecryptfs_fill_auth_tok",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/keys/encrypted-keys/ecryptfs_format.c",
    "lines": "50-78",
    "snippet": "int ecryptfs_fill_auth_tok(struct ecryptfs_auth_tok *auth_tok,\n\t\t\t   const char *key_desc)\n{\n\tint major, minor;\n\n\tecryptfs_get_versions(&major, &minor, NULL);\n\tauth_tok->version = (((uint16_t)(major << 8) & 0xFF00)\n\t\t\t     | ((uint16_t)minor & 0x00FF));\n\tauth_tok->token_type = ECRYPTFS_PASSWORD;\n\tstrncpy((char *)auth_tok->token.password.signature, key_desc,\n\t\tECRYPTFS_PASSWORD_SIG_SIZE);\n\tauth_tok->token.password.session_key_encryption_key_bytes =\n\t\tECRYPTFS_MAX_KEY_BYTES;\n\t/*\n\t * Removed auth_tok->token.password.salt and\n\t * auth_tok->token.password.session_key_encryption_key\n\t * initialization from the original code\n\t */\n\t/* TODO: Make the hash parameterizable via policy */\n\tauth_tok->token.password.flags |=\n\t\tECRYPTFS_SESSION_KEY_ENCRYPTION_KEY_SET;\n\t/* The kernel code will encrypt the session key. */\n\tauth_tok->session_key.encrypted_key[0] = 0;\n\tauth_tok->session_key.encrypted_key_size = 0;\n\t/* Default; subject to change by kernel eCryptfs */\n\tauth_tok->token.password.hash_algo = PGP_DIGEST_ALGO_SHA512;\n\tauth_tok->token.password.flags &= ~(ECRYPTFS_PERSISTENT_PASSWORD);\n\treturn 0;\n}",
    "includes": [
      "#include \"ecryptfs_format.h\"",
      "#include <linux/module.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "strncpy",
          "args": [
            "(char *)auth_tok->token.password.signature",
            "key_desc",
            "ECRYPTFS_PASSWORD_SIG_SIZE"
          ],
          "line": 59
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ecryptfs_get_versions",
          "args": [
            "&major",
            "&minor",
            "NULL"
          ],
          "line": 55
        },
        "resolved": true,
        "details": {
          "function_name": "ecryptfs_get_versions",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/keys/encrypted-keys/ecryptfs_format.c",
          "lines": "33-39",
          "snippet": "void ecryptfs_get_versions(int *major, int *minor, int *file_version)\n{\n\t*major = ECRYPTFS_VERSION_MAJOR;\n\t*minor = ECRYPTFS_VERSION_MINOR;\n\tif (file_version)\n\t\t*file_version = ECRYPTFS_SUPPORTED_FILE_VERSION;\n}",
          "includes": [
            "#include \"ecryptfs_format.h\"",
            "#include <linux/module.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"ecryptfs_format.h\"\n#include <linux/module.h>\n\nvoid ecryptfs_get_versions(int *major, int *minor, int *file_version)\n{\n\t*major = ECRYPTFS_VERSION_MAJOR;\n\t*minor = ECRYPTFS_VERSION_MINOR;\n\tif (file_version)\n\t\t*file_version = ECRYPTFS_SUPPORTED_FILE_VERSION;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"ecryptfs_format.h\"\n#include <linux/module.h>\n\nint ecryptfs_fill_auth_tok(struct ecryptfs_auth_tok *auth_tok,\n\t\t\t   const char *key_desc)\n{\n\tint major, minor;\n\n\tecryptfs_get_versions(&major, &minor, NULL);\n\tauth_tok->version = (((uint16_t)(major << 8) & 0xFF00)\n\t\t\t     | ((uint16_t)minor & 0x00FF));\n\tauth_tok->token_type = ECRYPTFS_PASSWORD;\n\tstrncpy((char *)auth_tok->token.password.signature, key_desc,\n\t\tECRYPTFS_PASSWORD_SIG_SIZE);\n\tauth_tok->token.password.session_key_encryption_key_bytes =\n\t\tECRYPTFS_MAX_KEY_BYTES;\n\t/*\n\t * Removed auth_tok->token.password.salt and\n\t * auth_tok->token.password.session_key_encryption_key\n\t * initialization from the original code\n\t */\n\t/* TODO: Make the hash parameterizable via policy */\n\tauth_tok->token.password.flags |=\n\t\tECRYPTFS_SESSION_KEY_ENCRYPTION_KEY_SET;\n\t/* The kernel code will encrypt the session key. */\n\tauth_tok->session_key.encrypted_key[0] = 0;\n\tauth_tok->session_key.encrypted_key_size = 0;\n\t/* Default; subject to change by kernel eCryptfs */\n\tauth_tok->token.password.hash_algo = PGP_DIGEST_ALGO_SHA512;\n\tauth_tok->token.password.flags &= ~(ECRYPTFS_PERSISTENT_PASSWORD);\n\treturn 0;\n}"
  },
  {
    "function_name": "ecryptfs_get_versions",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/keys/encrypted-keys/ecryptfs_format.c",
    "lines": "33-39",
    "snippet": "void ecryptfs_get_versions(int *major, int *minor, int *file_version)\n{\n\t*major = ECRYPTFS_VERSION_MAJOR;\n\t*minor = ECRYPTFS_VERSION_MINOR;\n\tif (file_version)\n\t\t*file_version = ECRYPTFS_SUPPORTED_FILE_VERSION;\n}",
    "includes": [
      "#include \"ecryptfs_format.h\"",
      "#include <linux/module.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"ecryptfs_format.h\"\n#include <linux/module.h>\n\nvoid ecryptfs_get_versions(int *major, int *minor, int *file_version)\n{\n\t*major = ECRYPTFS_VERSION_MAJOR;\n\t*minor = ECRYPTFS_VERSION_MINOR;\n\tif (file_version)\n\t\t*file_version = ECRYPTFS_SUPPORTED_FILE_VERSION;\n}"
  },
  {
    "function_name": "ecryptfs_get_auth_tok_key",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/keys/encrypted-keys/ecryptfs_format.c",
    "lines": "21-24",
    "snippet": "u8 *ecryptfs_get_auth_tok_key(struct ecryptfs_auth_tok *auth_tok)\n{\n\treturn auth_tok->token.password.session_key_encryption_key;\n}",
    "includes": [
      "#include \"ecryptfs_format.h\"",
      "#include <linux/module.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"ecryptfs_format.h\"\n#include <linux/module.h>\n\nu8 *ecryptfs_get_auth_tok_key(struct ecryptfs_auth_tok *auth_tok)\n{\n\treturn auth_tok->token.password.session_key_encryption_key;\n}"
  }
]