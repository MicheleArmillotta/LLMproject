[
  {
    "function_name": "aa_clear_task_ctx_trans",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/include/context.h",
    "lines": "220-227",
    "snippet": "static inline void aa_clear_task_ctx_trans(struct aa_task_ctx *ctx)\n{\n\taa_put_label(ctx->previous);\n\taa_put_label(ctx->onexec);\n\tctx->previous = NULL;\n\tctx->onexec = NULL;\n\tctx->token = 0;\n}",
    "includes": [
      "#include \"policy_ns.h\"",
      "#include \"label.h\"",
      "#include <linux/sched.h>",
      "#include <linux/slab.h>",
      "#include <linux/cred.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "aa_put_label",
          "args": [
            "ctx->onexec"
          ],
          "line": 223
        },
        "resolved": true,
        "details": {
          "function_name": "aa_put_label",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/include/label.h",
          "lines": "416-420",
          "snippet": "static inline void aa_put_label(struct aa_label *l)\n{\n\tif (l)\n\t\tkref_put(&l->count, aa_label_kref);\n}",
          "includes": [
            "#include \"lib.h\"",
            "#include \"apparmor.h\"",
            "#include <linux/rcupdate.h>",
            "#include <linux/rbtree.h>",
            "#include <linux/audit.h>",
            "#include <linux/atomic.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"lib.h\"\n#include \"apparmor.h\"\n#include <linux/rcupdate.h>\n#include <linux/rbtree.h>\n#include <linux/audit.h>\n#include <linux/atomic.h>\n\nstatic inline void aa_put_label(struct aa_label *l)\n{\n\tif (l)\n\t\tkref_put(&l->count, aa_label_kref);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"policy_ns.h\"\n#include \"label.h\"\n#include <linux/sched.h>\n#include <linux/slab.h>\n#include <linux/cred.h>\n\nstatic inline void aa_clear_task_ctx_trans(struct aa_task_ctx *ctx)\n{\n\taa_put_label(ctx->previous);\n\taa_put_label(ctx->onexec);\n\tctx->previous = NULL;\n\tctx->onexec = NULL;\n\tctx->token = 0;\n}"
  },
  {
    "function_name": "aa_get_current_ns",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/include/context.h",
    "lines": "204-214",
    "snippet": "static inline struct aa_ns *aa_get_current_ns(void)\n{\n\tstruct aa_label *label;\n\tstruct aa_ns *ns;\n\n\tlabel  = __begin_current_label_crit_section();\n\tns = aa_get_ns(labels_ns(label));\n\t__end_current_label_crit_section(label);\n\n\treturn ns;\n}",
    "includes": [
      "#include \"policy_ns.h\"",
      "#include \"label.h\"",
      "#include <linux/sched.h>",
      "#include <linux/slab.h>",
      "#include <linux/cred.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "__end_current_label_crit_section",
          "args": [
            "label"
          ],
          "line": 211
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "aa_get_ns",
          "args": [
            "labels_ns(label)"
          ],
          "line": 210
        },
        "resolved": true,
        "details": {
          "function_name": "aa_get_ns",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/include/policy_ns.h",
          "lines": "116-122",
          "snippet": "static inline struct aa_ns *aa_get_ns(struct aa_ns *ns)\n{\n\tif (ns)\n\t\taa_get_profile(ns->unconfined);\n\n\treturn ns;\n}",
          "includes": [
            "#include \"policy.h\"",
            "#include \"label.h\"",
            "#include \"apparmorfs.h\"",
            "#include \"apparmor.h\"",
            "#include <linux/kref.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"policy.h\"\n#include \"label.h\"\n#include \"apparmorfs.h\"\n#include \"apparmor.h\"\n#include <linux/kref.h>\n\nstatic inline struct aa_ns *aa_get_ns(struct aa_ns *ns)\n{\n\tif (ns)\n\t\taa_get_profile(ns->unconfined);\n\n\treturn ns;\n}"
        }
      },
      {
        "call_info": {
          "callee": "labels_ns",
          "args": [
            "label"
          ],
          "line": 210
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "__begin_current_label_crit_section",
          "args": [],
          "line": 209
        },
        "resolved": true,
        "details": {
          "function_name": "__begin_current_label_crit_section",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/include/context.h",
          "lines": "168-176",
          "snippet": "static inline struct aa_label *__begin_current_label_crit_section(void)\n{\n\tstruct aa_label *label = aa_current_raw_label();\n\n\tif (label_is_stale(label))\n\t\tlabel = aa_get_newest_label(label);\n\n\treturn label;\n}",
          "includes": [
            "#include \"policy_ns.h\"",
            "#include \"label.h\"",
            "#include <linux/sched.h>",
            "#include <linux/slab.h>",
            "#include <linux/cred.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"policy_ns.h\"\n#include \"label.h\"\n#include <linux/sched.h>\n#include <linux/slab.h>\n#include <linux/cred.h>\n\nstatic inline struct aa_label *__begin_current_label_crit_section(void)\n{\n\tstruct aa_label *label = aa_current_raw_label();\n\n\tif (label_is_stale(label))\n\t\tlabel = aa_get_newest_label(label);\n\n\treturn label;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"policy_ns.h\"\n#include \"label.h\"\n#include <linux/sched.h>\n#include <linux/slab.h>\n#include <linux/cred.h>\n\nstatic inline struct aa_ns *aa_get_current_ns(void)\n{\n\tstruct aa_label *label;\n\tstruct aa_ns *ns;\n\n\tlabel  = __begin_current_label_crit_section();\n\tns = aa_get_ns(labels_ns(label));\n\t__end_current_label_crit_section(label);\n\n\treturn ns;\n}"
  },
  {
    "function_name": "begin_current_label_crit_section",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/include/context.h",
    "lines": "190-202",
    "snippet": "static inline struct aa_label *begin_current_label_crit_section(void)\n{\n\tstruct aa_label *label = aa_current_raw_label();\n\n\tif (label_is_stale(label)) {\n\t\tlabel = aa_get_newest_label(label);\n\t\tif (aa_replace_current_label(label) == 0)\n\t\t\t/* task cred will keep the reference */\n\t\t\taa_put_label(label);\n\t}\n\n\treturn label;\n}",
    "includes": [
      "#include \"policy_ns.h\"",
      "#include \"label.h\"",
      "#include <linux/sched.h>",
      "#include <linux/slab.h>",
      "#include <linux/cred.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "aa_put_label",
          "args": [
            "label"
          ],
          "line": 198
        },
        "resolved": true,
        "details": {
          "function_name": "aa_put_label",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/include/label.h",
          "lines": "416-420",
          "snippet": "static inline void aa_put_label(struct aa_label *l)\n{\n\tif (l)\n\t\tkref_put(&l->count, aa_label_kref);\n}",
          "includes": [
            "#include \"lib.h\"",
            "#include \"apparmor.h\"",
            "#include <linux/rcupdate.h>",
            "#include <linux/rbtree.h>",
            "#include <linux/audit.h>",
            "#include <linux/atomic.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"lib.h\"\n#include \"apparmor.h\"\n#include <linux/rcupdate.h>\n#include <linux/rbtree.h>\n#include <linux/audit.h>\n#include <linux/atomic.h>\n\nstatic inline void aa_put_label(struct aa_label *l)\n{\n\tif (l)\n\t\tkref_put(&l->count, aa_label_kref);\n}"
        }
      },
      {
        "call_info": {
          "callee": "aa_replace_current_label",
          "args": [
            "label"
          ],
          "line": 196
        },
        "resolved": true,
        "details": {
          "function_name": "aa_replace_current_label",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/context.c",
          "lines": "94-129",
          "snippet": "int aa_replace_current_label(struct aa_label *label)\n{\n\tstruct aa_task_ctx *ctx = current_ctx();\n\tstruct cred *new;\n\tAA_BUG(!label);\n\n\tif (ctx->label == label)\n\t\treturn 0;\n\n\tif (current_cred() != current_real_cred())\n\t\treturn -EBUSY;\n\n\tnew  = prepare_creds();\n\tif (!new)\n\t\treturn -ENOMEM;\n\n\tctx = cred_ctx(new);\n\tif (unconfined(label) || (labels_ns(ctx->label) != labels_ns(label)))\n\t\t/* if switching to unconfined or a different label namespace\n\t\t * clear out context state\n\t\t */\n\t\taa_clear_task_ctx_trans(ctx);\n\n\t/*\n\t * be careful switching ctx->profile, when racing replacement it\n\t * is possible that ctx->profile->proxy->profile is the reference\n\t * keeping @profile valid, so make sure to get its reference before\n\t * dropping the reference on ctx->profile\n\t */\n\taa_get_label(label);\n\taa_put_label(ctx->label);\n\tctx->label = label;\n\n\tcommit_creds(new);\n\treturn 0;\n}",
          "includes": [
            "#include \"include/policy.h\"",
            "#include \"include/context.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"include/policy.h\"\n#include \"include/context.h\"\n\nint aa_replace_current_label(struct aa_label *label)\n{\n\tstruct aa_task_ctx *ctx = current_ctx();\n\tstruct cred *new;\n\tAA_BUG(!label);\n\n\tif (ctx->label == label)\n\t\treturn 0;\n\n\tif (current_cred() != current_real_cred())\n\t\treturn -EBUSY;\n\n\tnew  = prepare_creds();\n\tif (!new)\n\t\treturn -ENOMEM;\n\n\tctx = cred_ctx(new);\n\tif (unconfined(label) || (labels_ns(ctx->label) != labels_ns(label)))\n\t\t/* if switching to unconfined or a different label namespace\n\t\t * clear out context state\n\t\t */\n\t\taa_clear_task_ctx_trans(ctx);\n\n\t/*\n\t * be careful switching ctx->profile, when racing replacement it\n\t * is possible that ctx->profile->proxy->profile is the reference\n\t * keeping @profile valid, so make sure to get its reference before\n\t * dropping the reference on ctx->profile\n\t */\n\taa_get_label(label);\n\taa_put_label(ctx->label);\n\tctx->label = label;\n\n\tcommit_creds(new);\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "aa_get_newest_label",
          "args": [
            "label"
          ],
          "line": 195
        },
        "resolved": true,
        "details": {
          "function_name": "aa_get_newest_label",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/include/label.h",
          "lines": "393-414",
          "snippet": "static inline struct aa_label *aa_get_newest_label(struct aa_label *l)\n{\n\tif (!l)\n\t\treturn NULL;\n\n\tif (label_is_stale(l)) {\n\t\tstruct aa_label *tmp;\n\n\t\tAA_BUG(!l->proxy);\n\t\tAA_BUG(!l->proxy->label);\n\t\t/* BUG: only way this can happen is @l ref count and its\n\t\t * replacement count have gone to 0 and are on their way\n\t\t * to destruction. ie. we have a refcounting error\n\t\t */\n\t\ttmp = aa_get_label_rcu(&l->proxy->label);\n\t\tAA_BUG(!tmp);\n\n\t\treturn tmp;\n\t}\n\n\treturn aa_get_label(l);\n}",
          "includes": [
            "#include \"lib.h\"",
            "#include \"apparmor.h\"",
            "#include <linux/rcupdate.h>",
            "#include <linux/rbtree.h>",
            "#include <linux/audit.h>",
            "#include <linux/atomic.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"lib.h\"\n#include \"apparmor.h\"\n#include <linux/rcupdate.h>\n#include <linux/rbtree.h>\n#include <linux/audit.h>\n#include <linux/atomic.h>\n\nstatic inline struct aa_label *aa_get_newest_label(struct aa_label *l)\n{\n\tif (!l)\n\t\treturn NULL;\n\n\tif (label_is_stale(l)) {\n\t\tstruct aa_label *tmp;\n\n\t\tAA_BUG(!l->proxy);\n\t\tAA_BUG(!l->proxy->label);\n\t\t/* BUG: only way this can happen is @l ref count and its\n\t\t * replacement count have gone to 0 and are on their way\n\t\t * to destruction. ie. we have a refcounting error\n\t\t */\n\t\ttmp = aa_get_label_rcu(&l->proxy->label);\n\t\tAA_BUG(!tmp);\n\n\t\treturn tmp;\n\t}\n\n\treturn aa_get_label(l);\n}"
        }
      },
      {
        "call_info": {
          "callee": "label_is_stale",
          "args": [
            "label"
          ],
          "line": 194
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "aa_current_raw_label",
          "args": [],
          "line": 192
        },
        "resolved": true,
        "details": {
          "function_name": "aa_current_raw_label",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/include/context.h",
          "lines": "117-120",
          "snippet": "static inline struct aa_label *aa_current_raw_label(void)\n{\n\treturn aa_cred_raw_label(current_cred());\n}",
          "includes": [
            "#include \"policy_ns.h\"",
            "#include \"label.h\"",
            "#include <linux/sched.h>",
            "#include <linux/slab.h>",
            "#include <linux/cred.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"policy_ns.h\"\n#include \"label.h\"\n#include <linux/sched.h>\n#include <linux/slab.h>\n#include <linux/cred.h>\n\nstatic inline struct aa_label *aa_current_raw_label(void)\n{\n\treturn aa_cred_raw_label(current_cred());\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"policy_ns.h\"\n#include \"label.h\"\n#include <linux/sched.h>\n#include <linux/slab.h>\n#include <linux/cred.h>\n\nstatic inline struct aa_label *begin_current_label_crit_section(void)\n{\n\tstruct aa_label *label = aa_current_raw_label();\n\n\tif (label_is_stale(label)) {\n\t\tlabel = aa_get_newest_label(label);\n\t\tif (aa_replace_current_label(label) == 0)\n\t\t\t/* task cred will keep the reference */\n\t\t\taa_put_label(label);\n\t}\n\n\treturn label;\n}"
  },
  {
    "function_name": "__begin_current_label_crit_section",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/include/context.h",
    "lines": "168-176",
    "snippet": "static inline struct aa_label *__begin_current_label_crit_section(void)\n{\n\tstruct aa_label *label = aa_current_raw_label();\n\n\tif (label_is_stale(label))\n\t\tlabel = aa_get_newest_label(label);\n\n\treturn label;\n}",
    "includes": [
      "#include \"policy_ns.h\"",
      "#include \"label.h\"",
      "#include <linux/sched.h>",
      "#include <linux/slab.h>",
      "#include <linux/cred.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "aa_get_newest_label",
          "args": [
            "label"
          ],
          "line": 173
        },
        "resolved": true,
        "details": {
          "function_name": "aa_get_newest_label",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/include/label.h",
          "lines": "393-414",
          "snippet": "static inline struct aa_label *aa_get_newest_label(struct aa_label *l)\n{\n\tif (!l)\n\t\treturn NULL;\n\n\tif (label_is_stale(l)) {\n\t\tstruct aa_label *tmp;\n\n\t\tAA_BUG(!l->proxy);\n\t\tAA_BUG(!l->proxy->label);\n\t\t/* BUG: only way this can happen is @l ref count and its\n\t\t * replacement count have gone to 0 and are on their way\n\t\t * to destruction. ie. we have a refcounting error\n\t\t */\n\t\ttmp = aa_get_label_rcu(&l->proxy->label);\n\t\tAA_BUG(!tmp);\n\n\t\treturn tmp;\n\t}\n\n\treturn aa_get_label(l);\n}",
          "includes": [
            "#include \"lib.h\"",
            "#include \"apparmor.h\"",
            "#include <linux/rcupdate.h>",
            "#include <linux/rbtree.h>",
            "#include <linux/audit.h>",
            "#include <linux/atomic.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"lib.h\"\n#include \"apparmor.h\"\n#include <linux/rcupdate.h>\n#include <linux/rbtree.h>\n#include <linux/audit.h>\n#include <linux/atomic.h>\n\nstatic inline struct aa_label *aa_get_newest_label(struct aa_label *l)\n{\n\tif (!l)\n\t\treturn NULL;\n\n\tif (label_is_stale(l)) {\n\t\tstruct aa_label *tmp;\n\n\t\tAA_BUG(!l->proxy);\n\t\tAA_BUG(!l->proxy->label);\n\t\t/* BUG: only way this can happen is @l ref count and its\n\t\t * replacement count have gone to 0 and are on their way\n\t\t * to destruction. ie. we have a refcounting error\n\t\t */\n\t\ttmp = aa_get_label_rcu(&l->proxy->label);\n\t\tAA_BUG(!tmp);\n\n\t\treturn tmp;\n\t}\n\n\treturn aa_get_label(l);\n}"
        }
      },
      {
        "call_info": {
          "callee": "label_is_stale",
          "args": [
            "label"
          ],
          "line": 172
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "aa_current_raw_label",
          "args": [],
          "line": 170
        },
        "resolved": true,
        "details": {
          "function_name": "aa_current_raw_label",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/include/context.h",
          "lines": "117-120",
          "snippet": "static inline struct aa_label *aa_current_raw_label(void)\n{\n\treturn aa_cred_raw_label(current_cred());\n}",
          "includes": [
            "#include \"policy_ns.h\"",
            "#include \"label.h\"",
            "#include <linux/sched.h>",
            "#include <linux/slab.h>",
            "#include <linux/cred.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"policy_ns.h\"\n#include \"label.h\"\n#include <linux/sched.h>\n#include <linux/slab.h>\n#include <linux/cred.h>\n\nstatic inline struct aa_label *aa_current_raw_label(void)\n{\n\treturn aa_cred_raw_label(current_cred());\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"policy_ns.h\"\n#include \"label.h\"\n#include <linux/sched.h>\n#include <linux/slab.h>\n#include <linux/cred.h>\n\nstatic inline struct aa_label *__begin_current_label_crit_section(void)\n{\n\tstruct aa_label *label = aa_current_raw_label();\n\n\tif (label_is_stale(label))\n\t\tlabel = aa_get_newest_label(label);\n\n\treturn label;\n}"
  },
  {
    "function_name": "end_current_label_crit_section",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/include/context.h",
    "lines": "150-154",
    "snippet": "static inline void end_current_label_crit_section(struct aa_label *label)\n{\n\tif (label != aa_current_raw_label())\n\t\taa_put_label(label);\n}",
    "includes": [
      "#include \"policy_ns.h\"",
      "#include \"label.h\"",
      "#include <linux/sched.h>",
      "#include <linux/slab.h>",
      "#include <linux/cred.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "aa_put_label",
          "args": [
            "label"
          ],
          "line": 153
        },
        "resolved": true,
        "details": {
          "function_name": "aa_put_label",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/include/label.h",
          "lines": "416-420",
          "snippet": "static inline void aa_put_label(struct aa_label *l)\n{\n\tif (l)\n\t\tkref_put(&l->count, aa_label_kref);\n}",
          "includes": [
            "#include \"lib.h\"",
            "#include \"apparmor.h\"",
            "#include <linux/rcupdate.h>",
            "#include <linux/rbtree.h>",
            "#include <linux/audit.h>",
            "#include <linux/atomic.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"lib.h\"\n#include \"apparmor.h\"\n#include <linux/rcupdate.h>\n#include <linux/rbtree.h>\n#include <linux/audit.h>\n#include <linux/atomic.h>\n\nstatic inline void aa_put_label(struct aa_label *l)\n{\n\tif (l)\n\t\tkref_put(&l->count, aa_label_kref);\n}"
        }
      },
      {
        "call_info": {
          "callee": "aa_current_raw_label",
          "args": [],
          "line": 152
        },
        "resolved": true,
        "details": {
          "function_name": "aa_current_raw_label",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/include/context.h",
          "lines": "117-120",
          "snippet": "static inline struct aa_label *aa_current_raw_label(void)\n{\n\treturn aa_cred_raw_label(current_cred());\n}",
          "includes": [
            "#include \"policy_ns.h\"",
            "#include \"label.h\"",
            "#include <linux/sched.h>",
            "#include <linux/slab.h>",
            "#include <linux/cred.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"policy_ns.h\"\n#include \"label.h\"\n#include <linux/sched.h>\n#include <linux/slab.h>\n#include <linux/cred.h>\n\nstatic inline struct aa_label *aa_current_raw_label(void)\n{\n\treturn aa_cred_raw_label(current_cred());\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"policy_ns.h\"\n#include \"label.h\"\n#include <linux/sched.h>\n#include <linux/slab.h>\n#include <linux/cred.h>\n\nstatic inline void end_current_label_crit_section(struct aa_label *label)\n{\n\tif (label != aa_current_raw_label())\n\t\taa_put_label(label);\n}"
  },
  {
    "function_name": "aa_get_current_label",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/include/context.h",
    "lines": "131-138",
    "snippet": "static inline struct aa_label *aa_get_current_label(void)\n{\n\tstruct aa_label *l = aa_current_raw_label();\n\n\tif (label_is_stale(l))\n\t\treturn aa_get_newest_label(l);\n\treturn aa_get_label(l);\n}",
    "includes": [
      "#include \"policy_ns.h\"",
      "#include \"label.h\"",
      "#include <linux/sched.h>",
      "#include <linux/slab.h>",
      "#include <linux/cred.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "aa_get_label",
          "args": [
            "l"
          ],
          "line": 137
        },
        "resolved": true,
        "details": {
          "function_name": "aa_get_label_rcu",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/include/label.h",
          "lines": "372-383",
          "snippet": "static inline struct aa_label *aa_get_label_rcu(struct aa_label __rcu **l)\n{\n\tstruct aa_label *c;\n\n\trcu_read_lock();\n\tdo {\n\t\tc = rcu_dereference(*l);\n\t} while (c && !kref_get_unless_zero(&c->count));\n\trcu_read_unlock();\n\n\treturn c;\n}",
          "includes": [
            "#include \"lib.h\"",
            "#include \"apparmor.h\"",
            "#include <linux/rcupdate.h>",
            "#include <linux/rbtree.h>",
            "#include <linux/audit.h>",
            "#include <linux/atomic.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"lib.h\"\n#include \"apparmor.h\"\n#include <linux/rcupdate.h>\n#include <linux/rbtree.h>\n#include <linux/audit.h>\n#include <linux/atomic.h>\n\nstatic inline struct aa_label *aa_get_label_rcu(struct aa_label __rcu **l)\n{\n\tstruct aa_label *c;\n\n\trcu_read_lock();\n\tdo {\n\t\tc = rcu_dereference(*l);\n\t} while (c && !kref_get_unless_zero(&c->count));\n\trcu_read_unlock();\n\n\treturn c;\n}"
        }
      },
      {
        "call_info": {
          "callee": "aa_get_newest_label",
          "args": [
            "l"
          ],
          "line": 136
        },
        "resolved": true,
        "details": {
          "function_name": "aa_get_newest_label",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/include/label.h",
          "lines": "393-414",
          "snippet": "static inline struct aa_label *aa_get_newest_label(struct aa_label *l)\n{\n\tif (!l)\n\t\treturn NULL;\n\n\tif (label_is_stale(l)) {\n\t\tstruct aa_label *tmp;\n\n\t\tAA_BUG(!l->proxy);\n\t\tAA_BUG(!l->proxy->label);\n\t\t/* BUG: only way this can happen is @l ref count and its\n\t\t * replacement count have gone to 0 and are on their way\n\t\t * to destruction. ie. we have a refcounting error\n\t\t */\n\t\ttmp = aa_get_label_rcu(&l->proxy->label);\n\t\tAA_BUG(!tmp);\n\n\t\treturn tmp;\n\t}\n\n\treturn aa_get_label(l);\n}",
          "includes": [
            "#include \"lib.h\"",
            "#include \"apparmor.h\"",
            "#include <linux/rcupdate.h>",
            "#include <linux/rbtree.h>",
            "#include <linux/audit.h>",
            "#include <linux/atomic.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"lib.h\"\n#include \"apparmor.h\"\n#include <linux/rcupdate.h>\n#include <linux/rbtree.h>\n#include <linux/audit.h>\n#include <linux/atomic.h>\n\nstatic inline struct aa_label *aa_get_newest_label(struct aa_label *l)\n{\n\tif (!l)\n\t\treturn NULL;\n\n\tif (label_is_stale(l)) {\n\t\tstruct aa_label *tmp;\n\n\t\tAA_BUG(!l->proxy);\n\t\tAA_BUG(!l->proxy->label);\n\t\t/* BUG: only way this can happen is @l ref count and its\n\t\t * replacement count have gone to 0 and are on their way\n\t\t * to destruction. ie. we have a refcounting error\n\t\t */\n\t\ttmp = aa_get_label_rcu(&l->proxy->label);\n\t\tAA_BUG(!tmp);\n\n\t\treturn tmp;\n\t}\n\n\treturn aa_get_label(l);\n}"
        }
      },
      {
        "call_info": {
          "callee": "label_is_stale",
          "args": [
            "l"
          ],
          "line": 135
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "aa_current_raw_label",
          "args": [],
          "line": 133
        },
        "resolved": true,
        "details": {
          "function_name": "aa_current_raw_label",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/include/context.h",
          "lines": "117-120",
          "snippet": "static inline struct aa_label *aa_current_raw_label(void)\n{\n\treturn aa_cred_raw_label(current_cred());\n}",
          "includes": [
            "#include \"policy_ns.h\"",
            "#include \"label.h\"",
            "#include <linux/sched.h>",
            "#include <linux/slab.h>",
            "#include <linux/cred.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"policy_ns.h\"\n#include \"label.h\"\n#include <linux/sched.h>\n#include <linux/slab.h>\n#include <linux/cred.h>\n\nstatic inline struct aa_label *aa_current_raw_label(void)\n{\n\treturn aa_cred_raw_label(current_cred());\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"policy_ns.h\"\n#include \"label.h\"\n#include <linux/sched.h>\n#include <linux/slab.h>\n#include <linux/cred.h>\n\nstatic inline struct aa_label *aa_get_current_label(void)\n{\n\tstruct aa_label *l = aa_current_raw_label();\n\n\tif (label_is_stale(l))\n\t\treturn aa_get_newest_label(l);\n\treturn aa_get_label(l);\n}"
  },
  {
    "function_name": "aa_current_raw_label",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/include/context.h",
    "lines": "117-120",
    "snippet": "static inline struct aa_label *aa_current_raw_label(void)\n{\n\treturn aa_cred_raw_label(current_cred());\n}",
    "includes": [
      "#include \"policy_ns.h\"",
      "#include \"label.h\"",
      "#include <linux/sched.h>",
      "#include <linux/slab.h>",
      "#include <linux/cred.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "aa_cred_raw_label",
          "args": [
            "current_cred()"
          ],
          "line": 119
        },
        "resolved": true,
        "details": {
          "function_name": "aa_cred_raw_label",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/include/context.h",
          "lines": "66-72",
          "snippet": "static inline struct aa_label *aa_cred_raw_label(const struct cred *cred)\n{\n\tstruct aa_task_ctx *ctx = cred_ctx(cred);\n\n\tAA_BUG(!ctx || !ctx->label);\n\treturn ctx->label;\n}",
          "includes": [
            "#include \"policy_ns.h\"",
            "#include \"label.h\"",
            "#include <linux/sched.h>",
            "#include <linux/slab.h>",
            "#include <linux/cred.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"policy_ns.h\"\n#include \"label.h\"\n#include <linux/sched.h>\n#include <linux/slab.h>\n#include <linux/cred.h>\n\nstatic inline struct aa_label *aa_cred_raw_label(const struct cred *cred)\n{\n\tstruct aa_task_ctx *ctx = cred_ctx(cred);\n\n\tAA_BUG(!ctx || !ctx->label);\n\treturn ctx->label;\n}"
        }
      },
      {
        "call_info": {
          "callee": "current_cred",
          "args": [],
          "line": 119
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"policy_ns.h\"\n#include \"label.h\"\n#include <linux/sched.h>\n#include <linux/slab.h>\n#include <linux/cred.h>\n\nstatic inline struct aa_label *aa_current_raw_label(void)\n{\n\treturn aa_cred_raw_label(current_cred());\n}"
  },
  {
    "function_name": "__aa_task_is_confined",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/include/context.h",
    "lines": "104-107",
    "snippet": "static inline bool __aa_task_is_confined(struct task_struct *task)\n{\n\treturn !unconfined(__aa_task_raw_label(task));\n}",
    "includes": [
      "#include \"policy_ns.h\"",
      "#include \"label.h\"",
      "#include <linux/sched.h>",
      "#include <linux/slab.h>",
      "#include <linux/cred.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "unconfined",
          "args": [
            "__aa_task_raw_label(task)"
          ],
          "line": 106
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "__aa_task_raw_label",
          "args": [
            "task"
          ],
          "line": 106
        },
        "resolved": true,
        "details": {
          "function_name": "__aa_task_raw_label",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/include/context.h",
          "lines": "93-96",
          "snippet": "static inline struct aa_label *__aa_task_raw_label(struct task_struct *task)\n{\n\treturn aa_cred_raw_label(__task_cred(task));\n}",
          "includes": [
            "#include \"policy_ns.h\"",
            "#include \"label.h\"",
            "#include <linux/sched.h>",
            "#include <linux/slab.h>",
            "#include <linux/cred.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"policy_ns.h\"\n#include \"label.h\"\n#include <linux/sched.h>\n#include <linux/slab.h>\n#include <linux/cred.h>\n\nstatic inline struct aa_label *__aa_task_raw_label(struct task_struct *task)\n{\n\treturn aa_cred_raw_label(__task_cred(task));\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"policy_ns.h\"\n#include \"label.h\"\n#include <linux/sched.h>\n#include <linux/slab.h>\n#include <linux/cred.h>\n\nstatic inline bool __aa_task_is_confined(struct task_struct *task)\n{\n\treturn !unconfined(__aa_task_raw_label(task));\n}"
  },
  {
    "function_name": "__aa_task_raw_label",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/include/context.h",
    "lines": "93-96",
    "snippet": "static inline struct aa_label *__aa_task_raw_label(struct task_struct *task)\n{\n\treturn aa_cred_raw_label(__task_cred(task));\n}",
    "includes": [
      "#include \"policy_ns.h\"",
      "#include \"label.h\"",
      "#include <linux/sched.h>",
      "#include <linux/slab.h>",
      "#include <linux/cred.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "aa_cred_raw_label",
          "args": [
            "__task_cred(task)"
          ],
          "line": 95
        },
        "resolved": true,
        "details": {
          "function_name": "aa_cred_raw_label",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/include/context.h",
          "lines": "66-72",
          "snippet": "static inline struct aa_label *aa_cred_raw_label(const struct cred *cred)\n{\n\tstruct aa_task_ctx *ctx = cred_ctx(cred);\n\n\tAA_BUG(!ctx || !ctx->label);\n\treturn ctx->label;\n}",
          "includes": [
            "#include \"policy_ns.h\"",
            "#include \"label.h\"",
            "#include <linux/sched.h>",
            "#include <linux/slab.h>",
            "#include <linux/cred.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"policy_ns.h\"\n#include \"label.h\"\n#include <linux/sched.h>\n#include <linux/slab.h>\n#include <linux/cred.h>\n\nstatic inline struct aa_label *aa_cred_raw_label(const struct cred *cred)\n{\n\tstruct aa_task_ctx *ctx = cred_ctx(cred);\n\n\tAA_BUG(!ctx || !ctx->label);\n\treturn ctx->label;\n}"
        }
      },
      {
        "call_info": {
          "callee": "__task_cred",
          "args": [
            "task"
          ],
          "line": 95
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"policy_ns.h\"\n#include \"label.h\"\n#include <linux/sched.h>\n#include <linux/slab.h>\n#include <linux/cred.h>\n\nstatic inline struct aa_label *__aa_task_raw_label(struct task_struct *task)\n{\n\treturn aa_cred_raw_label(__task_cred(task));\n}"
  },
  {
    "function_name": "aa_get_newest_cred_label",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/include/context.h",
    "lines": "80-83",
    "snippet": "static inline struct aa_label *aa_get_newest_cred_label(const struct cred *cred)\n{\n\treturn aa_get_newest_label(aa_cred_raw_label(cred));\n}",
    "includes": [
      "#include \"policy_ns.h\"",
      "#include \"label.h\"",
      "#include <linux/sched.h>",
      "#include <linux/slab.h>",
      "#include <linux/cred.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "aa_get_newest_label",
          "args": [
            "aa_cred_raw_label(cred)"
          ],
          "line": 82
        },
        "resolved": true,
        "details": {
          "function_name": "aa_get_newest_label",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/include/label.h",
          "lines": "393-414",
          "snippet": "static inline struct aa_label *aa_get_newest_label(struct aa_label *l)\n{\n\tif (!l)\n\t\treturn NULL;\n\n\tif (label_is_stale(l)) {\n\t\tstruct aa_label *tmp;\n\n\t\tAA_BUG(!l->proxy);\n\t\tAA_BUG(!l->proxy->label);\n\t\t/* BUG: only way this can happen is @l ref count and its\n\t\t * replacement count have gone to 0 and are on their way\n\t\t * to destruction. ie. we have a refcounting error\n\t\t */\n\t\ttmp = aa_get_label_rcu(&l->proxy->label);\n\t\tAA_BUG(!tmp);\n\n\t\treturn tmp;\n\t}\n\n\treturn aa_get_label(l);\n}",
          "includes": [
            "#include \"lib.h\"",
            "#include \"apparmor.h\"",
            "#include <linux/rcupdate.h>",
            "#include <linux/rbtree.h>",
            "#include <linux/audit.h>",
            "#include <linux/atomic.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"lib.h\"\n#include \"apparmor.h\"\n#include <linux/rcupdate.h>\n#include <linux/rbtree.h>\n#include <linux/audit.h>\n#include <linux/atomic.h>\n\nstatic inline struct aa_label *aa_get_newest_label(struct aa_label *l)\n{\n\tif (!l)\n\t\treturn NULL;\n\n\tif (label_is_stale(l)) {\n\t\tstruct aa_label *tmp;\n\n\t\tAA_BUG(!l->proxy);\n\t\tAA_BUG(!l->proxy->label);\n\t\t/* BUG: only way this can happen is @l ref count and its\n\t\t * replacement count have gone to 0 and are on their way\n\t\t * to destruction. ie. we have a refcounting error\n\t\t */\n\t\ttmp = aa_get_label_rcu(&l->proxy->label);\n\t\tAA_BUG(!tmp);\n\n\t\treturn tmp;\n\t}\n\n\treturn aa_get_label(l);\n}"
        }
      },
      {
        "call_info": {
          "callee": "aa_cred_raw_label",
          "args": [
            "cred"
          ],
          "line": 82
        },
        "resolved": true,
        "details": {
          "function_name": "aa_cred_raw_label",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/include/context.h",
          "lines": "66-72",
          "snippet": "static inline struct aa_label *aa_cred_raw_label(const struct cred *cred)\n{\n\tstruct aa_task_ctx *ctx = cred_ctx(cred);\n\n\tAA_BUG(!ctx || !ctx->label);\n\treturn ctx->label;\n}",
          "includes": [
            "#include \"policy_ns.h\"",
            "#include \"label.h\"",
            "#include <linux/sched.h>",
            "#include <linux/slab.h>",
            "#include <linux/cred.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"policy_ns.h\"\n#include \"label.h\"\n#include <linux/sched.h>\n#include <linux/slab.h>\n#include <linux/cred.h>\n\nstatic inline struct aa_label *aa_cred_raw_label(const struct cred *cred)\n{\n\tstruct aa_task_ctx *ctx = cred_ctx(cred);\n\n\tAA_BUG(!ctx || !ctx->label);\n\treturn ctx->label;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"policy_ns.h\"\n#include \"label.h\"\n#include <linux/sched.h>\n#include <linux/slab.h>\n#include <linux/cred.h>\n\nstatic inline struct aa_label *aa_get_newest_cred_label(const struct cred *cred)\n{\n\treturn aa_get_newest_label(aa_cred_raw_label(cred));\n}"
  },
  {
    "function_name": "aa_cred_raw_label",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/include/context.h",
    "lines": "66-72",
    "snippet": "static inline struct aa_label *aa_cred_raw_label(const struct cred *cred)\n{\n\tstruct aa_task_ctx *ctx = cred_ctx(cred);\n\n\tAA_BUG(!ctx || !ctx->label);\n\treturn ctx->label;\n}",
    "includes": [
      "#include \"policy_ns.h\"",
      "#include \"label.h\"",
      "#include <linux/sched.h>",
      "#include <linux/slab.h>",
      "#include <linux/cred.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "AA_BUG",
          "args": [
            "!ctx || !ctx->label"
          ],
          "line": 70
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "cred_ctx",
          "args": [
            "cred"
          ],
          "line": 68
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"policy_ns.h\"\n#include \"label.h\"\n#include <linux/sched.h>\n#include <linux/slab.h>\n#include <linux/cred.h>\n\nstatic inline struct aa_label *aa_cred_raw_label(const struct cred *cred)\n{\n\tstruct aa_task_ctx *ctx = cred_ctx(cred);\n\n\tAA_BUG(!ctx || !ctx->label);\n\treturn ctx->label;\n}"
  }
]