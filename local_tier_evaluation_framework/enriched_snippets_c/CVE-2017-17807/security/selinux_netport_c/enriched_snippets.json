[
  {
    "function_name": "sel_netport_init",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/selinux/netport.c",
    "lines": "237-250",
    "snippet": "static __init int sel_netport_init(void)\n{\n\tint iter;\n\n\tif (!selinux_enabled)\n\t\treturn 0;\n\n\tfor (iter = 0; iter < SEL_NETPORT_HASH_SIZE; iter++) {\n\t\tINIT_LIST_HEAD(&sel_netport_hash[iter].list);\n\t\tsel_netport_hash[iter].size = 0;\n\t}\n\n\treturn 0;\n}",
    "includes": [
      "#include \"objsec.h\"",
      "#include \"netport.h\"",
      "#include <net/ipv6.h>",
      "#include <net/ip.h>",
      "#include <linux/ipv6.h>",
      "#include <linux/ip.h>",
      "#include <linux/in6.h>",
      "#include <linux/in.h>",
      "#include <linux/spinlock.h>",
      "#include <linux/slab.h>",
      "#include <linux/list.h>",
      "#include <linux/rcupdate.h>",
      "#include <linux/types.h>"
    ],
    "macros_used": [
      "#define SEL_NETPORT_HASH_SIZE       256"
    ],
    "globals_used": [
      "static struct sel_netport_bkt sel_netport_hash[SEL_NETPORT_HASH_SIZE];"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "INIT_LIST_HEAD",
          "args": [
            "&sel_netport_hash[iter].list"
          ],
          "line": 245
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"objsec.h\"\n#include \"netport.h\"\n#include <net/ipv6.h>\n#include <net/ip.h>\n#include <linux/ipv6.h>\n#include <linux/ip.h>\n#include <linux/in6.h>\n#include <linux/in.h>\n#include <linux/spinlock.h>\n#include <linux/slab.h>\n#include <linux/list.h>\n#include <linux/rcupdate.h>\n#include <linux/types.h>\n\n#define SEL_NETPORT_HASH_SIZE       256\n\nstatic struct sel_netport_bkt sel_netport_hash[SEL_NETPORT_HASH_SIZE];\n\nstatic __init int sel_netport_init(void)\n{\n\tint iter;\n\n\tif (!selinux_enabled)\n\t\treturn 0;\n\n\tfor (iter = 0; iter < SEL_NETPORT_HASH_SIZE; iter++) {\n\t\tINIT_LIST_HEAD(&sel_netport_hash[iter].list);\n\t\tsel_netport_hash[iter].size = 0;\n\t}\n\n\treturn 0;\n}"
  },
  {
    "function_name": "sel_netport_flush",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/selinux/netport.c",
    "lines": "220-235",
    "snippet": "void sel_netport_flush(void)\n{\n\tunsigned int idx;\n\tstruct sel_netport *port, *port_tmp;\n\n\tspin_lock_bh(&sel_netport_lock);\n\tfor (idx = 0; idx < SEL_NETPORT_HASH_SIZE; idx++) {\n\t\tlist_for_each_entry_safe(port, port_tmp,\n\t\t\t\t\t &sel_netport_hash[idx].list, list) {\n\t\t\tlist_del_rcu(&port->list);\n\t\t\tkfree_rcu(port, rcu);\n\t\t}\n\t\tsel_netport_hash[idx].size = 0;\n\t}\n\tspin_unlock_bh(&sel_netport_lock);\n}",
    "includes": [
      "#include \"objsec.h\"",
      "#include \"netport.h\"",
      "#include <net/ipv6.h>",
      "#include <net/ip.h>",
      "#include <linux/ipv6.h>",
      "#include <linux/ip.h>",
      "#include <linux/in6.h>",
      "#include <linux/in.h>",
      "#include <linux/spinlock.h>",
      "#include <linux/slab.h>",
      "#include <linux/list.h>",
      "#include <linux/rcupdate.h>",
      "#include <linux/types.h>"
    ],
    "macros_used": [
      "#define SEL_NETPORT_HASH_SIZE       256"
    ],
    "globals_used": [
      "static DEFINE_SPINLOCK(sel_netport_lock);",
      "static struct sel_netport_bkt sel_netport_hash[SEL_NETPORT_HASH_SIZE];"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "spin_unlock_bh",
          "args": [
            "&sel_netport_lock"
          ],
          "line": 234
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kfree_rcu",
          "args": [
            "port",
            "rcu"
          ],
          "line": 230
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "list_del_rcu",
          "args": [
            "&port->list"
          ],
          "line": 229
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "list_for_each_entry_safe",
          "args": [
            "port",
            "port_tmp",
            "&sel_netport_hash[idx].list",
            "list"
          ],
          "line": 227
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "spin_lock_bh",
          "args": [
            "&sel_netport_lock"
          ],
          "line": 225
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"objsec.h\"\n#include \"netport.h\"\n#include <net/ipv6.h>\n#include <net/ip.h>\n#include <linux/ipv6.h>\n#include <linux/ip.h>\n#include <linux/in6.h>\n#include <linux/in.h>\n#include <linux/spinlock.h>\n#include <linux/slab.h>\n#include <linux/list.h>\n#include <linux/rcupdate.h>\n#include <linux/types.h>\n\n#define SEL_NETPORT_HASH_SIZE       256\n\nstatic DEFINE_SPINLOCK(sel_netport_lock);\nstatic struct sel_netport_bkt sel_netport_hash[SEL_NETPORT_HASH_SIZE];\n\nvoid sel_netport_flush(void)\n{\n\tunsigned int idx;\n\tstruct sel_netport *port, *port_tmp;\n\n\tspin_lock_bh(&sel_netport_lock);\n\tfor (idx = 0; idx < SEL_NETPORT_HASH_SIZE; idx++) {\n\t\tlist_for_each_entry_safe(port, port_tmp,\n\t\t\t\t\t &sel_netport_hash[idx].list, list) {\n\t\t\tlist_del_rcu(&port->list);\n\t\t\tkfree_rcu(port, rcu);\n\t\t}\n\t\tsel_netport_hash[idx].size = 0;\n\t}\n\tspin_unlock_bh(&sel_netport_lock);\n}"
  },
  {
    "function_name": "sel_netport_sid",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/selinux/netport.c",
    "lines": "197-211",
    "snippet": "int sel_netport_sid(u8 protocol, u16 pnum, u32 *sid)\n{\n\tstruct sel_netport *port;\n\n\trcu_read_lock();\n\tport = sel_netport_find(protocol, pnum);\n\tif (port != NULL) {\n\t\t*sid = port->psec.sid;\n\t\trcu_read_unlock();\n\t\treturn 0;\n\t}\n\trcu_read_unlock();\n\n\treturn sel_netport_sid_slow(protocol, pnum, sid);\n}",
    "includes": [
      "#include \"objsec.h\"",
      "#include \"netport.h\"",
      "#include <net/ipv6.h>",
      "#include <net/ip.h>",
      "#include <linux/ipv6.h>",
      "#include <linux/ip.h>",
      "#include <linux/in6.h>",
      "#include <linux/in.h>",
      "#include <linux/spinlock.h>",
      "#include <linux/slab.h>",
      "#include <linux/list.h>",
      "#include <linux/rcupdate.h>",
      "#include <linux/types.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "sel_netport_sid_slow",
          "args": [
            "protocol",
            "pnum",
            "sid"
          ],
          "line": 210
        },
        "resolved": true,
        "details": {
          "function_name": "sel_netport_sid_slow",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/selinux/netport.c",
          "lines": "148-182",
          "snippet": "static int sel_netport_sid_slow(u8 protocol, u16 pnum, u32 *sid)\n{\n\tint ret = -ENOMEM;\n\tstruct sel_netport *port;\n\tstruct sel_netport *new = NULL;\n\n\tspin_lock_bh(&sel_netport_lock);\n\tport = sel_netport_find(protocol, pnum);\n\tif (port != NULL) {\n\t\t*sid = port->psec.sid;\n\t\tspin_unlock_bh(&sel_netport_lock);\n\t\treturn 0;\n\t}\n\tnew = kzalloc(sizeof(*new), GFP_ATOMIC);\n\tif (new == NULL)\n\t\tgoto out;\n\tret = security_port_sid(protocol, pnum, sid);\n\tif (ret != 0)\n\t\tgoto out;\n\n\tnew->psec.port = pnum;\n\tnew->psec.protocol = protocol;\n\tnew->psec.sid = *sid;\n\tsel_netport_insert(new);\n\nout:\n\tspin_unlock_bh(&sel_netport_lock);\n\tif (unlikely(ret)) {\n\t\tprintk(KERN_WARNING\n\t\t       \"SELinux: failure in sel_netport_sid_slow(),\"\n\t\t       \" unable to determine network port label\\n\");\n\t\tkfree(new);\n\t}\n\treturn ret;\n}",
          "includes": [
            "#include \"objsec.h\"",
            "#include \"netport.h\"",
            "#include <net/ipv6.h>",
            "#include <net/ip.h>",
            "#include <linux/ipv6.h>",
            "#include <linux/ip.h>",
            "#include <linux/in6.h>",
            "#include <linux/in.h>",
            "#include <linux/spinlock.h>",
            "#include <linux/slab.h>",
            "#include <linux/list.h>",
            "#include <linux/rcupdate.h>",
            "#include <linux/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static DEFINE_SPINLOCK(sel_netport_lock);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"objsec.h\"\n#include \"netport.h\"\n#include <net/ipv6.h>\n#include <net/ip.h>\n#include <linux/ipv6.h>\n#include <linux/ip.h>\n#include <linux/in6.h>\n#include <linux/in.h>\n#include <linux/spinlock.h>\n#include <linux/slab.h>\n#include <linux/list.h>\n#include <linux/rcupdate.h>\n#include <linux/types.h>\n\nstatic DEFINE_SPINLOCK(sel_netport_lock);\n\nstatic int sel_netport_sid_slow(u8 protocol, u16 pnum, u32 *sid)\n{\n\tint ret = -ENOMEM;\n\tstruct sel_netport *port;\n\tstruct sel_netport *new = NULL;\n\n\tspin_lock_bh(&sel_netport_lock);\n\tport = sel_netport_find(protocol, pnum);\n\tif (port != NULL) {\n\t\t*sid = port->psec.sid;\n\t\tspin_unlock_bh(&sel_netport_lock);\n\t\treturn 0;\n\t}\n\tnew = kzalloc(sizeof(*new), GFP_ATOMIC);\n\tif (new == NULL)\n\t\tgoto out;\n\tret = security_port_sid(protocol, pnum, sid);\n\tif (ret != 0)\n\t\tgoto out;\n\n\tnew->psec.port = pnum;\n\tnew->psec.protocol = protocol;\n\tnew->psec.sid = *sid;\n\tsel_netport_insert(new);\n\nout:\n\tspin_unlock_bh(&sel_netport_lock);\n\tif (unlikely(ret)) {\n\t\tprintk(KERN_WARNING\n\t\t       \"SELinux: failure in sel_netport_sid_slow(),\"\n\t\t       \" unable to determine network port label\\n\");\n\t\tkfree(new);\n\t}\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "rcu_read_unlock",
          "args": [],
          "line": 208
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rcu_read_unlock",
          "args": [],
          "line": 205
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sel_netport_find",
          "args": [
            "protocol",
            "pnum"
          ],
          "line": 202
        },
        "resolved": true,
        "details": {
          "function_name": "sel_netport_find",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/selinux/netport.c",
          "lines": "94-105",
          "snippet": "static struct sel_netport *sel_netport_find(u8 protocol, u16 pnum)\n{\n\tunsigned int idx;\n\tstruct sel_netport *port;\n\n\tidx = sel_netport_hashfn(pnum);\n\tlist_for_each_entry_rcu(port, &sel_netport_hash[idx].list, list)\n\t\tif (port->psec.port == pnum && port->psec.protocol == protocol)\n\t\t\treturn port;\n\n\treturn NULL;\n}",
          "includes": [
            "#include \"objsec.h\"",
            "#include \"netport.h\"",
            "#include <net/ipv6.h>",
            "#include <net/ip.h>",
            "#include <linux/ipv6.h>",
            "#include <linux/ip.h>",
            "#include <linux/in6.h>",
            "#include <linux/in.h>",
            "#include <linux/spinlock.h>",
            "#include <linux/slab.h>",
            "#include <linux/list.h>",
            "#include <linux/rcupdate.h>",
            "#include <linux/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static struct sel_netport_bkt sel_netport_hash[SEL_NETPORT_HASH_SIZE];"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"objsec.h\"\n#include \"netport.h\"\n#include <net/ipv6.h>\n#include <net/ip.h>\n#include <linux/ipv6.h>\n#include <linux/ip.h>\n#include <linux/in6.h>\n#include <linux/in.h>\n#include <linux/spinlock.h>\n#include <linux/slab.h>\n#include <linux/list.h>\n#include <linux/rcupdate.h>\n#include <linux/types.h>\n\nstatic struct sel_netport_bkt sel_netport_hash[SEL_NETPORT_HASH_SIZE];\n\nstatic struct sel_netport *sel_netport_find(u8 protocol, u16 pnum)\n{\n\tunsigned int idx;\n\tstruct sel_netport *port;\n\n\tidx = sel_netport_hashfn(pnum);\n\tlist_for_each_entry_rcu(port, &sel_netport_hash[idx].list, list)\n\t\tif (port->psec.port == pnum && port->psec.protocol == protocol)\n\t\t\treturn port;\n\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "rcu_read_lock",
          "args": [],
          "line": 201
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"objsec.h\"\n#include \"netport.h\"\n#include <net/ipv6.h>\n#include <net/ip.h>\n#include <linux/ipv6.h>\n#include <linux/ip.h>\n#include <linux/in6.h>\n#include <linux/in.h>\n#include <linux/spinlock.h>\n#include <linux/slab.h>\n#include <linux/list.h>\n#include <linux/rcupdate.h>\n#include <linux/types.h>\n\nint sel_netport_sid(u8 protocol, u16 pnum, u32 *sid)\n{\n\tstruct sel_netport *port;\n\n\trcu_read_lock();\n\tport = sel_netport_find(protocol, pnum);\n\tif (port != NULL) {\n\t\t*sid = port->psec.sid;\n\t\trcu_read_unlock();\n\t\treturn 0;\n\t}\n\trcu_read_unlock();\n\n\treturn sel_netport_sid_slow(protocol, pnum, sid);\n}"
  },
  {
    "function_name": "sel_netport_sid_slow",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/selinux/netport.c",
    "lines": "148-182",
    "snippet": "static int sel_netport_sid_slow(u8 protocol, u16 pnum, u32 *sid)\n{\n\tint ret = -ENOMEM;\n\tstruct sel_netport *port;\n\tstruct sel_netport *new = NULL;\n\n\tspin_lock_bh(&sel_netport_lock);\n\tport = sel_netport_find(protocol, pnum);\n\tif (port != NULL) {\n\t\t*sid = port->psec.sid;\n\t\tspin_unlock_bh(&sel_netport_lock);\n\t\treturn 0;\n\t}\n\tnew = kzalloc(sizeof(*new), GFP_ATOMIC);\n\tif (new == NULL)\n\t\tgoto out;\n\tret = security_port_sid(protocol, pnum, sid);\n\tif (ret != 0)\n\t\tgoto out;\n\n\tnew->psec.port = pnum;\n\tnew->psec.protocol = protocol;\n\tnew->psec.sid = *sid;\n\tsel_netport_insert(new);\n\nout:\n\tspin_unlock_bh(&sel_netport_lock);\n\tif (unlikely(ret)) {\n\t\tprintk(KERN_WARNING\n\t\t       \"SELinux: failure in sel_netport_sid_slow(),\"\n\t\t       \" unable to determine network port label\\n\");\n\t\tkfree(new);\n\t}\n\treturn ret;\n}",
    "includes": [
      "#include \"objsec.h\"",
      "#include \"netport.h\"",
      "#include <net/ipv6.h>",
      "#include <net/ip.h>",
      "#include <linux/ipv6.h>",
      "#include <linux/ip.h>",
      "#include <linux/in6.h>",
      "#include <linux/in.h>",
      "#include <linux/spinlock.h>",
      "#include <linux/slab.h>",
      "#include <linux/list.h>",
      "#include <linux/rcupdate.h>",
      "#include <linux/types.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static DEFINE_SPINLOCK(sel_netport_lock);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "kfree",
          "args": [
            "new"
          ],
          "line": 179
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "printk",
          "args": [
            "KERN_WARNING\n\t\t       \"SELinux: failure in sel_netport_sid_slow(),\"\n\t\t       \" unable to determine network port label\\n\""
          ],
          "line": 176
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "unlikely",
          "args": [
            "ret"
          ],
          "line": 175
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "spin_unlock_bh",
          "args": [
            "&sel_netport_lock"
          ],
          "line": 174
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sel_netport_insert",
          "args": [
            "new"
          ],
          "line": 171
        },
        "resolved": true,
        "details": {
          "function_name": "sel_netport_insert",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/selinux/netport.c",
          "lines": "115-134",
          "snippet": "static void sel_netport_insert(struct sel_netport *port)\n{\n\tunsigned int idx;\n\n\t/* we need to impose a limit on the growth of the hash table so check\n\t * this bucket to make sure it is within the specified bounds */\n\tidx = sel_netport_hashfn(port->psec.port);\n\tlist_add_rcu(&port->list, &sel_netport_hash[idx].list);\n\tif (sel_netport_hash[idx].size == SEL_NETPORT_HASH_BKT_LIMIT) {\n\t\tstruct sel_netport *tail;\n\t\ttail = list_entry(\n\t\t\trcu_dereference_protected(\n\t\t\t\tsel_netport_hash[idx].list.prev,\n\t\t\t\tlockdep_is_held(&sel_netport_lock)),\n\t\t\tstruct sel_netport, list);\n\t\tlist_del_rcu(&tail->list);\n\t\tkfree_rcu(tail, rcu);\n\t} else\n\t\tsel_netport_hash[idx].size++;\n}",
          "includes": [
            "#include \"objsec.h\"",
            "#include \"netport.h\"",
            "#include <net/ipv6.h>",
            "#include <net/ip.h>",
            "#include <linux/ipv6.h>",
            "#include <linux/ip.h>",
            "#include <linux/in6.h>",
            "#include <linux/in.h>",
            "#include <linux/spinlock.h>",
            "#include <linux/slab.h>",
            "#include <linux/list.h>",
            "#include <linux/rcupdate.h>",
            "#include <linux/types.h>"
          ],
          "macros_used": [
            "#define SEL_NETPORT_HASH_BKT_LIMIT   16"
          ],
          "globals_used": [
            "static DEFINE_SPINLOCK(sel_netport_lock);",
            "static struct sel_netport_bkt sel_netport_hash[SEL_NETPORT_HASH_SIZE];"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"objsec.h\"\n#include \"netport.h\"\n#include <net/ipv6.h>\n#include <net/ip.h>\n#include <linux/ipv6.h>\n#include <linux/ip.h>\n#include <linux/in6.h>\n#include <linux/in.h>\n#include <linux/spinlock.h>\n#include <linux/slab.h>\n#include <linux/list.h>\n#include <linux/rcupdate.h>\n#include <linux/types.h>\n\n#define SEL_NETPORT_HASH_BKT_LIMIT   16\n\nstatic DEFINE_SPINLOCK(sel_netport_lock);\nstatic struct sel_netport_bkt sel_netport_hash[SEL_NETPORT_HASH_SIZE];\n\nstatic void sel_netport_insert(struct sel_netport *port)\n{\n\tunsigned int idx;\n\n\t/* we need to impose a limit on the growth of the hash table so check\n\t * this bucket to make sure it is within the specified bounds */\n\tidx = sel_netport_hashfn(port->psec.port);\n\tlist_add_rcu(&port->list, &sel_netport_hash[idx].list);\n\tif (sel_netport_hash[idx].size == SEL_NETPORT_HASH_BKT_LIMIT) {\n\t\tstruct sel_netport *tail;\n\t\ttail = list_entry(\n\t\t\trcu_dereference_protected(\n\t\t\t\tsel_netport_hash[idx].list.prev,\n\t\t\t\tlockdep_is_held(&sel_netport_lock)),\n\t\t\tstruct sel_netport, list);\n\t\tlist_del_rcu(&tail->list);\n\t\tkfree_rcu(tail, rcu);\n\t} else\n\t\tsel_netport_hash[idx].size++;\n}"
        }
      },
      {
        "call_info": {
          "callee": "security_port_sid",
          "args": [
            "protocol",
            "pnum",
            "sid"
          ],
          "line": 164
        },
        "resolved": true,
        "details": {
          "function_name": "security_port_sid",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/selinux/ss/services.c",
          "lines": "2214-2246",
          "snippet": "int security_port_sid(u8 protocol, u16 port, u32 *out_sid)\n{\n\tstruct ocontext *c;\n\tint rc = 0;\n\n\tread_lock(&policy_rwlock);\n\n\tc = policydb.ocontexts[OCON_PORT];\n\twhile (c) {\n\t\tif (c->u.port.protocol == protocol &&\n\t\t    c->u.port.low_port <= port &&\n\t\t    c->u.port.high_port >= port)\n\t\t\tbreak;\n\t\tc = c->next;\n\t}\n\n\tif (c) {\n\t\tif (!c->sid[0]) {\n\t\t\trc = sidtab_context_to_sid(&sidtab,\n\t\t\t\t\t\t   &c->context[0],\n\t\t\t\t\t\t   &c->sid[0]);\n\t\t\tif (rc)\n\t\t\t\tgoto out;\n\t\t}\n\t\t*out_sid = c->sid[0];\n\t} else {\n\t\t*out_sid = SECINITSID_PORT;\n\t}\n\nout:\n\tread_unlock(&policy_rwlock);\n\treturn rc;\n}",
          "includes": [
            "#include \"initial_sid_to_string.h\"",
            "#include \"audit.h\"",
            "#include \"ebitmap.h\"",
            "#include \"xfrm.h\"",
            "#include \"netlabel.h\"",
            "#include \"objsec.h\"",
            "#include \"mls.h\"",
            "#include \"conditional.h\"",
            "#include \"services.h\"",
            "#include \"sidtab.h\"",
            "#include \"policydb.h\"",
            "#include \"context.h\"",
            "#include \"security.h\"",
            "#include \"avc_ss.h\"",
            "#include \"avc.h\"",
            "#include \"flask.h\"",
            "#include <net/netlabel.h>",
            "#include <linux/vmalloc.h>",
            "#include <linux/flex_array.h>",
            "#include <linux/selinux.h>",
            "#include <linux/mutex.h>",
            "#include <linux/audit.h>",
            "#include <linux/sched.h>",
            "#include <linux/in.h>",
            "#include <linux/errno.h>",
            "#include <linux/rcupdate.h>",
            "#include <linux/spinlock.h>",
            "#include <linux/string.h>",
            "#include <linux/slab.h>",
            "#include <linux/kernel.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static DEFINE_RWLOCK(policy_rwlock);",
            "static struct sidtab sidtab;",
            "struct policydb policydb;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"initial_sid_to_string.h\"\n#include \"audit.h\"\n#include \"ebitmap.h\"\n#include \"xfrm.h\"\n#include \"netlabel.h\"\n#include \"objsec.h\"\n#include \"mls.h\"\n#include \"conditional.h\"\n#include \"services.h\"\n#include \"sidtab.h\"\n#include \"policydb.h\"\n#include \"context.h\"\n#include \"security.h\"\n#include \"avc_ss.h\"\n#include \"avc.h\"\n#include \"flask.h\"\n#include <net/netlabel.h>\n#include <linux/vmalloc.h>\n#include <linux/flex_array.h>\n#include <linux/selinux.h>\n#include <linux/mutex.h>\n#include <linux/audit.h>\n#include <linux/sched.h>\n#include <linux/in.h>\n#include <linux/errno.h>\n#include <linux/rcupdate.h>\n#include <linux/spinlock.h>\n#include <linux/string.h>\n#include <linux/slab.h>\n#include <linux/kernel.h>\n\nstatic DEFINE_RWLOCK(policy_rwlock);\nstatic struct sidtab sidtab;\nstruct policydb policydb;\n\nint security_port_sid(u8 protocol, u16 port, u32 *out_sid)\n{\n\tstruct ocontext *c;\n\tint rc = 0;\n\n\tread_lock(&policy_rwlock);\n\n\tc = policydb.ocontexts[OCON_PORT];\n\twhile (c) {\n\t\tif (c->u.port.protocol == protocol &&\n\t\t    c->u.port.low_port <= port &&\n\t\t    c->u.port.high_port >= port)\n\t\t\tbreak;\n\t\tc = c->next;\n\t}\n\n\tif (c) {\n\t\tif (!c->sid[0]) {\n\t\t\trc = sidtab_context_to_sid(&sidtab,\n\t\t\t\t\t\t   &c->context[0],\n\t\t\t\t\t\t   &c->sid[0]);\n\t\t\tif (rc)\n\t\t\t\tgoto out;\n\t\t}\n\t\t*out_sid = c->sid[0];\n\t} else {\n\t\t*out_sid = SECINITSID_PORT;\n\t}\n\nout:\n\tread_unlock(&policy_rwlock);\n\treturn rc;\n}"
        }
      },
      {
        "call_info": {
          "callee": "kzalloc",
          "args": [
            "sizeof(*new)",
            "GFP_ATOMIC"
          ],
          "line": 161
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "spin_unlock_bh",
          "args": [
            "&sel_netport_lock"
          ],
          "line": 158
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sel_netport_find",
          "args": [
            "protocol",
            "pnum"
          ],
          "line": 155
        },
        "resolved": true,
        "details": {
          "function_name": "sel_netport_find",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/selinux/netport.c",
          "lines": "94-105",
          "snippet": "static struct sel_netport *sel_netport_find(u8 protocol, u16 pnum)\n{\n\tunsigned int idx;\n\tstruct sel_netport *port;\n\n\tidx = sel_netport_hashfn(pnum);\n\tlist_for_each_entry_rcu(port, &sel_netport_hash[idx].list, list)\n\t\tif (port->psec.port == pnum && port->psec.protocol == protocol)\n\t\t\treturn port;\n\n\treturn NULL;\n}",
          "includes": [
            "#include \"objsec.h\"",
            "#include \"netport.h\"",
            "#include <net/ipv6.h>",
            "#include <net/ip.h>",
            "#include <linux/ipv6.h>",
            "#include <linux/ip.h>",
            "#include <linux/in6.h>",
            "#include <linux/in.h>",
            "#include <linux/spinlock.h>",
            "#include <linux/slab.h>",
            "#include <linux/list.h>",
            "#include <linux/rcupdate.h>",
            "#include <linux/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static struct sel_netport_bkt sel_netport_hash[SEL_NETPORT_HASH_SIZE];"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"objsec.h\"\n#include \"netport.h\"\n#include <net/ipv6.h>\n#include <net/ip.h>\n#include <linux/ipv6.h>\n#include <linux/ip.h>\n#include <linux/in6.h>\n#include <linux/in.h>\n#include <linux/spinlock.h>\n#include <linux/slab.h>\n#include <linux/list.h>\n#include <linux/rcupdate.h>\n#include <linux/types.h>\n\nstatic struct sel_netport_bkt sel_netport_hash[SEL_NETPORT_HASH_SIZE];\n\nstatic struct sel_netport *sel_netport_find(u8 protocol, u16 pnum)\n{\n\tunsigned int idx;\n\tstruct sel_netport *port;\n\n\tidx = sel_netport_hashfn(pnum);\n\tlist_for_each_entry_rcu(port, &sel_netport_hash[idx].list, list)\n\t\tif (port->psec.port == pnum && port->psec.protocol == protocol)\n\t\t\treturn port;\n\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "spin_lock_bh",
          "args": [
            "&sel_netport_lock"
          ],
          "line": 154
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"objsec.h\"\n#include \"netport.h\"\n#include <net/ipv6.h>\n#include <net/ip.h>\n#include <linux/ipv6.h>\n#include <linux/ip.h>\n#include <linux/in6.h>\n#include <linux/in.h>\n#include <linux/spinlock.h>\n#include <linux/slab.h>\n#include <linux/list.h>\n#include <linux/rcupdate.h>\n#include <linux/types.h>\n\nstatic DEFINE_SPINLOCK(sel_netport_lock);\n\nstatic int sel_netport_sid_slow(u8 protocol, u16 pnum, u32 *sid)\n{\n\tint ret = -ENOMEM;\n\tstruct sel_netport *port;\n\tstruct sel_netport *new = NULL;\n\n\tspin_lock_bh(&sel_netport_lock);\n\tport = sel_netport_find(protocol, pnum);\n\tif (port != NULL) {\n\t\t*sid = port->psec.sid;\n\t\tspin_unlock_bh(&sel_netport_lock);\n\t\treturn 0;\n\t}\n\tnew = kzalloc(sizeof(*new), GFP_ATOMIC);\n\tif (new == NULL)\n\t\tgoto out;\n\tret = security_port_sid(protocol, pnum, sid);\n\tif (ret != 0)\n\t\tgoto out;\n\n\tnew->psec.port = pnum;\n\tnew->psec.protocol = protocol;\n\tnew->psec.sid = *sid;\n\tsel_netport_insert(new);\n\nout:\n\tspin_unlock_bh(&sel_netport_lock);\n\tif (unlikely(ret)) {\n\t\tprintk(KERN_WARNING\n\t\t       \"SELinux: failure in sel_netport_sid_slow(),\"\n\t\t       \" unable to determine network port label\\n\");\n\t\tkfree(new);\n\t}\n\treturn ret;\n}"
  },
  {
    "function_name": "sel_netport_insert",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/selinux/netport.c",
    "lines": "115-134",
    "snippet": "static void sel_netport_insert(struct sel_netport *port)\n{\n\tunsigned int idx;\n\n\t/* we need to impose a limit on the growth of the hash table so check\n\t * this bucket to make sure it is within the specified bounds */\n\tidx = sel_netport_hashfn(port->psec.port);\n\tlist_add_rcu(&port->list, &sel_netport_hash[idx].list);\n\tif (sel_netport_hash[idx].size == SEL_NETPORT_HASH_BKT_LIMIT) {\n\t\tstruct sel_netport *tail;\n\t\ttail = list_entry(\n\t\t\trcu_dereference_protected(\n\t\t\t\tsel_netport_hash[idx].list.prev,\n\t\t\t\tlockdep_is_held(&sel_netport_lock)),\n\t\t\tstruct sel_netport, list);\n\t\tlist_del_rcu(&tail->list);\n\t\tkfree_rcu(tail, rcu);\n\t} else\n\t\tsel_netport_hash[idx].size++;\n}",
    "includes": [
      "#include \"objsec.h\"",
      "#include \"netport.h\"",
      "#include <net/ipv6.h>",
      "#include <net/ip.h>",
      "#include <linux/ipv6.h>",
      "#include <linux/ip.h>",
      "#include <linux/in6.h>",
      "#include <linux/in.h>",
      "#include <linux/spinlock.h>",
      "#include <linux/slab.h>",
      "#include <linux/list.h>",
      "#include <linux/rcupdate.h>",
      "#include <linux/types.h>"
    ],
    "macros_used": [
      "#define SEL_NETPORT_HASH_BKT_LIMIT   16"
    ],
    "globals_used": [
      "static DEFINE_SPINLOCK(sel_netport_lock);",
      "static struct sel_netport_bkt sel_netport_hash[SEL_NETPORT_HASH_SIZE];"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "kfree_rcu",
          "args": [
            "tail",
            "rcu"
          ],
          "line": 131
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "list_del_rcu",
          "args": [
            "&tail->list"
          ],
          "line": 130
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "list_entry",
          "args": [
            "rcu_dereference_protected(\n\t\t\t\tsel_netport_hash[idx].list.prev,\n\t\t\t\tlockdep_is_held(&sel_netport_lock))",
            "structsel_netport",
            "list"
          ],
          "line": 125
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rcu_dereference_protected",
          "args": [
            "sel_netport_hash[idx].list.prev",
            "lockdep_is_held(&sel_netport_lock)"
          ],
          "line": 126
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lockdep_is_held",
          "args": [
            "&sel_netport_lock"
          ],
          "line": 128
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "list_add_rcu",
          "args": [
            "&port->list",
            "&sel_netport_hash[idx].list"
          ],
          "line": 122
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sel_netport_hashfn",
          "args": [
            "port->psec.port"
          ],
          "line": 121
        },
        "resolved": true,
        "details": {
          "function_name": "sel_netport_hashfn",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/selinux/netport.c",
          "lines": "79-82",
          "snippet": "static unsigned int sel_netport_hashfn(u16 pnum)\n{\n\treturn (pnum & (SEL_NETPORT_HASH_SIZE - 1));\n}",
          "includes": [
            "#include \"objsec.h\"",
            "#include \"netport.h\"",
            "#include <net/ipv6.h>",
            "#include <net/ip.h>",
            "#include <linux/ipv6.h>",
            "#include <linux/ip.h>",
            "#include <linux/in6.h>",
            "#include <linux/in.h>",
            "#include <linux/spinlock.h>",
            "#include <linux/slab.h>",
            "#include <linux/list.h>",
            "#include <linux/rcupdate.h>",
            "#include <linux/types.h>"
          ],
          "macros_used": [
            "#define SEL_NETPORT_HASH_SIZE       256"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"objsec.h\"\n#include \"netport.h\"\n#include <net/ipv6.h>\n#include <net/ip.h>\n#include <linux/ipv6.h>\n#include <linux/ip.h>\n#include <linux/in6.h>\n#include <linux/in.h>\n#include <linux/spinlock.h>\n#include <linux/slab.h>\n#include <linux/list.h>\n#include <linux/rcupdate.h>\n#include <linux/types.h>\n\n#define SEL_NETPORT_HASH_SIZE       256\n\nstatic unsigned int sel_netport_hashfn(u16 pnum)\n{\n\treturn (pnum & (SEL_NETPORT_HASH_SIZE - 1));\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"objsec.h\"\n#include \"netport.h\"\n#include <net/ipv6.h>\n#include <net/ip.h>\n#include <linux/ipv6.h>\n#include <linux/ip.h>\n#include <linux/in6.h>\n#include <linux/in.h>\n#include <linux/spinlock.h>\n#include <linux/slab.h>\n#include <linux/list.h>\n#include <linux/rcupdate.h>\n#include <linux/types.h>\n\n#define SEL_NETPORT_HASH_BKT_LIMIT   16\n\nstatic DEFINE_SPINLOCK(sel_netport_lock);\nstatic struct sel_netport_bkt sel_netport_hash[SEL_NETPORT_HASH_SIZE];\n\nstatic void sel_netport_insert(struct sel_netport *port)\n{\n\tunsigned int idx;\n\n\t/* we need to impose a limit on the growth of the hash table so check\n\t * this bucket to make sure it is within the specified bounds */\n\tidx = sel_netport_hashfn(port->psec.port);\n\tlist_add_rcu(&port->list, &sel_netport_hash[idx].list);\n\tif (sel_netport_hash[idx].size == SEL_NETPORT_HASH_BKT_LIMIT) {\n\t\tstruct sel_netport *tail;\n\t\ttail = list_entry(\n\t\t\trcu_dereference_protected(\n\t\t\t\tsel_netport_hash[idx].list.prev,\n\t\t\t\tlockdep_is_held(&sel_netport_lock)),\n\t\t\tstruct sel_netport, list);\n\t\tlist_del_rcu(&tail->list);\n\t\tkfree_rcu(tail, rcu);\n\t} else\n\t\tsel_netport_hash[idx].size++;\n}"
  },
  {
    "function_name": "sel_netport_find",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/selinux/netport.c",
    "lines": "94-105",
    "snippet": "static struct sel_netport *sel_netport_find(u8 protocol, u16 pnum)\n{\n\tunsigned int idx;\n\tstruct sel_netport *port;\n\n\tidx = sel_netport_hashfn(pnum);\n\tlist_for_each_entry_rcu(port, &sel_netport_hash[idx].list, list)\n\t\tif (port->psec.port == pnum && port->psec.protocol == protocol)\n\t\t\treturn port;\n\n\treturn NULL;\n}",
    "includes": [
      "#include \"objsec.h\"",
      "#include \"netport.h\"",
      "#include <net/ipv6.h>",
      "#include <net/ip.h>",
      "#include <linux/ipv6.h>",
      "#include <linux/ip.h>",
      "#include <linux/in6.h>",
      "#include <linux/in.h>",
      "#include <linux/spinlock.h>",
      "#include <linux/slab.h>",
      "#include <linux/list.h>",
      "#include <linux/rcupdate.h>",
      "#include <linux/types.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static struct sel_netport_bkt sel_netport_hash[SEL_NETPORT_HASH_SIZE];"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "list_for_each_entry_rcu",
          "args": [
            "port",
            "&sel_netport_hash[idx].list",
            "list"
          ],
          "line": 100
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sel_netport_hashfn",
          "args": [
            "pnum"
          ],
          "line": 99
        },
        "resolved": true,
        "details": {
          "function_name": "sel_netport_hashfn",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/selinux/netport.c",
          "lines": "79-82",
          "snippet": "static unsigned int sel_netport_hashfn(u16 pnum)\n{\n\treturn (pnum & (SEL_NETPORT_HASH_SIZE - 1));\n}",
          "includes": [
            "#include \"objsec.h\"",
            "#include \"netport.h\"",
            "#include <net/ipv6.h>",
            "#include <net/ip.h>",
            "#include <linux/ipv6.h>",
            "#include <linux/ip.h>",
            "#include <linux/in6.h>",
            "#include <linux/in.h>",
            "#include <linux/spinlock.h>",
            "#include <linux/slab.h>",
            "#include <linux/list.h>",
            "#include <linux/rcupdate.h>",
            "#include <linux/types.h>"
          ],
          "macros_used": [
            "#define SEL_NETPORT_HASH_SIZE       256"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"objsec.h\"\n#include \"netport.h\"\n#include <net/ipv6.h>\n#include <net/ip.h>\n#include <linux/ipv6.h>\n#include <linux/ip.h>\n#include <linux/in6.h>\n#include <linux/in.h>\n#include <linux/spinlock.h>\n#include <linux/slab.h>\n#include <linux/list.h>\n#include <linux/rcupdate.h>\n#include <linux/types.h>\n\n#define SEL_NETPORT_HASH_SIZE       256\n\nstatic unsigned int sel_netport_hashfn(u16 pnum)\n{\n\treturn (pnum & (SEL_NETPORT_HASH_SIZE - 1));\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"objsec.h\"\n#include \"netport.h\"\n#include <net/ipv6.h>\n#include <net/ip.h>\n#include <linux/ipv6.h>\n#include <linux/ip.h>\n#include <linux/in6.h>\n#include <linux/in.h>\n#include <linux/spinlock.h>\n#include <linux/slab.h>\n#include <linux/list.h>\n#include <linux/rcupdate.h>\n#include <linux/types.h>\n\nstatic struct sel_netport_bkt sel_netport_hash[SEL_NETPORT_HASH_SIZE];\n\nstatic struct sel_netport *sel_netport_find(u8 protocol, u16 pnum)\n{\n\tunsigned int idx;\n\tstruct sel_netport *port;\n\n\tidx = sel_netport_hashfn(pnum);\n\tlist_for_each_entry_rcu(port, &sel_netport_hash[idx].list, list)\n\t\tif (port->psec.port == pnum && port->psec.protocol == protocol)\n\t\t\treturn port;\n\n\treturn NULL;\n}"
  },
  {
    "function_name": "sel_netport_hashfn",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/selinux/netport.c",
    "lines": "79-82",
    "snippet": "static unsigned int sel_netport_hashfn(u16 pnum)\n{\n\treturn (pnum & (SEL_NETPORT_HASH_SIZE - 1));\n}",
    "includes": [
      "#include \"objsec.h\"",
      "#include \"netport.h\"",
      "#include <net/ipv6.h>",
      "#include <net/ip.h>",
      "#include <linux/ipv6.h>",
      "#include <linux/ip.h>",
      "#include <linux/in6.h>",
      "#include <linux/in.h>",
      "#include <linux/spinlock.h>",
      "#include <linux/slab.h>",
      "#include <linux/list.h>",
      "#include <linux/rcupdate.h>",
      "#include <linux/types.h>"
    ],
    "macros_used": [
      "#define SEL_NETPORT_HASH_SIZE       256"
    ],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"objsec.h\"\n#include \"netport.h\"\n#include <net/ipv6.h>\n#include <net/ip.h>\n#include <linux/ipv6.h>\n#include <linux/ip.h>\n#include <linux/in6.h>\n#include <linux/in.h>\n#include <linux/spinlock.h>\n#include <linux/slab.h>\n#include <linux/list.h>\n#include <linux/rcupdate.h>\n#include <linux/types.h>\n\n#define SEL_NETPORT_HASH_SIZE       256\n\nstatic unsigned int sel_netport_hashfn(u16 pnum)\n{\n\treturn (pnum & (SEL_NETPORT_HASH_SIZE - 1));\n}"
  }
]