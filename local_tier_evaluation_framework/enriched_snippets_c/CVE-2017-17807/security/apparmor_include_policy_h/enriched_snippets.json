[
  {
    "function_name": "AUDIT_MODE",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/include/policy.h",
    "lines": "283-289",
    "snippet": "static inline int AUDIT_MODE(struct aa_profile *profile)\n{\n\tif (aa_g_audit != AUDIT_NORMAL)\n\t\treturn aa_g_audit;\n\n\treturn profile->audit;\n}",
    "includes": [
      "#include \"resource.h\"",
      "#include \"perms.h\"",
      "#include \"label.h\"",
      "#include \"lib.h\"",
      "#include \"file.h\"",
      "#include \"domain.h\"",
      "#include \"capability.h\"",
      "#include \"audit.h\"",
      "#include \"apparmor.h\"",
      "#include <linux/socket.h>",
      "#include <linux/slab.h>",
      "#include <linux/sched.h>",
      "#include <linux/rhashtable.h>",
      "#include <linux/kref.h>",
      "#include <linux/cred.h>",
      "#include <linux/capability.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"resource.h\"\n#include \"perms.h\"\n#include \"label.h\"\n#include \"lib.h\"\n#include \"file.h\"\n#include \"domain.h\"\n#include \"capability.h\"\n#include \"audit.h\"\n#include \"apparmor.h\"\n#include <linux/socket.h>\n#include <linux/slab.h>\n#include <linux/sched.h>\n#include <linux/rhashtable.h>\n#include <linux/kref.h>\n#include <linux/cred.h>\n#include <linux/capability.h>\n\nstatic inline int AUDIT_MODE(struct aa_profile *profile)\n{\n\tif (aa_g_audit != AUDIT_NORMAL)\n\t\treturn aa_g_audit;\n\n\treturn profile->audit;\n}"
  },
  {
    "function_name": "aa_put_profile",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/include/policy.h",
    "lines": "277-281",
    "snippet": "static inline void aa_put_profile(struct aa_profile *p)\n{\n\tif (p)\n\t\tkref_put(&p->label.count, aa_label_kref);\n}",
    "includes": [
      "#include \"resource.h\"",
      "#include \"perms.h\"",
      "#include \"label.h\"",
      "#include \"lib.h\"",
      "#include \"file.h\"",
      "#include \"domain.h\"",
      "#include \"capability.h\"",
      "#include \"audit.h\"",
      "#include \"apparmor.h\"",
      "#include <linux/socket.h>",
      "#include <linux/slab.h>",
      "#include <linux/sched.h>",
      "#include <linux/rhashtable.h>",
      "#include <linux/kref.h>",
      "#include <linux/cred.h>",
      "#include <linux/capability.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "kref_put",
          "args": [
            "&p->label.count",
            "aa_label_kref"
          ],
          "line": 280
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"resource.h\"\n#include \"perms.h\"\n#include \"label.h\"\n#include \"lib.h\"\n#include \"file.h\"\n#include \"domain.h\"\n#include \"capability.h\"\n#include \"audit.h\"\n#include \"apparmor.h\"\n#include <linux/socket.h>\n#include <linux/slab.h>\n#include <linux/sched.h>\n#include <linux/rhashtable.h>\n#include <linux/kref.h>\n#include <linux/cred.h>\n#include <linux/capability.h>\n\nstatic inline void aa_put_profile(struct aa_profile *p)\n{\n\tif (p)\n\t\tkref_put(&p->label.count, aa_label_kref);\n}"
  },
  {
    "function_name": "aa_get_profile_rcu",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/include/policy.h",
    "lines": "260-271",
    "snippet": "static inline struct aa_profile *aa_get_profile_rcu(struct aa_profile __rcu **p)\n{\n\tstruct aa_profile *c;\n\n\trcu_read_lock();\n\tdo {\n\t\tc = rcu_dereference(*p);\n\t} while (c && !kref_get_unless_zero(&c->label.count));\n\trcu_read_unlock();\n\n\treturn c;\n}",
    "includes": [
      "#include \"resource.h\"",
      "#include \"perms.h\"",
      "#include \"label.h\"",
      "#include \"lib.h\"",
      "#include \"file.h\"",
      "#include \"domain.h\"",
      "#include \"capability.h\"",
      "#include \"audit.h\"",
      "#include \"apparmor.h\"",
      "#include <linux/socket.h>",
      "#include <linux/slab.h>",
      "#include <linux/sched.h>",
      "#include <linux/rhashtable.h>",
      "#include <linux/kref.h>",
      "#include <linux/cred.h>",
      "#include <linux/capability.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "rcu_read_unlock",
          "args": [],
          "line": 268
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kref_get_unless_zero",
          "args": [
            "&c->label.count"
          ],
          "line": 267
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rcu_dereference",
          "args": [
            "*p"
          ],
          "line": 266
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rcu_read_lock",
          "args": [],
          "line": 264
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"resource.h\"\n#include \"perms.h\"\n#include \"label.h\"\n#include \"lib.h\"\n#include \"file.h\"\n#include \"domain.h\"\n#include \"capability.h\"\n#include \"audit.h\"\n#include \"apparmor.h\"\n#include <linux/socket.h>\n#include <linux/slab.h>\n#include <linux/sched.h>\n#include <linux/rhashtable.h>\n#include <linux/kref.h>\n#include <linux/cred.h>\n#include <linux/capability.h>\n\nstatic inline struct aa_profile *aa_get_profile_rcu(struct aa_profile __rcu **p)\n{\n\tstruct aa_profile *c;\n\n\trcu_read_lock();\n\tdo {\n\t\tc = rcu_dereference(*p);\n\t} while (c && !kref_get_unless_zero(&c->label.count));\n\trcu_read_unlock();\n\n\treturn c;\n}"
  },
  {
    "function_name": "aa_get_profile_not0",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/include/policy.h",
    "lines": "245-251",
    "snippet": "static inline struct aa_profile *aa_get_profile_not0(struct aa_profile *p)\n{\n\tif (p && kref_get_unless_zero(&p->label.count))\n\t\treturn p;\n\n\treturn NULL;\n}",
    "includes": [
      "#include \"resource.h\"",
      "#include \"perms.h\"",
      "#include \"label.h\"",
      "#include \"lib.h\"",
      "#include \"file.h\"",
      "#include \"domain.h\"",
      "#include \"capability.h\"",
      "#include \"audit.h\"",
      "#include \"apparmor.h\"",
      "#include <linux/socket.h>",
      "#include <linux/slab.h>",
      "#include <linux/sched.h>",
      "#include <linux/rhashtable.h>",
      "#include <linux/kref.h>",
      "#include <linux/cred.h>",
      "#include <linux/capability.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "kref_get_unless_zero",
          "args": [
            "&p->label.count"
          ],
          "line": 247
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"resource.h\"\n#include \"perms.h\"\n#include \"label.h\"\n#include \"lib.h\"\n#include \"file.h\"\n#include \"domain.h\"\n#include \"capability.h\"\n#include \"audit.h\"\n#include \"apparmor.h\"\n#include <linux/socket.h>\n#include <linux/slab.h>\n#include <linux/sched.h>\n#include <linux/rhashtable.h>\n#include <linux/kref.h>\n#include <linux/cred.h>\n#include <linux/capability.h>\n\nstatic inline struct aa_profile *aa_get_profile_not0(struct aa_profile *p)\n{\n\tif (p && kref_get_unless_zero(&p->label.count))\n\t\treturn p;\n\n\treturn NULL;\n}"
  },
  {
    "function_name": "aa_get_profile",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/include/policy.h",
    "lines": "230-236",
    "snippet": "static inline struct aa_profile *aa_get_profile(struct aa_profile *p)\n{\n\tif (p)\n\t\tkref_get(&(p->label.count));\n\n\treturn p;\n}",
    "includes": [
      "#include \"resource.h\"",
      "#include \"perms.h\"",
      "#include \"label.h\"",
      "#include \"lib.h\"",
      "#include \"file.h\"",
      "#include \"domain.h\"",
      "#include \"capability.h\"",
      "#include \"audit.h\"",
      "#include \"apparmor.h\"",
      "#include <linux/socket.h>",
      "#include <linux/slab.h>",
      "#include <linux/sched.h>",
      "#include <linux/rhashtable.h>",
      "#include <linux/kref.h>",
      "#include <linux/cred.h>",
      "#include <linux/capability.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "kref_get",
          "args": [
            "&(p->label.count)"
          ],
          "line": 233
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"resource.h\"\n#include \"perms.h\"\n#include \"label.h\"\n#include \"lib.h\"\n#include \"file.h\"\n#include \"domain.h\"\n#include \"capability.h\"\n#include \"audit.h\"\n#include \"apparmor.h\"\n#include <linux/socket.h>\n#include <linux/slab.h>\n#include <linux/sched.h>\n#include <linux/rhashtable.h>\n#include <linux/kref.h>\n#include <linux/cred.h>\n#include <linux/capability.h>\n\nstatic inline struct aa_profile *aa_get_profile(struct aa_profile *p)\n{\n\tif (p)\n\t\tkref_get(&(p->label.count));\n\n\treturn p;\n}"
  },
  {
    "function_name": "PROFILE_MEDIATES_SAFE",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/include/policy.h",
    "lines": "214-221",
    "snippet": "static inline unsigned int PROFILE_MEDIATES_SAFE(struct aa_profile *profile,\n\t\t\t\t\t\t unsigned char class)\n{\n\tif (profile->policy.dfa)\n\t\treturn aa_dfa_match_len(profile->policy.dfa,\n\t\t\t\t\tprofile->policy.start[0], &class, 1);\n\treturn 0;\n}",
    "includes": [
      "#include \"resource.h\"",
      "#include \"perms.h\"",
      "#include \"label.h\"",
      "#include \"lib.h\"",
      "#include \"file.h\"",
      "#include \"domain.h\"",
      "#include \"capability.h\"",
      "#include \"audit.h\"",
      "#include \"apparmor.h\"",
      "#include <linux/socket.h>",
      "#include <linux/slab.h>",
      "#include <linux/sched.h>",
      "#include <linux/rhashtable.h>",
      "#include <linux/kref.h>",
      "#include <linux/cred.h>",
      "#include <linux/capability.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "aa_dfa_match_len",
          "args": [
            "profile->policy.dfa",
            "profile->policy.start[0]",
            "&class",
            "1"
          ],
          "line": 218
        },
        "resolved": true,
        "details": {
          "function_name": "aa_dfa_match_len",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/match.c",
          "lines": "331-367",
          "snippet": "unsigned int aa_dfa_match_len(struct aa_dfa *dfa, unsigned int start,\n\t\t\t      const char *str, int len)\n{\n\tu16 *def = DEFAULT_TABLE(dfa);\n\tu32 *base = BASE_TABLE(dfa);\n\tu16 *next = NEXT_TABLE(dfa);\n\tu16 *check = CHECK_TABLE(dfa);\n\tunsigned int state = start, pos;\n\n\tif (state == 0)\n\t\treturn 0;\n\n\t/* current state is <state>, matching character *str */\n\tif (dfa->tables[YYTD_ID_EC]) {\n\t\t/* Equivalence class table defined */\n\t\tu8 *equiv = EQUIV_TABLE(dfa);\n\t\t/* default is direct to next state */\n\t\tfor (; len; len--) {\n\t\t\tpos = base_idx(base[state]) + equiv[(u8) *str++];\n\t\t\tif (check[pos] == state)\n\t\t\t\tstate = next[pos];\n\t\t\telse\n\t\t\t\tstate = def[state];\n\t\t}\n\t} else {\n\t\t/* default is direct to next state */\n\t\tfor (; len; len--) {\n\t\t\tpos = base_idx(base[state]) + (u8) *str++;\n\t\t\tif (check[pos] == state)\n\t\t\t\tstate = next[pos];\n\t\t\telse\n\t\t\t\tstate = def[state];\n\t\t}\n\t}\n\n\treturn state;\n}",
          "includes": [
            "#include \"include/match.h\"",
            "#include \"include/lib.h\"",
            "#include <linux/kref.h>",
            "#include <linux/err.h>",
            "#include <linux/vmalloc.h>",
            "#include <linux/slab.h>",
            "#include <linux/mm.h>",
            "#include <linux/kernel.h>",
            "#include <linux/errno.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"include/match.h\"\n#include \"include/lib.h\"\n#include <linux/kref.h>\n#include <linux/err.h>\n#include <linux/vmalloc.h>\n#include <linux/slab.h>\n#include <linux/mm.h>\n#include <linux/kernel.h>\n#include <linux/errno.h>\n\nunsigned int aa_dfa_match_len(struct aa_dfa *dfa, unsigned int start,\n\t\t\t      const char *str, int len)\n{\n\tu16 *def = DEFAULT_TABLE(dfa);\n\tu32 *base = BASE_TABLE(dfa);\n\tu16 *next = NEXT_TABLE(dfa);\n\tu16 *check = CHECK_TABLE(dfa);\n\tunsigned int state = start, pos;\n\n\tif (state == 0)\n\t\treturn 0;\n\n\t/* current state is <state>, matching character *str */\n\tif (dfa->tables[YYTD_ID_EC]) {\n\t\t/* Equivalence class table defined */\n\t\tu8 *equiv = EQUIV_TABLE(dfa);\n\t\t/* default is direct to next state */\n\t\tfor (; len; len--) {\n\t\t\tpos = base_idx(base[state]) + equiv[(u8) *str++];\n\t\t\tif (check[pos] == state)\n\t\t\t\tstate = next[pos];\n\t\t\telse\n\t\t\t\tstate = def[state];\n\t\t}\n\t} else {\n\t\t/* default is direct to next state */\n\t\tfor (; len; len--) {\n\t\t\tpos = base_idx(base[state]) + (u8) *str++;\n\t\t\tif (check[pos] == state)\n\t\t\t\tstate = next[pos];\n\t\t\telse\n\t\t\t\tstate = def[state];\n\t\t}\n\t}\n\n\treturn state;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"resource.h\"\n#include \"perms.h\"\n#include \"label.h\"\n#include \"lib.h\"\n#include \"file.h\"\n#include \"domain.h\"\n#include \"capability.h\"\n#include \"audit.h\"\n#include \"apparmor.h\"\n#include <linux/socket.h>\n#include <linux/slab.h>\n#include <linux/sched.h>\n#include <linux/rhashtable.h>\n#include <linux/kref.h>\n#include <linux/cred.h>\n#include <linux/capability.h>\n\nstatic inline unsigned int PROFILE_MEDIATES_SAFE(struct aa_profile *profile,\n\t\t\t\t\t\t unsigned char class)\n{\n\tif (profile->policy.dfa)\n\t\treturn aa_dfa_match_len(profile->policy.dfa,\n\t\t\t\t\tprofile->policy.start[0], &class, 1);\n\treturn 0;\n}"
  },
  {
    "function_name": "aa_get_newest_profile",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/include/policy.h",
    "lines": "207-210",
    "snippet": "static inline struct aa_profile *aa_get_newest_profile(struct aa_profile *p)\n{\n\treturn labels_profile(aa_get_newest_label(&p->label));\n}",
    "includes": [
      "#include \"resource.h\"",
      "#include \"perms.h\"",
      "#include \"label.h\"",
      "#include \"lib.h\"",
      "#include \"file.h\"",
      "#include \"domain.h\"",
      "#include \"capability.h\"",
      "#include \"audit.h\"",
      "#include \"apparmor.h\"",
      "#include <linux/socket.h>",
      "#include <linux/slab.h>",
      "#include <linux/sched.h>",
      "#include <linux/rhashtable.h>",
      "#include <linux/kref.h>",
      "#include <linux/cred.h>",
      "#include <linux/capability.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "labels_profile",
          "args": [
            "aa_get_newest_label(&p->label)"
          ],
          "line": 209
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "aa_get_newest_label",
          "args": [
            "&p->label"
          ],
          "line": 209
        },
        "resolved": true,
        "details": {
          "function_name": "aa_get_newest_label",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/include/label.h",
          "lines": "393-414",
          "snippet": "static inline struct aa_label *aa_get_newest_label(struct aa_label *l)\n{\n\tif (!l)\n\t\treturn NULL;\n\n\tif (label_is_stale(l)) {\n\t\tstruct aa_label *tmp;\n\n\t\tAA_BUG(!l->proxy);\n\t\tAA_BUG(!l->proxy->label);\n\t\t/* BUG: only way this can happen is @l ref count and its\n\t\t * replacement count have gone to 0 and are on their way\n\t\t * to destruction. ie. we have a refcounting error\n\t\t */\n\t\ttmp = aa_get_label_rcu(&l->proxy->label);\n\t\tAA_BUG(!tmp);\n\n\t\treturn tmp;\n\t}\n\n\treturn aa_get_label(l);\n}",
          "includes": [
            "#include \"lib.h\"",
            "#include \"apparmor.h\"",
            "#include <linux/rcupdate.h>",
            "#include <linux/rbtree.h>",
            "#include <linux/audit.h>",
            "#include <linux/atomic.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"lib.h\"\n#include \"apparmor.h\"\n#include <linux/rcupdate.h>\n#include <linux/rbtree.h>\n#include <linux/audit.h>\n#include <linux/atomic.h>\n\nstatic inline struct aa_label *aa_get_newest_label(struct aa_label *l)\n{\n\tif (!l)\n\t\treturn NULL;\n\n\tif (label_is_stale(l)) {\n\t\tstruct aa_label *tmp;\n\n\t\tAA_BUG(!l->proxy);\n\t\tAA_BUG(!l->proxy->label);\n\t\t/* BUG: only way this can happen is @l ref count and its\n\t\t * replacement count have gone to 0 and are on their way\n\t\t * to destruction. ie. we have a refcounting error\n\t\t */\n\t\ttmp = aa_get_label_rcu(&l->proxy->label);\n\t\tAA_BUG(!tmp);\n\n\t\treturn tmp;\n\t}\n\n\treturn aa_get_label(l);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"resource.h\"\n#include \"perms.h\"\n#include \"label.h\"\n#include \"lib.h\"\n#include \"file.h\"\n#include \"domain.h\"\n#include \"capability.h\"\n#include \"audit.h\"\n#include \"apparmor.h\"\n#include <linux/socket.h>\n#include <linux/slab.h>\n#include <linux/sched.h>\n#include <linux/rhashtable.h>\n#include <linux/kref.h>\n#include <linux/cred.h>\n#include <linux/capability.h>\n\nstatic inline struct aa_profile *aa_get_newest_profile(struct aa_profile *p)\n{\n\treturn labels_profile(aa_get_newest_label(&p->label));\n}"
  }
]