[
  {
    "function_name": "key_check",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/keys/internal.h",
    "lines": "307-311",
    "snippet": "static inline void key_check(const struct key *key)\n{\n\tif (key && (IS_ERR(key) || key->magic != KEY_DEBUG_MAGIC))\n\t\t__key_check(key);\n}",
    "includes": [
      "#include <linux/compat.h>",
      "#include <linux/refcount.h>",
      "#include <linux/keyctl.h>",
      "#include <linux/task_work.h>",
      "#include <linux/key-type.h>",
      "#include <linux/cred.h>",
      "#include <linux/wait_bit.h>",
      "#include <linux/sched.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "__key_check",
          "args": [
            "key"
          ],
          "line": 310
        },
        "resolved": true,
        "details": {
          "function_name": "__key_check",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/keys/key.c",
          "lines": "42-47",
          "snippet": "void __key_check(const struct key *key)\n{\n\tprintk(\"__key_check: key %p {%08x} should be {%08x}\\n\",\n\t       key, key->magic, KEY_DEBUG_MAGIC);\n\tBUG();\n}",
          "includes": [
            "#include \"internal.h\"",
            "#include <linux/err.h>",
            "#include <linux/random.h>",
            "#include <linux/workqueue.h>",
            "#include <linux/security.h>",
            "#include <linux/slab.h>",
            "#include <linux/sched.h>",
            "#include <linux/poison.h>",
            "#include <linux/init.h>",
            "#include <linux/module.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"internal.h\"\n#include <linux/err.h>\n#include <linux/random.h>\n#include <linux/workqueue.h>\n#include <linux/security.h>\n#include <linux/slab.h>\n#include <linux/sched.h>\n#include <linux/poison.h>\n#include <linux/init.h>\n#include <linux/module.h>\n\nvoid __key_check(const struct key *key)\n{\n\tprintk(\"__key_check: key %p {%08x} should be {%08x}\\n\",\n\t       key, key->magic, KEY_DEBUG_MAGIC);\n\tBUG();\n}"
        }
      },
      {
        "call_info": {
          "callee": "IS_ERR",
          "args": [
            "key"
          ],
          "line": 309
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <linux/compat.h>\n#include <linux/refcount.h>\n#include <linux/keyctl.h>\n#include <linux/task_work.h>\n#include <linux/key-type.h>\n#include <linux/cred.h>\n#include <linux/wait_bit.h>\n#include <linux/sched.h>\n\nstatic inline void key_check(const struct key *key)\n{\n\tif (key && (IS_ERR(key) || key->magic != KEY_DEBUG_MAGIC))\n\t\t__key_check(key);\n}"
  },
  {
    "function_name": "compat_keyctl_dh_compute",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/keys/internal.h",
    "lines": "291-297",
    "snippet": "static inline long compat_keyctl_dh_compute(\n\t\t\t\tstruct keyctl_dh_params __user *params,\n\t\t\t\tchar __user *buffer, size_t buflen,\n\t\t\t\tstruct keyctl_kdf_params __user *kdf)\n{\n\treturn -EOPNOTSUPP;\n}",
    "includes": [
      "#include <linux/compat.h>",
      "#include <linux/refcount.h>",
      "#include <linux/keyctl.h>",
      "#include <linux/task_work.h>",
      "#include <linux/key-type.h>",
      "#include <linux/cred.h>",
      "#include <linux/wait_bit.h>",
      "#include <linux/sched.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include <linux/compat.h>\n#include <linux/refcount.h>\n#include <linux/keyctl.h>\n#include <linux/task_work.h>\n#include <linux/key-type.h>\n#include <linux/cred.h>\n#include <linux/wait_bit.h>\n#include <linux/sched.h>\n\nstatic inline long compat_keyctl_dh_compute(\n\t\t\t\tstruct keyctl_dh_params __user *params,\n\t\t\t\tchar __user *buffer, size_t buflen,\n\t\t\t\tstruct keyctl_kdf_params __user *kdf)\n{\n\treturn -EOPNOTSUPP;\n}"
  },
  {
    "function_name": "keyctl_dh_compute",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/keys/internal.h",
    "lines": "283-288",
    "snippet": "static inline long keyctl_dh_compute(struct keyctl_dh_params __user *params,\n\t\t\t\t     char __user *buffer, size_t buflen,\n\t\t\t\t     struct keyctl_kdf_params __user *kdf)\n{\n\treturn -EOPNOTSUPP;\n}",
    "includes": [
      "#include <linux/compat.h>",
      "#include <linux/refcount.h>",
      "#include <linux/keyctl.h>",
      "#include <linux/task_work.h>",
      "#include <linux/key-type.h>",
      "#include <linux/cred.h>",
      "#include <linux/wait_bit.h>",
      "#include <linux/sched.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include <linux/compat.h>\n#include <linux/refcount.h>\n#include <linux/keyctl.h>\n#include <linux/task_work.h>\n#include <linux/key-type.h>\n#include <linux/cred.h>\n#include <linux/wait_bit.h>\n#include <linux/sched.h>\n\nstatic inline long keyctl_dh_compute(struct keyctl_dh_params __user *params,\n\t\t\t\t     char __user *buffer, size_t buflen,\n\t\t\t\t     struct keyctl_kdf_params __user *kdf)\n{\n\treturn -EOPNOTSUPP;\n}"
  },
  {
    "function_name": "keyctl_get_persistent",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/keys/internal.h",
    "lines": "264-267",
    "snippet": "static inline long keyctl_get_persistent(uid_t uid, key_serial_t destring)\n{\n\treturn -EOPNOTSUPP;\n}",
    "includes": [
      "#include <linux/compat.h>",
      "#include <linux/refcount.h>",
      "#include <linux/keyctl.h>",
      "#include <linux/task_work.h>",
      "#include <linux/key-type.h>",
      "#include <linux/cred.h>",
      "#include <linux/wait_bit.h>",
      "#include <linux/sched.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include <linux/compat.h>\n#include <linux/refcount.h>\n#include <linux/keyctl.h>\n#include <linux/task_work.h>\n#include <linux/key-type.h>\n#include <linux/cred.h>\n#include <linux/wait_bit.h>\n#include <linux/sched.h>\n\nstatic inline long keyctl_get_persistent(uid_t uid, key_serial_t destring)\n{\n\treturn -EOPNOTSUPP;\n}"
  },
  {
    "function_name": "key_is_dead",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/keys/internal.h",
    "lines": "214-220",
    "snippet": "static inline bool key_is_dead(const struct key *key, time64_t limit)\n{\n\treturn\n\t\tkey->flags & ((1 << KEY_FLAG_DEAD) |\n\t\t\t      (1 << KEY_FLAG_INVALIDATED)) ||\n\t\t(key->expiry > 0 && key->expiry <= limit);\n}",
    "includes": [
      "#include <linux/compat.h>",
      "#include <linux/refcount.h>",
      "#include <linux/keyctl.h>",
      "#include <linux/task_work.h>",
      "#include <linux/key-type.h>",
      "#include <linux/cred.h>",
      "#include <linux/wait_bit.h>",
      "#include <linux/sched.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include <linux/compat.h>\n#include <linux/refcount.h>\n#include <linux/keyctl.h>\n#include <linux/task_work.h>\n#include <linux/key-type.h>\n#include <linux/cred.h>\n#include <linux/wait_bit.h>\n#include <linux/sched.h>\n\nstatic inline bool key_is_dead(const struct key *key, time64_t limit)\n{\n\treturn\n\t\tkey->flags & ((1 << KEY_FLAG_DEAD) |\n\t\t\t      (1 << KEY_FLAG_INVALIDATED)) ||\n\t\t(key->expiry > 0 && key->expiry <= limit);\n}"
  },
  {
    "function_name": "key_permission",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/keys/internal.h",
    "lines": "186-189",
    "snippet": "static inline int key_permission(const key_ref_t key_ref, unsigned perm)\n{\n\treturn key_task_permission(key_ref, current_cred(), perm);\n}",
    "includes": [
      "#include <linux/compat.h>",
      "#include <linux/refcount.h>",
      "#include <linux/keyctl.h>",
      "#include <linux/task_work.h>",
      "#include <linux/key-type.h>",
      "#include <linux/cred.h>",
      "#include <linux/wait_bit.h>",
      "#include <linux/sched.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "key_task_permission",
          "args": [
            "key_ref",
            "current_cred()",
            "perm"
          ],
          "line": 188
        },
        "resolved": true,
        "details": {
          "function_name": "key_task_permission",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/keys/permission.c",
          "lines": "30-78",
          "snippet": "int key_task_permission(const key_ref_t key_ref, const struct cred *cred,\n\t\t\tunsigned perm)\n{\n\tstruct key *key;\n\tkey_perm_t kperm;\n\tint ret;\n\n\tkey = key_ref_to_ptr(key_ref);\n\n\t/* use the second 8-bits of permissions for keys the caller owns */\n\tif (uid_eq(key->uid, cred->fsuid)) {\n\t\tkperm = key->perm >> 16;\n\t\tgoto use_these_perms;\n\t}\n\n\t/* use the third 8-bits of permissions for keys the caller has a group\n\t * membership in common with */\n\tif (gid_valid(key->gid) && key->perm & KEY_GRP_ALL) {\n\t\tif (gid_eq(key->gid, cred->fsgid)) {\n\t\t\tkperm = key->perm >> 8;\n\t\t\tgoto use_these_perms;\n\t\t}\n\n\t\tret = groups_search(cred->group_info, key->gid);\n\t\tif (ret) {\n\t\t\tkperm = key->perm >> 8;\n\t\t\tgoto use_these_perms;\n\t\t}\n\t}\n\n\t/* otherwise use the least-significant 8-bits */\n\tkperm = key->perm;\n\nuse_these_perms:\n\n\t/* use the top 8-bits of permissions for keys the caller possesses\n\t * - possessor permissions are additive with other permissions\n\t */\n\tif (is_key_possessed(key_ref))\n\t\tkperm |= key->perm >> 24;\n\n\tkperm = kperm & perm & KEY_NEED_ALL;\n\n\tif (kperm != perm)\n\t\treturn -EACCES;\n\n\t/* let LSM be the final arbiter */\n\treturn security_key_permission(key_ref, cred, perm);\n}",
          "includes": [
            "#include \"internal.h\"",
            "#include <linux/security.h>",
            "#include <linux/module.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"internal.h\"\n#include <linux/security.h>\n#include <linux/module.h>\n\nint key_task_permission(const key_ref_t key_ref, const struct cred *cred,\n\t\t\tunsigned perm)\n{\n\tstruct key *key;\n\tkey_perm_t kperm;\n\tint ret;\n\n\tkey = key_ref_to_ptr(key_ref);\n\n\t/* use the second 8-bits of permissions for keys the caller owns */\n\tif (uid_eq(key->uid, cred->fsuid)) {\n\t\tkperm = key->perm >> 16;\n\t\tgoto use_these_perms;\n\t}\n\n\t/* use the third 8-bits of permissions for keys the caller has a group\n\t * membership in common with */\n\tif (gid_valid(key->gid) && key->perm & KEY_GRP_ALL) {\n\t\tif (gid_eq(key->gid, cred->fsgid)) {\n\t\t\tkperm = key->perm >> 8;\n\t\t\tgoto use_these_perms;\n\t\t}\n\n\t\tret = groups_search(cred->group_info, key->gid);\n\t\tif (ret) {\n\t\t\tkperm = key->perm >> 8;\n\t\t\tgoto use_these_perms;\n\t\t}\n\t}\n\n\t/* otherwise use the least-significant 8-bits */\n\tkperm = key->perm;\n\nuse_these_perms:\n\n\t/* use the top 8-bits of permissions for keys the caller possesses\n\t * - possessor permissions are additive with other permissions\n\t */\n\tif (is_key_possessed(key_ref))\n\t\tkperm |= key->perm >> 24;\n\n\tkperm = kperm & perm & KEY_NEED_ALL;\n\n\tif (kperm != perm)\n\t\treturn -EACCES;\n\n\t/* let LSM be the final arbiter */\n\treturn security_key_permission(key_ref, cred, perm);\n}"
        }
      },
      {
        "call_info": {
          "callee": "current_cred",
          "args": [],
          "line": 188
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <linux/compat.h>\n#include <linux/refcount.h>\n#include <linux/keyctl.h>\n#include <linux/task_work.h>\n#include <linux/key-type.h>\n#include <linux/cred.h>\n#include <linux/wait_bit.h>\n#include <linux/sched.h>\n\nstatic inline int key_permission(const key_ref_t key_ref, unsigned perm)\n{\n\treturn key_task_permission(key_ref, current_cred(), perm);\n}"
  }
]