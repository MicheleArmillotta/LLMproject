[
  {
    "function_name": "request_trusted_key",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/keys/encrypted-keys/masterkey_trusted.c",
    "lines": "31-47",
    "snippet": "struct key *request_trusted_key(const char *trusted_desc,\n\t\t\t\tconst u8 **master_key, size_t *master_keylen)\n{\n\tstruct trusted_key_payload *tpayload;\n\tstruct key *tkey;\n\n\ttkey = request_key(&key_type_trusted, trusted_desc, NULL);\n\tif (IS_ERR(tkey))\n\t\tgoto error;\n\n\tdown_read(&tkey->sem);\n\ttpayload = tkey->payload.data[0];\n\t*master_key = tpayload->key;\n\t*master_keylen = tpayload->key_len;\nerror:\n\treturn tkey;\n}",
    "includes": [
      "#include \"encrypted.h\"",
      "#include <keys/encrypted-type.h>",
      "#include <keys/trusted-type.h>",
      "#include <linux/err.h>",
      "#include <linux/module.h>",
      "#include <linux/uaccess.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "down_read",
          "args": [
            "&tkey->sem"
          ],
          "line": 41
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "IS_ERR",
          "args": [
            "tkey"
          ],
          "line": 38
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "request_key",
          "args": [
            "&key_type_trusted",
            "trusted_desc",
            "NULL"
          ],
          "line": 37
        },
        "resolved": true,
        "details": {
          "function_name": "request_key_auth_read",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/keys/request_key_auth.c",
          "lines": "84-104",
          "snippet": "static long request_key_auth_read(const struct key *key,\n\t\t\t\t  char __user *buffer, size_t buflen)\n{\n\tstruct request_key_auth *rka = key->payload.data[0];\n\tsize_t datalen;\n\tlong ret;\n\n\tdatalen = rka->callout_len;\n\tret = datalen;\n\n\t/* we can return the data as is */\n\tif (buffer && buflen > 0) {\n\t\tif (buflen > datalen)\n\t\t\tbuflen = datalen;\n\n\t\tif (copy_to_user(buffer, rka->callout_info, buflen) != 0)\n\t\t\tret = -EFAULT;\n\t}\n\n\treturn ret;\n}",
          "includes": [
            "#include <keys/user-type.h>",
            "#include \"internal.h\"",
            "#include <linux/uaccess.h>",
            "#include <linux/slab.h>",
            "#include <linux/seq_file.h>",
            "#include <linux/err.h>",
            "#include <linux/sched.h>",
            "#include <linux/module.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void request_key_auth_revoke(struct key *);",
            "static void request_key_auth_destroy(struct key *);",
            "static long request_key_auth_read(const struct key *, char __user *, size_t);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <keys/user-type.h>\n#include \"internal.h\"\n#include <linux/uaccess.h>\n#include <linux/slab.h>\n#include <linux/seq_file.h>\n#include <linux/err.h>\n#include <linux/sched.h>\n#include <linux/module.h>\n\nstatic void request_key_auth_revoke(struct key *);\nstatic void request_key_auth_destroy(struct key *);\nstatic long request_key_auth_read(const struct key *, char __user *, size_t);\n\nstatic long request_key_auth_read(const struct key *key,\n\t\t\t\t  char __user *buffer, size_t buflen)\n{\n\tstruct request_key_auth *rka = key->payload.data[0];\n\tsize_t datalen;\n\tlong ret;\n\n\tdatalen = rka->callout_len;\n\tret = datalen;\n\n\t/* we can return the data as is */\n\tif (buffer && buflen > 0) {\n\t\tif (buflen > datalen)\n\t\t\tbuflen = datalen;\n\n\t\tif (copy_to_user(buffer, rka->callout_info, buflen) != 0)\n\t\t\tret = -EFAULT;\n\t}\n\n\treturn ret;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"encrypted.h\"\n#include <keys/encrypted-type.h>\n#include <keys/trusted-type.h>\n#include <linux/err.h>\n#include <linux/module.h>\n#include <linux/uaccess.h>\n\nstruct key *request_trusted_key(const char *trusted_desc,\n\t\t\t\tconst u8 **master_key, size_t *master_keylen)\n{\n\tstruct trusted_key_payload *tpayload;\n\tstruct key *tkey;\n\n\ttkey = request_key(&key_type_trusted, trusted_desc, NULL);\n\tif (IS_ERR(tkey))\n\t\tgoto error;\n\n\tdown_read(&tkey->sem);\n\ttpayload = tkey->payload.data[0];\n\t*master_key = tpayload->key;\n\t*master_keylen = tpayload->key_len;\nerror:\n\treturn tkey;\n}"
  }
]