[
  {
    "function_name": "aa_free_root_ns",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/policy_ns.c",
    "lines": "406-414",
    "snippet": "void __init aa_free_root_ns(void)\n{\n\t struct aa_ns *ns = root_ns;\n\n\t root_ns = NULL;\n\n\t destroy_ns(ns);\n\t aa_put_ns(ns);\n}",
    "includes": [
      "#include \"include/policy.h\"",
      "#include \"include/label.h\"",
      "#include \"include/policy_ns.h\"",
      "#include \"include/context.h\"",
      "#include \"include/apparmor.h\"",
      "#include <linux/string.h>",
      "#include <linux/slab.h>",
      "#include <linux/mutex.h>",
      "#include <linux/list.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "struct aa_ns *root_ns;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "aa_put_ns",
          "args": [
            "ns"
          ],
          "line": 413
        },
        "resolved": true,
        "details": {
          "function_name": "aa_put_ns",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/include/policy_ns.h",
          "lines": "130-134",
          "snippet": "static inline void aa_put_ns(struct aa_ns *ns)\n{\n\tif (ns)\n\t\taa_put_profile(ns->unconfined);\n}",
          "includes": [
            "#include \"policy.h\"",
            "#include \"label.h\"",
            "#include \"apparmorfs.h\"",
            "#include \"apparmor.h\"",
            "#include <linux/kref.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"policy.h\"\n#include \"label.h\"\n#include \"apparmorfs.h\"\n#include \"apparmor.h\"\n#include <linux/kref.h>\n\nstatic inline void aa_put_ns(struct aa_ns *ns)\n{\n\tif (ns)\n\t\taa_put_profile(ns->unconfined);\n}"
        }
      },
      {
        "call_info": {
          "callee": "destroy_ns",
          "args": [
            "ns"
          ],
          "line": 412
        },
        "resolved": true,
        "details": {
          "function_name": "destroy_ns",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/policy_ns.c",
          "lines": "334-356",
          "snippet": "static void destroy_ns(struct aa_ns *ns)\n{\n\tif (!ns)\n\t\treturn;\n\n\tmutex_lock_nested(&ns->lock, ns->level);\n\t/* release all profiles in this namespace */\n\t__aa_profile_list_release(&ns->base.profiles);\n\n\t/* release all sub namespaces */\n\t__ns_list_release(&ns->sub_ns);\n\n\tif (ns->parent) {\n\t\tunsigned long flags;\n\n\t\twrite_lock_irqsave(&ns->labels.lock, flags);\n\t\t__aa_proxy_redirect(ns_unconfined(ns),\n\t\t\t\t    ns_unconfined(ns->parent));\n\t\twrite_unlock_irqrestore(&ns->labels.lock, flags);\n\t}\n\t__aafs_ns_rmdir(ns);\n\tmutex_unlock(&ns->lock);\n}",
          "includes": [
            "#include \"include/policy.h\"",
            "#include \"include/label.h\"",
            "#include \"include/policy_ns.h\"",
            "#include \"include/context.h\"",
            "#include \"include/apparmor.h\"",
            "#include <linux/string.h>",
            "#include <linux/slab.h>",
            "#include <linux/mutex.h>",
            "#include <linux/list.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"include/policy.h\"\n#include \"include/label.h\"\n#include \"include/policy_ns.h\"\n#include \"include/context.h\"\n#include \"include/apparmor.h\"\n#include <linux/string.h>\n#include <linux/slab.h>\n#include <linux/mutex.h>\n#include <linux/list.h>\n\nstatic void destroy_ns(struct aa_ns *ns)\n{\n\tif (!ns)\n\t\treturn;\n\n\tmutex_lock_nested(&ns->lock, ns->level);\n\t/* release all profiles in this namespace */\n\t__aa_profile_list_release(&ns->base.profiles);\n\n\t/* release all sub namespaces */\n\t__ns_list_release(&ns->sub_ns);\n\n\tif (ns->parent) {\n\t\tunsigned long flags;\n\n\t\twrite_lock_irqsave(&ns->labels.lock, flags);\n\t\t__aa_proxy_redirect(ns_unconfined(ns),\n\t\t\t\t    ns_unconfined(ns->parent));\n\t\twrite_unlock_irqrestore(&ns->labels.lock, flags);\n\t}\n\t__aafs_ns_rmdir(ns);\n\tmutex_unlock(&ns->lock);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"include/policy.h\"\n#include \"include/label.h\"\n#include \"include/policy_ns.h\"\n#include \"include/context.h\"\n#include \"include/apparmor.h\"\n#include <linux/string.h>\n#include <linux/slab.h>\n#include <linux/mutex.h>\n#include <linux/list.h>\n\nstruct aa_ns *root_ns;\n\nvoid __init aa_free_root_ns(void)\n{\n\t struct aa_ns *ns = root_ns;\n\n\t root_ns = NULL;\n\n\t destroy_ns(ns);\n\t aa_put_ns(ns);\n}"
  },
  {
    "function_name": "aa_alloc_root_ns",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/policy_ns.c",
    "lines": "393-401",
    "snippet": "int __init aa_alloc_root_ns(void)\n{\n\t/* released by aa_free_root_ns - used as list ref*/\n\troot_ns = alloc_ns(NULL, \"root\");\n\tif (!root_ns)\n\t\treturn -ENOMEM;\n\n\treturn 0;\n}",
    "includes": [
      "#include \"include/policy.h\"",
      "#include \"include/label.h\"",
      "#include \"include/policy_ns.h\"",
      "#include \"include/context.h\"",
      "#include \"include/apparmor.h\"",
      "#include <linux/string.h>",
      "#include <linux/slab.h>",
      "#include <linux/mutex.h>",
      "#include <linux/list.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "struct aa_ns *root_ns;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "alloc_ns",
          "args": [
            "NULL",
            "\"root\""
          ],
          "line": 396
        },
        "resolved": true,
        "details": {
          "function_name": "alloc_ns",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/policy_ns.c",
          "lines": "91-132",
          "snippet": "static struct aa_ns *alloc_ns(const char *prefix, const char *name)\n{\n\tstruct aa_ns *ns;\n\n\tns = kzalloc(sizeof(*ns), GFP_KERNEL);\n\tAA_DEBUG(\"%s(%p)\\n\", __func__, ns);\n\tif (!ns)\n\t\treturn NULL;\n\tif (!aa_policy_init(&ns->base, prefix, name, GFP_KERNEL))\n\t\tgoto fail_ns;\n\n\tINIT_LIST_HEAD(&ns->sub_ns);\n\tINIT_LIST_HEAD(&ns->rawdata_list);\n\tmutex_init(&ns->lock);\n\tinit_waitqueue_head(&ns->wait);\n\n\t/* released by aa_free_ns() */\n\tns->unconfined = aa_alloc_profile(\"unconfined\", NULL, GFP_KERNEL);\n\tif (!ns->unconfined)\n\t\tgoto fail_unconfined;\n\n\tns->unconfined->label.flags |= FLAG_IX_ON_NAME_ERROR |\n\t\tFLAG_IMMUTIBLE | FLAG_NS_COUNT | FLAG_UNCONFINED;\n\tns->unconfined->mode = APPARMOR_UNCONFINED;\n\tns->unconfined->file.dfa = aa_get_dfa(nulldfa);\n\tns->unconfined->policy.dfa = aa_get_dfa(nulldfa);\n\n\t/* ns and ns->unconfined share ns->unconfined refcount */\n\tns->unconfined->ns = ns;\n\n\tatomic_set(&ns->uniq_null, 0);\n\n\taa_labelset_init(&ns->labels);\n\n\treturn ns;\n\nfail_unconfined:\n\tkzfree(ns->base.hname);\nfail_ns:\n\tkzfree(ns);\n\treturn NULL;\n}",
          "includes": [
            "#include \"include/policy.h\"",
            "#include \"include/label.h\"",
            "#include \"include/policy_ns.h\"",
            "#include \"include/context.h\"",
            "#include \"include/apparmor.h\"",
            "#include <linux/string.h>",
            "#include <linux/slab.h>",
            "#include <linux/mutex.h>",
            "#include <linux/list.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"include/policy.h\"\n#include \"include/label.h\"\n#include \"include/policy_ns.h\"\n#include \"include/context.h\"\n#include \"include/apparmor.h\"\n#include <linux/string.h>\n#include <linux/slab.h>\n#include <linux/mutex.h>\n#include <linux/list.h>\n\nstatic struct aa_ns *alloc_ns(const char *prefix, const char *name)\n{\n\tstruct aa_ns *ns;\n\n\tns = kzalloc(sizeof(*ns), GFP_KERNEL);\n\tAA_DEBUG(\"%s(%p)\\n\", __func__, ns);\n\tif (!ns)\n\t\treturn NULL;\n\tif (!aa_policy_init(&ns->base, prefix, name, GFP_KERNEL))\n\t\tgoto fail_ns;\n\n\tINIT_LIST_HEAD(&ns->sub_ns);\n\tINIT_LIST_HEAD(&ns->rawdata_list);\n\tmutex_init(&ns->lock);\n\tinit_waitqueue_head(&ns->wait);\n\n\t/* released by aa_free_ns() */\n\tns->unconfined = aa_alloc_profile(\"unconfined\", NULL, GFP_KERNEL);\n\tif (!ns->unconfined)\n\t\tgoto fail_unconfined;\n\n\tns->unconfined->label.flags |= FLAG_IX_ON_NAME_ERROR |\n\t\tFLAG_IMMUTIBLE | FLAG_NS_COUNT | FLAG_UNCONFINED;\n\tns->unconfined->mode = APPARMOR_UNCONFINED;\n\tns->unconfined->file.dfa = aa_get_dfa(nulldfa);\n\tns->unconfined->policy.dfa = aa_get_dfa(nulldfa);\n\n\t/* ns and ns->unconfined share ns->unconfined refcount */\n\tns->unconfined->ns = ns;\n\n\tatomic_set(&ns->uniq_null, 0);\n\n\taa_labelset_init(&ns->labels);\n\n\treturn ns;\n\nfail_unconfined:\n\tkzfree(ns->base.hname);\nfail_ns:\n\tkzfree(ns);\n\treturn NULL;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"include/policy.h\"\n#include \"include/label.h\"\n#include \"include/policy_ns.h\"\n#include \"include/context.h\"\n#include \"include/apparmor.h\"\n#include <linux/string.h>\n#include <linux/slab.h>\n#include <linux/mutex.h>\n#include <linux/list.h>\n\nstruct aa_ns *root_ns;\n\nint __init aa_alloc_root_ns(void)\n{\n\t/* released by aa_free_root_ns - used as list ref*/\n\troot_ns = alloc_ns(NULL, \"root\");\n\tif (!root_ns)\n\t\treturn -ENOMEM;\n\n\treturn 0;\n}"
  },
  {
    "function_name": "__ns_list_release",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/policy_ns.c",
    "lines": "378-385",
    "snippet": "static void __ns_list_release(struct list_head *head)\n{\n\tstruct aa_ns *ns, *tmp;\n\n\tlist_for_each_entry_safe(ns, tmp, head, base.list)\n\t\t__aa_remove_ns(ns);\n\n}",
    "includes": [
      "#include \"include/policy.h\"",
      "#include \"include/label.h\"",
      "#include \"include/policy_ns.h\"",
      "#include \"include/context.h\"",
      "#include \"include/apparmor.h\"",
      "#include <linux/string.h>",
      "#include <linux/slab.h>",
      "#include <linux/mutex.h>",
      "#include <linux/list.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void __ns_list_release(struct list_head *head);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "__aa_remove_ns",
          "args": [
            "ns"
          ],
          "line": 383
        },
        "resolved": true,
        "details": {
          "function_name": "__aa_remove_ns",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/policy_ns.c",
          "lines": "364-370",
          "snippet": "void __aa_remove_ns(struct aa_ns *ns)\n{\n\t/* remove ns from namespace list */\n\tlist_del_rcu(&ns->base.list);\n\tdestroy_ns(ns);\n\taa_put_ns(ns);\n}",
          "includes": [
            "#include \"include/policy.h\"",
            "#include \"include/label.h\"",
            "#include \"include/policy_ns.h\"",
            "#include \"include/context.h\"",
            "#include \"include/apparmor.h\"",
            "#include <linux/string.h>",
            "#include <linux/slab.h>",
            "#include <linux/mutex.h>",
            "#include <linux/list.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"include/policy.h\"\n#include \"include/label.h\"\n#include \"include/policy_ns.h\"\n#include \"include/context.h\"\n#include \"include/apparmor.h\"\n#include <linux/string.h>\n#include <linux/slab.h>\n#include <linux/mutex.h>\n#include <linux/list.h>\n\nvoid __aa_remove_ns(struct aa_ns *ns)\n{\n\t/* remove ns from namespace list */\n\tlist_del_rcu(&ns->base.list);\n\tdestroy_ns(ns);\n\taa_put_ns(ns);\n}"
        }
      },
      {
        "call_info": {
          "callee": "list_for_each_entry_safe",
          "args": [
            "ns",
            "tmp",
            "head",
            "base.list"
          ],
          "line": 382
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"include/policy.h\"\n#include \"include/label.h\"\n#include \"include/policy_ns.h\"\n#include \"include/context.h\"\n#include \"include/apparmor.h\"\n#include <linux/string.h>\n#include <linux/slab.h>\n#include <linux/mutex.h>\n#include <linux/list.h>\n\nstatic void __ns_list_release(struct list_head *head);\n\nstatic void __ns_list_release(struct list_head *head)\n{\n\tstruct aa_ns *ns, *tmp;\n\n\tlist_for_each_entry_safe(ns, tmp, head, base.list)\n\t\t__aa_remove_ns(ns);\n\n}"
  },
  {
    "function_name": "__aa_remove_ns",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/policy_ns.c",
    "lines": "364-370",
    "snippet": "void __aa_remove_ns(struct aa_ns *ns)\n{\n\t/* remove ns from namespace list */\n\tlist_del_rcu(&ns->base.list);\n\tdestroy_ns(ns);\n\taa_put_ns(ns);\n}",
    "includes": [
      "#include \"include/policy.h\"",
      "#include \"include/label.h\"",
      "#include \"include/policy_ns.h\"",
      "#include \"include/context.h\"",
      "#include \"include/apparmor.h\"",
      "#include <linux/string.h>",
      "#include <linux/slab.h>",
      "#include <linux/mutex.h>",
      "#include <linux/list.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "aa_put_ns",
          "args": [
            "ns"
          ],
          "line": 369
        },
        "resolved": true,
        "details": {
          "function_name": "aa_put_ns",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/include/policy_ns.h",
          "lines": "130-134",
          "snippet": "static inline void aa_put_ns(struct aa_ns *ns)\n{\n\tif (ns)\n\t\taa_put_profile(ns->unconfined);\n}",
          "includes": [
            "#include \"policy.h\"",
            "#include \"label.h\"",
            "#include \"apparmorfs.h\"",
            "#include \"apparmor.h\"",
            "#include <linux/kref.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"policy.h\"\n#include \"label.h\"\n#include \"apparmorfs.h\"\n#include \"apparmor.h\"\n#include <linux/kref.h>\n\nstatic inline void aa_put_ns(struct aa_ns *ns)\n{\n\tif (ns)\n\t\taa_put_profile(ns->unconfined);\n}"
        }
      },
      {
        "call_info": {
          "callee": "destroy_ns",
          "args": [
            "ns"
          ],
          "line": 368
        },
        "resolved": true,
        "details": {
          "function_name": "destroy_ns",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/policy_ns.c",
          "lines": "334-356",
          "snippet": "static void destroy_ns(struct aa_ns *ns)\n{\n\tif (!ns)\n\t\treturn;\n\n\tmutex_lock_nested(&ns->lock, ns->level);\n\t/* release all profiles in this namespace */\n\t__aa_profile_list_release(&ns->base.profiles);\n\n\t/* release all sub namespaces */\n\t__ns_list_release(&ns->sub_ns);\n\n\tif (ns->parent) {\n\t\tunsigned long flags;\n\n\t\twrite_lock_irqsave(&ns->labels.lock, flags);\n\t\t__aa_proxy_redirect(ns_unconfined(ns),\n\t\t\t\t    ns_unconfined(ns->parent));\n\t\twrite_unlock_irqrestore(&ns->labels.lock, flags);\n\t}\n\t__aafs_ns_rmdir(ns);\n\tmutex_unlock(&ns->lock);\n}",
          "includes": [
            "#include \"include/policy.h\"",
            "#include \"include/label.h\"",
            "#include \"include/policy_ns.h\"",
            "#include \"include/context.h\"",
            "#include \"include/apparmor.h\"",
            "#include <linux/string.h>",
            "#include <linux/slab.h>",
            "#include <linux/mutex.h>",
            "#include <linux/list.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"include/policy.h\"\n#include \"include/label.h\"\n#include \"include/policy_ns.h\"\n#include \"include/context.h\"\n#include \"include/apparmor.h\"\n#include <linux/string.h>\n#include <linux/slab.h>\n#include <linux/mutex.h>\n#include <linux/list.h>\n\nstatic void destroy_ns(struct aa_ns *ns)\n{\n\tif (!ns)\n\t\treturn;\n\n\tmutex_lock_nested(&ns->lock, ns->level);\n\t/* release all profiles in this namespace */\n\t__aa_profile_list_release(&ns->base.profiles);\n\n\t/* release all sub namespaces */\n\t__ns_list_release(&ns->sub_ns);\n\n\tif (ns->parent) {\n\t\tunsigned long flags;\n\n\t\twrite_lock_irqsave(&ns->labels.lock, flags);\n\t\t__aa_proxy_redirect(ns_unconfined(ns),\n\t\t\t\t    ns_unconfined(ns->parent));\n\t\twrite_unlock_irqrestore(&ns->labels.lock, flags);\n\t}\n\t__aafs_ns_rmdir(ns);\n\tmutex_unlock(&ns->lock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "list_del_rcu",
          "args": [
            "&ns->base.list"
          ],
          "line": 367
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"include/policy.h\"\n#include \"include/label.h\"\n#include \"include/policy_ns.h\"\n#include \"include/context.h\"\n#include \"include/apparmor.h\"\n#include <linux/string.h>\n#include <linux/slab.h>\n#include <linux/mutex.h>\n#include <linux/list.h>\n\nvoid __aa_remove_ns(struct aa_ns *ns)\n{\n\t/* remove ns from namespace list */\n\tlist_del_rcu(&ns->base.list);\n\tdestroy_ns(ns);\n\taa_put_ns(ns);\n}"
  },
  {
    "function_name": "destroy_ns",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/policy_ns.c",
    "lines": "334-356",
    "snippet": "static void destroy_ns(struct aa_ns *ns)\n{\n\tif (!ns)\n\t\treturn;\n\n\tmutex_lock_nested(&ns->lock, ns->level);\n\t/* release all profiles in this namespace */\n\t__aa_profile_list_release(&ns->base.profiles);\n\n\t/* release all sub namespaces */\n\t__ns_list_release(&ns->sub_ns);\n\n\tif (ns->parent) {\n\t\tunsigned long flags;\n\n\t\twrite_lock_irqsave(&ns->labels.lock, flags);\n\t\t__aa_proxy_redirect(ns_unconfined(ns),\n\t\t\t\t    ns_unconfined(ns->parent));\n\t\twrite_unlock_irqrestore(&ns->labels.lock, flags);\n\t}\n\t__aafs_ns_rmdir(ns);\n\tmutex_unlock(&ns->lock);\n}",
    "includes": [
      "#include \"include/policy.h\"",
      "#include \"include/label.h\"",
      "#include \"include/policy_ns.h\"",
      "#include \"include/context.h\"",
      "#include \"include/apparmor.h\"",
      "#include <linux/string.h>",
      "#include <linux/slab.h>",
      "#include <linux/mutex.h>",
      "#include <linux/list.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "mutex_unlock",
          "args": [
            "&ns->lock"
          ],
          "line": 355
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "__aafs_ns_rmdir",
          "args": [
            "ns"
          ],
          "line": 354
        },
        "resolved": true,
        "details": {
          "function_name": "__aafs_ns_rmdir",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/apparmorfs.c",
          "lines": "1736-1782",
          "snippet": "void __aafs_ns_rmdir(struct aa_ns *ns)\n{\n\tstruct aa_ns *sub;\n\tstruct aa_profile *child;\n\tint i;\n\n\tif (!ns)\n\t\treturn;\n\tAA_BUG(!mutex_is_locked(&ns->lock));\n\n\tlist_for_each_entry(child, &ns->base.profiles, base.list)\n\t\t__aafs_profile_rmdir(child);\n\n\tlist_for_each_entry(sub, &ns->sub_ns, base.list) {\n\t\tmutex_lock_nested(&sub->lock, sub->level);\n\t\t__aafs_ns_rmdir(sub);\n\t\tmutex_unlock(&sub->lock);\n\t}\n\n\t__aa_fs_list_remove_rawdata(ns);\n\n\tif (ns_subns_dir(ns)) {\n\t\tsub = d_inode(ns_subns_dir(ns))->i_private;\n\t\taa_put_ns(sub);\n\t}\n\tif (ns_subload(ns)) {\n\t\tsub = d_inode(ns_subload(ns))->i_private;\n\t\taa_put_ns(sub);\n\t}\n\tif (ns_subreplace(ns)) {\n\t\tsub = d_inode(ns_subreplace(ns))->i_private;\n\t\taa_put_ns(sub);\n\t}\n\tif (ns_subremove(ns)) {\n\t\tsub = d_inode(ns_subremove(ns))->i_private;\n\t\taa_put_ns(sub);\n\t}\n\tif (ns_subrevision(ns)) {\n\t\tsub = d_inode(ns_subrevision(ns))->i_private;\n\t\taa_put_ns(sub);\n\t}\n\n\tfor (i = AAFS_NS_SIZEOF - 1; i >= 0; --i) {\n\t\taafs_remove(ns->dents[i]);\n\t\tns->dents[i] = NULL;\n\t}\n}",
          "includes": [
            "#include \"include/policy_unpack.h\"",
            "#include \"include/resource.h\"",
            "#include \"include/policy_ns.h\"",
            "#include \"include/policy.h\"",
            "#include \"include/label.h\"",
            "#include \"include/policy_ns.h\"",
            "#include \"include/ipc.h\"",
            "#include \"include/crypto.h\"",
            "#include \"include/context.h\"",
            "#include \"include/audit.h\"",
            "#include \"include/apparmorfs.h\"",
            "#include \"include/apparmor.h\"",
            "#include <uapi/linux/magic.h>",
            "#include <uapi/linux/major.h>",
            "#include <linux/poll.h>",
            "#include <linux/fs.h>",
            "#include <linux/rcupdate.h>",
            "#include <linux/capability.h>",
            "#include <linux/namei.h>",
            "#include <linux/mount.h>",
            "#include <linux/uaccess.h>",
            "#include <linux/seq_file.h>",
            "#include <linux/module.h>",
            "#include <linux/vmalloc.h>",
            "#include <linux/security.h>",
            "#include <linux/ctype.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"include/policy_unpack.h\"\n#include \"include/resource.h\"\n#include \"include/policy_ns.h\"\n#include \"include/policy.h\"\n#include \"include/label.h\"\n#include \"include/policy_ns.h\"\n#include \"include/ipc.h\"\n#include \"include/crypto.h\"\n#include \"include/context.h\"\n#include \"include/audit.h\"\n#include \"include/apparmorfs.h\"\n#include \"include/apparmor.h\"\n#include <uapi/linux/magic.h>\n#include <uapi/linux/major.h>\n#include <linux/poll.h>\n#include <linux/fs.h>\n#include <linux/rcupdate.h>\n#include <linux/capability.h>\n#include <linux/namei.h>\n#include <linux/mount.h>\n#include <linux/uaccess.h>\n#include <linux/seq_file.h>\n#include <linux/module.h>\n#include <linux/vmalloc.h>\n#include <linux/security.h>\n#include <linux/ctype.h>\n\nvoid __aafs_ns_rmdir(struct aa_ns *ns)\n{\n\tstruct aa_ns *sub;\n\tstruct aa_profile *child;\n\tint i;\n\n\tif (!ns)\n\t\treturn;\n\tAA_BUG(!mutex_is_locked(&ns->lock));\n\n\tlist_for_each_entry(child, &ns->base.profiles, base.list)\n\t\t__aafs_profile_rmdir(child);\n\n\tlist_for_each_entry(sub, &ns->sub_ns, base.list) {\n\t\tmutex_lock_nested(&sub->lock, sub->level);\n\t\t__aafs_ns_rmdir(sub);\n\t\tmutex_unlock(&sub->lock);\n\t}\n\n\t__aa_fs_list_remove_rawdata(ns);\n\n\tif (ns_subns_dir(ns)) {\n\t\tsub = d_inode(ns_subns_dir(ns))->i_private;\n\t\taa_put_ns(sub);\n\t}\n\tif (ns_subload(ns)) {\n\t\tsub = d_inode(ns_subload(ns))->i_private;\n\t\taa_put_ns(sub);\n\t}\n\tif (ns_subreplace(ns)) {\n\t\tsub = d_inode(ns_subreplace(ns))->i_private;\n\t\taa_put_ns(sub);\n\t}\n\tif (ns_subremove(ns)) {\n\t\tsub = d_inode(ns_subremove(ns))->i_private;\n\t\taa_put_ns(sub);\n\t}\n\tif (ns_subrevision(ns)) {\n\t\tsub = d_inode(ns_subrevision(ns))->i_private;\n\t\taa_put_ns(sub);\n\t}\n\n\tfor (i = AAFS_NS_SIZEOF - 1; i >= 0; --i) {\n\t\taafs_remove(ns->dents[i]);\n\t\tns->dents[i] = NULL;\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "write_unlock_irqrestore",
          "args": [
            "&ns->labels.lock",
            "flags"
          ],
          "line": 352
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "__aa_proxy_redirect",
          "args": [
            "ns_unconfined(ns)",
            "ns_unconfined(ns->parent)"
          ],
          "line": 350
        },
        "resolved": true,
        "details": {
          "function_name": "__aa_proxy_redirect",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/label.c",
          "lines": "77-90",
          "snippet": "void __aa_proxy_redirect(struct aa_label *orig, struct aa_label *new)\n{\n\tstruct aa_label *tmp;\n\n\tAA_BUG(!orig);\n\tAA_BUG(!new);\n\tlockdep_assert_held_exclusive(&labels_set(orig)->lock);\n\n\ttmp = rcu_dereference_protected(orig->proxy->label,\n\t\t\t\t\t&labels_ns(orig)->lock);\n\trcu_assign_pointer(orig->proxy->label, aa_get_label(new));\n\torig->flags |= FLAG_STALE;\n\taa_put_label(tmp);\n}",
          "includes": [
            "#include \"include/secid.h\"",
            "#include \"include/policy.h\"",
            "#include \"include/label.h\"",
            "#include \"include/context.h\"",
            "#include \"include/apparmor.h\"",
            "#include <linux/sort.h>",
            "#include <linux/seq_file.h>",
            "#include <linux/audit.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"include/secid.h\"\n#include \"include/policy.h\"\n#include \"include/label.h\"\n#include \"include/context.h\"\n#include \"include/apparmor.h\"\n#include <linux/sort.h>\n#include <linux/seq_file.h>\n#include <linux/audit.h>\n\nvoid __aa_proxy_redirect(struct aa_label *orig, struct aa_label *new)\n{\n\tstruct aa_label *tmp;\n\n\tAA_BUG(!orig);\n\tAA_BUG(!new);\n\tlockdep_assert_held_exclusive(&labels_set(orig)->lock);\n\n\ttmp = rcu_dereference_protected(orig->proxy->label,\n\t\t\t\t\t&labels_ns(orig)->lock);\n\trcu_assign_pointer(orig->proxy->label, aa_get_label(new));\n\torig->flags |= FLAG_STALE;\n\taa_put_label(tmp);\n}"
        }
      },
      {
        "call_info": {
          "callee": "ns_unconfined",
          "args": [
            "ns->parent"
          ],
          "line": 351
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ns_unconfined",
          "args": [
            "ns"
          ],
          "line": 350
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "write_lock_irqsave",
          "args": [
            "&ns->labels.lock",
            "flags"
          ],
          "line": 349
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "__ns_list_release",
          "args": [
            "&ns->sub_ns"
          ],
          "line": 344
        },
        "resolved": true,
        "details": {
          "function_name": "__ns_list_release",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/policy_ns.c",
          "lines": "378-385",
          "snippet": "static void __ns_list_release(struct list_head *head)\n{\n\tstruct aa_ns *ns, *tmp;\n\n\tlist_for_each_entry_safe(ns, tmp, head, base.list)\n\t\t__aa_remove_ns(ns);\n\n}",
          "includes": [
            "#include \"include/policy.h\"",
            "#include \"include/label.h\"",
            "#include \"include/policy_ns.h\"",
            "#include \"include/context.h\"",
            "#include \"include/apparmor.h\"",
            "#include <linux/string.h>",
            "#include <linux/slab.h>",
            "#include <linux/mutex.h>",
            "#include <linux/list.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void __ns_list_release(struct list_head *head);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"include/policy.h\"\n#include \"include/label.h\"\n#include \"include/policy_ns.h\"\n#include \"include/context.h\"\n#include \"include/apparmor.h\"\n#include <linux/string.h>\n#include <linux/slab.h>\n#include <linux/mutex.h>\n#include <linux/list.h>\n\nstatic void __ns_list_release(struct list_head *head);\n\nstatic void __ns_list_release(struct list_head *head)\n{\n\tstruct aa_ns *ns, *tmp;\n\n\tlist_for_each_entry_safe(ns, tmp, head, base.list)\n\t\t__aa_remove_ns(ns);\n\n}"
        }
      },
      {
        "call_info": {
          "callee": "__aa_profile_list_release",
          "args": [
            "&ns->base.profiles"
          ],
          "line": 341
        },
        "resolved": true,
        "details": {
          "function_name": "__aa_profile_list_release",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/policy.c",
          "lines": "179-184",
          "snippet": "void __aa_profile_list_release(struct list_head *head)\n{\n\tstruct aa_profile *profile, *tmp;\n\tlist_for_each_entry_safe(profile, tmp, head, base.list)\n\t\t__remove_profile(profile);\n}",
          "includes": [
            "#include \"include/resource.h\"",
            "#include \"include/policy_unpack.h\"",
            "#include \"include/policy_ns.h\"",
            "#include \"include/policy.h\"",
            "#include \"include/path.h\"",
            "#include \"include/match.h\"",
            "#include \"include/ipc.h\"",
            "#include \"include/file.h\"",
            "#include \"include/context.h\"",
            "#include \"include/capability.h\"",
            "#include \"include/apparmor.h\"",
            "#include <linux/user_namespace.h>",
            "#include <linux/rculist.h>",
            "#include <linux/cred.h>",
            "#include <linux/string.h>",
            "#include <linux/spinlock.h>",
            "#include <linux/slab.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"include/resource.h\"\n#include \"include/policy_unpack.h\"\n#include \"include/policy_ns.h\"\n#include \"include/policy.h\"\n#include \"include/path.h\"\n#include \"include/match.h\"\n#include \"include/ipc.h\"\n#include \"include/file.h\"\n#include \"include/context.h\"\n#include \"include/capability.h\"\n#include \"include/apparmor.h\"\n#include <linux/user_namespace.h>\n#include <linux/rculist.h>\n#include <linux/cred.h>\n#include <linux/string.h>\n#include <linux/spinlock.h>\n#include <linux/slab.h>\n\nvoid __aa_profile_list_release(struct list_head *head)\n{\n\tstruct aa_profile *profile, *tmp;\n\tlist_for_each_entry_safe(profile, tmp, head, base.list)\n\t\t__remove_profile(profile);\n}"
        }
      },
      {
        "call_info": {
          "callee": "mutex_lock_nested",
          "args": [
            "&ns->lock",
            "ns->level"
          ],
          "line": 339
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"include/policy.h\"\n#include \"include/label.h\"\n#include \"include/policy_ns.h\"\n#include \"include/context.h\"\n#include \"include/apparmor.h\"\n#include <linux/string.h>\n#include <linux/slab.h>\n#include <linux/mutex.h>\n#include <linux/list.h>\n\nstatic void destroy_ns(struct aa_ns *ns)\n{\n\tif (!ns)\n\t\treturn;\n\n\tmutex_lock_nested(&ns->lock, ns->level);\n\t/* release all profiles in this namespace */\n\t__aa_profile_list_release(&ns->base.profiles);\n\n\t/* release all sub namespaces */\n\t__ns_list_release(&ns->sub_ns);\n\n\tif (ns->parent) {\n\t\tunsigned long flags;\n\n\t\twrite_lock_irqsave(&ns->labels.lock, flags);\n\t\t__aa_proxy_redirect(ns_unconfined(ns),\n\t\t\t\t    ns_unconfined(ns->parent));\n\t\twrite_unlock_irqrestore(&ns->labels.lock, flags);\n\t}\n\t__aafs_ns_rmdir(ns);\n\tmutex_unlock(&ns->lock);\n}"
  },
  {
    "function_name": "aa_prepare_ns",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/policy_ns.c",
    "lines": "312-326",
    "snippet": "struct aa_ns *aa_prepare_ns(struct aa_ns *parent, const char *name)\n{\n\tstruct aa_ns *ns;\n\n\tmutex_lock_nested(&parent->lock, parent->level);\n\t/* try and find the specified ns and if it doesn't exist create it */\n\t/* released by caller */\n\tns = aa_get_ns(__aa_find_ns(&parent->sub_ns, name));\n\tif (!ns)\n\t\tns = __aa_create_ns(parent, name, NULL);\n\tmutex_unlock(&parent->lock);\n\n\t/* return ref */\n\treturn ns;\n}",
    "includes": [
      "#include \"include/policy.h\"",
      "#include \"include/label.h\"",
      "#include \"include/policy_ns.h\"",
      "#include \"include/context.h\"",
      "#include \"include/apparmor.h\"",
      "#include <linux/string.h>",
      "#include <linux/slab.h>",
      "#include <linux/mutex.h>",
      "#include <linux/list.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "mutex_unlock",
          "args": [
            "&parent->lock"
          ],
          "line": 322
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "__aa_create_ns",
          "args": [
            "parent",
            "name",
            "NULL"
          ],
          "line": 321
        },
        "resolved": true,
        "details": {
          "function_name": "__aa_create_ns",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/policy_ns.c",
          "lines": "246-276",
          "snippet": "static struct aa_ns *__aa_create_ns(struct aa_ns *parent, const char *name,\n\t\t\t\t    struct dentry *dir)\n{\n\tstruct aa_ns *ns;\n\tint error;\n\n\tAA_BUG(!parent);\n\tAA_BUG(!name);\n\tAA_BUG(!mutex_is_locked(&parent->lock));\n\n\tns = alloc_ns(parent->base.hname, name);\n\tif (!ns)\n\t\treturn NULL;\n\tns->level = parent->level + 1;\n\tmutex_lock_nested(&ns->lock, ns->level);\n\terror = __aafs_ns_mkdir(ns, ns_subns_dir(parent), name, dir);\n\tif (error) {\n\t\tAA_ERROR(\"Failed to create interface for ns %s\\n\",\n\t\t\t ns->base.name);\n\t\tmutex_unlock(&ns->lock);\n\t\taa_free_ns(ns);\n\t\treturn ERR_PTR(error);\n\t}\n\tns->parent = aa_get_ns(parent);\n\tlist_add_rcu(&ns->base.list, &parent->sub_ns);\n\t/* add list ref */\n\taa_get_ns(ns);\n\tmutex_unlock(&ns->lock);\n\n\treturn ns;\n}",
          "includes": [
            "#include \"include/policy.h\"",
            "#include \"include/label.h\"",
            "#include \"include/policy_ns.h\"",
            "#include \"include/context.h\"",
            "#include \"include/apparmor.h\"",
            "#include <linux/string.h>",
            "#include <linux/slab.h>",
            "#include <linux/mutex.h>",
            "#include <linux/list.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"include/policy.h\"\n#include \"include/label.h\"\n#include \"include/policy_ns.h\"\n#include \"include/context.h\"\n#include \"include/apparmor.h\"\n#include <linux/string.h>\n#include <linux/slab.h>\n#include <linux/mutex.h>\n#include <linux/list.h>\n\nstatic struct aa_ns *__aa_create_ns(struct aa_ns *parent, const char *name,\n\t\t\t\t    struct dentry *dir)\n{\n\tstruct aa_ns *ns;\n\tint error;\n\n\tAA_BUG(!parent);\n\tAA_BUG(!name);\n\tAA_BUG(!mutex_is_locked(&parent->lock));\n\n\tns = alloc_ns(parent->base.hname, name);\n\tif (!ns)\n\t\treturn NULL;\n\tns->level = parent->level + 1;\n\tmutex_lock_nested(&ns->lock, ns->level);\n\terror = __aafs_ns_mkdir(ns, ns_subns_dir(parent), name, dir);\n\tif (error) {\n\t\tAA_ERROR(\"Failed to create interface for ns %s\\n\",\n\t\t\t ns->base.name);\n\t\tmutex_unlock(&ns->lock);\n\t\taa_free_ns(ns);\n\t\treturn ERR_PTR(error);\n\t}\n\tns->parent = aa_get_ns(parent);\n\tlist_add_rcu(&ns->base.list, &parent->sub_ns);\n\t/* add list ref */\n\taa_get_ns(ns);\n\tmutex_unlock(&ns->lock);\n\n\treturn ns;\n}"
        }
      },
      {
        "call_info": {
          "callee": "aa_get_ns",
          "args": [
            "__aa_find_ns(&parent->sub_ns, name)"
          ],
          "line": 319
        },
        "resolved": true,
        "details": {
          "function_name": "aa_get_ns",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/include/policy_ns.h",
          "lines": "116-122",
          "snippet": "static inline struct aa_ns *aa_get_ns(struct aa_ns *ns)\n{\n\tif (ns)\n\t\taa_get_profile(ns->unconfined);\n\n\treturn ns;\n}",
          "includes": [
            "#include \"policy.h\"",
            "#include \"label.h\"",
            "#include \"apparmorfs.h\"",
            "#include \"apparmor.h\"",
            "#include <linux/kref.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"policy.h\"\n#include \"label.h\"\n#include \"apparmorfs.h\"\n#include \"apparmor.h\"\n#include <linux/kref.h>\n\nstatic inline struct aa_ns *aa_get_ns(struct aa_ns *ns)\n{\n\tif (ns)\n\t\taa_get_profile(ns->unconfined);\n\n\treturn ns;\n}"
        }
      },
      {
        "call_info": {
          "callee": "__aa_find_ns",
          "args": [
            "&parent->sub_ns",
            "name"
          ],
          "line": 319
        },
        "resolved": true,
        "details": {
          "function_name": "__aa_find_ns",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/include/policy_ns.h",
          "lines": "151-155",
          "snippet": "static inline struct aa_ns *__aa_find_ns(struct list_head *head,\n\t\t\t\t\t const char *name)\n{\n\treturn __aa_findn_ns(head, name, strlen(name));\n}",
          "includes": [
            "#include \"policy.h\"",
            "#include \"label.h\"",
            "#include \"apparmorfs.h\"",
            "#include \"apparmor.h\"",
            "#include <linux/kref.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"policy.h\"\n#include \"label.h\"\n#include \"apparmorfs.h\"\n#include \"apparmor.h\"\n#include <linux/kref.h>\n\nstatic inline struct aa_ns *__aa_find_ns(struct list_head *head,\n\t\t\t\t\t const char *name)\n{\n\treturn __aa_findn_ns(head, name, strlen(name));\n}"
        }
      },
      {
        "call_info": {
          "callee": "mutex_lock_nested",
          "args": [
            "&parent->lock",
            "parent->level"
          ],
          "line": 316
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"include/policy.h\"\n#include \"include/label.h\"\n#include \"include/policy_ns.h\"\n#include \"include/context.h\"\n#include \"include/apparmor.h\"\n#include <linux/string.h>\n#include <linux/slab.h>\n#include <linux/mutex.h>\n#include <linux/list.h>\n\nstruct aa_ns *aa_prepare_ns(struct aa_ns *parent, const char *name)\n{\n\tstruct aa_ns *ns;\n\n\tmutex_lock_nested(&parent->lock, parent->level);\n\t/* try and find the specified ns and if it doesn't exist create it */\n\t/* released by caller */\n\tns = aa_get_ns(__aa_find_ns(&parent->sub_ns, name));\n\tif (!ns)\n\t\tns = __aa_create_ns(parent, name, NULL);\n\tmutex_unlock(&parent->lock);\n\n\t/* return ref */\n\treturn ns;\n}"
  },
  {
    "function_name": "__aa_find_or_create_ns",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/policy_ns.c",
    "lines": "286-303",
    "snippet": "struct aa_ns *__aa_find_or_create_ns(struct aa_ns *parent, const char *name,\n\t\t\t\t     struct dentry *dir)\n{\n\tstruct aa_ns *ns;\n\n\tAA_BUG(!mutex_is_locked(&parent->lock));\n\n\t/* try and find the specified ns */\n\t/* released by caller */\n\tns = aa_get_ns(__aa_find_ns(&parent->sub_ns, name));\n\tif (!ns)\n\t\tns = __aa_create_ns(parent, name, dir);\n\telse\n\t\tns = ERR_PTR(-EEXIST);\n\n\t/* return ref */\n\treturn ns;\n}",
    "includes": [
      "#include \"include/policy.h\"",
      "#include \"include/label.h\"",
      "#include \"include/policy_ns.h\"",
      "#include \"include/context.h\"",
      "#include \"include/apparmor.h\"",
      "#include <linux/string.h>",
      "#include <linux/slab.h>",
      "#include <linux/mutex.h>",
      "#include <linux/list.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "ERR_PTR",
          "args": [
            "-EEXIST"
          ],
          "line": 299
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "__aa_create_ns",
          "args": [
            "parent",
            "name",
            "dir"
          ],
          "line": 297
        },
        "resolved": true,
        "details": {
          "function_name": "__aa_create_ns",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/policy_ns.c",
          "lines": "246-276",
          "snippet": "static struct aa_ns *__aa_create_ns(struct aa_ns *parent, const char *name,\n\t\t\t\t    struct dentry *dir)\n{\n\tstruct aa_ns *ns;\n\tint error;\n\n\tAA_BUG(!parent);\n\tAA_BUG(!name);\n\tAA_BUG(!mutex_is_locked(&parent->lock));\n\n\tns = alloc_ns(parent->base.hname, name);\n\tif (!ns)\n\t\treturn NULL;\n\tns->level = parent->level + 1;\n\tmutex_lock_nested(&ns->lock, ns->level);\n\terror = __aafs_ns_mkdir(ns, ns_subns_dir(parent), name, dir);\n\tif (error) {\n\t\tAA_ERROR(\"Failed to create interface for ns %s\\n\",\n\t\t\t ns->base.name);\n\t\tmutex_unlock(&ns->lock);\n\t\taa_free_ns(ns);\n\t\treturn ERR_PTR(error);\n\t}\n\tns->parent = aa_get_ns(parent);\n\tlist_add_rcu(&ns->base.list, &parent->sub_ns);\n\t/* add list ref */\n\taa_get_ns(ns);\n\tmutex_unlock(&ns->lock);\n\n\treturn ns;\n}",
          "includes": [
            "#include \"include/policy.h\"",
            "#include \"include/label.h\"",
            "#include \"include/policy_ns.h\"",
            "#include \"include/context.h\"",
            "#include \"include/apparmor.h\"",
            "#include <linux/string.h>",
            "#include <linux/slab.h>",
            "#include <linux/mutex.h>",
            "#include <linux/list.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"include/policy.h\"\n#include \"include/label.h\"\n#include \"include/policy_ns.h\"\n#include \"include/context.h\"\n#include \"include/apparmor.h\"\n#include <linux/string.h>\n#include <linux/slab.h>\n#include <linux/mutex.h>\n#include <linux/list.h>\n\nstatic struct aa_ns *__aa_create_ns(struct aa_ns *parent, const char *name,\n\t\t\t\t    struct dentry *dir)\n{\n\tstruct aa_ns *ns;\n\tint error;\n\n\tAA_BUG(!parent);\n\tAA_BUG(!name);\n\tAA_BUG(!mutex_is_locked(&parent->lock));\n\n\tns = alloc_ns(parent->base.hname, name);\n\tif (!ns)\n\t\treturn NULL;\n\tns->level = parent->level + 1;\n\tmutex_lock_nested(&ns->lock, ns->level);\n\terror = __aafs_ns_mkdir(ns, ns_subns_dir(parent), name, dir);\n\tif (error) {\n\t\tAA_ERROR(\"Failed to create interface for ns %s\\n\",\n\t\t\t ns->base.name);\n\t\tmutex_unlock(&ns->lock);\n\t\taa_free_ns(ns);\n\t\treturn ERR_PTR(error);\n\t}\n\tns->parent = aa_get_ns(parent);\n\tlist_add_rcu(&ns->base.list, &parent->sub_ns);\n\t/* add list ref */\n\taa_get_ns(ns);\n\tmutex_unlock(&ns->lock);\n\n\treturn ns;\n}"
        }
      },
      {
        "call_info": {
          "callee": "aa_get_ns",
          "args": [
            "__aa_find_ns(&parent->sub_ns, name)"
          ],
          "line": 295
        },
        "resolved": true,
        "details": {
          "function_name": "aa_get_ns",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/include/policy_ns.h",
          "lines": "116-122",
          "snippet": "static inline struct aa_ns *aa_get_ns(struct aa_ns *ns)\n{\n\tif (ns)\n\t\taa_get_profile(ns->unconfined);\n\n\treturn ns;\n}",
          "includes": [
            "#include \"policy.h\"",
            "#include \"label.h\"",
            "#include \"apparmorfs.h\"",
            "#include \"apparmor.h\"",
            "#include <linux/kref.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"policy.h\"\n#include \"label.h\"\n#include \"apparmorfs.h\"\n#include \"apparmor.h\"\n#include <linux/kref.h>\n\nstatic inline struct aa_ns *aa_get_ns(struct aa_ns *ns)\n{\n\tif (ns)\n\t\taa_get_profile(ns->unconfined);\n\n\treturn ns;\n}"
        }
      },
      {
        "call_info": {
          "callee": "__aa_find_ns",
          "args": [
            "&parent->sub_ns",
            "name"
          ],
          "line": 295
        },
        "resolved": true,
        "details": {
          "function_name": "__aa_find_ns",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/include/policy_ns.h",
          "lines": "151-155",
          "snippet": "static inline struct aa_ns *__aa_find_ns(struct list_head *head,\n\t\t\t\t\t const char *name)\n{\n\treturn __aa_findn_ns(head, name, strlen(name));\n}",
          "includes": [
            "#include \"policy.h\"",
            "#include \"label.h\"",
            "#include \"apparmorfs.h\"",
            "#include \"apparmor.h\"",
            "#include <linux/kref.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"policy.h\"\n#include \"label.h\"\n#include \"apparmorfs.h\"\n#include \"apparmor.h\"\n#include <linux/kref.h>\n\nstatic inline struct aa_ns *__aa_find_ns(struct list_head *head,\n\t\t\t\t\t const char *name)\n{\n\treturn __aa_findn_ns(head, name, strlen(name));\n}"
        }
      },
      {
        "call_info": {
          "callee": "AA_BUG",
          "args": [
            "!mutex_is_locked(&parent->lock)"
          ],
          "line": 291
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "mutex_is_locked",
          "args": [
            "&parent->lock"
          ],
          "line": 291
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"include/policy.h\"\n#include \"include/label.h\"\n#include \"include/policy_ns.h\"\n#include \"include/context.h\"\n#include \"include/apparmor.h\"\n#include <linux/string.h>\n#include <linux/slab.h>\n#include <linux/mutex.h>\n#include <linux/list.h>\n\nstruct aa_ns *__aa_find_or_create_ns(struct aa_ns *parent, const char *name,\n\t\t\t\t     struct dentry *dir)\n{\n\tstruct aa_ns *ns;\n\n\tAA_BUG(!mutex_is_locked(&parent->lock));\n\n\t/* try and find the specified ns */\n\t/* released by caller */\n\tns = aa_get_ns(__aa_find_ns(&parent->sub_ns, name));\n\tif (!ns)\n\t\tns = __aa_create_ns(parent, name, dir);\n\telse\n\t\tns = ERR_PTR(-EEXIST);\n\n\t/* return ref */\n\treturn ns;\n}"
  },
  {
    "function_name": "__aa_create_ns",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/policy_ns.c",
    "lines": "246-276",
    "snippet": "static struct aa_ns *__aa_create_ns(struct aa_ns *parent, const char *name,\n\t\t\t\t    struct dentry *dir)\n{\n\tstruct aa_ns *ns;\n\tint error;\n\n\tAA_BUG(!parent);\n\tAA_BUG(!name);\n\tAA_BUG(!mutex_is_locked(&parent->lock));\n\n\tns = alloc_ns(parent->base.hname, name);\n\tif (!ns)\n\t\treturn NULL;\n\tns->level = parent->level + 1;\n\tmutex_lock_nested(&ns->lock, ns->level);\n\terror = __aafs_ns_mkdir(ns, ns_subns_dir(parent), name, dir);\n\tif (error) {\n\t\tAA_ERROR(\"Failed to create interface for ns %s\\n\",\n\t\t\t ns->base.name);\n\t\tmutex_unlock(&ns->lock);\n\t\taa_free_ns(ns);\n\t\treturn ERR_PTR(error);\n\t}\n\tns->parent = aa_get_ns(parent);\n\tlist_add_rcu(&ns->base.list, &parent->sub_ns);\n\t/* add list ref */\n\taa_get_ns(ns);\n\tmutex_unlock(&ns->lock);\n\n\treturn ns;\n}",
    "includes": [
      "#include \"include/policy.h\"",
      "#include \"include/label.h\"",
      "#include \"include/policy_ns.h\"",
      "#include \"include/context.h\"",
      "#include \"include/apparmor.h\"",
      "#include <linux/string.h>",
      "#include <linux/slab.h>",
      "#include <linux/mutex.h>",
      "#include <linux/list.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "mutex_unlock",
          "args": [
            "&ns->lock"
          ],
          "line": 273
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "aa_get_ns",
          "args": [
            "ns"
          ],
          "line": 272
        },
        "resolved": true,
        "details": {
          "function_name": "aa_get_ns",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/include/policy_ns.h",
          "lines": "116-122",
          "snippet": "static inline struct aa_ns *aa_get_ns(struct aa_ns *ns)\n{\n\tif (ns)\n\t\taa_get_profile(ns->unconfined);\n\n\treturn ns;\n}",
          "includes": [
            "#include \"policy.h\"",
            "#include \"label.h\"",
            "#include \"apparmorfs.h\"",
            "#include \"apparmor.h\"",
            "#include <linux/kref.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"policy.h\"\n#include \"label.h\"\n#include \"apparmorfs.h\"\n#include \"apparmor.h\"\n#include <linux/kref.h>\n\nstatic inline struct aa_ns *aa_get_ns(struct aa_ns *ns)\n{\n\tif (ns)\n\t\taa_get_profile(ns->unconfined);\n\n\treturn ns;\n}"
        }
      },
      {
        "call_info": {
          "callee": "list_add_rcu",
          "args": [
            "&ns->base.list",
            "&parent->sub_ns"
          ],
          "line": 270
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ERR_PTR",
          "args": [
            "error"
          ],
          "line": 267
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "aa_free_ns",
          "args": [
            "ns"
          ],
          "line": 266
        },
        "resolved": true,
        "details": {
          "function_name": "aa_free_ns",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/policy_ns.c",
          "lines": "141-153",
          "snippet": "void aa_free_ns(struct aa_ns *ns)\n{\n\tif (!ns)\n\t\treturn;\n\n\taa_policy_destroy(&ns->base);\n\taa_labelset_destroy(&ns->labels);\n\taa_put_ns(ns->parent);\n\n\tns->unconfined->ns = NULL;\n\taa_free_profile(ns->unconfined);\n\tkzfree(ns);\n}",
          "includes": [
            "#include \"include/policy.h\"",
            "#include \"include/label.h\"",
            "#include \"include/policy_ns.h\"",
            "#include \"include/context.h\"",
            "#include \"include/apparmor.h\"",
            "#include <linux/string.h>",
            "#include <linux/slab.h>",
            "#include <linux/mutex.h>",
            "#include <linux/list.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"include/policy.h\"\n#include \"include/label.h\"\n#include \"include/policy_ns.h\"\n#include \"include/context.h\"\n#include \"include/apparmor.h\"\n#include <linux/string.h>\n#include <linux/slab.h>\n#include <linux/mutex.h>\n#include <linux/list.h>\n\nvoid aa_free_ns(struct aa_ns *ns)\n{\n\tif (!ns)\n\t\treturn;\n\n\taa_policy_destroy(&ns->base);\n\taa_labelset_destroy(&ns->labels);\n\taa_put_ns(ns->parent);\n\n\tns->unconfined->ns = NULL;\n\taa_free_profile(ns->unconfined);\n\tkzfree(ns);\n}"
        }
      },
      {
        "call_info": {
          "callee": "mutex_unlock",
          "args": [
            "&ns->lock"
          ],
          "line": 265
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "AA_ERROR",
          "args": [
            "\"Failed to create interface for ns %s\\n\"",
            "ns->base.name"
          ],
          "line": 263
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "__aafs_ns_mkdir",
          "args": [
            "ns",
            "ns_subns_dir(parent)",
            "name",
            "dir"
          ],
          "line": 261
        },
        "resolved": true,
        "details": {
          "function_name": "__aafs_ns_mkdir",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/apparmorfs.c",
          "lines": "1844-1896",
          "snippet": "int __aafs_ns_mkdir(struct aa_ns *ns, struct dentry *parent, const char *name,\n\t\t    struct dentry *dent)\n{\n\tstruct aa_ns *sub;\n\tstruct aa_profile *child;\n\tstruct dentry *dir;\n\tint error;\n\n\tAA_BUG(!ns);\n\tAA_BUG(!parent);\n\tAA_BUG(!mutex_is_locked(&ns->lock));\n\n\tif (!name)\n\t\tname = ns->base.name;\n\n\tif (!dent) {\n\t\t/* create ns dir if it doesn't already exist */\n\t\tdent = aafs_create_dir(name, parent);\n\t\tif (IS_ERR(dent))\n\t\t\tgoto fail;\n\t} else\n\t\tdget(dent);\n\tns_dir(ns) = dir = dent;\n\terror = __aafs_ns_mkdir_entries(ns, dir);\n\tif (error)\n\t\tgoto fail2;\n\n\t/* profiles */\n\tlist_for_each_entry(child, &ns->base.profiles, base.list) {\n\t\terror = __aafs_profile_mkdir(child, ns_subprofs_dir(ns));\n\t\tif (error)\n\t\t\tgoto fail2;\n\t}\n\n\t/* subnamespaces */\n\tlist_for_each_entry(sub, &ns->sub_ns, base.list) {\n\t\tmutex_lock_nested(&sub->lock, sub->level);\n\t\terror = __aafs_ns_mkdir(sub, ns_subns_dir(ns), NULL, NULL);\n\t\tmutex_unlock(&sub->lock);\n\t\tif (error)\n\t\t\tgoto fail2;\n\t}\n\n\treturn 0;\n\nfail:\n\terror = PTR_ERR(dent);\n\nfail2:\n\t__aafs_ns_rmdir(ns);\n\n\treturn error;\n}",
          "includes": [
            "#include \"include/policy_unpack.h\"",
            "#include \"include/resource.h\"",
            "#include \"include/policy_ns.h\"",
            "#include \"include/policy.h\"",
            "#include \"include/label.h\"",
            "#include \"include/policy_ns.h\"",
            "#include \"include/ipc.h\"",
            "#include \"include/crypto.h\"",
            "#include \"include/context.h\"",
            "#include \"include/audit.h\"",
            "#include \"include/apparmorfs.h\"",
            "#include \"include/apparmor.h\"",
            "#include <uapi/linux/magic.h>",
            "#include <uapi/linux/major.h>",
            "#include <linux/poll.h>",
            "#include <linux/fs.h>",
            "#include <linux/rcupdate.h>",
            "#include <linux/capability.h>",
            "#include <linux/namei.h>",
            "#include <linux/mount.h>",
            "#include <linux/uaccess.h>",
            "#include <linux/seq_file.h>",
            "#include <linux/module.h>",
            "#include <linux/vmalloc.h>",
            "#include <linux/security.h>",
            "#include <linux/ctype.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"include/policy_unpack.h\"\n#include \"include/resource.h\"\n#include \"include/policy_ns.h\"\n#include \"include/policy.h\"\n#include \"include/label.h\"\n#include \"include/policy_ns.h\"\n#include \"include/ipc.h\"\n#include \"include/crypto.h\"\n#include \"include/context.h\"\n#include \"include/audit.h\"\n#include \"include/apparmorfs.h\"\n#include \"include/apparmor.h\"\n#include <uapi/linux/magic.h>\n#include <uapi/linux/major.h>\n#include <linux/poll.h>\n#include <linux/fs.h>\n#include <linux/rcupdate.h>\n#include <linux/capability.h>\n#include <linux/namei.h>\n#include <linux/mount.h>\n#include <linux/uaccess.h>\n#include <linux/seq_file.h>\n#include <linux/module.h>\n#include <linux/vmalloc.h>\n#include <linux/security.h>\n#include <linux/ctype.h>\n\nint __aafs_ns_mkdir(struct aa_ns *ns, struct dentry *parent, const char *name,\n\t\t    struct dentry *dent)\n{\n\tstruct aa_ns *sub;\n\tstruct aa_profile *child;\n\tstruct dentry *dir;\n\tint error;\n\n\tAA_BUG(!ns);\n\tAA_BUG(!parent);\n\tAA_BUG(!mutex_is_locked(&ns->lock));\n\n\tif (!name)\n\t\tname = ns->base.name;\n\n\tif (!dent) {\n\t\t/* create ns dir if it doesn't already exist */\n\t\tdent = aafs_create_dir(name, parent);\n\t\tif (IS_ERR(dent))\n\t\t\tgoto fail;\n\t} else\n\t\tdget(dent);\n\tns_dir(ns) = dir = dent;\n\terror = __aafs_ns_mkdir_entries(ns, dir);\n\tif (error)\n\t\tgoto fail2;\n\n\t/* profiles */\n\tlist_for_each_entry(child, &ns->base.profiles, base.list) {\n\t\terror = __aafs_profile_mkdir(child, ns_subprofs_dir(ns));\n\t\tif (error)\n\t\t\tgoto fail2;\n\t}\n\n\t/* subnamespaces */\n\tlist_for_each_entry(sub, &ns->sub_ns, base.list) {\n\t\tmutex_lock_nested(&sub->lock, sub->level);\n\t\terror = __aafs_ns_mkdir(sub, ns_subns_dir(ns), NULL, NULL);\n\t\tmutex_unlock(&sub->lock);\n\t\tif (error)\n\t\t\tgoto fail2;\n\t}\n\n\treturn 0;\n\nfail:\n\terror = PTR_ERR(dent);\n\nfail2:\n\t__aafs_ns_rmdir(ns);\n\n\treturn error;\n}"
        }
      },
      {
        "call_info": {
          "callee": "ns_subns_dir",
          "args": [
            "parent"
          ],
          "line": 261
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "mutex_lock_nested",
          "args": [
            "&ns->lock",
            "ns->level"
          ],
          "line": 260
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "alloc_ns",
          "args": [
            "parent->base.hname",
            "name"
          ],
          "line": 256
        },
        "resolved": true,
        "details": {
          "function_name": "alloc_ns",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/policy_ns.c",
          "lines": "91-132",
          "snippet": "static struct aa_ns *alloc_ns(const char *prefix, const char *name)\n{\n\tstruct aa_ns *ns;\n\n\tns = kzalloc(sizeof(*ns), GFP_KERNEL);\n\tAA_DEBUG(\"%s(%p)\\n\", __func__, ns);\n\tif (!ns)\n\t\treturn NULL;\n\tif (!aa_policy_init(&ns->base, prefix, name, GFP_KERNEL))\n\t\tgoto fail_ns;\n\n\tINIT_LIST_HEAD(&ns->sub_ns);\n\tINIT_LIST_HEAD(&ns->rawdata_list);\n\tmutex_init(&ns->lock);\n\tinit_waitqueue_head(&ns->wait);\n\n\t/* released by aa_free_ns() */\n\tns->unconfined = aa_alloc_profile(\"unconfined\", NULL, GFP_KERNEL);\n\tif (!ns->unconfined)\n\t\tgoto fail_unconfined;\n\n\tns->unconfined->label.flags |= FLAG_IX_ON_NAME_ERROR |\n\t\tFLAG_IMMUTIBLE | FLAG_NS_COUNT | FLAG_UNCONFINED;\n\tns->unconfined->mode = APPARMOR_UNCONFINED;\n\tns->unconfined->file.dfa = aa_get_dfa(nulldfa);\n\tns->unconfined->policy.dfa = aa_get_dfa(nulldfa);\n\n\t/* ns and ns->unconfined share ns->unconfined refcount */\n\tns->unconfined->ns = ns;\n\n\tatomic_set(&ns->uniq_null, 0);\n\n\taa_labelset_init(&ns->labels);\n\n\treturn ns;\n\nfail_unconfined:\n\tkzfree(ns->base.hname);\nfail_ns:\n\tkzfree(ns);\n\treturn NULL;\n}",
          "includes": [
            "#include \"include/policy.h\"",
            "#include \"include/label.h\"",
            "#include \"include/policy_ns.h\"",
            "#include \"include/context.h\"",
            "#include \"include/apparmor.h\"",
            "#include <linux/string.h>",
            "#include <linux/slab.h>",
            "#include <linux/mutex.h>",
            "#include <linux/list.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"include/policy.h\"\n#include \"include/label.h\"\n#include \"include/policy_ns.h\"\n#include \"include/context.h\"\n#include \"include/apparmor.h\"\n#include <linux/string.h>\n#include <linux/slab.h>\n#include <linux/mutex.h>\n#include <linux/list.h>\n\nstatic struct aa_ns *alloc_ns(const char *prefix, const char *name)\n{\n\tstruct aa_ns *ns;\n\n\tns = kzalloc(sizeof(*ns), GFP_KERNEL);\n\tAA_DEBUG(\"%s(%p)\\n\", __func__, ns);\n\tif (!ns)\n\t\treturn NULL;\n\tif (!aa_policy_init(&ns->base, prefix, name, GFP_KERNEL))\n\t\tgoto fail_ns;\n\n\tINIT_LIST_HEAD(&ns->sub_ns);\n\tINIT_LIST_HEAD(&ns->rawdata_list);\n\tmutex_init(&ns->lock);\n\tinit_waitqueue_head(&ns->wait);\n\n\t/* released by aa_free_ns() */\n\tns->unconfined = aa_alloc_profile(\"unconfined\", NULL, GFP_KERNEL);\n\tif (!ns->unconfined)\n\t\tgoto fail_unconfined;\n\n\tns->unconfined->label.flags |= FLAG_IX_ON_NAME_ERROR |\n\t\tFLAG_IMMUTIBLE | FLAG_NS_COUNT | FLAG_UNCONFINED;\n\tns->unconfined->mode = APPARMOR_UNCONFINED;\n\tns->unconfined->file.dfa = aa_get_dfa(nulldfa);\n\tns->unconfined->policy.dfa = aa_get_dfa(nulldfa);\n\n\t/* ns and ns->unconfined share ns->unconfined refcount */\n\tns->unconfined->ns = ns;\n\n\tatomic_set(&ns->uniq_null, 0);\n\n\taa_labelset_init(&ns->labels);\n\n\treturn ns;\n\nfail_unconfined:\n\tkzfree(ns->base.hname);\nfail_ns:\n\tkzfree(ns);\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "AA_BUG",
          "args": [
            "!mutex_is_locked(&parent->lock)"
          ],
          "line": 254
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "mutex_is_locked",
          "args": [
            "&parent->lock"
          ],
          "line": 254
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "AA_BUG",
          "args": [
            "!name"
          ],
          "line": 253
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "AA_BUG",
          "args": [
            "!parent"
          ],
          "line": 252
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"include/policy.h\"\n#include \"include/label.h\"\n#include \"include/policy_ns.h\"\n#include \"include/context.h\"\n#include \"include/apparmor.h\"\n#include <linux/string.h>\n#include <linux/slab.h>\n#include <linux/mutex.h>\n#include <linux/list.h>\n\nstatic struct aa_ns *__aa_create_ns(struct aa_ns *parent, const char *name,\n\t\t\t\t    struct dentry *dir)\n{\n\tstruct aa_ns *ns;\n\tint error;\n\n\tAA_BUG(!parent);\n\tAA_BUG(!name);\n\tAA_BUG(!mutex_is_locked(&parent->lock));\n\n\tns = alloc_ns(parent->base.hname, name);\n\tif (!ns)\n\t\treturn NULL;\n\tns->level = parent->level + 1;\n\tmutex_lock_nested(&ns->lock, ns->level);\n\terror = __aafs_ns_mkdir(ns, ns_subns_dir(parent), name, dir);\n\tif (error) {\n\t\tAA_ERROR(\"Failed to create interface for ns %s\\n\",\n\t\t\t ns->base.name);\n\t\tmutex_unlock(&ns->lock);\n\t\taa_free_ns(ns);\n\t\treturn ERR_PTR(error);\n\t}\n\tns->parent = aa_get_ns(parent);\n\tlist_add_rcu(&ns->base.list, &parent->sub_ns);\n\t/* add list ref */\n\taa_get_ns(ns);\n\tmutex_unlock(&ns->lock);\n\n\treturn ns;\n}"
  },
  {
    "function_name": "aa_lookupn_ns",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/policy_ns.c",
    "lines": "235-244",
    "snippet": "struct aa_ns *aa_lookupn_ns(struct aa_ns *view, const char *name, size_t n)\n{\n\tstruct aa_ns *ns = NULL;\n\n\trcu_read_lock();\n\tns = aa_get_ns(__aa_lookupn_ns(view, name, n));\n\trcu_read_unlock();\n\n\treturn ns;\n}",
    "includes": [
      "#include \"include/policy.h\"",
      "#include \"include/label.h\"",
      "#include \"include/policy_ns.h\"",
      "#include \"include/context.h\"",
      "#include \"include/apparmor.h\"",
      "#include <linux/string.h>",
      "#include <linux/slab.h>",
      "#include <linux/mutex.h>",
      "#include <linux/list.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "rcu_read_unlock",
          "args": [],
          "line": 241
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "aa_get_ns",
          "args": [
            "__aa_lookupn_ns(view, name, n)"
          ],
          "line": 240
        },
        "resolved": true,
        "details": {
          "function_name": "aa_get_ns",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/include/policy_ns.h",
          "lines": "116-122",
          "snippet": "static inline struct aa_ns *aa_get_ns(struct aa_ns *ns)\n{\n\tif (ns)\n\t\taa_get_profile(ns->unconfined);\n\n\treturn ns;\n}",
          "includes": [
            "#include \"policy.h\"",
            "#include \"label.h\"",
            "#include \"apparmorfs.h\"",
            "#include \"apparmor.h\"",
            "#include <linux/kref.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"policy.h\"\n#include \"label.h\"\n#include \"apparmorfs.h\"\n#include \"apparmor.h\"\n#include <linux/kref.h>\n\nstatic inline struct aa_ns *aa_get_ns(struct aa_ns *ns)\n{\n\tif (ns)\n\t\taa_get_profile(ns->unconfined);\n\n\treturn ns;\n}"
        }
      },
      {
        "call_info": {
          "callee": "__aa_lookupn_ns",
          "args": [
            "view",
            "name",
            "n"
          ],
          "line": 240
        },
        "resolved": true,
        "details": {
          "function_name": "__aa_lookupn_ns",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/policy_ns.c",
          "lines": "204-222",
          "snippet": "struct aa_ns *__aa_lookupn_ns(struct aa_ns *view, const char *hname, size_t n)\n{\n\tstruct aa_ns *ns = view;\n\tconst char *split;\n\n\tfor (split = strnstr(hname, \"//\", n); split;\n\t     split = strnstr(hname, \"//\", n)) {\n\t\tns = __aa_findn_ns(&ns->sub_ns, hname, split - hname);\n\t\tif (!ns)\n\t\t\treturn NULL;\n\n\t\tn -= split + 2 - hname;\n\t\thname = split + 2;\n\t}\n\n\tif (n)\n\t\treturn __aa_findn_ns(&ns->sub_ns, hname, n);\n\treturn NULL;\n}",
          "includes": [
            "#include \"include/policy.h\"",
            "#include \"include/label.h\"",
            "#include \"include/policy_ns.h\"",
            "#include \"include/context.h\"",
            "#include \"include/apparmor.h\"",
            "#include <linux/string.h>",
            "#include <linux/slab.h>",
            "#include <linux/mutex.h>",
            "#include <linux/list.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"include/policy.h\"\n#include \"include/label.h\"\n#include \"include/policy_ns.h\"\n#include \"include/context.h\"\n#include \"include/apparmor.h\"\n#include <linux/string.h>\n#include <linux/slab.h>\n#include <linux/mutex.h>\n#include <linux/list.h>\n\nstruct aa_ns *__aa_lookupn_ns(struct aa_ns *view, const char *hname, size_t n)\n{\n\tstruct aa_ns *ns = view;\n\tconst char *split;\n\n\tfor (split = strnstr(hname, \"//\", n); split;\n\t     split = strnstr(hname, \"//\", n)) {\n\t\tns = __aa_findn_ns(&ns->sub_ns, hname, split - hname);\n\t\tif (!ns)\n\t\t\treturn NULL;\n\n\t\tn -= split + 2 - hname;\n\t\thname = split + 2;\n\t}\n\n\tif (n)\n\t\treturn __aa_findn_ns(&ns->sub_ns, hname, n);\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "rcu_read_lock",
          "args": [],
          "line": 239
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"include/policy.h\"\n#include \"include/label.h\"\n#include \"include/policy_ns.h\"\n#include \"include/context.h\"\n#include \"include/apparmor.h\"\n#include <linux/string.h>\n#include <linux/slab.h>\n#include <linux/mutex.h>\n#include <linux/list.h>\n\nstruct aa_ns *aa_lookupn_ns(struct aa_ns *view, const char *name, size_t n)\n{\n\tstruct aa_ns *ns = NULL;\n\n\trcu_read_lock();\n\tns = aa_get_ns(__aa_lookupn_ns(view, name, n));\n\trcu_read_unlock();\n\n\treturn ns;\n}"
  },
  {
    "function_name": "__aa_lookupn_ns",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/policy_ns.c",
    "lines": "204-222",
    "snippet": "struct aa_ns *__aa_lookupn_ns(struct aa_ns *view, const char *hname, size_t n)\n{\n\tstruct aa_ns *ns = view;\n\tconst char *split;\n\n\tfor (split = strnstr(hname, \"//\", n); split;\n\t     split = strnstr(hname, \"//\", n)) {\n\t\tns = __aa_findn_ns(&ns->sub_ns, hname, split - hname);\n\t\tif (!ns)\n\t\t\treturn NULL;\n\n\t\tn -= split + 2 - hname;\n\t\thname = split + 2;\n\t}\n\n\tif (n)\n\t\treturn __aa_findn_ns(&ns->sub_ns, hname, n);\n\treturn NULL;\n}",
    "includes": [
      "#include \"include/policy.h\"",
      "#include \"include/label.h\"",
      "#include \"include/policy_ns.h\"",
      "#include \"include/context.h\"",
      "#include \"include/apparmor.h\"",
      "#include <linux/string.h>",
      "#include <linux/slab.h>",
      "#include <linux/mutex.h>",
      "#include <linux/list.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "__aa_findn_ns",
          "args": [
            "&ns->sub_ns",
            "hname",
            "n"
          ],
          "line": 220
        },
        "resolved": true,
        "details": {
          "function_name": "__aa_findn_ns",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/include/policy_ns.h",
          "lines": "145-149",
          "snippet": "static inline struct aa_ns *__aa_findn_ns(struct list_head *head,\n\t\t\t\t\t  const char *name, size_t n)\n{\n\treturn (struct aa_ns *)__policy_strn_find(head, name, n);\n}",
          "includes": [
            "#include \"policy.h\"",
            "#include \"label.h\"",
            "#include \"apparmorfs.h\"",
            "#include \"apparmor.h\"",
            "#include <linux/kref.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"policy.h\"\n#include \"label.h\"\n#include \"apparmorfs.h\"\n#include \"apparmor.h\"\n#include <linux/kref.h>\n\nstatic inline struct aa_ns *__aa_findn_ns(struct list_head *head,\n\t\t\t\t\t  const char *name, size_t n)\n{\n\treturn (struct aa_ns *)__policy_strn_find(head, name, n);\n}"
        }
      },
      {
        "call_info": {
          "callee": "strnstr",
          "args": [
            "hname",
            "\"//\"",
            "n"
          ],
          "line": 210
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strnstr",
          "args": [
            "hname",
            "\"//\"",
            "n"
          ],
          "line": 209
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"include/policy.h\"\n#include \"include/label.h\"\n#include \"include/policy_ns.h\"\n#include \"include/context.h\"\n#include \"include/apparmor.h\"\n#include <linux/string.h>\n#include <linux/slab.h>\n#include <linux/mutex.h>\n#include <linux/list.h>\n\nstruct aa_ns *__aa_lookupn_ns(struct aa_ns *view, const char *hname, size_t n)\n{\n\tstruct aa_ns *ns = view;\n\tconst char *split;\n\n\tfor (split = strnstr(hname, \"//\", n); split;\n\t     split = strnstr(hname, \"//\", n)) {\n\t\tns = __aa_findn_ns(&ns->sub_ns, hname, split - hname);\n\t\tif (!ns)\n\t\t\treturn NULL;\n\n\t\tn -= split + 2 - hname;\n\t\thname = split + 2;\n\t}\n\n\tif (n)\n\t\treturn __aa_findn_ns(&ns->sub_ns, hname, n);\n\treturn NULL;\n}"
  },
  {
    "function_name": "aa_find_ns",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/policy_ns.c",
    "lines": "187-190",
    "snippet": "struct aa_ns *aa_find_ns(struct aa_ns *root, const char *name)\n{\n\treturn aa_findn_ns(root, name, strlen(name));\n}",
    "includes": [
      "#include \"include/policy.h\"",
      "#include \"include/label.h\"",
      "#include \"include/policy_ns.h\"",
      "#include \"include/context.h\"",
      "#include \"include/apparmor.h\"",
      "#include <linux/string.h>",
      "#include <linux/slab.h>",
      "#include <linux/mutex.h>",
      "#include <linux/list.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "aa_findn_ns",
          "args": [
            "root",
            "name",
            "strlen(name)"
          ],
          "line": 189
        },
        "resolved": true,
        "details": {
          "function_name": "aa_findn_ns",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/policy_ns.c",
          "lines": "166-175",
          "snippet": "struct aa_ns *aa_findn_ns(struct aa_ns *root, const char *name, size_t n)\n{\n\tstruct aa_ns *ns = NULL;\n\n\trcu_read_lock();\n\tns = aa_get_ns(__aa_findn_ns(&root->sub_ns, name, n));\n\trcu_read_unlock();\n\n\treturn ns;\n}",
          "includes": [
            "#include \"include/policy.h\"",
            "#include \"include/label.h\"",
            "#include \"include/policy_ns.h\"",
            "#include \"include/context.h\"",
            "#include \"include/apparmor.h\"",
            "#include <linux/string.h>",
            "#include <linux/slab.h>",
            "#include <linux/mutex.h>",
            "#include <linux/list.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"include/policy.h\"\n#include \"include/label.h\"\n#include \"include/policy_ns.h\"\n#include \"include/context.h\"\n#include \"include/apparmor.h\"\n#include <linux/string.h>\n#include <linux/slab.h>\n#include <linux/mutex.h>\n#include <linux/list.h>\n\nstruct aa_ns *aa_findn_ns(struct aa_ns *root, const char *name, size_t n)\n{\n\tstruct aa_ns *ns = NULL;\n\n\trcu_read_lock();\n\tns = aa_get_ns(__aa_findn_ns(&root->sub_ns, name, n));\n\trcu_read_unlock();\n\n\treturn ns;\n}"
        }
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "name"
          ],
          "line": 189
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"include/policy.h\"\n#include \"include/label.h\"\n#include \"include/policy_ns.h\"\n#include \"include/context.h\"\n#include \"include/apparmor.h\"\n#include <linux/string.h>\n#include <linux/slab.h>\n#include <linux/mutex.h>\n#include <linux/list.h>\n\nstruct aa_ns *aa_find_ns(struct aa_ns *root, const char *name)\n{\n\treturn aa_findn_ns(root, name, strlen(name));\n}"
  },
  {
    "function_name": "aa_findn_ns",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/policy_ns.c",
    "lines": "166-175",
    "snippet": "struct aa_ns *aa_findn_ns(struct aa_ns *root, const char *name, size_t n)\n{\n\tstruct aa_ns *ns = NULL;\n\n\trcu_read_lock();\n\tns = aa_get_ns(__aa_findn_ns(&root->sub_ns, name, n));\n\trcu_read_unlock();\n\n\treturn ns;\n}",
    "includes": [
      "#include \"include/policy.h\"",
      "#include \"include/label.h\"",
      "#include \"include/policy_ns.h\"",
      "#include \"include/context.h\"",
      "#include \"include/apparmor.h\"",
      "#include <linux/string.h>",
      "#include <linux/slab.h>",
      "#include <linux/mutex.h>",
      "#include <linux/list.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "rcu_read_unlock",
          "args": [],
          "line": 172
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "aa_get_ns",
          "args": [
            "__aa_findn_ns(&root->sub_ns, name, n)"
          ],
          "line": 171
        },
        "resolved": true,
        "details": {
          "function_name": "aa_get_ns",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/include/policy_ns.h",
          "lines": "116-122",
          "snippet": "static inline struct aa_ns *aa_get_ns(struct aa_ns *ns)\n{\n\tif (ns)\n\t\taa_get_profile(ns->unconfined);\n\n\treturn ns;\n}",
          "includes": [
            "#include \"policy.h\"",
            "#include \"label.h\"",
            "#include \"apparmorfs.h\"",
            "#include \"apparmor.h\"",
            "#include <linux/kref.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"policy.h\"\n#include \"label.h\"\n#include \"apparmorfs.h\"\n#include \"apparmor.h\"\n#include <linux/kref.h>\n\nstatic inline struct aa_ns *aa_get_ns(struct aa_ns *ns)\n{\n\tif (ns)\n\t\taa_get_profile(ns->unconfined);\n\n\treturn ns;\n}"
        }
      },
      {
        "call_info": {
          "callee": "__aa_findn_ns",
          "args": [
            "&root->sub_ns",
            "name",
            "n"
          ],
          "line": 171
        },
        "resolved": true,
        "details": {
          "function_name": "__aa_findn_ns",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/include/policy_ns.h",
          "lines": "145-149",
          "snippet": "static inline struct aa_ns *__aa_findn_ns(struct list_head *head,\n\t\t\t\t\t  const char *name, size_t n)\n{\n\treturn (struct aa_ns *)__policy_strn_find(head, name, n);\n}",
          "includes": [
            "#include \"policy.h\"",
            "#include \"label.h\"",
            "#include \"apparmorfs.h\"",
            "#include \"apparmor.h\"",
            "#include <linux/kref.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"policy.h\"\n#include \"label.h\"\n#include \"apparmorfs.h\"\n#include \"apparmor.h\"\n#include <linux/kref.h>\n\nstatic inline struct aa_ns *__aa_findn_ns(struct list_head *head,\n\t\t\t\t\t  const char *name, size_t n)\n{\n\treturn (struct aa_ns *)__policy_strn_find(head, name, n);\n}"
        }
      },
      {
        "call_info": {
          "callee": "rcu_read_lock",
          "args": [],
          "line": 170
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"include/policy.h\"\n#include \"include/label.h\"\n#include \"include/policy_ns.h\"\n#include \"include/context.h\"\n#include \"include/apparmor.h\"\n#include <linux/string.h>\n#include <linux/slab.h>\n#include <linux/mutex.h>\n#include <linux/list.h>\n\nstruct aa_ns *aa_findn_ns(struct aa_ns *root, const char *name, size_t n)\n{\n\tstruct aa_ns *ns = NULL;\n\n\trcu_read_lock();\n\tns = aa_get_ns(__aa_findn_ns(&root->sub_ns, name, n));\n\trcu_read_unlock();\n\n\treturn ns;\n}"
  },
  {
    "function_name": "aa_free_ns",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/policy_ns.c",
    "lines": "141-153",
    "snippet": "void aa_free_ns(struct aa_ns *ns)\n{\n\tif (!ns)\n\t\treturn;\n\n\taa_policy_destroy(&ns->base);\n\taa_labelset_destroy(&ns->labels);\n\taa_put_ns(ns->parent);\n\n\tns->unconfined->ns = NULL;\n\taa_free_profile(ns->unconfined);\n\tkzfree(ns);\n}",
    "includes": [
      "#include \"include/policy.h\"",
      "#include \"include/label.h\"",
      "#include \"include/policy_ns.h\"",
      "#include \"include/context.h\"",
      "#include \"include/apparmor.h\"",
      "#include <linux/string.h>",
      "#include <linux/slab.h>",
      "#include <linux/mutex.h>",
      "#include <linux/list.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "kzfree",
          "args": [
            "ns"
          ],
          "line": 152
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "aa_free_profile",
          "args": [
            "ns->unconfined"
          ],
          "line": 151
        },
        "resolved": true,
        "details": {
          "function_name": "aa_free_profile",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/policy.c",
          "lines": "210-245",
          "snippet": "void aa_free_profile(struct aa_profile *profile)\n{\n\tstruct rhashtable *rht;\n\n\tAA_DEBUG(\"%s(%p)\\n\", __func__, profile);\n\n\tif (!profile)\n\t\treturn;\n\n\t/* free children profiles */\n\taa_policy_destroy(&profile->base);\n\taa_put_profile(rcu_access_pointer(profile->parent));\n\n\taa_put_ns(profile->ns);\n\tkzfree(profile->rename);\n\n\taa_free_file_rules(&profile->file);\n\taa_free_cap_rules(&profile->caps);\n\taa_free_rlimit_rules(&profile->rlimits);\n\n\tkzfree(profile->dirname);\n\taa_put_dfa(profile->xmatch);\n\taa_put_dfa(profile->policy.dfa);\n\n\tif (profile->data) {\n\t\trht = profile->data;\n\t\tprofile->data = NULL;\n\t\trhashtable_free_and_destroy(rht, aa_free_data, NULL);\n\t\tkzfree(rht);\n\t}\n\n\tkzfree(profile->hash);\n\taa_put_loaddata(profile->rawdata);\n\n\tkzfree(profile);\n}",
          "includes": [
            "#include \"include/resource.h\"",
            "#include \"include/policy_unpack.h\"",
            "#include \"include/policy_ns.h\"",
            "#include \"include/policy.h\"",
            "#include \"include/path.h\"",
            "#include \"include/match.h\"",
            "#include \"include/ipc.h\"",
            "#include \"include/file.h\"",
            "#include \"include/context.h\"",
            "#include \"include/capability.h\"",
            "#include \"include/apparmor.h\"",
            "#include <linux/user_namespace.h>",
            "#include <linux/rculist.h>",
            "#include <linux/cred.h>",
            "#include <linux/string.h>",
            "#include <linux/spinlock.h>",
            "#include <linux/slab.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"include/resource.h\"\n#include \"include/policy_unpack.h\"\n#include \"include/policy_ns.h\"\n#include \"include/policy.h\"\n#include \"include/path.h\"\n#include \"include/match.h\"\n#include \"include/ipc.h\"\n#include \"include/file.h\"\n#include \"include/context.h\"\n#include \"include/capability.h\"\n#include \"include/apparmor.h\"\n#include <linux/user_namespace.h>\n#include <linux/rculist.h>\n#include <linux/cred.h>\n#include <linux/string.h>\n#include <linux/spinlock.h>\n#include <linux/slab.h>\n\nvoid aa_free_profile(struct aa_profile *profile)\n{\n\tstruct rhashtable *rht;\n\n\tAA_DEBUG(\"%s(%p)\\n\", __func__, profile);\n\n\tif (!profile)\n\t\treturn;\n\n\t/* free children profiles */\n\taa_policy_destroy(&profile->base);\n\taa_put_profile(rcu_access_pointer(profile->parent));\n\n\taa_put_ns(profile->ns);\n\tkzfree(profile->rename);\n\n\taa_free_file_rules(&profile->file);\n\taa_free_cap_rules(&profile->caps);\n\taa_free_rlimit_rules(&profile->rlimits);\n\n\tkzfree(profile->dirname);\n\taa_put_dfa(profile->xmatch);\n\taa_put_dfa(profile->policy.dfa);\n\n\tif (profile->data) {\n\t\trht = profile->data;\n\t\tprofile->data = NULL;\n\t\trhashtable_free_and_destroy(rht, aa_free_data, NULL);\n\t\tkzfree(rht);\n\t}\n\n\tkzfree(profile->hash);\n\taa_put_loaddata(profile->rawdata);\n\n\tkzfree(profile);\n}"
        }
      },
      {
        "call_info": {
          "callee": "aa_put_ns",
          "args": [
            "ns->parent"
          ],
          "line": 148
        },
        "resolved": true,
        "details": {
          "function_name": "aa_put_ns",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/include/policy_ns.h",
          "lines": "130-134",
          "snippet": "static inline void aa_put_ns(struct aa_ns *ns)\n{\n\tif (ns)\n\t\taa_put_profile(ns->unconfined);\n}",
          "includes": [
            "#include \"policy.h\"",
            "#include \"label.h\"",
            "#include \"apparmorfs.h\"",
            "#include \"apparmor.h\"",
            "#include <linux/kref.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"policy.h\"\n#include \"label.h\"\n#include \"apparmorfs.h\"\n#include \"apparmor.h\"\n#include <linux/kref.h>\n\nstatic inline void aa_put_ns(struct aa_ns *ns)\n{\n\tif (ns)\n\t\taa_put_profile(ns->unconfined);\n}"
        }
      },
      {
        "call_info": {
          "callee": "aa_labelset_destroy",
          "args": [
            "&ns->labels"
          ],
          "line": 147
        },
        "resolved": true,
        "details": {
          "function_name": "aa_labelset_destroy",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/label.c",
          "lines": "1941-1959",
          "snippet": "void aa_labelset_destroy(struct aa_labelset *ls)\n{\n\tstruct rb_node *node;\n\tunsigned long flags;\n\n\tAA_BUG(!ls);\n\n\twrite_lock_irqsave(&ls->lock, flags);\n\tfor (node = rb_first(&ls->root); node; node = rb_first(&ls->root)) {\n\t\tstruct aa_label *this = rb_entry(node, struct aa_label, node);\n\n\t\tif (labels_ns(this) != root_ns)\n\t\t\t__label_remove(this,\n\t\t\t\t       ns_unconfined(labels_ns(this)->parent));\n\t\telse\n\t\t\t__label_remove(this, NULL);\n\t}\n\twrite_unlock_irqrestore(&ls->lock, flags);\n}",
          "includes": [
            "#include \"include/secid.h\"",
            "#include \"include/policy.h\"",
            "#include \"include/label.h\"",
            "#include \"include/context.h\"",
            "#include \"include/apparmor.h\"",
            "#include <linux/sort.h>",
            "#include <linux/seq_file.h>",
            "#include <linux/audit.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"include/secid.h\"\n#include \"include/policy.h\"\n#include \"include/label.h\"\n#include \"include/context.h\"\n#include \"include/apparmor.h\"\n#include <linux/sort.h>\n#include <linux/seq_file.h>\n#include <linux/audit.h>\n\nvoid aa_labelset_destroy(struct aa_labelset *ls)\n{\n\tstruct rb_node *node;\n\tunsigned long flags;\n\n\tAA_BUG(!ls);\n\n\twrite_lock_irqsave(&ls->lock, flags);\n\tfor (node = rb_first(&ls->root); node; node = rb_first(&ls->root)) {\n\t\tstruct aa_label *this = rb_entry(node, struct aa_label, node);\n\n\t\tif (labels_ns(this) != root_ns)\n\t\t\t__label_remove(this,\n\t\t\t\t       ns_unconfined(labels_ns(this)->parent));\n\t\telse\n\t\t\t__label_remove(this, NULL);\n\t}\n\twrite_unlock_irqrestore(&ls->lock, flags);\n}"
        }
      },
      {
        "call_info": {
          "callee": "aa_policy_destroy",
          "args": [
            "&ns->base"
          ],
          "line": 146
        },
        "resolved": true,
        "details": {
          "function_name": "aa_policy_destroy",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/lib.c",
          "lines": "510-517",
          "snippet": "void aa_policy_destroy(struct aa_policy *policy)\n{\n\tAA_BUG(on_list_rcu(&policy->profiles));\n\tAA_BUG(on_list_rcu(&policy->list));\n\n\t/* don't free name as its a subset of hname */\n\taa_put_str(policy->hname);\n}",
          "includes": [
            "#include \"include/policy.h\"",
            "#include \"include/perms.h\"",
            "#include \"include/lib.h\"",
            "#include \"include/apparmor.h\"",
            "#include \"include/audit.h\"",
            "#include <linux/vmalloc.h>",
            "#include <linux/string.h>",
            "#include <linux/slab.h>",
            "#include <linux/mm.h>",
            "#include <linux/ctype.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"include/policy.h\"\n#include \"include/perms.h\"\n#include \"include/lib.h\"\n#include \"include/apparmor.h\"\n#include \"include/audit.h\"\n#include <linux/vmalloc.h>\n#include <linux/string.h>\n#include <linux/slab.h>\n#include <linux/mm.h>\n#include <linux/ctype.h>\n\nvoid aa_policy_destroy(struct aa_policy *policy)\n{\n\tAA_BUG(on_list_rcu(&policy->profiles));\n\tAA_BUG(on_list_rcu(&policy->list));\n\n\t/* don't free name as its a subset of hname */\n\taa_put_str(policy->hname);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"include/policy.h\"\n#include \"include/label.h\"\n#include \"include/policy_ns.h\"\n#include \"include/context.h\"\n#include \"include/apparmor.h\"\n#include <linux/string.h>\n#include <linux/slab.h>\n#include <linux/mutex.h>\n#include <linux/list.h>\n\nvoid aa_free_ns(struct aa_ns *ns)\n{\n\tif (!ns)\n\t\treturn;\n\n\taa_policy_destroy(&ns->base);\n\taa_labelset_destroy(&ns->labels);\n\taa_put_ns(ns->parent);\n\n\tns->unconfined->ns = NULL;\n\taa_free_profile(ns->unconfined);\n\tkzfree(ns);\n}"
  },
  {
    "function_name": "alloc_ns",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/policy_ns.c",
    "lines": "91-132",
    "snippet": "static struct aa_ns *alloc_ns(const char *prefix, const char *name)\n{\n\tstruct aa_ns *ns;\n\n\tns = kzalloc(sizeof(*ns), GFP_KERNEL);\n\tAA_DEBUG(\"%s(%p)\\n\", __func__, ns);\n\tif (!ns)\n\t\treturn NULL;\n\tif (!aa_policy_init(&ns->base, prefix, name, GFP_KERNEL))\n\t\tgoto fail_ns;\n\n\tINIT_LIST_HEAD(&ns->sub_ns);\n\tINIT_LIST_HEAD(&ns->rawdata_list);\n\tmutex_init(&ns->lock);\n\tinit_waitqueue_head(&ns->wait);\n\n\t/* released by aa_free_ns() */\n\tns->unconfined = aa_alloc_profile(\"unconfined\", NULL, GFP_KERNEL);\n\tif (!ns->unconfined)\n\t\tgoto fail_unconfined;\n\n\tns->unconfined->label.flags |= FLAG_IX_ON_NAME_ERROR |\n\t\tFLAG_IMMUTIBLE | FLAG_NS_COUNT | FLAG_UNCONFINED;\n\tns->unconfined->mode = APPARMOR_UNCONFINED;\n\tns->unconfined->file.dfa = aa_get_dfa(nulldfa);\n\tns->unconfined->policy.dfa = aa_get_dfa(nulldfa);\n\n\t/* ns and ns->unconfined share ns->unconfined refcount */\n\tns->unconfined->ns = ns;\n\n\tatomic_set(&ns->uniq_null, 0);\n\n\taa_labelset_init(&ns->labels);\n\n\treturn ns;\n\nfail_unconfined:\n\tkzfree(ns->base.hname);\nfail_ns:\n\tkzfree(ns);\n\treturn NULL;\n}",
    "includes": [
      "#include \"include/policy.h\"",
      "#include \"include/label.h\"",
      "#include \"include/policy_ns.h\"",
      "#include \"include/context.h\"",
      "#include \"include/apparmor.h\"",
      "#include <linux/string.h>",
      "#include <linux/slab.h>",
      "#include <linux/mutex.h>",
      "#include <linux/list.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "kzfree",
          "args": [
            "ns"
          ],
          "line": 130
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kzfree",
          "args": [
            "ns->base.hname"
          ],
          "line": 128
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "aa_labelset_init",
          "args": [
            "&ns->labels"
          ],
          "line": 123
        },
        "resolved": true,
        "details": {
          "function_name": "aa_labelset_init",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/label.c",
          "lines": "1964-1970",
          "snippet": "void aa_labelset_init(struct aa_labelset *ls)\n{\n\tAA_BUG(!ls);\n\n\trwlock_init(&ls->lock);\n\tls->root = RB_ROOT;\n}",
          "includes": [
            "#include \"include/secid.h\"",
            "#include \"include/policy.h\"",
            "#include \"include/label.h\"",
            "#include \"include/context.h\"",
            "#include \"include/apparmor.h\"",
            "#include <linux/sort.h>",
            "#include <linux/seq_file.h>",
            "#include <linux/audit.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"include/secid.h\"\n#include \"include/policy.h\"\n#include \"include/label.h\"\n#include \"include/context.h\"\n#include \"include/apparmor.h\"\n#include <linux/sort.h>\n#include <linux/seq_file.h>\n#include <linux/audit.h>\n\nvoid aa_labelset_init(struct aa_labelset *ls)\n{\n\tAA_BUG(!ls);\n\n\trwlock_init(&ls->lock);\n\tls->root = RB_ROOT;\n}"
        }
      },
      {
        "call_info": {
          "callee": "atomic_set",
          "args": [
            "&ns->uniq_null",
            "0"
          ],
          "line": 121
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "aa_get_dfa",
          "args": [
            "nulldfa"
          ],
          "line": 116
        },
        "resolved": true,
        "details": {
          "function_name": "aa_get_dfa",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/include/match.h",
          "lines": "142-148",
          "snippet": "static inline struct aa_dfa *aa_get_dfa(struct aa_dfa *dfa)\n{\n\tif (dfa)\n\t\tkref_get(&(dfa->count));\n\n\treturn dfa;\n}",
          "includes": [
            "#include <linux/kref.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/kref.h>\n\nstatic inline struct aa_dfa *aa_get_dfa(struct aa_dfa *dfa)\n{\n\tif (dfa)\n\t\tkref_get(&(dfa->count));\n\n\treturn dfa;\n}"
        }
      },
      {
        "call_info": {
          "callee": "aa_alloc_profile",
          "args": [
            "\"unconfined\"",
            "NULL",
            "GFP_KERNEL"
          ],
          "line": 108
        },
        "resolved": true,
        "details": {
          "function_name": "aa_alloc_profile",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/policy.c",
          "lines": "254-290",
          "snippet": "struct aa_profile *aa_alloc_profile(const char *hname, struct aa_proxy *proxy,\n\t\t\t\t    gfp_t gfp)\n{\n\tstruct aa_profile *profile;\n\n\t/* freed by free_profile - usually through aa_put_profile */\n\tprofile = kzalloc(sizeof(*profile) + sizeof(struct aa_profile *) * 2,\n\t\t\t  gfp);\n\tif (!profile)\n\t\treturn NULL;\n\n\tif (!aa_policy_init(&profile->base, NULL, hname, gfp))\n\t\tgoto fail;\n\tif (!aa_label_init(&profile->label, 1))\n\t\tgoto fail;\n\n\t/* update being set needed by fs interface */\n\tif (!proxy) {\n\t\tproxy = aa_alloc_proxy(&profile->label, gfp);\n\t\tif (!proxy)\n\t\t\tgoto fail;\n\t} else\n\t\taa_get_proxy(proxy);\n\tprofile->label.proxy = proxy;\n\n\tprofile->label.hname = profile->base.hname;\n\tprofile->label.flags |= FLAG_PROFILE;\n\tprofile->label.vec[0] = profile;\n\n\t/* refcount released by caller */\n\treturn profile;\n\nfail:\n\taa_free_profile(profile);\n\n\treturn NULL;\n}",
          "includes": [
            "#include \"include/resource.h\"",
            "#include \"include/policy_unpack.h\"",
            "#include \"include/policy_ns.h\"",
            "#include \"include/policy.h\"",
            "#include \"include/path.h\"",
            "#include \"include/match.h\"",
            "#include \"include/ipc.h\"",
            "#include \"include/file.h\"",
            "#include \"include/context.h\"",
            "#include \"include/capability.h\"",
            "#include \"include/apparmor.h\"",
            "#include <linux/user_namespace.h>",
            "#include <linux/rculist.h>",
            "#include <linux/cred.h>",
            "#include <linux/string.h>",
            "#include <linux/spinlock.h>",
            "#include <linux/slab.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"include/resource.h\"\n#include \"include/policy_unpack.h\"\n#include \"include/policy_ns.h\"\n#include \"include/policy.h\"\n#include \"include/path.h\"\n#include \"include/match.h\"\n#include \"include/ipc.h\"\n#include \"include/file.h\"\n#include \"include/context.h\"\n#include \"include/capability.h\"\n#include \"include/apparmor.h\"\n#include <linux/user_namespace.h>\n#include <linux/rculist.h>\n#include <linux/cred.h>\n#include <linux/string.h>\n#include <linux/spinlock.h>\n#include <linux/slab.h>\n\nstruct aa_profile *aa_alloc_profile(const char *hname, struct aa_proxy *proxy,\n\t\t\t\t    gfp_t gfp)\n{\n\tstruct aa_profile *profile;\n\n\t/* freed by free_profile - usually through aa_put_profile */\n\tprofile = kzalloc(sizeof(*profile) + sizeof(struct aa_profile *) * 2,\n\t\t\t  gfp);\n\tif (!profile)\n\t\treturn NULL;\n\n\tif (!aa_policy_init(&profile->base, NULL, hname, gfp))\n\t\tgoto fail;\n\tif (!aa_label_init(&profile->label, 1))\n\t\tgoto fail;\n\n\t/* update being set needed by fs interface */\n\tif (!proxy) {\n\t\tproxy = aa_alloc_proxy(&profile->label, gfp);\n\t\tif (!proxy)\n\t\t\tgoto fail;\n\t} else\n\t\taa_get_proxy(proxy);\n\tprofile->label.proxy = proxy;\n\n\tprofile->label.hname = profile->base.hname;\n\tprofile->label.flags |= FLAG_PROFILE;\n\tprofile->label.vec[0] = profile;\n\n\t/* refcount released by caller */\n\treturn profile;\n\nfail:\n\taa_free_profile(profile);\n\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "init_waitqueue_head",
          "args": [
            "&ns->wait"
          ],
          "line": 105
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "mutex_init",
          "args": [
            "&ns->lock"
          ],
          "line": 104
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "INIT_LIST_HEAD",
          "args": [
            "&ns->rawdata_list"
          ],
          "line": 103
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "INIT_LIST_HEAD",
          "args": [
            "&ns->sub_ns"
          ],
          "line": 102
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "aa_policy_init",
          "args": [
            "&ns->base",
            "prefix",
            "name",
            "GFP_KERNEL"
          ],
          "line": 99
        },
        "resolved": true,
        "details": {
          "function_name": "aa_policy_init",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/lib.c",
          "lines": "480-504",
          "snippet": "bool aa_policy_init(struct aa_policy *policy, const char *prefix,\n\t\t    const char *name, gfp_t gfp)\n{\n\tchar *hname;\n\n\t/* freed by policy_free */\n\tif (prefix) {\n\t\thname = aa_str_alloc(strlen(prefix) + strlen(name) + 3, gfp);\n\t\tif (hname)\n\t\t\tsprintf(hname, \"%s//%s\", prefix, name);\n\t} else {\n\t\thname = aa_str_alloc(strlen(name) + 1, gfp);\n\t\tif (hname)\n\t\t\tstrcpy(hname, name);\n\t}\n\tif (!hname)\n\t\treturn false;\n\tpolicy->hname = hname;\n\t/* base.name is a substring of fqname */\n\tpolicy->name = basename(policy->hname);\n\tINIT_LIST_HEAD(&policy->list);\n\tINIT_LIST_HEAD(&policy->profiles);\n\n\treturn true;\n}",
          "includes": [
            "#include \"include/policy.h\"",
            "#include \"include/perms.h\"",
            "#include \"include/lib.h\"",
            "#include \"include/apparmor.h\"",
            "#include \"include/audit.h\"",
            "#include <linux/vmalloc.h>",
            "#include <linux/string.h>",
            "#include <linux/slab.h>",
            "#include <linux/mm.h>",
            "#include <linux/ctype.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"include/policy.h\"\n#include \"include/perms.h\"\n#include \"include/lib.h\"\n#include \"include/apparmor.h\"\n#include \"include/audit.h\"\n#include <linux/vmalloc.h>\n#include <linux/string.h>\n#include <linux/slab.h>\n#include <linux/mm.h>\n#include <linux/ctype.h>\n\nbool aa_policy_init(struct aa_policy *policy, const char *prefix,\n\t\t    const char *name, gfp_t gfp)\n{\n\tchar *hname;\n\n\t/* freed by policy_free */\n\tif (prefix) {\n\t\thname = aa_str_alloc(strlen(prefix) + strlen(name) + 3, gfp);\n\t\tif (hname)\n\t\t\tsprintf(hname, \"%s//%s\", prefix, name);\n\t} else {\n\t\thname = aa_str_alloc(strlen(name) + 1, gfp);\n\t\tif (hname)\n\t\t\tstrcpy(hname, name);\n\t}\n\tif (!hname)\n\t\treturn false;\n\tpolicy->hname = hname;\n\t/* base.name is a substring of fqname */\n\tpolicy->name = basename(policy->hname);\n\tINIT_LIST_HEAD(&policy->list);\n\tINIT_LIST_HEAD(&policy->profiles);\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "AA_DEBUG",
          "args": [
            "\"%s(%p)\\n\"",
            "__func__",
            "ns"
          ],
          "line": 96
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kzalloc",
          "args": [
            "sizeof(*ns)",
            "GFP_KERNEL"
          ],
          "line": 95
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"include/policy.h\"\n#include \"include/label.h\"\n#include \"include/policy_ns.h\"\n#include \"include/context.h\"\n#include \"include/apparmor.h\"\n#include <linux/string.h>\n#include <linux/slab.h>\n#include <linux/mutex.h>\n#include <linux/list.h>\n\nstatic struct aa_ns *alloc_ns(const char *prefix, const char *name)\n{\n\tstruct aa_ns *ns;\n\n\tns = kzalloc(sizeof(*ns), GFP_KERNEL);\n\tAA_DEBUG(\"%s(%p)\\n\", __func__, ns);\n\tif (!ns)\n\t\treturn NULL;\n\tif (!aa_policy_init(&ns->base, prefix, name, GFP_KERNEL))\n\t\tgoto fail_ns;\n\n\tINIT_LIST_HEAD(&ns->sub_ns);\n\tINIT_LIST_HEAD(&ns->rawdata_list);\n\tmutex_init(&ns->lock);\n\tinit_waitqueue_head(&ns->wait);\n\n\t/* released by aa_free_ns() */\n\tns->unconfined = aa_alloc_profile(\"unconfined\", NULL, GFP_KERNEL);\n\tif (!ns->unconfined)\n\t\tgoto fail_unconfined;\n\n\tns->unconfined->label.flags |= FLAG_IX_ON_NAME_ERROR |\n\t\tFLAG_IMMUTIBLE | FLAG_NS_COUNT | FLAG_UNCONFINED;\n\tns->unconfined->mode = APPARMOR_UNCONFINED;\n\tns->unconfined->file.dfa = aa_get_dfa(nulldfa);\n\tns->unconfined->policy.dfa = aa_get_dfa(nulldfa);\n\n\t/* ns and ns->unconfined share ns->unconfined refcount */\n\tns->unconfined->ns = ns;\n\n\tatomic_set(&ns->uniq_null, 0);\n\n\taa_labelset_init(&ns->labels);\n\n\treturn ns;\n\nfail_unconfined:\n\tkzfree(ns->base.hname);\nfail_ns:\n\tkzfree(ns);\n\treturn NULL;\n}"
  },
  {
    "function_name": "aa_ns_name",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/policy_ns.c",
    "lines": "65-82",
    "snippet": "const char *aa_ns_name(struct aa_ns *curr, struct aa_ns *view, bool subns)\n{\n\t/* if view == curr then the namespace name isn't displayed */\n\tif (curr == view)\n\t\treturn \"\";\n\n\tif (aa_ns_visible(curr, view, subns)) {\n\t\t/* at this point if a ns is visible it is in a view ns\n\t\t * thus the curr ns.hname is a prefix of its name.\n\t\t * Only output the virtualized portion of the name\n\t\t * Add + 2 to skip over // separating curr hname prefix\n\t\t * from the visible tail of the views hname\n\t\t */\n\t\treturn view->base.hname + strlen(curr->base.hname) + 2;\n\t}\n\n\treturn aa_hidden_ns_name;\n}",
    "includes": [
      "#include \"include/policy.h\"",
      "#include \"include/label.h\"",
      "#include \"include/policy_ns.h\"",
      "#include \"include/context.h\"",
      "#include \"include/apparmor.h\"",
      "#include <linux/string.h>",
      "#include <linux/slab.h>",
      "#include <linux/mutex.h>",
      "#include <linux/list.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "const char *aa_hidden_ns_name = \"---\";"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "curr->base.hname"
          ],
          "line": 78
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "aa_ns_visible",
          "args": [
            "curr",
            "view",
            "subns"
          ],
          "line": 71
        },
        "resolved": true,
        "details": {
          "function_name": "aa_ns_visible",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/policy_ns.c",
          "lines": "41-55",
          "snippet": "bool aa_ns_visible(struct aa_ns *curr, struct aa_ns *view, bool subns)\n{\n\tif (curr == view)\n\t\treturn true;\n\n\tif (!subns)\n\t\treturn false;\n\n\tfor ( ; view; view = view->parent) {\n\t\tif (view->parent == curr)\n\t\t\treturn true;\n\t}\n\n\treturn false;\n}",
          "includes": [
            "#include \"include/policy.h\"",
            "#include \"include/label.h\"",
            "#include \"include/policy_ns.h\"",
            "#include \"include/context.h\"",
            "#include \"include/apparmor.h\"",
            "#include <linux/string.h>",
            "#include <linux/slab.h>",
            "#include <linux/mutex.h>",
            "#include <linux/list.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"include/policy.h\"\n#include \"include/label.h\"\n#include \"include/policy_ns.h\"\n#include \"include/context.h\"\n#include \"include/apparmor.h\"\n#include <linux/string.h>\n#include <linux/slab.h>\n#include <linux/mutex.h>\n#include <linux/list.h>\n\nbool aa_ns_visible(struct aa_ns *curr, struct aa_ns *view, bool subns)\n{\n\tif (curr == view)\n\t\treturn true;\n\n\tif (!subns)\n\t\treturn false;\n\n\tfor ( ; view; view = view->parent) {\n\t\tif (view->parent == curr)\n\t\t\treturn true;\n\t}\n\n\treturn false;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"include/policy.h\"\n#include \"include/label.h\"\n#include \"include/policy_ns.h\"\n#include \"include/context.h\"\n#include \"include/apparmor.h\"\n#include <linux/string.h>\n#include <linux/slab.h>\n#include <linux/mutex.h>\n#include <linux/list.h>\n\nconst char *aa_hidden_ns_name = \"---\";\n\nconst char *aa_ns_name(struct aa_ns *curr, struct aa_ns *view, bool subns)\n{\n\t/* if view == curr then the namespace name isn't displayed */\n\tif (curr == view)\n\t\treturn \"\";\n\n\tif (aa_ns_visible(curr, view, subns)) {\n\t\t/* at this point if a ns is visible it is in a view ns\n\t\t * thus the curr ns.hname is a prefix of its name.\n\t\t * Only output the virtualized portion of the name\n\t\t * Add + 2 to skip over // separating curr hname prefix\n\t\t * from the visible tail of the views hname\n\t\t */\n\t\treturn view->base.hname + strlen(curr->base.hname) + 2;\n\t}\n\n\treturn aa_hidden_ns_name;\n}"
  },
  {
    "function_name": "aa_ns_visible",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/policy_ns.c",
    "lines": "41-55",
    "snippet": "bool aa_ns_visible(struct aa_ns *curr, struct aa_ns *view, bool subns)\n{\n\tif (curr == view)\n\t\treturn true;\n\n\tif (!subns)\n\t\treturn false;\n\n\tfor ( ; view; view = view->parent) {\n\t\tif (view->parent == curr)\n\t\t\treturn true;\n\t}\n\n\treturn false;\n}",
    "includes": [
      "#include \"include/policy.h\"",
      "#include \"include/label.h\"",
      "#include \"include/policy_ns.h\"",
      "#include \"include/context.h\"",
      "#include \"include/apparmor.h\"",
      "#include <linux/string.h>",
      "#include <linux/slab.h>",
      "#include <linux/mutex.h>",
      "#include <linux/list.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"include/policy.h\"\n#include \"include/label.h\"\n#include \"include/policy_ns.h\"\n#include \"include/context.h\"\n#include \"include/apparmor.h\"\n#include <linux/string.h>\n#include <linux/slab.h>\n#include <linux/mutex.h>\n#include <linux/list.h>\n\nbool aa_ns_visible(struct aa_ns *curr, struct aa_ns *view, bool subns)\n{\n\tif (curr == view)\n\t\treturn true;\n\n\tif (!subns)\n\t\treturn false;\n\n\tfor ( ; view; view = view->parent) {\n\t\tif (view->parent == curr)\n\t\t\treturn true;\n\t}\n\n\treturn false;\n}"
  }
]