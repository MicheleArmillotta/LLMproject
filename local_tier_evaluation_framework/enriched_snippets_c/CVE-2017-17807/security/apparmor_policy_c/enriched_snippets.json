[
  {
    "function_name": "aa_remove_profiles",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/policy.c",
    "lines": "1087-1155",
    "snippet": "ssize_t aa_remove_profiles(struct aa_ns *policy_ns, struct aa_label *subj,\n\t\t\t   char *fqname, size_t size)\n{\n\tstruct aa_ns *ns = NULL;\n\tstruct aa_profile *profile = NULL;\n\tconst char *name = fqname, *info = NULL;\n\tconst char *ns_name = NULL;\n\tssize_t error = 0;\n\n\tif (*fqname == 0) {\n\t\tinfo = \"no profile specified\";\n\t\terror = -ENOENT;\n\t\tgoto fail;\n\t}\n\n\tif (fqname[0] == ':') {\n\t\tsize_t ns_len;\n\n\t\tname = aa_splitn_fqname(fqname, size, &ns_name, &ns_len);\n\t\t/* released below */\n\t\tns = aa_lookupn_ns(policy_ns ? policy_ns : labels_ns(subj),\n\t\t\t\t   ns_name, ns_len);\n\t\tif (!ns) {\n\t\t\tinfo = \"namespace does not exist\";\n\t\t\terror = -ENOENT;\n\t\t\tgoto fail;\n\t\t}\n\t} else\n\t\t/* released below */\n\t\tns = aa_get_ns(policy_ns ? policy_ns : labels_ns(subj));\n\n\tif (!name) {\n\t\t/* remove namespace - can only happen if fqname[0] == ':' */\n\t\tmutex_lock_nested(&ns->parent->lock, ns->level);\n\t\t__aa_remove_ns(ns);\n\t\t__aa_bump_ns_revision(ns);\n\t\tmutex_unlock(&ns->parent->lock);\n\t} else {\n\t\t/* remove profile */\n\t\tmutex_lock_nested(&ns->lock, ns->level);\n\t\tprofile = aa_get_profile(__lookup_profile(&ns->base, name));\n\t\tif (!profile) {\n\t\t\terror = -ENOENT;\n\t\t\tinfo = \"profile does not exist\";\n\t\t\tgoto fail_ns_lock;\n\t\t}\n\t\tname = profile->base.hname;\n\t\t__remove_profile(profile);\n\t\t__aa_labelset_update_subtree(ns);\n\t\t__aa_bump_ns_revision(ns);\n\t\tmutex_unlock(&ns->lock);\n\t}\n\n\t/* don't fail removal if audit fails */\n\t(void) audit_policy(subj, OP_PROF_RM, ns_name, name, info,\n\t\t\t    error);\n\taa_put_ns(ns);\n\taa_put_profile(profile);\n\treturn size;\n\nfail_ns_lock:\n\tmutex_unlock(&ns->lock);\n\taa_put_ns(ns);\n\nfail:\n\t(void) audit_policy(subj, OP_PROF_RM, ns_name, name, info,\n\t\t\t    error);\n\treturn error;\n}",
    "includes": [
      "#include \"include/resource.h\"",
      "#include \"include/policy_unpack.h\"",
      "#include \"include/policy_ns.h\"",
      "#include \"include/policy.h\"",
      "#include \"include/path.h\"",
      "#include \"include/match.h\"",
      "#include \"include/ipc.h\"",
      "#include \"include/file.h\"",
      "#include \"include/context.h\"",
      "#include \"include/capability.h\"",
      "#include \"include/apparmor.h\"",
      "#include <linux/user_namespace.h>",
      "#include <linux/rculist.h>",
      "#include <linux/cred.h>",
      "#include <linux/string.h>",
      "#include <linux/spinlock.h>",
      "#include <linux/slab.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "audit_policy",
          "args": [
            "subj",
            "OP_PROF_RM",
            "ns_name",
            "name",
            "info",
            "error"
          ],
          "line": 1152
        },
        "resolved": true,
        "details": {
          "function_name": "audit_policy",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/policy.c",
          "lines": "615-630",
          "snippet": "static int audit_policy(struct aa_label *label, const char *op,\n\t\t\tconst char *ns_name, const char *name,\n\t\t\tconst char *info, int error)\n{\n\tDEFINE_AUDIT_DATA(sa, LSM_AUDIT_DATA_NONE, op);\n\n\taad(&sa)->iface.ns = ns_name;\n\taad(&sa)->name = name;\n\taad(&sa)->info = info;\n\taad(&sa)->error = error;\n\taad(&sa)->label = label;\n\n\taa_audit_msg(AUDIT_APPARMOR_STATUS, &sa, audit_cb);\n\n\treturn error;\n}",
          "includes": [
            "#include \"include/resource.h\"",
            "#include \"include/policy_unpack.h\"",
            "#include \"include/policy_ns.h\"",
            "#include \"include/policy.h\"",
            "#include \"include/path.h\"",
            "#include \"include/match.h\"",
            "#include \"include/ipc.h\"",
            "#include \"include/file.h\"",
            "#include \"include/context.h\"",
            "#include \"include/capability.h\"",
            "#include \"include/apparmor.h\"",
            "#include <linux/user_namespace.h>",
            "#include <linux/rculist.h>",
            "#include <linux/cred.h>",
            "#include <linux/string.h>",
            "#include <linux/spinlock.h>",
            "#include <linux/slab.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"include/resource.h\"\n#include \"include/policy_unpack.h\"\n#include \"include/policy_ns.h\"\n#include \"include/policy.h\"\n#include \"include/path.h\"\n#include \"include/match.h\"\n#include \"include/ipc.h\"\n#include \"include/file.h\"\n#include \"include/context.h\"\n#include \"include/capability.h\"\n#include \"include/apparmor.h\"\n#include <linux/user_namespace.h>\n#include <linux/rculist.h>\n#include <linux/cred.h>\n#include <linux/string.h>\n#include <linux/spinlock.h>\n#include <linux/slab.h>\n\nstatic int audit_policy(struct aa_label *label, const char *op,\n\t\t\tconst char *ns_name, const char *name,\n\t\t\tconst char *info, int error)\n{\n\tDEFINE_AUDIT_DATA(sa, LSM_AUDIT_DATA_NONE, op);\n\n\taad(&sa)->iface.ns = ns_name;\n\taad(&sa)->name = name;\n\taad(&sa)->info = info;\n\taad(&sa)->error = error;\n\taad(&sa)->label = label;\n\n\taa_audit_msg(AUDIT_APPARMOR_STATUS, &sa, audit_cb);\n\n\treturn error;\n}"
        }
      },
      {
        "call_info": {
          "callee": "aa_put_ns",
          "args": [
            "ns"
          ],
          "line": 1149
        },
        "resolved": true,
        "details": {
          "function_name": "aa_put_ns",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/include/policy_ns.h",
          "lines": "130-134",
          "snippet": "static inline void aa_put_ns(struct aa_ns *ns)\n{\n\tif (ns)\n\t\taa_put_profile(ns->unconfined);\n}",
          "includes": [
            "#include \"policy.h\"",
            "#include \"label.h\"",
            "#include \"apparmorfs.h\"",
            "#include \"apparmor.h\"",
            "#include <linux/kref.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"policy.h\"\n#include \"label.h\"\n#include \"apparmorfs.h\"\n#include \"apparmor.h\"\n#include <linux/kref.h>\n\nstatic inline void aa_put_ns(struct aa_ns *ns)\n{\n\tif (ns)\n\t\taa_put_profile(ns->unconfined);\n}"
        }
      },
      {
        "call_info": {
          "callee": "mutex_unlock",
          "args": [
            "&ns->lock"
          ],
          "line": 1148
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "aa_put_profile",
          "args": [
            "profile"
          ],
          "line": 1144
        },
        "resolved": true,
        "details": {
          "function_name": "aa_put_profile",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/include/policy.h",
          "lines": "277-281",
          "snippet": "static inline void aa_put_profile(struct aa_profile *p)\n{\n\tif (p)\n\t\tkref_put(&p->label.count, aa_label_kref);\n}",
          "includes": [
            "#include \"resource.h\"",
            "#include \"perms.h\"",
            "#include \"label.h\"",
            "#include \"lib.h\"",
            "#include \"file.h\"",
            "#include \"domain.h\"",
            "#include \"capability.h\"",
            "#include \"audit.h\"",
            "#include \"apparmor.h\"",
            "#include <linux/socket.h>",
            "#include <linux/slab.h>",
            "#include <linux/sched.h>",
            "#include <linux/rhashtable.h>",
            "#include <linux/kref.h>",
            "#include <linux/cred.h>",
            "#include <linux/capability.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"resource.h\"\n#include \"perms.h\"\n#include \"label.h\"\n#include \"lib.h\"\n#include \"file.h\"\n#include \"domain.h\"\n#include \"capability.h\"\n#include \"audit.h\"\n#include \"apparmor.h\"\n#include <linux/socket.h>\n#include <linux/slab.h>\n#include <linux/sched.h>\n#include <linux/rhashtable.h>\n#include <linux/kref.h>\n#include <linux/cred.h>\n#include <linux/capability.h>\n\nstatic inline void aa_put_profile(struct aa_profile *p)\n{\n\tif (p)\n\t\tkref_put(&p->label.count, aa_label_kref);\n}"
        }
      },
      {
        "call_info": {
          "callee": "mutex_unlock",
          "args": [
            "&ns->lock"
          ],
          "line": 1137
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "__aa_bump_ns_revision",
          "args": [
            "ns"
          ],
          "line": 1136
        },
        "resolved": true,
        "details": {
          "function_name": "__aa_bump_ns_revision",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/apparmorfs.c",
          "lines": "590-594",
          "snippet": "void __aa_bump_ns_revision(struct aa_ns *ns)\n{\n\tns->revision++;\n\twake_up_interruptible(&ns->wait);\n}",
          "includes": [
            "#include \"include/policy_unpack.h\"",
            "#include \"include/resource.h\"",
            "#include \"include/policy_ns.h\"",
            "#include \"include/policy.h\"",
            "#include \"include/label.h\"",
            "#include \"include/policy_ns.h\"",
            "#include \"include/ipc.h\"",
            "#include \"include/crypto.h\"",
            "#include \"include/context.h\"",
            "#include \"include/audit.h\"",
            "#include \"include/apparmorfs.h\"",
            "#include \"include/apparmor.h\"",
            "#include <uapi/linux/magic.h>",
            "#include <uapi/linux/major.h>",
            "#include <linux/poll.h>",
            "#include <linux/fs.h>",
            "#include <linux/rcupdate.h>",
            "#include <linux/capability.h>",
            "#include <linux/namei.h>",
            "#include <linux/mount.h>",
            "#include <linux/uaccess.h>",
            "#include <linux/seq_file.h>",
            "#include <linux/module.h>",
            "#include <linux/vmalloc.h>",
            "#include <linux/security.h>",
            "#include <linux/ctype.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"include/policy_unpack.h\"\n#include \"include/resource.h\"\n#include \"include/policy_ns.h\"\n#include \"include/policy.h\"\n#include \"include/label.h\"\n#include \"include/policy_ns.h\"\n#include \"include/ipc.h\"\n#include \"include/crypto.h\"\n#include \"include/context.h\"\n#include \"include/audit.h\"\n#include \"include/apparmorfs.h\"\n#include \"include/apparmor.h\"\n#include <uapi/linux/magic.h>\n#include <uapi/linux/major.h>\n#include <linux/poll.h>\n#include <linux/fs.h>\n#include <linux/rcupdate.h>\n#include <linux/capability.h>\n#include <linux/namei.h>\n#include <linux/mount.h>\n#include <linux/uaccess.h>\n#include <linux/seq_file.h>\n#include <linux/module.h>\n#include <linux/vmalloc.h>\n#include <linux/security.h>\n#include <linux/ctype.h>\n\nvoid __aa_bump_ns_revision(struct aa_ns *ns)\n{\n\tns->revision++;\n\twake_up_interruptible(&ns->wait);\n}"
        }
      },
      {
        "call_info": {
          "callee": "__aa_labelset_update_subtree",
          "args": [
            "ns"
          ],
          "line": 1135
        },
        "resolved": true,
        "details": {
          "function_name": "__aa_labelset_update_subtree",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/label.c",
          "lines": "2108-2122",
          "snippet": "void __aa_labelset_update_subtree(struct aa_ns *ns)\n{\n\tstruct aa_ns *child;\n\n\tAA_BUG(!ns);\n\tAA_BUG(!mutex_is_locked(&ns->lock));\n\n\t__labelset_update(ns);\n\n\tlist_for_each_entry(child, &ns->sub_ns, base.list) {\n\t\tmutex_lock_nested(&child->lock, child->level);\n\t\t__aa_labelset_update_subtree(child);\n\t\tmutex_unlock(&child->lock);\n\t}\n}",
          "includes": [
            "#include \"include/secid.h\"",
            "#include \"include/policy.h\"",
            "#include \"include/label.h\"",
            "#include \"include/context.h\"",
            "#include \"include/apparmor.h\"",
            "#include <linux/sort.h>",
            "#include <linux/seq_file.h>",
            "#include <linux/audit.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"include/secid.h\"\n#include \"include/policy.h\"\n#include \"include/label.h\"\n#include \"include/context.h\"\n#include \"include/apparmor.h\"\n#include <linux/sort.h>\n#include <linux/seq_file.h>\n#include <linux/audit.h>\n\nvoid __aa_labelset_update_subtree(struct aa_ns *ns)\n{\n\tstruct aa_ns *child;\n\n\tAA_BUG(!ns);\n\tAA_BUG(!mutex_is_locked(&ns->lock));\n\n\t__labelset_update(ns);\n\n\tlist_for_each_entry(child, &ns->sub_ns, base.list) {\n\t\tmutex_lock_nested(&child->lock, child->level);\n\t\t__aa_labelset_update_subtree(child);\n\t\tmutex_unlock(&child->lock);\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "__remove_profile",
          "args": [
            "profile"
          ],
          "line": 1134
        },
        "resolved": true,
        "details": {
          "function_name": "__remove_profile",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/policy.c",
          "lines": "159-171",
          "snippet": "static void __remove_profile(struct aa_profile *profile)\n{\n\tAA_BUG(!profile);\n\tAA_BUG(!profile->ns);\n\tAA_BUG(!mutex_is_locked(&profile->ns->lock));\n\n\t/* release any children lists first */\n\t__aa_profile_list_release(&profile->base.profiles);\n\t/* released by free_profile */\n\taa_label_remove(&profile->label);\n\t__aafs_profile_rmdir(profile);\n\t__list_remove_profile(profile);\n}",
          "includes": [
            "#include \"include/resource.h\"",
            "#include \"include/policy_unpack.h\"",
            "#include \"include/policy_ns.h\"",
            "#include \"include/policy.h\"",
            "#include \"include/path.h\"",
            "#include \"include/match.h\"",
            "#include \"include/ipc.h\"",
            "#include \"include/file.h\"",
            "#include \"include/context.h\"",
            "#include \"include/capability.h\"",
            "#include \"include/apparmor.h\"",
            "#include <linux/user_namespace.h>",
            "#include <linux/rculist.h>",
            "#include <linux/cred.h>",
            "#include <linux/string.h>",
            "#include <linux/spinlock.h>",
            "#include <linux/slab.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"include/resource.h\"\n#include \"include/policy_unpack.h\"\n#include \"include/policy_ns.h\"\n#include \"include/policy.h\"\n#include \"include/path.h\"\n#include \"include/match.h\"\n#include \"include/ipc.h\"\n#include \"include/file.h\"\n#include \"include/context.h\"\n#include \"include/capability.h\"\n#include \"include/apparmor.h\"\n#include <linux/user_namespace.h>\n#include <linux/rculist.h>\n#include <linux/cred.h>\n#include <linux/string.h>\n#include <linux/spinlock.h>\n#include <linux/slab.h>\n\nstatic void __remove_profile(struct aa_profile *profile)\n{\n\tAA_BUG(!profile);\n\tAA_BUG(!profile->ns);\n\tAA_BUG(!mutex_is_locked(&profile->ns->lock));\n\n\t/* release any children lists first */\n\t__aa_profile_list_release(&profile->base.profiles);\n\t/* released by free_profile */\n\taa_label_remove(&profile->label);\n\t__aafs_profile_rmdir(profile);\n\t__list_remove_profile(profile);\n}"
        }
      },
      {
        "call_info": {
          "callee": "aa_get_profile",
          "args": [
            "__lookup_profile(&ns->base, name)"
          ],
          "line": 1127
        },
        "resolved": true,
        "details": {
          "function_name": "aa_get_profile_rcu",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/include/policy.h",
          "lines": "260-271",
          "snippet": "static inline struct aa_profile *aa_get_profile_rcu(struct aa_profile __rcu **p)\n{\n\tstruct aa_profile *c;\n\n\trcu_read_lock();\n\tdo {\n\t\tc = rcu_dereference(*p);\n\t} while (c && !kref_get_unless_zero(&c->label.count));\n\trcu_read_unlock();\n\n\treturn c;\n}",
          "includes": [
            "#include \"resource.h\"",
            "#include \"perms.h\"",
            "#include \"label.h\"",
            "#include \"lib.h\"",
            "#include \"file.h\"",
            "#include \"domain.h\"",
            "#include \"capability.h\"",
            "#include \"audit.h\"",
            "#include \"apparmor.h\"",
            "#include <linux/socket.h>",
            "#include <linux/slab.h>",
            "#include <linux/sched.h>",
            "#include <linux/rhashtable.h>",
            "#include <linux/kref.h>",
            "#include <linux/cred.h>",
            "#include <linux/capability.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"resource.h\"\n#include \"perms.h\"\n#include \"label.h\"\n#include \"lib.h\"\n#include \"file.h\"\n#include \"domain.h\"\n#include \"capability.h\"\n#include \"audit.h\"\n#include \"apparmor.h\"\n#include <linux/socket.h>\n#include <linux/slab.h>\n#include <linux/sched.h>\n#include <linux/rhashtable.h>\n#include <linux/kref.h>\n#include <linux/cred.h>\n#include <linux/capability.h>\n\nstatic inline struct aa_profile *aa_get_profile_rcu(struct aa_profile __rcu **p)\n{\n\tstruct aa_profile *c;\n\n\trcu_read_lock();\n\tdo {\n\t\tc = rcu_dereference(*p);\n\t} while (c && !kref_get_unless_zero(&c->label.count));\n\trcu_read_unlock();\n\n\treturn c;\n}"
        }
      },
      {
        "call_info": {
          "callee": "__lookup_profile",
          "args": [
            "&ns->base",
            "name"
          ],
          "line": 1127
        },
        "resolved": true,
        "details": {
          "function_name": "__lookup_profile",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/policy.c",
          "lines": "416-420",
          "snippet": "static struct aa_profile *__lookup_profile(struct aa_policy *base,\n\t\t\t\t\t   const char *hname)\n{\n\treturn __lookupn_profile(base, hname, strlen(hname));\n}",
          "includes": [
            "#include \"include/resource.h\"",
            "#include \"include/policy_unpack.h\"",
            "#include \"include/policy_ns.h\"",
            "#include \"include/policy.h\"",
            "#include \"include/path.h\"",
            "#include \"include/match.h\"",
            "#include \"include/ipc.h\"",
            "#include \"include/file.h\"",
            "#include \"include/context.h\"",
            "#include \"include/capability.h\"",
            "#include \"include/apparmor.h\"",
            "#include <linux/user_namespace.h>",
            "#include <linux/rculist.h>",
            "#include <linux/cred.h>",
            "#include <linux/string.h>",
            "#include <linux/spinlock.h>",
            "#include <linux/slab.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"include/resource.h\"\n#include \"include/policy_unpack.h\"\n#include \"include/policy_ns.h\"\n#include \"include/policy.h\"\n#include \"include/path.h\"\n#include \"include/match.h\"\n#include \"include/ipc.h\"\n#include \"include/file.h\"\n#include \"include/context.h\"\n#include \"include/capability.h\"\n#include \"include/apparmor.h\"\n#include <linux/user_namespace.h>\n#include <linux/rculist.h>\n#include <linux/cred.h>\n#include <linux/string.h>\n#include <linux/spinlock.h>\n#include <linux/slab.h>\n\nstatic struct aa_profile *__lookup_profile(struct aa_policy *base,\n\t\t\t\t\t   const char *hname)\n{\n\treturn __lookupn_profile(base, hname, strlen(hname));\n}"
        }
      },
      {
        "call_info": {
          "callee": "mutex_lock_nested",
          "args": [
            "&ns->lock",
            "ns->level"
          ],
          "line": 1126
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "mutex_unlock",
          "args": [
            "&ns->parent->lock"
          ],
          "line": 1123
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "__aa_remove_ns",
          "args": [
            "ns"
          ],
          "line": 1121
        },
        "resolved": true,
        "details": {
          "function_name": "__aa_remove_ns",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/policy_ns.c",
          "lines": "364-370",
          "snippet": "void __aa_remove_ns(struct aa_ns *ns)\n{\n\t/* remove ns from namespace list */\n\tlist_del_rcu(&ns->base.list);\n\tdestroy_ns(ns);\n\taa_put_ns(ns);\n}",
          "includes": [
            "#include \"include/policy.h\"",
            "#include \"include/label.h\"",
            "#include \"include/policy_ns.h\"",
            "#include \"include/context.h\"",
            "#include \"include/apparmor.h\"",
            "#include <linux/string.h>",
            "#include <linux/slab.h>",
            "#include <linux/mutex.h>",
            "#include <linux/list.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"include/policy.h\"\n#include \"include/label.h\"\n#include \"include/policy_ns.h\"\n#include \"include/context.h\"\n#include \"include/apparmor.h\"\n#include <linux/string.h>\n#include <linux/slab.h>\n#include <linux/mutex.h>\n#include <linux/list.h>\n\nvoid __aa_remove_ns(struct aa_ns *ns)\n{\n\t/* remove ns from namespace list */\n\tlist_del_rcu(&ns->base.list);\n\tdestroy_ns(ns);\n\taa_put_ns(ns);\n}"
        }
      },
      {
        "call_info": {
          "callee": "mutex_lock_nested",
          "args": [
            "&ns->parent->lock",
            "ns->level"
          ],
          "line": 1120
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "aa_get_ns",
          "args": [
            "policy_ns ? policy_ns : labels_ns(subj)"
          ],
          "line": 1116
        },
        "resolved": true,
        "details": {
          "function_name": "aa_get_ns",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/include/policy_ns.h",
          "lines": "116-122",
          "snippet": "static inline struct aa_ns *aa_get_ns(struct aa_ns *ns)\n{\n\tif (ns)\n\t\taa_get_profile(ns->unconfined);\n\n\treturn ns;\n}",
          "includes": [
            "#include \"policy.h\"",
            "#include \"label.h\"",
            "#include \"apparmorfs.h\"",
            "#include \"apparmor.h\"",
            "#include <linux/kref.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"policy.h\"\n#include \"label.h\"\n#include \"apparmorfs.h\"\n#include \"apparmor.h\"\n#include <linux/kref.h>\n\nstatic inline struct aa_ns *aa_get_ns(struct aa_ns *ns)\n{\n\tif (ns)\n\t\taa_get_profile(ns->unconfined);\n\n\treturn ns;\n}"
        }
      },
      {
        "call_info": {
          "callee": "labels_ns",
          "args": [
            "subj"
          ],
          "line": 1116
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "aa_lookupn_ns",
          "args": [
            "policy_ns ? policy_ns : labels_ns(subj)",
            "ns_name",
            "ns_len"
          ],
          "line": 1107
        },
        "resolved": true,
        "details": {
          "function_name": "aa_lookupn_ns",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/policy_ns.c",
          "lines": "235-244",
          "snippet": "struct aa_ns *aa_lookupn_ns(struct aa_ns *view, const char *name, size_t n)\n{\n\tstruct aa_ns *ns = NULL;\n\n\trcu_read_lock();\n\tns = aa_get_ns(__aa_lookupn_ns(view, name, n));\n\trcu_read_unlock();\n\n\treturn ns;\n}",
          "includes": [
            "#include \"include/policy.h\"",
            "#include \"include/label.h\"",
            "#include \"include/policy_ns.h\"",
            "#include \"include/context.h\"",
            "#include \"include/apparmor.h\"",
            "#include <linux/string.h>",
            "#include <linux/slab.h>",
            "#include <linux/mutex.h>",
            "#include <linux/list.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"include/policy.h\"\n#include \"include/label.h\"\n#include \"include/policy_ns.h\"\n#include \"include/context.h\"\n#include \"include/apparmor.h\"\n#include <linux/string.h>\n#include <linux/slab.h>\n#include <linux/mutex.h>\n#include <linux/list.h>\n\nstruct aa_ns *aa_lookupn_ns(struct aa_ns *view, const char *name, size_t n)\n{\n\tstruct aa_ns *ns = NULL;\n\n\trcu_read_lock();\n\tns = aa_get_ns(__aa_lookupn_ns(view, name, n));\n\trcu_read_unlock();\n\n\treturn ns;\n}"
        }
      },
      {
        "call_info": {
          "callee": "labels_ns",
          "args": [
            "subj"
          ],
          "line": 1107
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "aa_splitn_fqname",
          "args": [
            "fqname",
            "size",
            "&ns_name",
            "&ns_len"
          ],
          "line": 1105
        },
        "resolved": true,
        "details": {
          "function_name": "aa_splitn_fqname",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/lib.c",
          "lines": "87-120",
          "snippet": "const char *aa_splitn_fqname(const char *fqname, size_t n, const char **ns_name,\n\t\t\t     size_t *ns_len)\n{\n\tconst char *end = fqname + n;\n\tconst char *name = skipn_spaces(fqname, n);\n\n\tif (!name)\n\t\treturn NULL;\n\t*ns_name = NULL;\n\t*ns_len = 0;\n\tif (name[0] == ':') {\n\t\tchar *split = strnchr(&name[1], end - &name[1], ':');\n\t\t*ns_name = skipn_spaces(&name[1], end - &name[1]);\n\t\tif (!*ns_name)\n\t\t\treturn NULL;\n\t\tif (split) {\n\t\t\t*ns_len = split - *ns_name;\n\t\t\tif (*ns_len == 0)\n\t\t\t\t*ns_name = NULL;\n\t\t\tsplit++;\n\t\t\tif (end - split > 1 && strncmp(split, \"//\", 2) == 0)\n\t\t\t\tsplit += 2;\n\t\t\tname = skipn_spaces(split, end - split);\n\t\t} else {\n\t\t\t/* a ns name without a following profile is allowed */\n\t\t\tname = NULL;\n\t\t\t*ns_len = end - *ns_name;\n\t\t}\n\t}\n\tif (name && *name == 0)\n\t\tname = NULL;\n\n\treturn name;\n}",
          "includes": [
            "#include \"include/policy.h\"",
            "#include \"include/perms.h\"",
            "#include \"include/lib.h\"",
            "#include \"include/apparmor.h\"",
            "#include \"include/audit.h\"",
            "#include <linux/vmalloc.h>",
            "#include <linux/string.h>",
            "#include <linux/slab.h>",
            "#include <linux/mm.h>",
            "#include <linux/ctype.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"include/policy.h\"\n#include \"include/perms.h\"\n#include \"include/lib.h\"\n#include \"include/apparmor.h\"\n#include \"include/audit.h\"\n#include <linux/vmalloc.h>\n#include <linux/string.h>\n#include <linux/slab.h>\n#include <linux/mm.h>\n#include <linux/ctype.h>\n\nconst char *aa_splitn_fqname(const char *fqname, size_t n, const char **ns_name,\n\t\t\t     size_t *ns_len)\n{\n\tconst char *end = fqname + n;\n\tconst char *name = skipn_spaces(fqname, n);\n\n\tif (!name)\n\t\treturn NULL;\n\t*ns_name = NULL;\n\t*ns_len = 0;\n\tif (name[0] == ':') {\n\t\tchar *split = strnchr(&name[1], end - &name[1], ':');\n\t\t*ns_name = skipn_spaces(&name[1], end - &name[1]);\n\t\tif (!*ns_name)\n\t\t\treturn NULL;\n\t\tif (split) {\n\t\t\t*ns_len = split - *ns_name;\n\t\t\tif (*ns_len == 0)\n\t\t\t\t*ns_name = NULL;\n\t\t\tsplit++;\n\t\t\tif (end - split > 1 && strncmp(split, \"//\", 2) == 0)\n\t\t\t\tsplit += 2;\n\t\t\tname = skipn_spaces(split, end - split);\n\t\t} else {\n\t\t\t/* a ns name without a following profile is allowed */\n\t\t\tname = NULL;\n\t\t\t*ns_len = end - *ns_name;\n\t\t}\n\t}\n\tif (name && *name == 0)\n\t\tname = NULL;\n\n\treturn name;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"include/resource.h\"\n#include \"include/policy_unpack.h\"\n#include \"include/policy_ns.h\"\n#include \"include/policy.h\"\n#include \"include/path.h\"\n#include \"include/match.h\"\n#include \"include/ipc.h\"\n#include \"include/file.h\"\n#include \"include/context.h\"\n#include \"include/capability.h\"\n#include \"include/apparmor.h\"\n#include <linux/user_namespace.h>\n#include <linux/rculist.h>\n#include <linux/cred.h>\n#include <linux/string.h>\n#include <linux/spinlock.h>\n#include <linux/slab.h>\n\nssize_t aa_remove_profiles(struct aa_ns *policy_ns, struct aa_label *subj,\n\t\t\t   char *fqname, size_t size)\n{\n\tstruct aa_ns *ns = NULL;\n\tstruct aa_profile *profile = NULL;\n\tconst char *name = fqname, *info = NULL;\n\tconst char *ns_name = NULL;\n\tssize_t error = 0;\n\n\tif (*fqname == 0) {\n\t\tinfo = \"no profile specified\";\n\t\terror = -ENOENT;\n\t\tgoto fail;\n\t}\n\n\tif (fqname[0] == ':') {\n\t\tsize_t ns_len;\n\n\t\tname = aa_splitn_fqname(fqname, size, &ns_name, &ns_len);\n\t\t/* released below */\n\t\tns = aa_lookupn_ns(policy_ns ? policy_ns : labels_ns(subj),\n\t\t\t\t   ns_name, ns_len);\n\t\tif (!ns) {\n\t\t\tinfo = \"namespace does not exist\";\n\t\t\terror = -ENOENT;\n\t\t\tgoto fail;\n\t\t}\n\t} else\n\t\t/* released below */\n\t\tns = aa_get_ns(policy_ns ? policy_ns : labels_ns(subj));\n\n\tif (!name) {\n\t\t/* remove namespace - can only happen if fqname[0] == ':' */\n\t\tmutex_lock_nested(&ns->parent->lock, ns->level);\n\t\t__aa_remove_ns(ns);\n\t\t__aa_bump_ns_revision(ns);\n\t\tmutex_unlock(&ns->parent->lock);\n\t} else {\n\t\t/* remove profile */\n\t\tmutex_lock_nested(&ns->lock, ns->level);\n\t\tprofile = aa_get_profile(__lookup_profile(&ns->base, name));\n\t\tif (!profile) {\n\t\t\terror = -ENOENT;\n\t\t\tinfo = \"profile does not exist\";\n\t\t\tgoto fail_ns_lock;\n\t\t}\n\t\tname = profile->base.hname;\n\t\t__remove_profile(profile);\n\t\t__aa_labelset_update_subtree(ns);\n\t\t__aa_bump_ns_revision(ns);\n\t\tmutex_unlock(&ns->lock);\n\t}\n\n\t/* don't fail removal if audit fails */\n\t(void) audit_policy(subj, OP_PROF_RM, ns_name, name, info,\n\t\t\t    error);\n\taa_put_ns(ns);\n\taa_put_profile(profile);\n\treturn size;\n\nfail_ns_lock:\n\tmutex_unlock(&ns->lock);\n\taa_put_ns(ns);\n\nfail:\n\t(void) audit_policy(subj, OP_PROF_RM, ns_name, name, info,\n\t\t\t    error);\n\treturn error;\n}"
  },
  {
    "function_name": "aa_replace_profiles",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/policy.c",
    "lines": "853-1071",
    "snippet": "ssize_t aa_replace_profiles(struct aa_ns *policy_ns, struct aa_label *label,\n\t\t\t    u32 mask, struct aa_loaddata *udata)\n{\n\tconst char *ns_name, *info = NULL;\n\tstruct aa_ns *ns = NULL;\n\tstruct aa_load_ent *ent, *tmp;\n\tstruct aa_loaddata *rawdata_ent;\n\tconst char *op;\n\tssize_t count, error;\n\tLIST_HEAD(lh);\n\n\top = mask & AA_MAY_REPLACE_POLICY ? OP_PROF_REPL : OP_PROF_LOAD;\n\taa_get_loaddata(udata);\n\t/* released below */\n\terror = aa_unpack(udata, &lh, &ns_name);\n\tif (error)\n\t\tgoto out;\n\n\t/* ensure that profiles are all for the same ns\n\t * TODO: update locking to remove this constaint. All profiles in\n\t *       the load set must succeed as a set or the load will\n\t *       fail. Sort ent list and take ns locks in hierarchy order\n\t */\n\tcount = 0;\n\tlist_for_each_entry(ent, &lh, list) {\n\t\tif (ns_name) {\n\t\t\tif (ent->ns_name &&\n\t\t\t    strcmp(ent->ns_name, ns_name) != 0) {\n\t\t\t\tinfo = \"policy load has mixed namespaces\";\n\t\t\t\terror = -EACCES;\n\t\t\t\tgoto fail;\n\t\t\t}\n\t\t} else if (ent->ns_name) {\n\t\t\tif (count) {\n\t\t\t\tinfo = \"policy load has mixed namespaces\";\n\t\t\t\terror = -EACCES;\n\t\t\t\tgoto fail;\n\t\t\t}\n\t\t\tns_name = ent->ns_name;\n\t\t} else\n\t\t\tcount++;\n\t}\n\tif (ns_name) {\n\t\tns = aa_prepare_ns(policy_ns ? policy_ns : labels_ns(label),\n\t\t\t\t   ns_name);\n\t\tif (IS_ERR(ns)) {\n\t\t\top = OP_PROF_LOAD;\n\t\t\tinfo = \"failed to prepare namespace\";\n\t\t\terror = PTR_ERR(ns);\n\t\t\tns = NULL;\n\t\t\tent = NULL;\n\t\t\tgoto fail;\n\t\t}\n\t} else\n\t\tns = aa_get_ns(policy_ns ? policy_ns : labels_ns(label));\n\n\tmutex_lock_nested(&ns->lock, ns->level);\n\t/* check for duplicate rawdata blobs: space and file dedup */\n\tlist_for_each_entry(rawdata_ent, &ns->rawdata_list, list) {\n\t\tif (aa_rawdata_eq(rawdata_ent, udata)) {\n\t\t\tstruct aa_loaddata *tmp;\n\n\t\t\ttmp = __aa_get_loaddata(rawdata_ent);\n\t\t\t/* check we didn't fail the race */\n\t\t\tif (tmp) {\n\t\t\t\taa_put_loaddata(udata);\n\t\t\t\tudata = tmp;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\t/* setup parent and ns info */\n\tlist_for_each_entry(ent, &lh, list) {\n\t\tstruct aa_policy *policy;\n\n\t\tent->new->rawdata = aa_get_loaddata(udata);\n\t\terror = __lookup_replace(ns, ent->new->base.hname,\n\t\t\t\t\t !(mask & AA_MAY_REPLACE_POLICY),\n\t\t\t\t\t &ent->old, &info);\n\t\tif (error)\n\t\t\tgoto fail_lock;\n\n\t\tif (ent->new->rename) {\n\t\t\terror = __lookup_replace(ns, ent->new->rename,\n\t\t\t\t\t\t!(mask & AA_MAY_REPLACE_POLICY),\n\t\t\t\t\t\t&ent->rename, &info);\n\t\t\tif (error)\n\t\t\t\tgoto fail_lock;\n\t\t}\n\n\t\t/* released when @new is freed */\n\t\tent->new->ns = aa_get_ns(ns);\n\n\t\tif (ent->old || ent->rename)\n\t\t\tcontinue;\n\n\t\t/* no ref on policy only use inside lock */\n\t\tpolicy = __lookup_parent(ns, ent->new->base.hname);\n\t\tif (!policy) {\n\t\t\tstruct aa_profile *p;\n\t\t\tp = __list_lookup_parent(&lh, ent->new);\n\t\t\tif (!p) {\n\t\t\t\terror = -ENOENT;\n\t\t\t\tinfo = \"parent does not exist\";\n\t\t\t\tgoto fail_lock;\n\t\t\t}\n\t\t\trcu_assign_pointer(ent->new->parent, aa_get_profile(p));\n\t\t} else if (policy != &ns->base) {\n\t\t\t/* released on profile replacement or free_profile */\n\t\t\tstruct aa_profile *p = (struct aa_profile *) policy;\n\t\t\trcu_assign_pointer(ent->new->parent, aa_get_profile(p));\n\t\t}\n\t}\n\n\t/* create new fs entries for introspection if needed */\n\tif (!udata->dents[AAFS_LOADDATA_DIR]) {\n\t\terror = __aa_fs_create_rawdata(ns, udata);\n\t\tif (error) {\n\t\t\tinfo = \"failed to create raw_data dir and files\";\n\t\t\tent = NULL;\n\t\t\tgoto fail_lock;\n\t\t}\n\t}\n\tlist_for_each_entry(ent, &lh, list) {\n\t\tif (!ent->old) {\n\t\t\tstruct dentry *parent;\n\t\t\tif (rcu_access_pointer(ent->new->parent)) {\n\t\t\t\tstruct aa_profile *p;\n\t\t\t\tp = aa_deref_parent(ent->new);\n\t\t\t\tparent = prof_child_dir(p);\n\t\t\t} else\n\t\t\t\tparent = ns_subprofs_dir(ent->new->ns);\n\t\t\terror = __aafs_profile_mkdir(ent->new, parent);\n\t\t}\n\n\t\tif (error) {\n\t\t\tinfo = \"failed to create\";\n\t\t\tgoto fail_lock;\n\t\t}\n\t}\n\n\t/* Done with checks that may fail - do actual replacement */\n\t__aa_bump_ns_revision(ns);\n\t__aa_loaddata_update(udata, ns->revision);\n\tlist_for_each_entry_safe(ent, tmp, &lh, list) {\n\t\tlist_del_init(&ent->list);\n\t\top = (!ent->old && !ent->rename) ? OP_PROF_LOAD : OP_PROF_REPL;\n\n\t\tif (ent->old && ent->old->rawdata == ent->new->rawdata) {\n\t\t\t/* dedup actual profile replacement */\n\t\t\taudit_policy(label, op, ns_name, ent->new->base.hname,\n\t\t\t\t     \"same as current profile, skipping\",\n\t\t\t\t     error);\n\t\t\tgoto skip;\n\t\t}\n\n\t\t/*\n\t\t * TODO: finer dedup based on profile range in data. Load set\n\t\t * can differ but profile may remain unchanged\n\t\t */\n\t\taudit_policy(label, op, ns_name, ent->new->base.hname, NULL,\n\t\t\t     error);\n\n\t\tif (ent->old) {\n\t\t\tshare_name(ent->old, ent->new);\n\t\t\t__replace_profile(ent->old, ent->new);\n\t\t} else {\n\t\t\tstruct list_head *lh;\n\n\t\t\tif (rcu_access_pointer(ent->new->parent)) {\n\t\t\t\tstruct aa_profile *parent;\n\n\t\t\t\tparent = update_to_newest_parent(ent->new);\n\t\t\t\tlh = &parent->base.profiles;\n\t\t\t} else\n\t\t\t\tlh = &ns->base.profiles;\n\t\t\t__add_profile(lh, ent->new);\n\t\t}\n\tskip:\n\t\taa_load_ent_free(ent);\n\t}\n\t__aa_labelset_update_subtree(ns);\n\tmutex_unlock(&ns->lock);\n\nout:\n\taa_put_ns(ns);\n\taa_put_loaddata(udata);\n\n\tif (error)\n\t\treturn error;\n\treturn udata->size;\n\nfail_lock:\n\tmutex_unlock(&ns->lock);\n\n\t/* audit cause of failure */\n\top = (ent && !ent->old) ? OP_PROF_LOAD : OP_PROF_REPL;\nfail:\n\t  audit_policy(label, op, ns_name, ent ? ent->new->base.hname : NULL,\n\t\t       info, error);\n\t/* audit status that rest of profiles in the atomic set failed too */\n\tinfo = \"valid profile in failed atomic policy load\";\n\tlist_for_each_entry(tmp, &lh, list) {\n\t\tif (tmp == ent) {\n\t\t\tinfo = \"unchecked profile in failed atomic policy load\";\n\t\t\t/* skip entry that caused failure */\n\t\t\tcontinue;\n\t\t}\n\t\top = (!tmp->old) ? OP_PROF_LOAD : OP_PROF_REPL;\n\t\taudit_policy(label, op, ns_name, tmp->new->base.hname, info,\n\t\t\t     error);\n\t}\n\tlist_for_each_entry_safe(ent, tmp, &lh, list) {\n\t\tlist_del_init(&ent->list);\n\t\taa_load_ent_free(ent);\n\t}\n\n\tgoto out;\n}",
    "includes": [
      "#include \"include/resource.h\"",
      "#include \"include/policy_unpack.h\"",
      "#include \"include/policy_ns.h\"",
      "#include \"include/policy.h\"",
      "#include \"include/path.h\"",
      "#include \"include/match.h\"",
      "#include \"include/ipc.h\"",
      "#include \"include/file.h\"",
      "#include \"include/context.h\"",
      "#include \"include/capability.h\"",
      "#include \"include/apparmor.h\"",
      "#include <linux/user_namespace.h>",
      "#include <linux/rculist.h>",
      "#include <linux/cred.h>",
      "#include <linux/string.h>",
      "#include <linux/spinlock.h>",
      "#include <linux/slab.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "aa_load_ent_free",
          "args": [
            "ent"
          ],
          "line": 1067
        },
        "resolved": true,
        "details": {
          "function_name": "aa_load_ent_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/policy_unpack.c",
          "lines": "924-933",
          "snippet": "void aa_load_ent_free(struct aa_load_ent *ent)\n{\n\tif (ent) {\n\t\taa_put_profile(ent->rename);\n\t\taa_put_profile(ent->old);\n\t\taa_put_profile(ent->new);\n\t\tkfree(ent->ns_name);\n\t\tkzfree(ent);\n\t}\n}",
          "includes": [
            "#include \"include/policy_unpack.h\"",
            "#include \"include/policy.h\"",
            "#include \"include/path.h\"",
            "#include \"include/match.h\"",
            "#include \"include/crypto.h\"",
            "#include \"include/context.h\"",
            "#include \"include/audit.h\"",
            "#include \"include/apparmor.h\"",
            "#include <linux/errno.h>",
            "#include <linux/ctype.h>",
            "#include <asm/unaligned.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"include/policy_unpack.h\"\n#include \"include/policy.h\"\n#include \"include/path.h\"\n#include \"include/match.h\"\n#include \"include/crypto.h\"\n#include \"include/context.h\"\n#include \"include/audit.h\"\n#include \"include/apparmor.h\"\n#include <linux/errno.h>\n#include <linux/ctype.h>\n#include <asm/unaligned.h>\n\nvoid aa_load_ent_free(struct aa_load_ent *ent)\n{\n\tif (ent) {\n\t\taa_put_profile(ent->rename);\n\t\taa_put_profile(ent->old);\n\t\taa_put_profile(ent->new);\n\t\tkfree(ent->ns_name);\n\t\tkzfree(ent);\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "list_del_init",
          "args": [
            "&ent->list"
          ],
          "line": 1066
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "list_for_each_entry_safe",
          "args": [
            "ent",
            "tmp",
            "&lh",
            "list"
          ],
          "line": 1065
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "audit_policy",
          "args": [
            "label",
            "op",
            "ns_name",
            "tmp->new->base.hname",
            "info",
            "error"
          ],
          "line": 1062
        },
        "resolved": true,
        "details": {
          "function_name": "audit_policy",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/policy.c",
          "lines": "615-630",
          "snippet": "static int audit_policy(struct aa_label *label, const char *op,\n\t\t\tconst char *ns_name, const char *name,\n\t\t\tconst char *info, int error)\n{\n\tDEFINE_AUDIT_DATA(sa, LSM_AUDIT_DATA_NONE, op);\n\n\taad(&sa)->iface.ns = ns_name;\n\taad(&sa)->name = name;\n\taad(&sa)->info = info;\n\taad(&sa)->error = error;\n\taad(&sa)->label = label;\n\n\taa_audit_msg(AUDIT_APPARMOR_STATUS, &sa, audit_cb);\n\n\treturn error;\n}",
          "includes": [
            "#include \"include/resource.h\"",
            "#include \"include/policy_unpack.h\"",
            "#include \"include/policy_ns.h\"",
            "#include \"include/policy.h\"",
            "#include \"include/path.h\"",
            "#include \"include/match.h\"",
            "#include \"include/ipc.h\"",
            "#include \"include/file.h\"",
            "#include \"include/context.h\"",
            "#include \"include/capability.h\"",
            "#include \"include/apparmor.h\"",
            "#include <linux/user_namespace.h>",
            "#include <linux/rculist.h>",
            "#include <linux/cred.h>",
            "#include <linux/string.h>",
            "#include <linux/spinlock.h>",
            "#include <linux/slab.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"include/resource.h\"\n#include \"include/policy_unpack.h\"\n#include \"include/policy_ns.h\"\n#include \"include/policy.h\"\n#include \"include/path.h\"\n#include \"include/match.h\"\n#include \"include/ipc.h\"\n#include \"include/file.h\"\n#include \"include/context.h\"\n#include \"include/capability.h\"\n#include \"include/apparmor.h\"\n#include <linux/user_namespace.h>\n#include <linux/rculist.h>\n#include <linux/cred.h>\n#include <linux/string.h>\n#include <linux/spinlock.h>\n#include <linux/slab.h>\n\nstatic int audit_policy(struct aa_label *label, const char *op,\n\t\t\tconst char *ns_name, const char *name,\n\t\t\tconst char *info, int error)\n{\n\tDEFINE_AUDIT_DATA(sa, LSM_AUDIT_DATA_NONE, op);\n\n\taad(&sa)->iface.ns = ns_name;\n\taad(&sa)->name = name;\n\taad(&sa)->info = info;\n\taad(&sa)->error = error;\n\taad(&sa)->label = label;\n\n\taa_audit_msg(AUDIT_APPARMOR_STATUS, &sa, audit_cb);\n\n\treturn error;\n}"
        }
      },
      {
        "call_info": {
          "callee": "list_for_each_entry",
          "args": [
            "tmp",
            "&lh",
            "list"
          ],
          "line": 1055
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "mutex_unlock",
          "args": [
            "&ns->lock"
          ],
          "line": 1046
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "aa_put_loaddata",
          "args": [
            "udata"
          ],
          "line": 1039
        },
        "resolved": true,
        "details": {
          "function_name": "aa_put_loaddata",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/include/policy_unpack.h",
          "lines": "119-123",
          "snippet": "static inline void aa_put_loaddata(struct aa_loaddata *data)\n{\n\tif (data)\n\t\tkref_put(&data->count, aa_loaddata_kref);\n}",
          "includes": [
            "#include <linux/workqueue.h>",
            "#include <linux/dcache.h>",
            "#include <linux/kref.h>",
            "#include <linux/list.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/workqueue.h>\n#include <linux/dcache.h>\n#include <linux/kref.h>\n#include <linux/list.h>\n\nstatic inline void aa_put_loaddata(struct aa_loaddata *data)\n{\n\tif (data)\n\t\tkref_put(&data->count, aa_loaddata_kref);\n}"
        }
      },
      {
        "call_info": {
          "callee": "aa_put_ns",
          "args": [
            "ns"
          ],
          "line": 1038
        },
        "resolved": true,
        "details": {
          "function_name": "aa_put_ns",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/include/policy_ns.h",
          "lines": "130-134",
          "snippet": "static inline void aa_put_ns(struct aa_ns *ns)\n{\n\tif (ns)\n\t\taa_put_profile(ns->unconfined);\n}",
          "includes": [
            "#include \"policy.h\"",
            "#include \"label.h\"",
            "#include \"apparmorfs.h\"",
            "#include \"apparmor.h\"",
            "#include <linux/kref.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"policy.h\"\n#include \"label.h\"\n#include \"apparmorfs.h\"\n#include \"apparmor.h\"\n#include <linux/kref.h>\n\nstatic inline void aa_put_ns(struct aa_ns *ns)\n{\n\tif (ns)\n\t\taa_put_profile(ns->unconfined);\n}"
        }
      },
      {
        "call_info": {
          "callee": "mutex_unlock",
          "args": [
            "&ns->lock"
          ],
          "line": 1035
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "__aa_labelset_update_subtree",
          "args": [
            "ns"
          ],
          "line": 1034
        },
        "resolved": true,
        "details": {
          "function_name": "__aa_labelset_update_subtree",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/label.c",
          "lines": "2108-2122",
          "snippet": "void __aa_labelset_update_subtree(struct aa_ns *ns)\n{\n\tstruct aa_ns *child;\n\n\tAA_BUG(!ns);\n\tAA_BUG(!mutex_is_locked(&ns->lock));\n\n\t__labelset_update(ns);\n\n\tlist_for_each_entry(child, &ns->sub_ns, base.list) {\n\t\tmutex_lock_nested(&child->lock, child->level);\n\t\t__aa_labelset_update_subtree(child);\n\t\tmutex_unlock(&child->lock);\n\t}\n}",
          "includes": [
            "#include \"include/secid.h\"",
            "#include \"include/policy.h\"",
            "#include \"include/label.h\"",
            "#include \"include/context.h\"",
            "#include \"include/apparmor.h\"",
            "#include <linux/sort.h>",
            "#include <linux/seq_file.h>",
            "#include <linux/audit.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"include/secid.h\"\n#include \"include/policy.h\"\n#include \"include/label.h\"\n#include \"include/context.h\"\n#include \"include/apparmor.h\"\n#include <linux/sort.h>\n#include <linux/seq_file.h>\n#include <linux/audit.h>\n\nvoid __aa_labelset_update_subtree(struct aa_ns *ns)\n{\n\tstruct aa_ns *child;\n\n\tAA_BUG(!ns);\n\tAA_BUG(!mutex_is_locked(&ns->lock));\n\n\t__labelset_update(ns);\n\n\tlist_for_each_entry(child, &ns->sub_ns, base.list) {\n\t\tmutex_lock_nested(&child->lock, child->level);\n\t\t__aa_labelset_update_subtree(child);\n\t\tmutex_unlock(&child->lock);\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "__add_profile",
          "args": [
            "lh",
            "ent->new"
          ],
          "line": 1029
        },
        "resolved": true,
        "details": {
          "function_name": "__add_profile",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/policy.c",
          "lines": "114-129",
          "snippet": "static void __add_profile(struct list_head *list, struct aa_profile *profile)\n{\n\tstruct aa_label *l;\n\n\tAA_BUG(!list);\n\tAA_BUG(!profile);\n\tAA_BUG(!profile->ns);\n\tAA_BUG(!mutex_is_locked(&profile->ns->lock));\n\n\tlist_add_rcu(&profile->base.list, list);\n\t/* get list reference */\n\taa_get_profile(profile);\n\tl = aa_label_insert(&profile->ns->labels, &profile->label);\n\tAA_BUG(l != &profile->label);\n\taa_put_label(l);\n}",
          "includes": [
            "#include \"include/resource.h\"",
            "#include \"include/policy_unpack.h\"",
            "#include \"include/policy_ns.h\"",
            "#include \"include/policy.h\"",
            "#include \"include/path.h\"",
            "#include \"include/match.h\"",
            "#include \"include/ipc.h\"",
            "#include \"include/file.h\"",
            "#include \"include/context.h\"",
            "#include \"include/capability.h\"",
            "#include \"include/apparmor.h\"",
            "#include <linux/user_namespace.h>",
            "#include <linux/rculist.h>",
            "#include <linux/cred.h>",
            "#include <linux/string.h>",
            "#include <linux/spinlock.h>",
            "#include <linux/slab.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"include/resource.h\"\n#include \"include/policy_unpack.h\"\n#include \"include/policy_ns.h\"\n#include \"include/policy.h\"\n#include \"include/path.h\"\n#include \"include/match.h\"\n#include \"include/ipc.h\"\n#include \"include/file.h\"\n#include \"include/context.h\"\n#include \"include/capability.h\"\n#include \"include/apparmor.h\"\n#include <linux/user_namespace.h>\n#include <linux/rculist.h>\n#include <linux/cred.h>\n#include <linux/string.h>\n#include <linux/spinlock.h>\n#include <linux/slab.h>\n\nstatic void __add_profile(struct list_head *list, struct aa_profile *profile)\n{\n\tstruct aa_label *l;\n\n\tAA_BUG(!list);\n\tAA_BUG(!profile);\n\tAA_BUG(!profile->ns);\n\tAA_BUG(!mutex_is_locked(&profile->ns->lock));\n\n\tlist_add_rcu(&profile->base.list, list);\n\t/* get list reference */\n\taa_get_profile(profile);\n\tl = aa_label_insert(&profile->ns->labels, &profile->label);\n\tAA_BUG(l != &profile->label);\n\taa_put_label(l);\n}"
        }
      },
      {
        "call_info": {
          "callee": "update_to_newest_parent",
          "args": [
            "ent->new"
          ],
          "line": 1025
        },
        "resolved": true,
        "details": {
          "function_name": "update_to_newest_parent",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/policy.c",
          "lines": "822-838",
          "snippet": "static struct aa_profile *update_to_newest_parent(struct aa_profile *new)\n{\n\tstruct aa_profile *parent, *newest;\n\n\tparent = rcu_dereference_protected(new->parent,\n\t\t\t\t\t   mutex_is_locked(&new->ns->lock));\n\tnewest = aa_get_newest_profile(parent);\n\n\t/* parent replaced in this atomic set? */\n\tif (newest != parent) {\n\t\taa_put_profile(parent);\n\t\trcu_assign_pointer(new->parent, newest);\n\t} else\n\t\taa_put_profile(newest);\n\n\treturn newest;\n}",
          "includes": [
            "#include \"include/resource.h\"",
            "#include \"include/policy_unpack.h\"",
            "#include \"include/policy_ns.h\"",
            "#include \"include/policy.h\"",
            "#include \"include/path.h\"",
            "#include \"include/match.h\"",
            "#include \"include/ipc.h\"",
            "#include \"include/file.h\"",
            "#include \"include/context.h\"",
            "#include \"include/capability.h\"",
            "#include \"include/apparmor.h\"",
            "#include <linux/user_namespace.h>",
            "#include <linux/rculist.h>",
            "#include <linux/cred.h>",
            "#include <linux/string.h>",
            "#include <linux/spinlock.h>",
            "#include <linux/slab.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"include/resource.h\"\n#include \"include/policy_unpack.h\"\n#include \"include/policy_ns.h\"\n#include \"include/policy.h\"\n#include \"include/path.h\"\n#include \"include/match.h\"\n#include \"include/ipc.h\"\n#include \"include/file.h\"\n#include \"include/context.h\"\n#include \"include/capability.h\"\n#include \"include/apparmor.h\"\n#include <linux/user_namespace.h>\n#include <linux/rculist.h>\n#include <linux/cred.h>\n#include <linux/string.h>\n#include <linux/spinlock.h>\n#include <linux/slab.h>\n\nstatic struct aa_profile *update_to_newest_parent(struct aa_profile *new)\n{\n\tstruct aa_profile *parent, *newest;\n\n\tparent = rcu_dereference_protected(new->parent,\n\t\t\t\t\t   mutex_is_locked(&new->ns->lock));\n\tnewest = aa_get_newest_profile(parent);\n\n\t/* parent replaced in this atomic set? */\n\tif (newest != parent) {\n\t\taa_put_profile(parent);\n\t\trcu_assign_pointer(new->parent, newest);\n\t} else\n\t\taa_put_profile(newest);\n\n\treturn newest;\n}"
        }
      },
      {
        "call_info": {
          "callee": "rcu_access_pointer",
          "args": [
            "ent->new->parent"
          ],
          "line": 1022
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "__replace_profile",
          "args": [
            "ent->old",
            "ent->new"
          ],
          "line": 1018
        },
        "resolved": true,
        "details": {
          "function_name": "__replace_profile",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/policy.c",
          "lines": "738-782",
          "snippet": "static void __replace_profile(struct aa_profile *old, struct aa_profile *new)\n{\n\tstruct aa_profile *child, *tmp;\n\n\tif (!list_empty(&old->base.profiles)) {\n\t\tLIST_HEAD(lh);\n\t\tlist_splice_init_rcu(&old->base.profiles, &lh, synchronize_rcu);\n\n\t\tlist_for_each_entry_safe(child, tmp, &lh, base.list) {\n\t\t\tstruct aa_profile *p;\n\n\t\t\tlist_del_init(&child->base.list);\n\t\t\tp = __find_child(&new->base.profiles, child->base.name);\n\t\t\tif (p) {\n\t\t\t\t/* @p replaces @child  */\n\t\t\t\t__replace_profile(child, p);\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t/* inherit @child and its children */\n\t\t\t/* TODO: update hname of inherited children */\n\t\t\t/* list refcount transferred to @new */\n\t\t\tp = aa_deref_parent(child);\n\t\t\trcu_assign_pointer(child->parent, aa_get_profile(new));\n\t\t\tlist_add_rcu(&child->base.list, &new->base.profiles);\n\t\t\taa_put_profile(p);\n\t\t}\n\t}\n\n\tif (!rcu_access_pointer(new->parent)) {\n\t\tstruct aa_profile *parent = aa_deref_parent(old);\n\t\trcu_assign_pointer(new->parent, aa_get_profile(parent));\n\t}\n\taa_label_replace(&old->label, &new->label);\n\t/* migrate dents must come after label replacement b/c update */\n\t__aafs_profile_migrate_dents(old, new);\n\n\tif (list_empty(&new->base.list)) {\n\t\t/* new is not on a list already */\n\t\tlist_replace_rcu(&old->base.list, &new->base.list);\n\t\taa_get_profile(new);\n\t\taa_put_profile(old);\n\t} else\n\t\t__list_remove_profile(old);\n}",
          "includes": [
            "#include \"include/resource.h\"",
            "#include \"include/policy_unpack.h\"",
            "#include \"include/policy_ns.h\"",
            "#include \"include/policy.h\"",
            "#include \"include/path.h\"",
            "#include \"include/match.h\"",
            "#include \"include/ipc.h\"",
            "#include \"include/file.h\"",
            "#include \"include/context.h\"",
            "#include \"include/capability.h\"",
            "#include \"include/apparmor.h\"",
            "#include <linux/user_namespace.h>",
            "#include <linux/rculist.h>",
            "#include <linux/cred.h>",
            "#include <linux/string.h>",
            "#include <linux/spinlock.h>",
            "#include <linux/slab.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"include/resource.h\"\n#include \"include/policy_unpack.h\"\n#include \"include/policy_ns.h\"\n#include \"include/policy.h\"\n#include \"include/path.h\"\n#include \"include/match.h\"\n#include \"include/ipc.h\"\n#include \"include/file.h\"\n#include \"include/context.h\"\n#include \"include/capability.h\"\n#include \"include/apparmor.h\"\n#include <linux/user_namespace.h>\n#include <linux/rculist.h>\n#include <linux/cred.h>\n#include <linux/string.h>\n#include <linux/spinlock.h>\n#include <linux/slab.h>\n\nstatic void __replace_profile(struct aa_profile *old, struct aa_profile *new)\n{\n\tstruct aa_profile *child, *tmp;\n\n\tif (!list_empty(&old->base.profiles)) {\n\t\tLIST_HEAD(lh);\n\t\tlist_splice_init_rcu(&old->base.profiles, &lh, synchronize_rcu);\n\n\t\tlist_for_each_entry_safe(child, tmp, &lh, base.list) {\n\t\t\tstruct aa_profile *p;\n\n\t\t\tlist_del_init(&child->base.list);\n\t\t\tp = __find_child(&new->base.profiles, child->base.name);\n\t\t\tif (p) {\n\t\t\t\t/* @p replaces @child  */\n\t\t\t\t__replace_profile(child, p);\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t/* inherit @child and its children */\n\t\t\t/* TODO: update hname of inherited children */\n\t\t\t/* list refcount transferred to @new */\n\t\t\tp = aa_deref_parent(child);\n\t\t\trcu_assign_pointer(child->parent, aa_get_profile(new));\n\t\t\tlist_add_rcu(&child->base.list, &new->base.profiles);\n\t\t\taa_put_profile(p);\n\t\t}\n\t}\n\n\tif (!rcu_access_pointer(new->parent)) {\n\t\tstruct aa_profile *parent = aa_deref_parent(old);\n\t\trcu_assign_pointer(new->parent, aa_get_profile(parent));\n\t}\n\taa_label_replace(&old->label, &new->label);\n\t/* migrate dents must come after label replacement b/c update */\n\t__aafs_profile_migrate_dents(old, new);\n\n\tif (list_empty(&new->base.list)) {\n\t\t/* new is not on a list already */\n\t\tlist_replace_rcu(&old->base.list, &new->base.list);\n\t\taa_get_profile(new);\n\t\taa_put_profile(old);\n\t} else\n\t\t__list_remove_profile(old);\n}"
        }
      },
      {
        "call_info": {
          "callee": "share_name",
          "args": [
            "ent->old",
            "ent->new"
          ],
          "line": 1017
        },
        "resolved": true,
        "details": {
          "function_name": "share_name",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/policy.c",
          "lines": "810-817",
          "snippet": "static void share_name(struct aa_profile *old, struct aa_profile *new)\n{\n\taa_put_str(new->base.hname);\n\taa_get_str(old->base.hname);\n\tnew->base.hname = old->base.hname;\n\tnew->base.name = old->base.name;\n\tnew->label.hname = old->label.hname;\n}",
          "includes": [
            "#include \"include/resource.h\"",
            "#include \"include/policy_unpack.h\"",
            "#include \"include/policy_ns.h\"",
            "#include \"include/policy.h\"",
            "#include \"include/path.h\"",
            "#include \"include/match.h\"",
            "#include \"include/ipc.h\"",
            "#include \"include/file.h\"",
            "#include \"include/context.h\"",
            "#include \"include/capability.h\"",
            "#include \"include/apparmor.h\"",
            "#include <linux/user_namespace.h>",
            "#include <linux/rculist.h>",
            "#include <linux/cred.h>",
            "#include <linux/string.h>",
            "#include <linux/spinlock.h>",
            "#include <linux/slab.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"include/resource.h\"\n#include \"include/policy_unpack.h\"\n#include \"include/policy_ns.h\"\n#include \"include/policy.h\"\n#include \"include/path.h\"\n#include \"include/match.h\"\n#include \"include/ipc.h\"\n#include \"include/file.h\"\n#include \"include/context.h\"\n#include \"include/capability.h\"\n#include \"include/apparmor.h\"\n#include <linux/user_namespace.h>\n#include <linux/rculist.h>\n#include <linux/cred.h>\n#include <linux/string.h>\n#include <linux/spinlock.h>\n#include <linux/slab.h>\n\nstatic void share_name(struct aa_profile *old, struct aa_profile *new)\n{\n\taa_put_str(new->base.hname);\n\taa_get_str(old->base.hname);\n\tnew->base.hname = old->base.hname;\n\tnew->base.name = old->base.name;\n\tnew->label.hname = old->label.hname;\n}"
        }
      },
      {
        "call_info": {
          "callee": "list_del_init",
          "args": [
            "&ent->list"
          ],
          "line": 998
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "list_for_each_entry_safe",
          "args": [
            "ent",
            "tmp",
            "&lh",
            "list"
          ],
          "line": 997
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "__aa_loaddata_update",
          "args": [
            "udata",
            "ns->revision"
          ],
          "line": 996
        },
        "resolved": true,
        "details": {
          "function_name": "__aa_loaddata_update",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/policy_unpack.c",
          "lines": "126-139",
          "snippet": "void __aa_loaddata_update(struct aa_loaddata *data, long revision)\n{\n\tAA_BUG(!data);\n\tAA_BUG(!data->ns);\n\tAA_BUG(!data->dents[AAFS_LOADDATA_REVISION]);\n\tAA_BUG(!mutex_is_locked(&data->ns->lock));\n\tAA_BUG(data->revision > revision);\n\n\tdata->revision = revision;\n\td_inode(data->dents[AAFS_LOADDATA_DIR])->i_mtime =\n\t\tcurrent_time(d_inode(data->dents[AAFS_LOADDATA_DIR]));\n\td_inode(data->dents[AAFS_LOADDATA_REVISION])->i_mtime =\n\t\tcurrent_time(d_inode(data->dents[AAFS_LOADDATA_REVISION]));\n}",
          "includes": [
            "#include \"include/policy_unpack.h\"",
            "#include \"include/policy.h\"",
            "#include \"include/path.h\"",
            "#include \"include/match.h\"",
            "#include \"include/crypto.h\"",
            "#include \"include/context.h\"",
            "#include \"include/audit.h\"",
            "#include \"include/apparmor.h\"",
            "#include <linux/errno.h>",
            "#include <linux/ctype.h>",
            "#include <asm/unaligned.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"include/policy_unpack.h\"\n#include \"include/policy.h\"\n#include \"include/path.h\"\n#include \"include/match.h\"\n#include \"include/crypto.h\"\n#include \"include/context.h\"\n#include \"include/audit.h\"\n#include \"include/apparmor.h\"\n#include <linux/errno.h>\n#include <linux/ctype.h>\n#include <asm/unaligned.h>\n\nvoid __aa_loaddata_update(struct aa_loaddata *data, long revision)\n{\n\tAA_BUG(!data);\n\tAA_BUG(!data->ns);\n\tAA_BUG(!data->dents[AAFS_LOADDATA_REVISION]);\n\tAA_BUG(!mutex_is_locked(&data->ns->lock));\n\tAA_BUG(data->revision > revision);\n\n\tdata->revision = revision;\n\td_inode(data->dents[AAFS_LOADDATA_DIR])->i_mtime =\n\t\tcurrent_time(d_inode(data->dents[AAFS_LOADDATA_DIR]));\n\td_inode(data->dents[AAFS_LOADDATA_REVISION])->i_mtime =\n\t\tcurrent_time(d_inode(data->dents[AAFS_LOADDATA_REVISION]));\n}"
        }
      },
      {
        "call_info": {
          "callee": "__aa_bump_ns_revision",
          "args": [
            "ns"
          ],
          "line": 995
        },
        "resolved": true,
        "details": {
          "function_name": "__aa_bump_ns_revision",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/apparmorfs.c",
          "lines": "590-594",
          "snippet": "void __aa_bump_ns_revision(struct aa_ns *ns)\n{\n\tns->revision++;\n\twake_up_interruptible(&ns->wait);\n}",
          "includes": [
            "#include \"include/policy_unpack.h\"",
            "#include \"include/resource.h\"",
            "#include \"include/policy_ns.h\"",
            "#include \"include/policy.h\"",
            "#include \"include/label.h\"",
            "#include \"include/policy_ns.h\"",
            "#include \"include/ipc.h\"",
            "#include \"include/crypto.h\"",
            "#include \"include/context.h\"",
            "#include \"include/audit.h\"",
            "#include \"include/apparmorfs.h\"",
            "#include \"include/apparmor.h\"",
            "#include <uapi/linux/magic.h>",
            "#include <uapi/linux/major.h>",
            "#include <linux/poll.h>",
            "#include <linux/fs.h>",
            "#include <linux/rcupdate.h>",
            "#include <linux/capability.h>",
            "#include <linux/namei.h>",
            "#include <linux/mount.h>",
            "#include <linux/uaccess.h>",
            "#include <linux/seq_file.h>",
            "#include <linux/module.h>",
            "#include <linux/vmalloc.h>",
            "#include <linux/security.h>",
            "#include <linux/ctype.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"include/policy_unpack.h\"\n#include \"include/resource.h\"\n#include \"include/policy_ns.h\"\n#include \"include/policy.h\"\n#include \"include/label.h\"\n#include \"include/policy_ns.h\"\n#include \"include/ipc.h\"\n#include \"include/crypto.h\"\n#include \"include/context.h\"\n#include \"include/audit.h\"\n#include \"include/apparmorfs.h\"\n#include \"include/apparmor.h\"\n#include <uapi/linux/magic.h>\n#include <uapi/linux/major.h>\n#include <linux/poll.h>\n#include <linux/fs.h>\n#include <linux/rcupdate.h>\n#include <linux/capability.h>\n#include <linux/namei.h>\n#include <linux/mount.h>\n#include <linux/uaccess.h>\n#include <linux/seq_file.h>\n#include <linux/module.h>\n#include <linux/vmalloc.h>\n#include <linux/security.h>\n#include <linux/ctype.h>\n\nvoid __aa_bump_ns_revision(struct aa_ns *ns)\n{\n\tns->revision++;\n\twake_up_interruptible(&ns->wait);\n}"
        }
      },
      {
        "call_info": {
          "callee": "__aafs_profile_mkdir",
          "args": [
            "ent->new",
            "parent"
          ],
          "line": 985
        },
        "resolved": true,
        "details": {
          "function_name": "__aafs_profile_mkdir",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/apparmorfs.c",
          "lines": "1510-1623",
          "snippet": "int __aafs_profile_mkdir(struct aa_profile *profile, struct dentry *parent)\n{\n\tstruct aa_profile *child;\n\tstruct dentry *dent = NULL, *dir;\n\tint error;\n\n\tAA_BUG(!profile);\n\tAA_BUG(!mutex_is_locked(&profiles_ns(profile)->lock));\n\n\tif (!parent) {\n\t\tstruct aa_profile *p;\n\t\tp = aa_deref_parent(profile);\n\t\tdent = prof_dir(p);\n\t\t/* adding to parent that previously didn't have children */\n\t\tdent = aafs_create_dir(\"profiles\", dent);\n\t\tif (IS_ERR(dent))\n\t\t\tgoto fail;\n\t\tprof_child_dir(p) = parent = dent;\n\t}\n\n\tif (!profile->dirname) {\n\t\tint len, id_len;\n\t\tlen = mangle_name(profile->base.name, NULL);\n\t\tid_len = snprintf(NULL, 0, \".%ld\", profile->ns->uniq_id);\n\n\t\tprofile->dirname = kmalloc(len + id_len + 1, GFP_KERNEL);\n\t\tif (!profile->dirname) {\n\t\t\terror = -ENOMEM;\n\t\t\tgoto fail2;\n\t\t}\n\n\t\tmangle_name(profile->base.name, profile->dirname);\n\t\tsprintf(profile->dirname + len, \".%ld\", profile->ns->uniq_id++);\n\t}\n\n\tdent = aafs_create_dir(profile->dirname, parent);\n\tif (IS_ERR(dent))\n\t\tgoto fail;\n\tprof_dir(profile) = dir = dent;\n\n\tdent = create_profile_file(dir, \"name\", profile,\n\t\t\t\t   &seq_profile_name_fops);\n\tif (IS_ERR(dent))\n\t\tgoto fail;\n\tprofile->dents[AAFS_PROF_NAME] = dent;\n\n\tdent = create_profile_file(dir, \"mode\", profile,\n\t\t\t\t   &seq_profile_mode_fops);\n\tif (IS_ERR(dent))\n\t\tgoto fail;\n\tprofile->dents[AAFS_PROF_MODE] = dent;\n\n\tdent = create_profile_file(dir, \"attach\", profile,\n\t\t\t\t   &seq_profile_attach_fops);\n\tif (IS_ERR(dent))\n\t\tgoto fail;\n\tprofile->dents[AAFS_PROF_ATTACH] = dent;\n\n\tif (profile->hash) {\n\t\tdent = create_profile_file(dir, \"sha1\", profile,\n\t\t\t\t\t   &seq_profile_hash_fops);\n\t\tif (IS_ERR(dent))\n\t\t\tgoto fail;\n\t\tprofile->dents[AAFS_PROF_HASH] = dent;\n\t}\n\n\tif (profile->rawdata) {\n\t\tchar target[64];\n\t\tint depth = profile_depth(profile);\n\n\t\terror = gen_symlink_name(target, sizeof(target), depth,\n\t\t\t\t\t profile->rawdata->name, \"sha1\");\n\t\tif (error < 0)\n\t\t\tgoto fail2;\n\t\tdent = aafs_create_symlink(\"raw_sha1\", dir, target, NULL);\n\t\tif (IS_ERR(dent))\n\t\t\tgoto fail;\n\t\tprofile->dents[AAFS_PROF_RAW_HASH] = dent;\n\n\t\terror = gen_symlink_name(target, sizeof(target), depth,\n\t\t\t\t\t profile->rawdata->name, \"abi\");\n\t\tif (error < 0)\n\t\t\tgoto fail2;\n\t\tdent = aafs_create_symlink(\"raw_abi\", dir, target, NULL);\n\t\tif (IS_ERR(dent))\n\t\t\tgoto fail;\n\t\tprofile->dents[AAFS_PROF_RAW_ABI] = dent;\n\n\t\terror = gen_symlink_name(target, sizeof(target), depth,\n\t\t\t\t\t profile->rawdata->name, \"raw_data\");\n\t\tif (error < 0)\n\t\t\tgoto fail2;\n\t\tdent = aafs_create_symlink(\"raw_data\", dir, target, NULL);\n\t\tif (IS_ERR(dent))\n\t\t\tgoto fail;\n\t\tprofile->dents[AAFS_PROF_RAW_DATA] = dent;\n\t}\n\n\tlist_for_each_entry(child, &profile->base.profiles, base.list) {\n\t\terror = __aafs_profile_mkdir(child, prof_child_dir(profile));\n\t\tif (error)\n\t\t\tgoto fail2;\n\t}\n\n\treturn 0;\n\nfail:\n\terror = PTR_ERR(dent);\n\nfail2:\n\t__aafs_profile_rmdir(profile);\n\n\treturn error;\n}",
          "includes": [
            "#include \"include/policy_unpack.h\"",
            "#include \"include/resource.h\"",
            "#include \"include/policy_ns.h\"",
            "#include \"include/policy.h\"",
            "#include \"include/label.h\"",
            "#include \"include/policy_ns.h\"",
            "#include \"include/ipc.h\"",
            "#include \"include/crypto.h\"",
            "#include \"include/context.h\"",
            "#include \"include/audit.h\"",
            "#include \"include/apparmorfs.h\"",
            "#include \"include/apparmor.h\"",
            "#include <uapi/linux/magic.h>",
            "#include <uapi/linux/major.h>",
            "#include <linux/poll.h>",
            "#include <linux/fs.h>",
            "#include <linux/rcupdate.h>",
            "#include <linux/capability.h>",
            "#include <linux/namei.h>",
            "#include <linux/mount.h>",
            "#include <linux/uaccess.h>",
            "#include <linux/seq_file.h>",
            "#include <linux/module.h>",
            "#include <linux/vmalloc.h>",
            "#include <linux/security.h>",
            "#include <linux/ctype.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"include/policy_unpack.h\"\n#include \"include/resource.h\"\n#include \"include/policy_ns.h\"\n#include \"include/policy.h\"\n#include \"include/label.h\"\n#include \"include/policy_ns.h\"\n#include \"include/ipc.h\"\n#include \"include/crypto.h\"\n#include \"include/context.h\"\n#include \"include/audit.h\"\n#include \"include/apparmorfs.h\"\n#include \"include/apparmor.h\"\n#include <uapi/linux/magic.h>\n#include <uapi/linux/major.h>\n#include <linux/poll.h>\n#include <linux/fs.h>\n#include <linux/rcupdate.h>\n#include <linux/capability.h>\n#include <linux/namei.h>\n#include <linux/mount.h>\n#include <linux/uaccess.h>\n#include <linux/seq_file.h>\n#include <linux/module.h>\n#include <linux/vmalloc.h>\n#include <linux/security.h>\n#include <linux/ctype.h>\n\nint __aafs_profile_mkdir(struct aa_profile *profile, struct dentry *parent)\n{\n\tstruct aa_profile *child;\n\tstruct dentry *dent = NULL, *dir;\n\tint error;\n\n\tAA_BUG(!profile);\n\tAA_BUG(!mutex_is_locked(&profiles_ns(profile)->lock));\n\n\tif (!parent) {\n\t\tstruct aa_profile *p;\n\t\tp = aa_deref_parent(profile);\n\t\tdent = prof_dir(p);\n\t\t/* adding to parent that previously didn't have children */\n\t\tdent = aafs_create_dir(\"profiles\", dent);\n\t\tif (IS_ERR(dent))\n\t\t\tgoto fail;\n\t\tprof_child_dir(p) = parent = dent;\n\t}\n\n\tif (!profile->dirname) {\n\t\tint len, id_len;\n\t\tlen = mangle_name(profile->base.name, NULL);\n\t\tid_len = snprintf(NULL, 0, \".%ld\", profile->ns->uniq_id);\n\n\t\tprofile->dirname = kmalloc(len + id_len + 1, GFP_KERNEL);\n\t\tif (!profile->dirname) {\n\t\t\terror = -ENOMEM;\n\t\t\tgoto fail2;\n\t\t}\n\n\t\tmangle_name(profile->base.name, profile->dirname);\n\t\tsprintf(profile->dirname + len, \".%ld\", profile->ns->uniq_id++);\n\t}\n\n\tdent = aafs_create_dir(profile->dirname, parent);\n\tif (IS_ERR(dent))\n\t\tgoto fail;\n\tprof_dir(profile) = dir = dent;\n\n\tdent = create_profile_file(dir, \"name\", profile,\n\t\t\t\t   &seq_profile_name_fops);\n\tif (IS_ERR(dent))\n\t\tgoto fail;\n\tprofile->dents[AAFS_PROF_NAME] = dent;\n\n\tdent = create_profile_file(dir, \"mode\", profile,\n\t\t\t\t   &seq_profile_mode_fops);\n\tif (IS_ERR(dent))\n\t\tgoto fail;\n\tprofile->dents[AAFS_PROF_MODE] = dent;\n\n\tdent = create_profile_file(dir, \"attach\", profile,\n\t\t\t\t   &seq_profile_attach_fops);\n\tif (IS_ERR(dent))\n\t\tgoto fail;\n\tprofile->dents[AAFS_PROF_ATTACH] = dent;\n\n\tif (profile->hash) {\n\t\tdent = create_profile_file(dir, \"sha1\", profile,\n\t\t\t\t\t   &seq_profile_hash_fops);\n\t\tif (IS_ERR(dent))\n\t\t\tgoto fail;\n\t\tprofile->dents[AAFS_PROF_HASH] = dent;\n\t}\n\n\tif (profile->rawdata) {\n\t\tchar target[64];\n\t\tint depth = profile_depth(profile);\n\n\t\terror = gen_symlink_name(target, sizeof(target), depth,\n\t\t\t\t\t profile->rawdata->name, \"sha1\");\n\t\tif (error < 0)\n\t\t\tgoto fail2;\n\t\tdent = aafs_create_symlink(\"raw_sha1\", dir, target, NULL);\n\t\tif (IS_ERR(dent))\n\t\t\tgoto fail;\n\t\tprofile->dents[AAFS_PROF_RAW_HASH] = dent;\n\n\t\terror = gen_symlink_name(target, sizeof(target), depth,\n\t\t\t\t\t profile->rawdata->name, \"abi\");\n\t\tif (error < 0)\n\t\t\tgoto fail2;\n\t\tdent = aafs_create_symlink(\"raw_abi\", dir, target, NULL);\n\t\tif (IS_ERR(dent))\n\t\t\tgoto fail;\n\t\tprofile->dents[AAFS_PROF_RAW_ABI] = dent;\n\n\t\terror = gen_symlink_name(target, sizeof(target), depth,\n\t\t\t\t\t profile->rawdata->name, \"raw_data\");\n\t\tif (error < 0)\n\t\t\tgoto fail2;\n\t\tdent = aafs_create_symlink(\"raw_data\", dir, target, NULL);\n\t\tif (IS_ERR(dent))\n\t\t\tgoto fail;\n\t\tprofile->dents[AAFS_PROF_RAW_DATA] = dent;\n\t}\n\n\tlist_for_each_entry(child, &profile->base.profiles, base.list) {\n\t\terror = __aafs_profile_mkdir(child, prof_child_dir(profile));\n\t\tif (error)\n\t\t\tgoto fail2;\n\t}\n\n\treturn 0;\n\nfail:\n\terror = PTR_ERR(dent);\n\nfail2:\n\t__aafs_profile_rmdir(profile);\n\n\treturn error;\n}"
        }
      },
      {
        "call_info": {
          "callee": "ns_subprofs_dir",
          "args": [
            "ent->new->ns"
          ],
          "line": 984
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "prof_child_dir",
          "args": [
            "p"
          ],
          "line": 982
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "aa_deref_parent",
          "args": [
            "ent->new"
          ],
          "line": 981
        },
        "resolved": true,
        "details": {
          "function_name": "aa_deref_parent",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/include/policy_ns.h",
          "lines": "103-107",
          "snippet": "static inline struct aa_profile *aa_deref_parent(struct aa_profile *p)\n{\n\treturn rcu_dereference_protected(p->parent,\n\t\t\t\t\t mutex_is_locked(&p->ns->lock));\n}",
          "includes": [
            "#include \"policy.h\"",
            "#include \"label.h\"",
            "#include \"apparmorfs.h\"",
            "#include \"apparmor.h\"",
            "#include <linux/kref.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"policy.h\"\n#include \"label.h\"\n#include \"apparmorfs.h\"\n#include \"apparmor.h\"\n#include <linux/kref.h>\n\nstatic inline struct aa_profile *aa_deref_parent(struct aa_profile *p)\n{\n\treturn rcu_dereference_protected(p->parent,\n\t\t\t\t\t mutex_is_locked(&p->ns->lock));\n}"
        }
      },
      {
        "call_info": {
          "callee": "rcu_access_pointer",
          "args": [
            "ent->new->parent"
          ],
          "line": 979
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "list_for_each_entry",
          "args": [
            "ent",
            "&lh",
            "list"
          ],
          "line": 976
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "__aa_fs_create_rawdata",
          "args": [
            "ns",
            "udata"
          ],
          "line": 969
        },
        "resolved": true,
        "details": {
          "function_name": "__aa_fs_create_rawdata",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/apparmorfs.c",
          "lines": "1348-1409",
          "snippet": "int __aa_fs_create_rawdata(struct aa_ns *ns, struct aa_loaddata *rawdata)\n{\n\tstruct dentry *dent, *dir;\n\n\tAA_BUG(!ns);\n\tAA_BUG(!rawdata);\n\tAA_BUG(!mutex_is_locked(&ns->lock));\n\tAA_BUG(!ns_subdata_dir(ns));\n\n\t/*\n\t * just use ns revision dir was originally created at. This is\n\t * under ns->lock and if load is successful revision will be\n\t * bumped and is guaranteed to be unique\n\t */\n\trawdata->name = kasprintf(GFP_KERNEL, \"%ld\", ns->revision);\n\tif (!rawdata->name)\n\t\treturn -ENOMEM;\n\n\tdir = aafs_create_dir(rawdata->name, ns_subdata_dir(ns));\n\tif (IS_ERR(dir))\n\t\t/* ->name freed when rawdata freed */\n\t\treturn PTR_ERR(dir);\n\trawdata->dents[AAFS_LOADDATA_DIR] = dir;\n\n\tdent = aafs_create_file(\"abi\", S_IFREG | 0444, dir, rawdata,\n\t\t\t\t      &seq_rawdata_abi_fops);\n\tif (IS_ERR(dent))\n\t\tgoto fail;\n\trawdata->dents[AAFS_LOADDATA_ABI] = dent;\n\n\tdent = aafs_create_file(\"revision\", S_IFREG | 0444, dir, rawdata,\n\t\t\t\t      &seq_rawdata_revision_fops);\n\tif (IS_ERR(dent))\n\t\tgoto fail;\n\trawdata->dents[AAFS_LOADDATA_REVISION] = dent;\n\n\tif (aa_g_hash_policy) {\n\t\tdent = aafs_create_file(\"sha1\", S_IFREG | 0444, dir,\n\t\t\t\t\t      rawdata, &seq_rawdata_hash_fops);\n\t\tif (IS_ERR(dent))\n\t\t\tgoto fail;\n\t\trawdata->dents[AAFS_LOADDATA_HASH] = dent;\n\t}\n\n\tdent = aafs_create_file(\"raw_data\", S_IFREG | 0444,\n\t\t\t\t      dir, rawdata, &rawdata_fops);\n\tif (IS_ERR(dent))\n\t\tgoto fail;\n\trawdata->dents[AAFS_LOADDATA_DATA] = dent;\n\td_inode(dent)->i_size = rawdata->size;\n\n\trawdata->ns = aa_get_ns(ns);\n\tlist_add(&rawdata->list, &ns->rawdata_list);\n\t/* no refcount on inode rawdata */\n\n\treturn 0;\n\nfail:\n\tremove_rawdata_dents(rawdata);\n\n\treturn PTR_ERR(dent);\n}",
          "includes": [
            "#include \"include/policy_unpack.h\"",
            "#include \"include/resource.h\"",
            "#include \"include/policy_ns.h\"",
            "#include \"include/policy.h\"",
            "#include \"include/label.h\"",
            "#include \"include/policy_ns.h\"",
            "#include \"include/ipc.h\"",
            "#include \"include/crypto.h\"",
            "#include \"include/context.h\"",
            "#include \"include/audit.h\"",
            "#include \"include/apparmorfs.h\"",
            "#include \"include/apparmor.h\"",
            "#include <uapi/linux/magic.h>",
            "#include <uapi/linux/major.h>",
            "#include <linux/poll.h>",
            "#include <linux/fs.h>",
            "#include <linux/rcupdate.h>",
            "#include <linux/capability.h>",
            "#include <linux/namei.h>",
            "#include <linux/mount.h>",
            "#include <linux/uaccess.h>",
            "#include <linux/seq_file.h>",
            "#include <linux/module.h>",
            "#include <linux/vmalloc.h>",
            "#include <linux/security.h>",
            "#include <linux/ctype.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static const struct file_operations rawdata_fops = {\n\t.open = rawdata_open,\n\t.read = rawdata_read,\n\t.llseek = generic_file_llseek,\n\t.release = rawdata_release,\n};"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"include/policy_unpack.h\"\n#include \"include/resource.h\"\n#include \"include/policy_ns.h\"\n#include \"include/policy.h\"\n#include \"include/label.h\"\n#include \"include/policy_ns.h\"\n#include \"include/ipc.h\"\n#include \"include/crypto.h\"\n#include \"include/context.h\"\n#include \"include/audit.h\"\n#include \"include/apparmorfs.h\"\n#include \"include/apparmor.h\"\n#include <uapi/linux/magic.h>\n#include <uapi/linux/major.h>\n#include <linux/poll.h>\n#include <linux/fs.h>\n#include <linux/rcupdate.h>\n#include <linux/capability.h>\n#include <linux/namei.h>\n#include <linux/mount.h>\n#include <linux/uaccess.h>\n#include <linux/seq_file.h>\n#include <linux/module.h>\n#include <linux/vmalloc.h>\n#include <linux/security.h>\n#include <linux/ctype.h>\n\nstatic const struct file_operations rawdata_fops = {\n\t.open = rawdata_open,\n\t.read = rawdata_read,\n\t.llseek = generic_file_llseek,\n\t.release = rawdata_release,\n};\n\nint __aa_fs_create_rawdata(struct aa_ns *ns, struct aa_loaddata *rawdata)\n{\n\tstruct dentry *dent, *dir;\n\n\tAA_BUG(!ns);\n\tAA_BUG(!rawdata);\n\tAA_BUG(!mutex_is_locked(&ns->lock));\n\tAA_BUG(!ns_subdata_dir(ns));\n\n\t/*\n\t * just use ns revision dir was originally created at. This is\n\t * under ns->lock and if load is successful revision will be\n\t * bumped and is guaranteed to be unique\n\t */\n\trawdata->name = kasprintf(GFP_KERNEL, \"%ld\", ns->revision);\n\tif (!rawdata->name)\n\t\treturn -ENOMEM;\n\n\tdir = aafs_create_dir(rawdata->name, ns_subdata_dir(ns));\n\tif (IS_ERR(dir))\n\t\t/* ->name freed when rawdata freed */\n\t\treturn PTR_ERR(dir);\n\trawdata->dents[AAFS_LOADDATA_DIR] = dir;\n\n\tdent = aafs_create_file(\"abi\", S_IFREG | 0444, dir, rawdata,\n\t\t\t\t      &seq_rawdata_abi_fops);\n\tif (IS_ERR(dent))\n\t\tgoto fail;\n\trawdata->dents[AAFS_LOADDATA_ABI] = dent;\n\n\tdent = aafs_create_file(\"revision\", S_IFREG | 0444, dir, rawdata,\n\t\t\t\t      &seq_rawdata_revision_fops);\n\tif (IS_ERR(dent))\n\t\tgoto fail;\n\trawdata->dents[AAFS_LOADDATA_REVISION] = dent;\n\n\tif (aa_g_hash_policy) {\n\t\tdent = aafs_create_file(\"sha1\", S_IFREG | 0444, dir,\n\t\t\t\t\t      rawdata, &seq_rawdata_hash_fops);\n\t\tif (IS_ERR(dent))\n\t\t\tgoto fail;\n\t\trawdata->dents[AAFS_LOADDATA_HASH] = dent;\n\t}\n\n\tdent = aafs_create_file(\"raw_data\", S_IFREG | 0444,\n\t\t\t\t      dir, rawdata, &rawdata_fops);\n\tif (IS_ERR(dent))\n\t\tgoto fail;\n\trawdata->dents[AAFS_LOADDATA_DATA] = dent;\n\td_inode(dent)->i_size = rawdata->size;\n\n\trawdata->ns = aa_get_ns(ns);\n\tlist_add(&rawdata->list, &ns->rawdata_list);\n\t/* no refcount on inode rawdata */\n\n\treturn 0;\n\nfail:\n\tremove_rawdata_dents(rawdata);\n\n\treturn PTR_ERR(dent);\n}"
        }
      },
      {
        "call_info": {
          "callee": "rcu_assign_pointer",
          "args": [
            "ent->new->parent",
            "aa_get_profile(p)"
          ],
          "line": 963
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "aa_get_profile",
          "args": [
            "p"
          ],
          "line": 963
        },
        "resolved": true,
        "details": {
          "function_name": "aa_get_profile_rcu",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/include/policy.h",
          "lines": "260-271",
          "snippet": "static inline struct aa_profile *aa_get_profile_rcu(struct aa_profile __rcu **p)\n{\n\tstruct aa_profile *c;\n\n\trcu_read_lock();\n\tdo {\n\t\tc = rcu_dereference(*p);\n\t} while (c && !kref_get_unless_zero(&c->label.count));\n\trcu_read_unlock();\n\n\treturn c;\n}",
          "includes": [
            "#include \"resource.h\"",
            "#include \"perms.h\"",
            "#include \"label.h\"",
            "#include \"lib.h\"",
            "#include \"file.h\"",
            "#include \"domain.h\"",
            "#include \"capability.h\"",
            "#include \"audit.h\"",
            "#include \"apparmor.h\"",
            "#include <linux/socket.h>",
            "#include <linux/slab.h>",
            "#include <linux/sched.h>",
            "#include <linux/rhashtable.h>",
            "#include <linux/kref.h>",
            "#include <linux/cred.h>",
            "#include <linux/capability.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"resource.h\"\n#include \"perms.h\"\n#include \"label.h\"\n#include \"lib.h\"\n#include \"file.h\"\n#include \"domain.h\"\n#include \"capability.h\"\n#include \"audit.h\"\n#include \"apparmor.h\"\n#include <linux/socket.h>\n#include <linux/slab.h>\n#include <linux/sched.h>\n#include <linux/rhashtable.h>\n#include <linux/kref.h>\n#include <linux/cred.h>\n#include <linux/capability.h>\n\nstatic inline struct aa_profile *aa_get_profile_rcu(struct aa_profile __rcu **p)\n{\n\tstruct aa_profile *c;\n\n\trcu_read_lock();\n\tdo {\n\t\tc = rcu_dereference(*p);\n\t} while (c && !kref_get_unless_zero(&c->label.count));\n\trcu_read_unlock();\n\n\treturn c;\n}"
        }
      },
      {
        "call_info": {
          "callee": "rcu_assign_pointer",
          "args": [
            "ent->new->parent",
            "aa_get_profile(p)"
          ],
          "line": 959
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "__list_lookup_parent",
          "args": [
            "&lh",
            "ent->new"
          ],
          "line": 953
        },
        "resolved": true,
        "details": {
          "function_name": "__list_lookup_parent",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/policy.c",
          "lines": "702-723",
          "snippet": "static struct aa_profile *__list_lookup_parent(struct list_head *lh,\n\t\t\t\t\t       struct aa_profile *profile)\n{\n\tconst char *base = basename(profile->base.hname);\n\tlong len = base - profile->base.hname;\n\tstruct aa_load_ent *ent;\n\n\t/* parent won't have trailing // so remove from len */\n\tif (len <= 2)\n\t\treturn NULL;\n\tlen -= 2;\n\n\tlist_for_each_entry(ent, lh, list) {\n\t\tif (ent->new == profile)\n\t\t\tcontinue;\n\t\tif (strncmp(ent->new->base.hname, profile->base.hname, len) ==\n\t\t    0 && ent->new->base.hname[len] == 0)\n\t\t\treturn ent->new;\n\t}\n\n\treturn NULL;\n}",
          "includes": [
            "#include \"include/resource.h\"",
            "#include \"include/policy_unpack.h\"",
            "#include \"include/policy_ns.h\"",
            "#include \"include/policy.h\"",
            "#include \"include/path.h\"",
            "#include \"include/match.h\"",
            "#include \"include/ipc.h\"",
            "#include \"include/file.h\"",
            "#include \"include/context.h\"",
            "#include \"include/capability.h\"",
            "#include \"include/apparmor.h\"",
            "#include <linux/user_namespace.h>",
            "#include <linux/rculist.h>",
            "#include <linux/cred.h>",
            "#include <linux/string.h>",
            "#include <linux/spinlock.h>",
            "#include <linux/slab.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"include/resource.h\"\n#include \"include/policy_unpack.h\"\n#include \"include/policy_ns.h\"\n#include \"include/policy.h\"\n#include \"include/path.h\"\n#include \"include/match.h\"\n#include \"include/ipc.h\"\n#include \"include/file.h\"\n#include \"include/context.h\"\n#include \"include/capability.h\"\n#include \"include/apparmor.h\"\n#include <linux/user_namespace.h>\n#include <linux/rculist.h>\n#include <linux/cred.h>\n#include <linux/string.h>\n#include <linux/spinlock.h>\n#include <linux/slab.h>\n\nstatic struct aa_profile *__list_lookup_parent(struct list_head *lh,\n\t\t\t\t\t       struct aa_profile *profile)\n{\n\tconst char *base = basename(profile->base.hname);\n\tlong len = base - profile->base.hname;\n\tstruct aa_load_ent *ent;\n\n\t/* parent won't have trailing // so remove from len */\n\tif (len <= 2)\n\t\treturn NULL;\n\tlen -= 2;\n\n\tlist_for_each_entry(ent, lh, list) {\n\t\tif (ent->new == profile)\n\t\t\tcontinue;\n\t\tif (strncmp(ent->new->base.hname, profile->base.hname, len) ==\n\t\t    0 && ent->new->base.hname[len] == 0)\n\t\t\treturn ent->new;\n\t}\n\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "__lookup_parent",
          "args": [
            "ns",
            "ent->new->base.hname"
          ],
          "line": 950
        },
        "resolved": true,
        "details": {
          "function_name": "__lookup_parent",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/policy.c",
          "lines": "358-379",
          "snippet": "static struct aa_policy *__lookup_parent(struct aa_ns *ns,\n\t\t\t\t\t const char *hname)\n{\n\tstruct aa_policy *policy;\n\tstruct aa_profile *profile = NULL;\n\tchar *split;\n\n\tpolicy = &ns->base;\n\n\tfor (split = strstr(hname, \"//\"); split;) {\n\t\tprofile = __strn_find_child(&policy->profiles, hname,\n\t\t\t\t\t    split - hname);\n\t\tif (!profile)\n\t\t\treturn NULL;\n\t\tpolicy = &profile->base;\n\t\thname = split + 2;\n\t\tsplit = strstr(hname, \"//\");\n\t}\n\tif (!profile)\n\t\treturn &ns->base;\n\treturn &profile->base;\n}",
          "includes": [
            "#include \"include/resource.h\"",
            "#include \"include/policy_unpack.h\"",
            "#include \"include/policy_ns.h\"",
            "#include \"include/policy.h\"",
            "#include \"include/path.h\"",
            "#include \"include/match.h\"",
            "#include \"include/ipc.h\"",
            "#include \"include/file.h\"",
            "#include \"include/context.h\"",
            "#include \"include/capability.h\"",
            "#include \"include/apparmor.h\"",
            "#include <linux/user_namespace.h>",
            "#include <linux/rculist.h>",
            "#include <linux/cred.h>",
            "#include <linux/string.h>",
            "#include <linux/spinlock.h>",
            "#include <linux/slab.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"include/resource.h\"\n#include \"include/policy_unpack.h\"\n#include \"include/policy_ns.h\"\n#include \"include/policy.h\"\n#include \"include/path.h\"\n#include \"include/match.h\"\n#include \"include/ipc.h\"\n#include \"include/file.h\"\n#include \"include/context.h\"\n#include \"include/capability.h\"\n#include \"include/apparmor.h\"\n#include <linux/user_namespace.h>\n#include <linux/rculist.h>\n#include <linux/cred.h>\n#include <linux/string.h>\n#include <linux/spinlock.h>\n#include <linux/slab.h>\n\nstatic struct aa_policy *__lookup_parent(struct aa_ns *ns,\n\t\t\t\t\t const char *hname)\n{\n\tstruct aa_policy *policy;\n\tstruct aa_profile *profile = NULL;\n\tchar *split;\n\n\tpolicy = &ns->base;\n\n\tfor (split = strstr(hname, \"//\"); split;) {\n\t\tprofile = __strn_find_child(&policy->profiles, hname,\n\t\t\t\t\t    split - hname);\n\t\tif (!profile)\n\t\t\treturn NULL;\n\t\tpolicy = &profile->base;\n\t\thname = split + 2;\n\t\tsplit = strstr(hname, \"//\");\n\t}\n\tif (!profile)\n\t\treturn &ns->base;\n\treturn &profile->base;\n}"
        }
      },
      {
        "call_info": {
          "callee": "aa_get_ns",
          "args": [
            "ns"
          ],
          "line": 944
        },
        "resolved": true,
        "details": {
          "function_name": "aa_get_ns",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/include/policy_ns.h",
          "lines": "116-122",
          "snippet": "static inline struct aa_ns *aa_get_ns(struct aa_ns *ns)\n{\n\tif (ns)\n\t\taa_get_profile(ns->unconfined);\n\n\treturn ns;\n}",
          "includes": [
            "#include \"policy.h\"",
            "#include \"label.h\"",
            "#include \"apparmorfs.h\"",
            "#include \"apparmor.h\"",
            "#include <linux/kref.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"policy.h\"\n#include \"label.h\"\n#include \"apparmorfs.h\"\n#include \"apparmor.h\"\n#include <linux/kref.h>\n\nstatic inline struct aa_ns *aa_get_ns(struct aa_ns *ns)\n{\n\tif (ns)\n\t\taa_get_profile(ns->unconfined);\n\n\treturn ns;\n}"
        }
      },
      {
        "call_info": {
          "callee": "__lookup_replace",
          "args": [
            "ns",
            "ent->new->rename",
            "!(mask & AA_MAY_REPLACE_POLICY)",
            "&ent->rename",
            "&info"
          ],
          "line": 936
        },
        "resolved": true,
        "details": {
          "function_name": "__lookup_replace",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/policy.c",
          "lines": "794-808",
          "snippet": "static int __lookup_replace(struct aa_ns *ns, const char *hname,\n\t\t\t    bool noreplace, struct aa_profile **p,\n\t\t\t    const char **info)\n{\n\t*p = aa_get_profile(__lookup_profile(&ns->base, hname));\n\tif (*p) {\n\t\tint error = replacement_allowed(*p, noreplace, info);\n\t\tif (error) {\n\t\t\t*info = \"profile can not be replaced\";\n\t\t\treturn error;\n\t\t}\n\t}\n\n\treturn 0;\n}",
          "includes": [
            "#include \"include/resource.h\"",
            "#include \"include/policy_unpack.h\"",
            "#include \"include/policy_ns.h\"",
            "#include \"include/policy.h\"",
            "#include \"include/path.h\"",
            "#include \"include/match.h\"",
            "#include \"include/ipc.h\"",
            "#include \"include/file.h\"",
            "#include \"include/context.h\"",
            "#include \"include/capability.h\"",
            "#include \"include/apparmor.h\"",
            "#include <linux/user_namespace.h>",
            "#include <linux/rculist.h>",
            "#include <linux/cred.h>",
            "#include <linux/string.h>",
            "#include <linux/spinlock.h>",
            "#include <linux/slab.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"include/resource.h\"\n#include \"include/policy_unpack.h\"\n#include \"include/policy_ns.h\"\n#include \"include/policy.h\"\n#include \"include/path.h\"\n#include \"include/match.h\"\n#include \"include/ipc.h\"\n#include \"include/file.h\"\n#include \"include/context.h\"\n#include \"include/capability.h\"\n#include \"include/apparmor.h\"\n#include <linux/user_namespace.h>\n#include <linux/rculist.h>\n#include <linux/cred.h>\n#include <linux/string.h>\n#include <linux/spinlock.h>\n#include <linux/slab.h>\n\nstatic int __lookup_replace(struct aa_ns *ns, const char *hname,\n\t\t\t    bool noreplace, struct aa_profile **p,\n\t\t\t    const char **info)\n{\n\t*p = aa_get_profile(__lookup_profile(&ns->base, hname));\n\tif (*p) {\n\t\tint error = replacement_allowed(*p, noreplace, info);\n\t\tif (error) {\n\t\t\t*info = \"profile can not be replaced\";\n\t\t\treturn error;\n\t\t}\n\t}\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "aa_get_loaddata",
          "args": [
            "udata"
          ],
          "line": 928
        },
        "resolved": true,
        "details": {
          "function_name": "aa_get_loaddata",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/include/policy_unpack.h",
          "lines": "105-113",
          "snippet": "static inline struct aa_loaddata *\naa_get_loaddata(struct aa_loaddata *data)\n{\n\tstruct aa_loaddata *tmp = __aa_get_loaddata(data);\n\n\tAA_BUG(data && !tmp);\n\n\treturn tmp;\n}",
          "includes": [
            "#include <linux/workqueue.h>",
            "#include <linux/dcache.h>",
            "#include <linux/kref.h>",
            "#include <linux/list.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/workqueue.h>\n#include <linux/dcache.h>\n#include <linux/kref.h>\n#include <linux/list.h>\n\nstatic inline struct aa_loaddata *\naa_get_loaddata(struct aa_loaddata *data)\n{\n\tstruct aa_loaddata *tmp = __aa_get_loaddata(data);\n\n\tAA_BUG(data && !tmp);\n\n\treturn tmp;\n}"
        }
      },
      {
        "call_info": {
          "callee": "list_for_each_entry",
          "args": [
            "ent",
            "&lh",
            "list"
          ],
          "line": 925
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "__aa_get_loaddata",
          "args": [
            "rawdata_ent"
          ],
          "line": 915
        },
        "resolved": true,
        "details": {
          "function_name": "__aa_get_loaddata",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/include/policy_unpack.h",
          "lines": "88-95",
          "snippet": "static inline struct aa_loaddata *\n__aa_get_loaddata(struct aa_loaddata *data)\n{\n\tif (data && kref_get_unless_zero(&(data->count)))\n\t\treturn data;\n\n\treturn NULL;\n}",
          "includes": [
            "#include <linux/workqueue.h>",
            "#include <linux/dcache.h>",
            "#include <linux/kref.h>",
            "#include <linux/list.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/workqueue.h>\n#include <linux/dcache.h>\n#include <linux/kref.h>\n#include <linux/list.h>\n\nstatic inline struct aa_loaddata *\n__aa_get_loaddata(struct aa_loaddata *data)\n{\n\tif (data && kref_get_unless_zero(&(data->count)))\n\t\treturn data;\n\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "aa_rawdata_eq",
          "args": [
            "rawdata_ent",
            "udata"
          ],
          "line": 912
        },
        "resolved": true,
        "details": {
          "function_name": "aa_rawdata_eq",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/policy_unpack.c",
          "lines": "141-148",
          "snippet": "bool aa_rawdata_eq(struct aa_loaddata *l, struct aa_loaddata *r)\n{\n\tif (l->size != r->size)\n\t\treturn false;\n\tif (aa_g_hash_policy && memcmp(l->hash, r->hash, aa_hash_size()) != 0)\n\t\treturn false;\n\treturn memcmp(l->data, r->data, r->size) == 0;\n}",
          "includes": [
            "#include \"include/policy_unpack.h\"",
            "#include \"include/policy.h\"",
            "#include \"include/path.h\"",
            "#include \"include/match.h\"",
            "#include \"include/crypto.h\"",
            "#include \"include/context.h\"",
            "#include \"include/audit.h\"",
            "#include \"include/apparmor.h\"",
            "#include <linux/errno.h>",
            "#include <linux/ctype.h>",
            "#include <asm/unaligned.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"include/policy_unpack.h\"\n#include \"include/policy.h\"\n#include \"include/path.h\"\n#include \"include/match.h\"\n#include \"include/crypto.h\"\n#include \"include/context.h\"\n#include \"include/audit.h\"\n#include \"include/apparmor.h\"\n#include <linux/errno.h>\n#include <linux/ctype.h>\n#include <asm/unaligned.h>\n\nbool aa_rawdata_eq(struct aa_loaddata *l, struct aa_loaddata *r)\n{\n\tif (l->size != r->size)\n\t\treturn false;\n\tif (aa_g_hash_policy && memcmp(l->hash, r->hash, aa_hash_size()) != 0)\n\t\treturn false;\n\treturn memcmp(l->data, r->data, r->size) == 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "list_for_each_entry",
          "args": [
            "rawdata_ent",
            "&ns->rawdata_list",
            "list"
          ],
          "line": 911
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "mutex_lock_nested",
          "args": [
            "&ns->lock",
            "ns->level"
          ],
          "line": 909
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "labels_ns",
          "args": [
            "label"
          ],
          "line": 907
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "PTR_ERR",
          "args": [
            "ns"
          ],
          "line": 901
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "IS_ERR",
          "args": [
            "ns"
          ],
          "line": 898
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "aa_prepare_ns",
          "args": [
            "policy_ns ? policy_ns : labels_ns(label)",
            "ns_name"
          ],
          "line": 896
        },
        "resolved": true,
        "details": {
          "function_name": "aa_prepare_ns",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/policy_ns.c",
          "lines": "312-326",
          "snippet": "struct aa_ns *aa_prepare_ns(struct aa_ns *parent, const char *name)\n{\n\tstruct aa_ns *ns;\n\n\tmutex_lock_nested(&parent->lock, parent->level);\n\t/* try and find the specified ns and if it doesn't exist create it */\n\t/* released by caller */\n\tns = aa_get_ns(__aa_find_ns(&parent->sub_ns, name));\n\tif (!ns)\n\t\tns = __aa_create_ns(parent, name, NULL);\n\tmutex_unlock(&parent->lock);\n\n\t/* return ref */\n\treturn ns;\n}",
          "includes": [
            "#include \"include/policy.h\"",
            "#include \"include/label.h\"",
            "#include \"include/policy_ns.h\"",
            "#include \"include/context.h\"",
            "#include \"include/apparmor.h\"",
            "#include <linux/string.h>",
            "#include <linux/slab.h>",
            "#include <linux/mutex.h>",
            "#include <linux/list.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"include/policy.h\"\n#include \"include/label.h\"\n#include \"include/policy_ns.h\"\n#include \"include/context.h\"\n#include \"include/apparmor.h\"\n#include <linux/string.h>\n#include <linux/slab.h>\n#include <linux/mutex.h>\n#include <linux/list.h>\n\nstruct aa_ns *aa_prepare_ns(struct aa_ns *parent, const char *name)\n{\n\tstruct aa_ns *ns;\n\n\tmutex_lock_nested(&parent->lock, parent->level);\n\t/* try and find the specified ns and if it doesn't exist create it */\n\t/* released by caller */\n\tns = aa_get_ns(__aa_find_ns(&parent->sub_ns, name));\n\tif (!ns)\n\t\tns = __aa_create_ns(parent, name, NULL);\n\tmutex_unlock(&parent->lock);\n\n\t/* return ref */\n\treturn ns;\n}"
        }
      },
      {
        "call_info": {
          "callee": "labels_ns",
          "args": [
            "label"
          ],
          "line": 896
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "ent->ns_name",
            "ns_name"
          ],
          "line": 880
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "list_for_each_entry",
          "args": [
            "ent",
            "&lh",
            "list"
          ],
          "line": 877
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "aa_unpack",
          "args": [
            "udata",
            "&lh",
            "&ns_name"
          ],
          "line": 867
        },
        "resolved": true,
        "details": {
          "function_name": "aa_unpack",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/policy_unpack.c",
          "lines": "955-1023",
          "snippet": "int aa_unpack(struct aa_loaddata *udata, struct list_head *lh,\n\t      const char **ns)\n{\n\tstruct aa_load_ent *tmp, *ent;\n\tstruct aa_profile *profile = NULL;\n\tint error;\n\tstruct aa_ext e = {\n\t\t.start = udata->data,\n\t\t.end = udata->data + udata->size,\n\t\t.pos = udata->data,\n\t};\n\n\t*ns = NULL;\n\twhile (e.pos < e.end) {\n\t\tchar *ns_name = NULL;\n\t\tvoid *start;\n\t\terror = verify_header(&e, e.pos == e.start, ns);\n\t\tif (error)\n\t\t\tgoto fail;\n\n\t\tstart = e.pos;\n\t\tprofile = unpack_profile(&e, &ns_name);\n\t\tif (IS_ERR(profile)) {\n\t\t\terror = PTR_ERR(profile);\n\t\t\tgoto fail;\n\t\t}\n\n\t\terror = verify_profile(profile);\n\t\tif (error)\n\t\t\tgoto fail_profile;\n\n\t\tif (aa_g_hash_policy)\n\t\t\terror = aa_calc_profile_hash(profile, e.version, start,\n\t\t\t\t\t\t     e.pos - start);\n\t\tif (error)\n\t\t\tgoto fail_profile;\n\n\t\tent = aa_load_ent_alloc();\n\t\tif (!ent) {\n\t\t\terror = -ENOMEM;\n\t\t\tgoto fail_profile;\n\t\t}\n\n\t\tent->new = profile;\n\t\tent->ns_name = ns_name;\n\t\tlist_add_tail(&ent->list, lh);\n\t}\n\tudata->abi = e.version & K_ABI_MASK;\n\tif (aa_g_hash_policy) {\n\t\tudata->hash = aa_calc_hash(udata->data, udata->size);\n\t\tif (IS_ERR(udata->hash)) {\n\t\t\terror = PTR_ERR(udata->hash);\n\t\t\tudata->hash = NULL;\n\t\t\tgoto fail;\n\t\t}\n\t}\n\treturn 0;\n\nfail_profile:\n\taa_put_profile(profile);\n\nfail:\n\tlist_for_each_entry_safe(ent, tmp, lh, list) {\n\t\tlist_del_init(&ent->list);\n\t\taa_load_ent_free(ent);\n\t}\n\n\treturn error;\n}",
          "includes": [
            "#include \"include/policy_unpack.h\"",
            "#include \"include/policy.h\"",
            "#include \"include/path.h\"",
            "#include \"include/match.h\"",
            "#include \"include/crypto.h\"",
            "#include \"include/context.h\"",
            "#include \"include/audit.h\"",
            "#include \"include/apparmor.h\"",
            "#include <linux/errno.h>",
            "#include <linux/ctype.h>",
            "#include <asm/unaligned.h>"
          ],
          "macros_used": [
            "#define K_ABI_MASK 0x3ff"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"include/policy_unpack.h\"\n#include \"include/policy.h\"\n#include \"include/path.h\"\n#include \"include/match.h\"\n#include \"include/crypto.h\"\n#include \"include/context.h\"\n#include \"include/audit.h\"\n#include \"include/apparmor.h\"\n#include <linux/errno.h>\n#include <linux/ctype.h>\n#include <asm/unaligned.h>\n\n#define K_ABI_MASK 0x3ff\n\nint aa_unpack(struct aa_loaddata *udata, struct list_head *lh,\n\t      const char **ns)\n{\n\tstruct aa_load_ent *tmp, *ent;\n\tstruct aa_profile *profile = NULL;\n\tint error;\n\tstruct aa_ext e = {\n\t\t.start = udata->data,\n\t\t.end = udata->data + udata->size,\n\t\t.pos = udata->data,\n\t};\n\n\t*ns = NULL;\n\twhile (e.pos < e.end) {\n\t\tchar *ns_name = NULL;\n\t\tvoid *start;\n\t\terror = verify_header(&e, e.pos == e.start, ns);\n\t\tif (error)\n\t\t\tgoto fail;\n\n\t\tstart = e.pos;\n\t\tprofile = unpack_profile(&e, &ns_name);\n\t\tif (IS_ERR(profile)) {\n\t\t\terror = PTR_ERR(profile);\n\t\t\tgoto fail;\n\t\t}\n\n\t\terror = verify_profile(profile);\n\t\tif (error)\n\t\t\tgoto fail_profile;\n\n\t\tif (aa_g_hash_policy)\n\t\t\terror = aa_calc_profile_hash(profile, e.version, start,\n\t\t\t\t\t\t     e.pos - start);\n\t\tif (error)\n\t\t\tgoto fail_profile;\n\n\t\tent = aa_load_ent_alloc();\n\t\tif (!ent) {\n\t\t\terror = -ENOMEM;\n\t\t\tgoto fail_profile;\n\t\t}\n\n\t\tent->new = profile;\n\t\tent->ns_name = ns_name;\n\t\tlist_add_tail(&ent->list, lh);\n\t}\n\tudata->abi = e.version & K_ABI_MASK;\n\tif (aa_g_hash_policy) {\n\t\tudata->hash = aa_calc_hash(udata->data, udata->size);\n\t\tif (IS_ERR(udata->hash)) {\n\t\t\terror = PTR_ERR(udata->hash);\n\t\t\tudata->hash = NULL;\n\t\t\tgoto fail;\n\t\t}\n\t}\n\treturn 0;\n\nfail_profile:\n\taa_put_profile(profile);\n\nfail:\n\tlist_for_each_entry_safe(ent, tmp, lh, list) {\n\t\tlist_del_init(&ent->list);\n\t\taa_load_ent_free(ent);\n\t}\n\n\treturn error;\n}"
        }
      },
      {
        "call_info": {
          "callee": "LIST_HEAD",
          "args": [
            "lh"
          ],
          "line": 862
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"include/resource.h\"\n#include \"include/policy_unpack.h\"\n#include \"include/policy_ns.h\"\n#include \"include/policy.h\"\n#include \"include/path.h\"\n#include \"include/match.h\"\n#include \"include/ipc.h\"\n#include \"include/file.h\"\n#include \"include/context.h\"\n#include \"include/capability.h\"\n#include \"include/apparmor.h\"\n#include <linux/user_namespace.h>\n#include <linux/rculist.h>\n#include <linux/cred.h>\n#include <linux/string.h>\n#include <linux/spinlock.h>\n#include <linux/slab.h>\n\nssize_t aa_replace_profiles(struct aa_ns *policy_ns, struct aa_label *label,\n\t\t\t    u32 mask, struct aa_loaddata *udata)\n{\n\tconst char *ns_name, *info = NULL;\n\tstruct aa_ns *ns = NULL;\n\tstruct aa_load_ent *ent, *tmp;\n\tstruct aa_loaddata *rawdata_ent;\n\tconst char *op;\n\tssize_t count, error;\n\tLIST_HEAD(lh);\n\n\top = mask & AA_MAY_REPLACE_POLICY ? OP_PROF_REPL : OP_PROF_LOAD;\n\taa_get_loaddata(udata);\n\t/* released below */\n\terror = aa_unpack(udata, &lh, &ns_name);\n\tif (error)\n\t\tgoto out;\n\n\t/* ensure that profiles are all for the same ns\n\t * TODO: update locking to remove this constaint. All profiles in\n\t *       the load set must succeed as a set or the load will\n\t *       fail. Sort ent list and take ns locks in hierarchy order\n\t */\n\tcount = 0;\n\tlist_for_each_entry(ent, &lh, list) {\n\t\tif (ns_name) {\n\t\t\tif (ent->ns_name &&\n\t\t\t    strcmp(ent->ns_name, ns_name) != 0) {\n\t\t\t\tinfo = \"policy load has mixed namespaces\";\n\t\t\t\terror = -EACCES;\n\t\t\t\tgoto fail;\n\t\t\t}\n\t\t} else if (ent->ns_name) {\n\t\t\tif (count) {\n\t\t\t\tinfo = \"policy load has mixed namespaces\";\n\t\t\t\terror = -EACCES;\n\t\t\t\tgoto fail;\n\t\t\t}\n\t\t\tns_name = ent->ns_name;\n\t\t} else\n\t\t\tcount++;\n\t}\n\tif (ns_name) {\n\t\tns = aa_prepare_ns(policy_ns ? policy_ns : labels_ns(label),\n\t\t\t\t   ns_name);\n\t\tif (IS_ERR(ns)) {\n\t\t\top = OP_PROF_LOAD;\n\t\t\tinfo = \"failed to prepare namespace\";\n\t\t\terror = PTR_ERR(ns);\n\t\t\tns = NULL;\n\t\t\tent = NULL;\n\t\t\tgoto fail;\n\t\t}\n\t} else\n\t\tns = aa_get_ns(policy_ns ? policy_ns : labels_ns(label));\n\n\tmutex_lock_nested(&ns->lock, ns->level);\n\t/* check for duplicate rawdata blobs: space and file dedup */\n\tlist_for_each_entry(rawdata_ent, &ns->rawdata_list, list) {\n\t\tif (aa_rawdata_eq(rawdata_ent, udata)) {\n\t\t\tstruct aa_loaddata *tmp;\n\n\t\t\ttmp = __aa_get_loaddata(rawdata_ent);\n\t\t\t/* check we didn't fail the race */\n\t\t\tif (tmp) {\n\t\t\t\taa_put_loaddata(udata);\n\t\t\t\tudata = tmp;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\t/* setup parent and ns info */\n\tlist_for_each_entry(ent, &lh, list) {\n\t\tstruct aa_policy *policy;\n\n\t\tent->new->rawdata = aa_get_loaddata(udata);\n\t\terror = __lookup_replace(ns, ent->new->base.hname,\n\t\t\t\t\t !(mask & AA_MAY_REPLACE_POLICY),\n\t\t\t\t\t &ent->old, &info);\n\t\tif (error)\n\t\t\tgoto fail_lock;\n\n\t\tif (ent->new->rename) {\n\t\t\terror = __lookup_replace(ns, ent->new->rename,\n\t\t\t\t\t\t!(mask & AA_MAY_REPLACE_POLICY),\n\t\t\t\t\t\t&ent->rename, &info);\n\t\t\tif (error)\n\t\t\t\tgoto fail_lock;\n\t\t}\n\n\t\t/* released when @new is freed */\n\t\tent->new->ns = aa_get_ns(ns);\n\n\t\tif (ent->old || ent->rename)\n\t\t\tcontinue;\n\n\t\t/* no ref on policy only use inside lock */\n\t\tpolicy = __lookup_parent(ns, ent->new->base.hname);\n\t\tif (!policy) {\n\t\t\tstruct aa_profile *p;\n\t\t\tp = __list_lookup_parent(&lh, ent->new);\n\t\t\tif (!p) {\n\t\t\t\terror = -ENOENT;\n\t\t\t\tinfo = \"parent does not exist\";\n\t\t\t\tgoto fail_lock;\n\t\t\t}\n\t\t\trcu_assign_pointer(ent->new->parent, aa_get_profile(p));\n\t\t} else if (policy != &ns->base) {\n\t\t\t/* released on profile replacement or free_profile */\n\t\t\tstruct aa_profile *p = (struct aa_profile *) policy;\n\t\t\trcu_assign_pointer(ent->new->parent, aa_get_profile(p));\n\t\t}\n\t}\n\n\t/* create new fs entries for introspection if needed */\n\tif (!udata->dents[AAFS_LOADDATA_DIR]) {\n\t\terror = __aa_fs_create_rawdata(ns, udata);\n\t\tif (error) {\n\t\t\tinfo = \"failed to create raw_data dir and files\";\n\t\t\tent = NULL;\n\t\t\tgoto fail_lock;\n\t\t}\n\t}\n\tlist_for_each_entry(ent, &lh, list) {\n\t\tif (!ent->old) {\n\t\t\tstruct dentry *parent;\n\t\t\tif (rcu_access_pointer(ent->new->parent)) {\n\t\t\t\tstruct aa_profile *p;\n\t\t\t\tp = aa_deref_parent(ent->new);\n\t\t\t\tparent = prof_child_dir(p);\n\t\t\t} else\n\t\t\t\tparent = ns_subprofs_dir(ent->new->ns);\n\t\t\terror = __aafs_profile_mkdir(ent->new, parent);\n\t\t}\n\n\t\tif (error) {\n\t\t\tinfo = \"failed to create\";\n\t\t\tgoto fail_lock;\n\t\t}\n\t}\n\n\t/* Done with checks that may fail - do actual replacement */\n\t__aa_bump_ns_revision(ns);\n\t__aa_loaddata_update(udata, ns->revision);\n\tlist_for_each_entry_safe(ent, tmp, &lh, list) {\n\t\tlist_del_init(&ent->list);\n\t\top = (!ent->old && !ent->rename) ? OP_PROF_LOAD : OP_PROF_REPL;\n\n\t\tif (ent->old && ent->old->rawdata == ent->new->rawdata) {\n\t\t\t/* dedup actual profile replacement */\n\t\t\taudit_policy(label, op, ns_name, ent->new->base.hname,\n\t\t\t\t     \"same as current profile, skipping\",\n\t\t\t\t     error);\n\t\t\tgoto skip;\n\t\t}\n\n\t\t/*\n\t\t * TODO: finer dedup based on profile range in data. Load set\n\t\t * can differ but profile may remain unchanged\n\t\t */\n\t\taudit_policy(label, op, ns_name, ent->new->base.hname, NULL,\n\t\t\t     error);\n\n\t\tif (ent->old) {\n\t\t\tshare_name(ent->old, ent->new);\n\t\t\t__replace_profile(ent->old, ent->new);\n\t\t} else {\n\t\t\tstruct list_head *lh;\n\n\t\t\tif (rcu_access_pointer(ent->new->parent)) {\n\t\t\t\tstruct aa_profile *parent;\n\n\t\t\t\tparent = update_to_newest_parent(ent->new);\n\t\t\t\tlh = &parent->base.profiles;\n\t\t\t} else\n\t\t\t\tlh = &ns->base.profiles;\n\t\t\t__add_profile(lh, ent->new);\n\t\t}\n\tskip:\n\t\taa_load_ent_free(ent);\n\t}\n\t__aa_labelset_update_subtree(ns);\n\tmutex_unlock(&ns->lock);\n\nout:\n\taa_put_ns(ns);\n\taa_put_loaddata(udata);\n\n\tif (error)\n\t\treturn error;\n\treturn udata->size;\n\nfail_lock:\n\tmutex_unlock(&ns->lock);\n\n\t/* audit cause of failure */\n\top = (ent && !ent->old) ? OP_PROF_LOAD : OP_PROF_REPL;\nfail:\n\t  audit_policy(label, op, ns_name, ent ? ent->new->base.hname : NULL,\n\t\t       info, error);\n\t/* audit status that rest of profiles in the atomic set failed too */\n\tinfo = \"valid profile in failed atomic policy load\";\n\tlist_for_each_entry(tmp, &lh, list) {\n\t\tif (tmp == ent) {\n\t\t\tinfo = \"unchecked profile in failed atomic policy load\";\n\t\t\t/* skip entry that caused failure */\n\t\t\tcontinue;\n\t\t}\n\t\top = (!tmp->old) ? OP_PROF_LOAD : OP_PROF_REPL;\n\t\taudit_policy(label, op, ns_name, tmp->new->base.hname, info,\n\t\t\t     error);\n\t}\n\tlist_for_each_entry_safe(ent, tmp, &lh, list) {\n\t\tlist_del_init(&ent->list);\n\t\taa_load_ent_free(ent);\n\t}\n\n\tgoto out;\n}"
  },
  {
    "function_name": "update_to_newest_parent",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/policy.c",
    "lines": "822-838",
    "snippet": "static struct aa_profile *update_to_newest_parent(struct aa_profile *new)\n{\n\tstruct aa_profile *parent, *newest;\n\n\tparent = rcu_dereference_protected(new->parent,\n\t\t\t\t\t   mutex_is_locked(&new->ns->lock));\n\tnewest = aa_get_newest_profile(parent);\n\n\t/* parent replaced in this atomic set? */\n\tif (newest != parent) {\n\t\taa_put_profile(parent);\n\t\trcu_assign_pointer(new->parent, newest);\n\t} else\n\t\taa_put_profile(newest);\n\n\treturn newest;\n}",
    "includes": [
      "#include \"include/resource.h\"",
      "#include \"include/policy_unpack.h\"",
      "#include \"include/policy_ns.h\"",
      "#include \"include/policy.h\"",
      "#include \"include/path.h\"",
      "#include \"include/match.h\"",
      "#include \"include/ipc.h\"",
      "#include \"include/file.h\"",
      "#include \"include/context.h\"",
      "#include \"include/capability.h\"",
      "#include \"include/apparmor.h\"",
      "#include <linux/user_namespace.h>",
      "#include <linux/rculist.h>",
      "#include <linux/cred.h>",
      "#include <linux/string.h>",
      "#include <linux/spinlock.h>",
      "#include <linux/slab.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "aa_put_profile",
          "args": [
            "newest"
          ],
          "line": 835
        },
        "resolved": true,
        "details": {
          "function_name": "aa_put_profile",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/include/policy.h",
          "lines": "277-281",
          "snippet": "static inline void aa_put_profile(struct aa_profile *p)\n{\n\tif (p)\n\t\tkref_put(&p->label.count, aa_label_kref);\n}",
          "includes": [
            "#include \"resource.h\"",
            "#include \"perms.h\"",
            "#include \"label.h\"",
            "#include \"lib.h\"",
            "#include \"file.h\"",
            "#include \"domain.h\"",
            "#include \"capability.h\"",
            "#include \"audit.h\"",
            "#include \"apparmor.h\"",
            "#include <linux/socket.h>",
            "#include <linux/slab.h>",
            "#include <linux/sched.h>",
            "#include <linux/rhashtable.h>",
            "#include <linux/kref.h>",
            "#include <linux/cred.h>",
            "#include <linux/capability.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"resource.h\"\n#include \"perms.h\"\n#include \"label.h\"\n#include \"lib.h\"\n#include \"file.h\"\n#include \"domain.h\"\n#include \"capability.h\"\n#include \"audit.h\"\n#include \"apparmor.h\"\n#include <linux/socket.h>\n#include <linux/slab.h>\n#include <linux/sched.h>\n#include <linux/rhashtable.h>\n#include <linux/kref.h>\n#include <linux/cred.h>\n#include <linux/capability.h>\n\nstatic inline void aa_put_profile(struct aa_profile *p)\n{\n\tif (p)\n\t\tkref_put(&p->label.count, aa_label_kref);\n}"
        }
      },
      {
        "call_info": {
          "callee": "rcu_assign_pointer",
          "args": [
            "new->parent",
            "newest"
          ],
          "line": 833
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "aa_get_newest_profile",
          "args": [
            "parent"
          ],
          "line": 828
        },
        "resolved": true,
        "details": {
          "function_name": "aa_get_newest_profile",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/include/policy.h",
          "lines": "207-210",
          "snippet": "static inline struct aa_profile *aa_get_newest_profile(struct aa_profile *p)\n{\n\treturn labels_profile(aa_get_newest_label(&p->label));\n}",
          "includes": [
            "#include \"resource.h\"",
            "#include \"perms.h\"",
            "#include \"label.h\"",
            "#include \"lib.h\"",
            "#include \"file.h\"",
            "#include \"domain.h\"",
            "#include \"capability.h\"",
            "#include \"audit.h\"",
            "#include \"apparmor.h\"",
            "#include <linux/socket.h>",
            "#include <linux/slab.h>",
            "#include <linux/sched.h>",
            "#include <linux/rhashtable.h>",
            "#include <linux/kref.h>",
            "#include <linux/cred.h>",
            "#include <linux/capability.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"resource.h\"\n#include \"perms.h\"\n#include \"label.h\"\n#include \"lib.h\"\n#include \"file.h\"\n#include \"domain.h\"\n#include \"capability.h\"\n#include \"audit.h\"\n#include \"apparmor.h\"\n#include <linux/socket.h>\n#include <linux/slab.h>\n#include <linux/sched.h>\n#include <linux/rhashtable.h>\n#include <linux/kref.h>\n#include <linux/cred.h>\n#include <linux/capability.h>\n\nstatic inline struct aa_profile *aa_get_newest_profile(struct aa_profile *p)\n{\n\treturn labels_profile(aa_get_newest_label(&p->label));\n}"
        }
      },
      {
        "call_info": {
          "callee": "rcu_dereference_protected",
          "args": [
            "new->parent",
            "mutex_is_locked(&new->ns->lock)"
          ],
          "line": 826
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "mutex_is_locked",
          "args": [
            "&new->ns->lock"
          ],
          "line": 827
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"include/resource.h\"\n#include \"include/policy_unpack.h\"\n#include \"include/policy_ns.h\"\n#include \"include/policy.h\"\n#include \"include/path.h\"\n#include \"include/match.h\"\n#include \"include/ipc.h\"\n#include \"include/file.h\"\n#include \"include/context.h\"\n#include \"include/capability.h\"\n#include \"include/apparmor.h\"\n#include <linux/user_namespace.h>\n#include <linux/rculist.h>\n#include <linux/cred.h>\n#include <linux/string.h>\n#include <linux/spinlock.h>\n#include <linux/slab.h>\n\nstatic struct aa_profile *update_to_newest_parent(struct aa_profile *new)\n{\n\tstruct aa_profile *parent, *newest;\n\n\tparent = rcu_dereference_protected(new->parent,\n\t\t\t\t\t   mutex_is_locked(&new->ns->lock));\n\tnewest = aa_get_newest_profile(parent);\n\n\t/* parent replaced in this atomic set? */\n\tif (newest != parent) {\n\t\taa_put_profile(parent);\n\t\trcu_assign_pointer(new->parent, newest);\n\t} else\n\t\taa_put_profile(newest);\n\n\treturn newest;\n}"
  },
  {
    "function_name": "share_name",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/policy.c",
    "lines": "810-817",
    "snippet": "static void share_name(struct aa_profile *old, struct aa_profile *new)\n{\n\taa_put_str(new->base.hname);\n\taa_get_str(old->base.hname);\n\tnew->base.hname = old->base.hname;\n\tnew->base.name = old->base.name;\n\tnew->label.hname = old->label.hname;\n}",
    "includes": [
      "#include \"include/resource.h\"",
      "#include \"include/policy_unpack.h\"",
      "#include \"include/policy_ns.h\"",
      "#include \"include/policy.h\"",
      "#include \"include/path.h\"",
      "#include \"include/match.h\"",
      "#include \"include/ipc.h\"",
      "#include \"include/file.h\"",
      "#include \"include/context.h\"",
      "#include \"include/capability.h\"",
      "#include \"include/apparmor.h\"",
      "#include <linux/user_namespace.h>",
      "#include <linux/rculist.h>",
      "#include <linux/cred.h>",
      "#include <linux/string.h>",
      "#include <linux/spinlock.h>",
      "#include <linux/slab.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "aa_get_str",
          "args": [
            "old->base.hname"
          ],
          "line": 813
        },
        "resolved": true,
        "details": {
          "function_name": "aa_get_str",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/include/lib.h",
          "lines": "107-113",
          "snippet": "static inline __counted char *aa_get_str(__counted char *str)\n{\n\tif (str)\n\t\tkref_get(&(str_to_counted(str)->count));\n\n\treturn str;\n}",
          "includes": [
            "#include \"match.h\"",
            "#include <linux/fs.h>",
            "#include <linux/slab.h>"
          ],
          "macros_used": [
            "#define __counted\t/* atm just a notation */"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"match.h\"\n#include <linux/fs.h>\n#include <linux/slab.h>\n\n#define __counted\t/* atm just a notation */\n\nstatic inline __counted char *aa_get_str(__counted char *str)\n{\n\tif (str)\n\t\tkref_get(&(str_to_counted(str)->count));\n\n\treturn str;\n}"
        }
      },
      {
        "call_info": {
          "callee": "aa_put_str",
          "args": [
            "new->base.hname"
          ],
          "line": 812
        },
        "resolved": true,
        "details": {
          "function_name": "aa_put_str",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/include/lib.h",
          "lines": "115-119",
          "snippet": "static inline void aa_put_str(__counted char *str)\n{\n\tif (str)\n\t\tkref_put(&str_to_counted(str)->count, aa_str_kref);\n}",
          "includes": [
            "#include \"match.h\"",
            "#include <linux/fs.h>",
            "#include <linux/slab.h>"
          ],
          "macros_used": [
            "#define __counted\t/* atm just a notation */"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"match.h\"\n#include <linux/fs.h>\n#include <linux/slab.h>\n\n#define __counted\t/* atm just a notation */\n\nstatic inline void aa_put_str(__counted char *str)\n{\n\tif (str)\n\t\tkref_put(&str_to_counted(str)->count, aa_str_kref);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"include/resource.h\"\n#include \"include/policy_unpack.h\"\n#include \"include/policy_ns.h\"\n#include \"include/policy.h\"\n#include \"include/path.h\"\n#include \"include/match.h\"\n#include \"include/ipc.h\"\n#include \"include/file.h\"\n#include \"include/context.h\"\n#include \"include/capability.h\"\n#include \"include/apparmor.h\"\n#include <linux/user_namespace.h>\n#include <linux/rculist.h>\n#include <linux/cred.h>\n#include <linux/string.h>\n#include <linux/spinlock.h>\n#include <linux/slab.h>\n\nstatic void share_name(struct aa_profile *old, struct aa_profile *new)\n{\n\taa_put_str(new->base.hname);\n\taa_get_str(old->base.hname);\n\tnew->base.hname = old->base.hname;\n\tnew->base.name = old->base.name;\n\tnew->label.hname = old->label.hname;\n}"
  },
  {
    "function_name": "__lookup_replace",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/policy.c",
    "lines": "794-808",
    "snippet": "static int __lookup_replace(struct aa_ns *ns, const char *hname,\n\t\t\t    bool noreplace, struct aa_profile **p,\n\t\t\t    const char **info)\n{\n\t*p = aa_get_profile(__lookup_profile(&ns->base, hname));\n\tif (*p) {\n\t\tint error = replacement_allowed(*p, noreplace, info);\n\t\tif (error) {\n\t\t\t*info = \"profile can not be replaced\";\n\t\t\treturn error;\n\t\t}\n\t}\n\n\treturn 0;\n}",
    "includes": [
      "#include \"include/resource.h\"",
      "#include \"include/policy_unpack.h\"",
      "#include \"include/policy_ns.h\"",
      "#include \"include/policy.h\"",
      "#include \"include/path.h\"",
      "#include \"include/match.h\"",
      "#include \"include/ipc.h\"",
      "#include \"include/file.h\"",
      "#include \"include/context.h\"",
      "#include \"include/capability.h\"",
      "#include \"include/apparmor.h\"",
      "#include <linux/user_namespace.h>",
      "#include <linux/rculist.h>",
      "#include <linux/cred.h>",
      "#include <linux/string.h>",
      "#include <linux/spinlock.h>",
      "#include <linux/slab.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "replacement_allowed",
          "args": [
            "*p",
            "noreplace",
            "info"
          ],
          "line": 800
        },
        "resolved": true,
        "details": {
          "function_name": "replacement_allowed",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/policy.c",
          "lines": "578-591",
          "snippet": "static int replacement_allowed(struct aa_profile *profile, int noreplace,\n\t\t\t       const char **info)\n{\n\tif (profile) {\n\t\tif (profile->label.flags & FLAG_IMMUTIBLE) {\n\t\t\t*info = \"cannot replace immutible profile\";\n\t\t\treturn -EPERM;\n\t\t} else if (noreplace) {\n\t\t\t*info = \"profile already exists\";\n\t\t\treturn -EEXIST;\n\t\t}\n\t}\n\treturn 0;\n}",
          "includes": [
            "#include \"include/resource.h\"",
            "#include \"include/policy_unpack.h\"",
            "#include \"include/policy_ns.h\"",
            "#include \"include/policy.h\"",
            "#include \"include/path.h\"",
            "#include \"include/match.h\"",
            "#include \"include/ipc.h\"",
            "#include \"include/file.h\"",
            "#include \"include/context.h\"",
            "#include \"include/capability.h\"",
            "#include \"include/apparmor.h\"",
            "#include <linux/user_namespace.h>",
            "#include <linux/rculist.h>",
            "#include <linux/cred.h>",
            "#include <linux/string.h>",
            "#include <linux/spinlock.h>",
            "#include <linux/slab.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"include/resource.h\"\n#include \"include/policy_unpack.h\"\n#include \"include/policy_ns.h\"\n#include \"include/policy.h\"\n#include \"include/path.h\"\n#include \"include/match.h\"\n#include \"include/ipc.h\"\n#include \"include/file.h\"\n#include \"include/context.h\"\n#include \"include/capability.h\"\n#include \"include/apparmor.h\"\n#include <linux/user_namespace.h>\n#include <linux/rculist.h>\n#include <linux/cred.h>\n#include <linux/string.h>\n#include <linux/spinlock.h>\n#include <linux/slab.h>\n\nstatic int replacement_allowed(struct aa_profile *profile, int noreplace,\n\t\t\t       const char **info)\n{\n\tif (profile) {\n\t\tif (profile->label.flags & FLAG_IMMUTIBLE) {\n\t\t\t*info = \"cannot replace immutible profile\";\n\t\t\treturn -EPERM;\n\t\t} else if (noreplace) {\n\t\t\t*info = \"profile already exists\";\n\t\t\treturn -EEXIST;\n\t\t}\n\t}\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "aa_get_profile",
          "args": [
            "__lookup_profile(&ns->base, hname)"
          ],
          "line": 798
        },
        "resolved": true,
        "details": {
          "function_name": "aa_get_profile_rcu",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/include/policy.h",
          "lines": "260-271",
          "snippet": "static inline struct aa_profile *aa_get_profile_rcu(struct aa_profile __rcu **p)\n{\n\tstruct aa_profile *c;\n\n\trcu_read_lock();\n\tdo {\n\t\tc = rcu_dereference(*p);\n\t} while (c && !kref_get_unless_zero(&c->label.count));\n\trcu_read_unlock();\n\n\treturn c;\n}",
          "includes": [
            "#include \"resource.h\"",
            "#include \"perms.h\"",
            "#include \"label.h\"",
            "#include \"lib.h\"",
            "#include \"file.h\"",
            "#include \"domain.h\"",
            "#include \"capability.h\"",
            "#include \"audit.h\"",
            "#include \"apparmor.h\"",
            "#include <linux/socket.h>",
            "#include <linux/slab.h>",
            "#include <linux/sched.h>",
            "#include <linux/rhashtable.h>",
            "#include <linux/kref.h>",
            "#include <linux/cred.h>",
            "#include <linux/capability.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"resource.h\"\n#include \"perms.h\"\n#include \"label.h\"\n#include \"lib.h\"\n#include \"file.h\"\n#include \"domain.h\"\n#include \"capability.h\"\n#include \"audit.h\"\n#include \"apparmor.h\"\n#include <linux/socket.h>\n#include <linux/slab.h>\n#include <linux/sched.h>\n#include <linux/rhashtable.h>\n#include <linux/kref.h>\n#include <linux/cred.h>\n#include <linux/capability.h>\n\nstatic inline struct aa_profile *aa_get_profile_rcu(struct aa_profile __rcu **p)\n{\n\tstruct aa_profile *c;\n\n\trcu_read_lock();\n\tdo {\n\t\tc = rcu_dereference(*p);\n\t} while (c && !kref_get_unless_zero(&c->label.count));\n\trcu_read_unlock();\n\n\treturn c;\n}"
        }
      },
      {
        "call_info": {
          "callee": "__lookup_profile",
          "args": [
            "&ns->base",
            "hname"
          ],
          "line": 798
        },
        "resolved": true,
        "details": {
          "function_name": "__lookup_profile",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/policy.c",
          "lines": "416-420",
          "snippet": "static struct aa_profile *__lookup_profile(struct aa_policy *base,\n\t\t\t\t\t   const char *hname)\n{\n\treturn __lookupn_profile(base, hname, strlen(hname));\n}",
          "includes": [
            "#include \"include/resource.h\"",
            "#include \"include/policy_unpack.h\"",
            "#include \"include/policy_ns.h\"",
            "#include \"include/policy.h\"",
            "#include \"include/path.h\"",
            "#include \"include/match.h\"",
            "#include \"include/ipc.h\"",
            "#include \"include/file.h\"",
            "#include \"include/context.h\"",
            "#include \"include/capability.h\"",
            "#include \"include/apparmor.h\"",
            "#include <linux/user_namespace.h>",
            "#include <linux/rculist.h>",
            "#include <linux/cred.h>",
            "#include <linux/string.h>",
            "#include <linux/spinlock.h>",
            "#include <linux/slab.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"include/resource.h\"\n#include \"include/policy_unpack.h\"\n#include \"include/policy_ns.h\"\n#include \"include/policy.h\"\n#include \"include/path.h\"\n#include \"include/match.h\"\n#include \"include/ipc.h\"\n#include \"include/file.h\"\n#include \"include/context.h\"\n#include \"include/capability.h\"\n#include \"include/apparmor.h\"\n#include <linux/user_namespace.h>\n#include <linux/rculist.h>\n#include <linux/cred.h>\n#include <linux/string.h>\n#include <linux/spinlock.h>\n#include <linux/slab.h>\n\nstatic struct aa_profile *__lookup_profile(struct aa_policy *base,\n\t\t\t\t\t   const char *hname)\n{\n\treturn __lookupn_profile(base, hname, strlen(hname));\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"include/resource.h\"\n#include \"include/policy_unpack.h\"\n#include \"include/policy_ns.h\"\n#include \"include/policy.h\"\n#include \"include/path.h\"\n#include \"include/match.h\"\n#include \"include/ipc.h\"\n#include \"include/file.h\"\n#include \"include/context.h\"\n#include \"include/capability.h\"\n#include \"include/apparmor.h\"\n#include <linux/user_namespace.h>\n#include <linux/rculist.h>\n#include <linux/cred.h>\n#include <linux/string.h>\n#include <linux/spinlock.h>\n#include <linux/slab.h>\n\nstatic int __lookup_replace(struct aa_ns *ns, const char *hname,\n\t\t\t    bool noreplace, struct aa_profile **p,\n\t\t\t    const char **info)\n{\n\t*p = aa_get_profile(__lookup_profile(&ns->base, hname));\n\tif (*p) {\n\t\tint error = replacement_allowed(*p, noreplace, info);\n\t\tif (error) {\n\t\t\t*info = \"profile can not be replaced\";\n\t\t\treturn error;\n\t\t}\n\t}\n\n\treturn 0;\n}"
  },
  {
    "function_name": "__replace_profile",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/policy.c",
    "lines": "738-782",
    "snippet": "static void __replace_profile(struct aa_profile *old, struct aa_profile *new)\n{\n\tstruct aa_profile *child, *tmp;\n\n\tif (!list_empty(&old->base.profiles)) {\n\t\tLIST_HEAD(lh);\n\t\tlist_splice_init_rcu(&old->base.profiles, &lh, synchronize_rcu);\n\n\t\tlist_for_each_entry_safe(child, tmp, &lh, base.list) {\n\t\t\tstruct aa_profile *p;\n\n\t\t\tlist_del_init(&child->base.list);\n\t\t\tp = __find_child(&new->base.profiles, child->base.name);\n\t\t\tif (p) {\n\t\t\t\t/* @p replaces @child  */\n\t\t\t\t__replace_profile(child, p);\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t/* inherit @child and its children */\n\t\t\t/* TODO: update hname of inherited children */\n\t\t\t/* list refcount transferred to @new */\n\t\t\tp = aa_deref_parent(child);\n\t\t\trcu_assign_pointer(child->parent, aa_get_profile(new));\n\t\t\tlist_add_rcu(&child->base.list, &new->base.profiles);\n\t\t\taa_put_profile(p);\n\t\t}\n\t}\n\n\tif (!rcu_access_pointer(new->parent)) {\n\t\tstruct aa_profile *parent = aa_deref_parent(old);\n\t\trcu_assign_pointer(new->parent, aa_get_profile(parent));\n\t}\n\taa_label_replace(&old->label, &new->label);\n\t/* migrate dents must come after label replacement b/c update */\n\t__aafs_profile_migrate_dents(old, new);\n\n\tif (list_empty(&new->base.list)) {\n\t\t/* new is not on a list already */\n\t\tlist_replace_rcu(&old->base.list, &new->base.list);\n\t\taa_get_profile(new);\n\t\taa_put_profile(old);\n\t} else\n\t\t__list_remove_profile(old);\n}",
    "includes": [
      "#include \"include/resource.h\"",
      "#include \"include/policy_unpack.h\"",
      "#include \"include/policy_ns.h\"",
      "#include \"include/policy.h\"",
      "#include \"include/path.h\"",
      "#include \"include/match.h\"",
      "#include \"include/ipc.h\"",
      "#include \"include/file.h\"",
      "#include \"include/context.h\"",
      "#include \"include/capability.h\"",
      "#include \"include/apparmor.h\"",
      "#include <linux/user_namespace.h>",
      "#include <linux/rculist.h>",
      "#include <linux/cred.h>",
      "#include <linux/string.h>",
      "#include <linux/spinlock.h>",
      "#include <linux/slab.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "__list_remove_profile",
          "args": [
            "old"
          ],
          "line": 781
        },
        "resolved": true,
        "details": {
          "function_name": "__list_remove_profile",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/policy.c",
          "lines": "143-151",
          "snippet": "static void __list_remove_profile(struct aa_profile *profile)\n{\n\tAA_BUG(!profile);\n\tAA_BUG(!profile->ns);\n\tAA_BUG(!mutex_is_locked(&profile->ns->lock));\n\n\tlist_del_rcu(&profile->base.list);\n\taa_put_profile(profile);\n}",
          "includes": [
            "#include \"include/resource.h\"",
            "#include \"include/policy_unpack.h\"",
            "#include \"include/policy_ns.h\"",
            "#include \"include/policy.h\"",
            "#include \"include/path.h\"",
            "#include \"include/match.h\"",
            "#include \"include/ipc.h\"",
            "#include \"include/file.h\"",
            "#include \"include/context.h\"",
            "#include \"include/capability.h\"",
            "#include \"include/apparmor.h\"",
            "#include <linux/user_namespace.h>",
            "#include <linux/rculist.h>",
            "#include <linux/cred.h>",
            "#include <linux/string.h>",
            "#include <linux/spinlock.h>",
            "#include <linux/slab.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"include/resource.h\"\n#include \"include/policy_unpack.h\"\n#include \"include/policy_ns.h\"\n#include \"include/policy.h\"\n#include \"include/path.h\"\n#include \"include/match.h\"\n#include \"include/ipc.h\"\n#include \"include/file.h\"\n#include \"include/context.h\"\n#include \"include/capability.h\"\n#include \"include/apparmor.h\"\n#include <linux/user_namespace.h>\n#include <linux/rculist.h>\n#include <linux/cred.h>\n#include <linux/string.h>\n#include <linux/spinlock.h>\n#include <linux/slab.h>\n\nstatic void __list_remove_profile(struct aa_profile *profile)\n{\n\tAA_BUG(!profile);\n\tAA_BUG(!profile->ns);\n\tAA_BUG(!mutex_is_locked(&profile->ns->lock));\n\n\tlist_del_rcu(&profile->base.list);\n\taa_put_profile(profile);\n}"
        }
      },
      {
        "call_info": {
          "callee": "aa_put_profile",
          "args": [
            "old"
          ],
          "line": 779
        },
        "resolved": true,
        "details": {
          "function_name": "aa_put_profile",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/include/policy.h",
          "lines": "277-281",
          "snippet": "static inline void aa_put_profile(struct aa_profile *p)\n{\n\tif (p)\n\t\tkref_put(&p->label.count, aa_label_kref);\n}",
          "includes": [
            "#include \"resource.h\"",
            "#include \"perms.h\"",
            "#include \"label.h\"",
            "#include \"lib.h\"",
            "#include \"file.h\"",
            "#include \"domain.h\"",
            "#include \"capability.h\"",
            "#include \"audit.h\"",
            "#include \"apparmor.h\"",
            "#include <linux/socket.h>",
            "#include <linux/slab.h>",
            "#include <linux/sched.h>",
            "#include <linux/rhashtable.h>",
            "#include <linux/kref.h>",
            "#include <linux/cred.h>",
            "#include <linux/capability.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"resource.h\"\n#include \"perms.h\"\n#include \"label.h\"\n#include \"lib.h\"\n#include \"file.h\"\n#include \"domain.h\"\n#include \"capability.h\"\n#include \"audit.h\"\n#include \"apparmor.h\"\n#include <linux/socket.h>\n#include <linux/slab.h>\n#include <linux/sched.h>\n#include <linux/rhashtable.h>\n#include <linux/kref.h>\n#include <linux/cred.h>\n#include <linux/capability.h>\n\nstatic inline void aa_put_profile(struct aa_profile *p)\n{\n\tif (p)\n\t\tkref_put(&p->label.count, aa_label_kref);\n}"
        }
      },
      {
        "call_info": {
          "callee": "aa_get_profile",
          "args": [
            "new"
          ],
          "line": 778
        },
        "resolved": true,
        "details": {
          "function_name": "aa_get_profile_rcu",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/include/policy.h",
          "lines": "260-271",
          "snippet": "static inline struct aa_profile *aa_get_profile_rcu(struct aa_profile __rcu **p)\n{\n\tstruct aa_profile *c;\n\n\trcu_read_lock();\n\tdo {\n\t\tc = rcu_dereference(*p);\n\t} while (c && !kref_get_unless_zero(&c->label.count));\n\trcu_read_unlock();\n\n\treturn c;\n}",
          "includes": [
            "#include \"resource.h\"",
            "#include \"perms.h\"",
            "#include \"label.h\"",
            "#include \"lib.h\"",
            "#include \"file.h\"",
            "#include \"domain.h\"",
            "#include \"capability.h\"",
            "#include \"audit.h\"",
            "#include \"apparmor.h\"",
            "#include <linux/socket.h>",
            "#include <linux/slab.h>",
            "#include <linux/sched.h>",
            "#include <linux/rhashtable.h>",
            "#include <linux/kref.h>",
            "#include <linux/cred.h>",
            "#include <linux/capability.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"resource.h\"\n#include \"perms.h\"\n#include \"label.h\"\n#include \"lib.h\"\n#include \"file.h\"\n#include \"domain.h\"\n#include \"capability.h\"\n#include \"audit.h\"\n#include \"apparmor.h\"\n#include <linux/socket.h>\n#include <linux/slab.h>\n#include <linux/sched.h>\n#include <linux/rhashtable.h>\n#include <linux/kref.h>\n#include <linux/cred.h>\n#include <linux/capability.h>\n\nstatic inline struct aa_profile *aa_get_profile_rcu(struct aa_profile __rcu **p)\n{\n\tstruct aa_profile *c;\n\n\trcu_read_lock();\n\tdo {\n\t\tc = rcu_dereference(*p);\n\t} while (c && !kref_get_unless_zero(&c->label.count));\n\trcu_read_unlock();\n\n\treturn c;\n}"
        }
      },
      {
        "call_info": {
          "callee": "list_replace_rcu",
          "args": [
            "&old->base.list",
            "&new->base.list"
          ],
          "line": 777
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "list_empty",
          "args": [
            "&new->base.list"
          ],
          "line": 775
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "__aafs_profile_migrate_dents",
          "args": [
            "old",
            "new"
          ],
          "line": 773
        },
        "resolved": true,
        "details": {
          "function_name": "__aafs_profile_migrate_dents",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/apparmorfs.c",
          "lines": "1444-1459",
          "snippet": "void __aafs_profile_migrate_dents(struct aa_profile *old,\n\t\t\t\t  struct aa_profile *new)\n{\n\tint i;\n\n\tAA_BUG(!old);\n\tAA_BUG(!new);\n\tAA_BUG(!mutex_is_locked(&profiles_ns(old)->lock));\n\n\tfor (i = 0; i < AAFS_PROF_SIZEOF; i++) {\n\t\tnew->dents[i] = old->dents[i];\n\t\tif (new->dents[i])\n\t\t\tnew->dents[i]->d_inode->i_mtime = current_time(new->dents[i]->d_inode);\n\t\told->dents[i] = NULL;\n\t}\n}",
          "includes": [
            "#include \"include/policy_unpack.h\"",
            "#include \"include/resource.h\"",
            "#include \"include/policy_ns.h\"",
            "#include \"include/policy.h\"",
            "#include \"include/label.h\"",
            "#include \"include/policy_ns.h\"",
            "#include \"include/ipc.h\"",
            "#include \"include/crypto.h\"",
            "#include \"include/context.h\"",
            "#include \"include/audit.h\"",
            "#include \"include/apparmorfs.h\"",
            "#include \"include/apparmor.h\"",
            "#include <uapi/linux/magic.h>",
            "#include <uapi/linux/major.h>",
            "#include <linux/poll.h>",
            "#include <linux/fs.h>",
            "#include <linux/rcupdate.h>",
            "#include <linux/capability.h>",
            "#include <linux/namei.h>",
            "#include <linux/mount.h>",
            "#include <linux/uaccess.h>",
            "#include <linux/seq_file.h>",
            "#include <linux/module.h>",
            "#include <linux/vmalloc.h>",
            "#include <linux/security.h>",
            "#include <linux/ctype.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"include/policy_unpack.h\"\n#include \"include/resource.h\"\n#include \"include/policy_ns.h\"\n#include \"include/policy.h\"\n#include \"include/label.h\"\n#include \"include/policy_ns.h\"\n#include \"include/ipc.h\"\n#include \"include/crypto.h\"\n#include \"include/context.h\"\n#include \"include/audit.h\"\n#include \"include/apparmorfs.h\"\n#include \"include/apparmor.h\"\n#include <uapi/linux/magic.h>\n#include <uapi/linux/major.h>\n#include <linux/poll.h>\n#include <linux/fs.h>\n#include <linux/rcupdate.h>\n#include <linux/capability.h>\n#include <linux/namei.h>\n#include <linux/mount.h>\n#include <linux/uaccess.h>\n#include <linux/seq_file.h>\n#include <linux/module.h>\n#include <linux/vmalloc.h>\n#include <linux/security.h>\n#include <linux/ctype.h>\n\nvoid __aafs_profile_migrate_dents(struct aa_profile *old,\n\t\t\t\t  struct aa_profile *new)\n{\n\tint i;\n\n\tAA_BUG(!old);\n\tAA_BUG(!new);\n\tAA_BUG(!mutex_is_locked(&profiles_ns(old)->lock));\n\n\tfor (i = 0; i < AAFS_PROF_SIZEOF; i++) {\n\t\tnew->dents[i] = old->dents[i];\n\t\tif (new->dents[i])\n\t\t\tnew->dents[i]->d_inode->i_mtime = current_time(new->dents[i]->d_inode);\n\t\told->dents[i] = NULL;\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "aa_label_replace",
          "args": [
            "&old->label",
            "&new->label"
          ],
          "line": 771
        },
        "resolved": true,
        "details": {
          "function_name": "aa_label_replace",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/label.c",
          "lines": "770-801",
          "snippet": "bool aa_label_replace(struct aa_label *old, struct aa_label *new)\n{\n\tunsigned long flags;\n\tbool res;\n\n\tif (name_is_shared(old, new) && labels_ns(old) == labels_ns(new)) {\n\t\twrite_lock_irqsave(&labels_set(old)->lock, flags);\n\t\tif (old->proxy != new->proxy)\n\t\t\t__proxy_share(old, new);\n\t\telse\n\t\t\t__aa_proxy_redirect(old, new);\n\t\tres = __label_replace(old, new);\n\t\twrite_unlock_irqrestore(&labels_set(old)->lock, flags);\n\t} else {\n\t\tstruct aa_label *l;\n\t\tstruct aa_labelset *ls = labels_set(old);\n\n\t\twrite_lock_irqsave(&ls->lock, flags);\n\t\tres = __label_remove(old, new);\n\t\tif (labels_ns(old) != labels_ns(new)) {\n\t\t\twrite_unlock_irqrestore(&ls->lock, flags);\n\t\t\tls = labels_set(new);\n\t\t\twrite_lock_irqsave(&ls->lock, flags);\n\t\t}\n\t\tl = __label_insert(ls, new, true);\n\t\tres = (l == new);\n\t\twrite_unlock_irqrestore(&ls->lock, flags);\n\t\taa_put_label(l);\n\t}\n\n\treturn res;\n}",
          "includes": [
            "#include \"include/secid.h\"",
            "#include \"include/policy.h\"",
            "#include \"include/label.h\"",
            "#include \"include/context.h\"",
            "#include \"include/apparmor.h\"",
            "#include <linux/sort.h>",
            "#include <linux/seq_file.h>",
            "#include <linux/audit.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"include/secid.h\"\n#include \"include/policy.h\"\n#include \"include/label.h\"\n#include \"include/context.h\"\n#include \"include/apparmor.h\"\n#include <linux/sort.h>\n#include <linux/seq_file.h>\n#include <linux/audit.h>\n\nbool aa_label_replace(struct aa_label *old, struct aa_label *new)\n{\n\tunsigned long flags;\n\tbool res;\n\n\tif (name_is_shared(old, new) && labels_ns(old) == labels_ns(new)) {\n\t\twrite_lock_irqsave(&labels_set(old)->lock, flags);\n\t\tif (old->proxy != new->proxy)\n\t\t\t__proxy_share(old, new);\n\t\telse\n\t\t\t__aa_proxy_redirect(old, new);\n\t\tres = __label_replace(old, new);\n\t\twrite_unlock_irqrestore(&labels_set(old)->lock, flags);\n\t} else {\n\t\tstruct aa_label *l;\n\t\tstruct aa_labelset *ls = labels_set(old);\n\n\t\twrite_lock_irqsave(&ls->lock, flags);\n\t\tres = __label_remove(old, new);\n\t\tif (labels_ns(old) != labels_ns(new)) {\n\t\t\twrite_unlock_irqrestore(&ls->lock, flags);\n\t\t\tls = labels_set(new);\n\t\t\twrite_lock_irqsave(&ls->lock, flags);\n\t\t}\n\t\tl = __label_insert(ls, new, true);\n\t\tres = (l == new);\n\t\twrite_unlock_irqrestore(&ls->lock, flags);\n\t\taa_put_label(l);\n\t}\n\n\treturn res;\n}"
        }
      },
      {
        "call_info": {
          "callee": "rcu_assign_pointer",
          "args": [
            "new->parent",
            "aa_get_profile(parent)"
          ],
          "line": 769
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "aa_deref_parent",
          "args": [
            "old"
          ],
          "line": 768
        },
        "resolved": true,
        "details": {
          "function_name": "aa_deref_parent",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/include/policy_ns.h",
          "lines": "103-107",
          "snippet": "static inline struct aa_profile *aa_deref_parent(struct aa_profile *p)\n{\n\treturn rcu_dereference_protected(p->parent,\n\t\t\t\t\t mutex_is_locked(&p->ns->lock));\n}",
          "includes": [
            "#include \"policy.h\"",
            "#include \"label.h\"",
            "#include \"apparmorfs.h\"",
            "#include \"apparmor.h\"",
            "#include <linux/kref.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"policy.h\"\n#include \"label.h\"\n#include \"apparmorfs.h\"\n#include \"apparmor.h\"\n#include <linux/kref.h>\n\nstatic inline struct aa_profile *aa_deref_parent(struct aa_profile *p)\n{\n\treturn rcu_dereference_protected(p->parent,\n\t\t\t\t\t mutex_is_locked(&p->ns->lock));\n}"
        }
      },
      {
        "call_info": {
          "callee": "rcu_access_pointer",
          "args": [
            "new->parent"
          ],
          "line": 767
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "list_add_rcu",
          "args": [
            "&child->base.list",
            "&new->base.profiles"
          ],
          "line": 762
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rcu_assign_pointer",
          "args": [
            "child->parent",
            "aa_get_profile(new)"
          ],
          "line": 761
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "__replace_profile",
          "args": [
            "child",
            "p"
          ],
          "line": 753
        },
        "resolved": true,
        "details": {
          "function_name": "__replace_profile",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/policy.c",
          "lines": "738-782",
          "snippet": "static void __replace_profile(struct aa_profile *old, struct aa_profile *new)\n{\n\tstruct aa_profile *child, *tmp;\n\n\tif (!list_empty(&old->base.profiles)) {\n\t\tLIST_HEAD(lh);\n\t\tlist_splice_init_rcu(&old->base.profiles, &lh, synchronize_rcu);\n\n\t\tlist_for_each_entry_safe(child, tmp, &lh, base.list) {\n\t\t\tstruct aa_profile *p;\n\n\t\t\tlist_del_init(&child->base.list);\n\t\t\tp = __find_child(&new->base.profiles, child->base.name);\n\t\t\tif (p) {\n\t\t\t\t/* @p replaces @child  */\n\t\t\t\t__replace_profile(child, p);\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t/* inherit @child and its children */\n\t\t\t/* TODO: update hname of inherited children */\n\t\t\t/* list refcount transferred to @new */\n\t\t\tp = aa_deref_parent(child);\n\t\t\trcu_assign_pointer(child->parent, aa_get_profile(new));\n\t\t\tlist_add_rcu(&child->base.list, &new->base.profiles);\n\t\t\taa_put_profile(p);\n\t\t}\n\t}\n\n\tif (!rcu_access_pointer(new->parent)) {\n\t\tstruct aa_profile *parent = aa_deref_parent(old);\n\t\trcu_assign_pointer(new->parent, aa_get_profile(parent));\n\t}\n\taa_label_replace(&old->label, &new->label);\n\t/* migrate dents must come after label replacement b/c update */\n\t__aafs_profile_migrate_dents(old, new);\n\n\tif (list_empty(&new->base.list)) {\n\t\t/* new is not on a list already */\n\t\tlist_replace_rcu(&old->base.list, &new->base.list);\n\t\taa_get_profile(new);\n\t\taa_put_profile(old);\n\t} else\n\t\t__list_remove_profile(old);\n}",
          "note": "cyclic_reference_detected"
        }
      },
      {
        "call_info": {
          "callee": "__find_child",
          "args": [
            "&new->base.profiles",
            "child->base.name"
          ],
          "line": 750
        },
        "resolved": true,
        "details": {
          "function_name": "__find_child",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/policy.c",
          "lines": "319-322",
          "snippet": "static struct aa_profile *__find_child(struct list_head *head, const char *name)\n{\n\treturn __strn_find_child(head, name, strlen(name));\n}",
          "includes": [
            "#include \"include/resource.h\"",
            "#include \"include/policy_unpack.h\"",
            "#include \"include/policy_ns.h\"",
            "#include \"include/policy.h\"",
            "#include \"include/path.h\"",
            "#include \"include/match.h\"",
            "#include \"include/ipc.h\"",
            "#include \"include/file.h\"",
            "#include \"include/context.h\"",
            "#include \"include/capability.h\"",
            "#include \"include/apparmor.h\"",
            "#include <linux/user_namespace.h>",
            "#include <linux/rculist.h>",
            "#include <linux/cred.h>",
            "#include <linux/string.h>",
            "#include <linux/spinlock.h>",
            "#include <linux/slab.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"include/resource.h\"\n#include \"include/policy_unpack.h\"\n#include \"include/policy_ns.h\"\n#include \"include/policy.h\"\n#include \"include/path.h\"\n#include \"include/match.h\"\n#include \"include/ipc.h\"\n#include \"include/file.h\"\n#include \"include/context.h\"\n#include \"include/capability.h\"\n#include \"include/apparmor.h\"\n#include <linux/user_namespace.h>\n#include <linux/rculist.h>\n#include <linux/cred.h>\n#include <linux/string.h>\n#include <linux/spinlock.h>\n#include <linux/slab.h>\n\nstatic struct aa_profile *__find_child(struct list_head *head, const char *name)\n{\n\treturn __strn_find_child(head, name, strlen(name));\n}"
        }
      },
      {
        "call_info": {
          "callee": "list_del_init",
          "args": [
            "&child->base.list"
          ],
          "line": 749
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "list_for_each_entry_safe",
          "args": [
            "child",
            "tmp",
            "&lh",
            "base.list"
          ],
          "line": 746
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "list_splice_init_rcu",
          "args": [
            "&old->base.profiles",
            "&lh",
            "synchronize_rcu"
          ],
          "line": 744
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "LIST_HEAD",
          "args": [
            "lh"
          ],
          "line": 743
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "list_empty",
          "args": [
            "&old->base.profiles"
          ],
          "line": 742
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"include/resource.h\"\n#include \"include/policy_unpack.h\"\n#include \"include/policy_ns.h\"\n#include \"include/policy.h\"\n#include \"include/path.h\"\n#include \"include/match.h\"\n#include \"include/ipc.h\"\n#include \"include/file.h\"\n#include \"include/context.h\"\n#include \"include/capability.h\"\n#include \"include/apparmor.h\"\n#include <linux/user_namespace.h>\n#include <linux/rculist.h>\n#include <linux/cred.h>\n#include <linux/string.h>\n#include <linux/spinlock.h>\n#include <linux/slab.h>\n\nstatic void __replace_profile(struct aa_profile *old, struct aa_profile *new)\n{\n\tstruct aa_profile *child, *tmp;\n\n\tif (!list_empty(&old->base.profiles)) {\n\t\tLIST_HEAD(lh);\n\t\tlist_splice_init_rcu(&old->base.profiles, &lh, synchronize_rcu);\n\n\t\tlist_for_each_entry_safe(child, tmp, &lh, base.list) {\n\t\t\tstruct aa_profile *p;\n\n\t\t\tlist_del_init(&child->base.list);\n\t\t\tp = __find_child(&new->base.profiles, child->base.name);\n\t\t\tif (p) {\n\t\t\t\t/* @p replaces @child  */\n\t\t\t\t__replace_profile(child, p);\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t/* inherit @child and its children */\n\t\t\t/* TODO: update hname of inherited children */\n\t\t\t/* list refcount transferred to @new */\n\t\t\tp = aa_deref_parent(child);\n\t\t\trcu_assign_pointer(child->parent, aa_get_profile(new));\n\t\t\tlist_add_rcu(&child->base.list, &new->base.profiles);\n\t\t\taa_put_profile(p);\n\t\t}\n\t}\n\n\tif (!rcu_access_pointer(new->parent)) {\n\t\tstruct aa_profile *parent = aa_deref_parent(old);\n\t\trcu_assign_pointer(new->parent, aa_get_profile(parent));\n\t}\n\taa_label_replace(&old->label, &new->label);\n\t/* migrate dents must come after label replacement b/c update */\n\t__aafs_profile_migrate_dents(old, new);\n\n\tif (list_empty(&new->base.list)) {\n\t\t/* new is not on a list already */\n\t\tlist_replace_rcu(&old->base.list, &new->base.list);\n\t\taa_get_profile(new);\n\t\taa_put_profile(old);\n\t} else\n\t\t__list_remove_profile(old);\n}"
  },
  {
    "function_name": "__list_lookup_parent",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/policy.c",
    "lines": "702-723",
    "snippet": "static struct aa_profile *__list_lookup_parent(struct list_head *lh,\n\t\t\t\t\t       struct aa_profile *profile)\n{\n\tconst char *base = basename(profile->base.hname);\n\tlong len = base - profile->base.hname;\n\tstruct aa_load_ent *ent;\n\n\t/* parent won't have trailing // so remove from len */\n\tif (len <= 2)\n\t\treturn NULL;\n\tlen -= 2;\n\n\tlist_for_each_entry(ent, lh, list) {\n\t\tif (ent->new == profile)\n\t\t\tcontinue;\n\t\tif (strncmp(ent->new->base.hname, profile->base.hname, len) ==\n\t\t    0 && ent->new->base.hname[len] == 0)\n\t\t\treturn ent->new;\n\t}\n\n\treturn NULL;\n}",
    "includes": [
      "#include \"include/resource.h\"",
      "#include \"include/policy_unpack.h\"",
      "#include \"include/policy_ns.h\"",
      "#include \"include/policy.h\"",
      "#include \"include/path.h\"",
      "#include \"include/match.h\"",
      "#include \"include/ipc.h\"",
      "#include \"include/file.h\"",
      "#include \"include/context.h\"",
      "#include \"include/capability.h\"",
      "#include \"include/apparmor.h\"",
      "#include <linux/user_namespace.h>",
      "#include <linux/rculist.h>",
      "#include <linux/cred.h>",
      "#include <linux/string.h>",
      "#include <linux/spinlock.h>",
      "#include <linux/slab.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "strncmp",
          "args": [
            "ent->new->base.hname",
            "profile->base.hname",
            "len"
          ],
          "line": 717
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "list_for_each_entry",
          "args": [
            "ent",
            "lh",
            "list"
          ],
          "line": 714
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "basename",
          "args": [
            "profile->base.hname"
          ],
          "line": 705
        },
        "resolved": true,
        "details": {
          "function_name": "basename",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/include/lib.h",
          "lines": "141-150",
          "snippet": "static inline const char *basename(const char *hname)\n{\n\tchar *split;\n\n\thname = strim((char *)hname);\n\tfor (split = strstr(hname, \"//\"); split; split = strstr(hname, \"//\"))\n\t\thname = split + 2;\n\n\treturn hname;\n}",
          "includes": [
            "#include \"match.h\"",
            "#include <linux/fs.h>",
            "#include <linux/slab.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"match.h\"\n#include <linux/fs.h>\n#include <linux/slab.h>\n\nstatic inline const char *basename(const char *hname)\n{\n\tchar *split;\n\n\thname = strim((char *)hname);\n\tfor (split = strstr(hname, \"//\"); split; split = strstr(hname, \"//\"))\n\t\thname = split + 2;\n\n\treturn hname;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"include/resource.h\"\n#include \"include/policy_unpack.h\"\n#include \"include/policy_ns.h\"\n#include \"include/policy.h\"\n#include \"include/path.h\"\n#include \"include/match.h\"\n#include \"include/ipc.h\"\n#include \"include/file.h\"\n#include \"include/context.h\"\n#include \"include/capability.h\"\n#include \"include/apparmor.h\"\n#include <linux/user_namespace.h>\n#include <linux/rculist.h>\n#include <linux/cred.h>\n#include <linux/string.h>\n#include <linux/spinlock.h>\n#include <linux/slab.h>\n\nstatic struct aa_profile *__list_lookup_parent(struct list_head *lh,\n\t\t\t\t\t       struct aa_profile *profile)\n{\n\tconst char *base = basename(profile->base.hname);\n\tlong len = base - profile->base.hname;\n\tstruct aa_load_ent *ent;\n\n\t/* parent won't have trailing // so remove from len */\n\tif (len <= 2)\n\t\treturn NULL;\n\tlen -= 2;\n\n\tlist_for_each_entry(ent, lh, list) {\n\t\tif (ent->new == profile)\n\t\t\tcontinue;\n\t\tif (strncmp(ent->new->base.hname, profile->base.hname, len) ==\n\t\t    0 && ent->new->base.hname[len] == 0)\n\t\t\treturn ent->new;\n\t}\n\n\treturn NULL;\n}"
  },
  {
    "function_name": "aa_may_manage_policy",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/policy.c",
    "lines": "678-700",
    "snippet": "int aa_may_manage_policy(struct aa_label *label, struct aa_ns *ns, u32 mask)\n{\n\tconst char *op;\n\n\tif (mask & AA_MAY_REMOVE_POLICY)\n\t\top = OP_PROF_RM;\n\telse if (mask & AA_MAY_REPLACE_POLICY)\n\t\top = OP_PROF_REPL;\n\telse\n\t\top = OP_PROF_LOAD;\n\n\t/* check if loading policy is locked out */\n\tif (aa_g_lock_policy)\n\t\treturn audit_policy(label, op, NULL, NULL, \"policy_locked\",\n\t\t\t\t    -EACCES);\n\n\tif (!policy_admin_capable(ns))\n\t\treturn audit_policy(label, op, NULL, NULL, \"not policy admin\",\n\t\t\t\t    -EACCES);\n\n\t/* TODO: add fine grained mediation of policy loads */\n\treturn 0;\n}",
    "includes": [
      "#include \"include/resource.h\"",
      "#include \"include/policy_unpack.h\"",
      "#include \"include/policy_ns.h\"",
      "#include \"include/policy.h\"",
      "#include \"include/path.h\"",
      "#include \"include/match.h\"",
      "#include \"include/ipc.h\"",
      "#include \"include/file.h\"",
      "#include \"include/context.h\"",
      "#include \"include/capability.h\"",
      "#include \"include/apparmor.h\"",
      "#include <linux/user_namespace.h>",
      "#include <linux/rculist.h>",
      "#include <linux/cred.h>",
      "#include <linux/string.h>",
      "#include <linux/spinlock.h>",
      "#include <linux/slab.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "audit_policy",
          "args": [
            "label",
            "op",
            "NULL",
            "NULL",
            "\"not policy admin\"",
            "-EACCES"
          ],
          "line": 695
        },
        "resolved": true,
        "details": {
          "function_name": "audit_policy",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/policy.c",
          "lines": "615-630",
          "snippet": "static int audit_policy(struct aa_label *label, const char *op,\n\t\t\tconst char *ns_name, const char *name,\n\t\t\tconst char *info, int error)\n{\n\tDEFINE_AUDIT_DATA(sa, LSM_AUDIT_DATA_NONE, op);\n\n\taad(&sa)->iface.ns = ns_name;\n\taad(&sa)->name = name;\n\taad(&sa)->info = info;\n\taad(&sa)->error = error;\n\taad(&sa)->label = label;\n\n\taa_audit_msg(AUDIT_APPARMOR_STATUS, &sa, audit_cb);\n\n\treturn error;\n}",
          "includes": [
            "#include \"include/resource.h\"",
            "#include \"include/policy_unpack.h\"",
            "#include \"include/policy_ns.h\"",
            "#include \"include/policy.h\"",
            "#include \"include/path.h\"",
            "#include \"include/match.h\"",
            "#include \"include/ipc.h\"",
            "#include \"include/file.h\"",
            "#include \"include/context.h\"",
            "#include \"include/capability.h\"",
            "#include \"include/apparmor.h\"",
            "#include <linux/user_namespace.h>",
            "#include <linux/rculist.h>",
            "#include <linux/cred.h>",
            "#include <linux/string.h>",
            "#include <linux/spinlock.h>",
            "#include <linux/slab.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"include/resource.h\"\n#include \"include/policy_unpack.h\"\n#include \"include/policy_ns.h\"\n#include \"include/policy.h\"\n#include \"include/path.h\"\n#include \"include/match.h\"\n#include \"include/ipc.h\"\n#include \"include/file.h\"\n#include \"include/context.h\"\n#include \"include/capability.h\"\n#include \"include/apparmor.h\"\n#include <linux/user_namespace.h>\n#include <linux/rculist.h>\n#include <linux/cred.h>\n#include <linux/string.h>\n#include <linux/spinlock.h>\n#include <linux/slab.h>\n\nstatic int audit_policy(struct aa_label *label, const char *op,\n\t\t\tconst char *ns_name, const char *name,\n\t\t\tconst char *info, int error)\n{\n\tDEFINE_AUDIT_DATA(sa, LSM_AUDIT_DATA_NONE, op);\n\n\taad(&sa)->iface.ns = ns_name;\n\taad(&sa)->name = name;\n\taad(&sa)->info = info;\n\taad(&sa)->error = error;\n\taad(&sa)->label = label;\n\n\taa_audit_msg(AUDIT_APPARMOR_STATUS, &sa, audit_cb);\n\n\treturn error;\n}"
        }
      },
      {
        "call_info": {
          "callee": "policy_admin_capable",
          "args": [
            "ns"
          ],
          "line": 694
        },
        "resolved": true,
        "details": {
          "function_name": "policy_admin_capable",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/policy.c",
          "lines": "660-669",
          "snippet": "bool policy_admin_capable(struct aa_ns *ns)\n{\n\tstruct user_namespace *user_ns = current_user_ns();\n\tbool capable = ns_capable(user_ns, CAP_MAC_ADMIN);\n\n\tAA_DEBUG(\"cap_mac_admin? %d\\n\", capable);\n\tAA_DEBUG(\"policy locked? %d\\n\", aa_g_lock_policy);\n\n\treturn policy_view_capable(ns) && capable && !aa_g_lock_policy;\n}",
          "includes": [
            "#include \"include/resource.h\"",
            "#include \"include/policy_unpack.h\"",
            "#include \"include/policy_ns.h\"",
            "#include \"include/policy.h\"",
            "#include \"include/path.h\"",
            "#include \"include/match.h\"",
            "#include \"include/ipc.h\"",
            "#include \"include/file.h\"",
            "#include \"include/context.h\"",
            "#include \"include/capability.h\"",
            "#include \"include/apparmor.h\"",
            "#include <linux/user_namespace.h>",
            "#include <linux/rculist.h>",
            "#include <linux/cred.h>",
            "#include <linux/string.h>",
            "#include <linux/spinlock.h>",
            "#include <linux/slab.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"include/resource.h\"\n#include \"include/policy_unpack.h\"\n#include \"include/policy_ns.h\"\n#include \"include/policy.h\"\n#include \"include/path.h\"\n#include \"include/match.h\"\n#include \"include/ipc.h\"\n#include \"include/file.h\"\n#include \"include/context.h\"\n#include \"include/capability.h\"\n#include \"include/apparmor.h\"\n#include <linux/user_namespace.h>\n#include <linux/rculist.h>\n#include <linux/cred.h>\n#include <linux/string.h>\n#include <linux/spinlock.h>\n#include <linux/slab.h>\n\nbool policy_admin_capable(struct aa_ns *ns)\n{\n\tstruct user_namespace *user_ns = current_user_ns();\n\tbool capable = ns_capable(user_ns, CAP_MAC_ADMIN);\n\n\tAA_DEBUG(\"cap_mac_admin? %d\\n\", capable);\n\tAA_DEBUG(\"policy locked? %d\\n\", aa_g_lock_policy);\n\n\treturn policy_view_capable(ns) && capable && !aa_g_lock_policy;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"include/resource.h\"\n#include \"include/policy_unpack.h\"\n#include \"include/policy_ns.h\"\n#include \"include/policy.h\"\n#include \"include/path.h\"\n#include \"include/match.h\"\n#include \"include/ipc.h\"\n#include \"include/file.h\"\n#include \"include/context.h\"\n#include \"include/capability.h\"\n#include \"include/apparmor.h\"\n#include <linux/user_namespace.h>\n#include <linux/rculist.h>\n#include <linux/cred.h>\n#include <linux/string.h>\n#include <linux/spinlock.h>\n#include <linux/slab.h>\n\nint aa_may_manage_policy(struct aa_label *label, struct aa_ns *ns, u32 mask)\n{\n\tconst char *op;\n\n\tif (mask & AA_MAY_REMOVE_POLICY)\n\t\top = OP_PROF_RM;\n\telse if (mask & AA_MAY_REPLACE_POLICY)\n\t\top = OP_PROF_REPL;\n\telse\n\t\top = OP_PROF_LOAD;\n\n\t/* check if loading policy is locked out */\n\tif (aa_g_lock_policy)\n\t\treturn audit_policy(label, op, NULL, NULL, \"policy_locked\",\n\t\t\t\t    -EACCES);\n\n\tif (!policy_admin_capable(ns))\n\t\treturn audit_policy(label, op, NULL, NULL, \"not policy admin\",\n\t\t\t\t    -EACCES);\n\n\t/* TODO: add fine grained mediation of policy loads */\n\treturn 0;\n}"
  },
  {
    "function_name": "policy_admin_capable",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/policy.c",
    "lines": "660-669",
    "snippet": "bool policy_admin_capable(struct aa_ns *ns)\n{\n\tstruct user_namespace *user_ns = current_user_ns();\n\tbool capable = ns_capable(user_ns, CAP_MAC_ADMIN);\n\n\tAA_DEBUG(\"cap_mac_admin? %d\\n\", capable);\n\tAA_DEBUG(\"policy locked? %d\\n\", aa_g_lock_policy);\n\n\treturn policy_view_capable(ns) && capable && !aa_g_lock_policy;\n}",
    "includes": [
      "#include \"include/resource.h\"",
      "#include \"include/policy_unpack.h\"",
      "#include \"include/policy_ns.h\"",
      "#include \"include/policy.h\"",
      "#include \"include/path.h\"",
      "#include \"include/match.h\"",
      "#include \"include/ipc.h\"",
      "#include \"include/file.h\"",
      "#include \"include/context.h\"",
      "#include \"include/capability.h\"",
      "#include \"include/apparmor.h\"",
      "#include <linux/user_namespace.h>",
      "#include <linux/rculist.h>",
      "#include <linux/cred.h>",
      "#include <linux/string.h>",
      "#include <linux/spinlock.h>",
      "#include <linux/slab.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "policy_view_capable",
          "args": [
            "ns"
          ],
          "line": 668
        },
        "resolved": true,
        "details": {
          "function_name": "policy_view_capable",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/policy.c",
          "lines": "640-658",
          "snippet": "bool policy_view_capable(struct aa_ns *ns)\n{\n\tstruct user_namespace *user_ns = current_user_ns();\n\tstruct aa_ns *view_ns = aa_get_current_ns();\n\tbool root_in_user_ns = uid_eq(current_euid(), make_kuid(user_ns, 0)) ||\n\t\t\t       in_egroup_p(make_kgid(user_ns, 0));\n\tbool response = false;\n\tif (!ns)\n\t\tns = view_ns;\n\n\tif (root_in_user_ns && aa_ns_visible(view_ns, ns, true) &&\n\t    (user_ns == &init_user_ns ||\n\t     (unprivileged_userns_apparmor_policy != 0 &&\n\t      user_ns->level == view_ns->level)))\n\t\tresponse = true;\n\taa_put_ns(view_ns);\n\n\treturn response;\n}",
          "includes": [
            "#include \"include/resource.h\"",
            "#include \"include/policy_unpack.h\"",
            "#include \"include/policy_ns.h\"",
            "#include \"include/policy.h\"",
            "#include \"include/path.h\"",
            "#include \"include/match.h\"",
            "#include \"include/ipc.h\"",
            "#include \"include/file.h\"",
            "#include \"include/context.h\"",
            "#include \"include/capability.h\"",
            "#include \"include/apparmor.h\"",
            "#include <linux/user_namespace.h>",
            "#include <linux/rculist.h>",
            "#include <linux/cred.h>",
            "#include <linux/string.h>",
            "#include <linux/spinlock.h>",
            "#include <linux/slab.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "int unprivileged_userns_apparmor_policy = 1;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"include/resource.h\"\n#include \"include/policy_unpack.h\"\n#include \"include/policy_ns.h\"\n#include \"include/policy.h\"\n#include \"include/path.h\"\n#include \"include/match.h\"\n#include \"include/ipc.h\"\n#include \"include/file.h\"\n#include \"include/context.h\"\n#include \"include/capability.h\"\n#include \"include/apparmor.h\"\n#include <linux/user_namespace.h>\n#include <linux/rculist.h>\n#include <linux/cred.h>\n#include <linux/string.h>\n#include <linux/spinlock.h>\n#include <linux/slab.h>\n\nint unprivileged_userns_apparmor_policy = 1;\n\nbool policy_view_capable(struct aa_ns *ns)\n{\n\tstruct user_namespace *user_ns = current_user_ns();\n\tstruct aa_ns *view_ns = aa_get_current_ns();\n\tbool root_in_user_ns = uid_eq(current_euid(), make_kuid(user_ns, 0)) ||\n\t\t\t       in_egroup_p(make_kgid(user_ns, 0));\n\tbool response = false;\n\tif (!ns)\n\t\tns = view_ns;\n\n\tif (root_in_user_ns && aa_ns_visible(view_ns, ns, true) &&\n\t    (user_ns == &init_user_ns ||\n\t     (unprivileged_userns_apparmor_policy != 0 &&\n\t      user_ns->level == view_ns->level)))\n\t\tresponse = true;\n\taa_put_ns(view_ns);\n\n\treturn response;\n}"
        }
      },
      {
        "call_info": {
          "callee": "AA_DEBUG",
          "args": [
            "\"policy locked? %d\\n\"",
            "aa_g_lock_policy"
          ],
          "line": 666
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "AA_DEBUG",
          "args": [
            "\"cap_mac_admin? %d\\n\"",
            "capable"
          ],
          "line": 665
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ns_capable",
          "args": [
            "user_ns",
            "CAP_MAC_ADMIN"
          ],
          "line": 663
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "current_user_ns",
          "args": [],
          "line": 662
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"include/resource.h\"\n#include \"include/policy_unpack.h\"\n#include \"include/policy_ns.h\"\n#include \"include/policy.h\"\n#include \"include/path.h\"\n#include \"include/match.h\"\n#include \"include/ipc.h\"\n#include \"include/file.h\"\n#include \"include/context.h\"\n#include \"include/capability.h\"\n#include \"include/apparmor.h\"\n#include <linux/user_namespace.h>\n#include <linux/rculist.h>\n#include <linux/cred.h>\n#include <linux/string.h>\n#include <linux/spinlock.h>\n#include <linux/slab.h>\n\nbool policy_admin_capable(struct aa_ns *ns)\n{\n\tstruct user_namespace *user_ns = current_user_ns();\n\tbool capable = ns_capable(user_ns, CAP_MAC_ADMIN);\n\n\tAA_DEBUG(\"cap_mac_admin? %d\\n\", capable);\n\tAA_DEBUG(\"policy locked? %d\\n\", aa_g_lock_policy);\n\n\treturn policy_view_capable(ns) && capable && !aa_g_lock_policy;\n}"
  },
  {
    "function_name": "policy_view_capable",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/policy.c",
    "lines": "640-658",
    "snippet": "bool policy_view_capable(struct aa_ns *ns)\n{\n\tstruct user_namespace *user_ns = current_user_ns();\n\tstruct aa_ns *view_ns = aa_get_current_ns();\n\tbool root_in_user_ns = uid_eq(current_euid(), make_kuid(user_ns, 0)) ||\n\t\t\t       in_egroup_p(make_kgid(user_ns, 0));\n\tbool response = false;\n\tif (!ns)\n\t\tns = view_ns;\n\n\tif (root_in_user_ns && aa_ns_visible(view_ns, ns, true) &&\n\t    (user_ns == &init_user_ns ||\n\t     (unprivileged_userns_apparmor_policy != 0 &&\n\t      user_ns->level == view_ns->level)))\n\t\tresponse = true;\n\taa_put_ns(view_ns);\n\n\treturn response;\n}",
    "includes": [
      "#include \"include/resource.h\"",
      "#include \"include/policy_unpack.h\"",
      "#include \"include/policy_ns.h\"",
      "#include \"include/policy.h\"",
      "#include \"include/path.h\"",
      "#include \"include/match.h\"",
      "#include \"include/ipc.h\"",
      "#include \"include/file.h\"",
      "#include \"include/context.h\"",
      "#include \"include/capability.h\"",
      "#include \"include/apparmor.h\"",
      "#include <linux/user_namespace.h>",
      "#include <linux/rculist.h>",
      "#include <linux/cred.h>",
      "#include <linux/string.h>",
      "#include <linux/spinlock.h>",
      "#include <linux/slab.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "int unprivileged_userns_apparmor_policy = 1;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "aa_put_ns",
          "args": [
            "view_ns"
          ],
          "line": 655
        },
        "resolved": true,
        "details": {
          "function_name": "aa_put_ns",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/include/policy_ns.h",
          "lines": "130-134",
          "snippet": "static inline void aa_put_ns(struct aa_ns *ns)\n{\n\tif (ns)\n\t\taa_put_profile(ns->unconfined);\n}",
          "includes": [
            "#include \"policy.h\"",
            "#include \"label.h\"",
            "#include \"apparmorfs.h\"",
            "#include \"apparmor.h\"",
            "#include <linux/kref.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"policy.h\"\n#include \"label.h\"\n#include \"apparmorfs.h\"\n#include \"apparmor.h\"\n#include <linux/kref.h>\n\nstatic inline void aa_put_ns(struct aa_ns *ns)\n{\n\tif (ns)\n\t\taa_put_profile(ns->unconfined);\n}"
        }
      },
      {
        "call_info": {
          "callee": "aa_ns_visible",
          "args": [
            "view_ns",
            "ns",
            "true"
          ],
          "line": 650
        },
        "resolved": true,
        "details": {
          "function_name": "aa_ns_visible",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/policy_ns.c",
          "lines": "41-55",
          "snippet": "bool aa_ns_visible(struct aa_ns *curr, struct aa_ns *view, bool subns)\n{\n\tif (curr == view)\n\t\treturn true;\n\n\tif (!subns)\n\t\treturn false;\n\n\tfor ( ; view; view = view->parent) {\n\t\tif (view->parent == curr)\n\t\t\treturn true;\n\t}\n\n\treturn false;\n}",
          "includes": [
            "#include \"include/policy.h\"",
            "#include \"include/label.h\"",
            "#include \"include/policy_ns.h\"",
            "#include \"include/context.h\"",
            "#include \"include/apparmor.h\"",
            "#include <linux/string.h>",
            "#include <linux/slab.h>",
            "#include <linux/mutex.h>",
            "#include <linux/list.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"include/policy.h\"\n#include \"include/label.h\"\n#include \"include/policy_ns.h\"\n#include \"include/context.h\"\n#include \"include/apparmor.h\"\n#include <linux/string.h>\n#include <linux/slab.h>\n#include <linux/mutex.h>\n#include <linux/list.h>\n\nbool aa_ns_visible(struct aa_ns *curr, struct aa_ns *view, bool subns)\n{\n\tif (curr == view)\n\t\treturn true;\n\n\tif (!subns)\n\t\treturn false;\n\n\tfor ( ; view; view = view->parent) {\n\t\tif (view->parent == curr)\n\t\t\treturn true;\n\t}\n\n\treturn false;\n}"
        }
      },
      {
        "call_info": {
          "callee": "in_egroup_p",
          "args": [
            "make_kgid(user_ns, 0)"
          ],
          "line": 645
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "make_kgid",
          "args": [
            "user_ns",
            "0"
          ],
          "line": 645
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "uid_eq",
          "args": [
            "current_euid()",
            "make_kuid(user_ns, 0)"
          ],
          "line": 644
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "make_kuid",
          "args": [
            "user_ns",
            "0"
          ],
          "line": 644
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "current_euid",
          "args": [],
          "line": 644
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "aa_get_current_ns",
          "args": [],
          "line": 643
        },
        "resolved": true,
        "details": {
          "function_name": "aa_get_current_ns",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/include/context.h",
          "lines": "204-214",
          "snippet": "static inline struct aa_ns *aa_get_current_ns(void)\n{\n\tstruct aa_label *label;\n\tstruct aa_ns *ns;\n\n\tlabel  = __begin_current_label_crit_section();\n\tns = aa_get_ns(labels_ns(label));\n\t__end_current_label_crit_section(label);\n\n\treturn ns;\n}",
          "includes": [
            "#include \"policy_ns.h\"",
            "#include \"label.h\"",
            "#include <linux/sched.h>",
            "#include <linux/slab.h>",
            "#include <linux/cred.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"policy_ns.h\"\n#include \"label.h\"\n#include <linux/sched.h>\n#include <linux/slab.h>\n#include <linux/cred.h>\n\nstatic inline struct aa_ns *aa_get_current_ns(void)\n{\n\tstruct aa_label *label;\n\tstruct aa_ns *ns;\n\n\tlabel  = __begin_current_label_crit_section();\n\tns = aa_get_ns(labels_ns(label));\n\t__end_current_label_crit_section(label);\n\n\treturn ns;\n}"
        }
      },
      {
        "call_info": {
          "callee": "current_user_ns",
          "args": [],
          "line": 642
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"include/resource.h\"\n#include \"include/policy_unpack.h\"\n#include \"include/policy_ns.h\"\n#include \"include/policy.h\"\n#include \"include/path.h\"\n#include \"include/match.h\"\n#include \"include/ipc.h\"\n#include \"include/file.h\"\n#include \"include/context.h\"\n#include \"include/capability.h\"\n#include \"include/apparmor.h\"\n#include <linux/user_namespace.h>\n#include <linux/rculist.h>\n#include <linux/cred.h>\n#include <linux/string.h>\n#include <linux/spinlock.h>\n#include <linux/slab.h>\n\nint unprivileged_userns_apparmor_policy = 1;\n\nbool policy_view_capable(struct aa_ns *ns)\n{\n\tstruct user_namespace *user_ns = current_user_ns();\n\tstruct aa_ns *view_ns = aa_get_current_ns();\n\tbool root_in_user_ns = uid_eq(current_euid(), make_kuid(user_ns, 0)) ||\n\t\t\t       in_egroup_p(make_kgid(user_ns, 0));\n\tbool response = false;\n\tif (!ns)\n\t\tns = view_ns;\n\n\tif (root_in_user_ns && aa_ns_visible(view_ns, ns, true) &&\n\t    (user_ns == &init_user_ns ||\n\t     (unprivileged_userns_apparmor_policy != 0 &&\n\t      user_ns->level == view_ns->level)))\n\t\tresponse = true;\n\taa_put_ns(view_ns);\n\n\treturn response;\n}"
  },
  {
    "function_name": "audit_policy",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/policy.c",
    "lines": "615-630",
    "snippet": "static int audit_policy(struct aa_label *label, const char *op,\n\t\t\tconst char *ns_name, const char *name,\n\t\t\tconst char *info, int error)\n{\n\tDEFINE_AUDIT_DATA(sa, LSM_AUDIT_DATA_NONE, op);\n\n\taad(&sa)->iface.ns = ns_name;\n\taad(&sa)->name = name;\n\taad(&sa)->info = info;\n\taad(&sa)->error = error;\n\taad(&sa)->label = label;\n\n\taa_audit_msg(AUDIT_APPARMOR_STATUS, &sa, audit_cb);\n\n\treturn error;\n}",
    "includes": [
      "#include \"include/resource.h\"",
      "#include \"include/policy_unpack.h\"",
      "#include \"include/policy_ns.h\"",
      "#include \"include/policy.h\"",
      "#include \"include/path.h\"",
      "#include \"include/match.h\"",
      "#include \"include/ipc.h\"",
      "#include \"include/file.h\"",
      "#include \"include/context.h\"",
      "#include \"include/capability.h\"",
      "#include \"include/apparmor.h\"",
      "#include <linux/user_namespace.h>",
      "#include <linux/rculist.h>",
      "#include <linux/cred.h>",
      "#include <linux/string.h>",
      "#include <linux/spinlock.h>",
      "#include <linux/slab.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "aa_audit_msg",
          "args": [
            "AUDIT_APPARMOR_STATUS",
            "&sa",
            "audit_cb"
          ],
          "line": 627
        },
        "resolved": true,
        "details": {
          "function_name": "aa_audit_msg",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/audit.c",
          "lines": "111-116",
          "snippet": "void aa_audit_msg(int type, struct common_audit_data *sa,\n\t\t  void (*cb) (struct audit_buffer *, void *))\n{\n\taad(sa)->type = type;\n\tcommon_lsm_audit(sa, audit_pre, cb);\n}",
          "includes": [
            "#include \"include/policy_ns.h\"",
            "#include \"include/policy.h\"",
            "#include \"include/audit.h\"",
            "#include \"include/apparmor.h\"",
            "#include <linux/socket.h>",
            "#include <linux/audit.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"include/policy_ns.h\"\n#include \"include/policy.h\"\n#include \"include/audit.h\"\n#include \"include/apparmor.h\"\n#include <linux/socket.h>\n#include <linux/audit.h>\n\nvoid aa_audit_msg(int type, struct common_audit_data *sa,\n\t\t  void (*cb) (struct audit_buffer *, void *))\n{\n\taad(sa)->type = type;\n\tcommon_lsm_audit(sa, audit_pre, cb);\n}"
        }
      },
      {
        "call_info": {
          "callee": "aad",
          "args": [
            "&sa"
          ],
          "line": 625
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "aad",
          "args": [
            "&sa"
          ],
          "line": 624
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "aad",
          "args": [
            "&sa"
          ],
          "line": 623
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "aad",
          "args": [
            "&sa"
          ],
          "line": 622
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "aad",
          "args": [
            "&sa"
          ],
          "line": 621
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DEFINE_AUDIT_DATA",
          "args": [
            "sa",
            "LSM_AUDIT_DATA_NONE",
            "op"
          ],
          "line": 619
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"include/resource.h\"\n#include \"include/policy_unpack.h\"\n#include \"include/policy_ns.h\"\n#include \"include/policy.h\"\n#include \"include/path.h\"\n#include \"include/match.h\"\n#include \"include/ipc.h\"\n#include \"include/file.h\"\n#include \"include/context.h\"\n#include \"include/capability.h\"\n#include \"include/apparmor.h\"\n#include <linux/user_namespace.h>\n#include <linux/rculist.h>\n#include <linux/cred.h>\n#include <linux/string.h>\n#include <linux/spinlock.h>\n#include <linux/slab.h>\n\nstatic int audit_policy(struct aa_label *label, const char *op,\n\t\t\tconst char *ns_name, const char *name,\n\t\t\tconst char *info, int error)\n{\n\tDEFINE_AUDIT_DATA(sa, LSM_AUDIT_DATA_NONE, op);\n\n\taad(&sa)->iface.ns = ns_name;\n\taad(&sa)->name = name;\n\taad(&sa)->info = info;\n\taad(&sa)->error = error;\n\taad(&sa)->label = label;\n\n\taa_audit_msg(AUDIT_APPARMOR_STATUS, &sa, audit_cb);\n\n\treturn error;\n}"
  },
  {
    "function_name": "audit_cb",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/policy.c",
    "lines": "594-602",
    "snippet": "static void audit_cb(struct audit_buffer *ab, void *va)\n{\n\tstruct common_audit_data *sa = va;\n\n\tif (aad(sa)->iface.ns) {\n\t\taudit_log_format(ab, \" ns=\");\n\t\taudit_log_untrustedstring(ab, aad(sa)->iface.ns);\n\t}\n}",
    "includes": [
      "#include \"include/resource.h\"",
      "#include \"include/policy_unpack.h\"",
      "#include \"include/policy_ns.h\"",
      "#include \"include/policy.h\"",
      "#include \"include/path.h\"",
      "#include \"include/match.h\"",
      "#include \"include/ipc.h\"",
      "#include \"include/file.h\"",
      "#include \"include/context.h\"",
      "#include \"include/capability.h\"",
      "#include \"include/apparmor.h\"",
      "#include <linux/user_namespace.h>",
      "#include <linux/rculist.h>",
      "#include <linux/cred.h>",
      "#include <linux/string.h>",
      "#include <linux/spinlock.h>",
      "#include <linux/slab.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "audit_log_untrustedstring",
          "args": [
            "ab",
            "aad(sa)->iface.ns"
          ],
          "line": 600
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "aad",
          "args": [
            "sa"
          ],
          "line": 600
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "audit_log_format",
          "args": [
            "ab",
            "\" ns=\""
          ],
          "line": 599
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "aad",
          "args": [
            "sa"
          ],
          "line": 598
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"include/resource.h\"\n#include \"include/policy_unpack.h\"\n#include \"include/policy_ns.h\"\n#include \"include/policy.h\"\n#include \"include/path.h\"\n#include \"include/match.h\"\n#include \"include/ipc.h\"\n#include \"include/file.h\"\n#include \"include/context.h\"\n#include \"include/capability.h\"\n#include \"include/apparmor.h\"\n#include <linux/user_namespace.h>\n#include <linux/rculist.h>\n#include <linux/cred.h>\n#include <linux/string.h>\n#include <linux/spinlock.h>\n#include <linux/slab.h>\n\nstatic void audit_cb(struct audit_buffer *ab, void *va)\n{\n\tstruct common_audit_data *sa = va;\n\n\tif (aad(sa)->iface.ns) {\n\t\taudit_log_format(ab, \" ns=\");\n\t\taudit_log_untrustedstring(ab, aad(sa)->iface.ns);\n\t}\n}"
  },
  {
    "function_name": "replacement_allowed",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/policy.c",
    "lines": "578-591",
    "snippet": "static int replacement_allowed(struct aa_profile *profile, int noreplace,\n\t\t\t       const char **info)\n{\n\tif (profile) {\n\t\tif (profile->label.flags & FLAG_IMMUTIBLE) {\n\t\t\t*info = \"cannot replace immutible profile\";\n\t\t\treturn -EPERM;\n\t\t} else if (noreplace) {\n\t\t\t*info = \"profile already exists\";\n\t\t\treturn -EEXIST;\n\t\t}\n\t}\n\treturn 0;\n}",
    "includes": [
      "#include \"include/resource.h\"",
      "#include \"include/policy_unpack.h\"",
      "#include \"include/policy_ns.h\"",
      "#include \"include/policy.h\"",
      "#include \"include/path.h\"",
      "#include \"include/match.h\"",
      "#include \"include/ipc.h\"",
      "#include \"include/file.h\"",
      "#include \"include/context.h\"",
      "#include \"include/capability.h\"",
      "#include \"include/apparmor.h\"",
      "#include <linux/user_namespace.h>",
      "#include <linux/rculist.h>",
      "#include <linux/cred.h>",
      "#include <linux/string.h>",
      "#include <linux/spinlock.h>",
      "#include <linux/slab.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"include/resource.h\"\n#include \"include/policy_unpack.h\"\n#include \"include/policy_ns.h\"\n#include \"include/policy.h\"\n#include \"include/path.h\"\n#include \"include/match.h\"\n#include \"include/ipc.h\"\n#include \"include/file.h\"\n#include \"include/context.h\"\n#include \"include/capability.h\"\n#include \"include/apparmor.h\"\n#include <linux/user_namespace.h>\n#include <linux/rculist.h>\n#include <linux/cred.h>\n#include <linux/string.h>\n#include <linux/spinlock.h>\n#include <linux/slab.h>\n\nstatic int replacement_allowed(struct aa_profile *profile, int noreplace,\n\t\t\t       const char **info)\n{\n\tif (profile) {\n\t\tif (profile->label.flags & FLAG_IMMUTIBLE) {\n\t\t\t*info = \"cannot replace immutible profile\";\n\t\t\treturn -EPERM;\n\t\t} else if (noreplace) {\n\t\t\t*info = \"profile already exists\";\n\t\t\treturn -EEXIST;\n\t\t}\n\t}\n\treturn 0;\n}"
  },
  {
    "function_name": "aa_new_null_profile",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/policy.c",
    "lines": "500-568",
    "snippet": "struct aa_profile *aa_new_null_profile(struct aa_profile *parent, bool hat,\n\t\t\t\t       const char *base, gfp_t gfp)\n{\n\tstruct aa_profile *p, *profile;\n\tconst char *bname;\n\tchar *name = NULL;\n\n\tAA_BUG(!parent);\n\n\tif (base) {\n\t\tname = kmalloc(strlen(parent->base.hname) + 8 + strlen(base),\n\t\t\t       gfp);\n\t\tif (name) {\n\t\t\tsprintf(name, \"%s//null-%s\", parent->base.hname, base);\n\t\t\tgoto name;\n\t\t}\n\t\t/* fall through to try shorter uniq */\n\t}\n\n\tname = kmalloc(strlen(parent->base.hname) + 2 + 7 + 8, gfp);\n\tif (!name)\n\t\treturn NULL;\n\tsprintf(name, \"%s//null-%x\", parent->base.hname,\n\t\tatomic_inc_return(&parent->ns->uniq_null));\n\nname:\n\t/* lookup to see if this is a dup creation */\n\tbname = basename(name);\n\tprofile = aa_find_child(parent, bname);\n\tif (profile)\n\t\tgoto out;\n\n\tprofile = aa_alloc_profile(name, NULL, gfp);\n\tif (!profile)\n\t\tgoto fail;\n\n\tprofile->mode = APPARMOR_COMPLAIN;\n\tprofile->label.flags |= FLAG_NULL;\n\tif (hat)\n\t\tprofile->label.flags |= FLAG_HAT;\n\tprofile->path_flags = parent->path_flags;\n\n\t/* released on free_profile */\n\trcu_assign_pointer(profile->parent, aa_get_profile(parent));\n\tprofile->ns = aa_get_ns(parent->ns);\n\tprofile->file.dfa = aa_get_dfa(nulldfa);\n\tprofile->policy.dfa = aa_get_dfa(nulldfa);\n\n\tmutex_lock_nested(&profile->ns->lock, profile->ns->level);\n\tp = __find_child(&parent->base.profiles, bname);\n\tif (p) {\n\t\taa_free_profile(profile);\n\t\tprofile = aa_get_profile(p);\n\t} else {\n\t\t__add_profile(&parent->base.profiles, profile);\n\t}\n\tmutex_unlock(&profile->ns->lock);\n\n\t/* refcount released by caller */\nout:\n\tkfree(name);\n\n\treturn profile;\n\nfail:\n\tkfree(name);\n\taa_free_profile(profile);\n\treturn NULL;\n}",
    "includes": [
      "#include \"include/resource.h\"",
      "#include \"include/policy_unpack.h\"",
      "#include \"include/policy_ns.h\"",
      "#include \"include/policy.h\"",
      "#include \"include/path.h\"",
      "#include \"include/match.h\"",
      "#include \"include/ipc.h\"",
      "#include \"include/file.h\"",
      "#include \"include/context.h\"",
      "#include \"include/capability.h\"",
      "#include \"include/apparmor.h\"",
      "#include <linux/user_namespace.h>",
      "#include <linux/rculist.h>",
      "#include <linux/cred.h>",
      "#include <linux/string.h>",
      "#include <linux/spinlock.h>",
      "#include <linux/slab.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "aa_free_profile",
          "args": [
            "profile"
          ],
          "line": 566
        },
        "resolved": true,
        "details": {
          "function_name": "aa_free_profile",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/policy.c",
          "lines": "210-245",
          "snippet": "void aa_free_profile(struct aa_profile *profile)\n{\n\tstruct rhashtable *rht;\n\n\tAA_DEBUG(\"%s(%p)\\n\", __func__, profile);\n\n\tif (!profile)\n\t\treturn;\n\n\t/* free children profiles */\n\taa_policy_destroy(&profile->base);\n\taa_put_profile(rcu_access_pointer(profile->parent));\n\n\taa_put_ns(profile->ns);\n\tkzfree(profile->rename);\n\n\taa_free_file_rules(&profile->file);\n\taa_free_cap_rules(&profile->caps);\n\taa_free_rlimit_rules(&profile->rlimits);\n\n\tkzfree(profile->dirname);\n\taa_put_dfa(profile->xmatch);\n\taa_put_dfa(profile->policy.dfa);\n\n\tif (profile->data) {\n\t\trht = profile->data;\n\t\tprofile->data = NULL;\n\t\trhashtable_free_and_destroy(rht, aa_free_data, NULL);\n\t\tkzfree(rht);\n\t}\n\n\tkzfree(profile->hash);\n\taa_put_loaddata(profile->rawdata);\n\n\tkzfree(profile);\n}",
          "includes": [
            "#include \"include/resource.h\"",
            "#include \"include/policy_unpack.h\"",
            "#include \"include/policy_ns.h\"",
            "#include \"include/policy.h\"",
            "#include \"include/path.h\"",
            "#include \"include/match.h\"",
            "#include \"include/ipc.h\"",
            "#include \"include/file.h\"",
            "#include \"include/context.h\"",
            "#include \"include/capability.h\"",
            "#include \"include/apparmor.h\"",
            "#include <linux/user_namespace.h>",
            "#include <linux/rculist.h>",
            "#include <linux/cred.h>",
            "#include <linux/string.h>",
            "#include <linux/spinlock.h>",
            "#include <linux/slab.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"include/resource.h\"\n#include \"include/policy_unpack.h\"\n#include \"include/policy_ns.h\"\n#include \"include/policy.h\"\n#include \"include/path.h\"\n#include \"include/match.h\"\n#include \"include/ipc.h\"\n#include \"include/file.h\"\n#include \"include/context.h\"\n#include \"include/capability.h\"\n#include \"include/apparmor.h\"\n#include <linux/user_namespace.h>\n#include <linux/rculist.h>\n#include <linux/cred.h>\n#include <linux/string.h>\n#include <linux/spinlock.h>\n#include <linux/slab.h>\n\nvoid aa_free_profile(struct aa_profile *profile)\n{\n\tstruct rhashtable *rht;\n\n\tAA_DEBUG(\"%s(%p)\\n\", __func__, profile);\n\n\tif (!profile)\n\t\treturn;\n\n\t/* free children profiles */\n\taa_policy_destroy(&profile->base);\n\taa_put_profile(rcu_access_pointer(profile->parent));\n\n\taa_put_ns(profile->ns);\n\tkzfree(profile->rename);\n\n\taa_free_file_rules(&profile->file);\n\taa_free_cap_rules(&profile->caps);\n\taa_free_rlimit_rules(&profile->rlimits);\n\n\tkzfree(profile->dirname);\n\taa_put_dfa(profile->xmatch);\n\taa_put_dfa(profile->policy.dfa);\n\n\tif (profile->data) {\n\t\trht = profile->data;\n\t\tprofile->data = NULL;\n\t\trhashtable_free_and_destroy(rht, aa_free_data, NULL);\n\t\tkzfree(rht);\n\t}\n\n\tkzfree(profile->hash);\n\taa_put_loaddata(profile->rawdata);\n\n\tkzfree(profile);\n}"
        }
      },
      {
        "call_info": {
          "callee": "kfree",
          "args": [
            "name"
          ],
          "line": 565
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kfree",
          "args": [
            "name"
          ],
          "line": 560
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "mutex_unlock",
          "args": [
            "&profile->ns->lock"
          ],
          "line": 556
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "__add_profile",
          "args": [
            "&parent->base.profiles",
            "profile"
          ],
          "line": 554
        },
        "resolved": true,
        "details": {
          "function_name": "__add_profile",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/policy.c",
          "lines": "114-129",
          "snippet": "static void __add_profile(struct list_head *list, struct aa_profile *profile)\n{\n\tstruct aa_label *l;\n\n\tAA_BUG(!list);\n\tAA_BUG(!profile);\n\tAA_BUG(!profile->ns);\n\tAA_BUG(!mutex_is_locked(&profile->ns->lock));\n\n\tlist_add_rcu(&profile->base.list, list);\n\t/* get list reference */\n\taa_get_profile(profile);\n\tl = aa_label_insert(&profile->ns->labels, &profile->label);\n\tAA_BUG(l != &profile->label);\n\taa_put_label(l);\n}",
          "includes": [
            "#include \"include/resource.h\"",
            "#include \"include/policy_unpack.h\"",
            "#include \"include/policy_ns.h\"",
            "#include \"include/policy.h\"",
            "#include \"include/path.h\"",
            "#include \"include/match.h\"",
            "#include \"include/ipc.h\"",
            "#include \"include/file.h\"",
            "#include \"include/context.h\"",
            "#include \"include/capability.h\"",
            "#include \"include/apparmor.h\"",
            "#include <linux/user_namespace.h>",
            "#include <linux/rculist.h>",
            "#include <linux/cred.h>",
            "#include <linux/string.h>",
            "#include <linux/spinlock.h>",
            "#include <linux/slab.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"include/resource.h\"\n#include \"include/policy_unpack.h\"\n#include \"include/policy_ns.h\"\n#include \"include/policy.h\"\n#include \"include/path.h\"\n#include \"include/match.h\"\n#include \"include/ipc.h\"\n#include \"include/file.h\"\n#include \"include/context.h\"\n#include \"include/capability.h\"\n#include \"include/apparmor.h\"\n#include <linux/user_namespace.h>\n#include <linux/rculist.h>\n#include <linux/cred.h>\n#include <linux/string.h>\n#include <linux/spinlock.h>\n#include <linux/slab.h>\n\nstatic void __add_profile(struct list_head *list, struct aa_profile *profile)\n{\n\tstruct aa_label *l;\n\n\tAA_BUG(!list);\n\tAA_BUG(!profile);\n\tAA_BUG(!profile->ns);\n\tAA_BUG(!mutex_is_locked(&profile->ns->lock));\n\n\tlist_add_rcu(&profile->base.list, list);\n\t/* get list reference */\n\taa_get_profile(profile);\n\tl = aa_label_insert(&profile->ns->labels, &profile->label);\n\tAA_BUG(l != &profile->label);\n\taa_put_label(l);\n}"
        }
      },
      {
        "call_info": {
          "callee": "aa_get_profile",
          "args": [
            "p"
          ],
          "line": 552
        },
        "resolved": true,
        "details": {
          "function_name": "aa_get_profile_rcu",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/include/policy.h",
          "lines": "260-271",
          "snippet": "static inline struct aa_profile *aa_get_profile_rcu(struct aa_profile __rcu **p)\n{\n\tstruct aa_profile *c;\n\n\trcu_read_lock();\n\tdo {\n\t\tc = rcu_dereference(*p);\n\t} while (c && !kref_get_unless_zero(&c->label.count));\n\trcu_read_unlock();\n\n\treturn c;\n}",
          "includes": [
            "#include \"resource.h\"",
            "#include \"perms.h\"",
            "#include \"label.h\"",
            "#include \"lib.h\"",
            "#include \"file.h\"",
            "#include \"domain.h\"",
            "#include \"capability.h\"",
            "#include \"audit.h\"",
            "#include \"apparmor.h\"",
            "#include <linux/socket.h>",
            "#include <linux/slab.h>",
            "#include <linux/sched.h>",
            "#include <linux/rhashtable.h>",
            "#include <linux/kref.h>",
            "#include <linux/cred.h>",
            "#include <linux/capability.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"resource.h\"\n#include \"perms.h\"\n#include \"label.h\"\n#include \"lib.h\"\n#include \"file.h\"\n#include \"domain.h\"\n#include \"capability.h\"\n#include \"audit.h\"\n#include \"apparmor.h\"\n#include <linux/socket.h>\n#include <linux/slab.h>\n#include <linux/sched.h>\n#include <linux/rhashtable.h>\n#include <linux/kref.h>\n#include <linux/cred.h>\n#include <linux/capability.h>\n\nstatic inline struct aa_profile *aa_get_profile_rcu(struct aa_profile __rcu **p)\n{\n\tstruct aa_profile *c;\n\n\trcu_read_lock();\n\tdo {\n\t\tc = rcu_dereference(*p);\n\t} while (c && !kref_get_unless_zero(&c->label.count));\n\trcu_read_unlock();\n\n\treturn c;\n}"
        }
      },
      {
        "call_info": {
          "callee": "__find_child",
          "args": [
            "&parent->base.profiles",
            "bname"
          ],
          "line": 549
        },
        "resolved": true,
        "details": {
          "function_name": "__find_child",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/policy.c",
          "lines": "319-322",
          "snippet": "static struct aa_profile *__find_child(struct list_head *head, const char *name)\n{\n\treturn __strn_find_child(head, name, strlen(name));\n}",
          "includes": [
            "#include \"include/resource.h\"",
            "#include \"include/policy_unpack.h\"",
            "#include \"include/policy_ns.h\"",
            "#include \"include/policy.h\"",
            "#include \"include/path.h\"",
            "#include \"include/match.h\"",
            "#include \"include/ipc.h\"",
            "#include \"include/file.h\"",
            "#include \"include/context.h\"",
            "#include \"include/capability.h\"",
            "#include \"include/apparmor.h\"",
            "#include <linux/user_namespace.h>",
            "#include <linux/rculist.h>",
            "#include <linux/cred.h>",
            "#include <linux/string.h>",
            "#include <linux/spinlock.h>",
            "#include <linux/slab.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"include/resource.h\"\n#include \"include/policy_unpack.h\"\n#include \"include/policy_ns.h\"\n#include \"include/policy.h\"\n#include \"include/path.h\"\n#include \"include/match.h\"\n#include \"include/ipc.h\"\n#include \"include/file.h\"\n#include \"include/context.h\"\n#include \"include/capability.h\"\n#include \"include/apparmor.h\"\n#include <linux/user_namespace.h>\n#include <linux/rculist.h>\n#include <linux/cred.h>\n#include <linux/string.h>\n#include <linux/spinlock.h>\n#include <linux/slab.h>\n\nstatic struct aa_profile *__find_child(struct list_head *head, const char *name)\n{\n\treturn __strn_find_child(head, name, strlen(name));\n}"
        }
      },
      {
        "call_info": {
          "callee": "mutex_lock_nested",
          "args": [
            "&profile->ns->lock",
            "profile->ns->level"
          ],
          "line": 548
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "aa_get_dfa",
          "args": [
            "nulldfa"
          ],
          "line": 546
        },
        "resolved": true,
        "details": {
          "function_name": "aa_get_dfa",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/include/match.h",
          "lines": "142-148",
          "snippet": "static inline struct aa_dfa *aa_get_dfa(struct aa_dfa *dfa)\n{\n\tif (dfa)\n\t\tkref_get(&(dfa->count));\n\n\treturn dfa;\n}",
          "includes": [
            "#include <linux/kref.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/kref.h>\n\nstatic inline struct aa_dfa *aa_get_dfa(struct aa_dfa *dfa)\n{\n\tif (dfa)\n\t\tkref_get(&(dfa->count));\n\n\treturn dfa;\n}"
        }
      },
      {
        "call_info": {
          "callee": "aa_get_ns",
          "args": [
            "parent->ns"
          ],
          "line": 544
        },
        "resolved": true,
        "details": {
          "function_name": "aa_get_ns",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/include/policy_ns.h",
          "lines": "116-122",
          "snippet": "static inline struct aa_ns *aa_get_ns(struct aa_ns *ns)\n{\n\tif (ns)\n\t\taa_get_profile(ns->unconfined);\n\n\treturn ns;\n}",
          "includes": [
            "#include \"policy.h\"",
            "#include \"label.h\"",
            "#include \"apparmorfs.h\"",
            "#include \"apparmor.h\"",
            "#include <linux/kref.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"policy.h\"\n#include \"label.h\"\n#include \"apparmorfs.h\"\n#include \"apparmor.h\"\n#include <linux/kref.h>\n\nstatic inline struct aa_ns *aa_get_ns(struct aa_ns *ns)\n{\n\tif (ns)\n\t\taa_get_profile(ns->unconfined);\n\n\treturn ns;\n}"
        }
      },
      {
        "call_info": {
          "callee": "rcu_assign_pointer",
          "args": [
            "profile->parent",
            "aa_get_profile(parent)"
          ],
          "line": 543
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "aa_alloc_profile",
          "args": [
            "name",
            "NULL",
            "gfp"
          ],
          "line": 532
        },
        "resolved": true,
        "details": {
          "function_name": "aa_alloc_profile",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/policy.c",
          "lines": "254-290",
          "snippet": "struct aa_profile *aa_alloc_profile(const char *hname, struct aa_proxy *proxy,\n\t\t\t\t    gfp_t gfp)\n{\n\tstruct aa_profile *profile;\n\n\t/* freed by free_profile - usually through aa_put_profile */\n\tprofile = kzalloc(sizeof(*profile) + sizeof(struct aa_profile *) * 2,\n\t\t\t  gfp);\n\tif (!profile)\n\t\treturn NULL;\n\n\tif (!aa_policy_init(&profile->base, NULL, hname, gfp))\n\t\tgoto fail;\n\tif (!aa_label_init(&profile->label, 1))\n\t\tgoto fail;\n\n\t/* update being set needed by fs interface */\n\tif (!proxy) {\n\t\tproxy = aa_alloc_proxy(&profile->label, gfp);\n\t\tif (!proxy)\n\t\t\tgoto fail;\n\t} else\n\t\taa_get_proxy(proxy);\n\tprofile->label.proxy = proxy;\n\n\tprofile->label.hname = profile->base.hname;\n\tprofile->label.flags |= FLAG_PROFILE;\n\tprofile->label.vec[0] = profile;\n\n\t/* refcount released by caller */\n\treturn profile;\n\nfail:\n\taa_free_profile(profile);\n\n\treturn NULL;\n}",
          "includes": [
            "#include \"include/resource.h\"",
            "#include \"include/policy_unpack.h\"",
            "#include \"include/policy_ns.h\"",
            "#include \"include/policy.h\"",
            "#include \"include/path.h\"",
            "#include \"include/match.h\"",
            "#include \"include/ipc.h\"",
            "#include \"include/file.h\"",
            "#include \"include/context.h\"",
            "#include \"include/capability.h\"",
            "#include \"include/apparmor.h\"",
            "#include <linux/user_namespace.h>",
            "#include <linux/rculist.h>",
            "#include <linux/cred.h>",
            "#include <linux/string.h>",
            "#include <linux/spinlock.h>",
            "#include <linux/slab.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"include/resource.h\"\n#include \"include/policy_unpack.h\"\n#include \"include/policy_ns.h\"\n#include \"include/policy.h\"\n#include \"include/path.h\"\n#include \"include/match.h\"\n#include \"include/ipc.h\"\n#include \"include/file.h\"\n#include \"include/context.h\"\n#include \"include/capability.h\"\n#include \"include/apparmor.h\"\n#include <linux/user_namespace.h>\n#include <linux/rculist.h>\n#include <linux/cred.h>\n#include <linux/string.h>\n#include <linux/spinlock.h>\n#include <linux/slab.h>\n\nstruct aa_profile *aa_alloc_profile(const char *hname, struct aa_proxy *proxy,\n\t\t\t\t    gfp_t gfp)\n{\n\tstruct aa_profile *profile;\n\n\t/* freed by free_profile - usually through aa_put_profile */\n\tprofile = kzalloc(sizeof(*profile) + sizeof(struct aa_profile *) * 2,\n\t\t\t  gfp);\n\tif (!profile)\n\t\treturn NULL;\n\n\tif (!aa_policy_init(&profile->base, NULL, hname, gfp))\n\t\tgoto fail;\n\tif (!aa_label_init(&profile->label, 1))\n\t\tgoto fail;\n\n\t/* update being set needed by fs interface */\n\tif (!proxy) {\n\t\tproxy = aa_alloc_proxy(&profile->label, gfp);\n\t\tif (!proxy)\n\t\t\tgoto fail;\n\t} else\n\t\taa_get_proxy(proxy);\n\tprofile->label.proxy = proxy;\n\n\tprofile->label.hname = profile->base.hname;\n\tprofile->label.flags |= FLAG_PROFILE;\n\tprofile->label.vec[0] = profile;\n\n\t/* refcount released by caller */\n\treturn profile;\n\nfail:\n\taa_free_profile(profile);\n\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "aa_find_child",
          "args": [
            "parent",
            "bname"
          ],
          "line": 528
        },
        "resolved": true,
        "details": {
          "function_name": "aa_find_child",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/policy.c",
          "lines": "331-343",
          "snippet": "struct aa_profile *aa_find_child(struct aa_profile *parent, const char *name)\n{\n\tstruct aa_profile *profile;\n\n\trcu_read_lock();\n\tdo {\n\t\tprofile = __find_child(&parent->base.profiles, name);\n\t} while (profile && !aa_get_profile_not0(profile));\n\trcu_read_unlock();\n\n\t/* refcount released by caller */\n\treturn profile;\n}",
          "includes": [
            "#include \"include/resource.h\"",
            "#include \"include/policy_unpack.h\"",
            "#include \"include/policy_ns.h\"",
            "#include \"include/policy.h\"",
            "#include \"include/path.h\"",
            "#include \"include/match.h\"",
            "#include \"include/ipc.h\"",
            "#include \"include/file.h\"",
            "#include \"include/context.h\"",
            "#include \"include/capability.h\"",
            "#include \"include/apparmor.h\"",
            "#include <linux/user_namespace.h>",
            "#include <linux/rculist.h>",
            "#include <linux/cred.h>",
            "#include <linux/string.h>",
            "#include <linux/spinlock.h>",
            "#include <linux/slab.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"include/resource.h\"\n#include \"include/policy_unpack.h\"\n#include \"include/policy_ns.h\"\n#include \"include/policy.h\"\n#include \"include/path.h\"\n#include \"include/match.h\"\n#include \"include/ipc.h\"\n#include \"include/file.h\"\n#include \"include/context.h\"\n#include \"include/capability.h\"\n#include \"include/apparmor.h\"\n#include <linux/user_namespace.h>\n#include <linux/rculist.h>\n#include <linux/cred.h>\n#include <linux/string.h>\n#include <linux/spinlock.h>\n#include <linux/slab.h>\n\nstruct aa_profile *aa_find_child(struct aa_profile *parent, const char *name)\n{\n\tstruct aa_profile *profile;\n\n\trcu_read_lock();\n\tdo {\n\t\tprofile = __find_child(&parent->base.profiles, name);\n\t} while (profile && !aa_get_profile_not0(profile));\n\trcu_read_unlock();\n\n\t/* refcount released by caller */\n\treturn profile;\n}"
        }
      },
      {
        "call_info": {
          "callee": "basename",
          "args": [
            "name"
          ],
          "line": 527
        },
        "resolved": true,
        "details": {
          "function_name": "basename",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/include/lib.h",
          "lines": "141-150",
          "snippet": "static inline const char *basename(const char *hname)\n{\n\tchar *split;\n\n\thname = strim((char *)hname);\n\tfor (split = strstr(hname, \"//\"); split; split = strstr(hname, \"//\"))\n\t\thname = split + 2;\n\n\treturn hname;\n}",
          "includes": [
            "#include \"match.h\"",
            "#include <linux/fs.h>",
            "#include <linux/slab.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"match.h\"\n#include <linux/fs.h>\n#include <linux/slab.h>\n\nstatic inline const char *basename(const char *hname)\n{\n\tchar *split;\n\n\thname = strim((char *)hname);\n\tfor (split = strstr(hname, \"//\"); split; split = strstr(hname, \"//\"))\n\t\thname = split + 2;\n\n\treturn hname;\n}"
        }
      },
      {
        "call_info": {
          "callee": "sprintf",
          "args": [
            "name",
            "\"%s//null-%x\"",
            "parent->base.hname",
            "atomic_inc_return(&parent->ns->uniq_null)"
          ],
          "line": 522
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "atomic_inc_return",
          "args": [
            "&parent->ns->uniq_null"
          ],
          "line": 523
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kmalloc",
          "args": [
            "strlen(parent->base.hname) + 2 + 7 + 8",
            "gfp"
          ],
          "line": 519
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "parent->base.hname"
          ],
          "line": 519
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sprintf",
          "args": [
            "name",
            "\"%s//null-%s\"",
            "parent->base.hname",
            "base"
          ],
          "line": 513
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kmalloc",
          "args": [
            "strlen(parent->base.hname) + 8 + strlen(base)",
            "gfp"
          ],
          "line": 510
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "base"
          ],
          "line": 510
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "parent->base.hname"
          ],
          "line": 510
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "AA_BUG",
          "args": [
            "!parent"
          ],
          "line": 507
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"include/resource.h\"\n#include \"include/policy_unpack.h\"\n#include \"include/policy_ns.h\"\n#include \"include/policy.h\"\n#include \"include/path.h\"\n#include \"include/match.h\"\n#include \"include/ipc.h\"\n#include \"include/file.h\"\n#include \"include/context.h\"\n#include \"include/capability.h\"\n#include \"include/apparmor.h\"\n#include <linux/user_namespace.h>\n#include <linux/rculist.h>\n#include <linux/cred.h>\n#include <linux/string.h>\n#include <linux/spinlock.h>\n#include <linux/slab.h>\n\nstruct aa_profile *aa_new_null_profile(struct aa_profile *parent, bool hat,\n\t\t\t\t       const char *base, gfp_t gfp)\n{\n\tstruct aa_profile *p, *profile;\n\tconst char *bname;\n\tchar *name = NULL;\n\n\tAA_BUG(!parent);\n\n\tif (base) {\n\t\tname = kmalloc(strlen(parent->base.hname) + 8 + strlen(base),\n\t\t\t       gfp);\n\t\tif (name) {\n\t\t\tsprintf(name, \"%s//null-%s\", parent->base.hname, base);\n\t\t\tgoto name;\n\t\t}\n\t\t/* fall through to try shorter uniq */\n\t}\n\n\tname = kmalloc(strlen(parent->base.hname) + 2 + 7 + 8, gfp);\n\tif (!name)\n\t\treturn NULL;\n\tsprintf(name, \"%s//null-%x\", parent->base.hname,\n\t\tatomic_inc_return(&parent->ns->uniq_null));\n\nname:\n\t/* lookup to see if this is a dup creation */\n\tbname = basename(name);\n\tprofile = aa_find_child(parent, bname);\n\tif (profile)\n\t\tgoto out;\n\n\tprofile = aa_alloc_profile(name, NULL, gfp);\n\tif (!profile)\n\t\tgoto fail;\n\n\tprofile->mode = APPARMOR_COMPLAIN;\n\tprofile->label.flags |= FLAG_NULL;\n\tif (hat)\n\t\tprofile->label.flags |= FLAG_HAT;\n\tprofile->path_flags = parent->path_flags;\n\n\t/* released on free_profile */\n\trcu_assign_pointer(profile->parent, aa_get_profile(parent));\n\tprofile->ns = aa_get_ns(parent->ns);\n\tprofile->file.dfa = aa_get_dfa(nulldfa);\n\tprofile->policy.dfa = aa_get_dfa(nulldfa);\n\n\tmutex_lock_nested(&profile->ns->lock, profile->ns->level);\n\tp = __find_child(&parent->base.profiles, bname);\n\tif (p) {\n\t\taa_free_profile(profile);\n\t\tprofile = aa_get_profile(p);\n\t} else {\n\t\t__add_profile(&parent->base.profiles, profile);\n\t}\n\tmutex_unlock(&profile->ns->lock);\n\n\t/* refcount released by caller */\nout:\n\tkfree(name);\n\n\treturn profile;\n\nfail:\n\tkfree(name);\n\taa_free_profile(profile);\n\treturn NULL;\n}"
  },
  {
    "function_name": "aa_fqlookupn_profile",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/policy.c",
    "lines": "454-480",
    "snippet": "struct aa_profile *aa_fqlookupn_profile(struct aa_label *base,\n\t\t\t\t\tconst char *fqname, size_t n)\n{\n\tstruct aa_profile *profile;\n\tstruct aa_ns *ns;\n\tconst char *name, *ns_name;\n\tsize_t ns_len;\n\n\tname = aa_splitn_fqname(fqname, n, &ns_name, &ns_len);\n\tif (ns_name) {\n\t\tns = aa_lookupn_ns(labels_ns(base), ns_name, ns_len);\n\t\tif (!ns)\n\t\t\treturn NULL;\n\t} else\n\t\tns = aa_get_ns(labels_ns(base));\n\n\tif (name)\n\t\tprofile = aa_lookupn_profile(ns, name, n - (name - fqname));\n\telse if (ns)\n\t\t/* default profile for ns, currently unconfined */\n\t\tprofile = aa_get_newest_profile(ns->unconfined);\n\telse\n\t\tprofile = NULL;\n\taa_put_ns(ns);\n\n\treturn profile;\n}",
    "includes": [
      "#include \"include/resource.h\"",
      "#include \"include/policy_unpack.h\"",
      "#include \"include/policy_ns.h\"",
      "#include \"include/policy.h\"",
      "#include \"include/path.h\"",
      "#include \"include/match.h\"",
      "#include \"include/ipc.h\"",
      "#include \"include/file.h\"",
      "#include \"include/context.h\"",
      "#include \"include/capability.h\"",
      "#include \"include/apparmor.h\"",
      "#include <linux/user_namespace.h>",
      "#include <linux/rculist.h>",
      "#include <linux/cred.h>",
      "#include <linux/string.h>",
      "#include <linux/spinlock.h>",
      "#include <linux/slab.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "aa_put_ns",
          "args": [
            "ns"
          ],
          "line": 477
        },
        "resolved": true,
        "details": {
          "function_name": "aa_put_ns",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/include/policy_ns.h",
          "lines": "130-134",
          "snippet": "static inline void aa_put_ns(struct aa_ns *ns)\n{\n\tif (ns)\n\t\taa_put_profile(ns->unconfined);\n}",
          "includes": [
            "#include \"policy.h\"",
            "#include \"label.h\"",
            "#include \"apparmorfs.h\"",
            "#include \"apparmor.h\"",
            "#include <linux/kref.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"policy.h\"\n#include \"label.h\"\n#include \"apparmorfs.h\"\n#include \"apparmor.h\"\n#include <linux/kref.h>\n\nstatic inline void aa_put_ns(struct aa_ns *ns)\n{\n\tif (ns)\n\t\taa_put_profile(ns->unconfined);\n}"
        }
      },
      {
        "call_info": {
          "callee": "aa_get_newest_profile",
          "args": [
            "ns->unconfined"
          ],
          "line": 474
        },
        "resolved": true,
        "details": {
          "function_name": "aa_get_newest_profile",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/include/policy.h",
          "lines": "207-210",
          "snippet": "static inline struct aa_profile *aa_get_newest_profile(struct aa_profile *p)\n{\n\treturn labels_profile(aa_get_newest_label(&p->label));\n}",
          "includes": [
            "#include \"resource.h\"",
            "#include \"perms.h\"",
            "#include \"label.h\"",
            "#include \"lib.h\"",
            "#include \"file.h\"",
            "#include \"domain.h\"",
            "#include \"capability.h\"",
            "#include \"audit.h\"",
            "#include \"apparmor.h\"",
            "#include <linux/socket.h>",
            "#include <linux/slab.h>",
            "#include <linux/sched.h>",
            "#include <linux/rhashtable.h>",
            "#include <linux/kref.h>",
            "#include <linux/cred.h>",
            "#include <linux/capability.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"resource.h\"\n#include \"perms.h\"\n#include \"label.h\"\n#include \"lib.h\"\n#include \"file.h\"\n#include \"domain.h\"\n#include \"capability.h\"\n#include \"audit.h\"\n#include \"apparmor.h\"\n#include <linux/socket.h>\n#include <linux/slab.h>\n#include <linux/sched.h>\n#include <linux/rhashtable.h>\n#include <linux/kref.h>\n#include <linux/cred.h>\n#include <linux/capability.h>\n\nstatic inline struct aa_profile *aa_get_newest_profile(struct aa_profile *p)\n{\n\treturn labels_profile(aa_get_newest_label(&p->label));\n}"
        }
      },
      {
        "call_info": {
          "callee": "aa_lookupn_profile",
          "args": [
            "ns",
            "name",
            "n - (name - fqname)"
          ],
          "line": 471
        },
        "resolved": true,
        "details": {
          "function_name": "aa_lookupn_profile",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/policy.c",
          "lines": "430-447",
          "snippet": "struct aa_profile *aa_lookupn_profile(struct aa_ns *ns, const char *hname,\n\t\t\t\t      size_t n)\n{\n\tstruct aa_profile *profile;\n\n\trcu_read_lock();\n\tdo {\n\t\tprofile = __lookupn_profile(&ns->base, hname, n);\n\t} while (profile && !aa_get_profile_not0(profile));\n\trcu_read_unlock();\n\n\t/* the unconfined profile is not in the regular profile list */\n\tif (!profile && strncmp(hname, \"unconfined\", n) == 0)\n\t\tprofile = aa_get_newest_profile(ns->unconfined);\n\n\t/* refcount released by caller */\n\treturn profile;\n}",
          "includes": [
            "#include \"include/resource.h\"",
            "#include \"include/policy_unpack.h\"",
            "#include \"include/policy_ns.h\"",
            "#include \"include/policy.h\"",
            "#include \"include/path.h\"",
            "#include \"include/match.h\"",
            "#include \"include/ipc.h\"",
            "#include \"include/file.h\"",
            "#include \"include/context.h\"",
            "#include \"include/capability.h\"",
            "#include \"include/apparmor.h\"",
            "#include <linux/user_namespace.h>",
            "#include <linux/rculist.h>",
            "#include <linux/cred.h>",
            "#include <linux/string.h>",
            "#include <linux/spinlock.h>",
            "#include <linux/slab.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"include/resource.h\"\n#include \"include/policy_unpack.h\"\n#include \"include/policy_ns.h\"\n#include \"include/policy.h\"\n#include \"include/path.h\"\n#include \"include/match.h\"\n#include \"include/ipc.h\"\n#include \"include/file.h\"\n#include \"include/context.h\"\n#include \"include/capability.h\"\n#include \"include/apparmor.h\"\n#include <linux/user_namespace.h>\n#include <linux/rculist.h>\n#include <linux/cred.h>\n#include <linux/string.h>\n#include <linux/spinlock.h>\n#include <linux/slab.h>\n\nstruct aa_profile *aa_lookupn_profile(struct aa_ns *ns, const char *hname,\n\t\t\t\t      size_t n)\n{\n\tstruct aa_profile *profile;\n\n\trcu_read_lock();\n\tdo {\n\t\tprofile = __lookupn_profile(&ns->base, hname, n);\n\t} while (profile && !aa_get_profile_not0(profile));\n\trcu_read_unlock();\n\n\t/* the unconfined profile is not in the regular profile list */\n\tif (!profile && strncmp(hname, \"unconfined\", n) == 0)\n\t\tprofile = aa_get_newest_profile(ns->unconfined);\n\n\t/* refcount released by caller */\n\treturn profile;\n}"
        }
      },
      {
        "call_info": {
          "callee": "aa_get_ns",
          "args": [
            "labels_ns(base)"
          ],
          "line": 468
        },
        "resolved": true,
        "details": {
          "function_name": "aa_get_ns",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/include/policy_ns.h",
          "lines": "116-122",
          "snippet": "static inline struct aa_ns *aa_get_ns(struct aa_ns *ns)\n{\n\tif (ns)\n\t\taa_get_profile(ns->unconfined);\n\n\treturn ns;\n}",
          "includes": [
            "#include \"policy.h\"",
            "#include \"label.h\"",
            "#include \"apparmorfs.h\"",
            "#include \"apparmor.h\"",
            "#include <linux/kref.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"policy.h\"\n#include \"label.h\"\n#include \"apparmorfs.h\"\n#include \"apparmor.h\"\n#include <linux/kref.h>\n\nstatic inline struct aa_ns *aa_get_ns(struct aa_ns *ns)\n{\n\tif (ns)\n\t\taa_get_profile(ns->unconfined);\n\n\treturn ns;\n}"
        }
      },
      {
        "call_info": {
          "callee": "labels_ns",
          "args": [
            "base"
          ],
          "line": 468
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "aa_lookupn_ns",
          "args": [
            "labels_ns(base)",
            "ns_name",
            "ns_len"
          ],
          "line": 464
        },
        "resolved": true,
        "details": {
          "function_name": "aa_lookupn_ns",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/policy_ns.c",
          "lines": "235-244",
          "snippet": "struct aa_ns *aa_lookupn_ns(struct aa_ns *view, const char *name, size_t n)\n{\n\tstruct aa_ns *ns = NULL;\n\n\trcu_read_lock();\n\tns = aa_get_ns(__aa_lookupn_ns(view, name, n));\n\trcu_read_unlock();\n\n\treturn ns;\n}",
          "includes": [
            "#include \"include/policy.h\"",
            "#include \"include/label.h\"",
            "#include \"include/policy_ns.h\"",
            "#include \"include/context.h\"",
            "#include \"include/apparmor.h\"",
            "#include <linux/string.h>",
            "#include <linux/slab.h>",
            "#include <linux/mutex.h>",
            "#include <linux/list.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"include/policy.h\"\n#include \"include/label.h\"\n#include \"include/policy_ns.h\"\n#include \"include/context.h\"\n#include \"include/apparmor.h\"\n#include <linux/string.h>\n#include <linux/slab.h>\n#include <linux/mutex.h>\n#include <linux/list.h>\n\nstruct aa_ns *aa_lookupn_ns(struct aa_ns *view, const char *name, size_t n)\n{\n\tstruct aa_ns *ns = NULL;\n\n\trcu_read_lock();\n\tns = aa_get_ns(__aa_lookupn_ns(view, name, n));\n\trcu_read_unlock();\n\n\treturn ns;\n}"
        }
      },
      {
        "call_info": {
          "callee": "labels_ns",
          "args": [
            "base"
          ],
          "line": 464
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "aa_splitn_fqname",
          "args": [
            "fqname",
            "n",
            "&ns_name",
            "&ns_len"
          ],
          "line": 462
        },
        "resolved": true,
        "details": {
          "function_name": "aa_splitn_fqname",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/lib.c",
          "lines": "87-120",
          "snippet": "const char *aa_splitn_fqname(const char *fqname, size_t n, const char **ns_name,\n\t\t\t     size_t *ns_len)\n{\n\tconst char *end = fqname + n;\n\tconst char *name = skipn_spaces(fqname, n);\n\n\tif (!name)\n\t\treturn NULL;\n\t*ns_name = NULL;\n\t*ns_len = 0;\n\tif (name[0] == ':') {\n\t\tchar *split = strnchr(&name[1], end - &name[1], ':');\n\t\t*ns_name = skipn_spaces(&name[1], end - &name[1]);\n\t\tif (!*ns_name)\n\t\t\treturn NULL;\n\t\tif (split) {\n\t\t\t*ns_len = split - *ns_name;\n\t\t\tif (*ns_len == 0)\n\t\t\t\t*ns_name = NULL;\n\t\t\tsplit++;\n\t\t\tif (end - split > 1 && strncmp(split, \"//\", 2) == 0)\n\t\t\t\tsplit += 2;\n\t\t\tname = skipn_spaces(split, end - split);\n\t\t} else {\n\t\t\t/* a ns name without a following profile is allowed */\n\t\t\tname = NULL;\n\t\t\t*ns_len = end - *ns_name;\n\t\t}\n\t}\n\tif (name && *name == 0)\n\t\tname = NULL;\n\n\treturn name;\n}",
          "includes": [
            "#include \"include/policy.h\"",
            "#include \"include/perms.h\"",
            "#include \"include/lib.h\"",
            "#include \"include/apparmor.h\"",
            "#include \"include/audit.h\"",
            "#include <linux/vmalloc.h>",
            "#include <linux/string.h>",
            "#include <linux/slab.h>",
            "#include <linux/mm.h>",
            "#include <linux/ctype.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"include/policy.h\"\n#include \"include/perms.h\"\n#include \"include/lib.h\"\n#include \"include/apparmor.h\"\n#include \"include/audit.h\"\n#include <linux/vmalloc.h>\n#include <linux/string.h>\n#include <linux/slab.h>\n#include <linux/mm.h>\n#include <linux/ctype.h>\n\nconst char *aa_splitn_fqname(const char *fqname, size_t n, const char **ns_name,\n\t\t\t     size_t *ns_len)\n{\n\tconst char *end = fqname + n;\n\tconst char *name = skipn_spaces(fqname, n);\n\n\tif (!name)\n\t\treturn NULL;\n\t*ns_name = NULL;\n\t*ns_len = 0;\n\tif (name[0] == ':') {\n\t\tchar *split = strnchr(&name[1], end - &name[1], ':');\n\t\t*ns_name = skipn_spaces(&name[1], end - &name[1]);\n\t\tif (!*ns_name)\n\t\t\treturn NULL;\n\t\tif (split) {\n\t\t\t*ns_len = split - *ns_name;\n\t\t\tif (*ns_len == 0)\n\t\t\t\t*ns_name = NULL;\n\t\t\tsplit++;\n\t\t\tif (end - split > 1 && strncmp(split, \"//\", 2) == 0)\n\t\t\t\tsplit += 2;\n\t\t\tname = skipn_spaces(split, end - split);\n\t\t} else {\n\t\t\t/* a ns name without a following profile is allowed */\n\t\t\tname = NULL;\n\t\t\t*ns_len = end - *ns_name;\n\t\t}\n\t}\n\tif (name && *name == 0)\n\t\tname = NULL;\n\n\treturn name;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"include/resource.h\"\n#include \"include/policy_unpack.h\"\n#include \"include/policy_ns.h\"\n#include \"include/policy.h\"\n#include \"include/path.h\"\n#include \"include/match.h\"\n#include \"include/ipc.h\"\n#include \"include/file.h\"\n#include \"include/context.h\"\n#include \"include/capability.h\"\n#include \"include/apparmor.h\"\n#include <linux/user_namespace.h>\n#include <linux/rculist.h>\n#include <linux/cred.h>\n#include <linux/string.h>\n#include <linux/spinlock.h>\n#include <linux/slab.h>\n\nstruct aa_profile *aa_fqlookupn_profile(struct aa_label *base,\n\t\t\t\t\tconst char *fqname, size_t n)\n{\n\tstruct aa_profile *profile;\n\tstruct aa_ns *ns;\n\tconst char *name, *ns_name;\n\tsize_t ns_len;\n\n\tname = aa_splitn_fqname(fqname, n, &ns_name, &ns_len);\n\tif (ns_name) {\n\t\tns = aa_lookupn_ns(labels_ns(base), ns_name, ns_len);\n\t\tif (!ns)\n\t\t\treturn NULL;\n\t} else\n\t\tns = aa_get_ns(labels_ns(base));\n\n\tif (name)\n\t\tprofile = aa_lookupn_profile(ns, name, n - (name - fqname));\n\telse if (ns)\n\t\t/* default profile for ns, currently unconfined */\n\t\tprofile = aa_get_newest_profile(ns->unconfined);\n\telse\n\t\tprofile = NULL;\n\taa_put_ns(ns);\n\n\treturn profile;\n}"
  },
  {
    "function_name": "aa_lookup_profile",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/policy.c",
    "lines": "449-452",
    "snippet": "struct aa_profile *aa_lookup_profile(struct aa_ns *ns, const char *hname)\n{\n\treturn aa_lookupn_profile(ns, hname, strlen(hname));\n}",
    "includes": [
      "#include \"include/resource.h\"",
      "#include \"include/policy_unpack.h\"",
      "#include \"include/policy_ns.h\"",
      "#include \"include/policy.h\"",
      "#include \"include/path.h\"",
      "#include \"include/match.h\"",
      "#include \"include/ipc.h\"",
      "#include \"include/file.h\"",
      "#include \"include/context.h\"",
      "#include \"include/capability.h\"",
      "#include \"include/apparmor.h\"",
      "#include <linux/user_namespace.h>",
      "#include <linux/rculist.h>",
      "#include <linux/cred.h>",
      "#include <linux/string.h>",
      "#include <linux/spinlock.h>",
      "#include <linux/slab.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "aa_lookupn_profile",
          "args": [
            "ns",
            "hname",
            "strlen(hname)"
          ],
          "line": 451
        },
        "resolved": true,
        "details": {
          "function_name": "aa_lookupn_profile",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/policy.c",
          "lines": "430-447",
          "snippet": "struct aa_profile *aa_lookupn_profile(struct aa_ns *ns, const char *hname,\n\t\t\t\t      size_t n)\n{\n\tstruct aa_profile *profile;\n\n\trcu_read_lock();\n\tdo {\n\t\tprofile = __lookupn_profile(&ns->base, hname, n);\n\t} while (profile && !aa_get_profile_not0(profile));\n\trcu_read_unlock();\n\n\t/* the unconfined profile is not in the regular profile list */\n\tif (!profile && strncmp(hname, \"unconfined\", n) == 0)\n\t\tprofile = aa_get_newest_profile(ns->unconfined);\n\n\t/* refcount released by caller */\n\treturn profile;\n}",
          "includes": [
            "#include \"include/resource.h\"",
            "#include \"include/policy_unpack.h\"",
            "#include \"include/policy_ns.h\"",
            "#include \"include/policy.h\"",
            "#include \"include/path.h\"",
            "#include \"include/match.h\"",
            "#include \"include/ipc.h\"",
            "#include \"include/file.h\"",
            "#include \"include/context.h\"",
            "#include \"include/capability.h\"",
            "#include \"include/apparmor.h\"",
            "#include <linux/user_namespace.h>",
            "#include <linux/rculist.h>",
            "#include <linux/cred.h>",
            "#include <linux/string.h>",
            "#include <linux/spinlock.h>",
            "#include <linux/slab.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"include/resource.h\"\n#include \"include/policy_unpack.h\"\n#include \"include/policy_ns.h\"\n#include \"include/policy.h\"\n#include \"include/path.h\"\n#include \"include/match.h\"\n#include \"include/ipc.h\"\n#include \"include/file.h\"\n#include \"include/context.h\"\n#include \"include/capability.h\"\n#include \"include/apparmor.h\"\n#include <linux/user_namespace.h>\n#include <linux/rculist.h>\n#include <linux/cred.h>\n#include <linux/string.h>\n#include <linux/spinlock.h>\n#include <linux/slab.h>\n\nstruct aa_profile *aa_lookupn_profile(struct aa_ns *ns, const char *hname,\n\t\t\t\t      size_t n)\n{\n\tstruct aa_profile *profile;\n\n\trcu_read_lock();\n\tdo {\n\t\tprofile = __lookupn_profile(&ns->base, hname, n);\n\t} while (profile && !aa_get_profile_not0(profile));\n\trcu_read_unlock();\n\n\t/* the unconfined profile is not in the regular profile list */\n\tif (!profile && strncmp(hname, \"unconfined\", n) == 0)\n\t\tprofile = aa_get_newest_profile(ns->unconfined);\n\n\t/* refcount released by caller */\n\treturn profile;\n}"
        }
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "hname"
          ],
          "line": 451
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"include/resource.h\"\n#include \"include/policy_unpack.h\"\n#include \"include/policy_ns.h\"\n#include \"include/policy.h\"\n#include \"include/path.h\"\n#include \"include/match.h\"\n#include \"include/ipc.h\"\n#include \"include/file.h\"\n#include \"include/context.h\"\n#include \"include/capability.h\"\n#include \"include/apparmor.h\"\n#include <linux/user_namespace.h>\n#include <linux/rculist.h>\n#include <linux/cred.h>\n#include <linux/string.h>\n#include <linux/spinlock.h>\n#include <linux/slab.h>\n\nstruct aa_profile *aa_lookup_profile(struct aa_ns *ns, const char *hname)\n{\n\treturn aa_lookupn_profile(ns, hname, strlen(hname));\n}"
  },
  {
    "function_name": "aa_lookupn_profile",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/policy.c",
    "lines": "430-447",
    "snippet": "struct aa_profile *aa_lookupn_profile(struct aa_ns *ns, const char *hname,\n\t\t\t\t      size_t n)\n{\n\tstruct aa_profile *profile;\n\n\trcu_read_lock();\n\tdo {\n\t\tprofile = __lookupn_profile(&ns->base, hname, n);\n\t} while (profile && !aa_get_profile_not0(profile));\n\trcu_read_unlock();\n\n\t/* the unconfined profile is not in the regular profile list */\n\tif (!profile && strncmp(hname, \"unconfined\", n) == 0)\n\t\tprofile = aa_get_newest_profile(ns->unconfined);\n\n\t/* refcount released by caller */\n\treturn profile;\n}",
    "includes": [
      "#include \"include/resource.h\"",
      "#include \"include/policy_unpack.h\"",
      "#include \"include/policy_ns.h\"",
      "#include \"include/policy.h\"",
      "#include \"include/path.h\"",
      "#include \"include/match.h\"",
      "#include \"include/ipc.h\"",
      "#include \"include/file.h\"",
      "#include \"include/context.h\"",
      "#include \"include/capability.h\"",
      "#include \"include/apparmor.h\"",
      "#include <linux/user_namespace.h>",
      "#include <linux/rculist.h>",
      "#include <linux/cred.h>",
      "#include <linux/string.h>",
      "#include <linux/spinlock.h>",
      "#include <linux/slab.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "aa_get_newest_profile",
          "args": [
            "ns->unconfined"
          ],
          "line": 443
        },
        "resolved": true,
        "details": {
          "function_name": "aa_get_newest_profile",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/include/policy.h",
          "lines": "207-210",
          "snippet": "static inline struct aa_profile *aa_get_newest_profile(struct aa_profile *p)\n{\n\treturn labels_profile(aa_get_newest_label(&p->label));\n}",
          "includes": [
            "#include \"resource.h\"",
            "#include \"perms.h\"",
            "#include \"label.h\"",
            "#include \"lib.h\"",
            "#include \"file.h\"",
            "#include \"domain.h\"",
            "#include \"capability.h\"",
            "#include \"audit.h\"",
            "#include \"apparmor.h\"",
            "#include <linux/socket.h>",
            "#include <linux/slab.h>",
            "#include <linux/sched.h>",
            "#include <linux/rhashtable.h>",
            "#include <linux/kref.h>",
            "#include <linux/cred.h>",
            "#include <linux/capability.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"resource.h\"\n#include \"perms.h\"\n#include \"label.h\"\n#include \"lib.h\"\n#include \"file.h\"\n#include \"domain.h\"\n#include \"capability.h\"\n#include \"audit.h\"\n#include \"apparmor.h\"\n#include <linux/socket.h>\n#include <linux/slab.h>\n#include <linux/sched.h>\n#include <linux/rhashtable.h>\n#include <linux/kref.h>\n#include <linux/cred.h>\n#include <linux/capability.h>\n\nstatic inline struct aa_profile *aa_get_newest_profile(struct aa_profile *p)\n{\n\treturn labels_profile(aa_get_newest_label(&p->label));\n}"
        }
      },
      {
        "call_info": {
          "callee": "strncmp",
          "args": [
            "hname",
            "\"unconfined\"",
            "n"
          ],
          "line": 442
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rcu_read_unlock",
          "args": [],
          "line": 439
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "aa_get_profile_not0",
          "args": [
            "profile"
          ],
          "line": 438
        },
        "resolved": true,
        "details": {
          "function_name": "aa_get_profile_not0",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/include/policy.h",
          "lines": "245-251",
          "snippet": "static inline struct aa_profile *aa_get_profile_not0(struct aa_profile *p)\n{\n\tif (p && kref_get_unless_zero(&p->label.count))\n\t\treturn p;\n\n\treturn NULL;\n}",
          "includes": [
            "#include \"resource.h\"",
            "#include \"perms.h\"",
            "#include \"label.h\"",
            "#include \"lib.h\"",
            "#include \"file.h\"",
            "#include \"domain.h\"",
            "#include \"capability.h\"",
            "#include \"audit.h\"",
            "#include \"apparmor.h\"",
            "#include <linux/socket.h>",
            "#include <linux/slab.h>",
            "#include <linux/sched.h>",
            "#include <linux/rhashtable.h>",
            "#include <linux/kref.h>",
            "#include <linux/cred.h>",
            "#include <linux/capability.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"resource.h\"\n#include \"perms.h\"\n#include \"label.h\"\n#include \"lib.h\"\n#include \"file.h\"\n#include \"domain.h\"\n#include \"capability.h\"\n#include \"audit.h\"\n#include \"apparmor.h\"\n#include <linux/socket.h>\n#include <linux/slab.h>\n#include <linux/sched.h>\n#include <linux/rhashtable.h>\n#include <linux/kref.h>\n#include <linux/cred.h>\n#include <linux/capability.h>\n\nstatic inline struct aa_profile *aa_get_profile_not0(struct aa_profile *p)\n{\n\tif (p && kref_get_unless_zero(&p->label.count))\n\t\treturn p;\n\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "__lookupn_profile",
          "args": [
            "&ns->base",
            "hname",
            "n"
          ],
          "line": 437
        },
        "resolved": true,
        "details": {
          "function_name": "__lookupn_profile",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/policy.c",
          "lines": "393-414",
          "snippet": "static struct aa_profile *__lookupn_profile(struct aa_policy *base,\n\t\t\t\t\t    const char *hname, size_t n)\n{\n\tstruct aa_profile *profile = NULL;\n\tconst char *split;\n\n\tfor (split = strnstr(hname, \"//\", n); split;\n\t     split = strnstr(hname, \"//\", n)) {\n\t\tprofile = __strn_find_child(&base->profiles, hname,\n\t\t\t\t\t    split - hname);\n\t\tif (!profile)\n\t\t\treturn NULL;\n\n\t\tbase = &profile->base;\n\t\tn -= split + 2 - hname;\n\t\thname = split + 2;\n\t}\n\n\tif (n)\n\t\treturn __strn_find_child(&base->profiles, hname, n);\n\treturn NULL;\n}",
          "includes": [
            "#include \"include/resource.h\"",
            "#include \"include/policy_unpack.h\"",
            "#include \"include/policy_ns.h\"",
            "#include \"include/policy.h\"",
            "#include \"include/path.h\"",
            "#include \"include/match.h\"",
            "#include \"include/ipc.h\"",
            "#include \"include/file.h\"",
            "#include \"include/context.h\"",
            "#include \"include/capability.h\"",
            "#include \"include/apparmor.h\"",
            "#include <linux/user_namespace.h>",
            "#include <linux/rculist.h>",
            "#include <linux/cred.h>",
            "#include <linux/string.h>",
            "#include <linux/spinlock.h>",
            "#include <linux/slab.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"include/resource.h\"\n#include \"include/policy_unpack.h\"\n#include \"include/policy_ns.h\"\n#include \"include/policy.h\"\n#include \"include/path.h\"\n#include \"include/match.h\"\n#include \"include/ipc.h\"\n#include \"include/file.h\"\n#include \"include/context.h\"\n#include \"include/capability.h\"\n#include \"include/apparmor.h\"\n#include <linux/user_namespace.h>\n#include <linux/rculist.h>\n#include <linux/cred.h>\n#include <linux/string.h>\n#include <linux/spinlock.h>\n#include <linux/slab.h>\n\nstatic struct aa_profile *__lookupn_profile(struct aa_policy *base,\n\t\t\t\t\t    const char *hname, size_t n)\n{\n\tstruct aa_profile *profile = NULL;\n\tconst char *split;\n\n\tfor (split = strnstr(hname, \"//\", n); split;\n\t     split = strnstr(hname, \"//\", n)) {\n\t\tprofile = __strn_find_child(&base->profiles, hname,\n\t\t\t\t\t    split - hname);\n\t\tif (!profile)\n\t\t\treturn NULL;\n\n\t\tbase = &profile->base;\n\t\tn -= split + 2 - hname;\n\t\thname = split + 2;\n\t}\n\n\tif (n)\n\t\treturn __strn_find_child(&base->profiles, hname, n);\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "rcu_read_lock",
          "args": [],
          "line": 435
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"include/resource.h\"\n#include \"include/policy_unpack.h\"\n#include \"include/policy_ns.h\"\n#include \"include/policy.h\"\n#include \"include/path.h\"\n#include \"include/match.h\"\n#include \"include/ipc.h\"\n#include \"include/file.h\"\n#include \"include/context.h\"\n#include \"include/capability.h\"\n#include \"include/apparmor.h\"\n#include <linux/user_namespace.h>\n#include <linux/rculist.h>\n#include <linux/cred.h>\n#include <linux/string.h>\n#include <linux/spinlock.h>\n#include <linux/slab.h>\n\nstruct aa_profile *aa_lookupn_profile(struct aa_ns *ns, const char *hname,\n\t\t\t\t      size_t n)\n{\n\tstruct aa_profile *profile;\n\n\trcu_read_lock();\n\tdo {\n\t\tprofile = __lookupn_profile(&ns->base, hname, n);\n\t} while (profile && !aa_get_profile_not0(profile));\n\trcu_read_unlock();\n\n\t/* the unconfined profile is not in the regular profile list */\n\tif (!profile && strncmp(hname, \"unconfined\", n) == 0)\n\t\tprofile = aa_get_newest_profile(ns->unconfined);\n\n\t/* refcount released by caller */\n\treturn profile;\n}"
  },
  {
    "function_name": "__lookup_profile",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/policy.c",
    "lines": "416-420",
    "snippet": "static struct aa_profile *__lookup_profile(struct aa_policy *base,\n\t\t\t\t\t   const char *hname)\n{\n\treturn __lookupn_profile(base, hname, strlen(hname));\n}",
    "includes": [
      "#include \"include/resource.h\"",
      "#include \"include/policy_unpack.h\"",
      "#include \"include/policy_ns.h\"",
      "#include \"include/policy.h\"",
      "#include \"include/path.h\"",
      "#include \"include/match.h\"",
      "#include \"include/ipc.h\"",
      "#include \"include/file.h\"",
      "#include \"include/context.h\"",
      "#include \"include/capability.h\"",
      "#include \"include/apparmor.h\"",
      "#include <linux/user_namespace.h>",
      "#include <linux/rculist.h>",
      "#include <linux/cred.h>",
      "#include <linux/string.h>",
      "#include <linux/spinlock.h>",
      "#include <linux/slab.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "__lookupn_profile",
          "args": [
            "base",
            "hname",
            "strlen(hname)"
          ],
          "line": 419
        },
        "resolved": true,
        "details": {
          "function_name": "__lookupn_profile",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/policy.c",
          "lines": "393-414",
          "snippet": "static struct aa_profile *__lookupn_profile(struct aa_policy *base,\n\t\t\t\t\t    const char *hname, size_t n)\n{\n\tstruct aa_profile *profile = NULL;\n\tconst char *split;\n\n\tfor (split = strnstr(hname, \"//\", n); split;\n\t     split = strnstr(hname, \"//\", n)) {\n\t\tprofile = __strn_find_child(&base->profiles, hname,\n\t\t\t\t\t    split - hname);\n\t\tif (!profile)\n\t\t\treturn NULL;\n\n\t\tbase = &profile->base;\n\t\tn -= split + 2 - hname;\n\t\thname = split + 2;\n\t}\n\n\tif (n)\n\t\treturn __strn_find_child(&base->profiles, hname, n);\n\treturn NULL;\n}",
          "includes": [
            "#include \"include/resource.h\"",
            "#include \"include/policy_unpack.h\"",
            "#include \"include/policy_ns.h\"",
            "#include \"include/policy.h\"",
            "#include \"include/path.h\"",
            "#include \"include/match.h\"",
            "#include \"include/ipc.h\"",
            "#include \"include/file.h\"",
            "#include \"include/context.h\"",
            "#include \"include/capability.h\"",
            "#include \"include/apparmor.h\"",
            "#include <linux/user_namespace.h>",
            "#include <linux/rculist.h>",
            "#include <linux/cred.h>",
            "#include <linux/string.h>",
            "#include <linux/spinlock.h>",
            "#include <linux/slab.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"include/resource.h\"\n#include \"include/policy_unpack.h\"\n#include \"include/policy_ns.h\"\n#include \"include/policy.h\"\n#include \"include/path.h\"\n#include \"include/match.h\"\n#include \"include/ipc.h\"\n#include \"include/file.h\"\n#include \"include/context.h\"\n#include \"include/capability.h\"\n#include \"include/apparmor.h\"\n#include <linux/user_namespace.h>\n#include <linux/rculist.h>\n#include <linux/cred.h>\n#include <linux/string.h>\n#include <linux/spinlock.h>\n#include <linux/slab.h>\n\nstatic struct aa_profile *__lookupn_profile(struct aa_policy *base,\n\t\t\t\t\t    const char *hname, size_t n)\n{\n\tstruct aa_profile *profile = NULL;\n\tconst char *split;\n\n\tfor (split = strnstr(hname, \"//\", n); split;\n\t     split = strnstr(hname, \"//\", n)) {\n\t\tprofile = __strn_find_child(&base->profiles, hname,\n\t\t\t\t\t    split - hname);\n\t\tif (!profile)\n\t\t\treturn NULL;\n\n\t\tbase = &profile->base;\n\t\tn -= split + 2 - hname;\n\t\thname = split + 2;\n\t}\n\n\tif (n)\n\t\treturn __strn_find_child(&base->profiles, hname, n);\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "hname"
          ],
          "line": 419
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"include/resource.h\"\n#include \"include/policy_unpack.h\"\n#include \"include/policy_ns.h\"\n#include \"include/policy.h\"\n#include \"include/path.h\"\n#include \"include/match.h\"\n#include \"include/ipc.h\"\n#include \"include/file.h\"\n#include \"include/context.h\"\n#include \"include/capability.h\"\n#include \"include/apparmor.h\"\n#include <linux/user_namespace.h>\n#include <linux/rculist.h>\n#include <linux/cred.h>\n#include <linux/string.h>\n#include <linux/spinlock.h>\n#include <linux/slab.h>\n\nstatic struct aa_profile *__lookup_profile(struct aa_policy *base,\n\t\t\t\t\t   const char *hname)\n{\n\treturn __lookupn_profile(base, hname, strlen(hname));\n}"
  },
  {
    "function_name": "__lookupn_profile",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/policy.c",
    "lines": "393-414",
    "snippet": "static struct aa_profile *__lookupn_profile(struct aa_policy *base,\n\t\t\t\t\t    const char *hname, size_t n)\n{\n\tstruct aa_profile *profile = NULL;\n\tconst char *split;\n\n\tfor (split = strnstr(hname, \"//\", n); split;\n\t     split = strnstr(hname, \"//\", n)) {\n\t\tprofile = __strn_find_child(&base->profiles, hname,\n\t\t\t\t\t    split - hname);\n\t\tif (!profile)\n\t\t\treturn NULL;\n\n\t\tbase = &profile->base;\n\t\tn -= split + 2 - hname;\n\t\thname = split + 2;\n\t}\n\n\tif (n)\n\t\treturn __strn_find_child(&base->profiles, hname, n);\n\treturn NULL;\n}",
    "includes": [
      "#include \"include/resource.h\"",
      "#include \"include/policy_unpack.h\"",
      "#include \"include/policy_ns.h\"",
      "#include \"include/policy.h\"",
      "#include \"include/path.h\"",
      "#include \"include/match.h\"",
      "#include \"include/ipc.h\"",
      "#include \"include/file.h\"",
      "#include \"include/context.h\"",
      "#include \"include/capability.h\"",
      "#include \"include/apparmor.h\"",
      "#include <linux/user_namespace.h>",
      "#include <linux/rculist.h>",
      "#include <linux/cred.h>",
      "#include <linux/string.h>",
      "#include <linux/spinlock.h>",
      "#include <linux/slab.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "__strn_find_child",
          "args": [
            "&base->profiles",
            "hname",
            "n"
          ],
          "line": 412
        },
        "resolved": true,
        "details": {
          "function_name": "__strn_find_child",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/policy.c",
          "lines": "304-308",
          "snippet": "static struct aa_profile *__strn_find_child(struct list_head *head,\n\t\t\t\t\t    const char *name, int len)\n{\n\treturn (struct aa_profile *)__policy_strn_find(head, name, len);\n}",
          "includes": [
            "#include \"include/resource.h\"",
            "#include \"include/policy_unpack.h\"",
            "#include \"include/policy_ns.h\"",
            "#include \"include/policy.h\"",
            "#include \"include/path.h\"",
            "#include \"include/match.h\"",
            "#include \"include/ipc.h\"",
            "#include \"include/file.h\"",
            "#include \"include/context.h\"",
            "#include \"include/capability.h\"",
            "#include \"include/apparmor.h\"",
            "#include <linux/user_namespace.h>",
            "#include <linux/rculist.h>",
            "#include <linux/cred.h>",
            "#include <linux/string.h>",
            "#include <linux/spinlock.h>",
            "#include <linux/slab.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"include/resource.h\"\n#include \"include/policy_unpack.h\"\n#include \"include/policy_ns.h\"\n#include \"include/policy.h\"\n#include \"include/path.h\"\n#include \"include/match.h\"\n#include \"include/ipc.h\"\n#include \"include/file.h\"\n#include \"include/context.h\"\n#include \"include/capability.h\"\n#include \"include/apparmor.h\"\n#include <linux/user_namespace.h>\n#include <linux/rculist.h>\n#include <linux/cred.h>\n#include <linux/string.h>\n#include <linux/spinlock.h>\n#include <linux/slab.h>\n\nstatic struct aa_profile *__strn_find_child(struct list_head *head,\n\t\t\t\t\t    const char *name, int len)\n{\n\treturn (struct aa_profile *)__policy_strn_find(head, name, len);\n}"
        }
      },
      {
        "call_info": {
          "callee": "strnstr",
          "args": [
            "hname",
            "\"//\"",
            "n"
          ],
          "line": 400
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strnstr",
          "args": [
            "hname",
            "\"//\"",
            "n"
          ],
          "line": 399
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"include/resource.h\"\n#include \"include/policy_unpack.h\"\n#include \"include/policy_ns.h\"\n#include \"include/policy.h\"\n#include \"include/path.h\"\n#include \"include/match.h\"\n#include \"include/ipc.h\"\n#include \"include/file.h\"\n#include \"include/context.h\"\n#include \"include/capability.h\"\n#include \"include/apparmor.h\"\n#include <linux/user_namespace.h>\n#include <linux/rculist.h>\n#include <linux/cred.h>\n#include <linux/string.h>\n#include <linux/spinlock.h>\n#include <linux/slab.h>\n\nstatic struct aa_profile *__lookupn_profile(struct aa_policy *base,\n\t\t\t\t\t    const char *hname, size_t n)\n{\n\tstruct aa_profile *profile = NULL;\n\tconst char *split;\n\n\tfor (split = strnstr(hname, \"//\", n); split;\n\t     split = strnstr(hname, \"//\", n)) {\n\t\tprofile = __strn_find_child(&base->profiles, hname,\n\t\t\t\t\t    split - hname);\n\t\tif (!profile)\n\t\t\treturn NULL;\n\n\t\tbase = &profile->base;\n\t\tn -= split + 2 - hname;\n\t\thname = split + 2;\n\t}\n\n\tif (n)\n\t\treturn __strn_find_child(&base->profiles, hname, n);\n\treturn NULL;\n}"
  },
  {
    "function_name": "__lookup_parent",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/policy.c",
    "lines": "358-379",
    "snippet": "static struct aa_policy *__lookup_parent(struct aa_ns *ns,\n\t\t\t\t\t const char *hname)\n{\n\tstruct aa_policy *policy;\n\tstruct aa_profile *profile = NULL;\n\tchar *split;\n\n\tpolicy = &ns->base;\n\n\tfor (split = strstr(hname, \"//\"); split;) {\n\t\tprofile = __strn_find_child(&policy->profiles, hname,\n\t\t\t\t\t    split - hname);\n\t\tif (!profile)\n\t\t\treturn NULL;\n\t\tpolicy = &profile->base;\n\t\thname = split + 2;\n\t\tsplit = strstr(hname, \"//\");\n\t}\n\tif (!profile)\n\t\treturn &ns->base;\n\treturn &profile->base;\n}",
    "includes": [
      "#include \"include/resource.h\"",
      "#include \"include/policy_unpack.h\"",
      "#include \"include/policy_ns.h\"",
      "#include \"include/policy.h\"",
      "#include \"include/path.h\"",
      "#include \"include/match.h\"",
      "#include \"include/ipc.h\"",
      "#include \"include/file.h\"",
      "#include \"include/context.h\"",
      "#include \"include/capability.h\"",
      "#include \"include/apparmor.h\"",
      "#include <linux/user_namespace.h>",
      "#include <linux/rculist.h>",
      "#include <linux/cred.h>",
      "#include <linux/string.h>",
      "#include <linux/spinlock.h>",
      "#include <linux/slab.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "strstr",
          "args": [
            "hname",
            "\"//\""
          ],
          "line": 374
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "__strn_find_child",
          "args": [
            "&policy->profiles",
            "hname",
            "split - hname"
          ],
          "line": 368
        },
        "resolved": true,
        "details": {
          "function_name": "__strn_find_child",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/policy.c",
          "lines": "304-308",
          "snippet": "static struct aa_profile *__strn_find_child(struct list_head *head,\n\t\t\t\t\t    const char *name, int len)\n{\n\treturn (struct aa_profile *)__policy_strn_find(head, name, len);\n}",
          "includes": [
            "#include \"include/resource.h\"",
            "#include \"include/policy_unpack.h\"",
            "#include \"include/policy_ns.h\"",
            "#include \"include/policy.h\"",
            "#include \"include/path.h\"",
            "#include \"include/match.h\"",
            "#include \"include/ipc.h\"",
            "#include \"include/file.h\"",
            "#include \"include/context.h\"",
            "#include \"include/capability.h\"",
            "#include \"include/apparmor.h\"",
            "#include <linux/user_namespace.h>",
            "#include <linux/rculist.h>",
            "#include <linux/cred.h>",
            "#include <linux/string.h>",
            "#include <linux/spinlock.h>",
            "#include <linux/slab.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"include/resource.h\"\n#include \"include/policy_unpack.h\"\n#include \"include/policy_ns.h\"\n#include \"include/policy.h\"\n#include \"include/path.h\"\n#include \"include/match.h\"\n#include \"include/ipc.h\"\n#include \"include/file.h\"\n#include \"include/context.h\"\n#include \"include/capability.h\"\n#include \"include/apparmor.h\"\n#include <linux/user_namespace.h>\n#include <linux/rculist.h>\n#include <linux/cred.h>\n#include <linux/string.h>\n#include <linux/spinlock.h>\n#include <linux/slab.h>\n\nstatic struct aa_profile *__strn_find_child(struct list_head *head,\n\t\t\t\t\t    const char *name, int len)\n{\n\treturn (struct aa_profile *)__policy_strn_find(head, name, len);\n}"
        }
      },
      {
        "call_info": {
          "callee": "strstr",
          "args": [
            "hname",
            "\"//\""
          ],
          "line": 367
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"include/resource.h\"\n#include \"include/policy_unpack.h\"\n#include \"include/policy_ns.h\"\n#include \"include/policy.h\"\n#include \"include/path.h\"\n#include \"include/match.h\"\n#include \"include/ipc.h\"\n#include \"include/file.h\"\n#include \"include/context.h\"\n#include \"include/capability.h\"\n#include \"include/apparmor.h\"\n#include <linux/user_namespace.h>\n#include <linux/rculist.h>\n#include <linux/cred.h>\n#include <linux/string.h>\n#include <linux/spinlock.h>\n#include <linux/slab.h>\n\nstatic struct aa_policy *__lookup_parent(struct aa_ns *ns,\n\t\t\t\t\t const char *hname)\n{\n\tstruct aa_policy *policy;\n\tstruct aa_profile *profile = NULL;\n\tchar *split;\n\n\tpolicy = &ns->base;\n\n\tfor (split = strstr(hname, \"//\"); split;) {\n\t\tprofile = __strn_find_child(&policy->profiles, hname,\n\t\t\t\t\t    split - hname);\n\t\tif (!profile)\n\t\t\treturn NULL;\n\t\tpolicy = &profile->base;\n\t\thname = split + 2;\n\t\tsplit = strstr(hname, \"//\");\n\t}\n\tif (!profile)\n\t\treturn &ns->base;\n\treturn &profile->base;\n}"
  },
  {
    "function_name": "aa_find_child",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/policy.c",
    "lines": "331-343",
    "snippet": "struct aa_profile *aa_find_child(struct aa_profile *parent, const char *name)\n{\n\tstruct aa_profile *profile;\n\n\trcu_read_lock();\n\tdo {\n\t\tprofile = __find_child(&parent->base.profiles, name);\n\t} while (profile && !aa_get_profile_not0(profile));\n\trcu_read_unlock();\n\n\t/* refcount released by caller */\n\treturn profile;\n}",
    "includes": [
      "#include \"include/resource.h\"",
      "#include \"include/policy_unpack.h\"",
      "#include \"include/policy_ns.h\"",
      "#include \"include/policy.h\"",
      "#include \"include/path.h\"",
      "#include \"include/match.h\"",
      "#include \"include/ipc.h\"",
      "#include \"include/file.h\"",
      "#include \"include/context.h\"",
      "#include \"include/capability.h\"",
      "#include \"include/apparmor.h\"",
      "#include <linux/user_namespace.h>",
      "#include <linux/rculist.h>",
      "#include <linux/cred.h>",
      "#include <linux/string.h>",
      "#include <linux/spinlock.h>",
      "#include <linux/slab.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "rcu_read_unlock",
          "args": [],
          "line": 339
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "aa_get_profile_not0",
          "args": [
            "profile"
          ],
          "line": 338
        },
        "resolved": true,
        "details": {
          "function_name": "aa_get_profile_not0",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/include/policy.h",
          "lines": "245-251",
          "snippet": "static inline struct aa_profile *aa_get_profile_not0(struct aa_profile *p)\n{\n\tif (p && kref_get_unless_zero(&p->label.count))\n\t\treturn p;\n\n\treturn NULL;\n}",
          "includes": [
            "#include \"resource.h\"",
            "#include \"perms.h\"",
            "#include \"label.h\"",
            "#include \"lib.h\"",
            "#include \"file.h\"",
            "#include \"domain.h\"",
            "#include \"capability.h\"",
            "#include \"audit.h\"",
            "#include \"apparmor.h\"",
            "#include <linux/socket.h>",
            "#include <linux/slab.h>",
            "#include <linux/sched.h>",
            "#include <linux/rhashtable.h>",
            "#include <linux/kref.h>",
            "#include <linux/cred.h>",
            "#include <linux/capability.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"resource.h\"\n#include \"perms.h\"\n#include \"label.h\"\n#include \"lib.h\"\n#include \"file.h\"\n#include \"domain.h\"\n#include \"capability.h\"\n#include \"audit.h\"\n#include \"apparmor.h\"\n#include <linux/socket.h>\n#include <linux/slab.h>\n#include <linux/sched.h>\n#include <linux/rhashtable.h>\n#include <linux/kref.h>\n#include <linux/cred.h>\n#include <linux/capability.h>\n\nstatic inline struct aa_profile *aa_get_profile_not0(struct aa_profile *p)\n{\n\tif (p && kref_get_unless_zero(&p->label.count))\n\t\treturn p;\n\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "__find_child",
          "args": [
            "&parent->base.profiles",
            "name"
          ],
          "line": 337
        },
        "resolved": true,
        "details": {
          "function_name": "__find_child",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/policy.c",
          "lines": "319-322",
          "snippet": "static struct aa_profile *__find_child(struct list_head *head, const char *name)\n{\n\treturn __strn_find_child(head, name, strlen(name));\n}",
          "includes": [
            "#include \"include/resource.h\"",
            "#include \"include/policy_unpack.h\"",
            "#include \"include/policy_ns.h\"",
            "#include \"include/policy.h\"",
            "#include \"include/path.h\"",
            "#include \"include/match.h\"",
            "#include \"include/ipc.h\"",
            "#include \"include/file.h\"",
            "#include \"include/context.h\"",
            "#include \"include/capability.h\"",
            "#include \"include/apparmor.h\"",
            "#include <linux/user_namespace.h>",
            "#include <linux/rculist.h>",
            "#include <linux/cred.h>",
            "#include <linux/string.h>",
            "#include <linux/spinlock.h>",
            "#include <linux/slab.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"include/resource.h\"\n#include \"include/policy_unpack.h\"\n#include \"include/policy_ns.h\"\n#include \"include/policy.h\"\n#include \"include/path.h\"\n#include \"include/match.h\"\n#include \"include/ipc.h\"\n#include \"include/file.h\"\n#include \"include/context.h\"\n#include \"include/capability.h\"\n#include \"include/apparmor.h\"\n#include <linux/user_namespace.h>\n#include <linux/rculist.h>\n#include <linux/cred.h>\n#include <linux/string.h>\n#include <linux/spinlock.h>\n#include <linux/slab.h>\n\nstatic struct aa_profile *__find_child(struct list_head *head, const char *name)\n{\n\treturn __strn_find_child(head, name, strlen(name));\n}"
        }
      },
      {
        "call_info": {
          "callee": "rcu_read_lock",
          "args": [],
          "line": 335
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"include/resource.h\"\n#include \"include/policy_unpack.h\"\n#include \"include/policy_ns.h\"\n#include \"include/policy.h\"\n#include \"include/path.h\"\n#include \"include/match.h\"\n#include \"include/ipc.h\"\n#include \"include/file.h\"\n#include \"include/context.h\"\n#include \"include/capability.h\"\n#include \"include/apparmor.h\"\n#include <linux/user_namespace.h>\n#include <linux/rculist.h>\n#include <linux/cred.h>\n#include <linux/string.h>\n#include <linux/spinlock.h>\n#include <linux/slab.h>\n\nstruct aa_profile *aa_find_child(struct aa_profile *parent, const char *name)\n{\n\tstruct aa_profile *profile;\n\n\trcu_read_lock();\n\tdo {\n\t\tprofile = __find_child(&parent->base.profiles, name);\n\t} while (profile && !aa_get_profile_not0(profile));\n\trcu_read_unlock();\n\n\t/* refcount released by caller */\n\treturn profile;\n}"
  },
  {
    "function_name": "__find_child",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/policy.c",
    "lines": "319-322",
    "snippet": "static struct aa_profile *__find_child(struct list_head *head, const char *name)\n{\n\treturn __strn_find_child(head, name, strlen(name));\n}",
    "includes": [
      "#include \"include/resource.h\"",
      "#include \"include/policy_unpack.h\"",
      "#include \"include/policy_ns.h\"",
      "#include \"include/policy.h\"",
      "#include \"include/path.h\"",
      "#include \"include/match.h\"",
      "#include \"include/ipc.h\"",
      "#include \"include/file.h\"",
      "#include \"include/context.h\"",
      "#include \"include/capability.h\"",
      "#include \"include/apparmor.h\"",
      "#include <linux/user_namespace.h>",
      "#include <linux/rculist.h>",
      "#include <linux/cred.h>",
      "#include <linux/string.h>",
      "#include <linux/spinlock.h>",
      "#include <linux/slab.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "__strn_find_child",
          "args": [
            "head",
            "name",
            "strlen(name)"
          ],
          "line": 321
        },
        "resolved": true,
        "details": {
          "function_name": "__strn_find_child",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/policy.c",
          "lines": "304-308",
          "snippet": "static struct aa_profile *__strn_find_child(struct list_head *head,\n\t\t\t\t\t    const char *name, int len)\n{\n\treturn (struct aa_profile *)__policy_strn_find(head, name, len);\n}",
          "includes": [
            "#include \"include/resource.h\"",
            "#include \"include/policy_unpack.h\"",
            "#include \"include/policy_ns.h\"",
            "#include \"include/policy.h\"",
            "#include \"include/path.h\"",
            "#include \"include/match.h\"",
            "#include \"include/ipc.h\"",
            "#include \"include/file.h\"",
            "#include \"include/context.h\"",
            "#include \"include/capability.h\"",
            "#include \"include/apparmor.h\"",
            "#include <linux/user_namespace.h>",
            "#include <linux/rculist.h>",
            "#include <linux/cred.h>",
            "#include <linux/string.h>",
            "#include <linux/spinlock.h>",
            "#include <linux/slab.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"include/resource.h\"\n#include \"include/policy_unpack.h\"\n#include \"include/policy_ns.h\"\n#include \"include/policy.h\"\n#include \"include/path.h\"\n#include \"include/match.h\"\n#include \"include/ipc.h\"\n#include \"include/file.h\"\n#include \"include/context.h\"\n#include \"include/capability.h\"\n#include \"include/apparmor.h\"\n#include <linux/user_namespace.h>\n#include <linux/rculist.h>\n#include <linux/cred.h>\n#include <linux/string.h>\n#include <linux/spinlock.h>\n#include <linux/slab.h>\n\nstatic struct aa_profile *__strn_find_child(struct list_head *head,\n\t\t\t\t\t    const char *name, int len)\n{\n\treturn (struct aa_profile *)__policy_strn_find(head, name, len);\n}"
        }
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "name"
          ],
          "line": 321
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"include/resource.h\"\n#include \"include/policy_unpack.h\"\n#include \"include/policy_ns.h\"\n#include \"include/policy.h\"\n#include \"include/path.h\"\n#include \"include/match.h\"\n#include \"include/ipc.h\"\n#include \"include/file.h\"\n#include \"include/context.h\"\n#include \"include/capability.h\"\n#include \"include/apparmor.h\"\n#include <linux/user_namespace.h>\n#include <linux/rculist.h>\n#include <linux/cred.h>\n#include <linux/string.h>\n#include <linux/spinlock.h>\n#include <linux/slab.h>\n\nstatic struct aa_profile *__find_child(struct list_head *head, const char *name)\n{\n\treturn __strn_find_child(head, name, strlen(name));\n}"
  },
  {
    "function_name": "__strn_find_child",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/policy.c",
    "lines": "304-308",
    "snippet": "static struct aa_profile *__strn_find_child(struct list_head *head,\n\t\t\t\t\t    const char *name, int len)\n{\n\treturn (struct aa_profile *)__policy_strn_find(head, name, len);\n}",
    "includes": [
      "#include \"include/resource.h\"",
      "#include \"include/policy_unpack.h\"",
      "#include \"include/policy_ns.h\"",
      "#include \"include/policy.h\"",
      "#include \"include/path.h\"",
      "#include \"include/match.h\"",
      "#include \"include/ipc.h\"",
      "#include \"include/file.h\"",
      "#include \"include/context.h\"",
      "#include \"include/capability.h\"",
      "#include \"include/apparmor.h\"",
      "#include <linux/user_namespace.h>",
      "#include <linux/rculist.h>",
      "#include <linux/cred.h>",
      "#include <linux/string.h>",
      "#include <linux/spinlock.h>",
      "#include <linux/slab.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "__policy_strn_find",
          "args": [
            "head",
            "name",
            "len"
          ],
          "line": 307
        },
        "resolved": true,
        "details": {
          "function_name": "__policy_strn_find",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/include/lib.h",
          "lines": "186-197",
          "snippet": "static inline struct aa_policy *__policy_strn_find(struct list_head *head,\n\t\t\t\t\t    const char *str, int len)\n{\n\tstruct aa_policy *policy;\n\n\tlist_for_each_entry_rcu(policy, head, list) {\n\t\tif (aa_strneq(policy->name, str, len))\n\t\t\treturn policy;\n\t}\n\n\treturn NULL;\n}",
          "includes": [
            "#include \"match.h\"",
            "#include <linux/fs.h>",
            "#include <linux/slab.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"match.h\"\n#include <linux/fs.h>\n#include <linux/slab.h>\n\nstatic inline struct aa_policy *__policy_strn_find(struct list_head *head,\n\t\t\t\t\t    const char *str, int len)\n{\n\tstruct aa_policy *policy;\n\n\tlist_for_each_entry_rcu(policy, head, list) {\n\t\tif (aa_strneq(policy->name, str, len))\n\t\t\treturn policy;\n\t}\n\n\treturn NULL;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"include/resource.h\"\n#include \"include/policy_unpack.h\"\n#include \"include/policy_ns.h\"\n#include \"include/policy.h\"\n#include \"include/path.h\"\n#include \"include/match.h\"\n#include \"include/ipc.h\"\n#include \"include/file.h\"\n#include \"include/context.h\"\n#include \"include/capability.h\"\n#include \"include/apparmor.h\"\n#include <linux/user_namespace.h>\n#include <linux/rculist.h>\n#include <linux/cred.h>\n#include <linux/string.h>\n#include <linux/spinlock.h>\n#include <linux/slab.h>\n\nstatic struct aa_profile *__strn_find_child(struct list_head *head,\n\t\t\t\t\t    const char *name, int len)\n{\n\treturn (struct aa_profile *)__policy_strn_find(head, name, len);\n}"
  },
  {
    "function_name": "aa_alloc_profile",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/policy.c",
    "lines": "254-290",
    "snippet": "struct aa_profile *aa_alloc_profile(const char *hname, struct aa_proxy *proxy,\n\t\t\t\t    gfp_t gfp)\n{\n\tstruct aa_profile *profile;\n\n\t/* freed by free_profile - usually through aa_put_profile */\n\tprofile = kzalloc(sizeof(*profile) + sizeof(struct aa_profile *) * 2,\n\t\t\t  gfp);\n\tif (!profile)\n\t\treturn NULL;\n\n\tif (!aa_policy_init(&profile->base, NULL, hname, gfp))\n\t\tgoto fail;\n\tif (!aa_label_init(&profile->label, 1))\n\t\tgoto fail;\n\n\t/* update being set needed by fs interface */\n\tif (!proxy) {\n\t\tproxy = aa_alloc_proxy(&profile->label, gfp);\n\t\tif (!proxy)\n\t\t\tgoto fail;\n\t} else\n\t\taa_get_proxy(proxy);\n\tprofile->label.proxy = proxy;\n\n\tprofile->label.hname = profile->base.hname;\n\tprofile->label.flags |= FLAG_PROFILE;\n\tprofile->label.vec[0] = profile;\n\n\t/* refcount released by caller */\n\treturn profile;\n\nfail:\n\taa_free_profile(profile);\n\n\treturn NULL;\n}",
    "includes": [
      "#include \"include/resource.h\"",
      "#include \"include/policy_unpack.h\"",
      "#include \"include/policy_ns.h\"",
      "#include \"include/policy.h\"",
      "#include \"include/path.h\"",
      "#include \"include/match.h\"",
      "#include \"include/ipc.h\"",
      "#include \"include/file.h\"",
      "#include \"include/context.h\"",
      "#include \"include/capability.h\"",
      "#include \"include/apparmor.h\"",
      "#include <linux/user_namespace.h>",
      "#include <linux/rculist.h>",
      "#include <linux/cred.h>",
      "#include <linux/string.h>",
      "#include <linux/spinlock.h>",
      "#include <linux/slab.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "aa_free_profile",
          "args": [
            "profile"
          ],
          "line": 287
        },
        "resolved": true,
        "details": {
          "function_name": "aa_free_profile",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/policy.c",
          "lines": "210-245",
          "snippet": "void aa_free_profile(struct aa_profile *profile)\n{\n\tstruct rhashtable *rht;\n\n\tAA_DEBUG(\"%s(%p)\\n\", __func__, profile);\n\n\tif (!profile)\n\t\treturn;\n\n\t/* free children profiles */\n\taa_policy_destroy(&profile->base);\n\taa_put_profile(rcu_access_pointer(profile->parent));\n\n\taa_put_ns(profile->ns);\n\tkzfree(profile->rename);\n\n\taa_free_file_rules(&profile->file);\n\taa_free_cap_rules(&profile->caps);\n\taa_free_rlimit_rules(&profile->rlimits);\n\n\tkzfree(profile->dirname);\n\taa_put_dfa(profile->xmatch);\n\taa_put_dfa(profile->policy.dfa);\n\n\tif (profile->data) {\n\t\trht = profile->data;\n\t\tprofile->data = NULL;\n\t\trhashtable_free_and_destroy(rht, aa_free_data, NULL);\n\t\tkzfree(rht);\n\t}\n\n\tkzfree(profile->hash);\n\taa_put_loaddata(profile->rawdata);\n\n\tkzfree(profile);\n}",
          "includes": [
            "#include \"include/resource.h\"",
            "#include \"include/policy_unpack.h\"",
            "#include \"include/policy_ns.h\"",
            "#include \"include/policy.h\"",
            "#include \"include/path.h\"",
            "#include \"include/match.h\"",
            "#include \"include/ipc.h\"",
            "#include \"include/file.h\"",
            "#include \"include/context.h\"",
            "#include \"include/capability.h\"",
            "#include \"include/apparmor.h\"",
            "#include <linux/user_namespace.h>",
            "#include <linux/rculist.h>",
            "#include <linux/cred.h>",
            "#include <linux/string.h>",
            "#include <linux/spinlock.h>",
            "#include <linux/slab.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"include/resource.h\"\n#include \"include/policy_unpack.h\"\n#include \"include/policy_ns.h\"\n#include \"include/policy.h\"\n#include \"include/path.h\"\n#include \"include/match.h\"\n#include \"include/ipc.h\"\n#include \"include/file.h\"\n#include \"include/context.h\"\n#include \"include/capability.h\"\n#include \"include/apparmor.h\"\n#include <linux/user_namespace.h>\n#include <linux/rculist.h>\n#include <linux/cred.h>\n#include <linux/string.h>\n#include <linux/spinlock.h>\n#include <linux/slab.h>\n\nvoid aa_free_profile(struct aa_profile *profile)\n{\n\tstruct rhashtable *rht;\n\n\tAA_DEBUG(\"%s(%p)\\n\", __func__, profile);\n\n\tif (!profile)\n\t\treturn;\n\n\t/* free children profiles */\n\taa_policy_destroy(&profile->base);\n\taa_put_profile(rcu_access_pointer(profile->parent));\n\n\taa_put_ns(profile->ns);\n\tkzfree(profile->rename);\n\n\taa_free_file_rules(&profile->file);\n\taa_free_cap_rules(&profile->caps);\n\taa_free_rlimit_rules(&profile->rlimits);\n\n\tkzfree(profile->dirname);\n\taa_put_dfa(profile->xmatch);\n\taa_put_dfa(profile->policy.dfa);\n\n\tif (profile->data) {\n\t\trht = profile->data;\n\t\tprofile->data = NULL;\n\t\trhashtable_free_and_destroy(rht, aa_free_data, NULL);\n\t\tkzfree(rht);\n\t}\n\n\tkzfree(profile->hash);\n\taa_put_loaddata(profile->rawdata);\n\n\tkzfree(profile);\n}"
        }
      },
      {
        "call_info": {
          "callee": "aa_get_proxy",
          "args": [
            "proxy"
          ],
          "line": 276
        },
        "resolved": true,
        "details": {
          "function_name": "aa_get_proxy",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/include/label.h",
          "lines": "426-432",
          "snippet": "static inline struct aa_proxy *aa_get_proxy(struct aa_proxy *proxy)\n{\n\tif (proxy)\n\t\tkref_get(&(proxy->count));\n\n\treturn proxy;\n}",
          "includes": [
            "#include \"lib.h\"",
            "#include \"apparmor.h\"",
            "#include <linux/rcupdate.h>",
            "#include <linux/rbtree.h>",
            "#include <linux/audit.h>",
            "#include <linux/atomic.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"lib.h\"\n#include \"apparmor.h\"\n#include <linux/rcupdate.h>\n#include <linux/rbtree.h>\n#include <linux/audit.h>\n#include <linux/atomic.h>\n\nstatic inline struct aa_proxy *aa_get_proxy(struct aa_proxy *proxy)\n{\n\tif (proxy)\n\t\tkref_get(&(proxy->count));\n\n\treturn proxy;\n}"
        }
      },
      {
        "call_info": {
          "callee": "aa_alloc_proxy",
          "args": [
            "&profile->label",
            "gfp"
          ],
          "line": 272
        },
        "resolved": true,
        "details": {
          "function_name": "aa_alloc_proxy",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/label.c",
          "lines": "64-74",
          "snippet": "struct aa_proxy *aa_alloc_proxy(struct aa_label *label, gfp_t gfp)\n{\n\tstruct aa_proxy *new;\n\n\tnew = kzalloc(sizeof(struct aa_proxy), gfp);\n\tif (new) {\n\t\tkref_init(&new->count);\n\t\trcu_assign_pointer(new->label, aa_get_label(label));\n\t}\n\treturn new;\n}",
          "includes": [
            "#include \"include/secid.h\"",
            "#include \"include/policy.h\"",
            "#include \"include/label.h\"",
            "#include \"include/context.h\"",
            "#include \"include/apparmor.h\"",
            "#include <linux/sort.h>",
            "#include <linux/seq_file.h>",
            "#include <linux/audit.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"include/secid.h\"\n#include \"include/policy.h\"\n#include \"include/label.h\"\n#include \"include/context.h\"\n#include \"include/apparmor.h\"\n#include <linux/sort.h>\n#include <linux/seq_file.h>\n#include <linux/audit.h>\n\nstruct aa_proxy *aa_alloc_proxy(struct aa_label *label, gfp_t gfp)\n{\n\tstruct aa_proxy *new;\n\n\tnew = kzalloc(sizeof(struct aa_proxy), gfp);\n\tif (new) {\n\t\tkref_init(&new->count);\n\t\trcu_assign_pointer(new->label, aa_get_label(label));\n\t}\n\treturn new;\n}"
        }
      },
      {
        "call_info": {
          "callee": "aa_label_init",
          "args": [
            "&profile->label",
            "1"
          ],
          "line": 267
        },
        "resolved": true,
        "details": {
          "function_name": "aa_label_init",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/label.c",
          "lines": "405-420",
          "snippet": "bool aa_label_init(struct aa_label *label, int size)\n{\n\tAA_BUG(!label);\n\tAA_BUG(size < 1);\n\n\tlabel->secid = aa_alloc_secid();\n\tif (label->secid == AA_SECID_INVALID)\n\t\treturn false;\n\n\tlabel->size = size;\t\t\t/* doesn't include null */\n\tlabel->vec[size] = NULL;\t\t/* null terminate */\n\tkref_init(&label->count);\n\tRB_CLEAR_NODE(&label->node);\n\n\treturn true;\n}",
          "includes": [
            "#include \"include/secid.h\"",
            "#include \"include/policy.h\"",
            "#include \"include/label.h\"",
            "#include \"include/context.h\"",
            "#include \"include/apparmor.h\"",
            "#include <linux/sort.h>",
            "#include <linux/seq_file.h>",
            "#include <linux/audit.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"include/secid.h\"\n#include \"include/policy.h\"\n#include \"include/label.h\"\n#include \"include/context.h\"\n#include \"include/apparmor.h\"\n#include <linux/sort.h>\n#include <linux/seq_file.h>\n#include <linux/audit.h>\n\nbool aa_label_init(struct aa_label *label, int size)\n{\n\tAA_BUG(!label);\n\tAA_BUG(size < 1);\n\n\tlabel->secid = aa_alloc_secid();\n\tif (label->secid == AA_SECID_INVALID)\n\t\treturn false;\n\n\tlabel->size = size;\t\t\t/* doesn't include null */\n\tlabel->vec[size] = NULL;\t\t/* null terminate */\n\tkref_init(&label->count);\n\tRB_CLEAR_NODE(&label->node);\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "aa_policy_init",
          "args": [
            "&profile->base",
            "NULL",
            "hname",
            "gfp"
          ],
          "line": 265
        },
        "resolved": true,
        "details": {
          "function_name": "aa_policy_init",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/lib.c",
          "lines": "480-504",
          "snippet": "bool aa_policy_init(struct aa_policy *policy, const char *prefix,\n\t\t    const char *name, gfp_t gfp)\n{\n\tchar *hname;\n\n\t/* freed by policy_free */\n\tif (prefix) {\n\t\thname = aa_str_alloc(strlen(prefix) + strlen(name) + 3, gfp);\n\t\tif (hname)\n\t\t\tsprintf(hname, \"%s//%s\", prefix, name);\n\t} else {\n\t\thname = aa_str_alloc(strlen(name) + 1, gfp);\n\t\tif (hname)\n\t\t\tstrcpy(hname, name);\n\t}\n\tif (!hname)\n\t\treturn false;\n\tpolicy->hname = hname;\n\t/* base.name is a substring of fqname */\n\tpolicy->name = basename(policy->hname);\n\tINIT_LIST_HEAD(&policy->list);\n\tINIT_LIST_HEAD(&policy->profiles);\n\n\treturn true;\n}",
          "includes": [
            "#include \"include/policy.h\"",
            "#include \"include/perms.h\"",
            "#include \"include/lib.h\"",
            "#include \"include/apparmor.h\"",
            "#include \"include/audit.h\"",
            "#include <linux/vmalloc.h>",
            "#include <linux/string.h>",
            "#include <linux/slab.h>",
            "#include <linux/mm.h>",
            "#include <linux/ctype.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"include/policy.h\"\n#include \"include/perms.h\"\n#include \"include/lib.h\"\n#include \"include/apparmor.h\"\n#include \"include/audit.h\"\n#include <linux/vmalloc.h>\n#include <linux/string.h>\n#include <linux/slab.h>\n#include <linux/mm.h>\n#include <linux/ctype.h>\n\nbool aa_policy_init(struct aa_policy *policy, const char *prefix,\n\t\t    const char *name, gfp_t gfp)\n{\n\tchar *hname;\n\n\t/* freed by policy_free */\n\tif (prefix) {\n\t\thname = aa_str_alloc(strlen(prefix) + strlen(name) + 3, gfp);\n\t\tif (hname)\n\t\t\tsprintf(hname, \"%s//%s\", prefix, name);\n\t} else {\n\t\thname = aa_str_alloc(strlen(name) + 1, gfp);\n\t\tif (hname)\n\t\t\tstrcpy(hname, name);\n\t}\n\tif (!hname)\n\t\treturn false;\n\tpolicy->hname = hname;\n\t/* base.name is a substring of fqname */\n\tpolicy->name = basename(policy->hname);\n\tINIT_LIST_HEAD(&policy->list);\n\tINIT_LIST_HEAD(&policy->profiles);\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "kzalloc",
          "args": [
            "sizeof(*profile) + sizeof(struct aa_profile *) * 2",
            "gfp"
          ],
          "line": 260
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"include/resource.h\"\n#include \"include/policy_unpack.h\"\n#include \"include/policy_ns.h\"\n#include \"include/policy.h\"\n#include \"include/path.h\"\n#include \"include/match.h\"\n#include \"include/ipc.h\"\n#include \"include/file.h\"\n#include \"include/context.h\"\n#include \"include/capability.h\"\n#include \"include/apparmor.h\"\n#include <linux/user_namespace.h>\n#include <linux/rculist.h>\n#include <linux/cred.h>\n#include <linux/string.h>\n#include <linux/spinlock.h>\n#include <linux/slab.h>\n\nstruct aa_profile *aa_alloc_profile(const char *hname, struct aa_proxy *proxy,\n\t\t\t\t    gfp_t gfp)\n{\n\tstruct aa_profile *profile;\n\n\t/* freed by free_profile - usually through aa_put_profile */\n\tprofile = kzalloc(sizeof(*profile) + sizeof(struct aa_profile *) * 2,\n\t\t\t  gfp);\n\tif (!profile)\n\t\treturn NULL;\n\n\tif (!aa_policy_init(&profile->base, NULL, hname, gfp))\n\t\tgoto fail;\n\tif (!aa_label_init(&profile->label, 1))\n\t\tgoto fail;\n\n\t/* update being set needed by fs interface */\n\tif (!proxy) {\n\t\tproxy = aa_alloc_proxy(&profile->label, gfp);\n\t\tif (!proxy)\n\t\t\tgoto fail;\n\t} else\n\t\taa_get_proxy(proxy);\n\tprofile->label.proxy = proxy;\n\n\tprofile->label.hname = profile->base.hname;\n\tprofile->label.flags |= FLAG_PROFILE;\n\tprofile->label.vec[0] = profile;\n\n\t/* refcount released by caller */\n\treturn profile;\n\nfail:\n\taa_free_profile(profile);\n\n\treturn NULL;\n}"
  },
  {
    "function_name": "aa_free_profile",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/policy.c",
    "lines": "210-245",
    "snippet": "void aa_free_profile(struct aa_profile *profile)\n{\n\tstruct rhashtable *rht;\n\n\tAA_DEBUG(\"%s(%p)\\n\", __func__, profile);\n\n\tif (!profile)\n\t\treturn;\n\n\t/* free children profiles */\n\taa_policy_destroy(&profile->base);\n\taa_put_profile(rcu_access_pointer(profile->parent));\n\n\taa_put_ns(profile->ns);\n\tkzfree(profile->rename);\n\n\taa_free_file_rules(&profile->file);\n\taa_free_cap_rules(&profile->caps);\n\taa_free_rlimit_rules(&profile->rlimits);\n\n\tkzfree(profile->dirname);\n\taa_put_dfa(profile->xmatch);\n\taa_put_dfa(profile->policy.dfa);\n\n\tif (profile->data) {\n\t\trht = profile->data;\n\t\tprofile->data = NULL;\n\t\trhashtable_free_and_destroy(rht, aa_free_data, NULL);\n\t\tkzfree(rht);\n\t}\n\n\tkzfree(profile->hash);\n\taa_put_loaddata(profile->rawdata);\n\n\tkzfree(profile);\n}",
    "includes": [
      "#include \"include/resource.h\"",
      "#include \"include/policy_unpack.h\"",
      "#include \"include/policy_ns.h\"",
      "#include \"include/policy.h\"",
      "#include \"include/path.h\"",
      "#include \"include/match.h\"",
      "#include \"include/ipc.h\"",
      "#include \"include/file.h\"",
      "#include \"include/context.h\"",
      "#include \"include/capability.h\"",
      "#include \"include/apparmor.h\"",
      "#include <linux/user_namespace.h>",
      "#include <linux/rculist.h>",
      "#include <linux/cred.h>",
      "#include <linux/string.h>",
      "#include <linux/spinlock.h>",
      "#include <linux/slab.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "kzfree",
          "args": [
            "profile"
          ],
          "line": 244
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "aa_put_loaddata",
          "args": [
            "profile->rawdata"
          ],
          "line": 242
        },
        "resolved": true,
        "details": {
          "function_name": "aa_put_loaddata",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/include/policy_unpack.h",
          "lines": "119-123",
          "snippet": "static inline void aa_put_loaddata(struct aa_loaddata *data)\n{\n\tif (data)\n\t\tkref_put(&data->count, aa_loaddata_kref);\n}",
          "includes": [
            "#include <linux/workqueue.h>",
            "#include <linux/dcache.h>",
            "#include <linux/kref.h>",
            "#include <linux/list.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/workqueue.h>\n#include <linux/dcache.h>\n#include <linux/kref.h>\n#include <linux/list.h>\n\nstatic inline void aa_put_loaddata(struct aa_loaddata *data)\n{\n\tif (data)\n\t\tkref_put(&data->count, aa_loaddata_kref);\n}"
        }
      },
      {
        "call_info": {
          "callee": "kzfree",
          "args": [
            "profile->hash"
          ],
          "line": 241
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kzfree",
          "args": [
            "rht"
          ],
          "line": 238
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rhashtable_free_and_destroy",
          "args": [
            "rht",
            "aa_free_data",
            "NULL"
          ],
          "line": 237
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "aa_put_dfa",
          "args": [
            "profile->policy.dfa"
          ],
          "line": 232
        },
        "resolved": true,
        "details": {
          "function_name": "aa_put_dfa",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/include/match.h",
          "lines": "156-160",
          "snippet": "static inline void aa_put_dfa(struct aa_dfa *dfa)\n{\n\tif (dfa)\n\t\tkref_put(&dfa->count, aa_dfa_free_kref);\n}",
          "includes": [
            "#include <linux/kref.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/kref.h>\n\nstatic inline void aa_put_dfa(struct aa_dfa *dfa)\n{\n\tif (dfa)\n\t\tkref_put(&dfa->count, aa_dfa_free_kref);\n}"
        }
      },
      {
        "call_info": {
          "callee": "kzfree",
          "args": [
            "profile->dirname"
          ],
          "line": 230
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "aa_free_rlimit_rules",
          "args": [
            "&profile->rlimits"
          ],
          "line": 228
        },
        "resolved": true,
        "details": {
          "function_name": "aa_free_rlimit_rules",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/include/resource.h",
          "lines": "45-48",
          "snippet": "static inline void aa_free_rlimit_rules(struct aa_rlimit *rlims)\n{\n\t/* NOP */\n}",
          "includes": [
            "#include \"apparmorfs.h\"",
            "#include <linux/sched.h>",
            "#include <linux/resource.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"apparmorfs.h\"\n#include <linux/sched.h>\n#include <linux/resource.h>\n\nstatic inline void aa_free_rlimit_rules(struct aa_rlimit *rlims)\n{\n\t/* NOP */\n}"
        }
      },
      {
        "call_info": {
          "callee": "aa_free_cap_rules",
          "args": [
            "&profile->caps"
          ],
          "line": 227
        },
        "resolved": true,
        "details": {
          "function_name": "aa_free_cap_rules",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/include/capability.h",
          "lines": "45-48",
          "snippet": "static inline void aa_free_cap_rules(struct aa_caps *caps)\n{\n\t/* NOP */\n}",
          "includes": [
            "#include \"apparmorfs.h\"",
            "#include <linux/sched.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"apparmorfs.h\"\n#include <linux/sched.h>\n\nstatic inline void aa_free_cap_rules(struct aa_caps *caps)\n{\n\t/* NOP */\n}"
        }
      },
      {
        "call_info": {
          "callee": "aa_free_file_rules",
          "args": [
            "&profile->file"
          ],
          "line": 226
        },
        "resolved": true,
        "details": {
          "function_name": "aa_free_file_rules",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/include/file.h",
          "lines": "205-209",
          "snippet": "static inline void aa_free_file_rules(struct aa_file_rules *rules)\n{\n\taa_put_dfa(rules->dfa);\n\taa_free_domain_entries(&rules->trans);\n}",
          "includes": [
            "#include \"perms.h\"",
            "#include \"match.h\"",
            "#include \"domain.h\"",
            "#include <linux/spinlock.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"perms.h\"\n#include \"match.h\"\n#include \"domain.h\"\n#include <linux/spinlock.h>\n\nstatic inline void aa_free_file_rules(struct aa_file_rules *rules)\n{\n\taa_put_dfa(rules->dfa);\n\taa_free_domain_entries(&rules->trans);\n}"
        }
      },
      {
        "call_info": {
          "callee": "kzfree",
          "args": [
            "profile->rename"
          ],
          "line": 224
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "aa_put_ns",
          "args": [
            "profile->ns"
          ],
          "line": 223
        },
        "resolved": true,
        "details": {
          "function_name": "aa_put_ns",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/include/policy_ns.h",
          "lines": "130-134",
          "snippet": "static inline void aa_put_ns(struct aa_ns *ns)\n{\n\tif (ns)\n\t\taa_put_profile(ns->unconfined);\n}",
          "includes": [
            "#include \"policy.h\"",
            "#include \"label.h\"",
            "#include \"apparmorfs.h\"",
            "#include \"apparmor.h\"",
            "#include <linux/kref.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"policy.h\"\n#include \"label.h\"\n#include \"apparmorfs.h\"\n#include \"apparmor.h\"\n#include <linux/kref.h>\n\nstatic inline void aa_put_ns(struct aa_ns *ns)\n{\n\tif (ns)\n\t\taa_put_profile(ns->unconfined);\n}"
        }
      },
      {
        "call_info": {
          "callee": "aa_put_profile",
          "args": [
            "rcu_access_pointer(profile->parent)"
          ],
          "line": 221
        },
        "resolved": true,
        "details": {
          "function_name": "aa_put_profile",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/include/policy.h",
          "lines": "277-281",
          "snippet": "static inline void aa_put_profile(struct aa_profile *p)\n{\n\tif (p)\n\t\tkref_put(&p->label.count, aa_label_kref);\n}",
          "includes": [
            "#include \"resource.h\"",
            "#include \"perms.h\"",
            "#include \"label.h\"",
            "#include \"lib.h\"",
            "#include \"file.h\"",
            "#include \"domain.h\"",
            "#include \"capability.h\"",
            "#include \"audit.h\"",
            "#include \"apparmor.h\"",
            "#include <linux/socket.h>",
            "#include <linux/slab.h>",
            "#include <linux/sched.h>",
            "#include <linux/rhashtable.h>",
            "#include <linux/kref.h>",
            "#include <linux/cred.h>",
            "#include <linux/capability.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"resource.h\"\n#include \"perms.h\"\n#include \"label.h\"\n#include \"lib.h\"\n#include \"file.h\"\n#include \"domain.h\"\n#include \"capability.h\"\n#include \"audit.h\"\n#include \"apparmor.h\"\n#include <linux/socket.h>\n#include <linux/slab.h>\n#include <linux/sched.h>\n#include <linux/rhashtable.h>\n#include <linux/kref.h>\n#include <linux/cred.h>\n#include <linux/capability.h>\n\nstatic inline void aa_put_profile(struct aa_profile *p)\n{\n\tif (p)\n\t\tkref_put(&p->label.count, aa_label_kref);\n}"
        }
      },
      {
        "call_info": {
          "callee": "rcu_access_pointer",
          "args": [
            "profile->parent"
          ],
          "line": 221
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "aa_policy_destroy",
          "args": [
            "&profile->base"
          ],
          "line": 220
        },
        "resolved": true,
        "details": {
          "function_name": "aa_policy_destroy",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/lib.c",
          "lines": "510-517",
          "snippet": "void aa_policy_destroy(struct aa_policy *policy)\n{\n\tAA_BUG(on_list_rcu(&policy->profiles));\n\tAA_BUG(on_list_rcu(&policy->list));\n\n\t/* don't free name as its a subset of hname */\n\taa_put_str(policy->hname);\n}",
          "includes": [
            "#include \"include/policy.h\"",
            "#include \"include/perms.h\"",
            "#include \"include/lib.h\"",
            "#include \"include/apparmor.h\"",
            "#include \"include/audit.h\"",
            "#include <linux/vmalloc.h>",
            "#include <linux/string.h>",
            "#include <linux/slab.h>",
            "#include <linux/mm.h>",
            "#include <linux/ctype.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"include/policy.h\"\n#include \"include/perms.h\"\n#include \"include/lib.h\"\n#include \"include/apparmor.h\"\n#include \"include/audit.h\"\n#include <linux/vmalloc.h>\n#include <linux/string.h>\n#include <linux/slab.h>\n#include <linux/mm.h>\n#include <linux/ctype.h>\n\nvoid aa_policy_destroy(struct aa_policy *policy)\n{\n\tAA_BUG(on_list_rcu(&policy->profiles));\n\tAA_BUG(on_list_rcu(&policy->list));\n\n\t/* don't free name as its a subset of hname */\n\taa_put_str(policy->hname);\n}"
        }
      },
      {
        "call_info": {
          "callee": "AA_DEBUG",
          "args": [
            "\"%s(%p)\\n\"",
            "__func__",
            "profile"
          ],
          "line": 214
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"include/resource.h\"\n#include \"include/policy_unpack.h\"\n#include \"include/policy_ns.h\"\n#include \"include/policy.h\"\n#include \"include/path.h\"\n#include \"include/match.h\"\n#include \"include/ipc.h\"\n#include \"include/file.h\"\n#include \"include/context.h\"\n#include \"include/capability.h\"\n#include \"include/apparmor.h\"\n#include <linux/user_namespace.h>\n#include <linux/rculist.h>\n#include <linux/cred.h>\n#include <linux/string.h>\n#include <linux/spinlock.h>\n#include <linux/slab.h>\n\nvoid aa_free_profile(struct aa_profile *profile)\n{\n\tstruct rhashtable *rht;\n\n\tAA_DEBUG(\"%s(%p)\\n\", __func__, profile);\n\n\tif (!profile)\n\t\treturn;\n\n\t/* free children profiles */\n\taa_policy_destroy(&profile->base);\n\taa_put_profile(rcu_access_pointer(profile->parent));\n\n\taa_put_ns(profile->ns);\n\tkzfree(profile->rename);\n\n\taa_free_file_rules(&profile->file);\n\taa_free_cap_rules(&profile->caps);\n\taa_free_rlimit_rules(&profile->rlimits);\n\n\tkzfree(profile->dirname);\n\taa_put_dfa(profile->xmatch);\n\taa_put_dfa(profile->policy.dfa);\n\n\tif (profile->data) {\n\t\trht = profile->data;\n\t\tprofile->data = NULL;\n\t\trhashtable_free_and_destroy(rht, aa_free_data, NULL);\n\t\tkzfree(rht);\n\t}\n\n\tkzfree(profile->hash);\n\taa_put_loaddata(profile->rawdata);\n\n\tkzfree(profile);\n}"
  },
  {
    "function_name": "aa_free_data",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/policy.c",
    "lines": "191-198",
    "snippet": "static void aa_free_data(void *ptr, void *arg)\n{\n\tstruct aa_data *data = ptr;\n\n\tkzfree(data->data);\n\tkzfree(data->key);\n\tkzfree(data);\n}",
    "includes": [
      "#include \"include/resource.h\"",
      "#include \"include/policy_unpack.h\"",
      "#include \"include/policy_ns.h\"",
      "#include \"include/policy.h\"",
      "#include \"include/path.h\"",
      "#include \"include/match.h\"",
      "#include \"include/ipc.h\"",
      "#include \"include/file.h\"",
      "#include \"include/context.h\"",
      "#include \"include/capability.h\"",
      "#include \"include/apparmor.h\"",
      "#include <linux/user_namespace.h>",
      "#include <linux/rculist.h>",
      "#include <linux/cred.h>",
      "#include <linux/string.h>",
      "#include <linux/spinlock.h>",
      "#include <linux/slab.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "kzfree",
          "args": [
            "data"
          ],
          "line": 197
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kzfree",
          "args": [
            "data->key"
          ],
          "line": 196
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kzfree",
          "args": [
            "data->data"
          ],
          "line": 195
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"include/resource.h\"\n#include \"include/policy_unpack.h\"\n#include \"include/policy_ns.h\"\n#include \"include/policy.h\"\n#include \"include/path.h\"\n#include \"include/match.h\"\n#include \"include/ipc.h\"\n#include \"include/file.h\"\n#include \"include/context.h\"\n#include \"include/capability.h\"\n#include \"include/apparmor.h\"\n#include <linux/user_namespace.h>\n#include <linux/rculist.h>\n#include <linux/cred.h>\n#include <linux/string.h>\n#include <linux/spinlock.h>\n#include <linux/slab.h>\n\nstatic void aa_free_data(void *ptr, void *arg)\n{\n\tstruct aa_data *data = ptr;\n\n\tkzfree(data->data);\n\tkzfree(data->key);\n\tkzfree(data);\n}"
  },
  {
    "function_name": "__aa_profile_list_release",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/policy.c",
    "lines": "179-184",
    "snippet": "void __aa_profile_list_release(struct list_head *head)\n{\n\tstruct aa_profile *profile, *tmp;\n\tlist_for_each_entry_safe(profile, tmp, head, base.list)\n\t\t__remove_profile(profile);\n}",
    "includes": [
      "#include \"include/resource.h\"",
      "#include \"include/policy_unpack.h\"",
      "#include \"include/policy_ns.h\"",
      "#include \"include/policy.h\"",
      "#include \"include/path.h\"",
      "#include \"include/match.h\"",
      "#include \"include/ipc.h\"",
      "#include \"include/file.h\"",
      "#include \"include/context.h\"",
      "#include \"include/capability.h\"",
      "#include \"include/apparmor.h\"",
      "#include <linux/user_namespace.h>",
      "#include <linux/rculist.h>",
      "#include <linux/cred.h>",
      "#include <linux/string.h>",
      "#include <linux/spinlock.h>",
      "#include <linux/slab.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "__remove_profile",
          "args": [
            "profile"
          ],
          "line": 183
        },
        "resolved": true,
        "details": {
          "function_name": "__remove_profile",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/policy.c",
          "lines": "159-171",
          "snippet": "static void __remove_profile(struct aa_profile *profile)\n{\n\tAA_BUG(!profile);\n\tAA_BUG(!profile->ns);\n\tAA_BUG(!mutex_is_locked(&profile->ns->lock));\n\n\t/* release any children lists first */\n\t__aa_profile_list_release(&profile->base.profiles);\n\t/* released by free_profile */\n\taa_label_remove(&profile->label);\n\t__aafs_profile_rmdir(profile);\n\t__list_remove_profile(profile);\n}",
          "includes": [
            "#include \"include/resource.h\"",
            "#include \"include/policy_unpack.h\"",
            "#include \"include/policy_ns.h\"",
            "#include \"include/policy.h\"",
            "#include \"include/path.h\"",
            "#include \"include/match.h\"",
            "#include \"include/ipc.h\"",
            "#include \"include/file.h\"",
            "#include \"include/context.h\"",
            "#include \"include/capability.h\"",
            "#include \"include/apparmor.h\"",
            "#include <linux/user_namespace.h>",
            "#include <linux/rculist.h>",
            "#include <linux/cred.h>",
            "#include <linux/string.h>",
            "#include <linux/spinlock.h>",
            "#include <linux/slab.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"include/resource.h\"\n#include \"include/policy_unpack.h\"\n#include \"include/policy_ns.h\"\n#include \"include/policy.h\"\n#include \"include/path.h\"\n#include \"include/match.h\"\n#include \"include/ipc.h\"\n#include \"include/file.h\"\n#include \"include/context.h\"\n#include \"include/capability.h\"\n#include \"include/apparmor.h\"\n#include <linux/user_namespace.h>\n#include <linux/rculist.h>\n#include <linux/cred.h>\n#include <linux/string.h>\n#include <linux/spinlock.h>\n#include <linux/slab.h>\n\nstatic void __remove_profile(struct aa_profile *profile)\n{\n\tAA_BUG(!profile);\n\tAA_BUG(!profile->ns);\n\tAA_BUG(!mutex_is_locked(&profile->ns->lock));\n\n\t/* release any children lists first */\n\t__aa_profile_list_release(&profile->base.profiles);\n\t/* released by free_profile */\n\taa_label_remove(&profile->label);\n\t__aafs_profile_rmdir(profile);\n\t__list_remove_profile(profile);\n}"
        }
      },
      {
        "call_info": {
          "callee": "list_for_each_entry_safe",
          "args": [
            "profile",
            "tmp",
            "head",
            "base.list"
          ],
          "line": 182
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"include/resource.h\"\n#include \"include/policy_unpack.h\"\n#include \"include/policy_ns.h\"\n#include \"include/policy.h\"\n#include \"include/path.h\"\n#include \"include/match.h\"\n#include \"include/ipc.h\"\n#include \"include/file.h\"\n#include \"include/context.h\"\n#include \"include/capability.h\"\n#include \"include/apparmor.h\"\n#include <linux/user_namespace.h>\n#include <linux/rculist.h>\n#include <linux/cred.h>\n#include <linux/string.h>\n#include <linux/spinlock.h>\n#include <linux/slab.h>\n\nvoid __aa_profile_list_release(struct list_head *head)\n{\n\tstruct aa_profile *profile, *tmp;\n\tlist_for_each_entry_safe(profile, tmp, head, base.list)\n\t\t__remove_profile(profile);\n}"
  },
  {
    "function_name": "__remove_profile",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/policy.c",
    "lines": "159-171",
    "snippet": "static void __remove_profile(struct aa_profile *profile)\n{\n\tAA_BUG(!profile);\n\tAA_BUG(!profile->ns);\n\tAA_BUG(!mutex_is_locked(&profile->ns->lock));\n\n\t/* release any children lists first */\n\t__aa_profile_list_release(&profile->base.profiles);\n\t/* released by free_profile */\n\taa_label_remove(&profile->label);\n\t__aafs_profile_rmdir(profile);\n\t__list_remove_profile(profile);\n}",
    "includes": [
      "#include \"include/resource.h\"",
      "#include \"include/policy_unpack.h\"",
      "#include \"include/policy_ns.h\"",
      "#include \"include/policy.h\"",
      "#include \"include/path.h\"",
      "#include \"include/match.h\"",
      "#include \"include/ipc.h\"",
      "#include \"include/file.h\"",
      "#include \"include/context.h\"",
      "#include \"include/capability.h\"",
      "#include \"include/apparmor.h\"",
      "#include <linux/user_namespace.h>",
      "#include <linux/rculist.h>",
      "#include <linux/cred.h>",
      "#include <linux/string.h>",
      "#include <linux/spinlock.h>",
      "#include <linux/slab.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "__list_remove_profile",
          "args": [
            "profile"
          ],
          "line": 170
        },
        "resolved": true,
        "details": {
          "function_name": "__list_remove_profile",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/policy.c",
          "lines": "143-151",
          "snippet": "static void __list_remove_profile(struct aa_profile *profile)\n{\n\tAA_BUG(!profile);\n\tAA_BUG(!profile->ns);\n\tAA_BUG(!mutex_is_locked(&profile->ns->lock));\n\n\tlist_del_rcu(&profile->base.list);\n\taa_put_profile(profile);\n}",
          "includes": [
            "#include \"include/resource.h\"",
            "#include \"include/policy_unpack.h\"",
            "#include \"include/policy_ns.h\"",
            "#include \"include/policy.h\"",
            "#include \"include/path.h\"",
            "#include \"include/match.h\"",
            "#include \"include/ipc.h\"",
            "#include \"include/file.h\"",
            "#include \"include/context.h\"",
            "#include \"include/capability.h\"",
            "#include \"include/apparmor.h\"",
            "#include <linux/user_namespace.h>",
            "#include <linux/rculist.h>",
            "#include <linux/cred.h>",
            "#include <linux/string.h>",
            "#include <linux/spinlock.h>",
            "#include <linux/slab.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"include/resource.h\"\n#include \"include/policy_unpack.h\"\n#include \"include/policy_ns.h\"\n#include \"include/policy.h\"\n#include \"include/path.h\"\n#include \"include/match.h\"\n#include \"include/ipc.h\"\n#include \"include/file.h\"\n#include \"include/context.h\"\n#include \"include/capability.h\"\n#include \"include/apparmor.h\"\n#include <linux/user_namespace.h>\n#include <linux/rculist.h>\n#include <linux/cred.h>\n#include <linux/string.h>\n#include <linux/spinlock.h>\n#include <linux/slab.h>\n\nstatic void __list_remove_profile(struct aa_profile *profile)\n{\n\tAA_BUG(!profile);\n\tAA_BUG(!profile->ns);\n\tAA_BUG(!mutex_is_locked(&profile->ns->lock));\n\n\tlist_del_rcu(&profile->base.list);\n\taa_put_profile(profile);\n}"
        }
      },
      {
        "call_info": {
          "callee": "__aafs_profile_rmdir",
          "args": [
            "profile"
          ],
          "line": 169
        },
        "resolved": true,
        "details": {
          "function_name": "__aafs_profile_rmdir",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/apparmorfs.c",
          "lines": "1417-1438",
          "snippet": "void __aafs_profile_rmdir(struct aa_profile *profile)\n{\n\tstruct aa_profile *child;\n\tint i;\n\n\tif (!profile)\n\t\treturn;\n\n\tlist_for_each_entry(child, &profile->base.profiles, base.list)\n\t\t__aafs_profile_rmdir(child);\n\n\tfor (i = AAFS_PROF_SIZEOF - 1; i >= 0; --i) {\n\t\tstruct aa_proxy *proxy;\n\t\tif (!profile->dents[i])\n\t\t\tcontinue;\n\n\t\tproxy = d_inode(profile->dents[i])->i_private;\n\t\taafs_remove(profile->dents[i]);\n\t\taa_put_proxy(proxy);\n\t\tprofile->dents[i] = NULL;\n\t}\n}",
          "includes": [
            "#include \"include/policy_unpack.h\"",
            "#include \"include/resource.h\"",
            "#include \"include/policy_ns.h\"",
            "#include \"include/policy.h\"",
            "#include \"include/label.h\"",
            "#include \"include/policy_ns.h\"",
            "#include \"include/ipc.h\"",
            "#include \"include/crypto.h\"",
            "#include \"include/context.h\"",
            "#include \"include/audit.h\"",
            "#include \"include/apparmorfs.h\"",
            "#include \"include/apparmor.h\"",
            "#include <uapi/linux/magic.h>",
            "#include <uapi/linux/major.h>",
            "#include <linux/poll.h>",
            "#include <linux/fs.h>",
            "#include <linux/rcupdate.h>",
            "#include <linux/capability.h>",
            "#include <linux/namei.h>",
            "#include <linux/mount.h>",
            "#include <linux/uaccess.h>",
            "#include <linux/seq_file.h>",
            "#include <linux/module.h>",
            "#include <linux/vmalloc.h>",
            "#include <linux/security.h>",
            "#include <linux/ctype.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"include/policy_unpack.h\"\n#include \"include/resource.h\"\n#include \"include/policy_ns.h\"\n#include \"include/policy.h\"\n#include \"include/label.h\"\n#include \"include/policy_ns.h\"\n#include \"include/ipc.h\"\n#include \"include/crypto.h\"\n#include \"include/context.h\"\n#include \"include/audit.h\"\n#include \"include/apparmorfs.h\"\n#include \"include/apparmor.h\"\n#include <uapi/linux/magic.h>\n#include <uapi/linux/major.h>\n#include <linux/poll.h>\n#include <linux/fs.h>\n#include <linux/rcupdate.h>\n#include <linux/capability.h>\n#include <linux/namei.h>\n#include <linux/mount.h>\n#include <linux/uaccess.h>\n#include <linux/seq_file.h>\n#include <linux/module.h>\n#include <linux/vmalloc.h>\n#include <linux/security.h>\n#include <linux/ctype.h>\n\nvoid __aafs_profile_rmdir(struct aa_profile *profile)\n{\n\tstruct aa_profile *child;\n\tint i;\n\n\tif (!profile)\n\t\treturn;\n\n\tlist_for_each_entry(child, &profile->base.profiles, base.list)\n\t\t__aafs_profile_rmdir(child);\n\n\tfor (i = AAFS_PROF_SIZEOF - 1; i >= 0; --i) {\n\t\tstruct aa_proxy *proxy;\n\t\tif (!profile->dents[i])\n\t\t\tcontinue;\n\n\t\tproxy = d_inode(profile->dents[i])->i_private;\n\t\taafs_remove(profile->dents[i]);\n\t\taa_put_proxy(proxy);\n\t\tprofile->dents[i] = NULL;\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "aa_label_remove",
          "args": [
            "&profile->label"
          ],
          "line": 168
        },
        "resolved": true,
        "details": {
          "function_name": "aa_label_remove",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/label.c",
          "lines": "747-760",
          "snippet": "bool aa_label_remove(struct aa_label *label)\n{\n\tstruct aa_labelset *ls = labels_set(label);\n\tunsigned long flags;\n\tbool res;\n\n\tAA_BUG(!ls);\n\n\twrite_lock_irqsave(&ls->lock, flags);\n\tres = __label_remove(label, ns_unconfined(labels_ns(label)));\n\twrite_unlock_irqrestore(&ls->lock, flags);\n\n\treturn res;\n}",
          "includes": [
            "#include \"include/secid.h\"",
            "#include \"include/policy.h\"",
            "#include \"include/label.h\"",
            "#include \"include/context.h\"",
            "#include \"include/apparmor.h\"",
            "#include <linux/sort.h>",
            "#include <linux/seq_file.h>",
            "#include <linux/audit.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"include/secid.h\"\n#include \"include/policy.h\"\n#include \"include/label.h\"\n#include \"include/context.h\"\n#include \"include/apparmor.h\"\n#include <linux/sort.h>\n#include <linux/seq_file.h>\n#include <linux/audit.h>\n\nbool aa_label_remove(struct aa_label *label)\n{\n\tstruct aa_labelset *ls = labels_set(label);\n\tunsigned long flags;\n\tbool res;\n\n\tAA_BUG(!ls);\n\n\twrite_lock_irqsave(&ls->lock, flags);\n\tres = __label_remove(label, ns_unconfined(labels_ns(label)));\n\twrite_unlock_irqrestore(&ls->lock, flags);\n\n\treturn res;\n}"
        }
      },
      {
        "call_info": {
          "callee": "__aa_profile_list_release",
          "args": [
            "&profile->base.profiles"
          ],
          "line": 166
        },
        "resolved": true,
        "details": {
          "function_name": "__aa_profile_list_release",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/policy.c",
          "lines": "179-184",
          "snippet": "void __aa_profile_list_release(struct list_head *head)\n{\n\tstruct aa_profile *profile, *tmp;\n\tlist_for_each_entry_safe(profile, tmp, head, base.list)\n\t\t__remove_profile(profile);\n}",
          "includes": [
            "#include \"include/resource.h\"",
            "#include \"include/policy_unpack.h\"",
            "#include \"include/policy_ns.h\"",
            "#include \"include/policy.h\"",
            "#include \"include/path.h\"",
            "#include \"include/match.h\"",
            "#include \"include/ipc.h\"",
            "#include \"include/file.h\"",
            "#include \"include/context.h\"",
            "#include \"include/capability.h\"",
            "#include \"include/apparmor.h\"",
            "#include <linux/user_namespace.h>",
            "#include <linux/rculist.h>",
            "#include <linux/cred.h>",
            "#include <linux/string.h>",
            "#include <linux/spinlock.h>",
            "#include <linux/slab.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"include/resource.h\"\n#include \"include/policy_unpack.h\"\n#include \"include/policy_ns.h\"\n#include \"include/policy.h\"\n#include \"include/path.h\"\n#include \"include/match.h\"\n#include \"include/ipc.h\"\n#include \"include/file.h\"\n#include \"include/context.h\"\n#include \"include/capability.h\"\n#include \"include/apparmor.h\"\n#include <linux/user_namespace.h>\n#include <linux/rculist.h>\n#include <linux/cred.h>\n#include <linux/string.h>\n#include <linux/spinlock.h>\n#include <linux/slab.h>\n\nvoid __aa_profile_list_release(struct list_head *head)\n{\n\tstruct aa_profile *profile, *tmp;\n\tlist_for_each_entry_safe(profile, tmp, head, base.list)\n\t\t__remove_profile(profile);\n}"
        }
      },
      {
        "call_info": {
          "callee": "AA_BUG",
          "args": [
            "!mutex_is_locked(&profile->ns->lock)"
          ],
          "line": 163
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "mutex_is_locked",
          "args": [
            "&profile->ns->lock"
          ],
          "line": 163
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "AA_BUG",
          "args": [
            "!profile->ns"
          ],
          "line": 162
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "AA_BUG",
          "args": [
            "!profile"
          ],
          "line": 161
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"include/resource.h\"\n#include \"include/policy_unpack.h\"\n#include \"include/policy_ns.h\"\n#include \"include/policy.h\"\n#include \"include/path.h\"\n#include \"include/match.h\"\n#include \"include/ipc.h\"\n#include \"include/file.h\"\n#include \"include/context.h\"\n#include \"include/capability.h\"\n#include \"include/apparmor.h\"\n#include <linux/user_namespace.h>\n#include <linux/rculist.h>\n#include <linux/cred.h>\n#include <linux/string.h>\n#include <linux/spinlock.h>\n#include <linux/slab.h>\n\nstatic void __remove_profile(struct aa_profile *profile)\n{\n\tAA_BUG(!profile);\n\tAA_BUG(!profile->ns);\n\tAA_BUG(!mutex_is_locked(&profile->ns->lock));\n\n\t/* release any children lists first */\n\t__aa_profile_list_release(&profile->base.profiles);\n\t/* released by free_profile */\n\taa_label_remove(&profile->label);\n\t__aafs_profile_rmdir(profile);\n\t__list_remove_profile(profile);\n}"
  },
  {
    "function_name": "__list_remove_profile",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/policy.c",
    "lines": "143-151",
    "snippet": "static void __list_remove_profile(struct aa_profile *profile)\n{\n\tAA_BUG(!profile);\n\tAA_BUG(!profile->ns);\n\tAA_BUG(!mutex_is_locked(&profile->ns->lock));\n\n\tlist_del_rcu(&profile->base.list);\n\taa_put_profile(profile);\n}",
    "includes": [
      "#include \"include/resource.h\"",
      "#include \"include/policy_unpack.h\"",
      "#include \"include/policy_ns.h\"",
      "#include \"include/policy.h\"",
      "#include \"include/path.h\"",
      "#include \"include/match.h\"",
      "#include \"include/ipc.h\"",
      "#include \"include/file.h\"",
      "#include \"include/context.h\"",
      "#include \"include/capability.h\"",
      "#include \"include/apparmor.h\"",
      "#include <linux/user_namespace.h>",
      "#include <linux/rculist.h>",
      "#include <linux/cred.h>",
      "#include <linux/string.h>",
      "#include <linux/spinlock.h>",
      "#include <linux/slab.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "aa_put_profile",
          "args": [
            "profile"
          ],
          "line": 150
        },
        "resolved": true,
        "details": {
          "function_name": "aa_put_profile",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/include/policy.h",
          "lines": "277-281",
          "snippet": "static inline void aa_put_profile(struct aa_profile *p)\n{\n\tif (p)\n\t\tkref_put(&p->label.count, aa_label_kref);\n}",
          "includes": [
            "#include \"resource.h\"",
            "#include \"perms.h\"",
            "#include \"label.h\"",
            "#include \"lib.h\"",
            "#include \"file.h\"",
            "#include \"domain.h\"",
            "#include \"capability.h\"",
            "#include \"audit.h\"",
            "#include \"apparmor.h\"",
            "#include <linux/socket.h>",
            "#include <linux/slab.h>",
            "#include <linux/sched.h>",
            "#include <linux/rhashtable.h>",
            "#include <linux/kref.h>",
            "#include <linux/cred.h>",
            "#include <linux/capability.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"resource.h\"\n#include \"perms.h\"\n#include \"label.h\"\n#include \"lib.h\"\n#include \"file.h\"\n#include \"domain.h\"\n#include \"capability.h\"\n#include \"audit.h\"\n#include \"apparmor.h\"\n#include <linux/socket.h>\n#include <linux/slab.h>\n#include <linux/sched.h>\n#include <linux/rhashtable.h>\n#include <linux/kref.h>\n#include <linux/cred.h>\n#include <linux/capability.h>\n\nstatic inline void aa_put_profile(struct aa_profile *p)\n{\n\tif (p)\n\t\tkref_put(&p->label.count, aa_label_kref);\n}"
        }
      },
      {
        "call_info": {
          "callee": "list_del_rcu",
          "args": [
            "&profile->base.list"
          ],
          "line": 149
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "AA_BUG",
          "args": [
            "!mutex_is_locked(&profile->ns->lock)"
          ],
          "line": 147
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "mutex_is_locked",
          "args": [
            "&profile->ns->lock"
          ],
          "line": 147
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "AA_BUG",
          "args": [
            "!profile->ns"
          ],
          "line": 146
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "AA_BUG",
          "args": [
            "!profile"
          ],
          "line": 145
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"include/resource.h\"\n#include \"include/policy_unpack.h\"\n#include \"include/policy_ns.h\"\n#include \"include/policy.h\"\n#include \"include/path.h\"\n#include \"include/match.h\"\n#include \"include/ipc.h\"\n#include \"include/file.h\"\n#include \"include/context.h\"\n#include \"include/capability.h\"\n#include \"include/apparmor.h\"\n#include <linux/user_namespace.h>\n#include <linux/rculist.h>\n#include <linux/cred.h>\n#include <linux/string.h>\n#include <linux/spinlock.h>\n#include <linux/slab.h>\n\nstatic void __list_remove_profile(struct aa_profile *profile)\n{\n\tAA_BUG(!profile);\n\tAA_BUG(!profile->ns);\n\tAA_BUG(!mutex_is_locked(&profile->ns->lock));\n\n\tlist_del_rcu(&profile->base.list);\n\taa_put_profile(profile);\n}"
  },
  {
    "function_name": "__add_profile",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/policy.c",
    "lines": "114-129",
    "snippet": "static void __add_profile(struct list_head *list, struct aa_profile *profile)\n{\n\tstruct aa_label *l;\n\n\tAA_BUG(!list);\n\tAA_BUG(!profile);\n\tAA_BUG(!profile->ns);\n\tAA_BUG(!mutex_is_locked(&profile->ns->lock));\n\n\tlist_add_rcu(&profile->base.list, list);\n\t/* get list reference */\n\taa_get_profile(profile);\n\tl = aa_label_insert(&profile->ns->labels, &profile->label);\n\tAA_BUG(l != &profile->label);\n\taa_put_label(l);\n}",
    "includes": [
      "#include \"include/resource.h\"",
      "#include \"include/policy_unpack.h\"",
      "#include \"include/policy_ns.h\"",
      "#include \"include/policy.h\"",
      "#include \"include/path.h\"",
      "#include \"include/match.h\"",
      "#include \"include/ipc.h\"",
      "#include \"include/file.h\"",
      "#include \"include/context.h\"",
      "#include \"include/capability.h\"",
      "#include \"include/apparmor.h\"",
      "#include <linux/user_namespace.h>",
      "#include <linux/rculist.h>",
      "#include <linux/cred.h>",
      "#include <linux/string.h>",
      "#include <linux/spinlock.h>",
      "#include <linux/slab.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "aa_put_label",
          "args": [
            "l"
          ],
          "line": 128
        },
        "resolved": true,
        "details": {
          "function_name": "aa_put_label",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/include/label.h",
          "lines": "416-420",
          "snippet": "static inline void aa_put_label(struct aa_label *l)\n{\n\tif (l)\n\t\tkref_put(&l->count, aa_label_kref);\n}",
          "includes": [
            "#include \"lib.h\"",
            "#include \"apparmor.h\"",
            "#include <linux/rcupdate.h>",
            "#include <linux/rbtree.h>",
            "#include <linux/audit.h>",
            "#include <linux/atomic.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"lib.h\"\n#include \"apparmor.h\"\n#include <linux/rcupdate.h>\n#include <linux/rbtree.h>\n#include <linux/audit.h>\n#include <linux/atomic.h>\n\nstatic inline void aa_put_label(struct aa_label *l)\n{\n\tif (l)\n\t\tkref_put(&l->count, aa_label_kref);\n}"
        }
      },
      {
        "call_info": {
          "callee": "AA_BUG",
          "args": [
            "l != &profile->label"
          ],
          "line": 127
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "aa_label_insert",
          "args": [
            "&profile->ns->labels",
            "&profile->label"
          ],
          "line": 126
        },
        "resolved": true,
        "details": {
          "function_name": "aa_label_insert",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/label.c",
          "lines": "903-925",
          "snippet": "struct aa_label *aa_label_insert(struct aa_labelset *ls, struct aa_label *label)\n{\n\tstruct aa_label *l;\n\tunsigned long flags;\n\n\tAA_BUG(!ls);\n\tAA_BUG(!label);\n\n\t/* check if label exists before taking lock */\n\tif (!label_is_stale(label)) {\n\t\tread_lock_irqsave(&ls->lock, flags);\n\t\tl = __label_find(label);\n\t\tread_unlock_irqrestore(&ls->lock, flags);\n\t\tif (l)\n\t\t\treturn l;\n\t}\n\n\twrite_lock_irqsave(&ls->lock, flags);\n\tl = __label_insert(ls, label, false);\n\twrite_unlock_irqrestore(&ls->lock, flags);\n\n\treturn l;\n}",
          "includes": [
            "#include \"include/secid.h\"",
            "#include \"include/policy.h\"",
            "#include \"include/label.h\"",
            "#include \"include/context.h\"",
            "#include \"include/apparmor.h\"",
            "#include <linux/sort.h>",
            "#include <linux/seq_file.h>",
            "#include <linux/audit.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"include/secid.h\"\n#include \"include/policy.h\"\n#include \"include/label.h\"\n#include \"include/context.h\"\n#include \"include/apparmor.h\"\n#include <linux/sort.h>\n#include <linux/seq_file.h>\n#include <linux/audit.h>\n\nstruct aa_label *aa_label_insert(struct aa_labelset *ls, struct aa_label *label)\n{\n\tstruct aa_label *l;\n\tunsigned long flags;\n\n\tAA_BUG(!ls);\n\tAA_BUG(!label);\n\n\t/* check if label exists before taking lock */\n\tif (!label_is_stale(label)) {\n\t\tread_lock_irqsave(&ls->lock, flags);\n\t\tl = __label_find(label);\n\t\tread_unlock_irqrestore(&ls->lock, flags);\n\t\tif (l)\n\t\t\treturn l;\n\t}\n\n\twrite_lock_irqsave(&ls->lock, flags);\n\tl = __label_insert(ls, label, false);\n\twrite_unlock_irqrestore(&ls->lock, flags);\n\n\treturn l;\n}"
        }
      },
      {
        "call_info": {
          "callee": "aa_get_profile",
          "args": [
            "profile"
          ],
          "line": 125
        },
        "resolved": true,
        "details": {
          "function_name": "aa_get_profile_rcu",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/include/policy.h",
          "lines": "260-271",
          "snippet": "static inline struct aa_profile *aa_get_profile_rcu(struct aa_profile __rcu **p)\n{\n\tstruct aa_profile *c;\n\n\trcu_read_lock();\n\tdo {\n\t\tc = rcu_dereference(*p);\n\t} while (c && !kref_get_unless_zero(&c->label.count));\n\trcu_read_unlock();\n\n\treturn c;\n}",
          "includes": [
            "#include \"resource.h\"",
            "#include \"perms.h\"",
            "#include \"label.h\"",
            "#include \"lib.h\"",
            "#include \"file.h\"",
            "#include \"domain.h\"",
            "#include \"capability.h\"",
            "#include \"audit.h\"",
            "#include \"apparmor.h\"",
            "#include <linux/socket.h>",
            "#include <linux/slab.h>",
            "#include <linux/sched.h>",
            "#include <linux/rhashtable.h>",
            "#include <linux/kref.h>",
            "#include <linux/cred.h>",
            "#include <linux/capability.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"resource.h\"\n#include \"perms.h\"\n#include \"label.h\"\n#include \"lib.h\"\n#include \"file.h\"\n#include \"domain.h\"\n#include \"capability.h\"\n#include \"audit.h\"\n#include \"apparmor.h\"\n#include <linux/socket.h>\n#include <linux/slab.h>\n#include <linux/sched.h>\n#include <linux/rhashtable.h>\n#include <linux/kref.h>\n#include <linux/cred.h>\n#include <linux/capability.h>\n\nstatic inline struct aa_profile *aa_get_profile_rcu(struct aa_profile __rcu **p)\n{\n\tstruct aa_profile *c;\n\n\trcu_read_lock();\n\tdo {\n\t\tc = rcu_dereference(*p);\n\t} while (c && !kref_get_unless_zero(&c->label.count));\n\trcu_read_unlock();\n\n\treturn c;\n}"
        }
      },
      {
        "call_info": {
          "callee": "list_add_rcu",
          "args": [
            "&profile->base.list",
            "list"
          ],
          "line": 123
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "AA_BUG",
          "args": [
            "!mutex_is_locked(&profile->ns->lock)"
          ],
          "line": 121
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "mutex_is_locked",
          "args": [
            "&profile->ns->lock"
          ],
          "line": 121
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "AA_BUG",
          "args": [
            "!profile->ns"
          ],
          "line": 120
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "AA_BUG",
          "args": [
            "!profile"
          ],
          "line": 119
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "AA_BUG",
          "args": [
            "!list"
          ],
          "line": 118
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"include/resource.h\"\n#include \"include/policy_unpack.h\"\n#include \"include/policy_ns.h\"\n#include \"include/policy.h\"\n#include \"include/path.h\"\n#include \"include/match.h\"\n#include \"include/ipc.h\"\n#include \"include/file.h\"\n#include \"include/context.h\"\n#include \"include/capability.h\"\n#include \"include/apparmor.h\"\n#include <linux/user_namespace.h>\n#include <linux/rculist.h>\n#include <linux/cred.h>\n#include <linux/string.h>\n#include <linux/spinlock.h>\n#include <linux/slab.h>\n\nstatic void __add_profile(struct list_head *list, struct aa_profile *profile)\n{\n\tstruct aa_label *l;\n\n\tAA_BUG(!list);\n\tAA_BUG(!profile);\n\tAA_BUG(!profile->ns);\n\tAA_BUG(!mutex_is_locked(&profile->ns->lock));\n\n\tlist_add_rcu(&profile->base.list, list);\n\t/* get list reference */\n\taa_get_profile(profile);\n\tl = aa_label_insert(&profile->ns->labels, &profile->label);\n\tAA_BUG(l != &profile->label);\n\taa_put_label(l);\n}"
  }
]