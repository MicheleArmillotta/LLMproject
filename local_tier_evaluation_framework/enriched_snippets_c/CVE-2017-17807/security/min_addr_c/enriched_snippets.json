[
  {
    "function_name": "init_mmap_min_addr",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/min_addr.c",
    "lines": "47-52",
    "snippet": "static int __init init_mmap_min_addr(void)\n{\n\tupdate_mmap_min_addr();\n\n\treturn 0;\n}",
    "includes": [
      "#include <linux/sysctl.h>",
      "#include <linux/security.h>",
      "#include <linux/mm.h>",
      "#include <linux/init.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "update_mmap_min_addr",
          "args": [],
          "line": 49
        },
        "resolved": true,
        "details": {
          "function_name": "update_mmap_min_addr",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/min_addr.c",
          "lines": "16-26",
          "snippet": "static void update_mmap_min_addr(void)\n{\n#ifdef CONFIG_LSM_MMAP_MIN_ADDR\n\tif (dac_mmap_min_addr > CONFIG_LSM_MMAP_MIN_ADDR)\n\t\tmmap_min_addr = dac_mmap_min_addr;\n\telse\n\t\tmmap_min_addr = CONFIG_LSM_MMAP_MIN_ADDR;\n#else\n\tmmap_min_addr = dac_mmap_min_addr;\n#endif\n}",
          "includes": [
            "#include <linux/sysctl.h>",
            "#include <linux/security.h>",
            "#include <linux/mm.h>",
            "#include <linux/init.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "unsigned long mmap_min_addr;",
            "unsigned long dac_mmap_min_addr = CONFIG_DEFAULT_MMAP_MIN_ADDR;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <linux/sysctl.h>\n#include <linux/security.h>\n#include <linux/mm.h>\n#include <linux/init.h>\n\nunsigned long mmap_min_addr;\nunsigned long dac_mmap_min_addr = CONFIG_DEFAULT_MMAP_MIN_ADDR;\n\nstatic void update_mmap_min_addr(void)\n{\n#ifdef CONFIG_LSM_MMAP_MIN_ADDR\n\tif (dac_mmap_min_addr > CONFIG_LSM_MMAP_MIN_ADDR)\n\t\tmmap_min_addr = dac_mmap_min_addr;\n\telse\n\t\tmmap_min_addr = CONFIG_LSM_MMAP_MIN_ADDR;\n#else\n\tmmap_min_addr = dac_mmap_min_addr;\n#endif\n}"
        }
      }
    ],
    "contextual_snippet": "#include <linux/sysctl.h>\n#include <linux/security.h>\n#include <linux/mm.h>\n#include <linux/init.h>\n\nstatic int __init init_mmap_min_addr(void)\n{\n\tupdate_mmap_min_addr();\n\n\treturn 0;\n}"
  },
  {
    "function_name": "mmap_min_addr_handler",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/min_addr.c",
    "lines": "32-45",
    "snippet": "int mmap_min_addr_handler(struct ctl_table *table, int write,\n\t\t\t  void __user *buffer, size_t *lenp, loff_t *ppos)\n{\n\tint ret;\n\n\tif (write && !capable(CAP_SYS_RAWIO))\n\t\treturn -EPERM;\n\n\tret = proc_doulongvec_minmax(table, write, buffer, lenp, ppos);\n\n\tupdate_mmap_min_addr();\n\n\treturn ret;\n}",
    "includes": [
      "#include <linux/sysctl.h>",
      "#include <linux/security.h>",
      "#include <linux/mm.h>",
      "#include <linux/init.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "update_mmap_min_addr",
          "args": [],
          "line": 42
        },
        "resolved": true,
        "details": {
          "function_name": "update_mmap_min_addr",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/min_addr.c",
          "lines": "16-26",
          "snippet": "static void update_mmap_min_addr(void)\n{\n#ifdef CONFIG_LSM_MMAP_MIN_ADDR\n\tif (dac_mmap_min_addr > CONFIG_LSM_MMAP_MIN_ADDR)\n\t\tmmap_min_addr = dac_mmap_min_addr;\n\telse\n\t\tmmap_min_addr = CONFIG_LSM_MMAP_MIN_ADDR;\n#else\n\tmmap_min_addr = dac_mmap_min_addr;\n#endif\n}",
          "includes": [
            "#include <linux/sysctl.h>",
            "#include <linux/security.h>",
            "#include <linux/mm.h>",
            "#include <linux/init.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "unsigned long mmap_min_addr;",
            "unsigned long dac_mmap_min_addr = CONFIG_DEFAULT_MMAP_MIN_ADDR;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <linux/sysctl.h>\n#include <linux/security.h>\n#include <linux/mm.h>\n#include <linux/init.h>\n\nunsigned long mmap_min_addr;\nunsigned long dac_mmap_min_addr = CONFIG_DEFAULT_MMAP_MIN_ADDR;\n\nstatic void update_mmap_min_addr(void)\n{\n#ifdef CONFIG_LSM_MMAP_MIN_ADDR\n\tif (dac_mmap_min_addr > CONFIG_LSM_MMAP_MIN_ADDR)\n\t\tmmap_min_addr = dac_mmap_min_addr;\n\telse\n\t\tmmap_min_addr = CONFIG_LSM_MMAP_MIN_ADDR;\n#else\n\tmmap_min_addr = dac_mmap_min_addr;\n#endif\n}"
        }
      },
      {
        "call_info": {
          "callee": "proc_doulongvec_minmax",
          "args": [
            "table",
            "write",
            "buffer",
            "lenp",
            "ppos"
          ],
          "line": 40
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "capable",
          "args": [
            "CAP_SYS_RAWIO"
          ],
          "line": 37
        },
        "resolved": true,
        "details": {
          "function_name": "policy_admin_capable",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/apparmor/policy.c",
          "lines": "660-669",
          "snippet": "bool policy_admin_capable(struct aa_ns *ns)\n{\n\tstruct user_namespace *user_ns = current_user_ns();\n\tbool capable = ns_capable(user_ns, CAP_MAC_ADMIN);\n\n\tAA_DEBUG(\"cap_mac_admin? %d\\n\", capable);\n\tAA_DEBUG(\"policy locked? %d\\n\", aa_g_lock_policy);\n\n\treturn policy_view_capable(ns) && capable && !aa_g_lock_policy;\n}",
          "includes": [
            "#include \"include/resource.h\"",
            "#include \"include/policy_unpack.h\"",
            "#include \"include/policy_ns.h\"",
            "#include \"include/policy.h\"",
            "#include \"include/path.h\"",
            "#include \"include/match.h\"",
            "#include \"include/ipc.h\"",
            "#include \"include/file.h\"",
            "#include \"include/context.h\"",
            "#include \"include/capability.h\"",
            "#include \"include/apparmor.h\"",
            "#include <linux/user_namespace.h>",
            "#include <linux/rculist.h>",
            "#include <linux/cred.h>",
            "#include <linux/string.h>",
            "#include <linux/spinlock.h>",
            "#include <linux/slab.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"include/resource.h\"\n#include \"include/policy_unpack.h\"\n#include \"include/policy_ns.h\"\n#include \"include/policy.h\"\n#include \"include/path.h\"\n#include \"include/match.h\"\n#include \"include/ipc.h\"\n#include \"include/file.h\"\n#include \"include/context.h\"\n#include \"include/capability.h\"\n#include \"include/apparmor.h\"\n#include <linux/user_namespace.h>\n#include <linux/rculist.h>\n#include <linux/cred.h>\n#include <linux/string.h>\n#include <linux/spinlock.h>\n#include <linux/slab.h>\n\nbool policy_admin_capable(struct aa_ns *ns)\n{\n\tstruct user_namespace *user_ns = current_user_ns();\n\tbool capable = ns_capable(user_ns, CAP_MAC_ADMIN);\n\n\tAA_DEBUG(\"cap_mac_admin? %d\\n\", capable);\n\tAA_DEBUG(\"policy locked? %d\\n\", aa_g_lock_policy);\n\n\treturn policy_view_capable(ns) && capable && !aa_g_lock_policy;\n}"
        }
      }
    ],
    "contextual_snippet": "#include <linux/sysctl.h>\n#include <linux/security.h>\n#include <linux/mm.h>\n#include <linux/init.h>\n\nint mmap_min_addr_handler(struct ctl_table *table, int write,\n\t\t\t  void __user *buffer, size_t *lenp, loff_t *ppos)\n{\n\tint ret;\n\n\tif (write && !capable(CAP_SYS_RAWIO))\n\t\treturn -EPERM;\n\n\tret = proc_doulongvec_minmax(table, write, buffer, lenp, ppos);\n\n\tupdate_mmap_min_addr();\n\n\treturn ret;\n}"
  },
  {
    "function_name": "update_mmap_min_addr",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-17807/repo/security/min_addr.c",
    "lines": "16-26",
    "snippet": "static void update_mmap_min_addr(void)\n{\n#ifdef CONFIG_LSM_MMAP_MIN_ADDR\n\tif (dac_mmap_min_addr > CONFIG_LSM_MMAP_MIN_ADDR)\n\t\tmmap_min_addr = dac_mmap_min_addr;\n\telse\n\t\tmmap_min_addr = CONFIG_LSM_MMAP_MIN_ADDR;\n#else\n\tmmap_min_addr = dac_mmap_min_addr;\n#endif\n}",
    "includes": [
      "#include <linux/sysctl.h>",
      "#include <linux/security.h>",
      "#include <linux/mm.h>",
      "#include <linux/init.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "unsigned long mmap_min_addr;",
      "unsigned long dac_mmap_min_addr = CONFIG_DEFAULT_MMAP_MIN_ADDR;"
    ],
    "called_functions": [],
    "contextual_snippet": "#include <linux/sysctl.h>\n#include <linux/security.h>\n#include <linux/mm.h>\n#include <linux/init.h>\n\nunsigned long mmap_min_addr;\nunsigned long dac_mmap_min_addr = CONFIG_DEFAULT_MMAP_MIN_ADDR;\n\nstatic void update_mmap_min_addr(void)\n{\n#ifdef CONFIG_LSM_MMAP_MIN_ADDR\n\tif (dac_mmap_min_addr > CONFIG_LSM_MMAP_MIN_ADDR)\n\t\tmmap_min_addr = dac_mmap_min_addr;\n\telse\n\t\tmmap_min_addr = CONFIG_LSM_MMAP_MIN_ADDR;\n#else\n\tmmap_min_addr = dac_mmap_min_addr;\n#endif\n}"
  }
]