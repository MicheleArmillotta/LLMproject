[
  {
    "function_name": "unsetenv",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/openbsd-compat/setenv.c",
    "lines": "197-222",
    "snippet": "int\nunsetenv(const char *name)\n{\n\tchar **P;\n\tconst char *np;\n\tint offset = 0;\n\n\tif (!name || !*name) {\n\t\terrno = EINVAL;\n\t\treturn (-1);\n\t}\n\tfor (np = name; *np && *np != '='; ++np)\n\t\t;\n\tif (*np) {\n\t\terrno = EINVAL;\n\t\treturn (-1);\t\t\t/* has `=' in name */\n\t}\n\n\t/* could be set multiple times */\n\twhile (__findenv(name, (int)(np - name), &offset)) {\n\t\tfor (P = &environ[offset];; ++P)\n\t\t\tif (!(*P = *(P + 1)))\n\t\t\t\tbreak;\n\t}\n\treturn (0);\n}",
    "includes": [
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <errno.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "__findenv",
          "args": [
            "name",
            "(int)(np - name)",
            "&offset"
          ],
          "line": 216
        },
        "resolved": true,
        "details": {
          "function_name": "__findenv",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/openbsd-compat/setenv.c",
          "lines": "55-75",
          "snippet": "static char *\n__findenv(const char *name, int len, int *offset)\n{\n\textern char **environ;\n\tint i;\n\tconst char *np;\n\tchar **p, *cp;\n\n\tif (name == NULL || environ == NULL)\n\t\treturn (NULL);\n\tfor (p = environ + *offset; (cp = *p) != NULL; ++p) {\n\t\tfor (np = name, i = len; i && *cp; i--)\n\t\t\tif (*cp++ != *np++)\n\t\t\t\tbreak;\n\t\tif (i == 0 && *cp++ == '=') {\n\t\t\t*offset = p - environ;\n\t\t\treturn (cp);\n\t\t}\n\t}\n\treturn (NULL);\n}",
          "includes": [
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <stdlib.h>\n#include <errno.h>\n#include \"includes.h\"\n\nstatic char *\n__findenv(const char *name, int len, int *offset)\n{\n\textern char **environ;\n\tint i;\n\tconst char *np;\n\tchar **p, *cp;\n\n\tif (name == NULL || environ == NULL)\n\t\treturn (NULL);\n\tfor (p = environ + *offset; (cp = *p) != NULL; ++p) {\n\t\tfor (np = name, i = len; i && *cp; i--)\n\t\t\tif (*cp++ != *np++)\n\t\t\t\tbreak;\n\t\tif (i == 0 && *cp++ == '=') {\n\t\t\t*offset = p - environ;\n\t\t\treturn (cp);\n\t\t}\n\t}\n\treturn (NULL);\n}"
        }
      }
    ],
    "contextual_snippet": "#include <string.h>\n#include <stdlib.h>\n#include <errno.h>\n#include \"includes.h\"\n\nint\nunsetenv(const char *name)\n{\n\tchar **P;\n\tconst char *np;\n\tint offset = 0;\n\n\tif (!name || !*name) {\n\t\terrno = EINVAL;\n\t\treturn (-1);\n\t}\n\tfor (np = name; *np && *np != '='; ++np)\n\t\t;\n\tif (*np) {\n\t\terrno = EINVAL;\n\t\treturn (-1);\t\t\t/* has `=' in name */\n\t}\n\n\t/* could be set multiple times */\n\twhile (__findenv(name, (int)(np - name), &offset)) {\n\t\tfor (P = &environ[offset];; ++P)\n\t\t\tif (!(*P = *(P + 1)))\n\t\t\t\tbreak;\n\t}\n\treturn (0);\n}"
  },
  {
    "function_name": "setenv",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/openbsd-compat/setenv.c",
    "lines": "131-188",
    "snippet": "int\nsetenv(const char *name, const char *value, int rewrite)\n{\n\tchar *C, **P;\n\tconst char *np;\n\tint l_value, offset = 0;\n\n\tfor (np = name; *np && *np != '='; ++np)\n\t\t;\n#ifdef notyet\n\tif (*np) {\n\t\terrno = EINVAL;\n\t\treturn (-1);\t\t\t/* has `=' in name */\n\t}\n#endif\n\n\tl_value = strlen(value);\n\tif ((C = __findenv(name, (int)(np - name), &offset)) != NULL) {\n\t\tint tmpoff = offset + 1;\n\t\tif (!rewrite)\n\t\t\treturn (0);\n#if 0 /* XXX - existing entry may not be writable */\n\t\tif (strlen(C) >= l_value) {\t/* old larger; copy over */\n\t\t\twhile ((*C++ = *value++))\n\t\t\t\t;\n\t\t\treturn (0);\n\t\t}\n#endif\n\t\t/* could be set multiple times */\n\t\twhile (__findenv(name, (int)(np - name), &tmpoff)) {\n\t\t\tfor (P = &environ[tmpoff];; ++P)\n\t\t\t\tif (!(*P = *(P + 1)))\n\t\t\t\t\tbreak;\n\t\t}\n\t} else {\t\t\t\t\t/* create new slot */\n\t\tsize_t cnt;\n\n\t\tfor (P = environ; *P != NULL; P++)\n\t\t\t;\n\t\tcnt = P - environ;\n\t\tP = (char **)realloc(lastenv, sizeof(char *) * (cnt + 2));\n\t\tif (!P)\n\t\t\treturn (-1);\n\t\tif (lastenv != environ)\n\t\t\tmemcpy(P, environ, cnt * sizeof(char *));\n\t\tlastenv = environ = P;\n\t\toffset = cnt;\n\t\tenviron[cnt + 1] = NULL;\n\t}\n\tif (!(environ[offset] =\t\t\t/* name + `=' + value */\n\t    malloc((size_t)((int)(np - name) + l_value + 2))))\n\t\treturn (-1);\n\tfor (C = environ[offset]; (*C = *name++) && *C != '='; ++C)\n\t\t;\n\tfor (*C++ = '='; (*C++ = *value++); )\n\t\t;\n\treturn (0);\n}",
    "includes": [
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <errno.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "malloc",
          "args": [
            "(size_t)((int)(np - name) + l_value + 2)"
          ],
          "line": 181
        },
        "resolved": true,
        "details": {
          "function_name": "rpl_malloc",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/openbsd-compat/bsd-malloc.c",
          "lines": "26-32",
          "snippet": "void *\nrpl_malloc(size_t size)\n{\n\tif (size == 0)\n\t\tsize = 1;\n\treturn malloc(size);\n}",
          "includes": [
            "#include <stdlib.h>",
            "#include <sys/types.h>",
            "#include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <stdlib.h>\n#include <sys/types.h>\n#include \"config.h\"\n\nvoid *\nrpl_malloc(size_t size)\n{\n\tif (size == 0)\n\t\tsize = 1;\n\treturn malloc(size);\n}"
        }
      },
      {
        "call_info": {
          "callee": "memcpy",
          "args": [
            "P",
            "environ",
            "cnt * sizeof(char *)"
          ],
          "line": 175
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "realloc",
          "args": [
            "lastenv",
            "sizeof(char *) * (cnt + 2)"
          ],
          "line": 171
        },
        "resolved": true,
        "details": {
          "function_name": "rpl_realloc",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/openbsd-compat/bsd-malloc.c",
          "lines": "48-56",
          "snippet": "void *\nrpl_realloc(void *ptr, size_t size)\n{\n\tif (size == 0)\n\t\tsize = 1;\n\tif (ptr == 0)\n\t\treturn malloc(size);\n\treturn realloc(ptr, size);\n}",
          "includes": [
            "#include <stdlib.h>",
            "#include <sys/types.h>",
            "#include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <stdlib.h>\n#include <sys/types.h>\n#include \"config.h\"\n\nvoid *\nrpl_realloc(void *ptr, size_t size)\n{\n\tif (size == 0)\n\t\tsize = 1;\n\tif (ptr == 0)\n\t\treturn malloc(size);\n\treturn realloc(ptr, size);\n}"
        }
      },
      {
        "call_info": {
          "callee": "__findenv",
          "args": [
            "name",
            "(int)(np - name)",
            "&tmpoff"
          ],
          "line": 160
        },
        "resolved": true,
        "details": {
          "function_name": "__findenv",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/openbsd-compat/setenv.c",
          "lines": "55-75",
          "snippet": "static char *\n__findenv(const char *name, int len, int *offset)\n{\n\textern char **environ;\n\tint i;\n\tconst char *np;\n\tchar **p, *cp;\n\n\tif (name == NULL || environ == NULL)\n\t\treturn (NULL);\n\tfor (p = environ + *offset; (cp = *p) != NULL; ++p) {\n\t\tfor (np = name, i = len; i && *cp; i--)\n\t\t\tif (*cp++ != *np++)\n\t\t\t\tbreak;\n\t\tif (i == 0 && *cp++ == '=') {\n\t\t\t*offset = p - environ;\n\t\t\treturn (cp);\n\t\t}\n\t}\n\treturn (NULL);\n}",
          "includes": [
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <stdlib.h>\n#include <errno.h>\n#include \"includes.h\"\n\nstatic char *\n__findenv(const char *name, int len, int *offset)\n{\n\textern char **environ;\n\tint i;\n\tconst char *np;\n\tchar **p, *cp;\n\n\tif (name == NULL || environ == NULL)\n\t\treturn (NULL);\n\tfor (p = environ + *offset; (cp = *p) != NULL; ++p) {\n\t\tfor (np = name, i = len; i && *cp; i--)\n\t\t\tif (*cp++ != *np++)\n\t\t\t\tbreak;\n\t\tif (i == 0 && *cp++ == '=') {\n\t\t\t*offset = p - environ;\n\t\t\treturn (cp);\n\t\t}\n\t}\n\treturn (NULL);\n}"
        }
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "C"
          ],
          "line": 153
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "value"
          ],
          "line": 147
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <string.h>\n#include <stdlib.h>\n#include <errno.h>\n#include \"includes.h\"\n\nint\nsetenv(const char *name, const char *value, int rewrite)\n{\n\tchar *C, **P;\n\tconst char *np;\n\tint l_value, offset = 0;\n\n\tfor (np = name; *np && *np != '='; ++np)\n\t\t;\n#ifdef notyet\n\tif (*np) {\n\t\terrno = EINVAL;\n\t\treturn (-1);\t\t\t/* has `=' in name */\n\t}\n#endif\n\n\tl_value = strlen(value);\n\tif ((C = __findenv(name, (int)(np - name), &offset)) != NULL) {\n\t\tint tmpoff = offset + 1;\n\t\tif (!rewrite)\n\t\t\treturn (0);\n#if 0 /* XXX - existing entry may not be writable */\n\t\tif (strlen(C) >= l_value) {\t/* old larger; copy over */\n\t\t\twhile ((*C++ = *value++))\n\t\t\t\t;\n\t\t\treturn (0);\n\t\t}\n#endif\n\t\t/* could be set multiple times */\n\t\twhile (__findenv(name, (int)(np - name), &tmpoff)) {\n\t\t\tfor (P = &environ[tmpoff];; ++P)\n\t\t\t\tif (!(*P = *(P + 1)))\n\t\t\t\t\tbreak;\n\t\t}\n\t} else {\t\t\t\t\t/* create new slot */\n\t\tsize_t cnt;\n\n\t\tfor (P = environ; *P != NULL; P++)\n\t\t\t;\n\t\tcnt = P - environ;\n\t\tP = (char **)realloc(lastenv, sizeof(char *) * (cnt + 2));\n\t\tif (!P)\n\t\t\treturn (-1);\n\t\tif (lastenv != environ)\n\t\t\tmemcpy(P, environ, cnt * sizeof(char *));\n\t\tlastenv = environ = P;\n\t\toffset = cnt;\n\t\tenviron[cnt + 1] = NULL;\n\t}\n\tif (!(environ[offset] =\t\t\t/* name + `=' + value */\n\t    malloc((size_t)((int)(np - name) + l_value + 2))))\n\t\treturn (-1);\n\tfor (C = environ[offset]; (*C = *name++) && *C != '='; ++C)\n\t\t;\n\tfor (*C++ = '='; (*C++ = *value++); )\n\t\t;\n\treturn (0);\n}"
  },
  {
    "function_name": "putenv",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/openbsd-compat/setenv.c",
    "lines": "83-121",
    "snippet": "int\nputenv(char *str)\n{\n\tchar **P, *cp;\n\tsize_t cnt;\n\tint offset = 0;\n\n\tfor (cp = str; *cp && *cp != '='; ++cp)\n\t\t;\n\tif (*cp != '=') {\n\t\terrno = EINVAL;\n\t\treturn (-1);\t\t\t/* missing `=' in string */\n\t}\n\n\tif (__findenv(str, (int)(cp - str), &offset) != NULL) {\n\t\tenviron[offset++] = str;\n\t\t/* could be set multiple times */\n\t\twhile (__findenv(str, (int)(cp - str), &offset)) {\n\t\t\tfor (P = &environ[offset];; ++P)\n\t\t\t\tif (!(*P = *(P + 1)))\n\t\t\t\t\tbreak;\n\t\t}\n\t\treturn (0);\n\t}\n\n\t/* create new slot for string */\n\tfor (P = environ; *P != NULL; P++)\n\t\t;\n\tcnt = P - environ;\n\tP = (char **)realloc(lastenv, sizeof(char *) * (cnt + 2));\n\tif (!P)\n\t\treturn (-1);\n\tif (lastenv != environ)\n\t\tmemcpy(P, environ, cnt * sizeof(char *));\n\tlastenv = environ = P;\n\tenviron[cnt] = str;\n\tenviron[cnt + 1] = NULL;\n\treturn (0);\n}",
    "includes": [
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <errno.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "memcpy",
          "args": [
            "P",
            "environ",
            "cnt * sizeof(char *)"
          ],
          "line": 116
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "realloc",
          "args": [
            "lastenv",
            "sizeof(char *) * (cnt + 2)"
          ],
          "line": 112
        },
        "resolved": true,
        "details": {
          "function_name": "rpl_realloc",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/openbsd-compat/bsd-malloc.c",
          "lines": "48-56",
          "snippet": "void *\nrpl_realloc(void *ptr, size_t size)\n{\n\tif (size == 0)\n\t\tsize = 1;\n\tif (ptr == 0)\n\t\treturn malloc(size);\n\treturn realloc(ptr, size);\n}",
          "includes": [
            "#include <stdlib.h>",
            "#include <sys/types.h>",
            "#include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <stdlib.h>\n#include <sys/types.h>\n#include \"config.h\"\n\nvoid *\nrpl_realloc(void *ptr, size_t size)\n{\n\tif (size == 0)\n\t\tsize = 1;\n\tif (ptr == 0)\n\t\treturn malloc(size);\n\treturn realloc(ptr, size);\n}"
        }
      },
      {
        "call_info": {
          "callee": "__findenv",
          "args": [
            "str",
            "(int)(cp - str)",
            "&offset"
          ],
          "line": 100
        },
        "resolved": true,
        "details": {
          "function_name": "__findenv",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/openbsd-compat/setenv.c",
          "lines": "55-75",
          "snippet": "static char *\n__findenv(const char *name, int len, int *offset)\n{\n\textern char **environ;\n\tint i;\n\tconst char *np;\n\tchar **p, *cp;\n\n\tif (name == NULL || environ == NULL)\n\t\treturn (NULL);\n\tfor (p = environ + *offset; (cp = *p) != NULL; ++p) {\n\t\tfor (np = name, i = len; i && *cp; i--)\n\t\t\tif (*cp++ != *np++)\n\t\t\t\tbreak;\n\t\tif (i == 0 && *cp++ == '=') {\n\t\t\t*offset = p - environ;\n\t\t\treturn (cp);\n\t\t}\n\t}\n\treturn (NULL);\n}",
          "includes": [
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <stdlib.h>\n#include <errno.h>\n#include \"includes.h\"\n\nstatic char *\n__findenv(const char *name, int len, int *offset)\n{\n\textern char **environ;\n\tint i;\n\tconst char *np;\n\tchar **p, *cp;\n\n\tif (name == NULL || environ == NULL)\n\t\treturn (NULL);\n\tfor (p = environ + *offset; (cp = *p) != NULL; ++p) {\n\t\tfor (np = name, i = len; i && *cp; i--)\n\t\t\tif (*cp++ != *np++)\n\t\t\t\tbreak;\n\t\tif (i == 0 && *cp++ == '=') {\n\t\t\t*offset = p - environ;\n\t\t\treturn (cp);\n\t\t}\n\t}\n\treturn (NULL);\n}"
        }
      }
    ],
    "contextual_snippet": "#include <string.h>\n#include <stdlib.h>\n#include <errno.h>\n#include \"includes.h\"\n\nint\nputenv(char *str)\n{\n\tchar **P, *cp;\n\tsize_t cnt;\n\tint offset = 0;\n\n\tfor (cp = str; *cp && *cp != '='; ++cp)\n\t\t;\n\tif (*cp != '=') {\n\t\terrno = EINVAL;\n\t\treturn (-1);\t\t\t/* missing `=' in string */\n\t}\n\n\tif (__findenv(str, (int)(cp - str), &offset) != NULL) {\n\t\tenviron[offset++] = str;\n\t\t/* could be set multiple times */\n\t\twhile (__findenv(str, (int)(cp - str), &offset)) {\n\t\t\tfor (P = &environ[offset];; ++P)\n\t\t\t\tif (!(*P = *(P + 1)))\n\t\t\t\t\tbreak;\n\t\t}\n\t\treturn (0);\n\t}\n\n\t/* create new slot for string */\n\tfor (P = environ; *P != NULL; P++)\n\t\t;\n\tcnt = P - environ;\n\tP = (char **)realloc(lastenv, sizeof(char *) * (cnt + 2));\n\tif (!P)\n\t\treturn (-1);\n\tif (lastenv != environ)\n\t\tmemcpy(P, environ, cnt * sizeof(char *));\n\tlastenv = environ = P;\n\tenviron[cnt] = str;\n\tenviron[cnt + 1] = NULL;\n\treturn (0);\n}"
  },
  {
    "function_name": "__findenv",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/openbsd-compat/setenv.c",
    "lines": "55-75",
    "snippet": "static char *\n__findenv(const char *name, int len, int *offset)\n{\n\textern char **environ;\n\tint i;\n\tconst char *np;\n\tchar **p, *cp;\n\n\tif (name == NULL || environ == NULL)\n\t\treturn (NULL);\n\tfor (p = environ + *offset; (cp = *p) != NULL; ++p) {\n\t\tfor (np = name, i = len; i && *cp; i--)\n\t\t\tif (*cp++ != *np++)\n\t\t\t\tbreak;\n\t\tif (i == 0 && *cp++ == '=') {\n\t\t\t*offset = p - environ;\n\t\t\treturn (cp);\n\t\t}\n\t}\n\treturn (NULL);\n}",
    "includes": [
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <errno.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include <string.h>\n#include <stdlib.h>\n#include <errno.h>\n#include \"includes.h\"\n\nstatic char *\n__findenv(const char *name, int len, int *offset)\n{\n\textern char **environ;\n\tint i;\n\tconst char *np;\n\tchar **p, *cp;\n\n\tif (name == NULL || environ == NULL)\n\t\treturn (NULL);\n\tfor (p = environ + *offset; (cp = *p) != NULL; ++p) {\n\t\tfor (np = name, i = len; i && *cp; i--)\n\t\t\tif (*cp++ != *np++)\n\t\t\t\tbreak;\n\t\tif (i == 0 && *cp++ == '=') {\n\t\t\t*offset = p - environ;\n\t\t\treturn (cp);\n\t\t}\n\t}\n\treturn (NULL);\n}"
  }
]