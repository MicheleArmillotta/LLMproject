[
  {
    "function_name": "tests",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/regress/unittests/sshbuf/tests.c",
    "lines": "18-28",
    "snippet": "void\ntests(void)\n{\n\tsshbuf_tests();\n\tsshbuf_getput_basic_tests();\n\tsshbuf_getput_crypto_tests();\n\tsshbuf_misc_tests();\n\tsshbuf_fuzz_tests();\n\tsshbuf_getput_fuzz_tests();\n\tsshbuf_fixed();\n}",
    "includes": [
      "#include \"../test_helper/test_helper.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "void sshbuf_tests(void);",
      "void sshbuf_getput_basic_tests(void);",
      "void sshbuf_getput_crypto_tests(void);",
      "void sshbuf_misc_tests(void);",
      "void sshbuf_fuzz_tests(void);",
      "void sshbuf_getput_fuzz_tests(void);",
      "void sshbuf_fixed(void);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "sshbuf_fixed",
          "args": [],
          "line": 27
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_fixed",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/regress/unittests/sshbuf/test_sshbuf_fixed.c",
          "lines": "29-126",
          "snippet": "void\nsshbuf_fixed(void)\n{\n\tstruct sshbuf *p1, *p2, *p3;\n\tu_char c;\n\tchar *s;\n\tu_int i;\n\tsize_t l;\n\n\tTEST_START(\"sshbuf_from\");\n\tp1 = sshbuf_from(test_buf, sizeof(test_buf));\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_PTR_EQ(sshbuf_mutable_ptr(p1), NULL);\n\tASSERT_INT_EQ(sshbuf_check_reserve(p1, 1), SSH_ERR_BUFFER_READ_ONLY);\n\tASSERT_INT_EQ(sshbuf_reserve(p1, 1, NULL), SSH_ERR_BUFFER_READ_ONLY);\n\tASSERT_INT_EQ(sshbuf_set_max_size(p1, 200), SSH_ERR_BUFFER_READ_ONLY);\n\tASSERT_INT_EQ(sshbuf_put_u32(p1, 0x12345678), SSH_ERR_BUFFER_READ_ONLY);\n\tASSERT_SIZE_T_EQ(sshbuf_avail(p1), 0);\n\tASSERT_PTR_EQ(sshbuf_ptr(p1), test_buf);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_from data\");\n\tp1 = sshbuf_from(test_buf, sizeof(test_buf) - 1);\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_PTR_EQ(sshbuf_ptr(p1), test_buf);\n\tASSERT_INT_EQ(sshbuf_get_u8(p1, &c), 0);\n\tASSERT_PTR_EQ(sshbuf_ptr(p1), test_buf + 1);\n\tASSERT_U8_EQ(c, 1);\n\tASSERT_INT_EQ(sshbuf_get_u32(p1, &i), 0);\n\tASSERT_PTR_EQ(sshbuf_ptr(p1), test_buf + 5);\n\tASSERT_U32_EQ(i, 0x12345678);\n\tASSERT_INT_EQ(sshbuf_get_cstring(p1, &s, &l), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 0);\n\tASSERT_STRING_EQ(s, \"hello\");\n\tASSERT_SIZE_T_EQ(l, 5);\n\tsshbuf_free(p1);\n\tfree(s);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_fromb \");\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_U_INT_EQ(sshbuf_refcount(p1), 1);\n\tASSERT_PTR_EQ(sshbuf_parent(p1), NULL);\n\tASSERT_INT_EQ(sshbuf_put(p1, test_buf, sizeof(test_buf) - 1), 0);\n\tp2 = sshbuf_fromb(p1);\n\tASSERT_PTR_NE(p2, NULL);\n\tASSERT_U_INT_EQ(sshbuf_refcount(p1), 2);\n\tASSERT_PTR_EQ(sshbuf_parent(p1), NULL);\n\tASSERT_PTR_EQ(sshbuf_parent(p2), p1);\n\tASSERT_PTR_EQ(sshbuf_ptr(p2), sshbuf_ptr(p1));\n\tASSERT_PTR_NE(sshbuf_ptr(p1), NULL);\n\tASSERT_PTR_NE(sshbuf_ptr(p2), NULL);\n\tASSERT_PTR_EQ(sshbuf_mutable_ptr(p1), NULL);\n\tASSERT_PTR_EQ(sshbuf_mutable_ptr(p2), NULL);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), sshbuf_len(p2));\n\tASSERT_INT_EQ(sshbuf_get_u8(p2, &c), 0);\n\tASSERT_PTR_EQ(sshbuf_ptr(p2), sshbuf_ptr(p1) + 1);\n\tASSERT_U8_EQ(c, 1);\n\tASSERT_INT_EQ(sshbuf_get_u32(p2, &i), 0);\n\tASSERT_PTR_EQ(sshbuf_ptr(p2), sshbuf_ptr(p1) + 5);\n\tASSERT_U32_EQ(i, 0x12345678);\n\tASSERT_INT_EQ(sshbuf_get_cstring(p2, &s, &l), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p2), 0);\n\tASSERT_STRING_EQ(s, \"hello\");\n\tASSERT_SIZE_T_EQ(l, 5);\n\tsshbuf_free(p1);\n\tASSERT_U_INT_EQ(sshbuf_refcount(p1), 1);\n\tsshbuf_free(p2);\n\tfree(s);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_froms\");\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_put_u8(p1, 0x01), 0);\n\tASSERT_INT_EQ(sshbuf_put_u32(p1, 0x12345678), 0);\n\tASSERT_INT_EQ(sshbuf_put_cstring(p1, \"hello\"), 0);\n\tp2 = sshbuf_new();\n\tASSERT_PTR_NE(p2, NULL);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), sizeof(test_buf) - 1);\n\tASSERT_INT_EQ(sshbuf_put_stringb(p2, p1), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p2), sizeof(test_buf) + 4 - 1);\n\tASSERT_INT_EQ(sshbuf_froms(p2, &p3), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p2), 0);\n\tASSERT_PTR_NE(p3, NULL);\n\tASSERT_PTR_NE(sshbuf_ptr(p3), NULL);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p3), sizeof(test_buf) - 1);\n\tASSERT_MEM_EQ(sshbuf_ptr(p3), test_buf, sizeof(test_buf) - 1);\n\tsshbuf_free(p3);\n\tASSERT_INT_EQ(sshbuf_put_stringb(p2, p1), 0);\n\tASSERT_INT_EQ(sshbuf_consume_end(p2, 1), 0);\n\tASSERT_INT_EQ(sshbuf_froms(p2, &p3), SSH_ERR_MESSAGE_INCOMPLETE);\n\tASSERT_PTR_EQ(p3, NULL);\n\tsshbuf_free(p2);\n\tsshbuf_free(p1);\n}",
          "includes": [
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"../test_helper/test_helper.h\"",
            "#include <string.h>",
            "#include <stdlib.h>",
            "# include <stdint.h>",
            "#include <stdio.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "void sshbuf_fixed(void);",
            "const u_char test_buf[] = \"\\x01\\x12\\x34\\x56\\x78\\x00\\x00\\x00\\x05hello\";"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"../test_helper/test_helper.h\"\n#include <string.h>\n#include <stdlib.h>\n# include <stdint.h>\n#include <stdio.h>\n#include <sys/param.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid sshbuf_fixed(void);\nconst u_char test_buf[] = \"\\x01\\x12\\x34\\x56\\x78\\x00\\x00\\x00\\x05hello\";\n\nvoid\nsshbuf_fixed(void)\n{\n\tstruct sshbuf *p1, *p2, *p3;\n\tu_char c;\n\tchar *s;\n\tu_int i;\n\tsize_t l;\n\n\tTEST_START(\"sshbuf_from\");\n\tp1 = sshbuf_from(test_buf, sizeof(test_buf));\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_PTR_EQ(sshbuf_mutable_ptr(p1), NULL);\n\tASSERT_INT_EQ(sshbuf_check_reserve(p1, 1), SSH_ERR_BUFFER_READ_ONLY);\n\tASSERT_INT_EQ(sshbuf_reserve(p1, 1, NULL), SSH_ERR_BUFFER_READ_ONLY);\n\tASSERT_INT_EQ(sshbuf_set_max_size(p1, 200), SSH_ERR_BUFFER_READ_ONLY);\n\tASSERT_INT_EQ(sshbuf_put_u32(p1, 0x12345678), SSH_ERR_BUFFER_READ_ONLY);\n\tASSERT_SIZE_T_EQ(sshbuf_avail(p1), 0);\n\tASSERT_PTR_EQ(sshbuf_ptr(p1), test_buf);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_from data\");\n\tp1 = sshbuf_from(test_buf, sizeof(test_buf) - 1);\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_PTR_EQ(sshbuf_ptr(p1), test_buf);\n\tASSERT_INT_EQ(sshbuf_get_u8(p1, &c), 0);\n\tASSERT_PTR_EQ(sshbuf_ptr(p1), test_buf + 1);\n\tASSERT_U8_EQ(c, 1);\n\tASSERT_INT_EQ(sshbuf_get_u32(p1, &i), 0);\n\tASSERT_PTR_EQ(sshbuf_ptr(p1), test_buf + 5);\n\tASSERT_U32_EQ(i, 0x12345678);\n\tASSERT_INT_EQ(sshbuf_get_cstring(p1, &s, &l), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 0);\n\tASSERT_STRING_EQ(s, \"hello\");\n\tASSERT_SIZE_T_EQ(l, 5);\n\tsshbuf_free(p1);\n\tfree(s);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_fromb \");\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_U_INT_EQ(sshbuf_refcount(p1), 1);\n\tASSERT_PTR_EQ(sshbuf_parent(p1), NULL);\n\tASSERT_INT_EQ(sshbuf_put(p1, test_buf, sizeof(test_buf) - 1), 0);\n\tp2 = sshbuf_fromb(p1);\n\tASSERT_PTR_NE(p2, NULL);\n\tASSERT_U_INT_EQ(sshbuf_refcount(p1), 2);\n\tASSERT_PTR_EQ(sshbuf_parent(p1), NULL);\n\tASSERT_PTR_EQ(sshbuf_parent(p2), p1);\n\tASSERT_PTR_EQ(sshbuf_ptr(p2), sshbuf_ptr(p1));\n\tASSERT_PTR_NE(sshbuf_ptr(p1), NULL);\n\tASSERT_PTR_NE(sshbuf_ptr(p2), NULL);\n\tASSERT_PTR_EQ(sshbuf_mutable_ptr(p1), NULL);\n\tASSERT_PTR_EQ(sshbuf_mutable_ptr(p2), NULL);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), sshbuf_len(p2));\n\tASSERT_INT_EQ(sshbuf_get_u8(p2, &c), 0);\n\tASSERT_PTR_EQ(sshbuf_ptr(p2), sshbuf_ptr(p1) + 1);\n\tASSERT_U8_EQ(c, 1);\n\tASSERT_INT_EQ(sshbuf_get_u32(p2, &i), 0);\n\tASSERT_PTR_EQ(sshbuf_ptr(p2), sshbuf_ptr(p1) + 5);\n\tASSERT_U32_EQ(i, 0x12345678);\n\tASSERT_INT_EQ(sshbuf_get_cstring(p2, &s, &l), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p2), 0);\n\tASSERT_STRING_EQ(s, \"hello\");\n\tASSERT_SIZE_T_EQ(l, 5);\n\tsshbuf_free(p1);\n\tASSERT_U_INT_EQ(sshbuf_refcount(p1), 1);\n\tsshbuf_free(p2);\n\tfree(s);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_froms\");\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_put_u8(p1, 0x01), 0);\n\tASSERT_INT_EQ(sshbuf_put_u32(p1, 0x12345678), 0);\n\tASSERT_INT_EQ(sshbuf_put_cstring(p1, \"hello\"), 0);\n\tp2 = sshbuf_new();\n\tASSERT_PTR_NE(p2, NULL);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), sizeof(test_buf) - 1);\n\tASSERT_INT_EQ(sshbuf_put_stringb(p2, p1), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p2), sizeof(test_buf) + 4 - 1);\n\tASSERT_INT_EQ(sshbuf_froms(p2, &p3), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p2), 0);\n\tASSERT_PTR_NE(p3, NULL);\n\tASSERT_PTR_NE(sshbuf_ptr(p3), NULL);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p3), sizeof(test_buf) - 1);\n\tASSERT_MEM_EQ(sshbuf_ptr(p3), test_buf, sizeof(test_buf) - 1);\n\tsshbuf_free(p3);\n\tASSERT_INT_EQ(sshbuf_put_stringb(p2, p1), 0);\n\tASSERT_INT_EQ(sshbuf_consume_end(p2, 1), 0);\n\tASSERT_INT_EQ(sshbuf_froms(p2, &p3), SSH_ERR_MESSAGE_INCOMPLETE);\n\tASSERT_PTR_EQ(p3, NULL);\n\tsshbuf_free(p2);\n\tsshbuf_free(p1);\n}"
        }
      },
      {
        "call_info": {
          "callee": "sshbuf_getput_fuzz_tests",
          "args": [],
          "line": 26
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_getput_fuzz_tests",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/regress/unittests/sshbuf/test_sshbuf_getput_fuzz.c",
          "lines": "80-129",
          "snippet": "void\nsshbuf_getput_fuzz_tests(void)\n{\n\tu_char blob[] = {\n\t\t/* u8 */\n\t\t0xd0,\n\t\t/* u16 */\n\t\t0xc0, 0xde,\n\t\t/* u32 */\n\t\t0xfa, 0xce, 0xde, 0xad,\n\t\t/* u64 */\n\t\t0xfe, 0xed, 0xac, 0x1d, 0x1f, 0x1c, 0xbe, 0xef,\n\t\t/* string */\n\t\t0x00, 0x00, 0x00, 0x09,\n\t\t'O', ' ', 'G', 'o', 'r', 'g', 'o', 'n', '!',\n\t\t/* bignum1 */\n\t\t0x79,\n\t\t0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08,\n\t\t0x09, 0x0a, 0x0b, 0x0c, 0x0d, 0x0e, 0x0f, 0x10,\n\t\t/* bignum2 */\n\t\t0x00, 0x00, 0x00, 0x14,\n\t\t0x00,\n\t\t0xf0, 0xe0, 0xd0, 0xc0, 0xb0, 0xa0, 0x90, 0x80,\n\t\t0x70, 0x60, 0x50, 0x40, 0x30, 0x20, 0x10, 0x00,\n\t\t0x7f, 0xff, 0x11,\n\t\t/* EC point (NIST-256 curve) */\n\t\t0x00, 0x00, 0x00, 0x41,\n\t\t0x04,\n\t\t0x0c, 0x82, 0x80, 0x04, 0x83, 0x9d, 0x01, 0x06,\n\t\t0xaa, 0x59, 0x57, 0x52, 0x16, 0x19, 0x13, 0x57,\n\t\t0x34, 0xb4, 0x51, 0x45, 0x9d, 0xad, 0xb5, 0x86,\n\t\t0x67, 0x7e, 0xf9, 0xdf, 0x55, 0x78, 0x49, 0x99,\n\t\t0x4d, 0x19, 0x6b, 0x50, 0xf0, 0xb4, 0xe9, 0x4b,\n\t\t0x3c, 0x73, 0xe3, 0xa9, 0xd4, 0xcd, 0x9d, 0xf2,\n\t\t0xc8, 0xf9, 0xa3, 0x5e, 0x42, 0xbd, 0xd0, 0x47,\n\t\t0x55, 0x0f, 0x69, 0xd8, 0x0e, 0xc2, 0x3c, 0xd4,\n\t};\n\tstruct fuzz *fuzz;\n\n\tTEST_START(\"fuzz blob parsing\");\n\tfuzz = fuzz_begin(FUZZ_1_BIT_FLIP | FUZZ_2_BIT_FLIP |\n\t    FUZZ_1_BYTE_FLIP | FUZZ_2_BYTE_FLIP |\n\t    FUZZ_TRUNCATE_START | FUZZ_TRUNCATE_END, blob, sizeof(blob));\n\tTEST_ONERROR(onerror, fuzz);\n\tfor(; !fuzz_done(fuzz); fuzz_next(fuzz))\n\t\tattempt_parse_blob(blob, sizeof(blob));\n\tfuzz_cleanup(fuzz);\n\tTEST_DONE();\n\tTEST_ONERROR(NULL, NULL);\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include \"../test_helper/test_helper.h\"",
            "# include <openssl/ec.h>",
            "#include <openssl/objects.h>",
            "#include <openssl/bn.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "# include <stdint.h>",
            "#include <stdio.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "void sshbuf_getput_fuzz_tests(void);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"../test_helper/test_helper.h\"\n# include <openssl/ec.h>\n#include <openssl/objects.h>\n#include <openssl/bn.h>\n#include <string.h>\n#include <stdlib.h>\n# include <stdint.h>\n#include <stdio.h>\n#include <sys/param.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid sshbuf_getput_fuzz_tests(void);\n\nvoid\nsshbuf_getput_fuzz_tests(void)\n{\n\tu_char blob[] = {\n\t\t/* u8 */\n\t\t0xd0,\n\t\t/* u16 */\n\t\t0xc0, 0xde,\n\t\t/* u32 */\n\t\t0xfa, 0xce, 0xde, 0xad,\n\t\t/* u64 */\n\t\t0xfe, 0xed, 0xac, 0x1d, 0x1f, 0x1c, 0xbe, 0xef,\n\t\t/* string */\n\t\t0x00, 0x00, 0x00, 0x09,\n\t\t'O', ' ', 'G', 'o', 'r', 'g', 'o', 'n', '!',\n\t\t/* bignum1 */\n\t\t0x79,\n\t\t0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08,\n\t\t0x09, 0x0a, 0x0b, 0x0c, 0x0d, 0x0e, 0x0f, 0x10,\n\t\t/* bignum2 */\n\t\t0x00, 0x00, 0x00, 0x14,\n\t\t0x00,\n\t\t0xf0, 0xe0, 0xd0, 0xc0, 0xb0, 0xa0, 0x90, 0x80,\n\t\t0x70, 0x60, 0x50, 0x40, 0x30, 0x20, 0x10, 0x00,\n\t\t0x7f, 0xff, 0x11,\n\t\t/* EC point (NIST-256 curve) */\n\t\t0x00, 0x00, 0x00, 0x41,\n\t\t0x04,\n\t\t0x0c, 0x82, 0x80, 0x04, 0x83, 0x9d, 0x01, 0x06,\n\t\t0xaa, 0x59, 0x57, 0x52, 0x16, 0x19, 0x13, 0x57,\n\t\t0x34, 0xb4, 0x51, 0x45, 0x9d, 0xad, 0xb5, 0x86,\n\t\t0x67, 0x7e, 0xf9, 0xdf, 0x55, 0x78, 0x49, 0x99,\n\t\t0x4d, 0x19, 0x6b, 0x50, 0xf0, 0xb4, 0xe9, 0x4b,\n\t\t0x3c, 0x73, 0xe3, 0xa9, 0xd4, 0xcd, 0x9d, 0xf2,\n\t\t0xc8, 0xf9, 0xa3, 0x5e, 0x42, 0xbd, 0xd0, 0x47,\n\t\t0x55, 0x0f, 0x69, 0xd8, 0x0e, 0xc2, 0x3c, 0xd4,\n\t};\n\tstruct fuzz *fuzz;\n\n\tTEST_START(\"fuzz blob parsing\");\n\tfuzz = fuzz_begin(FUZZ_1_BIT_FLIP | FUZZ_2_BIT_FLIP |\n\t    FUZZ_1_BYTE_FLIP | FUZZ_2_BYTE_FLIP |\n\t    FUZZ_TRUNCATE_START | FUZZ_TRUNCATE_END, blob, sizeof(blob));\n\tTEST_ONERROR(onerror, fuzz);\n\tfor(; !fuzz_done(fuzz); fuzz_next(fuzz))\n\t\tattempt_parse_blob(blob, sizeof(blob));\n\tfuzz_cleanup(fuzz);\n\tTEST_DONE();\n\tTEST_ONERROR(NULL, NULL);\n}"
        }
      },
      {
        "call_info": {
          "callee": "sshbuf_fuzz_tests",
          "args": [],
          "line": 25
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_fuzz_tests",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/regress/unittests/sshbuf/test_sshbuf_fuzz.c",
          "lines": "28-127",
          "snippet": "void\nsshbuf_fuzz_tests(void)\n{\n\tstruct sshbuf *p1;\n\tu_char *dp;\n\tsize_t sz, sz2, i;\n\tu_int32_t r;\n\tint ret;\n\n\t/* NB. uses sshbuf internals */\n\tTEST_START(\"fuzz alloc/dealloc\");\n\tp1 = sshbuf_new();\n\tASSERT_INT_EQ(sshbuf_set_max_size(p1, 16 * 1024), 0);\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_PTR_NE(sshbuf_ptr(p1), NULL);\n\tASSERT_MEM_ZERO_NE(sshbuf_ptr(p1), sshbuf_len(p1));\n\tfor (i = 0; i < NUM_FUZZ_TESTS; i++) {\n\t\tr = arc4random_uniform(10);\n\t\tif (r == 0) {\n\t\t\t/* 10% chance: small reserve */\n\t\t\tr = arc4random_uniform(10);\n fuzz_reserve:\n\t\t\tsz = sshbuf_avail(p1);\n\t\t\tsz2 = sshbuf_len(p1);\n\t\t\tret = sshbuf_reserve(p1, r, &dp);\n\t\t\tif (ret < 0) {\n\t\t\t\tASSERT_PTR_EQ(dp, NULL);\n\t\t\t\tASSERT_SIZE_T_LT(sz, r);\n\t\t\t\tASSERT_SIZE_T_EQ(sshbuf_avail(p1), sz);\n\t\t\t\tASSERT_SIZE_T_EQ(sshbuf_len(p1), sz2);\n\t\t\t} else {\n\t\t\t\tASSERT_PTR_NE(dp, NULL);\n\t\t\t\tASSERT_SIZE_T_GE(sz, r);\n\t\t\t\tASSERT_SIZE_T_EQ(sshbuf_avail(p1), sz - r);\n\t\t\t\tASSERT_SIZE_T_EQ(sshbuf_len(p1), sz2 + r);\n\t\t\t\tmemset(dp, arc4random_uniform(255) + 1, r);\n\t\t\t}\n\t\t} else if (r < 3) {\n\t\t\t/* 20% chance: big reserve */\n\t\t\tr = arc4random_uniform(8 * 1024);\n\t\t\tgoto fuzz_reserve;\n\t\t} else if (r == 3) {\n\t\t\t/* 10% chance: small consume */\n\t\t\tr = arc4random_uniform(10);\n fuzz_consume:\n\t\t\tsz = sshbuf_avail(p1);\n\t\t\tsz2 = sshbuf_len(p1);\n\t\t\t/* 50% change consume from end, otherwise start */\n\t\t\tret = ((arc4random() & 1) ?\n\t\t\t    sshbuf_consume : sshbuf_consume_end)(p1, r);\n\t\t\tif (ret < 0) {\n\t\t\t\tASSERT_SIZE_T_LT(sz2, r);\n\t\t\t\tASSERT_SIZE_T_EQ(sshbuf_avail(p1), sz);\n\t\t\t\tASSERT_SIZE_T_EQ(sshbuf_len(p1), sz2);\n\t\t\t} else {\n\t\t\t\tASSERT_SIZE_T_GE(sz2, r);\n\t\t\t\tASSERT_SIZE_T_EQ(sshbuf_avail(p1), sz + r);\n\t\t\t\tASSERT_SIZE_T_EQ(sshbuf_len(p1), sz2 - r);\n\t\t\t}\n\t\t} else if (r < 8) {\n\t\t\t/* 40% chance: big consume */\n\t\t\tr = arc4random_uniform(2 * 1024);\n\t\t\tgoto fuzz_consume;\n\t\t} else if (r == 8) {\n\t\t\t/* 10% chance: reset max size */\n\t\t\tr = arc4random_uniform(16 * 1024);\n\t\t\tsz = sshbuf_max_size(p1);\n\t\t\tif (sshbuf_set_max_size(p1, r) < 0)\n\t\t\t\tASSERT_SIZE_T_EQ(sshbuf_max_size(p1), sz);\n\t\t\telse\n\t\t\t\tASSERT_SIZE_T_EQ(sshbuf_max_size(p1), r);\n\t\t} else {\n\t\t\tif (arc4random_uniform(8192) == 0) {\n\t\t\t\t/* tiny chance: new buffer */\n\t\t\t\tASSERT_PTR_NE(sshbuf_ptr(p1), NULL);\n\t\t\t\tASSERT_MEM_ZERO_NE(sshbuf_ptr(p1), sshbuf_len(p1));\n\t\t\t\tsshbuf_free(p1);\n\t\t\t\tp1 = sshbuf_new();\n\t\t\t\tASSERT_PTR_NE(p1, NULL);\n\t\t\t\tASSERT_INT_EQ(sshbuf_set_max_size(p1,\n\t\t\t\t    16 * 1024), 0);\n\t\t\t} else {\n\t\t\t\t/* Almost 10%: giant reserve */\n\t\t\t\t/* use arc4random_buf for r > 2^32 on 64 bit */\n\t\t\t\tarc4random_buf(&r, sizeof(r));\n\t\t\t\twhile (r < SSHBUF_SIZE_MAX / 2) {\n\t\t\t\t\tr <<= 1;\n\t\t\t\t\tr |= arc4random() & 1;\n\t\t\t\t}\n\t\t\t\tgoto fuzz_reserve;\n\t\t\t}\n\t\t}\n\t\tASSERT_PTR_NE(sshbuf_ptr(p1), NULL);\n\t\tASSERT_SIZE_T_LE(sshbuf_max_size(p1), 16 * 1024);\n\t}\n\tASSERT_PTR_NE(sshbuf_ptr(p1), NULL);\n\tASSERT_MEM_ZERO_NE(sshbuf_ptr(p1), sshbuf_len(p1));\n\tsshbuf_free(p1);\n\tTEST_DONE();\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include \"../test_helper/test_helper.h\"",
            "#include <string.h>",
            "#include <stdlib.h>",
            "# include <stdint.h>",
            "#include <stdio.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [
            "#define NUM_FUZZ_TESTS (1 << 18)"
          ],
          "globals_used": [
            "void sshbuf_fuzz_tests(void);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"../test_helper/test_helper.h\"\n#include <string.h>\n#include <stdlib.h>\n# include <stdint.h>\n#include <stdio.h>\n#include <sys/param.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\n#define NUM_FUZZ_TESTS (1 << 18)\n\nvoid sshbuf_fuzz_tests(void);\n\nvoid\nsshbuf_fuzz_tests(void)\n{\n\tstruct sshbuf *p1;\n\tu_char *dp;\n\tsize_t sz, sz2, i;\n\tu_int32_t r;\n\tint ret;\n\n\t/* NB. uses sshbuf internals */\n\tTEST_START(\"fuzz alloc/dealloc\");\n\tp1 = sshbuf_new();\n\tASSERT_INT_EQ(sshbuf_set_max_size(p1, 16 * 1024), 0);\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_PTR_NE(sshbuf_ptr(p1), NULL);\n\tASSERT_MEM_ZERO_NE(sshbuf_ptr(p1), sshbuf_len(p1));\n\tfor (i = 0; i < NUM_FUZZ_TESTS; i++) {\n\t\tr = arc4random_uniform(10);\n\t\tif (r == 0) {\n\t\t\t/* 10% chance: small reserve */\n\t\t\tr = arc4random_uniform(10);\n fuzz_reserve:\n\t\t\tsz = sshbuf_avail(p1);\n\t\t\tsz2 = sshbuf_len(p1);\n\t\t\tret = sshbuf_reserve(p1, r, &dp);\n\t\t\tif (ret < 0) {\n\t\t\t\tASSERT_PTR_EQ(dp, NULL);\n\t\t\t\tASSERT_SIZE_T_LT(sz, r);\n\t\t\t\tASSERT_SIZE_T_EQ(sshbuf_avail(p1), sz);\n\t\t\t\tASSERT_SIZE_T_EQ(sshbuf_len(p1), sz2);\n\t\t\t} else {\n\t\t\t\tASSERT_PTR_NE(dp, NULL);\n\t\t\t\tASSERT_SIZE_T_GE(sz, r);\n\t\t\t\tASSERT_SIZE_T_EQ(sshbuf_avail(p1), sz - r);\n\t\t\t\tASSERT_SIZE_T_EQ(sshbuf_len(p1), sz2 + r);\n\t\t\t\tmemset(dp, arc4random_uniform(255) + 1, r);\n\t\t\t}\n\t\t} else if (r < 3) {\n\t\t\t/* 20% chance: big reserve */\n\t\t\tr = arc4random_uniform(8 * 1024);\n\t\t\tgoto fuzz_reserve;\n\t\t} else if (r == 3) {\n\t\t\t/* 10% chance: small consume */\n\t\t\tr = arc4random_uniform(10);\n fuzz_consume:\n\t\t\tsz = sshbuf_avail(p1);\n\t\t\tsz2 = sshbuf_len(p1);\n\t\t\t/* 50% change consume from end, otherwise start */\n\t\t\tret = ((arc4random() & 1) ?\n\t\t\t    sshbuf_consume : sshbuf_consume_end)(p1, r);\n\t\t\tif (ret < 0) {\n\t\t\t\tASSERT_SIZE_T_LT(sz2, r);\n\t\t\t\tASSERT_SIZE_T_EQ(sshbuf_avail(p1), sz);\n\t\t\t\tASSERT_SIZE_T_EQ(sshbuf_len(p1), sz2);\n\t\t\t} else {\n\t\t\t\tASSERT_SIZE_T_GE(sz2, r);\n\t\t\t\tASSERT_SIZE_T_EQ(sshbuf_avail(p1), sz + r);\n\t\t\t\tASSERT_SIZE_T_EQ(sshbuf_len(p1), sz2 - r);\n\t\t\t}\n\t\t} else if (r < 8) {\n\t\t\t/* 40% chance: big consume */\n\t\t\tr = arc4random_uniform(2 * 1024);\n\t\t\tgoto fuzz_consume;\n\t\t} else if (r == 8) {\n\t\t\t/* 10% chance: reset max size */\n\t\t\tr = arc4random_uniform(16 * 1024);\n\t\t\tsz = sshbuf_max_size(p1);\n\t\t\tif (sshbuf_set_max_size(p1, r) < 0)\n\t\t\t\tASSERT_SIZE_T_EQ(sshbuf_max_size(p1), sz);\n\t\t\telse\n\t\t\t\tASSERT_SIZE_T_EQ(sshbuf_max_size(p1), r);\n\t\t} else {\n\t\t\tif (arc4random_uniform(8192) == 0) {\n\t\t\t\t/* tiny chance: new buffer */\n\t\t\t\tASSERT_PTR_NE(sshbuf_ptr(p1), NULL);\n\t\t\t\tASSERT_MEM_ZERO_NE(sshbuf_ptr(p1), sshbuf_len(p1));\n\t\t\t\tsshbuf_free(p1);\n\t\t\t\tp1 = sshbuf_new();\n\t\t\t\tASSERT_PTR_NE(p1, NULL);\n\t\t\t\tASSERT_INT_EQ(sshbuf_set_max_size(p1,\n\t\t\t\t    16 * 1024), 0);\n\t\t\t} else {\n\t\t\t\t/* Almost 10%: giant reserve */\n\t\t\t\t/* use arc4random_buf for r > 2^32 on 64 bit */\n\t\t\t\tarc4random_buf(&r, sizeof(r));\n\t\t\t\twhile (r < SSHBUF_SIZE_MAX / 2) {\n\t\t\t\t\tr <<= 1;\n\t\t\t\t\tr |= arc4random() & 1;\n\t\t\t\t}\n\t\t\t\tgoto fuzz_reserve;\n\t\t\t}\n\t\t}\n\t\tASSERT_PTR_NE(sshbuf_ptr(p1), NULL);\n\t\tASSERT_SIZE_T_LE(sshbuf_max_size(p1), 16 * 1024);\n\t}\n\tASSERT_PTR_NE(sshbuf_ptr(p1), NULL);\n\tASSERT_MEM_ZERO_NE(sshbuf_ptr(p1), sshbuf_len(p1));\n\tsshbuf_free(p1);\n\tTEST_DONE();\n}"
        }
      },
      {
        "call_info": {
          "callee": "sshbuf_misc_tests",
          "args": [],
          "line": 24
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_misc_tests",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/regress/unittests/sshbuf/test_sshbuf_misc.c",
          "lines": "25-166",
          "snippet": "void\nsshbuf_misc_tests(void)\n{\n\tstruct sshbuf *p1;\n\tchar tmp[512], *p;\n\tFILE *out;\n\tsize_t sz;\n\n\tTEST_START(\"sshbuf_dump\");\n\tout = tmpfile();\n\tASSERT_PTR_NE(out, NULL);\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_put_u32(p1, 0x12345678), 0);\n\tsshbuf_dump(p1, out);\n\tfflush(out);\n\trewind(out);\n\tsz = fread(tmp, 1, sizeof(tmp), out);\n\tASSERT_INT_EQ(ferror(out), 0);\n\tASSERT_INT_NE(feof(out), 0);\n\tASSERT_SIZE_T_GT(sz, 0);\n\ttmp[sz] = '\\0';\n\tASSERT_PTR_NE(strstr(tmp, \"12 34 56 78\"), NULL);\n\tfclose(out);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_dtob16\");\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_put_u32(p1, 0x12345678), 0);\n\tp = sshbuf_dtob16(p1);\n\tASSERT_PTR_NE(p, NULL);\n\tASSERT_STRING_EQ(p, \"12345678\");\n\tfree(p);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_dtob64 len 1\");\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_put_u8(p1, 0x11), 0);\n\tp = sshbuf_dtob64(p1);\n\tASSERT_PTR_NE(p, NULL);\n\tASSERT_STRING_EQ(p, \"EQ==\");\n\tfree(p);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_dtob64 len 2\");\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_put_u8(p1, 0x11), 0);\n\tASSERT_INT_EQ(sshbuf_put_u8(p1, 0x22), 0);\n\tp = sshbuf_dtob64(p1);\n\tASSERT_PTR_NE(p, NULL);\n\tASSERT_STRING_EQ(p, \"ESI=\");\n\tfree(p);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_dtob64 len 3\");\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_put_u8(p1, 0x11), 0);\n\tASSERT_INT_EQ(sshbuf_put_u8(p1, 0x22), 0);\n\tASSERT_INT_EQ(sshbuf_put_u8(p1, 0x33), 0);\n\tp = sshbuf_dtob64(p1);\n\tASSERT_PTR_NE(p, NULL);\n\tASSERT_STRING_EQ(p, \"ESIz\");\n\tfree(p);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_dtob64 len 8191\");\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_reserve(p1, 8192, NULL), 0);\n\tbzero(sshbuf_mutable_ptr(p1), 8192);\n\tp = sshbuf_dtob64(p1);\n\tASSERT_PTR_NE(p, NULL);\n\tASSERT_SIZE_T_EQ(strlen(p), ((8191 + 2) / 3) * 4);\n\tfree(p);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_b64tod len 1\");\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_b64tod(p1, \"0A==\"), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 1);\n\tASSERT_U8_EQ(*sshbuf_ptr(p1), 0xd0);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_b64tod len 2\");\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_b64tod(p1, \"0A8=\"), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 2);\n\tASSERT_U16_EQ(PEEK_U16(sshbuf_ptr(p1)), 0xd00f);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_b64tod len 4\");\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_b64tod(p1, \"0A/QDw==\"), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 4);\n\tASSERT_U32_EQ(PEEK_U32(sshbuf_ptr(p1)), 0xd00fd00f);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_dup_string\");\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\t/* Check empty buffer */\n\tp = sshbuf_dup_string(p1);\n\tASSERT_PTR_NE(p, NULL);\n\tASSERT_SIZE_T_EQ(strlen(p), 0);\n\tfree(p);\n\t/* Check buffer with string */\n\tASSERT_INT_EQ(sshbuf_put(p1, \"quad1\", strlen(\"quad1\")), 0);\n\tp = sshbuf_dup_string(p1);\n\tASSERT_PTR_NE(p, NULL);\n\tASSERT_SIZE_T_EQ(strlen(p), strlen(\"quad1\"));\n\tASSERT_STRING_EQ(p, \"quad1\");\n\tfree(p);\n\t/* Check buffer with terminating nul */\n\tASSERT_INT_EQ(sshbuf_put(p1, \"\\0\", 1), 0);\n\tp = sshbuf_dup_string(p1);\n\tASSERT_PTR_NE(p, NULL);\n\tASSERT_SIZE_T_EQ(strlen(p), strlen(\"quad1\"));\n\tASSERT_STRING_EQ(p, \"quad1\");\n\tfree(p);\n\t/* Check buffer with data after nul (expect failure) */\n\tASSERT_INT_EQ(sshbuf_put(p1, \"quad2\", strlen(\"quad2\")), 0);\n\tp = sshbuf_dup_string(p1);\n\tASSERT_PTR_EQ(p, NULL);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"../test_helper/test_helper.h\"",
            "#include <string.h>",
            "#include <stdlib.h>",
            "# include <stdint.h>",
            "#include <stdio.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "void sshbuf_misc_tests(void);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"../test_helper/test_helper.h\"\n#include <string.h>\n#include <stdlib.h>\n# include <stdint.h>\n#include <stdio.h>\n#include <sys/param.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid sshbuf_misc_tests(void);\n\nvoid\nsshbuf_misc_tests(void)\n{\n\tstruct sshbuf *p1;\n\tchar tmp[512], *p;\n\tFILE *out;\n\tsize_t sz;\n\n\tTEST_START(\"sshbuf_dump\");\n\tout = tmpfile();\n\tASSERT_PTR_NE(out, NULL);\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_put_u32(p1, 0x12345678), 0);\n\tsshbuf_dump(p1, out);\n\tfflush(out);\n\trewind(out);\n\tsz = fread(tmp, 1, sizeof(tmp), out);\n\tASSERT_INT_EQ(ferror(out), 0);\n\tASSERT_INT_NE(feof(out), 0);\n\tASSERT_SIZE_T_GT(sz, 0);\n\ttmp[sz] = '\\0';\n\tASSERT_PTR_NE(strstr(tmp, \"12 34 56 78\"), NULL);\n\tfclose(out);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_dtob16\");\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_put_u32(p1, 0x12345678), 0);\n\tp = sshbuf_dtob16(p1);\n\tASSERT_PTR_NE(p, NULL);\n\tASSERT_STRING_EQ(p, \"12345678\");\n\tfree(p);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_dtob64 len 1\");\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_put_u8(p1, 0x11), 0);\n\tp = sshbuf_dtob64(p1);\n\tASSERT_PTR_NE(p, NULL);\n\tASSERT_STRING_EQ(p, \"EQ==\");\n\tfree(p);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_dtob64 len 2\");\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_put_u8(p1, 0x11), 0);\n\tASSERT_INT_EQ(sshbuf_put_u8(p1, 0x22), 0);\n\tp = sshbuf_dtob64(p1);\n\tASSERT_PTR_NE(p, NULL);\n\tASSERT_STRING_EQ(p, \"ESI=\");\n\tfree(p);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_dtob64 len 3\");\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_put_u8(p1, 0x11), 0);\n\tASSERT_INT_EQ(sshbuf_put_u8(p1, 0x22), 0);\n\tASSERT_INT_EQ(sshbuf_put_u8(p1, 0x33), 0);\n\tp = sshbuf_dtob64(p1);\n\tASSERT_PTR_NE(p, NULL);\n\tASSERT_STRING_EQ(p, \"ESIz\");\n\tfree(p);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_dtob64 len 8191\");\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_reserve(p1, 8192, NULL), 0);\n\tbzero(sshbuf_mutable_ptr(p1), 8192);\n\tp = sshbuf_dtob64(p1);\n\tASSERT_PTR_NE(p, NULL);\n\tASSERT_SIZE_T_EQ(strlen(p), ((8191 + 2) / 3) * 4);\n\tfree(p);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_b64tod len 1\");\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_b64tod(p1, \"0A==\"), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 1);\n\tASSERT_U8_EQ(*sshbuf_ptr(p1), 0xd0);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_b64tod len 2\");\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_b64tod(p1, \"0A8=\"), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 2);\n\tASSERT_U16_EQ(PEEK_U16(sshbuf_ptr(p1)), 0xd00f);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_b64tod len 4\");\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_b64tod(p1, \"0A/QDw==\"), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 4);\n\tASSERT_U32_EQ(PEEK_U32(sshbuf_ptr(p1)), 0xd00fd00f);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_dup_string\");\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\t/* Check empty buffer */\n\tp = sshbuf_dup_string(p1);\n\tASSERT_PTR_NE(p, NULL);\n\tASSERT_SIZE_T_EQ(strlen(p), 0);\n\tfree(p);\n\t/* Check buffer with string */\n\tASSERT_INT_EQ(sshbuf_put(p1, \"quad1\", strlen(\"quad1\")), 0);\n\tp = sshbuf_dup_string(p1);\n\tASSERT_PTR_NE(p, NULL);\n\tASSERT_SIZE_T_EQ(strlen(p), strlen(\"quad1\"));\n\tASSERT_STRING_EQ(p, \"quad1\");\n\tfree(p);\n\t/* Check buffer with terminating nul */\n\tASSERT_INT_EQ(sshbuf_put(p1, \"\\0\", 1), 0);\n\tp = sshbuf_dup_string(p1);\n\tASSERT_PTR_NE(p, NULL);\n\tASSERT_SIZE_T_EQ(strlen(p), strlen(\"quad1\"));\n\tASSERT_STRING_EQ(p, \"quad1\");\n\tfree(p);\n\t/* Check buffer with data after nul (expect failure) */\n\tASSERT_INT_EQ(sshbuf_put(p1, \"quad2\", strlen(\"quad2\")), 0);\n\tp = sshbuf_dup_string(p1);\n\tASSERT_PTR_EQ(p, NULL);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n}"
        }
      },
      {
        "call_info": {
          "callee": "sshbuf_getput_crypto_tests",
          "args": [],
          "line": 23
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_getput_crypto_tests",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/regress/unittests/sshbuf/test_sshbuf_getput_crypto.c",
          "lines": "31-408",
          "snippet": "void\nsshbuf_getput_crypto_tests(void)\n{\n\tstruct sshbuf *p1;\n\tBIGNUM *bn, *bn2;\n\t/* This one has num_bits != num_bytes * 8 to test bignum1 encoding */\n\tconst char *hexbn1 = \"0102030405060708090a0b0c0d0e0f10\";\n\t/* This one has MSB set to test bignum2 encoding negative-avoidance */\n\tconst char *hexbn2 = \"f0e0d0c0b0a0908070605040302010007fff11\";\n\tu_char expbn1[] = {\n\t\t0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08,\n\t\t0x09, 0x0a, 0x0b, 0x0c, 0x0d, 0x0e, 0x0f, 0x10,\n\t};\n\tu_char expbn2[] = {\n\t\t0xf0, 0xe0, 0xd0, 0xc0, 0xb0, 0xa0, 0x90, 0x80,\n\t\t0x70, 0x60, 0x50, 0x40, 0x30, 0x20, 0x10, 0x00,\n\t\t0x7f, 0xff, 0x11\n\t};\n#if defined(OPENSSL_HAS_ECC) && defined(OPENSSL_HAS_NISTP256)\n\tconst u_char *d;\n\tsize_t s;\n\tBIGNUM *bn_x, *bn_y;\n\tint ec256_nid = NID_X9_62_prime256v1;\n\tchar *ec256_x = \"0C828004839D0106AA59575216191357\"\n\t\t        \"34B451459DADB586677EF9DF55784999\";\n\tchar *ec256_y = \"4D196B50F0B4E94B3C73E3A9D4CD9DF2\"\n\t                \"C8F9A35E42BDD047550F69D80EC23CD4\";\n\tu_char expec256[] = {\n\t\t0x04,\n\t\t0x0c, 0x82, 0x80, 0x04, 0x83, 0x9d, 0x01, 0x06,\n\t\t0xaa, 0x59, 0x57, 0x52, 0x16, 0x19, 0x13, 0x57,\n\t\t0x34, 0xb4, 0x51, 0x45, 0x9d, 0xad, 0xb5, 0x86,\n\t\t0x67, 0x7e, 0xf9, 0xdf, 0x55, 0x78, 0x49, 0x99,\n\t\t0x4d, 0x19, 0x6b, 0x50, 0xf0, 0xb4, 0xe9, 0x4b,\n\t\t0x3c, 0x73, 0xe3, 0xa9, 0xd4, 0xcd, 0x9d, 0xf2,\n\t\t0xc8, 0xf9, 0xa3, 0x5e, 0x42, 0xbd, 0xd0, 0x47,\n\t\t0x55, 0x0f, 0x69, 0xd8, 0x0e, 0xc2, 0x3c, 0xd4\n\t};\n\tEC_KEY *eck;\n\tEC_POINT *ecp;\n#endif\n\tint r;\n\n#define MKBN(b, bnn) \\\n\tdo { \\\n\t\tbnn = NULL; \\\n\t\tASSERT_INT_GT(BN_hex2bn(&bnn, b), 0); \\\n\t} while (0)\n\n\tTEST_START(\"sshbuf_put_bignum1\");\n\tMKBN(hexbn1, bn);\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_put_bignum1(p1, bn), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), sizeof(expbn1) + 2);\n\tASSERT_U16_EQ(PEEK_U16(sshbuf_ptr(p1)), (u_int16_t)BN_num_bits(bn));\n\tASSERT_MEM_EQ(sshbuf_ptr(p1) + 2, expbn1, sizeof(expbn1));\n\tBN_free(bn);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_put_bignum1 limited\");\n\tMKBN(hexbn1, bn);\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_set_max_size(p1, sizeof(expbn1) + 1), 0);\n\tr = sshbuf_put_bignum1(p1, bn);\n\tASSERT_INT_EQ(r, SSH_ERR_NO_BUFFER_SPACE);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 0);\n\tBN_free(bn);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_put_bignum1 bn2\");\n\tMKBN(hexbn2, bn);\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_put_bignum1(p1, bn), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), sizeof(expbn2) + 2);\n\tASSERT_U16_EQ(PEEK_U16(sshbuf_ptr(p1)), (u_int16_t)BN_num_bits(bn));\n\tASSERT_MEM_EQ(sshbuf_ptr(p1) + 2, expbn2, sizeof(expbn2));\n\tBN_free(bn);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_put_bignum1 bn2 limited\");\n\tMKBN(hexbn2, bn);\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_set_max_size(p1, sizeof(expbn1) + 1), 0);\n\tr = sshbuf_put_bignum1(p1, bn);\n\tASSERT_INT_EQ(r, SSH_ERR_NO_BUFFER_SPACE);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 0);\n\tBN_free(bn);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_put_bignum2\");\n\tMKBN(hexbn1, bn);\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_put_bignum2(p1, bn), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), sizeof(expbn1) + 4);\n\tASSERT_U32_EQ(PEEK_U32(sshbuf_ptr(p1)), (u_int32_t)BN_num_bytes(bn));\n\tASSERT_MEM_EQ(sshbuf_ptr(p1) + 4, expbn1, sizeof(expbn1));\n\tBN_free(bn);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_put_bignum2 limited\");\n\tMKBN(hexbn1, bn);\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_set_max_size(p1, sizeof(expbn1) + 3), 0);\n\tr = sshbuf_put_bignum2(p1, bn);\n\tASSERT_INT_EQ(r, SSH_ERR_NO_BUFFER_SPACE);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 0);\n\tBN_free(bn);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_put_bignum2 bn2\");\n\tMKBN(hexbn2, bn);\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_put_bignum2(p1, bn), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), sizeof(expbn2) + 4 + 1); /* MSB */\n\tASSERT_U32_EQ(PEEK_U32(sshbuf_ptr(p1)), (u_int32_t)BN_num_bytes(bn) + 1);\n\tASSERT_U8_EQ(*(sshbuf_ptr(p1) + 4), 0x00);\n\tASSERT_MEM_EQ(sshbuf_ptr(p1) + 5, expbn2, sizeof(expbn2));\n\tBN_free(bn);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_put_bignum2 bn2 limited\");\n\tMKBN(hexbn2, bn);\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_set_max_size(p1, sizeof(expbn2) + 3), 0);\n\tr = sshbuf_put_bignum2(p1, bn);\n\tASSERT_INT_EQ(r, SSH_ERR_NO_BUFFER_SPACE);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 0);\n\tBN_free(bn);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_get_bignum1\");\n\tMKBN(hexbn1, bn);\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_put_u16(p1, BN_num_bits(bn)), 0);\n\tASSERT_INT_EQ(sshbuf_put(p1, expbn1, sizeof(expbn1)), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 2 + sizeof(expbn1));\n\tASSERT_INT_EQ(sshbuf_put_u16(p1, 0xd00f), 0);\n\tbn2 = BN_new();\n\tASSERT_INT_EQ(sshbuf_get_bignum1(p1, bn2), 0);\n\tASSERT_BIGNUM_EQ(bn, bn2);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 2);\n\tBN_free(bn);\n\tBN_free(bn2);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_get_bignum1 truncated\");\n\tMKBN(hexbn1, bn);\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_put_u16(p1, BN_num_bits(bn)), 0);\n\tASSERT_INT_EQ(sshbuf_put(p1, expbn1, sizeof(expbn1) - 1), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 2 + sizeof(expbn1) - 1);\n\tbn2 = BN_new();\n\tr = sshbuf_get_bignum1(p1, bn2);\n\tASSERT_INT_EQ(r, SSH_ERR_MESSAGE_INCOMPLETE);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 2 + sizeof(expbn1) - 1);\n\tBN_free(bn);\n\tBN_free(bn2);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_get_bignum1 giant\");\n\tMKBN(hexbn1, bn);\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_put_u16(p1, 0xffff), 0);\n\tASSERT_INT_EQ(sshbuf_reserve(p1, (0xffff + 7) / 8, NULL), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 2 + ((0xffff + 7) / 8));\n\tbn2 = BN_new();\n\tr = sshbuf_get_bignum1(p1, bn2);\n\tASSERT_INT_EQ(r, SSH_ERR_BIGNUM_TOO_LARGE);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 2 + ((0xffff + 7) / 8));\n\tBN_free(bn);\n\tBN_free(bn2);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_get_bignum1 bn2\");\n\tMKBN(hexbn2, bn);\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_put_u16(p1, BN_num_bits(bn)), 0);\n\tASSERT_INT_EQ(sshbuf_put(p1, expbn2, sizeof(expbn2)), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 2 + sizeof(expbn2));\n\tASSERT_INT_EQ(sshbuf_put_u16(p1, 0xd00f), 0);\n\tbn2 = BN_new();\n\tASSERT_INT_EQ(sshbuf_get_bignum1(p1, bn2), 0);\n\tASSERT_BIGNUM_EQ(bn, bn2);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 2);\n\tBN_free(bn);\n\tBN_free(bn2);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_get_bignum1 bn2 truncated\");\n\tMKBN(hexbn2, bn);\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_put_u16(p1, BN_num_bits(bn)), 0);\n\tASSERT_INT_EQ(sshbuf_put(p1, expbn2, sizeof(expbn2) - 1), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 2 + sizeof(expbn2) - 1);\n\tbn2 = BN_new();\n\tr = sshbuf_get_bignum1(p1, bn2);\n\tASSERT_INT_EQ(r, SSH_ERR_MESSAGE_INCOMPLETE);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 2 + sizeof(expbn2) - 1);\n\tBN_free(bn);\n\tBN_free(bn2);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_get_bignum2\");\n\tMKBN(hexbn1, bn);\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_put_u32(p1, BN_num_bytes(bn)), 0);\n\tASSERT_INT_EQ(sshbuf_put(p1, expbn1, sizeof(expbn1)), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 4 + sizeof(expbn1));\n\tASSERT_INT_EQ(sshbuf_put_u16(p1, 0xd00f), 0);\n\tbn2 = BN_new();\n\tASSERT_INT_EQ(sshbuf_get_bignum2(p1, bn2), 0);\n\tASSERT_BIGNUM_EQ(bn, bn2);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 2);\n\tBN_free(bn);\n\tBN_free(bn2);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_get_bignum2 truncated\");\n\tMKBN(hexbn1, bn);\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_put_u32(p1, BN_num_bytes(bn)), 0);\n\tASSERT_INT_EQ(sshbuf_put(p1, expbn1, sizeof(expbn1) - 1), 0);\n\tbn2 = BN_new();\n\tr = sshbuf_get_bignum2(p1, bn2);\n\tASSERT_INT_EQ(r, SSH_ERR_MESSAGE_INCOMPLETE);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), sizeof(expbn1) + 3);\n\tBN_free(bn);\n\tBN_free(bn2);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_get_bignum2 giant\");\n\tMKBN(hexbn1, bn);\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_put_u32(p1, 65536), 0);\n\tASSERT_INT_EQ(sshbuf_reserve(p1, 65536, NULL), 0);\n\tbn2 = BN_new();\n\tr = sshbuf_get_bignum2(p1, bn2);\n\tASSERT_INT_EQ(r, SSH_ERR_BIGNUM_TOO_LARGE);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 65536 + 4);\n\tBN_free(bn);\n\tBN_free(bn2);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_get_bignum2 bn2\");\n\tMKBN(hexbn2, bn);\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_put_u32(p1, BN_num_bytes(bn) + 1), 0); /* MSB */\n\tASSERT_INT_EQ(sshbuf_put_u8(p1, 0x00), 0);\n\tASSERT_INT_EQ(sshbuf_put(p1, expbn2, sizeof(expbn2)), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 4 + 1 + sizeof(expbn2));\n\tASSERT_INT_EQ(sshbuf_put_u16(p1, 0xd00f), 0);\n\tbn2 = BN_new();\n\tASSERT_INT_EQ(sshbuf_get_bignum2(p1, bn2), 0);\n\tASSERT_BIGNUM_EQ(bn, bn2);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 2);\n\tBN_free(bn);\n\tBN_free(bn2);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_get_bignum2 bn2 truncated\");\n\tMKBN(hexbn2, bn);\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_put_u32(p1, BN_num_bytes(bn) + 1), 0);\n\tASSERT_INT_EQ(sshbuf_put_u8(p1, 0x00), 0);\n\tASSERT_INT_EQ(sshbuf_put(p1, expbn2, sizeof(expbn2) - 1), 0);\n\tbn2 = BN_new();\n\tr = sshbuf_get_bignum2(p1, bn2);\n\tASSERT_INT_EQ(r, SSH_ERR_MESSAGE_INCOMPLETE);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), sizeof(expbn2) + 1 + 4 - 1);\n\tBN_free(bn);\n\tBN_free(bn2);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_get_bignum2 bn2 negative\");\n\tMKBN(hexbn2, bn);\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_put_u32(p1, BN_num_bytes(bn)), 0);\n\tASSERT_INT_EQ(sshbuf_put(p1, expbn2, sizeof(expbn2)), 0);\n\tbn2 = BN_new();\n\tr = sshbuf_get_bignum2(p1, bn2);\n\tASSERT_INT_EQ(r, SSH_ERR_BIGNUM_IS_NEGATIVE);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), sizeof(expbn2) + 4);\n\tBN_free(bn);\n\tBN_free(bn2);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n#if defined(OPENSSL_HAS_ECC) && defined(OPENSSL_HAS_NISTP256)\n\tTEST_START(\"sshbuf_put_ec\");\n\teck = EC_KEY_new_by_curve_name(ec256_nid);\n\tASSERT_PTR_NE(eck, NULL);\n\tecp = EC_POINT_new(EC_KEY_get0_group(eck));\n\tASSERT_PTR_NE(ecp, NULL);\n\tMKBN(ec256_x, bn_x);\n\tMKBN(ec256_y, bn_y);\n\tASSERT_INT_EQ(EC_POINT_set_affine_coordinates_GFp(\n\t    EC_KEY_get0_group(eck), ecp, bn_x, bn_y, NULL), 1);\n\tASSERT_INT_EQ(EC_KEY_set_public_key(eck, ecp), 1);\n\tBN_free(bn_x);\n\tBN_free(bn_y);\n\tEC_POINT_free(ecp);\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_put_eckey(p1, eck), 0);\n\tASSERT_INT_EQ(sshbuf_get_string_direct(p1, &d, &s), 0);\n\tASSERT_SIZE_T_EQ(s, sizeof(expec256));\n\tASSERT_MEM_EQ(d, expec256, sizeof(expec256));\n\tsshbuf_free(p1);\n\tEC_KEY_free(eck);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_get_ec\");\n\teck = EC_KEY_new_by_curve_name(ec256_nid);\n\tASSERT_PTR_NE(eck, NULL);\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_put_string(p1, expec256, sizeof(expec256)), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), sizeof(expec256) + 4);\n\tASSERT_INT_EQ(sshbuf_put_u8(p1, 0x00), 0);\n\tASSERT_INT_EQ(sshbuf_get_eckey(p1, eck), 0);\n\tbn_x = BN_new();\n\tbn_y = BN_new();\n\tASSERT_PTR_NE(bn_x, NULL);\n\tASSERT_PTR_NE(bn_y, NULL);\n\tASSERT_INT_EQ(EC_POINT_get_affine_coordinates_GFp(\n\t    EC_KEY_get0_group(eck), EC_KEY_get0_public_key(eck),\n\t    bn_x, bn_y, NULL), 1);\n\tMKBN(ec256_x, bn);\n\tMKBN(ec256_y, bn2);\n\tASSERT_INT_EQ(BN_cmp(bn_x, bn), 0);\n\tASSERT_INT_EQ(BN_cmp(bn_y, bn2), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 1);\n\tsshbuf_free(p1);\n\tEC_KEY_free(eck);\n\tBN_free(bn_x);\n\tBN_free(bn_y);\n\tBN_free(bn);\n\tBN_free(bn2);\n\tTEST_DONE();\n#endif\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include \"../test_helper/test_helper.h\"",
            "# include <openssl/ec.h>",
            "#include <openssl/objects.h>",
            "#include <openssl/bn.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "# include <stdint.h>",
            "#include <stdio.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "void sshbuf_getput_crypto_tests(void);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"../test_helper/test_helper.h\"\n# include <openssl/ec.h>\n#include <openssl/objects.h>\n#include <openssl/bn.h>\n#include <string.h>\n#include <stdlib.h>\n# include <stdint.h>\n#include <stdio.h>\n#include <sys/param.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid sshbuf_getput_crypto_tests(void);\n\nvoid\nsshbuf_getput_crypto_tests(void)\n{\n\tstruct sshbuf *p1;\n\tBIGNUM *bn, *bn2;\n\t/* This one has num_bits != num_bytes * 8 to test bignum1 encoding */\n\tconst char *hexbn1 = \"0102030405060708090a0b0c0d0e0f10\";\n\t/* This one has MSB set to test bignum2 encoding negative-avoidance */\n\tconst char *hexbn2 = \"f0e0d0c0b0a0908070605040302010007fff11\";\n\tu_char expbn1[] = {\n\t\t0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08,\n\t\t0x09, 0x0a, 0x0b, 0x0c, 0x0d, 0x0e, 0x0f, 0x10,\n\t};\n\tu_char expbn2[] = {\n\t\t0xf0, 0xe0, 0xd0, 0xc0, 0xb0, 0xa0, 0x90, 0x80,\n\t\t0x70, 0x60, 0x50, 0x40, 0x30, 0x20, 0x10, 0x00,\n\t\t0x7f, 0xff, 0x11\n\t};\n#if defined(OPENSSL_HAS_ECC) && defined(OPENSSL_HAS_NISTP256)\n\tconst u_char *d;\n\tsize_t s;\n\tBIGNUM *bn_x, *bn_y;\n\tint ec256_nid = NID_X9_62_prime256v1;\n\tchar *ec256_x = \"0C828004839D0106AA59575216191357\"\n\t\t        \"34B451459DADB586677EF9DF55784999\";\n\tchar *ec256_y = \"4D196B50F0B4E94B3C73E3A9D4CD9DF2\"\n\t                \"C8F9A35E42BDD047550F69D80EC23CD4\";\n\tu_char expec256[] = {\n\t\t0x04,\n\t\t0x0c, 0x82, 0x80, 0x04, 0x83, 0x9d, 0x01, 0x06,\n\t\t0xaa, 0x59, 0x57, 0x52, 0x16, 0x19, 0x13, 0x57,\n\t\t0x34, 0xb4, 0x51, 0x45, 0x9d, 0xad, 0xb5, 0x86,\n\t\t0x67, 0x7e, 0xf9, 0xdf, 0x55, 0x78, 0x49, 0x99,\n\t\t0x4d, 0x19, 0x6b, 0x50, 0xf0, 0xb4, 0xe9, 0x4b,\n\t\t0x3c, 0x73, 0xe3, 0xa9, 0xd4, 0xcd, 0x9d, 0xf2,\n\t\t0xc8, 0xf9, 0xa3, 0x5e, 0x42, 0xbd, 0xd0, 0x47,\n\t\t0x55, 0x0f, 0x69, 0xd8, 0x0e, 0xc2, 0x3c, 0xd4\n\t};\n\tEC_KEY *eck;\n\tEC_POINT *ecp;\n#endif\n\tint r;\n\n#define MKBN(b, bnn) \\\n\tdo { \\\n\t\tbnn = NULL; \\\n\t\tASSERT_INT_GT(BN_hex2bn(&bnn, b), 0); \\\n\t} while (0)\n\n\tTEST_START(\"sshbuf_put_bignum1\");\n\tMKBN(hexbn1, bn);\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_put_bignum1(p1, bn), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), sizeof(expbn1) + 2);\n\tASSERT_U16_EQ(PEEK_U16(sshbuf_ptr(p1)), (u_int16_t)BN_num_bits(bn));\n\tASSERT_MEM_EQ(sshbuf_ptr(p1) + 2, expbn1, sizeof(expbn1));\n\tBN_free(bn);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_put_bignum1 limited\");\n\tMKBN(hexbn1, bn);\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_set_max_size(p1, sizeof(expbn1) + 1), 0);\n\tr = sshbuf_put_bignum1(p1, bn);\n\tASSERT_INT_EQ(r, SSH_ERR_NO_BUFFER_SPACE);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 0);\n\tBN_free(bn);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_put_bignum1 bn2\");\n\tMKBN(hexbn2, bn);\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_put_bignum1(p1, bn), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), sizeof(expbn2) + 2);\n\tASSERT_U16_EQ(PEEK_U16(sshbuf_ptr(p1)), (u_int16_t)BN_num_bits(bn));\n\tASSERT_MEM_EQ(sshbuf_ptr(p1) + 2, expbn2, sizeof(expbn2));\n\tBN_free(bn);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_put_bignum1 bn2 limited\");\n\tMKBN(hexbn2, bn);\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_set_max_size(p1, sizeof(expbn1) + 1), 0);\n\tr = sshbuf_put_bignum1(p1, bn);\n\tASSERT_INT_EQ(r, SSH_ERR_NO_BUFFER_SPACE);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 0);\n\tBN_free(bn);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_put_bignum2\");\n\tMKBN(hexbn1, bn);\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_put_bignum2(p1, bn), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), sizeof(expbn1) + 4);\n\tASSERT_U32_EQ(PEEK_U32(sshbuf_ptr(p1)), (u_int32_t)BN_num_bytes(bn));\n\tASSERT_MEM_EQ(sshbuf_ptr(p1) + 4, expbn1, sizeof(expbn1));\n\tBN_free(bn);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_put_bignum2 limited\");\n\tMKBN(hexbn1, bn);\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_set_max_size(p1, sizeof(expbn1) + 3), 0);\n\tr = sshbuf_put_bignum2(p1, bn);\n\tASSERT_INT_EQ(r, SSH_ERR_NO_BUFFER_SPACE);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 0);\n\tBN_free(bn);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_put_bignum2 bn2\");\n\tMKBN(hexbn2, bn);\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_put_bignum2(p1, bn), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), sizeof(expbn2) + 4 + 1); /* MSB */\n\tASSERT_U32_EQ(PEEK_U32(sshbuf_ptr(p1)), (u_int32_t)BN_num_bytes(bn) + 1);\n\tASSERT_U8_EQ(*(sshbuf_ptr(p1) + 4), 0x00);\n\tASSERT_MEM_EQ(sshbuf_ptr(p1) + 5, expbn2, sizeof(expbn2));\n\tBN_free(bn);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_put_bignum2 bn2 limited\");\n\tMKBN(hexbn2, bn);\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_set_max_size(p1, sizeof(expbn2) + 3), 0);\n\tr = sshbuf_put_bignum2(p1, bn);\n\tASSERT_INT_EQ(r, SSH_ERR_NO_BUFFER_SPACE);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 0);\n\tBN_free(bn);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_get_bignum1\");\n\tMKBN(hexbn1, bn);\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_put_u16(p1, BN_num_bits(bn)), 0);\n\tASSERT_INT_EQ(sshbuf_put(p1, expbn1, sizeof(expbn1)), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 2 + sizeof(expbn1));\n\tASSERT_INT_EQ(sshbuf_put_u16(p1, 0xd00f), 0);\n\tbn2 = BN_new();\n\tASSERT_INT_EQ(sshbuf_get_bignum1(p1, bn2), 0);\n\tASSERT_BIGNUM_EQ(bn, bn2);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 2);\n\tBN_free(bn);\n\tBN_free(bn2);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_get_bignum1 truncated\");\n\tMKBN(hexbn1, bn);\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_put_u16(p1, BN_num_bits(bn)), 0);\n\tASSERT_INT_EQ(sshbuf_put(p1, expbn1, sizeof(expbn1) - 1), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 2 + sizeof(expbn1) - 1);\n\tbn2 = BN_new();\n\tr = sshbuf_get_bignum1(p1, bn2);\n\tASSERT_INT_EQ(r, SSH_ERR_MESSAGE_INCOMPLETE);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 2 + sizeof(expbn1) - 1);\n\tBN_free(bn);\n\tBN_free(bn2);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_get_bignum1 giant\");\n\tMKBN(hexbn1, bn);\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_put_u16(p1, 0xffff), 0);\n\tASSERT_INT_EQ(sshbuf_reserve(p1, (0xffff + 7) / 8, NULL), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 2 + ((0xffff + 7) / 8));\n\tbn2 = BN_new();\n\tr = sshbuf_get_bignum1(p1, bn2);\n\tASSERT_INT_EQ(r, SSH_ERR_BIGNUM_TOO_LARGE);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 2 + ((0xffff + 7) / 8));\n\tBN_free(bn);\n\tBN_free(bn2);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_get_bignum1 bn2\");\n\tMKBN(hexbn2, bn);\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_put_u16(p1, BN_num_bits(bn)), 0);\n\tASSERT_INT_EQ(sshbuf_put(p1, expbn2, sizeof(expbn2)), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 2 + sizeof(expbn2));\n\tASSERT_INT_EQ(sshbuf_put_u16(p1, 0xd00f), 0);\n\tbn2 = BN_new();\n\tASSERT_INT_EQ(sshbuf_get_bignum1(p1, bn2), 0);\n\tASSERT_BIGNUM_EQ(bn, bn2);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 2);\n\tBN_free(bn);\n\tBN_free(bn2);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_get_bignum1 bn2 truncated\");\n\tMKBN(hexbn2, bn);\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_put_u16(p1, BN_num_bits(bn)), 0);\n\tASSERT_INT_EQ(sshbuf_put(p1, expbn2, sizeof(expbn2) - 1), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 2 + sizeof(expbn2) - 1);\n\tbn2 = BN_new();\n\tr = sshbuf_get_bignum1(p1, bn2);\n\tASSERT_INT_EQ(r, SSH_ERR_MESSAGE_INCOMPLETE);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 2 + sizeof(expbn2) - 1);\n\tBN_free(bn);\n\tBN_free(bn2);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_get_bignum2\");\n\tMKBN(hexbn1, bn);\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_put_u32(p1, BN_num_bytes(bn)), 0);\n\tASSERT_INT_EQ(sshbuf_put(p1, expbn1, sizeof(expbn1)), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 4 + sizeof(expbn1));\n\tASSERT_INT_EQ(sshbuf_put_u16(p1, 0xd00f), 0);\n\tbn2 = BN_new();\n\tASSERT_INT_EQ(sshbuf_get_bignum2(p1, bn2), 0);\n\tASSERT_BIGNUM_EQ(bn, bn2);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 2);\n\tBN_free(bn);\n\tBN_free(bn2);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_get_bignum2 truncated\");\n\tMKBN(hexbn1, bn);\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_put_u32(p1, BN_num_bytes(bn)), 0);\n\tASSERT_INT_EQ(sshbuf_put(p1, expbn1, sizeof(expbn1) - 1), 0);\n\tbn2 = BN_new();\n\tr = sshbuf_get_bignum2(p1, bn2);\n\tASSERT_INT_EQ(r, SSH_ERR_MESSAGE_INCOMPLETE);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), sizeof(expbn1) + 3);\n\tBN_free(bn);\n\tBN_free(bn2);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_get_bignum2 giant\");\n\tMKBN(hexbn1, bn);\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_put_u32(p1, 65536), 0);\n\tASSERT_INT_EQ(sshbuf_reserve(p1, 65536, NULL), 0);\n\tbn2 = BN_new();\n\tr = sshbuf_get_bignum2(p1, bn2);\n\tASSERT_INT_EQ(r, SSH_ERR_BIGNUM_TOO_LARGE);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 65536 + 4);\n\tBN_free(bn);\n\tBN_free(bn2);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_get_bignum2 bn2\");\n\tMKBN(hexbn2, bn);\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_put_u32(p1, BN_num_bytes(bn) + 1), 0); /* MSB */\n\tASSERT_INT_EQ(sshbuf_put_u8(p1, 0x00), 0);\n\tASSERT_INT_EQ(sshbuf_put(p1, expbn2, sizeof(expbn2)), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 4 + 1 + sizeof(expbn2));\n\tASSERT_INT_EQ(sshbuf_put_u16(p1, 0xd00f), 0);\n\tbn2 = BN_new();\n\tASSERT_INT_EQ(sshbuf_get_bignum2(p1, bn2), 0);\n\tASSERT_BIGNUM_EQ(bn, bn2);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 2);\n\tBN_free(bn);\n\tBN_free(bn2);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_get_bignum2 bn2 truncated\");\n\tMKBN(hexbn2, bn);\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_put_u32(p1, BN_num_bytes(bn) + 1), 0);\n\tASSERT_INT_EQ(sshbuf_put_u8(p1, 0x00), 0);\n\tASSERT_INT_EQ(sshbuf_put(p1, expbn2, sizeof(expbn2) - 1), 0);\n\tbn2 = BN_new();\n\tr = sshbuf_get_bignum2(p1, bn2);\n\tASSERT_INT_EQ(r, SSH_ERR_MESSAGE_INCOMPLETE);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), sizeof(expbn2) + 1 + 4 - 1);\n\tBN_free(bn);\n\tBN_free(bn2);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_get_bignum2 bn2 negative\");\n\tMKBN(hexbn2, bn);\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_put_u32(p1, BN_num_bytes(bn)), 0);\n\tASSERT_INT_EQ(sshbuf_put(p1, expbn2, sizeof(expbn2)), 0);\n\tbn2 = BN_new();\n\tr = sshbuf_get_bignum2(p1, bn2);\n\tASSERT_INT_EQ(r, SSH_ERR_BIGNUM_IS_NEGATIVE);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), sizeof(expbn2) + 4);\n\tBN_free(bn);\n\tBN_free(bn2);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n#if defined(OPENSSL_HAS_ECC) && defined(OPENSSL_HAS_NISTP256)\n\tTEST_START(\"sshbuf_put_ec\");\n\teck = EC_KEY_new_by_curve_name(ec256_nid);\n\tASSERT_PTR_NE(eck, NULL);\n\tecp = EC_POINT_new(EC_KEY_get0_group(eck));\n\tASSERT_PTR_NE(ecp, NULL);\n\tMKBN(ec256_x, bn_x);\n\tMKBN(ec256_y, bn_y);\n\tASSERT_INT_EQ(EC_POINT_set_affine_coordinates_GFp(\n\t    EC_KEY_get0_group(eck), ecp, bn_x, bn_y, NULL), 1);\n\tASSERT_INT_EQ(EC_KEY_set_public_key(eck, ecp), 1);\n\tBN_free(bn_x);\n\tBN_free(bn_y);\n\tEC_POINT_free(ecp);\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_put_eckey(p1, eck), 0);\n\tASSERT_INT_EQ(sshbuf_get_string_direct(p1, &d, &s), 0);\n\tASSERT_SIZE_T_EQ(s, sizeof(expec256));\n\tASSERT_MEM_EQ(d, expec256, sizeof(expec256));\n\tsshbuf_free(p1);\n\tEC_KEY_free(eck);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_get_ec\");\n\teck = EC_KEY_new_by_curve_name(ec256_nid);\n\tASSERT_PTR_NE(eck, NULL);\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_put_string(p1, expec256, sizeof(expec256)), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), sizeof(expec256) + 4);\n\tASSERT_INT_EQ(sshbuf_put_u8(p1, 0x00), 0);\n\tASSERT_INT_EQ(sshbuf_get_eckey(p1, eck), 0);\n\tbn_x = BN_new();\n\tbn_y = BN_new();\n\tASSERT_PTR_NE(bn_x, NULL);\n\tASSERT_PTR_NE(bn_y, NULL);\n\tASSERT_INT_EQ(EC_POINT_get_affine_coordinates_GFp(\n\t    EC_KEY_get0_group(eck), EC_KEY_get0_public_key(eck),\n\t    bn_x, bn_y, NULL), 1);\n\tMKBN(ec256_x, bn);\n\tMKBN(ec256_y, bn2);\n\tASSERT_INT_EQ(BN_cmp(bn_x, bn), 0);\n\tASSERT_INT_EQ(BN_cmp(bn_y, bn2), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 1);\n\tsshbuf_free(p1);\n\tEC_KEY_free(eck);\n\tBN_free(bn_x);\n\tBN_free(bn_y);\n\tBN_free(bn);\n\tBN_free(bn2);\n\tTEST_DONE();\n#endif\n}"
        }
      },
      {
        "call_info": {
          "callee": "sshbuf_getput_basic_tests",
          "args": [],
          "line": 22
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_getput_basic_tests",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/regress/unittests/sshbuf/test_sshbuf_getput_basic.c",
          "lines": "25-484",
          "snippet": "void\nsshbuf_getput_basic_tests(void)\n{\n\tstruct sshbuf *p1, *p2;\n\tconst u_char *cd;\n\tu_char *d, d2[32], x[] = {\n\t\t0x11, 0x22, 0x33, 0x44, 0x55, 0x66, 0x77, 0x88, 0x00, 0x99\n\t};\n\tu_int64_t v64;\n\tu_int32_t v32;\n\tu_int16_t v16;\n\tu_char v8;\n\tsize_t s;\n\tchar *s2;\n\tint r;\n\tu_char bn1[] = { 0x00, 0x00, 0x00 };\n\tu_char bn2[] = { 0x00, 0x00, 0x01, 0x02 };\n\tu_char bn3[] = { 0x00, 0x80, 0x09 };\n\tu_char bn_exp1[] = { 0x00, 0x00, 0x00, 0x00 };\n\tu_char bn_exp2[] = { 0x00, 0x00, 0x00, 0x02, 0x01, 0x02 };\n\tu_char bn_exp3[] = { 0x00, 0x00, 0x00, 0x03, 0x00, 0x80, 0x09 };\n\n\tTEST_START(\"PEEK_U64\");\n\tASSERT_U64_EQ(PEEK_U64(x), 0x1122334455667788ULL);\n\tTEST_DONE();\n\n\tTEST_START(\"PEEK_U32\");\n\tASSERT_U32_EQ(PEEK_U32(x), 0x11223344);\n\tTEST_DONE();\n\n\tTEST_START(\"PEEK_U16\");\n\tASSERT_U16_EQ(PEEK_U16(x), 0x1122);\n\tTEST_DONE();\n\n\tTEST_START(\"POKE_U64\");\n\tbzero(d2, sizeof(d2));\n\tPOKE_U64(d2, 0x1122334455667788ULL);\n\tASSERT_MEM_EQ(d2, x, 8);\n\tTEST_DONE();\n\t\n\tTEST_START(\"POKE_U32\");\n\tbzero(d2, sizeof(d2));\n\tPOKE_U32(d2, 0x11223344);\n\tASSERT_MEM_EQ(d2, x, 4);\n\tTEST_DONE();\n\t\n\tTEST_START(\"POKE_U16\");\n\tbzero(d2, sizeof(d2));\n\tPOKE_U16(d2, 0x1122);\n\tASSERT_MEM_EQ(d2, x, 2);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_put\");\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_put(p1, x, 5), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 5);\n\tcd = sshbuf_ptr(p1);\n\tASSERT_PTR_NE(cd, NULL);\n\tASSERT_U8_EQ(cd[0], 0x11);\n\tASSERT_U8_EQ(cd[1], 0x22);\n\tASSERT_U8_EQ(cd[2], 0x33);\n\tASSERT_U8_EQ(cd[3], 0x44);\n\tASSERT_U8_EQ(cd[4], 0x55);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_get\");\n\tASSERT_INT_EQ(sshbuf_get(p1, d2, 4), 0);\n\tASSERT_MEM_EQ(d2, x, 4);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 1);\n\tASSERT_U8_EQ(*(sshbuf_ptr(p1)), 0x55);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_get truncated\");\n\tr = sshbuf_get(p1, d2, 4);\n\tASSERT_INT_EQ(r, SSH_ERR_MESSAGE_INCOMPLETE);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 1);\n\tASSERT_U8_EQ(*(sshbuf_ptr(p1)), 0x55);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_put truncated\");\n\tASSERT_INT_EQ(sshbuf_set_max_size(p1, 4), 0);\n\tr = sshbuf_put(p1, x, 5);\n\tASSERT_INT_EQ(r, SSH_ERR_NO_BUFFER_SPACE);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 1);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_get_u64\");\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_put(p1, x, 10), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 10);\n\tASSERT_INT_EQ(sshbuf_get_u64(p1, &v64), 0);\n\tASSERT_U64_EQ(v64, 0x1122334455667788ULL);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 2);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_get_u64 truncated\");\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 2);\n\tr = sshbuf_get_u64(p1, &v64);\n\tASSERT_INT_EQ(r, SSH_ERR_MESSAGE_INCOMPLETE);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 2);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_get_u32\");\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_put(p1, x, 10), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 10);\n\tASSERT_INT_EQ(sshbuf_get_u32(p1, &v32), 0);\n\tASSERT_U32_EQ(v32, 0x11223344);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 6);\n\tASSERT_INT_EQ(sshbuf_get_u32(p1, &v32), 0);\n\tASSERT_U32_EQ(v32, 0x55667788);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 2);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_get_u32 truncated\");\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 2);\n\tr = sshbuf_get_u32(p1, &v32);\n\tASSERT_INT_EQ(r, SSH_ERR_MESSAGE_INCOMPLETE);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 2);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_get_u16\");\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_put(p1, x, 9), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 9);\n\tASSERT_INT_EQ(sshbuf_get_u16(p1, &v16), 0);\n\tASSERT_U16_EQ(v16, 0x1122);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 7);\n\tASSERT_INT_EQ(sshbuf_get_u16(p1, &v16), 0);\n\tASSERT_U16_EQ(v16, 0x3344);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 5);\n\tASSERT_INT_EQ(sshbuf_get_u16(p1, &v16), 0);\n\tASSERT_U16_EQ(v16, 0x5566);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 3);\n\tASSERT_INT_EQ(sshbuf_get_u16(p1, &v16), 0);\n\tASSERT_U16_EQ(v16, 0x7788);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_get_u16 truncated\");\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 1);\n\tr = sshbuf_get_u16(p1, &v16);\n\tASSERT_INT_EQ(r, SSH_ERR_MESSAGE_INCOMPLETE);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 1);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_get_u8\");\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_put(p1, x, 2), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 2);\n\tASSERT_INT_EQ(sshbuf_get_u8(p1, &v8), 0);\n\tASSERT_U8_EQ(v8, 0x11);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 1);\n\tASSERT_INT_EQ(sshbuf_get_u8(p1, &v8), 0);\n\tASSERT_U8_EQ(v8, 0x22);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 0);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_get_u8 truncated\");\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 0);\n\tr = sshbuf_get_u8(p1, &v8);\n\tASSERT_INT_EQ(r, SSH_ERR_MESSAGE_INCOMPLETE);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 0);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_put_u64\");\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_put_u64(p1, 0x1122334455667788ULL), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 8);\n\tASSERT_MEM_EQ(sshbuf_ptr(p1), x, 8);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_put_u64 exact\");\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_set_max_size(p1, 8), 0);\n\tASSERT_INT_EQ(sshbuf_put_u64(p1, 0x1122334455667788ULL), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 8);\n\tASSERT_MEM_EQ(sshbuf_ptr(p1), x, 8);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_put_u64 limited\");\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_set_max_size(p1, 7), 0);\n\tr = sshbuf_put_u64(p1, 0x1122334455667788ULL);\n\tASSERT_INT_EQ(r, SSH_ERR_NO_BUFFER_SPACE);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 0);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\t\n\tTEST_START(\"sshbuf_put_u32\");\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_put_u32(p1, 0x11223344), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 4);\n\tASSERT_MEM_EQ(sshbuf_ptr(p1), x, 4);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_put_u32 exact\");\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_set_max_size(p1, 4), 0);\n\tASSERT_INT_EQ(sshbuf_put_u32(p1, 0x11223344), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 4);\n\tASSERT_MEM_EQ(sshbuf_ptr(p1), x, 4);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_put_u32 limited\");\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_set_max_size(p1, 3), 0);\n\tr = sshbuf_put_u32(p1, 0x11223344);\n\tASSERT_INT_EQ(r, SSH_ERR_NO_BUFFER_SPACE);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 0);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\t\n\tTEST_START(\"sshbuf_put_u16\");\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_put_u16(p1, 0x1122), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 2);\n\tASSERT_MEM_EQ(sshbuf_ptr(p1), x, 2);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_put_u16\");\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_set_max_size(p1, 2), 0);\n\tASSERT_INT_EQ(sshbuf_put_u16(p1, 0x1122), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 2);\n\tASSERT_MEM_EQ(sshbuf_ptr(p1), x, 2);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_put_u16 limited\");\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_set_max_size(p1, 1), 0);\n\tr = sshbuf_put_u16(p1, 0x1122);\n\tASSERT_INT_EQ(r, SSH_ERR_NO_BUFFER_SPACE);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 0);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_get_string\");\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_put_u32(p1, sizeof(x)), 0);\n\tASSERT_INT_EQ(sshbuf_put(p1, x, sizeof(x)), 0);\n\tASSERT_INT_EQ(sshbuf_put_u32(p1, sizeof(x)), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), sizeof(x) + 4 + 4);\n\tASSERT_INT_EQ(sshbuf_get_string(p1, &d, &s), 0);\n\tASSERT_SIZE_T_EQ(s, sizeof(x));\n\tASSERT_MEM_EQ(d, x, sizeof(x));\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 4);\n\tfree(d);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_get_string exact\");\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_set_max_size(p1, sizeof(x) + 4), 0);\n\tASSERT_INT_EQ(sshbuf_put_u32(p1, sizeof(x)), 0);\n\tASSERT_INT_EQ(sshbuf_put(p1, x, sizeof(x)), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), sizeof(x) + 4);\n\tASSERT_INT_EQ(sshbuf_get_string(p1, &d, &s), 0);\n\tASSERT_SIZE_T_EQ(s, sizeof(x));\n\tASSERT_MEM_EQ(d, x, sizeof(x));\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 0);\n\tfree(d);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_get_string truncated\");\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_put_u32(p1, sizeof(x)), 0);\n\tASSERT_INT_EQ(sshbuf_put(p1, x, sizeof(x)), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), sizeof(x) + 4);\n\tASSERT_INT_EQ(sshbuf_consume_end(p1, 1), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), sizeof(x) + 3);\n\tr = sshbuf_get_string(p1, &d, &s);\n\tASSERT_INT_EQ(r, SSH_ERR_MESSAGE_INCOMPLETE);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), sizeof(x) + 3);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_get_string giant\");\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_put_u32(p1, 0xffffffff), 0);\n\tASSERT_INT_EQ(sshbuf_put(p1, x, sizeof(x)), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), sizeof(x) + 4);\n\tr = sshbuf_get_string(p1, &d, &s);\n\tASSERT_INT_EQ(r, SSH_ERR_STRING_TOO_LARGE);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), sizeof(x) + 4);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_get_cstring giant\");\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_put_u32(p1, 0xffffffff), 0);\n\tASSERT_INT_EQ(sshbuf_put(p1, x, sizeof(x)), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), sizeof(x) + 4);\n\tr = sshbuf_get_cstring(p1, &s2, &s);\n\tASSERT_INT_EQ(r, SSH_ERR_STRING_TOO_LARGE);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), sizeof(x) + 4);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_get_cstring embedded \\\\0\");\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_put_u32(p1, sizeof(x)), 0);\n\tASSERT_INT_EQ(sshbuf_put(p1, x, sizeof(x)), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), sizeof(x) + 4);\n\tr = sshbuf_get_cstring(p1, &s2, NULL);\n\tASSERT_INT_EQ(r, SSH_ERR_INVALID_FORMAT);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_get_cstring trailing \\\\0\");\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_put_u32(p1, sizeof(x) - 1), 0);\n\tASSERT_INT_EQ(sshbuf_put(p1, x, sizeof(x) - 1), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), sizeof(x) + 4 - 1);\n\tASSERT_INT_EQ(sshbuf_get_cstring(p1, &s2, &s), 0);\n\tASSERT_SIZE_T_EQ(s, sizeof(x) - 1);\n\tASSERT_MEM_EQ(s2, x, s);\n\tfree(s2);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_put_string\");\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_put_string(p1, x, sizeof(x)), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), sizeof(x) + 4);\n\tASSERT_U32_EQ(PEEK_U32(sshbuf_ptr(p1)), sizeof(x));\n\tASSERT_MEM_EQ(sshbuf_ptr(p1) + 4, x, sizeof(x));\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_put_string limited\");\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_set_max_size(p1, sizeof(x) + 4 - 1), 0);\n\tr = sshbuf_put_string(p1, x, sizeof(x));\n\tASSERT_INT_EQ(r, SSH_ERR_NO_BUFFER_SPACE);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 0);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_put_string giant\");\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tr = sshbuf_put_string(p1, (void *)0x01, 0xfffffffc);\n\tASSERT_INT_EQ(r, SSH_ERR_NO_BUFFER_SPACE);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 0);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_putf\");\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tr = sshbuf_putf(p1, \"%s %d %x\", \"hello\", 23, 0x5f);\n\tASSERT_INT_EQ(r, 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 11);\n\tASSERT_MEM_EQ(sshbuf_ptr(p1), \"hello 23 5f\", 11);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_putb\");\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tp2 = sshbuf_new();\n\tASSERT_PTR_NE(p2, NULL);\n\tASSERT_INT_EQ(sshbuf_put(p1, \"blahblahblah\", 12), 0);\n\tASSERT_INT_EQ(sshbuf_putb(p2, p1), 0);\n\tsshbuf_free(p1);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p2), 12);\n\tASSERT_MEM_EQ(sshbuf_ptr(p2), \"blahblahblah\", 12);\n\tsshbuf_free(p2);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_put_bignum2_bytes empty buf\");\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_put_bignum2_bytes(p1, NULL, 0), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), sizeof(bn_exp1));\n\tASSERT_MEM_EQ(sshbuf_ptr(p1), bn_exp1, sizeof(bn_exp1));\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_put_bignum2_bytes all zeroes\");\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_put_bignum2_bytes(p1, bn1, sizeof(bn1)), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), sizeof(bn_exp1));\n\tASSERT_MEM_EQ(sshbuf_ptr(p1), bn_exp1, sizeof(bn_exp1));\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_put_bignum2_bytes simple\");\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_put_bignum2_bytes(p1, bn2+2, sizeof(bn2)-2), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), sizeof(bn_exp2));\n\tASSERT_MEM_EQ(sshbuf_ptr(p1), bn_exp2, sizeof(bn_exp2));\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_put_bignum2_bytes leading zero\");\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_put_bignum2_bytes(p1, bn2, sizeof(bn2)), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), sizeof(bn_exp2));\n\tASSERT_MEM_EQ(sshbuf_ptr(p1), bn_exp2, sizeof(bn_exp2));\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_put_bignum2_bytes neg\");\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_put_bignum2_bytes(p1, bn3+1, sizeof(bn3)-1), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), sizeof(bn_exp3));\n\tASSERT_MEM_EQ(sshbuf_ptr(p1), bn_exp3, sizeof(bn_exp3));\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_put_bignum2_bytes neg and leading zero\");\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_put_bignum2_bytes(p1, bn3, sizeof(bn3)), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), sizeof(bn_exp3));\n\tASSERT_MEM_EQ(sshbuf_ptr(p1), bn_exp3, sizeof(bn_exp3));\n\tsshbuf_free(p1);\n\tTEST_DONE();\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include \"../test_helper/test_helper.h\"",
            "#include <string.h>",
            "#include <stdlib.h>",
            "# include <stdint.h>",
            "#include <stdio.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "void sshbuf_getput_basic_tests(void);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"../test_helper/test_helper.h\"\n#include <string.h>\n#include <stdlib.h>\n# include <stdint.h>\n#include <stdio.h>\n#include <sys/param.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid sshbuf_getput_basic_tests(void);\n\nvoid\nsshbuf_getput_basic_tests(void)\n{\n\tstruct sshbuf *p1, *p2;\n\tconst u_char *cd;\n\tu_char *d, d2[32], x[] = {\n\t\t0x11, 0x22, 0x33, 0x44, 0x55, 0x66, 0x77, 0x88, 0x00, 0x99\n\t};\n\tu_int64_t v64;\n\tu_int32_t v32;\n\tu_int16_t v16;\n\tu_char v8;\n\tsize_t s;\n\tchar *s2;\n\tint r;\n\tu_char bn1[] = { 0x00, 0x00, 0x00 };\n\tu_char bn2[] = { 0x00, 0x00, 0x01, 0x02 };\n\tu_char bn3[] = { 0x00, 0x80, 0x09 };\n\tu_char bn_exp1[] = { 0x00, 0x00, 0x00, 0x00 };\n\tu_char bn_exp2[] = { 0x00, 0x00, 0x00, 0x02, 0x01, 0x02 };\n\tu_char bn_exp3[] = { 0x00, 0x00, 0x00, 0x03, 0x00, 0x80, 0x09 };\n\n\tTEST_START(\"PEEK_U64\");\n\tASSERT_U64_EQ(PEEK_U64(x), 0x1122334455667788ULL);\n\tTEST_DONE();\n\n\tTEST_START(\"PEEK_U32\");\n\tASSERT_U32_EQ(PEEK_U32(x), 0x11223344);\n\tTEST_DONE();\n\n\tTEST_START(\"PEEK_U16\");\n\tASSERT_U16_EQ(PEEK_U16(x), 0x1122);\n\tTEST_DONE();\n\n\tTEST_START(\"POKE_U64\");\n\tbzero(d2, sizeof(d2));\n\tPOKE_U64(d2, 0x1122334455667788ULL);\n\tASSERT_MEM_EQ(d2, x, 8);\n\tTEST_DONE();\n\t\n\tTEST_START(\"POKE_U32\");\n\tbzero(d2, sizeof(d2));\n\tPOKE_U32(d2, 0x11223344);\n\tASSERT_MEM_EQ(d2, x, 4);\n\tTEST_DONE();\n\t\n\tTEST_START(\"POKE_U16\");\n\tbzero(d2, sizeof(d2));\n\tPOKE_U16(d2, 0x1122);\n\tASSERT_MEM_EQ(d2, x, 2);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_put\");\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_put(p1, x, 5), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 5);\n\tcd = sshbuf_ptr(p1);\n\tASSERT_PTR_NE(cd, NULL);\n\tASSERT_U8_EQ(cd[0], 0x11);\n\tASSERT_U8_EQ(cd[1], 0x22);\n\tASSERT_U8_EQ(cd[2], 0x33);\n\tASSERT_U8_EQ(cd[3], 0x44);\n\tASSERT_U8_EQ(cd[4], 0x55);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_get\");\n\tASSERT_INT_EQ(sshbuf_get(p1, d2, 4), 0);\n\tASSERT_MEM_EQ(d2, x, 4);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 1);\n\tASSERT_U8_EQ(*(sshbuf_ptr(p1)), 0x55);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_get truncated\");\n\tr = sshbuf_get(p1, d2, 4);\n\tASSERT_INT_EQ(r, SSH_ERR_MESSAGE_INCOMPLETE);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 1);\n\tASSERT_U8_EQ(*(sshbuf_ptr(p1)), 0x55);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_put truncated\");\n\tASSERT_INT_EQ(sshbuf_set_max_size(p1, 4), 0);\n\tr = sshbuf_put(p1, x, 5);\n\tASSERT_INT_EQ(r, SSH_ERR_NO_BUFFER_SPACE);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 1);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_get_u64\");\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_put(p1, x, 10), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 10);\n\tASSERT_INT_EQ(sshbuf_get_u64(p1, &v64), 0);\n\tASSERT_U64_EQ(v64, 0x1122334455667788ULL);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 2);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_get_u64 truncated\");\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 2);\n\tr = sshbuf_get_u64(p1, &v64);\n\tASSERT_INT_EQ(r, SSH_ERR_MESSAGE_INCOMPLETE);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 2);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_get_u32\");\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_put(p1, x, 10), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 10);\n\tASSERT_INT_EQ(sshbuf_get_u32(p1, &v32), 0);\n\tASSERT_U32_EQ(v32, 0x11223344);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 6);\n\tASSERT_INT_EQ(sshbuf_get_u32(p1, &v32), 0);\n\tASSERT_U32_EQ(v32, 0x55667788);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 2);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_get_u32 truncated\");\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 2);\n\tr = sshbuf_get_u32(p1, &v32);\n\tASSERT_INT_EQ(r, SSH_ERR_MESSAGE_INCOMPLETE);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 2);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_get_u16\");\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_put(p1, x, 9), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 9);\n\tASSERT_INT_EQ(sshbuf_get_u16(p1, &v16), 0);\n\tASSERT_U16_EQ(v16, 0x1122);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 7);\n\tASSERT_INT_EQ(sshbuf_get_u16(p1, &v16), 0);\n\tASSERT_U16_EQ(v16, 0x3344);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 5);\n\tASSERT_INT_EQ(sshbuf_get_u16(p1, &v16), 0);\n\tASSERT_U16_EQ(v16, 0x5566);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 3);\n\tASSERT_INT_EQ(sshbuf_get_u16(p1, &v16), 0);\n\tASSERT_U16_EQ(v16, 0x7788);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_get_u16 truncated\");\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 1);\n\tr = sshbuf_get_u16(p1, &v16);\n\tASSERT_INT_EQ(r, SSH_ERR_MESSAGE_INCOMPLETE);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 1);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_get_u8\");\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_put(p1, x, 2), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 2);\n\tASSERT_INT_EQ(sshbuf_get_u8(p1, &v8), 0);\n\tASSERT_U8_EQ(v8, 0x11);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 1);\n\tASSERT_INT_EQ(sshbuf_get_u8(p1, &v8), 0);\n\tASSERT_U8_EQ(v8, 0x22);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 0);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_get_u8 truncated\");\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 0);\n\tr = sshbuf_get_u8(p1, &v8);\n\tASSERT_INT_EQ(r, SSH_ERR_MESSAGE_INCOMPLETE);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 0);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_put_u64\");\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_put_u64(p1, 0x1122334455667788ULL), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 8);\n\tASSERT_MEM_EQ(sshbuf_ptr(p1), x, 8);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_put_u64 exact\");\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_set_max_size(p1, 8), 0);\n\tASSERT_INT_EQ(sshbuf_put_u64(p1, 0x1122334455667788ULL), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 8);\n\tASSERT_MEM_EQ(sshbuf_ptr(p1), x, 8);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_put_u64 limited\");\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_set_max_size(p1, 7), 0);\n\tr = sshbuf_put_u64(p1, 0x1122334455667788ULL);\n\tASSERT_INT_EQ(r, SSH_ERR_NO_BUFFER_SPACE);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 0);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\t\n\tTEST_START(\"sshbuf_put_u32\");\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_put_u32(p1, 0x11223344), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 4);\n\tASSERT_MEM_EQ(sshbuf_ptr(p1), x, 4);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_put_u32 exact\");\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_set_max_size(p1, 4), 0);\n\tASSERT_INT_EQ(sshbuf_put_u32(p1, 0x11223344), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 4);\n\tASSERT_MEM_EQ(sshbuf_ptr(p1), x, 4);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_put_u32 limited\");\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_set_max_size(p1, 3), 0);\n\tr = sshbuf_put_u32(p1, 0x11223344);\n\tASSERT_INT_EQ(r, SSH_ERR_NO_BUFFER_SPACE);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 0);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\t\n\tTEST_START(\"sshbuf_put_u16\");\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_put_u16(p1, 0x1122), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 2);\n\tASSERT_MEM_EQ(sshbuf_ptr(p1), x, 2);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_put_u16\");\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_set_max_size(p1, 2), 0);\n\tASSERT_INT_EQ(sshbuf_put_u16(p1, 0x1122), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 2);\n\tASSERT_MEM_EQ(sshbuf_ptr(p1), x, 2);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_put_u16 limited\");\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_set_max_size(p1, 1), 0);\n\tr = sshbuf_put_u16(p1, 0x1122);\n\tASSERT_INT_EQ(r, SSH_ERR_NO_BUFFER_SPACE);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 0);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_get_string\");\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_put_u32(p1, sizeof(x)), 0);\n\tASSERT_INT_EQ(sshbuf_put(p1, x, sizeof(x)), 0);\n\tASSERT_INT_EQ(sshbuf_put_u32(p1, sizeof(x)), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), sizeof(x) + 4 + 4);\n\tASSERT_INT_EQ(sshbuf_get_string(p1, &d, &s), 0);\n\tASSERT_SIZE_T_EQ(s, sizeof(x));\n\tASSERT_MEM_EQ(d, x, sizeof(x));\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 4);\n\tfree(d);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_get_string exact\");\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_set_max_size(p1, sizeof(x) + 4), 0);\n\tASSERT_INT_EQ(sshbuf_put_u32(p1, sizeof(x)), 0);\n\tASSERT_INT_EQ(sshbuf_put(p1, x, sizeof(x)), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), sizeof(x) + 4);\n\tASSERT_INT_EQ(sshbuf_get_string(p1, &d, &s), 0);\n\tASSERT_SIZE_T_EQ(s, sizeof(x));\n\tASSERT_MEM_EQ(d, x, sizeof(x));\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 0);\n\tfree(d);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_get_string truncated\");\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_put_u32(p1, sizeof(x)), 0);\n\tASSERT_INT_EQ(sshbuf_put(p1, x, sizeof(x)), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), sizeof(x) + 4);\n\tASSERT_INT_EQ(sshbuf_consume_end(p1, 1), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), sizeof(x) + 3);\n\tr = sshbuf_get_string(p1, &d, &s);\n\tASSERT_INT_EQ(r, SSH_ERR_MESSAGE_INCOMPLETE);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), sizeof(x) + 3);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_get_string giant\");\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_put_u32(p1, 0xffffffff), 0);\n\tASSERT_INT_EQ(sshbuf_put(p1, x, sizeof(x)), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), sizeof(x) + 4);\n\tr = sshbuf_get_string(p1, &d, &s);\n\tASSERT_INT_EQ(r, SSH_ERR_STRING_TOO_LARGE);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), sizeof(x) + 4);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_get_cstring giant\");\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_put_u32(p1, 0xffffffff), 0);\n\tASSERT_INT_EQ(sshbuf_put(p1, x, sizeof(x)), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), sizeof(x) + 4);\n\tr = sshbuf_get_cstring(p1, &s2, &s);\n\tASSERT_INT_EQ(r, SSH_ERR_STRING_TOO_LARGE);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), sizeof(x) + 4);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_get_cstring embedded \\\\0\");\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_put_u32(p1, sizeof(x)), 0);\n\tASSERT_INT_EQ(sshbuf_put(p1, x, sizeof(x)), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), sizeof(x) + 4);\n\tr = sshbuf_get_cstring(p1, &s2, NULL);\n\tASSERT_INT_EQ(r, SSH_ERR_INVALID_FORMAT);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_get_cstring trailing \\\\0\");\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_put_u32(p1, sizeof(x) - 1), 0);\n\tASSERT_INT_EQ(sshbuf_put(p1, x, sizeof(x) - 1), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), sizeof(x) + 4 - 1);\n\tASSERT_INT_EQ(sshbuf_get_cstring(p1, &s2, &s), 0);\n\tASSERT_SIZE_T_EQ(s, sizeof(x) - 1);\n\tASSERT_MEM_EQ(s2, x, s);\n\tfree(s2);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_put_string\");\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_put_string(p1, x, sizeof(x)), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), sizeof(x) + 4);\n\tASSERT_U32_EQ(PEEK_U32(sshbuf_ptr(p1)), sizeof(x));\n\tASSERT_MEM_EQ(sshbuf_ptr(p1) + 4, x, sizeof(x));\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_put_string limited\");\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_set_max_size(p1, sizeof(x) + 4 - 1), 0);\n\tr = sshbuf_put_string(p1, x, sizeof(x));\n\tASSERT_INT_EQ(r, SSH_ERR_NO_BUFFER_SPACE);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 0);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_put_string giant\");\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tr = sshbuf_put_string(p1, (void *)0x01, 0xfffffffc);\n\tASSERT_INT_EQ(r, SSH_ERR_NO_BUFFER_SPACE);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 0);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_putf\");\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tr = sshbuf_putf(p1, \"%s %d %x\", \"hello\", 23, 0x5f);\n\tASSERT_INT_EQ(r, 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 11);\n\tASSERT_MEM_EQ(sshbuf_ptr(p1), \"hello 23 5f\", 11);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_putb\");\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tp2 = sshbuf_new();\n\tASSERT_PTR_NE(p2, NULL);\n\tASSERT_INT_EQ(sshbuf_put(p1, \"blahblahblah\", 12), 0);\n\tASSERT_INT_EQ(sshbuf_putb(p2, p1), 0);\n\tsshbuf_free(p1);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p2), 12);\n\tASSERT_MEM_EQ(sshbuf_ptr(p2), \"blahblahblah\", 12);\n\tsshbuf_free(p2);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_put_bignum2_bytes empty buf\");\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_put_bignum2_bytes(p1, NULL, 0), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), sizeof(bn_exp1));\n\tASSERT_MEM_EQ(sshbuf_ptr(p1), bn_exp1, sizeof(bn_exp1));\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_put_bignum2_bytes all zeroes\");\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_put_bignum2_bytes(p1, bn1, sizeof(bn1)), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), sizeof(bn_exp1));\n\tASSERT_MEM_EQ(sshbuf_ptr(p1), bn_exp1, sizeof(bn_exp1));\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_put_bignum2_bytes simple\");\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_put_bignum2_bytes(p1, bn2+2, sizeof(bn2)-2), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), sizeof(bn_exp2));\n\tASSERT_MEM_EQ(sshbuf_ptr(p1), bn_exp2, sizeof(bn_exp2));\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_put_bignum2_bytes leading zero\");\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_put_bignum2_bytes(p1, bn2, sizeof(bn2)), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), sizeof(bn_exp2));\n\tASSERT_MEM_EQ(sshbuf_ptr(p1), bn_exp2, sizeof(bn_exp2));\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_put_bignum2_bytes neg\");\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_put_bignum2_bytes(p1, bn3+1, sizeof(bn3)-1), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), sizeof(bn_exp3));\n\tASSERT_MEM_EQ(sshbuf_ptr(p1), bn_exp3, sizeof(bn_exp3));\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_put_bignum2_bytes neg and leading zero\");\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_put_bignum2_bytes(p1, bn3, sizeof(bn3)), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), sizeof(bn_exp3));\n\tASSERT_MEM_EQ(sshbuf_ptr(p1), bn_exp3, sizeof(bn_exp3));\n\tsshbuf_free(p1);\n\tTEST_DONE();\n}"
        }
      },
      {
        "call_info": {
          "callee": "sshbuf_tests",
          "args": [],
          "line": 21
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_tests",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/regress/unittests/sshbuf/test_sshbuf.c",
          "lines": "27-240",
          "snippet": "void\nsshbuf_tests(void)\n{\n\tstruct sshbuf *p1;\n\tconst u_char *cdp;\n\tu_char *dp;\n\tsize_t sz;\n\tint r;\n\n\tTEST_START(\"allocate sshbuf\");\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tTEST_DONE();\n\n\tTEST_START(\"max size on fresh buffer\");\n\tASSERT_SIZE_T_GT(sshbuf_max_size(p1), 0);\n\tTEST_DONE();\n\n\tTEST_START(\"available on fresh buffer\");\n\tASSERT_SIZE_T_GT(sshbuf_avail(p1), 0);\n\tTEST_DONE();\n\n\tTEST_START(\"len = 0 on empty buffer\");\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 0);\n\tTEST_DONE();\n\n\tTEST_START(\"set valid max size\");\n\tASSERT_INT_EQ(sshbuf_set_max_size(p1, 65536), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_max_size(p1), 65536);\n\tTEST_DONE();\n\n\tTEST_START(\"available on limited buffer\");\n\tASSERT_SIZE_T_EQ(sshbuf_avail(p1), 65536);\n\tTEST_DONE();\n\n\tTEST_START(\"free\");\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"consume on empty buffer\");\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_consume(p1, 0), 0);\n\tASSERT_INT_EQ(sshbuf_consume(p1, 1), SSH_ERR_MESSAGE_INCOMPLETE);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"consume_end on empty buffer\");\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_consume_end(p1, 0), 0);\n\tASSERT_INT_EQ(sshbuf_consume_end(p1, 1), SSH_ERR_MESSAGE_INCOMPLETE);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"reserve space\");\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tr = sshbuf_reserve(p1, 1, &dp);\n\tASSERT_INT_EQ(r, 0);\n\tASSERT_PTR_NE(dp, NULL);\n\t*dp = 0x11;\n\tr = sshbuf_reserve(p1, 3, &dp);\n\tASSERT_INT_EQ(r, 0);\n\tASSERT_PTR_NE(dp, NULL);\n\t*dp++ = 0x22;\n\t*dp++ = 0x33;\n\t*dp++ = 0x44;\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_len on filled buffer\");\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 4);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_ptr on filled buffer\");\n\tcdp = sshbuf_ptr(p1);\n\tASSERT_PTR_NE(cdp, NULL);\n\tASSERT_U8_EQ(cdp[0], 0x11);\n\tASSERT_U8_EQ(cdp[1], 0x22);\n\tASSERT_U8_EQ(cdp[2], 0x33);\n\tASSERT_U8_EQ(cdp[3], 0x44);\n\tTEST_DONE();\n\n\tTEST_START(\"consume on filled buffer\");\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 4);\n\tASSERT_INT_EQ(sshbuf_consume(p1, 0), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 4);\n\tr = sshbuf_consume(p1, 64);\n\tASSERT_INT_EQ(r, SSH_ERR_MESSAGE_INCOMPLETE);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 4);\n\tASSERT_INT_EQ(sshbuf_consume(p1, 1), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 3);\n\tcdp = sshbuf_ptr(p1);\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_U8_EQ(cdp[0], 0x22);\n\tASSERT_INT_EQ(sshbuf_consume(p1, 2), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 1);\n\tcdp = sshbuf_ptr(p1);\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_U8_EQ(cdp[0], 0x44);\n\tr = sshbuf_consume(p1, 2);\n\tASSERT_INT_EQ(r, SSH_ERR_MESSAGE_INCOMPLETE);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 1);\n\tASSERT_INT_EQ(sshbuf_consume(p1, 1), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 0);\n\tr = sshbuf_consume(p1, 1);\n\tASSERT_INT_EQ(r, SSH_ERR_MESSAGE_INCOMPLETE);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"consume_end on filled buffer\");\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tr = sshbuf_reserve(p1, 4, &dp);\n\tASSERT_INT_EQ(r, 0);\n\tASSERT_PTR_NE(dp, NULL);\n\t*dp++ = 0x11;\n\t*dp++ = 0x22;\n\t*dp++ = 0x33;\n\t*dp++ = 0x44;\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 4);\n\tr = sshbuf_consume_end(p1, 5);\n\tASSERT_INT_EQ(r, SSH_ERR_MESSAGE_INCOMPLETE);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 4);\n\tASSERT_INT_EQ(sshbuf_consume_end(p1, 3), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 1);\n\tcdp = sshbuf_ptr(p1);\n\tASSERT_PTR_NE(cdp, NULL);\n\tASSERT_U8_EQ(*cdp, 0x11);\n\tr = sshbuf_consume_end(p1, 2);\n\tASSERT_INT_EQ(r, SSH_ERR_MESSAGE_INCOMPLETE);\n\tASSERT_INT_EQ(sshbuf_consume_end(p1, 1), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 0);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"fill limited buffer\");\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_set_max_size(p1, 1223), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_max_size(p1), 1223);\n\tASSERT_SIZE_T_EQ(sshbuf_avail(p1), 1223);\n\tr = sshbuf_reserve(p1, 1223, &dp);\n\tASSERT_INT_EQ(r, 0);\n\tASSERT_PTR_NE(dp, NULL);\n\tmemset(dp, 0xd7, 1223);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 1223);\n\tASSERT_SIZE_T_EQ(sshbuf_avail(p1), 0);\n\tr = sshbuf_reserve(p1, 1, &dp);\n\tASSERT_INT_EQ(r, SSH_ERR_NO_BUFFER_SPACE);\n\tASSERT_PTR_EQ(dp, NULL);\n\tTEST_DONE();\n\n\tTEST_START(\"consume and force compaction\");\n\tASSERT_INT_EQ(sshbuf_consume(p1, 223), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 1000);\n\tASSERT_SIZE_T_EQ(sshbuf_avail(p1), 223);\n\tr = sshbuf_reserve(p1, 224, &dp);\n\tASSERT_INT_EQ(r, SSH_ERR_NO_BUFFER_SPACE);\n\tASSERT_PTR_EQ(dp, NULL);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 1000);\n\tASSERT_SIZE_T_EQ(sshbuf_avail(p1), 223);\n\tr = sshbuf_reserve(p1, 223, &dp);\n\tASSERT_INT_EQ(r, 0);\n\tASSERT_PTR_NE(dp, NULL);\n\tmemset(dp, 0x7d, 223);\n\tcdp = sshbuf_ptr(p1);\n\tASSERT_PTR_NE(cdp, NULL);\n\tASSERT_MEM_FILLED_EQ(cdp, 0xd7, 1000);\n\tASSERT_MEM_FILLED_EQ(cdp + 1000, 0x7d, 223);\n\tTEST_DONE();\n\n\tTEST_START(\"resize full buffer\");\n\tr = sshbuf_set_max_size(p1, 1000);\n\tASSERT_INT_EQ(r, SSH_ERR_NO_BUFFER_SPACE);\n\tsz = roundup(1223 + SSHBUF_SIZE_INC * 3, SSHBUF_SIZE_INC);\n\tASSERT_INT_EQ(sshbuf_set_max_size(p1, sz), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_max_size(p1), sz);\n\tASSERT_SIZE_T_EQ(sshbuf_avail(p1), sz - 1223);\n\tASSERT_INT_EQ(sshbuf_len(p1), 1223);\n\tTEST_DONE();\n\n\t/* NB. uses sshbuf internals */\n\tTEST_START(\"alloc chunking\");\n\tr = sshbuf_reserve(p1, 1, &dp);\n\tASSERT_INT_EQ(r, 0);\n\tASSERT_PTR_NE(dp, NULL);\n\t*dp = 0xff;\n\tcdp = sshbuf_ptr(p1);\n\tASSERT_PTR_NE(cdp, NULL);\n\tASSERT_MEM_FILLED_EQ(cdp, 0xd7, 1000);\n\tASSERT_MEM_FILLED_EQ(cdp + 1000, 0x7d, 223);\n\tASSERT_MEM_FILLED_EQ(cdp + 1223, 0xff, 1);\n\tASSERT_SIZE_T_EQ(sshbuf_alloc(p1) % SSHBUF_SIZE_INC, 0);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"reset buffer\");\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_set_max_size(p1, 1223), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_max_size(p1), 1223);\n\tr = sshbuf_reserve(p1, 1223, &dp);\n\tASSERT_INT_EQ(r, 0);\n\tASSERT_PTR_NE(dp, NULL);\n\tmemset(dp, 0xd7, 1223);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 1223);\n\tsshbuf_reset(p1);\n\tASSERT_SIZE_T_EQ(sshbuf_max_size(p1), 1223);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_avail(p1), 1223);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include \"../test_helper/test_helper.h\"",
            "#include <string.h>",
            "#include <stdlib.h>",
            "# include <stdint.h>",
            "#include <stdio.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "void sshbuf_tests(void);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"../test_helper/test_helper.h\"\n#include <string.h>\n#include <stdlib.h>\n# include <stdint.h>\n#include <stdio.h>\n#include <sys/param.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid sshbuf_tests(void);\n\nvoid\nsshbuf_tests(void)\n{\n\tstruct sshbuf *p1;\n\tconst u_char *cdp;\n\tu_char *dp;\n\tsize_t sz;\n\tint r;\n\n\tTEST_START(\"allocate sshbuf\");\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tTEST_DONE();\n\n\tTEST_START(\"max size on fresh buffer\");\n\tASSERT_SIZE_T_GT(sshbuf_max_size(p1), 0);\n\tTEST_DONE();\n\n\tTEST_START(\"available on fresh buffer\");\n\tASSERT_SIZE_T_GT(sshbuf_avail(p1), 0);\n\tTEST_DONE();\n\n\tTEST_START(\"len = 0 on empty buffer\");\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 0);\n\tTEST_DONE();\n\n\tTEST_START(\"set valid max size\");\n\tASSERT_INT_EQ(sshbuf_set_max_size(p1, 65536), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_max_size(p1), 65536);\n\tTEST_DONE();\n\n\tTEST_START(\"available on limited buffer\");\n\tASSERT_SIZE_T_EQ(sshbuf_avail(p1), 65536);\n\tTEST_DONE();\n\n\tTEST_START(\"free\");\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"consume on empty buffer\");\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_consume(p1, 0), 0);\n\tASSERT_INT_EQ(sshbuf_consume(p1, 1), SSH_ERR_MESSAGE_INCOMPLETE);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"consume_end on empty buffer\");\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_consume_end(p1, 0), 0);\n\tASSERT_INT_EQ(sshbuf_consume_end(p1, 1), SSH_ERR_MESSAGE_INCOMPLETE);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"reserve space\");\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tr = sshbuf_reserve(p1, 1, &dp);\n\tASSERT_INT_EQ(r, 0);\n\tASSERT_PTR_NE(dp, NULL);\n\t*dp = 0x11;\n\tr = sshbuf_reserve(p1, 3, &dp);\n\tASSERT_INT_EQ(r, 0);\n\tASSERT_PTR_NE(dp, NULL);\n\t*dp++ = 0x22;\n\t*dp++ = 0x33;\n\t*dp++ = 0x44;\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_len on filled buffer\");\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 4);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_ptr on filled buffer\");\n\tcdp = sshbuf_ptr(p1);\n\tASSERT_PTR_NE(cdp, NULL);\n\tASSERT_U8_EQ(cdp[0], 0x11);\n\tASSERT_U8_EQ(cdp[1], 0x22);\n\tASSERT_U8_EQ(cdp[2], 0x33);\n\tASSERT_U8_EQ(cdp[3], 0x44);\n\tTEST_DONE();\n\n\tTEST_START(\"consume on filled buffer\");\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 4);\n\tASSERT_INT_EQ(sshbuf_consume(p1, 0), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 4);\n\tr = sshbuf_consume(p1, 64);\n\tASSERT_INT_EQ(r, SSH_ERR_MESSAGE_INCOMPLETE);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 4);\n\tASSERT_INT_EQ(sshbuf_consume(p1, 1), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 3);\n\tcdp = sshbuf_ptr(p1);\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_U8_EQ(cdp[0], 0x22);\n\tASSERT_INT_EQ(sshbuf_consume(p1, 2), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 1);\n\tcdp = sshbuf_ptr(p1);\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_U8_EQ(cdp[0], 0x44);\n\tr = sshbuf_consume(p1, 2);\n\tASSERT_INT_EQ(r, SSH_ERR_MESSAGE_INCOMPLETE);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 1);\n\tASSERT_INT_EQ(sshbuf_consume(p1, 1), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 0);\n\tr = sshbuf_consume(p1, 1);\n\tASSERT_INT_EQ(r, SSH_ERR_MESSAGE_INCOMPLETE);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"consume_end on filled buffer\");\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tr = sshbuf_reserve(p1, 4, &dp);\n\tASSERT_INT_EQ(r, 0);\n\tASSERT_PTR_NE(dp, NULL);\n\t*dp++ = 0x11;\n\t*dp++ = 0x22;\n\t*dp++ = 0x33;\n\t*dp++ = 0x44;\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 4);\n\tr = sshbuf_consume_end(p1, 5);\n\tASSERT_INT_EQ(r, SSH_ERR_MESSAGE_INCOMPLETE);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 4);\n\tASSERT_INT_EQ(sshbuf_consume_end(p1, 3), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 1);\n\tcdp = sshbuf_ptr(p1);\n\tASSERT_PTR_NE(cdp, NULL);\n\tASSERT_U8_EQ(*cdp, 0x11);\n\tr = sshbuf_consume_end(p1, 2);\n\tASSERT_INT_EQ(r, SSH_ERR_MESSAGE_INCOMPLETE);\n\tASSERT_INT_EQ(sshbuf_consume_end(p1, 1), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 0);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"fill limited buffer\");\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_set_max_size(p1, 1223), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_max_size(p1), 1223);\n\tASSERT_SIZE_T_EQ(sshbuf_avail(p1), 1223);\n\tr = sshbuf_reserve(p1, 1223, &dp);\n\tASSERT_INT_EQ(r, 0);\n\tASSERT_PTR_NE(dp, NULL);\n\tmemset(dp, 0xd7, 1223);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 1223);\n\tASSERT_SIZE_T_EQ(sshbuf_avail(p1), 0);\n\tr = sshbuf_reserve(p1, 1, &dp);\n\tASSERT_INT_EQ(r, SSH_ERR_NO_BUFFER_SPACE);\n\tASSERT_PTR_EQ(dp, NULL);\n\tTEST_DONE();\n\n\tTEST_START(\"consume and force compaction\");\n\tASSERT_INT_EQ(sshbuf_consume(p1, 223), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 1000);\n\tASSERT_SIZE_T_EQ(sshbuf_avail(p1), 223);\n\tr = sshbuf_reserve(p1, 224, &dp);\n\tASSERT_INT_EQ(r, SSH_ERR_NO_BUFFER_SPACE);\n\tASSERT_PTR_EQ(dp, NULL);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 1000);\n\tASSERT_SIZE_T_EQ(sshbuf_avail(p1), 223);\n\tr = sshbuf_reserve(p1, 223, &dp);\n\tASSERT_INT_EQ(r, 0);\n\tASSERT_PTR_NE(dp, NULL);\n\tmemset(dp, 0x7d, 223);\n\tcdp = sshbuf_ptr(p1);\n\tASSERT_PTR_NE(cdp, NULL);\n\tASSERT_MEM_FILLED_EQ(cdp, 0xd7, 1000);\n\tASSERT_MEM_FILLED_EQ(cdp + 1000, 0x7d, 223);\n\tTEST_DONE();\n\n\tTEST_START(\"resize full buffer\");\n\tr = sshbuf_set_max_size(p1, 1000);\n\tASSERT_INT_EQ(r, SSH_ERR_NO_BUFFER_SPACE);\n\tsz = roundup(1223 + SSHBUF_SIZE_INC * 3, SSHBUF_SIZE_INC);\n\tASSERT_INT_EQ(sshbuf_set_max_size(p1, sz), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_max_size(p1), sz);\n\tASSERT_SIZE_T_EQ(sshbuf_avail(p1), sz - 1223);\n\tASSERT_INT_EQ(sshbuf_len(p1), 1223);\n\tTEST_DONE();\n\n\t/* NB. uses sshbuf internals */\n\tTEST_START(\"alloc chunking\");\n\tr = sshbuf_reserve(p1, 1, &dp);\n\tASSERT_INT_EQ(r, 0);\n\tASSERT_PTR_NE(dp, NULL);\n\t*dp = 0xff;\n\tcdp = sshbuf_ptr(p1);\n\tASSERT_PTR_NE(cdp, NULL);\n\tASSERT_MEM_FILLED_EQ(cdp, 0xd7, 1000);\n\tASSERT_MEM_FILLED_EQ(cdp + 1000, 0x7d, 223);\n\tASSERT_MEM_FILLED_EQ(cdp + 1223, 0xff, 1);\n\tASSERT_SIZE_T_EQ(sshbuf_alloc(p1) % SSHBUF_SIZE_INC, 0);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"reset buffer\");\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_set_max_size(p1, 1223), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_max_size(p1), 1223);\n\tr = sshbuf_reserve(p1, 1223, &dp);\n\tASSERT_INT_EQ(r, 0);\n\tASSERT_PTR_NE(dp, NULL);\n\tmemset(dp, 0xd7, 1223);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 1223);\n\tsshbuf_reset(p1);\n\tASSERT_SIZE_T_EQ(sshbuf_max_size(p1), 1223);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_avail(p1), 1223);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"../test_helper/test_helper.h\"\n\nvoid sshbuf_tests(void);\nvoid sshbuf_getput_basic_tests(void);\nvoid sshbuf_getput_crypto_tests(void);\nvoid sshbuf_misc_tests(void);\nvoid sshbuf_fuzz_tests(void);\nvoid sshbuf_getput_fuzz_tests(void);\nvoid sshbuf_fixed(void);\n\nvoid\ntests(void)\n{\n\tsshbuf_tests();\n\tsshbuf_getput_basic_tests();\n\tsshbuf_getput_crypto_tests();\n\tsshbuf_misc_tests();\n\tsshbuf_fuzz_tests();\n\tsshbuf_getput_fuzz_tests();\n\tsshbuf_fixed();\n}"
  }
]