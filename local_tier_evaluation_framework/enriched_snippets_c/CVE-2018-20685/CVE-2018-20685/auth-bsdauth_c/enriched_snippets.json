[
  {
    "function_name": "bsdauth_free_ctx",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/auth-bsdauth.c",
    "lines": "119-128",
    "snippet": "static void\nbsdauth_free_ctx(void *ctx)\n{\n\tAuthctxt *authctxt = ctx;\n\n\tif (authctxt && authctxt->as) {\n\t\tauth_close(authctxt->as);\n\t\tauthctxt->as = NULL;\n\t}\n}",
    "includes": [
      "#include \"monitor_wrap.h\"",
      "#include \"ssh-gss.h\"",
      "#include \"log.h\"",
      "#include \"auth.h\"",
      "#include \"hostfile.h\"",
      "#include \"sshbuf.h\"",
      "#include \"sshkey.h\"",
      "#include \"xmalloc.h\"",
      "#include <stdarg.h>",
      "#include <stdio.h>",
      "#include <stdarg.h>",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "auth_close",
          "args": [
            "authctxt->as"
          ],
          "line": 125
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"monitor_wrap.h\"\n#include \"ssh-gss.h\"\n#include \"log.h\"\n#include \"auth.h\"\n#include \"hostfile.h\"\n#include \"sshbuf.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <stdarg.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nstatic void\nbsdauth_free_ctx(void *ctx)\n{\n\tAuthctxt *authctxt = ctx;\n\n\tif (authctxt && authctxt->as) {\n\t\tauth_close(authctxt->as);\n\t\tauthctxt->as = NULL;\n\t}\n}"
  },
  {
    "function_name": "bsdauth_respond",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/auth-bsdauth.c",
    "lines": "97-117",
    "snippet": "int\nbsdauth_respond(void *ctx, u_int numresponses, char **responses)\n{\n\tAuthctxt *authctxt = ctx;\n\tint authok;\n\n\tif (!authctxt->valid)\n\t\treturn -1;\n\n\tif (authctxt->as == NULL)\n\t\terror(\"bsdauth_respond: no bsd auth session\");\n\n\tif (numresponses != 1)\n\t\treturn -1;\n\n\tauthok = auth_userresponse(authctxt->as, responses[0], 0);\n\tauthctxt->as = NULL;\n\tdebug3(\"bsdauth_respond: <%s> = <%d>\", responses[0], authok);\n\n\treturn (authok == 0) ? -1 : 0;\n}",
    "includes": [
      "#include \"monitor_wrap.h\"",
      "#include \"ssh-gss.h\"",
      "#include \"log.h\"",
      "#include \"auth.h\"",
      "#include \"hostfile.h\"",
      "#include \"sshbuf.h\"",
      "#include \"sshkey.h\"",
      "#include \"xmalloc.h\"",
      "#include <stdarg.h>",
      "#include <stdio.h>",
      "#include <stdarg.h>",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "debug3",
          "args": [
            "\"bsdauth_respond: <%s> = <%d>\"",
            "responses[0]",
            "authok"
          ],
          "line": 114
        },
        "resolved": true,
        "details": {
          "function_name": "debug3",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/log.c",
          "lines": "242-250",
          "snippet": "void\ndebug3(const char *fmt,...)\n{\n\tva_list args;\n\n\tva_start(args, fmt);\n\tdo_log(SYSLOG_LEVEL_DEBUG3, fmt, args);\n\tva_end(args);\n}",
          "includes": [
            "#include \"log.h\"",
            "# include <vis.h>",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <syslog.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <fcntl.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n# include <vis.h>\n#include <errno.h>\n#include <unistd.h>\n#include <syslog.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <fcntl.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\ndebug3(const char *fmt,...)\n{\n\tva_list args;\n\n\tva_start(args, fmt);\n\tdo_log(SYSLOG_LEVEL_DEBUG3, fmt, args);\n\tva_end(args);\n}"
        }
      },
      {
        "call_info": {
          "callee": "auth_userresponse",
          "args": [
            "authctxt->as",
            "responses[0]",
            "0"
          ],
          "line": 112
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"bsdauth_respond: no bsd auth session\""
          ],
          "line": 107
        },
        "resolved": true,
        "details": {
          "function_name": "error",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/log.c",
          "lines": "162-170",
          "snippet": "void\nerror(const char *fmt,...)\n{\n\tva_list args;\n\n\tva_start(args, fmt);\n\tdo_log(SYSLOG_LEVEL_ERROR, fmt, args);\n\tva_end(args);\n}",
          "includes": [
            "#include \"log.h\"",
            "# include <vis.h>",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <syslog.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <fcntl.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n# include <vis.h>\n#include <errno.h>\n#include <unistd.h>\n#include <syslog.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <fcntl.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\nerror(const char *fmt,...)\n{\n\tva_list args;\n\n\tva_start(args, fmt);\n\tdo_log(SYSLOG_LEVEL_ERROR, fmt, args);\n\tva_end(args);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"monitor_wrap.h\"\n#include \"ssh-gss.h\"\n#include \"log.h\"\n#include \"auth.h\"\n#include \"hostfile.h\"\n#include \"sshbuf.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <stdarg.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nbsdauth_respond(void *ctx, u_int numresponses, char **responses)\n{\n\tAuthctxt *authctxt = ctx;\n\tint authok;\n\n\tif (!authctxt->valid)\n\t\treturn -1;\n\n\tif (authctxt->as == NULL)\n\t\terror(\"bsdauth_respond: no bsd auth session\");\n\n\tif (numresponses != 1)\n\t\treturn -1;\n\n\tauthok = auth_userresponse(authctxt->as, responses[0], 0);\n\tauthctxt->as = NULL;\n\tdebug3(\"bsdauth_respond: <%s> = <%d>\", responses[0], authok);\n\n\treturn (authok == 0) ? -1 : 0;\n}"
  },
  {
    "function_name": "bsdauth_query",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/auth-bsdauth.c",
    "lines": "52-95",
    "snippet": "int\nbsdauth_query(void *ctx, char **name, char **infotxt,\n   u_int *numprompts, char ***prompts, u_int **echo_on)\n{\n\tAuthctxt *authctxt = ctx;\n\tchar *challenge = NULL;\n\n\t*infotxt = NULL;\n\t*numprompts = 0;\n\t*prompts = NULL;\n\t*echo_on = NULL;\n\n\tif (authctxt->as != NULL) {\n\t\tdebug2(\"bsdauth_query: try reuse session\");\n\t\tchallenge = auth_getitem(authctxt->as, AUTHV_CHALLENGE);\n\t\tif (challenge == NULL) {\n\t\t\tauth_close(authctxt->as);\n\t\t\tauthctxt->as = NULL;\n\t\t}\n\t}\n\n\tif (challenge == NULL) {\n\t\tdebug2(\"bsdauth_query: new bsd auth session\");\n\t\tdebug3(\"bsdauth_query: style %s\",\n\t\t    authctxt->style ? authctxt->style : \"<default>\");\n\t\tauthctxt->as = auth_userchallenge(authctxt->user,\n\t\t    authctxt->style, \"auth-ssh\", &challenge);\n\t\tif (authctxt->as == NULL)\n\t\t\tchallenge = NULL;\n\t\tdebug2(\"bsdauth_query: <%s>\", challenge ? challenge : \"empty\");\n\t}\n\n\tif (challenge == NULL)\n\t\treturn -1;\n\n\t*name = xstrdup(\"\");\n\t*infotxt = xstrdup(\"\");\n\t*numprompts = 1;\n\t*prompts = xcalloc(*numprompts, sizeof(char *));\n\t*echo_on = xcalloc(*numprompts, sizeof(u_int));\n\t(*prompts)[0] = xstrdup(challenge);\n\n\treturn 0;\n}",
    "includes": [
      "#include \"monitor_wrap.h\"",
      "#include \"ssh-gss.h\"",
      "#include \"log.h\"",
      "#include \"auth.h\"",
      "#include \"hostfile.h\"",
      "#include \"sshbuf.h\"",
      "#include \"sshkey.h\"",
      "#include \"xmalloc.h\"",
      "#include <stdarg.h>",
      "#include <stdio.h>",
      "#include <stdarg.h>",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "xstrdup",
          "args": [
            "challenge"
          ],
          "line": 92
        },
        "resolved": true,
        "details": {
          "function_name": "xstrdup",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/xmalloc.c",
          "lines": "92-102",
          "snippet": "char *\nxstrdup(const char *str)\n{\n\tsize_t len;\n\tchar *cp;\n\n\tlen = strlen(str) + 1;\n\tcp = xmalloc(len);\n\tstrlcpy(cp, str, len);\n\treturn cp;\n}",
          "includes": [
            "#include \"log.h\"",
            "#include \"xmalloc.h\"",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdint.h>",
            "#include <stdarg.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n#include \"xmalloc.h\"\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdint.h>\n#include <stdarg.h>\n#include \"includes.h\"\n\nchar *\nxstrdup(const char *str)\n{\n\tsize_t len;\n\tchar *cp;\n\n\tlen = strlen(str) + 1;\n\tcp = xmalloc(len);\n\tstrlcpy(cp, str, len);\n\treturn cp;\n}"
        }
      },
      {
        "call_info": {
          "callee": "xcalloc",
          "args": [
            "*numprompts",
            "sizeof(u_int)"
          ],
          "line": 91
        },
        "resolved": true,
        "details": {
          "function_name": "xcalloc",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/xmalloc.c",
          "lines": "52-66",
          "snippet": "void *\nxcalloc(size_t nmemb, size_t size)\n{\n\tvoid *ptr;\n\n\tif (size == 0 || nmemb == 0)\n\t\tfatal(\"xcalloc: zero size\");\n\tif (SIZE_MAX / nmemb < size)\n\t\tfatal(\"xcalloc: nmemb * size > SIZE_MAX\");\n\tptr = calloc(nmemb, size);\n\tif (ptr == NULL)\n\t\tfatal(\"xcalloc: out of memory (allocating %zu bytes)\",\n\t\t    size * nmemb);\n\treturn ptr;\n}",
          "includes": [
            "#include \"log.h\"",
            "#include \"xmalloc.h\"",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdint.h>",
            "#include <stdarg.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n#include \"xmalloc.h\"\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdint.h>\n#include <stdarg.h>\n#include \"includes.h\"\n\nvoid *\nxcalloc(size_t nmemb, size_t size)\n{\n\tvoid *ptr;\n\n\tif (size == 0 || nmemb == 0)\n\t\tfatal(\"xcalloc: zero size\");\n\tif (SIZE_MAX / nmemb < size)\n\t\tfatal(\"xcalloc: nmemb * size > SIZE_MAX\");\n\tptr = calloc(nmemb, size);\n\tif (ptr == NULL)\n\t\tfatal(\"xcalloc: out of memory (allocating %zu bytes)\",\n\t\t    size * nmemb);\n\treturn ptr;\n}"
        }
      },
      {
        "call_info": {
          "callee": "debug2",
          "args": [
            "\"bsdauth_query: <%s>\"",
            "challenge ? challenge : \"empty\""
          ],
          "line": 81
        },
        "resolved": true,
        "details": {
          "function_name": "debug2",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/log.c",
          "lines": "232-240",
          "snippet": "void\ndebug2(const char *fmt,...)\n{\n\tva_list args;\n\n\tva_start(args, fmt);\n\tdo_log(SYSLOG_LEVEL_DEBUG2, fmt, args);\n\tva_end(args);\n}",
          "includes": [
            "#include \"log.h\"",
            "# include <vis.h>",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <syslog.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <fcntl.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n# include <vis.h>\n#include <errno.h>\n#include <unistd.h>\n#include <syslog.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <fcntl.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\ndebug2(const char *fmt,...)\n{\n\tva_list args;\n\n\tva_start(args, fmt);\n\tdo_log(SYSLOG_LEVEL_DEBUG2, fmt, args);\n\tva_end(args);\n}"
        }
      },
      {
        "call_info": {
          "callee": "auth_userchallenge",
          "args": [
            "authctxt->user",
            "authctxt->style",
            "\"auth-ssh\"",
            "&challenge"
          ],
          "line": 77
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug3",
          "args": [
            "\"bsdauth_query: style %s\"",
            "authctxt->style ? authctxt->style : \"<default>\""
          ],
          "line": 75
        },
        "resolved": true,
        "details": {
          "function_name": "debug3",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/log.c",
          "lines": "242-250",
          "snippet": "void\ndebug3(const char *fmt,...)\n{\n\tva_list args;\n\n\tva_start(args, fmt);\n\tdo_log(SYSLOG_LEVEL_DEBUG3, fmt, args);\n\tva_end(args);\n}",
          "includes": [
            "#include \"log.h\"",
            "# include <vis.h>",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <syslog.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <fcntl.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n# include <vis.h>\n#include <errno.h>\n#include <unistd.h>\n#include <syslog.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <fcntl.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\ndebug3(const char *fmt,...)\n{\n\tva_list args;\n\n\tva_start(args, fmt);\n\tdo_log(SYSLOG_LEVEL_DEBUG3, fmt, args);\n\tva_end(args);\n}"
        }
      },
      {
        "call_info": {
          "callee": "auth_close",
          "args": [
            "authctxt->as"
          ],
          "line": 68
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "auth_getitem",
          "args": [
            "authctxt->as",
            "AUTHV_CHALLENGE"
          ],
          "line": 66
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"monitor_wrap.h\"\n#include \"ssh-gss.h\"\n#include \"log.h\"\n#include \"auth.h\"\n#include \"hostfile.h\"\n#include \"sshbuf.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <stdarg.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nbsdauth_query(void *ctx, char **name, char **infotxt,\n   u_int *numprompts, char ***prompts, u_int **echo_on)\n{\n\tAuthctxt *authctxt = ctx;\n\tchar *challenge = NULL;\n\n\t*infotxt = NULL;\n\t*numprompts = 0;\n\t*prompts = NULL;\n\t*echo_on = NULL;\n\n\tif (authctxt->as != NULL) {\n\t\tdebug2(\"bsdauth_query: try reuse session\");\n\t\tchallenge = auth_getitem(authctxt->as, AUTHV_CHALLENGE);\n\t\tif (challenge == NULL) {\n\t\t\tauth_close(authctxt->as);\n\t\t\tauthctxt->as = NULL;\n\t\t}\n\t}\n\n\tif (challenge == NULL) {\n\t\tdebug2(\"bsdauth_query: new bsd auth session\");\n\t\tdebug3(\"bsdauth_query: style %s\",\n\t\t    authctxt->style ? authctxt->style : \"<default>\");\n\t\tauthctxt->as = auth_userchallenge(authctxt->user,\n\t\t    authctxt->style, \"auth-ssh\", &challenge);\n\t\tif (authctxt->as == NULL)\n\t\t\tchallenge = NULL;\n\t\tdebug2(\"bsdauth_query: <%s>\", challenge ? challenge : \"empty\");\n\t}\n\n\tif (challenge == NULL)\n\t\treturn -1;\n\n\t*name = xstrdup(\"\");\n\t*infotxt = xstrdup(\"\");\n\t*numprompts = 1;\n\t*prompts = xcalloc(*numprompts, sizeof(char *));\n\t*echo_on = xcalloc(*numprompts, sizeof(u_int));\n\t(*prompts)[0] = xstrdup(challenge);\n\n\treturn 0;\n}"
  },
  {
    "function_name": "bsdauth_init_ctx",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/auth-bsdauth.c",
    "lines": "46-50",
    "snippet": "static void *\nbsdauth_init_ctx(Authctxt *authctxt)\n{\n\treturn authctxt;\n}",
    "includes": [
      "#include \"monitor_wrap.h\"",
      "#include \"ssh-gss.h\"",
      "#include \"log.h\"",
      "#include \"auth.h\"",
      "#include \"hostfile.h\"",
      "#include \"sshbuf.h\"",
      "#include \"sshkey.h\"",
      "#include \"xmalloc.h\"",
      "#include <stdarg.h>",
      "#include <stdio.h>",
      "#include <stdarg.h>",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"monitor_wrap.h\"\n#include \"ssh-gss.h\"\n#include \"log.h\"\n#include \"auth.h\"\n#include \"hostfile.h\"\n#include \"sshbuf.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <stdarg.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nstatic void *\nbsdauth_init_ctx(Authctxt *authctxt)\n{\n\treturn authctxt;\n}"
  }
]