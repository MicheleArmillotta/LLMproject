[
  {
    "function_name": "tests",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/regress/unittests/authopt/tests.c",
    "lines": "560-573",
    "snippet": "void\ntests(void)\n{\n\textern char *__progname;\n\tLogLevel ll = test_is_verbose() ?\n\t    SYSLOG_LEVEL_DEBUG3 : SYSLOG_LEVEL_QUIET;\n\n\t/* test_cert_parse() are a bit spammy to error() by default... */\n\tlog_init(__progname, ll, SYSLOG_FACILITY_USER, 1);\n\n\ttest_authkeys_parse();\n\ttest_cert_parse();\n\ttest_merge();\n}",
    "includes": [
      "#include \"log.h\"",
      "#include \"misc.h\"",
      "#include \"auth-options.h\"",
      "#include \"authfile.h\"",
      "#include \"sshkey.h\"",
      "#include \"test_helper.h\"",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <stdio.h>",
      "#include <sys/param.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "test_merge",
          "args": [],
          "line": 572
        },
        "resolved": true,
        "details": {
          "function_name": "test_merge",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/regress/unittests/authopt/tests.c",
          "lines": "371-558",
          "snippet": "static void\ntest_merge(void)\n{\n\tstruct sshkey *cert;\n\tstruct sshauthopt *key_opts, *cert_opts, *merge_opts, *expected;\n\tconst char *errstr;\n\n\t/*\n\t * Prepare for a test by making some key and cert options and\n\t * attempting to merge them.\n\t */\n#define PREPARE(label, keyname, keywords) \\\n\tdo { \\\n\t\texpected = NULL; \\\n\t\tTEST_START(\"sshauthopt_merge \" label); \\\n\t\tcert = load_key(keyname \".cert\"); \\\n\t\tcert_opts = sshauthopt_from_cert(cert); \\\n\t\tASSERT_PTR_NE(cert_opts, NULL); \\\n\t\tkey_opts = sshauthopt_parse(keywords, &errstr); \\\n\t\tif (errstr != NULL) \\\n\t\t\tASSERT_STRING_EQ(errstr, \"\"); \\\n\t\tASSERT_PTR_NE(key_opts, NULL); \\\n\t\tmerge_opts = sshauthopt_merge(key_opts, \\\n\t\t    cert_opts, &errstr); \\\n\t} while (0)\n\n\t/* Cleanup stuff allocated by PREPARE() */\n#define CLEANUP() \\\n\tdo { \\\n\t\tsshauthopt_free(expected); \\\n\t\tsshauthopt_free(merge_opts); \\\n\t\tsshauthopt_free(key_opts); \\\n\t\tsshauthopt_free(cert_opts); \\\n\t\tsshkey_free(cert); \\\n\t} while (0)\n\n\t/* Check the results of PREPARE() against expectation; calls CLEANUP */\n#define CHECK_SUCCESS_AND_CLEANUP() \\\n\tdo { \\\n\t\tif (errstr != NULL) \\\n\t\t\tASSERT_STRING_EQ(errstr, \"\"); \\\n\t\tcompare_opts(merge_opts, expected); \\\n\t\tCLEANUP(); \\\n\t} while (0)\n\n\t/* Check a single case of merging of flag options */\n#define FLAG_CASE(keybase, label, keyname, keywords, mostly_off, var, val) \\\n\tdo { \\\n\t\tPREPARE(keybase \" \" label, keyname, keywords); \\\n\t\texpected = mostly_off ? \\\n\t\t    sshauthopt_new() : default_authkey_opts(); \\\n\t\texpected->var = val; \\\n\t\tASSERT_PTR_NE(expected, NULL); \\\n\t\tCHECK_SUCCESS_AND_CLEANUP(); \\\n\t\tTEST_DONE(); \\\n\t} while (0)\n\n\t/*\n\t * Fairly exhaustive exercise of a flag option. Tests\n\t * option both set and clear in certificate, set and clear in\n\t * authorized_keys and set and cleared via restrict keyword.\n\t */\n#define FLAG_TEST(keybase, keyword, var) \\\n\tdo { \\\n\t\tFLAG_CASE(keybase, \"keys:default,yes cert:default,no\", \\\n\t\t    \"no_\" keybase, keyword, 0, var, 0); \\\n\t\tFLAG_CASE(keybase,\"keys:-*,yes cert:default,no\", \\\n\t\t    \"no_\" keybase, \"restrict,\" keyword, 1, var, 0); \\\n\t\tFLAG_CASE(keybase, \"keys:default,no cert:default,no\", \\\n\t\t    \"no_\" keybase, \"no-\" keyword, 0, var, 0); \\\n\t\tFLAG_CASE(keybase, \"keys:-*,no cert:default,no\", \\\n\t\t    \"no_\" keybase, \"restrict,no-\" keyword, 1, var, 0); \\\n\t\t\\\n\t\tFLAG_CASE(keybase, \"keys:default,yes cert:-*,yes\", \\\n\t\t    \"only_\" keybase, keyword, 1, var, 1); \\\n\t\tFLAG_CASE(keybase,\"keys:-*,yes cert:-*,yes\", \\\n\t\t    \"only_\" keybase, \"restrict,\" keyword, 1, var, 1); \\\n\t\tFLAG_CASE(keybase, \"keys:default,no cert:-*,yes\", \\\n\t\t    \"only_\" keybase, \"no-\" keyword, 1, var, 0); \\\n\t\tFLAG_CASE(keybase, \"keys:-*,no cert:-*,yes\", \\\n\t\t    \"only_\" keybase, \"restrict,no-\" keyword, 1, var, 0); \\\n\t\t\\\n\t\tFLAG_CASE(keybase, \"keys:default,yes cert:-*\", \\\n\t\t    \"no_permit\", keyword, 1, var, 0); \\\n\t\tFLAG_CASE(keybase,\"keys:-*,yes cert:-*\", \\\n\t\t    \"no_permit\", \"restrict,\" keyword, 1, var, 0); \\\n\t\tFLAG_CASE(keybase, \"keys:default,no cert:-*\", \\\n\t\t    \"no_permit\", \"no-\" keyword, 1, var, 0); \\\n\t\tFLAG_CASE(keybase, \"keys:-*,no cert:-*\", \\\n\t\t    \"no_permit\", \"restrict,no-\" keyword, 1, var, 0); \\\n\t\t\\\n\t\tFLAG_CASE(keybase, \"keys:default,yes cert:*\", \\\n\t\t    \"all_permit\", keyword, 0, var, 1); \\\n\t\tFLAG_CASE(keybase,\"keys:-*,yes cert:*\", \\\n\t\t    \"all_permit\", \"restrict,\" keyword, 1, var, 1); \\\n\t\tFLAG_CASE(keybase, \"keys:default,no cert:*\", \\\n\t\t    \"all_permit\", \"no-\" keyword, 0, var, 0); \\\n\t\tFLAG_CASE(keybase, \"keys:-*,no cert:*\", \\\n\t\t    \"all_permit\", \"restrict,no-\" keyword, 1, var, 0); \\\n\t\t\\\n\t} while (0)\n\tFLAG_TEST(\"portfwd\", \"port-forwarding\", permit_port_forwarding_flag);\n\tFLAG_TEST(\"agentfwd\", \"agent-forwarding\", permit_agent_forwarding_flag);\n\tFLAG_TEST(\"pty\", \"pty\", permit_pty_flag);\n\tFLAG_TEST(\"user_rc\", \"user-rc\", permit_user_rc);\n\tFLAG_TEST(\"x11fwd\", \"x11-forwarding\", permit_x11_forwarding_flag);\n#undef FLAG_TEST\n\n\tPREPARE(\"source-address both\", \"sourceaddr\", \"from=\\\"127.0.0.1\\\"\");\n\texpected = default_authkey_opts();\n\texpected->required_from_host_cert = strdup(\"127.0.0.1/32,::1/128\");\n\tASSERT_PTR_NE(expected->required_from_host_cert, NULL);\n\texpected->required_from_host_keys = strdup(\"127.0.0.1\");\n\tASSERT_PTR_NE(expected->required_from_host_keys, NULL);\n\tCHECK_SUCCESS_AND_CLEANUP();\n\tTEST_DONE();\n\n\tPREPARE(\"source-address none\", \"all_permit\", \"\");\n\texpected = default_authkey_opts();\n\tCHECK_SUCCESS_AND_CLEANUP();\n\tTEST_DONE();\n\n\tPREPARE(\"source-address keys\", \"all_permit\", \"from=\\\"127.0.0.1\\\"\");\n\texpected = default_authkey_opts();\n\texpected->required_from_host_keys = strdup(\"127.0.0.1\");\n\tASSERT_PTR_NE(expected->required_from_host_keys, NULL);\n\tCHECK_SUCCESS_AND_CLEANUP();\n\tTEST_DONE();\n\n\tPREPARE(\"source-address cert\", \"sourceaddr\", \"\");\n\texpected = default_authkey_opts();\n\texpected->required_from_host_cert = strdup(\"127.0.0.1/32,::1/128\");\n\tASSERT_PTR_NE(expected->required_from_host_cert, NULL);\n\tCHECK_SUCCESS_AND_CLEANUP();\n\tTEST_DONE();\n\n\tPREPARE(\"force-command both\", \"force_command\", \"command=\\\"foo\\\"\");\n\texpected = default_authkey_opts();\n\texpected->force_command = strdup(\"foo\");\n\tASSERT_PTR_NE(expected->force_command, NULL);\n\tCHECK_SUCCESS_AND_CLEANUP();\n\tTEST_DONE();\n\n\tPREPARE(\"force-command none\", \"all_permit\", \"\");\n\texpected = default_authkey_opts();\n\tCHECK_SUCCESS_AND_CLEANUP();\n\tTEST_DONE();\n\n\tPREPARE(\"force-command keys\", \"all_permit\", \"command=\\\"bar\\\"\");\n\texpected = default_authkey_opts();\n\texpected->force_command = strdup(\"bar\");\n\tASSERT_PTR_NE(expected->force_command, NULL);\n\tCHECK_SUCCESS_AND_CLEANUP();\n\tTEST_DONE();\n\n\tPREPARE(\"force-command cert\", \"force_command\", \"\");\n\texpected = default_authkey_opts();\n\texpected->force_command = strdup(\"foo\");\n\tASSERT_PTR_NE(expected->force_command, NULL);\n\tCHECK_SUCCESS_AND_CLEANUP();\n\tTEST_DONE();\n\n\tPREPARE(\"force-command mismatch\", \"force_command\", \"command=\\\"bar\\\"\");\n\tASSERT_PTR_EQ(merge_opts, NULL);\n\tCLEANUP();\n\tTEST_DONE();\n\n\tPREPARE(\"tunnel\", \"all_permit\", \"tunnel=\\\"6\\\"\");\n\texpected = default_authkey_opts();\n\texpected->force_tun_device = 6;\n\tCHECK_SUCCESS_AND_CLEANUP();\n\tTEST_DONE();\n\n\tPREPARE(\"permitopen\", \"all_permit\",\n\t    \"permitopen=\\\"127.0.0.1:*\\\",permitopen=\\\"127.0.0.1:123\\\"\");\n\texpected = default_authkey_opts();\n\texpected->permitopen = commasplit(\"127.0.0.1:*,127.0.0.1:123\",\n\t    &expected->npermitopen);\n\tCHECK_SUCCESS_AND_CLEANUP();\n\tTEST_DONE();\n\n\tPREPARE(\"environment\", \"all_permit\",\n\t    \"environment=\\\"foo=a\\\",environment=\\\"bar=b\\\"\");\n\texpected = default_authkey_opts();\n\texpected->env = commasplit(\"foo=a,bar=b\", &expected->nenv);\n\tCHECK_SUCCESS_AND_CLEANUP();\n\tTEST_DONE();\n}",
          "includes": [
            "#include \"log.h\"",
            "#include \"misc.h\"",
            "#include \"auth-options.h\"",
            "#include \"authfile.h\"",
            "#include \"sshkey.h\"",
            "#include \"test_helper.h\"",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <stdio.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n#include \"misc.h\"\n#include \"auth-options.h\"\n#include \"authfile.h\"\n#include \"sshkey.h\"\n#include \"test_helper.h\"\n#include <string.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdio.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void\ntest_merge(void)\n{\n\tstruct sshkey *cert;\n\tstruct sshauthopt *key_opts, *cert_opts, *merge_opts, *expected;\n\tconst char *errstr;\n\n\t/*\n\t * Prepare for a test by making some key and cert options and\n\t * attempting to merge them.\n\t */\n#define PREPARE(label, keyname, keywords) \\\n\tdo { \\\n\t\texpected = NULL; \\\n\t\tTEST_START(\"sshauthopt_merge \" label); \\\n\t\tcert = load_key(keyname \".cert\"); \\\n\t\tcert_opts = sshauthopt_from_cert(cert); \\\n\t\tASSERT_PTR_NE(cert_opts, NULL); \\\n\t\tkey_opts = sshauthopt_parse(keywords, &errstr); \\\n\t\tif (errstr != NULL) \\\n\t\t\tASSERT_STRING_EQ(errstr, \"\"); \\\n\t\tASSERT_PTR_NE(key_opts, NULL); \\\n\t\tmerge_opts = sshauthopt_merge(key_opts, \\\n\t\t    cert_opts, &errstr); \\\n\t} while (0)\n\n\t/* Cleanup stuff allocated by PREPARE() */\n#define CLEANUP() \\\n\tdo { \\\n\t\tsshauthopt_free(expected); \\\n\t\tsshauthopt_free(merge_opts); \\\n\t\tsshauthopt_free(key_opts); \\\n\t\tsshauthopt_free(cert_opts); \\\n\t\tsshkey_free(cert); \\\n\t} while (0)\n\n\t/* Check the results of PREPARE() against expectation; calls CLEANUP */\n#define CHECK_SUCCESS_AND_CLEANUP() \\\n\tdo { \\\n\t\tif (errstr != NULL) \\\n\t\t\tASSERT_STRING_EQ(errstr, \"\"); \\\n\t\tcompare_opts(merge_opts, expected); \\\n\t\tCLEANUP(); \\\n\t} while (0)\n\n\t/* Check a single case of merging of flag options */\n#define FLAG_CASE(keybase, label, keyname, keywords, mostly_off, var, val) \\\n\tdo { \\\n\t\tPREPARE(keybase \" \" label, keyname, keywords); \\\n\t\texpected = mostly_off ? \\\n\t\t    sshauthopt_new() : default_authkey_opts(); \\\n\t\texpected->var = val; \\\n\t\tASSERT_PTR_NE(expected, NULL); \\\n\t\tCHECK_SUCCESS_AND_CLEANUP(); \\\n\t\tTEST_DONE(); \\\n\t} while (0)\n\n\t/*\n\t * Fairly exhaustive exercise of a flag option. Tests\n\t * option both set and clear in certificate, set and clear in\n\t * authorized_keys and set and cleared via restrict keyword.\n\t */\n#define FLAG_TEST(keybase, keyword, var) \\\n\tdo { \\\n\t\tFLAG_CASE(keybase, \"keys:default,yes cert:default,no\", \\\n\t\t    \"no_\" keybase, keyword, 0, var, 0); \\\n\t\tFLAG_CASE(keybase,\"keys:-*,yes cert:default,no\", \\\n\t\t    \"no_\" keybase, \"restrict,\" keyword, 1, var, 0); \\\n\t\tFLAG_CASE(keybase, \"keys:default,no cert:default,no\", \\\n\t\t    \"no_\" keybase, \"no-\" keyword, 0, var, 0); \\\n\t\tFLAG_CASE(keybase, \"keys:-*,no cert:default,no\", \\\n\t\t    \"no_\" keybase, \"restrict,no-\" keyword, 1, var, 0); \\\n\t\t\\\n\t\tFLAG_CASE(keybase, \"keys:default,yes cert:-*,yes\", \\\n\t\t    \"only_\" keybase, keyword, 1, var, 1); \\\n\t\tFLAG_CASE(keybase,\"keys:-*,yes cert:-*,yes\", \\\n\t\t    \"only_\" keybase, \"restrict,\" keyword, 1, var, 1); \\\n\t\tFLAG_CASE(keybase, \"keys:default,no cert:-*,yes\", \\\n\t\t    \"only_\" keybase, \"no-\" keyword, 1, var, 0); \\\n\t\tFLAG_CASE(keybase, \"keys:-*,no cert:-*,yes\", \\\n\t\t    \"only_\" keybase, \"restrict,no-\" keyword, 1, var, 0); \\\n\t\t\\\n\t\tFLAG_CASE(keybase, \"keys:default,yes cert:-*\", \\\n\t\t    \"no_permit\", keyword, 1, var, 0); \\\n\t\tFLAG_CASE(keybase,\"keys:-*,yes cert:-*\", \\\n\t\t    \"no_permit\", \"restrict,\" keyword, 1, var, 0); \\\n\t\tFLAG_CASE(keybase, \"keys:default,no cert:-*\", \\\n\t\t    \"no_permit\", \"no-\" keyword, 1, var, 0); \\\n\t\tFLAG_CASE(keybase, \"keys:-*,no cert:-*\", \\\n\t\t    \"no_permit\", \"restrict,no-\" keyword, 1, var, 0); \\\n\t\t\\\n\t\tFLAG_CASE(keybase, \"keys:default,yes cert:*\", \\\n\t\t    \"all_permit\", keyword, 0, var, 1); \\\n\t\tFLAG_CASE(keybase,\"keys:-*,yes cert:*\", \\\n\t\t    \"all_permit\", \"restrict,\" keyword, 1, var, 1); \\\n\t\tFLAG_CASE(keybase, \"keys:default,no cert:*\", \\\n\t\t    \"all_permit\", \"no-\" keyword, 0, var, 0); \\\n\t\tFLAG_CASE(keybase, \"keys:-*,no cert:*\", \\\n\t\t    \"all_permit\", \"restrict,no-\" keyword, 1, var, 0); \\\n\t\t\\\n\t} while (0)\n\tFLAG_TEST(\"portfwd\", \"port-forwarding\", permit_port_forwarding_flag);\n\tFLAG_TEST(\"agentfwd\", \"agent-forwarding\", permit_agent_forwarding_flag);\n\tFLAG_TEST(\"pty\", \"pty\", permit_pty_flag);\n\tFLAG_TEST(\"user_rc\", \"user-rc\", permit_user_rc);\n\tFLAG_TEST(\"x11fwd\", \"x11-forwarding\", permit_x11_forwarding_flag);\n#undef FLAG_TEST\n\n\tPREPARE(\"source-address both\", \"sourceaddr\", \"from=\\\"127.0.0.1\\\"\");\n\texpected = default_authkey_opts();\n\texpected->required_from_host_cert = strdup(\"127.0.0.1/32,::1/128\");\n\tASSERT_PTR_NE(expected->required_from_host_cert, NULL);\n\texpected->required_from_host_keys = strdup(\"127.0.0.1\");\n\tASSERT_PTR_NE(expected->required_from_host_keys, NULL);\n\tCHECK_SUCCESS_AND_CLEANUP();\n\tTEST_DONE();\n\n\tPREPARE(\"source-address none\", \"all_permit\", \"\");\n\texpected = default_authkey_opts();\n\tCHECK_SUCCESS_AND_CLEANUP();\n\tTEST_DONE();\n\n\tPREPARE(\"source-address keys\", \"all_permit\", \"from=\\\"127.0.0.1\\\"\");\n\texpected = default_authkey_opts();\n\texpected->required_from_host_keys = strdup(\"127.0.0.1\");\n\tASSERT_PTR_NE(expected->required_from_host_keys, NULL);\n\tCHECK_SUCCESS_AND_CLEANUP();\n\tTEST_DONE();\n\n\tPREPARE(\"source-address cert\", \"sourceaddr\", \"\");\n\texpected = default_authkey_opts();\n\texpected->required_from_host_cert = strdup(\"127.0.0.1/32,::1/128\");\n\tASSERT_PTR_NE(expected->required_from_host_cert, NULL);\n\tCHECK_SUCCESS_AND_CLEANUP();\n\tTEST_DONE();\n\n\tPREPARE(\"force-command both\", \"force_command\", \"command=\\\"foo\\\"\");\n\texpected = default_authkey_opts();\n\texpected->force_command = strdup(\"foo\");\n\tASSERT_PTR_NE(expected->force_command, NULL);\n\tCHECK_SUCCESS_AND_CLEANUP();\n\tTEST_DONE();\n\n\tPREPARE(\"force-command none\", \"all_permit\", \"\");\n\texpected = default_authkey_opts();\n\tCHECK_SUCCESS_AND_CLEANUP();\n\tTEST_DONE();\n\n\tPREPARE(\"force-command keys\", \"all_permit\", \"command=\\\"bar\\\"\");\n\texpected = default_authkey_opts();\n\texpected->force_command = strdup(\"bar\");\n\tASSERT_PTR_NE(expected->force_command, NULL);\n\tCHECK_SUCCESS_AND_CLEANUP();\n\tTEST_DONE();\n\n\tPREPARE(\"force-command cert\", \"force_command\", \"\");\n\texpected = default_authkey_opts();\n\texpected->force_command = strdup(\"foo\");\n\tASSERT_PTR_NE(expected->force_command, NULL);\n\tCHECK_SUCCESS_AND_CLEANUP();\n\tTEST_DONE();\n\n\tPREPARE(\"force-command mismatch\", \"force_command\", \"command=\\\"bar\\\"\");\n\tASSERT_PTR_EQ(merge_opts, NULL);\n\tCLEANUP();\n\tTEST_DONE();\n\n\tPREPARE(\"tunnel\", \"all_permit\", \"tunnel=\\\"6\\\"\");\n\texpected = default_authkey_opts();\n\texpected->force_tun_device = 6;\n\tCHECK_SUCCESS_AND_CLEANUP();\n\tTEST_DONE();\n\n\tPREPARE(\"permitopen\", \"all_permit\",\n\t    \"permitopen=\\\"127.0.0.1:*\\\",permitopen=\\\"127.0.0.1:123\\\"\");\n\texpected = default_authkey_opts();\n\texpected->permitopen = commasplit(\"127.0.0.1:*,127.0.0.1:123\",\n\t    &expected->npermitopen);\n\tCHECK_SUCCESS_AND_CLEANUP();\n\tTEST_DONE();\n\n\tPREPARE(\"environment\", \"all_permit\",\n\t    \"environment=\\\"foo=a\\\",environment=\\\"bar=b\\\"\");\n\texpected = default_authkey_opts();\n\texpected->env = commasplit(\"foo=a,bar=b\", &expected->nenv);\n\tCHECK_SUCCESS_AND_CLEANUP();\n\tTEST_DONE();\n}"
        }
      },
      {
        "call_info": {
          "callee": "test_cert_parse",
          "args": [],
          "line": 571
        },
        "resolved": true,
        "details": {
          "function_name": "test_cert_parse",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/regress/unittests/authopt/tests.c",
          "lines": "284-369",
          "snippet": "static void\ntest_cert_parse(void)\n{\n\tstruct sshkey *cert;\n\tstruct sshauthopt *opts, *expected;\n\n#define CHECK_SUCCESS_AND_CLEANUP() \\\n\tdo { \\\n\t\tcompare_opts(opts, expected); \\\n\t\tsshauthopt_free(expected); \\\n\t\tsshauthopt_free(opts); \\\n\t\tsshkey_free(cert); \\\n\t} while (0)\n#define FLAG_TEST(keybase, var) \\\n\tdo { \\\n\t\tTEST_START(\"sshauthopt_from_cert no_\" keybase); \\\n\t\tcert = load_key(\"no_\" keybase \".cert\"); \\\n\t\texpected = default_authkey_opts(); \\\n\t\texpected->var = 0; \\\n\t\topts = sshauthopt_from_cert(cert); \\\n\t\tCHECK_SUCCESS_AND_CLEANUP(); \\\n\t\tTEST_DONE(); \\\n\t\tTEST_START(\"sshauthopt_from_cert only_\" keybase); \\\n\t\tcert = load_key(\"only_\" keybase \".cert\"); \\\n\t\texpected = sshauthopt_new(); \\\n\t\tASSERT_PTR_NE(expected, NULL); \\\n\t\texpected->var = 1; \\\n\t\topts = sshauthopt_from_cert(cert); \\\n\t\tCHECK_SUCCESS_AND_CLEANUP(); \\\n\t\tTEST_DONE(); \\\n\t} while (0)\n\tFLAG_TEST(\"agentfwd\", permit_agent_forwarding_flag);\n\tFLAG_TEST(\"portfwd\", permit_port_forwarding_flag);\n\tFLAG_TEST(\"pty\", permit_pty_flag);\n\tFLAG_TEST(\"user_rc\", permit_user_rc);\n\tFLAG_TEST(\"x11fwd\", permit_x11_forwarding_flag);\n#undef FLAG_TEST\n\n\tTEST_START(\"sshauthopt_from_cert all permitted\");\n\tcert = load_key(\"all_permit.cert\");\n\texpected = default_authkey_opts();\n\topts = sshauthopt_from_cert(cert);\n\tCHECK_SUCCESS_AND_CLEANUP();\n\tTEST_DONE();\n\n\tTEST_START(\"sshauthopt_from_cert nothing permitted\");\n\tcert = load_key(\"no_permit.cert\");\n\texpected = sshauthopt_new();\n\tASSERT_PTR_NE(expected, NULL);\n\topts = sshauthopt_from_cert(cert);\n\tCHECK_SUCCESS_AND_CLEANUP();\n\tTEST_DONE();\n\n\tTEST_START(\"sshauthopt_from_cert force-command\");\n\tcert = load_key(\"force_command.cert\");\n\texpected = default_authkey_opts();\n\texpected->force_command = strdup(\"foo\");\n\tASSERT_PTR_NE(expected->force_command, NULL);\n\topts = sshauthopt_from_cert(cert);\n\tCHECK_SUCCESS_AND_CLEANUP();\n\tTEST_DONE();\n\n\tTEST_START(\"sshauthopt_from_cert source-address\");\n\tcert = load_key(\"sourceaddr.cert\");\n\texpected = default_authkey_opts();\n\texpected->required_from_host_cert = strdup(\"127.0.0.1/32,::1/128\");\n\tASSERT_PTR_NE(expected->required_from_host_cert, NULL);\n\topts = sshauthopt_from_cert(cert);\n\tCHECK_SUCCESS_AND_CLEANUP();\n\tTEST_DONE();\n#undef CHECK_SUCCESS_AND_CLEANUP\n\n#define FAIL_TEST(keybase) \\\n\tdo { \\\n\t\tTEST_START(\"sshauthopt_from_cert \" keybase); \\\n\t\tcert = load_key(keybase \".cert\"); \\\n\t\topts = sshauthopt_from_cert(cert); \\\n\t\tASSERT_PTR_EQ(opts, NULL); \\\n\t\tsshkey_free(cert); \\\n\t\tTEST_DONE(); \\\n\t} while (0)\n\tFAIL_TEST(\"host\");\n\tFAIL_TEST(\"bad_sourceaddr\");\n\tFAIL_TEST(\"unknown_critical\");\n#undef FAIL_TEST\n}",
          "includes": [
            "#include \"log.h\"",
            "#include \"misc.h\"",
            "#include \"auth-options.h\"",
            "#include \"authfile.h\"",
            "#include \"sshkey.h\"",
            "#include \"test_helper.h\"",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <stdio.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n#include \"misc.h\"\n#include \"auth-options.h\"\n#include \"authfile.h\"\n#include \"sshkey.h\"\n#include \"test_helper.h\"\n#include <string.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdio.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void\ntest_cert_parse(void)\n{\n\tstruct sshkey *cert;\n\tstruct sshauthopt *opts, *expected;\n\n#define CHECK_SUCCESS_AND_CLEANUP() \\\n\tdo { \\\n\t\tcompare_opts(opts, expected); \\\n\t\tsshauthopt_free(expected); \\\n\t\tsshauthopt_free(opts); \\\n\t\tsshkey_free(cert); \\\n\t} while (0)\n#define FLAG_TEST(keybase, var) \\\n\tdo { \\\n\t\tTEST_START(\"sshauthopt_from_cert no_\" keybase); \\\n\t\tcert = load_key(\"no_\" keybase \".cert\"); \\\n\t\texpected = default_authkey_opts(); \\\n\t\texpected->var = 0; \\\n\t\topts = sshauthopt_from_cert(cert); \\\n\t\tCHECK_SUCCESS_AND_CLEANUP(); \\\n\t\tTEST_DONE(); \\\n\t\tTEST_START(\"sshauthopt_from_cert only_\" keybase); \\\n\t\tcert = load_key(\"only_\" keybase \".cert\"); \\\n\t\texpected = sshauthopt_new(); \\\n\t\tASSERT_PTR_NE(expected, NULL); \\\n\t\texpected->var = 1; \\\n\t\topts = sshauthopt_from_cert(cert); \\\n\t\tCHECK_SUCCESS_AND_CLEANUP(); \\\n\t\tTEST_DONE(); \\\n\t} while (0)\n\tFLAG_TEST(\"agentfwd\", permit_agent_forwarding_flag);\n\tFLAG_TEST(\"portfwd\", permit_port_forwarding_flag);\n\tFLAG_TEST(\"pty\", permit_pty_flag);\n\tFLAG_TEST(\"user_rc\", permit_user_rc);\n\tFLAG_TEST(\"x11fwd\", permit_x11_forwarding_flag);\n#undef FLAG_TEST\n\n\tTEST_START(\"sshauthopt_from_cert all permitted\");\n\tcert = load_key(\"all_permit.cert\");\n\texpected = default_authkey_opts();\n\topts = sshauthopt_from_cert(cert);\n\tCHECK_SUCCESS_AND_CLEANUP();\n\tTEST_DONE();\n\n\tTEST_START(\"sshauthopt_from_cert nothing permitted\");\n\tcert = load_key(\"no_permit.cert\");\n\texpected = sshauthopt_new();\n\tASSERT_PTR_NE(expected, NULL);\n\topts = sshauthopt_from_cert(cert);\n\tCHECK_SUCCESS_AND_CLEANUP();\n\tTEST_DONE();\n\n\tTEST_START(\"sshauthopt_from_cert force-command\");\n\tcert = load_key(\"force_command.cert\");\n\texpected = default_authkey_opts();\n\texpected->force_command = strdup(\"foo\");\n\tASSERT_PTR_NE(expected->force_command, NULL);\n\topts = sshauthopt_from_cert(cert);\n\tCHECK_SUCCESS_AND_CLEANUP();\n\tTEST_DONE();\n\n\tTEST_START(\"sshauthopt_from_cert source-address\");\n\tcert = load_key(\"sourceaddr.cert\");\n\texpected = default_authkey_opts();\n\texpected->required_from_host_cert = strdup(\"127.0.0.1/32,::1/128\");\n\tASSERT_PTR_NE(expected->required_from_host_cert, NULL);\n\topts = sshauthopt_from_cert(cert);\n\tCHECK_SUCCESS_AND_CLEANUP();\n\tTEST_DONE();\n#undef CHECK_SUCCESS_AND_CLEANUP\n\n#define FAIL_TEST(keybase) \\\n\tdo { \\\n\t\tTEST_START(\"sshauthopt_from_cert \" keybase); \\\n\t\tcert = load_key(keybase \".cert\"); \\\n\t\topts = sshauthopt_from_cert(cert); \\\n\t\tASSERT_PTR_EQ(opts, NULL); \\\n\t\tsshkey_free(cert); \\\n\t\tTEST_DONE(); \\\n\t} while (0)\n\tFAIL_TEST(\"host\");\n\tFAIL_TEST(\"bad_sourceaddr\");\n\tFAIL_TEST(\"unknown_critical\");\n#undef FAIL_TEST\n}"
        }
      },
      {
        "call_info": {
          "callee": "test_authkeys_parse",
          "args": [],
          "line": 570
        },
        "resolved": true,
        "details": {
          "function_name": "test_authkeys_parse",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/regress/unittests/authopt/tests.c",
          "lines": "131-282",
          "snippet": "static void\ntest_authkeys_parse(void)\n{\n\tstruct sshauthopt *opts, *expected;\n\tconst char *errstr;\n\n#define FAIL_TEST(label, keywords) \\\n\tdo { \\\n\t\tTEST_START(\"sshauthopt_parse invalid \" label); \\\n\t\topts = sshauthopt_parse(keywords, &errstr); \\\n\t\tASSERT_PTR_EQ(opts, NULL); \\\n\t\tASSERT_PTR_NE(errstr, NULL); \\\n\t\tTEST_DONE(); \\\n\t} while (0) \n#define CHECK_SUCCESS_AND_CLEANUP() \\\n\tdo { \\\n\t\tif (errstr != NULL) \\\n\t\t\tASSERT_STRING_EQ(errstr, \"\"); \\\n\t\tcompare_opts(opts, expected); \\\n\t\tsshauthopt_free(expected); \\\n\t\tsshauthopt_free(opts); \\\n\t} while (0)\n\n\t/* Basic tests */\n\tTEST_START(\"sshauthopt_parse empty\");\n\texpected = default_authkey_opts();\n\topts = sshauthopt_parse(\"\", &errstr);\n\tCHECK_SUCCESS_AND_CLEANUP();\n\tTEST_DONE();\n\n\tTEST_START(\"sshauthopt_parse trailing whitespace\");\n\texpected = default_authkey_opts();\n\topts = sshauthopt_parse(\" \", &errstr);\n\tCHECK_SUCCESS_AND_CLEANUP();\n\tTEST_DONE();\n\n\tTEST_START(\"sshauthopt_parse restrict\");\n\texpected = default_authkey_restrict_opts();\n\topts = sshauthopt_parse(\"restrict\", &errstr);\n\tCHECK_SUCCESS_AND_CLEANUP();\n\tTEST_DONE();\n\n\t/* Invalid syntax */\n\tFAIL_TEST(\"trailing comma\", \"restrict,\");\n\tFAIL_TEST(\"bare comma\", \",\");\n\tFAIL_TEST(\"unknown option\", \"BLAH\");\n\tFAIL_TEST(\"unknown option with trailing comma\", \"BLAH,\");\n\tFAIL_TEST(\"unknown option with trailing whitespace\", \"BLAH \");\n\n\t/* force_tun_device */\n\tTEST_START(\"sshauthopt_parse tunnel explicit\");\n\texpected = default_authkey_opts();\n\texpected->force_tun_device = 1;\n\topts = sshauthopt_parse(\"tunnel=\\\"1\\\"\", &errstr);\n\tCHECK_SUCCESS_AND_CLEANUP();\n\tTEST_DONE();\n\n\tTEST_START(\"sshauthopt_parse tunnel any\");\n\texpected = default_authkey_opts();\n\texpected->force_tun_device = SSH_TUNID_ANY;\n\topts = sshauthopt_parse(\"tunnel=\\\"any\\\"\", &errstr);\n\tCHECK_SUCCESS_AND_CLEANUP();\n\tTEST_DONE();\n\n\tFAIL_TEST(\"tunnel\", \"tunnel=\\\"blah\\\"\");\n\n\t/* Flag options */\n#define FLAG_TEST(keyword, var, val) \\\n\tdo { \\\n\t\tTEST_START(\"sshauthopt_parse \" keyword); \\\n\t\texpected = default_authkey_opts(); \\\n\t\texpected->var = val; \\\n\t\topts = sshauthopt_parse(keyword, &errstr); \\\n\t\tCHECK_SUCCESS_AND_CLEANUP(); \\\n\t\texpected = default_authkey_restrict_opts(); \\\n\t\texpected->var = val; \\\n\t\topts = sshauthopt_parse(\"restrict,\"keyword, &errstr); \\\n\t\tCHECK_SUCCESS_AND_CLEANUP(); \\\n\t\tTEST_DONE(); \\\n\t} while (0)\n\t/* Positive flags */\n\tFLAG_TEST(\"cert-authority\", cert_authority, 1);\n\tFLAG_TEST(\"port-forwarding\", permit_port_forwarding_flag, 1);\n\tFLAG_TEST(\"agent-forwarding\", permit_agent_forwarding_flag, 1);\n\tFLAG_TEST(\"x11-forwarding\", permit_x11_forwarding_flag, 1);\n\tFLAG_TEST(\"pty\", permit_pty_flag, 1);\n\tFLAG_TEST(\"user-rc\", permit_user_rc, 1);\n\t/* Negative flags */\n\tFLAG_TEST(\"no-port-forwarding\", permit_port_forwarding_flag, 0);\n\tFLAG_TEST(\"no-agent-forwarding\", permit_agent_forwarding_flag, 0);\n\tFLAG_TEST(\"no-x11-forwarding\", permit_x11_forwarding_flag, 0);\n\tFLAG_TEST(\"no-pty\", permit_pty_flag, 0);\n\tFLAG_TEST(\"no-user-rc\", permit_user_rc, 0);\n#undef FLAG_TEST\n\tFAIL_TEST(\"no-cert-authority\", \"no-cert-authority\");\n\n\t/* String options */\n#define STRING_TEST(keyword, var, val) \\\n\tdo { \\\n\t\tTEST_START(\"sshauthopt_parse \" keyword); \\\n\t\texpected = default_authkey_opts(); \\\n\t\texpected->var = strdup(val); \\\n\t\tASSERT_PTR_NE(expected->var, NULL); \\\n\t\topts = sshauthopt_parse(keyword \"=\" #val, &errstr); \\\n\t\tCHECK_SUCCESS_AND_CLEANUP(); \\\n\t\texpected = default_authkey_restrict_opts(); \\\n\t\texpected->var = strdup(val); \\\n\t\tASSERT_PTR_NE(expected->var, NULL); \\\n\t\topts = sshauthopt_parse( \\\n\t\t    \"restrict,\" keyword \"=\" #val \",restrict\", &errstr); \\\n\t\tCHECK_SUCCESS_AND_CLEANUP(); \\\n\t\tTEST_DONE(); \\\n\t} while (0)\n\tSTRING_TEST(\"command\", force_command, \"/bin/true\");\n\tSTRING_TEST(\"principals\", cert_principals, \"gregor,josef,K\");\n\tSTRING_TEST(\"from\", required_from_host_keys, \"127.0.0.0/8\");\n#undef STRING_TEST\n\tFAIL_TEST(\"unquoted command\", \"command=oops\");\n\tFAIL_TEST(\"unquoted principals\", \"principals=estragon\");\n\tFAIL_TEST(\"unquoted from\", \"from=127.0.0.1\");\n\n\t/* String array option tests */\n#define ARRAY_TEST(label, keywords, var, nvar, val) \\\n\tdo { \\\n\t\tTEST_START(\"sshauthopt_parse \" label); \\\n\t\texpected = default_authkey_opts(); \\\n\t\texpected->var = commasplit(val, &expected->nvar); \\\n\t\tASSERT_PTR_NE(expected->var, NULL); \\\n\t\topts = sshauthopt_parse(keywords, &errstr); \\\n\t\tCHECK_SUCCESS_AND_CLEANUP(); \\\n\t\texpected = default_authkey_restrict_opts(); \\\n\t\texpected->var = commasplit(val, &expected->nvar); \\\n\t\tASSERT_PTR_NE(expected->var, NULL); \\\n\t\topts = sshauthopt_parse( \\\n\t\t    \"restrict,\" keywords \",restrict\", &errstr); \\\n\t\tCHECK_SUCCESS_AND_CLEANUP(); \\\n\t\tTEST_DONE(); \\\n\t} while (0)\n\tARRAY_TEST(\"environment\", \"environment=\\\"foo=1\\\",environment=\\\"bar=2\\\"\",\n\t    env, nenv, \"foo=1,bar=2\");\n\tARRAY_TEST(\"permitopen\", \"permitopen=\\\"foo:123\\\",permitopen=\\\"bar:*\\\"\",\n\t    permitopen, npermitopen, \"foo:123,bar:*\");\n#undef ARRAY_TEST\n\tFAIL_TEST(\"environment\", \"environment=\\\",=bah\\\"\");\n\tFAIL_TEST(\"permitopen port\", \"foo:bar\");\n\tFAIL_TEST(\"permitopen missing port\", \"foo:\");\n\tFAIL_TEST(\"permitopen missing port specification\", \"foo\");\n\tFAIL_TEST(\"permitopen invalid host\", \"[:\");\n\n#undef CHECK_SUCCESS_AND_CLEANUP\n#undef FAIL_TEST\n}",
          "includes": [
            "#include \"log.h\"",
            "#include \"misc.h\"",
            "#include \"auth-options.h\"",
            "#include \"authfile.h\"",
            "#include \"sshkey.h\"",
            "#include \"test_helper.h\"",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <stdio.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n#include \"misc.h\"\n#include \"auth-options.h\"\n#include \"authfile.h\"\n#include \"sshkey.h\"\n#include \"test_helper.h\"\n#include <string.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdio.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void\ntest_authkeys_parse(void)\n{\n\tstruct sshauthopt *opts, *expected;\n\tconst char *errstr;\n\n#define FAIL_TEST(label, keywords) \\\n\tdo { \\\n\t\tTEST_START(\"sshauthopt_parse invalid \" label); \\\n\t\topts = sshauthopt_parse(keywords, &errstr); \\\n\t\tASSERT_PTR_EQ(opts, NULL); \\\n\t\tASSERT_PTR_NE(errstr, NULL); \\\n\t\tTEST_DONE(); \\\n\t} while (0) \n#define CHECK_SUCCESS_AND_CLEANUP() \\\n\tdo { \\\n\t\tif (errstr != NULL) \\\n\t\t\tASSERT_STRING_EQ(errstr, \"\"); \\\n\t\tcompare_opts(opts, expected); \\\n\t\tsshauthopt_free(expected); \\\n\t\tsshauthopt_free(opts); \\\n\t} while (0)\n\n\t/* Basic tests */\n\tTEST_START(\"sshauthopt_parse empty\");\n\texpected = default_authkey_opts();\n\topts = sshauthopt_parse(\"\", &errstr);\n\tCHECK_SUCCESS_AND_CLEANUP();\n\tTEST_DONE();\n\n\tTEST_START(\"sshauthopt_parse trailing whitespace\");\n\texpected = default_authkey_opts();\n\topts = sshauthopt_parse(\" \", &errstr);\n\tCHECK_SUCCESS_AND_CLEANUP();\n\tTEST_DONE();\n\n\tTEST_START(\"sshauthopt_parse restrict\");\n\texpected = default_authkey_restrict_opts();\n\topts = sshauthopt_parse(\"restrict\", &errstr);\n\tCHECK_SUCCESS_AND_CLEANUP();\n\tTEST_DONE();\n\n\t/* Invalid syntax */\n\tFAIL_TEST(\"trailing comma\", \"restrict,\");\n\tFAIL_TEST(\"bare comma\", \",\");\n\tFAIL_TEST(\"unknown option\", \"BLAH\");\n\tFAIL_TEST(\"unknown option with trailing comma\", \"BLAH,\");\n\tFAIL_TEST(\"unknown option with trailing whitespace\", \"BLAH \");\n\n\t/* force_tun_device */\n\tTEST_START(\"sshauthopt_parse tunnel explicit\");\n\texpected = default_authkey_opts();\n\texpected->force_tun_device = 1;\n\topts = sshauthopt_parse(\"tunnel=\\\"1\\\"\", &errstr);\n\tCHECK_SUCCESS_AND_CLEANUP();\n\tTEST_DONE();\n\n\tTEST_START(\"sshauthopt_parse tunnel any\");\n\texpected = default_authkey_opts();\n\texpected->force_tun_device = SSH_TUNID_ANY;\n\topts = sshauthopt_parse(\"tunnel=\\\"any\\\"\", &errstr);\n\tCHECK_SUCCESS_AND_CLEANUP();\n\tTEST_DONE();\n\n\tFAIL_TEST(\"tunnel\", \"tunnel=\\\"blah\\\"\");\n\n\t/* Flag options */\n#define FLAG_TEST(keyword, var, val) \\\n\tdo { \\\n\t\tTEST_START(\"sshauthopt_parse \" keyword); \\\n\t\texpected = default_authkey_opts(); \\\n\t\texpected->var = val; \\\n\t\topts = sshauthopt_parse(keyword, &errstr); \\\n\t\tCHECK_SUCCESS_AND_CLEANUP(); \\\n\t\texpected = default_authkey_restrict_opts(); \\\n\t\texpected->var = val; \\\n\t\topts = sshauthopt_parse(\"restrict,\"keyword, &errstr); \\\n\t\tCHECK_SUCCESS_AND_CLEANUP(); \\\n\t\tTEST_DONE(); \\\n\t} while (0)\n\t/* Positive flags */\n\tFLAG_TEST(\"cert-authority\", cert_authority, 1);\n\tFLAG_TEST(\"port-forwarding\", permit_port_forwarding_flag, 1);\n\tFLAG_TEST(\"agent-forwarding\", permit_agent_forwarding_flag, 1);\n\tFLAG_TEST(\"x11-forwarding\", permit_x11_forwarding_flag, 1);\n\tFLAG_TEST(\"pty\", permit_pty_flag, 1);\n\tFLAG_TEST(\"user-rc\", permit_user_rc, 1);\n\t/* Negative flags */\n\tFLAG_TEST(\"no-port-forwarding\", permit_port_forwarding_flag, 0);\n\tFLAG_TEST(\"no-agent-forwarding\", permit_agent_forwarding_flag, 0);\n\tFLAG_TEST(\"no-x11-forwarding\", permit_x11_forwarding_flag, 0);\n\tFLAG_TEST(\"no-pty\", permit_pty_flag, 0);\n\tFLAG_TEST(\"no-user-rc\", permit_user_rc, 0);\n#undef FLAG_TEST\n\tFAIL_TEST(\"no-cert-authority\", \"no-cert-authority\");\n\n\t/* String options */\n#define STRING_TEST(keyword, var, val) \\\n\tdo { \\\n\t\tTEST_START(\"sshauthopt_parse \" keyword); \\\n\t\texpected = default_authkey_opts(); \\\n\t\texpected->var = strdup(val); \\\n\t\tASSERT_PTR_NE(expected->var, NULL); \\\n\t\topts = sshauthopt_parse(keyword \"=\" #val, &errstr); \\\n\t\tCHECK_SUCCESS_AND_CLEANUP(); \\\n\t\texpected = default_authkey_restrict_opts(); \\\n\t\texpected->var = strdup(val); \\\n\t\tASSERT_PTR_NE(expected->var, NULL); \\\n\t\topts = sshauthopt_parse( \\\n\t\t    \"restrict,\" keyword \"=\" #val \",restrict\", &errstr); \\\n\t\tCHECK_SUCCESS_AND_CLEANUP(); \\\n\t\tTEST_DONE(); \\\n\t} while (0)\n\tSTRING_TEST(\"command\", force_command, \"/bin/true\");\n\tSTRING_TEST(\"principals\", cert_principals, \"gregor,josef,K\");\n\tSTRING_TEST(\"from\", required_from_host_keys, \"127.0.0.0/8\");\n#undef STRING_TEST\n\tFAIL_TEST(\"unquoted command\", \"command=oops\");\n\tFAIL_TEST(\"unquoted principals\", \"principals=estragon\");\n\tFAIL_TEST(\"unquoted from\", \"from=127.0.0.1\");\n\n\t/* String array option tests */\n#define ARRAY_TEST(label, keywords, var, nvar, val) \\\n\tdo { \\\n\t\tTEST_START(\"sshauthopt_parse \" label); \\\n\t\texpected = default_authkey_opts(); \\\n\t\texpected->var = commasplit(val, &expected->nvar); \\\n\t\tASSERT_PTR_NE(expected->var, NULL); \\\n\t\topts = sshauthopt_parse(keywords, &errstr); \\\n\t\tCHECK_SUCCESS_AND_CLEANUP(); \\\n\t\texpected = default_authkey_restrict_opts(); \\\n\t\texpected->var = commasplit(val, &expected->nvar); \\\n\t\tASSERT_PTR_NE(expected->var, NULL); \\\n\t\topts = sshauthopt_parse( \\\n\t\t    \"restrict,\" keywords \",restrict\", &errstr); \\\n\t\tCHECK_SUCCESS_AND_CLEANUP(); \\\n\t\tTEST_DONE(); \\\n\t} while (0)\n\tARRAY_TEST(\"environment\", \"environment=\\\"foo=1\\\",environment=\\\"bar=2\\\"\",\n\t    env, nenv, \"foo=1,bar=2\");\n\tARRAY_TEST(\"permitopen\", \"permitopen=\\\"foo:123\\\",permitopen=\\\"bar:*\\\"\",\n\t    permitopen, npermitopen, \"foo:123,bar:*\");\n#undef ARRAY_TEST\n\tFAIL_TEST(\"environment\", \"environment=\\\",=bah\\\"\");\n\tFAIL_TEST(\"permitopen port\", \"foo:bar\");\n\tFAIL_TEST(\"permitopen missing port\", \"foo:\");\n\tFAIL_TEST(\"permitopen missing port specification\", \"foo\");\n\tFAIL_TEST(\"permitopen invalid host\", \"[:\");\n\n#undef CHECK_SUCCESS_AND_CLEANUP\n#undef FAIL_TEST\n}"
        }
      },
      {
        "call_info": {
          "callee": "log_init",
          "args": [
            "__progname",
            "ll",
            "SYSLOG_FACILITY_USER",
            "1"
          ],
          "line": 568
        },
        "resolved": true,
        "details": {
          "function_name": "log_init",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/log.c",
          "lines": "256-336",
          "snippet": "void\nlog_init(char *av0, LogLevel level, SyslogFacility facility, int on_stderr)\n{\n#if defined(HAVE_OPENLOG_R) && defined(SYSLOG_DATA_INIT)\n\tstruct syslog_data sdata = SYSLOG_DATA_INIT;\n#endif\n\n\targv0 = av0;\n\n\tif (log_change_level(level) != 0) {\n\t\tfprintf(stderr, \"Unrecognized internal syslog level code %d\\n\",\n\t\t    (int) level);\n\t\texit(1);\n\t}\n\n\tlog_handler = NULL;\n\tlog_handler_ctx = NULL;\n\n\tlog_on_stderr = on_stderr;\n\tif (on_stderr)\n\t\treturn;\n\n\tswitch (facility) {\n\tcase SYSLOG_FACILITY_DAEMON:\n\t\tlog_facility = LOG_DAEMON;\n\t\tbreak;\n\tcase SYSLOG_FACILITY_USER:\n\t\tlog_facility = LOG_USER;\n\t\tbreak;\n\tcase SYSLOG_FACILITY_AUTH:\n\t\tlog_facility = LOG_AUTH;\n\t\tbreak;\n#ifdef LOG_AUTHPRIV\n\tcase SYSLOG_FACILITY_AUTHPRIV:\n\t\tlog_facility = LOG_AUTHPRIV;\n\t\tbreak;\n#endif\n\tcase SYSLOG_FACILITY_LOCAL0:\n\t\tlog_facility = LOG_LOCAL0;\n\t\tbreak;\n\tcase SYSLOG_FACILITY_LOCAL1:\n\t\tlog_facility = LOG_LOCAL1;\n\t\tbreak;\n\tcase SYSLOG_FACILITY_LOCAL2:\n\t\tlog_facility = LOG_LOCAL2;\n\t\tbreak;\n\tcase SYSLOG_FACILITY_LOCAL3:\n\t\tlog_facility = LOG_LOCAL3;\n\t\tbreak;\n\tcase SYSLOG_FACILITY_LOCAL4:\n\t\tlog_facility = LOG_LOCAL4;\n\t\tbreak;\n\tcase SYSLOG_FACILITY_LOCAL5:\n\t\tlog_facility = LOG_LOCAL5;\n\t\tbreak;\n\tcase SYSLOG_FACILITY_LOCAL6:\n\t\tlog_facility = LOG_LOCAL6;\n\t\tbreak;\n\tcase SYSLOG_FACILITY_LOCAL7:\n\t\tlog_facility = LOG_LOCAL7;\n\t\tbreak;\n\tdefault:\n\t\tfprintf(stderr,\n\t\t    \"Unrecognized internal syslog facility code %d\\n\",\n\t\t    (int) facility);\n\t\texit(1);\n\t}\n\n\t/*\n\t * If an external library (eg libwrap) attempts to use syslog\n\t * immediately after reexec, syslog may be pointing to the wrong\n\t * facility, so we force an open/close of syslog here.\n\t */\n#if defined(HAVE_OPENLOG_R) && defined(SYSLOG_DATA_INIT)\n\topenlog_r(argv0 ? argv0 : __progname, LOG_PID, log_facility, &sdata);\n\tcloselog_r(&sdata);\n#else\n\topenlog(argv0 ? argv0 : __progname, LOG_PID, log_facility);\n\tcloselog();\n#endif\n}",
          "includes": [
            "#include \"log.h\"",
            "# include <vis.h>",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <syslog.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <fcntl.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static int log_on_stderr = 1;",
            "static int log_facility = LOG_AUTH;",
            "static char *argv0;",
            "static log_handler_fn *log_handler;",
            "static void *log_handler_ctx;",
            "extern char *__progname;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n# include <vis.h>\n#include <errno.h>\n#include <unistd.h>\n#include <syslog.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <fcntl.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nstatic int log_on_stderr = 1;\nstatic int log_facility = LOG_AUTH;\nstatic char *argv0;\nstatic log_handler_fn *log_handler;\nstatic void *log_handler_ctx;\nextern char *__progname;\n\nvoid\nlog_init(char *av0, LogLevel level, SyslogFacility facility, int on_stderr)\n{\n#if defined(HAVE_OPENLOG_R) && defined(SYSLOG_DATA_INIT)\n\tstruct syslog_data sdata = SYSLOG_DATA_INIT;\n#endif\n\n\targv0 = av0;\n\n\tif (log_change_level(level) != 0) {\n\t\tfprintf(stderr, \"Unrecognized internal syslog level code %d\\n\",\n\t\t    (int) level);\n\t\texit(1);\n\t}\n\n\tlog_handler = NULL;\n\tlog_handler_ctx = NULL;\n\n\tlog_on_stderr = on_stderr;\n\tif (on_stderr)\n\t\treturn;\n\n\tswitch (facility) {\n\tcase SYSLOG_FACILITY_DAEMON:\n\t\tlog_facility = LOG_DAEMON;\n\t\tbreak;\n\tcase SYSLOG_FACILITY_USER:\n\t\tlog_facility = LOG_USER;\n\t\tbreak;\n\tcase SYSLOG_FACILITY_AUTH:\n\t\tlog_facility = LOG_AUTH;\n\t\tbreak;\n#ifdef LOG_AUTHPRIV\n\tcase SYSLOG_FACILITY_AUTHPRIV:\n\t\tlog_facility = LOG_AUTHPRIV;\n\t\tbreak;\n#endif\n\tcase SYSLOG_FACILITY_LOCAL0:\n\t\tlog_facility = LOG_LOCAL0;\n\t\tbreak;\n\tcase SYSLOG_FACILITY_LOCAL1:\n\t\tlog_facility = LOG_LOCAL1;\n\t\tbreak;\n\tcase SYSLOG_FACILITY_LOCAL2:\n\t\tlog_facility = LOG_LOCAL2;\n\t\tbreak;\n\tcase SYSLOG_FACILITY_LOCAL3:\n\t\tlog_facility = LOG_LOCAL3;\n\t\tbreak;\n\tcase SYSLOG_FACILITY_LOCAL4:\n\t\tlog_facility = LOG_LOCAL4;\n\t\tbreak;\n\tcase SYSLOG_FACILITY_LOCAL5:\n\t\tlog_facility = LOG_LOCAL5;\n\t\tbreak;\n\tcase SYSLOG_FACILITY_LOCAL6:\n\t\tlog_facility = LOG_LOCAL6;\n\t\tbreak;\n\tcase SYSLOG_FACILITY_LOCAL7:\n\t\tlog_facility = LOG_LOCAL7;\n\t\tbreak;\n\tdefault:\n\t\tfprintf(stderr,\n\t\t    \"Unrecognized internal syslog facility code %d\\n\",\n\t\t    (int) facility);\n\t\texit(1);\n\t}\n\n\t/*\n\t * If an external library (eg libwrap) attempts to use syslog\n\t * immediately after reexec, syslog may be pointing to the wrong\n\t * facility, so we force an open/close of syslog here.\n\t */\n#if defined(HAVE_OPENLOG_R) && defined(SYSLOG_DATA_INIT)\n\topenlog_r(argv0 ? argv0 : __progname, LOG_PID, log_facility, &sdata);\n\tcloselog_r(&sdata);\n#else\n\topenlog(argv0 ? argv0 : __progname, LOG_PID, log_facility);\n\tcloselog();\n#endif\n}"
        }
      },
      {
        "call_info": {
          "callee": "test_is_verbose",
          "args": [],
          "line": 564
        },
        "resolved": true,
        "details": {
          "function_name": "test_is_verbose",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/regress/unittests/test_helper/test_helper.c",
          "lines": "169-173",
          "snippet": "int\ntest_is_verbose()\n{\n\treturn verbose_mode;\n}",
          "includes": [
            "#include \"atomicio.h\"",
            "#include \"test_helper.h\"",
            "# include <vis.h>",
            "#include <openssl/bn.h>",
            "#include <signal.h>",
            "#include <unistd.h>",
            "#include <assert.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "# include <stdint.h>",
            "#include <stdio.h>",
            "#include <fcntl.h>",
            "#include <sys/uio.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static int verbose_mode = 0;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"atomicio.h\"\n#include \"test_helper.h\"\n# include <vis.h>\n#include <openssl/bn.h>\n#include <signal.h>\n#include <unistd.h>\n#include <assert.h>\n#include <string.h>\n#include <stdlib.h>\n# include <stdint.h>\n#include <stdio.h>\n#include <fcntl.h>\n#include <sys/uio.h>\n#include <sys/param.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nstatic int verbose_mode = 0;\n\nint\ntest_is_verbose()\n{\n\treturn verbose_mode;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"log.h\"\n#include \"misc.h\"\n#include \"auth-options.h\"\n#include \"authfile.h\"\n#include \"sshkey.h\"\n#include \"test_helper.h\"\n#include <string.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdio.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nvoid\ntests(void)\n{\n\textern char *__progname;\n\tLogLevel ll = test_is_verbose() ?\n\t    SYSLOG_LEVEL_DEBUG3 : SYSLOG_LEVEL_QUIET;\n\n\t/* test_cert_parse() are a bit spammy to error() by default... */\n\tlog_init(__progname, ll, SYSLOG_FACILITY_USER, 1);\n\n\ttest_authkeys_parse();\n\ttest_cert_parse();\n\ttest_merge();\n}"
  },
  {
    "function_name": "test_merge",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/regress/unittests/authopt/tests.c",
    "lines": "371-558",
    "snippet": "static void\ntest_merge(void)\n{\n\tstruct sshkey *cert;\n\tstruct sshauthopt *key_opts, *cert_opts, *merge_opts, *expected;\n\tconst char *errstr;\n\n\t/*\n\t * Prepare for a test by making some key and cert options and\n\t * attempting to merge them.\n\t */\n#define PREPARE(label, keyname, keywords) \\\n\tdo { \\\n\t\texpected = NULL; \\\n\t\tTEST_START(\"sshauthopt_merge \" label); \\\n\t\tcert = load_key(keyname \".cert\"); \\\n\t\tcert_opts = sshauthopt_from_cert(cert); \\\n\t\tASSERT_PTR_NE(cert_opts, NULL); \\\n\t\tkey_opts = sshauthopt_parse(keywords, &errstr); \\\n\t\tif (errstr != NULL) \\\n\t\t\tASSERT_STRING_EQ(errstr, \"\"); \\\n\t\tASSERT_PTR_NE(key_opts, NULL); \\\n\t\tmerge_opts = sshauthopt_merge(key_opts, \\\n\t\t    cert_opts, &errstr); \\\n\t} while (0)\n\n\t/* Cleanup stuff allocated by PREPARE() */\n#define CLEANUP() \\\n\tdo { \\\n\t\tsshauthopt_free(expected); \\\n\t\tsshauthopt_free(merge_opts); \\\n\t\tsshauthopt_free(key_opts); \\\n\t\tsshauthopt_free(cert_opts); \\\n\t\tsshkey_free(cert); \\\n\t} while (0)\n\n\t/* Check the results of PREPARE() against expectation; calls CLEANUP */\n#define CHECK_SUCCESS_AND_CLEANUP() \\\n\tdo { \\\n\t\tif (errstr != NULL) \\\n\t\t\tASSERT_STRING_EQ(errstr, \"\"); \\\n\t\tcompare_opts(merge_opts, expected); \\\n\t\tCLEANUP(); \\\n\t} while (0)\n\n\t/* Check a single case of merging of flag options */\n#define FLAG_CASE(keybase, label, keyname, keywords, mostly_off, var, val) \\\n\tdo { \\\n\t\tPREPARE(keybase \" \" label, keyname, keywords); \\\n\t\texpected = mostly_off ? \\\n\t\t    sshauthopt_new() : default_authkey_opts(); \\\n\t\texpected->var = val; \\\n\t\tASSERT_PTR_NE(expected, NULL); \\\n\t\tCHECK_SUCCESS_AND_CLEANUP(); \\\n\t\tTEST_DONE(); \\\n\t} while (0)\n\n\t/*\n\t * Fairly exhaustive exercise of a flag option. Tests\n\t * option both set and clear in certificate, set and clear in\n\t * authorized_keys and set and cleared via restrict keyword.\n\t */\n#define FLAG_TEST(keybase, keyword, var) \\\n\tdo { \\\n\t\tFLAG_CASE(keybase, \"keys:default,yes cert:default,no\", \\\n\t\t    \"no_\" keybase, keyword, 0, var, 0); \\\n\t\tFLAG_CASE(keybase,\"keys:-*,yes cert:default,no\", \\\n\t\t    \"no_\" keybase, \"restrict,\" keyword, 1, var, 0); \\\n\t\tFLAG_CASE(keybase, \"keys:default,no cert:default,no\", \\\n\t\t    \"no_\" keybase, \"no-\" keyword, 0, var, 0); \\\n\t\tFLAG_CASE(keybase, \"keys:-*,no cert:default,no\", \\\n\t\t    \"no_\" keybase, \"restrict,no-\" keyword, 1, var, 0); \\\n\t\t\\\n\t\tFLAG_CASE(keybase, \"keys:default,yes cert:-*,yes\", \\\n\t\t    \"only_\" keybase, keyword, 1, var, 1); \\\n\t\tFLAG_CASE(keybase,\"keys:-*,yes cert:-*,yes\", \\\n\t\t    \"only_\" keybase, \"restrict,\" keyword, 1, var, 1); \\\n\t\tFLAG_CASE(keybase, \"keys:default,no cert:-*,yes\", \\\n\t\t    \"only_\" keybase, \"no-\" keyword, 1, var, 0); \\\n\t\tFLAG_CASE(keybase, \"keys:-*,no cert:-*,yes\", \\\n\t\t    \"only_\" keybase, \"restrict,no-\" keyword, 1, var, 0); \\\n\t\t\\\n\t\tFLAG_CASE(keybase, \"keys:default,yes cert:-*\", \\\n\t\t    \"no_permit\", keyword, 1, var, 0); \\\n\t\tFLAG_CASE(keybase,\"keys:-*,yes cert:-*\", \\\n\t\t    \"no_permit\", \"restrict,\" keyword, 1, var, 0); \\\n\t\tFLAG_CASE(keybase, \"keys:default,no cert:-*\", \\\n\t\t    \"no_permit\", \"no-\" keyword, 1, var, 0); \\\n\t\tFLAG_CASE(keybase, \"keys:-*,no cert:-*\", \\\n\t\t    \"no_permit\", \"restrict,no-\" keyword, 1, var, 0); \\\n\t\t\\\n\t\tFLAG_CASE(keybase, \"keys:default,yes cert:*\", \\\n\t\t    \"all_permit\", keyword, 0, var, 1); \\\n\t\tFLAG_CASE(keybase,\"keys:-*,yes cert:*\", \\\n\t\t    \"all_permit\", \"restrict,\" keyword, 1, var, 1); \\\n\t\tFLAG_CASE(keybase, \"keys:default,no cert:*\", \\\n\t\t    \"all_permit\", \"no-\" keyword, 0, var, 0); \\\n\t\tFLAG_CASE(keybase, \"keys:-*,no cert:*\", \\\n\t\t    \"all_permit\", \"restrict,no-\" keyword, 1, var, 0); \\\n\t\t\\\n\t} while (0)\n\tFLAG_TEST(\"portfwd\", \"port-forwarding\", permit_port_forwarding_flag);\n\tFLAG_TEST(\"agentfwd\", \"agent-forwarding\", permit_agent_forwarding_flag);\n\tFLAG_TEST(\"pty\", \"pty\", permit_pty_flag);\n\tFLAG_TEST(\"user_rc\", \"user-rc\", permit_user_rc);\n\tFLAG_TEST(\"x11fwd\", \"x11-forwarding\", permit_x11_forwarding_flag);\n#undef FLAG_TEST\n\n\tPREPARE(\"source-address both\", \"sourceaddr\", \"from=\\\"127.0.0.1\\\"\");\n\texpected = default_authkey_opts();\n\texpected->required_from_host_cert = strdup(\"127.0.0.1/32,::1/128\");\n\tASSERT_PTR_NE(expected->required_from_host_cert, NULL);\n\texpected->required_from_host_keys = strdup(\"127.0.0.1\");\n\tASSERT_PTR_NE(expected->required_from_host_keys, NULL);\n\tCHECK_SUCCESS_AND_CLEANUP();\n\tTEST_DONE();\n\n\tPREPARE(\"source-address none\", \"all_permit\", \"\");\n\texpected = default_authkey_opts();\n\tCHECK_SUCCESS_AND_CLEANUP();\n\tTEST_DONE();\n\n\tPREPARE(\"source-address keys\", \"all_permit\", \"from=\\\"127.0.0.1\\\"\");\n\texpected = default_authkey_opts();\n\texpected->required_from_host_keys = strdup(\"127.0.0.1\");\n\tASSERT_PTR_NE(expected->required_from_host_keys, NULL);\n\tCHECK_SUCCESS_AND_CLEANUP();\n\tTEST_DONE();\n\n\tPREPARE(\"source-address cert\", \"sourceaddr\", \"\");\n\texpected = default_authkey_opts();\n\texpected->required_from_host_cert = strdup(\"127.0.0.1/32,::1/128\");\n\tASSERT_PTR_NE(expected->required_from_host_cert, NULL);\n\tCHECK_SUCCESS_AND_CLEANUP();\n\tTEST_DONE();\n\n\tPREPARE(\"force-command both\", \"force_command\", \"command=\\\"foo\\\"\");\n\texpected = default_authkey_opts();\n\texpected->force_command = strdup(\"foo\");\n\tASSERT_PTR_NE(expected->force_command, NULL);\n\tCHECK_SUCCESS_AND_CLEANUP();\n\tTEST_DONE();\n\n\tPREPARE(\"force-command none\", \"all_permit\", \"\");\n\texpected = default_authkey_opts();\n\tCHECK_SUCCESS_AND_CLEANUP();\n\tTEST_DONE();\n\n\tPREPARE(\"force-command keys\", \"all_permit\", \"command=\\\"bar\\\"\");\n\texpected = default_authkey_opts();\n\texpected->force_command = strdup(\"bar\");\n\tASSERT_PTR_NE(expected->force_command, NULL);\n\tCHECK_SUCCESS_AND_CLEANUP();\n\tTEST_DONE();\n\n\tPREPARE(\"force-command cert\", \"force_command\", \"\");\n\texpected = default_authkey_opts();\n\texpected->force_command = strdup(\"foo\");\n\tASSERT_PTR_NE(expected->force_command, NULL);\n\tCHECK_SUCCESS_AND_CLEANUP();\n\tTEST_DONE();\n\n\tPREPARE(\"force-command mismatch\", \"force_command\", \"command=\\\"bar\\\"\");\n\tASSERT_PTR_EQ(merge_opts, NULL);\n\tCLEANUP();\n\tTEST_DONE();\n\n\tPREPARE(\"tunnel\", \"all_permit\", \"tunnel=\\\"6\\\"\");\n\texpected = default_authkey_opts();\n\texpected->force_tun_device = 6;\n\tCHECK_SUCCESS_AND_CLEANUP();\n\tTEST_DONE();\n\n\tPREPARE(\"permitopen\", \"all_permit\",\n\t    \"permitopen=\\\"127.0.0.1:*\\\",permitopen=\\\"127.0.0.1:123\\\"\");\n\texpected = default_authkey_opts();\n\texpected->permitopen = commasplit(\"127.0.0.1:*,127.0.0.1:123\",\n\t    &expected->npermitopen);\n\tCHECK_SUCCESS_AND_CLEANUP();\n\tTEST_DONE();\n\n\tPREPARE(\"environment\", \"all_permit\",\n\t    \"environment=\\\"foo=a\\\",environment=\\\"bar=b\\\"\");\n\texpected = default_authkey_opts();\n\texpected->env = commasplit(\"foo=a,bar=b\", &expected->nenv);\n\tCHECK_SUCCESS_AND_CLEANUP();\n\tTEST_DONE();\n}",
    "includes": [
      "#include \"log.h\"",
      "#include \"misc.h\"",
      "#include \"auth-options.h\"",
      "#include \"authfile.h\"",
      "#include \"sshkey.h\"",
      "#include \"test_helper.h\"",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <stdio.h>",
      "#include <sys/param.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "TEST_DONE",
          "args": [],
          "line": 557
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "CHECK_SUCCESS_AND_CLEANUP",
          "args": [],
          "line": 556
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "commasplit",
          "args": [
            "\"foo=a,bar=b\"",
            "&expected->nenv"
          ],
          "line": 555
        },
        "resolved": true,
        "details": {
          "function_name": "commasplit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/regress/unittests/authopt/tests.c",
          "lines": "65-83",
          "snippet": "static char **\ncommasplit(const char *s, size_t *np)\n{\n\tchar *ocp, *cp, *cp2, **ret = NULL;\n\tsize_t n;\n\n\tocp = cp = strdup(s);\n\tASSERT_PTR_NE(cp, NULL);\n\tfor (n = 0; (cp2 = strsep(&cp, \",\")) != NULL;) {\n\t\tret = recallocarray(ret, n, n + 1, sizeof(*ret));\n\t\tASSERT_PTR_NE(ret, NULL);\n\t\tcp2 = strdup(cp2);\n\t\tASSERT_PTR_NE(cp2, NULL);\n\t\tret[n++] = cp2;\n\t}\n\tfree(ocp);\n\t*np = n;\n\treturn ret;\n}",
          "includes": [
            "#include \"log.h\"",
            "#include \"misc.h\"",
            "#include \"auth-options.h\"",
            "#include \"authfile.h\"",
            "#include \"sshkey.h\"",
            "#include \"test_helper.h\"",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <stdio.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n#include \"misc.h\"\n#include \"auth-options.h\"\n#include \"authfile.h\"\n#include \"sshkey.h\"\n#include \"test_helper.h\"\n#include <string.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdio.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic char **\ncommasplit(const char *s, size_t *np)\n{\n\tchar *ocp, *cp, *cp2, **ret = NULL;\n\tsize_t n;\n\n\tocp = cp = strdup(s);\n\tASSERT_PTR_NE(cp, NULL);\n\tfor (n = 0; (cp2 = strsep(&cp, \",\")) != NULL;) {\n\t\tret = recallocarray(ret, n, n + 1, sizeof(*ret));\n\t\tASSERT_PTR_NE(ret, NULL);\n\t\tcp2 = strdup(cp2);\n\t\tASSERT_PTR_NE(cp2, NULL);\n\t\tret[n++] = cp2;\n\t}\n\tfree(ocp);\n\t*np = n;\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "default_authkey_opts",
          "args": [],
          "line": 554
        },
        "resolved": true,
        "details": {
          "function_name": "default_authkey_opts",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/regress/unittests/authopt/tests.c",
          "lines": "36-48",
          "snippet": "static struct sshauthopt *\ndefault_authkey_opts(void)\n{\n\tstruct sshauthopt *ret = sshauthopt_new();\n\n\tASSERT_PTR_NE(ret, NULL);\n\tret->permit_port_forwarding_flag = 1;\n\tret->permit_agent_forwarding_flag = 1;\n\tret->permit_x11_forwarding_flag = 1;\n\tret->permit_pty_flag = 1;\n\tret->permit_user_rc = 1;\n\treturn ret;\n}",
          "includes": [
            "#include \"log.h\"",
            "#include \"misc.h\"",
            "#include \"auth-options.h\"",
            "#include \"authfile.h\"",
            "#include \"sshkey.h\"",
            "#include \"test_helper.h\"",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <stdio.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n#include \"misc.h\"\n#include \"auth-options.h\"\n#include \"authfile.h\"\n#include \"sshkey.h\"\n#include \"test_helper.h\"\n#include <string.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdio.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic struct sshauthopt *\ndefault_authkey_opts(void)\n{\n\tstruct sshauthopt *ret = sshauthopt_new();\n\n\tASSERT_PTR_NE(ret, NULL);\n\tret->permit_port_forwarding_flag = 1;\n\tret->permit_agent_forwarding_flag = 1;\n\tret->permit_x11_forwarding_flag = 1;\n\tret->permit_pty_flag = 1;\n\tret->permit_user_rc = 1;\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "PREPARE",
          "args": [
            "\"environment\"",
            "\"all_permit\"",
            "\"environment=\\\"foo=a\\\",environment=\\\"bar=b\\\"\""
          ],
          "line": 552
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "TEST_DONE",
          "args": [],
          "line": 550
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "CHECK_SUCCESS_AND_CLEANUP",
          "args": [],
          "line": 549
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "PREPARE",
          "args": [
            "\"permitopen\"",
            "\"all_permit\"",
            "\"permitopen=\\\"127.0.0.1:*\\\",permitopen=\\\"127.0.0.1:123\\\"\""
          ],
          "line": 544
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "TEST_DONE",
          "args": [],
          "line": 542
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "CHECK_SUCCESS_AND_CLEANUP",
          "args": [],
          "line": 541
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "PREPARE",
          "args": [
            "\"tunnel\"",
            "\"all_permit\"",
            "\"tunnel=\\\"6\\\"\""
          ],
          "line": 538
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "TEST_DONE",
          "args": [],
          "line": 536
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "CLEANUP",
          "args": [],
          "line": 535
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASSERT_PTR_EQ",
          "args": [
            "merge_opts",
            "NULL"
          ],
          "line": 534
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "PREPARE",
          "args": [
            "\"force-command mismatch\"",
            "\"force_command\"",
            "\"command=\\\"bar\\\"\""
          ],
          "line": 533
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "TEST_DONE",
          "args": [],
          "line": 531
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "CHECK_SUCCESS_AND_CLEANUP",
          "args": [],
          "line": 530
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASSERT_PTR_NE",
          "args": [
            "expected->force_command",
            "NULL"
          ],
          "line": 529
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strdup",
          "args": [
            "\"foo\""
          ],
          "line": 528
        },
        "resolved": true,
        "details": {
          "function_name": "xstrdup",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/xmalloc.c",
          "lines": "92-102",
          "snippet": "char *\nxstrdup(const char *str)\n{\n\tsize_t len;\n\tchar *cp;\n\n\tlen = strlen(str) + 1;\n\tcp = xmalloc(len);\n\tstrlcpy(cp, str, len);\n\treturn cp;\n}",
          "includes": [
            "#include \"log.h\"",
            "#include \"xmalloc.h\"",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdint.h>",
            "#include <stdarg.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n#include \"xmalloc.h\"\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdint.h>\n#include <stdarg.h>\n#include \"includes.h\"\n\nchar *\nxstrdup(const char *str)\n{\n\tsize_t len;\n\tchar *cp;\n\n\tlen = strlen(str) + 1;\n\tcp = xmalloc(len);\n\tstrlcpy(cp, str, len);\n\treturn cp;\n}"
        }
      },
      {
        "call_info": {
          "callee": "PREPARE",
          "args": [
            "\"force-command cert\"",
            "\"force_command\"",
            "\"\""
          ],
          "line": 526
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "TEST_DONE",
          "args": [],
          "line": 524
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "CHECK_SUCCESS_AND_CLEANUP",
          "args": [],
          "line": 523
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASSERT_PTR_NE",
          "args": [
            "expected->force_command",
            "NULL"
          ],
          "line": 522
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "PREPARE",
          "args": [
            "\"force-command keys\"",
            "\"all_permit\"",
            "\"command=\\\"bar\\\"\""
          ],
          "line": 519
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "TEST_DONE",
          "args": [],
          "line": 517
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "CHECK_SUCCESS_AND_CLEANUP",
          "args": [],
          "line": 516
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "PREPARE",
          "args": [
            "\"force-command none\"",
            "\"all_permit\"",
            "\"\""
          ],
          "line": 514
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "TEST_DONE",
          "args": [],
          "line": 512
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "CHECK_SUCCESS_AND_CLEANUP",
          "args": [],
          "line": 511
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASSERT_PTR_NE",
          "args": [
            "expected->force_command",
            "NULL"
          ],
          "line": 510
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "PREPARE",
          "args": [
            "\"force-command both\"",
            "\"force_command\"",
            "\"command=\\\"foo\\\"\""
          ],
          "line": 507
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "TEST_DONE",
          "args": [],
          "line": 505
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "CHECK_SUCCESS_AND_CLEANUP",
          "args": [],
          "line": 504
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASSERT_PTR_NE",
          "args": [
            "expected->required_from_host_cert",
            "NULL"
          ],
          "line": 503
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "PREPARE",
          "args": [
            "\"source-address cert\"",
            "\"sourceaddr\"",
            "\"\""
          ],
          "line": 500
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "TEST_DONE",
          "args": [],
          "line": 498
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "CHECK_SUCCESS_AND_CLEANUP",
          "args": [],
          "line": 497
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASSERT_PTR_NE",
          "args": [
            "expected->required_from_host_keys",
            "NULL"
          ],
          "line": 496
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "PREPARE",
          "args": [
            "\"source-address keys\"",
            "\"all_permit\"",
            "\"from=\\\"127.0.0.1\\\"\""
          ],
          "line": 493
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "TEST_DONE",
          "args": [],
          "line": 491
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "CHECK_SUCCESS_AND_CLEANUP",
          "args": [],
          "line": 490
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "PREPARE",
          "args": [
            "\"source-address none\"",
            "\"all_permit\"",
            "\"\""
          ],
          "line": 488
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "TEST_DONE",
          "args": [],
          "line": 486
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "CHECK_SUCCESS_AND_CLEANUP",
          "args": [],
          "line": 485
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASSERT_PTR_NE",
          "args": [
            "expected->required_from_host_keys",
            "NULL"
          ],
          "line": 484
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASSERT_PTR_NE",
          "args": [
            "expected->required_from_host_cert",
            "NULL"
          ],
          "line": 482
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "PREPARE",
          "args": [
            "\"source-address both\"",
            "\"sourceaddr\"",
            "\"from=\\\"127.0.0.1\\\"\""
          ],
          "line": 479
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "FLAG_TEST",
          "args": [
            "\"x11fwd\"",
            "\"x11-forwarding\"",
            "permit_x11_forwarding_flag"
          ],
          "line": 476
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "FLAG_TEST",
          "args": [
            "\"user_rc\"",
            "\"user-rc\"",
            "permit_user_rc"
          ],
          "line": 475
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "FLAG_TEST",
          "args": [
            "\"pty\"",
            "\"pty\"",
            "permit_pty_flag"
          ],
          "line": 474
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "FLAG_TEST",
          "args": [
            "\"agentfwd\"",
            "\"agent-forwarding\"",
            "permit_agent_forwarding_flag"
          ],
          "line": 473
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "FLAG_TEST",
          "args": [
            "\"portfwd\"",
            "\"port-forwarding\"",
            "permit_port_forwarding_flag"
          ],
          "line": 472
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"log.h\"\n#include \"misc.h\"\n#include \"auth-options.h\"\n#include \"authfile.h\"\n#include \"sshkey.h\"\n#include \"test_helper.h\"\n#include <string.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdio.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void\ntest_merge(void)\n{\n\tstruct sshkey *cert;\n\tstruct sshauthopt *key_opts, *cert_opts, *merge_opts, *expected;\n\tconst char *errstr;\n\n\t/*\n\t * Prepare for a test by making some key and cert options and\n\t * attempting to merge them.\n\t */\n#define PREPARE(label, keyname, keywords) \\\n\tdo { \\\n\t\texpected = NULL; \\\n\t\tTEST_START(\"sshauthopt_merge \" label); \\\n\t\tcert = load_key(keyname \".cert\"); \\\n\t\tcert_opts = sshauthopt_from_cert(cert); \\\n\t\tASSERT_PTR_NE(cert_opts, NULL); \\\n\t\tkey_opts = sshauthopt_parse(keywords, &errstr); \\\n\t\tif (errstr != NULL) \\\n\t\t\tASSERT_STRING_EQ(errstr, \"\"); \\\n\t\tASSERT_PTR_NE(key_opts, NULL); \\\n\t\tmerge_opts = sshauthopt_merge(key_opts, \\\n\t\t    cert_opts, &errstr); \\\n\t} while (0)\n\n\t/* Cleanup stuff allocated by PREPARE() */\n#define CLEANUP() \\\n\tdo { \\\n\t\tsshauthopt_free(expected); \\\n\t\tsshauthopt_free(merge_opts); \\\n\t\tsshauthopt_free(key_opts); \\\n\t\tsshauthopt_free(cert_opts); \\\n\t\tsshkey_free(cert); \\\n\t} while (0)\n\n\t/* Check the results of PREPARE() against expectation; calls CLEANUP */\n#define CHECK_SUCCESS_AND_CLEANUP() \\\n\tdo { \\\n\t\tif (errstr != NULL) \\\n\t\t\tASSERT_STRING_EQ(errstr, \"\"); \\\n\t\tcompare_opts(merge_opts, expected); \\\n\t\tCLEANUP(); \\\n\t} while (0)\n\n\t/* Check a single case of merging of flag options */\n#define FLAG_CASE(keybase, label, keyname, keywords, mostly_off, var, val) \\\n\tdo { \\\n\t\tPREPARE(keybase \" \" label, keyname, keywords); \\\n\t\texpected = mostly_off ? \\\n\t\t    sshauthopt_new() : default_authkey_opts(); \\\n\t\texpected->var = val; \\\n\t\tASSERT_PTR_NE(expected, NULL); \\\n\t\tCHECK_SUCCESS_AND_CLEANUP(); \\\n\t\tTEST_DONE(); \\\n\t} while (0)\n\n\t/*\n\t * Fairly exhaustive exercise of a flag option. Tests\n\t * option both set and clear in certificate, set and clear in\n\t * authorized_keys and set and cleared via restrict keyword.\n\t */\n#define FLAG_TEST(keybase, keyword, var) \\\n\tdo { \\\n\t\tFLAG_CASE(keybase, \"keys:default,yes cert:default,no\", \\\n\t\t    \"no_\" keybase, keyword, 0, var, 0); \\\n\t\tFLAG_CASE(keybase,\"keys:-*,yes cert:default,no\", \\\n\t\t    \"no_\" keybase, \"restrict,\" keyword, 1, var, 0); \\\n\t\tFLAG_CASE(keybase, \"keys:default,no cert:default,no\", \\\n\t\t    \"no_\" keybase, \"no-\" keyword, 0, var, 0); \\\n\t\tFLAG_CASE(keybase, \"keys:-*,no cert:default,no\", \\\n\t\t    \"no_\" keybase, \"restrict,no-\" keyword, 1, var, 0); \\\n\t\t\\\n\t\tFLAG_CASE(keybase, \"keys:default,yes cert:-*,yes\", \\\n\t\t    \"only_\" keybase, keyword, 1, var, 1); \\\n\t\tFLAG_CASE(keybase,\"keys:-*,yes cert:-*,yes\", \\\n\t\t    \"only_\" keybase, \"restrict,\" keyword, 1, var, 1); \\\n\t\tFLAG_CASE(keybase, \"keys:default,no cert:-*,yes\", \\\n\t\t    \"only_\" keybase, \"no-\" keyword, 1, var, 0); \\\n\t\tFLAG_CASE(keybase, \"keys:-*,no cert:-*,yes\", \\\n\t\t    \"only_\" keybase, \"restrict,no-\" keyword, 1, var, 0); \\\n\t\t\\\n\t\tFLAG_CASE(keybase, \"keys:default,yes cert:-*\", \\\n\t\t    \"no_permit\", keyword, 1, var, 0); \\\n\t\tFLAG_CASE(keybase,\"keys:-*,yes cert:-*\", \\\n\t\t    \"no_permit\", \"restrict,\" keyword, 1, var, 0); \\\n\t\tFLAG_CASE(keybase, \"keys:default,no cert:-*\", \\\n\t\t    \"no_permit\", \"no-\" keyword, 1, var, 0); \\\n\t\tFLAG_CASE(keybase, \"keys:-*,no cert:-*\", \\\n\t\t    \"no_permit\", \"restrict,no-\" keyword, 1, var, 0); \\\n\t\t\\\n\t\tFLAG_CASE(keybase, \"keys:default,yes cert:*\", \\\n\t\t    \"all_permit\", keyword, 0, var, 1); \\\n\t\tFLAG_CASE(keybase,\"keys:-*,yes cert:*\", \\\n\t\t    \"all_permit\", \"restrict,\" keyword, 1, var, 1); \\\n\t\tFLAG_CASE(keybase, \"keys:default,no cert:*\", \\\n\t\t    \"all_permit\", \"no-\" keyword, 0, var, 0); \\\n\t\tFLAG_CASE(keybase, \"keys:-*,no cert:*\", \\\n\t\t    \"all_permit\", \"restrict,no-\" keyword, 1, var, 0); \\\n\t\t\\\n\t} while (0)\n\tFLAG_TEST(\"portfwd\", \"port-forwarding\", permit_port_forwarding_flag);\n\tFLAG_TEST(\"agentfwd\", \"agent-forwarding\", permit_agent_forwarding_flag);\n\tFLAG_TEST(\"pty\", \"pty\", permit_pty_flag);\n\tFLAG_TEST(\"user_rc\", \"user-rc\", permit_user_rc);\n\tFLAG_TEST(\"x11fwd\", \"x11-forwarding\", permit_x11_forwarding_flag);\n#undef FLAG_TEST\n\n\tPREPARE(\"source-address both\", \"sourceaddr\", \"from=\\\"127.0.0.1\\\"\");\n\texpected = default_authkey_opts();\n\texpected->required_from_host_cert = strdup(\"127.0.0.1/32,::1/128\");\n\tASSERT_PTR_NE(expected->required_from_host_cert, NULL);\n\texpected->required_from_host_keys = strdup(\"127.0.0.1\");\n\tASSERT_PTR_NE(expected->required_from_host_keys, NULL);\n\tCHECK_SUCCESS_AND_CLEANUP();\n\tTEST_DONE();\n\n\tPREPARE(\"source-address none\", \"all_permit\", \"\");\n\texpected = default_authkey_opts();\n\tCHECK_SUCCESS_AND_CLEANUP();\n\tTEST_DONE();\n\n\tPREPARE(\"source-address keys\", \"all_permit\", \"from=\\\"127.0.0.1\\\"\");\n\texpected = default_authkey_opts();\n\texpected->required_from_host_keys = strdup(\"127.0.0.1\");\n\tASSERT_PTR_NE(expected->required_from_host_keys, NULL);\n\tCHECK_SUCCESS_AND_CLEANUP();\n\tTEST_DONE();\n\n\tPREPARE(\"source-address cert\", \"sourceaddr\", \"\");\n\texpected = default_authkey_opts();\n\texpected->required_from_host_cert = strdup(\"127.0.0.1/32,::1/128\");\n\tASSERT_PTR_NE(expected->required_from_host_cert, NULL);\n\tCHECK_SUCCESS_AND_CLEANUP();\n\tTEST_DONE();\n\n\tPREPARE(\"force-command both\", \"force_command\", \"command=\\\"foo\\\"\");\n\texpected = default_authkey_opts();\n\texpected->force_command = strdup(\"foo\");\n\tASSERT_PTR_NE(expected->force_command, NULL);\n\tCHECK_SUCCESS_AND_CLEANUP();\n\tTEST_DONE();\n\n\tPREPARE(\"force-command none\", \"all_permit\", \"\");\n\texpected = default_authkey_opts();\n\tCHECK_SUCCESS_AND_CLEANUP();\n\tTEST_DONE();\n\n\tPREPARE(\"force-command keys\", \"all_permit\", \"command=\\\"bar\\\"\");\n\texpected = default_authkey_opts();\n\texpected->force_command = strdup(\"bar\");\n\tASSERT_PTR_NE(expected->force_command, NULL);\n\tCHECK_SUCCESS_AND_CLEANUP();\n\tTEST_DONE();\n\n\tPREPARE(\"force-command cert\", \"force_command\", \"\");\n\texpected = default_authkey_opts();\n\texpected->force_command = strdup(\"foo\");\n\tASSERT_PTR_NE(expected->force_command, NULL);\n\tCHECK_SUCCESS_AND_CLEANUP();\n\tTEST_DONE();\n\n\tPREPARE(\"force-command mismatch\", \"force_command\", \"command=\\\"bar\\\"\");\n\tASSERT_PTR_EQ(merge_opts, NULL);\n\tCLEANUP();\n\tTEST_DONE();\n\n\tPREPARE(\"tunnel\", \"all_permit\", \"tunnel=\\\"6\\\"\");\n\texpected = default_authkey_opts();\n\texpected->force_tun_device = 6;\n\tCHECK_SUCCESS_AND_CLEANUP();\n\tTEST_DONE();\n\n\tPREPARE(\"permitopen\", \"all_permit\",\n\t    \"permitopen=\\\"127.0.0.1:*\\\",permitopen=\\\"127.0.0.1:123\\\"\");\n\texpected = default_authkey_opts();\n\texpected->permitopen = commasplit(\"127.0.0.1:*,127.0.0.1:123\",\n\t    &expected->npermitopen);\n\tCHECK_SUCCESS_AND_CLEANUP();\n\tTEST_DONE();\n\n\tPREPARE(\"environment\", \"all_permit\",\n\t    \"environment=\\\"foo=a\\\",environment=\\\"bar=b\\\"\");\n\texpected = default_authkey_opts();\n\texpected->env = commasplit(\"foo=a,bar=b\", &expected->nenv);\n\tCHECK_SUCCESS_AND_CLEANUP();\n\tTEST_DONE();\n}"
  },
  {
    "function_name": "test_cert_parse",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/regress/unittests/authopt/tests.c",
    "lines": "284-369",
    "snippet": "static void\ntest_cert_parse(void)\n{\n\tstruct sshkey *cert;\n\tstruct sshauthopt *opts, *expected;\n\n#define CHECK_SUCCESS_AND_CLEANUP() \\\n\tdo { \\\n\t\tcompare_opts(opts, expected); \\\n\t\tsshauthopt_free(expected); \\\n\t\tsshauthopt_free(opts); \\\n\t\tsshkey_free(cert); \\\n\t} while (0)\n#define FLAG_TEST(keybase, var) \\\n\tdo { \\\n\t\tTEST_START(\"sshauthopt_from_cert no_\" keybase); \\\n\t\tcert = load_key(\"no_\" keybase \".cert\"); \\\n\t\texpected = default_authkey_opts(); \\\n\t\texpected->var = 0; \\\n\t\topts = sshauthopt_from_cert(cert); \\\n\t\tCHECK_SUCCESS_AND_CLEANUP(); \\\n\t\tTEST_DONE(); \\\n\t\tTEST_START(\"sshauthopt_from_cert only_\" keybase); \\\n\t\tcert = load_key(\"only_\" keybase \".cert\"); \\\n\t\texpected = sshauthopt_new(); \\\n\t\tASSERT_PTR_NE(expected, NULL); \\\n\t\texpected->var = 1; \\\n\t\topts = sshauthopt_from_cert(cert); \\\n\t\tCHECK_SUCCESS_AND_CLEANUP(); \\\n\t\tTEST_DONE(); \\\n\t} while (0)\n\tFLAG_TEST(\"agentfwd\", permit_agent_forwarding_flag);\n\tFLAG_TEST(\"portfwd\", permit_port_forwarding_flag);\n\tFLAG_TEST(\"pty\", permit_pty_flag);\n\tFLAG_TEST(\"user_rc\", permit_user_rc);\n\tFLAG_TEST(\"x11fwd\", permit_x11_forwarding_flag);\n#undef FLAG_TEST\n\n\tTEST_START(\"sshauthopt_from_cert all permitted\");\n\tcert = load_key(\"all_permit.cert\");\n\texpected = default_authkey_opts();\n\topts = sshauthopt_from_cert(cert);\n\tCHECK_SUCCESS_AND_CLEANUP();\n\tTEST_DONE();\n\n\tTEST_START(\"sshauthopt_from_cert nothing permitted\");\n\tcert = load_key(\"no_permit.cert\");\n\texpected = sshauthopt_new();\n\tASSERT_PTR_NE(expected, NULL);\n\topts = sshauthopt_from_cert(cert);\n\tCHECK_SUCCESS_AND_CLEANUP();\n\tTEST_DONE();\n\n\tTEST_START(\"sshauthopt_from_cert force-command\");\n\tcert = load_key(\"force_command.cert\");\n\texpected = default_authkey_opts();\n\texpected->force_command = strdup(\"foo\");\n\tASSERT_PTR_NE(expected->force_command, NULL);\n\topts = sshauthopt_from_cert(cert);\n\tCHECK_SUCCESS_AND_CLEANUP();\n\tTEST_DONE();\n\n\tTEST_START(\"sshauthopt_from_cert source-address\");\n\tcert = load_key(\"sourceaddr.cert\");\n\texpected = default_authkey_opts();\n\texpected->required_from_host_cert = strdup(\"127.0.0.1/32,::1/128\");\n\tASSERT_PTR_NE(expected->required_from_host_cert, NULL);\n\topts = sshauthopt_from_cert(cert);\n\tCHECK_SUCCESS_AND_CLEANUP();\n\tTEST_DONE();\n#undef CHECK_SUCCESS_AND_CLEANUP\n\n#define FAIL_TEST(keybase) \\\n\tdo { \\\n\t\tTEST_START(\"sshauthopt_from_cert \" keybase); \\\n\t\tcert = load_key(keybase \".cert\"); \\\n\t\topts = sshauthopt_from_cert(cert); \\\n\t\tASSERT_PTR_EQ(opts, NULL); \\\n\t\tsshkey_free(cert); \\\n\t\tTEST_DONE(); \\\n\t} while (0)\n\tFAIL_TEST(\"host\");\n\tFAIL_TEST(\"bad_sourceaddr\");\n\tFAIL_TEST(\"unknown_critical\");\n#undef FAIL_TEST\n}",
    "includes": [
      "#include \"log.h\"",
      "#include \"misc.h\"",
      "#include \"auth-options.h\"",
      "#include \"authfile.h\"",
      "#include \"sshkey.h\"",
      "#include \"test_helper.h\"",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <stdio.h>",
      "#include <sys/param.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "FAIL_TEST",
          "args": [
            "\"unknown_critical\""
          ],
          "line": 367
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "FAIL_TEST",
          "args": [
            "\"bad_sourceaddr\""
          ],
          "line": 366
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "FAIL_TEST",
          "args": [
            "\"host\""
          ],
          "line": 365
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "TEST_DONE",
          "args": [],
          "line": 353
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "CHECK_SUCCESS_AND_CLEANUP",
          "args": [],
          "line": 352
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sshauthopt_from_cert",
          "args": [
            "cert"
          ],
          "line": 351
        },
        "resolved": true,
        "details": {
          "function_name": "sshauthopt_from_cert",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/auth-options.c",
          "lines": "541-566",
          "snippet": "struct sshauthopt *\nsshauthopt_from_cert(struct sshkey *k)\n{\n\tstruct sshauthopt *ret;\n\n\tif (k == NULL || !sshkey_type_is_cert(k->type) || k->cert == NULL ||\n\t    k->cert->type != SSH2_CERT_TYPE_USER)\n\t\treturn NULL;\n\n\tif ((ret = sshauthopt_new()) == NULL)\n\t\treturn NULL;\n\n\t/* Handle options and critical extensions separately */\n\tif (cert_option_list(ret, k->cert->critical,\n\t    OPTIONS_CRITICAL, 1) == -1) {\n\t\tsshauthopt_free(ret);\n\t\treturn NULL;\n\t}\n\tif (cert_option_list(ret, k->cert->extensions,\n\t    OPTIONS_EXTENSIONS, 0) == -1) {\n\t\tsshauthopt_free(ret);\n\t\treturn NULL;\n\t}\n\t/* success */\n\treturn ret;\n}",
          "includes": [
            "#include \"auth-options.h\"",
            "#include \"ssh2.h\"",
            "#include \"match.h\"",
            "#include \"sshkey.h\"",
            "#include \"misc.h\"",
            "#include \"sshbuf.h\"",
            "#include \"log.h\"",
            "#include \"ssherr.h\"",
            "#include \"xmalloc.h\"",
            "#include \"openbsd-compat/sys-queue.h\"",
            "#include <limits.h>",
            "#include <ctype.h>",
            "#include <stdarg.h>",
            "#include <stdio.h>",
            "#include <string.h>",
            "#include <pwd.h>",
            "#include <netdb.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [
            "#define OPTIONS_EXTENSIONS\t2",
            "#define OPTIONS_CRITICAL\t1"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"auth-options.h\"\n#include \"ssh2.h\"\n#include \"match.h\"\n#include \"sshkey.h\"\n#include \"misc.h\"\n#include \"sshbuf.h\"\n#include \"log.h\"\n#include \"ssherr.h\"\n#include \"xmalloc.h\"\n#include \"openbsd-compat/sys-queue.h\"\n#include <limits.h>\n#include <ctype.h>\n#include <stdarg.h>\n#include <stdio.h>\n#include <string.h>\n#include <pwd.h>\n#include <netdb.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\n#define OPTIONS_EXTENSIONS\t2\n#define OPTIONS_CRITICAL\t1\n\nstruct sshauthopt *\nsshauthopt_from_cert(struct sshkey *k)\n{\n\tstruct sshauthopt *ret;\n\n\tif (k == NULL || !sshkey_type_is_cert(k->type) || k->cert == NULL ||\n\t    k->cert->type != SSH2_CERT_TYPE_USER)\n\t\treturn NULL;\n\n\tif ((ret = sshauthopt_new()) == NULL)\n\t\treturn NULL;\n\n\t/* Handle options and critical extensions separately */\n\tif (cert_option_list(ret, k->cert->critical,\n\t    OPTIONS_CRITICAL, 1) == -1) {\n\t\tsshauthopt_free(ret);\n\t\treturn NULL;\n\t}\n\tif (cert_option_list(ret, k->cert->extensions,\n\t    OPTIONS_EXTENSIONS, 0) == -1) {\n\t\tsshauthopt_free(ret);\n\t\treturn NULL;\n\t}\n\t/* success */\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "ASSERT_PTR_NE",
          "args": [
            "expected->required_from_host_cert",
            "NULL"
          ],
          "line": 350
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strdup",
          "args": [
            "\"127.0.0.1/32,::1/128\""
          ],
          "line": 349
        },
        "resolved": true,
        "details": {
          "function_name": "xstrdup",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/xmalloc.c",
          "lines": "92-102",
          "snippet": "char *\nxstrdup(const char *str)\n{\n\tsize_t len;\n\tchar *cp;\n\n\tlen = strlen(str) + 1;\n\tcp = xmalloc(len);\n\tstrlcpy(cp, str, len);\n\treturn cp;\n}",
          "includes": [
            "#include \"log.h\"",
            "#include \"xmalloc.h\"",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdint.h>",
            "#include <stdarg.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n#include \"xmalloc.h\"\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdint.h>\n#include <stdarg.h>\n#include \"includes.h\"\n\nchar *\nxstrdup(const char *str)\n{\n\tsize_t len;\n\tchar *cp;\n\n\tlen = strlen(str) + 1;\n\tcp = xmalloc(len);\n\tstrlcpy(cp, str, len);\n\treturn cp;\n}"
        }
      },
      {
        "call_info": {
          "callee": "default_authkey_opts",
          "args": [],
          "line": 348
        },
        "resolved": true,
        "details": {
          "function_name": "default_authkey_opts",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/regress/unittests/authopt/tests.c",
          "lines": "36-48",
          "snippet": "static struct sshauthopt *\ndefault_authkey_opts(void)\n{\n\tstruct sshauthopt *ret = sshauthopt_new();\n\n\tASSERT_PTR_NE(ret, NULL);\n\tret->permit_port_forwarding_flag = 1;\n\tret->permit_agent_forwarding_flag = 1;\n\tret->permit_x11_forwarding_flag = 1;\n\tret->permit_pty_flag = 1;\n\tret->permit_user_rc = 1;\n\treturn ret;\n}",
          "includes": [
            "#include \"log.h\"",
            "#include \"misc.h\"",
            "#include \"auth-options.h\"",
            "#include \"authfile.h\"",
            "#include \"sshkey.h\"",
            "#include \"test_helper.h\"",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <stdio.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n#include \"misc.h\"\n#include \"auth-options.h\"\n#include \"authfile.h\"\n#include \"sshkey.h\"\n#include \"test_helper.h\"\n#include <string.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdio.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic struct sshauthopt *\ndefault_authkey_opts(void)\n{\n\tstruct sshauthopt *ret = sshauthopt_new();\n\n\tASSERT_PTR_NE(ret, NULL);\n\tret->permit_port_forwarding_flag = 1;\n\tret->permit_agent_forwarding_flag = 1;\n\tret->permit_x11_forwarding_flag = 1;\n\tret->permit_pty_flag = 1;\n\tret->permit_user_rc = 1;\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "load_key",
          "args": [
            "\"sourceaddr.cert\""
          ],
          "line": 347
        },
        "resolved": true,
        "details": {
          "function_name": "load_key",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/regress/unittests/authopt/tests.c",
          "lines": "24-34",
          "snippet": "static struct sshkey *\nload_key(const char *name)\n{\n\tstruct sshkey *ret;\n\tint r;\n\n\tr = sshkey_load_public(test_data_file(name), &ret, NULL);\n\tASSERT_INT_EQ(r, 0);\n\tASSERT_PTR_NE(ret, NULL);\n\treturn ret;\n}",
          "includes": [
            "#include \"log.h\"",
            "#include \"misc.h\"",
            "#include \"auth-options.h\"",
            "#include \"authfile.h\"",
            "#include \"sshkey.h\"",
            "#include \"test_helper.h\"",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <stdio.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n#include \"misc.h\"\n#include \"auth-options.h\"\n#include \"authfile.h\"\n#include \"sshkey.h\"\n#include \"test_helper.h\"\n#include <string.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdio.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic struct sshkey *\nload_key(const char *name)\n{\n\tstruct sshkey *ret;\n\tint r;\n\n\tr = sshkey_load_public(test_data_file(name), &ret, NULL);\n\tASSERT_INT_EQ(r, 0);\n\tASSERT_PTR_NE(ret, NULL);\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "TEST_START",
          "args": [
            "\"sshauthopt_from_cert source-address\""
          ],
          "line": 346
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "TEST_DONE",
          "args": [],
          "line": 344
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "CHECK_SUCCESS_AND_CLEANUP",
          "args": [],
          "line": 343
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASSERT_PTR_NE",
          "args": [
            "expected->force_command",
            "NULL"
          ],
          "line": 341
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "TEST_START",
          "args": [
            "\"sshauthopt_from_cert force-command\""
          ],
          "line": 337
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "TEST_DONE",
          "args": [],
          "line": 335
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "CHECK_SUCCESS_AND_CLEANUP",
          "args": [],
          "line": 334
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASSERT_PTR_NE",
          "args": [
            "expected",
            "NULL"
          ],
          "line": 332
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sshauthopt_new",
          "args": [],
          "line": 331
        },
        "resolved": true,
        "details": {
          "function_name": "sshauthopt_new_with_keys_defaults",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/auth-options.c",
          "lines": "294-309",
          "snippet": "struct sshauthopt *\nsshauthopt_new_with_keys_defaults(void)\n{\n\tstruct sshauthopt *ret = NULL;\n\n\tif ((ret = sshauthopt_new()) == NULL)\n\t\treturn NULL;\n\n\t/* Defaults for authorized_keys flags */\n\tret->permit_port_forwarding_flag = 1;\n\tret->permit_agent_forwarding_flag = 1;\n\tret->permit_x11_forwarding_flag = 1;\n\tret->permit_pty_flag = 1;\n\tret->permit_user_rc = 1;\n\treturn ret;\n}",
          "includes": [
            "#include \"auth-options.h\"",
            "#include \"ssh2.h\"",
            "#include \"match.h\"",
            "#include \"sshkey.h\"",
            "#include \"misc.h\"",
            "#include \"sshbuf.h\"",
            "#include \"log.h\"",
            "#include \"ssherr.h\"",
            "#include \"xmalloc.h\"",
            "#include \"openbsd-compat/sys-queue.h\"",
            "#include <limits.h>",
            "#include <ctype.h>",
            "#include <stdarg.h>",
            "#include <stdio.h>",
            "#include <string.h>",
            "#include <pwd.h>",
            "#include <netdb.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"auth-options.h\"\n#include \"ssh2.h\"\n#include \"match.h\"\n#include \"sshkey.h\"\n#include \"misc.h\"\n#include \"sshbuf.h\"\n#include \"log.h\"\n#include \"ssherr.h\"\n#include \"xmalloc.h\"\n#include \"openbsd-compat/sys-queue.h\"\n#include <limits.h>\n#include <ctype.h>\n#include <stdarg.h>\n#include <stdio.h>\n#include <string.h>\n#include <pwd.h>\n#include <netdb.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nstruct sshauthopt *\nsshauthopt_new_with_keys_defaults(void)\n{\n\tstruct sshauthopt *ret = NULL;\n\n\tif ((ret = sshauthopt_new()) == NULL)\n\t\treturn NULL;\n\n\t/* Defaults for authorized_keys flags */\n\tret->permit_port_forwarding_flag = 1;\n\tret->permit_agent_forwarding_flag = 1;\n\tret->permit_x11_forwarding_flag = 1;\n\tret->permit_pty_flag = 1;\n\tret->permit_user_rc = 1;\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "TEST_START",
          "args": [
            "\"sshauthopt_from_cert nothing permitted\""
          ],
          "line": 329
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "TEST_DONE",
          "args": [],
          "line": 327
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "CHECK_SUCCESS_AND_CLEANUP",
          "args": [],
          "line": 326
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "TEST_START",
          "args": [
            "\"sshauthopt_from_cert all permitted\""
          ],
          "line": 322
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "FLAG_TEST",
          "args": [
            "\"x11fwd\"",
            "permit_x11_forwarding_flag"
          ],
          "line": 319
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "FLAG_TEST",
          "args": [
            "\"user_rc\"",
            "permit_user_rc"
          ],
          "line": 318
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "FLAG_TEST",
          "args": [
            "\"pty\"",
            "permit_pty_flag"
          ],
          "line": 317
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "FLAG_TEST",
          "args": [
            "\"portfwd\"",
            "permit_port_forwarding_flag"
          ],
          "line": 316
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "FLAG_TEST",
          "args": [
            "\"agentfwd\"",
            "permit_agent_forwarding_flag"
          ],
          "line": 315
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"log.h\"\n#include \"misc.h\"\n#include \"auth-options.h\"\n#include \"authfile.h\"\n#include \"sshkey.h\"\n#include \"test_helper.h\"\n#include <string.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdio.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void\ntest_cert_parse(void)\n{\n\tstruct sshkey *cert;\n\tstruct sshauthopt *opts, *expected;\n\n#define CHECK_SUCCESS_AND_CLEANUP() \\\n\tdo { \\\n\t\tcompare_opts(opts, expected); \\\n\t\tsshauthopt_free(expected); \\\n\t\tsshauthopt_free(opts); \\\n\t\tsshkey_free(cert); \\\n\t} while (0)\n#define FLAG_TEST(keybase, var) \\\n\tdo { \\\n\t\tTEST_START(\"sshauthopt_from_cert no_\" keybase); \\\n\t\tcert = load_key(\"no_\" keybase \".cert\"); \\\n\t\texpected = default_authkey_opts(); \\\n\t\texpected->var = 0; \\\n\t\topts = sshauthopt_from_cert(cert); \\\n\t\tCHECK_SUCCESS_AND_CLEANUP(); \\\n\t\tTEST_DONE(); \\\n\t\tTEST_START(\"sshauthopt_from_cert only_\" keybase); \\\n\t\tcert = load_key(\"only_\" keybase \".cert\"); \\\n\t\texpected = sshauthopt_new(); \\\n\t\tASSERT_PTR_NE(expected, NULL); \\\n\t\texpected->var = 1; \\\n\t\topts = sshauthopt_from_cert(cert); \\\n\t\tCHECK_SUCCESS_AND_CLEANUP(); \\\n\t\tTEST_DONE(); \\\n\t} while (0)\n\tFLAG_TEST(\"agentfwd\", permit_agent_forwarding_flag);\n\tFLAG_TEST(\"portfwd\", permit_port_forwarding_flag);\n\tFLAG_TEST(\"pty\", permit_pty_flag);\n\tFLAG_TEST(\"user_rc\", permit_user_rc);\n\tFLAG_TEST(\"x11fwd\", permit_x11_forwarding_flag);\n#undef FLAG_TEST\n\n\tTEST_START(\"sshauthopt_from_cert all permitted\");\n\tcert = load_key(\"all_permit.cert\");\n\texpected = default_authkey_opts();\n\topts = sshauthopt_from_cert(cert);\n\tCHECK_SUCCESS_AND_CLEANUP();\n\tTEST_DONE();\n\n\tTEST_START(\"sshauthopt_from_cert nothing permitted\");\n\tcert = load_key(\"no_permit.cert\");\n\texpected = sshauthopt_new();\n\tASSERT_PTR_NE(expected, NULL);\n\topts = sshauthopt_from_cert(cert);\n\tCHECK_SUCCESS_AND_CLEANUP();\n\tTEST_DONE();\n\n\tTEST_START(\"sshauthopt_from_cert force-command\");\n\tcert = load_key(\"force_command.cert\");\n\texpected = default_authkey_opts();\n\texpected->force_command = strdup(\"foo\");\n\tASSERT_PTR_NE(expected->force_command, NULL);\n\topts = sshauthopt_from_cert(cert);\n\tCHECK_SUCCESS_AND_CLEANUP();\n\tTEST_DONE();\n\n\tTEST_START(\"sshauthopt_from_cert source-address\");\n\tcert = load_key(\"sourceaddr.cert\");\n\texpected = default_authkey_opts();\n\texpected->required_from_host_cert = strdup(\"127.0.0.1/32,::1/128\");\n\tASSERT_PTR_NE(expected->required_from_host_cert, NULL);\n\topts = sshauthopt_from_cert(cert);\n\tCHECK_SUCCESS_AND_CLEANUP();\n\tTEST_DONE();\n#undef CHECK_SUCCESS_AND_CLEANUP\n\n#define FAIL_TEST(keybase) \\\n\tdo { \\\n\t\tTEST_START(\"sshauthopt_from_cert \" keybase); \\\n\t\tcert = load_key(keybase \".cert\"); \\\n\t\topts = sshauthopt_from_cert(cert); \\\n\t\tASSERT_PTR_EQ(opts, NULL); \\\n\t\tsshkey_free(cert); \\\n\t\tTEST_DONE(); \\\n\t} while (0)\n\tFAIL_TEST(\"host\");\n\tFAIL_TEST(\"bad_sourceaddr\");\n\tFAIL_TEST(\"unknown_critical\");\n#undef FAIL_TEST\n}"
  },
  {
    "function_name": "test_authkeys_parse",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/regress/unittests/authopt/tests.c",
    "lines": "131-282",
    "snippet": "static void\ntest_authkeys_parse(void)\n{\n\tstruct sshauthopt *opts, *expected;\n\tconst char *errstr;\n\n#define FAIL_TEST(label, keywords) \\\n\tdo { \\\n\t\tTEST_START(\"sshauthopt_parse invalid \" label); \\\n\t\topts = sshauthopt_parse(keywords, &errstr); \\\n\t\tASSERT_PTR_EQ(opts, NULL); \\\n\t\tASSERT_PTR_NE(errstr, NULL); \\\n\t\tTEST_DONE(); \\\n\t} while (0) \n#define CHECK_SUCCESS_AND_CLEANUP() \\\n\tdo { \\\n\t\tif (errstr != NULL) \\\n\t\t\tASSERT_STRING_EQ(errstr, \"\"); \\\n\t\tcompare_opts(opts, expected); \\\n\t\tsshauthopt_free(expected); \\\n\t\tsshauthopt_free(opts); \\\n\t} while (0)\n\n\t/* Basic tests */\n\tTEST_START(\"sshauthopt_parse empty\");\n\texpected = default_authkey_opts();\n\topts = sshauthopt_parse(\"\", &errstr);\n\tCHECK_SUCCESS_AND_CLEANUP();\n\tTEST_DONE();\n\n\tTEST_START(\"sshauthopt_parse trailing whitespace\");\n\texpected = default_authkey_opts();\n\topts = sshauthopt_parse(\" \", &errstr);\n\tCHECK_SUCCESS_AND_CLEANUP();\n\tTEST_DONE();\n\n\tTEST_START(\"sshauthopt_parse restrict\");\n\texpected = default_authkey_restrict_opts();\n\topts = sshauthopt_parse(\"restrict\", &errstr);\n\tCHECK_SUCCESS_AND_CLEANUP();\n\tTEST_DONE();\n\n\t/* Invalid syntax */\n\tFAIL_TEST(\"trailing comma\", \"restrict,\");\n\tFAIL_TEST(\"bare comma\", \",\");\n\tFAIL_TEST(\"unknown option\", \"BLAH\");\n\tFAIL_TEST(\"unknown option with trailing comma\", \"BLAH,\");\n\tFAIL_TEST(\"unknown option with trailing whitespace\", \"BLAH \");\n\n\t/* force_tun_device */\n\tTEST_START(\"sshauthopt_parse tunnel explicit\");\n\texpected = default_authkey_opts();\n\texpected->force_tun_device = 1;\n\topts = sshauthopt_parse(\"tunnel=\\\"1\\\"\", &errstr);\n\tCHECK_SUCCESS_AND_CLEANUP();\n\tTEST_DONE();\n\n\tTEST_START(\"sshauthopt_parse tunnel any\");\n\texpected = default_authkey_opts();\n\texpected->force_tun_device = SSH_TUNID_ANY;\n\topts = sshauthopt_parse(\"tunnel=\\\"any\\\"\", &errstr);\n\tCHECK_SUCCESS_AND_CLEANUP();\n\tTEST_DONE();\n\n\tFAIL_TEST(\"tunnel\", \"tunnel=\\\"blah\\\"\");\n\n\t/* Flag options */\n#define FLAG_TEST(keyword, var, val) \\\n\tdo { \\\n\t\tTEST_START(\"sshauthopt_parse \" keyword); \\\n\t\texpected = default_authkey_opts(); \\\n\t\texpected->var = val; \\\n\t\topts = sshauthopt_parse(keyword, &errstr); \\\n\t\tCHECK_SUCCESS_AND_CLEANUP(); \\\n\t\texpected = default_authkey_restrict_opts(); \\\n\t\texpected->var = val; \\\n\t\topts = sshauthopt_parse(\"restrict,\"keyword, &errstr); \\\n\t\tCHECK_SUCCESS_AND_CLEANUP(); \\\n\t\tTEST_DONE(); \\\n\t} while (0)\n\t/* Positive flags */\n\tFLAG_TEST(\"cert-authority\", cert_authority, 1);\n\tFLAG_TEST(\"port-forwarding\", permit_port_forwarding_flag, 1);\n\tFLAG_TEST(\"agent-forwarding\", permit_agent_forwarding_flag, 1);\n\tFLAG_TEST(\"x11-forwarding\", permit_x11_forwarding_flag, 1);\n\tFLAG_TEST(\"pty\", permit_pty_flag, 1);\n\tFLAG_TEST(\"user-rc\", permit_user_rc, 1);\n\t/* Negative flags */\n\tFLAG_TEST(\"no-port-forwarding\", permit_port_forwarding_flag, 0);\n\tFLAG_TEST(\"no-agent-forwarding\", permit_agent_forwarding_flag, 0);\n\tFLAG_TEST(\"no-x11-forwarding\", permit_x11_forwarding_flag, 0);\n\tFLAG_TEST(\"no-pty\", permit_pty_flag, 0);\n\tFLAG_TEST(\"no-user-rc\", permit_user_rc, 0);\n#undef FLAG_TEST\n\tFAIL_TEST(\"no-cert-authority\", \"no-cert-authority\");\n\n\t/* String options */\n#define STRING_TEST(keyword, var, val) \\\n\tdo { \\\n\t\tTEST_START(\"sshauthopt_parse \" keyword); \\\n\t\texpected = default_authkey_opts(); \\\n\t\texpected->var = strdup(val); \\\n\t\tASSERT_PTR_NE(expected->var, NULL); \\\n\t\topts = sshauthopt_parse(keyword \"=\" #val, &errstr); \\\n\t\tCHECK_SUCCESS_AND_CLEANUP(); \\\n\t\texpected = default_authkey_restrict_opts(); \\\n\t\texpected->var = strdup(val); \\\n\t\tASSERT_PTR_NE(expected->var, NULL); \\\n\t\topts = sshauthopt_parse( \\\n\t\t    \"restrict,\" keyword \"=\" #val \",restrict\", &errstr); \\\n\t\tCHECK_SUCCESS_AND_CLEANUP(); \\\n\t\tTEST_DONE(); \\\n\t} while (0)\n\tSTRING_TEST(\"command\", force_command, \"/bin/true\");\n\tSTRING_TEST(\"principals\", cert_principals, \"gregor,josef,K\");\n\tSTRING_TEST(\"from\", required_from_host_keys, \"127.0.0.0/8\");\n#undef STRING_TEST\n\tFAIL_TEST(\"unquoted command\", \"command=oops\");\n\tFAIL_TEST(\"unquoted principals\", \"principals=estragon\");\n\tFAIL_TEST(\"unquoted from\", \"from=127.0.0.1\");\n\n\t/* String array option tests */\n#define ARRAY_TEST(label, keywords, var, nvar, val) \\\n\tdo { \\\n\t\tTEST_START(\"sshauthopt_parse \" label); \\\n\t\texpected = default_authkey_opts(); \\\n\t\texpected->var = commasplit(val, &expected->nvar); \\\n\t\tASSERT_PTR_NE(expected->var, NULL); \\\n\t\topts = sshauthopt_parse(keywords, &errstr); \\\n\t\tCHECK_SUCCESS_AND_CLEANUP(); \\\n\t\texpected = default_authkey_restrict_opts(); \\\n\t\texpected->var = commasplit(val, &expected->nvar); \\\n\t\tASSERT_PTR_NE(expected->var, NULL); \\\n\t\topts = sshauthopt_parse( \\\n\t\t    \"restrict,\" keywords \",restrict\", &errstr); \\\n\t\tCHECK_SUCCESS_AND_CLEANUP(); \\\n\t\tTEST_DONE(); \\\n\t} while (0)\n\tARRAY_TEST(\"environment\", \"environment=\\\"foo=1\\\",environment=\\\"bar=2\\\"\",\n\t    env, nenv, \"foo=1,bar=2\");\n\tARRAY_TEST(\"permitopen\", \"permitopen=\\\"foo:123\\\",permitopen=\\\"bar:*\\\"\",\n\t    permitopen, npermitopen, \"foo:123,bar:*\");\n#undef ARRAY_TEST\n\tFAIL_TEST(\"environment\", \"environment=\\\",=bah\\\"\");\n\tFAIL_TEST(\"permitopen port\", \"foo:bar\");\n\tFAIL_TEST(\"permitopen missing port\", \"foo:\");\n\tFAIL_TEST(\"permitopen missing port specification\", \"foo\");\n\tFAIL_TEST(\"permitopen invalid host\", \"[:\");\n\n#undef CHECK_SUCCESS_AND_CLEANUP\n#undef FAIL_TEST\n}",
    "includes": [
      "#include \"log.h\"",
      "#include \"misc.h\"",
      "#include \"auth-options.h\"",
      "#include \"authfile.h\"",
      "#include \"sshkey.h\"",
      "#include \"test_helper.h\"",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <stdio.h>",
      "#include <sys/param.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "FAIL_TEST",
          "args": [
            "\"permitopen invalid host\"",
            "\"[:\""
          ],
          "line": 278
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "FAIL_TEST",
          "args": [
            "\"permitopen missing port specification\"",
            "\"foo\""
          ],
          "line": 277
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "FAIL_TEST",
          "args": [
            "\"permitopen missing port\"",
            "\"foo:\""
          ],
          "line": 276
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "FAIL_TEST",
          "args": [
            "\"permitopen port\"",
            "\"foo:bar\""
          ],
          "line": 275
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "FAIL_TEST",
          "args": [
            "\"environment\"",
            "\"environment=\\\",=bah\\\"\""
          ],
          "line": 274
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ARRAY_TEST",
          "args": [
            "\"permitopen\"",
            "\"permitopen=\\\"foo:123\\\",permitopen=\\\"bar:*\\\"\"",
            "permitopen",
            "npermitopen",
            "\"foo:123,bar:*\""
          ],
          "line": 271
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ARRAY_TEST",
          "args": [
            "\"environment\"",
            "\"environment=\\\"foo=1\\\",environment=\\\"bar=2\\\"\"",
            "env",
            "nenv",
            "\"foo=1,bar=2\""
          ],
          "line": 269
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "FAIL_TEST",
          "args": [
            "\"unquoted from\"",
            "\"from=127.0.0.1\""
          ],
          "line": 250
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "FAIL_TEST",
          "args": [
            "\"unquoted principals\"",
            "\"principals=estragon\""
          ],
          "line": 249
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "FAIL_TEST",
          "args": [
            "\"unquoted command\"",
            "\"command=oops\""
          ],
          "line": 248
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "STRING_TEST",
          "args": [
            "\"from\"",
            "required_from_host_keys",
            "\"127.0.0.0/8\""
          ],
          "line": 246
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "STRING_TEST",
          "args": [
            "\"principals\"",
            "cert_principals",
            "\"gregor,josef,K\""
          ],
          "line": 245
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "STRING_TEST",
          "args": [
            "\"command\"",
            "force_command",
            "\"/bin/true\""
          ],
          "line": 244
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "FAIL_TEST",
          "args": [
            "\"no-cert-authority\"",
            "\"no-cert-authority\""
          ],
          "line": 225
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "FLAG_TEST",
          "args": [
            "\"no-user-rc\"",
            "permit_user_rc",
            "0"
          ],
          "line": 223
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "FLAG_TEST",
          "args": [
            "\"no-pty\"",
            "permit_pty_flag",
            "0"
          ],
          "line": 222
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "FLAG_TEST",
          "args": [
            "\"no-x11-forwarding\"",
            "permit_x11_forwarding_flag",
            "0"
          ],
          "line": 221
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "FLAG_TEST",
          "args": [
            "\"no-agent-forwarding\"",
            "permit_agent_forwarding_flag",
            "0"
          ],
          "line": 220
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "FLAG_TEST",
          "args": [
            "\"no-port-forwarding\"",
            "permit_port_forwarding_flag",
            "0"
          ],
          "line": 219
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "FLAG_TEST",
          "args": [
            "\"user-rc\"",
            "permit_user_rc",
            "1"
          ],
          "line": 217
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "FLAG_TEST",
          "args": [
            "\"pty\"",
            "permit_pty_flag",
            "1"
          ],
          "line": 216
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "FLAG_TEST",
          "args": [
            "\"x11-forwarding\"",
            "permit_x11_forwarding_flag",
            "1"
          ],
          "line": 215
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "FLAG_TEST",
          "args": [
            "\"agent-forwarding\"",
            "permit_agent_forwarding_flag",
            "1"
          ],
          "line": 214
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "FLAG_TEST",
          "args": [
            "\"port-forwarding\"",
            "permit_port_forwarding_flag",
            "1"
          ],
          "line": 213
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "FLAG_TEST",
          "args": [
            "\"cert-authority\"",
            "cert_authority",
            "1"
          ],
          "line": 212
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "FAIL_TEST",
          "args": [
            "\"tunnel\"",
            "\"tunnel=\\\"blah\\\"\""
          ],
          "line": 195
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "TEST_DONE",
          "args": [],
          "line": 193
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "CHECK_SUCCESS_AND_CLEANUP",
          "args": [],
          "line": 192
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sshauthopt_parse",
          "args": [
            "\"tunnel=\\\"any\\\"\"",
            "&errstr"
          ],
          "line": 191
        },
        "resolved": true,
        "details": {
          "function_name": "sshauthopt_parse",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/auth-options.c",
          "lines": "383-539",
          "snippet": "struct sshauthopt *\nsshauthopt_parse(const char *opts, const char **errstrp)\n{\n\tchar **oarray, *opt, *cp, *tmp;\n\tint r;\n\tstruct sshauthopt *ret = NULL;\n\tconst char *errstr = \"unknown error\";\n\tuint64_t valid_before;\n\n\tif (errstrp != NULL)\n\t\t*errstrp = NULL;\n\tif ((ret = sshauthopt_new_with_keys_defaults()) == NULL)\n\t\tgoto alloc_fail;\n\n\tif (opts == NULL)\n\t\treturn ret;\n\n\twhile (*opts && *opts != ' ' && *opts != '\\t') {\n\t\t/* flag options */\n\t\tif ((r = opt_flag(\"restrict\", 0, &opts)) != -1) {\n\t\t\tret->restricted = 1;\n\t\t\tret->permit_port_forwarding_flag = 0;\n\t\t\tret->permit_agent_forwarding_flag = 0;\n\t\t\tret->permit_x11_forwarding_flag = 0;\n\t\t\tret->permit_pty_flag = 0;\n\t\t\tret->permit_user_rc = 0;\n\t\t} else if ((r = opt_flag(\"cert-authority\", 0, &opts)) != -1) {\n\t\t\tret->cert_authority = r;\n\t\t} else if ((r = opt_flag(\"port-forwarding\", 1, &opts)) != -1) {\n\t\t\tret->permit_port_forwarding_flag = r == 1;\n\t\t} else if ((r = opt_flag(\"agent-forwarding\", 1, &opts)) != -1) {\n\t\t\tret->permit_agent_forwarding_flag = r == 1;\n\t\t} else if ((r = opt_flag(\"x11-forwarding\", 1, &opts)) != -1) {\n\t\t\tret->permit_x11_forwarding_flag = r == 1;\n\t\t} else if ((r = opt_flag(\"pty\", 1, &opts)) != -1) {\n\t\t\tret->permit_pty_flag = r == 1;\n\t\t} else if ((r = opt_flag(\"user-rc\", 1, &opts)) != -1) {\n\t\t\tret->permit_user_rc = r == 1;\n\t\t} else if (opt_match(&opts, \"command\")) {\n\t\t\tif (ret->force_command != NULL) {\n\t\t\t\terrstr = \"multiple \\\"command\\\" clauses\";\n\t\t\t\tgoto fail;\n\t\t\t}\n\t\t\tret->force_command = opt_dequote(&opts, &errstr);\n\t\t\tif (ret->force_command == NULL)\n\t\t\t\tgoto fail;\n\t\t} else if (opt_match(&opts, \"principals\")) {\n\t\t\tif (ret->cert_principals != NULL) {\n\t\t\t\terrstr = \"multiple \\\"principals\\\" clauses\";\n\t\t\t\tgoto fail;\n\t\t\t}\n\t\t\tret->cert_principals = opt_dequote(&opts, &errstr);\n\t\t\tif (ret->cert_principals == NULL)\n\t\t\t\tgoto fail;\n\t\t} else if (opt_match(&opts, \"from\")) {\n\t\t\tif (ret->required_from_host_keys != NULL) {\n\t\t\t\terrstr = \"multiple \\\"from\\\" clauses\";\n\t\t\t\tgoto fail;\n\t\t\t}\n\t\t\tret->required_from_host_keys = opt_dequote(&opts,\n\t\t\t    &errstr);\n\t\t\tif (ret->required_from_host_keys == NULL)\n\t\t\t\tgoto fail;\n\t\t} else if (opt_match(&opts, \"expiry-time\")) {\n\t\t\tif ((opt = opt_dequote(&opts, &errstr)) == NULL)\n\t\t\t\tgoto fail;\n\t\t\tif (parse_absolute_time(opt, &valid_before) != 0 ||\n\t\t\t    valid_before == 0) {\n\t\t\t\tfree(opt);\n\t\t\t\terrstr = \"invalid expires time\";\n\t\t\t\tgoto fail;\n\t\t\t}\n\t\t\tfree(opt);\n\t\t\tif (ret->valid_before == 0 ||\n\t\t\t    valid_before < ret->valid_before)\n\t\t\t\tret->valid_before = valid_before;\n\t\t} else if (opt_match(&opts, \"environment\")) {\n\t\t\tif (ret->nenv > INT_MAX) {\n\t\t\t\terrstr = \"too many environment strings\";\n\t\t\t\tgoto fail;\n\t\t\t}\n\t\t\tif ((opt = opt_dequote(&opts, &errstr)) == NULL)\n\t\t\t\tgoto fail;\n\t\t\t/* env name must be alphanumeric and followed by '=' */\n\t\t\tif ((tmp = strchr(opt, '=')) == NULL) {\n\t\t\t\tfree(opt);\n\t\t\t\terrstr = \"invalid environment string\";\n\t\t\t\tgoto fail;\n\t\t\t}\n\t\t\tif ((cp = strdup(opt)) == NULL)\n\t\t\t\tgoto alloc_fail;\n\t\t\tcp[tmp - opt] = '\\0'; /* truncate at '=' */\n\t\t\tif (!valid_env_name(cp)) {\n\t\t\t\tfree(cp);\n\t\t\t\tfree(opt);\n\t\t\t\terrstr = \"invalid environment string\";\n\t\t\t\tgoto fail;\n\t\t\t}\n\t\t\tfree(cp);\n\t\t\t/* Append it. */\n\t\t\toarray = ret->env;\n\t\t\tif ((ret->env = recallocarray(ret->env, ret->nenv,\n\t\t\t    ret->nenv + 1, sizeof(*ret->env))) == NULL) {\n\t\t\t\tfree(opt);\n\t\t\t\tret->env = oarray; /* put it back for cleanup */\n\t\t\t\tgoto alloc_fail;\n\t\t\t}\n\t\t\tret->env[ret->nenv++] = opt;\n\t\t} else if (opt_match(&opts, \"permitopen\")) {\n\t\t\tif (handle_permit(&opts, 0, &ret->permitopen,\n\t\t\t    &ret->npermitopen, &errstr) != 0)\n\t\t\t\tgoto fail;\n\t\t} else if (opt_match(&opts, \"permitlisten\")) {\n\t\t\tif (handle_permit(&opts, 1, &ret->permitlisten,\n\t\t\t    &ret->npermitlisten, &errstr) != 0)\n\t\t\t\tgoto fail;\n\t\t} else if (opt_match(&opts, \"tunnel\")) {\n\t\t\tif ((opt = opt_dequote(&opts, &errstr)) == NULL)\n\t\t\t\tgoto fail;\n\t\t\tret->force_tun_device = a2tun(opt, NULL);\n\t\t\tfree(opt);\n\t\t\tif (ret->force_tun_device == SSH_TUNID_ERR) {\n\t\t\t\terrstr = \"invalid tun device\";\n\t\t\t\tgoto fail;\n\t\t\t}\n\t\t}\n\t\t/*\n\t\t * Skip the comma, and move to the next option\n\t\t * (or break out if there are no more).\n\t\t */\n\t\tif (*opts == '\\0' || *opts == ' ' || *opts == '\\t')\n\t\t\tbreak;\t\t/* End of options. */\n\t\t/* Anything other than a comma is an unknown option */\n\t\tif (*opts != ',') {\n\t\t\terrstr = \"unknown key option\";\n\t\t\tgoto fail;\n\t\t}\n\t\topts++;\n\t\tif (*opts == '\\0') {\n\t\t\terrstr = \"unexpected end-of-options\";\n\t\t\tgoto fail;\n\t\t}\n\t}\n\n\t/* success */\n\tif (errstrp != NULL)\n\t\t*errstrp = NULL;\n\treturn ret;\n\nalloc_fail:\n\terrstr = \"memory allocation failed\";\nfail:\n\tsshauthopt_free(ret);\n\tif (errstrp != NULL)\n\t\t*errstrp = errstr;\n\treturn NULL;\n}",
          "includes": [
            "#include \"auth-options.h\"",
            "#include \"ssh2.h\"",
            "#include \"match.h\"",
            "#include \"sshkey.h\"",
            "#include \"misc.h\"",
            "#include \"sshbuf.h\"",
            "#include \"log.h\"",
            "#include \"ssherr.h\"",
            "#include \"xmalloc.h\"",
            "#include \"openbsd-compat/sys-queue.h\"",
            "#include <limits.h>",
            "#include <ctype.h>",
            "#include <stdarg.h>",
            "#include <stdio.h>",
            "#include <string.h>",
            "#include <pwd.h>",
            "#include <netdb.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"auth-options.h\"\n#include \"ssh2.h\"\n#include \"match.h\"\n#include \"sshkey.h\"\n#include \"misc.h\"\n#include \"sshbuf.h\"\n#include \"log.h\"\n#include \"ssherr.h\"\n#include \"xmalloc.h\"\n#include \"openbsd-compat/sys-queue.h\"\n#include <limits.h>\n#include <ctype.h>\n#include <stdarg.h>\n#include <stdio.h>\n#include <string.h>\n#include <pwd.h>\n#include <netdb.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nstruct sshauthopt *\nsshauthopt_parse(const char *opts, const char **errstrp)\n{\n\tchar **oarray, *opt, *cp, *tmp;\n\tint r;\n\tstruct sshauthopt *ret = NULL;\n\tconst char *errstr = \"unknown error\";\n\tuint64_t valid_before;\n\n\tif (errstrp != NULL)\n\t\t*errstrp = NULL;\n\tif ((ret = sshauthopt_new_with_keys_defaults()) == NULL)\n\t\tgoto alloc_fail;\n\n\tif (opts == NULL)\n\t\treturn ret;\n\n\twhile (*opts && *opts != ' ' && *opts != '\\t') {\n\t\t/* flag options */\n\t\tif ((r = opt_flag(\"restrict\", 0, &opts)) != -1) {\n\t\t\tret->restricted = 1;\n\t\t\tret->permit_port_forwarding_flag = 0;\n\t\t\tret->permit_agent_forwarding_flag = 0;\n\t\t\tret->permit_x11_forwarding_flag = 0;\n\t\t\tret->permit_pty_flag = 0;\n\t\t\tret->permit_user_rc = 0;\n\t\t} else if ((r = opt_flag(\"cert-authority\", 0, &opts)) != -1) {\n\t\t\tret->cert_authority = r;\n\t\t} else if ((r = opt_flag(\"port-forwarding\", 1, &opts)) != -1) {\n\t\t\tret->permit_port_forwarding_flag = r == 1;\n\t\t} else if ((r = opt_flag(\"agent-forwarding\", 1, &opts)) != -1) {\n\t\t\tret->permit_agent_forwarding_flag = r == 1;\n\t\t} else if ((r = opt_flag(\"x11-forwarding\", 1, &opts)) != -1) {\n\t\t\tret->permit_x11_forwarding_flag = r == 1;\n\t\t} else if ((r = opt_flag(\"pty\", 1, &opts)) != -1) {\n\t\t\tret->permit_pty_flag = r == 1;\n\t\t} else if ((r = opt_flag(\"user-rc\", 1, &opts)) != -1) {\n\t\t\tret->permit_user_rc = r == 1;\n\t\t} else if (opt_match(&opts, \"command\")) {\n\t\t\tif (ret->force_command != NULL) {\n\t\t\t\terrstr = \"multiple \\\"command\\\" clauses\";\n\t\t\t\tgoto fail;\n\t\t\t}\n\t\t\tret->force_command = opt_dequote(&opts, &errstr);\n\t\t\tif (ret->force_command == NULL)\n\t\t\t\tgoto fail;\n\t\t} else if (opt_match(&opts, \"principals\")) {\n\t\t\tif (ret->cert_principals != NULL) {\n\t\t\t\terrstr = \"multiple \\\"principals\\\" clauses\";\n\t\t\t\tgoto fail;\n\t\t\t}\n\t\t\tret->cert_principals = opt_dequote(&opts, &errstr);\n\t\t\tif (ret->cert_principals == NULL)\n\t\t\t\tgoto fail;\n\t\t} else if (opt_match(&opts, \"from\")) {\n\t\t\tif (ret->required_from_host_keys != NULL) {\n\t\t\t\terrstr = \"multiple \\\"from\\\" clauses\";\n\t\t\t\tgoto fail;\n\t\t\t}\n\t\t\tret->required_from_host_keys = opt_dequote(&opts,\n\t\t\t    &errstr);\n\t\t\tif (ret->required_from_host_keys == NULL)\n\t\t\t\tgoto fail;\n\t\t} else if (opt_match(&opts, \"expiry-time\")) {\n\t\t\tif ((opt = opt_dequote(&opts, &errstr)) == NULL)\n\t\t\t\tgoto fail;\n\t\t\tif (parse_absolute_time(opt, &valid_before) != 0 ||\n\t\t\t    valid_before == 0) {\n\t\t\t\tfree(opt);\n\t\t\t\terrstr = \"invalid expires time\";\n\t\t\t\tgoto fail;\n\t\t\t}\n\t\t\tfree(opt);\n\t\t\tif (ret->valid_before == 0 ||\n\t\t\t    valid_before < ret->valid_before)\n\t\t\t\tret->valid_before = valid_before;\n\t\t} else if (opt_match(&opts, \"environment\")) {\n\t\t\tif (ret->nenv > INT_MAX) {\n\t\t\t\terrstr = \"too many environment strings\";\n\t\t\t\tgoto fail;\n\t\t\t}\n\t\t\tif ((opt = opt_dequote(&opts, &errstr)) == NULL)\n\t\t\t\tgoto fail;\n\t\t\t/* env name must be alphanumeric and followed by '=' */\n\t\t\tif ((tmp = strchr(opt, '=')) == NULL) {\n\t\t\t\tfree(opt);\n\t\t\t\terrstr = \"invalid environment string\";\n\t\t\t\tgoto fail;\n\t\t\t}\n\t\t\tif ((cp = strdup(opt)) == NULL)\n\t\t\t\tgoto alloc_fail;\n\t\t\tcp[tmp - opt] = '\\0'; /* truncate at '=' */\n\t\t\tif (!valid_env_name(cp)) {\n\t\t\t\tfree(cp);\n\t\t\t\tfree(opt);\n\t\t\t\terrstr = \"invalid environment string\";\n\t\t\t\tgoto fail;\n\t\t\t}\n\t\t\tfree(cp);\n\t\t\t/* Append it. */\n\t\t\toarray = ret->env;\n\t\t\tif ((ret->env = recallocarray(ret->env, ret->nenv,\n\t\t\t    ret->nenv + 1, sizeof(*ret->env))) == NULL) {\n\t\t\t\tfree(opt);\n\t\t\t\tret->env = oarray; /* put it back for cleanup */\n\t\t\t\tgoto alloc_fail;\n\t\t\t}\n\t\t\tret->env[ret->nenv++] = opt;\n\t\t} else if (opt_match(&opts, \"permitopen\")) {\n\t\t\tif (handle_permit(&opts, 0, &ret->permitopen,\n\t\t\t    &ret->npermitopen, &errstr) != 0)\n\t\t\t\tgoto fail;\n\t\t} else if (opt_match(&opts, \"permitlisten\")) {\n\t\t\tif (handle_permit(&opts, 1, &ret->permitlisten,\n\t\t\t    &ret->npermitlisten, &errstr) != 0)\n\t\t\t\tgoto fail;\n\t\t} else if (opt_match(&opts, \"tunnel\")) {\n\t\t\tif ((opt = opt_dequote(&opts, &errstr)) == NULL)\n\t\t\t\tgoto fail;\n\t\t\tret->force_tun_device = a2tun(opt, NULL);\n\t\t\tfree(opt);\n\t\t\tif (ret->force_tun_device == SSH_TUNID_ERR) {\n\t\t\t\terrstr = \"invalid tun device\";\n\t\t\t\tgoto fail;\n\t\t\t}\n\t\t}\n\t\t/*\n\t\t * Skip the comma, and move to the next option\n\t\t * (or break out if there are no more).\n\t\t */\n\t\tif (*opts == '\\0' || *opts == ' ' || *opts == '\\t')\n\t\t\tbreak;\t\t/* End of options. */\n\t\t/* Anything other than a comma is an unknown option */\n\t\tif (*opts != ',') {\n\t\t\terrstr = \"unknown key option\";\n\t\t\tgoto fail;\n\t\t}\n\t\topts++;\n\t\tif (*opts == '\\0') {\n\t\t\terrstr = \"unexpected end-of-options\";\n\t\t\tgoto fail;\n\t\t}\n\t}\n\n\t/* success */\n\tif (errstrp != NULL)\n\t\t*errstrp = NULL;\n\treturn ret;\n\nalloc_fail:\n\terrstr = \"memory allocation failed\";\nfail:\n\tsshauthopt_free(ret);\n\tif (errstrp != NULL)\n\t\t*errstrp = errstr;\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "default_authkey_opts",
          "args": [],
          "line": 189
        },
        "resolved": true,
        "details": {
          "function_name": "default_authkey_opts",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/regress/unittests/authopt/tests.c",
          "lines": "36-48",
          "snippet": "static struct sshauthopt *\ndefault_authkey_opts(void)\n{\n\tstruct sshauthopt *ret = sshauthopt_new();\n\n\tASSERT_PTR_NE(ret, NULL);\n\tret->permit_port_forwarding_flag = 1;\n\tret->permit_agent_forwarding_flag = 1;\n\tret->permit_x11_forwarding_flag = 1;\n\tret->permit_pty_flag = 1;\n\tret->permit_user_rc = 1;\n\treturn ret;\n}",
          "includes": [
            "#include \"log.h\"",
            "#include \"misc.h\"",
            "#include \"auth-options.h\"",
            "#include \"authfile.h\"",
            "#include \"sshkey.h\"",
            "#include \"test_helper.h\"",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <stdio.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n#include \"misc.h\"\n#include \"auth-options.h\"\n#include \"authfile.h\"\n#include \"sshkey.h\"\n#include \"test_helper.h\"\n#include <string.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdio.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic struct sshauthopt *\ndefault_authkey_opts(void)\n{\n\tstruct sshauthopt *ret = sshauthopt_new();\n\n\tASSERT_PTR_NE(ret, NULL);\n\tret->permit_port_forwarding_flag = 1;\n\tret->permit_agent_forwarding_flag = 1;\n\tret->permit_x11_forwarding_flag = 1;\n\tret->permit_pty_flag = 1;\n\tret->permit_user_rc = 1;\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "TEST_START",
          "args": [
            "\"sshauthopt_parse tunnel any\""
          ],
          "line": 188
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "TEST_DONE",
          "args": [],
          "line": 186
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "CHECK_SUCCESS_AND_CLEANUP",
          "args": [],
          "line": 185
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "TEST_START",
          "args": [
            "\"sshauthopt_parse tunnel explicit\""
          ],
          "line": 181
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "FAIL_TEST",
          "args": [
            "\"unknown option with trailing whitespace\"",
            "\"BLAH \""
          ],
          "line": 178
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "FAIL_TEST",
          "args": [
            "\"unknown option with trailing comma\"",
            "\"BLAH,\""
          ],
          "line": 177
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "FAIL_TEST",
          "args": [
            "\"unknown option\"",
            "\"BLAH\""
          ],
          "line": 176
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "FAIL_TEST",
          "args": [
            "\"bare comma\"",
            "\",\""
          ],
          "line": 175
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "FAIL_TEST",
          "args": [
            "\"trailing comma\"",
            "\"restrict,\""
          ],
          "line": 174
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "TEST_DONE",
          "args": [],
          "line": 171
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "CHECK_SUCCESS_AND_CLEANUP",
          "args": [],
          "line": 170
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "default_authkey_restrict_opts",
          "args": [],
          "line": 168
        },
        "resolved": true,
        "details": {
          "function_name": "default_authkey_restrict_opts",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/regress/unittests/authopt/tests.c",
          "lines": "50-63",
          "snippet": "static struct sshauthopt *\ndefault_authkey_restrict_opts(void)\n{\n\tstruct sshauthopt *ret = sshauthopt_new();\n\n\tASSERT_PTR_NE(ret, NULL);\n\tret->permit_port_forwarding_flag = 0;\n\tret->permit_agent_forwarding_flag = 0;\n\tret->permit_x11_forwarding_flag = 0;\n\tret->permit_pty_flag = 0;\n\tret->permit_user_rc = 0;\n\tret->restricted = 1;\n\treturn ret;\n}",
          "includes": [
            "#include \"log.h\"",
            "#include \"misc.h\"",
            "#include \"auth-options.h\"",
            "#include \"authfile.h\"",
            "#include \"sshkey.h\"",
            "#include \"test_helper.h\"",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <stdio.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n#include \"misc.h\"\n#include \"auth-options.h\"\n#include \"authfile.h\"\n#include \"sshkey.h\"\n#include \"test_helper.h\"\n#include <string.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdio.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic struct sshauthopt *\ndefault_authkey_restrict_opts(void)\n{\n\tstruct sshauthopt *ret = sshauthopt_new();\n\n\tASSERT_PTR_NE(ret, NULL);\n\tret->permit_port_forwarding_flag = 0;\n\tret->permit_agent_forwarding_flag = 0;\n\tret->permit_x11_forwarding_flag = 0;\n\tret->permit_pty_flag = 0;\n\tret->permit_user_rc = 0;\n\tret->restricted = 1;\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "TEST_START",
          "args": [
            "\"sshauthopt_parse restrict\""
          ],
          "line": 167
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "TEST_DONE",
          "args": [],
          "line": 165
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "CHECK_SUCCESS_AND_CLEANUP",
          "args": [],
          "line": 164
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "TEST_START",
          "args": [
            "\"sshauthopt_parse trailing whitespace\""
          ],
          "line": 161
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "TEST_DONE",
          "args": [],
          "line": 159
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "CHECK_SUCCESS_AND_CLEANUP",
          "args": [],
          "line": 158
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "TEST_START",
          "args": [
            "\"sshauthopt_parse empty\""
          ],
          "line": 155
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"log.h\"\n#include \"misc.h\"\n#include \"auth-options.h\"\n#include \"authfile.h\"\n#include \"sshkey.h\"\n#include \"test_helper.h\"\n#include <string.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdio.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void\ntest_authkeys_parse(void)\n{\n\tstruct sshauthopt *opts, *expected;\n\tconst char *errstr;\n\n#define FAIL_TEST(label, keywords) \\\n\tdo { \\\n\t\tTEST_START(\"sshauthopt_parse invalid \" label); \\\n\t\topts = sshauthopt_parse(keywords, &errstr); \\\n\t\tASSERT_PTR_EQ(opts, NULL); \\\n\t\tASSERT_PTR_NE(errstr, NULL); \\\n\t\tTEST_DONE(); \\\n\t} while (0) \n#define CHECK_SUCCESS_AND_CLEANUP() \\\n\tdo { \\\n\t\tif (errstr != NULL) \\\n\t\t\tASSERT_STRING_EQ(errstr, \"\"); \\\n\t\tcompare_opts(opts, expected); \\\n\t\tsshauthopt_free(expected); \\\n\t\tsshauthopt_free(opts); \\\n\t} while (0)\n\n\t/* Basic tests */\n\tTEST_START(\"sshauthopt_parse empty\");\n\texpected = default_authkey_opts();\n\topts = sshauthopt_parse(\"\", &errstr);\n\tCHECK_SUCCESS_AND_CLEANUP();\n\tTEST_DONE();\n\n\tTEST_START(\"sshauthopt_parse trailing whitespace\");\n\texpected = default_authkey_opts();\n\topts = sshauthopt_parse(\" \", &errstr);\n\tCHECK_SUCCESS_AND_CLEANUP();\n\tTEST_DONE();\n\n\tTEST_START(\"sshauthopt_parse restrict\");\n\texpected = default_authkey_restrict_opts();\n\topts = sshauthopt_parse(\"restrict\", &errstr);\n\tCHECK_SUCCESS_AND_CLEANUP();\n\tTEST_DONE();\n\n\t/* Invalid syntax */\n\tFAIL_TEST(\"trailing comma\", \"restrict,\");\n\tFAIL_TEST(\"bare comma\", \",\");\n\tFAIL_TEST(\"unknown option\", \"BLAH\");\n\tFAIL_TEST(\"unknown option with trailing comma\", \"BLAH,\");\n\tFAIL_TEST(\"unknown option with trailing whitespace\", \"BLAH \");\n\n\t/* force_tun_device */\n\tTEST_START(\"sshauthopt_parse tunnel explicit\");\n\texpected = default_authkey_opts();\n\texpected->force_tun_device = 1;\n\topts = sshauthopt_parse(\"tunnel=\\\"1\\\"\", &errstr);\n\tCHECK_SUCCESS_AND_CLEANUP();\n\tTEST_DONE();\n\n\tTEST_START(\"sshauthopt_parse tunnel any\");\n\texpected = default_authkey_opts();\n\texpected->force_tun_device = SSH_TUNID_ANY;\n\topts = sshauthopt_parse(\"tunnel=\\\"any\\\"\", &errstr);\n\tCHECK_SUCCESS_AND_CLEANUP();\n\tTEST_DONE();\n\n\tFAIL_TEST(\"tunnel\", \"tunnel=\\\"blah\\\"\");\n\n\t/* Flag options */\n#define FLAG_TEST(keyword, var, val) \\\n\tdo { \\\n\t\tTEST_START(\"sshauthopt_parse \" keyword); \\\n\t\texpected = default_authkey_opts(); \\\n\t\texpected->var = val; \\\n\t\topts = sshauthopt_parse(keyword, &errstr); \\\n\t\tCHECK_SUCCESS_AND_CLEANUP(); \\\n\t\texpected = default_authkey_restrict_opts(); \\\n\t\texpected->var = val; \\\n\t\topts = sshauthopt_parse(\"restrict,\"keyword, &errstr); \\\n\t\tCHECK_SUCCESS_AND_CLEANUP(); \\\n\t\tTEST_DONE(); \\\n\t} while (0)\n\t/* Positive flags */\n\tFLAG_TEST(\"cert-authority\", cert_authority, 1);\n\tFLAG_TEST(\"port-forwarding\", permit_port_forwarding_flag, 1);\n\tFLAG_TEST(\"agent-forwarding\", permit_agent_forwarding_flag, 1);\n\tFLAG_TEST(\"x11-forwarding\", permit_x11_forwarding_flag, 1);\n\tFLAG_TEST(\"pty\", permit_pty_flag, 1);\n\tFLAG_TEST(\"user-rc\", permit_user_rc, 1);\n\t/* Negative flags */\n\tFLAG_TEST(\"no-port-forwarding\", permit_port_forwarding_flag, 0);\n\tFLAG_TEST(\"no-agent-forwarding\", permit_agent_forwarding_flag, 0);\n\tFLAG_TEST(\"no-x11-forwarding\", permit_x11_forwarding_flag, 0);\n\tFLAG_TEST(\"no-pty\", permit_pty_flag, 0);\n\tFLAG_TEST(\"no-user-rc\", permit_user_rc, 0);\n#undef FLAG_TEST\n\tFAIL_TEST(\"no-cert-authority\", \"no-cert-authority\");\n\n\t/* String options */\n#define STRING_TEST(keyword, var, val) \\\n\tdo { \\\n\t\tTEST_START(\"sshauthopt_parse \" keyword); \\\n\t\texpected = default_authkey_opts(); \\\n\t\texpected->var = strdup(val); \\\n\t\tASSERT_PTR_NE(expected->var, NULL); \\\n\t\topts = sshauthopt_parse(keyword \"=\" #val, &errstr); \\\n\t\tCHECK_SUCCESS_AND_CLEANUP(); \\\n\t\texpected = default_authkey_restrict_opts(); \\\n\t\texpected->var = strdup(val); \\\n\t\tASSERT_PTR_NE(expected->var, NULL); \\\n\t\topts = sshauthopt_parse( \\\n\t\t    \"restrict,\" keyword \"=\" #val \",restrict\", &errstr); \\\n\t\tCHECK_SUCCESS_AND_CLEANUP(); \\\n\t\tTEST_DONE(); \\\n\t} while (0)\n\tSTRING_TEST(\"command\", force_command, \"/bin/true\");\n\tSTRING_TEST(\"principals\", cert_principals, \"gregor,josef,K\");\n\tSTRING_TEST(\"from\", required_from_host_keys, \"127.0.0.0/8\");\n#undef STRING_TEST\n\tFAIL_TEST(\"unquoted command\", \"command=oops\");\n\tFAIL_TEST(\"unquoted principals\", \"principals=estragon\");\n\tFAIL_TEST(\"unquoted from\", \"from=127.0.0.1\");\n\n\t/* String array option tests */\n#define ARRAY_TEST(label, keywords, var, nvar, val) \\\n\tdo { \\\n\t\tTEST_START(\"sshauthopt_parse \" label); \\\n\t\texpected = default_authkey_opts(); \\\n\t\texpected->var = commasplit(val, &expected->nvar); \\\n\t\tASSERT_PTR_NE(expected->var, NULL); \\\n\t\topts = sshauthopt_parse(keywords, &errstr); \\\n\t\tCHECK_SUCCESS_AND_CLEANUP(); \\\n\t\texpected = default_authkey_restrict_opts(); \\\n\t\texpected->var = commasplit(val, &expected->nvar); \\\n\t\tASSERT_PTR_NE(expected->var, NULL); \\\n\t\topts = sshauthopt_parse( \\\n\t\t    \"restrict,\" keywords \",restrict\", &errstr); \\\n\t\tCHECK_SUCCESS_AND_CLEANUP(); \\\n\t\tTEST_DONE(); \\\n\t} while (0)\n\tARRAY_TEST(\"environment\", \"environment=\\\"foo=1\\\",environment=\\\"bar=2\\\"\",\n\t    env, nenv, \"foo=1,bar=2\");\n\tARRAY_TEST(\"permitopen\", \"permitopen=\\\"foo:123\\\",permitopen=\\\"bar:*\\\"\",\n\t    permitopen, npermitopen, \"foo:123,bar:*\");\n#undef ARRAY_TEST\n\tFAIL_TEST(\"environment\", \"environment=\\\",=bah\\\"\");\n\tFAIL_TEST(\"permitopen port\", \"foo:bar\");\n\tFAIL_TEST(\"permitopen missing port\", \"foo:\");\n\tFAIL_TEST(\"permitopen missing port specification\", \"foo\");\n\tFAIL_TEST(\"permitopen invalid host\", \"[:\");\n\n#undef CHECK_SUCCESS_AND_CLEANUP\n#undef FAIL_TEST\n}"
  },
  {
    "function_name": "compare_opts",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/regress/unittests/authopt/tests.c",
    "lines": "85-129",
    "snippet": "static void\ncompare_opts(const struct sshauthopt *opts,\n    const struct sshauthopt *expected)\n{\n\tsize_t i;\n\n\tASSERT_PTR_NE(opts, NULL);\n\tASSERT_PTR_NE(expected, NULL);\n\tASSERT_PTR_NE(expected, opts); /* bozo :) */\n\n#define FLAG_EQ(x) ASSERT_INT_EQ(opts->x, expected->x)\n\tFLAG_EQ(permit_port_forwarding_flag);\n\tFLAG_EQ(permit_agent_forwarding_flag);\n\tFLAG_EQ(permit_x11_forwarding_flag);\n\tFLAG_EQ(permit_pty_flag);\n\tFLAG_EQ(permit_user_rc);\n\tFLAG_EQ(restricted);\n\tFLAG_EQ(cert_authority);\n#undef FLAG_EQ\n\n#define STR_EQ(x) \\\n\tdo { \\\n\t\tif (expected->x == NULL) \\\n\t\t\tASSERT_PTR_EQ(opts->x, expected->x); \\\n\t\telse \\\n\t\t\tASSERT_STRING_EQ(opts->x, expected->x); \\\n\t} while (0)\n\tSTR_EQ(cert_principals);\n\tSTR_EQ(force_command);\n\tSTR_EQ(required_from_host_cert);\n\tSTR_EQ(required_from_host_keys);\n#undef STR_EQ\n\n#define ARRAY_EQ(nx, x) \\\n\tdo { \\\n\t\tASSERT_SIZE_T_EQ(opts->nx, expected->nx); \\\n\t\tif (expected->nx == 0) \\\n\t\t\tbreak; \\\n\t\tfor (i = 0; i < expected->nx; i++) \\\n\t\t\tASSERT_STRING_EQ(opts->x[i], expected->x[i]); \\\n\t} while (0)\n\tARRAY_EQ(nenv, env);\n\tARRAY_EQ(npermitopen, permitopen);\n#undef ARRAY_EQ\n}",
    "includes": [
      "#include \"log.h\"",
      "#include \"misc.h\"",
      "#include \"auth-options.h\"",
      "#include \"authfile.h\"",
      "#include \"sshkey.h\"",
      "#include \"test_helper.h\"",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <stdio.h>",
      "#include <sys/param.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "ARRAY_EQ",
          "args": [
            "npermitopen",
            "permitopen"
          ],
          "line": 127
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ARRAY_EQ",
          "args": [
            "nenv",
            "env"
          ],
          "line": 126
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "STR_EQ",
          "args": [
            "required_from_host_keys"
          ],
          "line": 115
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "STR_EQ",
          "args": [
            "required_from_host_cert"
          ],
          "line": 114
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "STR_EQ",
          "args": [
            "force_command"
          ],
          "line": 113
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "STR_EQ",
          "args": [
            "cert_principals"
          ],
          "line": 112
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "FLAG_EQ",
          "args": [
            "cert_authority"
          ],
          "line": 102
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "FLAG_EQ",
          "args": [
            "restricted"
          ],
          "line": 101
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "FLAG_EQ",
          "args": [
            "permit_user_rc"
          ],
          "line": 100
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "FLAG_EQ",
          "args": [
            "permit_pty_flag"
          ],
          "line": 99
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "FLAG_EQ",
          "args": [
            "permit_x11_forwarding_flag"
          ],
          "line": 98
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "FLAG_EQ",
          "args": [
            "permit_agent_forwarding_flag"
          ],
          "line": 97
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "FLAG_EQ",
          "args": [
            "permit_port_forwarding_flag"
          ],
          "line": 96
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASSERT_PTR_NE",
          "args": [
            "expected",
            "opts"
          ],
          "line": 93
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASSERT_PTR_NE",
          "args": [
            "expected",
            "NULL"
          ],
          "line": 92
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASSERT_PTR_NE",
          "args": [
            "opts",
            "NULL"
          ],
          "line": 91
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"log.h\"\n#include \"misc.h\"\n#include \"auth-options.h\"\n#include \"authfile.h\"\n#include \"sshkey.h\"\n#include \"test_helper.h\"\n#include <string.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdio.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void\ncompare_opts(const struct sshauthopt *opts,\n    const struct sshauthopt *expected)\n{\n\tsize_t i;\n\n\tASSERT_PTR_NE(opts, NULL);\n\tASSERT_PTR_NE(expected, NULL);\n\tASSERT_PTR_NE(expected, opts); /* bozo :) */\n\n#define FLAG_EQ(x) ASSERT_INT_EQ(opts->x, expected->x)\n\tFLAG_EQ(permit_port_forwarding_flag);\n\tFLAG_EQ(permit_agent_forwarding_flag);\n\tFLAG_EQ(permit_x11_forwarding_flag);\n\tFLAG_EQ(permit_pty_flag);\n\tFLAG_EQ(permit_user_rc);\n\tFLAG_EQ(restricted);\n\tFLAG_EQ(cert_authority);\n#undef FLAG_EQ\n\n#define STR_EQ(x) \\\n\tdo { \\\n\t\tif (expected->x == NULL) \\\n\t\t\tASSERT_PTR_EQ(opts->x, expected->x); \\\n\t\telse \\\n\t\t\tASSERT_STRING_EQ(opts->x, expected->x); \\\n\t} while (0)\n\tSTR_EQ(cert_principals);\n\tSTR_EQ(force_command);\n\tSTR_EQ(required_from_host_cert);\n\tSTR_EQ(required_from_host_keys);\n#undef STR_EQ\n\n#define ARRAY_EQ(nx, x) \\\n\tdo { \\\n\t\tASSERT_SIZE_T_EQ(opts->nx, expected->nx); \\\n\t\tif (expected->nx == 0) \\\n\t\t\tbreak; \\\n\t\tfor (i = 0; i < expected->nx; i++) \\\n\t\t\tASSERT_STRING_EQ(opts->x[i], expected->x[i]); \\\n\t} while (0)\n\tARRAY_EQ(nenv, env);\n\tARRAY_EQ(npermitopen, permitopen);\n#undef ARRAY_EQ\n}"
  },
  {
    "function_name": "commasplit",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/regress/unittests/authopt/tests.c",
    "lines": "65-83",
    "snippet": "static char **\ncommasplit(const char *s, size_t *np)\n{\n\tchar *ocp, *cp, *cp2, **ret = NULL;\n\tsize_t n;\n\n\tocp = cp = strdup(s);\n\tASSERT_PTR_NE(cp, NULL);\n\tfor (n = 0; (cp2 = strsep(&cp, \",\")) != NULL;) {\n\t\tret = recallocarray(ret, n, n + 1, sizeof(*ret));\n\t\tASSERT_PTR_NE(ret, NULL);\n\t\tcp2 = strdup(cp2);\n\t\tASSERT_PTR_NE(cp2, NULL);\n\t\tret[n++] = cp2;\n\t}\n\tfree(ocp);\n\t*np = n;\n\treturn ret;\n}",
    "includes": [
      "#include \"log.h\"",
      "#include \"misc.h\"",
      "#include \"auth-options.h\"",
      "#include \"authfile.h\"",
      "#include \"sshkey.h\"",
      "#include \"test_helper.h\"",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <stdio.h>",
      "#include <sys/param.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "ocp"
          ],
          "line": 80
        },
        "resolved": true,
        "details": {
          "function_name": "freeze",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/smult_curve25519_ref.c",
          "lines": "50-60",
          "snippet": "static void freeze(unsigned int a[32])\n{\n  unsigned int aorig[32];\n  unsigned int j;\n  unsigned int negative;\n\n  for (j = 0;j < 32;++j) aorig[j] = a[j];\n  add(a,a,minusp);\n  negative = -((a[31] >> 7) & 1);\n  for (j = 0;j < 32;++j) a[j] ^= negative & (aorig[j] ^ a[j]);\n}",
          "includes": [],
          "macros_used": [],
          "globals_used": [
            "static const unsigned int minusp[32] = {\n 19, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 128\n} ;"
          ],
          "called_functions": [],
          "contextual_snippet": "static const unsigned int minusp[32] = {\n 19, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 128\n} ;\n\nstatic void freeze(unsigned int a[32])\n{\n  unsigned int aorig[32];\n  unsigned int j;\n  unsigned int negative;\n\n  for (j = 0;j < 32;++j) aorig[j] = a[j];\n  add(a,a,minusp);\n  negative = -((a[31] >> 7) & 1);\n  for (j = 0;j < 32;++j) a[j] ^= negative & (aorig[j] ^ a[j]);\n}"
        }
      },
      {
        "call_info": {
          "callee": "ASSERT_PTR_NE",
          "args": [
            "cp2",
            "NULL"
          ],
          "line": 77
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strdup",
          "args": [
            "cp2"
          ],
          "line": 76
        },
        "resolved": true,
        "details": {
          "function_name": "xstrdup",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/xmalloc.c",
          "lines": "92-102",
          "snippet": "char *\nxstrdup(const char *str)\n{\n\tsize_t len;\n\tchar *cp;\n\n\tlen = strlen(str) + 1;\n\tcp = xmalloc(len);\n\tstrlcpy(cp, str, len);\n\treturn cp;\n}",
          "includes": [
            "#include \"log.h\"",
            "#include \"xmalloc.h\"",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdint.h>",
            "#include <stdarg.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n#include \"xmalloc.h\"\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdint.h>\n#include <stdarg.h>\n#include \"includes.h\"\n\nchar *\nxstrdup(const char *str)\n{\n\tsize_t len;\n\tchar *cp;\n\n\tlen = strlen(str) + 1;\n\tcp = xmalloc(len);\n\tstrlcpy(cp, str, len);\n\treturn cp;\n}"
        }
      },
      {
        "call_info": {
          "callee": "ASSERT_PTR_NE",
          "args": [
            "ret",
            "NULL"
          ],
          "line": 75
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "recallocarray",
          "args": [
            "ret",
            "n",
            "n + 1",
            "sizeof(*ret)"
          ],
          "line": 74
        },
        "resolved": true,
        "details": {
          "function_name": "xrecallocarray",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/xmalloc.c",
          "lines": "80-90",
          "snippet": "void *\nxrecallocarray(void *ptr, size_t onmemb, size_t nmemb, size_t size)\n{\n\tvoid *new_ptr;\n\n\tnew_ptr = recallocarray(ptr, onmemb, nmemb, size);\n\tif (new_ptr == NULL)\n\t\tfatal(\"xrecallocarray: out of memory (%zu elements of %zu bytes)\",\n\t\t    nmemb, size);\n\treturn new_ptr;\n}",
          "includes": [
            "#include \"log.h\"",
            "#include \"xmalloc.h\"",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdint.h>",
            "#include <stdarg.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n#include \"xmalloc.h\"\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdint.h>\n#include <stdarg.h>\n#include \"includes.h\"\n\nvoid *\nxrecallocarray(void *ptr, size_t onmemb, size_t nmemb, size_t size)\n{\n\tvoid *new_ptr;\n\n\tnew_ptr = recallocarray(ptr, onmemb, nmemb, size);\n\tif (new_ptr == NULL)\n\t\tfatal(\"xrecallocarray: out of memory (%zu elements of %zu bytes)\",\n\t\t    nmemb, size);\n\treturn new_ptr;\n}"
        }
      },
      {
        "call_info": {
          "callee": "strsep",
          "args": [
            "&cp",
            "\",\""
          ],
          "line": 73
        },
        "resolved": true,
        "details": {
          "function_name": "xstrsep",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/ssh-keyscan.c",
          "lines": "162-178",
          "snippet": "static char *\nxstrsep(char **str, const char *delim)\n{\n\tchar *s, *e;\n\n\tif (!**str)\n\t\treturn (NULL);\n\n\ts = *str;\n\te = s + strcspn(s, delim);\n\n\tif (*e != '\\0')\n\t\t*e++ = '\\0';\n\t*str = e;\n\n\treturn (s);\n}",
          "includes": [
            "#include \"dns.h\"",
            "#include \"ssh_api.h\"",
            "#include \"ssherr.h\"",
            "#include \"hostfile.h\"",
            "#include \"misc.h\"",
            "#include \"atomicio.h\"",
            "#include \"log.h\"",
            "#include \"dispatch.h\"",
            "#include \"packet.h\"",
            "#include \"myproposal.h\"",
            "#include \"compat.h\"",
            "#include \"kex.h\"",
            "#include \"cipher.h\"",
            "#include \"sshkey.h\"",
            "#include \"sshbuf.h\"",
            "#include \"ssh.h\"",
            "#include \"xmalloc.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <signal.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <errno.h>",
            "#include <netdb.h>",
            "#include <openssl/bn.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/resource.h>",
            "#include \"openbsd-compat/sys-queue.h\"",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"dns.h\"\n#include \"ssh_api.h\"\n#include \"ssherr.h\"\n#include \"hostfile.h\"\n#include \"misc.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"dispatch.h\"\n#include \"packet.h\"\n#include \"myproposal.h\"\n#include \"compat.h\"\n#include \"kex.h\"\n#include \"cipher.h\"\n#include \"sshkey.h\"\n#include \"sshbuf.h\"\n#include \"ssh.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <string.h>\n#include <signal.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <errno.h>\n#include <netdb.h>\n#include <openssl/bn.h>\n#include <arpa/inet.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/resource.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nstatic char *\nxstrsep(char **str, const char *delim)\n{\n\tchar *s, *e;\n\n\tif (!**str)\n\t\treturn (NULL);\n\n\ts = *str;\n\te = s + strcspn(s, delim);\n\n\tif (*e != '\\0')\n\t\t*e++ = '\\0';\n\t*str = e;\n\n\treturn (s);\n}"
        }
      },
      {
        "call_info": {
          "callee": "ASSERT_PTR_NE",
          "args": [
            "cp",
            "NULL"
          ],
          "line": 72
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"log.h\"\n#include \"misc.h\"\n#include \"auth-options.h\"\n#include \"authfile.h\"\n#include \"sshkey.h\"\n#include \"test_helper.h\"\n#include <string.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdio.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic char **\ncommasplit(const char *s, size_t *np)\n{\n\tchar *ocp, *cp, *cp2, **ret = NULL;\n\tsize_t n;\n\n\tocp = cp = strdup(s);\n\tASSERT_PTR_NE(cp, NULL);\n\tfor (n = 0; (cp2 = strsep(&cp, \",\")) != NULL;) {\n\t\tret = recallocarray(ret, n, n + 1, sizeof(*ret));\n\t\tASSERT_PTR_NE(ret, NULL);\n\t\tcp2 = strdup(cp2);\n\t\tASSERT_PTR_NE(cp2, NULL);\n\t\tret[n++] = cp2;\n\t}\n\tfree(ocp);\n\t*np = n;\n\treturn ret;\n}"
  },
  {
    "function_name": "default_authkey_restrict_opts",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/regress/unittests/authopt/tests.c",
    "lines": "50-63",
    "snippet": "static struct sshauthopt *\ndefault_authkey_restrict_opts(void)\n{\n\tstruct sshauthopt *ret = sshauthopt_new();\n\n\tASSERT_PTR_NE(ret, NULL);\n\tret->permit_port_forwarding_flag = 0;\n\tret->permit_agent_forwarding_flag = 0;\n\tret->permit_x11_forwarding_flag = 0;\n\tret->permit_pty_flag = 0;\n\tret->permit_user_rc = 0;\n\tret->restricted = 1;\n\treturn ret;\n}",
    "includes": [
      "#include \"log.h\"",
      "#include \"misc.h\"",
      "#include \"auth-options.h\"",
      "#include \"authfile.h\"",
      "#include \"sshkey.h\"",
      "#include \"test_helper.h\"",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <stdio.h>",
      "#include <sys/param.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "ASSERT_PTR_NE",
          "args": [
            "ret",
            "NULL"
          ],
          "line": 55
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sshauthopt_new",
          "args": [],
          "line": 53
        },
        "resolved": true,
        "details": {
          "function_name": "sshauthopt_new_with_keys_defaults",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/auth-options.c",
          "lines": "294-309",
          "snippet": "struct sshauthopt *\nsshauthopt_new_with_keys_defaults(void)\n{\n\tstruct sshauthopt *ret = NULL;\n\n\tif ((ret = sshauthopt_new()) == NULL)\n\t\treturn NULL;\n\n\t/* Defaults for authorized_keys flags */\n\tret->permit_port_forwarding_flag = 1;\n\tret->permit_agent_forwarding_flag = 1;\n\tret->permit_x11_forwarding_flag = 1;\n\tret->permit_pty_flag = 1;\n\tret->permit_user_rc = 1;\n\treturn ret;\n}",
          "includes": [
            "#include \"auth-options.h\"",
            "#include \"ssh2.h\"",
            "#include \"match.h\"",
            "#include \"sshkey.h\"",
            "#include \"misc.h\"",
            "#include \"sshbuf.h\"",
            "#include \"log.h\"",
            "#include \"ssherr.h\"",
            "#include \"xmalloc.h\"",
            "#include \"openbsd-compat/sys-queue.h\"",
            "#include <limits.h>",
            "#include <ctype.h>",
            "#include <stdarg.h>",
            "#include <stdio.h>",
            "#include <string.h>",
            "#include <pwd.h>",
            "#include <netdb.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"auth-options.h\"\n#include \"ssh2.h\"\n#include \"match.h\"\n#include \"sshkey.h\"\n#include \"misc.h\"\n#include \"sshbuf.h\"\n#include \"log.h\"\n#include \"ssherr.h\"\n#include \"xmalloc.h\"\n#include \"openbsd-compat/sys-queue.h\"\n#include <limits.h>\n#include <ctype.h>\n#include <stdarg.h>\n#include <stdio.h>\n#include <string.h>\n#include <pwd.h>\n#include <netdb.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nstruct sshauthopt *\nsshauthopt_new_with_keys_defaults(void)\n{\n\tstruct sshauthopt *ret = NULL;\n\n\tif ((ret = sshauthopt_new()) == NULL)\n\t\treturn NULL;\n\n\t/* Defaults for authorized_keys flags */\n\tret->permit_port_forwarding_flag = 1;\n\tret->permit_agent_forwarding_flag = 1;\n\tret->permit_x11_forwarding_flag = 1;\n\tret->permit_pty_flag = 1;\n\tret->permit_user_rc = 1;\n\treturn ret;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"log.h\"\n#include \"misc.h\"\n#include \"auth-options.h\"\n#include \"authfile.h\"\n#include \"sshkey.h\"\n#include \"test_helper.h\"\n#include <string.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdio.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic struct sshauthopt *\ndefault_authkey_restrict_opts(void)\n{\n\tstruct sshauthopt *ret = sshauthopt_new();\n\n\tASSERT_PTR_NE(ret, NULL);\n\tret->permit_port_forwarding_flag = 0;\n\tret->permit_agent_forwarding_flag = 0;\n\tret->permit_x11_forwarding_flag = 0;\n\tret->permit_pty_flag = 0;\n\tret->permit_user_rc = 0;\n\tret->restricted = 1;\n\treturn ret;\n}"
  },
  {
    "function_name": "default_authkey_opts",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/regress/unittests/authopt/tests.c",
    "lines": "36-48",
    "snippet": "static struct sshauthopt *\ndefault_authkey_opts(void)\n{\n\tstruct sshauthopt *ret = sshauthopt_new();\n\n\tASSERT_PTR_NE(ret, NULL);\n\tret->permit_port_forwarding_flag = 1;\n\tret->permit_agent_forwarding_flag = 1;\n\tret->permit_x11_forwarding_flag = 1;\n\tret->permit_pty_flag = 1;\n\tret->permit_user_rc = 1;\n\treturn ret;\n}",
    "includes": [
      "#include \"log.h\"",
      "#include \"misc.h\"",
      "#include \"auth-options.h\"",
      "#include \"authfile.h\"",
      "#include \"sshkey.h\"",
      "#include \"test_helper.h\"",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <stdio.h>",
      "#include <sys/param.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "ASSERT_PTR_NE",
          "args": [
            "ret",
            "NULL"
          ],
          "line": 41
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sshauthopt_new",
          "args": [],
          "line": 39
        },
        "resolved": true,
        "details": {
          "function_name": "sshauthopt_new_with_keys_defaults",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/auth-options.c",
          "lines": "294-309",
          "snippet": "struct sshauthopt *\nsshauthopt_new_with_keys_defaults(void)\n{\n\tstruct sshauthopt *ret = NULL;\n\n\tif ((ret = sshauthopt_new()) == NULL)\n\t\treturn NULL;\n\n\t/* Defaults for authorized_keys flags */\n\tret->permit_port_forwarding_flag = 1;\n\tret->permit_agent_forwarding_flag = 1;\n\tret->permit_x11_forwarding_flag = 1;\n\tret->permit_pty_flag = 1;\n\tret->permit_user_rc = 1;\n\treturn ret;\n}",
          "includes": [
            "#include \"auth-options.h\"",
            "#include \"ssh2.h\"",
            "#include \"match.h\"",
            "#include \"sshkey.h\"",
            "#include \"misc.h\"",
            "#include \"sshbuf.h\"",
            "#include \"log.h\"",
            "#include \"ssherr.h\"",
            "#include \"xmalloc.h\"",
            "#include \"openbsd-compat/sys-queue.h\"",
            "#include <limits.h>",
            "#include <ctype.h>",
            "#include <stdarg.h>",
            "#include <stdio.h>",
            "#include <string.h>",
            "#include <pwd.h>",
            "#include <netdb.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"auth-options.h\"\n#include \"ssh2.h\"\n#include \"match.h\"\n#include \"sshkey.h\"\n#include \"misc.h\"\n#include \"sshbuf.h\"\n#include \"log.h\"\n#include \"ssherr.h\"\n#include \"xmalloc.h\"\n#include \"openbsd-compat/sys-queue.h\"\n#include <limits.h>\n#include <ctype.h>\n#include <stdarg.h>\n#include <stdio.h>\n#include <string.h>\n#include <pwd.h>\n#include <netdb.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nstruct sshauthopt *\nsshauthopt_new_with_keys_defaults(void)\n{\n\tstruct sshauthopt *ret = NULL;\n\n\tif ((ret = sshauthopt_new()) == NULL)\n\t\treturn NULL;\n\n\t/* Defaults for authorized_keys flags */\n\tret->permit_port_forwarding_flag = 1;\n\tret->permit_agent_forwarding_flag = 1;\n\tret->permit_x11_forwarding_flag = 1;\n\tret->permit_pty_flag = 1;\n\tret->permit_user_rc = 1;\n\treturn ret;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"log.h\"\n#include \"misc.h\"\n#include \"auth-options.h\"\n#include \"authfile.h\"\n#include \"sshkey.h\"\n#include \"test_helper.h\"\n#include <string.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdio.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic struct sshauthopt *\ndefault_authkey_opts(void)\n{\n\tstruct sshauthopt *ret = sshauthopt_new();\n\n\tASSERT_PTR_NE(ret, NULL);\n\tret->permit_port_forwarding_flag = 1;\n\tret->permit_agent_forwarding_flag = 1;\n\tret->permit_x11_forwarding_flag = 1;\n\tret->permit_pty_flag = 1;\n\tret->permit_user_rc = 1;\n\treturn ret;\n}"
  },
  {
    "function_name": "load_key",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/regress/unittests/authopt/tests.c",
    "lines": "24-34",
    "snippet": "static struct sshkey *\nload_key(const char *name)\n{\n\tstruct sshkey *ret;\n\tint r;\n\n\tr = sshkey_load_public(test_data_file(name), &ret, NULL);\n\tASSERT_INT_EQ(r, 0);\n\tASSERT_PTR_NE(ret, NULL);\n\treturn ret;\n}",
    "includes": [
      "#include \"log.h\"",
      "#include \"misc.h\"",
      "#include \"auth-options.h\"",
      "#include \"authfile.h\"",
      "#include \"sshkey.h\"",
      "#include \"test_helper.h\"",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <stdio.h>",
      "#include <sys/param.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "ASSERT_PTR_NE",
          "args": [
            "ret",
            "NULL"
          ],
          "line": 32
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASSERT_INT_EQ",
          "args": [
            "r",
            "0"
          ],
          "line": 31
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sshkey_load_public",
          "args": [
            "test_data_file(name)",
            "&ret",
            "NULL"
          ],
          "line": 30
        },
        "resolved": true,
        "details": {
          "function_name": "sshkey_load_public",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/authfile.c",
          "lines": "312-354",
          "snippet": "int\nsshkey_load_public(const char *filename, struct sshkey **keyp, char **commentp)\n{\n\tstruct sshkey *pub = NULL;\n\tchar *file = NULL;\n\tint r;\n\n\tif (keyp != NULL)\n\t\t*keyp = NULL;\n\tif (commentp != NULL)\n\t\t*commentp = NULL;\n\n\tif ((pub = sshkey_new(KEY_UNSPEC)) == NULL)\n\t\treturn SSH_ERR_ALLOC_FAIL;\n\tif ((r = sshkey_try_load_public(pub, filename, commentp)) == 0) {\n\t\tif (keyp != NULL) {\n\t\t\t*keyp = pub;\n\t\t\tpub = NULL;\n\t\t}\n\t\tr = 0;\n\t\tgoto out;\n\t}\n\tsshkey_free(pub);\n\n\t/* try .pub suffix */\n\tif (asprintf(&file, \"%s.pub\", filename) == -1)\n\t\treturn SSH_ERR_ALLOC_FAIL;\n\tif ((pub = sshkey_new(KEY_UNSPEC)) == NULL) {\n\t\tr = SSH_ERR_ALLOC_FAIL;\n\t\tgoto out;\n\t}\n\tif ((r = sshkey_try_load_public(pub, file, commentp)) == 0) {\n\t\tif (keyp != NULL) {\n\t\t\t*keyp = pub;\n\t\t\tpub = NULL;\n\t\t}\n\t\tr = 0;\n\t}\n out:\n\tfree(file);\n\tsshkey_free(pub);\n\treturn r;\n}",
          "includes": [
            "#include \"krl.h\"",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"sshkey.h\"",
            "#include \"atomicio.h\"",
            "#include \"misc.h\"",
            "#include \"authfile.h\"",
            "#include \"log.h\"",
            "#include \"ssh.h\"",
            "#include \"cipher.h\"",
            "#include <limits.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdarg.h>",
            "#include <stdio.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <sys/uio.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"krl.h\"\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"sshkey.h\"\n#include \"atomicio.h\"\n#include \"misc.h\"\n#include \"authfile.h\"\n#include \"log.h\"\n#include \"ssh.h\"\n#include \"cipher.h\"\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdarg.h>\n#include <stdio.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <sys/uio.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshkey_load_public(const char *filename, struct sshkey **keyp, char **commentp)\n{\n\tstruct sshkey *pub = NULL;\n\tchar *file = NULL;\n\tint r;\n\n\tif (keyp != NULL)\n\t\t*keyp = NULL;\n\tif (commentp != NULL)\n\t\t*commentp = NULL;\n\n\tif ((pub = sshkey_new(KEY_UNSPEC)) == NULL)\n\t\treturn SSH_ERR_ALLOC_FAIL;\n\tif ((r = sshkey_try_load_public(pub, filename, commentp)) == 0) {\n\t\tif (keyp != NULL) {\n\t\t\t*keyp = pub;\n\t\t\tpub = NULL;\n\t\t}\n\t\tr = 0;\n\t\tgoto out;\n\t}\n\tsshkey_free(pub);\n\n\t/* try .pub suffix */\n\tif (asprintf(&file, \"%s.pub\", filename) == -1)\n\t\treturn SSH_ERR_ALLOC_FAIL;\n\tif ((pub = sshkey_new(KEY_UNSPEC)) == NULL) {\n\t\tr = SSH_ERR_ALLOC_FAIL;\n\t\tgoto out;\n\t}\n\tif ((r = sshkey_try_load_public(pub, file, commentp)) == 0) {\n\t\tif (keyp != NULL) {\n\t\t\t*keyp = pub;\n\t\t\tpub = NULL;\n\t\t}\n\t\tr = 0;\n\t}\n out:\n\tfree(file);\n\tsshkey_free(pub);\n\treturn r;\n}"
        }
      },
      {
        "call_info": {
          "callee": "test_data_file",
          "args": [
            "name"
          ],
          "line": 30
        },
        "resolved": true,
        "details": {
          "function_name": "test_data_file",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/regress/unittests/test_helper/test_helper.c",
          "lines": "181-196",
          "snippet": "const char *\ntest_data_file(const char *name)\n{\n\tstatic char ret[PATH_MAX];\n\n\tif (data_dir != NULL)\n\t\tsnprintf(ret, sizeof(ret), \"%s/%s\", data_dir, name);\n\telse\n\t\tstrlcpy(ret, name, sizeof(ret));\n\tif (access(ret, F_OK) != 0) {\n\t\tfprintf(stderr, \"Cannot access data file %s: %s\\n\",\n\t\t    ret, strerror(errno));\n\t\texit(1);\n\t}\n\treturn ret;\n}",
          "includes": [
            "#include \"atomicio.h\"",
            "#include \"test_helper.h\"",
            "# include <vis.h>",
            "#include <openssl/bn.h>",
            "#include <signal.h>",
            "#include <unistd.h>",
            "#include <assert.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "# include <stdint.h>",
            "#include <stdio.h>",
            "#include <fcntl.h>",
            "#include <sys/uio.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static const char *data_dir = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"atomicio.h\"\n#include \"test_helper.h\"\n# include <vis.h>\n#include <openssl/bn.h>\n#include <signal.h>\n#include <unistd.h>\n#include <assert.h>\n#include <string.h>\n#include <stdlib.h>\n# include <stdint.h>\n#include <stdio.h>\n#include <fcntl.h>\n#include <sys/uio.h>\n#include <sys/param.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nstatic const char *data_dir = NULL;\n\nconst char *\ntest_data_file(const char *name)\n{\n\tstatic char ret[PATH_MAX];\n\n\tif (data_dir != NULL)\n\t\tsnprintf(ret, sizeof(ret), \"%s/%s\", data_dir, name);\n\telse\n\t\tstrlcpy(ret, name, sizeof(ret));\n\tif (access(ret, F_OK) != 0) {\n\t\tfprintf(stderr, \"Cannot access data file %s: %s\\n\",\n\t\t    ret, strerror(errno));\n\t\texit(1);\n\t}\n\treturn ret;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"log.h\"\n#include \"misc.h\"\n#include \"auth-options.h\"\n#include \"authfile.h\"\n#include \"sshkey.h\"\n#include \"test_helper.h\"\n#include <string.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdio.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic struct sshkey *\nload_key(const char *name)\n{\n\tstruct sshkey *ret;\n\tint r;\n\n\tr = sshkey_load_public(test_data_file(name), &ret, NULL);\n\tASSERT_INT_EQ(r, 0);\n\tASSERT_PTR_NE(ret, NULL);\n\treturn ret;\n}"
  }
]