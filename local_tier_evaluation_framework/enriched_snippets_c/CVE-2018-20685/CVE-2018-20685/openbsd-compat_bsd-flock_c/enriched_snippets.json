[
  {
    "function_name": "flock",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/openbsd-compat/bsd-flock.c",
    "lines": "43-80",
    "snippet": "int\nflock(int fd, int op)\n{\n\tint rc = 0;\n\n#if defined(F_SETLK) && defined(F_SETLKW)\n\tstruct flock fl = {0};\n\n\tswitch (op & (LOCK_EX|LOCK_SH|LOCK_UN)) {\n\tcase LOCK_EX:\n\t\tfl.l_type = F_WRLCK;\n\t\tbreak;\n\n\tcase LOCK_SH:\n\t\tfl.l_type = F_RDLCK;\n\t\tbreak;\n\n\tcase LOCK_UN:\n\t\tfl.l_type = F_UNLCK;\n\t\tbreak;\n\n\tdefault:\n\t\terrno = EINVAL;\n\t\treturn -1;\n\t}\n\n\tfl.l_whence = SEEK_SET;\n\trc = fcntl(fd, op & LOCK_NB ? F_SETLK : F_SETLKW, &fl);\n\n\tif (rc && (errno == EAGAIN))\n\t\terrno = EWOULDBLOCK;\n#else\n\trc = -1;\n\terrno = ENOSYS;\n#endif\n\n\treturn rc;\n}",
    "includes": [
      "#include <fcntl.h>",
      "#include <errno.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "fcntl",
          "args": [
            "fd",
            "op & LOCK_NB ? F_SETLK : F_SETLKW",
            "&fl"
          ],
          "line": 70
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <fcntl.h>\n#include <errno.h>\n#include \"includes.h\"\n\nint\nflock(int fd, int op)\n{\n\tint rc = 0;\n\n#if defined(F_SETLK) && defined(F_SETLKW)\n\tstruct flock fl = {0};\n\n\tswitch (op & (LOCK_EX|LOCK_SH|LOCK_UN)) {\n\tcase LOCK_EX:\n\t\tfl.l_type = F_WRLCK;\n\t\tbreak;\n\n\tcase LOCK_SH:\n\t\tfl.l_type = F_RDLCK;\n\t\tbreak;\n\n\tcase LOCK_UN:\n\t\tfl.l_type = F_UNLCK;\n\t\tbreak;\n\n\tdefault:\n\t\terrno = EINVAL;\n\t\treturn -1;\n\t}\n\n\tfl.l_whence = SEEK_SET;\n\trc = fcntl(fd, op & LOCK_NB ? F_SETLK : F_SETLKW, &fl);\n\n\tif (rc && (errno == EAGAIN))\n\t\terrno = EWOULDBLOCK;\n#else\n\trc = -1;\n\terrno = ENOSYS;\n#endif\n\n\treturn rc;\n}"
  }
]