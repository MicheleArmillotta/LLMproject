[
  {
    "function_name": "getgrouplist",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/openbsd-compat/getgrouplist.c",
    "lines": "45-93",
    "snippet": "int\ngetgrouplist(const char *uname, gid_t agroup, gid_t *groups, int *grpcnt)\n{\n\tstruct group *grp;\n\tint i, ngroups;\n\tint ret, maxgroups;\n\tint bail;\n\n\tret = 0;\n\tngroups = 0;\n\tmaxgroups = *grpcnt;\n\n\t/*\n\t * install primary group\n\t */\n\tif (ngroups >= maxgroups) {\n\t\t*grpcnt = ngroups;\n\t\treturn (-1);\n\t}\n\tgroups[ngroups++] = agroup;\n\n\t/*\n\t * Scan the group file to find additional groups.\n\t */\n\tsetgrent();\n\twhile ((grp = getgrent())) {\n\t\tif (grp->gr_gid == agroup)\n\t\t\tcontinue;\n\t\tfor (bail = 0, i = 0; bail == 0 && i < ngroups; i++)\n\t\t\tif (groups[i] == grp->gr_gid)\n\t\t\t\tbail = 1;\n\t\tif (bail)\n\t\t\tcontinue;\n\t\tfor (i = 0; grp->gr_mem[i]; i++) {\n\t\t\tif (!strcmp(grp->gr_mem[i], uname)) {\n\t\t\t\tif (ngroups >= maxgroups) {\n\t\t\t\t\tret = -1;\n\t\t\t\t\tgoto out;\n\t\t\t\t}\n\t\t\t\tgroups[ngroups++] = grp->gr_gid;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\nout:\n\tendgrent();\n\t*grpcnt = ngroups;\n\treturn (ret);\n}",
    "includes": [
      "#include <grp.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "endgrent",
          "args": [],
          "line": 90
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "grp->gr_mem[i]",
            "uname"
          ],
          "line": 79
        },
        "resolved": true,
        "details": {
          "function_name": "strcmp_maybe_null",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/misc.c",
          "lines": "1550-1558",
          "snippet": "static int\nstrcmp_maybe_null(const char *a, const char *b)\n{\n\tif ((a == NULL && b != NULL) || (a != NULL && b == NULL))\n\t\treturn 0;\n\tif (a != NULL && strcmp(a, b) != 0)\n\t\treturn 0;\n\treturn 1;\n}",
          "includes": [
            "#include \"platform.h\"",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"ssh.h\"",
            "#include \"log.h\"",
            "#include \"misc.h\"",
            "#include \"xmalloc.h\"",
            "#include <net/if.h>",
            "#include <pwd.h>",
            "# include <paths.h>",
            "#include <netdb.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <ctype.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/tcp.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in_systm.h>",
            "#include <netinet/in.h>",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <libgen.h>",
            "#include <limits.h>",
            "#include <sys/un.h>",
            "#include <sys/wait.h>",
            "#include <sys/time.h>",
            "#include <sys/stat.h>",
            "#include <sys/socket.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"platform.h\"\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"ssh.h\"\n#include \"log.h\"\n#include \"misc.h\"\n#include \"xmalloc.h\"\n#include <net/if.h>\n#include <pwd.h>\n# include <paths.h>\n#include <netdb.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <ctype.h>\n#include <arpa/inet.h>\n#include <netinet/tcp.h>\n#include <netinet/ip.h>\n#include <netinet/in_systm.h>\n#include <netinet/in.h>\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <libgen.h>\n#include <limits.h>\n#include <sys/un.h>\n#include <sys/wait.h>\n#include <sys/time.h>\n#include <sys/stat.h>\n#include <sys/socket.h>\n#include <sys/ioctl.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nstatic int\nstrcmp_maybe_null(const char *a, const char *b)\n{\n\tif ((a == NULL && b != NULL) || (a != NULL && b == NULL))\n\t\treturn 0;\n\tif (a != NULL && strcmp(a, b) != 0)\n\t\treturn 0;\n\treturn 1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "getgrent",
          "args": [],
          "line": 70
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "setgrent",
          "args": [],
          "line": 69
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <grp.h>\n#include <unistd.h>\n#include <string.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\ngetgrouplist(const char *uname, gid_t agroup, gid_t *groups, int *grpcnt)\n{\n\tstruct group *grp;\n\tint i, ngroups;\n\tint ret, maxgroups;\n\tint bail;\n\n\tret = 0;\n\tngroups = 0;\n\tmaxgroups = *grpcnt;\n\n\t/*\n\t * install primary group\n\t */\n\tif (ngroups >= maxgroups) {\n\t\t*grpcnt = ngroups;\n\t\treturn (-1);\n\t}\n\tgroups[ngroups++] = agroup;\n\n\t/*\n\t * Scan the group file to find additional groups.\n\t */\n\tsetgrent();\n\twhile ((grp = getgrent())) {\n\t\tif (grp->gr_gid == agroup)\n\t\t\tcontinue;\n\t\tfor (bail = 0, i = 0; bail == 0 && i < ngroups; i++)\n\t\t\tif (groups[i] == grp->gr_gid)\n\t\t\t\tbail = 1;\n\t\tif (bail)\n\t\t\tcontinue;\n\t\tfor (i = 0; grp->gr_mem[i]; i++) {\n\t\t\tif (!strcmp(grp->gr_mem[i], uname)) {\n\t\t\t\tif (ngroups >= maxgroups) {\n\t\t\t\t\tret = -1;\n\t\t\t\t\tgoto out;\n\t\t\t\t}\n\t\t\t\tgroups[ngroups++] = grp->gr_gid;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\nout:\n\tendgrent();\n\t*grpcnt = ngroups;\n\treturn (ret);\n}"
  }
]