[
  {
    "function_name": "setscreensize",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/progressmeter.c",
    "lines": "292-306",
    "snippet": "static void\nsetscreensize(void)\n{\n\tstruct winsize winsize;\n\n\tif (ioctl(STDOUT_FILENO, TIOCGWINSZ, &winsize) != -1 &&\n\t    winsize.ws_col != 0) {\n\t\tif (winsize.ws_col > MAX_WINSIZE)\n\t\t\twin_size = MAX_WINSIZE;\n\t\telse\n\t\t\twin_size = winsize.ws_col;\n\t} else\n\t\twin_size = DEFAULT_WINSIZE;\n\twin_size += 1;\t\t\t\t\t/* trailing \\0 */\n}",
    "includes": [
      "#include \"misc.h\"",
      "#include \"atomicio.h\"",
      "#include \"progressmeter.h\"",
      "#include <unistd.h>",
      "#include <time.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <signal.h>",
      "#include <errno.h>",
      "#include <sys/uio.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [
      "#define MAX_WINSIZE 512",
      "#define DEFAULT_WINSIZE 80"
    ],
    "globals_used": [
      "static void setscreensize(void);",
      "static int win_size;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "ioctl",
          "args": [
            "STDOUT_FILENO",
            "TIOCGWINSZ",
            "&winsize"
          ],
          "line": 297
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"misc.h\"\n#include \"atomicio.h\"\n#include \"progressmeter.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdio.h>\n#include <signal.h>\n#include <errno.h>\n#include <sys/uio.h>\n#include <sys/ioctl.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\n#define MAX_WINSIZE 512\n#define DEFAULT_WINSIZE 80\n\nstatic void setscreensize(void);\nstatic int win_size;\n\nstatic void\nsetscreensize(void)\n{\n\tstruct winsize winsize;\n\n\tif (ioctl(STDOUT_FILENO, TIOCGWINSZ, &winsize) != -1 &&\n\t    winsize.ws_col != 0) {\n\t\tif (winsize.ws_col > MAX_WINSIZE)\n\t\t\twin_size = MAX_WINSIZE;\n\t\telse\n\t\t\twin_size = winsize.ws_col;\n\t} else\n\t\twin_size = DEFAULT_WINSIZE;\n\twin_size += 1;\t\t\t\t\t/* trailing \\0 */\n}"
  },
  {
    "function_name": "sig_winch",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/progressmeter.c",
    "lines": "286-290",
    "snippet": "static void\nsig_winch(int sig)\n{\n\twin_resized = 1;\n}",
    "includes": [
      "#include \"misc.h\"",
      "#include \"atomicio.h\"",
      "#include \"progressmeter.h\"",
      "#include <unistd.h>",
      "#include <time.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <signal.h>",
      "#include <errno.h>",
      "#include <sys/uio.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "static void sig_winch(int);",
      "static volatile sig_atomic_t win_resized;"
    ],
    "called_functions": [],
    "contextual_snippet": "#include \"misc.h\"\n#include \"atomicio.h\"\n#include \"progressmeter.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdio.h>\n#include <signal.h>\n#include <errno.h>\n#include <sys/uio.h>\n#include <sys/ioctl.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nstatic void sig_winch(int);\nstatic volatile sig_atomic_t win_resized;\n\nstatic void\nsig_winch(int sig)\n{\n\twin_resized = 1;\n}"
  },
  {
    "function_name": "stop_progress_meter",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/progressmeter.c",
    "lines": "270-283",
    "snippet": "void\nstop_progress_meter(void)\n{\n\talarm(0);\n\n\tif (!can_output())\n\t\treturn;\n\n\t/* Ensure we complete the progress */\n\tif (cur_pos != end_pos)\n\t\trefresh_progress_meter();\n\n\tatomicio(vwrite, STDOUT_FILENO, \"\\n\", 1);\n}",
    "includes": [
      "#include \"misc.h\"",
      "#include \"atomicio.h\"",
      "#include \"progressmeter.h\"",
      "#include <unistd.h>",
      "#include <time.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <signal.h>",
      "#include <errno.h>",
      "#include <sys/uio.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "static int can_output(void);",
      "void refresh_progress_meter(void);",
      "static off_t end_pos;",
      "static off_t cur_pos;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "atomicio",
          "args": [
            "vwrite",
            "STDOUT_FILENO",
            "\"\\n\"",
            "1"
          ],
          "line": 282
        },
        "resolved": true,
        "details": {
          "function_name": "atomiciov",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/atomicio.c",
          "lines": "165-170",
          "snippet": "size_t\natomiciov(ssize_t (*f) (int, const struct iovec *, int), int fd,\n    const struct iovec *_iov, int iovcnt)\n{\n\treturn atomiciov6(f, fd, _iov, iovcnt, NULL, NULL);\n}",
          "includes": [
            "#include \"atomicio.h\"",
            "#include <limits.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#  include <sys/poll.h>",
            "#include <poll.h>",
            "#include <errno.h>",
            "#include <sys/uio.h>",
            "#include <sys/param.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"atomicio.h\"\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#  include <sys/poll.h>\n#include <poll.h>\n#include <errno.h>\n#include <sys/uio.h>\n#include <sys/param.h>\n#include \"includes.h\"\n\nsize_t\natomiciov(ssize_t (*f) (int, const struct iovec *, int), int fd,\n    const struct iovec *_iov, int iovcnt)\n{\n\treturn atomiciov6(f, fd, _iov, iovcnt, NULL, NULL);\n}"
        }
      },
      {
        "call_info": {
          "callee": "refresh_progress_meter",
          "args": [],
          "line": 280
        },
        "resolved": true,
        "details": {
          "function_name": "refresh_progress_meter",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/progressmeter.c",
          "lines": "119-227",
          "snippet": "void\nrefresh_progress_meter(void)\n{\n\tchar buf[MAX_WINSIZE + 1];\n\toff_t transferred;\n\tdouble elapsed, now;\n\tint percent;\n\toff_t bytes_left;\n\tint cur_speed;\n\tint hours, minutes, seconds;\n\tint i, len;\n\tint file_len;\n\n\ttransferred = *counter - (cur_pos ? cur_pos : start_pos);\n\tcur_pos = *counter;\n\tnow = monotime_double();\n\tbytes_left = end_pos - cur_pos;\n\n\tif (bytes_left > 0)\n\t\telapsed = now - last_update;\n\telse {\n\t\telapsed = now - start;\n\t\t/* Calculate true total speed when done */\n\t\ttransferred = end_pos - start_pos;\n\t\tbytes_per_second = 0;\n\t}\n\n\t/* calculate speed */\n\tif (elapsed != 0)\n\t\tcur_speed = (transferred / elapsed);\n\telse\n\t\tcur_speed = transferred;\n\n#define AGE_FACTOR 0.9\n\tif (bytes_per_second != 0) {\n\t\tbytes_per_second = (bytes_per_second * AGE_FACTOR) +\n\t\t    (cur_speed * (1.0 - AGE_FACTOR));\n\t} else\n\t\tbytes_per_second = cur_speed;\n\n\t/* filename */\n\tbuf[0] = '\\0';\n\tfile_len = win_size - 35;\n\tif (file_len > 0) {\n\t\tlen = snprintf(buf, file_len + 1, \"\\r%s\", file);\n\t\tif (len < 0)\n\t\t\tlen = 0;\n\t\tif (len >= file_len + 1)\n\t\t\tlen = file_len;\n\t\tfor (i = len; i < file_len; i++)\n\t\t\tbuf[i] = ' ';\n\t\tbuf[file_len] = '\\0';\n\t}\n\n\t/* percent of transfer done */\n\tif (end_pos == 0 || cur_pos == end_pos)\n\t\tpercent = 100;\n\telse\n\t\tpercent = ((float)cur_pos / end_pos) * 100;\n\tsnprintf(buf + strlen(buf), win_size - strlen(buf),\n\t    \" %3d%% \", percent);\n\n\t/* amount transferred */\n\tformat_size(buf + strlen(buf), win_size - strlen(buf),\n\t    cur_pos);\n\tstrlcat(buf, \" \", win_size);\n\n\t/* bandwidth usage */\n\tformat_rate(buf + strlen(buf), win_size - strlen(buf),\n\t    (off_t)bytes_per_second);\n\tstrlcat(buf, \"/s \", win_size);\n\n\t/* ETA */\n\tif (!transferred)\n\t\tstalled += elapsed;\n\telse\n\t\tstalled = 0;\n\n\tif (stalled >= STALL_TIME)\n\t\tstrlcat(buf, \"- stalled -\", win_size);\n\telse if (bytes_per_second == 0 && bytes_left)\n\t\tstrlcat(buf, \"  --:-- ETA\", win_size);\n\telse {\n\t\tif (bytes_left > 0)\n\t\t\tseconds = bytes_left / bytes_per_second;\n\t\telse\n\t\t\tseconds = elapsed;\n\n\t\thours = seconds / 3600;\n\t\tseconds -= hours * 3600;\n\t\tminutes = seconds / 60;\n\t\tseconds -= minutes * 60;\n\n\t\tif (hours != 0)\n\t\t\tsnprintf(buf + strlen(buf), win_size - strlen(buf),\n\t\t\t    \"%d:%02d:%02d\", hours, minutes, seconds);\n\t\telse\n\t\t\tsnprintf(buf + strlen(buf), win_size - strlen(buf),\n\t\t\t    \"  %02d:%02d\", minutes, seconds);\n\n\t\tif (bytes_left > 0)\n\t\t\tstrlcat(buf, \" ETA\", win_size);\n\t\telse\n\t\t\tstrlcat(buf, \"    \", win_size);\n\t}\n\n\tatomicio(vwrite, STDOUT_FILENO, buf, win_size - 1);\n\tlast_update = now;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include \"atomicio.h\"",
            "#include \"progressmeter.h\"",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <signal.h>",
            "#include <errno.h>",
            "#include <sys/uio.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [
            "#define AGE_FACTOR 0.9",
            "#define STALL_TIME 5\t\t/* we're stalled after this many seconds */",
            "#define MAX_WINSIZE 512"
          ],
          "globals_used": [
            "static void format_size(char *, int, off_t);",
            "static void format_rate(char *, int, off_t);",
            "void refresh_progress_meter(void);",
            "static double start;",
            "static double last_update;",
            "static const char *file;",
            "static off_t start_pos;",
            "static off_t end_pos;",
            "static off_t cur_pos;",
            "static volatile off_t *counter;",
            "static long stalled;",
            "static int bytes_per_second;",
            "static int win_size;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include \"atomicio.h\"\n#include \"progressmeter.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdio.h>\n#include <signal.h>\n#include <errno.h>\n#include <sys/uio.h>\n#include <sys/ioctl.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\n#define AGE_FACTOR 0.9\n#define STALL_TIME 5\t\t/* we're stalled after this many seconds */\n#define MAX_WINSIZE 512\n\nstatic void format_size(char *, int, off_t);\nstatic void format_rate(char *, int, off_t);\nvoid refresh_progress_meter(void);\nstatic double start;\nstatic double last_update;\nstatic const char *file;\nstatic off_t start_pos;\nstatic off_t end_pos;\nstatic off_t cur_pos;\nstatic volatile off_t *counter;\nstatic long stalled;\nstatic int bytes_per_second;\nstatic int win_size;\n\nvoid\nrefresh_progress_meter(void)\n{\n\tchar buf[MAX_WINSIZE + 1];\n\toff_t transferred;\n\tdouble elapsed, now;\n\tint percent;\n\toff_t bytes_left;\n\tint cur_speed;\n\tint hours, minutes, seconds;\n\tint i, len;\n\tint file_len;\n\n\ttransferred = *counter - (cur_pos ? cur_pos : start_pos);\n\tcur_pos = *counter;\n\tnow = monotime_double();\n\tbytes_left = end_pos - cur_pos;\n\n\tif (bytes_left > 0)\n\t\telapsed = now - last_update;\n\telse {\n\t\telapsed = now - start;\n\t\t/* Calculate true total speed when done */\n\t\ttransferred = end_pos - start_pos;\n\t\tbytes_per_second = 0;\n\t}\n\n\t/* calculate speed */\n\tif (elapsed != 0)\n\t\tcur_speed = (transferred / elapsed);\n\telse\n\t\tcur_speed = transferred;\n\n#define AGE_FACTOR 0.9\n\tif (bytes_per_second != 0) {\n\t\tbytes_per_second = (bytes_per_second * AGE_FACTOR) +\n\t\t    (cur_speed * (1.0 - AGE_FACTOR));\n\t} else\n\t\tbytes_per_second = cur_speed;\n\n\t/* filename */\n\tbuf[0] = '\\0';\n\tfile_len = win_size - 35;\n\tif (file_len > 0) {\n\t\tlen = snprintf(buf, file_len + 1, \"\\r%s\", file);\n\t\tif (len < 0)\n\t\t\tlen = 0;\n\t\tif (len >= file_len + 1)\n\t\t\tlen = file_len;\n\t\tfor (i = len; i < file_len; i++)\n\t\t\tbuf[i] = ' ';\n\t\tbuf[file_len] = '\\0';\n\t}\n\n\t/* percent of transfer done */\n\tif (end_pos == 0 || cur_pos == end_pos)\n\t\tpercent = 100;\n\telse\n\t\tpercent = ((float)cur_pos / end_pos) * 100;\n\tsnprintf(buf + strlen(buf), win_size - strlen(buf),\n\t    \" %3d%% \", percent);\n\n\t/* amount transferred */\n\tformat_size(buf + strlen(buf), win_size - strlen(buf),\n\t    cur_pos);\n\tstrlcat(buf, \" \", win_size);\n\n\t/* bandwidth usage */\n\tformat_rate(buf + strlen(buf), win_size - strlen(buf),\n\t    (off_t)bytes_per_second);\n\tstrlcat(buf, \"/s \", win_size);\n\n\t/* ETA */\n\tif (!transferred)\n\t\tstalled += elapsed;\n\telse\n\t\tstalled = 0;\n\n\tif (stalled >= STALL_TIME)\n\t\tstrlcat(buf, \"- stalled -\", win_size);\n\telse if (bytes_per_second == 0 && bytes_left)\n\t\tstrlcat(buf, \"  --:-- ETA\", win_size);\n\telse {\n\t\tif (bytes_left > 0)\n\t\t\tseconds = bytes_left / bytes_per_second;\n\t\telse\n\t\t\tseconds = elapsed;\n\n\t\thours = seconds / 3600;\n\t\tseconds -= hours * 3600;\n\t\tminutes = seconds / 60;\n\t\tseconds -= minutes * 60;\n\n\t\tif (hours != 0)\n\t\t\tsnprintf(buf + strlen(buf), win_size - strlen(buf),\n\t\t\t    \"%d:%02d:%02d\", hours, minutes, seconds);\n\t\telse\n\t\t\tsnprintf(buf + strlen(buf), win_size - strlen(buf),\n\t\t\t    \"  %02d:%02d\", minutes, seconds);\n\n\t\tif (bytes_left > 0)\n\t\t\tstrlcat(buf, \" ETA\", win_size);\n\t\telse\n\t\t\tstrlcat(buf, \"    \", win_size);\n\t}\n\n\tatomicio(vwrite, STDOUT_FILENO, buf, win_size - 1);\n\tlast_update = now;\n}"
        }
      },
      {
        "call_info": {
          "callee": "can_output",
          "args": [],
          "line": 275
        },
        "resolved": true,
        "details": {
          "function_name": "can_output",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/progressmeter.c",
          "lines": "81-85",
          "snippet": "static int\ncan_output(void)\n{\n\treturn (getpgrp() == tcgetpgrp(STDOUT_FILENO));\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include \"atomicio.h\"",
            "#include \"progressmeter.h\"",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <signal.h>",
            "#include <errno.h>",
            "#include <sys/uio.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static int can_output(void);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include \"atomicio.h\"\n#include \"progressmeter.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdio.h>\n#include <signal.h>\n#include <errno.h>\n#include <sys/uio.h>\n#include <sys/ioctl.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nstatic int can_output(void);\n\nstatic int\ncan_output(void)\n{\n\treturn (getpgrp() == tcgetpgrp(STDOUT_FILENO));\n}"
        }
      },
      {
        "call_info": {
          "callee": "alarm",
          "args": [
            "0"
          ],
          "line": 273
        },
        "resolved": true,
        "details": {
          "function_name": "grace_alarm_handler",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshd.c",
          "lines": "346-364",
          "snippet": "static void\ngrace_alarm_handler(int sig)\n{\n\tif (use_privsep && pmonitor != NULL && pmonitor->m_pid > 0)\n\t\tkill(pmonitor->m_pid, SIGALRM);\n\n\t/*\n\t * Try to kill any processes that we have spawned, E.g. authorized\n\t * keys command helpers.\n\t */\n\tif (getpgid(0) == getpid()) {\n\t\tsignal(SIGTERM, SIG_IGN);\n\t\tkill(0, SIGTERM);\n\t}\n\n\t/* Log error and exit. */\n\tsigdie(\"Timeout before authentication for %s port %d\",\n\t    ssh_remote_ipaddr(active_state), ssh_remote_port(active_state));\n}",
          "includes": [
            "#include \"ssherr.h\"",
            "#include \"version.h\"",
            "#include \"auth-options.h\"",
            "#include \"ssh-sandbox.h\"",
            "#include \"monitor_wrap.h\"",
            "#include \"ssh-gss.h\"",
            "#include \"monitor.h\"",
            "#include \"session.h\"",
            "#include \"channels.h\"",
            "#include \"dispatch.h\"",
            "#include \"msg.h\"",
            "#include \"authfd.h\"",
            "#include \"auth.h\"",
            "#include \"hostfile.h\"",
            "#include \"canohost.h\"",
            "#include \"atomicio.h\"",
            "#include \"pathnames.h\"",
            "#include \"authfile.h\"",
            "#include \"myproposal.h\"",
            "#include \"kex.h\"",
            "#include \"sshkey.h\"",
            "#include \"digest.h\"",
            "#include \"cipher.h\"",
            "#include \"compat.h\"",
            "#include \"uidswap.h\"",
            "#include \"servconf.h\"",
            "#include \"match.h\"",
            "#include \"misc.h\"",
            "#include \"sshbuf.h\"",
            "#include \"log.h\"",
            "#include \"packet.h\"",
            "#include \"sshpty.h\"",
            "#include \"ssh2.h\"",
            "#include \"ssh.h\"",
            "#include \"xmalloc.h\"",
            "#include <prot.h>",
            "#include <sys/security.h>",
            "#include \"openbsd-compat/openssl-compat.h\"",
            "#include <openssl/rand.h>",
            "#include <openssl/bn.h>",
            "#include <openssl/dh.h>",
            "#include <limits.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "#include <pwd.h>",
            "#include <grp.h>",
            "#include <paths.h>",
            "#include <netdb.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <sys/wait.h>",
            "#include \"openbsd-compat/sys-queue.h\"",
            "#include \"openbsd-compat/sys-tree.h\"",
            "# include <sys/time.h>",
            "# include <sys/stat.h>",
            "#include <sys/socket.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "int use_privsep = -1;",
            "struct monitor *pmonitor = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"ssherr.h\"\n#include \"version.h\"\n#include \"auth-options.h\"\n#include \"ssh-sandbox.h\"\n#include \"monitor_wrap.h\"\n#include \"ssh-gss.h\"\n#include \"monitor.h\"\n#include \"session.h\"\n#include \"channels.h\"\n#include \"dispatch.h\"\n#include \"msg.h\"\n#include \"authfd.h\"\n#include \"auth.h\"\n#include \"hostfile.h\"\n#include \"canohost.h\"\n#include \"atomicio.h\"\n#include \"pathnames.h\"\n#include \"authfile.h\"\n#include \"myproposal.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"digest.h\"\n#include \"cipher.h\"\n#include \"compat.h\"\n#include \"uidswap.h\"\n#include \"servconf.h\"\n#include \"match.h\"\n#include \"misc.h\"\n#include \"sshbuf.h\"\n#include \"log.h\"\n#include \"packet.h\"\n#include \"sshpty.h\"\n#include \"ssh2.h\"\n#include \"ssh.h\"\n#include \"xmalloc.h\"\n#include <prot.h>\n#include <sys/security.h>\n#include \"openbsd-compat/openssl-compat.h\"\n#include <openssl/rand.h>\n#include <openssl/bn.h>\n#include <openssl/dh.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <signal.h>\n#include <pwd.h>\n#include <grp.h>\n#include <paths.h>\n#include <netdb.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <sys/wait.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include \"openbsd-compat/sys-tree.h\"\n# include <sys/time.h>\n# include <sys/stat.h>\n#include <sys/socket.h>\n#include <sys/ioctl.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint use_privsep = -1;\nstruct monitor *pmonitor = NULL;\n\nstatic void\ngrace_alarm_handler(int sig)\n{\n\tif (use_privsep && pmonitor != NULL && pmonitor->m_pid > 0)\n\t\tkill(pmonitor->m_pid, SIGALRM);\n\n\t/*\n\t * Try to kill any processes that we have spawned, E.g. authorized\n\t * keys command helpers.\n\t */\n\tif (getpgid(0) == getpid()) {\n\t\tsignal(SIGTERM, SIG_IGN);\n\t\tkill(0, SIGTERM);\n\t}\n\n\t/* Log error and exit. */\n\tsigdie(\"Timeout before authentication for %s port %d\",\n\t    ssh_remote_ipaddr(active_state), ssh_remote_port(active_state));\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"misc.h\"\n#include \"atomicio.h\"\n#include \"progressmeter.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdio.h>\n#include <signal.h>\n#include <errno.h>\n#include <sys/uio.h>\n#include <sys/ioctl.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nstatic int can_output(void);\nvoid refresh_progress_meter(void);\nstatic off_t end_pos;\nstatic off_t cur_pos;\n\nvoid\nstop_progress_meter(void)\n{\n\talarm(0);\n\n\tif (!can_output())\n\t\treturn;\n\n\t/* Ensure we complete the progress */\n\tif (cur_pos != end_pos)\n\t\trefresh_progress_meter();\n\n\tatomicio(vwrite, STDOUT_FILENO, \"\\n\", 1);\n}"
  },
  {
    "function_name": "start_progress_meter",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/progressmeter.c",
    "lines": "249-268",
    "snippet": "void\nstart_progress_meter(const char *f, off_t filesize, off_t *ctr)\n{\n\tstart = last_update = monotime_double();\n\tfile = f;\n\tstart_pos = *ctr;\n\tend_pos = filesize;\n\tcur_pos = 0;\n\tcounter = ctr;\n\tstalled = 0;\n\tbytes_per_second = 0;\n\n\tsetscreensize();\n\tif (can_output())\n\t\trefresh_progress_meter();\n\n\tsignal(SIGALRM, update_progress_meter);\n\tsignal(SIGWINCH, sig_winch);\n\talarm(UPDATE_INTERVAL);\n}",
    "includes": [
      "#include \"misc.h\"",
      "#include \"atomicio.h\"",
      "#include \"progressmeter.h\"",
      "#include <unistd.h>",
      "#include <time.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <signal.h>",
      "#include <errno.h>",
      "#include <sys/uio.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [
      "#define UPDATE_INTERVAL 1\t/* update the progress meter every second */"
    ],
    "globals_used": [
      "static int can_output(void);",
      "static void format_size(char *, int, off_t);",
      "static void format_rate(char *, int, off_t);",
      "static void sig_winch(int);",
      "static void setscreensize(void);",
      "void refresh_progress_meter(void);",
      "static void update_progress_meter(int);",
      "static double start;",
      "static double last_update;",
      "static const char *file;",
      "static off_t start_pos;",
      "static off_t end_pos;",
      "static off_t cur_pos;",
      "static volatile off_t *counter;",
      "static long stalled;",
      "static int bytes_per_second;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "alarm",
          "args": [
            "UPDATE_INTERVAL"
          ],
          "line": 267
        },
        "resolved": true,
        "details": {
          "function_name": "grace_alarm_handler",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshd.c",
          "lines": "346-364",
          "snippet": "static void\ngrace_alarm_handler(int sig)\n{\n\tif (use_privsep && pmonitor != NULL && pmonitor->m_pid > 0)\n\t\tkill(pmonitor->m_pid, SIGALRM);\n\n\t/*\n\t * Try to kill any processes that we have spawned, E.g. authorized\n\t * keys command helpers.\n\t */\n\tif (getpgid(0) == getpid()) {\n\t\tsignal(SIGTERM, SIG_IGN);\n\t\tkill(0, SIGTERM);\n\t}\n\n\t/* Log error and exit. */\n\tsigdie(\"Timeout before authentication for %s port %d\",\n\t    ssh_remote_ipaddr(active_state), ssh_remote_port(active_state));\n}",
          "includes": [
            "#include \"ssherr.h\"",
            "#include \"version.h\"",
            "#include \"auth-options.h\"",
            "#include \"ssh-sandbox.h\"",
            "#include \"monitor_wrap.h\"",
            "#include \"ssh-gss.h\"",
            "#include \"monitor.h\"",
            "#include \"session.h\"",
            "#include \"channels.h\"",
            "#include \"dispatch.h\"",
            "#include \"msg.h\"",
            "#include \"authfd.h\"",
            "#include \"auth.h\"",
            "#include \"hostfile.h\"",
            "#include \"canohost.h\"",
            "#include \"atomicio.h\"",
            "#include \"pathnames.h\"",
            "#include \"authfile.h\"",
            "#include \"myproposal.h\"",
            "#include \"kex.h\"",
            "#include \"sshkey.h\"",
            "#include \"digest.h\"",
            "#include \"cipher.h\"",
            "#include \"compat.h\"",
            "#include \"uidswap.h\"",
            "#include \"servconf.h\"",
            "#include \"match.h\"",
            "#include \"misc.h\"",
            "#include \"sshbuf.h\"",
            "#include \"log.h\"",
            "#include \"packet.h\"",
            "#include \"sshpty.h\"",
            "#include \"ssh2.h\"",
            "#include \"ssh.h\"",
            "#include \"xmalloc.h\"",
            "#include <prot.h>",
            "#include <sys/security.h>",
            "#include \"openbsd-compat/openssl-compat.h\"",
            "#include <openssl/rand.h>",
            "#include <openssl/bn.h>",
            "#include <openssl/dh.h>",
            "#include <limits.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "#include <pwd.h>",
            "#include <grp.h>",
            "#include <paths.h>",
            "#include <netdb.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <sys/wait.h>",
            "#include \"openbsd-compat/sys-queue.h\"",
            "#include \"openbsd-compat/sys-tree.h\"",
            "# include <sys/time.h>",
            "# include <sys/stat.h>",
            "#include <sys/socket.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "int use_privsep = -1;",
            "struct monitor *pmonitor = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"ssherr.h\"\n#include \"version.h\"\n#include \"auth-options.h\"\n#include \"ssh-sandbox.h\"\n#include \"monitor_wrap.h\"\n#include \"ssh-gss.h\"\n#include \"monitor.h\"\n#include \"session.h\"\n#include \"channels.h\"\n#include \"dispatch.h\"\n#include \"msg.h\"\n#include \"authfd.h\"\n#include \"auth.h\"\n#include \"hostfile.h\"\n#include \"canohost.h\"\n#include \"atomicio.h\"\n#include \"pathnames.h\"\n#include \"authfile.h\"\n#include \"myproposal.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"digest.h\"\n#include \"cipher.h\"\n#include \"compat.h\"\n#include \"uidswap.h\"\n#include \"servconf.h\"\n#include \"match.h\"\n#include \"misc.h\"\n#include \"sshbuf.h\"\n#include \"log.h\"\n#include \"packet.h\"\n#include \"sshpty.h\"\n#include \"ssh2.h\"\n#include \"ssh.h\"\n#include \"xmalloc.h\"\n#include <prot.h>\n#include <sys/security.h>\n#include \"openbsd-compat/openssl-compat.h\"\n#include <openssl/rand.h>\n#include <openssl/bn.h>\n#include <openssl/dh.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <signal.h>\n#include <pwd.h>\n#include <grp.h>\n#include <paths.h>\n#include <netdb.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <sys/wait.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include \"openbsd-compat/sys-tree.h\"\n# include <sys/time.h>\n# include <sys/stat.h>\n#include <sys/socket.h>\n#include <sys/ioctl.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint use_privsep = -1;\nstruct monitor *pmonitor = NULL;\n\nstatic void\ngrace_alarm_handler(int sig)\n{\n\tif (use_privsep && pmonitor != NULL && pmonitor->m_pid > 0)\n\t\tkill(pmonitor->m_pid, SIGALRM);\n\n\t/*\n\t * Try to kill any processes that we have spawned, E.g. authorized\n\t * keys command helpers.\n\t */\n\tif (getpgid(0) == getpid()) {\n\t\tsignal(SIGTERM, SIG_IGN);\n\t\tkill(0, SIGTERM);\n\t}\n\n\t/* Log error and exit. */\n\tsigdie(\"Timeout before authentication for %s port %d\",\n\t    ssh_remote_ipaddr(active_state), ssh_remote_port(active_state));\n}"
        }
      },
      {
        "call_info": {
          "callee": "signal",
          "args": [
            "SIGWINCH",
            "sig_winch"
          ],
          "line": 266
        },
        "resolved": true,
        "details": {
          "function_name": "session_signal_req",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/session.c",
          "lines": "2130-2176",
          "snippet": "static int\nsession_signal_req(struct ssh *ssh, Session *s)\n{\n\tchar *signame = NULL;\n\tint r, sig, success = 0;\n\n\tif ((r = sshpkt_get_cstring(ssh, &signame, NULL)) != 0 ||\n\t    (r = sshpkt_get_end(ssh)) != 0) {\n\t\terror(\"%s: parse packet: %s\", __func__, ssh_err(r));\n\t\tgoto out;\n\t}\n\tif ((sig = name2sig(signame)) == -1) {\n\t\terror(\"%s: unsupported signal \\\"%s\\\"\", __func__, signame);\n\t\tgoto out;\n\t}\n\tif (s->pid <= 0) {\n\t\terror(\"%s: no pid for session %d\", __func__, s->self);\n\t\tgoto out;\n\t}\n\tif (s->forced || s->is_subsystem) {\n\t\terror(\"%s: refusing to send signal %s to %s session\", __func__,\n\t\t    signame, s->forced ? \"forced-command\" : \"subsystem\");\n\t\tgoto out;\n\t}\n\tif (!use_privsep || mm_is_monitor()) {\n\t\terror(\"%s: session signalling requires privilege separation\",\n\t\t    __func__);\n\t\tgoto out;\n\t}\n\n\tdebug(\"%s: signal %s, killpg(%ld, %d)\", __func__, signame,\n\t    (long)s->pid, sig);\n\ttemporarily_use_uid(s->pw);\n\tr = killpg(s->pid, sig);\n\trestore_uid();\n\tif (r != 0) {\n\t\terror(\"%s: killpg(%ld, %d): %s\", __func__, (long)s->pid,\n\t\t    sig, strerror(errno));\n\t\tgoto out;\n\t}\n\n\t/* success */\n\tsuccess = 1;\n out:\n\tfree(signame);\n\treturn success;\n}",
          "includes": [
            "#include <selinux/selinux.h>",
            "#include <kafs.h>",
            "#include \"atomicio.h\"",
            "#include \"sftp.h\"",
            "#include \"monitor_wrap.h\"",
            "#include \"kex.h\"",
            "#include \"session.h\"",
            "#include \"canohost.h\"",
            "#include \"serverloop.h\"",
            "#include \"sshlogin.h\"",
            "#include \"servconf.h\"",
            "#include \"misc.h\"",
            "#include \"log.h\"",
            "#include \"pathnames.h\"",
            "#include \"authfd.h\"",
            "#include \"auth-options.h\"",
            "#include \"auth.h\"",
            "#include \"hostfile.h\"",
            "#include \"ssh-gss.h\"",
            "#include \"cipher.h\"",
            "#include \"sshkey.h\"",
            "#include \"channels.h\"",
            "#include \"compat.h\"",
            "#include \"uidswap.h\"",
            "#include \"match.h\"",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"packet.h\"",
            "#include \"sshpty.h\"",
            "#include \"ssh2.h\"",
            "#include \"ssh.h\"",
            "#include \"xmalloc.h\"",
            "#include \"openbsd-compat/sys-queue.h\"",
            "#include <limits.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "#include <pwd.h>",
            "#include <paths.h>",
            "#include <netdb.h>",
            "#include <grp.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <ctype.h>",
            "#include <arpa/inet.h>",
            "#include <sys/wait.h>",
            "#include <sys/un.h>",
            "#include <sys/socket.h>",
            "# include <sys/stat.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "void\tsession_set_fds(struct ssh *, Session *, int, int, int, int, int);",
            "void\tsession_pty_cleanup(Session *);",
            "void\tsession_proctitle(Session *);",
            "int\tsession_setup_x11fwd(struct ssh *, Session *);",
            "int\tdo_exec_pty(struct ssh *, Session *, const char *);",
            "int\tdo_exec_no_pty(struct ssh *, Session *, const char *);",
            "int\tdo_exec(struct ssh *, Session *, const char *);",
            "void\tdo_login(struct ssh *, Session *, const char *);",
            "void\tdo_child(struct ssh *, Session *, const char *);",
            "int\tcheck_quietlogin(Session *, const char *);",
            "static int session_pty_req(struct ssh *, Session *);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <selinux/selinux.h>\n#include <kafs.h>\n#include \"atomicio.h\"\n#include \"sftp.h\"\n#include \"monitor_wrap.h\"\n#include \"kex.h\"\n#include \"session.h\"\n#include \"canohost.h\"\n#include \"serverloop.h\"\n#include \"sshlogin.h\"\n#include \"servconf.h\"\n#include \"misc.h\"\n#include \"log.h\"\n#include \"pathnames.h\"\n#include \"authfd.h\"\n#include \"auth-options.h\"\n#include \"auth.h\"\n#include \"hostfile.h\"\n#include \"ssh-gss.h\"\n#include \"cipher.h\"\n#include \"sshkey.h\"\n#include \"channels.h\"\n#include \"compat.h\"\n#include \"uidswap.h\"\n#include \"match.h\"\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"packet.h\"\n#include \"sshpty.h\"\n#include \"ssh2.h\"\n#include \"ssh.h\"\n#include \"xmalloc.h\"\n#include \"openbsd-compat/sys-queue.h\"\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <signal.h>\n#include <pwd.h>\n#include <paths.h>\n#include <netdb.h>\n#include <grp.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <ctype.h>\n#include <arpa/inet.h>\n#include <sys/wait.h>\n#include <sys/un.h>\n#include <sys/socket.h>\n# include <sys/stat.h>\n#include <sys/param.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\tsession_set_fds(struct ssh *, Session *, int, int, int, int, int);\nvoid\tsession_pty_cleanup(Session *);\nvoid\tsession_proctitle(Session *);\nint\tsession_setup_x11fwd(struct ssh *, Session *);\nint\tdo_exec_pty(struct ssh *, Session *, const char *);\nint\tdo_exec_no_pty(struct ssh *, Session *, const char *);\nint\tdo_exec(struct ssh *, Session *, const char *);\nvoid\tdo_login(struct ssh *, Session *, const char *);\nvoid\tdo_child(struct ssh *, Session *, const char *);\nint\tcheck_quietlogin(Session *, const char *);\nstatic int session_pty_req(struct ssh *, Session *);\n\nstatic int\nsession_signal_req(struct ssh *ssh, Session *s)\n{\n\tchar *signame = NULL;\n\tint r, sig, success = 0;\n\n\tif ((r = sshpkt_get_cstring(ssh, &signame, NULL)) != 0 ||\n\t    (r = sshpkt_get_end(ssh)) != 0) {\n\t\terror(\"%s: parse packet: %s\", __func__, ssh_err(r));\n\t\tgoto out;\n\t}\n\tif ((sig = name2sig(signame)) == -1) {\n\t\terror(\"%s: unsupported signal \\\"%s\\\"\", __func__, signame);\n\t\tgoto out;\n\t}\n\tif (s->pid <= 0) {\n\t\terror(\"%s: no pid for session %d\", __func__, s->self);\n\t\tgoto out;\n\t}\n\tif (s->forced || s->is_subsystem) {\n\t\terror(\"%s: refusing to send signal %s to %s session\", __func__,\n\t\t    signame, s->forced ? \"forced-command\" : \"subsystem\");\n\t\tgoto out;\n\t}\n\tif (!use_privsep || mm_is_monitor()) {\n\t\terror(\"%s: session signalling requires privilege separation\",\n\t\t    __func__);\n\t\tgoto out;\n\t}\n\n\tdebug(\"%s: signal %s, killpg(%ld, %d)\", __func__, signame,\n\t    (long)s->pid, sig);\n\ttemporarily_use_uid(s->pw);\n\tr = killpg(s->pid, sig);\n\trestore_uid();\n\tif (r != 0) {\n\t\terror(\"%s: killpg(%ld, %d): %s\", __func__, (long)s->pid,\n\t\t    sig, strerror(errno));\n\t\tgoto out;\n\t}\n\n\t/* success */\n\tsuccess = 1;\n out:\n\tfree(signame);\n\treturn success;\n}"
        }
      },
      {
        "call_info": {
          "callee": "refresh_progress_meter",
          "args": [],
          "line": 263
        },
        "resolved": true,
        "details": {
          "function_name": "refresh_progress_meter",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/progressmeter.c",
          "lines": "119-227",
          "snippet": "void\nrefresh_progress_meter(void)\n{\n\tchar buf[MAX_WINSIZE + 1];\n\toff_t transferred;\n\tdouble elapsed, now;\n\tint percent;\n\toff_t bytes_left;\n\tint cur_speed;\n\tint hours, minutes, seconds;\n\tint i, len;\n\tint file_len;\n\n\ttransferred = *counter - (cur_pos ? cur_pos : start_pos);\n\tcur_pos = *counter;\n\tnow = monotime_double();\n\tbytes_left = end_pos - cur_pos;\n\n\tif (bytes_left > 0)\n\t\telapsed = now - last_update;\n\telse {\n\t\telapsed = now - start;\n\t\t/* Calculate true total speed when done */\n\t\ttransferred = end_pos - start_pos;\n\t\tbytes_per_second = 0;\n\t}\n\n\t/* calculate speed */\n\tif (elapsed != 0)\n\t\tcur_speed = (transferred / elapsed);\n\telse\n\t\tcur_speed = transferred;\n\n#define AGE_FACTOR 0.9\n\tif (bytes_per_second != 0) {\n\t\tbytes_per_second = (bytes_per_second * AGE_FACTOR) +\n\t\t    (cur_speed * (1.0 - AGE_FACTOR));\n\t} else\n\t\tbytes_per_second = cur_speed;\n\n\t/* filename */\n\tbuf[0] = '\\0';\n\tfile_len = win_size - 35;\n\tif (file_len > 0) {\n\t\tlen = snprintf(buf, file_len + 1, \"\\r%s\", file);\n\t\tif (len < 0)\n\t\t\tlen = 0;\n\t\tif (len >= file_len + 1)\n\t\t\tlen = file_len;\n\t\tfor (i = len; i < file_len; i++)\n\t\t\tbuf[i] = ' ';\n\t\tbuf[file_len] = '\\0';\n\t}\n\n\t/* percent of transfer done */\n\tif (end_pos == 0 || cur_pos == end_pos)\n\t\tpercent = 100;\n\telse\n\t\tpercent = ((float)cur_pos / end_pos) * 100;\n\tsnprintf(buf + strlen(buf), win_size - strlen(buf),\n\t    \" %3d%% \", percent);\n\n\t/* amount transferred */\n\tformat_size(buf + strlen(buf), win_size - strlen(buf),\n\t    cur_pos);\n\tstrlcat(buf, \" \", win_size);\n\n\t/* bandwidth usage */\n\tformat_rate(buf + strlen(buf), win_size - strlen(buf),\n\t    (off_t)bytes_per_second);\n\tstrlcat(buf, \"/s \", win_size);\n\n\t/* ETA */\n\tif (!transferred)\n\t\tstalled += elapsed;\n\telse\n\t\tstalled = 0;\n\n\tif (stalled >= STALL_TIME)\n\t\tstrlcat(buf, \"- stalled -\", win_size);\n\telse if (bytes_per_second == 0 && bytes_left)\n\t\tstrlcat(buf, \"  --:-- ETA\", win_size);\n\telse {\n\t\tif (bytes_left > 0)\n\t\t\tseconds = bytes_left / bytes_per_second;\n\t\telse\n\t\t\tseconds = elapsed;\n\n\t\thours = seconds / 3600;\n\t\tseconds -= hours * 3600;\n\t\tminutes = seconds / 60;\n\t\tseconds -= minutes * 60;\n\n\t\tif (hours != 0)\n\t\t\tsnprintf(buf + strlen(buf), win_size - strlen(buf),\n\t\t\t    \"%d:%02d:%02d\", hours, minutes, seconds);\n\t\telse\n\t\t\tsnprintf(buf + strlen(buf), win_size - strlen(buf),\n\t\t\t    \"  %02d:%02d\", minutes, seconds);\n\n\t\tif (bytes_left > 0)\n\t\t\tstrlcat(buf, \" ETA\", win_size);\n\t\telse\n\t\t\tstrlcat(buf, \"    \", win_size);\n\t}\n\n\tatomicio(vwrite, STDOUT_FILENO, buf, win_size - 1);\n\tlast_update = now;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include \"atomicio.h\"",
            "#include \"progressmeter.h\"",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <signal.h>",
            "#include <errno.h>",
            "#include <sys/uio.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [
            "#define AGE_FACTOR 0.9",
            "#define STALL_TIME 5\t\t/* we're stalled after this many seconds */",
            "#define MAX_WINSIZE 512"
          ],
          "globals_used": [
            "static void format_size(char *, int, off_t);",
            "static void format_rate(char *, int, off_t);",
            "void refresh_progress_meter(void);",
            "static double start;",
            "static double last_update;",
            "static const char *file;",
            "static off_t start_pos;",
            "static off_t end_pos;",
            "static off_t cur_pos;",
            "static volatile off_t *counter;",
            "static long stalled;",
            "static int bytes_per_second;",
            "static int win_size;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include \"atomicio.h\"\n#include \"progressmeter.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdio.h>\n#include <signal.h>\n#include <errno.h>\n#include <sys/uio.h>\n#include <sys/ioctl.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\n#define AGE_FACTOR 0.9\n#define STALL_TIME 5\t\t/* we're stalled after this many seconds */\n#define MAX_WINSIZE 512\n\nstatic void format_size(char *, int, off_t);\nstatic void format_rate(char *, int, off_t);\nvoid refresh_progress_meter(void);\nstatic double start;\nstatic double last_update;\nstatic const char *file;\nstatic off_t start_pos;\nstatic off_t end_pos;\nstatic off_t cur_pos;\nstatic volatile off_t *counter;\nstatic long stalled;\nstatic int bytes_per_second;\nstatic int win_size;\n\nvoid\nrefresh_progress_meter(void)\n{\n\tchar buf[MAX_WINSIZE + 1];\n\toff_t transferred;\n\tdouble elapsed, now;\n\tint percent;\n\toff_t bytes_left;\n\tint cur_speed;\n\tint hours, minutes, seconds;\n\tint i, len;\n\tint file_len;\n\n\ttransferred = *counter - (cur_pos ? cur_pos : start_pos);\n\tcur_pos = *counter;\n\tnow = monotime_double();\n\tbytes_left = end_pos - cur_pos;\n\n\tif (bytes_left > 0)\n\t\telapsed = now - last_update;\n\telse {\n\t\telapsed = now - start;\n\t\t/* Calculate true total speed when done */\n\t\ttransferred = end_pos - start_pos;\n\t\tbytes_per_second = 0;\n\t}\n\n\t/* calculate speed */\n\tif (elapsed != 0)\n\t\tcur_speed = (transferred / elapsed);\n\telse\n\t\tcur_speed = transferred;\n\n#define AGE_FACTOR 0.9\n\tif (bytes_per_second != 0) {\n\t\tbytes_per_second = (bytes_per_second * AGE_FACTOR) +\n\t\t    (cur_speed * (1.0 - AGE_FACTOR));\n\t} else\n\t\tbytes_per_second = cur_speed;\n\n\t/* filename */\n\tbuf[0] = '\\0';\n\tfile_len = win_size - 35;\n\tif (file_len > 0) {\n\t\tlen = snprintf(buf, file_len + 1, \"\\r%s\", file);\n\t\tif (len < 0)\n\t\t\tlen = 0;\n\t\tif (len >= file_len + 1)\n\t\t\tlen = file_len;\n\t\tfor (i = len; i < file_len; i++)\n\t\t\tbuf[i] = ' ';\n\t\tbuf[file_len] = '\\0';\n\t}\n\n\t/* percent of transfer done */\n\tif (end_pos == 0 || cur_pos == end_pos)\n\t\tpercent = 100;\n\telse\n\t\tpercent = ((float)cur_pos / end_pos) * 100;\n\tsnprintf(buf + strlen(buf), win_size - strlen(buf),\n\t    \" %3d%% \", percent);\n\n\t/* amount transferred */\n\tformat_size(buf + strlen(buf), win_size - strlen(buf),\n\t    cur_pos);\n\tstrlcat(buf, \" \", win_size);\n\n\t/* bandwidth usage */\n\tformat_rate(buf + strlen(buf), win_size - strlen(buf),\n\t    (off_t)bytes_per_second);\n\tstrlcat(buf, \"/s \", win_size);\n\n\t/* ETA */\n\tif (!transferred)\n\t\tstalled += elapsed;\n\telse\n\t\tstalled = 0;\n\n\tif (stalled >= STALL_TIME)\n\t\tstrlcat(buf, \"- stalled -\", win_size);\n\telse if (bytes_per_second == 0 && bytes_left)\n\t\tstrlcat(buf, \"  --:-- ETA\", win_size);\n\telse {\n\t\tif (bytes_left > 0)\n\t\t\tseconds = bytes_left / bytes_per_second;\n\t\telse\n\t\t\tseconds = elapsed;\n\n\t\thours = seconds / 3600;\n\t\tseconds -= hours * 3600;\n\t\tminutes = seconds / 60;\n\t\tseconds -= minutes * 60;\n\n\t\tif (hours != 0)\n\t\t\tsnprintf(buf + strlen(buf), win_size - strlen(buf),\n\t\t\t    \"%d:%02d:%02d\", hours, minutes, seconds);\n\t\telse\n\t\t\tsnprintf(buf + strlen(buf), win_size - strlen(buf),\n\t\t\t    \"  %02d:%02d\", minutes, seconds);\n\n\t\tif (bytes_left > 0)\n\t\t\tstrlcat(buf, \" ETA\", win_size);\n\t\telse\n\t\t\tstrlcat(buf, \"    \", win_size);\n\t}\n\n\tatomicio(vwrite, STDOUT_FILENO, buf, win_size - 1);\n\tlast_update = now;\n}"
        }
      },
      {
        "call_info": {
          "callee": "can_output",
          "args": [],
          "line": 262
        },
        "resolved": true,
        "details": {
          "function_name": "can_output",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/progressmeter.c",
          "lines": "81-85",
          "snippet": "static int\ncan_output(void)\n{\n\treturn (getpgrp() == tcgetpgrp(STDOUT_FILENO));\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include \"atomicio.h\"",
            "#include \"progressmeter.h\"",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <signal.h>",
            "#include <errno.h>",
            "#include <sys/uio.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static int can_output(void);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include \"atomicio.h\"\n#include \"progressmeter.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdio.h>\n#include <signal.h>\n#include <errno.h>\n#include <sys/uio.h>\n#include <sys/ioctl.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nstatic int can_output(void);\n\nstatic int\ncan_output(void)\n{\n\treturn (getpgrp() == tcgetpgrp(STDOUT_FILENO));\n}"
        }
      },
      {
        "call_info": {
          "callee": "setscreensize",
          "args": [],
          "line": 261
        },
        "resolved": true,
        "details": {
          "function_name": "setscreensize",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/progressmeter.c",
          "lines": "292-306",
          "snippet": "static void\nsetscreensize(void)\n{\n\tstruct winsize winsize;\n\n\tif (ioctl(STDOUT_FILENO, TIOCGWINSZ, &winsize) != -1 &&\n\t    winsize.ws_col != 0) {\n\t\tif (winsize.ws_col > MAX_WINSIZE)\n\t\t\twin_size = MAX_WINSIZE;\n\t\telse\n\t\t\twin_size = winsize.ws_col;\n\t} else\n\t\twin_size = DEFAULT_WINSIZE;\n\twin_size += 1;\t\t\t\t\t/* trailing \\0 */\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include \"atomicio.h\"",
            "#include \"progressmeter.h\"",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <signal.h>",
            "#include <errno.h>",
            "#include <sys/uio.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [
            "#define MAX_WINSIZE 512",
            "#define DEFAULT_WINSIZE 80"
          ],
          "globals_used": [
            "static void setscreensize(void);",
            "static int win_size;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include \"atomicio.h\"\n#include \"progressmeter.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdio.h>\n#include <signal.h>\n#include <errno.h>\n#include <sys/uio.h>\n#include <sys/ioctl.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\n#define MAX_WINSIZE 512\n#define DEFAULT_WINSIZE 80\n\nstatic void setscreensize(void);\nstatic int win_size;\n\nstatic void\nsetscreensize(void)\n{\n\tstruct winsize winsize;\n\n\tif (ioctl(STDOUT_FILENO, TIOCGWINSZ, &winsize) != -1 &&\n\t    winsize.ws_col != 0) {\n\t\tif (winsize.ws_col > MAX_WINSIZE)\n\t\t\twin_size = MAX_WINSIZE;\n\t\telse\n\t\t\twin_size = winsize.ws_col;\n\t} else\n\t\twin_size = DEFAULT_WINSIZE;\n\twin_size += 1;\t\t\t\t\t/* trailing \\0 */\n}"
        }
      },
      {
        "call_info": {
          "callee": "monotime_double",
          "args": [],
          "line": 252
        },
        "resolved": true,
        "details": {
          "function_name": "monotime_double",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/misc.c",
          "lines": "1324-1331",
          "snippet": "double\nmonotime_double(void)\n{\n\tstruct timespec ts;\n\n\tmonotime_ts(&ts);\n\treturn ts.tv_sec + ((double)ts.tv_nsec / 1000000000);\n}",
          "includes": [
            "#include \"platform.h\"",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"ssh.h\"",
            "#include \"log.h\"",
            "#include \"misc.h\"",
            "#include \"xmalloc.h\"",
            "#include <net/if.h>",
            "#include <pwd.h>",
            "# include <paths.h>",
            "#include <netdb.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <ctype.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/tcp.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in_systm.h>",
            "#include <netinet/in.h>",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <libgen.h>",
            "#include <limits.h>",
            "#include <sys/un.h>",
            "#include <sys/wait.h>",
            "#include <sys/time.h>",
            "#include <sys/stat.h>",
            "#include <sys/socket.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"platform.h\"\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"ssh.h\"\n#include \"log.h\"\n#include \"misc.h\"\n#include \"xmalloc.h\"\n#include <net/if.h>\n#include <pwd.h>\n# include <paths.h>\n#include <netdb.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <ctype.h>\n#include <arpa/inet.h>\n#include <netinet/tcp.h>\n#include <netinet/ip.h>\n#include <netinet/in_systm.h>\n#include <netinet/in.h>\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <libgen.h>\n#include <limits.h>\n#include <sys/un.h>\n#include <sys/wait.h>\n#include <sys/time.h>\n#include <sys/stat.h>\n#include <sys/socket.h>\n#include <sys/ioctl.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\ndouble\nmonotime_double(void)\n{\n\tstruct timespec ts;\n\n\tmonotime_ts(&ts);\n\treturn ts.tv_sec + ((double)ts.tv_nsec / 1000000000);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"misc.h\"\n#include \"atomicio.h\"\n#include \"progressmeter.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdio.h>\n#include <signal.h>\n#include <errno.h>\n#include <sys/uio.h>\n#include <sys/ioctl.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\n#define UPDATE_INTERVAL 1\t/* update the progress meter every second */\n\nstatic int can_output(void);\nstatic void format_size(char *, int, off_t);\nstatic void format_rate(char *, int, off_t);\nstatic void sig_winch(int);\nstatic void setscreensize(void);\nvoid refresh_progress_meter(void);\nstatic void update_progress_meter(int);\nstatic double start;\nstatic double last_update;\nstatic const char *file;\nstatic off_t start_pos;\nstatic off_t end_pos;\nstatic off_t cur_pos;\nstatic volatile off_t *counter;\nstatic long stalled;\nstatic int bytes_per_second;\n\nvoid\nstart_progress_meter(const char *f, off_t filesize, off_t *ctr)\n{\n\tstart = last_update = monotime_double();\n\tfile = f;\n\tstart_pos = *ctr;\n\tend_pos = filesize;\n\tcur_pos = 0;\n\tcounter = ctr;\n\tstalled = 0;\n\tbytes_per_second = 0;\n\n\tsetscreensize();\n\tif (can_output())\n\t\trefresh_progress_meter();\n\n\tsignal(SIGALRM, update_progress_meter);\n\tsignal(SIGWINCH, sig_winch);\n\talarm(UPDATE_INTERVAL);\n}"
  },
  {
    "function_name": "update_progress_meter",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/progressmeter.c",
    "lines": "230-247",
    "snippet": "static void\nupdate_progress_meter(int ignore)\n{\n\tint save_errno;\n\n\tsave_errno = errno;\n\n\tif (win_resized) {\n\t\tsetscreensize();\n\t\twin_resized = 0;\n\t}\n\tif (can_output())\n\t\trefresh_progress_meter();\n\n\tsignal(SIGALRM, update_progress_meter);\n\talarm(UPDATE_INTERVAL);\n\terrno = save_errno;\n}",
    "includes": [
      "#include \"misc.h\"",
      "#include \"atomicio.h\"",
      "#include \"progressmeter.h\"",
      "#include <unistd.h>",
      "#include <time.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <signal.h>",
      "#include <errno.h>",
      "#include <sys/uio.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [
      "#define UPDATE_INTERVAL 1\t/* update the progress meter every second */"
    ],
    "globals_used": [
      "static int can_output(void);",
      "static void setscreensize(void);",
      "void refresh_progress_meter(void);",
      "static void update_progress_meter(int);",
      "static volatile sig_atomic_t win_resized;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "alarm",
          "args": [
            "UPDATE_INTERVAL"
          ],
          "line": 245
        },
        "resolved": true,
        "details": {
          "function_name": "grace_alarm_handler",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshd.c",
          "lines": "346-364",
          "snippet": "static void\ngrace_alarm_handler(int sig)\n{\n\tif (use_privsep && pmonitor != NULL && pmonitor->m_pid > 0)\n\t\tkill(pmonitor->m_pid, SIGALRM);\n\n\t/*\n\t * Try to kill any processes that we have spawned, E.g. authorized\n\t * keys command helpers.\n\t */\n\tif (getpgid(0) == getpid()) {\n\t\tsignal(SIGTERM, SIG_IGN);\n\t\tkill(0, SIGTERM);\n\t}\n\n\t/* Log error and exit. */\n\tsigdie(\"Timeout before authentication for %s port %d\",\n\t    ssh_remote_ipaddr(active_state), ssh_remote_port(active_state));\n}",
          "includes": [
            "#include \"ssherr.h\"",
            "#include \"version.h\"",
            "#include \"auth-options.h\"",
            "#include \"ssh-sandbox.h\"",
            "#include \"monitor_wrap.h\"",
            "#include \"ssh-gss.h\"",
            "#include \"monitor.h\"",
            "#include \"session.h\"",
            "#include \"channels.h\"",
            "#include \"dispatch.h\"",
            "#include \"msg.h\"",
            "#include \"authfd.h\"",
            "#include \"auth.h\"",
            "#include \"hostfile.h\"",
            "#include \"canohost.h\"",
            "#include \"atomicio.h\"",
            "#include \"pathnames.h\"",
            "#include \"authfile.h\"",
            "#include \"myproposal.h\"",
            "#include \"kex.h\"",
            "#include \"sshkey.h\"",
            "#include \"digest.h\"",
            "#include \"cipher.h\"",
            "#include \"compat.h\"",
            "#include \"uidswap.h\"",
            "#include \"servconf.h\"",
            "#include \"match.h\"",
            "#include \"misc.h\"",
            "#include \"sshbuf.h\"",
            "#include \"log.h\"",
            "#include \"packet.h\"",
            "#include \"sshpty.h\"",
            "#include \"ssh2.h\"",
            "#include \"ssh.h\"",
            "#include \"xmalloc.h\"",
            "#include <prot.h>",
            "#include <sys/security.h>",
            "#include \"openbsd-compat/openssl-compat.h\"",
            "#include <openssl/rand.h>",
            "#include <openssl/bn.h>",
            "#include <openssl/dh.h>",
            "#include <limits.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "#include <pwd.h>",
            "#include <grp.h>",
            "#include <paths.h>",
            "#include <netdb.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <sys/wait.h>",
            "#include \"openbsd-compat/sys-queue.h\"",
            "#include \"openbsd-compat/sys-tree.h\"",
            "# include <sys/time.h>",
            "# include <sys/stat.h>",
            "#include <sys/socket.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "int use_privsep = -1;",
            "struct monitor *pmonitor = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"ssherr.h\"\n#include \"version.h\"\n#include \"auth-options.h\"\n#include \"ssh-sandbox.h\"\n#include \"monitor_wrap.h\"\n#include \"ssh-gss.h\"\n#include \"monitor.h\"\n#include \"session.h\"\n#include \"channels.h\"\n#include \"dispatch.h\"\n#include \"msg.h\"\n#include \"authfd.h\"\n#include \"auth.h\"\n#include \"hostfile.h\"\n#include \"canohost.h\"\n#include \"atomicio.h\"\n#include \"pathnames.h\"\n#include \"authfile.h\"\n#include \"myproposal.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"digest.h\"\n#include \"cipher.h\"\n#include \"compat.h\"\n#include \"uidswap.h\"\n#include \"servconf.h\"\n#include \"match.h\"\n#include \"misc.h\"\n#include \"sshbuf.h\"\n#include \"log.h\"\n#include \"packet.h\"\n#include \"sshpty.h\"\n#include \"ssh2.h\"\n#include \"ssh.h\"\n#include \"xmalloc.h\"\n#include <prot.h>\n#include <sys/security.h>\n#include \"openbsd-compat/openssl-compat.h\"\n#include <openssl/rand.h>\n#include <openssl/bn.h>\n#include <openssl/dh.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <signal.h>\n#include <pwd.h>\n#include <grp.h>\n#include <paths.h>\n#include <netdb.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <sys/wait.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include \"openbsd-compat/sys-tree.h\"\n# include <sys/time.h>\n# include <sys/stat.h>\n#include <sys/socket.h>\n#include <sys/ioctl.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint use_privsep = -1;\nstruct monitor *pmonitor = NULL;\n\nstatic void\ngrace_alarm_handler(int sig)\n{\n\tif (use_privsep && pmonitor != NULL && pmonitor->m_pid > 0)\n\t\tkill(pmonitor->m_pid, SIGALRM);\n\n\t/*\n\t * Try to kill any processes that we have spawned, E.g. authorized\n\t * keys command helpers.\n\t */\n\tif (getpgid(0) == getpid()) {\n\t\tsignal(SIGTERM, SIG_IGN);\n\t\tkill(0, SIGTERM);\n\t}\n\n\t/* Log error and exit. */\n\tsigdie(\"Timeout before authentication for %s port %d\",\n\t    ssh_remote_ipaddr(active_state), ssh_remote_port(active_state));\n}"
        }
      },
      {
        "call_info": {
          "callee": "signal",
          "args": [
            "SIGALRM",
            "update_progress_meter"
          ],
          "line": 244
        },
        "resolved": true,
        "details": {
          "function_name": "session_signal_req",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/session.c",
          "lines": "2130-2176",
          "snippet": "static int\nsession_signal_req(struct ssh *ssh, Session *s)\n{\n\tchar *signame = NULL;\n\tint r, sig, success = 0;\n\n\tif ((r = sshpkt_get_cstring(ssh, &signame, NULL)) != 0 ||\n\t    (r = sshpkt_get_end(ssh)) != 0) {\n\t\terror(\"%s: parse packet: %s\", __func__, ssh_err(r));\n\t\tgoto out;\n\t}\n\tif ((sig = name2sig(signame)) == -1) {\n\t\terror(\"%s: unsupported signal \\\"%s\\\"\", __func__, signame);\n\t\tgoto out;\n\t}\n\tif (s->pid <= 0) {\n\t\terror(\"%s: no pid for session %d\", __func__, s->self);\n\t\tgoto out;\n\t}\n\tif (s->forced || s->is_subsystem) {\n\t\terror(\"%s: refusing to send signal %s to %s session\", __func__,\n\t\t    signame, s->forced ? \"forced-command\" : \"subsystem\");\n\t\tgoto out;\n\t}\n\tif (!use_privsep || mm_is_monitor()) {\n\t\terror(\"%s: session signalling requires privilege separation\",\n\t\t    __func__);\n\t\tgoto out;\n\t}\n\n\tdebug(\"%s: signal %s, killpg(%ld, %d)\", __func__, signame,\n\t    (long)s->pid, sig);\n\ttemporarily_use_uid(s->pw);\n\tr = killpg(s->pid, sig);\n\trestore_uid();\n\tif (r != 0) {\n\t\terror(\"%s: killpg(%ld, %d): %s\", __func__, (long)s->pid,\n\t\t    sig, strerror(errno));\n\t\tgoto out;\n\t}\n\n\t/* success */\n\tsuccess = 1;\n out:\n\tfree(signame);\n\treturn success;\n}",
          "includes": [
            "#include <selinux/selinux.h>",
            "#include <kafs.h>",
            "#include \"atomicio.h\"",
            "#include \"sftp.h\"",
            "#include \"monitor_wrap.h\"",
            "#include \"kex.h\"",
            "#include \"session.h\"",
            "#include \"canohost.h\"",
            "#include \"serverloop.h\"",
            "#include \"sshlogin.h\"",
            "#include \"servconf.h\"",
            "#include \"misc.h\"",
            "#include \"log.h\"",
            "#include \"pathnames.h\"",
            "#include \"authfd.h\"",
            "#include \"auth-options.h\"",
            "#include \"auth.h\"",
            "#include \"hostfile.h\"",
            "#include \"ssh-gss.h\"",
            "#include \"cipher.h\"",
            "#include \"sshkey.h\"",
            "#include \"channels.h\"",
            "#include \"compat.h\"",
            "#include \"uidswap.h\"",
            "#include \"match.h\"",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"packet.h\"",
            "#include \"sshpty.h\"",
            "#include \"ssh2.h\"",
            "#include \"ssh.h\"",
            "#include \"xmalloc.h\"",
            "#include \"openbsd-compat/sys-queue.h\"",
            "#include <limits.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "#include <pwd.h>",
            "#include <paths.h>",
            "#include <netdb.h>",
            "#include <grp.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <ctype.h>",
            "#include <arpa/inet.h>",
            "#include <sys/wait.h>",
            "#include <sys/un.h>",
            "#include <sys/socket.h>",
            "# include <sys/stat.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "void\tsession_set_fds(struct ssh *, Session *, int, int, int, int, int);",
            "void\tsession_pty_cleanup(Session *);",
            "void\tsession_proctitle(Session *);",
            "int\tsession_setup_x11fwd(struct ssh *, Session *);",
            "int\tdo_exec_pty(struct ssh *, Session *, const char *);",
            "int\tdo_exec_no_pty(struct ssh *, Session *, const char *);",
            "int\tdo_exec(struct ssh *, Session *, const char *);",
            "void\tdo_login(struct ssh *, Session *, const char *);",
            "void\tdo_child(struct ssh *, Session *, const char *);",
            "int\tcheck_quietlogin(Session *, const char *);",
            "static int session_pty_req(struct ssh *, Session *);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <selinux/selinux.h>\n#include <kafs.h>\n#include \"atomicio.h\"\n#include \"sftp.h\"\n#include \"monitor_wrap.h\"\n#include \"kex.h\"\n#include \"session.h\"\n#include \"canohost.h\"\n#include \"serverloop.h\"\n#include \"sshlogin.h\"\n#include \"servconf.h\"\n#include \"misc.h\"\n#include \"log.h\"\n#include \"pathnames.h\"\n#include \"authfd.h\"\n#include \"auth-options.h\"\n#include \"auth.h\"\n#include \"hostfile.h\"\n#include \"ssh-gss.h\"\n#include \"cipher.h\"\n#include \"sshkey.h\"\n#include \"channels.h\"\n#include \"compat.h\"\n#include \"uidswap.h\"\n#include \"match.h\"\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"packet.h\"\n#include \"sshpty.h\"\n#include \"ssh2.h\"\n#include \"ssh.h\"\n#include \"xmalloc.h\"\n#include \"openbsd-compat/sys-queue.h\"\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <signal.h>\n#include <pwd.h>\n#include <paths.h>\n#include <netdb.h>\n#include <grp.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <ctype.h>\n#include <arpa/inet.h>\n#include <sys/wait.h>\n#include <sys/un.h>\n#include <sys/socket.h>\n# include <sys/stat.h>\n#include <sys/param.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\tsession_set_fds(struct ssh *, Session *, int, int, int, int, int);\nvoid\tsession_pty_cleanup(Session *);\nvoid\tsession_proctitle(Session *);\nint\tsession_setup_x11fwd(struct ssh *, Session *);\nint\tdo_exec_pty(struct ssh *, Session *, const char *);\nint\tdo_exec_no_pty(struct ssh *, Session *, const char *);\nint\tdo_exec(struct ssh *, Session *, const char *);\nvoid\tdo_login(struct ssh *, Session *, const char *);\nvoid\tdo_child(struct ssh *, Session *, const char *);\nint\tcheck_quietlogin(Session *, const char *);\nstatic int session_pty_req(struct ssh *, Session *);\n\nstatic int\nsession_signal_req(struct ssh *ssh, Session *s)\n{\n\tchar *signame = NULL;\n\tint r, sig, success = 0;\n\n\tif ((r = sshpkt_get_cstring(ssh, &signame, NULL)) != 0 ||\n\t    (r = sshpkt_get_end(ssh)) != 0) {\n\t\terror(\"%s: parse packet: %s\", __func__, ssh_err(r));\n\t\tgoto out;\n\t}\n\tif ((sig = name2sig(signame)) == -1) {\n\t\terror(\"%s: unsupported signal \\\"%s\\\"\", __func__, signame);\n\t\tgoto out;\n\t}\n\tif (s->pid <= 0) {\n\t\terror(\"%s: no pid for session %d\", __func__, s->self);\n\t\tgoto out;\n\t}\n\tif (s->forced || s->is_subsystem) {\n\t\terror(\"%s: refusing to send signal %s to %s session\", __func__,\n\t\t    signame, s->forced ? \"forced-command\" : \"subsystem\");\n\t\tgoto out;\n\t}\n\tif (!use_privsep || mm_is_monitor()) {\n\t\terror(\"%s: session signalling requires privilege separation\",\n\t\t    __func__);\n\t\tgoto out;\n\t}\n\n\tdebug(\"%s: signal %s, killpg(%ld, %d)\", __func__, signame,\n\t    (long)s->pid, sig);\n\ttemporarily_use_uid(s->pw);\n\tr = killpg(s->pid, sig);\n\trestore_uid();\n\tif (r != 0) {\n\t\terror(\"%s: killpg(%ld, %d): %s\", __func__, (long)s->pid,\n\t\t    sig, strerror(errno));\n\t\tgoto out;\n\t}\n\n\t/* success */\n\tsuccess = 1;\n out:\n\tfree(signame);\n\treturn success;\n}"
        }
      },
      {
        "call_info": {
          "callee": "refresh_progress_meter",
          "args": [],
          "line": 242
        },
        "resolved": true,
        "details": {
          "function_name": "refresh_progress_meter",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/progressmeter.c",
          "lines": "119-227",
          "snippet": "void\nrefresh_progress_meter(void)\n{\n\tchar buf[MAX_WINSIZE + 1];\n\toff_t transferred;\n\tdouble elapsed, now;\n\tint percent;\n\toff_t bytes_left;\n\tint cur_speed;\n\tint hours, minutes, seconds;\n\tint i, len;\n\tint file_len;\n\n\ttransferred = *counter - (cur_pos ? cur_pos : start_pos);\n\tcur_pos = *counter;\n\tnow = monotime_double();\n\tbytes_left = end_pos - cur_pos;\n\n\tif (bytes_left > 0)\n\t\telapsed = now - last_update;\n\telse {\n\t\telapsed = now - start;\n\t\t/* Calculate true total speed when done */\n\t\ttransferred = end_pos - start_pos;\n\t\tbytes_per_second = 0;\n\t}\n\n\t/* calculate speed */\n\tif (elapsed != 0)\n\t\tcur_speed = (transferred / elapsed);\n\telse\n\t\tcur_speed = transferred;\n\n#define AGE_FACTOR 0.9\n\tif (bytes_per_second != 0) {\n\t\tbytes_per_second = (bytes_per_second * AGE_FACTOR) +\n\t\t    (cur_speed * (1.0 - AGE_FACTOR));\n\t} else\n\t\tbytes_per_second = cur_speed;\n\n\t/* filename */\n\tbuf[0] = '\\0';\n\tfile_len = win_size - 35;\n\tif (file_len > 0) {\n\t\tlen = snprintf(buf, file_len + 1, \"\\r%s\", file);\n\t\tif (len < 0)\n\t\t\tlen = 0;\n\t\tif (len >= file_len + 1)\n\t\t\tlen = file_len;\n\t\tfor (i = len; i < file_len; i++)\n\t\t\tbuf[i] = ' ';\n\t\tbuf[file_len] = '\\0';\n\t}\n\n\t/* percent of transfer done */\n\tif (end_pos == 0 || cur_pos == end_pos)\n\t\tpercent = 100;\n\telse\n\t\tpercent = ((float)cur_pos / end_pos) * 100;\n\tsnprintf(buf + strlen(buf), win_size - strlen(buf),\n\t    \" %3d%% \", percent);\n\n\t/* amount transferred */\n\tformat_size(buf + strlen(buf), win_size - strlen(buf),\n\t    cur_pos);\n\tstrlcat(buf, \" \", win_size);\n\n\t/* bandwidth usage */\n\tformat_rate(buf + strlen(buf), win_size - strlen(buf),\n\t    (off_t)bytes_per_second);\n\tstrlcat(buf, \"/s \", win_size);\n\n\t/* ETA */\n\tif (!transferred)\n\t\tstalled += elapsed;\n\telse\n\t\tstalled = 0;\n\n\tif (stalled >= STALL_TIME)\n\t\tstrlcat(buf, \"- stalled -\", win_size);\n\telse if (bytes_per_second == 0 && bytes_left)\n\t\tstrlcat(buf, \"  --:-- ETA\", win_size);\n\telse {\n\t\tif (bytes_left > 0)\n\t\t\tseconds = bytes_left / bytes_per_second;\n\t\telse\n\t\t\tseconds = elapsed;\n\n\t\thours = seconds / 3600;\n\t\tseconds -= hours * 3600;\n\t\tminutes = seconds / 60;\n\t\tseconds -= minutes * 60;\n\n\t\tif (hours != 0)\n\t\t\tsnprintf(buf + strlen(buf), win_size - strlen(buf),\n\t\t\t    \"%d:%02d:%02d\", hours, minutes, seconds);\n\t\telse\n\t\t\tsnprintf(buf + strlen(buf), win_size - strlen(buf),\n\t\t\t    \"  %02d:%02d\", minutes, seconds);\n\n\t\tif (bytes_left > 0)\n\t\t\tstrlcat(buf, \" ETA\", win_size);\n\t\telse\n\t\t\tstrlcat(buf, \"    \", win_size);\n\t}\n\n\tatomicio(vwrite, STDOUT_FILENO, buf, win_size - 1);\n\tlast_update = now;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include \"atomicio.h\"",
            "#include \"progressmeter.h\"",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <signal.h>",
            "#include <errno.h>",
            "#include <sys/uio.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [
            "#define AGE_FACTOR 0.9",
            "#define STALL_TIME 5\t\t/* we're stalled after this many seconds */",
            "#define MAX_WINSIZE 512"
          ],
          "globals_used": [
            "static void format_size(char *, int, off_t);",
            "static void format_rate(char *, int, off_t);",
            "void refresh_progress_meter(void);",
            "static double start;",
            "static double last_update;",
            "static const char *file;",
            "static off_t start_pos;",
            "static off_t end_pos;",
            "static off_t cur_pos;",
            "static volatile off_t *counter;",
            "static long stalled;",
            "static int bytes_per_second;",
            "static int win_size;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include \"atomicio.h\"\n#include \"progressmeter.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdio.h>\n#include <signal.h>\n#include <errno.h>\n#include <sys/uio.h>\n#include <sys/ioctl.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\n#define AGE_FACTOR 0.9\n#define STALL_TIME 5\t\t/* we're stalled after this many seconds */\n#define MAX_WINSIZE 512\n\nstatic void format_size(char *, int, off_t);\nstatic void format_rate(char *, int, off_t);\nvoid refresh_progress_meter(void);\nstatic double start;\nstatic double last_update;\nstatic const char *file;\nstatic off_t start_pos;\nstatic off_t end_pos;\nstatic off_t cur_pos;\nstatic volatile off_t *counter;\nstatic long stalled;\nstatic int bytes_per_second;\nstatic int win_size;\n\nvoid\nrefresh_progress_meter(void)\n{\n\tchar buf[MAX_WINSIZE + 1];\n\toff_t transferred;\n\tdouble elapsed, now;\n\tint percent;\n\toff_t bytes_left;\n\tint cur_speed;\n\tint hours, minutes, seconds;\n\tint i, len;\n\tint file_len;\n\n\ttransferred = *counter - (cur_pos ? cur_pos : start_pos);\n\tcur_pos = *counter;\n\tnow = monotime_double();\n\tbytes_left = end_pos - cur_pos;\n\n\tif (bytes_left > 0)\n\t\telapsed = now - last_update;\n\telse {\n\t\telapsed = now - start;\n\t\t/* Calculate true total speed when done */\n\t\ttransferred = end_pos - start_pos;\n\t\tbytes_per_second = 0;\n\t}\n\n\t/* calculate speed */\n\tif (elapsed != 0)\n\t\tcur_speed = (transferred / elapsed);\n\telse\n\t\tcur_speed = transferred;\n\n#define AGE_FACTOR 0.9\n\tif (bytes_per_second != 0) {\n\t\tbytes_per_second = (bytes_per_second * AGE_FACTOR) +\n\t\t    (cur_speed * (1.0 - AGE_FACTOR));\n\t} else\n\t\tbytes_per_second = cur_speed;\n\n\t/* filename */\n\tbuf[0] = '\\0';\n\tfile_len = win_size - 35;\n\tif (file_len > 0) {\n\t\tlen = snprintf(buf, file_len + 1, \"\\r%s\", file);\n\t\tif (len < 0)\n\t\t\tlen = 0;\n\t\tif (len >= file_len + 1)\n\t\t\tlen = file_len;\n\t\tfor (i = len; i < file_len; i++)\n\t\t\tbuf[i] = ' ';\n\t\tbuf[file_len] = '\\0';\n\t}\n\n\t/* percent of transfer done */\n\tif (end_pos == 0 || cur_pos == end_pos)\n\t\tpercent = 100;\n\telse\n\t\tpercent = ((float)cur_pos / end_pos) * 100;\n\tsnprintf(buf + strlen(buf), win_size - strlen(buf),\n\t    \" %3d%% \", percent);\n\n\t/* amount transferred */\n\tformat_size(buf + strlen(buf), win_size - strlen(buf),\n\t    cur_pos);\n\tstrlcat(buf, \" \", win_size);\n\n\t/* bandwidth usage */\n\tformat_rate(buf + strlen(buf), win_size - strlen(buf),\n\t    (off_t)bytes_per_second);\n\tstrlcat(buf, \"/s \", win_size);\n\n\t/* ETA */\n\tif (!transferred)\n\t\tstalled += elapsed;\n\telse\n\t\tstalled = 0;\n\n\tif (stalled >= STALL_TIME)\n\t\tstrlcat(buf, \"- stalled -\", win_size);\n\telse if (bytes_per_second == 0 && bytes_left)\n\t\tstrlcat(buf, \"  --:-- ETA\", win_size);\n\telse {\n\t\tif (bytes_left > 0)\n\t\t\tseconds = bytes_left / bytes_per_second;\n\t\telse\n\t\t\tseconds = elapsed;\n\n\t\thours = seconds / 3600;\n\t\tseconds -= hours * 3600;\n\t\tminutes = seconds / 60;\n\t\tseconds -= minutes * 60;\n\n\t\tif (hours != 0)\n\t\t\tsnprintf(buf + strlen(buf), win_size - strlen(buf),\n\t\t\t    \"%d:%02d:%02d\", hours, minutes, seconds);\n\t\telse\n\t\t\tsnprintf(buf + strlen(buf), win_size - strlen(buf),\n\t\t\t    \"  %02d:%02d\", minutes, seconds);\n\n\t\tif (bytes_left > 0)\n\t\t\tstrlcat(buf, \" ETA\", win_size);\n\t\telse\n\t\t\tstrlcat(buf, \"    \", win_size);\n\t}\n\n\tatomicio(vwrite, STDOUT_FILENO, buf, win_size - 1);\n\tlast_update = now;\n}"
        }
      },
      {
        "call_info": {
          "callee": "can_output",
          "args": [],
          "line": 241
        },
        "resolved": true,
        "details": {
          "function_name": "can_output",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/progressmeter.c",
          "lines": "81-85",
          "snippet": "static int\ncan_output(void)\n{\n\treturn (getpgrp() == tcgetpgrp(STDOUT_FILENO));\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include \"atomicio.h\"",
            "#include \"progressmeter.h\"",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <signal.h>",
            "#include <errno.h>",
            "#include <sys/uio.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static int can_output(void);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include \"atomicio.h\"\n#include \"progressmeter.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdio.h>\n#include <signal.h>\n#include <errno.h>\n#include <sys/uio.h>\n#include <sys/ioctl.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nstatic int can_output(void);\n\nstatic int\ncan_output(void)\n{\n\treturn (getpgrp() == tcgetpgrp(STDOUT_FILENO));\n}"
        }
      },
      {
        "call_info": {
          "callee": "setscreensize",
          "args": [],
          "line": 238
        },
        "resolved": true,
        "details": {
          "function_name": "setscreensize",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/progressmeter.c",
          "lines": "292-306",
          "snippet": "static void\nsetscreensize(void)\n{\n\tstruct winsize winsize;\n\n\tif (ioctl(STDOUT_FILENO, TIOCGWINSZ, &winsize) != -1 &&\n\t    winsize.ws_col != 0) {\n\t\tif (winsize.ws_col > MAX_WINSIZE)\n\t\t\twin_size = MAX_WINSIZE;\n\t\telse\n\t\t\twin_size = winsize.ws_col;\n\t} else\n\t\twin_size = DEFAULT_WINSIZE;\n\twin_size += 1;\t\t\t\t\t/* trailing \\0 */\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include \"atomicio.h\"",
            "#include \"progressmeter.h\"",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <signal.h>",
            "#include <errno.h>",
            "#include <sys/uio.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [
            "#define MAX_WINSIZE 512",
            "#define DEFAULT_WINSIZE 80"
          ],
          "globals_used": [
            "static void setscreensize(void);",
            "static int win_size;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include \"atomicio.h\"\n#include \"progressmeter.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdio.h>\n#include <signal.h>\n#include <errno.h>\n#include <sys/uio.h>\n#include <sys/ioctl.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\n#define MAX_WINSIZE 512\n#define DEFAULT_WINSIZE 80\n\nstatic void setscreensize(void);\nstatic int win_size;\n\nstatic void\nsetscreensize(void)\n{\n\tstruct winsize winsize;\n\n\tif (ioctl(STDOUT_FILENO, TIOCGWINSZ, &winsize) != -1 &&\n\t    winsize.ws_col != 0) {\n\t\tif (winsize.ws_col > MAX_WINSIZE)\n\t\t\twin_size = MAX_WINSIZE;\n\t\telse\n\t\t\twin_size = winsize.ws_col;\n\t} else\n\t\twin_size = DEFAULT_WINSIZE;\n\twin_size += 1;\t\t\t\t\t/* trailing \\0 */\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"misc.h\"\n#include \"atomicio.h\"\n#include \"progressmeter.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdio.h>\n#include <signal.h>\n#include <errno.h>\n#include <sys/uio.h>\n#include <sys/ioctl.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\n#define UPDATE_INTERVAL 1\t/* update the progress meter every second */\n\nstatic int can_output(void);\nstatic void setscreensize(void);\nvoid refresh_progress_meter(void);\nstatic void update_progress_meter(int);\nstatic volatile sig_atomic_t win_resized;\n\nstatic void\nupdate_progress_meter(int ignore)\n{\n\tint save_errno;\n\n\tsave_errno = errno;\n\n\tif (win_resized) {\n\t\tsetscreensize();\n\t\twin_resized = 0;\n\t}\n\tif (can_output())\n\t\trefresh_progress_meter();\n\n\tsignal(SIGALRM, update_progress_meter);\n\talarm(UPDATE_INTERVAL);\n\terrno = save_errno;\n}"
  },
  {
    "function_name": "refresh_progress_meter",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/progressmeter.c",
    "lines": "119-227",
    "snippet": "void\nrefresh_progress_meter(void)\n{\n\tchar buf[MAX_WINSIZE + 1];\n\toff_t transferred;\n\tdouble elapsed, now;\n\tint percent;\n\toff_t bytes_left;\n\tint cur_speed;\n\tint hours, minutes, seconds;\n\tint i, len;\n\tint file_len;\n\n\ttransferred = *counter - (cur_pos ? cur_pos : start_pos);\n\tcur_pos = *counter;\n\tnow = monotime_double();\n\tbytes_left = end_pos - cur_pos;\n\n\tif (bytes_left > 0)\n\t\telapsed = now - last_update;\n\telse {\n\t\telapsed = now - start;\n\t\t/* Calculate true total speed when done */\n\t\ttransferred = end_pos - start_pos;\n\t\tbytes_per_second = 0;\n\t}\n\n\t/* calculate speed */\n\tif (elapsed != 0)\n\t\tcur_speed = (transferred / elapsed);\n\telse\n\t\tcur_speed = transferred;\n\n#define AGE_FACTOR 0.9\n\tif (bytes_per_second != 0) {\n\t\tbytes_per_second = (bytes_per_second * AGE_FACTOR) +\n\t\t    (cur_speed * (1.0 - AGE_FACTOR));\n\t} else\n\t\tbytes_per_second = cur_speed;\n\n\t/* filename */\n\tbuf[0] = '\\0';\n\tfile_len = win_size - 35;\n\tif (file_len > 0) {\n\t\tlen = snprintf(buf, file_len + 1, \"\\r%s\", file);\n\t\tif (len < 0)\n\t\t\tlen = 0;\n\t\tif (len >= file_len + 1)\n\t\t\tlen = file_len;\n\t\tfor (i = len; i < file_len; i++)\n\t\t\tbuf[i] = ' ';\n\t\tbuf[file_len] = '\\0';\n\t}\n\n\t/* percent of transfer done */\n\tif (end_pos == 0 || cur_pos == end_pos)\n\t\tpercent = 100;\n\telse\n\t\tpercent = ((float)cur_pos / end_pos) * 100;\n\tsnprintf(buf + strlen(buf), win_size - strlen(buf),\n\t    \" %3d%% \", percent);\n\n\t/* amount transferred */\n\tformat_size(buf + strlen(buf), win_size - strlen(buf),\n\t    cur_pos);\n\tstrlcat(buf, \" \", win_size);\n\n\t/* bandwidth usage */\n\tformat_rate(buf + strlen(buf), win_size - strlen(buf),\n\t    (off_t)bytes_per_second);\n\tstrlcat(buf, \"/s \", win_size);\n\n\t/* ETA */\n\tif (!transferred)\n\t\tstalled += elapsed;\n\telse\n\t\tstalled = 0;\n\n\tif (stalled >= STALL_TIME)\n\t\tstrlcat(buf, \"- stalled -\", win_size);\n\telse if (bytes_per_second == 0 && bytes_left)\n\t\tstrlcat(buf, \"  --:-- ETA\", win_size);\n\telse {\n\t\tif (bytes_left > 0)\n\t\t\tseconds = bytes_left / bytes_per_second;\n\t\telse\n\t\t\tseconds = elapsed;\n\n\t\thours = seconds / 3600;\n\t\tseconds -= hours * 3600;\n\t\tminutes = seconds / 60;\n\t\tseconds -= minutes * 60;\n\n\t\tif (hours != 0)\n\t\t\tsnprintf(buf + strlen(buf), win_size - strlen(buf),\n\t\t\t    \"%d:%02d:%02d\", hours, minutes, seconds);\n\t\telse\n\t\t\tsnprintf(buf + strlen(buf), win_size - strlen(buf),\n\t\t\t    \"  %02d:%02d\", minutes, seconds);\n\n\t\tif (bytes_left > 0)\n\t\t\tstrlcat(buf, \" ETA\", win_size);\n\t\telse\n\t\t\tstrlcat(buf, \"    \", win_size);\n\t}\n\n\tatomicio(vwrite, STDOUT_FILENO, buf, win_size - 1);\n\tlast_update = now;\n}",
    "includes": [
      "#include \"misc.h\"",
      "#include \"atomicio.h\"",
      "#include \"progressmeter.h\"",
      "#include <unistd.h>",
      "#include <time.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <signal.h>",
      "#include <errno.h>",
      "#include <sys/uio.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [
      "#define AGE_FACTOR 0.9",
      "#define STALL_TIME 5\t\t/* we're stalled after this many seconds */",
      "#define MAX_WINSIZE 512"
    ],
    "globals_used": [
      "static void format_size(char *, int, off_t);",
      "static void format_rate(char *, int, off_t);",
      "void refresh_progress_meter(void);",
      "static double start;",
      "static double last_update;",
      "static const char *file;",
      "static off_t start_pos;",
      "static off_t end_pos;",
      "static off_t cur_pos;",
      "static volatile off_t *counter;",
      "static long stalled;",
      "static int bytes_per_second;",
      "static int win_size;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "atomicio",
          "args": [
            "vwrite",
            "STDOUT_FILENO",
            "buf",
            "win_size - 1"
          ],
          "line": 225
        },
        "resolved": true,
        "details": {
          "function_name": "atomiciov",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/atomicio.c",
          "lines": "165-170",
          "snippet": "size_t\natomiciov(ssize_t (*f) (int, const struct iovec *, int), int fd,\n    const struct iovec *_iov, int iovcnt)\n{\n\treturn atomiciov6(f, fd, _iov, iovcnt, NULL, NULL);\n}",
          "includes": [
            "#include \"atomicio.h\"",
            "#include <limits.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#  include <sys/poll.h>",
            "#include <poll.h>",
            "#include <errno.h>",
            "#include <sys/uio.h>",
            "#include <sys/param.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"atomicio.h\"\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#  include <sys/poll.h>\n#include <poll.h>\n#include <errno.h>\n#include <sys/uio.h>\n#include <sys/param.h>\n#include \"includes.h\"\n\nsize_t\natomiciov(ssize_t (*f) (int, const struct iovec *, int), int fd,\n    const struct iovec *_iov, int iovcnt)\n{\n\treturn atomiciov6(f, fd, _iov, iovcnt, NULL, NULL);\n}"
        }
      },
      {
        "call_info": {
          "callee": "strlcat",
          "args": [
            "buf",
            "\"    \"",
            "win_size"
          ],
          "line": 222
        },
        "resolved": true,
        "details": {
          "function_name": "strlcat",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/openbsd-compat/strlcat.c",
          "lines": "34-60",
          "snippet": "size_t\nstrlcat(char *dst, const char *src, size_t siz)\n{\n\tchar *d = dst;\n\tconst char *s = src;\n\tsize_t n = siz;\n\tsize_t dlen;\n\n\t/* Find the end of dst and adjust bytes left but don't go past end */\n\twhile (n-- != 0 && *d != '\\0')\n\t\td++;\n\tdlen = d - dst;\n\tn = siz - dlen;\n\n\tif (n == 0)\n\t\treturn(dlen + strlen(s));\n\twhile (*s != '\\0') {\n\t\tif (n != 1) {\n\t\t\t*d++ = *s;\n\t\t\tn--;\n\t\t}\n\t\ts++;\n\t}\n\t*d = '\\0';\n\n\treturn(dlen + (s - src));\t/* count does not include NUL */\n}",
          "includes": [
            "#include <string.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nsize_t\nstrlcat(char *dst, const char *src, size_t siz)\n{\n\tchar *d = dst;\n\tconst char *s = src;\n\tsize_t n = siz;\n\tsize_t dlen;\n\n\t/* Find the end of dst and adjust bytes left but don't go past end */\n\twhile (n-- != 0 && *d != '\\0')\n\t\td++;\n\tdlen = d - dst;\n\tn = siz - dlen;\n\n\tif (n == 0)\n\t\treturn(dlen + strlen(s));\n\twhile (*s != '\\0') {\n\t\tif (n != 1) {\n\t\t\t*d++ = *s;\n\t\t\tn--;\n\t\t}\n\t\ts++;\n\t}\n\t*d = '\\0';\n\n\treturn(dlen + (s - src));\t/* count does not include NUL */\n}"
        }
      },
      {
        "call_info": {
          "callee": "snprintf",
          "args": [
            "buf + strlen(buf)",
            "win_size - strlen(buf)",
            "\"  %02d:%02d\"",
            "minutes",
            "seconds"
          ],
          "line": 216
        },
        "resolved": true,
        "details": {
          "function_name": "snprintf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/openbsd-compat/bsd-snprintf.c",
          "lines": "869-879",
          "snippet": "int\nsnprintf(char *str, size_t count, SNPRINTF_CONST char *fmt, ...)\n{\n\tsize_t ret;\n\tva_list ap;\n\n\tva_start(ap, fmt);\n\tret = vsnprintf(str, count, fmt, ap);\n\tva_end(ap);\n\treturn ret;\n}",
          "includes": [
            "#include <errno.h>",
            "#include <limits.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdarg.h>",
            "#include <ctype.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <errno.h>\n#include <limits.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdarg.h>\n#include <ctype.h>\n#include \"includes.h\"\n\nint\nsnprintf(char *str, size_t count, SNPRINTF_CONST char *fmt, ...)\n{\n\tsize_t ret;\n\tva_list ap;\n\n\tva_start(ap, fmt);\n\tret = vsnprintf(str, count, fmt, ap);\n\tva_end(ap);\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "buf"
          ],
          "line": 216
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "buf"
          ],
          "line": 216
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "buf"
          ],
          "line": 213
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "buf"
          ],
          "line": 213
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "format_rate",
          "args": [
            "buf + strlen(buf)",
            "win_size - strlen(buf)",
            "(off_t)bytes_per_second"
          ],
          "line": 187
        },
        "resolved": true,
        "details": {
          "function_name": "format_rate",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/progressmeter.c",
          "lines": "87-104",
          "snippet": "static void\nformat_rate(char *buf, int size, off_t bytes)\n{\n\tint i;\n\n\tbytes *= 100;\n\tfor (i = 0; bytes >= 100*1000 && unit[i] != 'T'; i++)\n\t\tbytes = (bytes + 512) / 1024;\n\tif (i == 0) {\n\t\ti++;\n\t\tbytes = (bytes + 512) / 1024;\n\t}\n\tsnprintf(buf, size, \"%3lld.%1lld%c%s\",\n\t    (long long) (bytes + 5) / 100,\n\t    (long long) (bytes + 5) / 10 % 10,\n\t    unit[i],\n\t    i ? \"B\" : \" \");\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include \"atomicio.h\"",
            "#include \"progressmeter.h\"",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <signal.h>",
            "#include <errno.h>",
            "#include <sys/uio.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static void format_size(char *, int, off_t);",
            "static void format_rate(char *, int, off_t);",
            "static const char unit[] = \" KMGT\";"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include \"atomicio.h\"\n#include \"progressmeter.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdio.h>\n#include <signal.h>\n#include <errno.h>\n#include <sys/uio.h>\n#include <sys/ioctl.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nstatic void format_size(char *, int, off_t);\nstatic void format_rate(char *, int, off_t);\nstatic const char unit[] = \" KMGT\";\n\nstatic void\nformat_rate(char *buf, int size, off_t bytes)\n{\n\tint i;\n\n\tbytes *= 100;\n\tfor (i = 0; bytes >= 100*1000 && unit[i] != 'T'; i++)\n\t\tbytes = (bytes + 512) / 1024;\n\tif (i == 0) {\n\t\ti++;\n\t\tbytes = (bytes + 512) / 1024;\n\t}\n\tsnprintf(buf, size, \"%3lld.%1lld%c%s\",\n\t    (long long) (bytes + 5) / 100,\n\t    (long long) (bytes + 5) / 10 % 10,\n\t    unit[i],\n\t    i ? \"B\" : \" \");\n}"
        }
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "buf"
          ],
          "line": 187
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "buf"
          ],
          "line": 187
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "format_size",
          "args": [
            "buf + strlen(buf)",
            "win_size - strlen(buf)",
            "cur_pos"
          ],
          "line": 182
        },
        "resolved": true,
        "details": {
          "function_name": "format_size",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/progressmeter.c",
          "lines": "106-117",
          "snippet": "static void\nformat_size(char *buf, int size, off_t bytes)\n{\n\tint i;\n\n\tfor (i = 0; bytes >= 10000 && unit[i] != 'T'; i++)\n\t\tbytes = (bytes + 512) / 1024;\n\tsnprintf(buf, size, \"%4lld%c%s\",\n\t    (long long) bytes,\n\t    unit[i],\n\t    i ? \"B\" : \" \");\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include \"atomicio.h\"",
            "#include \"progressmeter.h\"",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <signal.h>",
            "#include <errno.h>",
            "#include <sys/uio.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static void format_size(char *, int, off_t);",
            "static void format_rate(char *, int, off_t);",
            "static const char unit[] = \" KMGT\";"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include \"atomicio.h\"\n#include \"progressmeter.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdio.h>\n#include <signal.h>\n#include <errno.h>\n#include <sys/uio.h>\n#include <sys/ioctl.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nstatic void format_size(char *, int, off_t);\nstatic void format_rate(char *, int, off_t);\nstatic const char unit[] = \" KMGT\";\n\nstatic void\nformat_size(char *buf, int size, off_t bytes)\n{\n\tint i;\n\n\tfor (i = 0; bytes >= 10000 && unit[i] != 'T'; i++)\n\t\tbytes = (bytes + 512) / 1024;\n\tsnprintf(buf, size, \"%4lld%c%s\",\n\t    (long long) bytes,\n\t    unit[i],\n\t    i ? \"B\" : \" \");\n}"
        }
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "buf"
          ],
          "line": 182
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "buf"
          ],
          "line": 182
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "buf"
          ],
          "line": 178
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "buf"
          ],
          "line": 178
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "monotime_double",
          "args": [],
          "line": 134
        },
        "resolved": true,
        "details": {
          "function_name": "monotime_double",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/misc.c",
          "lines": "1324-1331",
          "snippet": "double\nmonotime_double(void)\n{\n\tstruct timespec ts;\n\n\tmonotime_ts(&ts);\n\treturn ts.tv_sec + ((double)ts.tv_nsec / 1000000000);\n}",
          "includes": [
            "#include \"platform.h\"",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"ssh.h\"",
            "#include \"log.h\"",
            "#include \"misc.h\"",
            "#include \"xmalloc.h\"",
            "#include <net/if.h>",
            "#include <pwd.h>",
            "# include <paths.h>",
            "#include <netdb.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <ctype.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/tcp.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in_systm.h>",
            "#include <netinet/in.h>",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <libgen.h>",
            "#include <limits.h>",
            "#include <sys/un.h>",
            "#include <sys/wait.h>",
            "#include <sys/time.h>",
            "#include <sys/stat.h>",
            "#include <sys/socket.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"platform.h\"\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"ssh.h\"\n#include \"log.h\"\n#include \"misc.h\"\n#include \"xmalloc.h\"\n#include <net/if.h>\n#include <pwd.h>\n# include <paths.h>\n#include <netdb.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <ctype.h>\n#include <arpa/inet.h>\n#include <netinet/tcp.h>\n#include <netinet/ip.h>\n#include <netinet/in_systm.h>\n#include <netinet/in.h>\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <libgen.h>\n#include <limits.h>\n#include <sys/un.h>\n#include <sys/wait.h>\n#include <sys/time.h>\n#include <sys/stat.h>\n#include <sys/socket.h>\n#include <sys/ioctl.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\ndouble\nmonotime_double(void)\n{\n\tstruct timespec ts;\n\n\tmonotime_ts(&ts);\n\treturn ts.tv_sec + ((double)ts.tv_nsec / 1000000000);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"misc.h\"\n#include \"atomicio.h\"\n#include \"progressmeter.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdio.h>\n#include <signal.h>\n#include <errno.h>\n#include <sys/uio.h>\n#include <sys/ioctl.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\n#define AGE_FACTOR 0.9\n#define STALL_TIME 5\t\t/* we're stalled after this many seconds */\n#define MAX_WINSIZE 512\n\nstatic void format_size(char *, int, off_t);\nstatic void format_rate(char *, int, off_t);\nvoid refresh_progress_meter(void);\nstatic double start;\nstatic double last_update;\nstatic const char *file;\nstatic off_t start_pos;\nstatic off_t end_pos;\nstatic off_t cur_pos;\nstatic volatile off_t *counter;\nstatic long stalled;\nstatic int bytes_per_second;\nstatic int win_size;\n\nvoid\nrefresh_progress_meter(void)\n{\n\tchar buf[MAX_WINSIZE + 1];\n\toff_t transferred;\n\tdouble elapsed, now;\n\tint percent;\n\toff_t bytes_left;\n\tint cur_speed;\n\tint hours, minutes, seconds;\n\tint i, len;\n\tint file_len;\n\n\ttransferred = *counter - (cur_pos ? cur_pos : start_pos);\n\tcur_pos = *counter;\n\tnow = monotime_double();\n\tbytes_left = end_pos - cur_pos;\n\n\tif (bytes_left > 0)\n\t\telapsed = now - last_update;\n\telse {\n\t\telapsed = now - start;\n\t\t/* Calculate true total speed when done */\n\t\ttransferred = end_pos - start_pos;\n\t\tbytes_per_second = 0;\n\t}\n\n\t/* calculate speed */\n\tif (elapsed != 0)\n\t\tcur_speed = (transferred / elapsed);\n\telse\n\t\tcur_speed = transferred;\n\n#define AGE_FACTOR 0.9\n\tif (bytes_per_second != 0) {\n\t\tbytes_per_second = (bytes_per_second * AGE_FACTOR) +\n\t\t    (cur_speed * (1.0 - AGE_FACTOR));\n\t} else\n\t\tbytes_per_second = cur_speed;\n\n\t/* filename */\n\tbuf[0] = '\\0';\n\tfile_len = win_size - 35;\n\tif (file_len > 0) {\n\t\tlen = snprintf(buf, file_len + 1, \"\\r%s\", file);\n\t\tif (len < 0)\n\t\t\tlen = 0;\n\t\tif (len >= file_len + 1)\n\t\t\tlen = file_len;\n\t\tfor (i = len; i < file_len; i++)\n\t\t\tbuf[i] = ' ';\n\t\tbuf[file_len] = '\\0';\n\t}\n\n\t/* percent of transfer done */\n\tif (end_pos == 0 || cur_pos == end_pos)\n\t\tpercent = 100;\n\telse\n\t\tpercent = ((float)cur_pos / end_pos) * 100;\n\tsnprintf(buf + strlen(buf), win_size - strlen(buf),\n\t    \" %3d%% \", percent);\n\n\t/* amount transferred */\n\tformat_size(buf + strlen(buf), win_size - strlen(buf),\n\t    cur_pos);\n\tstrlcat(buf, \" \", win_size);\n\n\t/* bandwidth usage */\n\tformat_rate(buf + strlen(buf), win_size - strlen(buf),\n\t    (off_t)bytes_per_second);\n\tstrlcat(buf, \"/s \", win_size);\n\n\t/* ETA */\n\tif (!transferred)\n\t\tstalled += elapsed;\n\telse\n\t\tstalled = 0;\n\n\tif (stalled >= STALL_TIME)\n\t\tstrlcat(buf, \"- stalled -\", win_size);\n\telse if (bytes_per_second == 0 && bytes_left)\n\t\tstrlcat(buf, \"  --:-- ETA\", win_size);\n\telse {\n\t\tif (bytes_left > 0)\n\t\t\tseconds = bytes_left / bytes_per_second;\n\t\telse\n\t\t\tseconds = elapsed;\n\n\t\thours = seconds / 3600;\n\t\tseconds -= hours * 3600;\n\t\tminutes = seconds / 60;\n\t\tseconds -= minutes * 60;\n\n\t\tif (hours != 0)\n\t\t\tsnprintf(buf + strlen(buf), win_size - strlen(buf),\n\t\t\t    \"%d:%02d:%02d\", hours, minutes, seconds);\n\t\telse\n\t\t\tsnprintf(buf + strlen(buf), win_size - strlen(buf),\n\t\t\t    \"  %02d:%02d\", minutes, seconds);\n\n\t\tif (bytes_left > 0)\n\t\t\tstrlcat(buf, \" ETA\", win_size);\n\t\telse\n\t\t\tstrlcat(buf, \"    \", win_size);\n\t}\n\n\tatomicio(vwrite, STDOUT_FILENO, buf, win_size - 1);\n\tlast_update = now;\n}"
  },
  {
    "function_name": "format_size",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/progressmeter.c",
    "lines": "106-117",
    "snippet": "static void\nformat_size(char *buf, int size, off_t bytes)\n{\n\tint i;\n\n\tfor (i = 0; bytes >= 10000 && unit[i] != 'T'; i++)\n\t\tbytes = (bytes + 512) / 1024;\n\tsnprintf(buf, size, \"%4lld%c%s\",\n\t    (long long) bytes,\n\t    unit[i],\n\t    i ? \"B\" : \" \");\n}",
    "includes": [
      "#include \"misc.h\"",
      "#include \"atomicio.h\"",
      "#include \"progressmeter.h\"",
      "#include <unistd.h>",
      "#include <time.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <signal.h>",
      "#include <errno.h>",
      "#include <sys/uio.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "static void format_size(char *, int, off_t);",
      "static void format_rate(char *, int, off_t);",
      "static const char unit[] = \" KMGT\";"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "snprintf",
          "args": [
            "buf",
            "size",
            "\"%4lld%c%s\"",
            "(long long) bytes",
            "unit[i]",
            "i ? \"B\" : \" \""
          ],
          "line": 113
        },
        "resolved": true,
        "details": {
          "function_name": "snprintf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/openbsd-compat/bsd-snprintf.c",
          "lines": "869-879",
          "snippet": "int\nsnprintf(char *str, size_t count, SNPRINTF_CONST char *fmt, ...)\n{\n\tsize_t ret;\n\tva_list ap;\n\n\tva_start(ap, fmt);\n\tret = vsnprintf(str, count, fmt, ap);\n\tva_end(ap);\n\treturn ret;\n}",
          "includes": [
            "#include <errno.h>",
            "#include <limits.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdarg.h>",
            "#include <ctype.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <errno.h>\n#include <limits.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdarg.h>\n#include <ctype.h>\n#include \"includes.h\"\n\nint\nsnprintf(char *str, size_t count, SNPRINTF_CONST char *fmt, ...)\n{\n\tsize_t ret;\n\tva_list ap;\n\n\tva_start(ap, fmt);\n\tret = vsnprintf(str, count, fmt, ap);\n\tva_end(ap);\n\treturn ret;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"misc.h\"\n#include \"atomicio.h\"\n#include \"progressmeter.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdio.h>\n#include <signal.h>\n#include <errno.h>\n#include <sys/uio.h>\n#include <sys/ioctl.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nstatic void format_size(char *, int, off_t);\nstatic void format_rate(char *, int, off_t);\nstatic const char unit[] = \" KMGT\";\n\nstatic void\nformat_size(char *buf, int size, off_t bytes)\n{\n\tint i;\n\n\tfor (i = 0; bytes >= 10000 && unit[i] != 'T'; i++)\n\t\tbytes = (bytes + 512) / 1024;\n\tsnprintf(buf, size, \"%4lld%c%s\",\n\t    (long long) bytes,\n\t    unit[i],\n\t    i ? \"B\" : \" \");\n}"
  },
  {
    "function_name": "format_rate",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/progressmeter.c",
    "lines": "87-104",
    "snippet": "static void\nformat_rate(char *buf, int size, off_t bytes)\n{\n\tint i;\n\n\tbytes *= 100;\n\tfor (i = 0; bytes >= 100*1000 && unit[i] != 'T'; i++)\n\t\tbytes = (bytes + 512) / 1024;\n\tif (i == 0) {\n\t\ti++;\n\t\tbytes = (bytes + 512) / 1024;\n\t}\n\tsnprintf(buf, size, \"%3lld.%1lld%c%s\",\n\t    (long long) (bytes + 5) / 100,\n\t    (long long) (bytes + 5) / 10 % 10,\n\t    unit[i],\n\t    i ? \"B\" : \" \");\n}",
    "includes": [
      "#include \"misc.h\"",
      "#include \"atomicio.h\"",
      "#include \"progressmeter.h\"",
      "#include <unistd.h>",
      "#include <time.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <signal.h>",
      "#include <errno.h>",
      "#include <sys/uio.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "static void format_size(char *, int, off_t);",
      "static void format_rate(char *, int, off_t);",
      "static const char unit[] = \" KMGT\";"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "snprintf",
          "args": [
            "buf",
            "size",
            "\"%3lld.%1lld%c%s\"",
            "(long long) (bytes + 5) / 100",
            "(long long) (bytes + 5) / 10 % 10",
            "unit[i]",
            "i ? \"B\" : \" \""
          ],
          "line": 99
        },
        "resolved": true,
        "details": {
          "function_name": "snprintf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/openbsd-compat/bsd-snprintf.c",
          "lines": "869-879",
          "snippet": "int\nsnprintf(char *str, size_t count, SNPRINTF_CONST char *fmt, ...)\n{\n\tsize_t ret;\n\tva_list ap;\n\n\tva_start(ap, fmt);\n\tret = vsnprintf(str, count, fmt, ap);\n\tva_end(ap);\n\treturn ret;\n}",
          "includes": [
            "#include <errno.h>",
            "#include <limits.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdarg.h>",
            "#include <ctype.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <errno.h>\n#include <limits.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdarg.h>\n#include <ctype.h>\n#include \"includes.h\"\n\nint\nsnprintf(char *str, size_t count, SNPRINTF_CONST char *fmt, ...)\n{\n\tsize_t ret;\n\tva_list ap;\n\n\tva_start(ap, fmt);\n\tret = vsnprintf(str, count, fmt, ap);\n\tva_end(ap);\n\treturn ret;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"misc.h\"\n#include \"atomicio.h\"\n#include \"progressmeter.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdio.h>\n#include <signal.h>\n#include <errno.h>\n#include <sys/uio.h>\n#include <sys/ioctl.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nstatic void format_size(char *, int, off_t);\nstatic void format_rate(char *, int, off_t);\nstatic const char unit[] = \" KMGT\";\n\nstatic void\nformat_rate(char *buf, int size, off_t bytes)\n{\n\tint i;\n\n\tbytes *= 100;\n\tfor (i = 0; bytes >= 100*1000 && unit[i] != 'T'; i++)\n\t\tbytes = (bytes + 512) / 1024;\n\tif (i == 0) {\n\t\ti++;\n\t\tbytes = (bytes + 512) / 1024;\n\t}\n\tsnprintf(buf, size, \"%3lld.%1lld%c%s\",\n\t    (long long) (bytes + 5) / 100,\n\t    (long long) (bytes + 5) / 10 % 10,\n\t    unit[i],\n\t    i ? \"B\" : \" \");\n}"
  },
  {
    "function_name": "can_output",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/progressmeter.c",
    "lines": "81-85",
    "snippet": "static int\ncan_output(void)\n{\n\treturn (getpgrp() == tcgetpgrp(STDOUT_FILENO));\n}",
    "includes": [
      "#include \"misc.h\"",
      "#include \"atomicio.h\"",
      "#include \"progressmeter.h\"",
      "#include <unistd.h>",
      "#include <time.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <signal.h>",
      "#include <errno.h>",
      "#include <sys/uio.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "static int can_output(void);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "tcgetpgrp",
          "args": [
            "STDOUT_FILENO"
          ],
          "line": 84
        },
        "resolved": true,
        "details": {
          "function_name": "tcgetpgrp",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/openbsd-compat/bsd-misc.c",
          "lines": "182-191",
          "snippet": "pid_t\ntcgetpgrp(int fd)\n{\n\tint ctty_pgrp;\n\n\tif (ioctl(fd, TIOCGPGRP, &ctty_pgrp) == -1)\n\t\treturn(-1);\n\telse\n\t\treturn(ctty_pgrp);\n}",
          "includes": [
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <signal.h>",
            "#include <string.h>",
            "# include <sys/time.h>",
            "# include <sys/select.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <unistd.h>\n#include <time.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <signal.h>\n#include <string.h>\n# include <sys/time.h>\n# include <sys/select.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\npid_t\ntcgetpgrp(int fd)\n{\n\tint ctty_pgrp;\n\n\tif (ioctl(fd, TIOCGPGRP, &ctty_pgrp) == -1)\n\t\treturn(-1);\n\telse\n\t\treturn(ctty_pgrp);\n}"
        }
      },
      {
        "call_info": {
          "callee": "getpgrp",
          "args": [],
          "line": 84
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"misc.h\"\n#include \"atomicio.h\"\n#include \"progressmeter.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdio.h>\n#include <signal.h>\n#include <errno.h>\n#include <sys/uio.h>\n#include <sys/ioctl.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nstatic int can_output(void);\n\nstatic int\ncan_output(void)\n{\n\treturn (getpgrp() == tcgetpgrp(STDOUT_FILENO));\n}"
  }
]