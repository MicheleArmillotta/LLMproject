[
  {
    "function_name": "group_from_gid",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/openbsd-compat/pwcache.c",
    "lines": "82-113",
    "snippet": "char *\ngroup_from_gid(gid_t gid, int nogroup)\n{\n\tstatic struct ncache {\n\t\tgid_t\tgid;\n\t\tchar\t*name;\n\t} c_gid[NCACHE];\n\tstatic int gropen;\n\tstatic char nbuf[15];\t\t/* 32 bits == 10 digits */\n\tstruct group *gr;\n\tstruct ncache *cp;\n\n\tcp = c_gid + (gid & MASK);\n\tif (cp->gid != gid || cp->name == NULL) {\n\t\tif (gropen == 0) {\n#ifdef HAVE_SETGROUPENT\n\t\t\tsetgroupent(1);\n#endif\n\t\t\tgropen = 1;\n\t\t}\n\t\tif ((gr = getgrgid(gid)) == NULL) {\n\t\t\tif (nogroup)\n\t\t\t\treturn (NULL);\n\t\t\t(void)snprintf(nbuf, sizeof(nbuf), \"%u\", gid);\n\t\t}\n\t\tcp->gid = gid;\n\t\tif (cp->name != NULL)\n\t\t\tfree(cp->name);\n\t\tcp->name = strdup(gr ? gr->gr_name : nbuf);\n\t}\n\treturn (cp->name);\n}",
    "includes": [
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <pwd.h>",
      "#include <grp.h>",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [
      "#define\tMASK\t(NCACHE - 1)\t\t/* bits to store with */",
      "#define\tNCACHE\t64\t\t\t/* power of 2 */"
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "strdup",
          "args": [
            "gr ? gr->gr_name : nbuf"
          ],
          "line": 110
        },
        "resolved": true,
        "details": {
          "function_name": "strdup",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/openbsd-compat/bsd-misc.c",
          "lines": "216-227",
          "snippet": "char *\nstrdup(const char *str)\n{\n\tsize_t len;\n\tchar *cp;\n\n\tlen = strlen(str) + 1;\n\tcp = malloc(len);\n\tif (cp != NULL)\n\t\treturn(memcpy(cp, str, len));\n\treturn NULL;\n}",
          "includes": [
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <signal.h>",
            "#include <string.h>",
            "# include <sys/time.h>",
            "# include <sys/select.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <unistd.h>\n#include <time.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <signal.h>\n#include <string.h>\n# include <sys/time.h>\n# include <sys/select.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nchar *\nstrdup(const char *str)\n{\n\tsize_t len;\n\tchar *cp;\n\n\tlen = strlen(str) + 1;\n\tcp = malloc(len);\n\tif (cp != NULL)\n\t\treturn(memcpy(cp, str, len));\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "free",
          "args": [
            "cp->name"
          ],
          "line": 109
        },
        "resolved": true,
        "details": {
          "function_name": "freeaddrinfo",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/openbsd-compat/fake-rfc2553.c",
          "lines": "109-119",
          "snippet": "void\nfreeaddrinfo(struct addrinfo *ai)\n{\n\tstruct addrinfo *next;\n\n\tfor(; ai != NULL;) {\n\t\tnext = ai->ai_next;\n\t\tfree(ai);\n\t\tai = next;\n\t}\n}",
          "includes": [
            "#include <arpa/inet.h>",
            "#include <netinet/in.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <arpa/inet.h>\n#include <netinet/in.h>\n#include <string.h>\n#include <stdlib.h>\n#include \"includes.h\"\n\nvoid\nfreeaddrinfo(struct addrinfo *ai)\n{\n\tstruct addrinfo *next;\n\n\tfor(; ai != NULL;) {\n\t\tnext = ai->ai_next;\n\t\tfree(ai);\n\t\tai = next;\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "snprintf",
          "args": [
            "nbuf",
            "sizeof(nbuf)",
            "\"%u\"",
            "gid"
          ],
          "line": 105
        },
        "resolved": true,
        "details": {
          "function_name": "snprintf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/openbsd-compat/bsd-snprintf.c",
          "lines": "869-879",
          "snippet": "int\nsnprintf(char *str, size_t count, SNPRINTF_CONST char *fmt, ...)\n{\n\tsize_t ret;\n\tva_list ap;\n\n\tva_start(ap, fmt);\n\tret = vsnprintf(str, count, fmt, ap);\n\tva_end(ap);\n\treturn ret;\n}",
          "includes": [
            "#include <errno.h>",
            "#include <limits.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdarg.h>",
            "#include <ctype.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <errno.h>\n#include <limits.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdarg.h>\n#include <ctype.h>\n#include \"includes.h\"\n\nint\nsnprintf(char *str, size_t count, SNPRINTF_CONST char *fmt, ...)\n{\n\tsize_t ret;\n\tva_list ap;\n\n\tva_start(ap, fmt);\n\tret = vsnprintf(str, count, fmt, ap);\n\tva_end(ap);\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "getgrgid",
          "args": [
            "gid"
          ],
          "line": 102
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "setgroupent",
          "args": [
            "1"
          ],
          "line": 98
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <grp.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\n#define\tMASK\t(NCACHE - 1)\t\t/* bits to store with */\n#define\tNCACHE\t64\t\t\t/* power of 2 */\n\nchar *\ngroup_from_gid(gid_t gid, int nogroup)\n{\n\tstatic struct ncache {\n\t\tgid_t\tgid;\n\t\tchar\t*name;\n\t} c_gid[NCACHE];\n\tstatic int gropen;\n\tstatic char nbuf[15];\t\t/* 32 bits == 10 digits */\n\tstruct group *gr;\n\tstruct ncache *cp;\n\n\tcp = c_gid + (gid & MASK);\n\tif (cp->gid != gid || cp->name == NULL) {\n\t\tif (gropen == 0) {\n#ifdef HAVE_SETGROUPENT\n\t\t\tsetgroupent(1);\n#endif\n\t\t\tgropen = 1;\n\t\t}\n\t\tif ((gr = getgrgid(gid)) == NULL) {\n\t\t\tif (nogroup)\n\t\t\t\treturn (NULL);\n\t\t\t(void)snprintf(nbuf, sizeof(nbuf), \"%u\", gid);\n\t\t}\n\t\tcp->gid = gid;\n\t\tif (cp->name != NULL)\n\t\t\tfree(cp->name);\n\t\tcp->name = strdup(gr ? gr->gr_name : nbuf);\n\t}\n\treturn (cp->name);\n}"
  },
  {
    "function_name": "user_from_uid",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/openbsd-compat/pwcache.c",
    "lines": "47-78",
    "snippet": "char *\nuser_from_uid(uid_t uid, int nouser)\n{\n\tstatic struct ncache {\n\t\tuid_t\tuid;\n\t\tchar\t*name;\n\t} c_uid[NCACHE];\n\tstatic int pwopen;\n\tstatic char nbuf[15];\t\t/* 32 bits == 10 digits */\n\tstruct passwd *pw;\n\tstruct ncache *cp;\n\n\tcp = c_uid + (uid & MASK);\n\tif (cp->uid != uid || cp->name == NULL) {\n\t\tif (pwopen == 0) {\n#ifdef HAVE_SETPASSENT\n\t\t\tsetpassent(1);\n#endif\n\t\t\tpwopen = 1;\n\t\t}\n\t\tif ((pw = getpwuid(uid)) == NULL) {\n\t\t\tif (nouser)\n\t\t\t\treturn (NULL);\n\t\t\t(void)snprintf(nbuf, sizeof(nbuf), \"%u\", uid);\n\t\t}\n\t\tcp->uid = uid;\n\t\tif (cp->name != NULL)\n\t\t\tfree(cp->name);\n\t\tcp->name = strdup(pw ? pw->pw_name : nbuf);\n\t}\n\treturn (cp->name);\n}",
    "includes": [
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <pwd.h>",
      "#include <grp.h>",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [
      "#define\tMASK\t(NCACHE - 1)\t\t/* bits to store with */",
      "#define\tNCACHE\t64\t\t\t/* power of 2 */"
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "strdup",
          "args": [
            "pw ? pw->pw_name : nbuf"
          ],
          "line": 75
        },
        "resolved": true,
        "details": {
          "function_name": "strdup",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/openbsd-compat/bsd-misc.c",
          "lines": "216-227",
          "snippet": "char *\nstrdup(const char *str)\n{\n\tsize_t len;\n\tchar *cp;\n\n\tlen = strlen(str) + 1;\n\tcp = malloc(len);\n\tif (cp != NULL)\n\t\treturn(memcpy(cp, str, len));\n\treturn NULL;\n}",
          "includes": [
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <signal.h>",
            "#include <string.h>",
            "# include <sys/time.h>",
            "# include <sys/select.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <unistd.h>\n#include <time.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <signal.h>\n#include <string.h>\n# include <sys/time.h>\n# include <sys/select.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nchar *\nstrdup(const char *str)\n{\n\tsize_t len;\n\tchar *cp;\n\n\tlen = strlen(str) + 1;\n\tcp = malloc(len);\n\tif (cp != NULL)\n\t\treturn(memcpy(cp, str, len));\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "free",
          "args": [
            "cp->name"
          ],
          "line": 74
        },
        "resolved": true,
        "details": {
          "function_name": "freeaddrinfo",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/openbsd-compat/fake-rfc2553.c",
          "lines": "109-119",
          "snippet": "void\nfreeaddrinfo(struct addrinfo *ai)\n{\n\tstruct addrinfo *next;\n\n\tfor(; ai != NULL;) {\n\t\tnext = ai->ai_next;\n\t\tfree(ai);\n\t\tai = next;\n\t}\n}",
          "includes": [
            "#include <arpa/inet.h>",
            "#include <netinet/in.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <arpa/inet.h>\n#include <netinet/in.h>\n#include <string.h>\n#include <stdlib.h>\n#include \"includes.h\"\n\nvoid\nfreeaddrinfo(struct addrinfo *ai)\n{\n\tstruct addrinfo *next;\n\n\tfor(; ai != NULL;) {\n\t\tnext = ai->ai_next;\n\t\tfree(ai);\n\t\tai = next;\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "snprintf",
          "args": [
            "nbuf",
            "sizeof(nbuf)",
            "\"%u\"",
            "uid"
          ],
          "line": 70
        },
        "resolved": true,
        "details": {
          "function_name": "snprintf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/openbsd-compat/bsd-snprintf.c",
          "lines": "869-879",
          "snippet": "int\nsnprintf(char *str, size_t count, SNPRINTF_CONST char *fmt, ...)\n{\n\tsize_t ret;\n\tva_list ap;\n\n\tva_start(ap, fmt);\n\tret = vsnprintf(str, count, fmt, ap);\n\tva_end(ap);\n\treturn ret;\n}",
          "includes": [
            "#include <errno.h>",
            "#include <limits.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdarg.h>",
            "#include <ctype.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <errno.h>\n#include <limits.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdarg.h>\n#include <ctype.h>\n#include \"includes.h\"\n\nint\nsnprintf(char *str, size_t count, SNPRINTF_CONST char *fmt, ...)\n{\n\tsize_t ret;\n\tva_list ap;\n\n\tva_start(ap, fmt);\n\tret = vsnprintf(str, count, fmt, ap);\n\tva_end(ap);\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "getpwuid",
          "args": [
            "uid"
          ],
          "line": 67
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "setpassent",
          "args": [
            "1"
          ],
          "line": 63
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <grp.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\n#define\tMASK\t(NCACHE - 1)\t\t/* bits to store with */\n#define\tNCACHE\t64\t\t\t/* power of 2 */\n\nchar *\nuser_from_uid(uid_t uid, int nouser)\n{\n\tstatic struct ncache {\n\t\tuid_t\tuid;\n\t\tchar\t*name;\n\t} c_uid[NCACHE];\n\tstatic int pwopen;\n\tstatic char nbuf[15];\t\t/* 32 bits == 10 digits */\n\tstruct passwd *pw;\n\tstruct ncache *cp;\n\n\tcp = c_uid + (uid & MASK);\n\tif (cp->uid != uid || cp->name == NULL) {\n\t\tif (pwopen == 0) {\n#ifdef HAVE_SETPASSENT\n\t\t\tsetpassent(1);\n#endif\n\t\t\tpwopen = 1;\n\t\t}\n\t\tif ((pw = getpwuid(uid)) == NULL) {\n\t\t\tif (nouser)\n\t\t\t\treturn (NULL);\n\t\t\t(void)snprintf(nbuf, sizeof(nbuf), \"%u\", uid);\n\t\t}\n\t\tcp->uid = uid;\n\t\tif (cp->name != NULL)\n\t\t\tfree(cp->name);\n\t\tcp->name = strdup(pw ? pw->pw_name : nbuf);\n\t}\n\treturn (cp->name);\n}"
  }
]