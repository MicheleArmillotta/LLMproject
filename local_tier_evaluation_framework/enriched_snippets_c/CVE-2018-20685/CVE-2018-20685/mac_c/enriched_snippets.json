[
  {
    "function_name": "mac_valid",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/mac.c",
    "lines": "247-265",
    "snippet": "int\nmac_valid(const char *names)\n{\n\tchar *maclist, *cp, *p;\n\n\tif (names == NULL || strcmp(names, \"\") == 0)\n\t\treturn 0;\n\tif ((maclist = cp = strdup(names)) == NULL)\n\t\treturn 0;\n\tfor ((p = strsep(&cp, MAC_SEP)); p && *p != '\\0';\n\t    (p = strsep(&cp, MAC_SEP))) {\n\t\tif (mac_setup(NULL, p) < 0) {\n\t\t\tfree(maclist);\n\t\t\treturn 0;\n\t\t}\n\t}\n\tfree(maclist);\n\treturn 1;\n}",
    "includes": [
      "#include \"openbsd-compat/openssl-compat.h\"",
      "#include \"sshbuf.h\"",
      "#include \"ssherr.h\"",
      "#include \"misc.h\"",
      "#include \"mac.h\"",
      "#include \"umac.h\"",
      "#include \"hmac.h\"",
      "#include \"digest.h\"",
      "#include <stdio.h>",
      "#include <string.h>",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [
      "#define\tMAC_SEP\t\",\""
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "maclist"
          ],
          "line": 263
        },
        "resolved": true,
        "details": {
          "function_name": "freeze",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/smult_curve25519_ref.c",
          "lines": "50-60",
          "snippet": "static void freeze(unsigned int a[32])\n{\n  unsigned int aorig[32];\n  unsigned int j;\n  unsigned int negative;\n\n  for (j = 0;j < 32;++j) aorig[j] = a[j];\n  add(a,a,minusp);\n  negative = -((a[31] >> 7) & 1);\n  for (j = 0;j < 32;++j) a[j] ^= negative & (aorig[j] ^ a[j]);\n}",
          "includes": [],
          "macros_used": [],
          "globals_used": [
            "static const unsigned int minusp[32] = {\n 19, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 128\n} ;"
          ],
          "called_functions": [],
          "contextual_snippet": "static const unsigned int minusp[32] = {\n 19, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 128\n} ;\n\nstatic void freeze(unsigned int a[32])\n{\n  unsigned int aorig[32];\n  unsigned int j;\n  unsigned int negative;\n\n  for (j = 0;j < 32;++j) aorig[j] = a[j];\n  add(a,a,minusp);\n  negative = -((a[31] >> 7) & 1);\n  for (j = 0;j < 32;++j) a[j] ^= negative & (aorig[j] ^ a[j]);\n}"
        }
      },
      {
        "call_info": {
          "callee": "mac_setup",
          "args": [
            "NULL",
            "p"
          ],
          "line": 258
        },
        "resolved": true,
        "details": {
          "function_name": "mac_setup",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/mac.c",
          "lines": "127-140",
          "snippet": "int\nmac_setup(struct sshmac *mac, char *name)\n{\n\tconst struct macalg *m;\n\n\tfor (m = macs; m->name != NULL; m++) {\n\t\tif (strcmp(name, m->name) != 0)\n\t\t\tcontinue;\n\t\tif (mac != NULL)\n\t\t\treturn mac_setup_by_alg(mac, m);\n\t\treturn 0;\n\t}\n\treturn SSH_ERR_INVALID_ARGUMENT;\n}",
          "includes": [
            "#include \"openbsd-compat/openssl-compat.h\"",
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include \"misc.h\"",
            "#include \"mac.h\"",
            "#include \"umac.h\"",
            "#include \"hmac.h\"",
            "#include \"digest.h\"",
            "#include <stdio.h>",
            "#include <string.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static const struct macalg macs[] = {\n\t/* Encrypt-and-MAC (encrypt-and-authenticate) variants */\n\t{ \"hmac-sha1\",\t\t\t\tSSH_DIGEST, SSH_DIGEST_SHA1, 0, 0, 0, 0 },\n\t{ \"hmac-sha1-96\",\t\t\tSSH_DIGEST, SSH_DIGEST_SHA1, 96, 0, 0, 0 },\n#ifdef HAVE_EVP_SHA256\n\t{ \"hmac-sha2-256\",\t\t\tSSH_DIGEST, SSH_DIGEST_SHA256, 0, 0, 0, 0 },\n\t{ \"hmac-sha2-512\",\t\t\tSSH_DIGEST, SSH_DIGEST_SHA512, 0, 0, 0, 0 },\n#endif\n\t{ \"hmac-md5\",\t\t\t\tSSH_DIGEST, SSH_DIGEST_MD5, 0, 0, 0, 0 },\n\t{ \"hmac-md5-96\",\t\t\tSSH_DIGEST, SSH_DIGEST_MD5, 96, 0, 0, 0 },\n\t{ \"umac-64@openssh.com\",\t\tSSH_UMAC, 0, 0, 128, 64, 0 },\n\t{ \"umac-128@openssh.com\",\t\tSSH_UMAC128, 0, 0, 128, 128, 0 },\n\n\t/* Encrypt-then-MAC variants */\n\t{ \"hmac-sha1-etm@openssh.com\",\t\tSSH_DIGEST, SSH_DIGEST_SHA1, 0, 0, 0, 1 },\n\t{ \"hmac-sha1-96-etm@openssh.com\",\tSSH_DIGEST, SSH_DIGEST_SHA1, 96, 0, 0, 1 },\n#ifdef HAVE_EVP_SHA256\n\t{ \"hmac-sha2-256-etm@openssh.com\",\tSSH_DIGEST, SSH_DIGEST_SHA256, 0, 0, 0, 1 },\n\t{ \"hmac-sha2-512-etm@openssh.com\",\tSSH_DIGEST, SSH_DIGEST_SHA512, 0, 0, 0, 1 },\n#endif\n\t{ \"hmac-md5-etm@openssh.com\",\t\tSSH_DIGEST, SSH_DIGEST_MD5, 0, 0, 0, 1 },\n\t{ \"hmac-md5-96-etm@openssh.com\",\tSSH_DIGEST, SSH_DIGEST_MD5, 96, 0, 0, 1 },\n\t{ \"umac-64-etm@openssh.com\",\t\tSSH_UMAC, 0, 0, 128, 64, 1 },\n\t{ \"umac-128-etm@openssh.com\",\t\tSSH_UMAC128, 0, 0, 128, 128, 1 },\n\n\t{ NULL,\t\t\t\t\t0, 0, 0, 0, 0, 0 }\n};"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"openbsd-compat/openssl-compat.h\"\n#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"misc.h\"\n#include \"mac.h\"\n#include \"umac.h\"\n#include \"hmac.h\"\n#include \"digest.h\"\n#include <stdio.h>\n#include <string.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nstatic const struct macalg macs[] = {\n\t/* Encrypt-and-MAC (encrypt-and-authenticate) variants */\n\t{ \"hmac-sha1\",\t\t\t\tSSH_DIGEST, SSH_DIGEST_SHA1, 0, 0, 0, 0 },\n\t{ \"hmac-sha1-96\",\t\t\tSSH_DIGEST, SSH_DIGEST_SHA1, 96, 0, 0, 0 },\n#ifdef HAVE_EVP_SHA256\n\t{ \"hmac-sha2-256\",\t\t\tSSH_DIGEST, SSH_DIGEST_SHA256, 0, 0, 0, 0 },\n\t{ \"hmac-sha2-512\",\t\t\tSSH_DIGEST, SSH_DIGEST_SHA512, 0, 0, 0, 0 },\n#endif\n\t{ \"hmac-md5\",\t\t\t\tSSH_DIGEST, SSH_DIGEST_MD5, 0, 0, 0, 0 },\n\t{ \"hmac-md5-96\",\t\t\tSSH_DIGEST, SSH_DIGEST_MD5, 96, 0, 0, 0 },\n\t{ \"umac-64@openssh.com\",\t\tSSH_UMAC, 0, 0, 128, 64, 0 },\n\t{ \"umac-128@openssh.com\",\t\tSSH_UMAC128, 0, 0, 128, 128, 0 },\n\n\t/* Encrypt-then-MAC variants */\n\t{ \"hmac-sha1-etm@openssh.com\",\t\tSSH_DIGEST, SSH_DIGEST_SHA1, 0, 0, 0, 1 },\n\t{ \"hmac-sha1-96-etm@openssh.com\",\tSSH_DIGEST, SSH_DIGEST_SHA1, 96, 0, 0, 1 },\n#ifdef HAVE_EVP_SHA256\n\t{ \"hmac-sha2-256-etm@openssh.com\",\tSSH_DIGEST, SSH_DIGEST_SHA256, 0, 0, 0, 1 },\n\t{ \"hmac-sha2-512-etm@openssh.com\",\tSSH_DIGEST, SSH_DIGEST_SHA512, 0, 0, 0, 1 },\n#endif\n\t{ \"hmac-md5-etm@openssh.com\",\t\tSSH_DIGEST, SSH_DIGEST_MD5, 0, 0, 0, 1 },\n\t{ \"hmac-md5-96-etm@openssh.com\",\tSSH_DIGEST, SSH_DIGEST_MD5, 96, 0, 0, 1 },\n\t{ \"umac-64-etm@openssh.com\",\t\tSSH_UMAC, 0, 0, 128, 64, 1 },\n\t{ \"umac-128-etm@openssh.com\",\t\tSSH_UMAC128, 0, 0, 128, 128, 1 },\n\n\t{ NULL,\t\t\t\t\t0, 0, 0, 0, 0, 0 }\n};\n\nint\nmac_setup(struct sshmac *mac, char *name)\n{\n\tconst struct macalg *m;\n\n\tfor (m = macs; m->name != NULL; m++) {\n\t\tif (strcmp(name, m->name) != 0)\n\t\t\tcontinue;\n\t\tif (mac != NULL)\n\t\t\treturn mac_setup_by_alg(mac, m);\n\t\treturn 0;\n\t}\n\treturn SSH_ERR_INVALID_ARGUMENT;\n}"
        }
      },
      {
        "call_info": {
          "callee": "strsep",
          "args": [
            "&cp",
            "MAC_SEP"
          ],
          "line": 257
        },
        "resolved": true,
        "details": {
          "function_name": "xstrsep",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/ssh-keyscan.c",
          "lines": "162-178",
          "snippet": "static char *\nxstrsep(char **str, const char *delim)\n{\n\tchar *s, *e;\n\n\tif (!**str)\n\t\treturn (NULL);\n\n\ts = *str;\n\te = s + strcspn(s, delim);\n\n\tif (*e != '\\0')\n\t\t*e++ = '\\0';\n\t*str = e;\n\n\treturn (s);\n}",
          "includes": [
            "#include \"dns.h\"",
            "#include \"ssh_api.h\"",
            "#include \"ssherr.h\"",
            "#include \"hostfile.h\"",
            "#include \"misc.h\"",
            "#include \"atomicio.h\"",
            "#include \"log.h\"",
            "#include \"dispatch.h\"",
            "#include \"packet.h\"",
            "#include \"myproposal.h\"",
            "#include \"compat.h\"",
            "#include \"kex.h\"",
            "#include \"cipher.h\"",
            "#include \"sshkey.h\"",
            "#include \"sshbuf.h\"",
            "#include \"ssh.h\"",
            "#include \"xmalloc.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <signal.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <errno.h>",
            "#include <netdb.h>",
            "#include <openssl/bn.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/resource.h>",
            "#include \"openbsd-compat/sys-queue.h\"",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"dns.h\"\n#include \"ssh_api.h\"\n#include \"ssherr.h\"\n#include \"hostfile.h\"\n#include \"misc.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"dispatch.h\"\n#include \"packet.h\"\n#include \"myproposal.h\"\n#include \"compat.h\"\n#include \"kex.h\"\n#include \"cipher.h\"\n#include \"sshkey.h\"\n#include \"sshbuf.h\"\n#include \"ssh.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <string.h>\n#include <signal.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <errno.h>\n#include <netdb.h>\n#include <openssl/bn.h>\n#include <arpa/inet.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/resource.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nstatic char *\nxstrsep(char **str, const char *delim)\n{\n\tchar *s, *e;\n\n\tif (!**str)\n\t\treturn (NULL);\n\n\ts = *str;\n\te = s + strcspn(s, delim);\n\n\tif (*e != '\\0')\n\t\t*e++ = '\\0';\n\t*str = e;\n\n\treturn (s);\n}"
        }
      },
      {
        "call_info": {
          "callee": "strdup",
          "args": [
            "names"
          ],
          "line": 254
        },
        "resolved": true,
        "details": {
          "function_name": "xstrdup",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/xmalloc.c",
          "lines": "92-102",
          "snippet": "char *\nxstrdup(const char *str)\n{\n\tsize_t len;\n\tchar *cp;\n\n\tlen = strlen(str) + 1;\n\tcp = xmalloc(len);\n\tstrlcpy(cp, str, len);\n\treturn cp;\n}",
          "includes": [
            "#include \"log.h\"",
            "#include \"xmalloc.h\"",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdint.h>",
            "#include <stdarg.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n#include \"xmalloc.h\"\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdint.h>\n#include <stdarg.h>\n#include \"includes.h\"\n\nchar *\nxstrdup(const char *str)\n{\n\tsize_t len;\n\tchar *cp;\n\n\tlen = strlen(str) + 1;\n\tcp = xmalloc(len);\n\tstrlcpy(cp, str, len);\n\treturn cp;\n}"
        }
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "names",
            "\"\""
          ],
          "line": 252
        },
        "resolved": true,
        "details": {
          "function_name": "strcmp_maybe_null",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/misc.c",
          "lines": "1550-1558",
          "snippet": "static int\nstrcmp_maybe_null(const char *a, const char *b)\n{\n\tif ((a == NULL && b != NULL) || (a != NULL && b == NULL))\n\t\treturn 0;\n\tif (a != NULL && strcmp(a, b) != 0)\n\t\treturn 0;\n\treturn 1;\n}",
          "includes": [
            "#include \"platform.h\"",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"ssh.h\"",
            "#include \"log.h\"",
            "#include \"misc.h\"",
            "#include \"xmalloc.h\"",
            "#include <net/if.h>",
            "#include <pwd.h>",
            "# include <paths.h>",
            "#include <netdb.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <ctype.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/tcp.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in_systm.h>",
            "#include <netinet/in.h>",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <libgen.h>",
            "#include <limits.h>",
            "#include <sys/un.h>",
            "#include <sys/wait.h>",
            "#include <sys/time.h>",
            "#include <sys/stat.h>",
            "#include <sys/socket.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"platform.h\"\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"ssh.h\"\n#include \"log.h\"\n#include \"misc.h\"\n#include \"xmalloc.h\"\n#include <net/if.h>\n#include <pwd.h>\n# include <paths.h>\n#include <netdb.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <ctype.h>\n#include <arpa/inet.h>\n#include <netinet/tcp.h>\n#include <netinet/ip.h>\n#include <netinet/in_systm.h>\n#include <netinet/in.h>\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <libgen.h>\n#include <limits.h>\n#include <sys/un.h>\n#include <sys/wait.h>\n#include <sys/time.h>\n#include <sys/stat.h>\n#include <sys/socket.h>\n#include <sys/ioctl.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nstatic int\nstrcmp_maybe_null(const char *a, const char *b)\n{\n\tif ((a == NULL && b != NULL) || (a != NULL && b == NULL))\n\t\treturn 0;\n\tif (a != NULL && strcmp(a, b) != 0)\n\t\treturn 0;\n\treturn 1;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"openbsd-compat/openssl-compat.h\"\n#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"misc.h\"\n#include \"mac.h\"\n#include \"umac.h\"\n#include \"hmac.h\"\n#include \"digest.h\"\n#include <stdio.h>\n#include <string.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\n#define\tMAC_SEP\t\",\"\n\nint\nmac_valid(const char *names)\n{\n\tchar *maclist, *cp, *p;\n\n\tif (names == NULL || strcmp(names, \"\") == 0)\n\t\treturn 0;\n\tif ((maclist = cp = strdup(names)) == NULL)\n\t\treturn 0;\n\tfor ((p = strsep(&cp, MAC_SEP)); p && *p != '\\0';\n\t    (p = strsep(&cp, MAC_SEP))) {\n\t\tif (mac_setup(NULL, p) < 0) {\n\t\t\tfree(maclist);\n\t\t\treturn 0;\n\t\t}\n\t}\n\tfree(maclist);\n\treturn 1;\n}"
  },
  {
    "function_name": "mac_clear",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/mac.c",
    "lines": "230-243",
    "snippet": "void\nmac_clear(struct sshmac *mac)\n{\n\tif (mac->type == SSH_UMAC) {\n\t\tif (mac->umac_ctx != NULL)\n\t\t\tumac_delete(mac->umac_ctx);\n\t} else if (mac->type == SSH_UMAC128) {\n\t\tif (mac->umac_ctx != NULL)\n\t\t\tumac128_delete(mac->umac_ctx);\n\t} else if (mac->hmac_ctx != NULL)\n\t\tssh_hmac_free(mac->hmac_ctx);\n\tmac->hmac_ctx = NULL;\n\tmac->umac_ctx = NULL;\n}",
    "includes": [
      "#include \"openbsd-compat/openssl-compat.h\"",
      "#include \"sshbuf.h\"",
      "#include \"ssherr.h\"",
      "#include \"misc.h\"",
      "#include \"mac.h\"",
      "#include \"umac.h\"",
      "#include \"hmac.h\"",
      "#include \"digest.h\"",
      "#include <stdio.h>",
      "#include <string.h>",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [
      "#define SSH_UMAC128\t3",
      "#define SSH_UMAC\t2\t/* UMAC (not integrated with OpenSSL) */"
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "ssh_hmac_free",
          "args": [
            "mac->hmac_ctx"
          ],
          "line": 240
        },
        "resolved": true,
        "details": {
          "function_name": "ssh_hmac_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/hmac.c",
          "lines": "121-135",
          "snippet": "void\nssh_hmac_free(struct ssh_hmac_ctx *ctx)\n{\n\tif (ctx != NULL) {\n\t\tssh_digest_free(ctx->ictx);\n\t\tssh_digest_free(ctx->octx);\n\t\tssh_digest_free(ctx->digest);\n\t\tif (ctx->buf) {\n\t\t\texplicit_bzero(ctx->buf, ctx->buf_len);\n\t\t\tfree(ctx->buf);\n\t\t}\n\t\texplicit_bzero(ctx, sizeof(*ctx));\n\t\tfree(ctx);\n\t}\n}",
          "includes": [
            "#include \"hmac.h\"",
            "#include \"digest.h\"",
            "#include \"sshbuf.h\"",
            "#include <string.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"hmac.h\"\n#include \"digest.h\"\n#include \"sshbuf.h\"\n#include <string.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\nssh_hmac_free(struct ssh_hmac_ctx *ctx)\n{\n\tif (ctx != NULL) {\n\t\tssh_digest_free(ctx->ictx);\n\t\tssh_digest_free(ctx->octx);\n\t\tssh_digest_free(ctx->digest);\n\t\tif (ctx->buf) {\n\t\t\texplicit_bzero(ctx->buf, ctx->buf_len);\n\t\t\tfree(ctx->buf);\n\t\t}\n\t\texplicit_bzero(ctx, sizeof(*ctx));\n\t\tfree(ctx);\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "umac128_delete",
          "args": [
            "mac->umac_ctx"
          ],
          "line": 238
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "umac_delete",
          "args": [
            "mac->umac_ctx"
          ],
          "line": 235
        },
        "resolved": true,
        "details": {
          "function_name": "umac_delete",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/umac.c",
          "lines": "1201-1211",
          "snippet": "int umac_delete(struct umac_ctx *ctx)\n/* Deallocate the ctx structure */\n{\n    if (ctx) {\n        if (ALLOC_BOUNDARY)\n            ctx = (struct umac_ctx *)ctx->free_ptr;\n        explicit_bzero(ctx, sizeof(*ctx) + ALLOC_BOUNDARY);\n        free(ctx);\n    }\n    return (1);\n}",
          "includes": [
            "#include \"rijndael.h\"",
            "# include <openssl/aes.h>",
            "#include \"openbsd-compat/openssl-compat.h\"",
            "#include \"misc.h\"",
            "#include \"umac.h\"",
            "#include \"xmalloc.h\"",
            "#include <stddef.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <string.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [
            "#define ALLOC_BOUNDARY       16     /* Keep buffers aligned to this       */"
          ],
          "globals_used": [
            "struct umac_ctx {\n    uhash_ctx hash;          /* Hash function for message compression    */\n    pdf_ctx pdf;             /* PDF for hashed output                    */\n    void *free_ptr;          /* Address to free this struct via          */\n} umac_ctx;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"rijndael.h\"\n# include <openssl/aes.h>\n#include \"openbsd-compat/openssl-compat.h\"\n#include \"misc.h\"\n#include \"umac.h\"\n#include \"xmalloc.h\"\n#include <stddef.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <string.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\n#define ALLOC_BOUNDARY       16     /* Keep buffers aligned to this       */\n\nstruct umac_ctx {\n    uhash_ctx hash;          /* Hash function for message compression    */\n    pdf_ctx pdf;             /* PDF for hashed output                    */\n    void *free_ptr;          /* Address to free this struct via          */\n} umac_ctx;\n\nint umac_delete(struct umac_ctx *ctx)\n/* Deallocate the ctx structure */\n{\n    if (ctx) {\n        if (ALLOC_BOUNDARY)\n            ctx = (struct umac_ctx *)ctx->free_ptr;\n        explicit_bzero(ctx, sizeof(*ctx) + ALLOC_BOUNDARY);\n        free(ctx);\n    }\n    return (1);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"openbsd-compat/openssl-compat.h\"\n#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"misc.h\"\n#include \"mac.h\"\n#include \"umac.h\"\n#include \"hmac.h\"\n#include \"digest.h\"\n#include <stdio.h>\n#include <string.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\n#define SSH_UMAC128\t3\n#define SSH_UMAC\t2\t/* UMAC (not integrated with OpenSSL) */\n\nvoid\nmac_clear(struct sshmac *mac)\n{\n\tif (mac->type == SSH_UMAC) {\n\t\tif (mac->umac_ctx != NULL)\n\t\t\tumac_delete(mac->umac_ctx);\n\t} else if (mac->type == SSH_UMAC128) {\n\t\tif (mac->umac_ctx != NULL)\n\t\t\tumac128_delete(mac->umac_ctx);\n\t} else if (mac->hmac_ctx != NULL)\n\t\tssh_hmac_free(mac->hmac_ctx);\n\tmac->hmac_ctx = NULL;\n\tmac->umac_ctx = NULL;\n}"
  },
  {
    "function_name": "mac_check",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/mac.c",
    "lines": "212-228",
    "snippet": "int\nmac_check(struct sshmac *mac, u_int32_t seqno,\n    const u_char *data, size_t dlen,\n    const u_char *theirmac, size_t mlen)\n{\n\tu_char ourmac[SSH_DIGEST_MAX_LENGTH];\n\tint r;\n\n\tif (mac->mac_len > mlen)\n\t\treturn SSH_ERR_INVALID_ARGUMENT;\n\tif ((r = mac_compute(mac, seqno, data, dlen,\n\t    ourmac, sizeof(ourmac))) != 0)\n\t\treturn r;\n\tif (timingsafe_bcmp(ourmac, theirmac, mac->mac_len) != 0)\n\t\treturn SSH_ERR_MAC_INVALID;\n\treturn 0;\n}",
    "includes": [
      "#include \"openbsd-compat/openssl-compat.h\"",
      "#include \"sshbuf.h\"",
      "#include \"ssherr.h\"",
      "#include \"misc.h\"",
      "#include \"mac.h\"",
      "#include \"umac.h\"",
      "#include \"hmac.h\"",
      "#include \"digest.h\"",
      "#include <stdio.h>",
      "#include <string.h>",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "timingsafe_bcmp",
          "args": [
            "ourmac",
            "theirmac",
            "mac->mac_len"
          ],
          "line": 225
        },
        "resolved": true,
        "details": {
          "function_name": "timingsafe_bcmp",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/openbsd-compat/timingsafe_bcmp.c",
          "lines": "23-32",
          "snippet": "int\ntimingsafe_bcmp(const void *b1, const void *b2, size_t n)\n{\n\tconst unsigned char *p1 = b1, *p2 = b2;\n\tint ret = 0;\n\n\tfor (; n > 0; n--)\n\t\tret |= *p1++ ^ *p2++;\n\treturn (ret != 0);\n}",
          "includes": [
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"includes.h\"\n\nint\ntimingsafe_bcmp(const void *b1, const void *b2, size_t n)\n{\n\tconst unsigned char *p1 = b1, *p2 = b2;\n\tint ret = 0;\n\n\tfor (; n > 0; n--)\n\t\tret |= *p1++ ^ *p2++;\n\treturn (ret != 0);\n}"
        }
      },
      {
        "call_info": {
          "callee": "mac_compute",
          "args": [
            "mac",
            "seqno",
            "data",
            "dlen",
            "ourmac",
            "sizeof(ourmac)"
          ],
          "line": 222
        },
        "resolved": true,
        "details": {
          "function_name": "mac_compute",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/mac.c",
          "lines": "166-210",
          "snippet": "int\nmac_compute(struct sshmac *mac, u_int32_t seqno,\n    const u_char *data, int datalen,\n    u_char *digest, size_t dlen)\n{\n\tstatic union {\n\t\tu_char m[SSH_DIGEST_MAX_LENGTH];\n\t\tu_int64_t for_align;\n\t} u;\n\tu_char b[4];\n\tu_char nonce[8];\n\n\tif (mac->mac_len > sizeof(u))\n\t\treturn SSH_ERR_INTERNAL_ERROR;\n\n\tswitch (mac->type) {\n\tcase SSH_DIGEST:\n\t\tput_u32(b, seqno);\n\t\t/* reset HMAC context */\n\t\tif (ssh_hmac_init(mac->hmac_ctx, NULL, 0) < 0 ||\n\t\t    ssh_hmac_update(mac->hmac_ctx, b, sizeof(b)) < 0 ||\n\t\t    ssh_hmac_update(mac->hmac_ctx, data, datalen) < 0 ||\n\t\t    ssh_hmac_final(mac->hmac_ctx, u.m, sizeof(u.m)) < 0)\n\t\t\treturn SSH_ERR_LIBCRYPTO_ERROR;\n\t\tbreak;\n\tcase SSH_UMAC:\n\t\tPOKE_U64(nonce, seqno);\n\t\tumac_update(mac->umac_ctx, data, datalen);\n\t\tumac_final(mac->umac_ctx, u.m, nonce);\n\t\tbreak;\n\tcase SSH_UMAC128:\n\t\tput_u64(nonce, seqno);\n\t\tumac128_update(mac->umac_ctx, data, datalen);\n\t\tumac128_final(mac->umac_ctx, u.m, nonce);\n\t\tbreak;\n\tdefault:\n\t\treturn SSH_ERR_INVALID_ARGUMENT;\n\t}\n\tif (digest != NULL) {\n\t\tif (dlen > mac->mac_len)\n\t\t\tdlen = mac->mac_len;\n\t\tmemcpy(digest, u.m, dlen);\n\t}\n\treturn 0;\n}",
          "includes": [
            "#include \"openbsd-compat/openssl-compat.h\"",
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include \"misc.h\"",
            "#include \"mac.h\"",
            "#include \"umac.h\"",
            "#include \"hmac.h\"",
            "#include \"digest.h\"",
            "#include <stdio.h>",
            "#include <string.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [
            "#define SSH_UMAC128\t3",
            "#define SSH_UMAC\t2\t/* UMAC (not integrated with OpenSSL) */",
            "#define SSH_DIGEST\t1\t/* SSH_DIGEST_XXX */"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"openbsd-compat/openssl-compat.h\"\n#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"misc.h\"\n#include \"mac.h\"\n#include \"umac.h\"\n#include \"hmac.h\"\n#include \"digest.h\"\n#include <stdio.h>\n#include <string.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\n#define SSH_UMAC128\t3\n#define SSH_UMAC\t2\t/* UMAC (not integrated with OpenSSL) */\n#define SSH_DIGEST\t1\t/* SSH_DIGEST_XXX */\n\nint\nmac_compute(struct sshmac *mac, u_int32_t seqno,\n    const u_char *data, int datalen,\n    u_char *digest, size_t dlen)\n{\n\tstatic union {\n\t\tu_char m[SSH_DIGEST_MAX_LENGTH];\n\t\tu_int64_t for_align;\n\t} u;\n\tu_char b[4];\n\tu_char nonce[8];\n\n\tif (mac->mac_len > sizeof(u))\n\t\treturn SSH_ERR_INTERNAL_ERROR;\n\n\tswitch (mac->type) {\n\tcase SSH_DIGEST:\n\t\tput_u32(b, seqno);\n\t\t/* reset HMAC context */\n\t\tif (ssh_hmac_init(mac->hmac_ctx, NULL, 0) < 0 ||\n\t\t    ssh_hmac_update(mac->hmac_ctx, b, sizeof(b)) < 0 ||\n\t\t    ssh_hmac_update(mac->hmac_ctx, data, datalen) < 0 ||\n\t\t    ssh_hmac_final(mac->hmac_ctx, u.m, sizeof(u.m)) < 0)\n\t\t\treturn SSH_ERR_LIBCRYPTO_ERROR;\n\t\tbreak;\n\tcase SSH_UMAC:\n\t\tPOKE_U64(nonce, seqno);\n\t\tumac_update(mac->umac_ctx, data, datalen);\n\t\tumac_final(mac->umac_ctx, u.m, nonce);\n\t\tbreak;\n\tcase SSH_UMAC128:\n\t\tput_u64(nonce, seqno);\n\t\tumac128_update(mac->umac_ctx, data, datalen);\n\t\tumac128_final(mac->umac_ctx, u.m, nonce);\n\t\tbreak;\n\tdefault:\n\t\treturn SSH_ERR_INVALID_ARGUMENT;\n\t}\n\tif (digest != NULL) {\n\t\tif (dlen > mac->mac_len)\n\t\t\tdlen = mac->mac_len;\n\t\tmemcpy(digest, u.m, dlen);\n\t}\n\treturn 0;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"openbsd-compat/openssl-compat.h\"\n#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"misc.h\"\n#include \"mac.h\"\n#include \"umac.h\"\n#include \"hmac.h\"\n#include \"digest.h\"\n#include <stdio.h>\n#include <string.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nmac_check(struct sshmac *mac, u_int32_t seqno,\n    const u_char *data, size_t dlen,\n    const u_char *theirmac, size_t mlen)\n{\n\tu_char ourmac[SSH_DIGEST_MAX_LENGTH];\n\tint r;\n\n\tif (mac->mac_len > mlen)\n\t\treturn SSH_ERR_INVALID_ARGUMENT;\n\tif ((r = mac_compute(mac, seqno, data, dlen,\n\t    ourmac, sizeof(ourmac))) != 0)\n\t\treturn r;\n\tif (timingsafe_bcmp(ourmac, theirmac, mac->mac_len) != 0)\n\t\treturn SSH_ERR_MAC_INVALID;\n\treturn 0;\n}"
  },
  {
    "function_name": "mac_compute",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/mac.c",
    "lines": "166-210",
    "snippet": "int\nmac_compute(struct sshmac *mac, u_int32_t seqno,\n    const u_char *data, int datalen,\n    u_char *digest, size_t dlen)\n{\n\tstatic union {\n\t\tu_char m[SSH_DIGEST_MAX_LENGTH];\n\t\tu_int64_t for_align;\n\t} u;\n\tu_char b[4];\n\tu_char nonce[8];\n\n\tif (mac->mac_len > sizeof(u))\n\t\treturn SSH_ERR_INTERNAL_ERROR;\n\n\tswitch (mac->type) {\n\tcase SSH_DIGEST:\n\t\tput_u32(b, seqno);\n\t\t/* reset HMAC context */\n\t\tif (ssh_hmac_init(mac->hmac_ctx, NULL, 0) < 0 ||\n\t\t    ssh_hmac_update(mac->hmac_ctx, b, sizeof(b)) < 0 ||\n\t\t    ssh_hmac_update(mac->hmac_ctx, data, datalen) < 0 ||\n\t\t    ssh_hmac_final(mac->hmac_ctx, u.m, sizeof(u.m)) < 0)\n\t\t\treturn SSH_ERR_LIBCRYPTO_ERROR;\n\t\tbreak;\n\tcase SSH_UMAC:\n\t\tPOKE_U64(nonce, seqno);\n\t\tumac_update(mac->umac_ctx, data, datalen);\n\t\tumac_final(mac->umac_ctx, u.m, nonce);\n\t\tbreak;\n\tcase SSH_UMAC128:\n\t\tput_u64(nonce, seqno);\n\t\tumac128_update(mac->umac_ctx, data, datalen);\n\t\tumac128_final(mac->umac_ctx, u.m, nonce);\n\t\tbreak;\n\tdefault:\n\t\treturn SSH_ERR_INVALID_ARGUMENT;\n\t}\n\tif (digest != NULL) {\n\t\tif (dlen > mac->mac_len)\n\t\t\tdlen = mac->mac_len;\n\t\tmemcpy(digest, u.m, dlen);\n\t}\n\treturn 0;\n}",
    "includes": [
      "#include \"openbsd-compat/openssl-compat.h\"",
      "#include \"sshbuf.h\"",
      "#include \"ssherr.h\"",
      "#include \"misc.h\"",
      "#include \"mac.h\"",
      "#include \"umac.h\"",
      "#include \"hmac.h\"",
      "#include \"digest.h\"",
      "#include <stdio.h>",
      "#include <string.h>",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [
      "#define SSH_UMAC128\t3",
      "#define SSH_UMAC\t2\t/* UMAC (not integrated with OpenSSL) */",
      "#define SSH_DIGEST\t1\t/* SSH_DIGEST_XXX */"
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "memcpy",
          "args": [
            "digest",
            "u.m",
            "dlen"
          ],
          "line": 207
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "umac128_final",
          "args": [
            "mac->umac_ctx",
            "u.m",
            "nonce"
          ],
          "line": 199
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "umac128_update",
          "args": [
            "mac->umac_ctx",
            "data",
            "datalen"
          ],
          "line": 198
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "put_u64",
          "args": [
            "nonce",
            "seqno"
          ],
          "line": 197
        },
        "resolved": true,
        "details": {
          "function_name": "put_u64",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/misc.c",
          "lines": "1209-1222",
          "snippet": "void\nput_u64(void *vp, u_int64_t v)\n{\n\tu_char *p = (u_char *)vp;\n\n\tp[0] = (u_char)(v >> 56) & 0xff;\n\tp[1] = (u_char)(v >> 48) & 0xff;\n\tp[2] = (u_char)(v >> 40) & 0xff;\n\tp[3] = (u_char)(v >> 32) & 0xff;\n\tp[4] = (u_char)(v >> 24) & 0xff;\n\tp[5] = (u_char)(v >> 16) & 0xff;\n\tp[6] = (u_char)(v >> 8) & 0xff;\n\tp[7] = (u_char)v & 0xff;\n}",
          "includes": [
            "#include \"platform.h\"",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"ssh.h\"",
            "#include \"log.h\"",
            "#include \"misc.h\"",
            "#include \"xmalloc.h\"",
            "#include <net/if.h>",
            "#include <pwd.h>",
            "# include <paths.h>",
            "#include <netdb.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <ctype.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/tcp.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in_systm.h>",
            "#include <netinet/in.h>",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <libgen.h>",
            "#include <limits.h>",
            "#include <sys/un.h>",
            "#include <sys/wait.h>",
            "#include <sys/time.h>",
            "#include <sys/stat.h>",
            "#include <sys/socket.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"platform.h\"\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"ssh.h\"\n#include \"log.h\"\n#include \"misc.h\"\n#include \"xmalloc.h\"\n#include <net/if.h>\n#include <pwd.h>\n# include <paths.h>\n#include <netdb.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <ctype.h>\n#include <arpa/inet.h>\n#include <netinet/tcp.h>\n#include <netinet/ip.h>\n#include <netinet/in_systm.h>\n#include <netinet/in.h>\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <libgen.h>\n#include <limits.h>\n#include <sys/un.h>\n#include <sys/wait.h>\n#include <sys/time.h>\n#include <sys/stat.h>\n#include <sys/socket.h>\n#include <sys/ioctl.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\nput_u64(void *vp, u_int64_t v)\n{\n\tu_char *p = (u_char *)vp;\n\n\tp[0] = (u_char)(v >> 56) & 0xff;\n\tp[1] = (u_char)(v >> 48) & 0xff;\n\tp[2] = (u_char)(v >> 40) & 0xff;\n\tp[3] = (u_char)(v >> 32) & 0xff;\n\tp[4] = (u_char)(v >> 24) & 0xff;\n\tp[5] = (u_char)(v >> 16) & 0xff;\n\tp[6] = (u_char)(v >> 8) & 0xff;\n\tp[7] = (u_char)v & 0xff;\n}"
        }
      },
      {
        "call_info": {
          "callee": "umac_final",
          "args": [
            "mac->umac_ctx",
            "u.m",
            "nonce"
          ],
          "line": 194
        },
        "resolved": true,
        "details": {
          "function_name": "umac_final",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/umac.c",
          "lines": "1243-1250",
          "snippet": "int umac_final(struct umac_ctx *ctx, u_char tag[], const u_char nonce[8])\n/* Incorporate any pending data, pad, and generate tag */\n{\n    uhash_final(&ctx->hash, (u_char *)tag);\n    pdf_gen_xor(&ctx->pdf, (const UINT8 *)nonce, (UINT8 *)tag);\n\n    return (1);\n}",
          "includes": [
            "#include \"rijndael.h\"",
            "# include <openssl/aes.h>",
            "#include \"openbsd-compat/openssl-compat.h\"",
            "#include \"misc.h\"",
            "#include \"umac.h\"",
            "#include \"xmalloc.h\"",
            "#include <stddef.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <string.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "struct umac_ctx {\n    uhash_ctx hash;          /* Hash function for message compression    */\n    pdf_ctx pdf;             /* PDF for hashed output                    */\n    void *free_ptr;          /* Address to free this struct via          */\n} umac_ctx;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"rijndael.h\"\n# include <openssl/aes.h>\n#include \"openbsd-compat/openssl-compat.h\"\n#include \"misc.h\"\n#include \"umac.h\"\n#include \"xmalloc.h\"\n#include <stddef.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <string.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nstruct umac_ctx {\n    uhash_ctx hash;          /* Hash function for message compression    */\n    pdf_ctx pdf;             /* PDF for hashed output                    */\n    void *free_ptr;          /* Address to free this struct via          */\n} umac_ctx;\n\nint umac_final(struct umac_ctx *ctx, u_char tag[], const u_char nonce[8])\n/* Incorporate any pending data, pad, and generate tag */\n{\n    uhash_final(&ctx->hash, (u_char *)tag);\n    pdf_gen_xor(&ctx->pdf, (const UINT8 *)nonce, (UINT8 *)tag);\n\n    return (1);\n}"
        }
      },
      {
        "call_info": {
          "callee": "umac_update",
          "args": [
            "mac->umac_ctx",
            "data",
            "datalen"
          ],
          "line": 193
        },
        "resolved": true,
        "details": {
          "function_name": "umac_update",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/umac.c",
          "lines": "1254-1261",
          "snippet": "int umac_update(struct umac_ctx *ctx, const u_char *input, long len)\n/* Given len bytes of data, we parse it into L1_KEY_LEN chunks and   */\n/* hash each one, calling the PDF on the hashed output whenever the hash- */\n/* output buffer is full.                                                 */\n{\n    uhash_update(&ctx->hash, input, len);\n    return (1);\n}",
          "includes": [
            "#include \"rijndael.h\"",
            "# include <openssl/aes.h>",
            "#include \"openbsd-compat/openssl-compat.h\"",
            "#include \"misc.h\"",
            "#include \"umac.h\"",
            "#include \"xmalloc.h\"",
            "#include <stddef.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <string.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [
            "#define L1_KEY_LEN         1024     /* Internal key bytes                 */"
          ],
          "globals_used": [
            "struct umac_ctx {\n    uhash_ctx hash;          /* Hash function for message compression    */\n    pdf_ctx pdf;             /* PDF for hashed output                    */\n    void *free_ptr;          /* Address to free this struct via          */\n} umac_ctx;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"rijndael.h\"\n# include <openssl/aes.h>\n#include \"openbsd-compat/openssl-compat.h\"\n#include \"misc.h\"\n#include \"umac.h\"\n#include \"xmalloc.h\"\n#include <stddef.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <string.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\n#define L1_KEY_LEN         1024     /* Internal key bytes                 */\n\nstruct umac_ctx {\n    uhash_ctx hash;          /* Hash function for message compression    */\n    pdf_ctx pdf;             /* PDF for hashed output                    */\n    void *free_ptr;          /* Address to free this struct via          */\n} umac_ctx;\n\nint umac_update(struct umac_ctx *ctx, const u_char *input, long len)\n/* Given len bytes of data, we parse it into L1_KEY_LEN chunks and   */\n/* hash each one, calling the PDF on the hashed output whenever the hash- */\n/* output buffer is full.                                                 */\n{\n    uhash_update(&ctx->hash, input, len);\n    return (1);\n}"
        }
      },
      {
        "call_info": {
          "callee": "POKE_U64",
          "args": [
            "nonce",
            "seqno"
          ],
          "line": 192
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ssh_hmac_final",
          "args": [
            "mac->hmac_ctx",
            "u.m",
            "sizeof(u.m)"
          ],
          "line": 188
        },
        "resolved": true,
        "details": {
          "function_name": "ssh_hmac_final",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/hmac.c",
          "lines": "104-119",
          "snippet": "int\nssh_hmac_final(struct ssh_hmac_ctx *ctx, u_char *d, size_t dlen)\n{\n\tsize_t len;\n\n\tlen = ssh_digest_bytes(ctx->alg);\n\tif (dlen < len ||\n\t    ssh_digest_final(ctx->digest, ctx->buf, len))\n\t\treturn -1;\n\t/* switch to octx */\n\tif (ssh_digest_copy_state(ctx->octx, ctx->digest) < 0 ||\n\t    ssh_digest_update(ctx->digest, ctx->buf, len) < 0 ||\n\t    ssh_digest_final(ctx->digest, d, dlen) < 0)\n\t\treturn -1;\n\treturn 0;\n}",
          "includes": [
            "#include \"hmac.h\"",
            "#include \"digest.h\"",
            "#include \"sshbuf.h\"",
            "#include <string.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"hmac.h\"\n#include \"digest.h\"\n#include \"sshbuf.h\"\n#include <string.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nssh_hmac_final(struct ssh_hmac_ctx *ctx, u_char *d, size_t dlen)\n{\n\tsize_t len;\n\n\tlen = ssh_digest_bytes(ctx->alg);\n\tif (dlen < len ||\n\t    ssh_digest_final(ctx->digest, ctx->buf, len))\n\t\treturn -1;\n\t/* switch to octx */\n\tif (ssh_digest_copy_state(ctx->octx, ctx->digest) < 0 ||\n\t    ssh_digest_update(ctx->digest, ctx->buf, len) < 0 ||\n\t    ssh_digest_final(ctx->digest, d, dlen) < 0)\n\t\treturn -1;\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "ssh_hmac_update",
          "args": [
            "mac->hmac_ctx",
            "data",
            "datalen"
          ],
          "line": 187
        },
        "resolved": true,
        "details": {
          "function_name": "ssh_hmac_update",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/hmac.c",
          "lines": "92-96",
          "snippet": "int\nssh_hmac_update(struct ssh_hmac_ctx *ctx, const void *m, size_t mlen)\n{\n\treturn ssh_digest_update(ctx->digest, m, mlen);\n}",
          "includes": [
            "#include \"hmac.h\"",
            "#include \"digest.h\"",
            "#include \"sshbuf.h\"",
            "#include <string.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"hmac.h\"\n#include \"digest.h\"\n#include \"sshbuf.h\"\n#include <string.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nssh_hmac_update(struct ssh_hmac_ctx *ctx, const void *m, size_t mlen)\n{\n\treturn ssh_digest_update(ctx->digest, m, mlen);\n}"
        }
      },
      {
        "call_info": {
          "callee": "ssh_hmac_init",
          "args": [
            "mac->hmac_ctx",
            "NULL",
            "0"
          ],
          "line": 185
        },
        "resolved": true,
        "details": {
          "function_name": "ssh_hmac_init",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/hmac.c",
          "lines": "63-90",
          "snippet": "int\nssh_hmac_init(struct ssh_hmac_ctx *ctx, const void *key, size_t klen)\n{\n\tsize_t i;\n\n\t/* reset ictx and octx if no is key given */\n\tif (key != NULL) {\n\t\t/* truncate long keys */\n\t\tif (klen <= ctx->buf_len)\n\t\t\tmemcpy(ctx->buf, key, klen);\n\t\telse if (ssh_digest_memory(ctx->alg, key, klen, ctx->buf,\n\t\t    ctx->buf_len) < 0)\n\t\t\treturn -1;\n\t\tfor (i = 0; i < ctx->buf_len; i++)\n\t\t\tctx->buf[i] ^= 0x36;\n\t\tif (ssh_digest_update(ctx->ictx, ctx->buf, ctx->buf_len) < 0)\n\t\t\treturn -1;\n\t\tfor (i = 0; i < ctx->buf_len; i++)\n\t\t\tctx->buf[i] ^= 0x36 ^ 0x5c;\n\t\tif (ssh_digest_update(ctx->octx, ctx->buf, ctx->buf_len) < 0)\n\t\t\treturn -1;\n\t\texplicit_bzero(ctx->buf, ctx->buf_len);\n\t}\n\t/* start with ictx */\n\tif (ssh_digest_copy_state(ctx->ictx, ctx->digest) < 0)\n\t\treturn -1;\n\treturn 0;\n}",
          "includes": [
            "#include \"hmac.h\"",
            "#include \"digest.h\"",
            "#include \"sshbuf.h\"",
            "#include <string.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"hmac.h\"\n#include \"digest.h\"\n#include \"sshbuf.h\"\n#include <string.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nssh_hmac_init(struct ssh_hmac_ctx *ctx, const void *key, size_t klen)\n{\n\tsize_t i;\n\n\t/* reset ictx and octx if no is key given */\n\tif (key != NULL) {\n\t\t/* truncate long keys */\n\t\tif (klen <= ctx->buf_len)\n\t\t\tmemcpy(ctx->buf, key, klen);\n\t\telse if (ssh_digest_memory(ctx->alg, key, klen, ctx->buf,\n\t\t    ctx->buf_len) < 0)\n\t\t\treturn -1;\n\t\tfor (i = 0; i < ctx->buf_len; i++)\n\t\t\tctx->buf[i] ^= 0x36;\n\t\tif (ssh_digest_update(ctx->ictx, ctx->buf, ctx->buf_len) < 0)\n\t\t\treturn -1;\n\t\tfor (i = 0; i < ctx->buf_len; i++)\n\t\t\tctx->buf[i] ^= 0x36 ^ 0x5c;\n\t\tif (ssh_digest_update(ctx->octx, ctx->buf, ctx->buf_len) < 0)\n\t\t\treturn -1;\n\t\texplicit_bzero(ctx->buf, ctx->buf_len);\n\t}\n\t/* start with ictx */\n\tif (ssh_digest_copy_state(ctx->ictx, ctx->digest) < 0)\n\t\treturn -1;\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "put_u32",
          "args": [
            "b",
            "seqno"
          ],
          "line": 183
        },
        "resolved": true,
        "details": {
          "function_name": "put_u32_le",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/misc.c",
          "lines": "1235-1244",
          "snippet": "void\nput_u32_le(void *vp, u_int32_t v)\n{\n\tu_char *p = (u_char *)vp;\n\n\tp[0] = (u_char)v & 0xff;\n\tp[1] = (u_char)(v >> 8) & 0xff;\n\tp[2] = (u_char)(v >> 16) & 0xff;\n\tp[3] = (u_char)(v >> 24) & 0xff;\n}",
          "includes": [
            "#include \"platform.h\"",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"ssh.h\"",
            "#include \"log.h\"",
            "#include \"misc.h\"",
            "#include \"xmalloc.h\"",
            "#include <net/if.h>",
            "#include <pwd.h>",
            "# include <paths.h>",
            "#include <netdb.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <ctype.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/tcp.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in_systm.h>",
            "#include <netinet/in.h>",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <libgen.h>",
            "#include <limits.h>",
            "#include <sys/un.h>",
            "#include <sys/wait.h>",
            "#include <sys/time.h>",
            "#include <sys/stat.h>",
            "#include <sys/socket.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"platform.h\"\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"ssh.h\"\n#include \"log.h\"\n#include \"misc.h\"\n#include \"xmalloc.h\"\n#include <net/if.h>\n#include <pwd.h>\n# include <paths.h>\n#include <netdb.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <ctype.h>\n#include <arpa/inet.h>\n#include <netinet/tcp.h>\n#include <netinet/ip.h>\n#include <netinet/in_systm.h>\n#include <netinet/in.h>\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <libgen.h>\n#include <limits.h>\n#include <sys/un.h>\n#include <sys/wait.h>\n#include <sys/time.h>\n#include <sys/stat.h>\n#include <sys/socket.h>\n#include <sys/ioctl.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\nput_u32_le(void *vp, u_int32_t v)\n{\n\tu_char *p = (u_char *)vp;\n\n\tp[0] = (u_char)v & 0xff;\n\tp[1] = (u_char)(v >> 8) & 0xff;\n\tp[2] = (u_char)(v >> 16) & 0xff;\n\tp[3] = (u_char)(v >> 24) & 0xff;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"openbsd-compat/openssl-compat.h\"\n#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"misc.h\"\n#include \"mac.h\"\n#include \"umac.h\"\n#include \"hmac.h\"\n#include \"digest.h\"\n#include <stdio.h>\n#include <string.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\n#define SSH_UMAC128\t3\n#define SSH_UMAC\t2\t/* UMAC (not integrated with OpenSSL) */\n#define SSH_DIGEST\t1\t/* SSH_DIGEST_XXX */\n\nint\nmac_compute(struct sshmac *mac, u_int32_t seqno,\n    const u_char *data, int datalen,\n    u_char *digest, size_t dlen)\n{\n\tstatic union {\n\t\tu_char m[SSH_DIGEST_MAX_LENGTH];\n\t\tu_int64_t for_align;\n\t} u;\n\tu_char b[4];\n\tu_char nonce[8];\n\n\tif (mac->mac_len > sizeof(u))\n\t\treturn SSH_ERR_INTERNAL_ERROR;\n\n\tswitch (mac->type) {\n\tcase SSH_DIGEST:\n\t\tput_u32(b, seqno);\n\t\t/* reset HMAC context */\n\t\tif (ssh_hmac_init(mac->hmac_ctx, NULL, 0) < 0 ||\n\t\t    ssh_hmac_update(mac->hmac_ctx, b, sizeof(b)) < 0 ||\n\t\t    ssh_hmac_update(mac->hmac_ctx, data, datalen) < 0 ||\n\t\t    ssh_hmac_final(mac->hmac_ctx, u.m, sizeof(u.m)) < 0)\n\t\t\treturn SSH_ERR_LIBCRYPTO_ERROR;\n\t\tbreak;\n\tcase SSH_UMAC:\n\t\tPOKE_U64(nonce, seqno);\n\t\tumac_update(mac->umac_ctx, data, datalen);\n\t\tumac_final(mac->umac_ctx, u.m, nonce);\n\t\tbreak;\n\tcase SSH_UMAC128:\n\t\tput_u64(nonce, seqno);\n\t\tumac128_update(mac->umac_ctx, data, datalen);\n\t\tumac128_final(mac->umac_ctx, u.m, nonce);\n\t\tbreak;\n\tdefault:\n\t\treturn SSH_ERR_INVALID_ARGUMENT;\n\t}\n\tif (digest != NULL) {\n\t\tif (dlen > mac->mac_len)\n\t\t\tdlen = mac->mac_len;\n\t\tmemcpy(digest, u.m, dlen);\n\t}\n\treturn 0;\n}"
  },
  {
    "function_name": "mac_init",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/mac.c",
    "lines": "142-164",
    "snippet": "int\nmac_init(struct sshmac *mac)\n{\n\tif (mac->key == NULL)\n\t\treturn SSH_ERR_INVALID_ARGUMENT;\n\tswitch (mac->type) {\n\tcase SSH_DIGEST:\n\t\tif (mac->hmac_ctx == NULL ||\n\t\t    ssh_hmac_init(mac->hmac_ctx, mac->key, mac->key_len) < 0)\n\t\t\treturn SSH_ERR_INVALID_ARGUMENT;\n\t\treturn 0;\n\tcase SSH_UMAC:\n\t\tif ((mac->umac_ctx = umac_new(mac->key)) == NULL)\n\t\t\treturn SSH_ERR_ALLOC_FAIL;\n\t\treturn 0;\n\tcase SSH_UMAC128:\n\t\tif ((mac->umac_ctx = umac128_new(mac->key)) == NULL)\n\t\t\treturn SSH_ERR_ALLOC_FAIL;\n\t\treturn 0;\n\tdefault:\n\t\treturn SSH_ERR_INVALID_ARGUMENT;\n\t}\n}",
    "includes": [
      "#include \"openbsd-compat/openssl-compat.h\"",
      "#include \"sshbuf.h\"",
      "#include \"ssherr.h\"",
      "#include \"misc.h\"",
      "#include \"mac.h\"",
      "#include \"umac.h\"",
      "#include \"hmac.h\"",
      "#include \"digest.h\"",
      "#include <stdio.h>",
      "#include <string.h>",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [
      "#define SSH_UMAC128\t3",
      "#define SSH_UMAC\t2\t/* UMAC (not integrated with OpenSSL) */",
      "#define SSH_DIGEST\t1\t/* SSH_DIGEST_XXX */"
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "umac128_new",
          "args": [
            "mac->key"
          ],
          "line": 158
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "umac_new",
          "args": [
            "mac->key"
          ],
          "line": 154
        },
        "resolved": true,
        "details": {
          "function_name": "umac_new",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/umac.c",
          "lines": "1215-1239",
          "snippet": "struct umac_ctx *umac_new(const u_char key[])\n/* Dynamically allocate a umac_ctx struct, initialize variables,\n * generate subkeys from key. Align to 16-byte boundary.\n */\n{\n    struct umac_ctx *ctx, *octx;\n    size_t bytes_to_add;\n    aes_int_key prf_key;\n\n    octx = ctx = xcalloc(1, sizeof(*ctx) + ALLOC_BOUNDARY);\n    if (ctx) {\n        if (ALLOC_BOUNDARY) {\n            bytes_to_add = ALLOC_BOUNDARY -\n                              ((ptrdiff_t)ctx & (ALLOC_BOUNDARY - 1));\n            ctx = (struct umac_ctx *)((u_char *)ctx + bytes_to_add);\n        }\n        ctx->free_ptr = octx;\n        aes_key_setup(key, prf_key);\n        pdf_init(&ctx->pdf, prf_key);\n        uhash_init(&ctx->hash, prf_key);\n        explicit_bzero(prf_key, sizeof(prf_key));\n    }\n\n    return (ctx);\n}",
          "includes": [
            "#include \"rijndael.h\"",
            "# include <openssl/aes.h>",
            "#include \"openbsd-compat/openssl-compat.h\"",
            "#include \"misc.h\"",
            "#include \"umac.h\"",
            "#include \"xmalloc.h\"",
            "#include <stddef.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <string.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [
            "#define ALLOC_BOUNDARY       16     /* Keep buffers aligned to this       */"
          ],
          "globals_used": [
            "struct umac_ctx {\n    uhash_ctx hash;          /* Hash function for message compression    */\n    pdf_ctx pdf;             /* PDF for hashed output                    */\n    void *free_ptr;          /* Address to free this struct via          */\n} umac_ctx;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"rijndael.h\"\n# include <openssl/aes.h>\n#include \"openbsd-compat/openssl-compat.h\"\n#include \"misc.h\"\n#include \"umac.h\"\n#include \"xmalloc.h\"\n#include <stddef.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <string.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\n#define ALLOC_BOUNDARY       16     /* Keep buffers aligned to this       */\n\nstruct umac_ctx {\n    uhash_ctx hash;          /* Hash function for message compression    */\n    pdf_ctx pdf;             /* PDF for hashed output                    */\n    void *free_ptr;          /* Address to free this struct via          */\n} umac_ctx;\n\nstruct umac_ctx *umac_new(const u_char key[])\n/* Dynamically allocate a umac_ctx struct, initialize variables,\n * generate subkeys from key. Align to 16-byte boundary.\n */\n{\n    struct umac_ctx *ctx, *octx;\n    size_t bytes_to_add;\n    aes_int_key prf_key;\n\n    octx = ctx = xcalloc(1, sizeof(*ctx) + ALLOC_BOUNDARY);\n    if (ctx) {\n        if (ALLOC_BOUNDARY) {\n            bytes_to_add = ALLOC_BOUNDARY -\n                              ((ptrdiff_t)ctx & (ALLOC_BOUNDARY - 1));\n            ctx = (struct umac_ctx *)((u_char *)ctx + bytes_to_add);\n        }\n        ctx->free_ptr = octx;\n        aes_key_setup(key, prf_key);\n        pdf_init(&ctx->pdf, prf_key);\n        uhash_init(&ctx->hash, prf_key);\n        explicit_bzero(prf_key, sizeof(prf_key));\n    }\n\n    return (ctx);\n}"
        }
      },
      {
        "call_info": {
          "callee": "ssh_hmac_init",
          "args": [
            "mac->hmac_ctx",
            "mac->key",
            "mac->key_len"
          ],
          "line": 150
        },
        "resolved": true,
        "details": {
          "function_name": "ssh_hmac_init",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/hmac.c",
          "lines": "63-90",
          "snippet": "int\nssh_hmac_init(struct ssh_hmac_ctx *ctx, const void *key, size_t klen)\n{\n\tsize_t i;\n\n\t/* reset ictx and octx if no is key given */\n\tif (key != NULL) {\n\t\t/* truncate long keys */\n\t\tif (klen <= ctx->buf_len)\n\t\t\tmemcpy(ctx->buf, key, klen);\n\t\telse if (ssh_digest_memory(ctx->alg, key, klen, ctx->buf,\n\t\t    ctx->buf_len) < 0)\n\t\t\treturn -1;\n\t\tfor (i = 0; i < ctx->buf_len; i++)\n\t\t\tctx->buf[i] ^= 0x36;\n\t\tif (ssh_digest_update(ctx->ictx, ctx->buf, ctx->buf_len) < 0)\n\t\t\treturn -1;\n\t\tfor (i = 0; i < ctx->buf_len; i++)\n\t\t\tctx->buf[i] ^= 0x36 ^ 0x5c;\n\t\tif (ssh_digest_update(ctx->octx, ctx->buf, ctx->buf_len) < 0)\n\t\t\treturn -1;\n\t\texplicit_bzero(ctx->buf, ctx->buf_len);\n\t}\n\t/* start with ictx */\n\tif (ssh_digest_copy_state(ctx->ictx, ctx->digest) < 0)\n\t\treturn -1;\n\treturn 0;\n}",
          "includes": [
            "#include \"hmac.h\"",
            "#include \"digest.h\"",
            "#include \"sshbuf.h\"",
            "#include <string.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"hmac.h\"\n#include \"digest.h\"\n#include \"sshbuf.h\"\n#include <string.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nssh_hmac_init(struct ssh_hmac_ctx *ctx, const void *key, size_t klen)\n{\n\tsize_t i;\n\n\t/* reset ictx and octx if no is key given */\n\tif (key != NULL) {\n\t\t/* truncate long keys */\n\t\tif (klen <= ctx->buf_len)\n\t\t\tmemcpy(ctx->buf, key, klen);\n\t\telse if (ssh_digest_memory(ctx->alg, key, klen, ctx->buf,\n\t\t    ctx->buf_len) < 0)\n\t\t\treturn -1;\n\t\tfor (i = 0; i < ctx->buf_len; i++)\n\t\t\tctx->buf[i] ^= 0x36;\n\t\tif (ssh_digest_update(ctx->ictx, ctx->buf, ctx->buf_len) < 0)\n\t\t\treturn -1;\n\t\tfor (i = 0; i < ctx->buf_len; i++)\n\t\t\tctx->buf[i] ^= 0x36 ^ 0x5c;\n\t\tif (ssh_digest_update(ctx->octx, ctx->buf, ctx->buf_len) < 0)\n\t\t\treturn -1;\n\t\texplicit_bzero(ctx->buf, ctx->buf_len);\n\t}\n\t/* start with ictx */\n\tif (ssh_digest_copy_state(ctx->ictx, ctx->digest) < 0)\n\t\treturn -1;\n\treturn 0;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"openbsd-compat/openssl-compat.h\"\n#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"misc.h\"\n#include \"mac.h\"\n#include \"umac.h\"\n#include \"hmac.h\"\n#include \"digest.h\"\n#include <stdio.h>\n#include <string.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\n#define SSH_UMAC128\t3\n#define SSH_UMAC\t2\t/* UMAC (not integrated with OpenSSL) */\n#define SSH_DIGEST\t1\t/* SSH_DIGEST_XXX */\n\nint\nmac_init(struct sshmac *mac)\n{\n\tif (mac->key == NULL)\n\t\treturn SSH_ERR_INVALID_ARGUMENT;\n\tswitch (mac->type) {\n\tcase SSH_DIGEST:\n\t\tif (mac->hmac_ctx == NULL ||\n\t\t    ssh_hmac_init(mac->hmac_ctx, mac->key, mac->key_len) < 0)\n\t\t\treturn SSH_ERR_INVALID_ARGUMENT;\n\t\treturn 0;\n\tcase SSH_UMAC:\n\t\tif ((mac->umac_ctx = umac_new(mac->key)) == NULL)\n\t\t\treturn SSH_ERR_ALLOC_FAIL;\n\t\treturn 0;\n\tcase SSH_UMAC128:\n\t\tif ((mac->umac_ctx = umac128_new(mac->key)) == NULL)\n\t\t\treturn SSH_ERR_ALLOC_FAIL;\n\t\treturn 0;\n\tdefault:\n\t\treturn SSH_ERR_INVALID_ARGUMENT;\n\t}\n}"
  },
  {
    "function_name": "mac_setup",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/mac.c",
    "lines": "127-140",
    "snippet": "int\nmac_setup(struct sshmac *mac, char *name)\n{\n\tconst struct macalg *m;\n\n\tfor (m = macs; m->name != NULL; m++) {\n\t\tif (strcmp(name, m->name) != 0)\n\t\t\tcontinue;\n\t\tif (mac != NULL)\n\t\t\treturn mac_setup_by_alg(mac, m);\n\t\treturn 0;\n\t}\n\treturn SSH_ERR_INVALID_ARGUMENT;\n}",
    "includes": [
      "#include \"openbsd-compat/openssl-compat.h\"",
      "#include \"sshbuf.h\"",
      "#include \"ssherr.h\"",
      "#include \"misc.h\"",
      "#include \"mac.h\"",
      "#include \"umac.h\"",
      "#include \"hmac.h\"",
      "#include \"digest.h\"",
      "#include <stdio.h>",
      "#include <string.h>",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "static const struct macalg macs[] = {\n\t/* Encrypt-and-MAC (encrypt-and-authenticate) variants */\n\t{ \"hmac-sha1\",\t\t\t\tSSH_DIGEST, SSH_DIGEST_SHA1, 0, 0, 0, 0 },\n\t{ \"hmac-sha1-96\",\t\t\tSSH_DIGEST, SSH_DIGEST_SHA1, 96, 0, 0, 0 },\n#ifdef HAVE_EVP_SHA256\n\t{ \"hmac-sha2-256\",\t\t\tSSH_DIGEST, SSH_DIGEST_SHA256, 0, 0, 0, 0 },\n\t{ \"hmac-sha2-512\",\t\t\tSSH_DIGEST, SSH_DIGEST_SHA512, 0, 0, 0, 0 },\n#endif\n\t{ \"hmac-md5\",\t\t\t\tSSH_DIGEST, SSH_DIGEST_MD5, 0, 0, 0, 0 },\n\t{ \"hmac-md5-96\",\t\t\tSSH_DIGEST, SSH_DIGEST_MD5, 96, 0, 0, 0 },\n\t{ \"umac-64@openssh.com\",\t\tSSH_UMAC, 0, 0, 128, 64, 0 },\n\t{ \"umac-128@openssh.com\",\t\tSSH_UMAC128, 0, 0, 128, 128, 0 },\n\n\t/* Encrypt-then-MAC variants */\n\t{ \"hmac-sha1-etm@openssh.com\",\t\tSSH_DIGEST, SSH_DIGEST_SHA1, 0, 0, 0, 1 },\n\t{ \"hmac-sha1-96-etm@openssh.com\",\tSSH_DIGEST, SSH_DIGEST_SHA1, 96, 0, 0, 1 },\n#ifdef HAVE_EVP_SHA256\n\t{ \"hmac-sha2-256-etm@openssh.com\",\tSSH_DIGEST, SSH_DIGEST_SHA256, 0, 0, 0, 1 },\n\t{ \"hmac-sha2-512-etm@openssh.com\",\tSSH_DIGEST, SSH_DIGEST_SHA512, 0, 0, 0, 1 },\n#endif\n\t{ \"hmac-md5-etm@openssh.com\",\t\tSSH_DIGEST, SSH_DIGEST_MD5, 0, 0, 0, 1 },\n\t{ \"hmac-md5-96-etm@openssh.com\",\tSSH_DIGEST, SSH_DIGEST_MD5, 96, 0, 0, 1 },\n\t{ \"umac-64-etm@openssh.com\",\t\tSSH_UMAC, 0, 0, 128, 64, 1 },\n\t{ \"umac-128-etm@openssh.com\",\t\tSSH_UMAC128, 0, 0, 128, 128, 1 },\n\n\t{ NULL,\t\t\t\t\t0, 0, 0, 0, 0, 0 }\n};"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "mac_setup_by_alg",
          "args": [
            "mac",
            "m"
          ],
          "line": 136
        },
        "resolved": true,
        "details": {
          "function_name": "mac_setup_by_alg",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/mac.c",
          "lines": "108-125",
          "snippet": "static int\nmac_setup_by_alg(struct sshmac *mac, const struct macalg *macalg)\n{\n\tmac->type = macalg->type;\n\tif (mac->type == SSH_DIGEST) {\n\t\tif ((mac->hmac_ctx = ssh_hmac_start(macalg->alg)) == NULL)\n\t\t\treturn SSH_ERR_ALLOC_FAIL;\n\t\tmac->key_len = mac->mac_len = ssh_hmac_bytes(macalg->alg);\n\t} else {\n\t\tmac->mac_len = macalg->len / 8;\n\t\tmac->key_len = macalg->key_len / 8;\n\t\tmac->umac_ctx = NULL;\n\t}\n\tif (macalg->truncatebits != 0)\n\t\tmac->mac_len = macalg->truncatebits / 8;\n\tmac->etm = macalg->etm;\n\treturn 0;\n}",
          "includes": [
            "#include \"openbsd-compat/openssl-compat.h\"",
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include \"misc.h\"",
            "#include \"mac.h\"",
            "#include \"umac.h\"",
            "#include \"hmac.h\"",
            "#include \"digest.h\"",
            "#include <stdio.h>",
            "#include <string.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [
            "#define SSH_DIGEST\t1\t/* SSH_DIGEST_XXX */"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"openbsd-compat/openssl-compat.h\"\n#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"misc.h\"\n#include \"mac.h\"\n#include \"umac.h\"\n#include \"hmac.h\"\n#include \"digest.h\"\n#include <stdio.h>\n#include <string.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\n#define SSH_DIGEST\t1\t/* SSH_DIGEST_XXX */\n\nstatic int\nmac_setup_by_alg(struct sshmac *mac, const struct macalg *macalg)\n{\n\tmac->type = macalg->type;\n\tif (mac->type == SSH_DIGEST) {\n\t\tif ((mac->hmac_ctx = ssh_hmac_start(macalg->alg)) == NULL)\n\t\t\treturn SSH_ERR_ALLOC_FAIL;\n\t\tmac->key_len = mac->mac_len = ssh_hmac_bytes(macalg->alg);\n\t} else {\n\t\tmac->mac_len = macalg->len / 8;\n\t\tmac->key_len = macalg->key_len / 8;\n\t\tmac->umac_ctx = NULL;\n\t}\n\tif (macalg->truncatebits != 0)\n\t\tmac->mac_len = macalg->truncatebits / 8;\n\tmac->etm = macalg->etm;\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "name",
            "m->name"
          ],
          "line": 133
        },
        "resolved": true,
        "details": {
          "function_name": "strcmp_maybe_null",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/misc.c",
          "lines": "1550-1558",
          "snippet": "static int\nstrcmp_maybe_null(const char *a, const char *b)\n{\n\tif ((a == NULL && b != NULL) || (a != NULL && b == NULL))\n\t\treturn 0;\n\tif (a != NULL && strcmp(a, b) != 0)\n\t\treturn 0;\n\treturn 1;\n}",
          "includes": [
            "#include \"platform.h\"",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"ssh.h\"",
            "#include \"log.h\"",
            "#include \"misc.h\"",
            "#include \"xmalloc.h\"",
            "#include <net/if.h>",
            "#include <pwd.h>",
            "# include <paths.h>",
            "#include <netdb.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <ctype.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/tcp.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in_systm.h>",
            "#include <netinet/in.h>",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <libgen.h>",
            "#include <limits.h>",
            "#include <sys/un.h>",
            "#include <sys/wait.h>",
            "#include <sys/time.h>",
            "#include <sys/stat.h>",
            "#include <sys/socket.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"platform.h\"\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"ssh.h\"\n#include \"log.h\"\n#include \"misc.h\"\n#include \"xmalloc.h\"\n#include <net/if.h>\n#include <pwd.h>\n# include <paths.h>\n#include <netdb.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <ctype.h>\n#include <arpa/inet.h>\n#include <netinet/tcp.h>\n#include <netinet/ip.h>\n#include <netinet/in_systm.h>\n#include <netinet/in.h>\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <libgen.h>\n#include <limits.h>\n#include <sys/un.h>\n#include <sys/wait.h>\n#include <sys/time.h>\n#include <sys/stat.h>\n#include <sys/socket.h>\n#include <sys/ioctl.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nstatic int\nstrcmp_maybe_null(const char *a, const char *b)\n{\n\tif ((a == NULL && b != NULL) || (a != NULL && b == NULL))\n\t\treturn 0;\n\tif (a != NULL && strcmp(a, b) != 0)\n\t\treturn 0;\n\treturn 1;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"openbsd-compat/openssl-compat.h\"\n#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"misc.h\"\n#include \"mac.h\"\n#include \"umac.h\"\n#include \"hmac.h\"\n#include \"digest.h\"\n#include <stdio.h>\n#include <string.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nstatic const struct macalg macs[] = {\n\t/* Encrypt-and-MAC (encrypt-and-authenticate) variants */\n\t{ \"hmac-sha1\",\t\t\t\tSSH_DIGEST, SSH_DIGEST_SHA1, 0, 0, 0, 0 },\n\t{ \"hmac-sha1-96\",\t\t\tSSH_DIGEST, SSH_DIGEST_SHA1, 96, 0, 0, 0 },\n#ifdef HAVE_EVP_SHA256\n\t{ \"hmac-sha2-256\",\t\t\tSSH_DIGEST, SSH_DIGEST_SHA256, 0, 0, 0, 0 },\n\t{ \"hmac-sha2-512\",\t\t\tSSH_DIGEST, SSH_DIGEST_SHA512, 0, 0, 0, 0 },\n#endif\n\t{ \"hmac-md5\",\t\t\t\tSSH_DIGEST, SSH_DIGEST_MD5, 0, 0, 0, 0 },\n\t{ \"hmac-md5-96\",\t\t\tSSH_DIGEST, SSH_DIGEST_MD5, 96, 0, 0, 0 },\n\t{ \"umac-64@openssh.com\",\t\tSSH_UMAC, 0, 0, 128, 64, 0 },\n\t{ \"umac-128@openssh.com\",\t\tSSH_UMAC128, 0, 0, 128, 128, 0 },\n\n\t/* Encrypt-then-MAC variants */\n\t{ \"hmac-sha1-etm@openssh.com\",\t\tSSH_DIGEST, SSH_DIGEST_SHA1, 0, 0, 0, 1 },\n\t{ \"hmac-sha1-96-etm@openssh.com\",\tSSH_DIGEST, SSH_DIGEST_SHA1, 96, 0, 0, 1 },\n#ifdef HAVE_EVP_SHA256\n\t{ \"hmac-sha2-256-etm@openssh.com\",\tSSH_DIGEST, SSH_DIGEST_SHA256, 0, 0, 0, 1 },\n\t{ \"hmac-sha2-512-etm@openssh.com\",\tSSH_DIGEST, SSH_DIGEST_SHA512, 0, 0, 0, 1 },\n#endif\n\t{ \"hmac-md5-etm@openssh.com\",\t\tSSH_DIGEST, SSH_DIGEST_MD5, 0, 0, 0, 1 },\n\t{ \"hmac-md5-96-etm@openssh.com\",\tSSH_DIGEST, SSH_DIGEST_MD5, 96, 0, 0, 1 },\n\t{ \"umac-64-etm@openssh.com\",\t\tSSH_UMAC, 0, 0, 128, 64, 1 },\n\t{ \"umac-128-etm@openssh.com\",\t\tSSH_UMAC128, 0, 0, 128, 128, 1 },\n\n\t{ NULL,\t\t\t\t\t0, 0, 0, 0, 0, 0 }\n};\n\nint\nmac_setup(struct sshmac *mac, char *name)\n{\n\tconst struct macalg *m;\n\n\tfor (m = macs; m->name != NULL; m++) {\n\t\tif (strcmp(name, m->name) != 0)\n\t\t\tcontinue;\n\t\tif (mac != NULL)\n\t\t\treturn mac_setup_by_alg(mac, m);\n\t\treturn 0;\n\t}\n\treturn SSH_ERR_INVALID_ARGUMENT;\n}"
  },
  {
    "function_name": "mac_setup_by_alg",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/mac.c",
    "lines": "108-125",
    "snippet": "static int\nmac_setup_by_alg(struct sshmac *mac, const struct macalg *macalg)\n{\n\tmac->type = macalg->type;\n\tif (mac->type == SSH_DIGEST) {\n\t\tif ((mac->hmac_ctx = ssh_hmac_start(macalg->alg)) == NULL)\n\t\t\treturn SSH_ERR_ALLOC_FAIL;\n\t\tmac->key_len = mac->mac_len = ssh_hmac_bytes(macalg->alg);\n\t} else {\n\t\tmac->mac_len = macalg->len / 8;\n\t\tmac->key_len = macalg->key_len / 8;\n\t\tmac->umac_ctx = NULL;\n\t}\n\tif (macalg->truncatebits != 0)\n\t\tmac->mac_len = macalg->truncatebits / 8;\n\tmac->etm = macalg->etm;\n\treturn 0;\n}",
    "includes": [
      "#include \"openbsd-compat/openssl-compat.h\"",
      "#include \"sshbuf.h\"",
      "#include \"ssherr.h\"",
      "#include \"misc.h\"",
      "#include \"mac.h\"",
      "#include \"umac.h\"",
      "#include \"hmac.h\"",
      "#include \"digest.h\"",
      "#include <stdio.h>",
      "#include <string.h>",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [
      "#define SSH_DIGEST\t1\t/* SSH_DIGEST_XXX */"
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "ssh_hmac_bytes",
          "args": [
            "macalg->alg"
          ],
          "line": 115
        },
        "resolved": true,
        "details": {
          "function_name": "ssh_hmac_bytes",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/hmac.c",
          "lines": "36-40",
          "snippet": "size_t\nssh_hmac_bytes(int alg)\n{\n\treturn ssh_digest_bytes(alg);\n}",
          "includes": [
            "#include \"hmac.h\"",
            "#include \"digest.h\"",
            "#include \"sshbuf.h\"",
            "#include <string.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"hmac.h\"\n#include \"digest.h\"\n#include \"sshbuf.h\"\n#include <string.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nsize_t\nssh_hmac_bytes(int alg)\n{\n\treturn ssh_digest_bytes(alg);\n}"
        }
      },
      {
        "call_info": {
          "callee": "ssh_hmac_start",
          "args": [
            "macalg->alg"
          ],
          "line": 113
        },
        "resolved": true,
        "details": {
          "function_name": "ssh_hmac_start",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/hmac.c",
          "lines": "42-61",
          "snippet": "struct ssh_hmac_ctx *\nssh_hmac_start(int alg)\n{\n\tstruct ssh_hmac_ctx\t*ret;\n\n\tif ((ret = calloc(1, sizeof(*ret))) == NULL)\n\t\treturn NULL;\n\tret->alg = alg;\n\tif ((ret->ictx = ssh_digest_start(alg)) == NULL ||\n\t    (ret->octx = ssh_digest_start(alg)) == NULL ||\n\t    (ret->digest = ssh_digest_start(alg)) == NULL)\n\t\tgoto fail;\n\tret->buf_len = ssh_digest_blocksize(ret->ictx);\n\tif ((ret->buf = calloc(1, ret->buf_len)) == NULL)\n\t\tgoto fail;\n\treturn ret;\nfail:\n\tssh_hmac_free(ret);\n\treturn NULL;\n}",
          "includes": [
            "#include \"hmac.h\"",
            "#include \"digest.h\"",
            "#include \"sshbuf.h\"",
            "#include <string.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"hmac.h\"\n#include \"digest.h\"\n#include \"sshbuf.h\"\n#include <string.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nstruct ssh_hmac_ctx *\nssh_hmac_start(int alg)\n{\n\tstruct ssh_hmac_ctx\t*ret;\n\n\tif ((ret = calloc(1, sizeof(*ret))) == NULL)\n\t\treturn NULL;\n\tret->alg = alg;\n\tif ((ret->ictx = ssh_digest_start(alg)) == NULL ||\n\t    (ret->octx = ssh_digest_start(alg)) == NULL ||\n\t    (ret->digest = ssh_digest_start(alg)) == NULL)\n\t\tgoto fail;\n\tret->buf_len = ssh_digest_blocksize(ret->ictx);\n\tif ((ret->buf = calloc(1, ret->buf_len)) == NULL)\n\t\tgoto fail;\n\treturn ret;\nfail:\n\tssh_hmac_free(ret);\n\treturn NULL;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"openbsd-compat/openssl-compat.h\"\n#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"misc.h\"\n#include \"mac.h\"\n#include \"umac.h\"\n#include \"hmac.h\"\n#include \"digest.h\"\n#include <stdio.h>\n#include <string.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\n#define SSH_DIGEST\t1\t/* SSH_DIGEST_XXX */\n\nstatic int\nmac_setup_by_alg(struct sshmac *mac, const struct macalg *macalg)\n{\n\tmac->type = macalg->type;\n\tif (mac->type == SSH_DIGEST) {\n\t\tif ((mac->hmac_ctx = ssh_hmac_start(macalg->alg)) == NULL)\n\t\t\treturn SSH_ERR_ALLOC_FAIL;\n\t\tmac->key_len = mac->mac_len = ssh_hmac_bytes(macalg->alg);\n\t} else {\n\t\tmac->mac_len = macalg->len / 8;\n\t\tmac->key_len = macalg->key_len / 8;\n\t\tmac->umac_ctx = NULL;\n\t}\n\tif (macalg->truncatebits != 0)\n\t\tmac->mac_len = macalg->truncatebits / 8;\n\tmac->etm = macalg->etm;\n\treturn 0;\n}"
  },
  {
    "function_name": "mac_alg_list",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/mac.c",
    "lines": "86-106",
    "snippet": "char *\nmac_alg_list(char sep)\n{\n\tchar *ret = NULL, *tmp;\n\tsize_t nlen, rlen = 0;\n\tconst struct macalg *m;\n\n\tfor (m = macs; m->name != NULL; m++) {\n\t\tif (ret != NULL)\n\t\t\tret[rlen++] = sep;\n\t\tnlen = strlen(m->name);\n\t\tif ((tmp = realloc(ret, rlen + nlen + 2)) == NULL) {\n\t\t\tfree(ret);\n\t\t\treturn NULL;\n\t\t}\n\t\tret = tmp;\n\t\tmemcpy(ret + rlen, m->name, nlen + 1);\n\t\trlen += nlen;\n\t}\n\treturn ret;\n}",
    "includes": [
      "#include \"openbsd-compat/openssl-compat.h\"",
      "#include \"sshbuf.h\"",
      "#include \"ssherr.h\"",
      "#include \"misc.h\"",
      "#include \"mac.h\"",
      "#include \"umac.h\"",
      "#include \"hmac.h\"",
      "#include \"digest.h\"",
      "#include <stdio.h>",
      "#include <string.h>",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "static const struct macalg macs[] = {\n\t/* Encrypt-and-MAC (encrypt-and-authenticate) variants */\n\t{ \"hmac-sha1\",\t\t\t\tSSH_DIGEST, SSH_DIGEST_SHA1, 0, 0, 0, 0 },\n\t{ \"hmac-sha1-96\",\t\t\tSSH_DIGEST, SSH_DIGEST_SHA1, 96, 0, 0, 0 },\n#ifdef HAVE_EVP_SHA256\n\t{ \"hmac-sha2-256\",\t\t\tSSH_DIGEST, SSH_DIGEST_SHA256, 0, 0, 0, 0 },\n\t{ \"hmac-sha2-512\",\t\t\tSSH_DIGEST, SSH_DIGEST_SHA512, 0, 0, 0, 0 },\n#endif\n\t{ \"hmac-md5\",\t\t\t\tSSH_DIGEST, SSH_DIGEST_MD5, 0, 0, 0, 0 },\n\t{ \"hmac-md5-96\",\t\t\tSSH_DIGEST, SSH_DIGEST_MD5, 96, 0, 0, 0 },\n\t{ \"umac-64@openssh.com\",\t\tSSH_UMAC, 0, 0, 128, 64, 0 },\n\t{ \"umac-128@openssh.com\",\t\tSSH_UMAC128, 0, 0, 128, 128, 0 },\n\n\t/* Encrypt-then-MAC variants */\n\t{ \"hmac-sha1-etm@openssh.com\",\t\tSSH_DIGEST, SSH_DIGEST_SHA1, 0, 0, 0, 1 },\n\t{ \"hmac-sha1-96-etm@openssh.com\",\tSSH_DIGEST, SSH_DIGEST_SHA1, 96, 0, 0, 1 },\n#ifdef HAVE_EVP_SHA256\n\t{ \"hmac-sha2-256-etm@openssh.com\",\tSSH_DIGEST, SSH_DIGEST_SHA256, 0, 0, 0, 1 },\n\t{ \"hmac-sha2-512-etm@openssh.com\",\tSSH_DIGEST, SSH_DIGEST_SHA512, 0, 0, 0, 1 },\n#endif\n\t{ \"hmac-md5-etm@openssh.com\",\t\tSSH_DIGEST, SSH_DIGEST_MD5, 0, 0, 0, 1 },\n\t{ \"hmac-md5-96-etm@openssh.com\",\tSSH_DIGEST, SSH_DIGEST_MD5, 96, 0, 0, 1 },\n\t{ \"umac-64-etm@openssh.com\",\t\tSSH_UMAC, 0, 0, 128, 64, 1 },\n\t{ \"umac-128-etm@openssh.com\",\t\tSSH_UMAC128, 0, 0, 128, 128, 1 },\n\n\t{ NULL,\t\t\t\t\t0, 0, 0, 0, 0, 0 }\n};"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "memcpy",
          "args": [
            "ret + rlen",
            "m->name",
            "nlen + 1"
          ],
          "line": 102
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "free",
          "args": [
            "ret"
          ],
          "line": 98
        },
        "resolved": true,
        "details": {
          "function_name": "freeze",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/smult_curve25519_ref.c",
          "lines": "50-60",
          "snippet": "static void freeze(unsigned int a[32])\n{\n  unsigned int aorig[32];\n  unsigned int j;\n  unsigned int negative;\n\n  for (j = 0;j < 32;++j) aorig[j] = a[j];\n  add(a,a,minusp);\n  negative = -((a[31] >> 7) & 1);\n  for (j = 0;j < 32;++j) a[j] ^= negative & (aorig[j] ^ a[j]);\n}",
          "includes": [],
          "macros_used": [],
          "globals_used": [
            "static const unsigned int minusp[32] = {\n 19, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 128\n} ;"
          ],
          "called_functions": [],
          "contextual_snippet": "static const unsigned int minusp[32] = {\n 19, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 128\n} ;\n\nstatic void freeze(unsigned int a[32])\n{\n  unsigned int aorig[32];\n  unsigned int j;\n  unsigned int negative;\n\n  for (j = 0;j < 32;++j) aorig[j] = a[j];\n  add(a,a,minusp);\n  negative = -((a[31] >> 7) & 1);\n  for (j = 0;j < 32;++j) a[j] ^= negative & (aorig[j] ^ a[j]);\n}"
        }
      },
      {
        "call_info": {
          "callee": "realloc",
          "args": [
            "ret",
            "rlen + nlen + 2"
          ],
          "line": 97
        },
        "resolved": true,
        "details": {
          "function_name": "rpl_realloc",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/openbsd-compat/bsd-malloc.c",
          "lines": "48-56",
          "snippet": "void *\nrpl_realloc(void *ptr, size_t size)\n{\n\tif (size == 0)\n\t\tsize = 1;\n\tif (ptr == 0)\n\t\treturn malloc(size);\n\treturn realloc(ptr, size);\n}",
          "includes": [
            "#include <stdlib.h>",
            "#include <sys/types.h>",
            "#include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <stdlib.h>\n#include <sys/types.h>\n#include \"config.h\"\n\nvoid *\nrpl_realloc(void *ptr, size_t size)\n{\n\tif (size == 0)\n\t\tsize = 1;\n\tif (ptr == 0)\n\t\treturn malloc(size);\n\treturn realloc(ptr, size);\n}"
        }
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "m->name"
          ],
          "line": 96
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"openbsd-compat/openssl-compat.h\"\n#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"misc.h\"\n#include \"mac.h\"\n#include \"umac.h\"\n#include \"hmac.h\"\n#include \"digest.h\"\n#include <stdio.h>\n#include <string.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nstatic const struct macalg macs[] = {\n\t/* Encrypt-and-MAC (encrypt-and-authenticate) variants */\n\t{ \"hmac-sha1\",\t\t\t\tSSH_DIGEST, SSH_DIGEST_SHA1, 0, 0, 0, 0 },\n\t{ \"hmac-sha1-96\",\t\t\tSSH_DIGEST, SSH_DIGEST_SHA1, 96, 0, 0, 0 },\n#ifdef HAVE_EVP_SHA256\n\t{ \"hmac-sha2-256\",\t\t\tSSH_DIGEST, SSH_DIGEST_SHA256, 0, 0, 0, 0 },\n\t{ \"hmac-sha2-512\",\t\t\tSSH_DIGEST, SSH_DIGEST_SHA512, 0, 0, 0, 0 },\n#endif\n\t{ \"hmac-md5\",\t\t\t\tSSH_DIGEST, SSH_DIGEST_MD5, 0, 0, 0, 0 },\n\t{ \"hmac-md5-96\",\t\t\tSSH_DIGEST, SSH_DIGEST_MD5, 96, 0, 0, 0 },\n\t{ \"umac-64@openssh.com\",\t\tSSH_UMAC, 0, 0, 128, 64, 0 },\n\t{ \"umac-128@openssh.com\",\t\tSSH_UMAC128, 0, 0, 128, 128, 0 },\n\n\t/* Encrypt-then-MAC variants */\n\t{ \"hmac-sha1-etm@openssh.com\",\t\tSSH_DIGEST, SSH_DIGEST_SHA1, 0, 0, 0, 1 },\n\t{ \"hmac-sha1-96-etm@openssh.com\",\tSSH_DIGEST, SSH_DIGEST_SHA1, 96, 0, 0, 1 },\n#ifdef HAVE_EVP_SHA256\n\t{ \"hmac-sha2-256-etm@openssh.com\",\tSSH_DIGEST, SSH_DIGEST_SHA256, 0, 0, 0, 1 },\n\t{ \"hmac-sha2-512-etm@openssh.com\",\tSSH_DIGEST, SSH_DIGEST_SHA512, 0, 0, 0, 1 },\n#endif\n\t{ \"hmac-md5-etm@openssh.com\",\t\tSSH_DIGEST, SSH_DIGEST_MD5, 0, 0, 0, 1 },\n\t{ \"hmac-md5-96-etm@openssh.com\",\tSSH_DIGEST, SSH_DIGEST_MD5, 96, 0, 0, 1 },\n\t{ \"umac-64-etm@openssh.com\",\t\tSSH_UMAC, 0, 0, 128, 64, 1 },\n\t{ \"umac-128-etm@openssh.com\",\t\tSSH_UMAC128, 0, 0, 128, 128, 1 },\n\n\t{ NULL,\t\t\t\t\t0, 0, 0, 0, 0, 0 }\n};\n\nchar *\nmac_alg_list(char sep)\n{\n\tchar *ret = NULL, *tmp;\n\tsize_t nlen, rlen = 0;\n\tconst struct macalg *m;\n\n\tfor (m = macs; m->name != NULL; m++) {\n\t\tif (ret != NULL)\n\t\t\tret[rlen++] = sep;\n\t\tnlen = strlen(m->name);\n\t\tif ((tmp = realloc(ret, rlen + nlen + 2)) == NULL) {\n\t\t\tfree(ret);\n\t\t\treturn NULL;\n\t\t}\n\t\tret = tmp;\n\t\tmemcpy(ret + rlen, m->name, nlen + 1);\n\t\trlen += nlen;\n\t}\n\treturn ret;\n}"
  }
]