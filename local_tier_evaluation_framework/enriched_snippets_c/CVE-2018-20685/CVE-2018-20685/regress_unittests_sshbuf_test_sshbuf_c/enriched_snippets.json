[
  {
    "function_name": "sshbuf_tests",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/regress/unittests/sshbuf/test_sshbuf.c",
    "lines": "27-240",
    "snippet": "void\nsshbuf_tests(void)\n{\n\tstruct sshbuf *p1;\n\tconst u_char *cdp;\n\tu_char *dp;\n\tsize_t sz;\n\tint r;\n\n\tTEST_START(\"allocate sshbuf\");\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tTEST_DONE();\n\n\tTEST_START(\"max size on fresh buffer\");\n\tASSERT_SIZE_T_GT(sshbuf_max_size(p1), 0);\n\tTEST_DONE();\n\n\tTEST_START(\"available on fresh buffer\");\n\tASSERT_SIZE_T_GT(sshbuf_avail(p1), 0);\n\tTEST_DONE();\n\n\tTEST_START(\"len = 0 on empty buffer\");\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 0);\n\tTEST_DONE();\n\n\tTEST_START(\"set valid max size\");\n\tASSERT_INT_EQ(sshbuf_set_max_size(p1, 65536), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_max_size(p1), 65536);\n\tTEST_DONE();\n\n\tTEST_START(\"available on limited buffer\");\n\tASSERT_SIZE_T_EQ(sshbuf_avail(p1), 65536);\n\tTEST_DONE();\n\n\tTEST_START(\"free\");\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"consume on empty buffer\");\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_consume(p1, 0), 0);\n\tASSERT_INT_EQ(sshbuf_consume(p1, 1), SSH_ERR_MESSAGE_INCOMPLETE);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"consume_end on empty buffer\");\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_consume_end(p1, 0), 0);\n\tASSERT_INT_EQ(sshbuf_consume_end(p1, 1), SSH_ERR_MESSAGE_INCOMPLETE);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"reserve space\");\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tr = sshbuf_reserve(p1, 1, &dp);\n\tASSERT_INT_EQ(r, 0);\n\tASSERT_PTR_NE(dp, NULL);\n\t*dp = 0x11;\n\tr = sshbuf_reserve(p1, 3, &dp);\n\tASSERT_INT_EQ(r, 0);\n\tASSERT_PTR_NE(dp, NULL);\n\t*dp++ = 0x22;\n\t*dp++ = 0x33;\n\t*dp++ = 0x44;\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_len on filled buffer\");\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 4);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_ptr on filled buffer\");\n\tcdp = sshbuf_ptr(p1);\n\tASSERT_PTR_NE(cdp, NULL);\n\tASSERT_U8_EQ(cdp[0], 0x11);\n\tASSERT_U8_EQ(cdp[1], 0x22);\n\tASSERT_U8_EQ(cdp[2], 0x33);\n\tASSERT_U8_EQ(cdp[3], 0x44);\n\tTEST_DONE();\n\n\tTEST_START(\"consume on filled buffer\");\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 4);\n\tASSERT_INT_EQ(sshbuf_consume(p1, 0), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 4);\n\tr = sshbuf_consume(p1, 64);\n\tASSERT_INT_EQ(r, SSH_ERR_MESSAGE_INCOMPLETE);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 4);\n\tASSERT_INT_EQ(sshbuf_consume(p1, 1), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 3);\n\tcdp = sshbuf_ptr(p1);\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_U8_EQ(cdp[0], 0x22);\n\tASSERT_INT_EQ(sshbuf_consume(p1, 2), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 1);\n\tcdp = sshbuf_ptr(p1);\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_U8_EQ(cdp[0], 0x44);\n\tr = sshbuf_consume(p1, 2);\n\tASSERT_INT_EQ(r, SSH_ERR_MESSAGE_INCOMPLETE);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 1);\n\tASSERT_INT_EQ(sshbuf_consume(p1, 1), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 0);\n\tr = sshbuf_consume(p1, 1);\n\tASSERT_INT_EQ(r, SSH_ERR_MESSAGE_INCOMPLETE);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"consume_end on filled buffer\");\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tr = sshbuf_reserve(p1, 4, &dp);\n\tASSERT_INT_EQ(r, 0);\n\tASSERT_PTR_NE(dp, NULL);\n\t*dp++ = 0x11;\n\t*dp++ = 0x22;\n\t*dp++ = 0x33;\n\t*dp++ = 0x44;\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 4);\n\tr = sshbuf_consume_end(p1, 5);\n\tASSERT_INT_EQ(r, SSH_ERR_MESSAGE_INCOMPLETE);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 4);\n\tASSERT_INT_EQ(sshbuf_consume_end(p1, 3), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 1);\n\tcdp = sshbuf_ptr(p1);\n\tASSERT_PTR_NE(cdp, NULL);\n\tASSERT_U8_EQ(*cdp, 0x11);\n\tr = sshbuf_consume_end(p1, 2);\n\tASSERT_INT_EQ(r, SSH_ERR_MESSAGE_INCOMPLETE);\n\tASSERT_INT_EQ(sshbuf_consume_end(p1, 1), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 0);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"fill limited buffer\");\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_set_max_size(p1, 1223), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_max_size(p1), 1223);\n\tASSERT_SIZE_T_EQ(sshbuf_avail(p1), 1223);\n\tr = sshbuf_reserve(p1, 1223, &dp);\n\tASSERT_INT_EQ(r, 0);\n\tASSERT_PTR_NE(dp, NULL);\n\tmemset(dp, 0xd7, 1223);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 1223);\n\tASSERT_SIZE_T_EQ(sshbuf_avail(p1), 0);\n\tr = sshbuf_reserve(p1, 1, &dp);\n\tASSERT_INT_EQ(r, SSH_ERR_NO_BUFFER_SPACE);\n\tASSERT_PTR_EQ(dp, NULL);\n\tTEST_DONE();\n\n\tTEST_START(\"consume and force compaction\");\n\tASSERT_INT_EQ(sshbuf_consume(p1, 223), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 1000);\n\tASSERT_SIZE_T_EQ(sshbuf_avail(p1), 223);\n\tr = sshbuf_reserve(p1, 224, &dp);\n\tASSERT_INT_EQ(r, SSH_ERR_NO_BUFFER_SPACE);\n\tASSERT_PTR_EQ(dp, NULL);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 1000);\n\tASSERT_SIZE_T_EQ(sshbuf_avail(p1), 223);\n\tr = sshbuf_reserve(p1, 223, &dp);\n\tASSERT_INT_EQ(r, 0);\n\tASSERT_PTR_NE(dp, NULL);\n\tmemset(dp, 0x7d, 223);\n\tcdp = sshbuf_ptr(p1);\n\tASSERT_PTR_NE(cdp, NULL);\n\tASSERT_MEM_FILLED_EQ(cdp, 0xd7, 1000);\n\tASSERT_MEM_FILLED_EQ(cdp + 1000, 0x7d, 223);\n\tTEST_DONE();\n\n\tTEST_START(\"resize full buffer\");\n\tr = sshbuf_set_max_size(p1, 1000);\n\tASSERT_INT_EQ(r, SSH_ERR_NO_BUFFER_SPACE);\n\tsz = roundup(1223 + SSHBUF_SIZE_INC * 3, SSHBUF_SIZE_INC);\n\tASSERT_INT_EQ(sshbuf_set_max_size(p1, sz), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_max_size(p1), sz);\n\tASSERT_SIZE_T_EQ(sshbuf_avail(p1), sz - 1223);\n\tASSERT_INT_EQ(sshbuf_len(p1), 1223);\n\tTEST_DONE();\n\n\t/* NB. uses sshbuf internals */\n\tTEST_START(\"alloc chunking\");\n\tr = sshbuf_reserve(p1, 1, &dp);\n\tASSERT_INT_EQ(r, 0);\n\tASSERT_PTR_NE(dp, NULL);\n\t*dp = 0xff;\n\tcdp = sshbuf_ptr(p1);\n\tASSERT_PTR_NE(cdp, NULL);\n\tASSERT_MEM_FILLED_EQ(cdp, 0xd7, 1000);\n\tASSERT_MEM_FILLED_EQ(cdp + 1000, 0x7d, 223);\n\tASSERT_MEM_FILLED_EQ(cdp + 1223, 0xff, 1);\n\tASSERT_SIZE_T_EQ(sshbuf_alloc(p1) % SSHBUF_SIZE_INC, 0);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"reset buffer\");\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_set_max_size(p1, 1223), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_max_size(p1), 1223);\n\tr = sshbuf_reserve(p1, 1223, &dp);\n\tASSERT_INT_EQ(r, 0);\n\tASSERT_PTR_NE(dp, NULL);\n\tmemset(dp, 0xd7, 1223);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 1223);\n\tsshbuf_reset(p1);\n\tASSERT_SIZE_T_EQ(sshbuf_max_size(p1), 1223);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_avail(p1), 1223);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n}",
    "includes": [
      "#include \"sshbuf.h\"",
      "#include \"ssherr.h\"",
      "#include \"../test_helper/test_helper.h\"",
      "#include <string.h>",
      "#include <stdlib.h>",
      "# include <stdint.h>",
      "#include <stdio.h>",
      "#include <sys/param.h>",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "void sshbuf_tests(void);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "TEST_DONE",
          "args": [],
          "line": 239
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sshbuf_free",
          "args": [
            "p1"
          ],
          "line": 238
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf.c",
          "lines": "133-166",
          "snippet": "void\nsshbuf_free(struct sshbuf *buf)\n{\n\tif (buf == NULL)\n\t\treturn;\n\t/*\n\t * The following will leak on insane buffers, but this is the safest\n\t * course of action - an invalid pointer or already-freed pointer may\n\t * have been passed to us and continuing to scribble over memory would\n\t * be bad.\n\t */\n\tif (sshbuf_check_sanity(buf) != 0)\n\t\treturn;\n\t/*\n\t * If we are a child, the free our parent to decrement its reference\n\t * count and possibly free it.\n\t */\n\tsshbuf_free(buf->parent);\n\tbuf->parent = NULL;\n\t/*\n\t * If we are a parent with still-extant children, then don't free just\n\t * yet. The last child's call to sshbuf_free should decrement our\n\t * refcount to 0 and trigger the actual free.\n\t */\n\tbuf->refcount--;\n\tif (buf->refcount > 0)\n\t\treturn;\n\tif (!buf->readonly) {\n\t\texplicit_bzero(buf->d, buf->alloc);\n\t\tfree(buf->d);\n\t}\n\texplicit_bzero(buf, sizeof(*buf));\n\tfree(buf);\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <signal.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <signal.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\nsshbuf_free(struct sshbuf *buf)\n{\n\tif (buf == NULL)\n\t\treturn;\n\t/*\n\t * The following will leak on insane buffers, but this is the safest\n\t * course of action - an invalid pointer or already-freed pointer may\n\t * have been passed to us and continuing to scribble over memory would\n\t * be bad.\n\t */\n\tif (sshbuf_check_sanity(buf) != 0)\n\t\treturn;\n\t/*\n\t * If we are a child, the free our parent to decrement its reference\n\t * count and possibly free it.\n\t */\n\tsshbuf_free(buf->parent);\n\tbuf->parent = NULL;\n\t/*\n\t * If we are a parent with still-extant children, then don't free just\n\t * yet. The last child's call to sshbuf_free should decrement our\n\t * refcount to 0 and trigger the actual free.\n\t */\n\tbuf->refcount--;\n\tif (buf->refcount > 0)\n\t\treturn;\n\tif (!buf->readonly) {\n\t\texplicit_bzero(buf->d, buf->alloc);\n\t\tfree(buf->d);\n\t}\n\texplicit_bzero(buf, sizeof(*buf));\n\tfree(buf);\n}"
        }
      },
      {
        "call_info": {
          "callee": "ASSERT_SIZE_T_EQ",
          "args": [
            "sshbuf_avail(p1)",
            "1223"
          ],
          "line": 237
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sshbuf_avail",
          "args": [
            "p1"
          ],
          "line": 237
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_avail",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf.c",
          "lines": "260-266",
          "snippet": "size_t\nsshbuf_avail(const struct sshbuf *buf)\n{\n\tif (sshbuf_check_sanity(buf) != 0 || buf->readonly || buf->refcount > 1)\n\t\treturn 0;\n\treturn buf->max_size - (buf->size - buf->off);\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <signal.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <signal.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nsize_t\nsshbuf_avail(const struct sshbuf *buf)\n{\n\tif (sshbuf_check_sanity(buf) != 0 || buf->readonly || buf->refcount > 1)\n\t\treturn 0;\n\treturn buf->max_size - (buf->size - buf->off);\n}"
        }
      },
      {
        "call_info": {
          "callee": "ASSERT_SIZE_T_EQ",
          "args": [
            "sshbuf_len(p1)",
            "0"
          ],
          "line": 236
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sshbuf_len",
          "args": [
            "p1"
          ],
          "line": 236
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_len",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf.c",
          "lines": "252-258",
          "snippet": "size_t\nsshbuf_len(const struct sshbuf *buf)\n{\n\tif (sshbuf_check_sanity(buf) != 0)\n\t\treturn 0;\n\treturn buf->size - buf->off;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <signal.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <signal.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nsize_t\nsshbuf_len(const struct sshbuf *buf)\n{\n\tif (sshbuf_check_sanity(buf) != 0)\n\t\treturn 0;\n\treturn buf->size - buf->off;\n}"
        }
      },
      {
        "call_info": {
          "callee": "ASSERT_SIZE_T_EQ",
          "args": [
            "sshbuf_max_size(p1)",
            "1223"
          ],
          "line": 235
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sshbuf_max_size",
          "args": [
            "p1"
          ],
          "line": 235
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_max_size",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf.c",
          "lines": "190-194",
          "snippet": "size_t\nsshbuf_max_size(const struct sshbuf *buf)\n{\n\treturn buf->max_size;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <signal.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <signal.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nsize_t\nsshbuf_max_size(const struct sshbuf *buf)\n{\n\treturn buf->max_size;\n}"
        }
      },
      {
        "call_info": {
          "callee": "sshbuf_reset",
          "args": [
            "p1"
          ],
          "line": 234
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_reset",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf.c",
          "lines": "168-188",
          "snippet": "void\nsshbuf_reset(struct sshbuf *buf)\n{\n\tu_char *d;\n\n\tif (buf->readonly || buf->refcount > 1) {\n\t\t/* Nonsensical. Just make buffer appear empty */\n\t\tbuf->off = buf->size;\n\t\treturn;\n\t}\n\t(void) sshbuf_check_sanity(buf);\n\tbuf->off = buf->size = 0;\n\tif (buf->alloc != SSHBUF_SIZE_INIT) {\n\t\tif ((d = recallocarray(buf->d, buf->alloc, SSHBUF_SIZE_INIT,\n\t\t    1)) != NULL) {\n\t\t\tbuf->cd = buf->d = d;\n\t\t\tbuf->alloc = SSHBUF_SIZE_INIT;\n\t\t}\n\t}\n\texplicit_bzero(buf->d, SSHBUF_SIZE_INIT);\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <signal.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <signal.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\nsshbuf_reset(struct sshbuf *buf)\n{\n\tu_char *d;\n\n\tif (buf->readonly || buf->refcount > 1) {\n\t\t/* Nonsensical. Just make buffer appear empty */\n\t\tbuf->off = buf->size;\n\t\treturn;\n\t}\n\t(void) sshbuf_check_sanity(buf);\n\tbuf->off = buf->size = 0;\n\tif (buf->alloc != SSHBUF_SIZE_INIT) {\n\t\tif ((d = recallocarray(buf->d, buf->alloc, SSHBUF_SIZE_INIT,\n\t\t    1)) != NULL) {\n\t\t\tbuf->cd = buf->d = d;\n\t\t\tbuf->alloc = SSHBUF_SIZE_INIT;\n\t\t}\n\t}\n\texplicit_bzero(buf->d, SSHBUF_SIZE_INIT);\n}"
        }
      },
      {
        "call_info": {
          "callee": "ASSERT_SIZE_T_EQ",
          "args": [
            "sshbuf_len(p1)",
            "1223"
          ],
          "line": 233
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memset",
          "args": [
            "dp",
            "0xd7",
            "1223"
          ],
          "line": 232
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASSERT_PTR_NE",
          "args": [
            "dp",
            "NULL"
          ],
          "line": 231
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASSERT_INT_EQ",
          "args": [
            "r",
            "0"
          ],
          "line": 230
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sshbuf_reserve",
          "args": [
            "p1",
            "1223",
            "&dp"
          ],
          "line": 229
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_reserve",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf.c",
          "lines": "343-361",
          "snippet": "int\nsshbuf_reserve(struct sshbuf *buf, size_t len, u_char **dpp)\n{\n\tu_char *dp;\n\tint r;\n\n\tif (dpp != NULL)\n\t\t*dpp = NULL;\n\n\tSSHBUF_DBG((\"reserve buf = %p len = %zu\", buf, len));\n\tif ((r = sshbuf_allocate(buf, len)) != 0)\n\t\treturn r;\n\n\tdp = buf->d + buf->size;\n\tbuf->size += len;\n\tif (dpp != NULL)\n\t\t*dpp = dp;\n\treturn 0;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <signal.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <signal.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshbuf_reserve(struct sshbuf *buf, size_t len, u_char **dpp)\n{\n\tu_char *dp;\n\tint r;\n\n\tif (dpp != NULL)\n\t\t*dpp = NULL;\n\n\tSSHBUF_DBG((\"reserve buf = %p len = %zu\", buf, len));\n\tif ((r = sshbuf_allocate(buf, len)) != 0)\n\t\treturn r;\n\n\tdp = buf->d + buf->size;\n\tbuf->size += len;\n\tif (dpp != NULL)\n\t\t*dpp = dp;\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "ASSERT_SIZE_T_EQ",
          "args": [
            "sshbuf_max_size(p1)",
            "1223"
          ],
          "line": 228
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASSERT_INT_EQ",
          "args": [
            "sshbuf_set_max_size(p1, 1223)",
            "0"
          ],
          "line": 227
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sshbuf_set_max_size",
          "args": [
            "p1",
            "1223"
          ],
          "line": 227
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_set_max_size",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf.c",
          "lines": "214-250",
          "snippet": "int\nsshbuf_set_max_size(struct sshbuf *buf, size_t max_size)\n{\n\tsize_t rlen;\n\tu_char *dp;\n\tint r;\n\n\tSSHBUF_DBG((\"set max buf = %p len = %zu\", buf, max_size));\n\tif ((r = sshbuf_check_sanity(buf)) != 0)\n\t\treturn r;\n\tif (max_size == buf->max_size)\n\t\treturn 0;\n\tif (buf->readonly || buf->refcount > 1)\n\t\treturn SSH_ERR_BUFFER_READ_ONLY;\n\tif (max_size > SSHBUF_SIZE_MAX)\n\t\treturn SSH_ERR_NO_BUFFER_SPACE;\n\t/* pack and realloc if necessary */\n\tsshbuf_maybe_pack(buf, max_size < buf->size);\n\tif (max_size < buf->alloc && max_size > buf->size) {\n\t\tif (buf->size < SSHBUF_SIZE_INIT)\n\t\t\trlen = SSHBUF_SIZE_INIT;\n\t\telse\n\t\t\trlen = ROUNDUP(buf->size, SSHBUF_SIZE_INC);\n\t\tif (rlen > max_size)\n\t\t\trlen = max_size;\n\t\tSSHBUF_DBG((\"new alloc = %zu\", rlen));\n\t\tif ((dp = recallocarray(buf->d, buf->alloc, rlen, 1)) == NULL)\n\t\t\treturn SSH_ERR_ALLOC_FAIL;\n\t\tbuf->cd = buf->d = dp;\n\t\tbuf->alloc = rlen;\n\t}\n\tSSHBUF_TELL(\"new-max\");\n\tif (max_size < buf->alloc)\n\t\treturn SSH_ERR_NO_BUFFER_SPACE;\n\tbuf->max_size = max_size;\n\treturn 0;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <signal.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <signal.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshbuf_set_max_size(struct sshbuf *buf, size_t max_size)\n{\n\tsize_t rlen;\n\tu_char *dp;\n\tint r;\n\n\tSSHBUF_DBG((\"set max buf = %p len = %zu\", buf, max_size));\n\tif ((r = sshbuf_check_sanity(buf)) != 0)\n\t\treturn r;\n\tif (max_size == buf->max_size)\n\t\treturn 0;\n\tif (buf->readonly || buf->refcount > 1)\n\t\treturn SSH_ERR_BUFFER_READ_ONLY;\n\tif (max_size > SSHBUF_SIZE_MAX)\n\t\treturn SSH_ERR_NO_BUFFER_SPACE;\n\t/* pack and realloc if necessary */\n\tsshbuf_maybe_pack(buf, max_size < buf->size);\n\tif (max_size < buf->alloc && max_size > buf->size) {\n\t\tif (buf->size < SSHBUF_SIZE_INIT)\n\t\t\trlen = SSHBUF_SIZE_INIT;\n\t\telse\n\t\t\trlen = ROUNDUP(buf->size, SSHBUF_SIZE_INC);\n\t\tif (rlen > max_size)\n\t\t\trlen = max_size;\n\t\tSSHBUF_DBG((\"new alloc = %zu\", rlen));\n\t\tif ((dp = recallocarray(buf->d, buf->alloc, rlen, 1)) == NULL)\n\t\t\treturn SSH_ERR_ALLOC_FAIL;\n\t\tbuf->cd = buf->d = dp;\n\t\tbuf->alloc = rlen;\n\t}\n\tSSHBUF_TELL(\"new-max\");\n\tif (max_size < buf->alloc)\n\t\treturn SSH_ERR_NO_BUFFER_SPACE;\n\tbuf->max_size = max_size;\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "ASSERT_PTR_NE",
          "args": [
            "p1",
            "NULL"
          ],
          "line": 226
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sshbuf_new",
          "args": [],
          "line": 225
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_new",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf.c",
          "lines": "68-85",
          "snippet": "struct sshbuf *\nsshbuf_new(void)\n{\n\tstruct sshbuf *ret;\n\n\tif ((ret = calloc(sizeof(*ret), 1)) == NULL)\n\t\treturn NULL;\n\tret->alloc = SSHBUF_SIZE_INIT;\n\tret->max_size = SSHBUF_SIZE_MAX;\n\tret->readonly = 0;\n\tret->refcount = 1;\n\tret->parent = NULL;\n\tif ((ret->cd = ret->d = calloc(1, ret->alloc)) == NULL) {\n\t\tfree(ret);\n\t\treturn NULL;\n\t}\n\treturn ret;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <signal.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <signal.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nstruct sshbuf *\nsshbuf_new(void)\n{\n\tstruct sshbuf *ret;\n\n\tif ((ret = calloc(sizeof(*ret), 1)) == NULL)\n\t\treturn NULL;\n\tret->alloc = SSHBUF_SIZE_INIT;\n\tret->max_size = SSHBUF_SIZE_MAX;\n\tret->readonly = 0;\n\tret->refcount = 1;\n\tret->parent = NULL;\n\tif ((ret->cd = ret->d = calloc(1, ret->alloc)) == NULL) {\n\t\tfree(ret);\n\t\treturn NULL;\n\t}\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "TEST_START",
          "args": [
            "\"reset buffer\""
          ],
          "line": 224
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "TEST_DONE",
          "args": [],
          "line": 222
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASSERT_SIZE_T_EQ",
          "args": [
            "sshbuf_alloc(p1) % SSHBUF_SIZE_INC",
            "0"
          ],
          "line": 220
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sshbuf_alloc",
          "args": [
            "p1"
          ],
          "line": 220
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_alloc",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf.c",
          "lines": "196-200",
          "snippet": "size_t\nsshbuf_alloc(const struct sshbuf *buf)\n{\n\treturn buf->alloc;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <signal.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <signal.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nsize_t\nsshbuf_alloc(const struct sshbuf *buf)\n{\n\treturn buf->alloc;\n}"
        }
      },
      {
        "call_info": {
          "callee": "ASSERT_MEM_FILLED_EQ",
          "args": [
            "cdp + 1223",
            "0xff",
            "1"
          ],
          "line": 219
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASSERT_MEM_FILLED_EQ",
          "args": [
            "cdp + 1000",
            "0x7d",
            "223"
          ],
          "line": 218
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASSERT_MEM_FILLED_EQ",
          "args": [
            "cdp",
            "0xd7",
            "1000"
          ],
          "line": 217
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASSERT_PTR_NE",
          "args": [
            "cdp",
            "NULL"
          ],
          "line": 216
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sshbuf_ptr",
          "args": [
            "p1"
          ],
          "line": 215
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_ptr",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf.c",
          "lines": "268-274",
          "snippet": "const u_char *\nsshbuf_ptr(const struct sshbuf *buf)\n{\n\tif (sshbuf_check_sanity(buf) != 0)\n\t\treturn NULL;\n\treturn buf->cd + buf->off;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <signal.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <signal.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nconst u_char *\nsshbuf_ptr(const struct sshbuf *buf)\n{\n\tif (sshbuf_check_sanity(buf) != 0)\n\t\treturn NULL;\n\treturn buf->cd + buf->off;\n}"
        }
      },
      {
        "call_info": {
          "callee": "ASSERT_PTR_NE",
          "args": [
            "dp",
            "NULL"
          ],
          "line": 213
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASSERT_INT_EQ",
          "args": [
            "r",
            "0"
          ],
          "line": 212
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "TEST_START",
          "args": [
            "\"alloc chunking\""
          ],
          "line": 210
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "TEST_DONE",
          "args": [],
          "line": 207
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASSERT_INT_EQ",
          "args": [
            "sshbuf_len(p1)",
            "1223"
          ],
          "line": 206
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASSERT_SIZE_T_EQ",
          "args": [
            "sshbuf_avail(p1)",
            "sz - 1223"
          ],
          "line": 205
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASSERT_SIZE_T_EQ",
          "args": [
            "sshbuf_max_size(p1)",
            "sz"
          ],
          "line": 204
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASSERT_INT_EQ",
          "args": [
            "sshbuf_set_max_size(p1, sz)",
            "0"
          ],
          "line": 203
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "roundup",
          "args": [
            "1223 + SSHBUF_SIZE_INC * 3",
            "SSHBUF_SIZE_INC"
          ],
          "line": 202
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASSERT_INT_EQ",
          "args": [
            "r",
            "SSH_ERR_NO_BUFFER_SPACE"
          ],
          "line": 201
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "TEST_START",
          "args": [
            "\"resize full buffer\""
          ],
          "line": 199
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "TEST_DONE",
          "args": [],
          "line": 197
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASSERT_MEM_FILLED_EQ",
          "args": [
            "cdp + 1000",
            "0x7d",
            "223"
          ],
          "line": 196
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASSERT_MEM_FILLED_EQ",
          "args": [
            "cdp",
            "0xd7",
            "1000"
          ],
          "line": 195
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASSERT_PTR_NE",
          "args": [
            "cdp",
            "NULL"
          ],
          "line": 194
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memset",
          "args": [
            "dp",
            "0x7d",
            "223"
          ],
          "line": 192
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASSERT_PTR_NE",
          "args": [
            "dp",
            "NULL"
          ],
          "line": 191
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASSERT_INT_EQ",
          "args": [
            "r",
            "0"
          ],
          "line": 190
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASSERT_SIZE_T_EQ",
          "args": [
            "sshbuf_avail(p1)",
            "223"
          ],
          "line": 188
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASSERT_SIZE_T_EQ",
          "args": [
            "sshbuf_len(p1)",
            "1000"
          ],
          "line": 187
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASSERT_PTR_EQ",
          "args": [
            "dp",
            "NULL"
          ],
          "line": 186
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASSERT_INT_EQ",
          "args": [
            "r",
            "SSH_ERR_NO_BUFFER_SPACE"
          ],
          "line": 185
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASSERT_SIZE_T_EQ",
          "args": [
            "sshbuf_avail(p1)",
            "223"
          ],
          "line": 183
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASSERT_SIZE_T_EQ",
          "args": [
            "sshbuf_len(p1)",
            "1000"
          ],
          "line": 182
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASSERT_INT_EQ",
          "args": [
            "sshbuf_consume(p1, 223)",
            "0"
          ],
          "line": 181
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sshbuf_consume",
          "args": [
            "p1",
            "223"
          ],
          "line": 181
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_consume_end",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf.c",
          "lines": "383-398",
          "snippet": "int\nsshbuf_consume_end(struct sshbuf *buf, size_t len)\n{\n\tint r;\n\n\tSSHBUF_DBG((\"len = %zu\", len));\n\tif ((r = sshbuf_check_sanity(buf)) != 0)\n\t\treturn r;\n\tif (len == 0)\n\t\treturn 0;\n\tif (len > sshbuf_len(buf))\n\t\treturn SSH_ERR_MESSAGE_INCOMPLETE;\n\tbuf->size -= len;\n\tSSHBUF_TELL(\"done\");\n\treturn 0;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <signal.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <signal.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshbuf_consume_end(struct sshbuf *buf, size_t len)\n{\n\tint r;\n\n\tSSHBUF_DBG((\"len = %zu\", len));\n\tif ((r = sshbuf_check_sanity(buf)) != 0)\n\t\treturn r;\n\tif (len == 0)\n\t\treturn 0;\n\tif (len > sshbuf_len(buf))\n\t\treturn SSH_ERR_MESSAGE_INCOMPLETE;\n\tbuf->size -= len;\n\tSSHBUF_TELL(\"done\");\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "TEST_START",
          "args": [
            "\"consume and force compaction\""
          ],
          "line": 180
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "TEST_DONE",
          "args": [],
          "line": 178
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASSERT_PTR_EQ",
          "args": [
            "dp",
            "NULL"
          ],
          "line": 177
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASSERT_INT_EQ",
          "args": [
            "r",
            "SSH_ERR_NO_BUFFER_SPACE"
          ],
          "line": 176
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASSERT_SIZE_T_EQ",
          "args": [
            "sshbuf_avail(p1)",
            "0"
          ],
          "line": 174
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASSERT_SIZE_T_EQ",
          "args": [
            "sshbuf_len(p1)",
            "1223"
          ],
          "line": 173
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memset",
          "args": [
            "dp",
            "0xd7",
            "1223"
          ],
          "line": 172
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASSERT_PTR_NE",
          "args": [
            "dp",
            "NULL"
          ],
          "line": 171
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASSERT_INT_EQ",
          "args": [
            "r",
            "0"
          ],
          "line": 170
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASSERT_SIZE_T_EQ",
          "args": [
            "sshbuf_avail(p1)",
            "1223"
          ],
          "line": 168
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASSERT_SIZE_T_EQ",
          "args": [
            "sshbuf_max_size(p1)",
            "1223"
          ],
          "line": 167
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASSERT_INT_EQ",
          "args": [
            "sshbuf_set_max_size(p1, 1223)",
            "0"
          ],
          "line": 166
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASSERT_PTR_NE",
          "args": [
            "p1",
            "NULL"
          ],
          "line": 165
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "TEST_START",
          "args": [
            "\"fill limited buffer\""
          ],
          "line": 163
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "TEST_DONE",
          "args": [],
          "line": 161
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASSERT_SIZE_T_EQ",
          "args": [
            "sshbuf_len(p1)",
            "0"
          ],
          "line": 159
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASSERT_INT_EQ",
          "args": [
            "sshbuf_consume_end(p1, 1)",
            "0"
          ],
          "line": 158
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASSERT_INT_EQ",
          "args": [
            "r",
            "SSH_ERR_MESSAGE_INCOMPLETE"
          ],
          "line": 157
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASSERT_U8_EQ",
          "args": [
            "*cdp",
            "0x11"
          ],
          "line": 155
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASSERT_PTR_NE",
          "args": [
            "cdp",
            "NULL"
          ],
          "line": 154
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASSERT_SIZE_T_EQ",
          "args": [
            "sshbuf_len(p1)",
            "1"
          ],
          "line": 152
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASSERT_INT_EQ",
          "args": [
            "sshbuf_consume_end(p1, 3)",
            "0"
          ],
          "line": 151
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASSERT_SIZE_T_EQ",
          "args": [
            "sshbuf_len(p1)",
            "4"
          ],
          "line": 150
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASSERT_INT_EQ",
          "args": [
            "r",
            "SSH_ERR_MESSAGE_INCOMPLETE"
          ],
          "line": 149
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASSERT_SIZE_T_EQ",
          "args": [
            "sshbuf_len(p1)",
            "4"
          ],
          "line": 147
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASSERT_PTR_NE",
          "args": [
            "dp",
            "NULL"
          ],
          "line": 142
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASSERT_INT_EQ",
          "args": [
            "r",
            "0"
          ],
          "line": 141
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASSERT_PTR_NE",
          "args": [
            "p1",
            "NULL"
          ],
          "line": 139
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "TEST_START",
          "args": [
            "\"consume_end on filled buffer\""
          ],
          "line": 137
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "TEST_DONE",
          "args": [],
          "line": 135
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASSERT_INT_EQ",
          "args": [
            "r",
            "SSH_ERR_MESSAGE_INCOMPLETE"
          ],
          "line": 133
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASSERT_SIZE_T_EQ",
          "args": [
            "sshbuf_len(p1)",
            "0"
          ],
          "line": 131
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASSERT_INT_EQ",
          "args": [
            "sshbuf_consume(p1, 1)",
            "0"
          ],
          "line": 130
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASSERT_SIZE_T_EQ",
          "args": [
            "sshbuf_len(p1)",
            "1"
          ],
          "line": 129
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASSERT_INT_EQ",
          "args": [
            "r",
            "SSH_ERR_MESSAGE_INCOMPLETE"
          ],
          "line": 128
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASSERT_U8_EQ",
          "args": [
            "cdp[0]",
            "0x44"
          ],
          "line": 126
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASSERT_PTR_NE",
          "args": [
            "p1",
            "NULL"
          ],
          "line": 125
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASSERT_SIZE_T_EQ",
          "args": [
            "sshbuf_len(p1)",
            "1"
          ],
          "line": 123
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASSERT_INT_EQ",
          "args": [
            "sshbuf_consume(p1, 2)",
            "0"
          ],
          "line": 122
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASSERT_U8_EQ",
          "args": [
            "cdp[0]",
            "0x22"
          ],
          "line": 121
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASSERT_PTR_NE",
          "args": [
            "p1",
            "NULL"
          ],
          "line": 120
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASSERT_SIZE_T_EQ",
          "args": [
            "sshbuf_len(p1)",
            "3"
          ],
          "line": 118
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASSERT_INT_EQ",
          "args": [
            "sshbuf_consume(p1, 1)",
            "0"
          ],
          "line": 117
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASSERT_SIZE_T_EQ",
          "args": [
            "sshbuf_len(p1)",
            "4"
          ],
          "line": 116
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASSERT_INT_EQ",
          "args": [
            "r",
            "SSH_ERR_MESSAGE_INCOMPLETE"
          ],
          "line": 115
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASSERT_SIZE_T_EQ",
          "args": [
            "sshbuf_len(p1)",
            "4"
          ],
          "line": 113
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASSERT_INT_EQ",
          "args": [
            "sshbuf_consume(p1, 0)",
            "0"
          ],
          "line": 112
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASSERT_SIZE_T_EQ",
          "args": [
            "sshbuf_len(p1)",
            "4"
          ],
          "line": 111
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "TEST_START",
          "args": [
            "\"consume on filled buffer\""
          ],
          "line": 110
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "TEST_DONE",
          "args": [],
          "line": 108
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASSERT_U8_EQ",
          "args": [
            "cdp[3]",
            "0x44"
          ],
          "line": 107
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASSERT_U8_EQ",
          "args": [
            "cdp[2]",
            "0x33"
          ],
          "line": 106
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASSERT_U8_EQ",
          "args": [
            "cdp[1]",
            "0x22"
          ],
          "line": 105
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASSERT_U8_EQ",
          "args": [
            "cdp[0]",
            "0x11"
          ],
          "line": 104
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASSERT_PTR_NE",
          "args": [
            "cdp",
            "NULL"
          ],
          "line": 103
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "TEST_START",
          "args": [
            "\"sshbuf_ptr on filled buffer\""
          ],
          "line": 101
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "TEST_DONE",
          "args": [],
          "line": 99
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASSERT_SIZE_T_EQ",
          "args": [
            "sshbuf_len(p1)",
            "4"
          ],
          "line": 98
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "TEST_START",
          "args": [
            "\"sshbuf_len on filled buffer\""
          ],
          "line": 97
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "TEST_DONE",
          "args": [],
          "line": 95
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASSERT_PTR_NE",
          "args": [
            "dp",
            "NULL"
          ],
          "line": 91
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASSERT_INT_EQ",
          "args": [
            "r",
            "0"
          ],
          "line": 90
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASSERT_PTR_NE",
          "args": [
            "dp",
            "NULL"
          ],
          "line": 87
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASSERT_INT_EQ",
          "args": [
            "r",
            "0"
          ],
          "line": 86
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASSERT_PTR_NE",
          "args": [
            "p1",
            "NULL"
          ],
          "line": 84
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "TEST_START",
          "args": [
            "\"reserve space\""
          ],
          "line": 82
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "TEST_DONE",
          "args": [],
          "line": 80
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASSERT_INT_EQ",
          "args": [
            "sshbuf_consume_end(p1, 1)",
            "SSH_ERR_MESSAGE_INCOMPLETE"
          ],
          "line": 78
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASSERT_INT_EQ",
          "args": [
            "sshbuf_consume_end(p1, 0)",
            "0"
          ],
          "line": 77
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASSERT_PTR_NE",
          "args": [
            "p1",
            "NULL"
          ],
          "line": 76
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "TEST_START",
          "args": [
            "\"consume_end on empty buffer\""
          ],
          "line": 74
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "TEST_DONE",
          "args": [],
          "line": 72
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASSERT_INT_EQ",
          "args": [
            "sshbuf_consume(p1, 1)",
            "SSH_ERR_MESSAGE_INCOMPLETE"
          ],
          "line": 70
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASSERT_INT_EQ",
          "args": [
            "sshbuf_consume(p1, 0)",
            "0"
          ],
          "line": 69
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASSERT_PTR_NE",
          "args": [
            "p1",
            "NULL"
          ],
          "line": 68
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "TEST_START",
          "args": [
            "\"consume on empty buffer\""
          ],
          "line": 66
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "TEST_DONE",
          "args": [],
          "line": 64
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "TEST_START",
          "args": [
            "\"free\""
          ],
          "line": 62
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "TEST_DONE",
          "args": [],
          "line": 60
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASSERT_SIZE_T_EQ",
          "args": [
            "sshbuf_avail(p1)",
            "65536"
          ],
          "line": 59
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "TEST_START",
          "args": [
            "\"available on limited buffer\""
          ],
          "line": 58
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "TEST_DONE",
          "args": [],
          "line": 56
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASSERT_SIZE_T_EQ",
          "args": [
            "sshbuf_max_size(p1)",
            "65536"
          ],
          "line": 55
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASSERT_INT_EQ",
          "args": [
            "sshbuf_set_max_size(p1, 65536)",
            "0"
          ],
          "line": 54
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "TEST_START",
          "args": [
            "\"set valid max size\""
          ],
          "line": 53
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "TEST_DONE",
          "args": [],
          "line": 51
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASSERT_SIZE_T_EQ",
          "args": [
            "sshbuf_len(p1)",
            "0"
          ],
          "line": 50
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "TEST_START",
          "args": [
            "\"len = 0 on empty buffer\""
          ],
          "line": 49
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "TEST_DONE",
          "args": [],
          "line": 47
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASSERT_SIZE_T_GT",
          "args": [
            "sshbuf_avail(p1)",
            "0"
          ],
          "line": 46
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "TEST_START",
          "args": [
            "\"available on fresh buffer\""
          ],
          "line": 45
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "TEST_DONE",
          "args": [],
          "line": 43
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASSERT_SIZE_T_GT",
          "args": [
            "sshbuf_max_size(p1)",
            "0"
          ],
          "line": 42
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "TEST_START",
          "args": [
            "\"max size on fresh buffer\""
          ],
          "line": 41
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "TEST_DONE",
          "args": [],
          "line": 39
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASSERT_PTR_NE",
          "args": [
            "p1",
            "NULL"
          ],
          "line": 38
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "TEST_START",
          "args": [
            "\"allocate sshbuf\""
          ],
          "line": 36
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"../test_helper/test_helper.h\"\n#include <string.h>\n#include <stdlib.h>\n# include <stdint.h>\n#include <stdio.h>\n#include <sys/param.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid sshbuf_tests(void);\n\nvoid\nsshbuf_tests(void)\n{\n\tstruct sshbuf *p1;\n\tconst u_char *cdp;\n\tu_char *dp;\n\tsize_t sz;\n\tint r;\n\n\tTEST_START(\"allocate sshbuf\");\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tTEST_DONE();\n\n\tTEST_START(\"max size on fresh buffer\");\n\tASSERT_SIZE_T_GT(sshbuf_max_size(p1), 0);\n\tTEST_DONE();\n\n\tTEST_START(\"available on fresh buffer\");\n\tASSERT_SIZE_T_GT(sshbuf_avail(p1), 0);\n\tTEST_DONE();\n\n\tTEST_START(\"len = 0 on empty buffer\");\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 0);\n\tTEST_DONE();\n\n\tTEST_START(\"set valid max size\");\n\tASSERT_INT_EQ(sshbuf_set_max_size(p1, 65536), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_max_size(p1), 65536);\n\tTEST_DONE();\n\n\tTEST_START(\"available on limited buffer\");\n\tASSERT_SIZE_T_EQ(sshbuf_avail(p1), 65536);\n\tTEST_DONE();\n\n\tTEST_START(\"free\");\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"consume on empty buffer\");\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_consume(p1, 0), 0);\n\tASSERT_INT_EQ(sshbuf_consume(p1, 1), SSH_ERR_MESSAGE_INCOMPLETE);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"consume_end on empty buffer\");\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_consume_end(p1, 0), 0);\n\tASSERT_INT_EQ(sshbuf_consume_end(p1, 1), SSH_ERR_MESSAGE_INCOMPLETE);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"reserve space\");\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tr = sshbuf_reserve(p1, 1, &dp);\n\tASSERT_INT_EQ(r, 0);\n\tASSERT_PTR_NE(dp, NULL);\n\t*dp = 0x11;\n\tr = sshbuf_reserve(p1, 3, &dp);\n\tASSERT_INT_EQ(r, 0);\n\tASSERT_PTR_NE(dp, NULL);\n\t*dp++ = 0x22;\n\t*dp++ = 0x33;\n\t*dp++ = 0x44;\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_len on filled buffer\");\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 4);\n\tTEST_DONE();\n\n\tTEST_START(\"sshbuf_ptr on filled buffer\");\n\tcdp = sshbuf_ptr(p1);\n\tASSERT_PTR_NE(cdp, NULL);\n\tASSERT_U8_EQ(cdp[0], 0x11);\n\tASSERT_U8_EQ(cdp[1], 0x22);\n\tASSERT_U8_EQ(cdp[2], 0x33);\n\tASSERT_U8_EQ(cdp[3], 0x44);\n\tTEST_DONE();\n\n\tTEST_START(\"consume on filled buffer\");\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 4);\n\tASSERT_INT_EQ(sshbuf_consume(p1, 0), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 4);\n\tr = sshbuf_consume(p1, 64);\n\tASSERT_INT_EQ(r, SSH_ERR_MESSAGE_INCOMPLETE);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 4);\n\tASSERT_INT_EQ(sshbuf_consume(p1, 1), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 3);\n\tcdp = sshbuf_ptr(p1);\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_U8_EQ(cdp[0], 0x22);\n\tASSERT_INT_EQ(sshbuf_consume(p1, 2), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 1);\n\tcdp = sshbuf_ptr(p1);\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_U8_EQ(cdp[0], 0x44);\n\tr = sshbuf_consume(p1, 2);\n\tASSERT_INT_EQ(r, SSH_ERR_MESSAGE_INCOMPLETE);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 1);\n\tASSERT_INT_EQ(sshbuf_consume(p1, 1), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 0);\n\tr = sshbuf_consume(p1, 1);\n\tASSERT_INT_EQ(r, SSH_ERR_MESSAGE_INCOMPLETE);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"consume_end on filled buffer\");\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tr = sshbuf_reserve(p1, 4, &dp);\n\tASSERT_INT_EQ(r, 0);\n\tASSERT_PTR_NE(dp, NULL);\n\t*dp++ = 0x11;\n\t*dp++ = 0x22;\n\t*dp++ = 0x33;\n\t*dp++ = 0x44;\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 4);\n\tr = sshbuf_consume_end(p1, 5);\n\tASSERT_INT_EQ(r, SSH_ERR_MESSAGE_INCOMPLETE);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 4);\n\tASSERT_INT_EQ(sshbuf_consume_end(p1, 3), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 1);\n\tcdp = sshbuf_ptr(p1);\n\tASSERT_PTR_NE(cdp, NULL);\n\tASSERT_U8_EQ(*cdp, 0x11);\n\tr = sshbuf_consume_end(p1, 2);\n\tASSERT_INT_EQ(r, SSH_ERR_MESSAGE_INCOMPLETE);\n\tASSERT_INT_EQ(sshbuf_consume_end(p1, 1), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 0);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"fill limited buffer\");\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_set_max_size(p1, 1223), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_max_size(p1), 1223);\n\tASSERT_SIZE_T_EQ(sshbuf_avail(p1), 1223);\n\tr = sshbuf_reserve(p1, 1223, &dp);\n\tASSERT_INT_EQ(r, 0);\n\tASSERT_PTR_NE(dp, NULL);\n\tmemset(dp, 0xd7, 1223);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 1223);\n\tASSERT_SIZE_T_EQ(sshbuf_avail(p1), 0);\n\tr = sshbuf_reserve(p1, 1, &dp);\n\tASSERT_INT_EQ(r, SSH_ERR_NO_BUFFER_SPACE);\n\tASSERT_PTR_EQ(dp, NULL);\n\tTEST_DONE();\n\n\tTEST_START(\"consume and force compaction\");\n\tASSERT_INT_EQ(sshbuf_consume(p1, 223), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 1000);\n\tASSERT_SIZE_T_EQ(sshbuf_avail(p1), 223);\n\tr = sshbuf_reserve(p1, 224, &dp);\n\tASSERT_INT_EQ(r, SSH_ERR_NO_BUFFER_SPACE);\n\tASSERT_PTR_EQ(dp, NULL);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 1000);\n\tASSERT_SIZE_T_EQ(sshbuf_avail(p1), 223);\n\tr = sshbuf_reserve(p1, 223, &dp);\n\tASSERT_INT_EQ(r, 0);\n\tASSERT_PTR_NE(dp, NULL);\n\tmemset(dp, 0x7d, 223);\n\tcdp = sshbuf_ptr(p1);\n\tASSERT_PTR_NE(cdp, NULL);\n\tASSERT_MEM_FILLED_EQ(cdp, 0xd7, 1000);\n\tASSERT_MEM_FILLED_EQ(cdp + 1000, 0x7d, 223);\n\tTEST_DONE();\n\n\tTEST_START(\"resize full buffer\");\n\tr = sshbuf_set_max_size(p1, 1000);\n\tASSERT_INT_EQ(r, SSH_ERR_NO_BUFFER_SPACE);\n\tsz = roundup(1223 + SSHBUF_SIZE_INC * 3, SSHBUF_SIZE_INC);\n\tASSERT_INT_EQ(sshbuf_set_max_size(p1, sz), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_max_size(p1), sz);\n\tASSERT_SIZE_T_EQ(sshbuf_avail(p1), sz - 1223);\n\tASSERT_INT_EQ(sshbuf_len(p1), 1223);\n\tTEST_DONE();\n\n\t/* NB. uses sshbuf internals */\n\tTEST_START(\"alloc chunking\");\n\tr = sshbuf_reserve(p1, 1, &dp);\n\tASSERT_INT_EQ(r, 0);\n\tASSERT_PTR_NE(dp, NULL);\n\t*dp = 0xff;\n\tcdp = sshbuf_ptr(p1);\n\tASSERT_PTR_NE(cdp, NULL);\n\tASSERT_MEM_FILLED_EQ(cdp, 0xd7, 1000);\n\tASSERT_MEM_FILLED_EQ(cdp + 1000, 0x7d, 223);\n\tASSERT_MEM_FILLED_EQ(cdp + 1223, 0xff, 1);\n\tASSERT_SIZE_T_EQ(sshbuf_alloc(p1) % SSHBUF_SIZE_INC, 0);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n\n\tTEST_START(\"reset buffer\");\n\tp1 = sshbuf_new();\n\tASSERT_PTR_NE(p1, NULL);\n\tASSERT_INT_EQ(sshbuf_set_max_size(p1, 1223), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_max_size(p1), 1223);\n\tr = sshbuf_reserve(p1, 1223, &dp);\n\tASSERT_INT_EQ(r, 0);\n\tASSERT_PTR_NE(dp, NULL);\n\tmemset(dp, 0xd7, 1223);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 1223);\n\tsshbuf_reset(p1);\n\tASSERT_SIZE_T_EQ(sshbuf_max_size(p1), 1223);\n\tASSERT_SIZE_T_EQ(sshbuf_len(p1), 0);\n\tASSERT_SIZE_T_EQ(sshbuf_avail(p1), 1223);\n\tsshbuf_free(p1);\n\tTEST_DONE();\n}"
  }
]