[
  {
    "function_name": "main",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/openbsd-compat/regress/snprintftest.c",
    "lines": "46-73",
    "snippet": "int\nmain(void)\n{\n\tchar b[5];\n\tchar *src;\n\n\tsnprintf(b,5,\"123456789\");\n\tif (b[4] != '\\0')\n\t\tfail(\"snprintf does not correctly terminate long strings\");\n\n\t/* check for read overrun on unterminated string */\n\tif ((src = malloc(BUFSZ)) == NULL) {\n\t\tfail(\"malloc failed\");\n\t} else {\n\t\tmemset(src, 'a', BUFSZ);\n\t\tsnprintf(b, sizeof(b), \"%.*s\", 1, src);\n\t\tif (strcmp(b, \"a\") != 0)\n\t\t\tfail(\"failed with length limit '%%.s'\");\n\t}\n\n\t/* check that snprintf and vsnprintf return sane values */\n\tif (snprintf(b, 1, \"%s %d\", \"hello\", 12345) != 11)\n\t\tfail(\"snprintf does not return required length\");\n\tif (x_snprintf(b, 1, \"%s %d\", \"hello\", 12345) != 11)\n\t\tfail(\"vsnprintf does not return required length\");\n\n\treturn failed;\n}",
    "includes": [
      "#include <string.h>",
      "#include <stdarg.h>",
      "#include <stdio.h>",
      "#include <stdlib.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [
      "#define BUFSZ 2048"
    ],
    "globals_used": [
      "static int failed = 0;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "fail",
          "args": [
            "\"vsnprintf does not return required length\""
          ],
          "line": 70
        },
        "resolved": true,
        "details": {
          "function_name": "fail",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/openbsd-compat/regress/snprintftest.c",
          "lines": "28-33",
          "snippet": "static void\nfail(const char *m)\n{\n\tfprintf(stderr, \"snprintftest: %s\\n\", m);\n\tfailed = 1;\n}",
          "includes": [
            "#include <string.h>",
            "#include <stdarg.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int failed = 0;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <stdarg.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <sys/types.h>\n\nstatic int failed = 0;\n\nstatic void\nfail(const char *m)\n{\n\tfprintf(stderr, \"snprintftest: %s\\n\", m);\n\tfailed = 1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "x_snprintf",
          "args": [
            "b",
            "1",
            "\"%s %d\"",
            "\"hello\"",
            "12345"
          ],
          "line": 69
        },
        "resolved": true,
        "details": {
          "function_name": "x_snprintf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/openbsd-compat/regress/snprintftest.c",
          "lines": "35-44",
          "snippet": "int x_snprintf(char *str, size_t count, const char *fmt, ...)\n{\n\tsize_t ret;\n\tva_list ap;\n\n\tva_start(ap, fmt);\n\tret = vsnprintf(str, count, fmt, ap);\n\tva_end(ap);\n\treturn ret;\n}",
          "includes": [
            "#include <string.h>",
            "#include <stdarg.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <stdarg.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <sys/types.h>\n\nint x_snprintf(char *str, size_t count, const char *fmt, ...)\n{\n\tsize_t ret;\n\tva_list ap;\n\n\tva_start(ap, fmt);\n\tret = vsnprintf(str, count, fmt, ap);\n\tva_end(ap);\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "b",
            "\"a\""
          ],
          "line": 62
        },
        "resolved": true,
        "details": {
          "function_name": "strcmp_maybe_null",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/misc.c",
          "lines": "1550-1558",
          "snippet": "static int\nstrcmp_maybe_null(const char *a, const char *b)\n{\n\tif ((a == NULL && b != NULL) || (a != NULL && b == NULL))\n\t\treturn 0;\n\tif (a != NULL && strcmp(a, b) != 0)\n\t\treturn 0;\n\treturn 1;\n}",
          "includes": [
            "#include \"platform.h\"",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"ssh.h\"",
            "#include \"log.h\"",
            "#include \"misc.h\"",
            "#include \"xmalloc.h\"",
            "#include <net/if.h>",
            "#include <pwd.h>",
            "# include <paths.h>",
            "#include <netdb.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <ctype.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/tcp.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in_systm.h>",
            "#include <netinet/in.h>",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <libgen.h>",
            "#include <limits.h>",
            "#include <sys/un.h>",
            "#include <sys/wait.h>",
            "#include <sys/time.h>",
            "#include <sys/stat.h>",
            "#include <sys/socket.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"platform.h\"\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"ssh.h\"\n#include \"log.h\"\n#include \"misc.h\"\n#include \"xmalloc.h\"\n#include <net/if.h>\n#include <pwd.h>\n# include <paths.h>\n#include <netdb.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <ctype.h>\n#include <arpa/inet.h>\n#include <netinet/tcp.h>\n#include <netinet/ip.h>\n#include <netinet/in_systm.h>\n#include <netinet/in.h>\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <libgen.h>\n#include <limits.h>\n#include <sys/un.h>\n#include <sys/wait.h>\n#include <sys/time.h>\n#include <sys/stat.h>\n#include <sys/socket.h>\n#include <sys/ioctl.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nstatic int\nstrcmp_maybe_null(const char *a, const char *b)\n{\n\tif ((a == NULL && b != NULL) || (a != NULL && b == NULL))\n\t\treturn 0;\n\tif (a != NULL && strcmp(a, b) != 0)\n\t\treturn 0;\n\treturn 1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "memset",
          "args": [
            "src",
            "'a'",
            "BUFSZ"
          ],
          "line": 60
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "malloc",
          "args": [
            "BUFSZ"
          ],
          "line": 57
        },
        "resolved": true,
        "details": {
          "function_name": "xmalloc",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/xmalloc.c",
          "lines": "39-50",
          "snippet": "void *\nxmalloc(size_t size)\n{\n\tvoid *ptr;\n\n\tif (size == 0)\n\t\tfatal(\"xmalloc: zero size\");\n\tptr = malloc(size);\n\tif (ptr == NULL)\n\t\tfatal(\"xmalloc: out of memory (allocating %zu bytes)\", size);\n\treturn ptr;\n}",
          "includes": [
            "#include \"log.h\"",
            "#include \"xmalloc.h\"",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdint.h>",
            "#include <stdarg.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n#include \"xmalloc.h\"\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdint.h>\n#include <stdarg.h>\n#include \"includes.h\"\n\nvoid *\nxmalloc(size_t size)\n{\n\tvoid *ptr;\n\n\tif (size == 0)\n\t\tfatal(\"xmalloc: zero size\");\n\tptr = malloc(size);\n\tif (ptr == NULL)\n\t\tfatal(\"xmalloc: out of memory (allocating %zu bytes)\", size);\n\treturn ptr;\n}"
        }
      }
    ],
    "contextual_snippet": "#include <string.h>\n#include <stdarg.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <sys/types.h>\n\n#define BUFSZ 2048\n\nstatic int failed = 0;\n\nint\nmain(void)\n{\n\tchar b[5];\n\tchar *src;\n\n\tsnprintf(b,5,\"123456789\");\n\tif (b[4] != '\\0')\n\t\tfail(\"snprintf does not correctly terminate long strings\");\n\n\t/* check for read overrun on unterminated string */\n\tif ((src = malloc(BUFSZ)) == NULL) {\n\t\tfail(\"malloc failed\");\n\t} else {\n\t\tmemset(src, 'a', BUFSZ);\n\t\tsnprintf(b, sizeof(b), \"%.*s\", 1, src);\n\t\tif (strcmp(b, \"a\") != 0)\n\t\t\tfail(\"failed with length limit '%%.s'\");\n\t}\n\n\t/* check that snprintf and vsnprintf return sane values */\n\tif (snprintf(b, 1, \"%s %d\", \"hello\", 12345) != 11)\n\t\tfail(\"snprintf does not return required length\");\n\tif (x_snprintf(b, 1, \"%s %d\", \"hello\", 12345) != 11)\n\t\tfail(\"vsnprintf does not return required length\");\n\n\treturn failed;\n}"
  },
  {
    "function_name": "x_snprintf",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/openbsd-compat/regress/snprintftest.c",
    "lines": "35-44",
    "snippet": "int x_snprintf(char *str, size_t count, const char *fmt, ...)\n{\n\tsize_t ret;\n\tva_list ap;\n\n\tva_start(ap, fmt);\n\tret = vsnprintf(str, count, fmt, ap);\n\tva_end(ap);\n\treturn ret;\n}",
    "includes": [
      "#include <string.h>",
      "#include <stdarg.h>",
      "#include <stdio.h>",
      "#include <stdlib.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "va_end",
          "args": [
            "ap"
          ],
          "line": 42
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "vsnprintf",
          "args": [
            "str",
            "count",
            "fmt",
            "ap"
          ],
          "line": 41
        },
        "resolved": true,
        "details": {
          "function_name": "vsnprintf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/openbsd-compat/bsd-snprintf.c",
          "lines": "861-865",
          "snippet": "int\nvsnprintf (char *str, size_t count, const char *fmt, va_list args)\n{\n\treturn dopr(str, count, fmt, args);\n}",
          "includes": [
            "#include <errno.h>",
            "#include <limits.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdarg.h>",
            "#include <ctype.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <errno.h>\n#include <limits.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdarg.h>\n#include <ctype.h>\n#include \"includes.h\"\n\nint\nvsnprintf (char *str, size_t count, const char *fmt, va_list args)\n{\n\treturn dopr(str, count, fmt, args);\n}"
        }
      },
      {
        "call_info": {
          "callee": "va_start",
          "args": [
            "ap",
            "fmt"
          ],
          "line": 40
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <string.h>\n#include <stdarg.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <sys/types.h>\n\nint x_snprintf(char *str, size_t count, const char *fmt, ...)\n{\n\tsize_t ret;\n\tva_list ap;\n\n\tva_start(ap, fmt);\n\tret = vsnprintf(str, count, fmt, ap);\n\tva_end(ap);\n\treturn ret;\n}"
  },
  {
    "function_name": "fail",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/openbsd-compat/regress/snprintftest.c",
    "lines": "28-33",
    "snippet": "static void\nfail(const char *m)\n{\n\tfprintf(stderr, \"snprintftest: %s\\n\", m);\n\tfailed = 1;\n}",
    "includes": [
      "#include <string.h>",
      "#include <stdarg.h>",
      "#include <stdio.h>",
      "#include <stdlib.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static int failed = 0;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"snprintftest: %s\\n\"",
            "m"
          ],
          "line": 31
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <string.h>\n#include <stdarg.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <sys/types.h>\n\nstatic int failed = 0;\n\nstatic void\nfail(const char *m)\n{\n\tfprintf(stderr, \"snprintftest: %s\\n\", m);\n\tfailed = 1;\n}"
  }
]