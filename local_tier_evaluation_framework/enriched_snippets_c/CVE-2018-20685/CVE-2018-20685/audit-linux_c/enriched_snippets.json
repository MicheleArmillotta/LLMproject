[
  {
    "function_name": "audit_event",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/audit-linux.c",
    "lines": "99-125",
    "snippet": "void\naudit_event(ssh_audit_event_t event)\n{\n\tstruct ssh *ssh = active_state; /* XXX */\n\n\tswitch(event) {\n\tcase SSH_AUTH_SUCCESS:\n\tcase SSH_CONNECTION_CLOSE:\n\tcase SSH_NOLOGIN:\n\tcase SSH_LOGIN_EXCEED_MAXTRIES:\n\tcase SSH_LOGIN_ROOT_DENIED:\n\t\tbreak;\n\tcase SSH_AUTH_FAIL_NONE:\n\tcase SSH_AUTH_FAIL_PASSWD:\n\tcase SSH_AUTH_FAIL_KBDINT:\n\tcase SSH_AUTH_FAIL_PUBKEY:\n\tcase SSH_AUTH_FAIL_HOSTBASED:\n\tcase SSH_AUTH_FAIL_GSSAPI:\n\tcase SSH_INVALID_USER:\n\t\tlinux_audit_record_event(-1, audit_username(), NULL,\n\t\t    ssh_remote_ipaddr(ssh), \"sshd\", 0);\n\t\tbreak;\n\tdefault:\n\t\tdebug(\"%s: unhandled event %d\", __func__, event);\n\t\tbreak;\n\t}\n}",
    "includes": [
      "#include \"packet.h\"",
      "#include \"canohost.h\"",
      "#include \"audit.h\"",
      "#include \"log.h\"",
      "#include <string.h>",
      "#include <unistd.h>",
      "#include <libaudit.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "debug",
          "args": [
            "\"%s: unhandled event %d\"",
            "__func__",
            "event"
          ],
          "line": 122
        },
        "resolved": true,
        "details": {
          "function_name": "debug3",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/log.c",
          "lines": "242-250",
          "snippet": "void\ndebug3(const char *fmt,...)\n{\n\tva_list args;\n\n\tva_start(args, fmt);\n\tdo_log(SYSLOG_LEVEL_DEBUG3, fmt, args);\n\tva_end(args);\n}",
          "includes": [
            "#include \"log.h\"",
            "# include <vis.h>",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <syslog.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <fcntl.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n# include <vis.h>\n#include <errno.h>\n#include <unistd.h>\n#include <syslog.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <fcntl.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\ndebug3(const char *fmt,...)\n{\n\tva_list args;\n\n\tva_start(args, fmt);\n\tdo_log(SYSLOG_LEVEL_DEBUG3, fmt, args);\n\tva_end(args);\n}"
        }
      },
      {
        "call_info": {
          "callee": "linux_audit_record_event",
          "args": [
            "-1",
            "audit_username()",
            "NULL",
            "ssh_remote_ipaddr(ssh)",
            "\"sshd\"",
            "0"
          ],
          "line": 118
        },
        "resolved": true,
        "details": {
          "function_name": "linux_audit_record_event",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/audit-linux.c",
          "lines": "41-69",
          "snippet": "int\nlinux_audit_record_event(int uid, const char *username, const char *hostname,\n    const char *ip, const char *ttyn, int success)\n{\n\tint audit_fd, rc, saved_errno;\n\n\tif ((audit_fd = audit_open()) < 0) {\n\t\tif (errno == EINVAL || errno == EPROTONOSUPPORT ||\n\t\t    errno == EAFNOSUPPORT)\n\t\t\treturn 1; /* No audit support in kernel */\n\t\telse\n\t\t\treturn 0; /* Must prevent login */\n\t}\n\trc = audit_log_acct_message(audit_fd, AUDIT_USER_LOGIN,\n\t    NULL, \"login\", username ? username : \"(unknown)\",\n\t    username == NULL ? uid : -1, hostname, ip, ttyn, success);\n\tsaved_errno = errno;\n\tclose(audit_fd);\n\n\t/*\n\t * Do not report error if the error is EPERM and sshd is run as non\n\t * root user.\n\t */\n\tif ((rc == -EPERM) && (geteuid() != 0))\n\t\trc = 0;\n\terrno = saved_errno;\n\n\treturn rc >= 0;\n}",
          "includes": [
            "#include \"packet.h\"",
            "#include \"canohost.h\"",
            "#include \"audit.h\"",
            "#include \"log.h\"",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <libaudit.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"packet.h\"\n#include \"canohost.h\"\n#include \"audit.h\"\n#include \"log.h\"\n#include <string.h>\n#include <unistd.h>\n#include <libaudit.h>\n#include \"includes.h\"\n\nint\nlinux_audit_record_event(int uid, const char *username, const char *hostname,\n    const char *ip, const char *ttyn, int success)\n{\n\tint audit_fd, rc, saved_errno;\n\n\tif ((audit_fd = audit_open()) < 0) {\n\t\tif (errno == EINVAL || errno == EPROTONOSUPPORT ||\n\t\t    errno == EAFNOSUPPORT)\n\t\t\treturn 1; /* No audit support in kernel */\n\t\telse\n\t\t\treturn 0; /* Must prevent login */\n\t}\n\trc = audit_log_acct_message(audit_fd, AUDIT_USER_LOGIN,\n\t    NULL, \"login\", username ? username : \"(unknown)\",\n\t    username == NULL ? uid : -1, hostname, ip, ttyn, success);\n\tsaved_errno = errno;\n\tclose(audit_fd);\n\n\t/*\n\t * Do not report error if the error is EPERM and sshd is run as non\n\t * root user.\n\t */\n\tif ((rc == -EPERM) && (geteuid() != 0))\n\t\trc = 0;\n\terrno = saved_errno;\n\n\treturn rc >= 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "ssh_remote_ipaddr",
          "args": [
            "ssh"
          ],
          "line": 119
        },
        "resolved": true,
        "details": {
          "function_name": "ssh_remote_ipaddr",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
          "lines": "514-535",
          "snippet": "const char *\nssh_remote_ipaddr(struct ssh *ssh)\n{\n\tint sock;\n\n\t/* Check whether we have cached the ipaddr. */\n\tif (ssh->remote_ipaddr == NULL) {\n\t\tif (ssh_packet_connection_is_on_socket(ssh)) {\n\t\t\tsock = ssh->state->connection_in;\n\t\t\tssh->remote_ipaddr = get_peer_ipaddr(sock);\n\t\t\tssh->remote_port = get_peer_port(sock);\n\t\t\tssh->local_ipaddr = get_local_ipaddr(sock);\n\t\t\tssh->local_port = get_local_port(sock);\n\t\t} else {\n\t\t\tssh->remote_ipaddr = strdup(\"UNKNOWN\");\n\t\t\tssh->remote_port = 65535;\n\t\t\tssh->local_ipaddr = strdup(\"UNKNOWN\");\n\t\t\tssh->local_port = 65535;\n\t\t}\n\t}\n\treturn ssh->remote_ipaddr;\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include \"packet.h\"",
            "#include \"ssh.h\"",
            "#include \"channels.h\"",
            "#include \"misc.h\"",
            "#include \"canohost.h\"",
            "#include \"log.h\"",
            "#include \"mac.h\"",
            "#include \"digest.h\"",
            "#include \"kex.h\"",
            "#include \"sshkey.h\"",
            "#include \"cipher.h\"",
            "#include \"ssh2.h\"",
            "#include \"compat.h\"",
            "#include \"crc32.h\"",
            "#include \"xmalloc.h\"",
            "#include <zlib.h>",
            "#  include <openssl/ec.h>",
            "# include <openssl/evp.h>",
            "# include <openssl/bn.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <limits.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <netdb.h>",
            "#include <errno.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include \"openbsd-compat/sys-queue.h\"",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nconst char *\nssh_remote_ipaddr(struct ssh *ssh)\n{\n\tint sock;\n\n\t/* Check whether we have cached the ipaddr. */\n\tif (ssh->remote_ipaddr == NULL) {\n\t\tif (ssh_packet_connection_is_on_socket(ssh)) {\n\t\t\tsock = ssh->state->connection_in;\n\t\t\tssh->remote_ipaddr = get_peer_ipaddr(sock);\n\t\t\tssh->remote_port = get_peer_port(sock);\n\t\t\tssh->local_ipaddr = get_local_ipaddr(sock);\n\t\t\tssh->local_port = get_local_port(sock);\n\t\t} else {\n\t\t\tssh->remote_ipaddr = strdup(\"UNKNOWN\");\n\t\t\tssh->remote_port = 65535;\n\t\t\tssh->local_ipaddr = strdup(\"UNKNOWN\");\n\t\t\tssh->local_port = 65535;\n\t\t}\n\t}\n\treturn ssh->remote_ipaddr;\n}"
        }
      },
      {
        "call_info": {
          "callee": "audit_username",
          "args": [],
          "line": 118
        },
        "resolved": true,
        "details": {
          "function_name": "audit_username",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/audit.c",
          "lines": "69-80",
          "snippet": "const char *\naudit_username(void)\n{\n\tstatic const char unknownuser[] = \"(unknown user)\";\n\tstatic const char invaliduser[] = \"(invalid user)\";\n\n\tif (the_authctxt == NULL || the_authctxt->user == NULL)\n\t\treturn (unknownuser);\n\tif (!the_authctxt->valid)\n\t\treturn (invaliduser);\n\treturn (the_authctxt->user);\n}",
          "includes": [
            "#include \"auth.h\"",
            "#include \"hostfile.h\"",
            "#include \"log.h\"",
            "#include \"audit.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdarg.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"auth.h\"\n#include \"hostfile.h\"\n#include \"log.h\"\n#include \"audit.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdarg.h>\n#include \"includes.h\"\n\nconst char *\naudit_username(void)\n{\n\tstatic const char unknownuser[] = \"(unknown user)\";\n\tstatic const char invaliduser[] = \"(invalid user)\";\n\n\tif (the_authctxt == NULL || the_authctxt->user == NULL)\n\t\treturn (unknownuser);\n\tif (!the_authctxt->valid)\n\t\treturn (invaliduser);\n\treturn (the_authctxt->user);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"packet.h\"\n#include \"canohost.h\"\n#include \"audit.h\"\n#include \"log.h\"\n#include <string.h>\n#include <unistd.h>\n#include <libaudit.h>\n#include \"includes.h\"\n\nvoid\naudit_event(ssh_audit_event_t event)\n{\n\tstruct ssh *ssh = active_state; /* XXX */\n\n\tswitch(event) {\n\tcase SSH_AUTH_SUCCESS:\n\tcase SSH_CONNECTION_CLOSE:\n\tcase SSH_NOLOGIN:\n\tcase SSH_LOGIN_EXCEED_MAXTRIES:\n\tcase SSH_LOGIN_ROOT_DENIED:\n\t\tbreak;\n\tcase SSH_AUTH_FAIL_NONE:\n\tcase SSH_AUTH_FAIL_PASSWD:\n\tcase SSH_AUTH_FAIL_KBDINT:\n\tcase SSH_AUTH_FAIL_PUBKEY:\n\tcase SSH_AUTH_FAIL_HOSTBASED:\n\tcase SSH_AUTH_FAIL_GSSAPI:\n\tcase SSH_INVALID_USER:\n\t\tlinux_audit_record_event(-1, audit_username(), NULL,\n\t\t    ssh_remote_ipaddr(ssh), \"sshd\", 0);\n\t\tbreak;\n\tdefault:\n\t\tdebug(\"%s: unhandled event %d\", __func__, event);\n\t\tbreak;\n\t}\n}"
  },
  {
    "function_name": "audit_session_close",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/audit-linux.c",
    "lines": "93-97",
    "snippet": "void\naudit_session_close(struct logininfo *li)\n{\n\t/* not implemented */\n}",
    "includes": [
      "#include \"packet.h\"",
      "#include \"canohost.h\"",
      "#include \"audit.h\"",
      "#include \"log.h\"",
      "#include <string.h>",
      "#include <unistd.h>",
      "#include <libaudit.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"packet.h\"\n#include \"canohost.h\"\n#include \"audit.h\"\n#include \"log.h\"\n#include <string.h>\n#include <unistd.h>\n#include <libaudit.h>\n#include \"includes.h\"\n\nvoid\naudit_session_close(struct logininfo *li)\n{\n\t/* not implemented */\n}"
  },
  {
    "function_name": "audit_session_open",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/audit-linux.c",
    "lines": "85-91",
    "snippet": "void\naudit_session_open(struct logininfo *li)\n{\n\tif (linux_audit_record_event(li->uid, NULL, li->hostname, NULL,\n\t    li->line, 1) == 0)\n\t\tfatal(\"linux_audit_write_entry failed: %s\", strerror(errno));\n}",
    "includes": [
      "#include \"packet.h\"",
      "#include \"canohost.h\"",
      "#include \"audit.h\"",
      "#include \"log.h\"",
      "#include <string.h>",
      "#include <unistd.h>",
      "#include <libaudit.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "fatal",
          "args": [
            "\"linux_audit_write_entry failed: %s\"",
            "strerror(errno)"
          ],
          "line": 90
        },
        "resolved": true,
        "details": {
          "function_name": "match_test_missing_fatal",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/servconf.c",
          "lines": "988-993",
          "snippet": "static void\nmatch_test_missing_fatal(const char *criteria, const char *attrib)\n{\n\tfatal(\"'Match %s' in configuration but '%s' not in connection \"\n\t    \"test specification.\", criteria, attrib);\n}",
          "includes": [
            "#include \"digest.h\"",
            "#include \"myproposal.h\"",
            "#include \"auth.h\"",
            "#include \"hostfile.h\"",
            "#include \"ssherr.h\"",
            "#include \"packet.h\"",
            "#include \"canohost.h\"",
            "#include \"groupaccess.h\"",
            "#include \"channels.h\"",
            "#include \"match.h\"",
            "#include \"mac.h\"",
            "#include \"kex.h\"",
            "#include \"sshkey.h\"",
            "#include \"cipher.h\"",
            "#include \"pathnames.h\"",
            "#include \"compat.h\"",
            "#include \"servconf.h\"",
            "#include \"misc.h\"",
            "#include \"sshbuf.h\"",
            "#include \"log.h\"",
            "#include \"ssh.h\"",
            "#include \"xmalloc.h\"",
            "#include \"openbsd-compat/sys-queue.h\"",
            "#include <util.h>",
            "#include <errno.h>",
            "#include <stdarg.h>",
            "#include <limits.h>",
            "#include <unistd.h>",
            "#include <signal.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <pwd.h>",
            "#include <netdb.h>",
            "#include <ctype.h>",
            "#include <net/route.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in_systm.h>",
            "#include <netinet/in.h>",
            "#include <sys/sysctl.h>",
            "#include <sys/socket.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"digest.h\"\n#include \"myproposal.h\"\n#include \"auth.h\"\n#include \"hostfile.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"canohost.h\"\n#include \"groupaccess.h\"\n#include \"channels.h\"\n#include \"match.h\"\n#include \"mac.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"pathnames.h\"\n#include \"compat.h\"\n#include \"servconf.h\"\n#include \"misc.h\"\n#include \"sshbuf.h\"\n#include \"log.h\"\n#include \"ssh.h\"\n#include \"xmalloc.h\"\n#include \"openbsd-compat/sys-queue.h\"\n#include <util.h>\n#include <errno.h>\n#include <stdarg.h>\n#include <limits.h>\n#include <unistd.h>\n#include <signal.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <netdb.h>\n#include <ctype.h>\n#include <net/route.h>\n#include <netinet/ip.h>\n#include <netinet/in_systm.h>\n#include <netinet/in.h>\n#include <sys/sysctl.h>\n#include <sys/socket.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nstatic void\nmatch_test_missing_fatal(const char *criteria, const char *attrib)\n{\n\tfatal(\"'Match %s' in configuration but '%s' not in connection \"\n\t    \"test specification.\", criteria, attrib);\n}"
        }
      },
      {
        "call_info": {
          "callee": "strerror",
          "args": [
            "errno"
          ],
          "line": 90
        },
        "resolved": true,
        "details": {
          "function_name": "ssh_gai_strerror",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/misc.c",
          "lines": "140-146",
          "snippet": "const char *\nssh_gai_strerror(int gaierr)\n{\n\tif (gaierr == EAI_SYSTEM && errno != 0)\n\t\treturn strerror(errno);\n\treturn gai_strerror(gaierr);\n}",
          "includes": [
            "#include \"platform.h\"",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"ssh.h\"",
            "#include \"log.h\"",
            "#include \"misc.h\"",
            "#include \"xmalloc.h\"",
            "#include <net/if.h>",
            "#include <pwd.h>",
            "# include <paths.h>",
            "#include <netdb.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <ctype.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/tcp.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in_systm.h>",
            "#include <netinet/in.h>",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <libgen.h>",
            "#include <limits.h>",
            "#include <sys/un.h>",
            "#include <sys/wait.h>",
            "#include <sys/time.h>",
            "#include <sys/stat.h>",
            "#include <sys/socket.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"platform.h\"\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"ssh.h\"\n#include \"log.h\"\n#include \"misc.h\"\n#include \"xmalloc.h\"\n#include <net/if.h>\n#include <pwd.h>\n# include <paths.h>\n#include <netdb.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <ctype.h>\n#include <arpa/inet.h>\n#include <netinet/tcp.h>\n#include <netinet/ip.h>\n#include <netinet/in_systm.h>\n#include <netinet/in.h>\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <libgen.h>\n#include <limits.h>\n#include <sys/un.h>\n#include <sys/wait.h>\n#include <sys/time.h>\n#include <sys/stat.h>\n#include <sys/socket.h>\n#include <sys/ioctl.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nconst char *\nssh_gai_strerror(int gaierr)\n{\n\tif (gaierr == EAI_SYSTEM && errno != 0)\n\t\treturn strerror(errno);\n\treturn gai_strerror(gaierr);\n}"
        }
      },
      {
        "call_info": {
          "callee": "linux_audit_record_event",
          "args": [
            "li->uid",
            "NULL",
            "li->hostname",
            "NULL",
            "li->line",
            "1"
          ],
          "line": 88
        },
        "resolved": true,
        "details": {
          "function_name": "linux_audit_record_event",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/audit-linux.c",
          "lines": "41-69",
          "snippet": "int\nlinux_audit_record_event(int uid, const char *username, const char *hostname,\n    const char *ip, const char *ttyn, int success)\n{\n\tint audit_fd, rc, saved_errno;\n\n\tif ((audit_fd = audit_open()) < 0) {\n\t\tif (errno == EINVAL || errno == EPROTONOSUPPORT ||\n\t\t    errno == EAFNOSUPPORT)\n\t\t\treturn 1; /* No audit support in kernel */\n\t\telse\n\t\t\treturn 0; /* Must prevent login */\n\t}\n\trc = audit_log_acct_message(audit_fd, AUDIT_USER_LOGIN,\n\t    NULL, \"login\", username ? username : \"(unknown)\",\n\t    username == NULL ? uid : -1, hostname, ip, ttyn, success);\n\tsaved_errno = errno;\n\tclose(audit_fd);\n\n\t/*\n\t * Do not report error if the error is EPERM and sshd is run as non\n\t * root user.\n\t */\n\tif ((rc == -EPERM) && (geteuid() != 0))\n\t\trc = 0;\n\terrno = saved_errno;\n\n\treturn rc >= 0;\n}",
          "includes": [
            "#include \"packet.h\"",
            "#include \"canohost.h\"",
            "#include \"audit.h\"",
            "#include \"log.h\"",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <libaudit.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"packet.h\"\n#include \"canohost.h\"\n#include \"audit.h\"\n#include \"log.h\"\n#include <string.h>\n#include <unistd.h>\n#include <libaudit.h>\n#include \"includes.h\"\n\nint\nlinux_audit_record_event(int uid, const char *username, const char *hostname,\n    const char *ip, const char *ttyn, int success)\n{\n\tint audit_fd, rc, saved_errno;\n\n\tif ((audit_fd = audit_open()) < 0) {\n\t\tif (errno == EINVAL || errno == EPROTONOSUPPORT ||\n\t\t    errno == EAFNOSUPPORT)\n\t\t\treturn 1; /* No audit support in kernel */\n\t\telse\n\t\t\treturn 0; /* Must prevent login */\n\t}\n\trc = audit_log_acct_message(audit_fd, AUDIT_USER_LOGIN,\n\t    NULL, \"login\", username ? username : \"(unknown)\",\n\t    username == NULL ? uid : -1, hostname, ip, ttyn, success);\n\tsaved_errno = errno;\n\tclose(audit_fd);\n\n\t/*\n\t * Do not report error if the error is EPERM and sshd is run as non\n\t * root user.\n\t */\n\tif ((rc == -EPERM) && (geteuid() != 0))\n\t\trc = 0;\n\terrno = saved_errno;\n\n\treturn rc >= 0;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"packet.h\"\n#include \"canohost.h\"\n#include \"audit.h\"\n#include \"log.h\"\n#include <string.h>\n#include <unistd.h>\n#include <libaudit.h>\n#include \"includes.h\"\n\nvoid\naudit_session_open(struct logininfo *li)\n{\n\tif (linux_audit_record_event(li->uid, NULL, li->hostname, NULL,\n\t    li->line, 1) == 0)\n\t\tfatal(\"linux_audit_write_entry failed: %s\", strerror(errno));\n}"
  },
  {
    "function_name": "audit_run_command",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/audit-linux.c",
    "lines": "79-83",
    "snippet": "void\naudit_run_command(const char *command)\n{\n\t/* not implemented */\n}",
    "includes": [
      "#include \"packet.h\"",
      "#include \"canohost.h\"",
      "#include \"audit.h\"",
      "#include \"log.h\"",
      "#include <string.h>",
      "#include <unistd.h>",
      "#include <libaudit.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"packet.h\"\n#include \"canohost.h\"\n#include \"audit.h\"\n#include \"log.h\"\n#include <string.h>\n#include <unistd.h>\n#include <libaudit.h>\n#include \"includes.h\"\n\nvoid\naudit_run_command(const char *command)\n{\n\t/* not implemented */\n}"
  },
  {
    "function_name": "audit_connection_from",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/audit-linux.c",
    "lines": "73-77",
    "snippet": "void\naudit_connection_from(const char *host, int port)\n{\n\t/* not implemented */\n}",
    "includes": [
      "#include \"packet.h\"",
      "#include \"canohost.h\"",
      "#include \"audit.h\"",
      "#include \"log.h\"",
      "#include <string.h>",
      "#include <unistd.h>",
      "#include <libaudit.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"packet.h\"\n#include \"canohost.h\"\n#include \"audit.h\"\n#include \"log.h\"\n#include <string.h>\n#include <unistd.h>\n#include <libaudit.h>\n#include \"includes.h\"\n\nvoid\naudit_connection_from(const char *host, int port)\n{\n\t/* not implemented */\n}"
  },
  {
    "function_name": "linux_audit_record_event",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/audit-linux.c",
    "lines": "41-69",
    "snippet": "int\nlinux_audit_record_event(int uid, const char *username, const char *hostname,\n    const char *ip, const char *ttyn, int success)\n{\n\tint audit_fd, rc, saved_errno;\n\n\tif ((audit_fd = audit_open()) < 0) {\n\t\tif (errno == EINVAL || errno == EPROTONOSUPPORT ||\n\t\t    errno == EAFNOSUPPORT)\n\t\t\treturn 1; /* No audit support in kernel */\n\t\telse\n\t\t\treturn 0; /* Must prevent login */\n\t}\n\trc = audit_log_acct_message(audit_fd, AUDIT_USER_LOGIN,\n\t    NULL, \"login\", username ? username : \"(unknown)\",\n\t    username == NULL ? uid : -1, hostname, ip, ttyn, success);\n\tsaved_errno = errno;\n\tclose(audit_fd);\n\n\t/*\n\t * Do not report error if the error is EPERM and sshd is run as non\n\t * root user.\n\t */\n\tif ((rc == -EPERM) && (geteuid() != 0))\n\t\trc = 0;\n\terrno = saved_errno;\n\n\treturn rc >= 0;\n}",
    "includes": [
      "#include \"packet.h\"",
      "#include \"canohost.h\"",
      "#include \"audit.h\"",
      "#include \"log.h\"",
      "#include <string.h>",
      "#include <unistd.h>",
      "#include <libaudit.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "geteuid",
          "args": [],
          "line": 64
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "close",
          "args": [
            "audit_fd"
          ],
          "line": 58
        },
        "resolved": true,
        "details": {
          "function_name": "audit_session_close",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/audit-linux.c",
          "lines": "93-97",
          "snippet": "void\naudit_session_close(struct logininfo *li)\n{\n\t/* not implemented */\n}",
          "includes": [
            "#include \"packet.h\"",
            "#include \"canohost.h\"",
            "#include \"audit.h\"",
            "#include \"log.h\"",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <libaudit.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"packet.h\"\n#include \"canohost.h\"\n#include \"audit.h\"\n#include \"log.h\"\n#include <string.h>\n#include <unistd.h>\n#include <libaudit.h>\n#include \"includes.h\"\n\nvoid\naudit_session_close(struct logininfo *li)\n{\n\t/* not implemented */\n}"
        }
      },
      {
        "call_info": {
          "callee": "audit_log_acct_message",
          "args": [
            "audit_fd",
            "AUDIT_USER_LOGIN",
            "NULL",
            "\"login\"",
            "username ? username : \"(unknown)\"",
            "username == NULL ? uid : -1",
            "hostname",
            "ip",
            "ttyn",
            "success"
          ],
          "line": 54
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "audit_open",
          "args": [],
          "line": 47
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"packet.h\"\n#include \"canohost.h\"\n#include \"audit.h\"\n#include \"log.h\"\n#include <string.h>\n#include <unistd.h>\n#include <libaudit.h>\n#include \"includes.h\"\n\nint\nlinux_audit_record_event(int uid, const char *username, const char *hostname,\n    const char *ip, const char *ttyn, int success)\n{\n\tint audit_fd, rc, saved_errno;\n\n\tif ((audit_fd = audit_open()) < 0) {\n\t\tif (errno == EINVAL || errno == EPROTONOSUPPORT ||\n\t\t    errno == EAFNOSUPPORT)\n\t\t\treturn 1; /* No audit support in kernel */\n\t\telse\n\t\t\treturn 0; /* Must prevent login */\n\t}\n\trc = audit_log_acct_message(audit_fd, AUDIT_USER_LOGIN,\n\t    NULL, \"login\", username ? username : \"(unknown)\",\n\t    username == NULL ? uid : -1, hostname, ip, ttyn, success);\n\tsaved_errno = errno;\n\tclose(audit_fd);\n\n\t/*\n\t * Do not report error if the error is EPERM and sshd is run as non\n\t * root user.\n\t */\n\tif ((rc == -EPERM) && (geteuid() != 0))\n\t\trc = 0;\n\terrno = saved_errno;\n\n\treturn rc >= 0;\n}"
  }
]