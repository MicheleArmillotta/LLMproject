[
  {
    "function_name": "crypto_sign_ed25519_open",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/ed25519.c",
    "lines": "103-144",
    "snippet": "int crypto_sign_ed25519_open(\n    unsigned char *m,unsigned long long *mlen,\n    const unsigned char *sm,unsigned long long smlen,\n    const unsigned char *pk\n    )\n{\n  unsigned int i;\n  int ret;\n  unsigned char t2[32];\n  ge25519 get1, get2;\n  sc25519 schram, scs;\n  unsigned char hram[crypto_hash_sha512_BYTES];\n\n  *mlen = (unsigned long long) -1;\n  if (smlen < 64) return -1;\n\n  if (ge25519_unpackneg_vartime(&get1, pk)) return -1;\n\n  get_hram(hram,sm,pk,m,smlen);\n\n  sc25519_from64bytes(&schram, hram);\n\n  sc25519_from32bytes(&scs, sm+32);\n\n  ge25519_double_scalarmult_vartime(&get2, &get1, &schram, &ge25519_base, &scs);\n  ge25519_pack(t2, &get2);\n\n  ret = crypto_verify_32(sm, t2);\n\n  if (!ret)\n  {\n    for(i=0;i<smlen-64;i++)\n      m[i] = sm[i + 64];\n    *mlen = smlen-64;\n  }\n  else\n  {\n    for(i=0;i<smlen-64;i++)\n      m[i] = 0;\n  }\n  return ret;\n}",
    "includes": [
      "#include \"ge25519.h\"",
      "#include \"crypto_api.h\"",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "crypto_verify_32",
          "args": [
            "sm",
            "t2"
          ],
          "line": 130
        },
        "resolved": true,
        "details": {
          "function_name": "crypto_verify_32",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/verify.c",
          "lines": "12-49",
          "snippet": "int crypto_verify_32(const unsigned char *x,const unsigned char *y)\n{\n  unsigned int differentbits = 0;\n#define F(i) differentbits |= x[i] ^ y[i];\n  F(0)\n  F(1)\n  F(2)\n  F(3)\n  F(4)\n  F(5)\n  F(6)\n  F(7)\n  F(8)\n  F(9)\n  F(10)\n  F(11)\n  F(12)\n  F(13)\n  F(14)\n  F(15)\n  F(16)\n  F(17)\n  F(18)\n  F(19)\n  F(20)\n  F(21)\n  F(22)\n  F(23)\n  F(24)\n  F(25)\n  F(26)\n  F(27)\n  F(28)\n  F(29)\n  F(30)\n  F(31)\n  return (1 & ((differentbits - 1) >> 8)) - 1;\n}",
          "includes": [
            "#include \"crypto_api.h\"",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"crypto_api.h\"\n#include \"includes.h\"\n\nint crypto_verify_32(const unsigned char *x,const unsigned char *y)\n{\n  unsigned int differentbits = 0;\n#define F(i) differentbits |= x[i] ^ y[i];\n  F(0)\n  F(1)\n  F(2)\n  F(3)\n  F(4)\n  F(5)\n  F(6)\n  F(7)\n  F(8)\n  F(9)\n  F(10)\n  F(11)\n  F(12)\n  F(13)\n  F(14)\n  F(15)\n  F(16)\n  F(17)\n  F(18)\n  F(19)\n  F(20)\n  F(21)\n  F(22)\n  F(23)\n  F(24)\n  F(25)\n  F(26)\n  F(27)\n  F(28)\n  F(29)\n  F(30)\n  F(31)\n  return (1 & ((differentbits - 1) >> 8)) - 1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "ge25519_pack",
          "args": [
            "t2",
            "&get2"
          ],
          "line": 128
        },
        "resolved": true,
        "details": {
          "function_name": "ge25519_pack",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/ge25519.c",
          "lines": "243-251",
          "snippet": "void ge25519_pack(unsigned char r[32], const ge25519_p3 *p)\n{\n  fe25519 tx, ty, zi;\n  fe25519_invert(&zi, &p->z); \n  fe25519_mul(&tx, &p->x, &zi);\n  fe25519_mul(&ty, &p->y, &zi);\n  fe25519_pack(r, &ty);\n  r[31] ^= fe25519_getparity(&tx) << 7;\n}",
          "includes": [
            "#include \"ge25519.h\"",
            "#include \"sc25519.h\"",
            "#include \"fe25519.h\"",
            "#include \"includes.h\""
          ],
          "macros_used": [
            "#define ge25519_p3 ge25519"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"ge25519.h\"\n#include \"sc25519.h\"\n#include \"fe25519.h\"\n#include \"includes.h\"\n\n#define ge25519_p3 ge25519\n\nvoid ge25519_pack(unsigned char r[32], const ge25519_p3 *p)\n{\n  fe25519 tx, ty, zi;\n  fe25519_invert(&zi, &p->z); \n  fe25519_mul(&tx, &p->x, &zi);\n  fe25519_mul(&ty, &p->y, &zi);\n  fe25519_pack(r, &ty);\n  r[31] ^= fe25519_getparity(&tx) << 7;\n}"
        }
      },
      {
        "call_info": {
          "callee": "ge25519_double_scalarmult_vartime",
          "args": [
            "&get2",
            "&get1",
            "&schram",
            "&ge25519_base",
            "&scs"
          ],
          "line": 127
        },
        "resolved": true,
        "details": {
          "function_name": "ge25519_double_scalarmult_vartime",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/ge25519.c",
          "lines": "262-304",
          "snippet": "void ge25519_double_scalarmult_vartime(ge25519_p3 *r, const ge25519_p3 *p1, const sc25519 *s1, const ge25519_p3 *p2, const sc25519 *s2)\n{\n  ge25519_p1p1 tp1p1;\n  ge25519_p3 pre[16];\n  unsigned char b[127];\n  int i;\n\n  /* precomputation                                                        s2 s1 */\n  setneutral(pre);                                                      /* 00 00 */\n  pre[1] = *p1;                                                         /* 00 01 */\n  dbl_p1p1(&tp1p1,(ge25519_p2 *)p1);      p1p1_to_p3( &pre[2], &tp1p1); /* 00 10 */\n  add_p1p1(&tp1p1,&pre[1], &pre[2]);      p1p1_to_p3( &pre[3], &tp1p1); /* 00 11 */\n  pre[4] = *p2;                                                         /* 01 00 */\n  add_p1p1(&tp1p1,&pre[1], &pre[4]);      p1p1_to_p3( &pre[5], &tp1p1); /* 01 01 */\n  add_p1p1(&tp1p1,&pre[2], &pre[4]);      p1p1_to_p3( &pre[6], &tp1p1); /* 01 10 */\n  add_p1p1(&tp1p1,&pre[3], &pre[4]);      p1p1_to_p3( &pre[7], &tp1p1); /* 01 11 */\n  dbl_p1p1(&tp1p1,(ge25519_p2 *)p2);      p1p1_to_p3( &pre[8], &tp1p1); /* 10 00 */\n  add_p1p1(&tp1p1,&pre[1], &pre[8]);      p1p1_to_p3( &pre[9], &tp1p1); /* 10 01 */\n  dbl_p1p1(&tp1p1,(ge25519_p2 *)&pre[5]); p1p1_to_p3(&pre[10], &tp1p1); /* 10 10 */\n  add_p1p1(&tp1p1,&pre[3], &pre[8]);      p1p1_to_p3(&pre[11], &tp1p1); /* 10 11 */\n  add_p1p1(&tp1p1,&pre[4], &pre[8]);      p1p1_to_p3(&pre[12], &tp1p1); /* 11 00 */\n  add_p1p1(&tp1p1,&pre[1],&pre[12]);      p1p1_to_p3(&pre[13], &tp1p1); /* 11 01 */\n  add_p1p1(&tp1p1,&pre[2],&pre[12]);      p1p1_to_p3(&pre[14], &tp1p1); /* 11 10 */\n  add_p1p1(&tp1p1,&pre[3],&pre[12]);      p1p1_to_p3(&pre[15], &tp1p1); /* 11 11 */\n\n  sc25519_2interleave2(b,s1,s2);\n\n  /* scalar multiplication */\n  *r = pre[b[126]];\n  for(i=125;i>=0;i--)\n  {\n    dbl_p1p1(&tp1p1, (ge25519_p2 *)r);\n    p1p1_to_p2((ge25519_p2 *) r, &tp1p1);\n    dbl_p1p1(&tp1p1, (ge25519_p2 *)r);\n    if(b[i]!=0)\n    {\n      p1p1_to_p3(r, &tp1p1);\n      add_p1p1(&tp1p1, r, &pre[b[i]]);\n    }\n    if(i != 0) p1p1_to_p2((ge25519_p2 *)r, &tp1p1);\n    else p1p1_to_p3(r, &tp1p1);\n  }\n}",
          "includes": [
            "#include \"ge25519.h\"",
            "#include \"sc25519.h\"",
            "#include \"fe25519.h\"",
            "#include \"includes.h\""
          ],
          "macros_used": [
            "#define ge25519_p3 ge25519"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"ge25519.h\"\n#include \"sc25519.h\"\n#include \"fe25519.h\"\n#include \"includes.h\"\n\n#define ge25519_p3 ge25519\n\nvoid ge25519_double_scalarmult_vartime(ge25519_p3 *r, const ge25519_p3 *p1, const sc25519 *s1, const ge25519_p3 *p2, const sc25519 *s2)\n{\n  ge25519_p1p1 tp1p1;\n  ge25519_p3 pre[16];\n  unsigned char b[127];\n  int i;\n\n  /* precomputation                                                        s2 s1 */\n  setneutral(pre);                                                      /* 00 00 */\n  pre[1] = *p1;                                                         /* 00 01 */\n  dbl_p1p1(&tp1p1,(ge25519_p2 *)p1);      p1p1_to_p3( &pre[2], &tp1p1); /* 00 10 */\n  add_p1p1(&tp1p1,&pre[1], &pre[2]);      p1p1_to_p3( &pre[3], &tp1p1); /* 00 11 */\n  pre[4] = *p2;                                                         /* 01 00 */\n  add_p1p1(&tp1p1,&pre[1], &pre[4]);      p1p1_to_p3( &pre[5], &tp1p1); /* 01 01 */\n  add_p1p1(&tp1p1,&pre[2], &pre[4]);      p1p1_to_p3( &pre[6], &tp1p1); /* 01 10 */\n  add_p1p1(&tp1p1,&pre[3], &pre[4]);      p1p1_to_p3( &pre[7], &tp1p1); /* 01 11 */\n  dbl_p1p1(&tp1p1,(ge25519_p2 *)p2);      p1p1_to_p3( &pre[8], &tp1p1); /* 10 00 */\n  add_p1p1(&tp1p1,&pre[1], &pre[8]);      p1p1_to_p3( &pre[9], &tp1p1); /* 10 01 */\n  dbl_p1p1(&tp1p1,(ge25519_p2 *)&pre[5]); p1p1_to_p3(&pre[10], &tp1p1); /* 10 10 */\n  add_p1p1(&tp1p1,&pre[3], &pre[8]);      p1p1_to_p3(&pre[11], &tp1p1); /* 10 11 */\n  add_p1p1(&tp1p1,&pre[4], &pre[8]);      p1p1_to_p3(&pre[12], &tp1p1); /* 11 00 */\n  add_p1p1(&tp1p1,&pre[1],&pre[12]);      p1p1_to_p3(&pre[13], &tp1p1); /* 11 01 */\n  add_p1p1(&tp1p1,&pre[2],&pre[12]);      p1p1_to_p3(&pre[14], &tp1p1); /* 11 10 */\n  add_p1p1(&tp1p1,&pre[3],&pre[12]);      p1p1_to_p3(&pre[15], &tp1p1); /* 11 11 */\n\n  sc25519_2interleave2(b,s1,s2);\n\n  /* scalar multiplication */\n  *r = pre[b[126]];\n  for(i=125;i>=0;i--)\n  {\n    dbl_p1p1(&tp1p1, (ge25519_p2 *)r);\n    p1p1_to_p2((ge25519_p2 *) r, &tp1p1);\n    dbl_p1p1(&tp1p1, (ge25519_p2 *)r);\n    if(b[i]!=0)\n    {\n      p1p1_to_p3(r, &tp1p1);\n      add_p1p1(&tp1p1, r, &pre[b[i]]);\n    }\n    if(i != 0) p1p1_to_p2((ge25519_p2 *)r, &tp1p1);\n    else p1p1_to_p3(r, &tp1p1);\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "sc25519_from32bytes",
          "args": [
            "&scs",
            "sm+32"
          ],
          "line": 125
        },
        "resolved": true,
        "details": {
          "function_name": "sc25519_from32bytes",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sc25519.c",
          "lines": "102-109",
          "snippet": "void sc25519_from32bytes(sc25519 *r, const unsigned char x[32])\n{\n  int i;\n  crypto_uint32 t[64];\n  for(i=0;i<32;i++) t[i] = x[i];\n  for(i=32;i<64;++i) t[i] = 0;\n  barrett_reduce(r, t);\n}",
          "includes": [
            "#include \"sc25519.h\"",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sc25519.h\"\n#include \"includes.h\"\n\nvoid sc25519_from32bytes(sc25519 *r, const unsigned char x[32])\n{\n  int i;\n  crypto_uint32 t[64];\n  for(i=0;i<32;i++) t[i] = x[i];\n  for(i=32;i<64;++i) t[i] = 0;\n  barrett_reduce(r, t);\n}"
        }
      },
      {
        "call_info": {
          "callee": "sc25519_from64bytes",
          "args": [
            "&schram",
            "hram"
          ],
          "line": 123
        },
        "resolved": true,
        "details": {
          "function_name": "sc25519_from64bytes",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sc25519.c",
          "lines": "117-123",
          "snippet": "void sc25519_from64bytes(sc25519 *r, const unsigned char x[64])\n{\n  int i;\n  crypto_uint32 t[64];\n  for(i=0;i<64;i++) t[i] = x[i];\n  barrett_reduce(r, t);\n}",
          "includes": [
            "#include \"sc25519.h\"",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sc25519.h\"\n#include \"includes.h\"\n\nvoid sc25519_from64bytes(sc25519 *r, const unsigned char x[64])\n{\n  int i;\n  crypto_uint32 t[64];\n  for(i=0;i<64;i++) t[i] = x[i];\n  barrett_reduce(r, t);\n}"
        }
      },
      {
        "call_info": {
          "callee": "get_hram",
          "args": [
            "hram",
            "sm",
            "pk",
            "m",
            "smlen"
          ],
          "line": 121
        },
        "resolved": true,
        "details": {
          "function_name": "get_hram",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/ed25519.c",
          "lines": "14-23",
          "snippet": "static void get_hram(unsigned char *hram, const unsigned char *sm, const unsigned char *pk, unsigned char *playground, unsigned long long smlen)\n{\n  unsigned long long i;\n\n  for (i =  0;i < 32;++i)    playground[i] = sm[i];\n  for (i = 32;i < 64;++i)    playground[i] = pk[i-32];\n  for (i = 64;i < smlen;++i) playground[i] = sm[i];\n\n  crypto_hash_sha512(hram,playground,smlen);\n}",
          "includes": [
            "#include \"ge25519.h\"",
            "#include \"crypto_api.h\"",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"ge25519.h\"\n#include \"crypto_api.h\"\n#include \"includes.h\"\n\nstatic void get_hram(unsigned char *hram, const unsigned char *sm, const unsigned char *pk, unsigned char *playground, unsigned long long smlen)\n{\n  unsigned long long i;\n\n  for (i =  0;i < 32;++i)    playground[i] = sm[i];\n  for (i = 32;i < 64;++i)    playground[i] = pk[i-32];\n  for (i = 64;i < smlen;++i) playground[i] = sm[i];\n\n  crypto_hash_sha512(hram,playground,smlen);\n}"
        }
      },
      {
        "call_info": {
          "callee": "ge25519_unpackneg_vartime",
          "args": [
            "&get1",
            "pk"
          ],
          "line": 119
        },
        "resolved": true,
        "details": {
          "function_name": "ge25519_unpackneg_vartime",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/ge25519.c",
          "lines": "196-241",
          "snippet": "int ge25519_unpackneg_vartime(ge25519_p3 *r, const unsigned char p[32])\n{\n  unsigned char par;\n  fe25519 t, chk, num, den, den2, den4, den6;\n  fe25519_setone(&r->z);\n  par = p[31] >> 7;\n  fe25519_unpack(&r->y, p); \n  fe25519_square(&num, &r->y); /* x = y^2 */\n  fe25519_mul(&den, &num, &ge25519_ecd); /* den = dy^2 */\n  fe25519_sub(&num, &num, &r->z); /* x = y^2-1 */\n  fe25519_add(&den, &r->z, &den); /* den = dy^2+1 */\n\n  /* Computation of sqrt(num/den) */\n  /* 1.: computation of num^((p-5)/8)*den^((7p-35)/8) = (num*den^7)^((p-5)/8) */\n  fe25519_square(&den2, &den);\n  fe25519_square(&den4, &den2);\n  fe25519_mul(&den6, &den4, &den2);\n  fe25519_mul(&t, &den6, &num);\n  fe25519_mul(&t, &t, &den);\n\n  fe25519_pow2523(&t, &t);\n  /* 2. computation of r->x = t * num * den^3 */\n  fe25519_mul(&t, &t, &num);\n  fe25519_mul(&t, &t, &den);\n  fe25519_mul(&t, &t, &den);\n  fe25519_mul(&r->x, &t, &den);\n\n  /* 3. Check whether sqrt computation gave correct result, multiply by sqrt(-1) if not: */\n  fe25519_square(&chk, &r->x);\n  fe25519_mul(&chk, &chk, &den);\n  if (!fe25519_iseq_vartime(&chk, &num))\n    fe25519_mul(&r->x, &r->x, &ge25519_sqrtm1);\n\n  /* 4. Now we have one of the two square roots, except if input was not a square */\n  fe25519_square(&chk, &r->x);\n  fe25519_mul(&chk, &chk, &den);\n  if (!fe25519_iseq_vartime(&chk, &num))\n    return -1;\n\n  /* 5. Choose the desired square root according to parity: */\n  if(fe25519_getparity(&r->x) != (1-par))\n    fe25519_neg(&r->x, &r->x);\n\n  fe25519_mul(&r->t, &r->x, &r->y);\n  return 0;\n}",
          "includes": [
            "#include \"ge25519.h\"",
            "#include \"sc25519.h\"",
            "#include \"fe25519.h\"",
            "#include \"includes.h\""
          ],
          "macros_used": [
            "#define ge25519_p3 ge25519"
          ],
          "globals_used": [
            "static const fe25519 ge25519_ecd = {{0xA3, 0x78, 0x59, 0x13, 0xCA, 0x4D, 0xEB, 0x75, 0xAB, 0xD8, 0x41, 0x41, 0x4D, 0x0A, 0x70, 0x00, \n                      0x98, 0xE8, 0x79, 0x77, 0x79, 0x40, 0xC7, 0x8C, 0x73, 0xFE, 0x6F, 0x2B, 0xEE, 0x6C, 0x03, 0x52}};",
            "static const fe25519 ge25519_sqrtm1 = {{0xB0, 0xA0, 0x0E, 0x4A, 0x27, 0x1B, 0xEE, 0xC4, 0x78, 0xE4, 0x2F, 0xAD, 0x06, 0x18, 0x43, 0x2F, \n                         0xA7, 0xD7, 0xFB, 0x3D, 0x99, 0x00, 0x4D, 0x2B, 0x0B, 0xDF, 0xC1, 0x4F, 0x80, 0x24, 0x83, 0x2B}};"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"ge25519.h\"\n#include \"sc25519.h\"\n#include \"fe25519.h\"\n#include \"includes.h\"\n\n#define ge25519_p3 ge25519\n\nstatic const fe25519 ge25519_ecd = {{0xA3, 0x78, 0x59, 0x13, 0xCA, 0x4D, 0xEB, 0x75, 0xAB, 0xD8, 0x41, 0x41, 0x4D, 0x0A, 0x70, 0x00, \n                      0x98, 0xE8, 0x79, 0x77, 0x79, 0x40, 0xC7, 0x8C, 0x73, 0xFE, 0x6F, 0x2B, 0xEE, 0x6C, 0x03, 0x52}};\nstatic const fe25519 ge25519_sqrtm1 = {{0xB0, 0xA0, 0x0E, 0x4A, 0x27, 0x1B, 0xEE, 0xC4, 0x78, 0xE4, 0x2F, 0xAD, 0x06, 0x18, 0x43, 0x2F, \n                         0xA7, 0xD7, 0xFB, 0x3D, 0x99, 0x00, 0x4D, 0x2B, 0x0B, 0xDF, 0xC1, 0x4F, 0x80, 0x24, 0x83, 0x2B}};\n\nint ge25519_unpackneg_vartime(ge25519_p3 *r, const unsigned char p[32])\n{\n  unsigned char par;\n  fe25519 t, chk, num, den, den2, den4, den6;\n  fe25519_setone(&r->z);\n  par = p[31] >> 7;\n  fe25519_unpack(&r->y, p); \n  fe25519_square(&num, &r->y); /* x = y^2 */\n  fe25519_mul(&den, &num, &ge25519_ecd); /* den = dy^2 */\n  fe25519_sub(&num, &num, &r->z); /* x = y^2-1 */\n  fe25519_add(&den, &r->z, &den); /* den = dy^2+1 */\n\n  /* Computation of sqrt(num/den) */\n  /* 1.: computation of num^((p-5)/8)*den^((7p-35)/8) = (num*den^7)^((p-5)/8) */\n  fe25519_square(&den2, &den);\n  fe25519_square(&den4, &den2);\n  fe25519_mul(&den6, &den4, &den2);\n  fe25519_mul(&t, &den6, &num);\n  fe25519_mul(&t, &t, &den);\n\n  fe25519_pow2523(&t, &t);\n  /* 2. computation of r->x = t * num * den^3 */\n  fe25519_mul(&t, &t, &num);\n  fe25519_mul(&t, &t, &den);\n  fe25519_mul(&t, &t, &den);\n  fe25519_mul(&r->x, &t, &den);\n\n  /* 3. Check whether sqrt computation gave correct result, multiply by sqrt(-1) if not: */\n  fe25519_square(&chk, &r->x);\n  fe25519_mul(&chk, &chk, &den);\n  if (!fe25519_iseq_vartime(&chk, &num))\n    fe25519_mul(&r->x, &r->x, &ge25519_sqrtm1);\n\n  /* 4. Now we have one of the two square roots, except if input was not a square */\n  fe25519_square(&chk, &r->x);\n  fe25519_mul(&chk, &chk, &den);\n  if (!fe25519_iseq_vartime(&chk, &num))\n    return -1;\n\n  /* 5. Choose the desired square root according to parity: */\n  if(fe25519_getparity(&r->x) != (1-par))\n    fe25519_neg(&r->x, &r->x);\n\n  fe25519_mul(&r->t, &r->x, &r->y);\n  return 0;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"ge25519.h\"\n#include \"crypto_api.h\"\n#include \"includes.h\"\n\nint crypto_sign_ed25519_open(\n    unsigned char *m,unsigned long long *mlen,\n    const unsigned char *sm,unsigned long long smlen,\n    const unsigned char *pk\n    )\n{\n  unsigned int i;\n  int ret;\n  unsigned char t2[32];\n  ge25519 get1, get2;\n  sc25519 schram, scs;\n  unsigned char hram[crypto_hash_sha512_BYTES];\n\n  *mlen = (unsigned long long) -1;\n  if (smlen < 64) return -1;\n\n  if (ge25519_unpackneg_vartime(&get1, pk)) return -1;\n\n  get_hram(hram,sm,pk,m,smlen);\n\n  sc25519_from64bytes(&schram, hram);\n\n  sc25519_from32bytes(&scs, sm+32);\n\n  ge25519_double_scalarmult_vartime(&get2, &get1, &schram, &ge25519_base, &scs);\n  ge25519_pack(t2, &get2);\n\n  ret = crypto_verify_32(sm, t2);\n\n  if (!ret)\n  {\n    for(i=0;i<smlen-64;i++)\n      m[i] = sm[i + 64];\n    *mlen = smlen-64;\n  }\n  else\n  {\n    for(i=0;i<smlen-64;i++)\n      m[i] = 0;\n  }\n  return ret;\n}"
  },
  {
    "function_name": "crypto_sign_ed25519",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/ed25519.c",
    "lines": "51-101",
    "snippet": "int crypto_sign_ed25519(\n    unsigned char *sm,unsigned long long *smlen,\n    const unsigned char *m,unsigned long long mlen,\n    const unsigned char *sk\n    )\n{\n  sc25519 sck, scs, scsk;\n  ge25519 ger;\n  unsigned char r[32];\n  unsigned char s[32];\n  unsigned char extsk[64];\n  unsigned long long i;\n  unsigned char hmg[crypto_hash_sha512_BYTES];\n  unsigned char hram[crypto_hash_sha512_BYTES];\n\n  crypto_hash_sha512(extsk, sk, 32);\n  extsk[0] &= 248;\n  extsk[31] &= 127;\n  extsk[31] |= 64;\n\n  *smlen = mlen+64;\n  for(i=0;i<mlen;i++)\n    sm[64 + i] = m[i];\n  for(i=0;i<32;i++)\n    sm[32 + i] = extsk[32+i];\n\n  crypto_hash_sha512(hmg, sm+32, mlen+32); /* Generate k as h(extsk[32],...,extsk[63],m) */\n\n  /* Computation of R */\n  sc25519_from64bytes(&sck, hmg);\n  ge25519_scalarmult_base(&ger, &sck);\n  ge25519_pack(r, &ger);\n  \n  /* Computation of s */\n  for(i=0;i<32;i++)\n    sm[i] = r[i];\n\n  get_hram(hram, sm, sk+32, sm, mlen+64);\n\n  sc25519_from64bytes(&scs, hram);\n  sc25519_from32bytes(&scsk, extsk);\n  sc25519_mul(&scs, &scs, &scsk);\n  \n  sc25519_add(&scs, &scs, &sck);\n\n  sc25519_to32bytes(s,&scs); /* cat s */\n  for(i=0;i<32;i++)\n    sm[32 + i] = s[i]; \n\n  return 0;\n}",
    "includes": [
      "#include \"ge25519.h\"",
      "#include \"crypto_api.h\"",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "sc25519_to32bytes",
          "args": [
            "s",
            "&scs"
          ],
          "line": 96
        },
        "resolved": true,
        "details": {
          "function_name": "sc25519_to32bytes",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sc25519.c",
          "lines": "134-138",
          "snippet": "void sc25519_to32bytes(unsigned char r[32], const sc25519 *x)\n{\n  int i;\n  for(i=0;i<32;i++) r[i] = x->v[i];\n}",
          "includes": [
            "#include \"sc25519.h\"",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sc25519.h\"\n#include \"includes.h\"\n\nvoid sc25519_to32bytes(unsigned char r[32], const sc25519 *x)\n{\n  int i;\n  for(i=0;i<32;i++) r[i] = x->v[i];\n}"
        }
      },
      {
        "call_info": {
          "callee": "sc25519_add",
          "args": [
            "&scs",
            "&scs",
            "&sck"
          ],
          "line": 94
        },
        "resolved": true,
        "details": {
          "function_name": "sc25519_add",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sc25519.c",
          "lines": "167-178",
          "snippet": "void sc25519_add(sc25519 *r, const sc25519 *x, const sc25519 *y)\n{\n  int i, carry;\n  for(i=0;i<32;i++) r->v[i] = x->v[i] + y->v[i];\n  for(i=0;i<31;i++)\n  {\n    carry = r->v[i] >> 8;\n    r->v[i+1] += carry;\n    r->v[i] &= 0xff;\n  }\n  reduce_add_sub(r);\n}",
          "includes": [
            "#include \"sc25519.h\"",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sc25519.h\"\n#include \"includes.h\"\n\nvoid sc25519_add(sc25519 *r, const sc25519 *x, const sc25519 *y)\n{\n  int i, carry;\n  for(i=0;i<32;i++) r->v[i] = x->v[i] + y->v[i];\n  for(i=0;i<31;i++)\n  {\n    carry = r->v[i] >> 8;\n    r->v[i+1] += carry;\n    r->v[i] &= 0xff;\n  }\n  reduce_add_sub(r);\n}"
        }
      },
      {
        "call_info": {
          "callee": "sc25519_mul",
          "args": [
            "&scs",
            "&scs",
            "&scsk"
          ],
          "line": 92
        },
        "resolved": true,
        "details": {
          "function_name": "sc25519_mul_shortsc",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sc25519.c",
          "lines": "214-219",
          "snippet": "void sc25519_mul_shortsc(sc25519 *r, const sc25519 *x, const shortsc25519 *y)\n{\n  sc25519 t;\n  sc25519_from_shortsc(&t, y);\n  sc25519_mul(r, x, &t);\n}",
          "includes": [
            "#include \"sc25519.h\"",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sc25519.h\"\n#include \"includes.h\"\n\nvoid sc25519_mul_shortsc(sc25519 *r, const sc25519 *x, const shortsc25519 *y)\n{\n  sc25519 t;\n  sc25519_from_shortsc(&t, y);\n  sc25519_mul(r, x, &t);\n}"
        }
      },
      {
        "call_info": {
          "callee": "sc25519_from32bytes",
          "args": [
            "&scsk",
            "extsk"
          ],
          "line": 91
        },
        "resolved": true,
        "details": {
          "function_name": "sc25519_from32bytes",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sc25519.c",
          "lines": "102-109",
          "snippet": "void sc25519_from32bytes(sc25519 *r, const unsigned char x[32])\n{\n  int i;\n  crypto_uint32 t[64];\n  for(i=0;i<32;i++) t[i] = x[i];\n  for(i=32;i<64;++i) t[i] = 0;\n  barrett_reduce(r, t);\n}",
          "includes": [
            "#include \"sc25519.h\"",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sc25519.h\"\n#include \"includes.h\"\n\nvoid sc25519_from32bytes(sc25519 *r, const unsigned char x[32])\n{\n  int i;\n  crypto_uint32 t[64];\n  for(i=0;i<32;i++) t[i] = x[i];\n  for(i=32;i<64;++i) t[i] = 0;\n  barrett_reduce(r, t);\n}"
        }
      },
      {
        "call_info": {
          "callee": "sc25519_from64bytes",
          "args": [
            "&scs",
            "hram"
          ],
          "line": 90
        },
        "resolved": true,
        "details": {
          "function_name": "sc25519_from64bytes",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sc25519.c",
          "lines": "117-123",
          "snippet": "void sc25519_from64bytes(sc25519 *r, const unsigned char x[64])\n{\n  int i;\n  crypto_uint32 t[64];\n  for(i=0;i<64;i++) t[i] = x[i];\n  barrett_reduce(r, t);\n}",
          "includes": [
            "#include \"sc25519.h\"",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sc25519.h\"\n#include \"includes.h\"\n\nvoid sc25519_from64bytes(sc25519 *r, const unsigned char x[64])\n{\n  int i;\n  crypto_uint32 t[64];\n  for(i=0;i<64;i++) t[i] = x[i];\n  barrett_reduce(r, t);\n}"
        }
      },
      {
        "call_info": {
          "callee": "get_hram",
          "args": [
            "hram",
            "sm",
            "sk+32",
            "sm",
            "mlen+64"
          ],
          "line": 88
        },
        "resolved": true,
        "details": {
          "function_name": "get_hram",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/ed25519.c",
          "lines": "14-23",
          "snippet": "static void get_hram(unsigned char *hram, const unsigned char *sm, const unsigned char *pk, unsigned char *playground, unsigned long long smlen)\n{\n  unsigned long long i;\n\n  for (i =  0;i < 32;++i)    playground[i] = sm[i];\n  for (i = 32;i < 64;++i)    playground[i] = pk[i-32];\n  for (i = 64;i < smlen;++i) playground[i] = sm[i];\n\n  crypto_hash_sha512(hram,playground,smlen);\n}",
          "includes": [
            "#include \"ge25519.h\"",
            "#include \"crypto_api.h\"",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"ge25519.h\"\n#include \"crypto_api.h\"\n#include \"includes.h\"\n\nstatic void get_hram(unsigned char *hram, const unsigned char *sm, const unsigned char *pk, unsigned char *playground, unsigned long long smlen)\n{\n  unsigned long long i;\n\n  for (i =  0;i < 32;++i)    playground[i] = sm[i];\n  for (i = 32;i < 64;++i)    playground[i] = pk[i-32];\n  for (i = 64;i < smlen;++i) playground[i] = sm[i];\n\n  crypto_hash_sha512(hram,playground,smlen);\n}"
        }
      },
      {
        "call_info": {
          "callee": "ge25519_pack",
          "args": [
            "r",
            "&ger"
          ],
          "line": 82
        },
        "resolved": true,
        "details": {
          "function_name": "ge25519_pack",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/ge25519.c",
          "lines": "243-251",
          "snippet": "void ge25519_pack(unsigned char r[32], const ge25519_p3 *p)\n{\n  fe25519 tx, ty, zi;\n  fe25519_invert(&zi, &p->z); \n  fe25519_mul(&tx, &p->x, &zi);\n  fe25519_mul(&ty, &p->y, &zi);\n  fe25519_pack(r, &ty);\n  r[31] ^= fe25519_getparity(&tx) << 7;\n}",
          "includes": [
            "#include \"ge25519.h\"",
            "#include \"sc25519.h\"",
            "#include \"fe25519.h\"",
            "#include \"includes.h\""
          ],
          "macros_used": [
            "#define ge25519_p3 ge25519"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"ge25519.h\"\n#include \"sc25519.h\"\n#include \"fe25519.h\"\n#include \"includes.h\"\n\n#define ge25519_p3 ge25519\n\nvoid ge25519_pack(unsigned char r[32], const ge25519_p3 *p)\n{\n  fe25519 tx, ty, zi;\n  fe25519_invert(&zi, &p->z); \n  fe25519_mul(&tx, &p->x, &zi);\n  fe25519_mul(&ty, &p->y, &zi);\n  fe25519_pack(r, &ty);\n  r[31] ^= fe25519_getparity(&tx) << 7;\n}"
        }
      },
      {
        "call_info": {
          "callee": "ge25519_scalarmult_base",
          "args": [
            "&ger",
            "&sck"
          ],
          "line": 81
        },
        "resolved": true,
        "details": {
          "function_name": "ge25519_scalarmult_base",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/ge25519.c",
          "lines": "306-321",
          "snippet": "void ge25519_scalarmult_base(ge25519_p3 *r, const sc25519 *s)\n{\n  signed char b[85];\n  int i;\n  ge25519_aff t;\n  sc25519_window3(b,s);\n\n  choose_t((ge25519_aff *)r, 0, b[0]);\n  fe25519_setone(&r->z);\n  fe25519_mul(&r->t, &r->x, &r->y);\n  for(i=1;i<85;i++)\n  {\n    choose_t(&t, (unsigned long long) i, b[i]);\n    ge25519_mixadd2(r, &t);\n  }\n}",
          "includes": [
            "#include \"ge25519.h\"",
            "#include \"sc25519.h\"",
            "#include \"fe25519.h\"",
            "#include \"includes.h\""
          ],
          "macros_used": [
            "#define ge25519_p3 ge25519"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"ge25519.h\"\n#include \"sc25519.h\"\n#include \"fe25519.h\"\n#include \"includes.h\"\n\n#define ge25519_p3 ge25519\n\nvoid ge25519_scalarmult_base(ge25519_p3 *r, const sc25519 *s)\n{\n  signed char b[85];\n  int i;\n  ge25519_aff t;\n  sc25519_window3(b,s);\n\n  choose_t((ge25519_aff *)r, 0, b[0]);\n  fe25519_setone(&r->z);\n  fe25519_mul(&r->t, &r->x, &r->y);\n  for(i=1;i<85;i++)\n  {\n    choose_t(&t, (unsigned long long) i, b[i]);\n    ge25519_mixadd2(r, &t);\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "crypto_hash_sha512",
          "args": [
            "hmg",
            "sm+32",
            "mlen+32"
          ],
          "line": 77
        },
        "resolved": true,
        "details": {
          "function_name": "crypto_hash_sha512",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/hash.c",
          "lines": "17-27",
          "snippet": "int\ncrypto_hash_sha512(unsigned char *out, const unsigned char *in,\n    unsigned long long inlen)\n{\n\tint r;\n\n\tif ((r = ssh_digest_memory(SSH_DIGEST_SHA512, in, inlen, out,\n\t    crypto_hash_sha512_BYTES)) != 0)\n\t\tfatal(\"%s: %s\", __func__, ssh_err(r));\n\treturn 0;\n}",
          "includes": [
            "#include \"ssherr.h\"",
            "#include \"log.h\"",
            "#include \"digest.h\"",
            "#include <stdarg.h>",
            "#include \"crypto_api.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"ssherr.h\"\n#include \"log.h\"\n#include \"digest.h\"\n#include <stdarg.h>\n#include \"crypto_api.h\"\n\nint\ncrypto_hash_sha512(unsigned char *out, const unsigned char *in,\n    unsigned long long inlen)\n{\n\tint r;\n\n\tif ((r = ssh_digest_memory(SSH_DIGEST_SHA512, in, inlen, out,\n\t    crypto_hash_sha512_BYTES)) != 0)\n\t\tfatal(\"%s: %s\", __func__, ssh_err(r));\n\treturn 0;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"ge25519.h\"\n#include \"crypto_api.h\"\n#include \"includes.h\"\n\nint crypto_sign_ed25519(\n    unsigned char *sm,unsigned long long *smlen,\n    const unsigned char *m,unsigned long long mlen,\n    const unsigned char *sk\n    )\n{\n  sc25519 sck, scs, scsk;\n  ge25519 ger;\n  unsigned char r[32];\n  unsigned char s[32];\n  unsigned char extsk[64];\n  unsigned long long i;\n  unsigned char hmg[crypto_hash_sha512_BYTES];\n  unsigned char hram[crypto_hash_sha512_BYTES];\n\n  crypto_hash_sha512(extsk, sk, 32);\n  extsk[0] &= 248;\n  extsk[31] &= 127;\n  extsk[31] |= 64;\n\n  *smlen = mlen+64;\n  for(i=0;i<mlen;i++)\n    sm[64 + i] = m[i];\n  for(i=0;i<32;i++)\n    sm[32 + i] = extsk[32+i];\n\n  crypto_hash_sha512(hmg, sm+32, mlen+32); /* Generate k as h(extsk[32],...,extsk[63],m) */\n\n  /* Computation of R */\n  sc25519_from64bytes(&sck, hmg);\n  ge25519_scalarmult_base(&ger, &sck);\n  ge25519_pack(r, &ger);\n  \n  /* Computation of s */\n  for(i=0;i<32;i++)\n    sm[i] = r[i];\n\n  get_hram(hram, sm, sk+32, sm, mlen+64);\n\n  sc25519_from64bytes(&scs, hram);\n  sc25519_from32bytes(&scsk, extsk);\n  sc25519_mul(&scs, &scs, &scsk);\n  \n  sc25519_add(&scs, &scs, &sck);\n\n  sc25519_to32bytes(s,&scs); /* cat s */\n  for(i=0;i<32;i++)\n    sm[32 + i] = s[i]; \n\n  return 0;\n}"
  },
  {
    "function_name": "crypto_sign_ed25519_keypair",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/ed25519.c",
    "lines": "26-49",
    "snippet": "int crypto_sign_ed25519_keypair(\n    unsigned char *pk,\n    unsigned char *sk\n    )\n{\n  sc25519 scsk;\n  ge25519 gepk;\n  unsigned char extsk[64];\n  int i;\n\n  randombytes(sk, 32);\n  crypto_hash_sha512(extsk, sk, 32);\n  extsk[0] &= 248;\n  extsk[31] &= 127;\n  extsk[31] |= 64;\n\n  sc25519_from32bytes(&scsk,extsk);\n  \n  ge25519_scalarmult_base(&gepk, &scsk);\n  ge25519_pack(pk, &gepk);\n  for(i=0;i<32;i++)\n    sk[32 + i] = pk[i];\n  return 0;\n}",
    "includes": [
      "#include \"ge25519.h\"",
      "#include \"crypto_api.h\"",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "ge25519_pack",
          "args": [
            "pk",
            "&gepk"
          ],
          "line": 45
        },
        "resolved": true,
        "details": {
          "function_name": "ge25519_pack",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/ge25519.c",
          "lines": "243-251",
          "snippet": "void ge25519_pack(unsigned char r[32], const ge25519_p3 *p)\n{\n  fe25519 tx, ty, zi;\n  fe25519_invert(&zi, &p->z); \n  fe25519_mul(&tx, &p->x, &zi);\n  fe25519_mul(&ty, &p->y, &zi);\n  fe25519_pack(r, &ty);\n  r[31] ^= fe25519_getparity(&tx) << 7;\n}",
          "includes": [
            "#include \"ge25519.h\"",
            "#include \"sc25519.h\"",
            "#include \"fe25519.h\"",
            "#include \"includes.h\""
          ],
          "macros_used": [
            "#define ge25519_p3 ge25519"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"ge25519.h\"\n#include \"sc25519.h\"\n#include \"fe25519.h\"\n#include \"includes.h\"\n\n#define ge25519_p3 ge25519\n\nvoid ge25519_pack(unsigned char r[32], const ge25519_p3 *p)\n{\n  fe25519 tx, ty, zi;\n  fe25519_invert(&zi, &p->z); \n  fe25519_mul(&tx, &p->x, &zi);\n  fe25519_mul(&ty, &p->y, &zi);\n  fe25519_pack(r, &ty);\n  r[31] ^= fe25519_getparity(&tx) << 7;\n}"
        }
      },
      {
        "call_info": {
          "callee": "ge25519_scalarmult_base",
          "args": [
            "&gepk",
            "&scsk"
          ],
          "line": 44
        },
        "resolved": true,
        "details": {
          "function_name": "ge25519_scalarmult_base",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/ge25519.c",
          "lines": "306-321",
          "snippet": "void ge25519_scalarmult_base(ge25519_p3 *r, const sc25519 *s)\n{\n  signed char b[85];\n  int i;\n  ge25519_aff t;\n  sc25519_window3(b,s);\n\n  choose_t((ge25519_aff *)r, 0, b[0]);\n  fe25519_setone(&r->z);\n  fe25519_mul(&r->t, &r->x, &r->y);\n  for(i=1;i<85;i++)\n  {\n    choose_t(&t, (unsigned long long) i, b[i]);\n    ge25519_mixadd2(r, &t);\n  }\n}",
          "includes": [
            "#include \"ge25519.h\"",
            "#include \"sc25519.h\"",
            "#include \"fe25519.h\"",
            "#include \"includes.h\""
          ],
          "macros_used": [
            "#define ge25519_p3 ge25519"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"ge25519.h\"\n#include \"sc25519.h\"\n#include \"fe25519.h\"\n#include \"includes.h\"\n\n#define ge25519_p3 ge25519\n\nvoid ge25519_scalarmult_base(ge25519_p3 *r, const sc25519 *s)\n{\n  signed char b[85];\n  int i;\n  ge25519_aff t;\n  sc25519_window3(b,s);\n\n  choose_t((ge25519_aff *)r, 0, b[0]);\n  fe25519_setone(&r->z);\n  fe25519_mul(&r->t, &r->x, &r->y);\n  for(i=1;i<85;i++)\n  {\n    choose_t(&t, (unsigned long long) i, b[i]);\n    ge25519_mixadd2(r, &t);\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "sc25519_from32bytes",
          "args": [
            "&scsk",
            "extsk"
          ],
          "line": 42
        },
        "resolved": true,
        "details": {
          "function_name": "sc25519_from32bytes",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sc25519.c",
          "lines": "102-109",
          "snippet": "void sc25519_from32bytes(sc25519 *r, const unsigned char x[32])\n{\n  int i;\n  crypto_uint32 t[64];\n  for(i=0;i<32;i++) t[i] = x[i];\n  for(i=32;i<64;++i) t[i] = 0;\n  barrett_reduce(r, t);\n}",
          "includes": [
            "#include \"sc25519.h\"",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sc25519.h\"\n#include \"includes.h\"\n\nvoid sc25519_from32bytes(sc25519 *r, const unsigned char x[32])\n{\n  int i;\n  crypto_uint32 t[64];\n  for(i=0;i<32;i++) t[i] = x[i];\n  for(i=32;i<64;++i) t[i] = 0;\n  barrett_reduce(r, t);\n}"
        }
      },
      {
        "call_info": {
          "callee": "crypto_hash_sha512",
          "args": [
            "extsk",
            "sk",
            "32"
          ],
          "line": 37
        },
        "resolved": true,
        "details": {
          "function_name": "crypto_hash_sha512",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/hash.c",
          "lines": "17-27",
          "snippet": "int\ncrypto_hash_sha512(unsigned char *out, const unsigned char *in,\n    unsigned long long inlen)\n{\n\tint r;\n\n\tif ((r = ssh_digest_memory(SSH_DIGEST_SHA512, in, inlen, out,\n\t    crypto_hash_sha512_BYTES)) != 0)\n\t\tfatal(\"%s: %s\", __func__, ssh_err(r));\n\treturn 0;\n}",
          "includes": [
            "#include \"ssherr.h\"",
            "#include \"log.h\"",
            "#include \"digest.h\"",
            "#include <stdarg.h>",
            "#include \"crypto_api.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"ssherr.h\"\n#include \"log.h\"\n#include \"digest.h\"\n#include <stdarg.h>\n#include \"crypto_api.h\"\n\nint\ncrypto_hash_sha512(unsigned char *out, const unsigned char *in,\n    unsigned long long inlen)\n{\n\tint r;\n\n\tif ((r = ssh_digest_memory(SSH_DIGEST_SHA512, in, inlen, out,\n\t    crypto_hash_sha512_BYTES)) != 0)\n\t\tfatal(\"%s: %s\", __func__, ssh_err(r));\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "randombytes",
          "args": [
            "sk",
            "32"
          ],
          "line": 36
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"ge25519.h\"\n#include \"crypto_api.h\"\n#include \"includes.h\"\n\nint crypto_sign_ed25519_keypair(\n    unsigned char *pk,\n    unsigned char *sk\n    )\n{\n  sc25519 scsk;\n  ge25519 gepk;\n  unsigned char extsk[64];\n  int i;\n\n  randombytes(sk, 32);\n  crypto_hash_sha512(extsk, sk, 32);\n  extsk[0] &= 248;\n  extsk[31] &= 127;\n  extsk[31] |= 64;\n\n  sc25519_from32bytes(&scsk,extsk);\n  \n  ge25519_scalarmult_base(&gepk, &scsk);\n  ge25519_pack(pk, &gepk);\n  for(i=0;i<32;i++)\n    sk[32 + i] = pk[i];\n  return 0;\n}"
  },
  {
    "function_name": "get_hram",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/ed25519.c",
    "lines": "14-23",
    "snippet": "static void get_hram(unsigned char *hram, const unsigned char *sm, const unsigned char *pk, unsigned char *playground, unsigned long long smlen)\n{\n  unsigned long long i;\n\n  for (i =  0;i < 32;++i)    playground[i] = sm[i];\n  for (i = 32;i < 64;++i)    playground[i] = pk[i-32];\n  for (i = 64;i < smlen;++i) playground[i] = sm[i];\n\n  crypto_hash_sha512(hram,playground,smlen);\n}",
    "includes": [
      "#include \"ge25519.h\"",
      "#include \"crypto_api.h\"",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "crypto_hash_sha512",
          "args": [
            "hram",
            "playground",
            "smlen"
          ],
          "line": 22
        },
        "resolved": true,
        "details": {
          "function_name": "crypto_hash_sha512",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/hash.c",
          "lines": "17-27",
          "snippet": "int\ncrypto_hash_sha512(unsigned char *out, const unsigned char *in,\n    unsigned long long inlen)\n{\n\tint r;\n\n\tif ((r = ssh_digest_memory(SSH_DIGEST_SHA512, in, inlen, out,\n\t    crypto_hash_sha512_BYTES)) != 0)\n\t\tfatal(\"%s: %s\", __func__, ssh_err(r));\n\treturn 0;\n}",
          "includes": [
            "#include \"ssherr.h\"",
            "#include \"log.h\"",
            "#include \"digest.h\"",
            "#include <stdarg.h>",
            "#include \"crypto_api.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"ssherr.h\"\n#include \"log.h\"\n#include \"digest.h\"\n#include <stdarg.h>\n#include \"crypto_api.h\"\n\nint\ncrypto_hash_sha512(unsigned char *out, const unsigned char *in,\n    unsigned long long inlen)\n{\n\tint r;\n\n\tif ((r = ssh_digest_memory(SSH_DIGEST_SHA512, in, inlen, out,\n\t    crypto_hash_sha512_BYTES)) != 0)\n\t\tfatal(\"%s: %s\", __func__, ssh_err(r));\n\treturn 0;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"ge25519.h\"\n#include \"crypto_api.h\"\n#include \"includes.h\"\n\nstatic void get_hram(unsigned char *hram, const unsigned char *sm, const unsigned char *pk, unsigned char *playground, unsigned long long smlen)\n{\n  unsigned long long i;\n\n  for (i =  0;i < 32;++i)    playground[i] = sm[i];\n  for (i = 32;i < 64;++i)    playground[i] = pk[i-32];\n  for (i = 64;i < smlen;++i) playground[i] = sm[i];\n\n  crypto_hash_sha512(hram,playground,smlen);\n}"
  }
]