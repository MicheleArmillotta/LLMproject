[
  {
    "function_name": "enter_raw_mode",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshtty.c",
    "lines": "68-96",
    "snippet": "void\nenter_raw_mode(int quiet)\n{\n\tstruct termios tio;\n\n\tif (tcgetattr(fileno(stdin), &tio) == -1) {\n\t\tif (!quiet)\n\t\t\tperror(\"tcgetattr\");\n\t\treturn;\n\t}\n\t_saved_tio = tio;\n\ttio.c_iflag |= IGNPAR;\n\ttio.c_iflag &= ~(ISTRIP | INLCR | IGNCR | ICRNL | IXON | IXANY | IXOFF);\n#ifdef IUCLC\n\ttio.c_iflag &= ~IUCLC;\n#endif\n\ttio.c_lflag &= ~(ISIG | ICANON | ECHO | ECHOE | ECHOK | ECHONL);\n#ifdef IEXTEN\n\ttio.c_lflag &= ~IEXTEN;\n#endif\n\ttio.c_oflag &= ~OPOST;\n\ttio.c_cc[VMIN] = 1;\n\ttio.c_cc[VTIME] = 0;\n\tif (tcsetattr(fileno(stdin), TCSADRAIN, &tio) == -1) {\n\t\tif (!quiet)\n\t\t\tperror(\"tcsetattr\");\n\t} else\n\t\t_in_raw_mode = 1;\n}",
    "includes": [
      "#include \"sshpty.h\"",
      "#include <pwd.h>",
      "#include <termios.h>",
      "#include <stdio.h>",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "static struct termios _saved_tio;",
      "static int _in_raw_mode = 0;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "perror",
          "args": [
            "\"tcsetattr\""
          ],
          "line": 93
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "tcsetattr",
          "args": [
            "fileno(stdin)",
            "TCSADRAIN",
            "&tio"
          ],
          "line": 91
        },
        "resolved": true,
        "details": {
          "function_name": "tcsetattr",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/openbsd-compat/bsd-nextstep.c",
          "lines": "52-73",
          "snippet": "int\ntcsetattr(int fd, int opt, const struct termios *t)\n{\n\tstruct termios localterm;\n\n\tif (opt & TCSASOFT) {\n\t\tlocalterm = *t;\n\t\tlocalterm.c_cflag |= CIGNORE;\n\t\tt = &localterm;\n\t}\n\tswitch (opt & ~TCSASOFT) {\n\tcase TCSANOW:\n\t\treturn (ioctl(fd, TIOCSETA, t));\n\tcase TCSADRAIN:\n\t\treturn (ioctl(fd, TIOCSETAW, t));\n\tcase TCSAFLUSH:\n\t\treturn (ioctl(fd, TIOCSETAF, t));\n\tdefault:\n\t\terrno = EINVAL;\n\t\treturn (-1);\n\t}\n}",
          "includes": [
            "#include \"bsd-nextstep.h\"",
            "#include <sys/wait.h>",
            "#include <errno.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"bsd-nextstep.h\"\n#include <sys/wait.h>\n#include <errno.h>\n#include \"includes.h\"\n\nint\ntcsetattr(int fd, int opt, const struct termios *t)\n{\n\tstruct termios localterm;\n\n\tif (opt & TCSASOFT) {\n\t\tlocalterm = *t;\n\t\tlocalterm.c_cflag |= CIGNORE;\n\t\tt = &localterm;\n\t}\n\tswitch (opt & ~TCSASOFT) {\n\tcase TCSANOW:\n\t\treturn (ioctl(fd, TIOCSETA, t));\n\tcase TCSADRAIN:\n\t\treturn (ioctl(fd, TIOCSETAW, t));\n\tcase TCSAFLUSH:\n\t\treturn (ioctl(fd, TIOCSETAF, t));\n\tdefault:\n\t\terrno = EINVAL;\n\t\treturn (-1);\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "fileno",
          "args": [
            "stdin"
          ],
          "line": 91
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "perror",
          "args": [
            "\"tcgetattr\""
          ],
          "line": 75
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "tcgetattr",
          "args": [
            "fileno(stdin)",
            "&tio"
          ],
          "line": 73
        },
        "resolved": true,
        "details": {
          "function_name": "tcgetattr",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/openbsd-compat/bsd-nextstep.c",
          "lines": "46-50",
          "snippet": "int\ntcgetattr(int fd, struct termios *t)\n{\n\treturn (ioctl(fd, TIOCGETA, t));\n}",
          "includes": [
            "#include \"bsd-nextstep.h\"",
            "#include <sys/wait.h>",
            "#include <errno.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"bsd-nextstep.h\"\n#include <sys/wait.h>\n#include <errno.h>\n#include \"includes.h\"\n\nint\ntcgetattr(int fd, struct termios *t)\n{\n\treturn (ioctl(fd, TIOCGETA, t));\n}"
        }
      },
      {
        "call_info": {
          "callee": "fileno",
          "args": [
            "stdin"
          ],
          "line": 73
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"sshpty.h\"\n#include <pwd.h>\n#include <termios.h>\n#include <stdio.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nstatic struct termios _saved_tio;\nstatic int _in_raw_mode = 0;\n\nvoid\nenter_raw_mode(int quiet)\n{\n\tstruct termios tio;\n\n\tif (tcgetattr(fileno(stdin), &tio) == -1) {\n\t\tif (!quiet)\n\t\t\tperror(\"tcgetattr\");\n\t\treturn;\n\t}\n\t_saved_tio = tio;\n\ttio.c_iflag |= IGNPAR;\n\ttio.c_iflag &= ~(ISTRIP | INLCR | IGNCR | ICRNL | IXON | IXANY | IXOFF);\n#ifdef IUCLC\n\ttio.c_iflag &= ~IUCLC;\n#endif\n\ttio.c_lflag &= ~(ISIG | ICANON | ECHO | ECHOE | ECHOK | ECHONL);\n#ifdef IEXTEN\n\ttio.c_lflag &= ~IEXTEN;\n#endif\n\ttio.c_oflag &= ~OPOST;\n\ttio.c_cc[VMIN] = 1;\n\ttio.c_cc[VTIME] = 0;\n\tif (tcsetattr(fileno(stdin), TCSADRAIN, &tio) == -1) {\n\t\tif (!quiet)\n\t\t\tperror(\"tcsetattr\");\n\t} else\n\t\t_in_raw_mode = 1;\n}"
  },
  {
    "function_name": "leave_raw_mode",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshtty.c",
    "lines": "56-66",
    "snippet": "void\nleave_raw_mode(int quiet)\n{\n\tif (!_in_raw_mode)\n\t\treturn;\n\tif (tcsetattr(fileno(stdin), TCSADRAIN, &_saved_tio) == -1) {\n\t\tif (!quiet)\n\t\t\tperror(\"tcsetattr\");\n\t} else\n\t\t_in_raw_mode = 0;\n}",
    "includes": [
      "#include \"sshpty.h\"",
      "#include <pwd.h>",
      "#include <termios.h>",
      "#include <stdio.h>",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "static struct termios _saved_tio;",
      "static int _in_raw_mode = 0;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "perror",
          "args": [
            "\"tcsetattr\""
          ],
          "line": 63
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "tcsetattr",
          "args": [
            "fileno(stdin)",
            "TCSADRAIN",
            "&_saved_tio"
          ],
          "line": 61
        },
        "resolved": true,
        "details": {
          "function_name": "tcsetattr",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/openbsd-compat/bsd-nextstep.c",
          "lines": "52-73",
          "snippet": "int\ntcsetattr(int fd, int opt, const struct termios *t)\n{\n\tstruct termios localterm;\n\n\tif (opt & TCSASOFT) {\n\t\tlocalterm = *t;\n\t\tlocalterm.c_cflag |= CIGNORE;\n\t\tt = &localterm;\n\t}\n\tswitch (opt & ~TCSASOFT) {\n\tcase TCSANOW:\n\t\treturn (ioctl(fd, TIOCSETA, t));\n\tcase TCSADRAIN:\n\t\treturn (ioctl(fd, TIOCSETAW, t));\n\tcase TCSAFLUSH:\n\t\treturn (ioctl(fd, TIOCSETAF, t));\n\tdefault:\n\t\terrno = EINVAL;\n\t\treturn (-1);\n\t}\n}",
          "includes": [
            "#include \"bsd-nextstep.h\"",
            "#include <sys/wait.h>",
            "#include <errno.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"bsd-nextstep.h\"\n#include <sys/wait.h>\n#include <errno.h>\n#include \"includes.h\"\n\nint\ntcsetattr(int fd, int opt, const struct termios *t)\n{\n\tstruct termios localterm;\n\n\tif (opt & TCSASOFT) {\n\t\tlocalterm = *t;\n\t\tlocalterm.c_cflag |= CIGNORE;\n\t\tt = &localterm;\n\t}\n\tswitch (opt & ~TCSASOFT) {\n\tcase TCSANOW:\n\t\treturn (ioctl(fd, TIOCSETA, t));\n\tcase TCSADRAIN:\n\t\treturn (ioctl(fd, TIOCSETAW, t));\n\tcase TCSAFLUSH:\n\t\treturn (ioctl(fd, TIOCSETAF, t));\n\tdefault:\n\t\terrno = EINVAL;\n\t\treturn (-1);\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "fileno",
          "args": [
            "stdin"
          ],
          "line": 61
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"sshpty.h\"\n#include <pwd.h>\n#include <termios.h>\n#include <stdio.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nstatic struct termios _saved_tio;\nstatic int _in_raw_mode = 0;\n\nvoid\nleave_raw_mode(int quiet)\n{\n\tif (!_in_raw_mode)\n\t\treturn;\n\tif (tcsetattr(fileno(stdin), TCSADRAIN, &_saved_tio) == -1) {\n\t\tif (!quiet)\n\t\t\tperror(\"tcsetattr\");\n\t} else\n\t\t_in_raw_mode = 0;\n}"
  },
  {
    "function_name": "get_saved_tio",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshtty.c",
    "lines": "50-54",
    "snippet": "struct termios *\nget_saved_tio(void)\n{\n\treturn _in_raw_mode ? &_saved_tio : NULL;\n}",
    "includes": [
      "#include \"sshpty.h\"",
      "#include <pwd.h>",
      "#include <termios.h>",
      "#include <stdio.h>",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "static struct termios _saved_tio;",
      "static int _in_raw_mode = 0;"
    ],
    "called_functions": [],
    "contextual_snippet": "#include \"sshpty.h\"\n#include <pwd.h>\n#include <termios.h>\n#include <stdio.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nstatic struct termios _saved_tio;\nstatic int _in_raw_mode = 0;\n\nstruct termios *\nget_saved_tio(void)\n{\n\treturn _in_raw_mode ? &_saved_tio : NULL;\n}"
  }
]