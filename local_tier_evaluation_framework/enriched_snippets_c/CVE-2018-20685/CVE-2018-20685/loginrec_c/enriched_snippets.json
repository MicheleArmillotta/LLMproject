[
  {
    "function_name": "record_failed_login",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
    "lines": "1655-1723",
    "snippet": "void\nrecord_failed_login(const char *username, const char *hostname,\n    const char *ttyn)\n{\n\tint fd;\n\tstruct utmp ut;\n\tstruct sockaddr_storage from;\n\tsocklen_t fromlen = sizeof(from);\n\tstruct sockaddr_in *a4;\n\tstruct sockaddr_in6 *a6;\n\ttime_t t;\n\tstruct stat fst;\n\n\tif (geteuid() != 0)\n\t\treturn;\n\tif ((fd = open(_PATH_BTMP, O_WRONLY | O_APPEND)) < 0) {\n\t\tdebug(\"Unable to open the btmp file %s: %s\", _PATH_BTMP,\n\t\t    strerror(errno));\n\t\treturn;\n\t}\n\tif (fstat(fd, &fst) < 0) {\n\t\tlogit(\"%s: fstat of %s failed: %s\", __func__, _PATH_BTMP,\n\t\t    strerror(errno));\n\t\tgoto out;\n\t}\n\tif((fst.st_mode & (S_IXGRP | S_IRWXO)) || (fst.st_uid != 0)){\n\t\tlogit(\"Excess permission or bad ownership on file %s\",\n\t\t    _PATH_BTMP);\n\t\tgoto out;\n\t}\n\n\tmemset(&ut, 0, sizeof(ut));\n\t/* strncpy because we don't necessarily want nul termination */\n\tstrncpy(ut.ut_user, username, sizeof(ut.ut_user));\n\tstrlcpy(ut.ut_line, \"ssh:notty\", sizeof(ut.ut_line));\n\n\ttime(&t);\n\tut.ut_time = t;     /* ut_time is not always a time_t */\n\tut.ut_type = LOGIN_PROCESS;\n\tut.ut_pid = getpid();\n\n\t/* strncpy because we don't necessarily want nul termination */\n\tstrncpy(ut.ut_host, hostname, sizeof(ut.ut_host));\n\n\tif (packet_connection_is_on_socket() &&\n\t    getpeername(packet_get_connection_in(),\n\t    (struct sockaddr *)&from, &fromlen) == 0) {\n\t\tipv64_normalise_mapped(&from, &fromlen);\n\t\tif (from.ss_family == AF_INET) {\n\t\t\ta4 = (struct sockaddr_in *)&from;\n\t\t\tmemcpy(&ut.ut_addr, &(a4->sin_addr),\n\t\t\t    MIN_SIZEOF(ut.ut_addr, a4->sin_addr));\n\t\t}\n#ifdef HAVE_ADDR_V6_IN_UTMP\n\t\tif (from.ss_family == AF_INET6) {\n\t\t\ta6 = (struct sockaddr_in6 *)&from;\n\t\t\tmemcpy(&ut.ut_addr_v6, &(a6->sin6_addr),\n\t\t\t    MIN_SIZEOF(ut.ut_addr_v6, a6->sin6_addr));\n\t\t}\n#endif\n\t}\n\n\tif (atomicio(vwrite, fd, &ut, sizeof(ut)) != sizeof(ut))\n\t\terror(\"Failed to write to %s: %s\", _PATH_BTMP,\n\t\t    strerror(errno));\n\nout:\n\tclose(fd);\n}",
    "includes": [
      "# include <util.h>",
      "#include \"ssherr.h\"",
      "#include \"sshbuf.h\"",
      "#include \"auth.h\"",
      "#include \"canohost.h\"",
      "#include \"packet.h\"",
      "#include \"atomicio.h\"",
      "#include \"log.h\"",
      "#include \"loginrec.h\"",
      "#include \"ssh.h\"",
      "#include \"hostfile.h\"",
      "#include \"sshkey.h\"",
      "#include \"xmalloc.h\"",
      "#include <unistd.h>",
      "#include <time.h>",
      "#include <string.h>",
      "#include <stdarg.h>",
      "#include <pwd.h>",
      "# include <paths.h>",
      "#include <fcntl.h>",
      "#include <errno.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "close",
          "args": [
            "fd"
          ],
          "line": 1722
        },
        "resolved": true,
        "details": {
          "function_name": "ssh_close_authentication_socket",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/authfd.c",
          "lines": "171-176",
          "snippet": "void\nssh_close_authentication_socket(int sock)\n{\n\tif (getenv(SSH_AUTHSOCKET_ENV_NAME))\n\t\tclose(sock);\n}",
          "includes": [
            "#include \"ssherr.h\"",
            "#include \"misc.h\"",
            "#include \"atomicio.h\"",
            "#include \"log.h\"",
            "#include \"compat.h\"",
            "#include \"cipher.h\"",
            "#include \"authfd.h\"",
            "#include \"sshkey.h\"",
            "#include \"sshbuf.h\"",
            "#include \"ssh.h\"",
            "#include \"xmalloc.h\"",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "#include <stdlib.h>",
            "#include <fcntl.h>",
            "#include <sys/socket.h>",
            "#include <sys/un.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"ssherr.h\"\n#include \"misc.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"compat.h\"\n#include \"cipher.h\"\n#include \"authfd.h\"\n#include \"sshkey.h\"\n#include \"sshbuf.h\"\n#include \"ssh.h\"\n#include \"xmalloc.h\"\n#include <errno.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdarg.h>\n#include <signal.h>\n#include <stdlib.h>\n#include <fcntl.h>\n#include <sys/socket.h>\n#include <sys/un.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\nssh_close_authentication_socket(int sock)\n{\n\tif (getenv(SSH_AUTHSOCKET_ENV_NAME))\n\t\tclose(sock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"Failed to write to %s: %s\"",
            "_PATH_BTMP",
            "strerror(errno)"
          ],
          "line": 1718
        },
        "resolved": true,
        "details": {
          "function_name": "error",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/log.c",
          "lines": "162-170",
          "snippet": "void\nerror(const char *fmt,...)\n{\n\tva_list args;\n\n\tva_start(args, fmt);\n\tdo_log(SYSLOG_LEVEL_ERROR, fmt, args);\n\tva_end(args);\n}",
          "includes": [
            "#include \"log.h\"",
            "# include <vis.h>",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <syslog.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <fcntl.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n# include <vis.h>\n#include <errno.h>\n#include <unistd.h>\n#include <syslog.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <fcntl.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\nerror(const char *fmt,...)\n{\n\tva_list args;\n\n\tva_start(args, fmt);\n\tdo_log(SYSLOG_LEVEL_ERROR, fmt, args);\n\tva_end(args);\n}"
        }
      },
      {
        "call_info": {
          "callee": "strerror",
          "args": [
            "errno"
          ],
          "line": 1719
        },
        "resolved": true,
        "details": {
          "function_name": "ssh_gai_strerror",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/misc.c",
          "lines": "140-146",
          "snippet": "const char *\nssh_gai_strerror(int gaierr)\n{\n\tif (gaierr == EAI_SYSTEM && errno != 0)\n\t\treturn strerror(errno);\n\treturn gai_strerror(gaierr);\n}",
          "includes": [
            "#include \"platform.h\"",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"ssh.h\"",
            "#include \"log.h\"",
            "#include \"misc.h\"",
            "#include \"xmalloc.h\"",
            "#include <net/if.h>",
            "#include <pwd.h>",
            "# include <paths.h>",
            "#include <netdb.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <ctype.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/tcp.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in_systm.h>",
            "#include <netinet/in.h>",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <libgen.h>",
            "#include <limits.h>",
            "#include <sys/un.h>",
            "#include <sys/wait.h>",
            "#include <sys/time.h>",
            "#include <sys/stat.h>",
            "#include <sys/socket.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"platform.h\"\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"ssh.h\"\n#include \"log.h\"\n#include \"misc.h\"\n#include \"xmalloc.h\"\n#include <net/if.h>\n#include <pwd.h>\n# include <paths.h>\n#include <netdb.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <ctype.h>\n#include <arpa/inet.h>\n#include <netinet/tcp.h>\n#include <netinet/ip.h>\n#include <netinet/in_systm.h>\n#include <netinet/in.h>\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <libgen.h>\n#include <limits.h>\n#include <sys/un.h>\n#include <sys/wait.h>\n#include <sys/time.h>\n#include <sys/stat.h>\n#include <sys/socket.h>\n#include <sys/ioctl.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nconst char *\nssh_gai_strerror(int gaierr)\n{\n\tif (gaierr == EAI_SYSTEM && errno != 0)\n\t\treturn strerror(errno);\n\treturn gai_strerror(gaierr);\n}"
        }
      },
      {
        "call_info": {
          "callee": "atomicio",
          "args": [
            "vwrite",
            "fd",
            "&ut",
            "sizeof(ut)"
          ],
          "line": 1717
        },
        "resolved": true,
        "details": {
          "function_name": "atomiciov",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/atomicio.c",
          "lines": "165-170",
          "snippet": "size_t\natomiciov(ssize_t (*f) (int, const struct iovec *, int), int fd,\n    const struct iovec *_iov, int iovcnt)\n{\n\treturn atomiciov6(f, fd, _iov, iovcnt, NULL, NULL);\n}",
          "includes": [
            "#include \"atomicio.h\"",
            "#include <limits.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#  include <sys/poll.h>",
            "#include <poll.h>",
            "#include <errno.h>",
            "#include <sys/uio.h>",
            "#include <sys/param.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"atomicio.h\"\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#  include <sys/poll.h>\n#include <poll.h>\n#include <errno.h>\n#include <sys/uio.h>\n#include <sys/param.h>\n#include \"includes.h\"\n\nsize_t\natomiciov(ssize_t (*f) (int, const struct iovec *, int), int fd,\n    const struct iovec *_iov, int iovcnt)\n{\n\treturn atomiciov6(f, fd, _iov, iovcnt, NULL, NULL);\n}"
        }
      },
      {
        "call_info": {
          "callee": "memcpy",
          "args": [
            "&ut.ut_addr_v6",
            "&(a6->sin6_addr)",
            "MIN_SIZEOF(ut.ut_addr_v6, a6->sin6_addr)"
          ],
          "line": 1711
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "MIN_SIZEOF",
          "args": [
            "ut.ut_addr_v6",
            "a6->sin6_addr"
          ],
          "line": 1712
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memcpy",
          "args": [
            "&ut.ut_addr",
            "&(a4->sin_addr)",
            "MIN_SIZEOF(ut.ut_addr, a4->sin_addr)"
          ],
          "line": 1705
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "MIN_SIZEOF",
          "args": [
            "ut.ut_addr",
            "a4->sin_addr"
          ],
          "line": 1706
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ipv64_normalise_mapped",
          "args": [
            "&from",
            "&fromlen"
          ],
          "line": 1702
        },
        "resolved": true,
        "details": {
          "function_name": "ipv64_normalise_mapped",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/canohost.c",
          "lines": "38-61",
          "snippet": "void\nipv64_normalise_mapped(struct sockaddr_storage *addr, socklen_t *len)\n{\n\tstruct sockaddr_in6 *a6 = (struct sockaddr_in6 *)addr;\n\tstruct sockaddr_in *a4 = (struct sockaddr_in *)addr;\n\tstruct in_addr inaddr;\n\tu_int16_t port;\n\n\tif (addr->ss_family != AF_INET6 ||\n\t    !IN6_IS_ADDR_V4MAPPED(&a6->sin6_addr))\n\t\treturn;\n\n\tdebug3(\"Normalising mapped IPv4 in IPv6 address\");\n\n\tmemcpy(&inaddr, ((char *)&a6->sin6_addr) + 12, sizeof(inaddr));\n\tport = a6->sin6_port;\n\n\tmemset(a4, 0, sizeof(*a4));\n\n\ta4->sin_family = AF_INET;\n\t*len = sizeof(*a4);\n\tmemcpy(&a4->sin_addr, &inaddr, sizeof(inaddr));\n\ta4->sin_port = port;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include \"canohost.h\"",
            "#include \"log.h\"",
            "#include \"packet.h\"",
            "#include \"xmalloc.h\"",
            "#include <unistd.h>",
            "#include <stdarg.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <netdb.h>",
            "#include <errno.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/in.h>",
            "#include <sys/un.h>",
            "#include <sys/socket.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"packet.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <stdarg.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/in.h>\n#include <sys/un.h>\n#include <sys/socket.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\nipv64_normalise_mapped(struct sockaddr_storage *addr, socklen_t *len)\n{\n\tstruct sockaddr_in6 *a6 = (struct sockaddr_in6 *)addr;\n\tstruct sockaddr_in *a4 = (struct sockaddr_in *)addr;\n\tstruct in_addr inaddr;\n\tu_int16_t port;\n\n\tif (addr->ss_family != AF_INET6 ||\n\t    !IN6_IS_ADDR_V4MAPPED(&a6->sin6_addr))\n\t\treturn;\n\n\tdebug3(\"Normalising mapped IPv4 in IPv6 address\");\n\n\tmemcpy(&inaddr, ((char *)&a6->sin6_addr) + 12, sizeof(inaddr));\n\tport = a6->sin6_port;\n\n\tmemset(a4, 0, sizeof(*a4));\n\n\ta4->sin_family = AF_INET;\n\t*len = sizeof(*a4);\n\tmemcpy(&a4->sin_addr, &inaddr, sizeof(inaddr));\n\ta4->sin_port = port;\n}"
        }
      },
      {
        "call_info": {
          "callee": "getpeername",
          "args": [
            "packet_get_connection_in()",
            "(struct sockaddr *)&from",
            "&fromlen"
          ],
          "line": 1700
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "packet_get_connection_in",
          "args": [],
          "line": 1700
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "packet_connection_is_on_socket",
          "args": [],
          "line": 1699
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strncpy",
          "args": [
            "ut.ut_host",
            "hostname",
            "sizeof(ut.ut_host)"
          ],
          "line": 1697
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "getpid",
          "args": [],
          "line": 1694
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "time",
          "args": [
            "&t"
          ],
          "line": 1691
        },
        "resolved": true,
        "details": {
          "function_name": "login_set_current_time",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
          "lines": "406-415",
          "snippet": "void\nlogin_set_current_time(struct logininfo *li)\n{\n\tstruct timeval tv;\n\n\tgettimeofday(&tv, NULL);\n\n\tli->tv_sec = tv.tv_sec;\n\tli->tv_usec = tv.tv_usec;\n}",
          "includes": [
            "# include <util.h>",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"auth.h\"",
            "#include \"canohost.h\"",
            "#include \"packet.h\"",
            "#include \"atomicio.h\"",
            "#include \"log.h\"",
            "#include \"loginrec.h\"",
            "#include \"ssh.h\"",
            "#include \"hostfile.h\"",
            "#include \"sshkey.h\"",
            "#include \"xmalloc.h\"",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <string.h>",
            "#include <stdarg.h>",
            "#include <pwd.h>",
            "# include <paths.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "int utmp_write_entry(struct logininfo *li);",
            "int utmpx_write_entry(struct logininfo *li);",
            "int wtmp_write_entry(struct logininfo *li);",
            "int wtmpx_write_entry(struct logininfo *li);",
            "int lastlog_write_entry(struct logininfo *li);",
            "int syslogin_write_entry(struct logininfo *li);",
            "int getlast_entry(struct logininfo *li);",
            "int lastlog_get_entry(struct logininfo *li);",
            "int utmpx_get_entry(struct logininfo *li);",
            "int wtmp_get_entry(struct logininfo *li);",
            "int wtmpx_get_entry(struct logininfo *li);"
          ],
          "called_functions": [],
          "contextual_snippet": "# include <util.h>\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"auth.h\"\n#include \"canohost.h\"\n#include \"packet.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"loginrec.h\"\n#include \"ssh.h\"\n#include \"hostfile.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdarg.h>\n#include <pwd.h>\n# include <paths.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint utmp_write_entry(struct logininfo *li);\nint utmpx_write_entry(struct logininfo *li);\nint wtmp_write_entry(struct logininfo *li);\nint wtmpx_write_entry(struct logininfo *li);\nint lastlog_write_entry(struct logininfo *li);\nint syslogin_write_entry(struct logininfo *li);\nint getlast_entry(struct logininfo *li);\nint lastlog_get_entry(struct logininfo *li);\nint utmpx_get_entry(struct logininfo *li);\nint wtmp_get_entry(struct logininfo *li);\nint wtmpx_get_entry(struct logininfo *li);\n\nvoid\nlogin_set_current_time(struct logininfo *li)\n{\n\tstruct timeval tv;\n\n\tgettimeofday(&tv, NULL);\n\n\tli->tv_sec = tv.tv_sec;\n\tli->tv_usec = tv.tv_usec;\n}"
        }
      },
      {
        "call_info": {
          "callee": "strlcpy",
          "args": [
            "ut.ut_line",
            "\"ssh:notty\"",
            "sizeof(ut.ut_line)"
          ],
          "line": 1689
        },
        "resolved": true,
        "details": {
          "function_name": "strlcpy",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/openbsd-compat/strlcpy.c",
          "lines": "32-56",
          "snippet": "size_t\nstrlcpy(char *dst, const char *src, size_t siz)\n{\n\tchar *d = dst;\n\tconst char *s = src;\n\tsize_t n = siz;\n\n\t/* Copy as many bytes as will fit */\n\tif (n != 0) {\n\t\twhile (--n != 0) {\n\t\t\tif ((*d++ = *s++) == '\\0')\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\t/* Not enough room in dst, add NUL and traverse rest of src */\n\tif (n == 0) {\n\t\tif (siz != 0)\n\t\t\t*d = '\\0';\t\t/* NUL-terminate dst */\n\t\twhile (*s++)\n\t\t\t;\n\t}\n\n\treturn(s - src - 1);\t/* count does not include NUL */\n}",
          "includes": [
            "#include <string.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nsize_t\nstrlcpy(char *dst, const char *src, size_t siz)\n{\n\tchar *d = dst;\n\tconst char *s = src;\n\tsize_t n = siz;\n\n\t/* Copy as many bytes as will fit */\n\tif (n != 0) {\n\t\twhile (--n != 0) {\n\t\t\tif ((*d++ = *s++) == '\\0')\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\t/* Not enough room in dst, add NUL and traverse rest of src */\n\tif (n == 0) {\n\t\tif (siz != 0)\n\t\t\t*d = '\\0';\t\t/* NUL-terminate dst */\n\t\twhile (*s++)\n\t\t\t;\n\t}\n\n\treturn(s - src - 1);\t/* count does not include NUL */\n}"
        }
      },
      {
        "call_info": {
          "callee": "strncpy",
          "args": [
            "ut.ut_user",
            "username",
            "sizeof(ut.ut_user)"
          ],
          "line": 1688
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memset",
          "args": [
            "&ut",
            "0",
            "sizeof(ut)"
          ],
          "line": 1686
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "logit",
          "args": [
            "\"Excess permission or bad ownership on file %s\"",
            "_PATH_BTMP"
          ],
          "line": 1681
        },
        "resolved": true,
        "details": {
          "function_name": "logit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/log.c",
          "lines": "198-206",
          "snippet": "void\nlogit(const char *fmt,...)\n{\n\tva_list args;\n\n\tva_start(args, fmt);\n\tdo_log(SYSLOG_LEVEL_INFO, fmt, args);\n\tva_end(args);\n}",
          "includes": [
            "#include \"log.h\"",
            "# include <vis.h>",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <syslog.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <fcntl.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n# include <vis.h>\n#include <errno.h>\n#include <unistd.h>\n#include <syslog.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <fcntl.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\nlogit(const char *fmt,...)\n{\n\tva_list args;\n\n\tva_start(args, fmt);\n\tdo_log(SYSLOG_LEVEL_INFO, fmt, args);\n\tva_end(args);\n}"
        }
      },
      {
        "call_info": {
          "callee": "fstat",
          "args": [
            "fd",
            "&fst"
          ],
          "line": 1675
        },
        "resolved": true,
        "details": {
          "function_name": "fstatvfs",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/openbsd-compat/bsd-statvfs.c",
          "lines": "71-85",
          "snippet": "int fstatvfs(int fd, struct statvfs *buf)\n{\n#  ifdef HAVE_FSTATFS\n\tstruct statfs fs;\n\n\tmemset(&fs, 0, sizeof(fs));\n\tif (fstatfs(fd, &fs) == -1)\n\t\treturn -1;\n\tcopy_statfs_to_statvfs(buf, &fs);\n\treturn 0;\n#  else\n\terrno = ENOSYS;\n\treturn -1;\n#  endif\n}",
          "includes": [
            "#include <errno.h>",
            "# include <sys/mount.h>",
            "#include <sys/param.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <errno.h>\n# include <sys/mount.h>\n#include <sys/param.h>\n#include \"includes.h\"\n\nint fstatvfs(int fd, struct statvfs *buf)\n{\n#  ifdef HAVE_FSTATFS\n\tstruct statfs fs;\n\n\tmemset(&fs, 0, sizeof(fs));\n\tif (fstatfs(fd, &fs) == -1)\n\t\treturn -1;\n\tcopy_statfs_to_statvfs(buf, &fs);\n\treturn 0;\n#  else\n\terrno = ENOSYS;\n\treturn -1;\n#  endif\n}"
        }
      },
      {
        "call_info": {
          "callee": "debug",
          "args": [
            "\"Unable to open the btmp file %s: %s\"",
            "_PATH_BTMP",
            "strerror(errno)"
          ],
          "line": 1671
        },
        "resolved": true,
        "details": {
          "function_name": "debug3",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/log.c",
          "lines": "242-250",
          "snippet": "void\ndebug3(const char *fmt,...)\n{\n\tva_list args;\n\n\tva_start(args, fmt);\n\tdo_log(SYSLOG_LEVEL_DEBUG3, fmt, args);\n\tva_end(args);\n}",
          "includes": [
            "#include \"log.h\"",
            "# include <vis.h>",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <syslog.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <fcntl.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n# include <vis.h>\n#include <errno.h>\n#include <unistd.h>\n#include <syslog.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <fcntl.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\ndebug3(const char *fmt,...)\n{\n\tva_list args;\n\n\tva_start(args, fmt);\n\tdo_log(SYSLOG_LEVEL_DEBUG3, fmt, args);\n\tva_end(args);\n}"
        }
      },
      {
        "call_info": {
          "callee": "open",
          "args": [
            "_PATH_BTMP",
            "O_WRONLY | O_APPEND"
          ],
          "line": 1670
        },
        "resolved": true,
        "details": {
          "function_name": "process_permitopen",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/servconf.c",
          "lines": "901-909",
          "snippet": "void\nprocess_permitopen(struct ssh *ssh, ServerOptions *options)\n{\n\tprocess_permitopen_list(ssh, sPermitOpen,\n\t    options->permitted_opens, options->num_permitted_opens);\n\tprocess_permitopen_list(ssh, sPermitListen,\n\t    options->permitted_listens,\n\t    options->num_permitted_listens);\n}",
          "includes": [
            "#include \"digest.h\"",
            "#include \"myproposal.h\"",
            "#include \"auth.h\"",
            "#include \"hostfile.h\"",
            "#include \"ssherr.h\"",
            "#include \"packet.h\"",
            "#include \"canohost.h\"",
            "#include \"groupaccess.h\"",
            "#include \"channels.h\"",
            "#include \"match.h\"",
            "#include \"mac.h\"",
            "#include \"kex.h\"",
            "#include \"sshkey.h\"",
            "#include \"cipher.h\"",
            "#include \"pathnames.h\"",
            "#include \"compat.h\"",
            "#include \"servconf.h\"",
            "#include \"misc.h\"",
            "#include \"sshbuf.h\"",
            "#include \"log.h\"",
            "#include \"ssh.h\"",
            "#include \"xmalloc.h\"",
            "#include \"openbsd-compat/sys-queue.h\"",
            "#include <util.h>",
            "#include <errno.h>",
            "#include <stdarg.h>",
            "#include <limits.h>",
            "#include <unistd.h>",
            "#include <signal.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <pwd.h>",
            "#include <netdb.h>",
            "#include <ctype.h>",
            "#include <net/route.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in_systm.h>",
            "#include <netinet/in.h>",
            "#include <sys/sysctl.h>",
            "#include <sys/socket.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static void add_listen_addr(ServerOptions *, const char *,\n    const char *, int);",
            "static void add_one_listen_addr(ServerOptions *, const char *,\n    const char *, int);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"digest.h\"\n#include \"myproposal.h\"\n#include \"auth.h\"\n#include \"hostfile.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"canohost.h\"\n#include \"groupaccess.h\"\n#include \"channels.h\"\n#include \"match.h\"\n#include \"mac.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"pathnames.h\"\n#include \"compat.h\"\n#include \"servconf.h\"\n#include \"misc.h\"\n#include \"sshbuf.h\"\n#include \"log.h\"\n#include \"ssh.h\"\n#include \"xmalloc.h\"\n#include \"openbsd-compat/sys-queue.h\"\n#include <util.h>\n#include <errno.h>\n#include <stdarg.h>\n#include <limits.h>\n#include <unistd.h>\n#include <signal.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <netdb.h>\n#include <ctype.h>\n#include <net/route.h>\n#include <netinet/ip.h>\n#include <netinet/in_systm.h>\n#include <netinet/in.h>\n#include <sys/sysctl.h>\n#include <sys/socket.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nstatic void add_listen_addr(ServerOptions *, const char *,\n    const char *, int);\nstatic void add_one_listen_addr(ServerOptions *, const char *,\n    const char *, int);\n\nvoid\nprocess_permitopen(struct ssh *ssh, ServerOptions *options)\n{\n\tprocess_permitopen_list(ssh, sPermitOpen,\n\t    options->permitted_opens, options->num_permitted_opens);\n\tprocess_permitopen_list(ssh, sPermitListen,\n\t    options->permitted_listens,\n\t    options->num_permitted_listens);\n}"
        }
      },
      {
        "call_info": {
          "callee": "geteuid",
          "args": [],
          "line": 1668
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "# include <util.h>\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"auth.h\"\n#include \"canohost.h\"\n#include \"packet.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"loginrec.h\"\n#include \"ssh.h\"\n#include \"hostfile.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdarg.h>\n#include <pwd.h>\n# include <paths.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\nrecord_failed_login(const char *username, const char *hostname,\n    const char *ttyn)\n{\n\tint fd;\n\tstruct utmp ut;\n\tstruct sockaddr_storage from;\n\tsocklen_t fromlen = sizeof(from);\n\tstruct sockaddr_in *a4;\n\tstruct sockaddr_in6 *a6;\n\ttime_t t;\n\tstruct stat fst;\n\n\tif (geteuid() != 0)\n\t\treturn;\n\tif ((fd = open(_PATH_BTMP, O_WRONLY | O_APPEND)) < 0) {\n\t\tdebug(\"Unable to open the btmp file %s: %s\", _PATH_BTMP,\n\t\t    strerror(errno));\n\t\treturn;\n\t}\n\tif (fstat(fd, &fst) < 0) {\n\t\tlogit(\"%s: fstat of %s failed: %s\", __func__, _PATH_BTMP,\n\t\t    strerror(errno));\n\t\tgoto out;\n\t}\n\tif((fst.st_mode & (S_IXGRP | S_IRWXO)) || (fst.st_uid != 0)){\n\t\tlogit(\"Excess permission or bad ownership on file %s\",\n\t\t    _PATH_BTMP);\n\t\tgoto out;\n\t}\n\n\tmemset(&ut, 0, sizeof(ut));\n\t/* strncpy because we don't necessarily want nul termination */\n\tstrncpy(ut.ut_user, username, sizeof(ut.ut_user));\n\tstrlcpy(ut.ut_line, \"ssh:notty\", sizeof(ut.ut_line));\n\n\ttime(&t);\n\tut.ut_time = t;     /* ut_time is not always a time_t */\n\tut.ut_type = LOGIN_PROCESS;\n\tut.ut_pid = getpid();\n\n\t/* strncpy because we don't necessarily want nul termination */\n\tstrncpy(ut.ut_host, hostname, sizeof(ut.ut_host));\n\n\tif (packet_connection_is_on_socket() &&\n\t    getpeername(packet_get_connection_in(),\n\t    (struct sockaddr *)&from, &fromlen) == 0) {\n\t\tipv64_normalise_mapped(&from, &fromlen);\n\t\tif (from.ss_family == AF_INET) {\n\t\t\ta4 = (struct sockaddr_in *)&from;\n\t\t\tmemcpy(&ut.ut_addr, &(a4->sin_addr),\n\t\t\t    MIN_SIZEOF(ut.ut_addr, a4->sin_addr));\n\t\t}\n#ifdef HAVE_ADDR_V6_IN_UTMP\n\t\tif (from.ss_family == AF_INET6) {\n\t\t\ta6 = (struct sockaddr_in6 *)&from;\n\t\t\tmemcpy(&ut.ut_addr_v6, &(a6->sin6_addr),\n\t\t\t    MIN_SIZEOF(ut.ut_addr_v6, a6->sin6_addr));\n\t\t}\n#endif\n\t}\n\n\tif (atomicio(vwrite, fd, &ut, sizeof(ut)) != sizeof(ut))\n\t\terror(\"Failed to write to %s: %s\", _PATH_BTMP,\n\t\t    strerror(errno));\n\nout:\n\tclose(fd);\n}"
  },
  {
    "function_name": "utmpx_get_entry",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
    "lines": "1623-1644",
    "snippet": "int\nutmpx_get_entry(struct logininfo *li)\n{\n\tstruct utmpx *utx;\n\n\tif (setutxdb(UTXDB_LASTLOGIN, NULL) != 0)\n\t\treturn (0);\n\tutx = getutxuser(li->username);\n\tif (utx == NULL) {\n\t\tendutxent();\n\t\treturn (0);\n\t}\n\n\tline_fullname(li->line, utx->ut_line,\n\t    MIN_SIZEOF(li->line, utx->ut_line));\n\tstrlcpy(li->hostname, utx->ut_host,\n\t    MIN_SIZEOF(li->hostname, utx->ut_host));\n\tli->tv_sec = utx->ut_tv.tv_sec;\n\tli->tv_usec = utx->ut_tv.tv_usec;\n\tendutxent();\n\treturn (1);\n}",
    "includes": [
      "# include <util.h>",
      "#include \"ssherr.h\"",
      "#include \"sshbuf.h\"",
      "#include \"auth.h\"",
      "#include \"canohost.h\"",
      "#include \"packet.h\"",
      "#include \"atomicio.h\"",
      "#include \"log.h\"",
      "#include \"loginrec.h\"",
      "#include \"ssh.h\"",
      "#include \"hostfile.h\"",
      "#include \"sshkey.h\"",
      "#include \"xmalloc.h\"",
      "#include <unistd.h>",
      "#include <time.h>",
      "#include <string.h>",
      "#include <stdarg.h>",
      "#include <pwd.h>",
      "# include <paths.h>",
      "#include <fcntl.h>",
      "#include <errno.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "int utmp_write_entry(struct logininfo *li);",
      "int utmpx_write_entry(struct logininfo *li);",
      "int wtmp_write_entry(struct logininfo *li);",
      "int wtmpx_write_entry(struct logininfo *li);",
      "int lastlog_write_entry(struct logininfo *li);",
      "int syslogin_write_entry(struct logininfo *li);",
      "int getlast_entry(struct logininfo *li);",
      "int lastlog_get_entry(struct logininfo *li);",
      "int utmpx_get_entry(struct logininfo *li);",
      "int wtmp_get_entry(struct logininfo *li);",
      "int wtmpx_get_entry(struct logininfo *li);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "endutxent",
          "args": [],
          "line": 1642
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strlcpy",
          "args": [
            "li->hostname",
            "utx->ut_host",
            "MIN_SIZEOF(li->hostname, utx->ut_host)"
          ],
          "line": 1638
        },
        "resolved": true,
        "details": {
          "function_name": "strlcpy",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/openbsd-compat/strlcpy.c",
          "lines": "32-56",
          "snippet": "size_t\nstrlcpy(char *dst, const char *src, size_t siz)\n{\n\tchar *d = dst;\n\tconst char *s = src;\n\tsize_t n = siz;\n\n\t/* Copy as many bytes as will fit */\n\tif (n != 0) {\n\t\twhile (--n != 0) {\n\t\t\tif ((*d++ = *s++) == '\\0')\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\t/* Not enough room in dst, add NUL and traverse rest of src */\n\tif (n == 0) {\n\t\tif (siz != 0)\n\t\t\t*d = '\\0';\t\t/* NUL-terminate dst */\n\t\twhile (*s++)\n\t\t\t;\n\t}\n\n\treturn(s - src - 1);\t/* count does not include NUL */\n}",
          "includes": [
            "#include <string.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nsize_t\nstrlcpy(char *dst, const char *src, size_t siz)\n{\n\tchar *d = dst;\n\tconst char *s = src;\n\tsize_t n = siz;\n\n\t/* Copy as many bytes as will fit */\n\tif (n != 0) {\n\t\twhile (--n != 0) {\n\t\t\tif ((*d++ = *s++) == '\\0')\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\t/* Not enough room in dst, add NUL and traverse rest of src */\n\tif (n == 0) {\n\t\tif (siz != 0)\n\t\t\t*d = '\\0';\t\t/* NUL-terminate dst */\n\t\twhile (*s++)\n\t\t\t;\n\t}\n\n\treturn(s - src - 1);\t/* count does not include NUL */\n}"
        }
      },
      {
        "call_info": {
          "callee": "MIN_SIZEOF",
          "args": [
            "li->hostname",
            "utx->ut_host"
          ],
          "line": 1639
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "line_fullname",
          "args": [
            "li->line",
            "utx->ut_line",
            "MIN_SIZEOF(li->line, utx->ut_line)"
          ],
          "line": 1636
        },
        "resolved": true,
        "details": {
          "function_name": "line_fullname",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
          "lines": "563-574",
          "snippet": "char *\nline_fullname(char *dst, const char *src, u_int dstsize)\n{\n\tmemset(dst, '\\0', dstsize);\n\tif ((strncmp(src, \"/dev/\", 5) == 0) || (dstsize < (strlen(src) + 5)))\n\t\tstrlcpy(dst, src, dstsize);\n\telse {\n\t\tstrlcpy(dst, \"/dev/\", dstsize);\n\t\tstrlcat(dst, src, dstsize);\n\t}\n\treturn (dst);\n}",
          "includes": [
            "# include <util.h>",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"auth.h\"",
            "#include \"canohost.h\"",
            "#include \"packet.h\"",
            "#include \"atomicio.h\"",
            "#include \"log.h\"",
            "#include \"loginrec.h\"",
            "#include \"ssh.h\"",
            "#include \"hostfile.h\"",
            "#include \"sshkey.h\"",
            "#include \"xmalloc.h\"",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <string.h>",
            "#include <stdarg.h>",
            "#include <pwd.h>",
            "# include <paths.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <util.h>\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"auth.h\"\n#include \"canohost.h\"\n#include \"packet.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"loginrec.h\"\n#include \"ssh.h\"\n#include \"hostfile.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdarg.h>\n#include <pwd.h>\n# include <paths.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nchar *\nline_fullname(char *dst, const char *src, u_int dstsize)\n{\n\tmemset(dst, '\\0', dstsize);\n\tif ((strncmp(src, \"/dev/\", 5) == 0) || (dstsize < (strlen(src) + 5)))\n\t\tstrlcpy(dst, src, dstsize);\n\telse {\n\t\tstrlcpy(dst, \"/dev/\", dstsize);\n\t\tstrlcat(dst, src, dstsize);\n\t}\n\treturn (dst);\n}"
        }
      },
      {
        "call_info": {
          "callee": "MIN_SIZEOF",
          "args": [
            "li->line",
            "utx->ut_line"
          ],
          "line": 1637
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "endutxent",
          "args": [],
          "line": 1632
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "getutxuser",
          "args": [
            "li->username"
          ],
          "line": 1630
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "setutxdb",
          "args": [
            "UTXDB_LASTLOGIN",
            "NULL"
          ],
          "line": 1628
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "# include <util.h>\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"auth.h\"\n#include \"canohost.h\"\n#include \"packet.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"loginrec.h\"\n#include \"ssh.h\"\n#include \"hostfile.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdarg.h>\n#include <pwd.h>\n# include <paths.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint utmp_write_entry(struct logininfo *li);\nint utmpx_write_entry(struct logininfo *li);\nint wtmp_write_entry(struct logininfo *li);\nint wtmpx_write_entry(struct logininfo *li);\nint lastlog_write_entry(struct logininfo *li);\nint syslogin_write_entry(struct logininfo *li);\nint getlast_entry(struct logininfo *li);\nint lastlog_get_entry(struct logininfo *li);\nint utmpx_get_entry(struct logininfo *li);\nint wtmp_get_entry(struct logininfo *li);\nint wtmpx_get_entry(struct logininfo *li);\n\nint\nutmpx_get_entry(struct logininfo *li)\n{\n\tstruct utmpx *utx;\n\n\tif (setutxdb(UTXDB_LASTLOGIN, NULL) != 0)\n\t\treturn (0);\n\tutx = getutxuser(li->username);\n\tif (utx == NULL) {\n\t\tendutxent();\n\t\treturn (0);\n\t}\n\n\tline_fullname(li->line, utx->ut_line,\n\t    MIN_SIZEOF(li->line, utx->ut_line));\n\tstrlcpy(li->hostname, utx->ut_host,\n\t    MIN_SIZEOF(li->hostname, utx->ut_host));\n\tli->tv_sec = utx->ut_tv.tv_sec;\n\tli->tv_usec = utx->ut_tv.tv_usec;\n\tendutxent();\n\treturn (1);\n}"
  },
  {
    "function_name": "lastlog_get_entry",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
    "lines": "1583-1617",
    "snippet": "int\nlastlog_get_entry(struct logininfo *li)\n{\n\tstruct lastlog last;\n\tint fd, ret;\n\n\tif (!lastlog_openseek(li, &fd, O_RDONLY))\n\t\treturn (0);\n\n\tret = atomicio(read, fd, &last, sizeof(last));\n\tclose(fd);\n\n\tswitch (ret) {\n\tcase 0:\n\t\tmemset(&last, '\\0', sizeof(last));\n\t\t/* FALLTHRU */\n\tcase sizeof(last):\n\t\tline_fullname(li->line, last.ll_line, sizeof(li->line));\n\t\tstrlcpy(li->hostname, last.ll_host,\n\t\t    MIN_SIZEOF(li->hostname, last.ll_host));\n\t\tli->tv_sec = last.ll_time;\n\t\treturn (1);\n\tcase -1:\n\t\terror(\"%s: Error reading from %s: %s\", __func__,\n\t\t    LASTLOG_FILE, strerror(errno));\n\t\treturn (0);\n\tdefault:\n\t\terror(\"%s: Error reading from %s: Expecting %d, got %d\",\n\t\t    __func__, LASTLOG_FILE, (int)sizeof(last), ret);\n\t\treturn (0);\n\t}\n\n\t/* NOTREACHED */\n\treturn (0);\n}",
    "includes": [
      "# include <util.h>",
      "#include \"ssherr.h\"",
      "#include \"sshbuf.h\"",
      "#include \"auth.h\"",
      "#include \"canohost.h\"",
      "#include \"packet.h\"",
      "#include \"atomicio.h\"",
      "#include \"log.h\"",
      "#include \"loginrec.h\"",
      "#include \"ssh.h\"",
      "#include \"hostfile.h\"",
      "#include \"sshkey.h\"",
      "#include \"xmalloc.h\"",
      "#include <unistd.h>",
      "#include <time.h>",
      "#include <string.h>",
      "#include <stdarg.h>",
      "#include <pwd.h>",
      "# include <paths.h>",
      "#include <fcntl.h>",
      "#include <errno.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "int utmp_write_entry(struct logininfo *li);",
      "int utmpx_write_entry(struct logininfo *li);",
      "int wtmp_write_entry(struct logininfo *li);",
      "int wtmpx_write_entry(struct logininfo *li);",
      "int lastlog_write_entry(struct logininfo *li);",
      "int syslogin_write_entry(struct logininfo *li);",
      "int getlast_entry(struct logininfo *li);",
      "int lastlog_get_entry(struct logininfo *li);",
      "int utmpx_get_entry(struct logininfo *li);",
      "int wtmp_get_entry(struct logininfo *li);",
      "int wtmpx_get_entry(struct logininfo *li);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"%s: Error reading from %s: Expecting %d, got %d\"",
            "__func__",
            "LASTLOG_FILE",
            "(int)sizeof(last)",
            "ret"
          ],
          "line": 1610
        },
        "resolved": true,
        "details": {
          "function_name": "error",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/log.c",
          "lines": "162-170",
          "snippet": "void\nerror(const char *fmt,...)\n{\n\tva_list args;\n\n\tva_start(args, fmt);\n\tdo_log(SYSLOG_LEVEL_ERROR, fmt, args);\n\tva_end(args);\n}",
          "includes": [
            "#include \"log.h\"",
            "# include <vis.h>",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <syslog.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <fcntl.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n# include <vis.h>\n#include <errno.h>\n#include <unistd.h>\n#include <syslog.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <fcntl.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\nerror(const char *fmt,...)\n{\n\tva_list args;\n\n\tva_start(args, fmt);\n\tdo_log(SYSLOG_LEVEL_ERROR, fmt, args);\n\tva_end(args);\n}"
        }
      },
      {
        "call_info": {
          "callee": "strerror",
          "args": [
            "errno"
          ],
          "line": 1607
        },
        "resolved": true,
        "details": {
          "function_name": "ssh_gai_strerror",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/misc.c",
          "lines": "140-146",
          "snippet": "const char *\nssh_gai_strerror(int gaierr)\n{\n\tif (gaierr == EAI_SYSTEM && errno != 0)\n\t\treturn strerror(errno);\n\treturn gai_strerror(gaierr);\n}",
          "includes": [
            "#include \"platform.h\"",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"ssh.h\"",
            "#include \"log.h\"",
            "#include \"misc.h\"",
            "#include \"xmalloc.h\"",
            "#include <net/if.h>",
            "#include <pwd.h>",
            "# include <paths.h>",
            "#include <netdb.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <ctype.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/tcp.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in_systm.h>",
            "#include <netinet/in.h>",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <libgen.h>",
            "#include <limits.h>",
            "#include <sys/un.h>",
            "#include <sys/wait.h>",
            "#include <sys/time.h>",
            "#include <sys/stat.h>",
            "#include <sys/socket.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"platform.h\"\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"ssh.h\"\n#include \"log.h\"\n#include \"misc.h\"\n#include \"xmalloc.h\"\n#include <net/if.h>\n#include <pwd.h>\n# include <paths.h>\n#include <netdb.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <ctype.h>\n#include <arpa/inet.h>\n#include <netinet/tcp.h>\n#include <netinet/ip.h>\n#include <netinet/in_systm.h>\n#include <netinet/in.h>\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <libgen.h>\n#include <limits.h>\n#include <sys/un.h>\n#include <sys/wait.h>\n#include <sys/time.h>\n#include <sys/stat.h>\n#include <sys/socket.h>\n#include <sys/ioctl.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nconst char *\nssh_gai_strerror(int gaierr)\n{\n\tif (gaierr == EAI_SYSTEM && errno != 0)\n\t\treturn strerror(errno);\n\treturn gai_strerror(gaierr);\n}"
        }
      },
      {
        "call_info": {
          "callee": "strlcpy",
          "args": [
            "li->hostname",
            "last.ll_host",
            "MIN_SIZEOF(li->hostname, last.ll_host)"
          ],
          "line": 1601
        },
        "resolved": true,
        "details": {
          "function_name": "strlcpy",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/openbsd-compat/strlcpy.c",
          "lines": "32-56",
          "snippet": "size_t\nstrlcpy(char *dst, const char *src, size_t siz)\n{\n\tchar *d = dst;\n\tconst char *s = src;\n\tsize_t n = siz;\n\n\t/* Copy as many bytes as will fit */\n\tif (n != 0) {\n\t\twhile (--n != 0) {\n\t\t\tif ((*d++ = *s++) == '\\0')\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\t/* Not enough room in dst, add NUL and traverse rest of src */\n\tif (n == 0) {\n\t\tif (siz != 0)\n\t\t\t*d = '\\0';\t\t/* NUL-terminate dst */\n\t\twhile (*s++)\n\t\t\t;\n\t}\n\n\treturn(s - src - 1);\t/* count does not include NUL */\n}",
          "includes": [
            "#include <string.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nsize_t\nstrlcpy(char *dst, const char *src, size_t siz)\n{\n\tchar *d = dst;\n\tconst char *s = src;\n\tsize_t n = siz;\n\n\t/* Copy as many bytes as will fit */\n\tif (n != 0) {\n\t\twhile (--n != 0) {\n\t\t\tif ((*d++ = *s++) == '\\0')\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\t/* Not enough room in dst, add NUL and traverse rest of src */\n\tif (n == 0) {\n\t\tif (siz != 0)\n\t\t\t*d = '\\0';\t\t/* NUL-terminate dst */\n\t\twhile (*s++)\n\t\t\t;\n\t}\n\n\treturn(s - src - 1);\t/* count does not include NUL */\n}"
        }
      },
      {
        "call_info": {
          "callee": "MIN_SIZEOF",
          "args": [
            "li->hostname",
            "last.ll_host"
          ],
          "line": 1602
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "line_fullname",
          "args": [
            "li->line",
            "last.ll_line",
            "sizeof(li->line)"
          ],
          "line": 1600
        },
        "resolved": true,
        "details": {
          "function_name": "line_fullname",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
          "lines": "563-574",
          "snippet": "char *\nline_fullname(char *dst, const char *src, u_int dstsize)\n{\n\tmemset(dst, '\\0', dstsize);\n\tif ((strncmp(src, \"/dev/\", 5) == 0) || (dstsize < (strlen(src) + 5)))\n\t\tstrlcpy(dst, src, dstsize);\n\telse {\n\t\tstrlcpy(dst, \"/dev/\", dstsize);\n\t\tstrlcat(dst, src, dstsize);\n\t}\n\treturn (dst);\n}",
          "includes": [
            "# include <util.h>",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"auth.h\"",
            "#include \"canohost.h\"",
            "#include \"packet.h\"",
            "#include \"atomicio.h\"",
            "#include \"log.h\"",
            "#include \"loginrec.h\"",
            "#include \"ssh.h\"",
            "#include \"hostfile.h\"",
            "#include \"sshkey.h\"",
            "#include \"xmalloc.h\"",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <string.h>",
            "#include <stdarg.h>",
            "#include <pwd.h>",
            "# include <paths.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <util.h>\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"auth.h\"\n#include \"canohost.h\"\n#include \"packet.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"loginrec.h\"\n#include \"ssh.h\"\n#include \"hostfile.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdarg.h>\n#include <pwd.h>\n# include <paths.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nchar *\nline_fullname(char *dst, const char *src, u_int dstsize)\n{\n\tmemset(dst, '\\0', dstsize);\n\tif ((strncmp(src, \"/dev/\", 5) == 0) || (dstsize < (strlen(src) + 5)))\n\t\tstrlcpy(dst, src, dstsize);\n\telse {\n\t\tstrlcpy(dst, \"/dev/\", dstsize);\n\t\tstrlcat(dst, src, dstsize);\n\t}\n\treturn (dst);\n}"
        }
      },
      {
        "call_info": {
          "callee": "memset",
          "args": [
            "&last",
            "'\\0'",
            "sizeof(last)"
          ],
          "line": 1597
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "close",
          "args": [
            "fd"
          ],
          "line": 1593
        },
        "resolved": true,
        "details": {
          "function_name": "ssh_close_authentication_socket",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/authfd.c",
          "lines": "171-176",
          "snippet": "void\nssh_close_authentication_socket(int sock)\n{\n\tif (getenv(SSH_AUTHSOCKET_ENV_NAME))\n\t\tclose(sock);\n}",
          "includes": [
            "#include \"ssherr.h\"",
            "#include \"misc.h\"",
            "#include \"atomicio.h\"",
            "#include \"log.h\"",
            "#include \"compat.h\"",
            "#include \"cipher.h\"",
            "#include \"authfd.h\"",
            "#include \"sshkey.h\"",
            "#include \"sshbuf.h\"",
            "#include \"ssh.h\"",
            "#include \"xmalloc.h\"",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "#include <stdlib.h>",
            "#include <fcntl.h>",
            "#include <sys/socket.h>",
            "#include <sys/un.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"ssherr.h\"\n#include \"misc.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"compat.h\"\n#include \"cipher.h\"\n#include \"authfd.h\"\n#include \"sshkey.h\"\n#include \"sshbuf.h\"\n#include \"ssh.h\"\n#include \"xmalloc.h\"\n#include <errno.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdarg.h>\n#include <signal.h>\n#include <stdlib.h>\n#include <fcntl.h>\n#include <sys/socket.h>\n#include <sys/un.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\nssh_close_authentication_socket(int sock)\n{\n\tif (getenv(SSH_AUTHSOCKET_ENV_NAME))\n\t\tclose(sock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "atomicio",
          "args": [
            "read",
            "fd",
            "&last",
            "sizeof(last)"
          ],
          "line": 1592
        },
        "resolved": true,
        "details": {
          "function_name": "atomiciov",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/atomicio.c",
          "lines": "165-170",
          "snippet": "size_t\natomiciov(ssize_t (*f) (int, const struct iovec *, int), int fd,\n    const struct iovec *_iov, int iovcnt)\n{\n\treturn atomiciov6(f, fd, _iov, iovcnt, NULL, NULL);\n}",
          "includes": [
            "#include \"atomicio.h\"",
            "#include <limits.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#  include <sys/poll.h>",
            "#include <poll.h>",
            "#include <errno.h>",
            "#include <sys/uio.h>",
            "#include <sys/param.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"atomicio.h\"\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#  include <sys/poll.h>\n#include <poll.h>\n#include <errno.h>\n#include <sys/uio.h>\n#include <sys/param.h>\n#include \"includes.h\"\n\nsize_t\natomiciov(ssize_t (*f) (int, const struct iovec *, int), int fd,\n    const struct iovec *_iov, int iovcnt)\n{\n\treturn atomiciov6(f, fd, _iov, iovcnt, NULL, NULL);\n}"
        }
      },
      {
        "call_info": {
          "callee": "lastlog_openseek",
          "args": [
            "li",
            "&fd",
            "O_RDONLY"
          ],
          "line": 1589
        },
        "resolved": true,
        "details": {
          "function_name": "lastlog_openseek",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
          "lines": "1471-1514",
          "snippet": "static int\nlastlog_openseek(struct logininfo *li, int *fd, int filemode)\n{\n\toff_t offset;\n\tchar lastlog_file[1024];\n\tstruct stat st;\n\n\tif (stat(LASTLOG_FILE, &st) != 0) {\n\t\tlogit(\"%s: Couldn't stat %s: %s\", __func__,\n\t\t    LASTLOG_FILE, strerror(errno));\n\t\treturn (0);\n\t}\n\tif (S_ISDIR(st.st_mode)) {\n\t\tsnprintf(lastlog_file, sizeof(lastlog_file), \"%s/%s\",\n\t\t    LASTLOG_FILE, li->username);\n\t} else if (S_ISREG(st.st_mode)) {\n\t\tstrlcpy(lastlog_file, LASTLOG_FILE, sizeof(lastlog_file));\n\t} else {\n\t\tlogit(\"%s: %.100s is not a file or directory!\", __func__,\n\t\t    LASTLOG_FILE);\n\t\treturn (0);\n\t}\n\n\t*fd = open(lastlog_file, filemode, 0600);\n\tif (*fd < 0) {\n\t\tdebug(\"%s: Couldn't open %s: %s\", __func__,\n\t\t    lastlog_file, strerror(errno));\n\t\treturn (0);\n\t}\n\n\tif (S_ISREG(st.st_mode)) {\n\t\t/* find this uid's offset in the lastlog file */\n\t\toffset = (off_t) ((u_long)li->uid * sizeof(struct lastlog));\n\n\t\tif (lseek(*fd, offset, SEEK_SET) != offset) {\n\t\t\tlogit(\"%s: %s->lseek(): %s\", __func__,\n\t\t\t    lastlog_file, strerror(errno));\n\t\t\tclose(*fd);\n\t\t\treturn (0);\n\t\t}\n\t}\n\n\treturn (1);\n}",
          "includes": [
            "# include <util.h>",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"auth.h\"",
            "#include \"canohost.h\"",
            "#include \"packet.h\"",
            "#include \"atomicio.h\"",
            "#include \"log.h\"",
            "#include \"loginrec.h\"",
            "#include \"ssh.h\"",
            "#include \"hostfile.h\"",
            "#include \"sshkey.h\"",
            "#include \"xmalloc.h\"",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <string.h>",
            "#include <stdarg.h>",
            "#include <pwd.h>",
            "# include <paths.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "int utmp_write_entry(struct logininfo *li);",
            "int utmpx_write_entry(struct logininfo *li);",
            "int wtmp_write_entry(struct logininfo *li);",
            "int wtmpx_write_entry(struct logininfo *li);",
            "int lastlog_write_entry(struct logininfo *li);",
            "int syslogin_write_entry(struct logininfo *li);",
            "int getlast_entry(struct logininfo *li);",
            "int lastlog_get_entry(struct logininfo *li);",
            "int utmpx_get_entry(struct logininfo *li);",
            "int wtmp_get_entry(struct logininfo *li);",
            "int wtmpx_get_entry(struct logininfo *li);"
          ],
          "called_functions": [],
          "contextual_snippet": "# include <util.h>\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"auth.h\"\n#include \"canohost.h\"\n#include \"packet.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"loginrec.h\"\n#include \"ssh.h\"\n#include \"hostfile.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdarg.h>\n#include <pwd.h>\n# include <paths.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint utmp_write_entry(struct logininfo *li);\nint utmpx_write_entry(struct logininfo *li);\nint wtmp_write_entry(struct logininfo *li);\nint wtmpx_write_entry(struct logininfo *li);\nint lastlog_write_entry(struct logininfo *li);\nint syslogin_write_entry(struct logininfo *li);\nint getlast_entry(struct logininfo *li);\nint lastlog_get_entry(struct logininfo *li);\nint utmpx_get_entry(struct logininfo *li);\nint wtmp_get_entry(struct logininfo *li);\nint wtmpx_get_entry(struct logininfo *li);\n\nstatic int\nlastlog_openseek(struct logininfo *li, int *fd, int filemode)\n{\n\toff_t offset;\n\tchar lastlog_file[1024];\n\tstruct stat st;\n\n\tif (stat(LASTLOG_FILE, &st) != 0) {\n\t\tlogit(\"%s: Couldn't stat %s: %s\", __func__,\n\t\t    LASTLOG_FILE, strerror(errno));\n\t\treturn (0);\n\t}\n\tif (S_ISDIR(st.st_mode)) {\n\t\tsnprintf(lastlog_file, sizeof(lastlog_file), \"%s/%s\",\n\t\t    LASTLOG_FILE, li->username);\n\t} else if (S_ISREG(st.st_mode)) {\n\t\tstrlcpy(lastlog_file, LASTLOG_FILE, sizeof(lastlog_file));\n\t} else {\n\t\tlogit(\"%s: %.100s is not a file or directory!\", __func__,\n\t\t    LASTLOG_FILE);\n\t\treturn (0);\n\t}\n\n\t*fd = open(lastlog_file, filemode, 0600);\n\tif (*fd < 0) {\n\t\tdebug(\"%s: Couldn't open %s: %s\", __func__,\n\t\t    lastlog_file, strerror(errno));\n\t\treturn (0);\n\t}\n\n\tif (S_ISREG(st.st_mode)) {\n\t\t/* find this uid's offset in the lastlog file */\n\t\toffset = (off_t) ((u_long)li->uid * sizeof(struct lastlog));\n\n\t\tif (lseek(*fd, offset, SEEK_SET) != offset) {\n\t\t\tlogit(\"%s: %s->lseek(): %s\", __func__,\n\t\t\t    lastlog_file, strerror(errno));\n\t\t\tclose(*fd);\n\t\t\treturn (0);\n\t\t}\n\t}\n\n\treturn (1);\n}"
        }
      }
    ],
    "contextual_snippet": "# include <util.h>\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"auth.h\"\n#include \"canohost.h\"\n#include \"packet.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"loginrec.h\"\n#include \"ssh.h\"\n#include \"hostfile.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdarg.h>\n#include <pwd.h>\n# include <paths.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint utmp_write_entry(struct logininfo *li);\nint utmpx_write_entry(struct logininfo *li);\nint wtmp_write_entry(struct logininfo *li);\nint wtmpx_write_entry(struct logininfo *li);\nint lastlog_write_entry(struct logininfo *li);\nint syslogin_write_entry(struct logininfo *li);\nint getlast_entry(struct logininfo *li);\nint lastlog_get_entry(struct logininfo *li);\nint utmpx_get_entry(struct logininfo *li);\nint wtmp_get_entry(struct logininfo *li);\nint wtmpx_get_entry(struct logininfo *li);\n\nint\nlastlog_get_entry(struct logininfo *li)\n{\n\tstruct lastlog last;\n\tint fd, ret;\n\n\tif (!lastlog_openseek(li, &fd, O_RDONLY))\n\t\treturn (0);\n\n\tret = atomicio(read, fd, &last, sizeof(last));\n\tclose(fd);\n\n\tswitch (ret) {\n\tcase 0:\n\t\tmemset(&last, '\\0', sizeof(last));\n\t\t/* FALLTHRU */\n\tcase sizeof(last):\n\t\tline_fullname(li->line, last.ll_line, sizeof(li->line));\n\t\tstrlcpy(li->hostname, last.ll_host,\n\t\t    MIN_SIZEOF(li->hostname, last.ll_host));\n\t\tli->tv_sec = last.ll_time;\n\t\treturn (1);\n\tcase -1:\n\t\terror(\"%s: Error reading from %s: %s\", __func__,\n\t\t    LASTLOG_FILE, strerror(errno));\n\t\treturn (0);\n\tdefault:\n\t\terror(\"%s: Error reading from %s: Expecting %d, got %d\",\n\t\t    __func__, LASTLOG_FILE, (int)sizeof(last), ret);\n\t\treturn (0);\n\t}\n\n\t/* NOTREACHED */\n\treturn (0);\n}"
  },
  {
    "function_name": "lastlog_get_entry",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
    "lines": "1566-1581",
    "snippet": "int\nlastlog_get_entry(struct logininfo *li)\n{\n\tstruct lastlogx l, *ll;\n\n\tif ((ll = getlastlogxbyname(li->username, &l)) == NULL) {\n\t\tmemset(&l, '\\0', sizeof(l));\n\t\tll = &l;\n\t}\n\tline_fullname(li->line, ll->ll_line, sizeof(li->line));\n\tstrlcpy(li->hostname, ll->ll_host,\n\t\tMIN_SIZEOF(li->hostname, ll->ll_host));\n\tli->tv_sec = ll->ll_tv.tv_sec;\n\tli->tv_usec = ll->ll_tv.tv_usec;\n\treturn (1);\n}",
    "includes": [
      "# include <util.h>",
      "#include \"ssherr.h\"",
      "#include \"sshbuf.h\"",
      "#include \"auth.h\"",
      "#include \"canohost.h\"",
      "#include \"packet.h\"",
      "#include \"atomicio.h\"",
      "#include \"log.h\"",
      "#include \"loginrec.h\"",
      "#include \"ssh.h\"",
      "#include \"hostfile.h\"",
      "#include \"sshkey.h\"",
      "#include \"xmalloc.h\"",
      "#include <unistd.h>",
      "#include <time.h>",
      "#include <string.h>",
      "#include <stdarg.h>",
      "#include <pwd.h>",
      "# include <paths.h>",
      "#include <fcntl.h>",
      "#include <errno.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "int utmp_write_entry(struct logininfo *li);",
      "int utmpx_write_entry(struct logininfo *li);",
      "int wtmp_write_entry(struct logininfo *li);",
      "int wtmpx_write_entry(struct logininfo *li);",
      "int lastlog_write_entry(struct logininfo *li);",
      "int syslogin_write_entry(struct logininfo *li);",
      "int getlast_entry(struct logininfo *li);",
      "int lastlog_get_entry(struct logininfo *li);",
      "int utmpx_get_entry(struct logininfo *li);",
      "int wtmp_get_entry(struct logininfo *li);",
      "int wtmpx_get_entry(struct logininfo *li);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "strlcpy",
          "args": [
            "li->hostname",
            "ll->ll_host",
            "MIN_SIZEOF(li->hostname, ll->ll_host)"
          ],
          "line": 1576
        },
        "resolved": true,
        "details": {
          "function_name": "strlcpy",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/openbsd-compat/strlcpy.c",
          "lines": "32-56",
          "snippet": "size_t\nstrlcpy(char *dst, const char *src, size_t siz)\n{\n\tchar *d = dst;\n\tconst char *s = src;\n\tsize_t n = siz;\n\n\t/* Copy as many bytes as will fit */\n\tif (n != 0) {\n\t\twhile (--n != 0) {\n\t\t\tif ((*d++ = *s++) == '\\0')\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\t/* Not enough room in dst, add NUL and traverse rest of src */\n\tif (n == 0) {\n\t\tif (siz != 0)\n\t\t\t*d = '\\0';\t\t/* NUL-terminate dst */\n\t\twhile (*s++)\n\t\t\t;\n\t}\n\n\treturn(s - src - 1);\t/* count does not include NUL */\n}",
          "includes": [
            "#include <string.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nsize_t\nstrlcpy(char *dst, const char *src, size_t siz)\n{\n\tchar *d = dst;\n\tconst char *s = src;\n\tsize_t n = siz;\n\n\t/* Copy as many bytes as will fit */\n\tif (n != 0) {\n\t\twhile (--n != 0) {\n\t\t\tif ((*d++ = *s++) == '\\0')\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\t/* Not enough room in dst, add NUL and traverse rest of src */\n\tif (n == 0) {\n\t\tif (siz != 0)\n\t\t\t*d = '\\0';\t\t/* NUL-terminate dst */\n\t\twhile (*s++)\n\t\t\t;\n\t}\n\n\treturn(s - src - 1);\t/* count does not include NUL */\n}"
        }
      },
      {
        "call_info": {
          "callee": "MIN_SIZEOF",
          "args": [
            "li->hostname",
            "ll->ll_host"
          ],
          "line": 1577
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "line_fullname",
          "args": [
            "li->line",
            "ll->ll_line",
            "sizeof(li->line)"
          ],
          "line": 1575
        },
        "resolved": true,
        "details": {
          "function_name": "line_fullname",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
          "lines": "563-574",
          "snippet": "char *\nline_fullname(char *dst, const char *src, u_int dstsize)\n{\n\tmemset(dst, '\\0', dstsize);\n\tif ((strncmp(src, \"/dev/\", 5) == 0) || (dstsize < (strlen(src) + 5)))\n\t\tstrlcpy(dst, src, dstsize);\n\telse {\n\t\tstrlcpy(dst, \"/dev/\", dstsize);\n\t\tstrlcat(dst, src, dstsize);\n\t}\n\treturn (dst);\n}",
          "includes": [
            "# include <util.h>",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"auth.h\"",
            "#include \"canohost.h\"",
            "#include \"packet.h\"",
            "#include \"atomicio.h\"",
            "#include \"log.h\"",
            "#include \"loginrec.h\"",
            "#include \"ssh.h\"",
            "#include \"hostfile.h\"",
            "#include \"sshkey.h\"",
            "#include \"xmalloc.h\"",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <string.h>",
            "#include <stdarg.h>",
            "#include <pwd.h>",
            "# include <paths.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <util.h>\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"auth.h\"\n#include \"canohost.h\"\n#include \"packet.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"loginrec.h\"\n#include \"ssh.h\"\n#include \"hostfile.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdarg.h>\n#include <pwd.h>\n# include <paths.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nchar *\nline_fullname(char *dst, const char *src, u_int dstsize)\n{\n\tmemset(dst, '\\0', dstsize);\n\tif ((strncmp(src, \"/dev/\", 5) == 0) || (dstsize < (strlen(src) + 5)))\n\t\tstrlcpy(dst, src, dstsize);\n\telse {\n\t\tstrlcpy(dst, \"/dev/\", dstsize);\n\t\tstrlcat(dst, src, dstsize);\n\t}\n\treturn (dst);\n}"
        }
      },
      {
        "call_info": {
          "callee": "memset",
          "args": [
            "&l",
            "'\\0'",
            "sizeof(l)"
          ],
          "line": 1572
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "getlastlogxbyname",
          "args": [
            "li->username",
            "&l"
          ],
          "line": 1571
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "# include <util.h>\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"auth.h\"\n#include \"canohost.h\"\n#include \"packet.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"loginrec.h\"\n#include \"ssh.h\"\n#include \"hostfile.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdarg.h>\n#include <pwd.h>\n# include <paths.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint utmp_write_entry(struct logininfo *li);\nint utmpx_write_entry(struct logininfo *li);\nint wtmp_write_entry(struct logininfo *li);\nint wtmpx_write_entry(struct logininfo *li);\nint lastlog_write_entry(struct logininfo *li);\nint syslogin_write_entry(struct logininfo *li);\nint getlast_entry(struct logininfo *li);\nint lastlog_get_entry(struct logininfo *li);\nint utmpx_get_entry(struct logininfo *li);\nint wtmp_get_entry(struct logininfo *li);\nint wtmpx_get_entry(struct logininfo *li);\n\nint\nlastlog_get_entry(struct logininfo *li)\n{\n\tstruct lastlogx l, *ll;\n\n\tif ((ll = getlastlogxbyname(li->username, &l)) == NULL) {\n\t\tmemset(&l, '\\0', sizeof(l));\n\t\tll = &l;\n\t}\n\tline_fullname(li->line, ll->ll_line, sizeof(li->line));\n\tstrlcpy(li->hostname, ll->ll_host,\n\t\tMIN_SIZEOF(li->hostname, ll->ll_host));\n\tli->tv_sec = ll->ll_tv.tv_sec;\n\tli->tv_usec = ll->ll_tv.tv_usec;\n\treturn (1);\n}"
  },
  {
    "function_name": "lastlog_write_entry",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
    "lines": "1530-1562",
    "snippet": "int\nlastlog_write_entry(struct logininfo *li)\n{\n\tstruct lastlog last;\n\tint fd;\n\n\tswitch(li->type) {\n\tcase LTYPE_LOGIN:\n\t\t/* create our struct lastlog */\n\t\tmemset(&last, '\\0', sizeof(last));\n\t\tline_stripname(last.ll_line, li->line, sizeof(last.ll_line));\n\t\tstrlcpy(last.ll_host, li->hostname,\n\t\t    MIN_SIZEOF(last.ll_host, li->hostname));\n\t\tlast.ll_time = li->tv_sec;\n\t\n\t\tif (!lastlog_openseek(li, &fd, O_RDWR|O_CREAT))\n\t\t\treturn (0);\n\t\n\t\t/* write the entry */\n\t\tif (atomicio(vwrite, fd, &last, sizeof(last)) != sizeof(last)) {\n\t\t\tclose(fd);\n\t\t\tlogit(\"%s: Error writing to %s: %s\", __func__,\n\t\t\t    LASTLOG_FILE, strerror(errno));\n\t\t\treturn (0);\n\t\t}\n\t\n\t\tclose(fd);\n\t\treturn (1);\n\tdefault:\n\t\tlogit(\"%s: Invalid type field\", __func__);\n\t\treturn (0);\n\t}\n}",
    "includes": [
      "# include <util.h>",
      "#include \"ssherr.h\"",
      "#include \"sshbuf.h\"",
      "#include \"auth.h\"",
      "#include \"canohost.h\"",
      "#include \"packet.h\"",
      "#include \"atomicio.h\"",
      "#include \"log.h\"",
      "#include \"loginrec.h\"",
      "#include \"ssh.h\"",
      "#include \"hostfile.h\"",
      "#include \"sshkey.h\"",
      "#include \"xmalloc.h\"",
      "#include <unistd.h>",
      "#include <time.h>",
      "#include <string.h>",
      "#include <stdarg.h>",
      "#include <pwd.h>",
      "# include <paths.h>",
      "#include <fcntl.h>",
      "#include <errno.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "int utmp_write_entry(struct logininfo *li);",
      "int utmpx_write_entry(struct logininfo *li);",
      "int wtmp_write_entry(struct logininfo *li);",
      "int wtmpx_write_entry(struct logininfo *li);",
      "int lastlog_write_entry(struct logininfo *li);",
      "int syslogin_write_entry(struct logininfo *li);",
      "int getlast_entry(struct logininfo *li);",
      "int lastlog_get_entry(struct logininfo *li);",
      "int utmpx_get_entry(struct logininfo *li);",
      "int wtmp_get_entry(struct logininfo *li);",
      "int wtmpx_get_entry(struct logininfo *li);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "logit",
          "args": [
            "\"%s: Invalid type field\"",
            "__func__"
          ],
          "line": 1559
        },
        "resolved": true,
        "details": {
          "function_name": "logit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/log.c",
          "lines": "198-206",
          "snippet": "void\nlogit(const char *fmt,...)\n{\n\tva_list args;\n\n\tva_start(args, fmt);\n\tdo_log(SYSLOG_LEVEL_INFO, fmt, args);\n\tva_end(args);\n}",
          "includes": [
            "#include \"log.h\"",
            "# include <vis.h>",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <syslog.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <fcntl.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n# include <vis.h>\n#include <errno.h>\n#include <unistd.h>\n#include <syslog.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <fcntl.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\nlogit(const char *fmt,...)\n{\n\tva_list args;\n\n\tva_start(args, fmt);\n\tdo_log(SYSLOG_LEVEL_INFO, fmt, args);\n\tva_end(args);\n}"
        }
      },
      {
        "call_info": {
          "callee": "close",
          "args": [
            "fd"
          ],
          "line": 1556
        },
        "resolved": true,
        "details": {
          "function_name": "ssh_close_authentication_socket",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/authfd.c",
          "lines": "171-176",
          "snippet": "void\nssh_close_authentication_socket(int sock)\n{\n\tif (getenv(SSH_AUTHSOCKET_ENV_NAME))\n\t\tclose(sock);\n}",
          "includes": [
            "#include \"ssherr.h\"",
            "#include \"misc.h\"",
            "#include \"atomicio.h\"",
            "#include \"log.h\"",
            "#include \"compat.h\"",
            "#include \"cipher.h\"",
            "#include \"authfd.h\"",
            "#include \"sshkey.h\"",
            "#include \"sshbuf.h\"",
            "#include \"ssh.h\"",
            "#include \"xmalloc.h\"",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "#include <stdlib.h>",
            "#include <fcntl.h>",
            "#include <sys/socket.h>",
            "#include <sys/un.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"ssherr.h\"\n#include \"misc.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"compat.h\"\n#include \"cipher.h\"\n#include \"authfd.h\"\n#include \"sshkey.h\"\n#include \"sshbuf.h\"\n#include \"ssh.h\"\n#include \"xmalloc.h\"\n#include <errno.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdarg.h>\n#include <signal.h>\n#include <stdlib.h>\n#include <fcntl.h>\n#include <sys/socket.h>\n#include <sys/un.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\nssh_close_authentication_socket(int sock)\n{\n\tif (getenv(SSH_AUTHSOCKET_ENV_NAME))\n\t\tclose(sock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "strerror",
          "args": [
            "errno"
          ],
          "line": 1552
        },
        "resolved": true,
        "details": {
          "function_name": "ssh_gai_strerror",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/misc.c",
          "lines": "140-146",
          "snippet": "const char *\nssh_gai_strerror(int gaierr)\n{\n\tif (gaierr == EAI_SYSTEM && errno != 0)\n\t\treturn strerror(errno);\n\treturn gai_strerror(gaierr);\n}",
          "includes": [
            "#include \"platform.h\"",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"ssh.h\"",
            "#include \"log.h\"",
            "#include \"misc.h\"",
            "#include \"xmalloc.h\"",
            "#include <net/if.h>",
            "#include <pwd.h>",
            "# include <paths.h>",
            "#include <netdb.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <ctype.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/tcp.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in_systm.h>",
            "#include <netinet/in.h>",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <libgen.h>",
            "#include <limits.h>",
            "#include <sys/un.h>",
            "#include <sys/wait.h>",
            "#include <sys/time.h>",
            "#include <sys/stat.h>",
            "#include <sys/socket.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"platform.h\"\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"ssh.h\"\n#include \"log.h\"\n#include \"misc.h\"\n#include \"xmalloc.h\"\n#include <net/if.h>\n#include <pwd.h>\n# include <paths.h>\n#include <netdb.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <ctype.h>\n#include <arpa/inet.h>\n#include <netinet/tcp.h>\n#include <netinet/ip.h>\n#include <netinet/in_systm.h>\n#include <netinet/in.h>\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <libgen.h>\n#include <limits.h>\n#include <sys/un.h>\n#include <sys/wait.h>\n#include <sys/time.h>\n#include <sys/stat.h>\n#include <sys/socket.h>\n#include <sys/ioctl.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nconst char *\nssh_gai_strerror(int gaierr)\n{\n\tif (gaierr == EAI_SYSTEM && errno != 0)\n\t\treturn strerror(errno);\n\treturn gai_strerror(gaierr);\n}"
        }
      },
      {
        "call_info": {
          "callee": "atomicio",
          "args": [
            "vwrite",
            "fd",
            "&last",
            "sizeof(last)"
          ],
          "line": 1549
        },
        "resolved": true,
        "details": {
          "function_name": "atomiciov",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/atomicio.c",
          "lines": "165-170",
          "snippet": "size_t\natomiciov(ssize_t (*f) (int, const struct iovec *, int), int fd,\n    const struct iovec *_iov, int iovcnt)\n{\n\treturn atomiciov6(f, fd, _iov, iovcnt, NULL, NULL);\n}",
          "includes": [
            "#include \"atomicio.h\"",
            "#include <limits.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#  include <sys/poll.h>",
            "#include <poll.h>",
            "#include <errno.h>",
            "#include <sys/uio.h>",
            "#include <sys/param.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"atomicio.h\"\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#  include <sys/poll.h>\n#include <poll.h>\n#include <errno.h>\n#include <sys/uio.h>\n#include <sys/param.h>\n#include \"includes.h\"\n\nsize_t\natomiciov(ssize_t (*f) (int, const struct iovec *, int), int fd,\n    const struct iovec *_iov, int iovcnt)\n{\n\treturn atomiciov6(f, fd, _iov, iovcnt, NULL, NULL);\n}"
        }
      },
      {
        "call_info": {
          "callee": "lastlog_openseek",
          "args": [
            "li",
            "&fd",
            "O_RDWR|O_CREAT"
          ],
          "line": 1545
        },
        "resolved": true,
        "details": {
          "function_name": "lastlog_openseek",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
          "lines": "1471-1514",
          "snippet": "static int\nlastlog_openseek(struct logininfo *li, int *fd, int filemode)\n{\n\toff_t offset;\n\tchar lastlog_file[1024];\n\tstruct stat st;\n\n\tif (stat(LASTLOG_FILE, &st) != 0) {\n\t\tlogit(\"%s: Couldn't stat %s: %s\", __func__,\n\t\t    LASTLOG_FILE, strerror(errno));\n\t\treturn (0);\n\t}\n\tif (S_ISDIR(st.st_mode)) {\n\t\tsnprintf(lastlog_file, sizeof(lastlog_file), \"%s/%s\",\n\t\t    LASTLOG_FILE, li->username);\n\t} else if (S_ISREG(st.st_mode)) {\n\t\tstrlcpy(lastlog_file, LASTLOG_FILE, sizeof(lastlog_file));\n\t} else {\n\t\tlogit(\"%s: %.100s is not a file or directory!\", __func__,\n\t\t    LASTLOG_FILE);\n\t\treturn (0);\n\t}\n\n\t*fd = open(lastlog_file, filemode, 0600);\n\tif (*fd < 0) {\n\t\tdebug(\"%s: Couldn't open %s: %s\", __func__,\n\t\t    lastlog_file, strerror(errno));\n\t\treturn (0);\n\t}\n\n\tif (S_ISREG(st.st_mode)) {\n\t\t/* find this uid's offset in the lastlog file */\n\t\toffset = (off_t) ((u_long)li->uid * sizeof(struct lastlog));\n\n\t\tif (lseek(*fd, offset, SEEK_SET) != offset) {\n\t\t\tlogit(\"%s: %s->lseek(): %s\", __func__,\n\t\t\t    lastlog_file, strerror(errno));\n\t\t\tclose(*fd);\n\t\t\treturn (0);\n\t\t}\n\t}\n\n\treturn (1);\n}",
          "includes": [
            "# include <util.h>",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"auth.h\"",
            "#include \"canohost.h\"",
            "#include \"packet.h\"",
            "#include \"atomicio.h\"",
            "#include \"log.h\"",
            "#include \"loginrec.h\"",
            "#include \"ssh.h\"",
            "#include \"hostfile.h\"",
            "#include \"sshkey.h\"",
            "#include \"xmalloc.h\"",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <string.h>",
            "#include <stdarg.h>",
            "#include <pwd.h>",
            "# include <paths.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "int utmp_write_entry(struct logininfo *li);",
            "int utmpx_write_entry(struct logininfo *li);",
            "int wtmp_write_entry(struct logininfo *li);",
            "int wtmpx_write_entry(struct logininfo *li);",
            "int lastlog_write_entry(struct logininfo *li);",
            "int syslogin_write_entry(struct logininfo *li);",
            "int getlast_entry(struct logininfo *li);",
            "int lastlog_get_entry(struct logininfo *li);",
            "int utmpx_get_entry(struct logininfo *li);",
            "int wtmp_get_entry(struct logininfo *li);",
            "int wtmpx_get_entry(struct logininfo *li);"
          ],
          "called_functions": [],
          "contextual_snippet": "# include <util.h>\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"auth.h\"\n#include \"canohost.h\"\n#include \"packet.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"loginrec.h\"\n#include \"ssh.h\"\n#include \"hostfile.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdarg.h>\n#include <pwd.h>\n# include <paths.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint utmp_write_entry(struct logininfo *li);\nint utmpx_write_entry(struct logininfo *li);\nint wtmp_write_entry(struct logininfo *li);\nint wtmpx_write_entry(struct logininfo *li);\nint lastlog_write_entry(struct logininfo *li);\nint syslogin_write_entry(struct logininfo *li);\nint getlast_entry(struct logininfo *li);\nint lastlog_get_entry(struct logininfo *li);\nint utmpx_get_entry(struct logininfo *li);\nint wtmp_get_entry(struct logininfo *li);\nint wtmpx_get_entry(struct logininfo *li);\n\nstatic int\nlastlog_openseek(struct logininfo *li, int *fd, int filemode)\n{\n\toff_t offset;\n\tchar lastlog_file[1024];\n\tstruct stat st;\n\n\tif (stat(LASTLOG_FILE, &st) != 0) {\n\t\tlogit(\"%s: Couldn't stat %s: %s\", __func__,\n\t\t    LASTLOG_FILE, strerror(errno));\n\t\treturn (0);\n\t}\n\tif (S_ISDIR(st.st_mode)) {\n\t\tsnprintf(lastlog_file, sizeof(lastlog_file), \"%s/%s\",\n\t\t    LASTLOG_FILE, li->username);\n\t} else if (S_ISREG(st.st_mode)) {\n\t\tstrlcpy(lastlog_file, LASTLOG_FILE, sizeof(lastlog_file));\n\t} else {\n\t\tlogit(\"%s: %.100s is not a file or directory!\", __func__,\n\t\t    LASTLOG_FILE);\n\t\treturn (0);\n\t}\n\n\t*fd = open(lastlog_file, filemode, 0600);\n\tif (*fd < 0) {\n\t\tdebug(\"%s: Couldn't open %s: %s\", __func__,\n\t\t    lastlog_file, strerror(errno));\n\t\treturn (0);\n\t}\n\n\tif (S_ISREG(st.st_mode)) {\n\t\t/* find this uid's offset in the lastlog file */\n\t\toffset = (off_t) ((u_long)li->uid * sizeof(struct lastlog));\n\n\t\tif (lseek(*fd, offset, SEEK_SET) != offset) {\n\t\t\tlogit(\"%s: %s->lseek(): %s\", __func__,\n\t\t\t    lastlog_file, strerror(errno));\n\t\t\tclose(*fd);\n\t\t\treturn (0);\n\t\t}\n\t}\n\n\treturn (1);\n}"
        }
      },
      {
        "call_info": {
          "callee": "strlcpy",
          "args": [
            "last.ll_host",
            "li->hostname",
            "MIN_SIZEOF(last.ll_host, li->hostname)"
          ],
          "line": 1541
        },
        "resolved": true,
        "details": {
          "function_name": "strlcpy",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/openbsd-compat/strlcpy.c",
          "lines": "32-56",
          "snippet": "size_t\nstrlcpy(char *dst, const char *src, size_t siz)\n{\n\tchar *d = dst;\n\tconst char *s = src;\n\tsize_t n = siz;\n\n\t/* Copy as many bytes as will fit */\n\tif (n != 0) {\n\t\twhile (--n != 0) {\n\t\t\tif ((*d++ = *s++) == '\\0')\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\t/* Not enough room in dst, add NUL and traverse rest of src */\n\tif (n == 0) {\n\t\tif (siz != 0)\n\t\t\t*d = '\\0';\t\t/* NUL-terminate dst */\n\t\twhile (*s++)\n\t\t\t;\n\t}\n\n\treturn(s - src - 1);\t/* count does not include NUL */\n}",
          "includes": [
            "#include <string.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nsize_t\nstrlcpy(char *dst, const char *src, size_t siz)\n{\n\tchar *d = dst;\n\tconst char *s = src;\n\tsize_t n = siz;\n\n\t/* Copy as many bytes as will fit */\n\tif (n != 0) {\n\t\twhile (--n != 0) {\n\t\t\tif ((*d++ = *s++) == '\\0')\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\t/* Not enough room in dst, add NUL and traverse rest of src */\n\tif (n == 0) {\n\t\tif (siz != 0)\n\t\t\t*d = '\\0';\t\t/* NUL-terminate dst */\n\t\twhile (*s++)\n\t\t\t;\n\t}\n\n\treturn(s - src - 1);\t/* count does not include NUL */\n}"
        }
      },
      {
        "call_info": {
          "callee": "MIN_SIZEOF",
          "args": [
            "last.ll_host",
            "li->hostname"
          ],
          "line": 1542
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "line_stripname",
          "args": [
            "last.ll_line",
            "li->line",
            "sizeof(last.ll_line)"
          ],
          "line": 1540
        },
        "resolved": true,
        "details": {
          "function_name": "line_stripname",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
          "lines": "577-586",
          "snippet": "char *\nline_stripname(char *dst, const char *src, int dstsize)\n{\n\tmemset(dst, '\\0', dstsize);\n\tif (strncmp(src, \"/dev/\", 5) == 0)\n\t\tstrlcpy(dst, src + 5, dstsize);\n\telse\n\t\tstrlcpy(dst, src, dstsize);\n\treturn (dst);\n}",
          "includes": [
            "# include <util.h>",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"auth.h\"",
            "#include \"canohost.h\"",
            "#include \"packet.h\"",
            "#include \"atomicio.h\"",
            "#include \"log.h\"",
            "#include \"loginrec.h\"",
            "#include \"ssh.h\"",
            "#include \"hostfile.h\"",
            "#include \"sshkey.h\"",
            "#include \"xmalloc.h\"",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <string.h>",
            "#include <stdarg.h>",
            "#include <pwd.h>",
            "# include <paths.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <util.h>\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"auth.h\"\n#include \"canohost.h\"\n#include \"packet.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"loginrec.h\"\n#include \"ssh.h\"\n#include \"hostfile.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdarg.h>\n#include <pwd.h>\n# include <paths.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nchar *\nline_stripname(char *dst, const char *src, int dstsize)\n{\n\tmemset(dst, '\\0', dstsize);\n\tif (strncmp(src, \"/dev/\", 5) == 0)\n\t\tstrlcpy(dst, src + 5, dstsize);\n\telse\n\t\tstrlcpy(dst, src, dstsize);\n\treturn (dst);\n}"
        }
      },
      {
        "call_info": {
          "callee": "memset",
          "args": [
            "&last",
            "'\\0'",
            "sizeof(last)"
          ],
          "line": 1539
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "# include <util.h>\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"auth.h\"\n#include \"canohost.h\"\n#include \"packet.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"loginrec.h\"\n#include \"ssh.h\"\n#include \"hostfile.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdarg.h>\n#include <pwd.h>\n# include <paths.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint utmp_write_entry(struct logininfo *li);\nint utmpx_write_entry(struct logininfo *li);\nint wtmp_write_entry(struct logininfo *li);\nint wtmpx_write_entry(struct logininfo *li);\nint lastlog_write_entry(struct logininfo *li);\nint syslogin_write_entry(struct logininfo *li);\nint getlast_entry(struct logininfo *li);\nint lastlog_get_entry(struct logininfo *li);\nint utmpx_get_entry(struct logininfo *li);\nint wtmp_get_entry(struct logininfo *li);\nint wtmpx_get_entry(struct logininfo *li);\n\nint\nlastlog_write_entry(struct logininfo *li)\n{\n\tstruct lastlog last;\n\tint fd;\n\n\tswitch(li->type) {\n\tcase LTYPE_LOGIN:\n\t\t/* create our struct lastlog */\n\t\tmemset(&last, '\\0', sizeof(last));\n\t\tline_stripname(last.ll_line, li->line, sizeof(last.ll_line));\n\t\tstrlcpy(last.ll_host, li->hostname,\n\t\t    MIN_SIZEOF(last.ll_host, li->hostname));\n\t\tlast.ll_time = li->tv_sec;\n\t\n\t\tif (!lastlog_openseek(li, &fd, O_RDWR|O_CREAT))\n\t\t\treturn (0);\n\t\n\t\t/* write the entry */\n\t\tif (atomicio(vwrite, fd, &last, sizeof(last)) != sizeof(last)) {\n\t\t\tclose(fd);\n\t\t\tlogit(\"%s: Error writing to %s: %s\", __func__,\n\t\t\t    LASTLOG_FILE, strerror(errno));\n\t\t\treturn (0);\n\t\t}\n\t\n\t\tclose(fd);\n\t\treturn (1);\n\tdefault:\n\t\tlogit(\"%s: Invalid type field\", __func__);\n\t\treturn (0);\n\t}\n}"
  },
  {
    "function_name": "lastlog_write_entry",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
    "lines": "1518-1528",
    "snippet": "int\nlastlog_write_entry(struct logininfo *li)\n{\n\tswitch(li->type) {\n\tcase LTYPE_LOGIN:\n\t\treturn 1; /* lastlog written by pututxline */\n\tdefault:\n\t\tlogit(\"lastlog_write_entry: Invalid type field\");\n\t\treturn 0;\n\t}\n}",
    "includes": [
      "# include <util.h>",
      "#include \"ssherr.h\"",
      "#include \"sshbuf.h\"",
      "#include \"auth.h\"",
      "#include \"canohost.h\"",
      "#include \"packet.h\"",
      "#include \"atomicio.h\"",
      "#include \"log.h\"",
      "#include \"loginrec.h\"",
      "#include \"ssh.h\"",
      "#include \"hostfile.h\"",
      "#include \"sshkey.h\"",
      "#include \"xmalloc.h\"",
      "#include <unistd.h>",
      "#include <time.h>",
      "#include <string.h>",
      "#include <stdarg.h>",
      "#include <pwd.h>",
      "# include <paths.h>",
      "#include <fcntl.h>",
      "#include <errno.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "int utmp_write_entry(struct logininfo *li);",
      "int utmpx_write_entry(struct logininfo *li);",
      "int wtmp_write_entry(struct logininfo *li);",
      "int wtmpx_write_entry(struct logininfo *li);",
      "int lastlog_write_entry(struct logininfo *li);",
      "int syslogin_write_entry(struct logininfo *li);",
      "int getlast_entry(struct logininfo *li);",
      "int lastlog_get_entry(struct logininfo *li);",
      "int utmpx_get_entry(struct logininfo *li);",
      "int wtmp_get_entry(struct logininfo *li);",
      "int wtmpx_get_entry(struct logininfo *li);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "logit",
          "args": [
            "\"lastlog_write_entry: Invalid type field\""
          ],
          "line": 1525
        },
        "resolved": true,
        "details": {
          "function_name": "logit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/log.c",
          "lines": "198-206",
          "snippet": "void\nlogit(const char *fmt,...)\n{\n\tva_list args;\n\n\tva_start(args, fmt);\n\tdo_log(SYSLOG_LEVEL_INFO, fmt, args);\n\tva_end(args);\n}",
          "includes": [
            "#include \"log.h\"",
            "# include <vis.h>",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <syslog.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <fcntl.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n# include <vis.h>\n#include <errno.h>\n#include <unistd.h>\n#include <syslog.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <fcntl.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\nlogit(const char *fmt,...)\n{\n\tva_list args;\n\n\tva_start(args, fmt);\n\tdo_log(SYSLOG_LEVEL_INFO, fmt, args);\n\tva_end(args);\n}"
        }
      }
    ],
    "contextual_snippet": "# include <util.h>\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"auth.h\"\n#include \"canohost.h\"\n#include \"packet.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"loginrec.h\"\n#include \"ssh.h\"\n#include \"hostfile.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdarg.h>\n#include <pwd.h>\n# include <paths.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint utmp_write_entry(struct logininfo *li);\nint utmpx_write_entry(struct logininfo *li);\nint wtmp_write_entry(struct logininfo *li);\nint wtmpx_write_entry(struct logininfo *li);\nint lastlog_write_entry(struct logininfo *li);\nint syslogin_write_entry(struct logininfo *li);\nint getlast_entry(struct logininfo *li);\nint lastlog_get_entry(struct logininfo *li);\nint utmpx_get_entry(struct logininfo *li);\nint wtmp_get_entry(struct logininfo *li);\nint wtmpx_get_entry(struct logininfo *li);\n\nint\nlastlog_write_entry(struct logininfo *li)\n{\n\tswitch(li->type) {\n\tcase LTYPE_LOGIN:\n\t\treturn 1; /* lastlog written by pututxline */\n\tdefault:\n\t\tlogit(\"lastlog_write_entry: Invalid type field\");\n\t\treturn 0;\n\t}\n}"
  },
  {
    "function_name": "lastlog_openseek",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
    "lines": "1471-1514",
    "snippet": "static int\nlastlog_openseek(struct logininfo *li, int *fd, int filemode)\n{\n\toff_t offset;\n\tchar lastlog_file[1024];\n\tstruct stat st;\n\n\tif (stat(LASTLOG_FILE, &st) != 0) {\n\t\tlogit(\"%s: Couldn't stat %s: %s\", __func__,\n\t\t    LASTLOG_FILE, strerror(errno));\n\t\treturn (0);\n\t}\n\tif (S_ISDIR(st.st_mode)) {\n\t\tsnprintf(lastlog_file, sizeof(lastlog_file), \"%s/%s\",\n\t\t    LASTLOG_FILE, li->username);\n\t} else if (S_ISREG(st.st_mode)) {\n\t\tstrlcpy(lastlog_file, LASTLOG_FILE, sizeof(lastlog_file));\n\t} else {\n\t\tlogit(\"%s: %.100s is not a file or directory!\", __func__,\n\t\t    LASTLOG_FILE);\n\t\treturn (0);\n\t}\n\n\t*fd = open(lastlog_file, filemode, 0600);\n\tif (*fd < 0) {\n\t\tdebug(\"%s: Couldn't open %s: %s\", __func__,\n\t\t    lastlog_file, strerror(errno));\n\t\treturn (0);\n\t}\n\n\tif (S_ISREG(st.st_mode)) {\n\t\t/* find this uid's offset in the lastlog file */\n\t\toffset = (off_t) ((u_long)li->uid * sizeof(struct lastlog));\n\n\t\tif (lseek(*fd, offset, SEEK_SET) != offset) {\n\t\t\tlogit(\"%s: %s->lseek(): %s\", __func__,\n\t\t\t    lastlog_file, strerror(errno));\n\t\t\tclose(*fd);\n\t\t\treturn (0);\n\t\t}\n\t}\n\n\treturn (1);\n}",
    "includes": [
      "# include <util.h>",
      "#include \"ssherr.h\"",
      "#include \"sshbuf.h\"",
      "#include \"auth.h\"",
      "#include \"canohost.h\"",
      "#include \"packet.h\"",
      "#include \"atomicio.h\"",
      "#include \"log.h\"",
      "#include \"loginrec.h\"",
      "#include \"ssh.h\"",
      "#include \"hostfile.h\"",
      "#include \"sshkey.h\"",
      "#include \"xmalloc.h\"",
      "#include <unistd.h>",
      "#include <time.h>",
      "#include <string.h>",
      "#include <stdarg.h>",
      "#include <pwd.h>",
      "# include <paths.h>",
      "#include <fcntl.h>",
      "#include <errno.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "int utmp_write_entry(struct logininfo *li);",
      "int utmpx_write_entry(struct logininfo *li);",
      "int wtmp_write_entry(struct logininfo *li);",
      "int wtmpx_write_entry(struct logininfo *li);",
      "int lastlog_write_entry(struct logininfo *li);",
      "int syslogin_write_entry(struct logininfo *li);",
      "int getlast_entry(struct logininfo *li);",
      "int lastlog_get_entry(struct logininfo *li);",
      "int utmpx_get_entry(struct logininfo *li);",
      "int wtmp_get_entry(struct logininfo *li);",
      "int wtmpx_get_entry(struct logininfo *li);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "close",
          "args": [
            "*fd"
          ],
          "line": 1508
        },
        "resolved": true,
        "details": {
          "function_name": "ssh_close_authentication_socket",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/authfd.c",
          "lines": "171-176",
          "snippet": "void\nssh_close_authentication_socket(int sock)\n{\n\tif (getenv(SSH_AUTHSOCKET_ENV_NAME))\n\t\tclose(sock);\n}",
          "includes": [
            "#include \"ssherr.h\"",
            "#include \"misc.h\"",
            "#include \"atomicio.h\"",
            "#include \"log.h\"",
            "#include \"compat.h\"",
            "#include \"cipher.h\"",
            "#include \"authfd.h\"",
            "#include \"sshkey.h\"",
            "#include \"sshbuf.h\"",
            "#include \"ssh.h\"",
            "#include \"xmalloc.h\"",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "#include <stdlib.h>",
            "#include <fcntl.h>",
            "#include <sys/socket.h>",
            "#include <sys/un.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"ssherr.h\"\n#include \"misc.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"compat.h\"\n#include \"cipher.h\"\n#include \"authfd.h\"\n#include \"sshkey.h\"\n#include \"sshbuf.h\"\n#include \"ssh.h\"\n#include \"xmalloc.h\"\n#include <errno.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdarg.h>\n#include <signal.h>\n#include <stdlib.h>\n#include <fcntl.h>\n#include <sys/socket.h>\n#include <sys/un.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\nssh_close_authentication_socket(int sock)\n{\n\tif (getenv(SSH_AUTHSOCKET_ENV_NAME))\n\t\tclose(sock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "logit",
          "args": [
            "\"%s: %s->lseek(): %s\"",
            "__func__",
            "lastlog_file",
            "strerror(errno)"
          ],
          "line": 1506
        },
        "resolved": true,
        "details": {
          "function_name": "logit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/log.c",
          "lines": "198-206",
          "snippet": "void\nlogit(const char *fmt,...)\n{\n\tva_list args;\n\n\tva_start(args, fmt);\n\tdo_log(SYSLOG_LEVEL_INFO, fmt, args);\n\tva_end(args);\n}",
          "includes": [
            "#include \"log.h\"",
            "# include <vis.h>",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <syslog.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <fcntl.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n# include <vis.h>\n#include <errno.h>\n#include <unistd.h>\n#include <syslog.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <fcntl.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\nlogit(const char *fmt,...)\n{\n\tva_list args;\n\n\tva_start(args, fmt);\n\tdo_log(SYSLOG_LEVEL_INFO, fmt, args);\n\tva_end(args);\n}"
        }
      },
      {
        "call_info": {
          "callee": "strerror",
          "args": [
            "errno"
          ],
          "line": 1507
        },
        "resolved": true,
        "details": {
          "function_name": "ssh_gai_strerror",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/misc.c",
          "lines": "140-146",
          "snippet": "const char *\nssh_gai_strerror(int gaierr)\n{\n\tif (gaierr == EAI_SYSTEM && errno != 0)\n\t\treturn strerror(errno);\n\treturn gai_strerror(gaierr);\n}",
          "includes": [
            "#include \"platform.h\"",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"ssh.h\"",
            "#include \"log.h\"",
            "#include \"misc.h\"",
            "#include \"xmalloc.h\"",
            "#include <net/if.h>",
            "#include <pwd.h>",
            "# include <paths.h>",
            "#include <netdb.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <ctype.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/tcp.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in_systm.h>",
            "#include <netinet/in.h>",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <libgen.h>",
            "#include <limits.h>",
            "#include <sys/un.h>",
            "#include <sys/wait.h>",
            "#include <sys/time.h>",
            "#include <sys/stat.h>",
            "#include <sys/socket.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"platform.h\"\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"ssh.h\"\n#include \"log.h\"\n#include \"misc.h\"\n#include \"xmalloc.h\"\n#include <net/if.h>\n#include <pwd.h>\n# include <paths.h>\n#include <netdb.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <ctype.h>\n#include <arpa/inet.h>\n#include <netinet/tcp.h>\n#include <netinet/ip.h>\n#include <netinet/in_systm.h>\n#include <netinet/in.h>\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <libgen.h>\n#include <limits.h>\n#include <sys/un.h>\n#include <sys/wait.h>\n#include <sys/time.h>\n#include <sys/stat.h>\n#include <sys/socket.h>\n#include <sys/ioctl.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nconst char *\nssh_gai_strerror(int gaierr)\n{\n\tif (gaierr == EAI_SYSTEM && errno != 0)\n\t\treturn strerror(errno);\n\treturn gai_strerror(gaierr);\n}"
        }
      },
      {
        "call_info": {
          "callee": "lseek",
          "args": [
            "*fd",
            "offset",
            "SEEK_SET"
          ],
          "line": 1505
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "",
          "args": [
            "(u_long)li->uid * sizeof(struct lastlog)"
          ],
          "line": 1503
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "S_ISREG",
          "args": [
            "st.st_mode"
          ],
          "line": 1501
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug",
          "args": [
            "\"%s: Couldn't open %s: %s\"",
            "__func__",
            "lastlog_file",
            "strerror(errno)"
          ],
          "line": 1496
        },
        "resolved": true,
        "details": {
          "function_name": "debug3",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/log.c",
          "lines": "242-250",
          "snippet": "void\ndebug3(const char *fmt,...)\n{\n\tva_list args;\n\n\tva_start(args, fmt);\n\tdo_log(SYSLOG_LEVEL_DEBUG3, fmt, args);\n\tva_end(args);\n}",
          "includes": [
            "#include \"log.h\"",
            "# include <vis.h>",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <syslog.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <fcntl.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n# include <vis.h>\n#include <errno.h>\n#include <unistd.h>\n#include <syslog.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <fcntl.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\ndebug3(const char *fmt,...)\n{\n\tva_list args;\n\n\tva_start(args, fmt);\n\tdo_log(SYSLOG_LEVEL_DEBUG3, fmt, args);\n\tva_end(args);\n}"
        }
      },
      {
        "call_info": {
          "callee": "open",
          "args": [
            "lastlog_file",
            "filemode",
            "0600"
          ],
          "line": 1494
        },
        "resolved": true,
        "details": {
          "function_name": "lastlog_openseek",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
          "lines": "1471-1514",
          "snippet": "static int\nlastlog_openseek(struct logininfo *li, int *fd, int filemode)\n{\n\toff_t offset;\n\tchar lastlog_file[1024];\n\tstruct stat st;\n\n\tif (stat(LASTLOG_FILE, &st) != 0) {\n\t\tlogit(\"%s: Couldn't stat %s: %s\", __func__,\n\t\t    LASTLOG_FILE, strerror(errno));\n\t\treturn (0);\n\t}\n\tif (S_ISDIR(st.st_mode)) {\n\t\tsnprintf(lastlog_file, sizeof(lastlog_file), \"%s/%s\",\n\t\t    LASTLOG_FILE, li->username);\n\t} else if (S_ISREG(st.st_mode)) {\n\t\tstrlcpy(lastlog_file, LASTLOG_FILE, sizeof(lastlog_file));\n\t} else {\n\t\tlogit(\"%s: %.100s is not a file or directory!\", __func__,\n\t\t    LASTLOG_FILE);\n\t\treturn (0);\n\t}\n\n\t*fd = open(lastlog_file, filemode, 0600);\n\tif (*fd < 0) {\n\t\tdebug(\"%s: Couldn't open %s: %s\", __func__,\n\t\t    lastlog_file, strerror(errno));\n\t\treturn (0);\n\t}\n\n\tif (S_ISREG(st.st_mode)) {\n\t\t/* find this uid's offset in the lastlog file */\n\t\toffset = (off_t) ((u_long)li->uid * sizeof(struct lastlog));\n\n\t\tif (lseek(*fd, offset, SEEK_SET) != offset) {\n\t\t\tlogit(\"%s: %s->lseek(): %s\", __func__,\n\t\t\t    lastlog_file, strerror(errno));\n\t\t\tclose(*fd);\n\t\t\treturn (0);\n\t\t}\n\t}\n\n\treturn (1);\n}",
          "note": "cyclic_reference_detected"
        }
      },
      {
        "call_info": {
          "callee": "strlcpy",
          "args": [
            "lastlog_file",
            "LASTLOG_FILE",
            "sizeof(lastlog_file)"
          ],
          "line": 1487
        },
        "resolved": true,
        "details": {
          "function_name": "strlcpy",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/openbsd-compat/strlcpy.c",
          "lines": "32-56",
          "snippet": "size_t\nstrlcpy(char *dst, const char *src, size_t siz)\n{\n\tchar *d = dst;\n\tconst char *s = src;\n\tsize_t n = siz;\n\n\t/* Copy as many bytes as will fit */\n\tif (n != 0) {\n\t\twhile (--n != 0) {\n\t\t\tif ((*d++ = *s++) == '\\0')\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\t/* Not enough room in dst, add NUL and traverse rest of src */\n\tif (n == 0) {\n\t\tif (siz != 0)\n\t\t\t*d = '\\0';\t\t/* NUL-terminate dst */\n\t\twhile (*s++)\n\t\t\t;\n\t}\n\n\treturn(s - src - 1);\t/* count does not include NUL */\n}",
          "includes": [
            "#include <string.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nsize_t\nstrlcpy(char *dst, const char *src, size_t siz)\n{\n\tchar *d = dst;\n\tconst char *s = src;\n\tsize_t n = siz;\n\n\t/* Copy as many bytes as will fit */\n\tif (n != 0) {\n\t\twhile (--n != 0) {\n\t\t\tif ((*d++ = *s++) == '\\0')\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\t/* Not enough room in dst, add NUL and traverse rest of src */\n\tif (n == 0) {\n\t\tif (siz != 0)\n\t\t\t*d = '\\0';\t\t/* NUL-terminate dst */\n\t\twhile (*s++)\n\t\t\t;\n\t}\n\n\treturn(s - src - 1);\t/* count does not include NUL */\n}"
        }
      },
      {
        "call_info": {
          "callee": "S_ISREG",
          "args": [
            "st.st_mode"
          ],
          "line": 1486
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "snprintf",
          "args": [
            "lastlog_file",
            "sizeof(lastlog_file)",
            "\"%s/%s\"",
            "LASTLOG_FILE",
            "li->username"
          ],
          "line": 1484
        },
        "resolved": true,
        "details": {
          "function_name": "snprintf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/openbsd-compat/bsd-snprintf.c",
          "lines": "869-879",
          "snippet": "int\nsnprintf(char *str, size_t count, SNPRINTF_CONST char *fmt, ...)\n{\n\tsize_t ret;\n\tva_list ap;\n\n\tva_start(ap, fmt);\n\tret = vsnprintf(str, count, fmt, ap);\n\tva_end(ap);\n\treturn ret;\n}",
          "includes": [
            "#include <errno.h>",
            "#include <limits.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdarg.h>",
            "#include <ctype.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <errno.h>\n#include <limits.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdarg.h>\n#include <ctype.h>\n#include \"includes.h\"\n\nint\nsnprintf(char *str, size_t count, SNPRINTF_CONST char *fmt, ...)\n{\n\tsize_t ret;\n\tva_list ap;\n\n\tva_start(ap, fmt);\n\tret = vsnprintf(str, count, fmt, ap);\n\tva_end(ap);\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "S_ISDIR",
          "args": [
            "st.st_mode"
          ],
          "line": 1483
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "stat",
          "args": [
            "LASTLOG_FILE",
            "&st"
          ],
          "line": 1478
        },
        "resolved": true,
        "details": {
          "function_name": "fmt_multistate_int",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/servconf.c",
          "lines": "2384-2394",
          "snippet": "static const char *\nfmt_multistate_int(int val, const struct multistate *m)\n{\n\tu_int i;\n\n\tfor (i = 0; m[i].key != NULL; i++) {\n\t\tif (m[i].value == val)\n\t\t\treturn m[i].key;\n\t}\n\treturn \"UNKNOWN\";\n}",
          "includes": [
            "#include \"digest.h\"",
            "#include \"myproposal.h\"",
            "#include \"auth.h\"",
            "#include \"hostfile.h\"",
            "#include \"ssherr.h\"",
            "#include \"packet.h\"",
            "#include \"canohost.h\"",
            "#include \"groupaccess.h\"",
            "#include \"channels.h\"",
            "#include \"match.h\"",
            "#include \"mac.h\"",
            "#include \"kex.h\"",
            "#include \"sshkey.h\"",
            "#include \"cipher.h\"",
            "#include \"pathnames.h\"",
            "#include \"compat.h\"",
            "#include \"servconf.h\"",
            "#include \"misc.h\"",
            "#include \"sshbuf.h\"",
            "#include \"log.h\"",
            "#include \"ssh.h\"",
            "#include \"xmalloc.h\"",
            "#include \"openbsd-compat/sys-queue.h\"",
            "#include <util.h>",
            "#include <errno.h>",
            "#include <stdarg.h>",
            "#include <limits.h>",
            "#include <unistd.h>",
            "#include <signal.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <pwd.h>",
            "#include <netdb.h>",
            "#include <ctype.h>",
            "#include <net/route.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in_systm.h>",
            "#include <netinet/in.h>",
            "#include <sys/sysctl.h>",
            "#include <sys/socket.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"digest.h\"\n#include \"myproposal.h\"\n#include \"auth.h\"\n#include \"hostfile.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"canohost.h\"\n#include \"groupaccess.h\"\n#include \"channels.h\"\n#include \"match.h\"\n#include \"mac.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"pathnames.h\"\n#include \"compat.h\"\n#include \"servconf.h\"\n#include \"misc.h\"\n#include \"sshbuf.h\"\n#include \"log.h\"\n#include \"ssh.h\"\n#include \"xmalloc.h\"\n#include \"openbsd-compat/sys-queue.h\"\n#include <util.h>\n#include <errno.h>\n#include <stdarg.h>\n#include <limits.h>\n#include <unistd.h>\n#include <signal.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <netdb.h>\n#include <ctype.h>\n#include <net/route.h>\n#include <netinet/ip.h>\n#include <netinet/in_systm.h>\n#include <netinet/in.h>\n#include <sys/sysctl.h>\n#include <sys/socket.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nstatic const char *\nfmt_multistate_int(int val, const struct multistate *m)\n{\n\tu_int i;\n\n\tfor (i = 0; m[i].key != NULL; i++) {\n\t\tif (m[i].value == val)\n\t\t\treturn m[i].key;\n\t}\n\treturn \"UNKNOWN\";\n}"
        }
      }
    ],
    "contextual_snippet": "# include <util.h>\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"auth.h\"\n#include \"canohost.h\"\n#include \"packet.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"loginrec.h\"\n#include \"ssh.h\"\n#include \"hostfile.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdarg.h>\n#include <pwd.h>\n# include <paths.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint utmp_write_entry(struct logininfo *li);\nint utmpx_write_entry(struct logininfo *li);\nint wtmp_write_entry(struct logininfo *li);\nint wtmpx_write_entry(struct logininfo *li);\nint lastlog_write_entry(struct logininfo *li);\nint syslogin_write_entry(struct logininfo *li);\nint getlast_entry(struct logininfo *li);\nint lastlog_get_entry(struct logininfo *li);\nint utmpx_get_entry(struct logininfo *li);\nint wtmp_get_entry(struct logininfo *li);\nint wtmpx_get_entry(struct logininfo *li);\n\nstatic int\nlastlog_openseek(struct logininfo *li, int *fd, int filemode)\n{\n\toff_t offset;\n\tchar lastlog_file[1024];\n\tstruct stat st;\n\n\tif (stat(LASTLOG_FILE, &st) != 0) {\n\t\tlogit(\"%s: Couldn't stat %s: %s\", __func__,\n\t\t    LASTLOG_FILE, strerror(errno));\n\t\treturn (0);\n\t}\n\tif (S_ISDIR(st.st_mode)) {\n\t\tsnprintf(lastlog_file, sizeof(lastlog_file), \"%s/%s\",\n\t\t    LASTLOG_FILE, li->username);\n\t} else if (S_ISREG(st.st_mode)) {\n\t\tstrlcpy(lastlog_file, LASTLOG_FILE, sizeof(lastlog_file));\n\t} else {\n\t\tlogit(\"%s: %.100s is not a file or directory!\", __func__,\n\t\t    LASTLOG_FILE);\n\t\treturn (0);\n\t}\n\n\t*fd = open(lastlog_file, filemode, 0600);\n\tif (*fd < 0) {\n\t\tdebug(\"%s: Couldn't open %s: %s\", __func__,\n\t\t    lastlog_file, strerror(errno));\n\t\treturn (0);\n\t}\n\n\tif (S_ISREG(st.st_mode)) {\n\t\t/* find this uid's offset in the lastlog file */\n\t\toffset = (off_t) ((u_long)li->uid * sizeof(struct lastlog));\n\n\t\tif (lseek(*fd, offset, SEEK_SET) != offset) {\n\t\t\tlogit(\"%s: %s->lseek(): %s\", __func__,\n\t\t\t    lastlog_file, strerror(errno));\n\t\t\tclose(*fd);\n\t\t\treturn (0);\n\t\t}\n\t}\n\n\treturn (1);\n}"
  },
  {
    "function_name": "syslogin_write_entry",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
    "lines": "1446-1458",
    "snippet": "int\nsyslogin_write_entry(struct logininfo *li)\n{\n\tswitch (li->type) {\n\tcase LTYPE_LOGIN:\n\t\treturn (syslogin_perform_login(li));\n\tcase LTYPE_LOGOUT:\n\t\treturn (syslogin_perform_logout(li));\n\tdefault:\n\t\tlogit(\"%s: Invalid type field\", __func__);\n\t\treturn (0);\n\t}\n}",
    "includes": [
      "# include <util.h>",
      "#include \"ssherr.h\"",
      "#include \"sshbuf.h\"",
      "#include \"auth.h\"",
      "#include \"canohost.h\"",
      "#include \"packet.h\"",
      "#include \"atomicio.h\"",
      "#include \"log.h\"",
      "#include \"loginrec.h\"",
      "#include \"ssh.h\"",
      "#include \"hostfile.h\"",
      "#include \"sshkey.h\"",
      "#include \"xmalloc.h\"",
      "#include <unistd.h>",
      "#include <time.h>",
      "#include <string.h>",
      "#include <stdarg.h>",
      "#include <pwd.h>",
      "# include <paths.h>",
      "#include <fcntl.h>",
      "#include <errno.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "int utmp_write_entry(struct logininfo *li);",
      "int utmpx_write_entry(struct logininfo *li);",
      "int wtmp_write_entry(struct logininfo *li);",
      "int wtmpx_write_entry(struct logininfo *li);",
      "int lastlog_write_entry(struct logininfo *li);",
      "int syslogin_write_entry(struct logininfo *li);",
      "int getlast_entry(struct logininfo *li);",
      "int lastlog_get_entry(struct logininfo *li);",
      "int utmpx_get_entry(struct logininfo *li);",
      "int wtmp_get_entry(struct logininfo *li);",
      "int wtmpx_get_entry(struct logininfo *li);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "logit",
          "args": [
            "\"%s: Invalid type field\"",
            "__func__"
          ],
          "line": 1455
        },
        "resolved": true,
        "details": {
          "function_name": "logit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/log.c",
          "lines": "198-206",
          "snippet": "void\nlogit(const char *fmt,...)\n{\n\tva_list args;\n\n\tva_start(args, fmt);\n\tdo_log(SYSLOG_LEVEL_INFO, fmt, args);\n\tva_end(args);\n}",
          "includes": [
            "#include \"log.h\"",
            "# include <vis.h>",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <syslog.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <fcntl.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n# include <vis.h>\n#include <errno.h>\n#include <unistd.h>\n#include <syslog.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <fcntl.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\nlogit(const char *fmt,...)\n{\n\tva_list args;\n\n\tva_start(args, fmt);\n\tdo_log(SYSLOG_LEVEL_INFO, fmt, args);\n\tva_end(args);\n}"
        }
      },
      {
        "call_info": {
          "callee": "syslogin_perform_logout",
          "args": [
            "li"
          ],
          "line": 1453
        },
        "resolved": true,
        "details": {
          "function_name": "syslogin_perform_logout",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
          "lines": "1424-1444",
          "snippet": "static int\nsyslogin_perform_logout(struct logininfo *li)\n{\n# ifdef HAVE_LOGOUT\n\tchar line[UT_LINESIZE];\n\n\t(void)line_stripname(line, li->line, sizeof(line));\n\n\tif (!logout(line))\n\t\tlogit(\"%s: logout() returned an error\", __func__);\n#  ifdef HAVE_LOGWTMP\n\telse\n\t\tlogwtmp(line, \"\", \"\");\n#  endif\n\t/* FIXME: (ATL - if the need arises) What to do if we have\n\t * login, but no logout?  what if logout but no logwtmp? All\n\t * routines are in libutil so they should all be there,\n\t * but... */\n# endif\n\treturn (1);\n}",
          "includes": [
            "# include <util.h>",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"auth.h\"",
            "#include \"canohost.h\"",
            "#include \"packet.h\"",
            "#include \"atomicio.h\"",
            "#include \"log.h\"",
            "#include \"loginrec.h\"",
            "#include \"ssh.h\"",
            "#include \"hostfile.h\"",
            "#include \"sshkey.h\"",
            "#include \"xmalloc.h\"",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <string.h>",
            "#include <stdarg.h>",
            "#include <pwd.h>",
            "# include <paths.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "int utmp_write_entry(struct logininfo *li);",
            "int utmpx_write_entry(struct logininfo *li);",
            "int wtmp_write_entry(struct logininfo *li);",
            "int wtmpx_write_entry(struct logininfo *li);",
            "int lastlog_write_entry(struct logininfo *li);",
            "int syslogin_write_entry(struct logininfo *li);",
            "int getlast_entry(struct logininfo *li);",
            "int lastlog_get_entry(struct logininfo *li);",
            "int utmpx_get_entry(struct logininfo *li);",
            "int wtmp_get_entry(struct logininfo *li);",
            "int wtmpx_get_entry(struct logininfo *li);"
          ],
          "called_functions": [],
          "contextual_snippet": "# include <util.h>\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"auth.h\"\n#include \"canohost.h\"\n#include \"packet.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"loginrec.h\"\n#include \"ssh.h\"\n#include \"hostfile.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdarg.h>\n#include <pwd.h>\n# include <paths.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint utmp_write_entry(struct logininfo *li);\nint utmpx_write_entry(struct logininfo *li);\nint wtmp_write_entry(struct logininfo *li);\nint wtmpx_write_entry(struct logininfo *li);\nint lastlog_write_entry(struct logininfo *li);\nint syslogin_write_entry(struct logininfo *li);\nint getlast_entry(struct logininfo *li);\nint lastlog_get_entry(struct logininfo *li);\nint utmpx_get_entry(struct logininfo *li);\nint wtmp_get_entry(struct logininfo *li);\nint wtmpx_get_entry(struct logininfo *li);\n\nstatic int\nsyslogin_perform_logout(struct logininfo *li)\n{\n# ifdef HAVE_LOGOUT\n\tchar line[UT_LINESIZE];\n\n\t(void)line_stripname(line, li->line, sizeof(line));\n\n\tif (!logout(line))\n\t\tlogit(\"%s: logout() returned an error\", __func__);\n#  ifdef HAVE_LOGWTMP\n\telse\n\t\tlogwtmp(line, \"\", \"\");\n#  endif\n\t/* FIXME: (ATL - if the need arises) What to do if we have\n\t * login, but no logout?  what if logout but no logwtmp? All\n\t * routines are in libutil so they should all be there,\n\t * but... */\n# endif\n\treturn (1);\n}"
        }
      },
      {
        "call_info": {
          "callee": "syslogin_perform_login",
          "args": [
            "li"
          ],
          "line": 1451
        },
        "resolved": true,
        "details": {
          "function_name": "syslogin_perform_login",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
          "lines": "1411-1422",
          "snippet": "static int\nsyslogin_perform_login(struct logininfo *li)\n{\n\tstruct utmp *ut;\n\n\tut = xmalloc(sizeof(*ut));\n\tconstruct_utmp(li, ut);\n\tlogin(ut);\n\tfree(ut);\n\n\treturn (1);\n}",
          "includes": [
            "# include <util.h>",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"auth.h\"",
            "#include \"canohost.h\"",
            "#include \"packet.h\"",
            "#include \"atomicio.h\"",
            "#include \"log.h\"",
            "#include \"loginrec.h\"",
            "#include \"ssh.h\"",
            "#include \"hostfile.h\"",
            "#include \"sshkey.h\"",
            "#include \"xmalloc.h\"",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <string.h>",
            "#include <stdarg.h>",
            "#include <pwd.h>",
            "# include <paths.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "int utmp_write_entry(struct logininfo *li);",
            "int utmpx_write_entry(struct logininfo *li);",
            "int wtmp_write_entry(struct logininfo *li);",
            "int wtmpx_write_entry(struct logininfo *li);",
            "int lastlog_write_entry(struct logininfo *li);",
            "int syslogin_write_entry(struct logininfo *li);",
            "int getlast_entry(struct logininfo *li);",
            "int lastlog_get_entry(struct logininfo *li);",
            "int utmpx_get_entry(struct logininfo *li);",
            "int wtmp_get_entry(struct logininfo *li);",
            "int wtmpx_get_entry(struct logininfo *li);"
          ],
          "called_functions": [],
          "contextual_snippet": "# include <util.h>\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"auth.h\"\n#include \"canohost.h\"\n#include \"packet.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"loginrec.h\"\n#include \"ssh.h\"\n#include \"hostfile.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdarg.h>\n#include <pwd.h>\n# include <paths.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint utmp_write_entry(struct logininfo *li);\nint utmpx_write_entry(struct logininfo *li);\nint wtmp_write_entry(struct logininfo *li);\nint wtmpx_write_entry(struct logininfo *li);\nint lastlog_write_entry(struct logininfo *li);\nint syslogin_write_entry(struct logininfo *li);\nint getlast_entry(struct logininfo *li);\nint lastlog_get_entry(struct logininfo *li);\nint utmpx_get_entry(struct logininfo *li);\nint wtmp_get_entry(struct logininfo *li);\nint wtmpx_get_entry(struct logininfo *li);\n\nstatic int\nsyslogin_perform_login(struct logininfo *li)\n{\n\tstruct utmp *ut;\n\n\tut = xmalloc(sizeof(*ut));\n\tconstruct_utmp(li, ut);\n\tlogin(ut);\n\tfree(ut);\n\n\treturn (1);\n}"
        }
      }
    ],
    "contextual_snippet": "# include <util.h>\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"auth.h\"\n#include \"canohost.h\"\n#include \"packet.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"loginrec.h\"\n#include \"ssh.h\"\n#include \"hostfile.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdarg.h>\n#include <pwd.h>\n# include <paths.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint utmp_write_entry(struct logininfo *li);\nint utmpx_write_entry(struct logininfo *li);\nint wtmp_write_entry(struct logininfo *li);\nint wtmpx_write_entry(struct logininfo *li);\nint lastlog_write_entry(struct logininfo *li);\nint syslogin_write_entry(struct logininfo *li);\nint getlast_entry(struct logininfo *li);\nint lastlog_get_entry(struct logininfo *li);\nint utmpx_get_entry(struct logininfo *li);\nint wtmp_get_entry(struct logininfo *li);\nint wtmpx_get_entry(struct logininfo *li);\n\nint\nsyslogin_write_entry(struct logininfo *li)\n{\n\tswitch (li->type) {\n\tcase LTYPE_LOGIN:\n\t\treturn (syslogin_perform_login(li));\n\tcase LTYPE_LOGOUT:\n\t\treturn (syslogin_perform_logout(li));\n\tdefault:\n\t\tlogit(\"%s: Invalid type field\", __func__);\n\t\treturn (0);\n\t}\n}"
  },
  {
    "function_name": "syslogin_perform_logout",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
    "lines": "1424-1444",
    "snippet": "static int\nsyslogin_perform_logout(struct logininfo *li)\n{\n# ifdef HAVE_LOGOUT\n\tchar line[UT_LINESIZE];\n\n\t(void)line_stripname(line, li->line, sizeof(line));\n\n\tif (!logout(line))\n\t\tlogit(\"%s: logout() returned an error\", __func__);\n#  ifdef HAVE_LOGWTMP\n\telse\n\t\tlogwtmp(line, \"\", \"\");\n#  endif\n\t/* FIXME: (ATL - if the need arises) What to do if we have\n\t * login, but no logout?  what if logout but no logwtmp? All\n\t * routines are in libutil so they should all be there,\n\t * but... */\n# endif\n\treturn (1);\n}",
    "includes": [
      "# include <util.h>",
      "#include \"ssherr.h\"",
      "#include \"sshbuf.h\"",
      "#include \"auth.h\"",
      "#include \"canohost.h\"",
      "#include \"packet.h\"",
      "#include \"atomicio.h\"",
      "#include \"log.h\"",
      "#include \"loginrec.h\"",
      "#include \"ssh.h\"",
      "#include \"hostfile.h\"",
      "#include \"sshkey.h\"",
      "#include \"xmalloc.h\"",
      "#include <unistd.h>",
      "#include <time.h>",
      "#include <string.h>",
      "#include <stdarg.h>",
      "#include <pwd.h>",
      "# include <paths.h>",
      "#include <fcntl.h>",
      "#include <errno.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "int utmp_write_entry(struct logininfo *li);",
      "int utmpx_write_entry(struct logininfo *li);",
      "int wtmp_write_entry(struct logininfo *li);",
      "int wtmpx_write_entry(struct logininfo *li);",
      "int lastlog_write_entry(struct logininfo *li);",
      "int syslogin_write_entry(struct logininfo *li);",
      "int getlast_entry(struct logininfo *li);",
      "int lastlog_get_entry(struct logininfo *li);",
      "int utmpx_get_entry(struct logininfo *li);",
      "int wtmp_get_entry(struct logininfo *li);",
      "int wtmpx_get_entry(struct logininfo *li);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "logit",
          "args": [
            "\"%s: logout() returned an error\"",
            "__func__"
          ],
          "line": 1433
        },
        "resolved": true,
        "details": {
          "function_name": "logit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/log.c",
          "lines": "198-206",
          "snippet": "void\nlogit(const char *fmt,...)\n{\n\tva_list args;\n\n\tva_start(args, fmt);\n\tdo_log(SYSLOG_LEVEL_INFO, fmt, args);\n\tva_end(args);\n}",
          "includes": [
            "#include \"log.h\"",
            "# include <vis.h>",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <syslog.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <fcntl.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n# include <vis.h>\n#include <errno.h>\n#include <unistd.h>\n#include <syslog.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <fcntl.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\nlogit(const char *fmt,...)\n{\n\tva_list args;\n\n\tva_start(args, fmt);\n\tdo_log(SYSLOG_LEVEL_INFO, fmt, args);\n\tva_end(args);\n}"
        }
      },
      {
        "call_info": {
          "callee": "logout",
          "args": [
            "line"
          ],
          "line": 1432
        },
        "resolved": true,
        "details": {
          "function_name": "syslogin_perform_logout",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
          "lines": "1424-1444",
          "snippet": "static int\nsyslogin_perform_logout(struct logininfo *li)\n{\n# ifdef HAVE_LOGOUT\n\tchar line[UT_LINESIZE];\n\n\t(void)line_stripname(line, li->line, sizeof(line));\n\n\tif (!logout(line))\n\t\tlogit(\"%s: logout() returned an error\", __func__);\n#  ifdef HAVE_LOGWTMP\n\telse\n\t\tlogwtmp(line, \"\", \"\");\n#  endif\n\t/* FIXME: (ATL - if the need arises) What to do if we have\n\t * login, but no logout?  what if logout but no logwtmp? All\n\t * routines are in libutil so they should all be there,\n\t * but... */\n# endif\n\treturn (1);\n}",
          "note": "cyclic_reference_detected"
        }
      },
      {
        "call_info": {
          "callee": "line_stripname",
          "args": [
            "line",
            "li->line",
            "sizeof(line)"
          ],
          "line": 1430
        },
        "resolved": true,
        "details": {
          "function_name": "line_stripname",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
          "lines": "577-586",
          "snippet": "char *\nline_stripname(char *dst, const char *src, int dstsize)\n{\n\tmemset(dst, '\\0', dstsize);\n\tif (strncmp(src, \"/dev/\", 5) == 0)\n\t\tstrlcpy(dst, src + 5, dstsize);\n\telse\n\t\tstrlcpy(dst, src, dstsize);\n\treturn (dst);\n}",
          "includes": [
            "# include <util.h>",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"auth.h\"",
            "#include \"canohost.h\"",
            "#include \"packet.h\"",
            "#include \"atomicio.h\"",
            "#include \"log.h\"",
            "#include \"loginrec.h\"",
            "#include \"ssh.h\"",
            "#include \"hostfile.h\"",
            "#include \"sshkey.h\"",
            "#include \"xmalloc.h\"",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <string.h>",
            "#include <stdarg.h>",
            "#include <pwd.h>",
            "# include <paths.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <util.h>\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"auth.h\"\n#include \"canohost.h\"\n#include \"packet.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"loginrec.h\"\n#include \"ssh.h\"\n#include \"hostfile.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdarg.h>\n#include <pwd.h>\n# include <paths.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nchar *\nline_stripname(char *dst, const char *src, int dstsize)\n{\n\tmemset(dst, '\\0', dstsize);\n\tif (strncmp(src, \"/dev/\", 5) == 0)\n\t\tstrlcpy(dst, src + 5, dstsize);\n\telse\n\t\tstrlcpy(dst, src, dstsize);\n\treturn (dst);\n}"
        }
      }
    ],
    "contextual_snippet": "# include <util.h>\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"auth.h\"\n#include \"canohost.h\"\n#include \"packet.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"loginrec.h\"\n#include \"ssh.h\"\n#include \"hostfile.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdarg.h>\n#include <pwd.h>\n# include <paths.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint utmp_write_entry(struct logininfo *li);\nint utmpx_write_entry(struct logininfo *li);\nint wtmp_write_entry(struct logininfo *li);\nint wtmpx_write_entry(struct logininfo *li);\nint lastlog_write_entry(struct logininfo *li);\nint syslogin_write_entry(struct logininfo *li);\nint getlast_entry(struct logininfo *li);\nint lastlog_get_entry(struct logininfo *li);\nint utmpx_get_entry(struct logininfo *li);\nint wtmp_get_entry(struct logininfo *li);\nint wtmpx_get_entry(struct logininfo *li);\n\nstatic int\nsyslogin_perform_logout(struct logininfo *li)\n{\n# ifdef HAVE_LOGOUT\n\tchar line[UT_LINESIZE];\n\n\t(void)line_stripname(line, li->line, sizeof(line));\n\n\tif (!logout(line))\n\t\tlogit(\"%s: logout() returned an error\", __func__);\n#  ifdef HAVE_LOGWTMP\n\telse\n\t\tlogwtmp(line, \"\", \"\");\n#  endif\n\t/* FIXME: (ATL - if the need arises) What to do if we have\n\t * login, but no logout?  what if logout but no logwtmp? All\n\t * routines are in libutil so they should all be there,\n\t * but... */\n# endif\n\treturn (1);\n}"
  },
  {
    "function_name": "syslogin_perform_login",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
    "lines": "1411-1422",
    "snippet": "static int\nsyslogin_perform_login(struct logininfo *li)\n{\n\tstruct utmp *ut;\n\n\tut = xmalloc(sizeof(*ut));\n\tconstruct_utmp(li, ut);\n\tlogin(ut);\n\tfree(ut);\n\n\treturn (1);\n}",
    "includes": [
      "# include <util.h>",
      "#include \"ssherr.h\"",
      "#include \"sshbuf.h\"",
      "#include \"auth.h\"",
      "#include \"canohost.h\"",
      "#include \"packet.h\"",
      "#include \"atomicio.h\"",
      "#include \"log.h\"",
      "#include \"loginrec.h\"",
      "#include \"ssh.h\"",
      "#include \"hostfile.h\"",
      "#include \"sshkey.h\"",
      "#include \"xmalloc.h\"",
      "#include <unistd.h>",
      "#include <time.h>",
      "#include <string.h>",
      "#include <stdarg.h>",
      "#include <pwd.h>",
      "# include <paths.h>",
      "#include <fcntl.h>",
      "#include <errno.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "int utmp_write_entry(struct logininfo *li);",
      "int utmpx_write_entry(struct logininfo *li);",
      "int wtmp_write_entry(struct logininfo *li);",
      "int wtmpx_write_entry(struct logininfo *li);",
      "int lastlog_write_entry(struct logininfo *li);",
      "int syslogin_write_entry(struct logininfo *li);",
      "int getlast_entry(struct logininfo *li);",
      "int lastlog_get_entry(struct logininfo *li);",
      "int utmpx_get_entry(struct logininfo *li);",
      "int wtmp_get_entry(struct logininfo *li);",
      "int wtmpx_get_entry(struct logininfo *li);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "ut"
          ],
          "line": 1419
        },
        "resolved": true,
        "details": {
          "function_name": "login_free_entry",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
          "lines": "354-358",
          "snippet": "void\nlogin_free_entry(struct logininfo *li)\n{\n\tfree(li);\n}",
          "includes": [
            "# include <util.h>",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"auth.h\"",
            "#include \"canohost.h\"",
            "#include \"packet.h\"",
            "#include \"atomicio.h\"",
            "#include \"log.h\"",
            "#include \"loginrec.h\"",
            "#include \"ssh.h\"",
            "#include \"hostfile.h\"",
            "#include \"sshkey.h\"",
            "#include \"xmalloc.h\"",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <string.h>",
            "#include <stdarg.h>",
            "#include <pwd.h>",
            "# include <paths.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "int utmp_write_entry(struct logininfo *li);",
            "int utmpx_write_entry(struct logininfo *li);",
            "int wtmp_write_entry(struct logininfo *li);",
            "int wtmpx_write_entry(struct logininfo *li);",
            "int lastlog_write_entry(struct logininfo *li);",
            "int syslogin_write_entry(struct logininfo *li);",
            "int getlast_entry(struct logininfo *li);",
            "int lastlog_get_entry(struct logininfo *li);",
            "int utmpx_get_entry(struct logininfo *li);",
            "int wtmp_get_entry(struct logininfo *li);",
            "int wtmpx_get_entry(struct logininfo *li);"
          ],
          "called_functions": [],
          "contextual_snippet": "# include <util.h>\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"auth.h\"\n#include \"canohost.h\"\n#include \"packet.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"loginrec.h\"\n#include \"ssh.h\"\n#include \"hostfile.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdarg.h>\n#include <pwd.h>\n# include <paths.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint utmp_write_entry(struct logininfo *li);\nint utmpx_write_entry(struct logininfo *li);\nint wtmp_write_entry(struct logininfo *li);\nint wtmpx_write_entry(struct logininfo *li);\nint lastlog_write_entry(struct logininfo *li);\nint syslogin_write_entry(struct logininfo *li);\nint getlast_entry(struct logininfo *li);\nint lastlog_get_entry(struct logininfo *li);\nint utmpx_get_entry(struct logininfo *li);\nint wtmp_get_entry(struct logininfo *li);\nint wtmpx_get_entry(struct logininfo *li);\n\nvoid\nlogin_free_entry(struct logininfo *li)\n{\n\tfree(li);\n}"
        }
      },
      {
        "call_info": {
          "callee": "login",
          "args": [
            "ut"
          ],
          "line": 1418
        },
        "resolved": true,
        "details": {
          "function_name": "syslogin_write_entry",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
          "lines": "1446-1458",
          "snippet": "int\nsyslogin_write_entry(struct logininfo *li)\n{\n\tswitch (li->type) {\n\tcase LTYPE_LOGIN:\n\t\treturn (syslogin_perform_login(li));\n\tcase LTYPE_LOGOUT:\n\t\treturn (syslogin_perform_logout(li));\n\tdefault:\n\t\tlogit(\"%s: Invalid type field\", __func__);\n\t\treturn (0);\n\t}\n}",
          "includes": [
            "# include <util.h>",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"auth.h\"",
            "#include \"canohost.h\"",
            "#include \"packet.h\"",
            "#include \"atomicio.h\"",
            "#include \"log.h\"",
            "#include \"loginrec.h\"",
            "#include \"ssh.h\"",
            "#include \"hostfile.h\"",
            "#include \"sshkey.h\"",
            "#include \"xmalloc.h\"",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <string.h>",
            "#include <stdarg.h>",
            "#include <pwd.h>",
            "# include <paths.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "int utmp_write_entry(struct logininfo *li);",
            "int utmpx_write_entry(struct logininfo *li);",
            "int wtmp_write_entry(struct logininfo *li);",
            "int wtmpx_write_entry(struct logininfo *li);",
            "int lastlog_write_entry(struct logininfo *li);",
            "int syslogin_write_entry(struct logininfo *li);",
            "int getlast_entry(struct logininfo *li);",
            "int lastlog_get_entry(struct logininfo *li);",
            "int utmpx_get_entry(struct logininfo *li);",
            "int wtmp_get_entry(struct logininfo *li);",
            "int wtmpx_get_entry(struct logininfo *li);"
          ],
          "called_functions": [],
          "contextual_snippet": "# include <util.h>\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"auth.h\"\n#include \"canohost.h\"\n#include \"packet.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"loginrec.h\"\n#include \"ssh.h\"\n#include \"hostfile.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdarg.h>\n#include <pwd.h>\n# include <paths.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint utmp_write_entry(struct logininfo *li);\nint utmpx_write_entry(struct logininfo *li);\nint wtmp_write_entry(struct logininfo *li);\nint wtmpx_write_entry(struct logininfo *li);\nint lastlog_write_entry(struct logininfo *li);\nint syslogin_write_entry(struct logininfo *li);\nint getlast_entry(struct logininfo *li);\nint lastlog_get_entry(struct logininfo *li);\nint utmpx_get_entry(struct logininfo *li);\nint wtmp_get_entry(struct logininfo *li);\nint wtmpx_get_entry(struct logininfo *li);\n\nint\nsyslogin_write_entry(struct logininfo *li)\n{\n\tswitch (li->type) {\n\tcase LTYPE_LOGIN:\n\t\treturn (syslogin_perform_login(li));\n\tcase LTYPE_LOGOUT:\n\t\treturn (syslogin_perform_logout(li));\n\tdefault:\n\t\tlogit(\"%s: Invalid type field\", __func__);\n\t\treturn (0);\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "construct_utmp",
          "args": [
            "li",
            "ut"
          ],
          "line": 1417
        },
        "resolved": true,
        "details": {
          "function_name": "construct_utmpx",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
          "lines": "738-801",
          "snippet": "void\nconstruct_utmpx(struct logininfo *li, struct utmpx *utx)\n{\n# ifdef HAVE_ADDR_V6_IN_UTMP\n\tstruct sockaddr_in6 *sa6;\n#  endif\n\tmemset(utx, '\\0', sizeof(*utx));\n\n# ifdef HAVE_ID_IN_UTMPX\n\tline_abbrevname(utx->ut_id, li->line, sizeof(utx->ut_id));\n# endif\n\n\t/* this is done here to keep utmp constants out of loginrec.h */\n\tswitch (li->type) {\n\tcase LTYPE_LOGIN:\n\t\tutx->ut_type = USER_PROCESS;\n\t\tbreak;\n\tcase LTYPE_LOGOUT:\n\t\tutx->ut_type = DEAD_PROCESS;\n\t\tbreak;\n\t}\n\tline_stripname(utx->ut_line, li->line, sizeof(utx->ut_line));\n\tset_utmpx_time(li, utx);\n\tutx->ut_pid = li->pid;\n\n\t/* strncpy(): Don't necessarily want null termination */\n\tstrncpy(utx->ut_user, li->username,\n\t    MIN_SIZEOF(utx->ut_user, li->username));\n\n\tif (li->type == LTYPE_LOGOUT)\n\t\treturn;\n\n\t/*\n\t * These fields are only used when logging in, and are blank\n\t * for logouts.\n\t */\n\n# ifdef HAVE_HOST_IN_UTMPX\n\tstrncpy(utx->ut_host, li->hostname,\n\t    MIN_SIZEOF(utx->ut_host, li->hostname));\n# endif\n# ifdef HAVE_ADDR_IN_UTMPX\n\t/* this is just a 32-bit IP address */\n\tif (li->hostaddr.sa.sa_family == AF_INET)\n\t\tutx->ut_addr = li->hostaddr.sa_in.sin_addr.s_addr;\n# endif\n# ifdef HAVE_ADDR_V6_IN_UTMP\n\t/* this is just a 128-bit IPv6 address */\n\tif (li->hostaddr.sa.sa_family == AF_INET6) {\n\t\tsa6 = ((struct sockaddr_in6 *)&li->hostaddr.sa);\n\t\tmemcpy(utx->ut_addr_v6, sa6->sin6_addr.s6_addr, 16);\n\t\tif (IN6_IS_ADDR_V4MAPPED(&sa6->sin6_addr)) {\n\t\t\tutx->ut_addr_v6[0] = utx->ut_addr_v6[3];\n\t\t\tutx->ut_addr_v6[1] = 0;\n\t\t\tutx->ut_addr_v6[2] = 0;\n\t\t\tutx->ut_addr_v6[3] = 0;\n\t\t}\n\t}\n# endif\n# ifdef HAVE_SYSLEN_IN_UTMPX\n\t/* ut_syslen is the length of the utx_host string */\n\tutx->ut_syslen = MIN(strlen(li->hostname), sizeof(utx->ut_host));\n# endif\n}",
          "includes": [
            "# include <util.h>",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"auth.h\"",
            "#include \"canohost.h\"",
            "#include \"packet.h\"",
            "#include \"atomicio.h\"",
            "#include \"log.h\"",
            "#include \"loginrec.h\"",
            "#include \"ssh.h\"",
            "#include \"hostfile.h\"",
            "#include \"sshkey.h\"",
            "#include \"xmalloc.h\"",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <string.h>",
            "#include <stdarg.h>",
            "#include <pwd.h>",
            "# include <paths.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "int utmp_write_entry(struct logininfo *li);",
            "int utmpx_write_entry(struct logininfo *li);",
            "int wtmp_write_entry(struct logininfo *li);",
            "int wtmpx_write_entry(struct logininfo *li);",
            "int lastlog_write_entry(struct logininfo *li);",
            "int syslogin_write_entry(struct logininfo *li);",
            "int getlast_entry(struct logininfo *li);",
            "int lastlog_get_entry(struct logininfo *li);",
            "int utmpx_get_entry(struct logininfo *li);",
            "int wtmp_get_entry(struct logininfo *li);",
            "int wtmpx_get_entry(struct logininfo *li);"
          ],
          "called_functions": [],
          "contextual_snippet": "# include <util.h>\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"auth.h\"\n#include \"canohost.h\"\n#include \"packet.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"loginrec.h\"\n#include \"ssh.h\"\n#include \"hostfile.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdarg.h>\n#include <pwd.h>\n# include <paths.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint utmp_write_entry(struct logininfo *li);\nint utmpx_write_entry(struct logininfo *li);\nint wtmp_write_entry(struct logininfo *li);\nint wtmpx_write_entry(struct logininfo *li);\nint lastlog_write_entry(struct logininfo *li);\nint syslogin_write_entry(struct logininfo *li);\nint getlast_entry(struct logininfo *li);\nint lastlog_get_entry(struct logininfo *li);\nint utmpx_get_entry(struct logininfo *li);\nint wtmp_get_entry(struct logininfo *li);\nint wtmpx_get_entry(struct logininfo *li);\n\nvoid\nconstruct_utmpx(struct logininfo *li, struct utmpx *utx)\n{\n# ifdef HAVE_ADDR_V6_IN_UTMP\n\tstruct sockaddr_in6 *sa6;\n#  endif\n\tmemset(utx, '\\0', sizeof(*utx));\n\n# ifdef HAVE_ID_IN_UTMPX\n\tline_abbrevname(utx->ut_id, li->line, sizeof(utx->ut_id));\n# endif\n\n\t/* this is done here to keep utmp constants out of loginrec.h */\n\tswitch (li->type) {\n\tcase LTYPE_LOGIN:\n\t\tutx->ut_type = USER_PROCESS;\n\t\tbreak;\n\tcase LTYPE_LOGOUT:\n\t\tutx->ut_type = DEAD_PROCESS;\n\t\tbreak;\n\t}\n\tline_stripname(utx->ut_line, li->line, sizeof(utx->ut_line));\n\tset_utmpx_time(li, utx);\n\tutx->ut_pid = li->pid;\n\n\t/* strncpy(): Don't necessarily want null termination */\n\tstrncpy(utx->ut_user, li->username,\n\t    MIN_SIZEOF(utx->ut_user, li->username));\n\n\tif (li->type == LTYPE_LOGOUT)\n\t\treturn;\n\n\t/*\n\t * These fields are only used when logging in, and are blank\n\t * for logouts.\n\t */\n\n# ifdef HAVE_HOST_IN_UTMPX\n\tstrncpy(utx->ut_host, li->hostname,\n\t    MIN_SIZEOF(utx->ut_host, li->hostname));\n# endif\n# ifdef HAVE_ADDR_IN_UTMPX\n\t/* this is just a 32-bit IP address */\n\tif (li->hostaddr.sa.sa_family == AF_INET)\n\t\tutx->ut_addr = li->hostaddr.sa_in.sin_addr.s_addr;\n# endif\n# ifdef HAVE_ADDR_V6_IN_UTMP\n\t/* this is just a 128-bit IPv6 address */\n\tif (li->hostaddr.sa.sa_family == AF_INET6) {\n\t\tsa6 = ((struct sockaddr_in6 *)&li->hostaddr.sa);\n\t\tmemcpy(utx->ut_addr_v6, sa6->sin6_addr.s6_addr, 16);\n\t\tif (IN6_IS_ADDR_V4MAPPED(&sa6->sin6_addr)) {\n\t\t\tutx->ut_addr_v6[0] = utx->ut_addr_v6[3];\n\t\t\tutx->ut_addr_v6[1] = 0;\n\t\t\tutx->ut_addr_v6[2] = 0;\n\t\t\tutx->ut_addr_v6[3] = 0;\n\t\t}\n\t}\n# endif\n# ifdef HAVE_SYSLEN_IN_UTMPX\n\t/* ut_syslen is the length of the utx_host string */\n\tutx->ut_syslen = MIN(strlen(li->hostname), sizeof(utx->ut_host));\n# endif\n}"
        }
      },
      {
        "call_info": {
          "callee": "xmalloc",
          "args": [
            "sizeof(*ut)"
          ],
          "line": 1416
        },
        "resolved": true,
        "details": {
          "function_name": "xmalloc",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/xmalloc.c",
          "lines": "39-50",
          "snippet": "void *\nxmalloc(size_t size)\n{\n\tvoid *ptr;\n\n\tif (size == 0)\n\t\tfatal(\"xmalloc: zero size\");\n\tptr = malloc(size);\n\tif (ptr == NULL)\n\t\tfatal(\"xmalloc: out of memory (allocating %zu bytes)\", size);\n\treturn ptr;\n}",
          "includes": [
            "#include \"log.h\"",
            "#include \"xmalloc.h\"",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdint.h>",
            "#include <stdarg.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n#include \"xmalloc.h\"\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdint.h>\n#include <stdarg.h>\n#include \"includes.h\"\n\nvoid *\nxmalloc(size_t size)\n{\n\tvoid *ptr;\n\n\tif (size == 0)\n\t\tfatal(\"xmalloc: zero size\");\n\tptr = malloc(size);\n\tif (ptr == NULL)\n\t\tfatal(\"xmalloc: out of memory (allocating %zu bytes)\", size);\n\treturn ptr;\n}"
        }
      }
    ],
    "contextual_snippet": "# include <util.h>\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"auth.h\"\n#include \"canohost.h\"\n#include \"packet.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"loginrec.h\"\n#include \"ssh.h\"\n#include \"hostfile.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdarg.h>\n#include <pwd.h>\n# include <paths.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint utmp_write_entry(struct logininfo *li);\nint utmpx_write_entry(struct logininfo *li);\nint wtmp_write_entry(struct logininfo *li);\nint wtmpx_write_entry(struct logininfo *li);\nint lastlog_write_entry(struct logininfo *li);\nint syslogin_write_entry(struct logininfo *li);\nint getlast_entry(struct logininfo *li);\nint lastlog_get_entry(struct logininfo *li);\nint utmpx_get_entry(struct logininfo *li);\nint wtmp_get_entry(struct logininfo *li);\nint wtmpx_get_entry(struct logininfo *li);\n\nstatic int\nsyslogin_perform_login(struct logininfo *li)\n{\n\tstruct utmp *ut;\n\n\tut = xmalloc(sizeof(*ut));\n\tconstruct_utmp(li, ut);\n\tlogin(ut);\n\tfree(ut);\n\n\treturn (1);\n}"
  },
  {
    "function_name": "wtmpx_get_entry",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
    "lines": "1341-1403",
    "snippet": "int\nwtmpx_get_entry(struct logininfo *li)\n{\n\tstruct stat st;\n\tstruct utmpx utx;\n\tint fd, found=0;\n\n\t/* Clear the time entries */\n\tli->tv_sec = li->tv_usec = 0;\n\n\tif ((fd = open(WTMPX_FILE, O_RDONLY)) < 0) {\n\t\tlogit(\"%s: problem opening %s: %s\", __func__,\n\t\t    WTMPX_FILE, strerror(errno));\n\t\treturn (0);\n\t}\n\tif (fstat(fd, &st) != 0) {\n\t\tlogit(\"%s: couldn't stat %s: %s\", __func__,\n\t\t    WTMPX_FILE, strerror(errno));\n\t\tclose(fd);\n\t\treturn (0);\n\t}\n\n\t/* Seek to the start of the last struct utmpx */\n\tif (lseek(fd, -(off_t)sizeof(struct utmpx), SEEK_END) == -1 ) {\n\t\t/* probably a newly rotated wtmpx file */\n\t\tclose(fd);\n\t\treturn (0);\n\t}\n\n\twhile (!found) {\n\t\tif (atomicio(read, fd, &utx, sizeof(utx)) != sizeof(utx)) {\n\t\t\tlogit(\"%s: read of %s failed: %s\", __func__,\n\t\t\t    WTMPX_FILE, strerror(errno));\n\t\t\tclose (fd);\n\t\t\treturn (0);\n\t\t}\n\t\t/*\n\t\t * Logouts are recorded as a blank username on a particular\n\t\t * line. So, we just need to find the username in struct utmpx\n\t\t */\n\t\tif (wtmpx_islogin(li, &utx)) {\n\t\t\tfound = 1;\n# if defined(HAVE_TV_IN_UTMPX)\n\t\t\tli->tv_sec = utx.ut_tv.tv_sec;\n# elif defined(HAVE_TIME_IN_UTMPX)\n\t\t\tli->tv_sec = utx.ut_time;\n# endif\n\t\t\tline_fullname(li->line, utx.ut_line, sizeof(li->line));\n# if defined(HAVE_HOST_IN_UTMPX)\n\t\t\tstrlcpy(li->hostname, utx.ut_host,\n\t\t\t    MIN_SIZEOF(li->hostname, utx.ut_host));\n# endif\n\t\t\tcontinue;\n\t\t}\n\t\tif (lseek(fd, -(off_t)(2 * sizeof(struct utmpx)), SEEK_CUR) == -1) {\n\t\t\tclose(fd);\n\t\t\treturn (0);\n\t\t}\n\t}\n\n\tclose(fd);\n\treturn (1);\n}",
    "includes": [
      "# include <util.h>",
      "#include \"ssherr.h\"",
      "#include \"sshbuf.h\"",
      "#include \"auth.h\"",
      "#include \"canohost.h\"",
      "#include \"packet.h\"",
      "#include \"atomicio.h\"",
      "#include \"log.h\"",
      "#include \"loginrec.h\"",
      "#include \"ssh.h\"",
      "#include \"hostfile.h\"",
      "#include \"sshkey.h\"",
      "#include \"xmalloc.h\"",
      "#include <unistd.h>",
      "#include <time.h>",
      "#include <string.h>",
      "#include <stdarg.h>",
      "#include <pwd.h>",
      "# include <paths.h>",
      "#include <fcntl.h>",
      "#include <errno.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "int utmp_write_entry(struct logininfo *li);",
      "int utmpx_write_entry(struct logininfo *li);",
      "int wtmp_write_entry(struct logininfo *li);",
      "int wtmpx_write_entry(struct logininfo *li);",
      "int lastlog_write_entry(struct logininfo *li);",
      "int syslogin_write_entry(struct logininfo *li);",
      "int getlast_entry(struct logininfo *li);",
      "int lastlog_get_entry(struct logininfo *li);",
      "int utmpx_get_entry(struct logininfo *li);",
      "int wtmp_get_entry(struct logininfo *li);",
      "int wtmpx_get_entry(struct logininfo *li);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "close",
          "args": [
            "fd"
          ],
          "line": 1401
        },
        "resolved": true,
        "details": {
          "function_name": "ssh_close_authentication_socket",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/authfd.c",
          "lines": "171-176",
          "snippet": "void\nssh_close_authentication_socket(int sock)\n{\n\tif (getenv(SSH_AUTHSOCKET_ENV_NAME))\n\t\tclose(sock);\n}",
          "includes": [
            "#include \"ssherr.h\"",
            "#include \"misc.h\"",
            "#include \"atomicio.h\"",
            "#include \"log.h\"",
            "#include \"compat.h\"",
            "#include \"cipher.h\"",
            "#include \"authfd.h\"",
            "#include \"sshkey.h\"",
            "#include \"sshbuf.h\"",
            "#include \"ssh.h\"",
            "#include \"xmalloc.h\"",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "#include <stdlib.h>",
            "#include <fcntl.h>",
            "#include <sys/socket.h>",
            "#include <sys/un.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"ssherr.h\"\n#include \"misc.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"compat.h\"\n#include \"cipher.h\"\n#include \"authfd.h\"\n#include \"sshkey.h\"\n#include \"sshbuf.h\"\n#include \"ssh.h\"\n#include \"xmalloc.h\"\n#include <errno.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdarg.h>\n#include <signal.h>\n#include <stdlib.h>\n#include <fcntl.h>\n#include <sys/socket.h>\n#include <sys/un.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\nssh_close_authentication_socket(int sock)\n{\n\tif (getenv(SSH_AUTHSOCKET_ENV_NAME))\n\t\tclose(sock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "lseek",
          "args": [
            "fd",
            "-(off_t)(2 * sizeof(struct utmpx))",
            "SEEK_CUR"
          ],
          "line": 1395
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "",
          "args": [
            "2 * sizeof(struct utmpx)"
          ],
          "line": 1395
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strlcpy",
          "args": [
            "li->hostname",
            "utx.ut_host",
            "MIN_SIZEOF(li->hostname, utx.ut_host)"
          ],
          "line": 1390
        },
        "resolved": true,
        "details": {
          "function_name": "strlcpy",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/openbsd-compat/strlcpy.c",
          "lines": "32-56",
          "snippet": "size_t\nstrlcpy(char *dst, const char *src, size_t siz)\n{\n\tchar *d = dst;\n\tconst char *s = src;\n\tsize_t n = siz;\n\n\t/* Copy as many bytes as will fit */\n\tif (n != 0) {\n\t\twhile (--n != 0) {\n\t\t\tif ((*d++ = *s++) == '\\0')\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\t/* Not enough room in dst, add NUL and traverse rest of src */\n\tif (n == 0) {\n\t\tif (siz != 0)\n\t\t\t*d = '\\0';\t\t/* NUL-terminate dst */\n\t\twhile (*s++)\n\t\t\t;\n\t}\n\n\treturn(s - src - 1);\t/* count does not include NUL */\n}",
          "includes": [
            "#include <string.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nsize_t\nstrlcpy(char *dst, const char *src, size_t siz)\n{\n\tchar *d = dst;\n\tconst char *s = src;\n\tsize_t n = siz;\n\n\t/* Copy as many bytes as will fit */\n\tif (n != 0) {\n\t\twhile (--n != 0) {\n\t\t\tif ((*d++ = *s++) == '\\0')\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\t/* Not enough room in dst, add NUL and traverse rest of src */\n\tif (n == 0) {\n\t\tif (siz != 0)\n\t\t\t*d = '\\0';\t\t/* NUL-terminate dst */\n\t\twhile (*s++)\n\t\t\t;\n\t}\n\n\treturn(s - src - 1);\t/* count does not include NUL */\n}"
        }
      },
      {
        "call_info": {
          "callee": "MIN_SIZEOF",
          "args": [
            "li->hostname",
            "utx.ut_host"
          ],
          "line": 1391
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "line_fullname",
          "args": [
            "li->line",
            "utx.ut_line",
            "sizeof(li->line)"
          ],
          "line": 1388
        },
        "resolved": true,
        "details": {
          "function_name": "line_fullname",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
          "lines": "563-574",
          "snippet": "char *\nline_fullname(char *dst, const char *src, u_int dstsize)\n{\n\tmemset(dst, '\\0', dstsize);\n\tif ((strncmp(src, \"/dev/\", 5) == 0) || (dstsize < (strlen(src) + 5)))\n\t\tstrlcpy(dst, src, dstsize);\n\telse {\n\t\tstrlcpy(dst, \"/dev/\", dstsize);\n\t\tstrlcat(dst, src, dstsize);\n\t}\n\treturn (dst);\n}",
          "includes": [
            "# include <util.h>",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"auth.h\"",
            "#include \"canohost.h\"",
            "#include \"packet.h\"",
            "#include \"atomicio.h\"",
            "#include \"log.h\"",
            "#include \"loginrec.h\"",
            "#include \"ssh.h\"",
            "#include \"hostfile.h\"",
            "#include \"sshkey.h\"",
            "#include \"xmalloc.h\"",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <string.h>",
            "#include <stdarg.h>",
            "#include <pwd.h>",
            "# include <paths.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <util.h>\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"auth.h\"\n#include \"canohost.h\"\n#include \"packet.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"loginrec.h\"\n#include \"ssh.h\"\n#include \"hostfile.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdarg.h>\n#include <pwd.h>\n# include <paths.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nchar *\nline_fullname(char *dst, const char *src, u_int dstsize)\n{\n\tmemset(dst, '\\0', dstsize);\n\tif ((strncmp(src, \"/dev/\", 5) == 0) || (dstsize < (strlen(src) + 5)))\n\t\tstrlcpy(dst, src, dstsize);\n\telse {\n\t\tstrlcpy(dst, \"/dev/\", dstsize);\n\t\tstrlcat(dst, src, dstsize);\n\t}\n\treturn (dst);\n}"
        }
      },
      {
        "call_info": {
          "callee": "wtmpx_islogin",
          "args": [
            "li",
            "&utx"
          ],
          "line": 1381
        },
        "resolved": true,
        "details": {
          "function_name": "wtmpx_islogin",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
          "lines": "1325-1338",
          "snippet": "static int\nwtmpx_islogin(struct logininfo *li, struct utmpx *utx)\n{\n\tif (strncmp(li->username, utx->ut_user,\n\t    MIN_SIZEOF(li->username, utx->ut_user)) == 0 ) {\n# ifdef HAVE_TYPE_IN_UTMPX\n\t\tif (utx->ut_type == USER_PROCESS)\n\t\t\treturn (1);\n# else\n\t\treturn (1);\n# endif\n\t}\n\treturn (0);\n}",
          "includes": [
            "# include <util.h>",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"auth.h\"",
            "#include \"canohost.h\"",
            "#include \"packet.h\"",
            "#include \"atomicio.h\"",
            "#include \"log.h\"",
            "#include \"loginrec.h\"",
            "#include \"ssh.h\"",
            "#include \"hostfile.h\"",
            "#include \"sshkey.h\"",
            "#include \"xmalloc.h\"",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <string.h>",
            "#include <stdarg.h>",
            "#include <pwd.h>",
            "# include <paths.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "int utmp_write_entry(struct logininfo *li);",
            "int utmpx_write_entry(struct logininfo *li);",
            "int wtmp_write_entry(struct logininfo *li);",
            "int wtmpx_write_entry(struct logininfo *li);",
            "int lastlog_write_entry(struct logininfo *li);",
            "int syslogin_write_entry(struct logininfo *li);",
            "int getlast_entry(struct logininfo *li);",
            "int lastlog_get_entry(struct logininfo *li);",
            "int utmpx_get_entry(struct logininfo *li);",
            "int wtmp_get_entry(struct logininfo *li);",
            "int wtmpx_get_entry(struct logininfo *li);"
          ],
          "called_functions": [],
          "contextual_snippet": "# include <util.h>\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"auth.h\"\n#include \"canohost.h\"\n#include \"packet.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"loginrec.h\"\n#include \"ssh.h\"\n#include \"hostfile.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdarg.h>\n#include <pwd.h>\n# include <paths.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint utmp_write_entry(struct logininfo *li);\nint utmpx_write_entry(struct logininfo *li);\nint wtmp_write_entry(struct logininfo *li);\nint wtmpx_write_entry(struct logininfo *li);\nint lastlog_write_entry(struct logininfo *li);\nint syslogin_write_entry(struct logininfo *li);\nint getlast_entry(struct logininfo *li);\nint lastlog_get_entry(struct logininfo *li);\nint utmpx_get_entry(struct logininfo *li);\nint wtmp_get_entry(struct logininfo *li);\nint wtmpx_get_entry(struct logininfo *li);\n\nstatic int\nwtmpx_islogin(struct logininfo *li, struct utmpx *utx)\n{\n\tif (strncmp(li->username, utx->ut_user,\n\t    MIN_SIZEOF(li->username, utx->ut_user)) == 0 ) {\n# ifdef HAVE_TYPE_IN_UTMPX\n\t\tif (utx->ut_type == USER_PROCESS)\n\t\t\treturn (1);\n# else\n\t\treturn (1);\n# endif\n\t}\n\treturn (0);\n}"
        }
      },
      {
        "call_info": {
          "callee": "logit",
          "args": [
            "\"%s: read of %s failed: %s\"",
            "__func__",
            "WTMPX_FILE",
            "strerror(errno)"
          ],
          "line": 1372
        },
        "resolved": true,
        "details": {
          "function_name": "logit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/log.c",
          "lines": "198-206",
          "snippet": "void\nlogit(const char *fmt,...)\n{\n\tva_list args;\n\n\tva_start(args, fmt);\n\tdo_log(SYSLOG_LEVEL_INFO, fmt, args);\n\tva_end(args);\n}",
          "includes": [
            "#include \"log.h\"",
            "# include <vis.h>",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <syslog.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <fcntl.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n# include <vis.h>\n#include <errno.h>\n#include <unistd.h>\n#include <syslog.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <fcntl.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\nlogit(const char *fmt,...)\n{\n\tva_list args;\n\n\tva_start(args, fmt);\n\tdo_log(SYSLOG_LEVEL_INFO, fmt, args);\n\tva_end(args);\n}"
        }
      },
      {
        "call_info": {
          "callee": "strerror",
          "args": [
            "errno"
          ],
          "line": 1373
        },
        "resolved": true,
        "details": {
          "function_name": "ssh_gai_strerror",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/misc.c",
          "lines": "140-146",
          "snippet": "const char *\nssh_gai_strerror(int gaierr)\n{\n\tif (gaierr == EAI_SYSTEM && errno != 0)\n\t\treturn strerror(errno);\n\treturn gai_strerror(gaierr);\n}",
          "includes": [
            "#include \"platform.h\"",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"ssh.h\"",
            "#include \"log.h\"",
            "#include \"misc.h\"",
            "#include \"xmalloc.h\"",
            "#include <net/if.h>",
            "#include <pwd.h>",
            "# include <paths.h>",
            "#include <netdb.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <ctype.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/tcp.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in_systm.h>",
            "#include <netinet/in.h>",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <libgen.h>",
            "#include <limits.h>",
            "#include <sys/un.h>",
            "#include <sys/wait.h>",
            "#include <sys/time.h>",
            "#include <sys/stat.h>",
            "#include <sys/socket.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"platform.h\"\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"ssh.h\"\n#include \"log.h\"\n#include \"misc.h\"\n#include \"xmalloc.h\"\n#include <net/if.h>\n#include <pwd.h>\n# include <paths.h>\n#include <netdb.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <ctype.h>\n#include <arpa/inet.h>\n#include <netinet/tcp.h>\n#include <netinet/ip.h>\n#include <netinet/in_systm.h>\n#include <netinet/in.h>\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <libgen.h>\n#include <limits.h>\n#include <sys/un.h>\n#include <sys/wait.h>\n#include <sys/time.h>\n#include <sys/stat.h>\n#include <sys/socket.h>\n#include <sys/ioctl.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nconst char *\nssh_gai_strerror(int gaierr)\n{\n\tif (gaierr == EAI_SYSTEM && errno != 0)\n\t\treturn strerror(errno);\n\treturn gai_strerror(gaierr);\n}"
        }
      },
      {
        "call_info": {
          "callee": "atomicio",
          "args": [
            "read",
            "fd",
            "&utx",
            "sizeof(utx)"
          ],
          "line": 1371
        },
        "resolved": true,
        "details": {
          "function_name": "atomiciov",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/atomicio.c",
          "lines": "165-170",
          "snippet": "size_t\natomiciov(ssize_t (*f) (int, const struct iovec *, int), int fd,\n    const struct iovec *_iov, int iovcnt)\n{\n\treturn atomiciov6(f, fd, _iov, iovcnt, NULL, NULL);\n}",
          "includes": [
            "#include \"atomicio.h\"",
            "#include <limits.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#  include <sys/poll.h>",
            "#include <poll.h>",
            "#include <errno.h>",
            "#include <sys/uio.h>",
            "#include <sys/param.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"atomicio.h\"\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#  include <sys/poll.h>\n#include <poll.h>\n#include <errno.h>\n#include <sys/uio.h>\n#include <sys/param.h>\n#include \"includes.h\"\n\nsize_t\natomiciov(ssize_t (*f) (int, const struct iovec *, int), int fd,\n    const struct iovec *_iov, int iovcnt)\n{\n\treturn atomiciov6(f, fd, _iov, iovcnt, NULL, NULL);\n}"
        }
      },
      {
        "call_info": {
          "callee": "lseek",
          "args": [
            "fd",
            "-(off_t)sizeof(struct utmpx)",
            "SEEK_END"
          ],
          "line": 1364
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fstat",
          "args": [
            "fd",
            "&st"
          ],
          "line": 1356
        },
        "resolved": true,
        "details": {
          "function_name": "fstatvfs",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/openbsd-compat/bsd-statvfs.c",
          "lines": "71-85",
          "snippet": "int fstatvfs(int fd, struct statvfs *buf)\n{\n#  ifdef HAVE_FSTATFS\n\tstruct statfs fs;\n\n\tmemset(&fs, 0, sizeof(fs));\n\tif (fstatfs(fd, &fs) == -1)\n\t\treturn -1;\n\tcopy_statfs_to_statvfs(buf, &fs);\n\treturn 0;\n#  else\n\terrno = ENOSYS;\n\treturn -1;\n#  endif\n}",
          "includes": [
            "#include <errno.h>",
            "# include <sys/mount.h>",
            "#include <sys/param.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <errno.h>\n# include <sys/mount.h>\n#include <sys/param.h>\n#include \"includes.h\"\n\nint fstatvfs(int fd, struct statvfs *buf)\n{\n#  ifdef HAVE_FSTATFS\n\tstruct statfs fs;\n\n\tmemset(&fs, 0, sizeof(fs));\n\tif (fstatfs(fd, &fs) == -1)\n\t\treturn -1;\n\tcopy_statfs_to_statvfs(buf, &fs);\n\treturn 0;\n#  else\n\terrno = ENOSYS;\n\treturn -1;\n#  endif\n}"
        }
      },
      {
        "call_info": {
          "callee": "open",
          "args": [
            "WTMPX_FILE",
            "O_RDONLY"
          ],
          "line": 1351
        },
        "resolved": true,
        "details": {
          "function_name": "process_permitopen",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/servconf.c",
          "lines": "901-909",
          "snippet": "void\nprocess_permitopen(struct ssh *ssh, ServerOptions *options)\n{\n\tprocess_permitopen_list(ssh, sPermitOpen,\n\t    options->permitted_opens, options->num_permitted_opens);\n\tprocess_permitopen_list(ssh, sPermitListen,\n\t    options->permitted_listens,\n\t    options->num_permitted_listens);\n}",
          "includes": [
            "#include \"digest.h\"",
            "#include \"myproposal.h\"",
            "#include \"auth.h\"",
            "#include \"hostfile.h\"",
            "#include \"ssherr.h\"",
            "#include \"packet.h\"",
            "#include \"canohost.h\"",
            "#include \"groupaccess.h\"",
            "#include \"channels.h\"",
            "#include \"match.h\"",
            "#include \"mac.h\"",
            "#include \"kex.h\"",
            "#include \"sshkey.h\"",
            "#include \"cipher.h\"",
            "#include \"pathnames.h\"",
            "#include \"compat.h\"",
            "#include \"servconf.h\"",
            "#include \"misc.h\"",
            "#include \"sshbuf.h\"",
            "#include \"log.h\"",
            "#include \"ssh.h\"",
            "#include \"xmalloc.h\"",
            "#include \"openbsd-compat/sys-queue.h\"",
            "#include <util.h>",
            "#include <errno.h>",
            "#include <stdarg.h>",
            "#include <limits.h>",
            "#include <unistd.h>",
            "#include <signal.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <pwd.h>",
            "#include <netdb.h>",
            "#include <ctype.h>",
            "#include <net/route.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in_systm.h>",
            "#include <netinet/in.h>",
            "#include <sys/sysctl.h>",
            "#include <sys/socket.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static void add_listen_addr(ServerOptions *, const char *,\n    const char *, int);",
            "static void add_one_listen_addr(ServerOptions *, const char *,\n    const char *, int);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"digest.h\"\n#include \"myproposal.h\"\n#include \"auth.h\"\n#include \"hostfile.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"canohost.h\"\n#include \"groupaccess.h\"\n#include \"channels.h\"\n#include \"match.h\"\n#include \"mac.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"pathnames.h\"\n#include \"compat.h\"\n#include \"servconf.h\"\n#include \"misc.h\"\n#include \"sshbuf.h\"\n#include \"log.h\"\n#include \"ssh.h\"\n#include \"xmalloc.h\"\n#include \"openbsd-compat/sys-queue.h\"\n#include <util.h>\n#include <errno.h>\n#include <stdarg.h>\n#include <limits.h>\n#include <unistd.h>\n#include <signal.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <netdb.h>\n#include <ctype.h>\n#include <net/route.h>\n#include <netinet/ip.h>\n#include <netinet/in_systm.h>\n#include <netinet/in.h>\n#include <sys/sysctl.h>\n#include <sys/socket.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nstatic void add_listen_addr(ServerOptions *, const char *,\n    const char *, int);\nstatic void add_one_listen_addr(ServerOptions *, const char *,\n    const char *, int);\n\nvoid\nprocess_permitopen(struct ssh *ssh, ServerOptions *options)\n{\n\tprocess_permitopen_list(ssh, sPermitOpen,\n\t    options->permitted_opens, options->num_permitted_opens);\n\tprocess_permitopen_list(ssh, sPermitListen,\n\t    options->permitted_listens,\n\t    options->num_permitted_listens);\n}"
        }
      }
    ],
    "contextual_snippet": "# include <util.h>\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"auth.h\"\n#include \"canohost.h\"\n#include \"packet.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"loginrec.h\"\n#include \"ssh.h\"\n#include \"hostfile.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdarg.h>\n#include <pwd.h>\n# include <paths.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint utmp_write_entry(struct logininfo *li);\nint utmpx_write_entry(struct logininfo *li);\nint wtmp_write_entry(struct logininfo *li);\nint wtmpx_write_entry(struct logininfo *li);\nint lastlog_write_entry(struct logininfo *li);\nint syslogin_write_entry(struct logininfo *li);\nint getlast_entry(struct logininfo *li);\nint lastlog_get_entry(struct logininfo *li);\nint utmpx_get_entry(struct logininfo *li);\nint wtmp_get_entry(struct logininfo *li);\nint wtmpx_get_entry(struct logininfo *li);\n\nint\nwtmpx_get_entry(struct logininfo *li)\n{\n\tstruct stat st;\n\tstruct utmpx utx;\n\tint fd, found=0;\n\n\t/* Clear the time entries */\n\tli->tv_sec = li->tv_usec = 0;\n\n\tif ((fd = open(WTMPX_FILE, O_RDONLY)) < 0) {\n\t\tlogit(\"%s: problem opening %s: %s\", __func__,\n\t\t    WTMPX_FILE, strerror(errno));\n\t\treturn (0);\n\t}\n\tif (fstat(fd, &st) != 0) {\n\t\tlogit(\"%s: couldn't stat %s: %s\", __func__,\n\t\t    WTMPX_FILE, strerror(errno));\n\t\tclose(fd);\n\t\treturn (0);\n\t}\n\n\t/* Seek to the start of the last struct utmpx */\n\tif (lseek(fd, -(off_t)sizeof(struct utmpx), SEEK_END) == -1 ) {\n\t\t/* probably a newly rotated wtmpx file */\n\t\tclose(fd);\n\t\treturn (0);\n\t}\n\n\twhile (!found) {\n\t\tif (atomicio(read, fd, &utx, sizeof(utx)) != sizeof(utx)) {\n\t\t\tlogit(\"%s: read of %s failed: %s\", __func__,\n\t\t\t    WTMPX_FILE, strerror(errno));\n\t\t\tclose (fd);\n\t\t\treturn (0);\n\t\t}\n\t\t/*\n\t\t * Logouts are recorded as a blank username on a particular\n\t\t * line. So, we just need to find the username in struct utmpx\n\t\t */\n\t\tif (wtmpx_islogin(li, &utx)) {\n\t\t\tfound = 1;\n# if defined(HAVE_TV_IN_UTMPX)\n\t\t\tli->tv_sec = utx.ut_tv.tv_sec;\n# elif defined(HAVE_TIME_IN_UTMPX)\n\t\t\tli->tv_sec = utx.ut_time;\n# endif\n\t\t\tline_fullname(li->line, utx.ut_line, sizeof(li->line));\n# if defined(HAVE_HOST_IN_UTMPX)\n\t\t\tstrlcpy(li->hostname, utx.ut_host,\n\t\t\t    MIN_SIZEOF(li->hostname, utx.ut_host));\n# endif\n\t\t\tcontinue;\n\t\t}\n\t\tif (lseek(fd, -(off_t)(2 * sizeof(struct utmpx)), SEEK_CUR) == -1) {\n\t\t\tclose(fd);\n\t\t\treturn (0);\n\t\t}\n\t}\n\n\tclose(fd);\n\treturn (1);\n}"
  },
  {
    "function_name": "wtmpx_islogin",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
    "lines": "1325-1338",
    "snippet": "static int\nwtmpx_islogin(struct logininfo *li, struct utmpx *utx)\n{\n\tif (strncmp(li->username, utx->ut_user,\n\t    MIN_SIZEOF(li->username, utx->ut_user)) == 0 ) {\n# ifdef HAVE_TYPE_IN_UTMPX\n\t\tif (utx->ut_type == USER_PROCESS)\n\t\t\treturn (1);\n# else\n\t\treturn (1);\n# endif\n\t}\n\treturn (0);\n}",
    "includes": [
      "# include <util.h>",
      "#include \"ssherr.h\"",
      "#include \"sshbuf.h\"",
      "#include \"auth.h\"",
      "#include \"canohost.h\"",
      "#include \"packet.h\"",
      "#include \"atomicio.h\"",
      "#include \"log.h\"",
      "#include \"loginrec.h\"",
      "#include \"ssh.h\"",
      "#include \"hostfile.h\"",
      "#include \"sshkey.h\"",
      "#include \"xmalloc.h\"",
      "#include <unistd.h>",
      "#include <time.h>",
      "#include <string.h>",
      "#include <stdarg.h>",
      "#include <pwd.h>",
      "# include <paths.h>",
      "#include <fcntl.h>",
      "#include <errno.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "int utmp_write_entry(struct logininfo *li);",
      "int utmpx_write_entry(struct logininfo *li);",
      "int wtmp_write_entry(struct logininfo *li);",
      "int wtmpx_write_entry(struct logininfo *li);",
      "int lastlog_write_entry(struct logininfo *li);",
      "int syslogin_write_entry(struct logininfo *li);",
      "int getlast_entry(struct logininfo *li);",
      "int lastlog_get_entry(struct logininfo *li);",
      "int utmpx_get_entry(struct logininfo *li);",
      "int wtmp_get_entry(struct logininfo *li);",
      "int wtmpx_get_entry(struct logininfo *li);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "strncmp",
          "args": [
            "li->username",
            "utx->ut_user",
            "MIN_SIZEOF(li->username, utx->ut_user)"
          ],
          "line": 1328
        },
        "resolved": true,
        "details": {
          "function_name": "g_strncmp",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/openbsd-compat/glob.c",
          "lines": "422-435",
          "snippet": "static int\ng_strncmp(const Char *s1, const char *s2, size_t n)\n{\n\tint rv = 0;\n\n\twhile (n--) {\n\t\trv = *(Char *)s1 - *(const unsigned char *)s2++;\n\t\tif (rv)\n\t\t\tbreak;\n\t\tif (*s1++ == '\\0')\n\t\t\tbreak;\n\t}\n\treturn rv;\n}",
          "includes": [
            "#include \"charclass.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <pwd.h>",
            "#include <limits.h>",
            "#include <errno.h>",
            "#include <ctype.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include \"glob.h\"",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"charclass.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <pwd.h>\n#include <limits.h>\n#include <errno.h>\n#include <ctype.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"glob.h\"\n#include \"includes.h\"\n\nstatic int\ng_strncmp(const Char *s1, const char *s2, size_t n)\n{\n\tint rv = 0;\n\n\twhile (n--) {\n\t\trv = *(Char *)s1 - *(const unsigned char *)s2++;\n\t\tif (rv)\n\t\t\tbreak;\n\t\tif (*s1++ == '\\0')\n\t\t\tbreak;\n\t}\n\treturn rv;\n}"
        }
      },
      {
        "call_info": {
          "callee": "MIN_SIZEOF",
          "args": [
            "li->username",
            "utx->ut_user"
          ],
          "line": 1329
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "# include <util.h>\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"auth.h\"\n#include \"canohost.h\"\n#include \"packet.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"loginrec.h\"\n#include \"ssh.h\"\n#include \"hostfile.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdarg.h>\n#include <pwd.h>\n# include <paths.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint utmp_write_entry(struct logininfo *li);\nint utmpx_write_entry(struct logininfo *li);\nint wtmp_write_entry(struct logininfo *li);\nint wtmpx_write_entry(struct logininfo *li);\nint lastlog_write_entry(struct logininfo *li);\nint syslogin_write_entry(struct logininfo *li);\nint getlast_entry(struct logininfo *li);\nint lastlog_get_entry(struct logininfo *li);\nint utmpx_get_entry(struct logininfo *li);\nint wtmp_get_entry(struct logininfo *li);\nint wtmpx_get_entry(struct logininfo *li);\n\nstatic int\nwtmpx_islogin(struct logininfo *li, struct utmpx *utx)\n{\n\tif (strncmp(li->username, utx->ut_user,\n\t    MIN_SIZEOF(li->username, utx->ut_user)) == 0 ) {\n# ifdef HAVE_TYPE_IN_UTMPX\n\t\tif (utx->ut_type == USER_PROCESS)\n\t\t\treturn (1);\n# else\n\t\treturn (1);\n# endif\n\t}\n\treturn (0);\n}"
  },
  {
    "function_name": "wtmpx_write_entry",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
    "lines": "1307-1319",
    "snippet": "int\nwtmpx_write_entry(struct logininfo *li)\n{\n\tswitch(li->type) {\n\tcase LTYPE_LOGIN:\n\t\treturn (wtmpx_perform_login(li));\n\tcase LTYPE_LOGOUT:\n\t\treturn (wtmpx_perform_logout(li));\n\tdefault:\n\t\tlogit(\"%s: invalid type field\", __func__);\n\t\treturn (0);\n\t}\n}",
    "includes": [
      "# include <util.h>",
      "#include \"ssherr.h\"",
      "#include \"sshbuf.h\"",
      "#include \"auth.h\"",
      "#include \"canohost.h\"",
      "#include \"packet.h\"",
      "#include \"atomicio.h\"",
      "#include \"log.h\"",
      "#include \"loginrec.h\"",
      "#include \"ssh.h\"",
      "#include \"hostfile.h\"",
      "#include \"sshkey.h\"",
      "#include \"xmalloc.h\"",
      "#include <unistd.h>",
      "#include <time.h>",
      "#include <string.h>",
      "#include <stdarg.h>",
      "#include <pwd.h>",
      "# include <paths.h>",
      "#include <fcntl.h>",
      "#include <errno.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "int utmp_write_entry(struct logininfo *li);",
      "int utmpx_write_entry(struct logininfo *li);",
      "int wtmp_write_entry(struct logininfo *li);",
      "int wtmpx_write_entry(struct logininfo *li);",
      "int lastlog_write_entry(struct logininfo *li);",
      "int syslogin_write_entry(struct logininfo *li);",
      "int getlast_entry(struct logininfo *li);",
      "int lastlog_get_entry(struct logininfo *li);",
      "int utmpx_get_entry(struct logininfo *li);",
      "int wtmp_get_entry(struct logininfo *li);",
      "int wtmpx_get_entry(struct logininfo *li);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "logit",
          "args": [
            "\"%s: invalid type field\"",
            "__func__"
          ],
          "line": 1316
        },
        "resolved": true,
        "details": {
          "function_name": "logit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/log.c",
          "lines": "198-206",
          "snippet": "void\nlogit(const char *fmt,...)\n{\n\tva_list args;\n\n\tva_start(args, fmt);\n\tdo_log(SYSLOG_LEVEL_INFO, fmt, args);\n\tva_end(args);\n}",
          "includes": [
            "#include \"log.h\"",
            "# include <vis.h>",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <syslog.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <fcntl.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n# include <vis.h>\n#include <errno.h>\n#include <unistd.h>\n#include <syslog.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <fcntl.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\nlogit(const char *fmt,...)\n{\n\tva_list args;\n\n\tva_start(args, fmt);\n\tdo_log(SYSLOG_LEVEL_INFO, fmt, args);\n\tva_end(args);\n}"
        }
      },
      {
        "call_info": {
          "callee": "wtmpx_perform_logout",
          "args": [
            "li"
          ],
          "line": 1314
        },
        "resolved": true,
        "details": {
          "function_name": "wtmpx_perform_logout",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
          "lines": "1297-1304",
          "snippet": "static int\nwtmpx_perform_logout(struct logininfo *li)\n{\n\tstruct utmpx utx;\n\n\tconstruct_utmpx(li, &utx);\n\treturn (wtmpx_write(li, &utx));\n}",
          "includes": [
            "# include <util.h>",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"auth.h\"",
            "#include \"canohost.h\"",
            "#include \"packet.h\"",
            "#include \"atomicio.h\"",
            "#include \"log.h\"",
            "#include \"loginrec.h\"",
            "#include \"ssh.h\"",
            "#include \"hostfile.h\"",
            "#include \"sshkey.h\"",
            "#include \"xmalloc.h\"",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <string.h>",
            "#include <stdarg.h>",
            "#include <pwd.h>",
            "# include <paths.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "int utmp_write_entry(struct logininfo *li);",
            "int utmpx_write_entry(struct logininfo *li);",
            "int wtmp_write_entry(struct logininfo *li);",
            "int wtmpx_write_entry(struct logininfo *li);",
            "int lastlog_write_entry(struct logininfo *li);",
            "int syslogin_write_entry(struct logininfo *li);",
            "int getlast_entry(struct logininfo *li);",
            "int lastlog_get_entry(struct logininfo *li);",
            "int utmpx_get_entry(struct logininfo *li);",
            "int wtmp_get_entry(struct logininfo *li);",
            "int wtmpx_get_entry(struct logininfo *li);"
          ],
          "called_functions": [],
          "contextual_snippet": "# include <util.h>\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"auth.h\"\n#include \"canohost.h\"\n#include \"packet.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"loginrec.h\"\n#include \"ssh.h\"\n#include \"hostfile.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdarg.h>\n#include <pwd.h>\n# include <paths.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint utmp_write_entry(struct logininfo *li);\nint utmpx_write_entry(struct logininfo *li);\nint wtmp_write_entry(struct logininfo *li);\nint wtmpx_write_entry(struct logininfo *li);\nint lastlog_write_entry(struct logininfo *li);\nint syslogin_write_entry(struct logininfo *li);\nint getlast_entry(struct logininfo *li);\nint lastlog_get_entry(struct logininfo *li);\nint utmpx_get_entry(struct logininfo *li);\nint wtmp_get_entry(struct logininfo *li);\nint wtmpx_get_entry(struct logininfo *li);\n\nstatic int\nwtmpx_perform_logout(struct logininfo *li)\n{\n\tstruct utmpx utx;\n\n\tconstruct_utmpx(li, &utx);\n\treturn (wtmpx_write(li, &utx));\n}"
        }
      },
      {
        "call_info": {
          "callee": "wtmpx_perform_login",
          "args": [
            "li"
          ],
          "line": 1312
        },
        "resolved": true,
        "details": {
          "function_name": "wtmpx_perform_login",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
          "lines": "1287-1294",
          "snippet": "static int\nwtmpx_perform_login(struct logininfo *li)\n{\n\tstruct utmpx utx;\n\n\tconstruct_utmpx(li, &utx);\n\treturn (wtmpx_write(li, &utx));\n}",
          "includes": [
            "# include <util.h>",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"auth.h\"",
            "#include \"canohost.h\"",
            "#include \"packet.h\"",
            "#include \"atomicio.h\"",
            "#include \"log.h\"",
            "#include \"loginrec.h\"",
            "#include \"ssh.h\"",
            "#include \"hostfile.h\"",
            "#include \"sshkey.h\"",
            "#include \"xmalloc.h\"",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <string.h>",
            "#include <stdarg.h>",
            "#include <pwd.h>",
            "# include <paths.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "int utmp_write_entry(struct logininfo *li);",
            "int utmpx_write_entry(struct logininfo *li);",
            "int wtmp_write_entry(struct logininfo *li);",
            "int wtmpx_write_entry(struct logininfo *li);",
            "int lastlog_write_entry(struct logininfo *li);",
            "int syslogin_write_entry(struct logininfo *li);",
            "int getlast_entry(struct logininfo *li);",
            "int lastlog_get_entry(struct logininfo *li);",
            "int utmpx_get_entry(struct logininfo *li);",
            "int wtmp_get_entry(struct logininfo *li);",
            "int wtmpx_get_entry(struct logininfo *li);"
          ],
          "called_functions": [],
          "contextual_snippet": "# include <util.h>\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"auth.h\"\n#include \"canohost.h\"\n#include \"packet.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"loginrec.h\"\n#include \"ssh.h\"\n#include \"hostfile.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdarg.h>\n#include <pwd.h>\n# include <paths.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint utmp_write_entry(struct logininfo *li);\nint utmpx_write_entry(struct logininfo *li);\nint wtmp_write_entry(struct logininfo *li);\nint wtmpx_write_entry(struct logininfo *li);\nint lastlog_write_entry(struct logininfo *li);\nint syslogin_write_entry(struct logininfo *li);\nint getlast_entry(struct logininfo *li);\nint lastlog_get_entry(struct logininfo *li);\nint utmpx_get_entry(struct logininfo *li);\nint wtmp_get_entry(struct logininfo *li);\nint wtmpx_get_entry(struct logininfo *li);\n\nstatic int\nwtmpx_perform_login(struct logininfo *li)\n{\n\tstruct utmpx utx;\n\n\tconstruct_utmpx(li, &utx);\n\treturn (wtmpx_write(li, &utx));\n}"
        }
      }
    ],
    "contextual_snippet": "# include <util.h>\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"auth.h\"\n#include \"canohost.h\"\n#include \"packet.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"loginrec.h\"\n#include \"ssh.h\"\n#include \"hostfile.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdarg.h>\n#include <pwd.h>\n# include <paths.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint utmp_write_entry(struct logininfo *li);\nint utmpx_write_entry(struct logininfo *li);\nint wtmp_write_entry(struct logininfo *li);\nint wtmpx_write_entry(struct logininfo *li);\nint lastlog_write_entry(struct logininfo *li);\nint syslogin_write_entry(struct logininfo *li);\nint getlast_entry(struct logininfo *li);\nint lastlog_get_entry(struct logininfo *li);\nint utmpx_get_entry(struct logininfo *li);\nint wtmp_get_entry(struct logininfo *li);\nint wtmpx_get_entry(struct logininfo *li);\n\nint\nwtmpx_write_entry(struct logininfo *li)\n{\n\tswitch(li->type) {\n\tcase LTYPE_LOGIN:\n\t\treturn (wtmpx_perform_login(li));\n\tcase LTYPE_LOGOUT:\n\t\treturn (wtmpx_perform_logout(li));\n\tdefault:\n\t\tlogit(\"%s: invalid type field\", __func__);\n\t\treturn (0);\n\t}\n}"
  },
  {
    "function_name": "wtmpx_perform_logout",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
    "lines": "1297-1304",
    "snippet": "static int\nwtmpx_perform_logout(struct logininfo *li)\n{\n\tstruct utmpx utx;\n\n\tconstruct_utmpx(li, &utx);\n\treturn (wtmpx_write(li, &utx));\n}",
    "includes": [
      "# include <util.h>",
      "#include \"ssherr.h\"",
      "#include \"sshbuf.h\"",
      "#include \"auth.h\"",
      "#include \"canohost.h\"",
      "#include \"packet.h\"",
      "#include \"atomicio.h\"",
      "#include \"log.h\"",
      "#include \"loginrec.h\"",
      "#include \"ssh.h\"",
      "#include \"hostfile.h\"",
      "#include \"sshkey.h\"",
      "#include \"xmalloc.h\"",
      "#include <unistd.h>",
      "#include <time.h>",
      "#include <string.h>",
      "#include <stdarg.h>",
      "#include <pwd.h>",
      "# include <paths.h>",
      "#include <fcntl.h>",
      "#include <errno.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "int utmp_write_entry(struct logininfo *li);",
      "int utmpx_write_entry(struct logininfo *li);",
      "int wtmp_write_entry(struct logininfo *li);",
      "int wtmpx_write_entry(struct logininfo *li);",
      "int lastlog_write_entry(struct logininfo *li);",
      "int syslogin_write_entry(struct logininfo *li);",
      "int getlast_entry(struct logininfo *li);",
      "int lastlog_get_entry(struct logininfo *li);",
      "int utmpx_get_entry(struct logininfo *li);",
      "int wtmp_get_entry(struct logininfo *li);",
      "int wtmpx_get_entry(struct logininfo *li);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "wtmpx_write",
          "args": [
            "li",
            "&utx"
          ],
          "line": 1303
        },
        "resolved": true,
        "details": {
          "function_name": "wtmpx_write",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
          "lines": "1257-1284",
          "snippet": "static int\nwtmpx_write(struct logininfo *li, struct utmpx *utx)\n{\n#ifndef HAVE_UPDWTMPX\n\tstruct stat buf;\n\tint fd, ret = 1;\n\n\tif ((fd = open(WTMPX_FILE, O_WRONLY|O_APPEND, 0)) < 0) {\n\t\tlogit(\"%s: problem opening %s: %s\", __func__,\n\t\t    WTMPX_FILE, strerror(errno));\n\t\treturn (0);\n\t}\n\n\tif (fstat(fd, &buf) == 0)\n\t\tif (atomicio(vwrite, fd, utx, sizeof(*utx)) != sizeof(*utx)) {\n\t\t\tftruncate(fd, buf.st_size);\n\t\t\tlogit(\"%s: problem writing %s: %s\", __func__,\n\t\t\t    WTMPX_FILE, strerror(errno));\n\t\t\tret = 0;\n\t\t}\n\tclose(fd);\n\n\treturn (ret);\n#else\n\tupdwtmpx(WTMPX_FILE, utx);\n\treturn (1);\n#endif\n}",
          "includes": [
            "# include <util.h>",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"auth.h\"",
            "#include \"canohost.h\"",
            "#include \"packet.h\"",
            "#include \"atomicio.h\"",
            "#include \"log.h\"",
            "#include \"loginrec.h\"",
            "#include \"ssh.h\"",
            "#include \"hostfile.h\"",
            "#include \"sshkey.h\"",
            "#include \"xmalloc.h\"",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <string.h>",
            "#include <stdarg.h>",
            "#include <pwd.h>",
            "# include <paths.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "int utmp_write_entry(struct logininfo *li);",
            "int utmpx_write_entry(struct logininfo *li);",
            "int wtmp_write_entry(struct logininfo *li);",
            "int wtmpx_write_entry(struct logininfo *li);",
            "int lastlog_write_entry(struct logininfo *li);",
            "int syslogin_write_entry(struct logininfo *li);",
            "int getlast_entry(struct logininfo *li);",
            "int lastlog_get_entry(struct logininfo *li);",
            "int utmpx_get_entry(struct logininfo *li);",
            "int wtmp_get_entry(struct logininfo *li);",
            "int wtmpx_get_entry(struct logininfo *li);"
          ],
          "called_functions": [],
          "contextual_snippet": "# include <util.h>\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"auth.h\"\n#include \"canohost.h\"\n#include \"packet.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"loginrec.h\"\n#include \"ssh.h\"\n#include \"hostfile.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdarg.h>\n#include <pwd.h>\n# include <paths.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint utmp_write_entry(struct logininfo *li);\nint utmpx_write_entry(struct logininfo *li);\nint wtmp_write_entry(struct logininfo *li);\nint wtmpx_write_entry(struct logininfo *li);\nint lastlog_write_entry(struct logininfo *li);\nint syslogin_write_entry(struct logininfo *li);\nint getlast_entry(struct logininfo *li);\nint lastlog_get_entry(struct logininfo *li);\nint utmpx_get_entry(struct logininfo *li);\nint wtmp_get_entry(struct logininfo *li);\nint wtmpx_get_entry(struct logininfo *li);\n\nstatic int\nwtmpx_write(struct logininfo *li, struct utmpx *utx)\n{\n#ifndef HAVE_UPDWTMPX\n\tstruct stat buf;\n\tint fd, ret = 1;\n\n\tif ((fd = open(WTMPX_FILE, O_WRONLY|O_APPEND, 0)) < 0) {\n\t\tlogit(\"%s: problem opening %s: %s\", __func__,\n\t\t    WTMPX_FILE, strerror(errno));\n\t\treturn (0);\n\t}\n\n\tif (fstat(fd, &buf) == 0)\n\t\tif (atomicio(vwrite, fd, utx, sizeof(*utx)) != sizeof(*utx)) {\n\t\t\tftruncate(fd, buf.st_size);\n\t\t\tlogit(\"%s: problem writing %s: %s\", __func__,\n\t\t\t    WTMPX_FILE, strerror(errno));\n\t\t\tret = 0;\n\t\t}\n\tclose(fd);\n\n\treturn (ret);\n#else\n\tupdwtmpx(WTMPX_FILE, utx);\n\treturn (1);\n#endif\n}"
        }
      },
      {
        "call_info": {
          "callee": "construct_utmpx",
          "args": [
            "li",
            "&utx"
          ],
          "line": 1302
        },
        "resolved": true,
        "details": {
          "function_name": "construct_utmpx",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
          "lines": "738-801",
          "snippet": "void\nconstruct_utmpx(struct logininfo *li, struct utmpx *utx)\n{\n# ifdef HAVE_ADDR_V6_IN_UTMP\n\tstruct sockaddr_in6 *sa6;\n#  endif\n\tmemset(utx, '\\0', sizeof(*utx));\n\n# ifdef HAVE_ID_IN_UTMPX\n\tline_abbrevname(utx->ut_id, li->line, sizeof(utx->ut_id));\n# endif\n\n\t/* this is done here to keep utmp constants out of loginrec.h */\n\tswitch (li->type) {\n\tcase LTYPE_LOGIN:\n\t\tutx->ut_type = USER_PROCESS;\n\t\tbreak;\n\tcase LTYPE_LOGOUT:\n\t\tutx->ut_type = DEAD_PROCESS;\n\t\tbreak;\n\t}\n\tline_stripname(utx->ut_line, li->line, sizeof(utx->ut_line));\n\tset_utmpx_time(li, utx);\n\tutx->ut_pid = li->pid;\n\n\t/* strncpy(): Don't necessarily want null termination */\n\tstrncpy(utx->ut_user, li->username,\n\t    MIN_SIZEOF(utx->ut_user, li->username));\n\n\tif (li->type == LTYPE_LOGOUT)\n\t\treturn;\n\n\t/*\n\t * These fields are only used when logging in, and are blank\n\t * for logouts.\n\t */\n\n# ifdef HAVE_HOST_IN_UTMPX\n\tstrncpy(utx->ut_host, li->hostname,\n\t    MIN_SIZEOF(utx->ut_host, li->hostname));\n# endif\n# ifdef HAVE_ADDR_IN_UTMPX\n\t/* this is just a 32-bit IP address */\n\tif (li->hostaddr.sa.sa_family == AF_INET)\n\t\tutx->ut_addr = li->hostaddr.sa_in.sin_addr.s_addr;\n# endif\n# ifdef HAVE_ADDR_V6_IN_UTMP\n\t/* this is just a 128-bit IPv6 address */\n\tif (li->hostaddr.sa.sa_family == AF_INET6) {\n\t\tsa6 = ((struct sockaddr_in6 *)&li->hostaddr.sa);\n\t\tmemcpy(utx->ut_addr_v6, sa6->sin6_addr.s6_addr, 16);\n\t\tif (IN6_IS_ADDR_V4MAPPED(&sa6->sin6_addr)) {\n\t\t\tutx->ut_addr_v6[0] = utx->ut_addr_v6[3];\n\t\t\tutx->ut_addr_v6[1] = 0;\n\t\t\tutx->ut_addr_v6[2] = 0;\n\t\t\tutx->ut_addr_v6[3] = 0;\n\t\t}\n\t}\n# endif\n# ifdef HAVE_SYSLEN_IN_UTMPX\n\t/* ut_syslen is the length of the utx_host string */\n\tutx->ut_syslen = MIN(strlen(li->hostname), sizeof(utx->ut_host));\n# endif\n}",
          "includes": [
            "# include <util.h>",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"auth.h\"",
            "#include \"canohost.h\"",
            "#include \"packet.h\"",
            "#include \"atomicio.h\"",
            "#include \"log.h\"",
            "#include \"loginrec.h\"",
            "#include \"ssh.h\"",
            "#include \"hostfile.h\"",
            "#include \"sshkey.h\"",
            "#include \"xmalloc.h\"",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <string.h>",
            "#include <stdarg.h>",
            "#include <pwd.h>",
            "# include <paths.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "int utmp_write_entry(struct logininfo *li);",
            "int utmpx_write_entry(struct logininfo *li);",
            "int wtmp_write_entry(struct logininfo *li);",
            "int wtmpx_write_entry(struct logininfo *li);",
            "int lastlog_write_entry(struct logininfo *li);",
            "int syslogin_write_entry(struct logininfo *li);",
            "int getlast_entry(struct logininfo *li);",
            "int lastlog_get_entry(struct logininfo *li);",
            "int utmpx_get_entry(struct logininfo *li);",
            "int wtmp_get_entry(struct logininfo *li);",
            "int wtmpx_get_entry(struct logininfo *li);"
          ],
          "called_functions": [],
          "contextual_snippet": "# include <util.h>\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"auth.h\"\n#include \"canohost.h\"\n#include \"packet.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"loginrec.h\"\n#include \"ssh.h\"\n#include \"hostfile.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdarg.h>\n#include <pwd.h>\n# include <paths.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint utmp_write_entry(struct logininfo *li);\nint utmpx_write_entry(struct logininfo *li);\nint wtmp_write_entry(struct logininfo *li);\nint wtmpx_write_entry(struct logininfo *li);\nint lastlog_write_entry(struct logininfo *li);\nint syslogin_write_entry(struct logininfo *li);\nint getlast_entry(struct logininfo *li);\nint lastlog_get_entry(struct logininfo *li);\nint utmpx_get_entry(struct logininfo *li);\nint wtmp_get_entry(struct logininfo *li);\nint wtmpx_get_entry(struct logininfo *li);\n\nvoid\nconstruct_utmpx(struct logininfo *li, struct utmpx *utx)\n{\n# ifdef HAVE_ADDR_V6_IN_UTMP\n\tstruct sockaddr_in6 *sa6;\n#  endif\n\tmemset(utx, '\\0', sizeof(*utx));\n\n# ifdef HAVE_ID_IN_UTMPX\n\tline_abbrevname(utx->ut_id, li->line, sizeof(utx->ut_id));\n# endif\n\n\t/* this is done here to keep utmp constants out of loginrec.h */\n\tswitch (li->type) {\n\tcase LTYPE_LOGIN:\n\t\tutx->ut_type = USER_PROCESS;\n\t\tbreak;\n\tcase LTYPE_LOGOUT:\n\t\tutx->ut_type = DEAD_PROCESS;\n\t\tbreak;\n\t}\n\tline_stripname(utx->ut_line, li->line, sizeof(utx->ut_line));\n\tset_utmpx_time(li, utx);\n\tutx->ut_pid = li->pid;\n\n\t/* strncpy(): Don't necessarily want null termination */\n\tstrncpy(utx->ut_user, li->username,\n\t    MIN_SIZEOF(utx->ut_user, li->username));\n\n\tif (li->type == LTYPE_LOGOUT)\n\t\treturn;\n\n\t/*\n\t * These fields are only used when logging in, and are blank\n\t * for logouts.\n\t */\n\n# ifdef HAVE_HOST_IN_UTMPX\n\tstrncpy(utx->ut_host, li->hostname,\n\t    MIN_SIZEOF(utx->ut_host, li->hostname));\n# endif\n# ifdef HAVE_ADDR_IN_UTMPX\n\t/* this is just a 32-bit IP address */\n\tif (li->hostaddr.sa.sa_family == AF_INET)\n\t\tutx->ut_addr = li->hostaddr.sa_in.sin_addr.s_addr;\n# endif\n# ifdef HAVE_ADDR_V6_IN_UTMP\n\t/* this is just a 128-bit IPv6 address */\n\tif (li->hostaddr.sa.sa_family == AF_INET6) {\n\t\tsa6 = ((struct sockaddr_in6 *)&li->hostaddr.sa);\n\t\tmemcpy(utx->ut_addr_v6, sa6->sin6_addr.s6_addr, 16);\n\t\tif (IN6_IS_ADDR_V4MAPPED(&sa6->sin6_addr)) {\n\t\t\tutx->ut_addr_v6[0] = utx->ut_addr_v6[3];\n\t\t\tutx->ut_addr_v6[1] = 0;\n\t\t\tutx->ut_addr_v6[2] = 0;\n\t\t\tutx->ut_addr_v6[3] = 0;\n\t\t}\n\t}\n# endif\n# ifdef HAVE_SYSLEN_IN_UTMPX\n\t/* ut_syslen is the length of the utx_host string */\n\tutx->ut_syslen = MIN(strlen(li->hostname), sizeof(utx->ut_host));\n# endif\n}"
        }
      }
    ],
    "contextual_snippet": "# include <util.h>\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"auth.h\"\n#include \"canohost.h\"\n#include \"packet.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"loginrec.h\"\n#include \"ssh.h\"\n#include \"hostfile.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdarg.h>\n#include <pwd.h>\n# include <paths.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint utmp_write_entry(struct logininfo *li);\nint utmpx_write_entry(struct logininfo *li);\nint wtmp_write_entry(struct logininfo *li);\nint wtmpx_write_entry(struct logininfo *li);\nint lastlog_write_entry(struct logininfo *li);\nint syslogin_write_entry(struct logininfo *li);\nint getlast_entry(struct logininfo *li);\nint lastlog_get_entry(struct logininfo *li);\nint utmpx_get_entry(struct logininfo *li);\nint wtmp_get_entry(struct logininfo *li);\nint wtmpx_get_entry(struct logininfo *li);\n\nstatic int\nwtmpx_perform_logout(struct logininfo *li)\n{\n\tstruct utmpx utx;\n\n\tconstruct_utmpx(li, &utx);\n\treturn (wtmpx_write(li, &utx));\n}"
  },
  {
    "function_name": "wtmpx_perform_login",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
    "lines": "1287-1294",
    "snippet": "static int\nwtmpx_perform_login(struct logininfo *li)\n{\n\tstruct utmpx utx;\n\n\tconstruct_utmpx(li, &utx);\n\treturn (wtmpx_write(li, &utx));\n}",
    "includes": [
      "# include <util.h>",
      "#include \"ssherr.h\"",
      "#include \"sshbuf.h\"",
      "#include \"auth.h\"",
      "#include \"canohost.h\"",
      "#include \"packet.h\"",
      "#include \"atomicio.h\"",
      "#include \"log.h\"",
      "#include \"loginrec.h\"",
      "#include \"ssh.h\"",
      "#include \"hostfile.h\"",
      "#include \"sshkey.h\"",
      "#include \"xmalloc.h\"",
      "#include <unistd.h>",
      "#include <time.h>",
      "#include <string.h>",
      "#include <stdarg.h>",
      "#include <pwd.h>",
      "# include <paths.h>",
      "#include <fcntl.h>",
      "#include <errno.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "int utmp_write_entry(struct logininfo *li);",
      "int utmpx_write_entry(struct logininfo *li);",
      "int wtmp_write_entry(struct logininfo *li);",
      "int wtmpx_write_entry(struct logininfo *li);",
      "int lastlog_write_entry(struct logininfo *li);",
      "int syslogin_write_entry(struct logininfo *li);",
      "int getlast_entry(struct logininfo *li);",
      "int lastlog_get_entry(struct logininfo *li);",
      "int utmpx_get_entry(struct logininfo *li);",
      "int wtmp_get_entry(struct logininfo *li);",
      "int wtmpx_get_entry(struct logininfo *li);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "wtmpx_write",
          "args": [
            "li",
            "&utx"
          ],
          "line": 1293
        },
        "resolved": true,
        "details": {
          "function_name": "wtmpx_write",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
          "lines": "1257-1284",
          "snippet": "static int\nwtmpx_write(struct logininfo *li, struct utmpx *utx)\n{\n#ifndef HAVE_UPDWTMPX\n\tstruct stat buf;\n\tint fd, ret = 1;\n\n\tif ((fd = open(WTMPX_FILE, O_WRONLY|O_APPEND, 0)) < 0) {\n\t\tlogit(\"%s: problem opening %s: %s\", __func__,\n\t\t    WTMPX_FILE, strerror(errno));\n\t\treturn (0);\n\t}\n\n\tif (fstat(fd, &buf) == 0)\n\t\tif (atomicio(vwrite, fd, utx, sizeof(*utx)) != sizeof(*utx)) {\n\t\t\tftruncate(fd, buf.st_size);\n\t\t\tlogit(\"%s: problem writing %s: %s\", __func__,\n\t\t\t    WTMPX_FILE, strerror(errno));\n\t\t\tret = 0;\n\t\t}\n\tclose(fd);\n\n\treturn (ret);\n#else\n\tupdwtmpx(WTMPX_FILE, utx);\n\treturn (1);\n#endif\n}",
          "includes": [
            "# include <util.h>",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"auth.h\"",
            "#include \"canohost.h\"",
            "#include \"packet.h\"",
            "#include \"atomicio.h\"",
            "#include \"log.h\"",
            "#include \"loginrec.h\"",
            "#include \"ssh.h\"",
            "#include \"hostfile.h\"",
            "#include \"sshkey.h\"",
            "#include \"xmalloc.h\"",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <string.h>",
            "#include <stdarg.h>",
            "#include <pwd.h>",
            "# include <paths.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "int utmp_write_entry(struct logininfo *li);",
            "int utmpx_write_entry(struct logininfo *li);",
            "int wtmp_write_entry(struct logininfo *li);",
            "int wtmpx_write_entry(struct logininfo *li);",
            "int lastlog_write_entry(struct logininfo *li);",
            "int syslogin_write_entry(struct logininfo *li);",
            "int getlast_entry(struct logininfo *li);",
            "int lastlog_get_entry(struct logininfo *li);",
            "int utmpx_get_entry(struct logininfo *li);",
            "int wtmp_get_entry(struct logininfo *li);",
            "int wtmpx_get_entry(struct logininfo *li);"
          ],
          "called_functions": [],
          "contextual_snippet": "# include <util.h>\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"auth.h\"\n#include \"canohost.h\"\n#include \"packet.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"loginrec.h\"\n#include \"ssh.h\"\n#include \"hostfile.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdarg.h>\n#include <pwd.h>\n# include <paths.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint utmp_write_entry(struct logininfo *li);\nint utmpx_write_entry(struct logininfo *li);\nint wtmp_write_entry(struct logininfo *li);\nint wtmpx_write_entry(struct logininfo *li);\nint lastlog_write_entry(struct logininfo *li);\nint syslogin_write_entry(struct logininfo *li);\nint getlast_entry(struct logininfo *li);\nint lastlog_get_entry(struct logininfo *li);\nint utmpx_get_entry(struct logininfo *li);\nint wtmp_get_entry(struct logininfo *li);\nint wtmpx_get_entry(struct logininfo *li);\n\nstatic int\nwtmpx_write(struct logininfo *li, struct utmpx *utx)\n{\n#ifndef HAVE_UPDWTMPX\n\tstruct stat buf;\n\tint fd, ret = 1;\n\n\tif ((fd = open(WTMPX_FILE, O_WRONLY|O_APPEND, 0)) < 0) {\n\t\tlogit(\"%s: problem opening %s: %s\", __func__,\n\t\t    WTMPX_FILE, strerror(errno));\n\t\treturn (0);\n\t}\n\n\tif (fstat(fd, &buf) == 0)\n\t\tif (atomicio(vwrite, fd, utx, sizeof(*utx)) != sizeof(*utx)) {\n\t\t\tftruncate(fd, buf.st_size);\n\t\t\tlogit(\"%s: problem writing %s: %s\", __func__,\n\t\t\t    WTMPX_FILE, strerror(errno));\n\t\t\tret = 0;\n\t\t}\n\tclose(fd);\n\n\treturn (ret);\n#else\n\tupdwtmpx(WTMPX_FILE, utx);\n\treturn (1);\n#endif\n}"
        }
      },
      {
        "call_info": {
          "callee": "construct_utmpx",
          "args": [
            "li",
            "&utx"
          ],
          "line": 1292
        },
        "resolved": true,
        "details": {
          "function_name": "construct_utmpx",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
          "lines": "738-801",
          "snippet": "void\nconstruct_utmpx(struct logininfo *li, struct utmpx *utx)\n{\n# ifdef HAVE_ADDR_V6_IN_UTMP\n\tstruct sockaddr_in6 *sa6;\n#  endif\n\tmemset(utx, '\\0', sizeof(*utx));\n\n# ifdef HAVE_ID_IN_UTMPX\n\tline_abbrevname(utx->ut_id, li->line, sizeof(utx->ut_id));\n# endif\n\n\t/* this is done here to keep utmp constants out of loginrec.h */\n\tswitch (li->type) {\n\tcase LTYPE_LOGIN:\n\t\tutx->ut_type = USER_PROCESS;\n\t\tbreak;\n\tcase LTYPE_LOGOUT:\n\t\tutx->ut_type = DEAD_PROCESS;\n\t\tbreak;\n\t}\n\tline_stripname(utx->ut_line, li->line, sizeof(utx->ut_line));\n\tset_utmpx_time(li, utx);\n\tutx->ut_pid = li->pid;\n\n\t/* strncpy(): Don't necessarily want null termination */\n\tstrncpy(utx->ut_user, li->username,\n\t    MIN_SIZEOF(utx->ut_user, li->username));\n\n\tif (li->type == LTYPE_LOGOUT)\n\t\treturn;\n\n\t/*\n\t * These fields are only used when logging in, and are blank\n\t * for logouts.\n\t */\n\n# ifdef HAVE_HOST_IN_UTMPX\n\tstrncpy(utx->ut_host, li->hostname,\n\t    MIN_SIZEOF(utx->ut_host, li->hostname));\n# endif\n# ifdef HAVE_ADDR_IN_UTMPX\n\t/* this is just a 32-bit IP address */\n\tif (li->hostaddr.sa.sa_family == AF_INET)\n\t\tutx->ut_addr = li->hostaddr.sa_in.sin_addr.s_addr;\n# endif\n# ifdef HAVE_ADDR_V6_IN_UTMP\n\t/* this is just a 128-bit IPv6 address */\n\tif (li->hostaddr.sa.sa_family == AF_INET6) {\n\t\tsa6 = ((struct sockaddr_in6 *)&li->hostaddr.sa);\n\t\tmemcpy(utx->ut_addr_v6, sa6->sin6_addr.s6_addr, 16);\n\t\tif (IN6_IS_ADDR_V4MAPPED(&sa6->sin6_addr)) {\n\t\t\tutx->ut_addr_v6[0] = utx->ut_addr_v6[3];\n\t\t\tutx->ut_addr_v6[1] = 0;\n\t\t\tutx->ut_addr_v6[2] = 0;\n\t\t\tutx->ut_addr_v6[3] = 0;\n\t\t}\n\t}\n# endif\n# ifdef HAVE_SYSLEN_IN_UTMPX\n\t/* ut_syslen is the length of the utx_host string */\n\tutx->ut_syslen = MIN(strlen(li->hostname), sizeof(utx->ut_host));\n# endif\n}",
          "includes": [
            "# include <util.h>",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"auth.h\"",
            "#include \"canohost.h\"",
            "#include \"packet.h\"",
            "#include \"atomicio.h\"",
            "#include \"log.h\"",
            "#include \"loginrec.h\"",
            "#include \"ssh.h\"",
            "#include \"hostfile.h\"",
            "#include \"sshkey.h\"",
            "#include \"xmalloc.h\"",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <string.h>",
            "#include <stdarg.h>",
            "#include <pwd.h>",
            "# include <paths.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "int utmp_write_entry(struct logininfo *li);",
            "int utmpx_write_entry(struct logininfo *li);",
            "int wtmp_write_entry(struct logininfo *li);",
            "int wtmpx_write_entry(struct logininfo *li);",
            "int lastlog_write_entry(struct logininfo *li);",
            "int syslogin_write_entry(struct logininfo *li);",
            "int getlast_entry(struct logininfo *li);",
            "int lastlog_get_entry(struct logininfo *li);",
            "int utmpx_get_entry(struct logininfo *li);",
            "int wtmp_get_entry(struct logininfo *li);",
            "int wtmpx_get_entry(struct logininfo *li);"
          ],
          "called_functions": [],
          "contextual_snippet": "# include <util.h>\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"auth.h\"\n#include \"canohost.h\"\n#include \"packet.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"loginrec.h\"\n#include \"ssh.h\"\n#include \"hostfile.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdarg.h>\n#include <pwd.h>\n# include <paths.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint utmp_write_entry(struct logininfo *li);\nint utmpx_write_entry(struct logininfo *li);\nint wtmp_write_entry(struct logininfo *li);\nint wtmpx_write_entry(struct logininfo *li);\nint lastlog_write_entry(struct logininfo *li);\nint syslogin_write_entry(struct logininfo *li);\nint getlast_entry(struct logininfo *li);\nint lastlog_get_entry(struct logininfo *li);\nint utmpx_get_entry(struct logininfo *li);\nint wtmp_get_entry(struct logininfo *li);\nint wtmpx_get_entry(struct logininfo *li);\n\nvoid\nconstruct_utmpx(struct logininfo *li, struct utmpx *utx)\n{\n# ifdef HAVE_ADDR_V6_IN_UTMP\n\tstruct sockaddr_in6 *sa6;\n#  endif\n\tmemset(utx, '\\0', sizeof(*utx));\n\n# ifdef HAVE_ID_IN_UTMPX\n\tline_abbrevname(utx->ut_id, li->line, sizeof(utx->ut_id));\n# endif\n\n\t/* this is done here to keep utmp constants out of loginrec.h */\n\tswitch (li->type) {\n\tcase LTYPE_LOGIN:\n\t\tutx->ut_type = USER_PROCESS;\n\t\tbreak;\n\tcase LTYPE_LOGOUT:\n\t\tutx->ut_type = DEAD_PROCESS;\n\t\tbreak;\n\t}\n\tline_stripname(utx->ut_line, li->line, sizeof(utx->ut_line));\n\tset_utmpx_time(li, utx);\n\tutx->ut_pid = li->pid;\n\n\t/* strncpy(): Don't necessarily want null termination */\n\tstrncpy(utx->ut_user, li->username,\n\t    MIN_SIZEOF(utx->ut_user, li->username));\n\n\tif (li->type == LTYPE_LOGOUT)\n\t\treturn;\n\n\t/*\n\t * These fields are only used when logging in, and are blank\n\t * for logouts.\n\t */\n\n# ifdef HAVE_HOST_IN_UTMPX\n\tstrncpy(utx->ut_host, li->hostname,\n\t    MIN_SIZEOF(utx->ut_host, li->hostname));\n# endif\n# ifdef HAVE_ADDR_IN_UTMPX\n\t/* this is just a 32-bit IP address */\n\tif (li->hostaddr.sa.sa_family == AF_INET)\n\t\tutx->ut_addr = li->hostaddr.sa_in.sin_addr.s_addr;\n# endif\n# ifdef HAVE_ADDR_V6_IN_UTMP\n\t/* this is just a 128-bit IPv6 address */\n\tif (li->hostaddr.sa.sa_family == AF_INET6) {\n\t\tsa6 = ((struct sockaddr_in6 *)&li->hostaddr.sa);\n\t\tmemcpy(utx->ut_addr_v6, sa6->sin6_addr.s6_addr, 16);\n\t\tif (IN6_IS_ADDR_V4MAPPED(&sa6->sin6_addr)) {\n\t\t\tutx->ut_addr_v6[0] = utx->ut_addr_v6[3];\n\t\t\tutx->ut_addr_v6[1] = 0;\n\t\t\tutx->ut_addr_v6[2] = 0;\n\t\t\tutx->ut_addr_v6[3] = 0;\n\t\t}\n\t}\n# endif\n# ifdef HAVE_SYSLEN_IN_UTMPX\n\t/* ut_syslen is the length of the utx_host string */\n\tutx->ut_syslen = MIN(strlen(li->hostname), sizeof(utx->ut_host));\n# endif\n}"
        }
      }
    ],
    "contextual_snippet": "# include <util.h>\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"auth.h\"\n#include \"canohost.h\"\n#include \"packet.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"loginrec.h\"\n#include \"ssh.h\"\n#include \"hostfile.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdarg.h>\n#include <pwd.h>\n# include <paths.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint utmp_write_entry(struct logininfo *li);\nint utmpx_write_entry(struct logininfo *li);\nint wtmp_write_entry(struct logininfo *li);\nint wtmpx_write_entry(struct logininfo *li);\nint lastlog_write_entry(struct logininfo *li);\nint syslogin_write_entry(struct logininfo *li);\nint getlast_entry(struct logininfo *li);\nint lastlog_get_entry(struct logininfo *li);\nint utmpx_get_entry(struct logininfo *li);\nint wtmp_get_entry(struct logininfo *li);\nint wtmpx_get_entry(struct logininfo *li);\n\nstatic int\nwtmpx_perform_login(struct logininfo *li)\n{\n\tstruct utmpx utx;\n\n\tconstruct_utmpx(li, &utx);\n\treturn (wtmpx_write(li, &utx));\n}"
  },
  {
    "function_name": "wtmpx_write",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
    "lines": "1257-1284",
    "snippet": "static int\nwtmpx_write(struct logininfo *li, struct utmpx *utx)\n{\n#ifndef HAVE_UPDWTMPX\n\tstruct stat buf;\n\tint fd, ret = 1;\n\n\tif ((fd = open(WTMPX_FILE, O_WRONLY|O_APPEND, 0)) < 0) {\n\t\tlogit(\"%s: problem opening %s: %s\", __func__,\n\t\t    WTMPX_FILE, strerror(errno));\n\t\treturn (0);\n\t}\n\n\tif (fstat(fd, &buf) == 0)\n\t\tif (atomicio(vwrite, fd, utx, sizeof(*utx)) != sizeof(*utx)) {\n\t\t\tftruncate(fd, buf.st_size);\n\t\t\tlogit(\"%s: problem writing %s: %s\", __func__,\n\t\t\t    WTMPX_FILE, strerror(errno));\n\t\t\tret = 0;\n\t\t}\n\tclose(fd);\n\n\treturn (ret);\n#else\n\tupdwtmpx(WTMPX_FILE, utx);\n\treturn (1);\n#endif\n}",
    "includes": [
      "# include <util.h>",
      "#include \"ssherr.h\"",
      "#include \"sshbuf.h\"",
      "#include \"auth.h\"",
      "#include \"canohost.h\"",
      "#include \"packet.h\"",
      "#include \"atomicio.h\"",
      "#include \"log.h\"",
      "#include \"loginrec.h\"",
      "#include \"ssh.h\"",
      "#include \"hostfile.h\"",
      "#include \"sshkey.h\"",
      "#include \"xmalloc.h\"",
      "#include <unistd.h>",
      "#include <time.h>",
      "#include <string.h>",
      "#include <stdarg.h>",
      "#include <pwd.h>",
      "# include <paths.h>",
      "#include <fcntl.h>",
      "#include <errno.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "int utmp_write_entry(struct logininfo *li);",
      "int utmpx_write_entry(struct logininfo *li);",
      "int wtmp_write_entry(struct logininfo *li);",
      "int wtmpx_write_entry(struct logininfo *li);",
      "int lastlog_write_entry(struct logininfo *li);",
      "int syslogin_write_entry(struct logininfo *li);",
      "int getlast_entry(struct logininfo *li);",
      "int lastlog_get_entry(struct logininfo *li);",
      "int utmpx_get_entry(struct logininfo *li);",
      "int wtmp_get_entry(struct logininfo *li);",
      "int wtmpx_get_entry(struct logininfo *li);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "updwtmpx",
          "args": [
            "WTMPX_FILE",
            "utx"
          ],
          "line": 1281
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "close",
          "args": [
            "fd"
          ],
          "line": 1277
        },
        "resolved": true,
        "details": {
          "function_name": "ssh_close_authentication_socket",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/authfd.c",
          "lines": "171-176",
          "snippet": "void\nssh_close_authentication_socket(int sock)\n{\n\tif (getenv(SSH_AUTHSOCKET_ENV_NAME))\n\t\tclose(sock);\n}",
          "includes": [
            "#include \"ssherr.h\"",
            "#include \"misc.h\"",
            "#include \"atomicio.h\"",
            "#include \"log.h\"",
            "#include \"compat.h\"",
            "#include \"cipher.h\"",
            "#include \"authfd.h\"",
            "#include \"sshkey.h\"",
            "#include \"sshbuf.h\"",
            "#include \"ssh.h\"",
            "#include \"xmalloc.h\"",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "#include <stdlib.h>",
            "#include <fcntl.h>",
            "#include <sys/socket.h>",
            "#include <sys/un.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"ssherr.h\"\n#include \"misc.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"compat.h\"\n#include \"cipher.h\"\n#include \"authfd.h\"\n#include \"sshkey.h\"\n#include \"sshbuf.h\"\n#include \"ssh.h\"\n#include \"xmalloc.h\"\n#include <errno.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdarg.h>\n#include <signal.h>\n#include <stdlib.h>\n#include <fcntl.h>\n#include <sys/socket.h>\n#include <sys/un.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\nssh_close_authentication_socket(int sock)\n{\n\tif (getenv(SSH_AUTHSOCKET_ENV_NAME))\n\t\tclose(sock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "logit",
          "args": [
            "\"%s: problem writing %s: %s\"",
            "__func__",
            "WTMPX_FILE",
            "strerror(errno)"
          ],
          "line": 1273
        },
        "resolved": true,
        "details": {
          "function_name": "logit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/log.c",
          "lines": "198-206",
          "snippet": "void\nlogit(const char *fmt,...)\n{\n\tva_list args;\n\n\tva_start(args, fmt);\n\tdo_log(SYSLOG_LEVEL_INFO, fmt, args);\n\tva_end(args);\n}",
          "includes": [
            "#include \"log.h\"",
            "# include <vis.h>",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <syslog.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <fcntl.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n# include <vis.h>\n#include <errno.h>\n#include <unistd.h>\n#include <syslog.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <fcntl.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\nlogit(const char *fmt,...)\n{\n\tva_list args;\n\n\tva_start(args, fmt);\n\tdo_log(SYSLOG_LEVEL_INFO, fmt, args);\n\tva_end(args);\n}"
        }
      },
      {
        "call_info": {
          "callee": "strerror",
          "args": [
            "errno"
          ],
          "line": 1274
        },
        "resolved": true,
        "details": {
          "function_name": "ssh_gai_strerror",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/misc.c",
          "lines": "140-146",
          "snippet": "const char *\nssh_gai_strerror(int gaierr)\n{\n\tif (gaierr == EAI_SYSTEM && errno != 0)\n\t\treturn strerror(errno);\n\treturn gai_strerror(gaierr);\n}",
          "includes": [
            "#include \"platform.h\"",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"ssh.h\"",
            "#include \"log.h\"",
            "#include \"misc.h\"",
            "#include \"xmalloc.h\"",
            "#include <net/if.h>",
            "#include <pwd.h>",
            "# include <paths.h>",
            "#include <netdb.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <ctype.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/tcp.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in_systm.h>",
            "#include <netinet/in.h>",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <libgen.h>",
            "#include <limits.h>",
            "#include <sys/un.h>",
            "#include <sys/wait.h>",
            "#include <sys/time.h>",
            "#include <sys/stat.h>",
            "#include <sys/socket.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"platform.h\"\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"ssh.h\"\n#include \"log.h\"\n#include \"misc.h\"\n#include \"xmalloc.h\"\n#include <net/if.h>\n#include <pwd.h>\n# include <paths.h>\n#include <netdb.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <ctype.h>\n#include <arpa/inet.h>\n#include <netinet/tcp.h>\n#include <netinet/ip.h>\n#include <netinet/in_systm.h>\n#include <netinet/in.h>\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <libgen.h>\n#include <limits.h>\n#include <sys/un.h>\n#include <sys/wait.h>\n#include <sys/time.h>\n#include <sys/stat.h>\n#include <sys/socket.h>\n#include <sys/ioctl.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nconst char *\nssh_gai_strerror(int gaierr)\n{\n\tif (gaierr == EAI_SYSTEM && errno != 0)\n\t\treturn strerror(errno);\n\treturn gai_strerror(gaierr);\n}"
        }
      },
      {
        "call_info": {
          "callee": "ftruncate",
          "args": [
            "fd",
            "buf.st_size"
          ],
          "line": 1272
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "atomicio",
          "args": [
            "vwrite",
            "fd",
            "utx",
            "sizeof(*utx)"
          ],
          "line": 1271
        },
        "resolved": true,
        "details": {
          "function_name": "atomiciov",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/atomicio.c",
          "lines": "165-170",
          "snippet": "size_t\natomiciov(ssize_t (*f) (int, const struct iovec *, int), int fd,\n    const struct iovec *_iov, int iovcnt)\n{\n\treturn atomiciov6(f, fd, _iov, iovcnt, NULL, NULL);\n}",
          "includes": [
            "#include \"atomicio.h\"",
            "#include <limits.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#  include <sys/poll.h>",
            "#include <poll.h>",
            "#include <errno.h>",
            "#include <sys/uio.h>",
            "#include <sys/param.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"atomicio.h\"\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#  include <sys/poll.h>\n#include <poll.h>\n#include <errno.h>\n#include <sys/uio.h>\n#include <sys/param.h>\n#include \"includes.h\"\n\nsize_t\natomiciov(ssize_t (*f) (int, const struct iovec *, int), int fd,\n    const struct iovec *_iov, int iovcnt)\n{\n\treturn atomiciov6(f, fd, _iov, iovcnt, NULL, NULL);\n}"
        }
      },
      {
        "call_info": {
          "callee": "fstat",
          "args": [
            "fd",
            "&buf"
          ],
          "line": 1270
        },
        "resolved": true,
        "details": {
          "function_name": "fstatvfs",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/openbsd-compat/bsd-statvfs.c",
          "lines": "71-85",
          "snippet": "int fstatvfs(int fd, struct statvfs *buf)\n{\n#  ifdef HAVE_FSTATFS\n\tstruct statfs fs;\n\n\tmemset(&fs, 0, sizeof(fs));\n\tif (fstatfs(fd, &fs) == -1)\n\t\treturn -1;\n\tcopy_statfs_to_statvfs(buf, &fs);\n\treturn 0;\n#  else\n\terrno = ENOSYS;\n\treturn -1;\n#  endif\n}",
          "includes": [
            "#include <errno.h>",
            "# include <sys/mount.h>",
            "#include <sys/param.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <errno.h>\n# include <sys/mount.h>\n#include <sys/param.h>\n#include \"includes.h\"\n\nint fstatvfs(int fd, struct statvfs *buf)\n{\n#  ifdef HAVE_FSTATFS\n\tstruct statfs fs;\n\n\tmemset(&fs, 0, sizeof(fs));\n\tif (fstatfs(fd, &fs) == -1)\n\t\treturn -1;\n\tcopy_statfs_to_statvfs(buf, &fs);\n\treturn 0;\n#  else\n\terrno = ENOSYS;\n\treturn -1;\n#  endif\n}"
        }
      },
      {
        "call_info": {
          "callee": "open",
          "args": [
            "WTMPX_FILE",
            "O_WRONLY|O_APPEND",
            "0"
          ],
          "line": 1264
        },
        "resolved": true,
        "details": {
          "function_name": "lastlog_openseek",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
          "lines": "1471-1514",
          "snippet": "static int\nlastlog_openseek(struct logininfo *li, int *fd, int filemode)\n{\n\toff_t offset;\n\tchar lastlog_file[1024];\n\tstruct stat st;\n\n\tif (stat(LASTLOG_FILE, &st) != 0) {\n\t\tlogit(\"%s: Couldn't stat %s: %s\", __func__,\n\t\t    LASTLOG_FILE, strerror(errno));\n\t\treturn (0);\n\t}\n\tif (S_ISDIR(st.st_mode)) {\n\t\tsnprintf(lastlog_file, sizeof(lastlog_file), \"%s/%s\",\n\t\t    LASTLOG_FILE, li->username);\n\t} else if (S_ISREG(st.st_mode)) {\n\t\tstrlcpy(lastlog_file, LASTLOG_FILE, sizeof(lastlog_file));\n\t} else {\n\t\tlogit(\"%s: %.100s is not a file or directory!\", __func__,\n\t\t    LASTLOG_FILE);\n\t\treturn (0);\n\t}\n\n\t*fd = open(lastlog_file, filemode, 0600);\n\tif (*fd < 0) {\n\t\tdebug(\"%s: Couldn't open %s: %s\", __func__,\n\t\t    lastlog_file, strerror(errno));\n\t\treturn (0);\n\t}\n\n\tif (S_ISREG(st.st_mode)) {\n\t\t/* find this uid's offset in the lastlog file */\n\t\toffset = (off_t) ((u_long)li->uid * sizeof(struct lastlog));\n\n\t\tif (lseek(*fd, offset, SEEK_SET) != offset) {\n\t\t\tlogit(\"%s: %s->lseek(): %s\", __func__,\n\t\t\t    lastlog_file, strerror(errno));\n\t\t\tclose(*fd);\n\t\t\treturn (0);\n\t\t}\n\t}\n\n\treturn (1);\n}",
          "includes": [
            "# include <util.h>",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"auth.h\"",
            "#include \"canohost.h\"",
            "#include \"packet.h\"",
            "#include \"atomicio.h\"",
            "#include \"log.h\"",
            "#include \"loginrec.h\"",
            "#include \"ssh.h\"",
            "#include \"hostfile.h\"",
            "#include \"sshkey.h\"",
            "#include \"xmalloc.h\"",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <string.h>",
            "#include <stdarg.h>",
            "#include <pwd.h>",
            "# include <paths.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "int utmp_write_entry(struct logininfo *li);",
            "int utmpx_write_entry(struct logininfo *li);",
            "int wtmp_write_entry(struct logininfo *li);",
            "int wtmpx_write_entry(struct logininfo *li);",
            "int lastlog_write_entry(struct logininfo *li);",
            "int syslogin_write_entry(struct logininfo *li);",
            "int getlast_entry(struct logininfo *li);",
            "int lastlog_get_entry(struct logininfo *li);",
            "int utmpx_get_entry(struct logininfo *li);",
            "int wtmp_get_entry(struct logininfo *li);",
            "int wtmpx_get_entry(struct logininfo *li);"
          ],
          "called_functions": [],
          "contextual_snippet": "# include <util.h>\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"auth.h\"\n#include \"canohost.h\"\n#include \"packet.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"loginrec.h\"\n#include \"ssh.h\"\n#include \"hostfile.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdarg.h>\n#include <pwd.h>\n# include <paths.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint utmp_write_entry(struct logininfo *li);\nint utmpx_write_entry(struct logininfo *li);\nint wtmp_write_entry(struct logininfo *li);\nint wtmpx_write_entry(struct logininfo *li);\nint lastlog_write_entry(struct logininfo *li);\nint syslogin_write_entry(struct logininfo *li);\nint getlast_entry(struct logininfo *li);\nint lastlog_get_entry(struct logininfo *li);\nint utmpx_get_entry(struct logininfo *li);\nint wtmp_get_entry(struct logininfo *li);\nint wtmpx_get_entry(struct logininfo *li);\n\nstatic int\nlastlog_openseek(struct logininfo *li, int *fd, int filemode)\n{\n\toff_t offset;\n\tchar lastlog_file[1024];\n\tstruct stat st;\n\n\tif (stat(LASTLOG_FILE, &st) != 0) {\n\t\tlogit(\"%s: Couldn't stat %s: %s\", __func__,\n\t\t    LASTLOG_FILE, strerror(errno));\n\t\treturn (0);\n\t}\n\tif (S_ISDIR(st.st_mode)) {\n\t\tsnprintf(lastlog_file, sizeof(lastlog_file), \"%s/%s\",\n\t\t    LASTLOG_FILE, li->username);\n\t} else if (S_ISREG(st.st_mode)) {\n\t\tstrlcpy(lastlog_file, LASTLOG_FILE, sizeof(lastlog_file));\n\t} else {\n\t\tlogit(\"%s: %.100s is not a file or directory!\", __func__,\n\t\t    LASTLOG_FILE);\n\t\treturn (0);\n\t}\n\n\t*fd = open(lastlog_file, filemode, 0600);\n\tif (*fd < 0) {\n\t\tdebug(\"%s: Couldn't open %s: %s\", __func__,\n\t\t    lastlog_file, strerror(errno));\n\t\treturn (0);\n\t}\n\n\tif (S_ISREG(st.st_mode)) {\n\t\t/* find this uid's offset in the lastlog file */\n\t\toffset = (off_t) ((u_long)li->uid * sizeof(struct lastlog));\n\n\t\tif (lseek(*fd, offset, SEEK_SET) != offset) {\n\t\t\tlogit(\"%s: %s->lseek(): %s\", __func__,\n\t\t\t    lastlog_file, strerror(errno));\n\t\t\tclose(*fd);\n\t\t\treturn (0);\n\t\t}\n\t}\n\n\treturn (1);\n}"
        }
      }
    ],
    "contextual_snippet": "# include <util.h>\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"auth.h\"\n#include \"canohost.h\"\n#include \"packet.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"loginrec.h\"\n#include \"ssh.h\"\n#include \"hostfile.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdarg.h>\n#include <pwd.h>\n# include <paths.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint utmp_write_entry(struct logininfo *li);\nint utmpx_write_entry(struct logininfo *li);\nint wtmp_write_entry(struct logininfo *li);\nint wtmpx_write_entry(struct logininfo *li);\nint lastlog_write_entry(struct logininfo *li);\nint syslogin_write_entry(struct logininfo *li);\nint getlast_entry(struct logininfo *li);\nint lastlog_get_entry(struct logininfo *li);\nint utmpx_get_entry(struct logininfo *li);\nint wtmp_get_entry(struct logininfo *li);\nint wtmpx_get_entry(struct logininfo *li);\n\nstatic int\nwtmpx_write(struct logininfo *li, struct utmpx *utx)\n{\n#ifndef HAVE_UPDWTMPX\n\tstruct stat buf;\n\tint fd, ret = 1;\n\n\tif ((fd = open(WTMPX_FILE, O_WRONLY|O_APPEND, 0)) < 0) {\n\t\tlogit(\"%s: problem opening %s: %s\", __func__,\n\t\t    WTMPX_FILE, strerror(errno));\n\t\treturn (0);\n\t}\n\n\tif (fstat(fd, &buf) == 0)\n\t\tif (atomicio(vwrite, fd, utx, sizeof(*utx)) != sizeof(*utx)) {\n\t\t\tftruncate(fd, buf.st_size);\n\t\t\tlogit(\"%s: problem writing %s: %s\", __func__,\n\t\t\t    WTMPX_FILE, strerror(errno));\n\t\t\tret = 0;\n\t\t}\n\tclose(fd);\n\n\treturn (ret);\n#else\n\tupdwtmpx(WTMPX_FILE, utx);\n\treturn (1);\n#endif\n}"
  },
  {
    "function_name": "wtmp_get_entry",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
    "lines": "1176-1244",
    "snippet": "int\nwtmp_get_entry(struct logininfo *li)\n{\n\tstruct stat st;\n\tstruct utmp ut;\n\tint fd, found = 0;\n\n\t/* Clear the time entries in our logininfo */\n\tli->tv_sec = li->tv_usec = 0;\n\n\tif ((fd = open(WTMP_FILE, O_RDONLY)) < 0) {\n\t\tlogit(\"%s: problem opening %s: %s\", __func__,\n\t\t    WTMP_FILE, strerror(errno));\n\t\treturn (0);\n\t}\n\tif (fstat(fd, &st) != 0) {\n\t\tlogit(\"%s: couldn't stat %s: %s\", __func__,\n\t\t    WTMP_FILE, strerror(errno));\n\t\tclose(fd);\n\t\treturn (0);\n\t}\n\n\t/* Seek to the start of the last struct utmp */\n\tif (lseek(fd, -(off_t)sizeof(struct utmp), SEEK_END) == -1) {\n\t\t/* Looks like we've got a fresh wtmp file */\n\t\tclose(fd);\n\t\treturn (0);\n\t}\n\n\twhile (!found) {\n\t\tif (atomicio(read, fd, &ut, sizeof(ut)) != sizeof(ut)) {\n\t\t\tlogit(\"%s: read of %s failed: %s\", __func__,\n\t\t\t    WTMP_FILE, strerror(errno));\n\t\t\tclose (fd);\n\t\t\treturn (0);\n\t\t}\n\t\tif (wtmp_islogin(li, &ut) ) {\n\t\t\tfound = 1;\n\t\t\t/*\n\t\t\t * We've already checked for a time in struct\n\t\t\t * utmp, in login_getlast()\n\t\t\t */\n# ifdef HAVE_TIME_IN_UTMP\n\t\t\tli->tv_sec = ut.ut_time;\n# else\n#  if HAVE_TV_IN_UTMP\n\t\t\tli->tv_sec = ut.ut_tv.tv_sec;\n#  endif\n# endif\n\t\t\tline_fullname(li->line, ut.ut_line,\n\t\t\t    MIN_SIZEOF(li->line, ut.ut_line));\n# ifdef HAVE_HOST_IN_UTMP\n\t\t\tstrlcpy(li->hostname, ut.ut_host,\n\t\t\t    MIN_SIZEOF(li->hostname, ut.ut_host));\n# endif\n\t\t\tcontinue;\n\t\t}\n\t\t/* Seek back 2 x struct utmp */\n\t\tif (lseek(fd, -(off_t)(2 * sizeof(struct utmp)), SEEK_CUR) == -1) {\n\t\t\t/* We've found the start of the file, so quit */\n\t\t\tclose(fd);\n\t\t\treturn (0);\n\t\t}\n\t}\n\n\t/* We found an entry. Tidy up and return */\n\tclose(fd);\n\treturn (1);\n}",
    "includes": [
      "# include <util.h>",
      "#include \"ssherr.h\"",
      "#include \"sshbuf.h\"",
      "#include \"auth.h\"",
      "#include \"canohost.h\"",
      "#include \"packet.h\"",
      "#include \"atomicio.h\"",
      "#include \"log.h\"",
      "#include \"loginrec.h\"",
      "#include \"ssh.h\"",
      "#include \"hostfile.h\"",
      "#include \"sshkey.h\"",
      "#include \"xmalloc.h\"",
      "#include <unistd.h>",
      "#include <time.h>",
      "#include <string.h>",
      "#include <stdarg.h>",
      "#include <pwd.h>",
      "# include <paths.h>",
      "#include <fcntl.h>",
      "#include <errno.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "int utmp_write_entry(struct logininfo *li);",
      "int utmpx_write_entry(struct logininfo *li);",
      "int wtmp_write_entry(struct logininfo *li);",
      "int wtmpx_write_entry(struct logininfo *li);",
      "int lastlog_write_entry(struct logininfo *li);",
      "int syslogin_write_entry(struct logininfo *li);",
      "int getlast_entry(struct logininfo *li);",
      "int lastlog_get_entry(struct logininfo *li);",
      "int utmpx_get_entry(struct logininfo *li);",
      "int wtmp_get_entry(struct logininfo *li);",
      "int wtmpx_get_entry(struct logininfo *li);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "close",
          "args": [
            "fd"
          ],
          "line": 1242
        },
        "resolved": true,
        "details": {
          "function_name": "ssh_close_authentication_socket",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/authfd.c",
          "lines": "171-176",
          "snippet": "void\nssh_close_authentication_socket(int sock)\n{\n\tif (getenv(SSH_AUTHSOCKET_ENV_NAME))\n\t\tclose(sock);\n}",
          "includes": [
            "#include \"ssherr.h\"",
            "#include \"misc.h\"",
            "#include \"atomicio.h\"",
            "#include \"log.h\"",
            "#include \"compat.h\"",
            "#include \"cipher.h\"",
            "#include \"authfd.h\"",
            "#include \"sshkey.h\"",
            "#include \"sshbuf.h\"",
            "#include \"ssh.h\"",
            "#include \"xmalloc.h\"",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "#include <stdlib.h>",
            "#include <fcntl.h>",
            "#include <sys/socket.h>",
            "#include <sys/un.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"ssherr.h\"\n#include \"misc.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"compat.h\"\n#include \"cipher.h\"\n#include \"authfd.h\"\n#include \"sshkey.h\"\n#include \"sshbuf.h\"\n#include \"ssh.h\"\n#include \"xmalloc.h\"\n#include <errno.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdarg.h>\n#include <signal.h>\n#include <stdlib.h>\n#include <fcntl.h>\n#include <sys/socket.h>\n#include <sys/un.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\nssh_close_authentication_socket(int sock)\n{\n\tif (getenv(SSH_AUTHSOCKET_ENV_NAME))\n\t\tclose(sock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "lseek",
          "args": [
            "fd",
            "-(off_t)(2 * sizeof(struct utmp))",
            "SEEK_CUR"
          ],
          "line": 1234
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "",
          "args": [
            "2 * sizeof(struct utmp)"
          ],
          "line": 1234
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strlcpy",
          "args": [
            "li->hostname",
            "ut.ut_host",
            "MIN_SIZEOF(li->hostname, ut.ut_host)"
          ],
          "line": 1228
        },
        "resolved": true,
        "details": {
          "function_name": "strlcpy",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/openbsd-compat/strlcpy.c",
          "lines": "32-56",
          "snippet": "size_t\nstrlcpy(char *dst, const char *src, size_t siz)\n{\n\tchar *d = dst;\n\tconst char *s = src;\n\tsize_t n = siz;\n\n\t/* Copy as many bytes as will fit */\n\tif (n != 0) {\n\t\twhile (--n != 0) {\n\t\t\tif ((*d++ = *s++) == '\\0')\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\t/* Not enough room in dst, add NUL and traverse rest of src */\n\tif (n == 0) {\n\t\tif (siz != 0)\n\t\t\t*d = '\\0';\t\t/* NUL-terminate dst */\n\t\twhile (*s++)\n\t\t\t;\n\t}\n\n\treturn(s - src - 1);\t/* count does not include NUL */\n}",
          "includes": [
            "#include <string.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nsize_t\nstrlcpy(char *dst, const char *src, size_t siz)\n{\n\tchar *d = dst;\n\tconst char *s = src;\n\tsize_t n = siz;\n\n\t/* Copy as many bytes as will fit */\n\tif (n != 0) {\n\t\twhile (--n != 0) {\n\t\t\tif ((*d++ = *s++) == '\\0')\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\t/* Not enough room in dst, add NUL and traverse rest of src */\n\tif (n == 0) {\n\t\tif (siz != 0)\n\t\t\t*d = '\\0';\t\t/* NUL-terminate dst */\n\t\twhile (*s++)\n\t\t\t;\n\t}\n\n\treturn(s - src - 1);\t/* count does not include NUL */\n}"
        }
      },
      {
        "call_info": {
          "callee": "MIN_SIZEOF",
          "args": [
            "li->hostname",
            "ut.ut_host"
          ],
          "line": 1229
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "line_fullname",
          "args": [
            "li->line",
            "ut.ut_line",
            "MIN_SIZEOF(li->line, ut.ut_line)"
          ],
          "line": 1225
        },
        "resolved": true,
        "details": {
          "function_name": "line_fullname",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
          "lines": "563-574",
          "snippet": "char *\nline_fullname(char *dst, const char *src, u_int dstsize)\n{\n\tmemset(dst, '\\0', dstsize);\n\tif ((strncmp(src, \"/dev/\", 5) == 0) || (dstsize < (strlen(src) + 5)))\n\t\tstrlcpy(dst, src, dstsize);\n\telse {\n\t\tstrlcpy(dst, \"/dev/\", dstsize);\n\t\tstrlcat(dst, src, dstsize);\n\t}\n\treturn (dst);\n}",
          "includes": [
            "# include <util.h>",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"auth.h\"",
            "#include \"canohost.h\"",
            "#include \"packet.h\"",
            "#include \"atomicio.h\"",
            "#include \"log.h\"",
            "#include \"loginrec.h\"",
            "#include \"ssh.h\"",
            "#include \"hostfile.h\"",
            "#include \"sshkey.h\"",
            "#include \"xmalloc.h\"",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <string.h>",
            "#include <stdarg.h>",
            "#include <pwd.h>",
            "# include <paths.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <util.h>\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"auth.h\"\n#include \"canohost.h\"\n#include \"packet.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"loginrec.h\"\n#include \"ssh.h\"\n#include \"hostfile.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdarg.h>\n#include <pwd.h>\n# include <paths.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nchar *\nline_fullname(char *dst, const char *src, u_int dstsize)\n{\n\tmemset(dst, '\\0', dstsize);\n\tif ((strncmp(src, \"/dev/\", 5) == 0) || (dstsize < (strlen(src) + 5)))\n\t\tstrlcpy(dst, src, dstsize);\n\telse {\n\t\tstrlcpy(dst, \"/dev/\", dstsize);\n\t\tstrlcat(dst, src, dstsize);\n\t}\n\treturn (dst);\n}"
        }
      },
      {
        "call_info": {
          "callee": "MIN_SIZEOF",
          "args": [
            "li->line",
            "ut.ut_line"
          ],
          "line": 1226
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "wtmp_islogin",
          "args": [
            "li",
            "&ut"
          ],
          "line": 1212
        },
        "resolved": true,
        "details": {
          "function_name": "wtmp_islogin",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
          "lines": "1161-1174",
          "snippet": "static int\nwtmp_islogin(struct logininfo *li, struct utmp *ut)\n{\n\tif (strncmp(li->username, ut->ut_name,\n\t    MIN_SIZEOF(li->username, ut->ut_name)) == 0) {\n# ifdef HAVE_TYPE_IN_UTMP\n\t\tif (ut->ut_type & USER_PROCESS)\n\t\t\treturn (1);\n# else\n\t\treturn (1);\n# endif\n\t}\n\treturn (0);\n}",
          "includes": [
            "# include <util.h>",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"auth.h\"",
            "#include \"canohost.h\"",
            "#include \"packet.h\"",
            "#include \"atomicio.h\"",
            "#include \"log.h\"",
            "#include \"loginrec.h\"",
            "#include \"ssh.h\"",
            "#include \"hostfile.h\"",
            "#include \"sshkey.h\"",
            "#include \"xmalloc.h\"",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <string.h>",
            "#include <stdarg.h>",
            "#include <pwd.h>",
            "# include <paths.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "int utmp_write_entry(struct logininfo *li);",
            "int utmpx_write_entry(struct logininfo *li);",
            "int wtmp_write_entry(struct logininfo *li);",
            "int wtmpx_write_entry(struct logininfo *li);",
            "int lastlog_write_entry(struct logininfo *li);",
            "int syslogin_write_entry(struct logininfo *li);",
            "int getlast_entry(struct logininfo *li);",
            "int lastlog_get_entry(struct logininfo *li);",
            "int utmpx_get_entry(struct logininfo *li);",
            "int wtmp_get_entry(struct logininfo *li);",
            "int wtmpx_get_entry(struct logininfo *li);"
          ],
          "called_functions": [],
          "contextual_snippet": "# include <util.h>\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"auth.h\"\n#include \"canohost.h\"\n#include \"packet.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"loginrec.h\"\n#include \"ssh.h\"\n#include \"hostfile.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdarg.h>\n#include <pwd.h>\n# include <paths.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint utmp_write_entry(struct logininfo *li);\nint utmpx_write_entry(struct logininfo *li);\nint wtmp_write_entry(struct logininfo *li);\nint wtmpx_write_entry(struct logininfo *li);\nint lastlog_write_entry(struct logininfo *li);\nint syslogin_write_entry(struct logininfo *li);\nint getlast_entry(struct logininfo *li);\nint lastlog_get_entry(struct logininfo *li);\nint utmpx_get_entry(struct logininfo *li);\nint wtmp_get_entry(struct logininfo *li);\nint wtmpx_get_entry(struct logininfo *li);\n\nstatic int\nwtmp_islogin(struct logininfo *li, struct utmp *ut)\n{\n\tif (strncmp(li->username, ut->ut_name,\n\t    MIN_SIZEOF(li->username, ut->ut_name)) == 0) {\n# ifdef HAVE_TYPE_IN_UTMP\n\t\tif (ut->ut_type & USER_PROCESS)\n\t\t\treturn (1);\n# else\n\t\treturn (1);\n# endif\n\t}\n\treturn (0);\n}"
        }
      },
      {
        "call_info": {
          "callee": "logit",
          "args": [
            "\"%s: read of %s failed: %s\"",
            "__func__",
            "WTMP_FILE",
            "strerror(errno)"
          ],
          "line": 1207
        },
        "resolved": true,
        "details": {
          "function_name": "logit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/log.c",
          "lines": "198-206",
          "snippet": "void\nlogit(const char *fmt,...)\n{\n\tva_list args;\n\n\tva_start(args, fmt);\n\tdo_log(SYSLOG_LEVEL_INFO, fmt, args);\n\tva_end(args);\n}",
          "includes": [
            "#include \"log.h\"",
            "# include <vis.h>",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <syslog.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <fcntl.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n# include <vis.h>\n#include <errno.h>\n#include <unistd.h>\n#include <syslog.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <fcntl.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\nlogit(const char *fmt,...)\n{\n\tva_list args;\n\n\tva_start(args, fmt);\n\tdo_log(SYSLOG_LEVEL_INFO, fmt, args);\n\tva_end(args);\n}"
        }
      },
      {
        "call_info": {
          "callee": "strerror",
          "args": [
            "errno"
          ],
          "line": 1208
        },
        "resolved": true,
        "details": {
          "function_name": "ssh_gai_strerror",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/misc.c",
          "lines": "140-146",
          "snippet": "const char *\nssh_gai_strerror(int gaierr)\n{\n\tif (gaierr == EAI_SYSTEM && errno != 0)\n\t\treturn strerror(errno);\n\treturn gai_strerror(gaierr);\n}",
          "includes": [
            "#include \"platform.h\"",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"ssh.h\"",
            "#include \"log.h\"",
            "#include \"misc.h\"",
            "#include \"xmalloc.h\"",
            "#include <net/if.h>",
            "#include <pwd.h>",
            "# include <paths.h>",
            "#include <netdb.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <ctype.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/tcp.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in_systm.h>",
            "#include <netinet/in.h>",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <libgen.h>",
            "#include <limits.h>",
            "#include <sys/un.h>",
            "#include <sys/wait.h>",
            "#include <sys/time.h>",
            "#include <sys/stat.h>",
            "#include <sys/socket.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"platform.h\"\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"ssh.h\"\n#include \"log.h\"\n#include \"misc.h\"\n#include \"xmalloc.h\"\n#include <net/if.h>\n#include <pwd.h>\n# include <paths.h>\n#include <netdb.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <ctype.h>\n#include <arpa/inet.h>\n#include <netinet/tcp.h>\n#include <netinet/ip.h>\n#include <netinet/in_systm.h>\n#include <netinet/in.h>\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <libgen.h>\n#include <limits.h>\n#include <sys/un.h>\n#include <sys/wait.h>\n#include <sys/time.h>\n#include <sys/stat.h>\n#include <sys/socket.h>\n#include <sys/ioctl.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nconst char *\nssh_gai_strerror(int gaierr)\n{\n\tif (gaierr == EAI_SYSTEM && errno != 0)\n\t\treturn strerror(errno);\n\treturn gai_strerror(gaierr);\n}"
        }
      },
      {
        "call_info": {
          "callee": "atomicio",
          "args": [
            "read",
            "fd",
            "&ut",
            "sizeof(ut)"
          ],
          "line": 1206
        },
        "resolved": true,
        "details": {
          "function_name": "atomiciov",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/atomicio.c",
          "lines": "165-170",
          "snippet": "size_t\natomiciov(ssize_t (*f) (int, const struct iovec *, int), int fd,\n    const struct iovec *_iov, int iovcnt)\n{\n\treturn atomiciov6(f, fd, _iov, iovcnt, NULL, NULL);\n}",
          "includes": [
            "#include \"atomicio.h\"",
            "#include <limits.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#  include <sys/poll.h>",
            "#include <poll.h>",
            "#include <errno.h>",
            "#include <sys/uio.h>",
            "#include <sys/param.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"atomicio.h\"\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#  include <sys/poll.h>\n#include <poll.h>\n#include <errno.h>\n#include <sys/uio.h>\n#include <sys/param.h>\n#include \"includes.h\"\n\nsize_t\natomiciov(ssize_t (*f) (int, const struct iovec *, int), int fd,\n    const struct iovec *_iov, int iovcnt)\n{\n\treturn atomiciov6(f, fd, _iov, iovcnt, NULL, NULL);\n}"
        }
      },
      {
        "call_info": {
          "callee": "lseek",
          "args": [
            "fd",
            "-(off_t)sizeof(struct utmp)",
            "SEEK_END"
          ],
          "line": 1199
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fstat",
          "args": [
            "fd",
            "&st"
          ],
          "line": 1191
        },
        "resolved": true,
        "details": {
          "function_name": "fstatvfs",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/openbsd-compat/bsd-statvfs.c",
          "lines": "71-85",
          "snippet": "int fstatvfs(int fd, struct statvfs *buf)\n{\n#  ifdef HAVE_FSTATFS\n\tstruct statfs fs;\n\n\tmemset(&fs, 0, sizeof(fs));\n\tif (fstatfs(fd, &fs) == -1)\n\t\treturn -1;\n\tcopy_statfs_to_statvfs(buf, &fs);\n\treturn 0;\n#  else\n\terrno = ENOSYS;\n\treturn -1;\n#  endif\n}",
          "includes": [
            "#include <errno.h>",
            "# include <sys/mount.h>",
            "#include <sys/param.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <errno.h>\n# include <sys/mount.h>\n#include <sys/param.h>\n#include \"includes.h\"\n\nint fstatvfs(int fd, struct statvfs *buf)\n{\n#  ifdef HAVE_FSTATFS\n\tstruct statfs fs;\n\n\tmemset(&fs, 0, sizeof(fs));\n\tif (fstatfs(fd, &fs) == -1)\n\t\treturn -1;\n\tcopy_statfs_to_statvfs(buf, &fs);\n\treturn 0;\n#  else\n\terrno = ENOSYS;\n\treturn -1;\n#  endif\n}"
        }
      },
      {
        "call_info": {
          "callee": "open",
          "args": [
            "WTMP_FILE",
            "O_RDONLY"
          ],
          "line": 1186
        },
        "resolved": true,
        "details": {
          "function_name": "process_permitopen",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/servconf.c",
          "lines": "901-909",
          "snippet": "void\nprocess_permitopen(struct ssh *ssh, ServerOptions *options)\n{\n\tprocess_permitopen_list(ssh, sPermitOpen,\n\t    options->permitted_opens, options->num_permitted_opens);\n\tprocess_permitopen_list(ssh, sPermitListen,\n\t    options->permitted_listens,\n\t    options->num_permitted_listens);\n}",
          "includes": [
            "#include \"digest.h\"",
            "#include \"myproposal.h\"",
            "#include \"auth.h\"",
            "#include \"hostfile.h\"",
            "#include \"ssherr.h\"",
            "#include \"packet.h\"",
            "#include \"canohost.h\"",
            "#include \"groupaccess.h\"",
            "#include \"channels.h\"",
            "#include \"match.h\"",
            "#include \"mac.h\"",
            "#include \"kex.h\"",
            "#include \"sshkey.h\"",
            "#include \"cipher.h\"",
            "#include \"pathnames.h\"",
            "#include \"compat.h\"",
            "#include \"servconf.h\"",
            "#include \"misc.h\"",
            "#include \"sshbuf.h\"",
            "#include \"log.h\"",
            "#include \"ssh.h\"",
            "#include \"xmalloc.h\"",
            "#include \"openbsd-compat/sys-queue.h\"",
            "#include <util.h>",
            "#include <errno.h>",
            "#include <stdarg.h>",
            "#include <limits.h>",
            "#include <unistd.h>",
            "#include <signal.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <pwd.h>",
            "#include <netdb.h>",
            "#include <ctype.h>",
            "#include <net/route.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in_systm.h>",
            "#include <netinet/in.h>",
            "#include <sys/sysctl.h>",
            "#include <sys/socket.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static void add_listen_addr(ServerOptions *, const char *,\n    const char *, int);",
            "static void add_one_listen_addr(ServerOptions *, const char *,\n    const char *, int);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"digest.h\"\n#include \"myproposal.h\"\n#include \"auth.h\"\n#include \"hostfile.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"canohost.h\"\n#include \"groupaccess.h\"\n#include \"channels.h\"\n#include \"match.h\"\n#include \"mac.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"pathnames.h\"\n#include \"compat.h\"\n#include \"servconf.h\"\n#include \"misc.h\"\n#include \"sshbuf.h\"\n#include \"log.h\"\n#include \"ssh.h\"\n#include \"xmalloc.h\"\n#include \"openbsd-compat/sys-queue.h\"\n#include <util.h>\n#include <errno.h>\n#include <stdarg.h>\n#include <limits.h>\n#include <unistd.h>\n#include <signal.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <netdb.h>\n#include <ctype.h>\n#include <net/route.h>\n#include <netinet/ip.h>\n#include <netinet/in_systm.h>\n#include <netinet/in.h>\n#include <sys/sysctl.h>\n#include <sys/socket.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nstatic void add_listen_addr(ServerOptions *, const char *,\n    const char *, int);\nstatic void add_one_listen_addr(ServerOptions *, const char *,\n    const char *, int);\n\nvoid\nprocess_permitopen(struct ssh *ssh, ServerOptions *options)\n{\n\tprocess_permitopen_list(ssh, sPermitOpen,\n\t    options->permitted_opens, options->num_permitted_opens);\n\tprocess_permitopen_list(ssh, sPermitListen,\n\t    options->permitted_listens,\n\t    options->num_permitted_listens);\n}"
        }
      }
    ],
    "contextual_snippet": "# include <util.h>\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"auth.h\"\n#include \"canohost.h\"\n#include \"packet.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"loginrec.h\"\n#include \"ssh.h\"\n#include \"hostfile.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdarg.h>\n#include <pwd.h>\n# include <paths.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint utmp_write_entry(struct logininfo *li);\nint utmpx_write_entry(struct logininfo *li);\nint wtmp_write_entry(struct logininfo *li);\nint wtmpx_write_entry(struct logininfo *li);\nint lastlog_write_entry(struct logininfo *li);\nint syslogin_write_entry(struct logininfo *li);\nint getlast_entry(struct logininfo *li);\nint lastlog_get_entry(struct logininfo *li);\nint utmpx_get_entry(struct logininfo *li);\nint wtmp_get_entry(struct logininfo *li);\nint wtmpx_get_entry(struct logininfo *li);\n\nint\nwtmp_get_entry(struct logininfo *li)\n{\n\tstruct stat st;\n\tstruct utmp ut;\n\tint fd, found = 0;\n\n\t/* Clear the time entries in our logininfo */\n\tli->tv_sec = li->tv_usec = 0;\n\n\tif ((fd = open(WTMP_FILE, O_RDONLY)) < 0) {\n\t\tlogit(\"%s: problem opening %s: %s\", __func__,\n\t\t    WTMP_FILE, strerror(errno));\n\t\treturn (0);\n\t}\n\tif (fstat(fd, &st) != 0) {\n\t\tlogit(\"%s: couldn't stat %s: %s\", __func__,\n\t\t    WTMP_FILE, strerror(errno));\n\t\tclose(fd);\n\t\treturn (0);\n\t}\n\n\t/* Seek to the start of the last struct utmp */\n\tif (lseek(fd, -(off_t)sizeof(struct utmp), SEEK_END) == -1) {\n\t\t/* Looks like we've got a fresh wtmp file */\n\t\tclose(fd);\n\t\treturn (0);\n\t}\n\n\twhile (!found) {\n\t\tif (atomicio(read, fd, &ut, sizeof(ut)) != sizeof(ut)) {\n\t\t\tlogit(\"%s: read of %s failed: %s\", __func__,\n\t\t\t    WTMP_FILE, strerror(errno));\n\t\t\tclose (fd);\n\t\t\treturn (0);\n\t\t}\n\t\tif (wtmp_islogin(li, &ut) ) {\n\t\t\tfound = 1;\n\t\t\t/*\n\t\t\t * We've already checked for a time in struct\n\t\t\t * utmp, in login_getlast()\n\t\t\t */\n# ifdef HAVE_TIME_IN_UTMP\n\t\t\tli->tv_sec = ut.ut_time;\n# else\n#  if HAVE_TV_IN_UTMP\n\t\t\tli->tv_sec = ut.ut_tv.tv_sec;\n#  endif\n# endif\n\t\t\tline_fullname(li->line, ut.ut_line,\n\t\t\t    MIN_SIZEOF(li->line, ut.ut_line));\n# ifdef HAVE_HOST_IN_UTMP\n\t\t\tstrlcpy(li->hostname, ut.ut_host,\n\t\t\t    MIN_SIZEOF(li->hostname, ut.ut_host));\n# endif\n\t\t\tcontinue;\n\t\t}\n\t\t/* Seek back 2 x struct utmp */\n\t\tif (lseek(fd, -(off_t)(2 * sizeof(struct utmp)), SEEK_CUR) == -1) {\n\t\t\t/* We've found the start of the file, so quit */\n\t\t\tclose(fd);\n\t\t\treturn (0);\n\t\t}\n\t}\n\n\t/* We found an entry. Tidy up and return */\n\tclose(fd);\n\treturn (1);\n}"
  },
  {
    "function_name": "wtmp_islogin",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
    "lines": "1161-1174",
    "snippet": "static int\nwtmp_islogin(struct logininfo *li, struct utmp *ut)\n{\n\tif (strncmp(li->username, ut->ut_name,\n\t    MIN_SIZEOF(li->username, ut->ut_name)) == 0) {\n# ifdef HAVE_TYPE_IN_UTMP\n\t\tif (ut->ut_type & USER_PROCESS)\n\t\t\treturn (1);\n# else\n\t\treturn (1);\n# endif\n\t}\n\treturn (0);\n}",
    "includes": [
      "# include <util.h>",
      "#include \"ssherr.h\"",
      "#include \"sshbuf.h\"",
      "#include \"auth.h\"",
      "#include \"canohost.h\"",
      "#include \"packet.h\"",
      "#include \"atomicio.h\"",
      "#include \"log.h\"",
      "#include \"loginrec.h\"",
      "#include \"ssh.h\"",
      "#include \"hostfile.h\"",
      "#include \"sshkey.h\"",
      "#include \"xmalloc.h\"",
      "#include <unistd.h>",
      "#include <time.h>",
      "#include <string.h>",
      "#include <stdarg.h>",
      "#include <pwd.h>",
      "# include <paths.h>",
      "#include <fcntl.h>",
      "#include <errno.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "int utmp_write_entry(struct logininfo *li);",
      "int utmpx_write_entry(struct logininfo *li);",
      "int wtmp_write_entry(struct logininfo *li);",
      "int wtmpx_write_entry(struct logininfo *li);",
      "int lastlog_write_entry(struct logininfo *li);",
      "int syslogin_write_entry(struct logininfo *li);",
      "int getlast_entry(struct logininfo *li);",
      "int lastlog_get_entry(struct logininfo *li);",
      "int utmpx_get_entry(struct logininfo *li);",
      "int wtmp_get_entry(struct logininfo *li);",
      "int wtmpx_get_entry(struct logininfo *li);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "strncmp",
          "args": [
            "li->username",
            "ut->ut_name",
            "MIN_SIZEOF(li->username, ut->ut_name)"
          ],
          "line": 1164
        },
        "resolved": true,
        "details": {
          "function_name": "g_strncmp",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/openbsd-compat/glob.c",
          "lines": "422-435",
          "snippet": "static int\ng_strncmp(const Char *s1, const char *s2, size_t n)\n{\n\tint rv = 0;\n\n\twhile (n--) {\n\t\trv = *(Char *)s1 - *(const unsigned char *)s2++;\n\t\tif (rv)\n\t\t\tbreak;\n\t\tif (*s1++ == '\\0')\n\t\t\tbreak;\n\t}\n\treturn rv;\n}",
          "includes": [
            "#include \"charclass.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <pwd.h>",
            "#include <limits.h>",
            "#include <errno.h>",
            "#include <ctype.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include \"glob.h\"",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"charclass.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <pwd.h>\n#include <limits.h>\n#include <errno.h>\n#include <ctype.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"glob.h\"\n#include \"includes.h\"\n\nstatic int\ng_strncmp(const Char *s1, const char *s2, size_t n)\n{\n\tint rv = 0;\n\n\twhile (n--) {\n\t\trv = *(Char *)s1 - *(const unsigned char *)s2++;\n\t\tif (rv)\n\t\t\tbreak;\n\t\tif (*s1++ == '\\0')\n\t\t\tbreak;\n\t}\n\treturn rv;\n}"
        }
      },
      {
        "call_info": {
          "callee": "MIN_SIZEOF",
          "args": [
            "li->username",
            "ut->ut_name"
          ],
          "line": 1165
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "# include <util.h>\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"auth.h\"\n#include \"canohost.h\"\n#include \"packet.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"loginrec.h\"\n#include \"ssh.h\"\n#include \"hostfile.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdarg.h>\n#include <pwd.h>\n# include <paths.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint utmp_write_entry(struct logininfo *li);\nint utmpx_write_entry(struct logininfo *li);\nint wtmp_write_entry(struct logininfo *li);\nint wtmpx_write_entry(struct logininfo *li);\nint lastlog_write_entry(struct logininfo *li);\nint syslogin_write_entry(struct logininfo *li);\nint getlast_entry(struct logininfo *li);\nint lastlog_get_entry(struct logininfo *li);\nint utmpx_get_entry(struct logininfo *li);\nint wtmp_get_entry(struct logininfo *li);\nint wtmpx_get_entry(struct logininfo *li);\n\nstatic int\nwtmp_islogin(struct logininfo *li, struct utmp *ut)\n{\n\tif (strncmp(li->username, ut->ut_name,\n\t    MIN_SIZEOF(li->username, ut->ut_name)) == 0) {\n# ifdef HAVE_TYPE_IN_UTMP\n\t\tif (ut->ut_type & USER_PROCESS)\n\t\t\treturn (1);\n# else\n\t\treturn (1);\n# endif\n\t}\n\treturn (0);\n}"
  },
  {
    "function_name": "wtmp_write_entry",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
    "lines": "1128-1140",
    "snippet": "int\nwtmp_write_entry(struct logininfo *li)\n{\n\tswitch(li->type) {\n\tcase LTYPE_LOGIN:\n\t\treturn (wtmp_perform_login(li));\n\tcase LTYPE_LOGOUT:\n\t\treturn (wtmp_perform_logout(li));\n\tdefault:\n\t\tlogit(\"%s: invalid type field\", __func__);\n\t\treturn (0);\n\t}\n}",
    "includes": [
      "# include <util.h>",
      "#include \"ssherr.h\"",
      "#include \"sshbuf.h\"",
      "#include \"auth.h\"",
      "#include \"canohost.h\"",
      "#include \"packet.h\"",
      "#include \"atomicio.h\"",
      "#include \"log.h\"",
      "#include \"loginrec.h\"",
      "#include \"ssh.h\"",
      "#include \"hostfile.h\"",
      "#include \"sshkey.h\"",
      "#include \"xmalloc.h\"",
      "#include <unistd.h>",
      "#include <time.h>",
      "#include <string.h>",
      "#include <stdarg.h>",
      "#include <pwd.h>",
      "# include <paths.h>",
      "#include <fcntl.h>",
      "#include <errno.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "int utmp_write_entry(struct logininfo *li);",
      "int utmpx_write_entry(struct logininfo *li);",
      "int wtmp_write_entry(struct logininfo *li);",
      "int wtmpx_write_entry(struct logininfo *li);",
      "int lastlog_write_entry(struct logininfo *li);",
      "int syslogin_write_entry(struct logininfo *li);",
      "int getlast_entry(struct logininfo *li);",
      "int lastlog_get_entry(struct logininfo *li);",
      "int utmpx_get_entry(struct logininfo *li);",
      "int wtmp_get_entry(struct logininfo *li);",
      "int wtmpx_get_entry(struct logininfo *li);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "logit",
          "args": [
            "\"%s: invalid type field\"",
            "__func__"
          ],
          "line": 1137
        },
        "resolved": true,
        "details": {
          "function_name": "logit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/log.c",
          "lines": "198-206",
          "snippet": "void\nlogit(const char *fmt,...)\n{\n\tva_list args;\n\n\tva_start(args, fmt);\n\tdo_log(SYSLOG_LEVEL_INFO, fmt, args);\n\tva_end(args);\n}",
          "includes": [
            "#include \"log.h\"",
            "# include <vis.h>",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <syslog.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <fcntl.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n# include <vis.h>\n#include <errno.h>\n#include <unistd.h>\n#include <syslog.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <fcntl.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\nlogit(const char *fmt,...)\n{\n\tva_list args;\n\n\tva_start(args, fmt);\n\tdo_log(SYSLOG_LEVEL_INFO, fmt, args);\n\tva_end(args);\n}"
        }
      },
      {
        "call_info": {
          "callee": "wtmp_perform_logout",
          "args": [
            "li"
          ],
          "line": 1135
        },
        "resolved": true,
        "details": {
          "function_name": "wtmp_perform_logout",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
          "lines": "1118-1125",
          "snippet": "static int\nwtmp_perform_logout(struct logininfo *li)\n{\n\tstruct utmp ut;\n\n\tconstruct_utmp(li, &ut);\n\treturn (wtmp_write(li, &ut));\n}",
          "includes": [
            "# include <util.h>",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"auth.h\"",
            "#include \"canohost.h\"",
            "#include \"packet.h\"",
            "#include \"atomicio.h\"",
            "#include \"log.h\"",
            "#include \"loginrec.h\"",
            "#include \"ssh.h\"",
            "#include \"hostfile.h\"",
            "#include \"sshkey.h\"",
            "#include \"xmalloc.h\"",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <string.h>",
            "#include <stdarg.h>",
            "#include <pwd.h>",
            "# include <paths.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "int utmp_write_entry(struct logininfo *li);",
            "int utmpx_write_entry(struct logininfo *li);",
            "int wtmp_write_entry(struct logininfo *li);",
            "int wtmpx_write_entry(struct logininfo *li);",
            "int lastlog_write_entry(struct logininfo *li);",
            "int syslogin_write_entry(struct logininfo *li);",
            "int getlast_entry(struct logininfo *li);",
            "int lastlog_get_entry(struct logininfo *li);",
            "int utmpx_get_entry(struct logininfo *li);",
            "int wtmp_get_entry(struct logininfo *li);",
            "int wtmpx_get_entry(struct logininfo *li);"
          ],
          "called_functions": [],
          "contextual_snippet": "# include <util.h>\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"auth.h\"\n#include \"canohost.h\"\n#include \"packet.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"loginrec.h\"\n#include \"ssh.h\"\n#include \"hostfile.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdarg.h>\n#include <pwd.h>\n# include <paths.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint utmp_write_entry(struct logininfo *li);\nint utmpx_write_entry(struct logininfo *li);\nint wtmp_write_entry(struct logininfo *li);\nint wtmpx_write_entry(struct logininfo *li);\nint lastlog_write_entry(struct logininfo *li);\nint syslogin_write_entry(struct logininfo *li);\nint getlast_entry(struct logininfo *li);\nint lastlog_get_entry(struct logininfo *li);\nint utmpx_get_entry(struct logininfo *li);\nint wtmp_get_entry(struct logininfo *li);\nint wtmpx_get_entry(struct logininfo *li);\n\nstatic int\nwtmp_perform_logout(struct logininfo *li)\n{\n\tstruct utmp ut;\n\n\tconstruct_utmp(li, &ut);\n\treturn (wtmp_write(li, &ut));\n}"
        }
      },
      {
        "call_info": {
          "callee": "wtmp_perform_login",
          "args": [
            "li"
          ],
          "line": 1133
        },
        "resolved": true,
        "details": {
          "function_name": "wtmp_perform_login",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
          "lines": "1108-1115",
          "snippet": "static int\nwtmp_perform_login(struct logininfo *li)\n{\n\tstruct utmp ut;\n\n\tconstruct_utmp(li, &ut);\n\treturn (wtmp_write(li, &ut));\n}",
          "includes": [
            "# include <util.h>",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"auth.h\"",
            "#include \"canohost.h\"",
            "#include \"packet.h\"",
            "#include \"atomicio.h\"",
            "#include \"log.h\"",
            "#include \"loginrec.h\"",
            "#include \"ssh.h\"",
            "#include \"hostfile.h\"",
            "#include \"sshkey.h\"",
            "#include \"xmalloc.h\"",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <string.h>",
            "#include <stdarg.h>",
            "#include <pwd.h>",
            "# include <paths.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "int utmp_write_entry(struct logininfo *li);",
            "int utmpx_write_entry(struct logininfo *li);",
            "int wtmp_write_entry(struct logininfo *li);",
            "int wtmpx_write_entry(struct logininfo *li);",
            "int lastlog_write_entry(struct logininfo *li);",
            "int syslogin_write_entry(struct logininfo *li);",
            "int getlast_entry(struct logininfo *li);",
            "int lastlog_get_entry(struct logininfo *li);",
            "int utmpx_get_entry(struct logininfo *li);",
            "int wtmp_get_entry(struct logininfo *li);",
            "int wtmpx_get_entry(struct logininfo *li);"
          ],
          "called_functions": [],
          "contextual_snippet": "# include <util.h>\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"auth.h\"\n#include \"canohost.h\"\n#include \"packet.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"loginrec.h\"\n#include \"ssh.h\"\n#include \"hostfile.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdarg.h>\n#include <pwd.h>\n# include <paths.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint utmp_write_entry(struct logininfo *li);\nint utmpx_write_entry(struct logininfo *li);\nint wtmp_write_entry(struct logininfo *li);\nint wtmpx_write_entry(struct logininfo *li);\nint lastlog_write_entry(struct logininfo *li);\nint syslogin_write_entry(struct logininfo *li);\nint getlast_entry(struct logininfo *li);\nint lastlog_get_entry(struct logininfo *li);\nint utmpx_get_entry(struct logininfo *li);\nint wtmp_get_entry(struct logininfo *li);\nint wtmpx_get_entry(struct logininfo *li);\n\nstatic int\nwtmp_perform_login(struct logininfo *li)\n{\n\tstruct utmp ut;\n\n\tconstruct_utmp(li, &ut);\n\treturn (wtmp_write(li, &ut));\n}"
        }
      }
    ],
    "contextual_snippet": "# include <util.h>\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"auth.h\"\n#include \"canohost.h\"\n#include \"packet.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"loginrec.h\"\n#include \"ssh.h\"\n#include \"hostfile.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdarg.h>\n#include <pwd.h>\n# include <paths.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint utmp_write_entry(struct logininfo *li);\nint utmpx_write_entry(struct logininfo *li);\nint wtmp_write_entry(struct logininfo *li);\nint wtmpx_write_entry(struct logininfo *li);\nint lastlog_write_entry(struct logininfo *li);\nint syslogin_write_entry(struct logininfo *li);\nint getlast_entry(struct logininfo *li);\nint lastlog_get_entry(struct logininfo *li);\nint utmpx_get_entry(struct logininfo *li);\nint wtmp_get_entry(struct logininfo *li);\nint wtmpx_get_entry(struct logininfo *li);\n\nint\nwtmp_write_entry(struct logininfo *li)\n{\n\tswitch(li->type) {\n\tcase LTYPE_LOGIN:\n\t\treturn (wtmp_perform_login(li));\n\tcase LTYPE_LOGOUT:\n\t\treturn (wtmp_perform_logout(li));\n\tdefault:\n\t\tlogit(\"%s: invalid type field\", __func__);\n\t\treturn (0);\n\t}\n}"
  },
  {
    "function_name": "wtmp_perform_logout",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
    "lines": "1118-1125",
    "snippet": "static int\nwtmp_perform_logout(struct logininfo *li)\n{\n\tstruct utmp ut;\n\n\tconstruct_utmp(li, &ut);\n\treturn (wtmp_write(li, &ut));\n}",
    "includes": [
      "# include <util.h>",
      "#include \"ssherr.h\"",
      "#include \"sshbuf.h\"",
      "#include \"auth.h\"",
      "#include \"canohost.h\"",
      "#include \"packet.h\"",
      "#include \"atomicio.h\"",
      "#include \"log.h\"",
      "#include \"loginrec.h\"",
      "#include \"ssh.h\"",
      "#include \"hostfile.h\"",
      "#include \"sshkey.h\"",
      "#include \"xmalloc.h\"",
      "#include <unistd.h>",
      "#include <time.h>",
      "#include <string.h>",
      "#include <stdarg.h>",
      "#include <pwd.h>",
      "# include <paths.h>",
      "#include <fcntl.h>",
      "#include <errno.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "int utmp_write_entry(struct logininfo *li);",
      "int utmpx_write_entry(struct logininfo *li);",
      "int wtmp_write_entry(struct logininfo *li);",
      "int wtmpx_write_entry(struct logininfo *li);",
      "int lastlog_write_entry(struct logininfo *li);",
      "int syslogin_write_entry(struct logininfo *li);",
      "int getlast_entry(struct logininfo *li);",
      "int lastlog_get_entry(struct logininfo *li);",
      "int utmpx_get_entry(struct logininfo *li);",
      "int wtmp_get_entry(struct logininfo *li);",
      "int wtmpx_get_entry(struct logininfo *li);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "wtmp_write",
          "args": [
            "li",
            "&ut"
          ],
          "line": 1124
        },
        "resolved": true,
        "details": {
          "function_name": "wtmp_write",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
          "lines": "1086-1106",
          "snippet": "static int\nwtmp_write(struct logininfo *li, struct utmp *ut)\n{\n\tstruct stat buf;\n\tint fd, ret = 1;\n\n\tif ((fd = open(WTMP_FILE, O_WRONLY|O_APPEND, 0)) < 0) {\n\t\tlogit(\"%s: problem writing %s: %s\", __func__,\n\t\t    WTMP_FILE, strerror(errno));\n\t\treturn (0);\n\t}\n\tif (fstat(fd, &buf) == 0)\n\t\tif (atomicio(vwrite, fd, ut, sizeof(*ut)) != sizeof(*ut)) {\n\t\t\tftruncate(fd, buf.st_size);\n\t\t\tlogit(\"%s: problem writing %s: %s\", __func__,\n\t\t\t    WTMP_FILE, strerror(errno));\n\t\t\tret = 0;\n\t\t}\n\tclose(fd);\n\treturn (ret);\n}",
          "includes": [
            "# include <util.h>",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"auth.h\"",
            "#include \"canohost.h\"",
            "#include \"packet.h\"",
            "#include \"atomicio.h\"",
            "#include \"log.h\"",
            "#include \"loginrec.h\"",
            "#include \"ssh.h\"",
            "#include \"hostfile.h\"",
            "#include \"sshkey.h\"",
            "#include \"xmalloc.h\"",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <string.h>",
            "#include <stdarg.h>",
            "#include <pwd.h>",
            "# include <paths.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "int utmp_write_entry(struct logininfo *li);",
            "int utmpx_write_entry(struct logininfo *li);",
            "int wtmp_write_entry(struct logininfo *li);",
            "int wtmpx_write_entry(struct logininfo *li);",
            "int lastlog_write_entry(struct logininfo *li);",
            "int syslogin_write_entry(struct logininfo *li);",
            "int getlast_entry(struct logininfo *li);",
            "int lastlog_get_entry(struct logininfo *li);",
            "int utmpx_get_entry(struct logininfo *li);",
            "int wtmp_get_entry(struct logininfo *li);",
            "int wtmpx_get_entry(struct logininfo *li);"
          ],
          "called_functions": [],
          "contextual_snippet": "# include <util.h>\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"auth.h\"\n#include \"canohost.h\"\n#include \"packet.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"loginrec.h\"\n#include \"ssh.h\"\n#include \"hostfile.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdarg.h>\n#include <pwd.h>\n# include <paths.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint utmp_write_entry(struct logininfo *li);\nint utmpx_write_entry(struct logininfo *li);\nint wtmp_write_entry(struct logininfo *li);\nint wtmpx_write_entry(struct logininfo *li);\nint lastlog_write_entry(struct logininfo *li);\nint syslogin_write_entry(struct logininfo *li);\nint getlast_entry(struct logininfo *li);\nint lastlog_get_entry(struct logininfo *li);\nint utmpx_get_entry(struct logininfo *li);\nint wtmp_get_entry(struct logininfo *li);\nint wtmpx_get_entry(struct logininfo *li);\n\nstatic int\nwtmp_write(struct logininfo *li, struct utmp *ut)\n{\n\tstruct stat buf;\n\tint fd, ret = 1;\n\n\tif ((fd = open(WTMP_FILE, O_WRONLY|O_APPEND, 0)) < 0) {\n\t\tlogit(\"%s: problem writing %s: %s\", __func__,\n\t\t    WTMP_FILE, strerror(errno));\n\t\treturn (0);\n\t}\n\tif (fstat(fd, &buf) == 0)\n\t\tif (atomicio(vwrite, fd, ut, sizeof(*ut)) != sizeof(*ut)) {\n\t\t\tftruncate(fd, buf.st_size);\n\t\t\tlogit(\"%s: problem writing %s: %s\", __func__,\n\t\t\t    WTMP_FILE, strerror(errno));\n\t\t\tret = 0;\n\t\t}\n\tclose(fd);\n\treturn (ret);\n}"
        }
      },
      {
        "call_info": {
          "callee": "construct_utmp",
          "args": [
            "li",
            "&ut"
          ],
          "line": 1123
        },
        "resolved": true,
        "details": {
          "function_name": "construct_utmpx",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
          "lines": "738-801",
          "snippet": "void\nconstruct_utmpx(struct logininfo *li, struct utmpx *utx)\n{\n# ifdef HAVE_ADDR_V6_IN_UTMP\n\tstruct sockaddr_in6 *sa6;\n#  endif\n\tmemset(utx, '\\0', sizeof(*utx));\n\n# ifdef HAVE_ID_IN_UTMPX\n\tline_abbrevname(utx->ut_id, li->line, sizeof(utx->ut_id));\n# endif\n\n\t/* this is done here to keep utmp constants out of loginrec.h */\n\tswitch (li->type) {\n\tcase LTYPE_LOGIN:\n\t\tutx->ut_type = USER_PROCESS;\n\t\tbreak;\n\tcase LTYPE_LOGOUT:\n\t\tutx->ut_type = DEAD_PROCESS;\n\t\tbreak;\n\t}\n\tline_stripname(utx->ut_line, li->line, sizeof(utx->ut_line));\n\tset_utmpx_time(li, utx);\n\tutx->ut_pid = li->pid;\n\n\t/* strncpy(): Don't necessarily want null termination */\n\tstrncpy(utx->ut_user, li->username,\n\t    MIN_SIZEOF(utx->ut_user, li->username));\n\n\tif (li->type == LTYPE_LOGOUT)\n\t\treturn;\n\n\t/*\n\t * These fields are only used when logging in, and are blank\n\t * for logouts.\n\t */\n\n# ifdef HAVE_HOST_IN_UTMPX\n\tstrncpy(utx->ut_host, li->hostname,\n\t    MIN_SIZEOF(utx->ut_host, li->hostname));\n# endif\n# ifdef HAVE_ADDR_IN_UTMPX\n\t/* this is just a 32-bit IP address */\n\tif (li->hostaddr.sa.sa_family == AF_INET)\n\t\tutx->ut_addr = li->hostaddr.sa_in.sin_addr.s_addr;\n# endif\n# ifdef HAVE_ADDR_V6_IN_UTMP\n\t/* this is just a 128-bit IPv6 address */\n\tif (li->hostaddr.sa.sa_family == AF_INET6) {\n\t\tsa6 = ((struct sockaddr_in6 *)&li->hostaddr.sa);\n\t\tmemcpy(utx->ut_addr_v6, sa6->sin6_addr.s6_addr, 16);\n\t\tif (IN6_IS_ADDR_V4MAPPED(&sa6->sin6_addr)) {\n\t\t\tutx->ut_addr_v6[0] = utx->ut_addr_v6[3];\n\t\t\tutx->ut_addr_v6[1] = 0;\n\t\t\tutx->ut_addr_v6[2] = 0;\n\t\t\tutx->ut_addr_v6[3] = 0;\n\t\t}\n\t}\n# endif\n# ifdef HAVE_SYSLEN_IN_UTMPX\n\t/* ut_syslen is the length of the utx_host string */\n\tutx->ut_syslen = MIN(strlen(li->hostname), sizeof(utx->ut_host));\n# endif\n}",
          "includes": [
            "# include <util.h>",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"auth.h\"",
            "#include \"canohost.h\"",
            "#include \"packet.h\"",
            "#include \"atomicio.h\"",
            "#include \"log.h\"",
            "#include \"loginrec.h\"",
            "#include \"ssh.h\"",
            "#include \"hostfile.h\"",
            "#include \"sshkey.h\"",
            "#include \"xmalloc.h\"",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <string.h>",
            "#include <stdarg.h>",
            "#include <pwd.h>",
            "# include <paths.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "int utmp_write_entry(struct logininfo *li);",
            "int utmpx_write_entry(struct logininfo *li);",
            "int wtmp_write_entry(struct logininfo *li);",
            "int wtmpx_write_entry(struct logininfo *li);",
            "int lastlog_write_entry(struct logininfo *li);",
            "int syslogin_write_entry(struct logininfo *li);",
            "int getlast_entry(struct logininfo *li);",
            "int lastlog_get_entry(struct logininfo *li);",
            "int utmpx_get_entry(struct logininfo *li);",
            "int wtmp_get_entry(struct logininfo *li);",
            "int wtmpx_get_entry(struct logininfo *li);"
          ],
          "called_functions": [],
          "contextual_snippet": "# include <util.h>\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"auth.h\"\n#include \"canohost.h\"\n#include \"packet.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"loginrec.h\"\n#include \"ssh.h\"\n#include \"hostfile.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdarg.h>\n#include <pwd.h>\n# include <paths.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint utmp_write_entry(struct logininfo *li);\nint utmpx_write_entry(struct logininfo *li);\nint wtmp_write_entry(struct logininfo *li);\nint wtmpx_write_entry(struct logininfo *li);\nint lastlog_write_entry(struct logininfo *li);\nint syslogin_write_entry(struct logininfo *li);\nint getlast_entry(struct logininfo *li);\nint lastlog_get_entry(struct logininfo *li);\nint utmpx_get_entry(struct logininfo *li);\nint wtmp_get_entry(struct logininfo *li);\nint wtmpx_get_entry(struct logininfo *li);\n\nvoid\nconstruct_utmpx(struct logininfo *li, struct utmpx *utx)\n{\n# ifdef HAVE_ADDR_V6_IN_UTMP\n\tstruct sockaddr_in6 *sa6;\n#  endif\n\tmemset(utx, '\\0', sizeof(*utx));\n\n# ifdef HAVE_ID_IN_UTMPX\n\tline_abbrevname(utx->ut_id, li->line, sizeof(utx->ut_id));\n# endif\n\n\t/* this is done here to keep utmp constants out of loginrec.h */\n\tswitch (li->type) {\n\tcase LTYPE_LOGIN:\n\t\tutx->ut_type = USER_PROCESS;\n\t\tbreak;\n\tcase LTYPE_LOGOUT:\n\t\tutx->ut_type = DEAD_PROCESS;\n\t\tbreak;\n\t}\n\tline_stripname(utx->ut_line, li->line, sizeof(utx->ut_line));\n\tset_utmpx_time(li, utx);\n\tutx->ut_pid = li->pid;\n\n\t/* strncpy(): Don't necessarily want null termination */\n\tstrncpy(utx->ut_user, li->username,\n\t    MIN_SIZEOF(utx->ut_user, li->username));\n\n\tif (li->type == LTYPE_LOGOUT)\n\t\treturn;\n\n\t/*\n\t * These fields are only used when logging in, and are blank\n\t * for logouts.\n\t */\n\n# ifdef HAVE_HOST_IN_UTMPX\n\tstrncpy(utx->ut_host, li->hostname,\n\t    MIN_SIZEOF(utx->ut_host, li->hostname));\n# endif\n# ifdef HAVE_ADDR_IN_UTMPX\n\t/* this is just a 32-bit IP address */\n\tif (li->hostaddr.sa.sa_family == AF_INET)\n\t\tutx->ut_addr = li->hostaddr.sa_in.sin_addr.s_addr;\n# endif\n# ifdef HAVE_ADDR_V6_IN_UTMP\n\t/* this is just a 128-bit IPv6 address */\n\tif (li->hostaddr.sa.sa_family == AF_INET6) {\n\t\tsa6 = ((struct sockaddr_in6 *)&li->hostaddr.sa);\n\t\tmemcpy(utx->ut_addr_v6, sa6->sin6_addr.s6_addr, 16);\n\t\tif (IN6_IS_ADDR_V4MAPPED(&sa6->sin6_addr)) {\n\t\t\tutx->ut_addr_v6[0] = utx->ut_addr_v6[3];\n\t\t\tutx->ut_addr_v6[1] = 0;\n\t\t\tutx->ut_addr_v6[2] = 0;\n\t\t\tutx->ut_addr_v6[3] = 0;\n\t\t}\n\t}\n# endif\n# ifdef HAVE_SYSLEN_IN_UTMPX\n\t/* ut_syslen is the length of the utx_host string */\n\tutx->ut_syslen = MIN(strlen(li->hostname), sizeof(utx->ut_host));\n# endif\n}"
        }
      }
    ],
    "contextual_snippet": "# include <util.h>\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"auth.h\"\n#include \"canohost.h\"\n#include \"packet.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"loginrec.h\"\n#include \"ssh.h\"\n#include \"hostfile.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdarg.h>\n#include <pwd.h>\n# include <paths.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint utmp_write_entry(struct logininfo *li);\nint utmpx_write_entry(struct logininfo *li);\nint wtmp_write_entry(struct logininfo *li);\nint wtmpx_write_entry(struct logininfo *li);\nint lastlog_write_entry(struct logininfo *li);\nint syslogin_write_entry(struct logininfo *li);\nint getlast_entry(struct logininfo *li);\nint lastlog_get_entry(struct logininfo *li);\nint utmpx_get_entry(struct logininfo *li);\nint wtmp_get_entry(struct logininfo *li);\nint wtmpx_get_entry(struct logininfo *li);\n\nstatic int\nwtmp_perform_logout(struct logininfo *li)\n{\n\tstruct utmp ut;\n\n\tconstruct_utmp(li, &ut);\n\treturn (wtmp_write(li, &ut));\n}"
  },
  {
    "function_name": "wtmp_perform_login",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
    "lines": "1108-1115",
    "snippet": "static int\nwtmp_perform_login(struct logininfo *li)\n{\n\tstruct utmp ut;\n\n\tconstruct_utmp(li, &ut);\n\treturn (wtmp_write(li, &ut));\n}",
    "includes": [
      "# include <util.h>",
      "#include \"ssherr.h\"",
      "#include \"sshbuf.h\"",
      "#include \"auth.h\"",
      "#include \"canohost.h\"",
      "#include \"packet.h\"",
      "#include \"atomicio.h\"",
      "#include \"log.h\"",
      "#include \"loginrec.h\"",
      "#include \"ssh.h\"",
      "#include \"hostfile.h\"",
      "#include \"sshkey.h\"",
      "#include \"xmalloc.h\"",
      "#include <unistd.h>",
      "#include <time.h>",
      "#include <string.h>",
      "#include <stdarg.h>",
      "#include <pwd.h>",
      "# include <paths.h>",
      "#include <fcntl.h>",
      "#include <errno.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "int utmp_write_entry(struct logininfo *li);",
      "int utmpx_write_entry(struct logininfo *li);",
      "int wtmp_write_entry(struct logininfo *li);",
      "int wtmpx_write_entry(struct logininfo *li);",
      "int lastlog_write_entry(struct logininfo *li);",
      "int syslogin_write_entry(struct logininfo *li);",
      "int getlast_entry(struct logininfo *li);",
      "int lastlog_get_entry(struct logininfo *li);",
      "int utmpx_get_entry(struct logininfo *li);",
      "int wtmp_get_entry(struct logininfo *li);",
      "int wtmpx_get_entry(struct logininfo *li);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "wtmp_write",
          "args": [
            "li",
            "&ut"
          ],
          "line": 1114
        },
        "resolved": true,
        "details": {
          "function_name": "wtmp_write",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
          "lines": "1086-1106",
          "snippet": "static int\nwtmp_write(struct logininfo *li, struct utmp *ut)\n{\n\tstruct stat buf;\n\tint fd, ret = 1;\n\n\tif ((fd = open(WTMP_FILE, O_WRONLY|O_APPEND, 0)) < 0) {\n\t\tlogit(\"%s: problem writing %s: %s\", __func__,\n\t\t    WTMP_FILE, strerror(errno));\n\t\treturn (0);\n\t}\n\tif (fstat(fd, &buf) == 0)\n\t\tif (atomicio(vwrite, fd, ut, sizeof(*ut)) != sizeof(*ut)) {\n\t\t\tftruncate(fd, buf.st_size);\n\t\t\tlogit(\"%s: problem writing %s: %s\", __func__,\n\t\t\t    WTMP_FILE, strerror(errno));\n\t\t\tret = 0;\n\t\t}\n\tclose(fd);\n\treturn (ret);\n}",
          "includes": [
            "# include <util.h>",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"auth.h\"",
            "#include \"canohost.h\"",
            "#include \"packet.h\"",
            "#include \"atomicio.h\"",
            "#include \"log.h\"",
            "#include \"loginrec.h\"",
            "#include \"ssh.h\"",
            "#include \"hostfile.h\"",
            "#include \"sshkey.h\"",
            "#include \"xmalloc.h\"",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <string.h>",
            "#include <stdarg.h>",
            "#include <pwd.h>",
            "# include <paths.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "int utmp_write_entry(struct logininfo *li);",
            "int utmpx_write_entry(struct logininfo *li);",
            "int wtmp_write_entry(struct logininfo *li);",
            "int wtmpx_write_entry(struct logininfo *li);",
            "int lastlog_write_entry(struct logininfo *li);",
            "int syslogin_write_entry(struct logininfo *li);",
            "int getlast_entry(struct logininfo *li);",
            "int lastlog_get_entry(struct logininfo *li);",
            "int utmpx_get_entry(struct logininfo *li);",
            "int wtmp_get_entry(struct logininfo *li);",
            "int wtmpx_get_entry(struct logininfo *li);"
          ],
          "called_functions": [],
          "contextual_snippet": "# include <util.h>\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"auth.h\"\n#include \"canohost.h\"\n#include \"packet.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"loginrec.h\"\n#include \"ssh.h\"\n#include \"hostfile.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdarg.h>\n#include <pwd.h>\n# include <paths.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint utmp_write_entry(struct logininfo *li);\nint utmpx_write_entry(struct logininfo *li);\nint wtmp_write_entry(struct logininfo *li);\nint wtmpx_write_entry(struct logininfo *li);\nint lastlog_write_entry(struct logininfo *li);\nint syslogin_write_entry(struct logininfo *li);\nint getlast_entry(struct logininfo *li);\nint lastlog_get_entry(struct logininfo *li);\nint utmpx_get_entry(struct logininfo *li);\nint wtmp_get_entry(struct logininfo *li);\nint wtmpx_get_entry(struct logininfo *li);\n\nstatic int\nwtmp_write(struct logininfo *li, struct utmp *ut)\n{\n\tstruct stat buf;\n\tint fd, ret = 1;\n\n\tif ((fd = open(WTMP_FILE, O_WRONLY|O_APPEND, 0)) < 0) {\n\t\tlogit(\"%s: problem writing %s: %s\", __func__,\n\t\t    WTMP_FILE, strerror(errno));\n\t\treturn (0);\n\t}\n\tif (fstat(fd, &buf) == 0)\n\t\tif (atomicio(vwrite, fd, ut, sizeof(*ut)) != sizeof(*ut)) {\n\t\t\tftruncate(fd, buf.st_size);\n\t\t\tlogit(\"%s: problem writing %s: %s\", __func__,\n\t\t\t    WTMP_FILE, strerror(errno));\n\t\t\tret = 0;\n\t\t}\n\tclose(fd);\n\treturn (ret);\n}"
        }
      },
      {
        "call_info": {
          "callee": "construct_utmp",
          "args": [
            "li",
            "&ut"
          ],
          "line": 1113
        },
        "resolved": true,
        "details": {
          "function_name": "construct_utmpx",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
          "lines": "738-801",
          "snippet": "void\nconstruct_utmpx(struct logininfo *li, struct utmpx *utx)\n{\n# ifdef HAVE_ADDR_V6_IN_UTMP\n\tstruct sockaddr_in6 *sa6;\n#  endif\n\tmemset(utx, '\\0', sizeof(*utx));\n\n# ifdef HAVE_ID_IN_UTMPX\n\tline_abbrevname(utx->ut_id, li->line, sizeof(utx->ut_id));\n# endif\n\n\t/* this is done here to keep utmp constants out of loginrec.h */\n\tswitch (li->type) {\n\tcase LTYPE_LOGIN:\n\t\tutx->ut_type = USER_PROCESS;\n\t\tbreak;\n\tcase LTYPE_LOGOUT:\n\t\tutx->ut_type = DEAD_PROCESS;\n\t\tbreak;\n\t}\n\tline_stripname(utx->ut_line, li->line, sizeof(utx->ut_line));\n\tset_utmpx_time(li, utx);\n\tutx->ut_pid = li->pid;\n\n\t/* strncpy(): Don't necessarily want null termination */\n\tstrncpy(utx->ut_user, li->username,\n\t    MIN_SIZEOF(utx->ut_user, li->username));\n\n\tif (li->type == LTYPE_LOGOUT)\n\t\treturn;\n\n\t/*\n\t * These fields are only used when logging in, and are blank\n\t * for logouts.\n\t */\n\n# ifdef HAVE_HOST_IN_UTMPX\n\tstrncpy(utx->ut_host, li->hostname,\n\t    MIN_SIZEOF(utx->ut_host, li->hostname));\n# endif\n# ifdef HAVE_ADDR_IN_UTMPX\n\t/* this is just a 32-bit IP address */\n\tif (li->hostaddr.sa.sa_family == AF_INET)\n\t\tutx->ut_addr = li->hostaddr.sa_in.sin_addr.s_addr;\n# endif\n# ifdef HAVE_ADDR_V6_IN_UTMP\n\t/* this is just a 128-bit IPv6 address */\n\tif (li->hostaddr.sa.sa_family == AF_INET6) {\n\t\tsa6 = ((struct sockaddr_in6 *)&li->hostaddr.sa);\n\t\tmemcpy(utx->ut_addr_v6, sa6->sin6_addr.s6_addr, 16);\n\t\tif (IN6_IS_ADDR_V4MAPPED(&sa6->sin6_addr)) {\n\t\t\tutx->ut_addr_v6[0] = utx->ut_addr_v6[3];\n\t\t\tutx->ut_addr_v6[1] = 0;\n\t\t\tutx->ut_addr_v6[2] = 0;\n\t\t\tutx->ut_addr_v6[3] = 0;\n\t\t}\n\t}\n# endif\n# ifdef HAVE_SYSLEN_IN_UTMPX\n\t/* ut_syslen is the length of the utx_host string */\n\tutx->ut_syslen = MIN(strlen(li->hostname), sizeof(utx->ut_host));\n# endif\n}",
          "includes": [
            "# include <util.h>",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"auth.h\"",
            "#include \"canohost.h\"",
            "#include \"packet.h\"",
            "#include \"atomicio.h\"",
            "#include \"log.h\"",
            "#include \"loginrec.h\"",
            "#include \"ssh.h\"",
            "#include \"hostfile.h\"",
            "#include \"sshkey.h\"",
            "#include \"xmalloc.h\"",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <string.h>",
            "#include <stdarg.h>",
            "#include <pwd.h>",
            "# include <paths.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "int utmp_write_entry(struct logininfo *li);",
            "int utmpx_write_entry(struct logininfo *li);",
            "int wtmp_write_entry(struct logininfo *li);",
            "int wtmpx_write_entry(struct logininfo *li);",
            "int lastlog_write_entry(struct logininfo *li);",
            "int syslogin_write_entry(struct logininfo *li);",
            "int getlast_entry(struct logininfo *li);",
            "int lastlog_get_entry(struct logininfo *li);",
            "int utmpx_get_entry(struct logininfo *li);",
            "int wtmp_get_entry(struct logininfo *li);",
            "int wtmpx_get_entry(struct logininfo *li);"
          ],
          "called_functions": [],
          "contextual_snippet": "# include <util.h>\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"auth.h\"\n#include \"canohost.h\"\n#include \"packet.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"loginrec.h\"\n#include \"ssh.h\"\n#include \"hostfile.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdarg.h>\n#include <pwd.h>\n# include <paths.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint utmp_write_entry(struct logininfo *li);\nint utmpx_write_entry(struct logininfo *li);\nint wtmp_write_entry(struct logininfo *li);\nint wtmpx_write_entry(struct logininfo *li);\nint lastlog_write_entry(struct logininfo *li);\nint syslogin_write_entry(struct logininfo *li);\nint getlast_entry(struct logininfo *li);\nint lastlog_get_entry(struct logininfo *li);\nint utmpx_get_entry(struct logininfo *li);\nint wtmp_get_entry(struct logininfo *li);\nint wtmpx_get_entry(struct logininfo *li);\n\nvoid\nconstruct_utmpx(struct logininfo *li, struct utmpx *utx)\n{\n# ifdef HAVE_ADDR_V6_IN_UTMP\n\tstruct sockaddr_in6 *sa6;\n#  endif\n\tmemset(utx, '\\0', sizeof(*utx));\n\n# ifdef HAVE_ID_IN_UTMPX\n\tline_abbrevname(utx->ut_id, li->line, sizeof(utx->ut_id));\n# endif\n\n\t/* this is done here to keep utmp constants out of loginrec.h */\n\tswitch (li->type) {\n\tcase LTYPE_LOGIN:\n\t\tutx->ut_type = USER_PROCESS;\n\t\tbreak;\n\tcase LTYPE_LOGOUT:\n\t\tutx->ut_type = DEAD_PROCESS;\n\t\tbreak;\n\t}\n\tline_stripname(utx->ut_line, li->line, sizeof(utx->ut_line));\n\tset_utmpx_time(li, utx);\n\tutx->ut_pid = li->pid;\n\n\t/* strncpy(): Don't necessarily want null termination */\n\tstrncpy(utx->ut_user, li->username,\n\t    MIN_SIZEOF(utx->ut_user, li->username));\n\n\tif (li->type == LTYPE_LOGOUT)\n\t\treturn;\n\n\t/*\n\t * These fields are only used when logging in, and are blank\n\t * for logouts.\n\t */\n\n# ifdef HAVE_HOST_IN_UTMPX\n\tstrncpy(utx->ut_host, li->hostname,\n\t    MIN_SIZEOF(utx->ut_host, li->hostname));\n# endif\n# ifdef HAVE_ADDR_IN_UTMPX\n\t/* this is just a 32-bit IP address */\n\tif (li->hostaddr.sa.sa_family == AF_INET)\n\t\tutx->ut_addr = li->hostaddr.sa_in.sin_addr.s_addr;\n# endif\n# ifdef HAVE_ADDR_V6_IN_UTMP\n\t/* this is just a 128-bit IPv6 address */\n\tif (li->hostaddr.sa.sa_family == AF_INET6) {\n\t\tsa6 = ((struct sockaddr_in6 *)&li->hostaddr.sa);\n\t\tmemcpy(utx->ut_addr_v6, sa6->sin6_addr.s6_addr, 16);\n\t\tif (IN6_IS_ADDR_V4MAPPED(&sa6->sin6_addr)) {\n\t\t\tutx->ut_addr_v6[0] = utx->ut_addr_v6[3];\n\t\t\tutx->ut_addr_v6[1] = 0;\n\t\t\tutx->ut_addr_v6[2] = 0;\n\t\t\tutx->ut_addr_v6[3] = 0;\n\t\t}\n\t}\n# endif\n# ifdef HAVE_SYSLEN_IN_UTMPX\n\t/* ut_syslen is the length of the utx_host string */\n\tutx->ut_syslen = MIN(strlen(li->hostname), sizeof(utx->ut_host));\n# endif\n}"
        }
      }
    ],
    "contextual_snippet": "# include <util.h>\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"auth.h\"\n#include \"canohost.h\"\n#include \"packet.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"loginrec.h\"\n#include \"ssh.h\"\n#include \"hostfile.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdarg.h>\n#include <pwd.h>\n# include <paths.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint utmp_write_entry(struct logininfo *li);\nint utmpx_write_entry(struct logininfo *li);\nint wtmp_write_entry(struct logininfo *li);\nint wtmpx_write_entry(struct logininfo *li);\nint lastlog_write_entry(struct logininfo *li);\nint syslogin_write_entry(struct logininfo *li);\nint getlast_entry(struct logininfo *li);\nint lastlog_get_entry(struct logininfo *li);\nint utmpx_get_entry(struct logininfo *li);\nint wtmp_get_entry(struct logininfo *li);\nint wtmpx_get_entry(struct logininfo *li);\n\nstatic int\nwtmp_perform_login(struct logininfo *li)\n{\n\tstruct utmp ut;\n\n\tconstruct_utmp(li, &ut);\n\treturn (wtmp_write(li, &ut));\n}"
  },
  {
    "function_name": "wtmp_write",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
    "lines": "1086-1106",
    "snippet": "static int\nwtmp_write(struct logininfo *li, struct utmp *ut)\n{\n\tstruct stat buf;\n\tint fd, ret = 1;\n\n\tif ((fd = open(WTMP_FILE, O_WRONLY|O_APPEND, 0)) < 0) {\n\t\tlogit(\"%s: problem writing %s: %s\", __func__,\n\t\t    WTMP_FILE, strerror(errno));\n\t\treturn (0);\n\t}\n\tif (fstat(fd, &buf) == 0)\n\t\tif (atomicio(vwrite, fd, ut, sizeof(*ut)) != sizeof(*ut)) {\n\t\t\tftruncate(fd, buf.st_size);\n\t\t\tlogit(\"%s: problem writing %s: %s\", __func__,\n\t\t\t    WTMP_FILE, strerror(errno));\n\t\t\tret = 0;\n\t\t}\n\tclose(fd);\n\treturn (ret);\n}",
    "includes": [
      "# include <util.h>",
      "#include \"ssherr.h\"",
      "#include \"sshbuf.h\"",
      "#include \"auth.h\"",
      "#include \"canohost.h\"",
      "#include \"packet.h\"",
      "#include \"atomicio.h\"",
      "#include \"log.h\"",
      "#include \"loginrec.h\"",
      "#include \"ssh.h\"",
      "#include \"hostfile.h\"",
      "#include \"sshkey.h\"",
      "#include \"xmalloc.h\"",
      "#include <unistd.h>",
      "#include <time.h>",
      "#include <string.h>",
      "#include <stdarg.h>",
      "#include <pwd.h>",
      "# include <paths.h>",
      "#include <fcntl.h>",
      "#include <errno.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "int utmp_write_entry(struct logininfo *li);",
      "int utmpx_write_entry(struct logininfo *li);",
      "int wtmp_write_entry(struct logininfo *li);",
      "int wtmpx_write_entry(struct logininfo *li);",
      "int lastlog_write_entry(struct logininfo *li);",
      "int syslogin_write_entry(struct logininfo *li);",
      "int getlast_entry(struct logininfo *li);",
      "int lastlog_get_entry(struct logininfo *li);",
      "int utmpx_get_entry(struct logininfo *li);",
      "int wtmp_get_entry(struct logininfo *li);",
      "int wtmpx_get_entry(struct logininfo *li);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "close",
          "args": [
            "fd"
          ],
          "line": 1104
        },
        "resolved": true,
        "details": {
          "function_name": "ssh_close_authentication_socket",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/authfd.c",
          "lines": "171-176",
          "snippet": "void\nssh_close_authentication_socket(int sock)\n{\n\tif (getenv(SSH_AUTHSOCKET_ENV_NAME))\n\t\tclose(sock);\n}",
          "includes": [
            "#include \"ssherr.h\"",
            "#include \"misc.h\"",
            "#include \"atomicio.h\"",
            "#include \"log.h\"",
            "#include \"compat.h\"",
            "#include \"cipher.h\"",
            "#include \"authfd.h\"",
            "#include \"sshkey.h\"",
            "#include \"sshbuf.h\"",
            "#include \"ssh.h\"",
            "#include \"xmalloc.h\"",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "#include <stdlib.h>",
            "#include <fcntl.h>",
            "#include <sys/socket.h>",
            "#include <sys/un.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"ssherr.h\"\n#include \"misc.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"compat.h\"\n#include \"cipher.h\"\n#include \"authfd.h\"\n#include \"sshkey.h\"\n#include \"sshbuf.h\"\n#include \"ssh.h\"\n#include \"xmalloc.h\"\n#include <errno.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdarg.h>\n#include <signal.h>\n#include <stdlib.h>\n#include <fcntl.h>\n#include <sys/socket.h>\n#include <sys/un.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\nssh_close_authentication_socket(int sock)\n{\n\tif (getenv(SSH_AUTHSOCKET_ENV_NAME))\n\t\tclose(sock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "logit",
          "args": [
            "\"%s: problem writing %s: %s\"",
            "__func__",
            "WTMP_FILE",
            "strerror(errno)"
          ],
          "line": 1100
        },
        "resolved": true,
        "details": {
          "function_name": "logit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/log.c",
          "lines": "198-206",
          "snippet": "void\nlogit(const char *fmt,...)\n{\n\tva_list args;\n\n\tva_start(args, fmt);\n\tdo_log(SYSLOG_LEVEL_INFO, fmt, args);\n\tva_end(args);\n}",
          "includes": [
            "#include \"log.h\"",
            "# include <vis.h>",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <syslog.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <fcntl.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n# include <vis.h>\n#include <errno.h>\n#include <unistd.h>\n#include <syslog.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <fcntl.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\nlogit(const char *fmt,...)\n{\n\tva_list args;\n\n\tva_start(args, fmt);\n\tdo_log(SYSLOG_LEVEL_INFO, fmt, args);\n\tva_end(args);\n}"
        }
      },
      {
        "call_info": {
          "callee": "strerror",
          "args": [
            "errno"
          ],
          "line": 1101
        },
        "resolved": true,
        "details": {
          "function_name": "ssh_gai_strerror",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/misc.c",
          "lines": "140-146",
          "snippet": "const char *\nssh_gai_strerror(int gaierr)\n{\n\tif (gaierr == EAI_SYSTEM && errno != 0)\n\t\treturn strerror(errno);\n\treturn gai_strerror(gaierr);\n}",
          "includes": [
            "#include \"platform.h\"",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"ssh.h\"",
            "#include \"log.h\"",
            "#include \"misc.h\"",
            "#include \"xmalloc.h\"",
            "#include <net/if.h>",
            "#include <pwd.h>",
            "# include <paths.h>",
            "#include <netdb.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <ctype.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/tcp.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in_systm.h>",
            "#include <netinet/in.h>",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <libgen.h>",
            "#include <limits.h>",
            "#include <sys/un.h>",
            "#include <sys/wait.h>",
            "#include <sys/time.h>",
            "#include <sys/stat.h>",
            "#include <sys/socket.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"platform.h\"\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"ssh.h\"\n#include \"log.h\"\n#include \"misc.h\"\n#include \"xmalloc.h\"\n#include <net/if.h>\n#include <pwd.h>\n# include <paths.h>\n#include <netdb.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <ctype.h>\n#include <arpa/inet.h>\n#include <netinet/tcp.h>\n#include <netinet/ip.h>\n#include <netinet/in_systm.h>\n#include <netinet/in.h>\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <libgen.h>\n#include <limits.h>\n#include <sys/un.h>\n#include <sys/wait.h>\n#include <sys/time.h>\n#include <sys/stat.h>\n#include <sys/socket.h>\n#include <sys/ioctl.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nconst char *\nssh_gai_strerror(int gaierr)\n{\n\tif (gaierr == EAI_SYSTEM && errno != 0)\n\t\treturn strerror(errno);\n\treturn gai_strerror(gaierr);\n}"
        }
      },
      {
        "call_info": {
          "callee": "ftruncate",
          "args": [
            "fd",
            "buf.st_size"
          ],
          "line": 1099
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "atomicio",
          "args": [
            "vwrite",
            "fd",
            "ut",
            "sizeof(*ut)"
          ],
          "line": 1098
        },
        "resolved": true,
        "details": {
          "function_name": "atomiciov",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/atomicio.c",
          "lines": "165-170",
          "snippet": "size_t\natomiciov(ssize_t (*f) (int, const struct iovec *, int), int fd,\n    const struct iovec *_iov, int iovcnt)\n{\n\treturn atomiciov6(f, fd, _iov, iovcnt, NULL, NULL);\n}",
          "includes": [
            "#include \"atomicio.h\"",
            "#include <limits.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#  include <sys/poll.h>",
            "#include <poll.h>",
            "#include <errno.h>",
            "#include <sys/uio.h>",
            "#include <sys/param.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"atomicio.h\"\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#  include <sys/poll.h>\n#include <poll.h>\n#include <errno.h>\n#include <sys/uio.h>\n#include <sys/param.h>\n#include \"includes.h\"\n\nsize_t\natomiciov(ssize_t (*f) (int, const struct iovec *, int), int fd,\n    const struct iovec *_iov, int iovcnt)\n{\n\treturn atomiciov6(f, fd, _iov, iovcnt, NULL, NULL);\n}"
        }
      },
      {
        "call_info": {
          "callee": "fstat",
          "args": [
            "fd",
            "&buf"
          ],
          "line": 1097
        },
        "resolved": true,
        "details": {
          "function_name": "fstatvfs",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/openbsd-compat/bsd-statvfs.c",
          "lines": "71-85",
          "snippet": "int fstatvfs(int fd, struct statvfs *buf)\n{\n#  ifdef HAVE_FSTATFS\n\tstruct statfs fs;\n\n\tmemset(&fs, 0, sizeof(fs));\n\tif (fstatfs(fd, &fs) == -1)\n\t\treturn -1;\n\tcopy_statfs_to_statvfs(buf, &fs);\n\treturn 0;\n#  else\n\terrno = ENOSYS;\n\treturn -1;\n#  endif\n}",
          "includes": [
            "#include <errno.h>",
            "# include <sys/mount.h>",
            "#include <sys/param.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <errno.h>\n# include <sys/mount.h>\n#include <sys/param.h>\n#include \"includes.h\"\n\nint fstatvfs(int fd, struct statvfs *buf)\n{\n#  ifdef HAVE_FSTATFS\n\tstruct statfs fs;\n\n\tmemset(&fs, 0, sizeof(fs));\n\tif (fstatfs(fd, &fs) == -1)\n\t\treturn -1;\n\tcopy_statfs_to_statvfs(buf, &fs);\n\treturn 0;\n#  else\n\terrno = ENOSYS;\n\treturn -1;\n#  endif\n}"
        }
      },
      {
        "call_info": {
          "callee": "open",
          "args": [
            "WTMP_FILE",
            "O_WRONLY|O_APPEND",
            "0"
          ],
          "line": 1092
        },
        "resolved": true,
        "details": {
          "function_name": "lastlog_openseek",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
          "lines": "1471-1514",
          "snippet": "static int\nlastlog_openseek(struct logininfo *li, int *fd, int filemode)\n{\n\toff_t offset;\n\tchar lastlog_file[1024];\n\tstruct stat st;\n\n\tif (stat(LASTLOG_FILE, &st) != 0) {\n\t\tlogit(\"%s: Couldn't stat %s: %s\", __func__,\n\t\t    LASTLOG_FILE, strerror(errno));\n\t\treturn (0);\n\t}\n\tif (S_ISDIR(st.st_mode)) {\n\t\tsnprintf(lastlog_file, sizeof(lastlog_file), \"%s/%s\",\n\t\t    LASTLOG_FILE, li->username);\n\t} else if (S_ISREG(st.st_mode)) {\n\t\tstrlcpy(lastlog_file, LASTLOG_FILE, sizeof(lastlog_file));\n\t} else {\n\t\tlogit(\"%s: %.100s is not a file or directory!\", __func__,\n\t\t    LASTLOG_FILE);\n\t\treturn (0);\n\t}\n\n\t*fd = open(lastlog_file, filemode, 0600);\n\tif (*fd < 0) {\n\t\tdebug(\"%s: Couldn't open %s: %s\", __func__,\n\t\t    lastlog_file, strerror(errno));\n\t\treturn (0);\n\t}\n\n\tif (S_ISREG(st.st_mode)) {\n\t\t/* find this uid's offset in the lastlog file */\n\t\toffset = (off_t) ((u_long)li->uid * sizeof(struct lastlog));\n\n\t\tif (lseek(*fd, offset, SEEK_SET) != offset) {\n\t\t\tlogit(\"%s: %s->lseek(): %s\", __func__,\n\t\t\t    lastlog_file, strerror(errno));\n\t\t\tclose(*fd);\n\t\t\treturn (0);\n\t\t}\n\t}\n\n\treturn (1);\n}",
          "includes": [
            "# include <util.h>",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"auth.h\"",
            "#include \"canohost.h\"",
            "#include \"packet.h\"",
            "#include \"atomicio.h\"",
            "#include \"log.h\"",
            "#include \"loginrec.h\"",
            "#include \"ssh.h\"",
            "#include \"hostfile.h\"",
            "#include \"sshkey.h\"",
            "#include \"xmalloc.h\"",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <string.h>",
            "#include <stdarg.h>",
            "#include <pwd.h>",
            "# include <paths.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "int utmp_write_entry(struct logininfo *li);",
            "int utmpx_write_entry(struct logininfo *li);",
            "int wtmp_write_entry(struct logininfo *li);",
            "int wtmpx_write_entry(struct logininfo *li);",
            "int lastlog_write_entry(struct logininfo *li);",
            "int syslogin_write_entry(struct logininfo *li);",
            "int getlast_entry(struct logininfo *li);",
            "int lastlog_get_entry(struct logininfo *li);",
            "int utmpx_get_entry(struct logininfo *li);",
            "int wtmp_get_entry(struct logininfo *li);",
            "int wtmpx_get_entry(struct logininfo *li);"
          ],
          "called_functions": [],
          "contextual_snippet": "# include <util.h>\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"auth.h\"\n#include \"canohost.h\"\n#include \"packet.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"loginrec.h\"\n#include \"ssh.h\"\n#include \"hostfile.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdarg.h>\n#include <pwd.h>\n# include <paths.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint utmp_write_entry(struct logininfo *li);\nint utmpx_write_entry(struct logininfo *li);\nint wtmp_write_entry(struct logininfo *li);\nint wtmpx_write_entry(struct logininfo *li);\nint lastlog_write_entry(struct logininfo *li);\nint syslogin_write_entry(struct logininfo *li);\nint getlast_entry(struct logininfo *li);\nint lastlog_get_entry(struct logininfo *li);\nint utmpx_get_entry(struct logininfo *li);\nint wtmp_get_entry(struct logininfo *li);\nint wtmpx_get_entry(struct logininfo *li);\n\nstatic int\nlastlog_openseek(struct logininfo *li, int *fd, int filemode)\n{\n\toff_t offset;\n\tchar lastlog_file[1024];\n\tstruct stat st;\n\n\tif (stat(LASTLOG_FILE, &st) != 0) {\n\t\tlogit(\"%s: Couldn't stat %s: %s\", __func__,\n\t\t    LASTLOG_FILE, strerror(errno));\n\t\treturn (0);\n\t}\n\tif (S_ISDIR(st.st_mode)) {\n\t\tsnprintf(lastlog_file, sizeof(lastlog_file), \"%s/%s\",\n\t\t    LASTLOG_FILE, li->username);\n\t} else if (S_ISREG(st.st_mode)) {\n\t\tstrlcpy(lastlog_file, LASTLOG_FILE, sizeof(lastlog_file));\n\t} else {\n\t\tlogit(\"%s: %.100s is not a file or directory!\", __func__,\n\t\t    LASTLOG_FILE);\n\t\treturn (0);\n\t}\n\n\t*fd = open(lastlog_file, filemode, 0600);\n\tif (*fd < 0) {\n\t\tdebug(\"%s: Couldn't open %s: %s\", __func__,\n\t\t    lastlog_file, strerror(errno));\n\t\treturn (0);\n\t}\n\n\tif (S_ISREG(st.st_mode)) {\n\t\t/* find this uid's offset in the lastlog file */\n\t\toffset = (off_t) ((u_long)li->uid * sizeof(struct lastlog));\n\n\t\tif (lseek(*fd, offset, SEEK_SET) != offset) {\n\t\t\tlogit(\"%s: %s->lseek(): %s\", __func__,\n\t\t\t    lastlog_file, strerror(errno));\n\t\t\tclose(*fd);\n\t\t\treturn (0);\n\t\t}\n\t}\n\n\treturn (1);\n}"
        }
      }
    ],
    "contextual_snippet": "# include <util.h>\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"auth.h\"\n#include \"canohost.h\"\n#include \"packet.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"loginrec.h\"\n#include \"ssh.h\"\n#include \"hostfile.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdarg.h>\n#include <pwd.h>\n# include <paths.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint utmp_write_entry(struct logininfo *li);\nint utmpx_write_entry(struct logininfo *li);\nint wtmp_write_entry(struct logininfo *li);\nint wtmpx_write_entry(struct logininfo *li);\nint lastlog_write_entry(struct logininfo *li);\nint syslogin_write_entry(struct logininfo *li);\nint getlast_entry(struct logininfo *li);\nint lastlog_get_entry(struct logininfo *li);\nint utmpx_get_entry(struct logininfo *li);\nint wtmp_get_entry(struct logininfo *li);\nint wtmpx_get_entry(struct logininfo *li);\n\nstatic int\nwtmp_write(struct logininfo *li, struct utmp *ut)\n{\n\tstruct stat buf;\n\tint fd, ret = 1;\n\n\tif ((fd = open(WTMP_FILE, O_WRONLY|O_APPEND, 0)) < 0) {\n\t\tlogit(\"%s: problem writing %s: %s\", __func__,\n\t\t    WTMP_FILE, strerror(errno));\n\t\treturn (0);\n\t}\n\tif (fstat(fd, &buf) == 0)\n\t\tif (atomicio(vwrite, fd, ut, sizeof(*ut)) != sizeof(*ut)) {\n\t\t\tftruncate(fd, buf.st_size);\n\t\t\tlogit(\"%s: problem writing %s: %s\", __func__,\n\t\t\t    WTMP_FILE, strerror(errno));\n\t\t\tret = 0;\n\t\t}\n\tclose(fd);\n\treturn (ret);\n}"
  },
  {
    "function_name": "utmpx_write_entry",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
    "lines": "1060-1072",
    "snippet": "int\nutmpx_write_entry(struct logininfo *li)\n{\n\tswitch(li->type) {\n\tcase LTYPE_LOGIN:\n\t\treturn (utmpx_perform_login(li));\n\tcase LTYPE_LOGOUT:\n\t\treturn (utmpx_perform_logout(li));\n\tdefault:\n\t\tlogit(\"%s: invalid type field\", __func__);\n\t\treturn (0);\n\t}\n}",
    "includes": [
      "# include <util.h>",
      "#include \"ssherr.h\"",
      "#include \"sshbuf.h\"",
      "#include \"auth.h\"",
      "#include \"canohost.h\"",
      "#include \"packet.h\"",
      "#include \"atomicio.h\"",
      "#include \"log.h\"",
      "#include \"loginrec.h\"",
      "#include \"ssh.h\"",
      "#include \"hostfile.h\"",
      "#include \"sshkey.h\"",
      "#include \"xmalloc.h\"",
      "#include <unistd.h>",
      "#include <time.h>",
      "#include <string.h>",
      "#include <stdarg.h>",
      "#include <pwd.h>",
      "# include <paths.h>",
      "#include <fcntl.h>",
      "#include <errno.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "int utmp_write_entry(struct logininfo *li);",
      "int utmpx_write_entry(struct logininfo *li);",
      "int wtmp_write_entry(struct logininfo *li);",
      "int wtmpx_write_entry(struct logininfo *li);",
      "int lastlog_write_entry(struct logininfo *li);",
      "int syslogin_write_entry(struct logininfo *li);",
      "int getlast_entry(struct logininfo *li);",
      "int lastlog_get_entry(struct logininfo *li);",
      "int utmpx_get_entry(struct logininfo *li);",
      "int wtmp_get_entry(struct logininfo *li);",
      "int wtmpx_get_entry(struct logininfo *li);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "logit",
          "args": [
            "\"%s: invalid type field\"",
            "__func__"
          ],
          "line": 1069
        },
        "resolved": true,
        "details": {
          "function_name": "logit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/log.c",
          "lines": "198-206",
          "snippet": "void\nlogit(const char *fmt,...)\n{\n\tva_list args;\n\n\tva_start(args, fmt);\n\tdo_log(SYSLOG_LEVEL_INFO, fmt, args);\n\tva_end(args);\n}",
          "includes": [
            "#include \"log.h\"",
            "# include <vis.h>",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <syslog.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <fcntl.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n# include <vis.h>\n#include <errno.h>\n#include <unistd.h>\n#include <syslog.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <fcntl.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\nlogit(const char *fmt,...)\n{\n\tva_list args;\n\n\tva_start(args, fmt);\n\tdo_log(SYSLOG_LEVEL_INFO, fmt, args);\n\tva_end(args);\n}"
        }
      },
      {
        "call_info": {
          "callee": "utmpx_perform_logout",
          "args": [
            "li"
          ],
          "line": 1067
        },
        "resolved": true,
        "details": {
          "function_name": "utmpx_perform_logout",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
          "lines": "1039-1058",
          "snippet": "static int\nutmpx_perform_logout(struct logininfo *li)\n{\n\tstruct utmpx utx;\n\n\tconstruct_utmpx(li, &utx);\n# ifdef HAVE_ID_IN_UTMPX\n\tline_abbrevname(utx.ut_id, li->line, sizeof(utx.ut_id));\n# endif\n# ifdef HAVE_TYPE_IN_UTMPX\n\tutx.ut_type = DEAD_PROCESS;\n# endif\n\n# ifdef UTMPX_USE_LIBRARY\n\tutmpx_write_library(li, &utx);\n# else\n\tutmpx_write_direct(li, &utx);\n# endif\n\treturn (1);\n}",
          "includes": [
            "# include <util.h>",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"auth.h\"",
            "#include \"canohost.h\"",
            "#include \"packet.h\"",
            "#include \"atomicio.h\"",
            "#include \"log.h\"",
            "#include \"loginrec.h\"",
            "#include \"ssh.h\"",
            "#include \"hostfile.h\"",
            "#include \"sshkey.h\"",
            "#include \"xmalloc.h\"",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <string.h>",
            "#include <stdarg.h>",
            "#include <pwd.h>",
            "# include <paths.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "int utmp_write_entry(struct logininfo *li);",
            "int utmpx_write_entry(struct logininfo *li);",
            "int wtmp_write_entry(struct logininfo *li);",
            "int wtmpx_write_entry(struct logininfo *li);",
            "int lastlog_write_entry(struct logininfo *li);",
            "int syslogin_write_entry(struct logininfo *li);",
            "int getlast_entry(struct logininfo *li);",
            "int lastlog_get_entry(struct logininfo *li);",
            "int utmpx_get_entry(struct logininfo *li);",
            "int wtmp_get_entry(struct logininfo *li);",
            "int wtmpx_get_entry(struct logininfo *li);"
          ],
          "called_functions": [],
          "contextual_snippet": "# include <util.h>\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"auth.h\"\n#include \"canohost.h\"\n#include \"packet.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"loginrec.h\"\n#include \"ssh.h\"\n#include \"hostfile.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdarg.h>\n#include <pwd.h>\n# include <paths.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint utmp_write_entry(struct logininfo *li);\nint utmpx_write_entry(struct logininfo *li);\nint wtmp_write_entry(struct logininfo *li);\nint wtmpx_write_entry(struct logininfo *li);\nint lastlog_write_entry(struct logininfo *li);\nint syslogin_write_entry(struct logininfo *li);\nint getlast_entry(struct logininfo *li);\nint lastlog_get_entry(struct logininfo *li);\nint utmpx_get_entry(struct logininfo *li);\nint wtmp_get_entry(struct logininfo *li);\nint wtmpx_get_entry(struct logininfo *li);\n\nstatic int\nutmpx_perform_logout(struct logininfo *li)\n{\n\tstruct utmpx utx;\n\n\tconstruct_utmpx(li, &utx);\n# ifdef HAVE_ID_IN_UTMPX\n\tline_abbrevname(utx.ut_id, li->line, sizeof(utx.ut_id));\n# endif\n# ifdef HAVE_TYPE_IN_UTMPX\n\tutx.ut_type = DEAD_PROCESS;\n# endif\n\n# ifdef UTMPX_USE_LIBRARY\n\tutmpx_write_library(li, &utx);\n# else\n\tutmpx_write_direct(li, &utx);\n# endif\n\treturn (1);\n}"
        }
      },
      {
        "call_info": {
          "callee": "utmpx_perform_login",
          "args": [
            "li"
          ],
          "line": 1065
        },
        "resolved": true,
        "details": {
          "function_name": "utmpx_perform_login",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
          "lines": "1018-1036",
          "snippet": "static int\nutmpx_perform_login(struct logininfo *li)\n{\n\tstruct utmpx utx;\n\n\tconstruct_utmpx(li, &utx);\n# ifdef UTMPX_USE_LIBRARY\n\tif (!utmpx_write_library(li, &utx)) {\n\t\tlogit(\"%s: utmp_write_library() failed\", __func__);\n\t\treturn (0);\n\t}\n# else\n\tif (!utmpx_write_direct(li, &ut)) {\n\t\tlogit(\"%s: utmp_write_direct() failed\", __func__);\n\t\treturn (0);\n\t}\n# endif\n\treturn (1);\n}",
          "includes": [
            "# include <util.h>",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"auth.h\"",
            "#include \"canohost.h\"",
            "#include \"packet.h\"",
            "#include \"atomicio.h\"",
            "#include \"log.h\"",
            "#include \"loginrec.h\"",
            "#include \"ssh.h\"",
            "#include \"hostfile.h\"",
            "#include \"sshkey.h\"",
            "#include \"xmalloc.h\"",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <string.h>",
            "#include <stdarg.h>",
            "#include <pwd.h>",
            "# include <paths.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "int utmp_write_entry(struct logininfo *li);",
            "int utmpx_write_entry(struct logininfo *li);",
            "int wtmp_write_entry(struct logininfo *li);",
            "int wtmpx_write_entry(struct logininfo *li);",
            "int lastlog_write_entry(struct logininfo *li);",
            "int syslogin_write_entry(struct logininfo *li);",
            "int getlast_entry(struct logininfo *li);",
            "int lastlog_get_entry(struct logininfo *li);",
            "int utmpx_get_entry(struct logininfo *li);",
            "int wtmp_get_entry(struct logininfo *li);",
            "int wtmpx_get_entry(struct logininfo *li);"
          ],
          "called_functions": [],
          "contextual_snippet": "# include <util.h>\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"auth.h\"\n#include \"canohost.h\"\n#include \"packet.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"loginrec.h\"\n#include \"ssh.h\"\n#include \"hostfile.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdarg.h>\n#include <pwd.h>\n# include <paths.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint utmp_write_entry(struct logininfo *li);\nint utmpx_write_entry(struct logininfo *li);\nint wtmp_write_entry(struct logininfo *li);\nint wtmpx_write_entry(struct logininfo *li);\nint lastlog_write_entry(struct logininfo *li);\nint syslogin_write_entry(struct logininfo *li);\nint getlast_entry(struct logininfo *li);\nint lastlog_get_entry(struct logininfo *li);\nint utmpx_get_entry(struct logininfo *li);\nint wtmp_get_entry(struct logininfo *li);\nint wtmpx_get_entry(struct logininfo *li);\n\nstatic int\nutmpx_perform_login(struct logininfo *li)\n{\n\tstruct utmpx utx;\n\n\tconstruct_utmpx(li, &utx);\n# ifdef UTMPX_USE_LIBRARY\n\tif (!utmpx_write_library(li, &utx)) {\n\t\tlogit(\"%s: utmp_write_library() failed\", __func__);\n\t\treturn (0);\n\t}\n# else\n\tif (!utmpx_write_direct(li, &ut)) {\n\t\tlogit(\"%s: utmp_write_direct() failed\", __func__);\n\t\treturn (0);\n\t}\n# endif\n\treturn (1);\n}"
        }
      }
    ],
    "contextual_snippet": "# include <util.h>\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"auth.h\"\n#include \"canohost.h\"\n#include \"packet.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"loginrec.h\"\n#include \"ssh.h\"\n#include \"hostfile.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdarg.h>\n#include <pwd.h>\n# include <paths.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint utmp_write_entry(struct logininfo *li);\nint utmpx_write_entry(struct logininfo *li);\nint wtmp_write_entry(struct logininfo *li);\nint wtmpx_write_entry(struct logininfo *li);\nint lastlog_write_entry(struct logininfo *li);\nint syslogin_write_entry(struct logininfo *li);\nint getlast_entry(struct logininfo *li);\nint lastlog_get_entry(struct logininfo *li);\nint utmpx_get_entry(struct logininfo *li);\nint wtmp_get_entry(struct logininfo *li);\nint wtmpx_get_entry(struct logininfo *li);\n\nint\nutmpx_write_entry(struct logininfo *li)\n{\n\tswitch(li->type) {\n\tcase LTYPE_LOGIN:\n\t\treturn (utmpx_perform_login(li));\n\tcase LTYPE_LOGOUT:\n\t\treturn (utmpx_perform_logout(li));\n\tdefault:\n\t\tlogit(\"%s: invalid type field\", __func__);\n\t\treturn (0);\n\t}\n}"
  },
  {
    "function_name": "utmpx_perform_logout",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
    "lines": "1039-1058",
    "snippet": "static int\nutmpx_perform_logout(struct logininfo *li)\n{\n\tstruct utmpx utx;\n\n\tconstruct_utmpx(li, &utx);\n# ifdef HAVE_ID_IN_UTMPX\n\tline_abbrevname(utx.ut_id, li->line, sizeof(utx.ut_id));\n# endif\n# ifdef HAVE_TYPE_IN_UTMPX\n\tutx.ut_type = DEAD_PROCESS;\n# endif\n\n# ifdef UTMPX_USE_LIBRARY\n\tutmpx_write_library(li, &utx);\n# else\n\tutmpx_write_direct(li, &utx);\n# endif\n\treturn (1);\n}",
    "includes": [
      "# include <util.h>",
      "#include \"ssherr.h\"",
      "#include \"sshbuf.h\"",
      "#include \"auth.h\"",
      "#include \"canohost.h\"",
      "#include \"packet.h\"",
      "#include \"atomicio.h\"",
      "#include \"log.h\"",
      "#include \"loginrec.h\"",
      "#include \"ssh.h\"",
      "#include \"hostfile.h\"",
      "#include \"sshkey.h\"",
      "#include \"xmalloc.h\"",
      "#include <unistd.h>",
      "#include <time.h>",
      "#include <string.h>",
      "#include <stdarg.h>",
      "#include <pwd.h>",
      "# include <paths.h>",
      "#include <fcntl.h>",
      "#include <errno.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "int utmp_write_entry(struct logininfo *li);",
      "int utmpx_write_entry(struct logininfo *li);",
      "int wtmp_write_entry(struct logininfo *li);",
      "int wtmpx_write_entry(struct logininfo *li);",
      "int lastlog_write_entry(struct logininfo *li);",
      "int syslogin_write_entry(struct logininfo *li);",
      "int getlast_entry(struct logininfo *li);",
      "int lastlog_get_entry(struct logininfo *li);",
      "int utmpx_get_entry(struct logininfo *li);",
      "int wtmp_get_entry(struct logininfo *li);",
      "int wtmpx_get_entry(struct logininfo *li);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "utmpx_write_direct",
          "args": [
            "li",
            "&utx"
          ],
          "line": 1055
        },
        "resolved": true,
        "details": {
          "function_name": "utmpx_write_direct",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
          "lines": "1010-1015",
          "snippet": "static int\nutmpx_write_direct(struct logininfo *li, struct utmpx *utx)\n{\n\tlogit(\"%s: not implemented!\", __func__);\n\treturn (0);\n}",
          "includes": [
            "# include <util.h>",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"auth.h\"",
            "#include \"canohost.h\"",
            "#include \"packet.h\"",
            "#include \"atomicio.h\"",
            "#include \"log.h\"",
            "#include \"loginrec.h\"",
            "#include \"ssh.h\"",
            "#include \"hostfile.h\"",
            "#include \"sshkey.h\"",
            "#include \"xmalloc.h\"",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <string.h>",
            "#include <stdarg.h>",
            "#include <pwd.h>",
            "# include <paths.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "int utmp_write_entry(struct logininfo *li);",
            "int utmpx_write_entry(struct logininfo *li);",
            "int wtmp_write_entry(struct logininfo *li);",
            "int wtmpx_write_entry(struct logininfo *li);",
            "int lastlog_write_entry(struct logininfo *li);",
            "int syslogin_write_entry(struct logininfo *li);",
            "int getlast_entry(struct logininfo *li);",
            "int lastlog_get_entry(struct logininfo *li);",
            "int utmpx_get_entry(struct logininfo *li);",
            "int wtmp_get_entry(struct logininfo *li);",
            "int wtmpx_get_entry(struct logininfo *li);"
          ],
          "called_functions": [],
          "contextual_snippet": "# include <util.h>\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"auth.h\"\n#include \"canohost.h\"\n#include \"packet.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"loginrec.h\"\n#include \"ssh.h\"\n#include \"hostfile.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdarg.h>\n#include <pwd.h>\n# include <paths.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint utmp_write_entry(struct logininfo *li);\nint utmpx_write_entry(struct logininfo *li);\nint wtmp_write_entry(struct logininfo *li);\nint wtmpx_write_entry(struct logininfo *li);\nint lastlog_write_entry(struct logininfo *li);\nint syslogin_write_entry(struct logininfo *li);\nint getlast_entry(struct logininfo *li);\nint lastlog_get_entry(struct logininfo *li);\nint utmpx_get_entry(struct logininfo *li);\nint wtmp_get_entry(struct logininfo *li);\nint wtmpx_get_entry(struct logininfo *li);\n\nstatic int\nutmpx_write_direct(struct logininfo *li, struct utmpx *utx)\n{\n\tlogit(\"%s: not implemented!\", __func__);\n\treturn (0);\n}"
        }
      },
      {
        "call_info": {
          "callee": "utmpx_write_library",
          "args": [
            "li",
            "&utx"
          ],
          "line": 1053
        },
        "resolved": true,
        "details": {
          "function_name": "utmpx_write_library",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
          "lines": "995-1005",
          "snippet": "static int\nutmpx_write_library(struct logininfo *li, struct utmpx *utx)\n{\n\tsetutxent();\n\tpututxline(utx);\n\n#  ifdef HAVE_ENDUTXENT\n\tendutxent();\n#  endif\n\treturn (1);\n}",
          "includes": [
            "# include <util.h>",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"auth.h\"",
            "#include \"canohost.h\"",
            "#include \"packet.h\"",
            "#include \"atomicio.h\"",
            "#include \"log.h\"",
            "#include \"loginrec.h\"",
            "#include \"ssh.h\"",
            "#include \"hostfile.h\"",
            "#include \"sshkey.h\"",
            "#include \"xmalloc.h\"",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <string.h>",
            "#include <stdarg.h>",
            "#include <pwd.h>",
            "# include <paths.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "int utmp_write_entry(struct logininfo *li);",
            "int utmpx_write_entry(struct logininfo *li);",
            "int wtmp_write_entry(struct logininfo *li);",
            "int wtmpx_write_entry(struct logininfo *li);",
            "int lastlog_write_entry(struct logininfo *li);",
            "int syslogin_write_entry(struct logininfo *li);",
            "int getlast_entry(struct logininfo *li);",
            "int lastlog_get_entry(struct logininfo *li);",
            "int utmpx_get_entry(struct logininfo *li);",
            "int wtmp_get_entry(struct logininfo *li);",
            "int wtmpx_get_entry(struct logininfo *li);"
          ],
          "called_functions": [],
          "contextual_snippet": "# include <util.h>\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"auth.h\"\n#include \"canohost.h\"\n#include \"packet.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"loginrec.h\"\n#include \"ssh.h\"\n#include \"hostfile.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdarg.h>\n#include <pwd.h>\n# include <paths.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint utmp_write_entry(struct logininfo *li);\nint utmpx_write_entry(struct logininfo *li);\nint wtmp_write_entry(struct logininfo *li);\nint wtmpx_write_entry(struct logininfo *li);\nint lastlog_write_entry(struct logininfo *li);\nint syslogin_write_entry(struct logininfo *li);\nint getlast_entry(struct logininfo *li);\nint lastlog_get_entry(struct logininfo *li);\nint utmpx_get_entry(struct logininfo *li);\nint wtmp_get_entry(struct logininfo *li);\nint wtmpx_get_entry(struct logininfo *li);\n\nstatic int\nutmpx_write_library(struct logininfo *li, struct utmpx *utx)\n{\n\tsetutxent();\n\tpututxline(utx);\n\n#  ifdef HAVE_ENDUTXENT\n\tendutxent();\n#  endif\n\treturn (1);\n}"
        }
      },
      {
        "call_info": {
          "callee": "line_abbrevname",
          "args": [
            "utx.ut_id",
            "li->line",
            "sizeof(utx.ut_id)"
          ],
          "line": 1046
        },
        "resolved": true,
        "details": {
          "function_name": "line_abbrevname",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
          "lines": "596-623",
          "snippet": "char *\nline_abbrevname(char *dst, const char *src, int dstsize)\n{\n\tsize_t len;\n\n\tmemset(dst, '\\0', dstsize);\n\n\t/* Always skip prefix if present */\n\tif (strncmp(src, \"/dev/\", 5) == 0)\n\t\tsrc += 5;\n\n#ifdef WITH_ABBREV_NO_TTY\n\tif (strncmp(src, \"tty\", 3) == 0)\n\t\tsrc += 3;\n#endif\n\n\tlen = strlen(src);\n\n\tif (len > 0) {\n\t\tif (((int)len - dstsize) > 0)\n\t\t\tsrc +=  ((int)len - dstsize);\n\n\t\t/* note: _don't_ change this to strlcpy */\n\t\tstrncpy(dst, src, (size_t)dstsize);\n\t}\n\n\treturn (dst);\n}",
          "includes": [
            "# include <util.h>",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"auth.h\"",
            "#include \"canohost.h\"",
            "#include \"packet.h\"",
            "#include \"atomicio.h\"",
            "#include \"log.h\"",
            "#include \"loginrec.h\"",
            "#include \"ssh.h\"",
            "#include \"hostfile.h\"",
            "#include \"sshkey.h\"",
            "#include \"xmalloc.h\"",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <string.h>",
            "#include <stdarg.h>",
            "#include <pwd.h>",
            "# include <paths.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <util.h>\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"auth.h\"\n#include \"canohost.h\"\n#include \"packet.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"loginrec.h\"\n#include \"ssh.h\"\n#include \"hostfile.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdarg.h>\n#include <pwd.h>\n# include <paths.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nchar *\nline_abbrevname(char *dst, const char *src, int dstsize)\n{\n\tsize_t len;\n\n\tmemset(dst, '\\0', dstsize);\n\n\t/* Always skip prefix if present */\n\tif (strncmp(src, \"/dev/\", 5) == 0)\n\t\tsrc += 5;\n\n#ifdef WITH_ABBREV_NO_TTY\n\tif (strncmp(src, \"tty\", 3) == 0)\n\t\tsrc += 3;\n#endif\n\n\tlen = strlen(src);\n\n\tif (len > 0) {\n\t\tif (((int)len - dstsize) > 0)\n\t\t\tsrc +=  ((int)len - dstsize);\n\n\t\t/* note: _don't_ change this to strlcpy */\n\t\tstrncpy(dst, src, (size_t)dstsize);\n\t}\n\n\treturn (dst);\n}"
        }
      },
      {
        "call_info": {
          "callee": "construct_utmpx",
          "args": [
            "li",
            "&utx"
          ],
          "line": 1044
        },
        "resolved": true,
        "details": {
          "function_name": "construct_utmpx",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
          "lines": "738-801",
          "snippet": "void\nconstruct_utmpx(struct logininfo *li, struct utmpx *utx)\n{\n# ifdef HAVE_ADDR_V6_IN_UTMP\n\tstruct sockaddr_in6 *sa6;\n#  endif\n\tmemset(utx, '\\0', sizeof(*utx));\n\n# ifdef HAVE_ID_IN_UTMPX\n\tline_abbrevname(utx->ut_id, li->line, sizeof(utx->ut_id));\n# endif\n\n\t/* this is done here to keep utmp constants out of loginrec.h */\n\tswitch (li->type) {\n\tcase LTYPE_LOGIN:\n\t\tutx->ut_type = USER_PROCESS;\n\t\tbreak;\n\tcase LTYPE_LOGOUT:\n\t\tutx->ut_type = DEAD_PROCESS;\n\t\tbreak;\n\t}\n\tline_stripname(utx->ut_line, li->line, sizeof(utx->ut_line));\n\tset_utmpx_time(li, utx);\n\tutx->ut_pid = li->pid;\n\n\t/* strncpy(): Don't necessarily want null termination */\n\tstrncpy(utx->ut_user, li->username,\n\t    MIN_SIZEOF(utx->ut_user, li->username));\n\n\tif (li->type == LTYPE_LOGOUT)\n\t\treturn;\n\n\t/*\n\t * These fields are only used when logging in, and are blank\n\t * for logouts.\n\t */\n\n# ifdef HAVE_HOST_IN_UTMPX\n\tstrncpy(utx->ut_host, li->hostname,\n\t    MIN_SIZEOF(utx->ut_host, li->hostname));\n# endif\n# ifdef HAVE_ADDR_IN_UTMPX\n\t/* this is just a 32-bit IP address */\n\tif (li->hostaddr.sa.sa_family == AF_INET)\n\t\tutx->ut_addr = li->hostaddr.sa_in.sin_addr.s_addr;\n# endif\n# ifdef HAVE_ADDR_V6_IN_UTMP\n\t/* this is just a 128-bit IPv6 address */\n\tif (li->hostaddr.sa.sa_family == AF_INET6) {\n\t\tsa6 = ((struct sockaddr_in6 *)&li->hostaddr.sa);\n\t\tmemcpy(utx->ut_addr_v6, sa6->sin6_addr.s6_addr, 16);\n\t\tif (IN6_IS_ADDR_V4MAPPED(&sa6->sin6_addr)) {\n\t\t\tutx->ut_addr_v6[0] = utx->ut_addr_v6[3];\n\t\t\tutx->ut_addr_v6[1] = 0;\n\t\t\tutx->ut_addr_v6[2] = 0;\n\t\t\tutx->ut_addr_v6[3] = 0;\n\t\t}\n\t}\n# endif\n# ifdef HAVE_SYSLEN_IN_UTMPX\n\t/* ut_syslen is the length of the utx_host string */\n\tutx->ut_syslen = MIN(strlen(li->hostname), sizeof(utx->ut_host));\n# endif\n}",
          "includes": [
            "# include <util.h>",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"auth.h\"",
            "#include \"canohost.h\"",
            "#include \"packet.h\"",
            "#include \"atomicio.h\"",
            "#include \"log.h\"",
            "#include \"loginrec.h\"",
            "#include \"ssh.h\"",
            "#include \"hostfile.h\"",
            "#include \"sshkey.h\"",
            "#include \"xmalloc.h\"",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <string.h>",
            "#include <stdarg.h>",
            "#include <pwd.h>",
            "# include <paths.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "int utmp_write_entry(struct logininfo *li);",
            "int utmpx_write_entry(struct logininfo *li);",
            "int wtmp_write_entry(struct logininfo *li);",
            "int wtmpx_write_entry(struct logininfo *li);",
            "int lastlog_write_entry(struct logininfo *li);",
            "int syslogin_write_entry(struct logininfo *li);",
            "int getlast_entry(struct logininfo *li);",
            "int lastlog_get_entry(struct logininfo *li);",
            "int utmpx_get_entry(struct logininfo *li);",
            "int wtmp_get_entry(struct logininfo *li);",
            "int wtmpx_get_entry(struct logininfo *li);"
          ],
          "called_functions": [],
          "contextual_snippet": "# include <util.h>\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"auth.h\"\n#include \"canohost.h\"\n#include \"packet.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"loginrec.h\"\n#include \"ssh.h\"\n#include \"hostfile.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdarg.h>\n#include <pwd.h>\n# include <paths.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint utmp_write_entry(struct logininfo *li);\nint utmpx_write_entry(struct logininfo *li);\nint wtmp_write_entry(struct logininfo *li);\nint wtmpx_write_entry(struct logininfo *li);\nint lastlog_write_entry(struct logininfo *li);\nint syslogin_write_entry(struct logininfo *li);\nint getlast_entry(struct logininfo *li);\nint lastlog_get_entry(struct logininfo *li);\nint utmpx_get_entry(struct logininfo *li);\nint wtmp_get_entry(struct logininfo *li);\nint wtmpx_get_entry(struct logininfo *li);\n\nvoid\nconstruct_utmpx(struct logininfo *li, struct utmpx *utx)\n{\n# ifdef HAVE_ADDR_V6_IN_UTMP\n\tstruct sockaddr_in6 *sa6;\n#  endif\n\tmemset(utx, '\\0', sizeof(*utx));\n\n# ifdef HAVE_ID_IN_UTMPX\n\tline_abbrevname(utx->ut_id, li->line, sizeof(utx->ut_id));\n# endif\n\n\t/* this is done here to keep utmp constants out of loginrec.h */\n\tswitch (li->type) {\n\tcase LTYPE_LOGIN:\n\t\tutx->ut_type = USER_PROCESS;\n\t\tbreak;\n\tcase LTYPE_LOGOUT:\n\t\tutx->ut_type = DEAD_PROCESS;\n\t\tbreak;\n\t}\n\tline_stripname(utx->ut_line, li->line, sizeof(utx->ut_line));\n\tset_utmpx_time(li, utx);\n\tutx->ut_pid = li->pid;\n\n\t/* strncpy(): Don't necessarily want null termination */\n\tstrncpy(utx->ut_user, li->username,\n\t    MIN_SIZEOF(utx->ut_user, li->username));\n\n\tif (li->type == LTYPE_LOGOUT)\n\t\treturn;\n\n\t/*\n\t * These fields are only used when logging in, and are blank\n\t * for logouts.\n\t */\n\n# ifdef HAVE_HOST_IN_UTMPX\n\tstrncpy(utx->ut_host, li->hostname,\n\t    MIN_SIZEOF(utx->ut_host, li->hostname));\n# endif\n# ifdef HAVE_ADDR_IN_UTMPX\n\t/* this is just a 32-bit IP address */\n\tif (li->hostaddr.sa.sa_family == AF_INET)\n\t\tutx->ut_addr = li->hostaddr.sa_in.sin_addr.s_addr;\n# endif\n# ifdef HAVE_ADDR_V6_IN_UTMP\n\t/* this is just a 128-bit IPv6 address */\n\tif (li->hostaddr.sa.sa_family == AF_INET6) {\n\t\tsa6 = ((struct sockaddr_in6 *)&li->hostaddr.sa);\n\t\tmemcpy(utx->ut_addr_v6, sa6->sin6_addr.s6_addr, 16);\n\t\tif (IN6_IS_ADDR_V4MAPPED(&sa6->sin6_addr)) {\n\t\t\tutx->ut_addr_v6[0] = utx->ut_addr_v6[3];\n\t\t\tutx->ut_addr_v6[1] = 0;\n\t\t\tutx->ut_addr_v6[2] = 0;\n\t\t\tutx->ut_addr_v6[3] = 0;\n\t\t}\n\t}\n# endif\n# ifdef HAVE_SYSLEN_IN_UTMPX\n\t/* ut_syslen is the length of the utx_host string */\n\tutx->ut_syslen = MIN(strlen(li->hostname), sizeof(utx->ut_host));\n# endif\n}"
        }
      }
    ],
    "contextual_snippet": "# include <util.h>\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"auth.h\"\n#include \"canohost.h\"\n#include \"packet.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"loginrec.h\"\n#include \"ssh.h\"\n#include \"hostfile.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdarg.h>\n#include <pwd.h>\n# include <paths.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint utmp_write_entry(struct logininfo *li);\nint utmpx_write_entry(struct logininfo *li);\nint wtmp_write_entry(struct logininfo *li);\nint wtmpx_write_entry(struct logininfo *li);\nint lastlog_write_entry(struct logininfo *li);\nint syslogin_write_entry(struct logininfo *li);\nint getlast_entry(struct logininfo *li);\nint lastlog_get_entry(struct logininfo *li);\nint utmpx_get_entry(struct logininfo *li);\nint wtmp_get_entry(struct logininfo *li);\nint wtmpx_get_entry(struct logininfo *li);\n\nstatic int\nutmpx_perform_logout(struct logininfo *li)\n{\n\tstruct utmpx utx;\n\n\tconstruct_utmpx(li, &utx);\n# ifdef HAVE_ID_IN_UTMPX\n\tline_abbrevname(utx.ut_id, li->line, sizeof(utx.ut_id));\n# endif\n# ifdef HAVE_TYPE_IN_UTMPX\n\tutx.ut_type = DEAD_PROCESS;\n# endif\n\n# ifdef UTMPX_USE_LIBRARY\n\tutmpx_write_library(li, &utx);\n# else\n\tutmpx_write_direct(li, &utx);\n# endif\n\treturn (1);\n}"
  },
  {
    "function_name": "utmpx_perform_login",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
    "lines": "1018-1036",
    "snippet": "static int\nutmpx_perform_login(struct logininfo *li)\n{\n\tstruct utmpx utx;\n\n\tconstruct_utmpx(li, &utx);\n# ifdef UTMPX_USE_LIBRARY\n\tif (!utmpx_write_library(li, &utx)) {\n\t\tlogit(\"%s: utmp_write_library() failed\", __func__);\n\t\treturn (0);\n\t}\n# else\n\tif (!utmpx_write_direct(li, &ut)) {\n\t\tlogit(\"%s: utmp_write_direct() failed\", __func__);\n\t\treturn (0);\n\t}\n# endif\n\treturn (1);\n}",
    "includes": [
      "# include <util.h>",
      "#include \"ssherr.h\"",
      "#include \"sshbuf.h\"",
      "#include \"auth.h\"",
      "#include \"canohost.h\"",
      "#include \"packet.h\"",
      "#include \"atomicio.h\"",
      "#include \"log.h\"",
      "#include \"loginrec.h\"",
      "#include \"ssh.h\"",
      "#include \"hostfile.h\"",
      "#include \"sshkey.h\"",
      "#include \"xmalloc.h\"",
      "#include <unistd.h>",
      "#include <time.h>",
      "#include <string.h>",
      "#include <stdarg.h>",
      "#include <pwd.h>",
      "# include <paths.h>",
      "#include <fcntl.h>",
      "#include <errno.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "int utmp_write_entry(struct logininfo *li);",
      "int utmpx_write_entry(struct logininfo *li);",
      "int wtmp_write_entry(struct logininfo *li);",
      "int wtmpx_write_entry(struct logininfo *li);",
      "int lastlog_write_entry(struct logininfo *li);",
      "int syslogin_write_entry(struct logininfo *li);",
      "int getlast_entry(struct logininfo *li);",
      "int lastlog_get_entry(struct logininfo *li);",
      "int utmpx_get_entry(struct logininfo *li);",
      "int wtmp_get_entry(struct logininfo *li);",
      "int wtmpx_get_entry(struct logininfo *li);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "logit",
          "args": [
            "\"%s: utmp_write_direct() failed\"",
            "__func__"
          ],
          "line": 1031
        },
        "resolved": true,
        "details": {
          "function_name": "logit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/log.c",
          "lines": "198-206",
          "snippet": "void\nlogit(const char *fmt,...)\n{\n\tva_list args;\n\n\tva_start(args, fmt);\n\tdo_log(SYSLOG_LEVEL_INFO, fmt, args);\n\tva_end(args);\n}",
          "includes": [
            "#include \"log.h\"",
            "# include <vis.h>",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <syslog.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <fcntl.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n# include <vis.h>\n#include <errno.h>\n#include <unistd.h>\n#include <syslog.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <fcntl.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\nlogit(const char *fmt,...)\n{\n\tva_list args;\n\n\tva_start(args, fmt);\n\tdo_log(SYSLOG_LEVEL_INFO, fmt, args);\n\tva_end(args);\n}"
        }
      },
      {
        "call_info": {
          "callee": "utmpx_write_direct",
          "args": [
            "li",
            "&ut"
          ],
          "line": 1030
        },
        "resolved": true,
        "details": {
          "function_name": "utmpx_write_direct",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
          "lines": "1010-1015",
          "snippet": "static int\nutmpx_write_direct(struct logininfo *li, struct utmpx *utx)\n{\n\tlogit(\"%s: not implemented!\", __func__);\n\treturn (0);\n}",
          "includes": [
            "# include <util.h>",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"auth.h\"",
            "#include \"canohost.h\"",
            "#include \"packet.h\"",
            "#include \"atomicio.h\"",
            "#include \"log.h\"",
            "#include \"loginrec.h\"",
            "#include \"ssh.h\"",
            "#include \"hostfile.h\"",
            "#include \"sshkey.h\"",
            "#include \"xmalloc.h\"",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <string.h>",
            "#include <stdarg.h>",
            "#include <pwd.h>",
            "# include <paths.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "int utmp_write_entry(struct logininfo *li);",
            "int utmpx_write_entry(struct logininfo *li);",
            "int wtmp_write_entry(struct logininfo *li);",
            "int wtmpx_write_entry(struct logininfo *li);",
            "int lastlog_write_entry(struct logininfo *li);",
            "int syslogin_write_entry(struct logininfo *li);",
            "int getlast_entry(struct logininfo *li);",
            "int lastlog_get_entry(struct logininfo *li);",
            "int utmpx_get_entry(struct logininfo *li);",
            "int wtmp_get_entry(struct logininfo *li);",
            "int wtmpx_get_entry(struct logininfo *li);"
          ],
          "called_functions": [],
          "contextual_snippet": "# include <util.h>\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"auth.h\"\n#include \"canohost.h\"\n#include \"packet.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"loginrec.h\"\n#include \"ssh.h\"\n#include \"hostfile.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdarg.h>\n#include <pwd.h>\n# include <paths.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint utmp_write_entry(struct logininfo *li);\nint utmpx_write_entry(struct logininfo *li);\nint wtmp_write_entry(struct logininfo *li);\nint wtmpx_write_entry(struct logininfo *li);\nint lastlog_write_entry(struct logininfo *li);\nint syslogin_write_entry(struct logininfo *li);\nint getlast_entry(struct logininfo *li);\nint lastlog_get_entry(struct logininfo *li);\nint utmpx_get_entry(struct logininfo *li);\nint wtmp_get_entry(struct logininfo *li);\nint wtmpx_get_entry(struct logininfo *li);\n\nstatic int\nutmpx_write_direct(struct logininfo *li, struct utmpx *utx)\n{\n\tlogit(\"%s: not implemented!\", __func__);\n\treturn (0);\n}"
        }
      },
      {
        "call_info": {
          "callee": "utmpx_write_library",
          "args": [
            "li",
            "&utx"
          ],
          "line": 1025
        },
        "resolved": true,
        "details": {
          "function_name": "utmpx_write_library",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
          "lines": "995-1005",
          "snippet": "static int\nutmpx_write_library(struct logininfo *li, struct utmpx *utx)\n{\n\tsetutxent();\n\tpututxline(utx);\n\n#  ifdef HAVE_ENDUTXENT\n\tendutxent();\n#  endif\n\treturn (1);\n}",
          "includes": [
            "# include <util.h>",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"auth.h\"",
            "#include \"canohost.h\"",
            "#include \"packet.h\"",
            "#include \"atomicio.h\"",
            "#include \"log.h\"",
            "#include \"loginrec.h\"",
            "#include \"ssh.h\"",
            "#include \"hostfile.h\"",
            "#include \"sshkey.h\"",
            "#include \"xmalloc.h\"",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <string.h>",
            "#include <stdarg.h>",
            "#include <pwd.h>",
            "# include <paths.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "int utmp_write_entry(struct logininfo *li);",
            "int utmpx_write_entry(struct logininfo *li);",
            "int wtmp_write_entry(struct logininfo *li);",
            "int wtmpx_write_entry(struct logininfo *li);",
            "int lastlog_write_entry(struct logininfo *li);",
            "int syslogin_write_entry(struct logininfo *li);",
            "int getlast_entry(struct logininfo *li);",
            "int lastlog_get_entry(struct logininfo *li);",
            "int utmpx_get_entry(struct logininfo *li);",
            "int wtmp_get_entry(struct logininfo *li);",
            "int wtmpx_get_entry(struct logininfo *li);"
          ],
          "called_functions": [],
          "contextual_snippet": "# include <util.h>\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"auth.h\"\n#include \"canohost.h\"\n#include \"packet.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"loginrec.h\"\n#include \"ssh.h\"\n#include \"hostfile.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdarg.h>\n#include <pwd.h>\n# include <paths.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint utmp_write_entry(struct logininfo *li);\nint utmpx_write_entry(struct logininfo *li);\nint wtmp_write_entry(struct logininfo *li);\nint wtmpx_write_entry(struct logininfo *li);\nint lastlog_write_entry(struct logininfo *li);\nint syslogin_write_entry(struct logininfo *li);\nint getlast_entry(struct logininfo *li);\nint lastlog_get_entry(struct logininfo *li);\nint utmpx_get_entry(struct logininfo *li);\nint wtmp_get_entry(struct logininfo *li);\nint wtmpx_get_entry(struct logininfo *li);\n\nstatic int\nutmpx_write_library(struct logininfo *li, struct utmpx *utx)\n{\n\tsetutxent();\n\tpututxline(utx);\n\n#  ifdef HAVE_ENDUTXENT\n\tendutxent();\n#  endif\n\treturn (1);\n}"
        }
      },
      {
        "call_info": {
          "callee": "construct_utmpx",
          "args": [
            "li",
            "&utx"
          ],
          "line": 1023
        },
        "resolved": true,
        "details": {
          "function_name": "construct_utmpx",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
          "lines": "738-801",
          "snippet": "void\nconstruct_utmpx(struct logininfo *li, struct utmpx *utx)\n{\n# ifdef HAVE_ADDR_V6_IN_UTMP\n\tstruct sockaddr_in6 *sa6;\n#  endif\n\tmemset(utx, '\\0', sizeof(*utx));\n\n# ifdef HAVE_ID_IN_UTMPX\n\tline_abbrevname(utx->ut_id, li->line, sizeof(utx->ut_id));\n# endif\n\n\t/* this is done here to keep utmp constants out of loginrec.h */\n\tswitch (li->type) {\n\tcase LTYPE_LOGIN:\n\t\tutx->ut_type = USER_PROCESS;\n\t\tbreak;\n\tcase LTYPE_LOGOUT:\n\t\tutx->ut_type = DEAD_PROCESS;\n\t\tbreak;\n\t}\n\tline_stripname(utx->ut_line, li->line, sizeof(utx->ut_line));\n\tset_utmpx_time(li, utx);\n\tutx->ut_pid = li->pid;\n\n\t/* strncpy(): Don't necessarily want null termination */\n\tstrncpy(utx->ut_user, li->username,\n\t    MIN_SIZEOF(utx->ut_user, li->username));\n\n\tif (li->type == LTYPE_LOGOUT)\n\t\treturn;\n\n\t/*\n\t * These fields are only used when logging in, and are blank\n\t * for logouts.\n\t */\n\n# ifdef HAVE_HOST_IN_UTMPX\n\tstrncpy(utx->ut_host, li->hostname,\n\t    MIN_SIZEOF(utx->ut_host, li->hostname));\n# endif\n# ifdef HAVE_ADDR_IN_UTMPX\n\t/* this is just a 32-bit IP address */\n\tif (li->hostaddr.sa.sa_family == AF_INET)\n\t\tutx->ut_addr = li->hostaddr.sa_in.sin_addr.s_addr;\n# endif\n# ifdef HAVE_ADDR_V6_IN_UTMP\n\t/* this is just a 128-bit IPv6 address */\n\tif (li->hostaddr.sa.sa_family == AF_INET6) {\n\t\tsa6 = ((struct sockaddr_in6 *)&li->hostaddr.sa);\n\t\tmemcpy(utx->ut_addr_v6, sa6->sin6_addr.s6_addr, 16);\n\t\tif (IN6_IS_ADDR_V4MAPPED(&sa6->sin6_addr)) {\n\t\t\tutx->ut_addr_v6[0] = utx->ut_addr_v6[3];\n\t\t\tutx->ut_addr_v6[1] = 0;\n\t\t\tutx->ut_addr_v6[2] = 0;\n\t\t\tutx->ut_addr_v6[3] = 0;\n\t\t}\n\t}\n# endif\n# ifdef HAVE_SYSLEN_IN_UTMPX\n\t/* ut_syslen is the length of the utx_host string */\n\tutx->ut_syslen = MIN(strlen(li->hostname), sizeof(utx->ut_host));\n# endif\n}",
          "includes": [
            "# include <util.h>",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"auth.h\"",
            "#include \"canohost.h\"",
            "#include \"packet.h\"",
            "#include \"atomicio.h\"",
            "#include \"log.h\"",
            "#include \"loginrec.h\"",
            "#include \"ssh.h\"",
            "#include \"hostfile.h\"",
            "#include \"sshkey.h\"",
            "#include \"xmalloc.h\"",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <string.h>",
            "#include <stdarg.h>",
            "#include <pwd.h>",
            "# include <paths.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "int utmp_write_entry(struct logininfo *li);",
            "int utmpx_write_entry(struct logininfo *li);",
            "int wtmp_write_entry(struct logininfo *li);",
            "int wtmpx_write_entry(struct logininfo *li);",
            "int lastlog_write_entry(struct logininfo *li);",
            "int syslogin_write_entry(struct logininfo *li);",
            "int getlast_entry(struct logininfo *li);",
            "int lastlog_get_entry(struct logininfo *li);",
            "int utmpx_get_entry(struct logininfo *li);",
            "int wtmp_get_entry(struct logininfo *li);",
            "int wtmpx_get_entry(struct logininfo *li);"
          ],
          "called_functions": [],
          "contextual_snippet": "# include <util.h>\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"auth.h\"\n#include \"canohost.h\"\n#include \"packet.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"loginrec.h\"\n#include \"ssh.h\"\n#include \"hostfile.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdarg.h>\n#include <pwd.h>\n# include <paths.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint utmp_write_entry(struct logininfo *li);\nint utmpx_write_entry(struct logininfo *li);\nint wtmp_write_entry(struct logininfo *li);\nint wtmpx_write_entry(struct logininfo *li);\nint lastlog_write_entry(struct logininfo *li);\nint syslogin_write_entry(struct logininfo *li);\nint getlast_entry(struct logininfo *li);\nint lastlog_get_entry(struct logininfo *li);\nint utmpx_get_entry(struct logininfo *li);\nint wtmp_get_entry(struct logininfo *li);\nint wtmpx_get_entry(struct logininfo *li);\n\nvoid\nconstruct_utmpx(struct logininfo *li, struct utmpx *utx)\n{\n# ifdef HAVE_ADDR_V6_IN_UTMP\n\tstruct sockaddr_in6 *sa6;\n#  endif\n\tmemset(utx, '\\0', sizeof(*utx));\n\n# ifdef HAVE_ID_IN_UTMPX\n\tline_abbrevname(utx->ut_id, li->line, sizeof(utx->ut_id));\n# endif\n\n\t/* this is done here to keep utmp constants out of loginrec.h */\n\tswitch (li->type) {\n\tcase LTYPE_LOGIN:\n\t\tutx->ut_type = USER_PROCESS;\n\t\tbreak;\n\tcase LTYPE_LOGOUT:\n\t\tutx->ut_type = DEAD_PROCESS;\n\t\tbreak;\n\t}\n\tline_stripname(utx->ut_line, li->line, sizeof(utx->ut_line));\n\tset_utmpx_time(li, utx);\n\tutx->ut_pid = li->pid;\n\n\t/* strncpy(): Don't necessarily want null termination */\n\tstrncpy(utx->ut_user, li->username,\n\t    MIN_SIZEOF(utx->ut_user, li->username));\n\n\tif (li->type == LTYPE_LOGOUT)\n\t\treturn;\n\n\t/*\n\t * These fields are only used when logging in, and are blank\n\t * for logouts.\n\t */\n\n# ifdef HAVE_HOST_IN_UTMPX\n\tstrncpy(utx->ut_host, li->hostname,\n\t    MIN_SIZEOF(utx->ut_host, li->hostname));\n# endif\n# ifdef HAVE_ADDR_IN_UTMPX\n\t/* this is just a 32-bit IP address */\n\tif (li->hostaddr.sa.sa_family == AF_INET)\n\t\tutx->ut_addr = li->hostaddr.sa_in.sin_addr.s_addr;\n# endif\n# ifdef HAVE_ADDR_V6_IN_UTMP\n\t/* this is just a 128-bit IPv6 address */\n\tif (li->hostaddr.sa.sa_family == AF_INET6) {\n\t\tsa6 = ((struct sockaddr_in6 *)&li->hostaddr.sa);\n\t\tmemcpy(utx->ut_addr_v6, sa6->sin6_addr.s6_addr, 16);\n\t\tif (IN6_IS_ADDR_V4MAPPED(&sa6->sin6_addr)) {\n\t\t\tutx->ut_addr_v6[0] = utx->ut_addr_v6[3];\n\t\t\tutx->ut_addr_v6[1] = 0;\n\t\t\tutx->ut_addr_v6[2] = 0;\n\t\t\tutx->ut_addr_v6[3] = 0;\n\t\t}\n\t}\n# endif\n# ifdef HAVE_SYSLEN_IN_UTMPX\n\t/* ut_syslen is the length of the utx_host string */\n\tutx->ut_syslen = MIN(strlen(li->hostname), sizeof(utx->ut_host));\n# endif\n}"
        }
      }
    ],
    "contextual_snippet": "# include <util.h>\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"auth.h\"\n#include \"canohost.h\"\n#include \"packet.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"loginrec.h\"\n#include \"ssh.h\"\n#include \"hostfile.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdarg.h>\n#include <pwd.h>\n# include <paths.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint utmp_write_entry(struct logininfo *li);\nint utmpx_write_entry(struct logininfo *li);\nint wtmp_write_entry(struct logininfo *li);\nint wtmpx_write_entry(struct logininfo *li);\nint lastlog_write_entry(struct logininfo *li);\nint syslogin_write_entry(struct logininfo *li);\nint getlast_entry(struct logininfo *li);\nint lastlog_get_entry(struct logininfo *li);\nint utmpx_get_entry(struct logininfo *li);\nint wtmp_get_entry(struct logininfo *li);\nint wtmpx_get_entry(struct logininfo *li);\n\nstatic int\nutmpx_perform_login(struct logininfo *li)\n{\n\tstruct utmpx utx;\n\n\tconstruct_utmpx(li, &utx);\n# ifdef UTMPX_USE_LIBRARY\n\tif (!utmpx_write_library(li, &utx)) {\n\t\tlogit(\"%s: utmp_write_library() failed\", __func__);\n\t\treturn (0);\n\t}\n# else\n\tif (!utmpx_write_direct(li, &ut)) {\n\t\tlogit(\"%s: utmp_write_direct() failed\", __func__);\n\t\treturn (0);\n\t}\n# endif\n\treturn (1);\n}"
  },
  {
    "function_name": "utmpx_write_direct",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
    "lines": "1010-1015",
    "snippet": "static int\nutmpx_write_direct(struct logininfo *li, struct utmpx *utx)\n{\n\tlogit(\"%s: not implemented!\", __func__);\n\treturn (0);\n}",
    "includes": [
      "# include <util.h>",
      "#include \"ssherr.h\"",
      "#include \"sshbuf.h\"",
      "#include \"auth.h\"",
      "#include \"canohost.h\"",
      "#include \"packet.h\"",
      "#include \"atomicio.h\"",
      "#include \"log.h\"",
      "#include \"loginrec.h\"",
      "#include \"ssh.h\"",
      "#include \"hostfile.h\"",
      "#include \"sshkey.h\"",
      "#include \"xmalloc.h\"",
      "#include <unistd.h>",
      "#include <time.h>",
      "#include <string.h>",
      "#include <stdarg.h>",
      "#include <pwd.h>",
      "# include <paths.h>",
      "#include <fcntl.h>",
      "#include <errno.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "int utmp_write_entry(struct logininfo *li);",
      "int utmpx_write_entry(struct logininfo *li);",
      "int wtmp_write_entry(struct logininfo *li);",
      "int wtmpx_write_entry(struct logininfo *li);",
      "int lastlog_write_entry(struct logininfo *li);",
      "int syslogin_write_entry(struct logininfo *li);",
      "int getlast_entry(struct logininfo *li);",
      "int lastlog_get_entry(struct logininfo *li);",
      "int utmpx_get_entry(struct logininfo *li);",
      "int wtmp_get_entry(struct logininfo *li);",
      "int wtmpx_get_entry(struct logininfo *li);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "logit",
          "args": [
            "\"%s: not implemented!\"",
            "__func__"
          ],
          "line": 1013
        },
        "resolved": true,
        "details": {
          "function_name": "logit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/log.c",
          "lines": "198-206",
          "snippet": "void\nlogit(const char *fmt,...)\n{\n\tva_list args;\n\n\tva_start(args, fmt);\n\tdo_log(SYSLOG_LEVEL_INFO, fmt, args);\n\tva_end(args);\n}",
          "includes": [
            "#include \"log.h\"",
            "# include <vis.h>",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <syslog.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <fcntl.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n# include <vis.h>\n#include <errno.h>\n#include <unistd.h>\n#include <syslog.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <fcntl.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\nlogit(const char *fmt,...)\n{\n\tva_list args;\n\n\tva_start(args, fmt);\n\tdo_log(SYSLOG_LEVEL_INFO, fmt, args);\n\tva_end(args);\n}"
        }
      }
    ],
    "contextual_snippet": "# include <util.h>\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"auth.h\"\n#include \"canohost.h\"\n#include \"packet.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"loginrec.h\"\n#include \"ssh.h\"\n#include \"hostfile.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdarg.h>\n#include <pwd.h>\n# include <paths.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint utmp_write_entry(struct logininfo *li);\nint utmpx_write_entry(struct logininfo *li);\nint wtmp_write_entry(struct logininfo *li);\nint wtmpx_write_entry(struct logininfo *li);\nint lastlog_write_entry(struct logininfo *li);\nint syslogin_write_entry(struct logininfo *li);\nint getlast_entry(struct logininfo *li);\nint lastlog_get_entry(struct logininfo *li);\nint utmpx_get_entry(struct logininfo *li);\nint wtmp_get_entry(struct logininfo *li);\nint wtmpx_get_entry(struct logininfo *li);\n\nstatic int\nutmpx_write_direct(struct logininfo *li, struct utmpx *utx)\n{\n\tlogit(\"%s: not implemented!\", __func__);\n\treturn (0);\n}"
  },
  {
    "function_name": "utmpx_write_library",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
    "lines": "995-1005",
    "snippet": "static int\nutmpx_write_library(struct logininfo *li, struct utmpx *utx)\n{\n\tsetutxent();\n\tpututxline(utx);\n\n#  ifdef HAVE_ENDUTXENT\n\tendutxent();\n#  endif\n\treturn (1);\n}",
    "includes": [
      "# include <util.h>",
      "#include \"ssherr.h\"",
      "#include \"sshbuf.h\"",
      "#include \"auth.h\"",
      "#include \"canohost.h\"",
      "#include \"packet.h\"",
      "#include \"atomicio.h\"",
      "#include \"log.h\"",
      "#include \"loginrec.h\"",
      "#include \"ssh.h\"",
      "#include \"hostfile.h\"",
      "#include \"sshkey.h\"",
      "#include \"xmalloc.h\"",
      "#include <unistd.h>",
      "#include <time.h>",
      "#include <string.h>",
      "#include <stdarg.h>",
      "#include <pwd.h>",
      "# include <paths.h>",
      "#include <fcntl.h>",
      "#include <errno.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "int utmp_write_entry(struct logininfo *li);",
      "int utmpx_write_entry(struct logininfo *li);",
      "int wtmp_write_entry(struct logininfo *li);",
      "int wtmpx_write_entry(struct logininfo *li);",
      "int lastlog_write_entry(struct logininfo *li);",
      "int syslogin_write_entry(struct logininfo *li);",
      "int getlast_entry(struct logininfo *li);",
      "int lastlog_get_entry(struct logininfo *li);",
      "int utmpx_get_entry(struct logininfo *li);",
      "int wtmp_get_entry(struct logininfo *li);",
      "int wtmpx_get_entry(struct logininfo *li);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "endutxent",
          "args": [],
          "line": 1002
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pututxline",
          "args": [
            "utx"
          ],
          "line": 999
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "setutxent",
          "args": [],
          "line": 998
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "# include <util.h>\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"auth.h\"\n#include \"canohost.h\"\n#include \"packet.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"loginrec.h\"\n#include \"ssh.h\"\n#include \"hostfile.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdarg.h>\n#include <pwd.h>\n# include <paths.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint utmp_write_entry(struct logininfo *li);\nint utmpx_write_entry(struct logininfo *li);\nint wtmp_write_entry(struct logininfo *li);\nint wtmpx_write_entry(struct logininfo *li);\nint lastlog_write_entry(struct logininfo *li);\nint syslogin_write_entry(struct logininfo *li);\nint getlast_entry(struct logininfo *li);\nint lastlog_get_entry(struct logininfo *li);\nint utmpx_get_entry(struct logininfo *li);\nint wtmp_get_entry(struct logininfo *li);\nint wtmpx_get_entry(struct logininfo *li);\n\nstatic int\nutmpx_write_library(struct logininfo *li, struct utmpx *utx)\n{\n\tsetutxent();\n\tpututxline(utx);\n\n#  ifdef HAVE_ENDUTXENT\n\tendutxent();\n#  endif\n\treturn (1);\n}"
  },
  {
    "function_name": "utmp_write_entry",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
    "lines": "961-975",
    "snippet": "int\nutmp_write_entry(struct logininfo *li)\n{\n\tswitch(li->type) {\n\tcase LTYPE_LOGIN:\n\t\treturn (utmp_perform_login(li));\n\n\tcase LTYPE_LOGOUT:\n\t\treturn (utmp_perform_logout(li));\n\n\tdefault:\n\t\tlogit(\"%s: invalid type field\", __func__);\n\t\treturn (0);\n\t}\n}",
    "includes": [
      "# include <util.h>",
      "#include \"ssherr.h\"",
      "#include \"sshbuf.h\"",
      "#include \"auth.h\"",
      "#include \"canohost.h\"",
      "#include \"packet.h\"",
      "#include \"atomicio.h\"",
      "#include \"log.h\"",
      "#include \"loginrec.h\"",
      "#include \"ssh.h\"",
      "#include \"hostfile.h\"",
      "#include \"sshkey.h\"",
      "#include \"xmalloc.h\"",
      "#include <unistd.h>",
      "#include <time.h>",
      "#include <string.h>",
      "#include <stdarg.h>",
      "#include <pwd.h>",
      "# include <paths.h>",
      "#include <fcntl.h>",
      "#include <errno.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "int utmp_write_entry(struct logininfo *li);",
      "int utmpx_write_entry(struct logininfo *li);",
      "int wtmp_write_entry(struct logininfo *li);",
      "int wtmpx_write_entry(struct logininfo *li);",
      "int lastlog_write_entry(struct logininfo *li);",
      "int syslogin_write_entry(struct logininfo *li);",
      "int getlast_entry(struct logininfo *li);",
      "int lastlog_get_entry(struct logininfo *li);",
      "int utmpx_get_entry(struct logininfo *li);",
      "int wtmp_get_entry(struct logininfo *li);",
      "int wtmpx_get_entry(struct logininfo *li);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "logit",
          "args": [
            "\"%s: invalid type field\"",
            "__func__"
          ],
          "line": 972
        },
        "resolved": true,
        "details": {
          "function_name": "logit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/log.c",
          "lines": "198-206",
          "snippet": "void\nlogit(const char *fmt,...)\n{\n\tva_list args;\n\n\tva_start(args, fmt);\n\tdo_log(SYSLOG_LEVEL_INFO, fmt, args);\n\tva_end(args);\n}",
          "includes": [
            "#include \"log.h\"",
            "# include <vis.h>",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <syslog.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <fcntl.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n# include <vis.h>\n#include <errno.h>\n#include <unistd.h>\n#include <syslog.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <fcntl.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\nlogit(const char *fmt,...)\n{\n\tva_list args;\n\n\tva_start(args, fmt);\n\tdo_log(SYSLOG_LEVEL_INFO, fmt, args);\n\tva_end(args);\n}"
        }
      },
      {
        "call_info": {
          "callee": "utmp_perform_logout",
          "args": [
            "li"
          ],
          "line": 969
        },
        "resolved": true,
        "details": {
          "function_name": "utmp_perform_logout",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
          "lines": "940-958",
          "snippet": "static int\nutmp_perform_logout(struct logininfo *li)\n{\n\tstruct utmp ut;\n\n\tconstruct_utmp(li, &ut);\n# ifdef UTMP_USE_LIBRARY\n\tif (!utmp_write_library(li, &ut)) {\n\t\tlogit(\"%s: utmp_write_library() failed\", __func__);\n\t\treturn (0);\n\t}\n# else\n\tif (!utmp_write_direct(li, &ut)) {\n\t\tlogit(\"%s: utmp_write_direct() failed\", __func__);\n\t\treturn (0);\n\t}\n# endif\n\treturn (1);\n}",
          "includes": [
            "# include <util.h>",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"auth.h\"",
            "#include \"canohost.h\"",
            "#include \"packet.h\"",
            "#include \"atomicio.h\"",
            "#include \"log.h\"",
            "#include \"loginrec.h\"",
            "#include \"ssh.h\"",
            "#include \"hostfile.h\"",
            "#include \"sshkey.h\"",
            "#include \"xmalloc.h\"",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <string.h>",
            "#include <stdarg.h>",
            "#include <pwd.h>",
            "# include <paths.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "int utmp_write_entry(struct logininfo *li);",
            "int utmpx_write_entry(struct logininfo *li);",
            "int wtmp_write_entry(struct logininfo *li);",
            "int wtmpx_write_entry(struct logininfo *li);",
            "int lastlog_write_entry(struct logininfo *li);",
            "int syslogin_write_entry(struct logininfo *li);",
            "int getlast_entry(struct logininfo *li);",
            "int lastlog_get_entry(struct logininfo *li);",
            "int utmpx_get_entry(struct logininfo *li);",
            "int wtmp_get_entry(struct logininfo *li);",
            "int wtmpx_get_entry(struct logininfo *li);"
          ],
          "called_functions": [],
          "contextual_snippet": "# include <util.h>\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"auth.h\"\n#include \"canohost.h\"\n#include \"packet.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"loginrec.h\"\n#include \"ssh.h\"\n#include \"hostfile.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdarg.h>\n#include <pwd.h>\n# include <paths.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint utmp_write_entry(struct logininfo *li);\nint utmpx_write_entry(struct logininfo *li);\nint wtmp_write_entry(struct logininfo *li);\nint wtmpx_write_entry(struct logininfo *li);\nint lastlog_write_entry(struct logininfo *li);\nint syslogin_write_entry(struct logininfo *li);\nint getlast_entry(struct logininfo *li);\nint lastlog_get_entry(struct logininfo *li);\nint utmpx_get_entry(struct logininfo *li);\nint wtmp_get_entry(struct logininfo *li);\nint wtmpx_get_entry(struct logininfo *li);\n\nstatic int\nutmp_perform_logout(struct logininfo *li)\n{\n\tstruct utmp ut;\n\n\tconstruct_utmp(li, &ut);\n# ifdef UTMP_USE_LIBRARY\n\tif (!utmp_write_library(li, &ut)) {\n\t\tlogit(\"%s: utmp_write_library() failed\", __func__);\n\t\treturn (0);\n\t}\n# else\n\tif (!utmp_write_direct(li, &ut)) {\n\t\tlogit(\"%s: utmp_write_direct() failed\", __func__);\n\t\treturn (0);\n\t}\n# endif\n\treturn (1);\n}"
        }
      },
      {
        "call_info": {
          "callee": "utmp_perform_login",
          "args": [
            "li"
          ],
          "line": 966
        },
        "resolved": true,
        "details": {
          "function_name": "utmp_perform_login",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
          "lines": "919-937",
          "snippet": "static int\nutmp_perform_login(struct logininfo *li)\n{\n\tstruct utmp ut;\n\n\tconstruct_utmp(li, &ut);\n# ifdef UTMP_USE_LIBRARY\n\tif (!utmp_write_library(li, &ut)) {\n\t\tlogit(\"%s: utmp_write_library() failed\", __func__);\n\t\treturn (0);\n\t}\n# else\n\tif (!utmp_write_direct(li, &ut)) {\n\t\tlogit(\"%s: utmp_write_direct() failed\", __func__);\n\t\treturn (0);\n\t}\n# endif\n\treturn (1);\n}",
          "includes": [
            "# include <util.h>",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"auth.h\"",
            "#include \"canohost.h\"",
            "#include \"packet.h\"",
            "#include \"atomicio.h\"",
            "#include \"log.h\"",
            "#include \"loginrec.h\"",
            "#include \"ssh.h\"",
            "#include \"hostfile.h\"",
            "#include \"sshkey.h\"",
            "#include \"xmalloc.h\"",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <string.h>",
            "#include <stdarg.h>",
            "#include <pwd.h>",
            "# include <paths.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "int utmp_write_entry(struct logininfo *li);",
            "int utmpx_write_entry(struct logininfo *li);",
            "int wtmp_write_entry(struct logininfo *li);",
            "int wtmpx_write_entry(struct logininfo *li);",
            "int lastlog_write_entry(struct logininfo *li);",
            "int syslogin_write_entry(struct logininfo *li);",
            "int getlast_entry(struct logininfo *li);",
            "int lastlog_get_entry(struct logininfo *li);",
            "int utmpx_get_entry(struct logininfo *li);",
            "int wtmp_get_entry(struct logininfo *li);",
            "int wtmpx_get_entry(struct logininfo *li);"
          ],
          "called_functions": [],
          "contextual_snippet": "# include <util.h>\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"auth.h\"\n#include \"canohost.h\"\n#include \"packet.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"loginrec.h\"\n#include \"ssh.h\"\n#include \"hostfile.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdarg.h>\n#include <pwd.h>\n# include <paths.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint utmp_write_entry(struct logininfo *li);\nint utmpx_write_entry(struct logininfo *li);\nint wtmp_write_entry(struct logininfo *li);\nint wtmpx_write_entry(struct logininfo *li);\nint lastlog_write_entry(struct logininfo *li);\nint syslogin_write_entry(struct logininfo *li);\nint getlast_entry(struct logininfo *li);\nint lastlog_get_entry(struct logininfo *li);\nint utmpx_get_entry(struct logininfo *li);\nint wtmp_get_entry(struct logininfo *li);\nint wtmpx_get_entry(struct logininfo *li);\n\nstatic int\nutmp_perform_login(struct logininfo *li)\n{\n\tstruct utmp ut;\n\n\tconstruct_utmp(li, &ut);\n# ifdef UTMP_USE_LIBRARY\n\tif (!utmp_write_library(li, &ut)) {\n\t\tlogit(\"%s: utmp_write_library() failed\", __func__);\n\t\treturn (0);\n\t}\n# else\n\tif (!utmp_write_direct(li, &ut)) {\n\t\tlogit(\"%s: utmp_write_direct() failed\", __func__);\n\t\treturn (0);\n\t}\n# endif\n\treturn (1);\n}"
        }
      }
    ],
    "contextual_snippet": "# include <util.h>\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"auth.h\"\n#include \"canohost.h\"\n#include \"packet.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"loginrec.h\"\n#include \"ssh.h\"\n#include \"hostfile.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdarg.h>\n#include <pwd.h>\n# include <paths.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint utmp_write_entry(struct logininfo *li);\nint utmpx_write_entry(struct logininfo *li);\nint wtmp_write_entry(struct logininfo *li);\nint wtmpx_write_entry(struct logininfo *li);\nint lastlog_write_entry(struct logininfo *li);\nint syslogin_write_entry(struct logininfo *li);\nint getlast_entry(struct logininfo *li);\nint lastlog_get_entry(struct logininfo *li);\nint utmpx_get_entry(struct logininfo *li);\nint wtmp_get_entry(struct logininfo *li);\nint wtmpx_get_entry(struct logininfo *li);\n\nint\nutmp_write_entry(struct logininfo *li)\n{\n\tswitch(li->type) {\n\tcase LTYPE_LOGIN:\n\t\treturn (utmp_perform_login(li));\n\n\tcase LTYPE_LOGOUT:\n\t\treturn (utmp_perform_logout(li));\n\n\tdefault:\n\t\tlogit(\"%s: invalid type field\", __func__);\n\t\treturn (0);\n\t}\n}"
  },
  {
    "function_name": "utmp_perform_logout",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
    "lines": "940-958",
    "snippet": "static int\nutmp_perform_logout(struct logininfo *li)\n{\n\tstruct utmp ut;\n\n\tconstruct_utmp(li, &ut);\n# ifdef UTMP_USE_LIBRARY\n\tif (!utmp_write_library(li, &ut)) {\n\t\tlogit(\"%s: utmp_write_library() failed\", __func__);\n\t\treturn (0);\n\t}\n# else\n\tif (!utmp_write_direct(li, &ut)) {\n\t\tlogit(\"%s: utmp_write_direct() failed\", __func__);\n\t\treturn (0);\n\t}\n# endif\n\treturn (1);\n}",
    "includes": [
      "# include <util.h>",
      "#include \"ssherr.h\"",
      "#include \"sshbuf.h\"",
      "#include \"auth.h\"",
      "#include \"canohost.h\"",
      "#include \"packet.h\"",
      "#include \"atomicio.h\"",
      "#include \"log.h\"",
      "#include \"loginrec.h\"",
      "#include \"ssh.h\"",
      "#include \"hostfile.h\"",
      "#include \"sshkey.h\"",
      "#include \"xmalloc.h\"",
      "#include <unistd.h>",
      "#include <time.h>",
      "#include <string.h>",
      "#include <stdarg.h>",
      "#include <pwd.h>",
      "# include <paths.h>",
      "#include <fcntl.h>",
      "#include <errno.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "int utmp_write_entry(struct logininfo *li);",
      "int utmpx_write_entry(struct logininfo *li);",
      "int wtmp_write_entry(struct logininfo *li);",
      "int wtmpx_write_entry(struct logininfo *li);",
      "int lastlog_write_entry(struct logininfo *li);",
      "int syslogin_write_entry(struct logininfo *li);",
      "int getlast_entry(struct logininfo *li);",
      "int lastlog_get_entry(struct logininfo *li);",
      "int utmpx_get_entry(struct logininfo *li);",
      "int wtmp_get_entry(struct logininfo *li);",
      "int wtmpx_get_entry(struct logininfo *li);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "logit",
          "args": [
            "\"%s: utmp_write_direct() failed\"",
            "__func__"
          ],
          "line": 953
        },
        "resolved": true,
        "details": {
          "function_name": "logit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/log.c",
          "lines": "198-206",
          "snippet": "void\nlogit(const char *fmt,...)\n{\n\tva_list args;\n\n\tva_start(args, fmt);\n\tdo_log(SYSLOG_LEVEL_INFO, fmt, args);\n\tva_end(args);\n}",
          "includes": [
            "#include \"log.h\"",
            "# include <vis.h>",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <syslog.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <fcntl.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n# include <vis.h>\n#include <errno.h>\n#include <unistd.h>\n#include <syslog.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <fcntl.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\nlogit(const char *fmt,...)\n{\n\tva_list args;\n\n\tva_start(args, fmt);\n\tdo_log(SYSLOG_LEVEL_INFO, fmt, args);\n\tva_end(args);\n}"
        }
      },
      {
        "call_info": {
          "callee": "utmp_write_direct",
          "args": [
            "li",
            "&ut"
          ],
          "line": 952
        },
        "resolved": true,
        "details": {
          "function_name": "utmp_write_direct",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
          "lines": "836-916",
          "snippet": "static int\nutmp_write_direct(struct logininfo *li, struct utmp *ut)\n{\n\tstruct utmp old_ut;\n\tregister int fd;\n\tint tty;\n\n\t/* FIXME: (ATL) ttyslot() needs local implementation */\n\n#if defined(HAVE_GETTTYENT)\n\tstruct ttyent *ty;\n\n\ttty=0;\n\tsetttyent();\n\twhile (NULL != (ty = getttyent())) {\n\t\ttty++;\n\t\tif (!strncmp(ty->ty_name, ut->ut_line, sizeof(ut->ut_line)))\n\t\t\tbreak;\n\t}\n\tendttyent();\n\n\tif (NULL == ty) {\n\t\tlogit(\"%s: tty not found\", __func__);\n\t\treturn (0);\n\t}\n#else /* FIXME */\n\n\ttty = ttyslot(); /* seems only to work for /dev/ttyp? style names */\n\n#endif /* HAVE_GETTTYENT */\n\n\tif (tty > 0 && (fd = open(UTMP_FILE, O_RDWR|O_CREAT, 0644)) >= 0) {\n\t\toff_t pos, ret;\n\n\t\tpos = (off_t)tty * sizeof(struct utmp);\n\t\tif ((ret = lseek(fd, pos, SEEK_SET)) == -1) {\n\t\t\tlogit(\"%s: lseek: %s\", __func__, strerror(errno));\n\t\t\tclose(fd);\n\t\t\treturn (0);\n\t\t}\n\t\tif (ret != pos) {\n\t\t\tlogit(\"%s: Couldn't seek to tty %d slot in %s\",\n\t\t\t    __func__, tty, UTMP_FILE);\n\t\t\tclose(fd);\n\t\t\treturn (0);\n\t\t}\n\t\t/*\n\t\t * Prevent luser from zero'ing out ut_host.\n\t\t * If the new ut_line is empty but the old one is not\n\t\t * and ut_line and ut_name match, preserve the old ut_line.\n\t\t */\n\t\tif (atomicio(read, fd, &old_ut, sizeof(old_ut)) == sizeof(old_ut) &&\n\t\t    (ut->ut_host[0] == '\\0') && (old_ut.ut_host[0] != '\\0') &&\n\t\t    (strncmp(old_ut.ut_line, ut->ut_line, sizeof(ut->ut_line)) == 0) &&\n\t\t    (strncmp(old_ut.ut_name, ut->ut_name, sizeof(ut->ut_name)) == 0))\n\t\t\tmemcpy(ut->ut_host, old_ut.ut_host, sizeof(ut->ut_host));\n\n\t\tif ((ret = lseek(fd, pos, SEEK_SET)) == -1) {\n\t\t\tlogit(\"%s: lseek: %s\", __func__, strerror(errno));\n\t\t\tclose(fd);\n\t\t\treturn (0);\n\t\t}\n\t\tif (ret != pos) {\n\t\t\tlogit(\"%s: Couldn't seek to tty %d slot in %s\",\n\t\t\t    __func__, tty, UTMP_FILE);\n\t\t\tclose(fd);\n\t\t\treturn (0);\n\t\t}\n\t\tif (atomicio(vwrite, fd, ut, sizeof(*ut)) != sizeof(*ut)) {\n\t\t\tlogit(\"%s: error writing %s: %s\", __func__,\n\t\t\t    UTMP_FILE, strerror(errno));\n\t\t\tclose(fd);\n\t\t\treturn (0);\n\t\t}\n\n\t\tclose(fd);\n\t\treturn (1);\n\t} else {\n\t\treturn (0);\n\t}\n}",
          "includes": [
            "# include <util.h>",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"auth.h\"",
            "#include \"canohost.h\"",
            "#include \"packet.h\"",
            "#include \"atomicio.h\"",
            "#include \"log.h\"",
            "#include \"loginrec.h\"",
            "#include \"ssh.h\"",
            "#include \"hostfile.h\"",
            "#include \"sshkey.h\"",
            "#include \"xmalloc.h\"",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <string.h>",
            "#include <stdarg.h>",
            "#include <pwd.h>",
            "# include <paths.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "int utmp_write_entry(struct logininfo *li);",
            "int utmpx_write_entry(struct logininfo *li);",
            "int wtmp_write_entry(struct logininfo *li);",
            "int wtmpx_write_entry(struct logininfo *li);",
            "int lastlog_write_entry(struct logininfo *li);",
            "int syslogin_write_entry(struct logininfo *li);",
            "int getlast_entry(struct logininfo *li);",
            "int lastlog_get_entry(struct logininfo *li);",
            "int utmpx_get_entry(struct logininfo *li);",
            "int wtmp_get_entry(struct logininfo *li);",
            "int wtmpx_get_entry(struct logininfo *li);"
          ],
          "called_functions": [],
          "contextual_snippet": "# include <util.h>\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"auth.h\"\n#include \"canohost.h\"\n#include \"packet.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"loginrec.h\"\n#include \"ssh.h\"\n#include \"hostfile.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdarg.h>\n#include <pwd.h>\n# include <paths.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint utmp_write_entry(struct logininfo *li);\nint utmpx_write_entry(struct logininfo *li);\nint wtmp_write_entry(struct logininfo *li);\nint wtmpx_write_entry(struct logininfo *li);\nint lastlog_write_entry(struct logininfo *li);\nint syslogin_write_entry(struct logininfo *li);\nint getlast_entry(struct logininfo *li);\nint lastlog_get_entry(struct logininfo *li);\nint utmpx_get_entry(struct logininfo *li);\nint wtmp_get_entry(struct logininfo *li);\nint wtmpx_get_entry(struct logininfo *li);\n\nstatic int\nutmp_write_direct(struct logininfo *li, struct utmp *ut)\n{\n\tstruct utmp old_ut;\n\tregister int fd;\n\tint tty;\n\n\t/* FIXME: (ATL) ttyslot() needs local implementation */\n\n#if defined(HAVE_GETTTYENT)\n\tstruct ttyent *ty;\n\n\ttty=0;\n\tsetttyent();\n\twhile (NULL != (ty = getttyent())) {\n\t\ttty++;\n\t\tif (!strncmp(ty->ty_name, ut->ut_line, sizeof(ut->ut_line)))\n\t\t\tbreak;\n\t}\n\tendttyent();\n\n\tif (NULL == ty) {\n\t\tlogit(\"%s: tty not found\", __func__);\n\t\treturn (0);\n\t}\n#else /* FIXME */\n\n\ttty = ttyslot(); /* seems only to work for /dev/ttyp? style names */\n\n#endif /* HAVE_GETTTYENT */\n\n\tif (tty > 0 && (fd = open(UTMP_FILE, O_RDWR|O_CREAT, 0644)) >= 0) {\n\t\toff_t pos, ret;\n\n\t\tpos = (off_t)tty * sizeof(struct utmp);\n\t\tif ((ret = lseek(fd, pos, SEEK_SET)) == -1) {\n\t\t\tlogit(\"%s: lseek: %s\", __func__, strerror(errno));\n\t\t\tclose(fd);\n\t\t\treturn (0);\n\t\t}\n\t\tif (ret != pos) {\n\t\t\tlogit(\"%s: Couldn't seek to tty %d slot in %s\",\n\t\t\t    __func__, tty, UTMP_FILE);\n\t\t\tclose(fd);\n\t\t\treturn (0);\n\t\t}\n\t\t/*\n\t\t * Prevent luser from zero'ing out ut_host.\n\t\t * If the new ut_line is empty but the old one is not\n\t\t * and ut_line and ut_name match, preserve the old ut_line.\n\t\t */\n\t\tif (atomicio(read, fd, &old_ut, sizeof(old_ut)) == sizeof(old_ut) &&\n\t\t    (ut->ut_host[0] == '\\0') && (old_ut.ut_host[0] != '\\0') &&\n\t\t    (strncmp(old_ut.ut_line, ut->ut_line, sizeof(ut->ut_line)) == 0) &&\n\t\t    (strncmp(old_ut.ut_name, ut->ut_name, sizeof(ut->ut_name)) == 0))\n\t\t\tmemcpy(ut->ut_host, old_ut.ut_host, sizeof(ut->ut_host));\n\n\t\tif ((ret = lseek(fd, pos, SEEK_SET)) == -1) {\n\t\t\tlogit(\"%s: lseek: %s\", __func__, strerror(errno));\n\t\t\tclose(fd);\n\t\t\treturn (0);\n\t\t}\n\t\tif (ret != pos) {\n\t\t\tlogit(\"%s: Couldn't seek to tty %d slot in %s\",\n\t\t\t    __func__, tty, UTMP_FILE);\n\t\t\tclose(fd);\n\t\t\treturn (0);\n\t\t}\n\t\tif (atomicio(vwrite, fd, ut, sizeof(*ut)) != sizeof(*ut)) {\n\t\t\tlogit(\"%s: error writing %s: %s\", __func__,\n\t\t\t    UTMP_FILE, strerror(errno));\n\t\t\tclose(fd);\n\t\t\treturn (0);\n\t\t}\n\n\t\tclose(fd);\n\t\treturn (1);\n\t} else {\n\t\treturn (0);\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "utmp_write_library",
          "args": [
            "li",
            "&ut"
          ],
          "line": 947
        },
        "resolved": true,
        "details": {
          "function_name": "utmp_write_library",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
          "lines": "820-829",
          "snippet": "static int\nutmp_write_library(struct logininfo *li, struct utmp *ut)\n{\n\tsetutent();\n\tpututline(ut);\n#  ifdef HAVE_ENDUTENT\n\tendutent();\n#  endif\n\treturn (1);\n}",
          "includes": [
            "# include <util.h>",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"auth.h\"",
            "#include \"canohost.h\"",
            "#include \"packet.h\"",
            "#include \"atomicio.h\"",
            "#include \"log.h\"",
            "#include \"loginrec.h\"",
            "#include \"ssh.h\"",
            "#include \"hostfile.h\"",
            "#include \"sshkey.h\"",
            "#include \"xmalloc.h\"",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <string.h>",
            "#include <stdarg.h>",
            "#include <pwd.h>",
            "# include <paths.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "int utmp_write_entry(struct logininfo *li);",
            "int utmpx_write_entry(struct logininfo *li);",
            "int wtmp_write_entry(struct logininfo *li);",
            "int wtmpx_write_entry(struct logininfo *li);",
            "int lastlog_write_entry(struct logininfo *li);",
            "int syslogin_write_entry(struct logininfo *li);",
            "int getlast_entry(struct logininfo *li);",
            "int lastlog_get_entry(struct logininfo *li);",
            "int utmpx_get_entry(struct logininfo *li);",
            "int wtmp_get_entry(struct logininfo *li);",
            "int wtmpx_get_entry(struct logininfo *li);"
          ],
          "called_functions": [],
          "contextual_snippet": "# include <util.h>\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"auth.h\"\n#include \"canohost.h\"\n#include \"packet.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"loginrec.h\"\n#include \"ssh.h\"\n#include \"hostfile.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdarg.h>\n#include <pwd.h>\n# include <paths.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint utmp_write_entry(struct logininfo *li);\nint utmpx_write_entry(struct logininfo *li);\nint wtmp_write_entry(struct logininfo *li);\nint wtmpx_write_entry(struct logininfo *li);\nint lastlog_write_entry(struct logininfo *li);\nint syslogin_write_entry(struct logininfo *li);\nint getlast_entry(struct logininfo *li);\nint lastlog_get_entry(struct logininfo *li);\nint utmpx_get_entry(struct logininfo *li);\nint wtmp_get_entry(struct logininfo *li);\nint wtmpx_get_entry(struct logininfo *li);\n\nstatic int\nutmp_write_library(struct logininfo *li, struct utmp *ut)\n{\n\tsetutent();\n\tpututline(ut);\n#  ifdef HAVE_ENDUTENT\n\tendutent();\n#  endif\n\treturn (1);\n}"
        }
      },
      {
        "call_info": {
          "callee": "construct_utmp",
          "args": [
            "li",
            "&ut"
          ],
          "line": 945
        },
        "resolved": true,
        "details": {
          "function_name": "construct_utmpx",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
          "lines": "738-801",
          "snippet": "void\nconstruct_utmpx(struct logininfo *li, struct utmpx *utx)\n{\n# ifdef HAVE_ADDR_V6_IN_UTMP\n\tstruct sockaddr_in6 *sa6;\n#  endif\n\tmemset(utx, '\\0', sizeof(*utx));\n\n# ifdef HAVE_ID_IN_UTMPX\n\tline_abbrevname(utx->ut_id, li->line, sizeof(utx->ut_id));\n# endif\n\n\t/* this is done here to keep utmp constants out of loginrec.h */\n\tswitch (li->type) {\n\tcase LTYPE_LOGIN:\n\t\tutx->ut_type = USER_PROCESS;\n\t\tbreak;\n\tcase LTYPE_LOGOUT:\n\t\tutx->ut_type = DEAD_PROCESS;\n\t\tbreak;\n\t}\n\tline_stripname(utx->ut_line, li->line, sizeof(utx->ut_line));\n\tset_utmpx_time(li, utx);\n\tutx->ut_pid = li->pid;\n\n\t/* strncpy(): Don't necessarily want null termination */\n\tstrncpy(utx->ut_user, li->username,\n\t    MIN_SIZEOF(utx->ut_user, li->username));\n\n\tif (li->type == LTYPE_LOGOUT)\n\t\treturn;\n\n\t/*\n\t * These fields are only used when logging in, and are blank\n\t * for logouts.\n\t */\n\n# ifdef HAVE_HOST_IN_UTMPX\n\tstrncpy(utx->ut_host, li->hostname,\n\t    MIN_SIZEOF(utx->ut_host, li->hostname));\n# endif\n# ifdef HAVE_ADDR_IN_UTMPX\n\t/* this is just a 32-bit IP address */\n\tif (li->hostaddr.sa.sa_family == AF_INET)\n\t\tutx->ut_addr = li->hostaddr.sa_in.sin_addr.s_addr;\n# endif\n# ifdef HAVE_ADDR_V6_IN_UTMP\n\t/* this is just a 128-bit IPv6 address */\n\tif (li->hostaddr.sa.sa_family == AF_INET6) {\n\t\tsa6 = ((struct sockaddr_in6 *)&li->hostaddr.sa);\n\t\tmemcpy(utx->ut_addr_v6, sa6->sin6_addr.s6_addr, 16);\n\t\tif (IN6_IS_ADDR_V4MAPPED(&sa6->sin6_addr)) {\n\t\t\tutx->ut_addr_v6[0] = utx->ut_addr_v6[3];\n\t\t\tutx->ut_addr_v6[1] = 0;\n\t\t\tutx->ut_addr_v6[2] = 0;\n\t\t\tutx->ut_addr_v6[3] = 0;\n\t\t}\n\t}\n# endif\n# ifdef HAVE_SYSLEN_IN_UTMPX\n\t/* ut_syslen is the length of the utx_host string */\n\tutx->ut_syslen = MIN(strlen(li->hostname), sizeof(utx->ut_host));\n# endif\n}",
          "includes": [
            "# include <util.h>",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"auth.h\"",
            "#include \"canohost.h\"",
            "#include \"packet.h\"",
            "#include \"atomicio.h\"",
            "#include \"log.h\"",
            "#include \"loginrec.h\"",
            "#include \"ssh.h\"",
            "#include \"hostfile.h\"",
            "#include \"sshkey.h\"",
            "#include \"xmalloc.h\"",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <string.h>",
            "#include <stdarg.h>",
            "#include <pwd.h>",
            "# include <paths.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "int utmp_write_entry(struct logininfo *li);",
            "int utmpx_write_entry(struct logininfo *li);",
            "int wtmp_write_entry(struct logininfo *li);",
            "int wtmpx_write_entry(struct logininfo *li);",
            "int lastlog_write_entry(struct logininfo *li);",
            "int syslogin_write_entry(struct logininfo *li);",
            "int getlast_entry(struct logininfo *li);",
            "int lastlog_get_entry(struct logininfo *li);",
            "int utmpx_get_entry(struct logininfo *li);",
            "int wtmp_get_entry(struct logininfo *li);",
            "int wtmpx_get_entry(struct logininfo *li);"
          ],
          "called_functions": [],
          "contextual_snippet": "# include <util.h>\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"auth.h\"\n#include \"canohost.h\"\n#include \"packet.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"loginrec.h\"\n#include \"ssh.h\"\n#include \"hostfile.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdarg.h>\n#include <pwd.h>\n# include <paths.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint utmp_write_entry(struct logininfo *li);\nint utmpx_write_entry(struct logininfo *li);\nint wtmp_write_entry(struct logininfo *li);\nint wtmpx_write_entry(struct logininfo *li);\nint lastlog_write_entry(struct logininfo *li);\nint syslogin_write_entry(struct logininfo *li);\nint getlast_entry(struct logininfo *li);\nint lastlog_get_entry(struct logininfo *li);\nint utmpx_get_entry(struct logininfo *li);\nint wtmp_get_entry(struct logininfo *li);\nint wtmpx_get_entry(struct logininfo *li);\n\nvoid\nconstruct_utmpx(struct logininfo *li, struct utmpx *utx)\n{\n# ifdef HAVE_ADDR_V6_IN_UTMP\n\tstruct sockaddr_in6 *sa6;\n#  endif\n\tmemset(utx, '\\0', sizeof(*utx));\n\n# ifdef HAVE_ID_IN_UTMPX\n\tline_abbrevname(utx->ut_id, li->line, sizeof(utx->ut_id));\n# endif\n\n\t/* this is done here to keep utmp constants out of loginrec.h */\n\tswitch (li->type) {\n\tcase LTYPE_LOGIN:\n\t\tutx->ut_type = USER_PROCESS;\n\t\tbreak;\n\tcase LTYPE_LOGOUT:\n\t\tutx->ut_type = DEAD_PROCESS;\n\t\tbreak;\n\t}\n\tline_stripname(utx->ut_line, li->line, sizeof(utx->ut_line));\n\tset_utmpx_time(li, utx);\n\tutx->ut_pid = li->pid;\n\n\t/* strncpy(): Don't necessarily want null termination */\n\tstrncpy(utx->ut_user, li->username,\n\t    MIN_SIZEOF(utx->ut_user, li->username));\n\n\tif (li->type == LTYPE_LOGOUT)\n\t\treturn;\n\n\t/*\n\t * These fields are only used when logging in, and are blank\n\t * for logouts.\n\t */\n\n# ifdef HAVE_HOST_IN_UTMPX\n\tstrncpy(utx->ut_host, li->hostname,\n\t    MIN_SIZEOF(utx->ut_host, li->hostname));\n# endif\n# ifdef HAVE_ADDR_IN_UTMPX\n\t/* this is just a 32-bit IP address */\n\tif (li->hostaddr.sa.sa_family == AF_INET)\n\t\tutx->ut_addr = li->hostaddr.sa_in.sin_addr.s_addr;\n# endif\n# ifdef HAVE_ADDR_V6_IN_UTMP\n\t/* this is just a 128-bit IPv6 address */\n\tif (li->hostaddr.sa.sa_family == AF_INET6) {\n\t\tsa6 = ((struct sockaddr_in6 *)&li->hostaddr.sa);\n\t\tmemcpy(utx->ut_addr_v6, sa6->sin6_addr.s6_addr, 16);\n\t\tif (IN6_IS_ADDR_V4MAPPED(&sa6->sin6_addr)) {\n\t\t\tutx->ut_addr_v6[0] = utx->ut_addr_v6[3];\n\t\t\tutx->ut_addr_v6[1] = 0;\n\t\t\tutx->ut_addr_v6[2] = 0;\n\t\t\tutx->ut_addr_v6[3] = 0;\n\t\t}\n\t}\n# endif\n# ifdef HAVE_SYSLEN_IN_UTMPX\n\t/* ut_syslen is the length of the utx_host string */\n\tutx->ut_syslen = MIN(strlen(li->hostname), sizeof(utx->ut_host));\n# endif\n}"
        }
      }
    ],
    "contextual_snippet": "# include <util.h>\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"auth.h\"\n#include \"canohost.h\"\n#include \"packet.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"loginrec.h\"\n#include \"ssh.h\"\n#include \"hostfile.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdarg.h>\n#include <pwd.h>\n# include <paths.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint utmp_write_entry(struct logininfo *li);\nint utmpx_write_entry(struct logininfo *li);\nint wtmp_write_entry(struct logininfo *li);\nint wtmpx_write_entry(struct logininfo *li);\nint lastlog_write_entry(struct logininfo *li);\nint syslogin_write_entry(struct logininfo *li);\nint getlast_entry(struct logininfo *li);\nint lastlog_get_entry(struct logininfo *li);\nint utmpx_get_entry(struct logininfo *li);\nint wtmp_get_entry(struct logininfo *li);\nint wtmpx_get_entry(struct logininfo *li);\n\nstatic int\nutmp_perform_logout(struct logininfo *li)\n{\n\tstruct utmp ut;\n\n\tconstruct_utmp(li, &ut);\n# ifdef UTMP_USE_LIBRARY\n\tif (!utmp_write_library(li, &ut)) {\n\t\tlogit(\"%s: utmp_write_library() failed\", __func__);\n\t\treturn (0);\n\t}\n# else\n\tif (!utmp_write_direct(li, &ut)) {\n\t\tlogit(\"%s: utmp_write_direct() failed\", __func__);\n\t\treturn (0);\n\t}\n# endif\n\treturn (1);\n}"
  },
  {
    "function_name": "utmp_perform_login",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
    "lines": "919-937",
    "snippet": "static int\nutmp_perform_login(struct logininfo *li)\n{\n\tstruct utmp ut;\n\n\tconstruct_utmp(li, &ut);\n# ifdef UTMP_USE_LIBRARY\n\tif (!utmp_write_library(li, &ut)) {\n\t\tlogit(\"%s: utmp_write_library() failed\", __func__);\n\t\treturn (0);\n\t}\n# else\n\tif (!utmp_write_direct(li, &ut)) {\n\t\tlogit(\"%s: utmp_write_direct() failed\", __func__);\n\t\treturn (0);\n\t}\n# endif\n\treturn (1);\n}",
    "includes": [
      "# include <util.h>",
      "#include \"ssherr.h\"",
      "#include \"sshbuf.h\"",
      "#include \"auth.h\"",
      "#include \"canohost.h\"",
      "#include \"packet.h\"",
      "#include \"atomicio.h\"",
      "#include \"log.h\"",
      "#include \"loginrec.h\"",
      "#include \"ssh.h\"",
      "#include \"hostfile.h\"",
      "#include \"sshkey.h\"",
      "#include \"xmalloc.h\"",
      "#include <unistd.h>",
      "#include <time.h>",
      "#include <string.h>",
      "#include <stdarg.h>",
      "#include <pwd.h>",
      "# include <paths.h>",
      "#include <fcntl.h>",
      "#include <errno.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "int utmp_write_entry(struct logininfo *li);",
      "int utmpx_write_entry(struct logininfo *li);",
      "int wtmp_write_entry(struct logininfo *li);",
      "int wtmpx_write_entry(struct logininfo *li);",
      "int lastlog_write_entry(struct logininfo *li);",
      "int syslogin_write_entry(struct logininfo *li);",
      "int getlast_entry(struct logininfo *li);",
      "int lastlog_get_entry(struct logininfo *li);",
      "int utmpx_get_entry(struct logininfo *li);",
      "int wtmp_get_entry(struct logininfo *li);",
      "int wtmpx_get_entry(struct logininfo *li);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "logit",
          "args": [
            "\"%s: utmp_write_direct() failed\"",
            "__func__"
          ],
          "line": 932
        },
        "resolved": true,
        "details": {
          "function_name": "logit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/log.c",
          "lines": "198-206",
          "snippet": "void\nlogit(const char *fmt,...)\n{\n\tva_list args;\n\n\tva_start(args, fmt);\n\tdo_log(SYSLOG_LEVEL_INFO, fmt, args);\n\tva_end(args);\n}",
          "includes": [
            "#include \"log.h\"",
            "# include <vis.h>",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <syslog.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <fcntl.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n# include <vis.h>\n#include <errno.h>\n#include <unistd.h>\n#include <syslog.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <fcntl.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\nlogit(const char *fmt,...)\n{\n\tva_list args;\n\n\tva_start(args, fmt);\n\tdo_log(SYSLOG_LEVEL_INFO, fmt, args);\n\tva_end(args);\n}"
        }
      },
      {
        "call_info": {
          "callee": "utmp_write_direct",
          "args": [
            "li",
            "&ut"
          ],
          "line": 931
        },
        "resolved": true,
        "details": {
          "function_name": "utmp_write_direct",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
          "lines": "836-916",
          "snippet": "static int\nutmp_write_direct(struct logininfo *li, struct utmp *ut)\n{\n\tstruct utmp old_ut;\n\tregister int fd;\n\tint tty;\n\n\t/* FIXME: (ATL) ttyslot() needs local implementation */\n\n#if defined(HAVE_GETTTYENT)\n\tstruct ttyent *ty;\n\n\ttty=0;\n\tsetttyent();\n\twhile (NULL != (ty = getttyent())) {\n\t\ttty++;\n\t\tif (!strncmp(ty->ty_name, ut->ut_line, sizeof(ut->ut_line)))\n\t\t\tbreak;\n\t}\n\tendttyent();\n\n\tif (NULL == ty) {\n\t\tlogit(\"%s: tty not found\", __func__);\n\t\treturn (0);\n\t}\n#else /* FIXME */\n\n\ttty = ttyslot(); /* seems only to work for /dev/ttyp? style names */\n\n#endif /* HAVE_GETTTYENT */\n\n\tif (tty > 0 && (fd = open(UTMP_FILE, O_RDWR|O_CREAT, 0644)) >= 0) {\n\t\toff_t pos, ret;\n\n\t\tpos = (off_t)tty * sizeof(struct utmp);\n\t\tif ((ret = lseek(fd, pos, SEEK_SET)) == -1) {\n\t\t\tlogit(\"%s: lseek: %s\", __func__, strerror(errno));\n\t\t\tclose(fd);\n\t\t\treturn (0);\n\t\t}\n\t\tif (ret != pos) {\n\t\t\tlogit(\"%s: Couldn't seek to tty %d slot in %s\",\n\t\t\t    __func__, tty, UTMP_FILE);\n\t\t\tclose(fd);\n\t\t\treturn (0);\n\t\t}\n\t\t/*\n\t\t * Prevent luser from zero'ing out ut_host.\n\t\t * If the new ut_line is empty but the old one is not\n\t\t * and ut_line and ut_name match, preserve the old ut_line.\n\t\t */\n\t\tif (atomicio(read, fd, &old_ut, sizeof(old_ut)) == sizeof(old_ut) &&\n\t\t    (ut->ut_host[0] == '\\0') && (old_ut.ut_host[0] != '\\0') &&\n\t\t    (strncmp(old_ut.ut_line, ut->ut_line, sizeof(ut->ut_line)) == 0) &&\n\t\t    (strncmp(old_ut.ut_name, ut->ut_name, sizeof(ut->ut_name)) == 0))\n\t\t\tmemcpy(ut->ut_host, old_ut.ut_host, sizeof(ut->ut_host));\n\n\t\tif ((ret = lseek(fd, pos, SEEK_SET)) == -1) {\n\t\t\tlogit(\"%s: lseek: %s\", __func__, strerror(errno));\n\t\t\tclose(fd);\n\t\t\treturn (0);\n\t\t}\n\t\tif (ret != pos) {\n\t\t\tlogit(\"%s: Couldn't seek to tty %d slot in %s\",\n\t\t\t    __func__, tty, UTMP_FILE);\n\t\t\tclose(fd);\n\t\t\treturn (0);\n\t\t}\n\t\tif (atomicio(vwrite, fd, ut, sizeof(*ut)) != sizeof(*ut)) {\n\t\t\tlogit(\"%s: error writing %s: %s\", __func__,\n\t\t\t    UTMP_FILE, strerror(errno));\n\t\t\tclose(fd);\n\t\t\treturn (0);\n\t\t}\n\n\t\tclose(fd);\n\t\treturn (1);\n\t} else {\n\t\treturn (0);\n\t}\n}",
          "includes": [
            "# include <util.h>",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"auth.h\"",
            "#include \"canohost.h\"",
            "#include \"packet.h\"",
            "#include \"atomicio.h\"",
            "#include \"log.h\"",
            "#include \"loginrec.h\"",
            "#include \"ssh.h\"",
            "#include \"hostfile.h\"",
            "#include \"sshkey.h\"",
            "#include \"xmalloc.h\"",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <string.h>",
            "#include <stdarg.h>",
            "#include <pwd.h>",
            "# include <paths.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "int utmp_write_entry(struct logininfo *li);",
            "int utmpx_write_entry(struct logininfo *li);",
            "int wtmp_write_entry(struct logininfo *li);",
            "int wtmpx_write_entry(struct logininfo *li);",
            "int lastlog_write_entry(struct logininfo *li);",
            "int syslogin_write_entry(struct logininfo *li);",
            "int getlast_entry(struct logininfo *li);",
            "int lastlog_get_entry(struct logininfo *li);",
            "int utmpx_get_entry(struct logininfo *li);",
            "int wtmp_get_entry(struct logininfo *li);",
            "int wtmpx_get_entry(struct logininfo *li);"
          ],
          "called_functions": [],
          "contextual_snippet": "# include <util.h>\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"auth.h\"\n#include \"canohost.h\"\n#include \"packet.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"loginrec.h\"\n#include \"ssh.h\"\n#include \"hostfile.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdarg.h>\n#include <pwd.h>\n# include <paths.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint utmp_write_entry(struct logininfo *li);\nint utmpx_write_entry(struct logininfo *li);\nint wtmp_write_entry(struct logininfo *li);\nint wtmpx_write_entry(struct logininfo *li);\nint lastlog_write_entry(struct logininfo *li);\nint syslogin_write_entry(struct logininfo *li);\nint getlast_entry(struct logininfo *li);\nint lastlog_get_entry(struct logininfo *li);\nint utmpx_get_entry(struct logininfo *li);\nint wtmp_get_entry(struct logininfo *li);\nint wtmpx_get_entry(struct logininfo *li);\n\nstatic int\nutmp_write_direct(struct logininfo *li, struct utmp *ut)\n{\n\tstruct utmp old_ut;\n\tregister int fd;\n\tint tty;\n\n\t/* FIXME: (ATL) ttyslot() needs local implementation */\n\n#if defined(HAVE_GETTTYENT)\n\tstruct ttyent *ty;\n\n\ttty=0;\n\tsetttyent();\n\twhile (NULL != (ty = getttyent())) {\n\t\ttty++;\n\t\tif (!strncmp(ty->ty_name, ut->ut_line, sizeof(ut->ut_line)))\n\t\t\tbreak;\n\t}\n\tendttyent();\n\n\tif (NULL == ty) {\n\t\tlogit(\"%s: tty not found\", __func__);\n\t\treturn (0);\n\t}\n#else /* FIXME */\n\n\ttty = ttyslot(); /* seems only to work for /dev/ttyp? style names */\n\n#endif /* HAVE_GETTTYENT */\n\n\tif (tty > 0 && (fd = open(UTMP_FILE, O_RDWR|O_CREAT, 0644)) >= 0) {\n\t\toff_t pos, ret;\n\n\t\tpos = (off_t)tty * sizeof(struct utmp);\n\t\tif ((ret = lseek(fd, pos, SEEK_SET)) == -1) {\n\t\t\tlogit(\"%s: lseek: %s\", __func__, strerror(errno));\n\t\t\tclose(fd);\n\t\t\treturn (0);\n\t\t}\n\t\tif (ret != pos) {\n\t\t\tlogit(\"%s: Couldn't seek to tty %d slot in %s\",\n\t\t\t    __func__, tty, UTMP_FILE);\n\t\t\tclose(fd);\n\t\t\treturn (0);\n\t\t}\n\t\t/*\n\t\t * Prevent luser from zero'ing out ut_host.\n\t\t * If the new ut_line is empty but the old one is not\n\t\t * and ut_line and ut_name match, preserve the old ut_line.\n\t\t */\n\t\tif (atomicio(read, fd, &old_ut, sizeof(old_ut)) == sizeof(old_ut) &&\n\t\t    (ut->ut_host[0] == '\\0') && (old_ut.ut_host[0] != '\\0') &&\n\t\t    (strncmp(old_ut.ut_line, ut->ut_line, sizeof(ut->ut_line)) == 0) &&\n\t\t    (strncmp(old_ut.ut_name, ut->ut_name, sizeof(ut->ut_name)) == 0))\n\t\t\tmemcpy(ut->ut_host, old_ut.ut_host, sizeof(ut->ut_host));\n\n\t\tif ((ret = lseek(fd, pos, SEEK_SET)) == -1) {\n\t\t\tlogit(\"%s: lseek: %s\", __func__, strerror(errno));\n\t\t\tclose(fd);\n\t\t\treturn (0);\n\t\t}\n\t\tif (ret != pos) {\n\t\t\tlogit(\"%s: Couldn't seek to tty %d slot in %s\",\n\t\t\t    __func__, tty, UTMP_FILE);\n\t\t\tclose(fd);\n\t\t\treturn (0);\n\t\t}\n\t\tif (atomicio(vwrite, fd, ut, sizeof(*ut)) != sizeof(*ut)) {\n\t\t\tlogit(\"%s: error writing %s: %s\", __func__,\n\t\t\t    UTMP_FILE, strerror(errno));\n\t\t\tclose(fd);\n\t\t\treturn (0);\n\t\t}\n\n\t\tclose(fd);\n\t\treturn (1);\n\t} else {\n\t\treturn (0);\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "utmp_write_library",
          "args": [
            "li",
            "&ut"
          ],
          "line": 926
        },
        "resolved": true,
        "details": {
          "function_name": "utmp_write_library",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
          "lines": "820-829",
          "snippet": "static int\nutmp_write_library(struct logininfo *li, struct utmp *ut)\n{\n\tsetutent();\n\tpututline(ut);\n#  ifdef HAVE_ENDUTENT\n\tendutent();\n#  endif\n\treturn (1);\n}",
          "includes": [
            "# include <util.h>",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"auth.h\"",
            "#include \"canohost.h\"",
            "#include \"packet.h\"",
            "#include \"atomicio.h\"",
            "#include \"log.h\"",
            "#include \"loginrec.h\"",
            "#include \"ssh.h\"",
            "#include \"hostfile.h\"",
            "#include \"sshkey.h\"",
            "#include \"xmalloc.h\"",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <string.h>",
            "#include <stdarg.h>",
            "#include <pwd.h>",
            "# include <paths.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "int utmp_write_entry(struct logininfo *li);",
            "int utmpx_write_entry(struct logininfo *li);",
            "int wtmp_write_entry(struct logininfo *li);",
            "int wtmpx_write_entry(struct logininfo *li);",
            "int lastlog_write_entry(struct logininfo *li);",
            "int syslogin_write_entry(struct logininfo *li);",
            "int getlast_entry(struct logininfo *li);",
            "int lastlog_get_entry(struct logininfo *li);",
            "int utmpx_get_entry(struct logininfo *li);",
            "int wtmp_get_entry(struct logininfo *li);",
            "int wtmpx_get_entry(struct logininfo *li);"
          ],
          "called_functions": [],
          "contextual_snippet": "# include <util.h>\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"auth.h\"\n#include \"canohost.h\"\n#include \"packet.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"loginrec.h\"\n#include \"ssh.h\"\n#include \"hostfile.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdarg.h>\n#include <pwd.h>\n# include <paths.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint utmp_write_entry(struct logininfo *li);\nint utmpx_write_entry(struct logininfo *li);\nint wtmp_write_entry(struct logininfo *li);\nint wtmpx_write_entry(struct logininfo *li);\nint lastlog_write_entry(struct logininfo *li);\nint syslogin_write_entry(struct logininfo *li);\nint getlast_entry(struct logininfo *li);\nint lastlog_get_entry(struct logininfo *li);\nint utmpx_get_entry(struct logininfo *li);\nint wtmp_get_entry(struct logininfo *li);\nint wtmpx_get_entry(struct logininfo *li);\n\nstatic int\nutmp_write_library(struct logininfo *li, struct utmp *ut)\n{\n\tsetutent();\n\tpututline(ut);\n#  ifdef HAVE_ENDUTENT\n\tendutent();\n#  endif\n\treturn (1);\n}"
        }
      },
      {
        "call_info": {
          "callee": "construct_utmp",
          "args": [
            "li",
            "&ut"
          ],
          "line": 924
        },
        "resolved": true,
        "details": {
          "function_name": "construct_utmpx",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
          "lines": "738-801",
          "snippet": "void\nconstruct_utmpx(struct logininfo *li, struct utmpx *utx)\n{\n# ifdef HAVE_ADDR_V6_IN_UTMP\n\tstruct sockaddr_in6 *sa6;\n#  endif\n\tmemset(utx, '\\0', sizeof(*utx));\n\n# ifdef HAVE_ID_IN_UTMPX\n\tline_abbrevname(utx->ut_id, li->line, sizeof(utx->ut_id));\n# endif\n\n\t/* this is done here to keep utmp constants out of loginrec.h */\n\tswitch (li->type) {\n\tcase LTYPE_LOGIN:\n\t\tutx->ut_type = USER_PROCESS;\n\t\tbreak;\n\tcase LTYPE_LOGOUT:\n\t\tutx->ut_type = DEAD_PROCESS;\n\t\tbreak;\n\t}\n\tline_stripname(utx->ut_line, li->line, sizeof(utx->ut_line));\n\tset_utmpx_time(li, utx);\n\tutx->ut_pid = li->pid;\n\n\t/* strncpy(): Don't necessarily want null termination */\n\tstrncpy(utx->ut_user, li->username,\n\t    MIN_SIZEOF(utx->ut_user, li->username));\n\n\tif (li->type == LTYPE_LOGOUT)\n\t\treturn;\n\n\t/*\n\t * These fields are only used when logging in, and are blank\n\t * for logouts.\n\t */\n\n# ifdef HAVE_HOST_IN_UTMPX\n\tstrncpy(utx->ut_host, li->hostname,\n\t    MIN_SIZEOF(utx->ut_host, li->hostname));\n# endif\n# ifdef HAVE_ADDR_IN_UTMPX\n\t/* this is just a 32-bit IP address */\n\tif (li->hostaddr.sa.sa_family == AF_INET)\n\t\tutx->ut_addr = li->hostaddr.sa_in.sin_addr.s_addr;\n# endif\n# ifdef HAVE_ADDR_V6_IN_UTMP\n\t/* this is just a 128-bit IPv6 address */\n\tif (li->hostaddr.sa.sa_family == AF_INET6) {\n\t\tsa6 = ((struct sockaddr_in6 *)&li->hostaddr.sa);\n\t\tmemcpy(utx->ut_addr_v6, sa6->sin6_addr.s6_addr, 16);\n\t\tif (IN6_IS_ADDR_V4MAPPED(&sa6->sin6_addr)) {\n\t\t\tutx->ut_addr_v6[0] = utx->ut_addr_v6[3];\n\t\t\tutx->ut_addr_v6[1] = 0;\n\t\t\tutx->ut_addr_v6[2] = 0;\n\t\t\tutx->ut_addr_v6[3] = 0;\n\t\t}\n\t}\n# endif\n# ifdef HAVE_SYSLEN_IN_UTMPX\n\t/* ut_syslen is the length of the utx_host string */\n\tutx->ut_syslen = MIN(strlen(li->hostname), sizeof(utx->ut_host));\n# endif\n}",
          "includes": [
            "# include <util.h>",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"auth.h\"",
            "#include \"canohost.h\"",
            "#include \"packet.h\"",
            "#include \"atomicio.h\"",
            "#include \"log.h\"",
            "#include \"loginrec.h\"",
            "#include \"ssh.h\"",
            "#include \"hostfile.h\"",
            "#include \"sshkey.h\"",
            "#include \"xmalloc.h\"",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <string.h>",
            "#include <stdarg.h>",
            "#include <pwd.h>",
            "# include <paths.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "int utmp_write_entry(struct logininfo *li);",
            "int utmpx_write_entry(struct logininfo *li);",
            "int wtmp_write_entry(struct logininfo *li);",
            "int wtmpx_write_entry(struct logininfo *li);",
            "int lastlog_write_entry(struct logininfo *li);",
            "int syslogin_write_entry(struct logininfo *li);",
            "int getlast_entry(struct logininfo *li);",
            "int lastlog_get_entry(struct logininfo *li);",
            "int utmpx_get_entry(struct logininfo *li);",
            "int wtmp_get_entry(struct logininfo *li);",
            "int wtmpx_get_entry(struct logininfo *li);"
          ],
          "called_functions": [],
          "contextual_snippet": "# include <util.h>\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"auth.h\"\n#include \"canohost.h\"\n#include \"packet.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"loginrec.h\"\n#include \"ssh.h\"\n#include \"hostfile.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdarg.h>\n#include <pwd.h>\n# include <paths.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint utmp_write_entry(struct logininfo *li);\nint utmpx_write_entry(struct logininfo *li);\nint wtmp_write_entry(struct logininfo *li);\nint wtmpx_write_entry(struct logininfo *li);\nint lastlog_write_entry(struct logininfo *li);\nint syslogin_write_entry(struct logininfo *li);\nint getlast_entry(struct logininfo *li);\nint lastlog_get_entry(struct logininfo *li);\nint utmpx_get_entry(struct logininfo *li);\nint wtmp_get_entry(struct logininfo *li);\nint wtmpx_get_entry(struct logininfo *li);\n\nvoid\nconstruct_utmpx(struct logininfo *li, struct utmpx *utx)\n{\n# ifdef HAVE_ADDR_V6_IN_UTMP\n\tstruct sockaddr_in6 *sa6;\n#  endif\n\tmemset(utx, '\\0', sizeof(*utx));\n\n# ifdef HAVE_ID_IN_UTMPX\n\tline_abbrevname(utx->ut_id, li->line, sizeof(utx->ut_id));\n# endif\n\n\t/* this is done here to keep utmp constants out of loginrec.h */\n\tswitch (li->type) {\n\tcase LTYPE_LOGIN:\n\t\tutx->ut_type = USER_PROCESS;\n\t\tbreak;\n\tcase LTYPE_LOGOUT:\n\t\tutx->ut_type = DEAD_PROCESS;\n\t\tbreak;\n\t}\n\tline_stripname(utx->ut_line, li->line, sizeof(utx->ut_line));\n\tset_utmpx_time(li, utx);\n\tutx->ut_pid = li->pid;\n\n\t/* strncpy(): Don't necessarily want null termination */\n\tstrncpy(utx->ut_user, li->username,\n\t    MIN_SIZEOF(utx->ut_user, li->username));\n\n\tif (li->type == LTYPE_LOGOUT)\n\t\treturn;\n\n\t/*\n\t * These fields are only used when logging in, and are blank\n\t * for logouts.\n\t */\n\n# ifdef HAVE_HOST_IN_UTMPX\n\tstrncpy(utx->ut_host, li->hostname,\n\t    MIN_SIZEOF(utx->ut_host, li->hostname));\n# endif\n# ifdef HAVE_ADDR_IN_UTMPX\n\t/* this is just a 32-bit IP address */\n\tif (li->hostaddr.sa.sa_family == AF_INET)\n\t\tutx->ut_addr = li->hostaddr.sa_in.sin_addr.s_addr;\n# endif\n# ifdef HAVE_ADDR_V6_IN_UTMP\n\t/* this is just a 128-bit IPv6 address */\n\tif (li->hostaddr.sa.sa_family == AF_INET6) {\n\t\tsa6 = ((struct sockaddr_in6 *)&li->hostaddr.sa);\n\t\tmemcpy(utx->ut_addr_v6, sa6->sin6_addr.s6_addr, 16);\n\t\tif (IN6_IS_ADDR_V4MAPPED(&sa6->sin6_addr)) {\n\t\t\tutx->ut_addr_v6[0] = utx->ut_addr_v6[3];\n\t\t\tutx->ut_addr_v6[1] = 0;\n\t\t\tutx->ut_addr_v6[2] = 0;\n\t\t\tutx->ut_addr_v6[3] = 0;\n\t\t}\n\t}\n# endif\n# ifdef HAVE_SYSLEN_IN_UTMPX\n\t/* ut_syslen is the length of the utx_host string */\n\tutx->ut_syslen = MIN(strlen(li->hostname), sizeof(utx->ut_host));\n# endif\n}"
        }
      }
    ],
    "contextual_snippet": "# include <util.h>\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"auth.h\"\n#include \"canohost.h\"\n#include \"packet.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"loginrec.h\"\n#include \"ssh.h\"\n#include \"hostfile.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdarg.h>\n#include <pwd.h>\n# include <paths.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint utmp_write_entry(struct logininfo *li);\nint utmpx_write_entry(struct logininfo *li);\nint wtmp_write_entry(struct logininfo *li);\nint wtmpx_write_entry(struct logininfo *li);\nint lastlog_write_entry(struct logininfo *li);\nint syslogin_write_entry(struct logininfo *li);\nint getlast_entry(struct logininfo *li);\nint lastlog_get_entry(struct logininfo *li);\nint utmpx_get_entry(struct logininfo *li);\nint wtmp_get_entry(struct logininfo *li);\nint wtmpx_get_entry(struct logininfo *li);\n\nstatic int\nutmp_perform_login(struct logininfo *li)\n{\n\tstruct utmp ut;\n\n\tconstruct_utmp(li, &ut);\n# ifdef UTMP_USE_LIBRARY\n\tif (!utmp_write_library(li, &ut)) {\n\t\tlogit(\"%s: utmp_write_library() failed\", __func__);\n\t\treturn (0);\n\t}\n# else\n\tif (!utmp_write_direct(li, &ut)) {\n\t\tlogit(\"%s: utmp_write_direct() failed\", __func__);\n\t\treturn (0);\n\t}\n# endif\n\treturn (1);\n}"
  },
  {
    "function_name": "utmp_write_direct",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
    "lines": "836-916",
    "snippet": "static int\nutmp_write_direct(struct logininfo *li, struct utmp *ut)\n{\n\tstruct utmp old_ut;\n\tregister int fd;\n\tint tty;\n\n\t/* FIXME: (ATL) ttyslot() needs local implementation */\n\n#if defined(HAVE_GETTTYENT)\n\tstruct ttyent *ty;\n\n\ttty=0;\n\tsetttyent();\n\twhile (NULL != (ty = getttyent())) {\n\t\ttty++;\n\t\tif (!strncmp(ty->ty_name, ut->ut_line, sizeof(ut->ut_line)))\n\t\t\tbreak;\n\t}\n\tendttyent();\n\n\tif (NULL == ty) {\n\t\tlogit(\"%s: tty not found\", __func__);\n\t\treturn (0);\n\t}\n#else /* FIXME */\n\n\ttty = ttyslot(); /* seems only to work for /dev/ttyp? style names */\n\n#endif /* HAVE_GETTTYENT */\n\n\tif (tty > 0 && (fd = open(UTMP_FILE, O_RDWR|O_CREAT, 0644)) >= 0) {\n\t\toff_t pos, ret;\n\n\t\tpos = (off_t)tty * sizeof(struct utmp);\n\t\tif ((ret = lseek(fd, pos, SEEK_SET)) == -1) {\n\t\t\tlogit(\"%s: lseek: %s\", __func__, strerror(errno));\n\t\t\tclose(fd);\n\t\t\treturn (0);\n\t\t}\n\t\tif (ret != pos) {\n\t\t\tlogit(\"%s: Couldn't seek to tty %d slot in %s\",\n\t\t\t    __func__, tty, UTMP_FILE);\n\t\t\tclose(fd);\n\t\t\treturn (0);\n\t\t}\n\t\t/*\n\t\t * Prevent luser from zero'ing out ut_host.\n\t\t * If the new ut_line is empty but the old one is not\n\t\t * and ut_line and ut_name match, preserve the old ut_line.\n\t\t */\n\t\tif (atomicio(read, fd, &old_ut, sizeof(old_ut)) == sizeof(old_ut) &&\n\t\t    (ut->ut_host[0] == '\\0') && (old_ut.ut_host[0] != '\\0') &&\n\t\t    (strncmp(old_ut.ut_line, ut->ut_line, sizeof(ut->ut_line)) == 0) &&\n\t\t    (strncmp(old_ut.ut_name, ut->ut_name, sizeof(ut->ut_name)) == 0))\n\t\t\tmemcpy(ut->ut_host, old_ut.ut_host, sizeof(ut->ut_host));\n\n\t\tif ((ret = lseek(fd, pos, SEEK_SET)) == -1) {\n\t\t\tlogit(\"%s: lseek: %s\", __func__, strerror(errno));\n\t\t\tclose(fd);\n\t\t\treturn (0);\n\t\t}\n\t\tif (ret != pos) {\n\t\t\tlogit(\"%s: Couldn't seek to tty %d slot in %s\",\n\t\t\t    __func__, tty, UTMP_FILE);\n\t\t\tclose(fd);\n\t\t\treturn (0);\n\t\t}\n\t\tif (atomicio(vwrite, fd, ut, sizeof(*ut)) != sizeof(*ut)) {\n\t\t\tlogit(\"%s: error writing %s: %s\", __func__,\n\t\t\t    UTMP_FILE, strerror(errno));\n\t\t\tclose(fd);\n\t\t\treturn (0);\n\t\t}\n\n\t\tclose(fd);\n\t\treturn (1);\n\t} else {\n\t\treturn (0);\n\t}\n}",
    "includes": [
      "# include <util.h>",
      "#include \"ssherr.h\"",
      "#include \"sshbuf.h\"",
      "#include \"auth.h\"",
      "#include \"canohost.h\"",
      "#include \"packet.h\"",
      "#include \"atomicio.h\"",
      "#include \"log.h\"",
      "#include \"loginrec.h\"",
      "#include \"ssh.h\"",
      "#include \"hostfile.h\"",
      "#include \"sshkey.h\"",
      "#include \"xmalloc.h\"",
      "#include <unistd.h>",
      "#include <time.h>",
      "#include <string.h>",
      "#include <stdarg.h>",
      "#include <pwd.h>",
      "# include <paths.h>",
      "#include <fcntl.h>",
      "#include <errno.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "int utmp_write_entry(struct logininfo *li);",
      "int utmpx_write_entry(struct logininfo *li);",
      "int wtmp_write_entry(struct logininfo *li);",
      "int wtmpx_write_entry(struct logininfo *li);",
      "int lastlog_write_entry(struct logininfo *li);",
      "int syslogin_write_entry(struct logininfo *li);",
      "int getlast_entry(struct logininfo *li);",
      "int lastlog_get_entry(struct logininfo *li);",
      "int utmpx_get_entry(struct logininfo *li);",
      "int wtmp_get_entry(struct logininfo *li);",
      "int wtmpx_get_entry(struct logininfo *li);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "close",
          "args": [
            "fd"
          ],
          "line": 911
        },
        "resolved": true,
        "details": {
          "function_name": "ssh_close_authentication_socket",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/authfd.c",
          "lines": "171-176",
          "snippet": "void\nssh_close_authentication_socket(int sock)\n{\n\tif (getenv(SSH_AUTHSOCKET_ENV_NAME))\n\t\tclose(sock);\n}",
          "includes": [
            "#include \"ssherr.h\"",
            "#include \"misc.h\"",
            "#include \"atomicio.h\"",
            "#include \"log.h\"",
            "#include \"compat.h\"",
            "#include \"cipher.h\"",
            "#include \"authfd.h\"",
            "#include \"sshkey.h\"",
            "#include \"sshbuf.h\"",
            "#include \"ssh.h\"",
            "#include \"xmalloc.h\"",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "#include <stdlib.h>",
            "#include <fcntl.h>",
            "#include <sys/socket.h>",
            "#include <sys/un.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"ssherr.h\"\n#include \"misc.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"compat.h\"\n#include \"cipher.h\"\n#include \"authfd.h\"\n#include \"sshkey.h\"\n#include \"sshbuf.h\"\n#include \"ssh.h\"\n#include \"xmalloc.h\"\n#include <errno.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdarg.h>\n#include <signal.h>\n#include <stdlib.h>\n#include <fcntl.h>\n#include <sys/socket.h>\n#include <sys/un.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\nssh_close_authentication_socket(int sock)\n{\n\tif (getenv(SSH_AUTHSOCKET_ENV_NAME))\n\t\tclose(sock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "logit",
          "args": [
            "\"%s: error writing %s: %s\"",
            "__func__",
            "UTMP_FILE",
            "strerror(errno)"
          ],
          "line": 905
        },
        "resolved": true,
        "details": {
          "function_name": "logit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/log.c",
          "lines": "198-206",
          "snippet": "void\nlogit(const char *fmt,...)\n{\n\tva_list args;\n\n\tva_start(args, fmt);\n\tdo_log(SYSLOG_LEVEL_INFO, fmt, args);\n\tva_end(args);\n}",
          "includes": [
            "#include \"log.h\"",
            "# include <vis.h>",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <syslog.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <fcntl.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n# include <vis.h>\n#include <errno.h>\n#include <unistd.h>\n#include <syslog.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <fcntl.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\nlogit(const char *fmt,...)\n{\n\tva_list args;\n\n\tva_start(args, fmt);\n\tdo_log(SYSLOG_LEVEL_INFO, fmt, args);\n\tva_end(args);\n}"
        }
      },
      {
        "call_info": {
          "callee": "strerror",
          "args": [
            "errno"
          ],
          "line": 906
        },
        "resolved": true,
        "details": {
          "function_name": "ssh_gai_strerror",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/misc.c",
          "lines": "140-146",
          "snippet": "const char *\nssh_gai_strerror(int gaierr)\n{\n\tif (gaierr == EAI_SYSTEM && errno != 0)\n\t\treturn strerror(errno);\n\treturn gai_strerror(gaierr);\n}",
          "includes": [
            "#include \"platform.h\"",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"ssh.h\"",
            "#include \"log.h\"",
            "#include \"misc.h\"",
            "#include \"xmalloc.h\"",
            "#include <net/if.h>",
            "#include <pwd.h>",
            "# include <paths.h>",
            "#include <netdb.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <ctype.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/tcp.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in_systm.h>",
            "#include <netinet/in.h>",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <libgen.h>",
            "#include <limits.h>",
            "#include <sys/un.h>",
            "#include <sys/wait.h>",
            "#include <sys/time.h>",
            "#include <sys/stat.h>",
            "#include <sys/socket.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"platform.h\"\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"ssh.h\"\n#include \"log.h\"\n#include \"misc.h\"\n#include \"xmalloc.h\"\n#include <net/if.h>\n#include <pwd.h>\n# include <paths.h>\n#include <netdb.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <ctype.h>\n#include <arpa/inet.h>\n#include <netinet/tcp.h>\n#include <netinet/ip.h>\n#include <netinet/in_systm.h>\n#include <netinet/in.h>\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <libgen.h>\n#include <limits.h>\n#include <sys/un.h>\n#include <sys/wait.h>\n#include <sys/time.h>\n#include <sys/stat.h>\n#include <sys/socket.h>\n#include <sys/ioctl.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nconst char *\nssh_gai_strerror(int gaierr)\n{\n\tif (gaierr == EAI_SYSTEM && errno != 0)\n\t\treturn strerror(errno);\n\treturn gai_strerror(gaierr);\n}"
        }
      },
      {
        "call_info": {
          "callee": "atomicio",
          "args": [
            "vwrite",
            "fd",
            "ut",
            "sizeof(*ut)"
          ],
          "line": 904
        },
        "resolved": true,
        "details": {
          "function_name": "atomiciov",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/atomicio.c",
          "lines": "165-170",
          "snippet": "size_t\natomiciov(ssize_t (*f) (int, const struct iovec *, int), int fd,\n    const struct iovec *_iov, int iovcnt)\n{\n\treturn atomiciov6(f, fd, _iov, iovcnt, NULL, NULL);\n}",
          "includes": [
            "#include \"atomicio.h\"",
            "#include <limits.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#  include <sys/poll.h>",
            "#include <poll.h>",
            "#include <errno.h>",
            "#include <sys/uio.h>",
            "#include <sys/param.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"atomicio.h\"\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#  include <sys/poll.h>\n#include <poll.h>\n#include <errno.h>\n#include <sys/uio.h>\n#include <sys/param.h>\n#include \"includes.h\"\n\nsize_t\natomiciov(ssize_t (*f) (int, const struct iovec *, int), int fd,\n    const struct iovec *_iov, int iovcnt)\n{\n\treturn atomiciov6(f, fd, _iov, iovcnt, NULL, NULL);\n}"
        }
      },
      {
        "call_info": {
          "callee": "lseek",
          "args": [
            "fd",
            "pos",
            "SEEK_SET"
          ],
          "line": 893
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memcpy",
          "args": [
            "ut->ut_host",
            "old_ut.ut_host",
            "sizeof(ut->ut_host)"
          ],
          "line": 891
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strncmp",
          "args": [
            "old_ut.ut_name",
            "ut->ut_name",
            "sizeof(ut->ut_name)"
          ],
          "line": 890
        },
        "resolved": true,
        "details": {
          "function_name": "g_strncmp",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/openbsd-compat/glob.c",
          "lines": "422-435",
          "snippet": "static int\ng_strncmp(const Char *s1, const char *s2, size_t n)\n{\n\tint rv = 0;\n\n\twhile (n--) {\n\t\trv = *(Char *)s1 - *(const unsigned char *)s2++;\n\t\tif (rv)\n\t\t\tbreak;\n\t\tif (*s1++ == '\\0')\n\t\t\tbreak;\n\t}\n\treturn rv;\n}",
          "includes": [
            "#include \"charclass.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <pwd.h>",
            "#include <limits.h>",
            "#include <errno.h>",
            "#include <ctype.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include \"glob.h\"",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"charclass.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <pwd.h>\n#include <limits.h>\n#include <errno.h>\n#include <ctype.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"glob.h\"\n#include \"includes.h\"\n\nstatic int\ng_strncmp(const Char *s1, const char *s2, size_t n)\n{\n\tint rv = 0;\n\n\twhile (n--) {\n\t\trv = *(Char *)s1 - *(const unsigned char *)s2++;\n\t\tif (rv)\n\t\t\tbreak;\n\t\tif (*s1++ == '\\0')\n\t\t\tbreak;\n\t}\n\treturn rv;\n}"
        }
      },
      {
        "call_info": {
          "callee": "lseek",
          "args": [
            "fd",
            "pos",
            "SEEK_SET"
          ],
          "line": 871
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "open",
          "args": [
            "UTMP_FILE",
            "O_RDWR|O_CREAT",
            "0644"
          ],
          "line": 867
        },
        "resolved": true,
        "details": {
          "function_name": "lastlog_openseek",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
          "lines": "1471-1514",
          "snippet": "static int\nlastlog_openseek(struct logininfo *li, int *fd, int filemode)\n{\n\toff_t offset;\n\tchar lastlog_file[1024];\n\tstruct stat st;\n\n\tif (stat(LASTLOG_FILE, &st) != 0) {\n\t\tlogit(\"%s: Couldn't stat %s: %s\", __func__,\n\t\t    LASTLOG_FILE, strerror(errno));\n\t\treturn (0);\n\t}\n\tif (S_ISDIR(st.st_mode)) {\n\t\tsnprintf(lastlog_file, sizeof(lastlog_file), \"%s/%s\",\n\t\t    LASTLOG_FILE, li->username);\n\t} else if (S_ISREG(st.st_mode)) {\n\t\tstrlcpy(lastlog_file, LASTLOG_FILE, sizeof(lastlog_file));\n\t} else {\n\t\tlogit(\"%s: %.100s is not a file or directory!\", __func__,\n\t\t    LASTLOG_FILE);\n\t\treturn (0);\n\t}\n\n\t*fd = open(lastlog_file, filemode, 0600);\n\tif (*fd < 0) {\n\t\tdebug(\"%s: Couldn't open %s: %s\", __func__,\n\t\t    lastlog_file, strerror(errno));\n\t\treturn (0);\n\t}\n\n\tif (S_ISREG(st.st_mode)) {\n\t\t/* find this uid's offset in the lastlog file */\n\t\toffset = (off_t) ((u_long)li->uid * sizeof(struct lastlog));\n\n\t\tif (lseek(*fd, offset, SEEK_SET) != offset) {\n\t\t\tlogit(\"%s: %s->lseek(): %s\", __func__,\n\t\t\t    lastlog_file, strerror(errno));\n\t\t\tclose(*fd);\n\t\t\treturn (0);\n\t\t}\n\t}\n\n\treturn (1);\n}",
          "includes": [
            "# include <util.h>",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"auth.h\"",
            "#include \"canohost.h\"",
            "#include \"packet.h\"",
            "#include \"atomicio.h\"",
            "#include \"log.h\"",
            "#include \"loginrec.h\"",
            "#include \"ssh.h\"",
            "#include \"hostfile.h\"",
            "#include \"sshkey.h\"",
            "#include \"xmalloc.h\"",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <string.h>",
            "#include <stdarg.h>",
            "#include <pwd.h>",
            "# include <paths.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "int utmp_write_entry(struct logininfo *li);",
            "int utmpx_write_entry(struct logininfo *li);",
            "int wtmp_write_entry(struct logininfo *li);",
            "int wtmpx_write_entry(struct logininfo *li);",
            "int lastlog_write_entry(struct logininfo *li);",
            "int syslogin_write_entry(struct logininfo *li);",
            "int getlast_entry(struct logininfo *li);",
            "int lastlog_get_entry(struct logininfo *li);",
            "int utmpx_get_entry(struct logininfo *li);",
            "int wtmp_get_entry(struct logininfo *li);",
            "int wtmpx_get_entry(struct logininfo *li);"
          ],
          "called_functions": [],
          "contextual_snippet": "# include <util.h>\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"auth.h\"\n#include \"canohost.h\"\n#include \"packet.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"loginrec.h\"\n#include \"ssh.h\"\n#include \"hostfile.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdarg.h>\n#include <pwd.h>\n# include <paths.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint utmp_write_entry(struct logininfo *li);\nint utmpx_write_entry(struct logininfo *li);\nint wtmp_write_entry(struct logininfo *li);\nint wtmpx_write_entry(struct logininfo *li);\nint lastlog_write_entry(struct logininfo *li);\nint syslogin_write_entry(struct logininfo *li);\nint getlast_entry(struct logininfo *li);\nint lastlog_get_entry(struct logininfo *li);\nint utmpx_get_entry(struct logininfo *li);\nint wtmp_get_entry(struct logininfo *li);\nint wtmpx_get_entry(struct logininfo *li);\n\nstatic int\nlastlog_openseek(struct logininfo *li, int *fd, int filemode)\n{\n\toff_t offset;\n\tchar lastlog_file[1024];\n\tstruct stat st;\n\n\tif (stat(LASTLOG_FILE, &st) != 0) {\n\t\tlogit(\"%s: Couldn't stat %s: %s\", __func__,\n\t\t    LASTLOG_FILE, strerror(errno));\n\t\treturn (0);\n\t}\n\tif (S_ISDIR(st.st_mode)) {\n\t\tsnprintf(lastlog_file, sizeof(lastlog_file), \"%s/%s\",\n\t\t    LASTLOG_FILE, li->username);\n\t} else if (S_ISREG(st.st_mode)) {\n\t\tstrlcpy(lastlog_file, LASTLOG_FILE, sizeof(lastlog_file));\n\t} else {\n\t\tlogit(\"%s: %.100s is not a file or directory!\", __func__,\n\t\t    LASTLOG_FILE);\n\t\treturn (0);\n\t}\n\n\t*fd = open(lastlog_file, filemode, 0600);\n\tif (*fd < 0) {\n\t\tdebug(\"%s: Couldn't open %s: %s\", __func__,\n\t\t    lastlog_file, strerror(errno));\n\t\treturn (0);\n\t}\n\n\tif (S_ISREG(st.st_mode)) {\n\t\t/* find this uid's offset in the lastlog file */\n\t\toffset = (off_t) ((u_long)li->uid * sizeof(struct lastlog));\n\n\t\tif (lseek(*fd, offset, SEEK_SET) != offset) {\n\t\t\tlogit(\"%s: %s->lseek(): %s\", __func__,\n\t\t\t    lastlog_file, strerror(errno));\n\t\t\tclose(*fd);\n\t\t\treturn (0);\n\t\t}\n\t}\n\n\treturn (1);\n}"
        }
      },
      {
        "call_info": {
          "callee": "ttyslot",
          "args": [],
          "line": 863
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "endttyent",
          "args": [],
          "line": 855
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "getttyent",
          "args": [],
          "line": 850
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "setttyent",
          "args": [],
          "line": 849
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "# include <util.h>\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"auth.h\"\n#include \"canohost.h\"\n#include \"packet.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"loginrec.h\"\n#include \"ssh.h\"\n#include \"hostfile.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdarg.h>\n#include <pwd.h>\n# include <paths.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint utmp_write_entry(struct logininfo *li);\nint utmpx_write_entry(struct logininfo *li);\nint wtmp_write_entry(struct logininfo *li);\nint wtmpx_write_entry(struct logininfo *li);\nint lastlog_write_entry(struct logininfo *li);\nint syslogin_write_entry(struct logininfo *li);\nint getlast_entry(struct logininfo *li);\nint lastlog_get_entry(struct logininfo *li);\nint utmpx_get_entry(struct logininfo *li);\nint wtmp_get_entry(struct logininfo *li);\nint wtmpx_get_entry(struct logininfo *li);\n\nstatic int\nutmp_write_direct(struct logininfo *li, struct utmp *ut)\n{\n\tstruct utmp old_ut;\n\tregister int fd;\n\tint tty;\n\n\t/* FIXME: (ATL) ttyslot() needs local implementation */\n\n#if defined(HAVE_GETTTYENT)\n\tstruct ttyent *ty;\n\n\ttty=0;\n\tsetttyent();\n\twhile (NULL != (ty = getttyent())) {\n\t\ttty++;\n\t\tif (!strncmp(ty->ty_name, ut->ut_line, sizeof(ut->ut_line)))\n\t\t\tbreak;\n\t}\n\tendttyent();\n\n\tif (NULL == ty) {\n\t\tlogit(\"%s: tty not found\", __func__);\n\t\treturn (0);\n\t}\n#else /* FIXME */\n\n\ttty = ttyslot(); /* seems only to work for /dev/ttyp? style names */\n\n#endif /* HAVE_GETTTYENT */\n\n\tif (tty > 0 && (fd = open(UTMP_FILE, O_RDWR|O_CREAT, 0644)) >= 0) {\n\t\toff_t pos, ret;\n\n\t\tpos = (off_t)tty * sizeof(struct utmp);\n\t\tif ((ret = lseek(fd, pos, SEEK_SET)) == -1) {\n\t\t\tlogit(\"%s: lseek: %s\", __func__, strerror(errno));\n\t\t\tclose(fd);\n\t\t\treturn (0);\n\t\t}\n\t\tif (ret != pos) {\n\t\t\tlogit(\"%s: Couldn't seek to tty %d slot in %s\",\n\t\t\t    __func__, tty, UTMP_FILE);\n\t\t\tclose(fd);\n\t\t\treturn (0);\n\t\t}\n\t\t/*\n\t\t * Prevent luser from zero'ing out ut_host.\n\t\t * If the new ut_line is empty but the old one is not\n\t\t * and ut_line and ut_name match, preserve the old ut_line.\n\t\t */\n\t\tif (atomicio(read, fd, &old_ut, sizeof(old_ut)) == sizeof(old_ut) &&\n\t\t    (ut->ut_host[0] == '\\0') && (old_ut.ut_host[0] != '\\0') &&\n\t\t    (strncmp(old_ut.ut_line, ut->ut_line, sizeof(ut->ut_line)) == 0) &&\n\t\t    (strncmp(old_ut.ut_name, ut->ut_name, sizeof(ut->ut_name)) == 0))\n\t\t\tmemcpy(ut->ut_host, old_ut.ut_host, sizeof(ut->ut_host));\n\n\t\tif ((ret = lseek(fd, pos, SEEK_SET)) == -1) {\n\t\t\tlogit(\"%s: lseek: %s\", __func__, strerror(errno));\n\t\t\tclose(fd);\n\t\t\treturn (0);\n\t\t}\n\t\tif (ret != pos) {\n\t\t\tlogit(\"%s: Couldn't seek to tty %d slot in %s\",\n\t\t\t    __func__, tty, UTMP_FILE);\n\t\t\tclose(fd);\n\t\t\treturn (0);\n\t\t}\n\t\tif (atomicio(vwrite, fd, ut, sizeof(*ut)) != sizeof(*ut)) {\n\t\t\tlogit(\"%s: error writing %s: %s\", __func__,\n\t\t\t    UTMP_FILE, strerror(errno));\n\t\t\tclose(fd);\n\t\t\treturn (0);\n\t\t}\n\n\t\tclose(fd);\n\t\treturn (1);\n\t} else {\n\t\treturn (0);\n\t}\n}"
  },
  {
    "function_name": "utmp_write_library",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
    "lines": "820-829",
    "snippet": "static int\nutmp_write_library(struct logininfo *li, struct utmp *ut)\n{\n\tsetutent();\n\tpututline(ut);\n#  ifdef HAVE_ENDUTENT\n\tendutent();\n#  endif\n\treturn (1);\n}",
    "includes": [
      "# include <util.h>",
      "#include \"ssherr.h\"",
      "#include \"sshbuf.h\"",
      "#include \"auth.h\"",
      "#include \"canohost.h\"",
      "#include \"packet.h\"",
      "#include \"atomicio.h\"",
      "#include \"log.h\"",
      "#include \"loginrec.h\"",
      "#include \"ssh.h\"",
      "#include \"hostfile.h\"",
      "#include \"sshkey.h\"",
      "#include \"xmalloc.h\"",
      "#include <unistd.h>",
      "#include <time.h>",
      "#include <string.h>",
      "#include <stdarg.h>",
      "#include <pwd.h>",
      "# include <paths.h>",
      "#include <fcntl.h>",
      "#include <errno.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "int utmp_write_entry(struct logininfo *li);",
      "int utmpx_write_entry(struct logininfo *li);",
      "int wtmp_write_entry(struct logininfo *li);",
      "int wtmpx_write_entry(struct logininfo *li);",
      "int lastlog_write_entry(struct logininfo *li);",
      "int syslogin_write_entry(struct logininfo *li);",
      "int getlast_entry(struct logininfo *li);",
      "int lastlog_get_entry(struct logininfo *li);",
      "int utmpx_get_entry(struct logininfo *li);",
      "int wtmp_get_entry(struct logininfo *li);",
      "int wtmpx_get_entry(struct logininfo *li);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "endutent",
          "args": [],
          "line": 826
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pututline",
          "args": [
            "ut"
          ],
          "line": 824
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "setutent",
          "args": [],
          "line": 823
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "# include <util.h>\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"auth.h\"\n#include \"canohost.h\"\n#include \"packet.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"loginrec.h\"\n#include \"ssh.h\"\n#include \"hostfile.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdarg.h>\n#include <pwd.h>\n# include <paths.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint utmp_write_entry(struct logininfo *li);\nint utmpx_write_entry(struct logininfo *li);\nint wtmp_write_entry(struct logininfo *li);\nint wtmpx_write_entry(struct logininfo *li);\nint lastlog_write_entry(struct logininfo *li);\nint syslogin_write_entry(struct logininfo *li);\nint getlast_entry(struct logininfo *li);\nint lastlog_get_entry(struct logininfo *li);\nint utmpx_get_entry(struct logininfo *li);\nint wtmp_get_entry(struct logininfo *li);\nint wtmpx_get_entry(struct logininfo *li);\n\nstatic int\nutmp_write_library(struct logininfo *li, struct utmp *ut)\n{\n\tsetutent();\n\tpututline(ut);\n#  ifdef HAVE_ENDUTENT\n\tendutent();\n#  endif\n\treturn (1);\n}"
  },
  {
    "function_name": "construct_utmpx",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
    "lines": "738-801",
    "snippet": "void\nconstruct_utmpx(struct logininfo *li, struct utmpx *utx)\n{\n# ifdef HAVE_ADDR_V6_IN_UTMP\n\tstruct sockaddr_in6 *sa6;\n#  endif\n\tmemset(utx, '\\0', sizeof(*utx));\n\n# ifdef HAVE_ID_IN_UTMPX\n\tline_abbrevname(utx->ut_id, li->line, sizeof(utx->ut_id));\n# endif\n\n\t/* this is done here to keep utmp constants out of loginrec.h */\n\tswitch (li->type) {\n\tcase LTYPE_LOGIN:\n\t\tutx->ut_type = USER_PROCESS;\n\t\tbreak;\n\tcase LTYPE_LOGOUT:\n\t\tutx->ut_type = DEAD_PROCESS;\n\t\tbreak;\n\t}\n\tline_stripname(utx->ut_line, li->line, sizeof(utx->ut_line));\n\tset_utmpx_time(li, utx);\n\tutx->ut_pid = li->pid;\n\n\t/* strncpy(): Don't necessarily want null termination */\n\tstrncpy(utx->ut_user, li->username,\n\t    MIN_SIZEOF(utx->ut_user, li->username));\n\n\tif (li->type == LTYPE_LOGOUT)\n\t\treturn;\n\n\t/*\n\t * These fields are only used when logging in, and are blank\n\t * for logouts.\n\t */\n\n# ifdef HAVE_HOST_IN_UTMPX\n\tstrncpy(utx->ut_host, li->hostname,\n\t    MIN_SIZEOF(utx->ut_host, li->hostname));\n# endif\n# ifdef HAVE_ADDR_IN_UTMPX\n\t/* this is just a 32-bit IP address */\n\tif (li->hostaddr.sa.sa_family == AF_INET)\n\t\tutx->ut_addr = li->hostaddr.sa_in.sin_addr.s_addr;\n# endif\n# ifdef HAVE_ADDR_V6_IN_UTMP\n\t/* this is just a 128-bit IPv6 address */\n\tif (li->hostaddr.sa.sa_family == AF_INET6) {\n\t\tsa6 = ((struct sockaddr_in6 *)&li->hostaddr.sa);\n\t\tmemcpy(utx->ut_addr_v6, sa6->sin6_addr.s6_addr, 16);\n\t\tif (IN6_IS_ADDR_V4MAPPED(&sa6->sin6_addr)) {\n\t\t\tutx->ut_addr_v6[0] = utx->ut_addr_v6[3];\n\t\t\tutx->ut_addr_v6[1] = 0;\n\t\t\tutx->ut_addr_v6[2] = 0;\n\t\t\tutx->ut_addr_v6[3] = 0;\n\t\t}\n\t}\n# endif\n# ifdef HAVE_SYSLEN_IN_UTMPX\n\t/* ut_syslen is the length of the utx_host string */\n\tutx->ut_syslen = MIN(strlen(li->hostname), sizeof(utx->ut_host));\n# endif\n}",
    "includes": [
      "# include <util.h>",
      "#include \"ssherr.h\"",
      "#include \"sshbuf.h\"",
      "#include \"auth.h\"",
      "#include \"canohost.h\"",
      "#include \"packet.h\"",
      "#include \"atomicio.h\"",
      "#include \"log.h\"",
      "#include \"loginrec.h\"",
      "#include \"ssh.h\"",
      "#include \"hostfile.h\"",
      "#include \"sshkey.h\"",
      "#include \"xmalloc.h\"",
      "#include <unistd.h>",
      "#include <time.h>",
      "#include <string.h>",
      "#include <stdarg.h>",
      "#include <pwd.h>",
      "# include <paths.h>",
      "#include <fcntl.h>",
      "#include <errno.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "int utmp_write_entry(struct logininfo *li);",
      "int utmpx_write_entry(struct logininfo *li);",
      "int wtmp_write_entry(struct logininfo *li);",
      "int wtmpx_write_entry(struct logininfo *li);",
      "int lastlog_write_entry(struct logininfo *li);",
      "int syslogin_write_entry(struct logininfo *li);",
      "int getlast_entry(struct logininfo *li);",
      "int lastlog_get_entry(struct logininfo *li);",
      "int utmpx_get_entry(struct logininfo *li);",
      "int wtmp_get_entry(struct logininfo *li);",
      "int wtmpx_get_entry(struct logininfo *li);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "MIN",
          "args": [
            "strlen(li->hostname)",
            "sizeof(utx->ut_host)"
          ],
          "line": 799
        },
        "resolved": true,
        "details": {
          "function_name": "_SPLAY_MINMAX",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/openbsd-compat/sys-tree.h",
          "lines": "247-278",
          "snippet": "void name##_SPLAY_MINMAX(struct name *head, int __comp) \\\n{\t\t\t\t\t\t\t\t\t\\\n\tstruct type __node, *__left, *__right, *__tmp;\t\t\t\\\n\\\n\tSPLAY_LEFT(&__node, field) = SPLAY_RIGHT(&__node, field) = NULL;\\\n\t__left = __right = &__node;\t\t\t\t\t\\\n\\\n\twhile (1) {\t\t\t\t\t\t\t\\\n\t\tif (__comp < 0) {\t\t\t\t\t\\\n\t\t\t__tmp = SPLAY_LEFT((head)->sph_root, field);\t\\\n\t\t\tif (__tmp == NULL)\t\t\t\t\\\n\t\t\t\tbreak;\t\t\t\t\t\\\n\t\t\tif (__comp < 0){\t\t\t\t\\\n\t\t\t\tSPLAY_ROTATE_RIGHT(head, __tmp, field);\t\\\n\t\t\t\tif (SPLAY_LEFT((head)->sph_root, field) == NULL)\\\n\t\t\t\t\tbreak;\t\t\t\t\\\n\t\t\t}\t\t\t\t\t\t\\\n\t\t\tSPLAY_LINKLEFT(head, __right, field);\t\t\\\n\t\t} else if (__comp > 0) {\t\t\t\t\\\n\t\t\t__tmp = SPLAY_RIGHT((head)->sph_root, field);\t\\\n\t\t\tif (__tmp == NULL)\t\t\t\t\\\n\t\t\t\tbreak;\t\t\t\t\t\\\n\t\t\tif (__comp > 0) {\t\t\t\t\\\n\t\t\t\tSPLAY_ROTATE_LEFT(head, __tmp, field);\t\\\n\t\t\t\tif (SPLAY_RIGHT((head)->sph_root, field) == NULL)\\\n\t\t\t\t\tbreak;\t\t\t\t\\\n\t\t\t}\t\t\t\t\t\t\\\n\t\t\tSPLAY_LINKRIGHT(head, __left, field);\t\t\\\n\t\t}\t\t\t\t\t\t\t\\\n\t}\t\t\t\t\t\t\t\t\\\n\tSPLAY_ASSEMBLE(head, &__node, __left, __right, field);\t\t\\\n}",
          "includes": [
            "#include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"config.h\"\n\nvoid name##_SPLAY_MINMAX(struct name *head, int __comp) \\\n{\t\t\t\t\t\t\t\t\t\\\n\tstruct type __node, *__left, *__right, *__tmp;\t\t\t\\\n\\\n\tSPLAY_LEFT(&__node, field) = SPLAY_RIGHT(&__node, field) = NULL;\\\n\t__left = __right = &__node;\t\t\t\t\t\\\n\\\n\twhile (1) {\t\t\t\t\t\t\t\\\n\t\tif (__comp < 0) {\t\t\t\t\t\\\n\t\t\t__tmp = SPLAY_LEFT((head)->sph_root, field);\t\\\n\t\t\tif (__tmp == NULL)\t\t\t\t\\\n\t\t\t\tbreak;\t\t\t\t\t\\\n\t\t\tif (__comp < 0){\t\t\t\t\\\n\t\t\t\tSPLAY_ROTATE_RIGHT(head, __tmp, field);\t\\\n\t\t\t\tif (SPLAY_LEFT((head)->sph_root, field) == NULL)\\\n\t\t\t\t\tbreak;\t\t\t\t\\\n\t\t\t}\t\t\t\t\t\t\\\n\t\t\tSPLAY_LINKLEFT(head, __right, field);\t\t\\\n\t\t} else if (__comp > 0) {\t\t\t\t\\\n\t\t\t__tmp = SPLAY_RIGHT((head)->sph_root, field);\t\\\n\t\t\tif (__tmp == NULL)\t\t\t\t\\\n\t\t\t\tbreak;\t\t\t\t\t\\\n\t\t\tif (__comp > 0) {\t\t\t\t\\\n\t\t\t\tSPLAY_ROTATE_LEFT(head, __tmp, field);\t\\\n\t\t\t\tif (SPLAY_RIGHT((head)->sph_root, field) == NULL)\\\n\t\t\t\t\tbreak;\t\t\t\t\\\n\t\t\t}\t\t\t\t\t\t\\\n\t\t\tSPLAY_LINKRIGHT(head, __left, field);\t\t\\\n\t\t}\t\t\t\t\t\t\t\\\n\t}\t\t\t\t\t\t\t\t\\\n\tSPLAY_ASSEMBLE(head, &__node, __left, __right, field);\t\t\\\n}"
        }
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "li->hostname"
          ],
          "line": 799
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "IN6_IS_ADDR_V4MAPPED",
          "args": [
            "&sa6->sin6_addr"
          ],
          "line": 789
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memcpy",
          "args": [
            "utx->ut_addr_v6",
            "sa6->sin6_addr.s6_addr",
            "16"
          ],
          "line": 788
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strncpy",
          "args": [
            "utx->ut_host",
            "li->hostname",
            "MIN_SIZEOF(utx->ut_host, li->hostname)"
          ],
          "line": 776
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "MIN_SIZEOF",
          "args": [
            "utx->ut_host",
            "li->hostname"
          ],
          "line": 777
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strncpy",
          "args": [
            "utx->ut_user",
            "li->username",
            "MIN_SIZEOF(utx->ut_user, li->username)"
          ],
          "line": 764
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "MIN_SIZEOF",
          "args": [
            "utx->ut_user",
            "li->username"
          ],
          "line": 765
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "set_utmpx_time",
          "args": [
            "li",
            "utx"
          ],
          "line": 760
        },
        "resolved": true,
        "details": {
          "function_name": "set_utmpx_time",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
          "lines": "727-736",
          "snippet": "void\nset_utmpx_time(struct logininfo *li, struct utmpx *utx)\n{\n# if defined(HAVE_TV_IN_UTMPX)\n\tutx->ut_tv.tv_sec = li->tv_sec;\n\tutx->ut_tv.tv_usec = li->tv_usec;\n# elif defined(HAVE_TIME_IN_UTMPX)\n\tutx->ut_time = li->tv_sec;\n# endif\n}",
          "includes": [
            "# include <util.h>",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"auth.h\"",
            "#include \"canohost.h\"",
            "#include \"packet.h\"",
            "#include \"atomicio.h\"",
            "#include \"log.h\"",
            "#include \"loginrec.h\"",
            "#include \"ssh.h\"",
            "#include \"hostfile.h\"",
            "#include \"sshkey.h\"",
            "#include \"xmalloc.h\"",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <string.h>",
            "#include <stdarg.h>",
            "#include <pwd.h>",
            "# include <paths.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "int utmp_write_entry(struct logininfo *li);",
            "int utmpx_write_entry(struct logininfo *li);",
            "int wtmp_write_entry(struct logininfo *li);",
            "int wtmpx_write_entry(struct logininfo *li);",
            "int lastlog_write_entry(struct logininfo *li);",
            "int syslogin_write_entry(struct logininfo *li);",
            "int getlast_entry(struct logininfo *li);",
            "int lastlog_get_entry(struct logininfo *li);",
            "int utmpx_get_entry(struct logininfo *li);",
            "int wtmp_get_entry(struct logininfo *li);",
            "int wtmpx_get_entry(struct logininfo *li);"
          ],
          "called_functions": [],
          "contextual_snippet": "# include <util.h>\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"auth.h\"\n#include \"canohost.h\"\n#include \"packet.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"loginrec.h\"\n#include \"ssh.h\"\n#include \"hostfile.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdarg.h>\n#include <pwd.h>\n# include <paths.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint utmp_write_entry(struct logininfo *li);\nint utmpx_write_entry(struct logininfo *li);\nint wtmp_write_entry(struct logininfo *li);\nint wtmpx_write_entry(struct logininfo *li);\nint lastlog_write_entry(struct logininfo *li);\nint syslogin_write_entry(struct logininfo *li);\nint getlast_entry(struct logininfo *li);\nint lastlog_get_entry(struct logininfo *li);\nint utmpx_get_entry(struct logininfo *li);\nint wtmp_get_entry(struct logininfo *li);\nint wtmpx_get_entry(struct logininfo *li);\n\nvoid\nset_utmpx_time(struct logininfo *li, struct utmpx *utx)\n{\n# if defined(HAVE_TV_IN_UTMPX)\n\tutx->ut_tv.tv_sec = li->tv_sec;\n\tutx->ut_tv.tv_usec = li->tv_usec;\n# elif defined(HAVE_TIME_IN_UTMPX)\n\tutx->ut_time = li->tv_sec;\n# endif\n}"
        }
      },
      {
        "call_info": {
          "callee": "line_stripname",
          "args": [
            "utx->ut_line",
            "li->line",
            "sizeof(utx->ut_line)"
          ],
          "line": 759
        },
        "resolved": true,
        "details": {
          "function_name": "line_stripname",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
          "lines": "577-586",
          "snippet": "char *\nline_stripname(char *dst, const char *src, int dstsize)\n{\n\tmemset(dst, '\\0', dstsize);\n\tif (strncmp(src, \"/dev/\", 5) == 0)\n\t\tstrlcpy(dst, src + 5, dstsize);\n\telse\n\t\tstrlcpy(dst, src, dstsize);\n\treturn (dst);\n}",
          "includes": [
            "# include <util.h>",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"auth.h\"",
            "#include \"canohost.h\"",
            "#include \"packet.h\"",
            "#include \"atomicio.h\"",
            "#include \"log.h\"",
            "#include \"loginrec.h\"",
            "#include \"ssh.h\"",
            "#include \"hostfile.h\"",
            "#include \"sshkey.h\"",
            "#include \"xmalloc.h\"",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <string.h>",
            "#include <stdarg.h>",
            "#include <pwd.h>",
            "# include <paths.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <util.h>\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"auth.h\"\n#include \"canohost.h\"\n#include \"packet.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"loginrec.h\"\n#include \"ssh.h\"\n#include \"hostfile.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdarg.h>\n#include <pwd.h>\n# include <paths.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nchar *\nline_stripname(char *dst, const char *src, int dstsize)\n{\n\tmemset(dst, '\\0', dstsize);\n\tif (strncmp(src, \"/dev/\", 5) == 0)\n\t\tstrlcpy(dst, src + 5, dstsize);\n\telse\n\t\tstrlcpy(dst, src, dstsize);\n\treturn (dst);\n}"
        }
      },
      {
        "call_info": {
          "callee": "line_abbrevname",
          "args": [
            "utx->ut_id",
            "li->line",
            "sizeof(utx->ut_id)"
          ],
          "line": 747
        },
        "resolved": true,
        "details": {
          "function_name": "line_abbrevname",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
          "lines": "596-623",
          "snippet": "char *\nline_abbrevname(char *dst, const char *src, int dstsize)\n{\n\tsize_t len;\n\n\tmemset(dst, '\\0', dstsize);\n\n\t/* Always skip prefix if present */\n\tif (strncmp(src, \"/dev/\", 5) == 0)\n\t\tsrc += 5;\n\n#ifdef WITH_ABBREV_NO_TTY\n\tif (strncmp(src, \"tty\", 3) == 0)\n\t\tsrc += 3;\n#endif\n\n\tlen = strlen(src);\n\n\tif (len > 0) {\n\t\tif (((int)len - dstsize) > 0)\n\t\t\tsrc +=  ((int)len - dstsize);\n\n\t\t/* note: _don't_ change this to strlcpy */\n\t\tstrncpy(dst, src, (size_t)dstsize);\n\t}\n\n\treturn (dst);\n}",
          "includes": [
            "# include <util.h>",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"auth.h\"",
            "#include \"canohost.h\"",
            "#include \"packet.h\"",
            "#include \"atomicio.h\"",
            "#include \"log.h\"",
            "#include \"loginrec.h\"",
            "#include \"ssh.h\"",
            "#include \"hostfile.h\"",
            "#include \"sshkey.h\"",
            "#include \"xmalloc.h\"",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <string.h>",
            "#include <stdarg.h>",
            "#include <pwd.h>",
            "# include <paths.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <util.h>\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"auth.h\"\n#include \"canohost.h\"\n#include \"packet.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"loginrec.h\"\n#include \"ssh.h\"\n#include \"hostfile.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdarg.h>\n#include <pwd.h>\n# include <paths.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nchar *\nline_abbrevname(char *dst, const char *src, int dstsize)\n{\n\tsize_t len;\n\n\tmemset(dst, '\\0', dstsize);\n\n\t/* Always skip prefix if present */\n\tif (strncmp(src, \"/dev/\", 5) == 0)\n\t\tsrc += 5;\n\n#ifdef WITH_ABBREV_NO_TTY\n\tif (strncmp(src, \"tty\", 3) == 0)\n\t\tsrc += 3;\n#endif\n\n\tlen = strlen(src);\n\n\tif (len > 0) {\n\t\tif (((int)len - dstsize) > 0)\n\t\t\tsrc +=  ((int)len - dstsize);\n\n\t\t/* note: _don't_ change this to strlcpy */\n\t\tstrncpy(dst, src, (size_t)dstsize);\n\t}\n\n\treturn (dst);\n}"
        }
      },
      {
        "call_info": {
          "callee": "memset",
          "args": [
            "utx",
            "'\\0'",
            "sizeof(*utx)"
          ],
          "line": 744
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "# include <util.h>\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"auth.h\"\n#include \"canohost.h\"\n#include \"packet.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"loginrec.h\"\n#include \"ssh.h\"\n#include \"hostfile.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdarg.h>\n#include <pwd.h>\n# include <paths.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint utmp_write_entry(struct logininfo *li);\nint utmpx_write_entry(struct logininfo *li);\nint wtmp_write_entry(struct logininfo *li);\nint wtmpx_write_entry(struct logininfo *li);\nint lastlog_write_entry(struct logininfo *li);\nint syslogin_write_entry(struct logininfo *li);\nint getlast_entry(struct logininfo *li);\nint lastlog_get_entry(struct logininfo *li);\nint utmpx_get_entry(struct logininfo *li);\nint wtmp_get_entry(struct logininfo *li);\nint wtmpx_get_entry(struct logininfo *li);\n\nvoid\nconstruct_utmpx(struct logininfo *li, struct utmpx *utx)\n{\n# ifdef HAVE_ADDR_V6_IN_UTMP\n\tstruct sockaddr_in6 *sa6;\n#  endif\n\tmemset(utx, '\\0', sizeof(*utx));\n\n# ifdef HAVE_ID_IN_UTMPX\n\tline_abbrevname(utx->ut_id, li->line, sizeof(utx->ut_id));\n# endif\n\n\t/* this is done here to keep utmp constants out of loginrec.h */\n\tswitch (li->type) {\n\tcase LTYPE_LOGIN:\n\t\tutx->ut_type = USER_PROCESS;\n\t\tbreak;\n\tcase LTYPE_LOGOUT:\n\t\tutx->ut_type = DEAD_PROCESS;\n\t\tbreak;\n\t}\n\tline_stripname(utx->ut_line, li->line, sizeof(utx->ut_line));\n\tset_utmpx_time(li, utx);\n\tutx->ut_pid = li->pid;\n\n\t/* strncpy(): Don't necessarily want null termination */\n\tstrncpy(utx->ut_user, li->username,\n\t    MIN_SIZEOF(utx->ut_user, li->username));\n\n\tif (li->type == LTYPE_LOGOUT)\n\t\treturn;\n\n\t/*\n\t * These fields are only used when logging in, and are blank\n\t * for logouts.\n\t */\n\n# ifdef HAVE_HOST_IN_UTMPX\n\tstrncpy(utx->ut_host, li->hostname,\n\t    MIN_SIZEOF(utx->ut_host, li->hostname));\n# endif\n# ifdef HAVE_ADDR_IN_UTMPX\n\t/* this is just a 32-bit IP address */\n\tif (li->hostaddr.sa.sa_family == AF_INET)\n\t\tutx->ut_addr = li->hostaddr.sa_in.sin_addr.s_addr;\n# endif\n# ifdef HAVE_ADDR_V6_IN_UTMP\n\t/* this is just a 128-bit IPv6 address */\n\tif (li->hostaddr.sa.sa_family == AF_INET6) {\n\t\tsa6 = ((struct sockaddr_in6 *)&li->hostaddr.sa);\n\t\tmemcpy(utx->ut_addr_v6, sa6->sin6_addr.s6_addr, 16);\n\t\tif (IN6_IS_ADDR_V4MAPPED(&sa6->sin6_addr)) {\n\t\t\tutx->ut_addr_v6[0] = utx->ut_addr_v6[3];\n\t\t\tutx->ut_addr_v6[1] = 0;\n\t\t\tutx->ut_addr_v6[2] = 0;\n\t\t\tutx->ut_addr_v6[3] = 0;\n\t\t}\n\t}\n# endif\n# ifdef HAVE_SYSLEN_IN_UTMPX\n\t/* ut_syslen is the length of the utx_host string */\n\tutx->ut_syslen = MIN(strlen(li->hostname), sizeof(utx->ut_host));\n# endif\n}"
  },
  {
    "function_name": "set_utmpx_time",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
    "lines": "727-736",
    "snippet": "void\nset_utmpx_time(struct logininfo *li, struct utmpx *utx)\n{\n# if defined(HAVE_TV_IN_UTMPX)\n\tutx->ut_tv.tv_sec = li->tv_sec;\n\tutx->ut_tv.tv_usec = li->tv_usec;\n# elif defined(HAVE_TIME_IN_UTMPX)\n\tutx->ut_time = li->tv_sec;\n# endif\n}",
    "includes": [
      "# include <util.h>",
      "#include \"ssherr.h\"",
      "#include \"sshbuf.h\"",
      "#include \"auth.h\"",
      "#include \"canohost.h\"",
      "#include \"packet.h\"",
      "#include \"atomicio.h\"",
      "#include \"log.h\"",
      "#include \"loginrec.h\"",
      "#include \"ssh.h\"",
      "#include \"hostfile.h\"",
      "#include \"sshkey.h\"",
      "#include \"xmalloc.h\"",
      "#include <unistd.h>",
      "#include <time.h>",
      "#include <string.h>",
      "#include <stdarg.h>",
      "#include <pwd.h>",
      "# include <paths.h>",
      "#include <fcntl.h>",
      "#include <errno.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "int utmp_write_entry(struct logininfo *li);",
      "int utmpx_write_entry(struct logininfo *li);",
      "int wtmp_write_entry(struct logininfo *li);",
      "int wtmpx_write_entry(struct logininfo *li);",
      "int lastlog_write_entry(struct logininfo *li);",
      "int syslogin_write_entry(struct logininfo *li);",
      "int getlast_entry(struct logininfo *li);",
      "int lastlog_get_entry(struct logininfo *li);",
      "int utmpx_get_entry(struct logininfo *li);",
      "int wtmp_get_entry(struct logininfo *li);",
      "int wtmpx_get_entry(struct logininfo *li);"
    ],
    "called_functions": [],
    "contextual_snippet": "# include <util.h>\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"auth.h\"\n#include \"canohost.h\"\n#include \"packet.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"loginrec.h\"\n#include \"ssh.h\"\n#include \"hostfile.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdarg.h>\n#include <pwd.h>\n# include <paths.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint utmp_write_entry(struct logininfo *li);\nint utmpx_write_entry(struct logininfo *li);\nint wtmp_write_entry(struct logininfo *li);\nint wtmpx_write_entry(struct logininfo *li);\nint lastlog_write_entry(struct logininfo *li);\nint syslogin_write_entry(struct logininfo *li);\nint getlast_entry(struct logininfo *li);\nint lastlog_get_entry(struct logininfo *li);\nint utmpx_get_entry(struct logininfo *li);\nint wtmp_get_entry(struct logininfo *li);\nint wtmpx_get_entry(struct logininfo *li);\n\nvoid\nset_utmpx_time(struct logininfo *li, struct utmpx *utx)\n{\n# if defined(HAVE_TV_IN_UTMPX)\n\tutx->ut_tv.tv_sec = li->tv_sec;\n\tutx->ut_tv.tv_usec = li->tv_usec;\n# elif defined(HAVE_TIME_IN_UTMPX)\n\tutx->ut_time = li->tv_sec;\n# endif\n}"
  },
  {
    "function_name": "construct_utmp",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
    "lines": "646-715",
    "snippet": "void\nconstruct_utmp(struct logininfo *li,\n\t\t    struct utmp *ut)\n{\n# ifdef HAVE_ADDR_V6_IN_UTMP\n\tstruct sockaddr_in6 *sa6;\n# endif\n\n\tmemset(ut, '\\0', sizeof(*ut));\n\n\t/* First fill out fields used for both logins and logouts */\n\n# ifdef HAVE_ID_IN_UTMP\n\tline_abbrevname(ut->ut_id, li->line, sizeof(ut->ut_id));\n# endif\n\n# ifdef HAVE_TYPE_IN_UTMP\n\t/* This is done here to keep utmp constants out of struct logininfo */\n\tswitch (li->type) {\n\tcase LTYPE_LOGIN:\n\t\tut->ut_type = USER_PROCESS;\n\t\tbreak;\n\tcase LTYPE_LOGOUT:\n\t\tut->ut_type = DEAD_PROCESS;\n\t\tbreak;\n\t}\n# endif\n\tset_utmp_time(li, ut);\n\n\tline_stripname(ut->ut_line, li->line, sizeof(ut->ut_line));\n\n# ifdef HAVE_PID_IN_UTMP\n\tut->ut_pid = li->pid;\n# endif\n\n\t/* If we're logging out, leave all other fields blank */\n\tif (li->type == LTYPE_LOGOUT)\n\t\treturn;\n\n\t/*\n\t * These fields are only used when logging in, and are blank\n\t * for logouts.\n\t */\n\n\t/* Use strncpy because we don't necessarily want null termination */\n\tstrncpy(ut->ut_name, li->username,\n\t    MIN_SIZEOF(ut->ut_name, li->username));\n# ifdef HAVE_HOST_IN_UTMP\n\tstrncpy(ut->ut_host, li->hostname,\n\t    MIN_SIZEOF(ut->ut_host, li->hostname));\n# endif\n# ifdef HAVE_ADDR_IN_UTMP\n\t/* this is just a 32-bit IP address */\n\tif (li->hostaddr.sa.sa_family == AF_INET)\n\t\tut->ut_addr = li->hostaddr.sa_in.sin_addr.s_addr;\n# endif\n# ifdef HAVE_ADDR_V6_IN_UTMP\n\t/* this is just a 128-bit IPv6 address */\n\tif (li->hostaddr.sa.sa_family == AF_INET6) {\n\t\tsa6 = ((struct sockaddr_in6 *)&li->hostaddr.sa);\n\t\tmemcpy(ut->ut_addr_v6, sa6->sin6_addr.s6_addr, 16);\n\t\tif (IN6_IS_ADDR_V4MAPPED(&sa6->sin6_addr)) {\n\t\t\tut->ut_addr_v6[0] = ut->ut_addr_v6[3];\n\t\t\tut->ut_addr_v6[1] = 0;\n\t\t\tut->ut_addr_v6[2] = 0;\n\t\t\tut->ut_addr_v6[3] = 0;\n\t\t}\n\t}\n# endif\n}",
    "includes": [
      "# include <util.h>",
      "#include \"ssherr.h\"",
      "#include \"sshbuf.h\"",
      "#include \"auth.h\"",
      "#include \"canohost.h\"",
      "#include \"packet.h\"",
      "#include \"atomicio.h\"",
      "#include \"log.h\"",
      "#include \"loginrec.h\"",
      "#include \"ssh.h\"",
      "#include \"hostfile.h\"",
      "#include \"sshkey.h\"",
      "#include \"xmalloc.h\"",
      "#include <unistd.h>",
      "#include <time.h>",
      "#include <string.h>",
      "#include <stdarg.h>",
      "#include <pwd.h>",
      "# include <paths.h>",
      "#include <fcntl.h>",
      "#include <errno.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "int utmp_write_entry(struct logininfo *li);",
      "int utmpx_write_entry(struct logininfo *li);",
      "int wtmp_write_entry(struct logininfo *li);",
      "int wtmpx_write_entry(struct logininfo *li);",
      "int lastlog_write_entry(struct logininfo *li);",
      "int syslogin_write_entry(struct logininfo *li);",
      "int getlast_entry(struct logininfo *li);",
      "int lastlog_get_entry(struct logininfo *li);",
      "int utmpx_get_entry(struct logininfo *li);",
      "int wtmp_get_entry(struct logininfo *li);",
      "int wtmpx_get_entry(struct logininfo *li);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "IN6_IS_ADDR_V4MAPPED",
          "args": [
            "&sa6->sin6_addr"
          ],
          "line": 707
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memcpy",
          "args": [
            "ut->ut_addr_v6",
            "sa6->sin6_addr.s6_addr",
            "16"
          ],
          "line": 706
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strncpy",
          "args": [
            "ut->ut_host",
            "li->hostname",
            "MIN_SIZEOF(ut->ut_host, li->hostname)"
          ],
          "line": 694
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "MIN_SIZEOF",
          "args": [
            "ut->ut_host",
            "li->hostname"
          ],
          "line": 695
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strncpy",
          "args": [
            "ut->ut_name",
            "li->username",
            "MIN_SIZEOF(ut->ut_name, li->username)"
          ],
          "line": 691
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "MIN_SIZEOF",
          "args": [
            "ut->ut_name",
            "li->username"
          ],
          "line": 692
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "line_stripname",
          "args": [
            "ut->ut_line",
            "li->line",
            "sizeof(ut->ut_line)"
          ],
          "line": 675
        },
        "resolved": true,
        "details": {
          "function_name": "line_stripname",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
          "lines": "577-586",
          "snippet": "char *\nline_stripname(char *dst, const char *src, int dstsize)\n{\n\tmemset(dst, '\\0', dstsize);\n\tif (strncmp(src, \"/dev/\", 5) == 0)\n\t\tstrlcpy(dst, src + 5, dstsize);\n\telse\n\t\tstrlcpy(dst, src, dstsize);\n\treturn (dst);\n}",
          "includes": [
            "# include <util.h>",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"auth.h\"",
            "#include \"canohost.h\"",
            "#include \"packet.h\"",
            "#include \"atomicio.h\"",
            "#include \"log.h\"",
            "#include \"loginrec.h\"",
            "#include \"ssh.h\"",
            "#include \"hostfile.h\"",
            "#include \"sshkey.h\"",
            "#include \"xmalloc.h\"",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <string.h>",
            "#include <stdarg.h>",
            "#include <pwd.h>",
            "# include <paths.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <util.h>\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"auth.h\"\n#include \"canohost.h\"\n#include \"packet.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"loginrec.h\"\n#include \"ssh.h\"\n#include \"hostfile.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdarg.h>\n#include <pwd.h>\n# include <paths.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nchar *\nline_stripname(char *dst, const char *src, int dstsize)\n{\n\tmemset(dst, '\\0', dstsize);\n\tif (strncmp(src, \"/dev/\", 5) == 0)\n\t\tstrlcpy(dst, src + 5, dstsize);\n\telse\n\t\tstrlcpy(dst, src, dstsize);\n\treturn (dst);\n}"
        }
      },
      {
        "call_info": {
          "callee": "set_utmp_time",
          "args": [
            "li",
            "ut"
          ],
          "line": 673
        },
        "resolved": true,
        "details": {
          "function_name": "set_utmp_time",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
          "lines": "635-644",
          "snippet": "void\nset_utmp_time(struct logininfo *li, struct utmp *ut)\n{\n# if defined(HAVE_TV_IN_UTMP)\n\tut->ut_tv.tv_sec = li->tv_sec;\n\tut->ut_tv.tv_usec = li->tv_usec;\n# elif defined(HAVE_TIME_IN_UTMP)\n\tut->ut_time = li->tv_sec;\n# endif\n}",
          "includes": [
            "# include <util.h>",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"auth.h\"",
            "#include \"canohost.h\"",
            "#include \"packet.h\"",
            "#include \"atomicio.h\"",
            "#include \"log.h\"",
            "#include \"loginrec.h\"",
            "#include \"ssh.h\"",
            "#include \"hostfile.h\"",
            "#include \"sshkey.h\"",
            "#include \"xmalloc.h\"",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <string.h>",
            "#include <stdarg.h>",
            "#include <pwd.h>",
            "# include <paths.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "int utmp_write_entry(struct logininfo *li);",
            "int utmpx_write_entry(struct logininfo *li);",
            "int wtmp_write_entry(struct logininfo *li);",
            "int wtmpx_write_entry(struct logininfo *li);",
            "int lastlog_write_entry(struct logininfo *li);",
            "int syslogin_write_entry(struct logininfo *li);",
            "int getlast_entry(struct logininfo *li);",
            "int lastlog_get_entry(struct logininfo *li);",
            "int utmpx_get_entry(struct logininfo *li);",
            "int wtmp_get_entry(struct logininfo *li);",
            "int wtmpx_get_entry(struct logininfo *li);"
          ],
          "called_functions": [],
          "contextual_snippet": "# include <util.h>\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"auth.h\"\n#include \"canohost.h\"\n#include \"packet.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"loginrec.h\"\n#include \"ssh.h\"\n#include \"hostfile.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdarg.h>\n#include <pwd.h>\n# include <paths.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint utmp_write_entry(struct logininfo *li);\nint utmpx_write_entry(struct logininfo *li);\nint wtmp_write_entry(struct logininfo *li);\nint wtmpx_write_entry(struct logininfo *li);\nint lastlog_write_entry(struct logininfo *li);\nint syslogin_write_entry(struct logininfo *li);\nint getlast_entry(struct logininfo *li);\nint lastlog_get_entry(struct logininfo *li);\nint utmpx_get_entry(struct logininfo *li);\nint wtmp_get_entry(struct logininfo *li);\nint wtmpx_get_entry(struct logininfo *li);\n\nvoid\nset_utmp_time(struct logininfo *li, struct utmp *ut)\n{\n# if defined(HAVE_TV_IN_UTMP)\n\tut->ut_tv.tv_sec = li->tv_sec;\n\tut->ut_tv.tv_usec = li->tv_usec;\n# elif defined(HAVE_TIME_IN_UTMP)\n\tut->ut_time = li->tv_sec;\n# endif\n}"
        }
      },
      {
        "call_info": {
          "callee": "line_abbrevname",
          "args": [
            "ut->ut_id",
            "li->line",
            "sizeof(ut->ut_id)"
          ],
          "line": 659
        },
        "resolved": true,
        "details": {
          "function_name": "line_abbrevname",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
          "lines": "596-623",
          "snippet": "char *\nline_abbrevname(char *dst, const char *src, int dstsize)\n{\n\tsize_t len;\n\n\tmemset(dst, '\\0', dstsize);\n\n\t/* Always skip prefix if present */\n\tif (strncmp(src, \"/dev/\", 5) == 0)\n\t\tsrc += 5;\n\n#ifdef WITH_ABBREV_NO_TTY\n\tif (strncmp(src, \"tty\", 3) == 0)\n\t\tsrc += 3;\n#endif\n\n\tlen = strlen(src);\n\n\tif (len > 0) {\n\t\tif (((int)len - dstsize) > 0)\n\t\t\tsrc +=  ((int)len - dstsize);\n\n\t\t/* note: _don't_ change this to strlcpy */\n\t\tstrncpy(dst, src, (size_t)dstsize);\n\t}\n\n\treturn (dst);\n}",
          "includes": [
            "# include <util.h>",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"auth.h\"",
            "#include \"canohost.h\"",
            "#include \"packet.h\"",
            "#include \"atomicio.h\"",
            "#include \"log.h\"",
            "#include \"loginrec.h\"",
            "#include \"ssh.h\"",
            "#include \"hostfile.h\"",
            "#include \"sshkey.h\"",
            "#include \"xmalloc.h\"",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <string.h>",
            "#include <stdarg.h>",
            "#include <pwd.h>",
            "# include <paths.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <util.h>\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"auth.h\"\n#include \"canohost.h\"\n#include \"packet.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"loginrec.h\"\n#include \"ssh.h\"\n#include \"hostfile.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdarg.h>\n#include <pwd.h>\n# include <paths.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nchar *\nline_abbrevname(char *dst, const char *src, int dstsize)\n{\n\tsize_t len;\n\n\tmemset(dst, '\\0', dstsize);\n\n\t/* Always skip prefix if present */\n\tif (strncmp(src, \"/dev/\", 5) == 0)\n\t\tsrc += 5;\n\n#ifdef WITH_ABBREV_NO_TTY\n\tif (strncmp(src, \"tty\", 3) == 0)\n\t\tsrc += 3;\n#endif\n\n\tlen = strlen(src);\n\n\tif (len > 0) {\n\t\tif (((int)len - dstsize) > 0)\n\t\t\tsrc +=  ((int)len - dstsize);\n\n\t\t/* note: _don't_ change this to strlcpy */\n\t\tstrncpy(dst, src, (size_t)dstsize);\n\t}\n\n\treturn (dst);\n}"
        }
      },
      {
        "call_info": {
          "callee": "memset",
          "args": [
            "ut",
            "'\\0'",
            "sizeof(*ut)"
          ],
          "line": 654
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "# include <util.h>\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"auth.h\"\n#include \"canohost.h\"\n#include \"packet.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"loginrec.h\"\n#include \"ssh.h\"\n#include \"hostfile.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdarg.h>\n#include <pwd.h>\n# include <paths.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint utmp_write_entry(struct logininfo *li);\nint utmpx_write_entry(struct logininfo *li);\nint wtmp_write_entry(struct logininfo *li);\nint wtmpx_write_entry(struct logininfo *li);\nint lastlog_write_entry(struct logininfo *li);\nint syslogin_write_entry(struct logininfo *li);\nint getlast_entry(struct logininfo *li);\nint lastlog_get_entry(struct logininfo *li);\nint utmpx_get_entry(struct logininfo *li);\nint wtmp_get_entry(struct logininfo *li);\nint wtmpx_get_entry(struct logininfo *li);\n\nvoid\nconstruct_utmp(struct logininfo *li,\n\t\t    struct utmp *ut)\n{\n# ifdef HAVE_ADDR_V6_IN_UTMP\n\tstruct sockaddr_in6 *sa6;\n# endif\n\n\tmemset(ut, '\\0', sizeof(*ut));\n\n\t/* First fill out fields used for both logins and logouts */\n\n# ifdef HAVE_ID_IN_UTMP\n\tline_abbrevname(ut->ut_id, li->line, sizeof(ut->ut_id));\n# endif\n\n# ifdef HAVE_TYPE_IN_UTMP\n\t/* This is done here to keep utmp constants out of struct logininfo */\n\tswitch (li->type) {\n\tcase LTYPE_LOGIN:\n\t\tut->ut_type = USER_PROCESS;\n\t\tbreak;\n\tcase LTYPE_LOGOUT:\n\t\tut->ut_type = DEAD_PROCESS;\n\t\tbreak;\n\t}\n# endif\n\tset_utmp_time(li, ut);\n\n\tline_stripname(ut->ut_line, li->line, sizeof(ut->ut_line));\n\n# ifdef HAVE_PID_IN_UTMP\n\tut->ut_pid = li->pid;\n# endif\n\n\t/* If we're logging out, leave all other fields blank */\n\tif (li->type == LTYPE_LOGOUT)\n\t\treturn;\n\n\t/*\n\t * These fields are only used when logging in, and are blank\n\t * for logouts.\n\t */\n\n\t/* Use strncpy because we don't necessarily want null termination */\n\tstrncpy(ut->ut_name, li->username,\n\t    MIN_SIZEOF(ut->ut_name, li->username));\n# ifdef HAVE_HOST_IN_UTMP\n\tstrncpy(ut->ut_host, li->hostname,\n\t    MIN_SIZEOF(ut->ut_host, li->hostname));\n# endif\n# ifdef HAVE_ADDR_IN_UTMP\n\t/* this is just a 32-bit IP address */\n\tif (li->hostaddr.sa.sa_family == AF_INET)\n\t\tut->ut_addr = li->hostaddr.sa_in.sin_addr.s_addr;\n# endif\n# ifdef HAVE_ADDR_V6_IN_UTMP\n\t/* this is just a 128-bit IPv6 address */\n\tif (li->hostaddr.sa.sa_family == AF_INET6) {\n\t\tsa6 = ((struct sockaddr_in6 *)&li->hostaddr.sa);\n\t\tmemcpy(ut->ut_addr_v6, sa6->sin6_addr.s6_addr, 16);\n\t\tif (IN6_IS_ADDR_V4MAPPED(&sa6->sin6_addr)) {\n\t\t\tut->ut_addr_v6[0] = ut->ut_addr_v6[3];\n\t\t\tut->ut_addr_v6[1] = 0;\n\t\t\tut->ut_addr_v6[2] = 0;\n\t\t\tut->ut_addr_v6[3] = 0;\n\t\t}\n\t}\n# endif\n}"
  },
  {
    "function_name": "set_utmp_time",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
    "lines": "635-644",
    "snippet": "void\nset_utmp_time(struct logininfo *li, struct utmp *ut)\n{\n# if defined(HAVE_TV_IN_UTMP)\n\tut->ut_tv.tv_sec = li->tv_sec;\n\tut->ut_tv.tv_usec = li->tv_usec;\n# elif defined(HAVE_TIME_IN_UTMP)\n\tut->ut_time = li->tv_sec;\n# endif\n}",
    "includes": [
      "# include <util.h>",
      "#include \"ssherr.h\"",
      "#include \"sshbuf.h\"",
      "#include \"auth.h\"",
      "#include \"canohost.h\"",
      "#include \"packet.h\"",
      "#include \"atomicio.h\"",
      "#include \"log.h\"",
      "#include \"loginrec.h\"",
      "#include \"ssh.h\"",
      "#include \"hostfile.h\"",
      "#include \"sshkey.h\"",
      "#include \"xmalloc.h\"",
      "#include <unistd.h>",
      "#include <time.h>",
      "#include <string.h>",
      "#include <stdarg.h>",
      "#include <pwd.h>",
      "# include <paths.h>",
      "#include <fcntl.h>",
      "#include <errno.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "int utmp_write_entry(struct logininfo *li);",
      "int utmpx_write_entry(struct logininfo *li);",
      "int wtmp_write_entry(struct logininfo *li);",
      "int wtmpx_write_entry(struct logininfo *li);",
      "int lastlog_write_entry(struct logininfo *li);",
      "int syslogin_write_entry(struct logininfo *li);",
      "int getlast_entry(struct logininfo *li);",
      "int lastlog_get_entry(struct logininfo *li);",
      "int utmpx_get_entry(struct logininfo *li);",
      "int wtmp_get_entry(struct logininfo *li);",
      "int wtmpx_get_entry(struct logininfo *li);"
    ],
    "called_functions": [],
    "contextual_snippet": "# include <util.h>\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"auth.h\"\n#include \"canohost.h\"\n#include \"packet.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"loginrec.h\"\n#include \"ssh.h\"\n#include \"hostfile.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdarg.h>\n#include <pwd.h>\n# include <paths.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint utmp_write_entry(struct logininfo *li);\nint utmpx_write_entry(struct logininfo *li);\nint wtmp_write_entry(struct logininfo *li);\nint wtmpx_write_entry(struct logininfo *li);\nint lastlog_write_entry(struct logininfo *li);\nint syslogin_write_entry(struct logininfo *li);\nint getlast_entry(struct logininfo *li);\nint lastlog_get_entry(struct logininfo *li);\nint utmpx_get_entry(struct logininfo *li);\nint wtmp_get_entry(struct logininfo *li);\nint wtmpx_get_entry(struct logininfo *li);\n\nvoid\nset_utmp_time(struct logininfo *li, struct utmp *ut)\n{\n# if defined(HAVE_TV_IN_UTMP)\n\tut->ut_tv.tv_sec = li->tv_sec;\n\tut->ut_tv.tv_usec = li->tv_usec;\n# elif defined(HAVE_TIME_IN_UTMP)\n\tut->ut_time = li->tv_sec;\n# endif\n}"
  },
  {
    "function_name": "line_abbrevname",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
    "lines": "596-623",
    "snippet": "char *\nline_abbrevname(char *dst, const char *src, int dstsize)\n{\n\tsize_t len;\n\n\tmemset(dst, '\\0', dstsize);\n\n\t/* Always skip prefix if present */\n\tif (strncmp(src, \"/dev/\", 5) == 0)\n\t\tsrc += 5;\n\n#ifdef WITH_ABBREV_NO_TTY\n\tif (strncmp(src, \"tty\", 3) == 0)\n\t\tsrc += 3;\n#endif\n\n\tlen = strlen(src);\n\n\tif (len > 0) {\n\t\tif (((int)len - dstsize) > 0)\n\t\t\tsrc +=  ((int)len - dstsize);\n\n\t\t/* note: _don't_ change this to strlcpy */\n\t\tstrncpy(dst, src, (size_t)dstsize);\n\t}\n\n\treturn (dst);\n}",
    "includes": [
      "# include <util.h>",
      "#include \"ssherr.h\"",
      "#include \"sshbuf.h\"",
      "#include \"auth.h\"",
      "#include \"canohost.h\"",
      "#include \"packet.h\"",
      "#include \"atomicio.h\"",
      "#include \"log.h\"",
      "#include \"loginrec.h\"",
      "#include \"ssh.h\"",
      "#include \"hostfile.h\"",
      "#include \"sshkey.h\"",
      "#include \"xmalloc.h\"",
      "#include <unistd.h>",
      "#include <time.h>",
      "#include <string.h>",
      "#include <stdarg.h>",
      "#include <pwd.h>",
      "# include <paths.h>",
      "#include <fcntl.h>",
      "#include <errno.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "strncpy",
          "args": [
            "dst",
            "src",
            "(size_t)dstsize"
          ],
          "line": 619
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "src"
          ],
          "line": 612
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strncmp",
          "args": [
            "src",
            "\"tty\"",
            "3"
          ],
          "line": 608
        },
        "resolved": true,
        "details": {
          "function_name": "g_strncmp",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/openbsd-compat/glob.c",
          "lines": "422-435",
          "snippet": "static int\ng_strncmp(const Char *s1, const char *s2, size_t n)\n{\n\tint rv = 0;\n\n\twhile (n--) {\n\t\trv = *(Char *)s1 - *(const unsigned char *)s2++;\n\t\tif (rv)\n\t\t\tbreak;\n\t\tif (*s1++ == '\\0')\n\t\t\tbreak;\n\t}\n\treturn rv;\n}",
          "includes": [
            "#include \"charclass.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <pwd.h>",
            "#include <limits.h>",
            "#include <errno.h>",
            "#include <ctype.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include \"glob.h\"",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"charclass.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <pwd.h>\n#include <limits.h>\n#include <errno.h>\n#include <ctype.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"glob.h\"\n#include \"includes.h\"\n\nstatic int\ng_strncmp(const Char *s1, const char *s2, size_t n)\n{\n\tint rv = 0;\n\n\twhile (n--) {\n\t\trv = *(Char *)s1 - *(const unsigned char *)s2++;\n\t\tif (rv)\n\t\t\tbreak;\n\t\tif (*s1++ == '\\0')\n\t\t\tbreak;\n\t}\n\treturn rv;\n}"
        }
      },
      {
        "call_info": {
          "callee": "memset",
          "args": [
            "dst",
            "'\\0'",
            "dstsize"
          ],
          "line": 601
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "# include <util.h>\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"auth.h\"\n#include \"canohost.h\"\n#include \"packet.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"loginrec.h\"\n#include \"ssh.h\"\n#include \"hostfile.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdarg.h>\n#include <pwd.h>\n# include <paths.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nchar *\nline_abbrevname(char *dst, const char *src, int dstsize)\n{\n\tsize_t len;\n\n\tmemset(dst, '\\0', dstsize);\n\n\t/* Always skip prefix if present */\n\tif (strncmp(src, \"/dev/\", 5) == 0)\n\t\tsrc += 5;\n\n#ifdef WITH_ABBREV_NO_TTY\n\tif (strncmp(src, \"tty\", 3) == 0)\n\t\tsrc += 3;\n#endif\n\n\tlen = strlen(src);\n\n\tif (len > 0) {\n\t\tif (((int)len - dstsize) > 0)\n\t\t\tsrc +=  ((int)len - dstsize);\n\n\t\t/* note: _don't_ change this to strlcpy */\n\t\tstrncpy(dst, src, (size_t)dstsize);\n\t}\n\n\treturn (dst);\n}"
  },
  {
    "function_name": "line_stripname",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
    "lines": "577-586",
    "snippet": "char *\nline_stripname(char *dst, const char *src, int dstsize)\n{\n\tmemset(dst, '\\0', dstsize);\n\tif (strncmp(src, \"/dev/\", 5) == 0)\n\t\tstrlcpy(dst, src + 5, dstsize);\n\telse\n\t\tstrlcpy(dst, src, dstsize);\n\treturn (dst);\n}",
    "includes": [
      "# include <util.h>",
      "#include \"ssherr.h\"",
      "#include \"sshbuf.h\"",
      "#include \"auth.h\"",
      "#include \"canohost.h\"",
      "#include \"packet.h\"",
      "#include \"atomicio.h\"",
      "#include \"log.h\"",
      "#include \"loginrec.h\"",
      "#include \"ssh.h\"",
      "#include \"hostfile.h\"",
      "#include \"sshkey.h\"",
      "#include \"xmalloc.h\"",
      "#include <unistd.h>",
      "#include <time.h>",
      "#include <string.h>",
      "#include <stdarg.h>",
      "#include <pwd.h>",
      "# include <paths.h>",
      "#include <fcntl.h>",
      "#include <errno.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "strlcpy",
          "args": [
            "dst",
            "src",
            "dstsize"
          ],
          "line": 584
        },
        "resolved": true,
        "details": {
          "function_name": "strlcpy",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/openbsd-compat/strlcpy.c",
          "lines": "32-56",
          "snippet": "size_t\nstrlcpy(char *dst, const char *src, size_t siz)\n{\n\tchar *d = dst;\n\tconst char *s = src;\n\tsize_t n = siz;\n\n\t/* Copy as many bytes as will fit */\n\tif (n != 0) {\n\t\twhile (--n != 0) {\n\t\t\tif ((*d++ = *s++) == '\\0')\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\t/* Not enough room in dst, add NUL and traverse rest of src */\n\tif (n == 0) {\n\t\tif (siz != 0)\n\t\t\t*d = '\\0';\t\t/* NUL-terminate dst */\n\t\twhile (*s++)\n\t\t\t;\n\t}\n\n\treturn(s - src - 1);\t/* count does not include NUL */\n}",
          "includes": [
            "#include <string.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nsize_t\nstrlcpy(char *dst, const char *src, size_t siz)\n{\n\tchar *d = dst;\n\tconst char *s = src;\n\tsize_t n = siz;\n\n\t/* Copy as many bytes as will fit */\n\tif (n != 0) {\n\t\twhile (--n != 0) {\n\t\t\tif ((*d++ = *s++) == '\\0')\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\t/* Not enough room in dst, add NUL and traverse rest of src */\n\tif (n == 0) {\n\t\tif (siz != 0)\n\t\t\t*d = '\\0';\t\t/* NUL-terminate dst */\n\t\twhile (*s++)\n\t\t\t;\n\t}\n\n\treturn(s - src - 1);\t/* count does not include NUL */\n}"
        }
      },
      {
        "call_info": {
          "callee": "strncmp",
          "args": [
            "src",
            "\"/dev/\"",
            "5"
          ],
          "line": 581
        },
        "resolved": true,
        "details": {
          "function_name": "g_strncmp",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/openbsd-compat/glob.c",
          "lines": "422-435",
          "snippet": "static int\ng_strncmp(const Char *s1, const char *s2, size_t n)\n{\n\tint rv = 0;\n\n\twhile (n--) {\n\t\trv = *(Char *)s1 - *(const unsigned char *)s2++;\n\t\tif (rv)\n\t\t\tbreak;\n\t\tif (*s1++ == '\\0')\n\t\t\tbreak;\n\t}\n\treturn rv;\n}",
          "includes": [
            "#include \"charclass.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <pwd.h>",
            "#include <limits.h>",
            "#include <errno.h>",
            "#include <ctype.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include \"glob.h\"",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"charclass.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <pwd.h>\n#include <limits.h>\n#include <errno.h>\n#include <ctype.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"glob.h\"\n#include \"includes.h\"\n\nstatic int\ng_strncmp(const Char *s1, const char *s2, size_t n)\n{\n\tint rv = 0;\n\n\twhile (n--) {\n\t\trv = *(Char *)s1 - *(const unsigned char *)s2++;\n\t\tif (rv)\n\t\t\tbreak;\n\t\tif (*s1++ == '\\0')\n\t\t\tbreak;\n\t}\n\treturn rv;\n}"
        }
      },
      {
        "call_info": {
          "callee": "memset",
          "args": [
            "dst",
            "'\\0'",
            "dstsize"
          ],
          "line": 580
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "# include <util.h>\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"auth.h\"\n#include \"canohost.h\"\n#include \"packet.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"loginrec.h\"\n#include \"ssh.h\"\n#include \"hostfile.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdarg.h>\n#include <pwd.h>\n# include <paths.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nchar *\nline_stripname(char *dst, const char *src, int dstsize)\n{\n\tmemset(dst, '\\0', dstsize);\n\tif (strncmp(src, \"/dev/\", 5) == 0)\n\t\tstrlcpy(dst, src + 5, dstsize);\n\telse\n\t\tstrlcpy(dst, src, dstsize);\n\treturn (dst);\n}"
  },
  {
    "function_name": "line_fullname",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
    "lines": "563-574",
    "snippet": "char *\nline_fullname(char *dst, const char *src, u_int dstsize)\n{\n\tmemset(dst, '\\0', dstsize);\n\tif ((strncmp(src, \"/dev/\", 5) == 0) || (dstsize < (strlen(src) + 5)))\n\t\tstrlcpy(dst, src, dstsize);\n\telse {\n\t\tstrlcpy(dst, \"/dev/\", dstsize);\n\t\tstrlcat(dst, src, dstsize);\n\t}\n\treturn (dst);\n}",
    "includes": [
      "# include <util.h>",
      "#include \"ssherr.h\"",
      "#include \"sshbuf.h\"",
      "#include \"auth.h\"",
      "#include \"canohost.h\"",
      "#include \"packet.h\"",
      "#include \"atomicio.h\"",
      "#include \"log.h\"",
      "#include \"loginrec.h\"",
      "#include \"ssh.h\"",
      "#include \"hostfile.h\"",
      "#include \"sshkey.h\"",
      "#include \"xmalloc.h\"",
      "#include <unistd.h>",
      "#include <time.h>",
      "#include <string.h>",
      "#include <stdarg.h>",
      "#include <pwd.h>",
      "# include <paths.h>",
      "#include <fcntl.h>",
      "#include <errno.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "strlcat",
          "args": [
            "dst",
            "src",
            "dstsize"
          ],
          "line": 571
        },
        "resolved": true,
        "details": {
          "function_name": "strlcat",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/openbsd-compat/strlcat.c",
          "lines": "34-60",
          "snippet": "size_t\nstrlcat(char *dst, const char *src, size_t siz)\n{\n\tchar *d = dst;\n\tconst char *s = src;\n\tsize_t n = siz;\n\tsize_t dlen;\n\n\t/* Find the end of dst and adjust bytes left but don't go past end */\n\twhile (n-- != 0 && *d != '\\0')\n\t\td++;\n\tdlen = d - dst;\n\tn = siz - dlen;\n\n\tif (n == 0)\n\t\treturn(dlen + strlen(s));\n\twhile (*s != '\\0') {\n\t\tif (n != 1) {\n\t\t\t*d++ = *s;\n\t\t\tn--;\n\t\t}\n\t\ts++;\n\t}\n\t*d = '\\0';\n\n\treturn(dlen + (s - src));\t/* count does not include NUL */\n}",
          "includes": [
            "#include <string.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nsize_t\nstrlcat(char *dst, const char *src, size_t siz)\n{\n\tchar *d = dst;\n\tconst char *s = src;\n\tsize_t n = siz;\n\tsize_t dlen;\n\n\t/* Find the end of dst and adjust bytes left but don't go past end */\n\twhile (n-- != 0 && *d != '\\0')\n\t\td++;\n\tdlen = d - dst;\n\tn = siz - dlen;\n\n\tif (n == 0)\n\t\treturn(dlen + strlen(s));\n\twhile (*s != '\\0') {\n\t\tif (n != 1) {\n\t\t\t*d++ = *s;\n\t\t\tn--;\n\t\t}\n\t\ts++;\n\t}\n\t*d = '\\0';\n\n\treturn(dlen + (s - src));\t/* count does not include NUL */\n}"
        }
      },
      {
        "call_info": {
          "callee": "strlcpy",
          "args": [
            "dst",
            "\"/dev/\"",
            "dstsize"
          ],
          "line": 570
        },
        "resolved": true,
        "details": {
          "function_name": "strlcpy",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/openbsd-compat/strlcpy.c",
          "lines": "32-56",
          "snippet": "size_t\nstrlcpy(char *dst, const char *src, size_t siz)\n{\n\tchar *d = dst;\n\tconst char *s = src;\n\tsize_t n = siz;\n\n\t/* Copy as many bytes as will fit */\n\tif (n != 0) {\n\t\twhile (--n != 0) {\n\t\t\tif ((*d++ = *s++) == '\\0')\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\t/* Not enough room in dst, add NUL and traverse rest of src */\n\tif (n == 0) {\n\t\tif (siz != 0)\n\t\t\t*d = '\\0';\t\t/* NUL-terminate dst */\n\t\twhile (*s++)\n\t\t\t;\n\t}\n\n\treturn(s - src - 1);\t/* count does not include NUL */\n}",
          "includes": [
            "#include <string.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nsize_t\nstrlcpy(char *dst, const char *src, size_t siz)\n{\n\tchar *d = dst;\n\tconst char *s = src;\n\tsize_t n = siz;\n\n\t/* Copy as many bytes as will fit */\n\tif (n != 0) {\n\t\twhile (--n != 0) {\n\t\t\tif ((*d++ = *s++) == '\\0')\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\t/* Not enough room in dst, add NUL and traverse rest of src */\n\tif (n == 0) {\n\t\tif (siz != 0)\n\t\t\t*d = '\\0';\t\t/* NUL-terminate dst */\n\t\twhile (*s++)\n\t\t\t;\n\t}\n\n\treturn(s - src - 1);\t/* count does not include NUL */\n}"
        }
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "src"
          ],
          "line": 567
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strncmp",
          "args": [
            "src",
            "\"/dev/\"",
            "5"
          ],
          "line": 567
        },
        "resolved": true,
        "details": {
          "function_name": "g_strncmp",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/openbsd-compat/glob.c",
          "lines": "422-435",
          "snippet": "static int\ng_strncmp(const Char *s1, const char *s2, size_t n)\n{\n\tint rv = 0;\n\n\twhile (n--) {\n\t\trv = *(Char *)s1 - *(const unsigned char *)s2++;\n\t\tif (rv)\n\t\t\tbreak;\n\t\tif (*s1++ == '\\0')\n\t\t\tbreak;\n\t}\n\treturn rv;\n}",
          "includes": [
            "#include \"charclass.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <pwd.h>",
            "#include <limits.h>",
            "#include <errno.h>",
            "#include <ctype.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include \"glob.h\"",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"charclass.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <pwd.h>\n#include <limits.h>\n#include <errno.h>\n#include <ctype.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"glob.h\"\n#include \"includes.h\"\n\nstatic int\ng_strncmp(const Char *s1, const char *s2, size_t n)\n{\n\tint rv = 0;\n\n\twhile (n--) {\n\t\trv = *(Char *)s1 - *(const unsigned char *)s2++;\n\t\tif (rv)\n\t\t\tbreak;\n\t\tif (*s1++ == '\\0')\n\t\t\tbreak;\n\t}\n\treturn rv;\n}"
        }
      },
      {
        "call_info": {
          "callee": "memset",
          "args": [
            "dst",
            "'\\0'",
            "dstsize"
          ],
          "line": 566
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "# include <util.h>\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"auth.h\"\n#include \"canohost.h\"\n#include \"packet.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"loginrec.h\"\n#include \"ssh.h\"\n#include \"hostfile.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdarg.h>\n#include <pwd.h>\n# include <paths.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nchar *\nline_fullname(char *dst, const char *src, u_int dstsize)\n{\n\tmemset(dst, '\\0', dstsize);\n\tif ((strncmp(src, \"/dev/\", 5) == 0) || (dstsize < (strlen(src) + 5)))\n\t\tstrlcpy(dst, src, dstsize);\n\telse {\n\t\tstrlcpy(dst, \"/dev/\", dstsize);\n\t\tstrlcat(dst, src, dstsize);\n\t}\n\treturn (dst);\n}"
  },
  {
    "function_name": "getlast_entry",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
    "lines": "510-538",
    "snippet": "int\ngetlast_entry(struct logininfo *li)\n{\n#ifdef USE_LASTLOG\n\treturn(lastlog_get_entry(li));\n#else /* !USE_LASTLOG */\n#if defined(USE_UTMPX) && defined(HAVE_SETUTXDB) && \\\n    defined(UTXDB_LASTLOGIN) && defined(HAVE_GETUTXUSER)\n\treturn (utmpx_get_entry(li));\n#endif\n\n#if defined(DISABLE_LASTLOG)\n\t/* On some systems we shouldn't even try to obtain last login\n\t * time, e.g. AIX */\n\treturn (0);\n# elif defined(USE_WTMP) && \\\n    (defined(HAVE_TIME_IN_UTMP) || defined(HAVE_TV_IN_UTMP))\n\t/* retrieve last login time from utmp */\n\treturn (wtmp_get_entry(li));\n# elif defined(USE_WTMPX) && \\\n    (defined(HAVE_TIME_IN_UTMPX) || defined(HAVE_TV_IN_UTMPX))\n\t/* If wtmp isn't available, try wtmpx */\n\treturn (wtmpx_get_entry(li));\n# else\n\t/* Give up: No means of retrieving last login time */\n\treturn (0);\n# endif /* DISABLE_LASTLOG */\n#endif /* USE_LASTLOG */\n}",
    "includes": [
      "# include <util.h>",
      "#include \"ssherr.h\"",
      "#include \"sshbuf.h\"",
      "#include \"auth.h\"",
      "#include \"canohost.h\"",
      "#include \"packet.h\"",
      "#include \"atomicio.h\"",
      "#include \"log.h\"",
      "#include \"loginrec.h\"",
      "#include \"ssh.h\"",
      "#include \"hostfile.h\"",
      "#include \"sshkey.h\"",
      "#include \"xmalloc.h\"",
      "#include <unistd.h>",
      "#include <time.h>",
      "#include <string.h>",
      "#include <stdarg.h>",
      "#include <pwd.h>",
      "# include <paths.h>",
      "#include <fcntl.h>",
      "#include <errno.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "int utmp_write_entry(struct logininfo *li);",
      "int utmpx_write_entry(struct logininfo *li);",
      "int wtmp_write_entry(struct logininfo *li);",
      "int wtmpx_write_entry(struct logininfo *li);",
      "int lastlog_write_entry(struct logininfo *li);",
      "int syslogin_write_entry(struct logininfo *li);",
      "int getlast_entry(struct logininfo *li);",
      "int lastlog_get_entry(struct logininfo *li);",
      "int utmpx_get_entry(struct logininfo *li);",
      "int wtmp_get_entry(struct logininfo *li);",
      "int wtmpx_get_entry(struct logininfo *li);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "wtmpx_get_entry",
          "args": [
            "li"
          ],
          "line": 532
        },
        "resolved": true,
        "details": {
          "function_name": "wtmpx_get_entry",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
          "lines": "1341-1403",
          "snippet": "int\nwtmpx_get_entry(struct logininfo *li)\n{\n\tstruct stat st;\n\tstruct utmpx utx;\n\tint fd, found=0;\n\n\t/* Clear the time entries */\n\tli->tv_sec = li->tv_usec = 0;\n\n\tif ((fd = open(WTMPX_FILE, O_RDONLY)) < 0) {\n\t\tlogit(\"%s: problem opening %s: %s\", __func__,\n\t\t    WTMPX_FILE, strerror(errno));\n\t\treturn (0);\n\t}\n\tif (fstat(fd, &st) != 0) {\n\t\tlogit(\"%s: couldn't stat %s: %s\", __func__,\n\t\t    WTMPX_FILE, strerror(errno));\n\t\tclose(fd);\n\t\treturn (0);\n\t}\n\n\t/* Seek to the start of the last struct utmpx */\n\tif (lseek(fd, -(off_t)sizeof(struct utmpx), SEEK_END) == -1 ) {\n\t\t/* probably a newly rotated wtmpx file */\n\t\tclose(fd);\n\t\treturn (0);\n\t}\n\n\twhile (!found) {\n\t\tif (atomicio(read, fd, &utx, sizeof(utx)) != sizeof(utx)) {\n\t\t\tlogit(\"%s: read of %s failed: %s\", __func__,\n\t\t\t    WTMPX_FILE, strerror(errno));\n\t\t\tclose (fd);\n\t\t\treturn (0);\n\t\t}\n\t\t/*\n\t\t * Logouts are recorded as a blank username on a particular\n\t\t * line. So, we just need to find the username in struct utmpx\n\t\t */\n\t\tif (wtmpx_islogin(li, &utx)) {\n\t\t\tfound = 1;\n# if defined(HAVE_TV_IN_UTMPX)\n\t\t\tli->tv_sec = utx.ut_tv.tv_sec;\n# elif defined(HAVE_TIME_IN_UTMPX)\n\t\t\tli->tv_sec = utx.ut_time;\n# endif\n\t\t\tline_fullname(li->line, utx.ut_line, sizeof(li->line));\n# if defined(HAVE_HOST_IN_UTMPX)\n\t\t\tstrlcpy(li->hostname, utx.ut_host,\n\t\t\t    MIN_SIZEOF(li->hostname, utx.ut_host));\n# endif\n\t\t\tcontinue;\n\t\t}\n\t\tif (lseek(fd, -(off_t)(2 * sizeof(struct utmpx)), SEEK_CUR) == -1) {\n\t\t\tclose(fd);\n\t\t\treturn (0);\n\t\t}\n\t}\n\n\tclose(fd);\n\treturn (1);\n}",
          "includes": [
            "# include <util.h>",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"auth.h\"",
            "#include \"canohost.h\"",
            "#include \"packet.h\"",
            "#include \"atomicio.h\"",
            "#include \"log.h\"",
            "#include \"loginrec.h\"",
            "#include \"ssh.h\"",
            "#include \"hostfile.h\"",
            "#include \"sshkey.h\"",
            "#include \"xmalloc.h\"",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <string.h>",
            "#include <stdarg.h>",
            "#include <pwd.h>",
            "# include <paths.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "int utmp_write_entry(struct logininfo *li);",
            "int utmpx_write_entry(struct logininfo *li);",
            "int wtmp_write_entry(struct logininfo *li);",
            "int wtmpx_write_entry(struct logininfo *li);",
            "int lastlog_write_entry(struct logininfo *li);",
            "int syslogin_write_entry(struct logininfo *li);",
            "int getlast_entry(struct logininfo *li);",
            "int lastlog_get_entry(struct logininfo *li);",
            "int utmpx_get_entry(struct logininfo *li);",
            "int wtmp_get_entry(struct logininfo *li);",
            "int wtmpx_get_entry(struct logininfo *li);"
          ],
          "called_functions": [],
          "contextual_snippet": "# include <util.h>\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"auth.h\"\n#include \"canohost.h\"\n#include \"packet.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"loginrec.h\"\n#include \"ssh.h\"\n#include \"hostfile.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdarg.h>\n#include <pwd.h>\n# include <paths.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint utmp_write_entry(struct logininfo *li);\nint utmpx_write_entry(struct logininfo *li);\nint wtmp_write_entry(struct logininfo *li);\nint wtmpx_write_entry(struct logininfo *li);\nint lastlog_write_entry(struct logininfo *li);\nint syslogin_write_entry(struct logininfo *li);\nint getlast_entry(struct logininfo *li);\nint lastlog_get_entry(struct logininfo *li);\nint utmpx_get_entry(struct logininfo *li);\nint wtmp_get_entry(struct logininfo *li);\nint wtmpx_get_entry(struct logininfo *li);\n\nint\nwtmpx_get_entry(struct logininfo *li)\n{\n\tstruct stat st;\n\tstruct utmpx utx;\n\tint fd, found=0;\n\n\t/* Clear the time entries */\n\tli->tv_sec = li->tv_usec = 0;\n\n\tif ((fd = open(WTMPX_FILE, O_RDONLY)) < 0) {\n\t\tlogit(\"%s: problem opening %s: %s\", __func__,\n\t\t    WTMPX_FILE, strerror(errno));\n\t\treturn (0);\n\t}\n\tif (fstat(fd, &st) != 0) {\n\t\tlogit(\"%s: couldn't stat %s: %s\", __func__,\n\t\t    WTMPX_FILE, strerror(errno));\n\t\tclose(fd);\n\t\treturn (0);\n\t}\n\n\t/* Seek to the start of the last struct utmpx */\n\tif (lseek(fd, -(off_t)sizeof(struct utmpx), SEEK_END) == -1 ) {\n\t\t/* probably a newly rotated wtmpx file */\n\t\tclose(fd);\n\t\treturn (0);\n\t}\n\n\twhile (!found) {\n\t\tif (atomicio(read, fd, &utx, sizeof(utx)) != sizeof(utx)) {\n\t\t\tlogit(\"%s: read of %s failed: %s\", __func__,\n\t\t\t    WTMPX_FILE, strerror(errno));\n\t\t\tclose (fd);\n\t\t\treturn (0);\n\t\t}\n\t\t/*\n\t\t * Logouts are recorded as a blank username on a particular\n\t\t * line. So, we just need to find the username in struct utmpx\n\t\t */\n\t\tif (wtmpx_islogin(li, &utx)) {\n\t\t\tfound = 1;\n# if defined(HAVE_TV_IN_UTMPX)\n\t\t\tli->tv_sec = utx.ut_tv.tv_sec;\n# elif defined(HAVE_TIME_IN_UTMPX)\n\t\t\tli->tv_sec = utx.ut_time;\n# endif\n\t\t\tline_fullname(li->line, utx.ut_line, sizeof(li->line));\n# if defined(HAVE_HOST_IN_UTMPX)\n\t\t\tstrlcpy(li->hostname, utx.ut_host,\n\t\t\t    MIN_SIZEOF(li->hostname, utx.ut_host));\n# endif\n\t\t\tcontinue;\n\t\t}\n\t\tif (lseek(fd, -(off_t)(2 * sizeof(struct utmpx)), SEEK_CUR) == -1) {\n\t\t\tclose(fd);\n\t\t\treturn (0);\n\t\t}\n\t}\n\n\tclose(fd);\n\treturn (1);\n}"
        }
      },
      {
        "call_info": {
          "callee": "wtmp_get_entry",
          "args": [
            "li"
          ],
          "line": 528
        },
        "resolved": true,
        "details": {
          "function_name": "wtmp_get_entry",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
          "lines": "1176-1244",
          "snippet": "int\nwtmp_get_entry(struct logininfo *li)\n{\n\tstruct stat st;\n\tstruct utmp ut;\n\tint fd, found = 0;\n\n\t/* Clear the time entries in our logininfo */\n\tli->tv_sec = li->tv_usec = 0;\n\n\tif ((fd = open(WTMP_FILE, O_RDONLY)) < 0) {\n\t\tlogit(\"%s: problem opening %s: %s\", __func__,\n\t\t    WTMP_FILE, strerror(errno));\n\t\treturn (0);\n\t}\n\tif (fstat(fd, &st) != 0) {\n\t\tlogit(\"%s: couldn't stat %s: %s\", __func__,\n\t\t    WTMP_FILE, strerror(errno));\n\t\tclose(fd);\n\t\treturn (0);\n\t}\n\n\t/* Seek to the start of the last struct utmp */\n\tif (lseek(fd, -(off_t)sizeof(struct utmp), SEEK_END) == -1) {\n\t\t/* Looks like we've got a fresh wtmp file */\n\t\tclose(fd);\n\t\treturn (0);\n\t}\n\n\twhile (!found) {\n\t\tif (atomicio(read, fd, &ut, sizeof(ut)) != sizeof(ut)) {\n\t\t\tlogit(\"%s: read of %s failed: %s\", __func__,\n\t\t\t    WTMP_FILE, strerror(errno));\n\t\t\tclose (fd);\n\t\t\treturn (0);\n\t\t}\n\t\tif (wtmp_islogin(li, &ut) ) {\n\t\t\tfound = 1;\n\t\t\t/*\n\t\t\t * We've already checked for a time in struct\n\t\t\t * utmp, in login_getlast()\n\t\t\t */\n# ifdef HAVE_TIME_IN_UTMP\n\t\t\tli->tv_sec = ut.ut_time;\n# else\n#  if HAVE_TV_IN_UTMP\n\t\t\tli->tv_sec = ut.ut_tv.tv_sec;\n#  endif\n# endif\n\t\t\tline_fullname(li->line, ut.ut_line,\n\t\t\t    MIN_SIZEOF(li->line, ut.ut_line));\n# ifdef HAVE_HOST_IN_UTMP\n\t\t\tstrlcpy(li->hostname, ut.ut_host,\n\t\t\t    MIN_SIZEOF(li->hostname, ut.ut_host));\n# endif\n\t\t\tcontinue;\n\t\t}\n\t\t/* Seek back 2 x struct utmp */\n\t\tif (lseek(fd, -(off_t)(2 * sizeof(struct utmp)), SEEK_CUR) == -1) {\n\t\t\t/* We've found the start of the file, so quit */\n\t\t\tclose(fd);\n\t\t\treturn (0);\n\t\t}\n\t}\n\n\t/* We found an entry. Tidy up and return */\n\tclose(fd);\n\treturn (1);\n}",
          "includes": [
            "# include <util.h>",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"auth.h\"",
            "#include \"canohost.h\"",
            "#include \"packet.h\"",
            "#include \"atomicio.h\"",
            "#include \"log.h\"",
            "#include \"loginrec.h\"",
            "#include \"ssh.h\"",
            "#include \"hostfile.h\"",
            "#include \"sshkey.h\"",
            "#include \"xmalloc.h\"",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <string.h>",
            "#include <stdarg.h>",
            "#include <pwd.h>",
            "# include <paths.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "int utmp_write_entry(struct logininfo *li);",
            "int utmpx_write_entry(struct logininfo *li);",
            "int wtmp_write_entry(struct logininfo *li);",
            "int wtmpx_write_entry(struct logininfo *li);",
            "int lastlog_write_entry(struct logininfo *li);",
            "int syslogin_write_entry(struct logininfo *li);",
            "int getlast_entry(struct logininfo *li);",
            "int lastlog_get_entry(struct logininfo *li);",
            "int utmpx_get_entry(struct logininfo *li);",
            "int wtmp_get_entry(struct logininfo *li);",
            "int wtmpx_get_entry(struct logininfo *li);"
          ],
          "called_functions": [],
          "contextual_snippet": "# include <util.h>\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"auth.h\"\n#include \"canohost.h\"\n#include \"packet.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"loginrec.h\"\n#include \"ssh.h\"\n#include \"hostfile.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdarg.h>\n#include <pwd.h>\n# include <paths.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint utmp_write_entry(struct logininfo *li);\nint utmpx_write_entry(struct logininfo *li);\nint wtmp_write_entry(struct logininfo *li);\nint wtmpx_write_entry(struct logininfo *li);\nint lastlog_write_entry(struct logininfo *li);\nint syslogin_write_entry(struct logininfo *li);\nint getlast_entry(struct logininfo *li);\nint lastlog_get_entry(struct logininfo *li);\nint utmpx_get_entry(struct logininfo *li);\nint wtmp_get_entry(struct logininfo *li);\nint wtmpx_get_entry(struct logininfo *li);\n\nint\nwtmp_get_entry(struct logininfo *li)\n{\n\tstruct stat st;\n\tstruct utmp ut;\n\tint fd, found = 0;\n\n\t/* Clear the time entries in our logininfo */\n\tli->tv_sec = li->tv_usec = 0;\n\n\tif ((fd = open(WTMP_FILE, O_RDONLY)) < 0) {\n\t\tlogit(\"%s: problem opening %s: %s\", __func__,\n\t\t    WTMP_FILE, strerror(errno));\n\t\treturn (0);\n\t}\n\tif (fstat(fd, &st) != 0) {\n\t\tlogit(\"%s: couldn't stat %s: %s\", __func__,\n\t\t    WTMP_FILE, strerror(errno));\n\t\tclose(fd);\n\t\treturn (0);\n\t}\n\n\t/* Seek to the start of the last struct utmp */\n\tif (lseek(fd, -(off_t)sizeof(struct utmp), SEEK_END) == -1) {\n\t\t/* Looks like we've got a fresh wtmp file */\n\t\tclose(fd);\n\t\treturn (0);\n\t}\n\n\twhile (!found) {\n\t\tif (atomicio(read, fd, &ut, sizeof(ut)) != sizeof(ut)) {\n\t\t\tlogit(\"%s: read of %s failed: %s\", __func__,\n\t\t\t    WTMP_FILE, strerror(errno));\n\t\t\tclose (fd);\n\t\t\treturn (0);\n\t\t}\n\t\tif (wtmp_islogin(li, &ut) ) {\n\t\t\tfound = 1;\n\t\t\t/*\n\t\t\t * We've already checked for a time in struct\n\t\t\t * utmp, in login_getlast()\n\t\t\t */\n# ifdef HAVE_TIME_IN_UTMP\n\t\t\tli->tv_sec = ut.ut_time;\n# else\n#  if HAVE_TV_IN_UTMP\n\t\t\tli->tv_sec = ut.ut_tv.tv_sec;\n#  endif\n# endif\n\t\t\tline_fullname(li->line, ut.ut_line,\n\t\t\t    MIN_SIZEOF(li->line, ut.ut_line));\n# ifdef HAVE_HOST_IN_UTMP\n\t\t\tstrlcpy(li->hostname, ut.ut_host,\n\t\t\t    MIN_SIZEOF(li->hostname, ut.ut_host));\n# endif\n\t\t\tcontinue;\n\t\t}\n\t\t/* Seek back 2 x struct utmp */\n\t\tif (lseek(fd, -(off_t)(2 * sizeof(struct utmp)), SEEK_CUR) == -1) {\n\t\t\t/* We've found the start of the file, so quit */\n\t\t\tclose(fd);\n\t\t\treturn (0);\n\t\t}\n\t}\n\n\t/* We found an entry. Tidy up and return */\n\tclose(fd);\n\treturn (1);\n}"
        }
      },
      {
        "call_info": {
          "callee": "utmpx_get_entry",
          "args": [
            "li"
          ],
          "line": 518
        },
        "resolved": true,
        "details": {
          "function_name": "utmpx_get_entry",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
          "lines": "1623-1644",
          "snippet": "int\nutmpx_get_entry(struct logininfo *li)\n{\n\tstruct utmpx *utx;\n\n\tif (setutxdb(UTXDB_LASTLOGIN, NULL) != 0)\n\t\treturn (0);\n\tutx = getutxuser(li->username);\n\tif (utx == NULL) {\n\t\tendutxent();\n\t\treturn (0);\n\t}\n\n\tline_fullname(li->line, utx->ut_line,\n\t    MIN_SIZEOF(li->line, utx->ut_line));\n\tstrlcpy(li->hostname, utx->ut_host,\n\t    MIN_SIZEOF(li->hostname, utx->ut_host));\n\tli->tv_sec = utx->ut_tv.tv_sec;\n\tli->tv_usec = utx->ut_tv.tv_usec;\n\tendutxent();\n\treturn (1);\n}",
          "includes": [
            "# include <util.h>",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"auth.h\"",
            "#include \"canohost.h\"",
            "#include \"packet.h\"",
            "#include \"atomicio.h\"",
            "#include \"log.h\"",
            "#include \"loginrec.h\"",
            "#include \"ssh.h\"",
            "#include \"hostfile.h\"",
            "#include \"sshkey.h\"",
            "#include \"xmalloc.h\"",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <string.h>",
            "#include <stdarg.h>",
            "#include <pwd.h>",
            "# include <paths.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "int utmp_write_entry(struct logininfo *li);",
            "int utmpx_write_entry(struct logininfo *li);",
            "int wtmp_write_entry(struct logininfo *li);",
            "int wtmpx_write_entry(struct logininfo *li);",
            "int lastlog_write_entry(struct logininfo *li);",
            "int syslogin_write_entry(struct logininfo *li);",
            "int getlast_entry(struct logininfo *li);",
            "int lastlog_get_entry(struct logininfo *li);",
            "int utmpx_get_entry(struct logininfo *li);",
            "int wtmp_get_entry(struct logininfo *li);",
            "int wtmpx_get_entry(struct logininfo *li);"
          ],
          "called_functions": [],
          "contextual_snippet": "# include <util.h>\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"auth.h\"\n#include \"canohost.h\"\n#include \"packet.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"loginrec.h\"\n#include \"ssh.h\"\n#include \"hostfile.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdarg.h>\n#include <pwd.h>\n# include <paths.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint utmp_write_entry(struct logininfo *li);\nint utmpx_write_entry(struct logininfo *li);\nint wtmp_write_entry(struct logininfo *li);\nint wtmpx_write_entry(struct logininfo *li);\nint lastlog_write_entry(struct logininfo *li);\nint syslogin_write_entry(struct logininfo *li);\nint getlast_entry(struct logininfo *li);\nint lastlog_get_entry(struct logininfo *li);\nint utmpx_get_entry(struct logininfo *li);\nint wtmp_get_entry(struct logininfo *li);\nint wtmpx_get_entry(struct logininfo *li);\n\nint\nutmpx_get_entry(struct logininfo *li)\n{\n\tstruct utmpx *utx;\n\n\tif (setutxdb(UTXDB_LASTLOGIN, NULL) != 0)\n\t\treturn (0);\n\tutx = getutxuser(li->username);\n\tif (utx == NULL) {\n\t\tendutxent();\n\t\treturn (0);\n\t}\n\n\tline_fullname(li->line, utx->ut_line,\n\t    MIN_SIZEOF(li->line, utx->ut_line));\n\tstrlcpy(li->hostname, utx->ut_host,\n\t    MIN_SIZEOF(li->hostname, utx->ut_host));\n\tli->tv_sec = utx->ut_tv.tv_sec;\n\tli->tv_usec = utx->ut_tv.tv_usec;\n\tendutxent();\n\treturn (1);\n}"
        }
      },
      {
        "call_info": {
          "callee": "lastlog_get_entry",
          "args": [
            "li"
          ],
          "line": 514
        },
        "resolved": true,
        "details": {
          "function_name": "lastlog_get_entry",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
          "lines": "1583-1617",
          "snippet": "int\nlastlog_get_entry(struct logininfo *li)\n{\n\tstruct lastlog last;\n\tint fd, ret;\n\n\tif (!lastlog_openseek(li, &fd, O_RDONLY))\n\t\treturn (0);\n\n\tret = atomicio(read, fd, &last, sizeof(last));\n\tclose(fd);\n\n\tswitch (ret) {\n\tcase 0:\n\t\tmemset(&last, '\\0', sizeof(last));\n\t\t/* FALLTHRU */\n\tcase sizeof(last):\n\t\tline_fullname(li->line, last.ll_line, sizeof(li->line));\n\t\tstrlcpy(li->hostname, last.ll_host,\n\t\t    MIN_SIZEOF(li->hostname, last.ll_host));\n\t\tli->tv_sec = last.ll_time;\n\t\treturn (1);\n\tcase -1:\n\t\terror(\"%s: Error reading from %s: %s\", __func__,\n\t\t    LASTLOG_FILE, strerror(errno));\n\t\treturn (0);\n\tdefault:\n\t\terror(\"%s: Error reading from %s: Expecting %d, got %d\",\n\t\t    __func__, LASTLOG_FILE, (int)sizeof(last), ret);\n\t\treturn (0);\n\t}\n\n\t/* NOTREACHED */\n\treturn (0);\n}",
          "includes": [
            "# include <util.h>",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"auth.h\"",
            "#include \"canohost.h\"",
            "#include \"packet.h\"",
            "#include \"atomicio.h\"",
            "#include \"log.h\"",
            "#include \"loginrec.h\"",
            "#include \"ssh.h\"",
            "#include \"hostfile.h\"",
            "#include \"sshkey.h\"",
            "#include \"xmalloc.h\"",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <string.h>",
            "#include <stdarg.h>",
            "#include <pwd.h>",
            "# include <paths.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "int utmp_write_entry(struct logininfo *li);",
            "int utmpx_write_entry(struct logininfo *li);",
            "int wtmp_write_entry(struct logininfo *li);",
            "int wtmpx_write_entry(struct logininfo *li);",
            "int lastlog_write_entry(struct logininfo *li);",
            "int syslogin_write_entry(struct logininfo *li);",
            "int getlast_entry(struct logininfo *li);",
            "int lastlog_get_entry(struct logininfo *li);",
            "int utmpx_get_entry(struct logininfo *li);",
            "int wtmp_get_entry(struct logininfo *li);",
            "int wtmpx_get_entry(struct logininfo *li);"
          ],
          "called_functions": [],
          "contextual_snippet": "# include <util.h>\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"auth.h\"\n#include \"canohost.h\"\n#include \"packet.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"loginrec.h\"\n#include \"ssh.h\"\n#include \"hostfile.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdarg.h>\n#include <pwd.h>\n# include <paths.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint utmp_write_entry(struct logininfo *li);\nint utmpx_write_entry(struct logininfo *li);\nint wtmp_write_entry(struct logininfo *li);\nint wtmpx_write_entry(struct logininfo *li);\nint lastlog_write_entry(struct logininfo *li);\nint syslogin_write_entry(struct logininfo *li);\nint getlast_entry(struct logininfo *li);\nint lastlog_get_entry(struct logininfo *li);\nint utmpx_get_entry(struct logininfo *li);\nint wtmp_get_entry(struct logininfo *li);\nint wtmpx_get_entry(struct logininfo *li);\n\nint\nlastlog_get_entry(struct logininfo *li)\n{\n\tstruct lastlog last;\n\tint fd, ret;\n\n\tif (!lastlog_openseek(li, &fd, O_RDONLY))\n\t\treturn (0);\n\n\tret = atomicio(read, fd, &last, sizeof(last));\n\tclose(fd);\n\n\tswitch (ret) {\n\tcase 0:\n\t\tmemset(&last, '\\0', sizeof(last));\n\t\t/* FALLTHRU */\n\tcase sizeof(last):\n\t\tline_fullname(li->line, last.ll_line, sizeof(li->line));\n\t\tstrlcpy(li->hostname, last.ll_host,\n\t\t    MIN_SIZEOF(li->hostname, last.ll_host));\n\t\tli->tv_sec = last.ll_time;\n\t\treturn (1);\n\tcase -1:\n\t\terror(\"%s: Error reading from %s: %s\", __func__,\n\t\t    LASTLOG_FILE, strerror(errno));\n\t\treturn (0);\n\tdefault:\n\t\terror(\"%s: Error reading from %s: Expecting %d, got %d\",\n\t\t    __func__, LASTLOG_FILE, (int)sizeof(last), ret);\n\t\treturn (0);\n\t}\n\n\t/* NOTREACHED */\n\treturn (0);\n}"
        }
      }
    ],
    "contextual_snippet": "# include <util.h>\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"auth.h\"\n#include \"canohost.h\"\n#include \"packet.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"loginrec.h\"\n#include \"ssh.h\"\n#include \"hostfile.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdarg.h>\n#include <pwd.h>\n# include <paths.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint utmp_write_entry(struct logininfo *li);\nint utmpx_write_entry(struct logininfo *li);\nint wtmp_write_entry(struct logininfo *li);\nint wtmpx_write_entry(struct logininfo *li);\nint lastlog_write_entry(struct logininfo *li);\nint syslogin_write_entry(struct logininfo *li);\nint getlast_entry(struct logininfo *li);\nint lastlog_get_entry(struct logininfo *li);\nint utmpx_get_entry(struct logininfo *li);\nint wtmp_get_entry(struct logininfo *li);\nint wtmpx_get_entry(struct logininfo *li);\n\nint\ngetlast_entry(struct logininfo *li)\n{\n#ifdef USE_LASTLOG\n\treturn(lastlog_get_entry(li));\n#else /* !USE_LASTLOG */\n#if defined(USE_UTMPX) && defined(HAVE_SETUTXDB) && \\\n    defined(UTXDB_LASTLOGIN) && defined(HAVE_GETUTXUSER)\n\treturn (utmpx_get_entry(li));\n#endif\n\n#if defined(DISABLE_LASTLOG)\n\t/* On some systems we shouldn't even try to obtain last login\n\t * time, e.g. AIX */\n\treturn (0);\n# elif defined(USE_WTMP) && \\\n    (defined(HAVE_TIME_IN_UTMP) || defined(HAVE_TV_IN_UTMP))\n\t/* retrieve last login time from utmp */\n\treturn (wtmp_get_entry(li));\n# elif defined(USE_WTMPX) && \\\n    (defined(HAVE_TIME_IN_UTMPX) || defined(HAVE_TV_IN_UTMPX))\n\t/* If wtmp isn't available, try wtmpx */\n\treturn (wtmpx_get_entry(li));\n# else\n\t/* Give up: No means of retrieving last login time */\n\treturn (0);\n# endif /* DISABLE_LASTLOG */\n#endif /* USE_LASTLOG */\n}"
  },
  {
    "function_name": "login_utmp_only",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
    "lines": "483-501",
    "snippet": "int\nlogin_utmp_only(struct logininfo *li)\n{\n\tli->type = LTYPE_LOGIN;\n\tlogin_set_current_time(li);\n# ifdef USE_UTMP\n\tutmp_write_entry(li);\n# endif\n# ifdef USE_WTMP\n\twtmp_write_entry(li);\n# endif\n# ifdef USE_UTMPX\n\tutmpx_write_entry(li);\n# endif\n# ifdef USE_WTMPX\n\twtmpx_write_entry(li);\n# endif\n\treturn (0);\n}",
    "includes": [
      "# include <util.h>",
      "#include \"ssherr.h\"",
      "#include \"sshbuf.h\"",
      "#include \"auth.h\"",
      "#include \"canohost.h\"",
      "#include \"packet.h\"",
      "#include \"atomicio.h\"",
      "#include \"log.h\"",
      "#include \"loginrec.h\"",
      "#include \"ssh.h\"",
      "#include \"hostfile.h\"",
      "#include \"sshkey.h\"",
      "#include \"xmalloc.h\"",
      "#include <unistd.h>",
      "#include <time.h>",
      "#include <string.h>",
      "#include <stdarg.h>",
      "#include <pwd.h>",
      "# include <paths.h>",
      "#include <fcntl.h>",
      "#include <errno.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "int utmp_write_entry(struct logininfo *li);",
      "int utmpx_write_entry(struct logininfo *li);",
      "int wtmp_write_entry(struct logininfo *li);",
      "int wtmpx_write_entry(struct logininfo *li);",
      "int lastlog_write_entry(struct logininfo *li);",
      "int syslogin_write_entry(struct logininfo *li);",
      "int getlast_entry(struct logininfo *li);",
      "int lastlog_get_entry(struct logininfo *li);",
      "int utmpx_get_entry(struct logininfo *li);",
      "int wtmp_get_entry(struct logininfo *li);",
      "int wtmpx_get_entry(struct logininfo *li);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "wtmpx_write_entry",
          "args": [
            "li"
          ],
          "line": 498
        },
        "resolved": true,
        "details": {
          "function_name": "wtmpx_write_entry",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
          "lines": "1307-1319",
          "snippet": "int\nwtmpx_write_entry(struct logininfo *li)\n{\n\tswitch(li->type) {\n\tcase LTYPE_LOGIN:\n\t\treturn (wtmpx_perform_login(li));\n\tcase LTYPE_LOGOUT:\n\t\treturn (wtmpx_perform_logout(li));\n\tdefault:\n\t\tlogit(\"%s: invalid type field\", __func__);\n\t\treturn (0);\n\t}\n}",
          "includes": [
            "# include <util.h>",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"auth.h\"",
            "#include \"canohost.h\"",
            "#include \"packet.h\"",
            "#include \"atomicio.h\"",
            "#include \"log.h\"",
            "#include \"loginrec.h\"",
            "#include \"ssh.h\"",
            "#include \"hostfile.h\"",
            "#include \"sshkey.h\"",
            "#include \"xmalloc.h\"",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <string.h>",
            "#include <stdarg.h>",
            "#include <pwd.h>",
            "# include <paths.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "int utmp_write_entry(struct logininfo *li);",
            "int utmpx_write_entry(struct logininfo *li);",
            "int wtmp_write_entry(struct logininfo *li);",
            "int wtmpx_write_entry(struct logininfo *li);",
            "int lastlog_write_entry(struct logininfo *li);",
            "int syslogin_write_entry(struct logininfo *li);",
            "int getlast_entry(struct logininfo *li);",
            "int lastlog_get_entry(struct logininfo *li);",
            "int utmpx_get_entry(struct logininfo *li);",
            "int wtmp_get_entry(struct logininfo *li);",
            "int wtmpx_get_entry(struct logininfo *li);"
          ],
          "called_functions": [],
          "contextual_snippet": "# include <util.h>\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"auth.h\"\n#include \"canohost.h\"\n#include \"packet.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"loginrec.h\"\n#include \"ssh.h\"\n#include \"hostfile.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdarg.h>\n#include <pwd.h>\n# include <paths.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint utmp_write_entry(struct logininfo *li);\nint utmpx_write_entry(struct logininfo *li);\nint wtmp_write_entry(struct logininfo *li);\nint wtmpx_write_entry(struct logininfo *li);\nint lastlog_write_entry(struct logininfo *li);\nint syslogin_write_entry(struct logininfo *li);\nint getlast_entry(struct logininfo *li);\nint lastlog_get_entry(struct logininfo *li);\nint utmpx_get_entry(struct logininfo *li);\nint wtmp_get_entry(struct logininfo *li);\nint wtmpx_get_entry(struct logininfo *li);\n\nint\nwtmpx_write_entry(struct logininfo *li)\n{\n\tswitch(li->type) {\n\tcase LTYPE_LOGIN:\n\t\treturn (wtmpx_perform_login(li));\n\tcase LTYPE_LOGOUT:\n\t\treturn (wtmpx_perform_logout(li));\n\tdefault:\n\t\tlogit(\"%s: invalid type field\", __func__);\n\t\treturn (0);\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "utmpx_write_entry",
          "args": [
            "li"
          ],
          "line": 495
        },
        "resolved": true,
        "details": {
          "function_name": "utmpx_write_entry",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
          "lines": "1060-1072",
          "snippet": "int\nutmpx_write_entry(struct logininfo *li)\n{\n\tswitch(li->type) {\n\tcase LTYPE_LOGIN:\n\t\treturn (utmpx_perform_login(li));\n\tcase LTYPE_LOGOUT:\n\t\treturn (utmpx_perform_logout(li));\n\tdefault:\n\t\tlogit(\"%s: invalid type field\", __func__);\n\t\treturn (0);\n\t}\n}",
          "includes": [
            "# include <util.h>",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"auth.h\"",
            "#include \"canohost.h\"",
            "#include \"packet.h\"",
            "#include \"atomicio.h\"",
            "#include \"log.h\"",
            "#include \"loginrec.h\"",
            "#include \"ssh.h\"",
            "#include \"hostfile.h\"",
            "#include \"sshkey.h\"",
            "#include \"xmalloc.h\"",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <string.h>",
            "#include <stdarg.h>",
            "#include <pwd.h>",
            "# include <paths.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "int utmp_write_entry(struct logininfo *li);",
            "int utmpx_write_entry(struct logininfo *li);",
            "int wtmp_write_entry(struct logininfo *li);",
            "int wtmpx_write_entry(struct logininfo *li);",
            "int lastlog_write_entry(struct logininfo *li);",
            "int syslogin_write_entry(struct logininfo *li);",
            "int getlast_entry(struct logininfo *li);",
            "int lastlog_get_entry(struct logininfo *li);",
            "int utmpx_get_entry(struct logininfo *li);",
            "int wtmp_get_entry(struct logininfo *li);",
            "int wtmpx_get_entry(struct logininfo *li);"
          ],
          "called_functions": [],
          "contextual_snippet": "# include <util.h>\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"auth.h\"\n#include \"canohost.h\"\n#include \"packet.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"loginrec.h\"\n#include \"ssh.h\"\n#include \"hostfile.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdarg.h>\n#include <pwd.h>\n# include <paths.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint utmp_write_entry(struct logininfo *li);\nint utmpx_write_entry(struct logininfo *li);\nint wtmp_write_entry(struct logininfo *li);\nint wtmpx_write_entry(struct logininfo *li);\nint lastlog_write_entry(struct logininfo *li);\nint syslogin_write_entry(struct logininfo *li);\nint getlast_entry(struct logininfo *li);\nint lastlog_get_entry(struct logininfo *li);\nint utmpx_get_entry(struct logininfo *li);\nint wtmp_get_entry(struct logininfo *li);\nint wtmpx_get_entry(struct logininfo *li);\n\nint\nutmpx_write_entry(struct logininfo *li)\n{\n\tswitch(li->type) {\n\tcase LTYPE_LOGIN:\n\t\treturn (utmpx_perform_login(li));\n\tcase LTYPE_LOGOUT:\n\t\treturn (utmpx_perform_logout(li));\n\tdefault:\n\t\tlogit(\"%s: invalid type field\", __func__);\n\t\treturn (0);\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "wtmp_write_entry",
          "args": [
            "li"
          ],
          "line": 492
        },
        "resolved": true,
        "details": {
          "function_name": "wtmp_write_entry",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
          "lines": "1128-1140",
          "snippet": "int\nwtmp_write_entry(struct logininfo *li)\n{\n\tswitch(li->type) {\n\tcase LTYPE_LOGIN:\n\t\treturn (wtmp_perform_login(li));\n\tcase LTYPE_LOGOUT:\n\t\treturn (wtmp_perform_logout(li));\n\tdefault:\n\t\tlogit(\"%s: invalid type field\", __func__);\n\t\treturn (0);\n\t}\n}",
          "includes": [
            "# include <util.h>",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"auth.h\"",
            "#include \"canohost.h\"",
            "#include \"packet.h\"",
            "#include \"atomicio.h\"",
            "#include \"log.h\"",
            "#include \"loginrec.h\"",
            "#include \"ssh.h\"",
            "#include \"hostfile.h\"",
            "#include \"sshkey.h\"",
            "#include \"xmalloc.h\"",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <string.h>",
            "#include <stdarg.h>",
            "#include <pwd.h>",
            "# include <paths.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "int utmp_write_entry(struct logininfo *li);",
            "int utmpx_write_entry(struct logininfo *li);",
            "int wtmp_write_entry(struct logininfo *li);",
            "int wtmpx_write_entry(struct logininfo *li);",
            "int lastlog_write_entry(struct logininfo *li);",
            "int syslogin_write_entry(struct logininfo *li);",
            "int getlast_entry(struct logininfo *li);",
            "int lastlog_get_entry(struct logininfo *li);",
            "int utmpx_get_entry(struct logininfo *li);",
            "int wtmp_get_entry(struct logininfo *li);",
            "int wtmpx_get_entry(struct logininfo *li);"
          ],
          "called_functions": [],
          "contextual_snippet": "# include <util.h>\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"auth.h\"\n#include \"canohost.h\"\n#include \"packet.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"loginrec.h\"\n#include \"ssh.h\"\n#include \"hostfile.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdarg.h>\n#include <pwd.h>\n# include <paths.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint utmp_write_entry(struct logininfo *li);\nint utmpx_write_entry(struct logininfo *li);\nint wtmp_write_entry(struct logininfo *li);\nint wtmpx_write_entry(struct logininfo *li);\nint lastlog_write_entry(struct logininfo *li);\nint syslogin_write_entry(struct logininfo *li);\nint getlast_entry(struct logininfo *li);\nint lastlog_get_entry(struct logininfo *li);\nint utmpx_get_entry(struct logininfo *li);\nint wtmp_get_entry(struct logininfo *li);\nint wtmpx_get_entry(struct logininfo *li);\n\nint\nwtmp_write_entry(struct logininfo *li)\n{\n\tswitch(li->type) {\n\tcase LTYPE_LOGIN:\n\t\treturn (wtmp_perform_login(li));\n\tcase LTYPE_LOGOUT:\n\t\treturn (wtmp_perform_logout(li));\n\tdefault:\n\t\tlogit(\"%s: invalid type field\", __func__);\n\t\treturn (0);\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "utmp_write_entry",
          "args": [
            "li"
          ],
          "line": 489
        },
        "resolved": true,
        "details": {
          "function_name": "utmp_write_entry",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
          "lines": "961-975",
          "snippet": "int\nutmp_write_entry(struct logininfo *li)\n{\n\tswitch(li->type) {\n\tcase LTYPE_LOGIN:\n\t\treturn (utmp_perform_login(li));\n\n\tcase LTYPE_LOGOUT:\n\t\treturn (utmp_perform_logout(li));\n\n\tdefault:\n\t\tlogit(\"%s: invalid type field\", __func__);\n\t\treturn (0);\n\t}\n}",
          "includes": [
            "# include <util.h>",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"auth.h\"",
            "#include \"canohost.h\"",
            "#include \"packet.h\"",
            "#include \"atomicio.h\"",
            "#include \"log.h\"",
            "#include \"loginrec.h\"",
            "#include \"ssh.h\"",
            "#include \"hostfile.h\"",
            "#include \"sshkey.h\"",
            "#include \"xmalloc.h\"",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <string.h>",
            "#include <stdarg.h>",
            "#include <pwd.h>",
            "# include <paths.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "int utmp_write_entry(struct logininfo *li);",
            "int utmpx_write_entry(struct logininfo *li);",
            "int wtmp_write_entry(struct logininfo *li);",
            "int wtmpx_write_entry(struct logininfo *li);",
            "int lastlog_write_entry(struct logininfo *li);",
            "int syslogin_write_entry(struct logininfo *li);",
            "int getlast_entry(struct logininfo *li);",
            "int lastlog_get_entry(struct logininfo *li);",
            "int utmpx_get_entry(struct logininfo *li);",
            "int wtmp_get_entry(struct logininfo *li);",
            "int wtmpx_get_entry(struct logininfo *li);"
          ],
          "called_functions": [],
          "contextual_snippet": "# include <util.h>\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"auth.h\"\n#include \"canohost.h\"\n#include \"packet.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"loginrec.h\"\n#include \"ssh.h\"\n#include \"hostfile.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdarg.h>\n#include <pwd.h>\n# include <paths.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint utmp_write_entry(struct logininfo *li);\nint utmpx_write_entry(struct logininfo *li);\nint wtmp_write_entry(struct logininfo *li);\nint wtmpx_write_entry(struct logininfo *li);\nint lastlog_write_entry(struct logininfo *li);\nint syslogin_write_entry(struct logininfo *li);\nint getlast_entry(struct logininfo *li);\nint lastlog_get_entry(struct logininfo *li);\nint utmpx_get_entry(struct logininfo *li);\nint wtmp_get_entry(struct logininfo *li);\nint wtmpx_get_entry(struct logininfo *li);\n\nint\nutmp_write_entry(struct logininfo *li)\n{\n\tswitch(li->type) {\n\tcase LTYPE_LOGIN:\n\t\treturn (utmp_perform_login(li));\n\n\tcase LTYPE_LOGOUT:\n\t\treturn (utmp_perform_logout(li));\n\n\tdefault:\n\t\tlogit(\"%s: invalid type field\", __func__);\n\t\treturn (0);\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "login_set_current_time",
          "args": [
            "li"
          ],
          "line": 487
        },
        "resolved": true,
        "details": {
          "function_name": "login_set_current_time",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
          "lines": "406-415",
          "snippet": "void\nlogin_set_current_time(struct logininfo *li)\n{\n\tstruct timeval tv;\n\n\tgettimeofday(&tv, NULL);\n\n\tli->tv_sec = tv.tv_sec;\n\tli->tv_usec = tv.tv_usec;\n}",
          "includes": [
            "# include <util.h>",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"auth.h\"",
            "#include \"canohost.h\"",
            "#include \"packet.h\"",
            "#include \"atomicio.h\"",
            "#include \"log.h\"",
            "#include \"loginrec.h\"",
            "#include \"ssh.h\"",
            "#include \"hostfile.h\"",
            "#include \"sshkey.h\"",
            "#include \"xmalloc.h\"",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <string.h>",
            "#include <stdarg.h>",
            "#include <pwd.h>",
            "# include <paths.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "int utmp_write_entry(struct logininfo *li);",
            "int utmpx_write_entry(struct logininfo *li);",
            "int wtmp_write_entry(struct logininfo *li);",
            "int wtmpx_write_entry(struct logininfo *li);",
            "int lastlog_write_entry(struct logininfo *li);",
            "int syslogin_write_entry(struct logininfo *li);",
            "int getlast_entry(struct logininfo *li);",
            "int lastlog_get_entry(struct logininfo *li);",
            "int utmpx_get_entry(struct logininfo *li);",
            "int wtmp_get_entry(struct logininfo *li);",
            "int wtmpx_get_entry(struct logininfo *li);"
          ],
          "called_functions": [],
          "contextual_snippet": "# include <util.h>\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"auth.h\"\n#include \"canohost.h\"\n#include \"packet.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"loginrec.h\"\n#include \"ssh.h\"\n#include \"hostfile.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdarg.h>\n#include <pwd.h>\n# include <paths.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint utmp_write_entry(struct logininfo *li);\nint utmpx_write_entry(struct logininfo *li);\nint wtmp_write_entry(struct logininfo *li);\nint wtmpx_write_entry(struct logininfo *li);\nint lastlog_write_entry(struct logininfo *li);\nint syslogin_write_entry(struct logininfo *li);\nint getlast_entry(struct logininfo *li);\nint lastlog_get_entry(struct logininfo *li);\nint utmpx_get_entry(struct logininfo *li);\nint wtmp_get_entry(struct logininfo *li);\nint wtmpx_get_entry(struct logininfo *li);\n\nvoid\nlogin_set_current_time(struct logininfo *li)\n{\n\tstruct timeval tv;\n\n\tgettimeofday(&tv, NULL);\n\n\tli->tv_sec = tv.tv_sec;\n\tli->tv_usec = tv.tv_usec;\n}"
        }
      }
    ],
    "contextual_snippet": "# include <util.h>\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"auth.h\"\n#include \"canohost.h\"\n#include \"packet.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"loginrec.h\"\n#include \"ssh.h\"\n#include \"hostfile.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdarg.h>\n#include <pwd.h>\n# include <paths.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint utmp_write_entry(struct logininfo *li);\nint utmpx_write_entry(struct logininfo *li);\nint wtmp_write_entry(struct logininfo *li);\nint wtmpx_write_entry(struct logininfo *li);\nint lastlog_write_entry(struct logininfo *li);\nint syslogin_write_entry(struct logininfo *li);\nint getlast_entry(struct logininfo *li);\nint lastlog_get_entry(struct logininfo *li);\nint utmpx_get_entry(struct logininfo *li);\nint wtmp_get_entry(struct logininfo *li);\nint wtmpx_get_entry(struct logininfo *li);\n\nint\nlogin_utmp_only(struct logininfo *li)\n{\n\tli->type = LTYPE_LOGIN;\n\tlogin_set_current_time(li);\n# ifdef USE_UTMP\n\tutmp_write_entry(li);\n# endif\n# ifdef USE_WTMP\n\twtmp_write_entry(li);\n# endif\n# ifdef USE_UTMPX\n\tutmpx_write_entry(li);\n# endif\n# ifdef USE_WTMPX\n\twtmpx_write_entry(li);\n# endif\n\treturn (0);\n}"
  },
  {
    "function_name": "login_write",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
    "lines": "436-480",
    "snippet": "int\nlogin_write(struct logininfo *li)\n{\n#ifndef HAVE_CYGWIN\n\tif (geteuid() != 0) {\n\t\tlogit(\"Attempt to write login records by non-root user (aborting)\");\n\t\treturn (1);\n\t}\n#endif\n\n\t/* set the timestamp */\n\tlogin_set_current_time(li);\n#ifdef USE_LOGIN\n\tsyslogin_write_entry(li);\n#endif\n#ifdef USE_LASTLOG\n\tif (li->type == LTYPE_LOGIN)\n\t\tlastlog_write_entry(li);\n#endif\n#ifdef USE_UTMP\n\tutmp_write_entry(li);\n#endif\n#ifdef USE_WTMP\n\twtmp_write_entry(li);\n#endif\n#ifdef USE_UTMPX\n\tutmpx_write_entry(li);\n#endif\n#ifdef USE_WTMPX\n\twtmpx_write_entry(li);\n#endif\n#ifdef CUSTOM_SYS_AUTH_RECORD_LOGIN\n\tif (li->type == LTYPE_LOGIN &&\n\t    !sys_auth_record_login(li->username,li->hostname,li->line,\n\t    &loginmsg))\n\t\tlogit(\"Writing login record failed for %s\", li->username);\n#endif\n#ifdef SSH_AUDIT_EVENTS\n\tif (li->type == LTYPE_LOGIN)\n\t\taudit_session_open(li);\n\telse if (li->type == LTYPE_LOGOUT)\n\t\taudit_session_close(li);\n#endif\n\treturn (0);\n}",
    "includes": [
      "# include <util.h>",
      "#include \"ssherr.h\"",
      "#include \"sshbuf.h\"",
      "#include \"auth.h\"",
      "#include \"canohost.h\"",
      "#include \"packet.h\"",
      "#include \"atomicio.h\"",
      "#include \"log.h\"",
      "#include \"loginrec.h\"",
      "#include \"ssh.h\"",
      "#include \"hostfile.h\"",
      "#include \"sshkey.h\"",
      "#include \"xmalloc.h\"",
      "#include <unistd.h>",
      "#include <time.h>",
      "#include <string.h>",
      "#include <stdarg.h>",
      "#include <pwd.h>",
      "# include <paths.h>",
      "#include <fcntl.h>",
      "#include <errno.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "int utmp_write_entry(struct logininfo *li);",
      "int utmpx_write_entry(struct logininfo *li);",
      "int wtmp_write_entry(struct logininfo *li);",
      "int wtmpx_write_entry(struct logininfo *li);",
      "int lastlog_write_entry(struct logininfo *li);",
      "int syslogin_write_entry(struct logininfo *li);",
      "int getlast_entry(struct logininfo *li);",
      "int lastlog_get_entry(struct logininfo *li);",
      "int utmpx_get_entry(struct logininfo *li);",
      "int wtmp_get_entry(struct logininfo *li);",
      "int wtmpx_get_entry(struct logininfo *li);",
      "extern struct sshbuf *loginmsg;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "audit_session_close",
          "args": [
            "li"
          ],
          "line": 477
        },
        "resolved": true,
        "details": {
          "function_name": "audit_session_close",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/audit.c",
          "lines": "163-170",
          "snippet": "void\naudit_session_close(struct logininfo *li)\n{\n\tconst char *t = li->line ? li->line : \"(no tty)\";\n\n\tdebug(\"audit session close euid %d user %s tty name %s\", geteuid(),\n\t    audit_username(), t);\n}",
          "includes": [
            "#include \"auth.h\"",
            "#include \"hostfile.h\"",
            "#include \"log.h\"",
            "#include \"audit.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdarg.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"auth.h\"\n#include \"hostfile.h\"\n#include \"log.h\"\n#include \"audit.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdarg.h>\n#include \"includes.h\"\n\nvoid\naudit_session_close(struct logininfo *li)\n{\n\tconst char *t = li->line ? li->line : \"(no tty)\";\n\n\tdebug(\"audit session close euid %d user %s tty name %s\", geteuid(),\n\t    audit_username(), t);\n}"
        }
      },
      {
        "call_info": {
          "callee": "audit_session_open",
          "args": [
            "li"
          ],
          "line": 475
        },
        "resolved": true,
        "details": {
          "function_name": "audit_session_open",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/audit.c",
          "lines": "147-154",
          "snippet": "void\naudit_session_open(struct logininfo *li)\n{\n\tconst char *t = li->line ? li->line : \"(no tty)\";\n\n\tdebug(\"audit session open euid %d user %s tty name %s\", geteuid(),\n\t    audit_username(), t);\n}",
          "includes": [
            "#include \"auth.h\"",
            "#include \"hostfile.h\"",
            "#include \"log.h\"",
            "#include \"audit.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdarg.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"auth.h\"\n#include \"hostfile.h\"\n#include \"log.h\"\n#include \"audit.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdarg.h>\n#include \"includes.h\"\n\nvoid\naudit_session_open(struct logininfo *li)\n{\n\tconst char *t = li->line ? li->line : \"(no tty)\";\n\n\tdebug(\"audit session open euid %d user %s tty name %s\", geteuid(),\n\t    audit_username(), t);\n}"
        }
      },
      {
        "call_info": {
          "callee": "logit",
          "args": [
            "\"Writing login record failed for %s\"",
            "li->username"
          ],
          "line": 471
        },
        "resolved": true,
        "details": {
          "function_name": "logit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/log.c",
          "lines": "198-206",
          "snippet": "void\nlogit(const char *fmt,...)\n{\n\tva_list args;\n\n\tva_start(args, fmt);\n\tdo_log(SYSLOG_LEVEL_INFO, fmt, args);\n\tva_end(args);\n}",
          "includes": [
            "#include \"log.h\"",
            "# include <vis.h>",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <syslog.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <fcntl.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n# include <vis.h>\n#include <errno.h>\n#include <unistd.h>\n#include <syslog.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <fcntl.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\nlogit(const char *fmt,...)\n{\n\tva_list args;\n\n\tva_start(args, fmt);\n\tdo_log(SYSLOG_LEVEL_INFO, fmt, args);\n\tva_end(args);\n}"
        }
      },
      {
        "call_info": {
          "callee": "sys_auth_record_login",
          "args": [
            "li->username",
            "li->hostname",
            "li->line",
            "&loginmsg"
          ],
          "line": 469
        },
        "resolved": true,
        "details": {
          "function_name": "sys_auth_record_login",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/openbsd-compat/port-aix.c",
          "lines": "282-300",
          "snippet": "int\nsys_auth_record_login(const char *user, const char *host, const char *ttynm,\n    struct sshbuf *loginmsg)\n{\n\tchar *msg = NULL;\n\tint success = 0;\n\n\taix_setauthdb(user);\n\tif (loginsuccess((char *)user, (char *)host, (char *)ttynm, &msg) == 0) {\n\t\tsuccess = 1;\n\t\tif (msg != NULL) {\n\t\t\tdebug(\"AIX/loginsuccess: msg %s\", msg);\n\t\t\tif (lastlogin_msg == NULL)\n\t\t\t\tlastlogin_msg = msg;\n\t\t}\n\t}\n\taix_restoreauthdb();\n\treturn (success);\n}",
          "includes": [
            "#  include <stdlib.h>",
            "#include \"port-aix.h\"",
            "# include <usersec.h>",
            "#  include <sys/audit.h>",
            "# include <userpw.h>",
            "# include <login.h>",
            "#include <sys/socket.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdarg.h>",
            "#include <uinfo.h>",
            "# include <netdb.h>",
            "#include <errno.h>",
            "#include \"log.h\"",
            "#include \"ssh_api.h\"",
            "#include \"ssh.h\"",
            "#include \"auth.h\"",
            "#include \"hostfile.h\"",
            "#include \"sshkey.h\"",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"xmalloc.h\"",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#  include <stdlib.h>\n#include \"port-aix.h\"\n# include <usersec.h>\n#  include <sys/audit.h>\n# include <userpw.h>\n# include <login.h>\n#include <sys/socket.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdarg.h>\n#include <uinfo.h>\n# include <netdb.h>\n#include <errno.h>\n#include \"log.h\"\n#include \"ssh_api.h\"\n#include \"ssh.h\"\n#include \"auth.h\"\n#include \"hostfile.h\"\n#include \"sshkey.h\"\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"xmalloc.h\"\n#include \"includes.h\"\n\nint\nsys_auth_record_login(const char *user, const char *host, const char *ttynm,\n    struct sshbuf *loginmsg)\n{\n\tchar *msg = NULL;\n\tint success = 0;\n\n\taix_setauthdb(user);\n\tif (loginsuccess((char *)user, (char *)host, (char *)ttynm, &msg) == 0) {\n\t\tsuccess = 1;\n\t\tif (msg != NULL) {\n\t\t\tdebug(\"AIX/loginsuccess: msg %s\", msg);\n\t\t\tif (lastlogin_msg == NULL)\n\t\t\t\tlastlogin_msg = msg;\n\t\t}\n\t}\n\taix_restoreauthdb();\n\treturn (success);\n}"
        }
      },
      {
        "call_info": {
          "callee": "wtmpx_write_entry",
          "args": [
            "li"
          ],
          "line": 465
        },
        "resolved": true,
        "details": {
          "function_name": "wtmpx_write_entry",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
          "lines": "1307-1319",
          "snippet": "int\nwtmpx_write_entry(struct logininfo *li)\n{\n\tswitch(li->type) {\n\tcase LTYPE_LOGIN:\n\t\treturn (wtmpx_perform_login(li));\n\tcase LTYPE_LOGOUT:\n\t\treturn (wtmpx_perform_logout(li));\n\tdefault:\n\t\tlogit(\"%s: invalid type field\", __func__);\n\t\treturn (0);\n\t}\n}",
          "includes": [
            "# include <util.h>",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"auth.h\"",
            "#include \"canohost.h\"",
            "#include \"packet.h\"",
            "#include \"atomicio.h\"",
            "#include \"log.h\"",
            "#include \"loginrec.h\"",
            "#include \"ssh.h\"",
            "#include \"hostfile.h\"",
            "#include \"sshkey.h\"",
            "#include \"xmalloc.h\"",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <string.h>",
            "#include <stdarg.h>",
            "#include <pwd.h>",
            "# include <paths.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "int utmp_write_entry(struct logininfo *li);",
            "int utmpx_write_entry(struct logininfo *li);",
            "int wtmp_write_entry(struct logininfo *li);",
            "int wtmpx_write_entry(struct logininfo *li);",
            "int lastlog_write_entry(struct logininfo *li);",
            "int syslogin_write_entry(struct logininfo *li);",
            "int getlast_entry(struct logininfo *li);",
            "int lastlog_get_entry(struct logininfo *li);",
            "int utmpx_get_entry(struct logininfo *li);",
            "int wtmp_get_entry(struct logininfo *li);",
            "int wtmpx_get_entry(struct logininfo *li);"
          ],
          "called_functions": [],
          "contextual_snippet": "# include <util.h>\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"auth.h\"\n#include \"canohost.h\"\n#include \"packet.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"loginrec.h\"\n#include \"ssh.h\"\n#include \"hostfile.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdarg.h>\n#include <pwd.h>\n# include <paths.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint utmp_write_entry(struct logininfo *li);\nint utmpx_write_entry(struct logininfo *li);\nint wtmp_write_entry(struct logininfo *li);\nint wtmpx_write_entry(struct logininfo *li);\nint lastlog_write_entry(struct logininfo *li);\nint syslogin_write_entry(struct logininfo *li);\nint getlast_entry(struct logininfo *li);\nint lastlog_get_entry(struct logininfo *li);\nint utmpx_get_entry(struct logininfo *li);\nint wtmp_get_entry(struct logininfo *li);\nint wtmpx_get_entry(struct logininfo *li);\n\nint\nwtmpx_write_entry(struct logininfo *li)\n{\n\tswitch(li->type) {\n\tcase LTYPE_LOGIN:\n\t\treturn (wtmpx_perform_login(li));\n\tcase LTYPE_LOGOUT:\n\t\treturn (wtmpx_perform_logout(li));\n\tdefault:\n\t\tlogit(\"%s: invalid type field\", __func__);\n\t\treturn (0);\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "utmpx_write_entry",
          "args": [
            "li"
          ],
          "line": 462
        },
        "resolved": true,
        "details": {
          "function_name": "utmpx_write_entry",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
          "lines": "1060-1072",
          "snippet": "int\nutmpx_write_entry(struct logininfo *li)\n{\n\tswitch(li->type) {\n\tcase LTYPE_LOGIN:\n\t\treturn (utmpx_perform_login(li));\n\tcase LTYPE_LOGOUT:\n\t\treturn (utmpx_perform_logout(li));\n\tdefault:\n\t\tlogit(\"%s: invalid type field\", __func__);\n\t\treturn (0);\n\t}\n}",
          "includes": [
            "# include <util.h>",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"auth.h\"",
            "#include \"canohost.h\"",
            "#include \"packet.h\"",
            "#include \"atomicio.h\"",
            "#include \"log.h\"",
            "#include \"loginrec.h\"",
            "#include \"ssh.h\"",
            "#include \"hostfile.h\"",
            "#include \"sshkey.h\"",
            "#include \"xmalloc.h\"",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <string.h>",
            "#include <stdarg.h>",
            "#include <pwd.h>",
            "# include <paths.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "int utmp_write_entry(struct logininfo *li);",
            "int utmpx_write_entry(struct logininfo *li);",
            "int wtmp_write_entry(struct logininfo *li);",
            "int wtmpx_write_entry(struct logininfo *li);",
            "int lastlog_write_entry(struct logininfo *li);",
            "int syslogin_write_entry(struct logininfo *li);",
            "int getlast_entry(struct logininfo *li);",
            "int lastlog_get_entry(struct logininfo *li);",
            "int utmpx_get_entry(struct logininfo *li);",
            "int wtmp_get_entry(struct logininfo *li);",
            "int wtmpx_get_entry(struct logininfo *li);"
          ],
          "called_functions": [],
          "contextual_snippet": "# include <util.h>\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"auth.h\"\n#include \"canohost.h\"\n#include \"packet.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"loginrec.h\"\n#include \"ssh.h\"\n#include \"hostfile.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdarg.h>\n#include <pwd.h>\n# include <paths.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint utmp_write_entry(struct logininfo *li);\nint utmpx_write_entry(struct logininfo *li);\nint wtmp_write_entry(struct logininfo *li);\nint wtmpx_write_entry(struct logininfo *li);\nint lastlog_write_entry(struct logininfo *li);\nint syslogin_write_entry(struct logininfo *li);\nint getlast_entry(struct logininfo *li);\nint lastlog_get_entry(struct logininfo *li);\nint utmpx_get_entry(struct logininfo *li);\nint wtmp_get_entry(struct logininfo *li);\nint wtmpx_get_entry(struct logininfo *li);\n\nint\nutmpx_write_entry(struct logininfo *li)\n{\n\tswitch(li->type) {\n\tcase LTYPE_LOGIN:\n\t\treturn (utmpx_perform_login(li));\n\tcase LTYPE_LOGOUT:\n\t\treturn (utmpx_perform_logout(li));\n\tdefault:\n\t\tlogit(\"%s: invalid type field\", __func__);\n\t\treturn (0);\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "wtmp_write_entry",
          "args": [
            "li"
          ],
          "line": 459
        },
        "resolved": true,
        "details": {
          "function_name": "wtmp_write_entry",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
          "lines": "1128-1140",
          "snippet": "int\nwtmp_write_entry(struct logininfo *li)\n{\n\tswitch(li->type) {\n\tcase LTYPE_LOGIN:\n\t\treturn (wtmp_perform_login(li));\n\tcase LTYPE_LOGOUT:\n\t\treturn (wtmp_perform_logout(li));\n\tdefault:\n\t\tlogit(\"%s: invalid type field\", __func__);\n\t\treturn (0);\n\t}\n}",
          "includes": [
            "# include <util.h>",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"auth.h\"",
            "#include \"canohost.h\"",
            "#include \"packet.h\"",
            "#include \"atomicio.h\"",
            "#include \"log.h\"",
            "#include \"loginrec.h\"",
            "#include \"ssh.h\"",
            "#include \"hostfile.h\"",
            "#include \"sshkey.h\"",
            "#include \"xmalloc.h\"",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <string.h>",
            "#include <stdarg.h>",
            "#include <pwd.h>",
            "# include <paths.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "int utmp_write_entry(struct logininfo *li);",
            "int utmpx_write_entry(struct logininfo *li);",
            "int wtmp_write_entry(struct logininfo *li);",
            "int wtmpx_write_entry(struct logininfo *li);",
            "int lastlog_write_entry(struct logininfo *li);",
            "int syslogin_write_entry(struct logininfo *li);",
            "int getlast_entry(struct logininfo *li);",
            "int lastlog_get_entry(struct logininfo *li);",
            "int utmpx_get_entry(struct logininfo *li);",
            "int wtmp_get_entry(struct logininfo *li);",
            "int wtmpx_get_entry(struct logininfo *li);"
          ],
          "called_functions": [],
          "contextual_snippet": "# include <util.h>\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"auth.h\"\n#include \"canohost.h\"\n#include \"packet.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"loginrec.h\"\n#include \"ssh.h\"\n#include \"hostfile.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdarg.h>\n#include <pwd.h>\n# include <paths.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint utmp_write_entry(struct logininfo *li);\nint utmpx_write_entry(struct logininfo *li);\nint wtmp_write_entry(struct logininfo *li);\nint wtmpx_write_entry(struct logininfo *li);\nint lastlog_write_entry(struct logininfo *li);\nint syslogin_write_entry(struct logininfo *li);\nint getlast_entry(struct logininfo *li);\nint lastlog_get_entry(struct logininfo *li);\nint utmpx_get_entry(struct logininfo *li);\nint wtmp_get_entry(struct logininfo *li);\nint wtmpx_get_entry(struct logininfo *li);\n\nint\nwtmp_write_entry(struct logininfo *li)\n{\n\tswitch(li->type) {\n\tcase LTYPE_LOGIN:\n\t\treturn (wtmp_perform_login(li));\n\tcase LTYPE_LOGOUT:\n\t\treturn (wtmp_perform_logout(li));\n\tdefault:\n\t\tlogit(\"%s: invalid type field\", __func__);\n\t\treturn (0);\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "utmp_write_entry",
          "args": [
            "li"
          ],
          "line": 456
        },
        "resolved": true,
        "details": {
          "function_name": "utmp_write_entry",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
          "lines": "961-975",
          "snippet": "int\nutmp_write_entry(struct logininfo *li)\n{\n\tswitch(li->type) {\n\tcase LTYPE_LOGIN:\n\t\treturn (utmp_perform_login(li));\n\n\tcase LTYPE_LOGOUT:\n\t\treturn (utmp_perform_logout(li));\n\n\tdefault:\n\t\tlogit(\"%s: invalid type field\", __func__);\n\t\treturn (0);\n\t}\n}",
          "includes": [
            "# include <util.h>",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"auth.h\"",
            "#include \"canohost.h\"",
            "#include \"packet.h\"",
            "#include \"atomicio.h\"",
            "#include \"log.h\"",
            "#include \"loginrec.h\"",
            "#include \"ssh.h\"",
            "#include \"hostfile.h\"",
            "#include \"sshkey.h\"",
            "#include \"xmalloc.h\"",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <string.h>",
            "#include <stdarg.h>",
            "#include <pwd.h>",
            "# include <paths.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "int utmp_write_entry(struct logininfo *li);",
            "int utmpx_write_entry(struct logininfo *li);",
            "int wtmp_write_entry(struct logininfo *li);",
            "int wtmpx_write_entry(struct logininfo *li);",
            "int lastlog_write_entry(struct logininfo *li);",
            "int syslogin_write_entry(struct logininfo *li);",
            "int getlast_entry(struct logininfo *li);",
            "int lastlog_get_entry(struct logininfo *li);",
            "int utmpx_get_entry(struct logininfo *li);",
            "int wtmp_get_entry(struct logininfo *li);",
            "int wtmpx_get_entry(struct logininfo *li);"
          ],
          "called_functions": [],
          "contextual_snippet": "# include <util.h>\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"auth.h\"\n#include \"canohost.h\"\n#include \"packet.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"loginrec.h\"\n#include \"ssh.h\"\n#include \"hostfile.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdarg.h>\n#include <pwd.h>\n# include <paths.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint utmp_write_entry(struct logininfo *li);\nint utmpx_write_entry(struct logininfo *li);\nint wtmp_write_entry(struct logininfo *li);\nint wtmpx_write_entry(struct logininfo *li);\nint lastlog_write_entry(struct logininfo *li);\nint syslogin_write_entry(struct logininfo *li);\nint getlast_entry(struct logininfo *li);\nint lastlog_get_entry(struct logininfo *li);\nint utmpx_get_entry(struct logininfo *li);\nint wtmp_get_entry(struct logininfo *li);\nint wtmpx_get_entry(struct logininfo *li);\n\nint\nutmp_write_entry(struct logininfo *li)\n{\n\tswitch(li->type) {\n\tcase LTYPE_LOGIN:\n\t\treturn (utmp_perform_login(li));\n\n\tcase LTYPE_LOGOUT:\n\t\treturn (utmp_perform_logout(li));\n\n\tdefault:\n\t\tlogit(\"%s: invalid type field\", __func__);\n\t\treturn (0);\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "lastlog_write_entry",
          "args": [
            "li"
          ],
          "line": 453
        },
        "resolved": true,
        "details": {
          "function_name": "lastlog_write_entry",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
          "lines": "1530-1562",
          "snippet": "int\nlastlog_write_entry(struct logininfo *li)\n{\n\tstruct lastlog last;\n\tint fd;\n\n\tswitch(li->type) {\n\tcase LTYPE_LOGIN:\n\t\t/* create our struct lastlog */\n\t\tmemset(&last, '\\0', sizeof(last));\n\t\tline_stripname(last.ll_line, li->line, sizeof(last.ll_line));\n\t\tstrlcpy(last.ll_host, li->hostname,\n\t\t    MIN_SIZEOF(last.ll_host, li->hostname));\n\t\tlast.ll_time = li->tv_sec;\n\t\n\t\tif (!lastlog_openseek(li, &fd, O_RDWR|O_CREAT))\n\t\t\treturn (0);\n\t\n\t\t/* write the entry */\n\t\tif (atomicio(vwrite, fd, &last, sizeof(last)) != sizeof(last)) {\n\t\t\tclose(fd);\n\t\t\tlogit(\"%s: Error writing to %s: %s\", __func__,\n\t\t\t    LASTLOG_FILE, strerror(errno));\n\t\t\treturn (0);\n\t\t}\n\t\n\t\tclose(fd);\n\t\treturn (1);\n\tdefault:\n\t\tlogit(\"%s: Invalid type field\", __func__);\n\t\treturn (0);\n\t}\n}",
          "includes": [
            "# include <util.h>",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"auth.h\"",
            "#include \"canohost.h\"",
            "#include \"packet.h\"",
            "#include \"atomicio.h\"",
            "#include \"log.h\"",
            "#include \"loginrec.h\"",
            "#include \"ssh.h\"",
            "#include \"hostfile.h\"",
            "#include \"sshkey.h\"",
            "#include \"xmalloc.h\"",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <string.h>",
            "#include <stdarg.h>",
            "#include <pwd.h>",
            "# include <paths.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "int utmp_write_entry(struct logininfo *li);",
            "int utmpx_write_entry(struct logininfo *li);",
            "int wtmp_write_entry(struct logininfo *li);",
            "int wtmpx_write_entry(struct logininfo *li);",
            "int lastlog_write_entry(struct logininfo *li);",
            "int syslogin_write_entry(struct logininfo *li);",
            "int getlast_entry(struct logininfo *li);",
            "int lastlog_get_entry(struct logininfo *li);",
            "int utmpx_get_entry(struct logininfo *li);",
            "int wtmp_get_entry(struct logininfo *li);",
            "int wtmpx_get_entry(struct logininfo *li);"
          ],
          "called_functions": [],
          "contextual_snippet": "# include <util.h>\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"auth.h\"\n#include \"canohost.h\"\n#include \"packet.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"loginrec.h\"\n#include \"ssh.h\"\n#include \"hostfile.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdarg.h>\n#include <pwd.h>\n# include <paths.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint utmp_write_entry(struct logininfo *li);\nint utmpx_write_entry(struct logininfo *li);\nint wtmp_write_entry(struct logininfo *li);\nint wtmpx_write_entry(struct logininfo *li);\nint lastlog_write_entry(struct logininfo *li);\nint syslogin_write_entry(struct logininfo *li);\nint getlast_entry(struct logininfo *li);\nint lastlog_get_entry(struct logininfo *li);\nint utmpx_get_entry(struct logininfo *li);\nint wtmp_get_entry(struct logininfo *li);\nint wtmpx_get_entry(struct logininfo *li);\n\nint\nlastlog_write_entry(struct logininfo *li)\n{\n\tstruct lastlog last;\n\tint fd;\n\n\tswitch(li->type) {\n\tcase LTYPE_LOGIN:\n\t\t/* create our struct lastlog */\n\t\tmemset(&last, '\\0', sizeof(last));\n\t\tline_stripname(last.ll_line, li->line, sizeof(last.ll_line));\n\t\tstrlcpy(last.ll_host, li->hostname,\n\t\t    MIN_SIZEOF(last.ll_host, li->hostname));\n\t\tlast.ll_time = li->tv_sec;\n\t\n\t\tif (!lastlog_openseek(li, &fd, O_RDWR|O_CREAT))\n\t\t\treturn (0);\n\t\n\t\t/* write the entry */\n\t\tif (atomicio(vwrite, fd, &last, sizeof(last)) != sizeof(last)) {\n\t\t\tclose(fd);\n\t\t\tlogit(\"%s: Error writing to %s: %s\", __func__,\n\t\t\t    LASTLOG_FILE, strerror(errno));\n\t\t\treturn (0);\n\t\t}\n\t\n\t\tclose(fd);\n\t\treturn (1);\n\tdefault:\n\t\tlogit(\"%s: Invalid type field\", __func__);\n\t\treturn (0);\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "syslogin_write_entry",
          "args": [
            "li"
          ],
          "line": 449
        },
        "resolved": true,
        "details": {
          "function_name": "syslogin_write_entry",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
          "lines": "1446-1458",
          "snippet": "int\nsyslogin_write_entry(struct logininfo *li)\n{\n\tswitch (li->type) {\n\tcase LTYPE_LOGIN:\n\t\treturn (syslogin_perform_login(li));\n\tcase LTYPE_LOGOUT:\n\t\treturn (syslogin_perform_logout(li));\n\tdefault:\n\t\tlogit(\"%s: Invalid type field\", __func__);\n\t\treturn (0);\n\t}\n}",
          "includes": [
            "# include <util.h>",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"auth.h\"",
            "#include \"canohost.h\"",
            "#include \"packet.h\"",
            "#include \"atomicio.h\"",
            "#include \"log.h\"",
            "#include \"loginrec.h\"",
            "#include \"ssh.h\"",
            "#include \"hostfile.h\"",
            "#include \"sshkey.h\"",
            "#include \"xmalloc.h\"",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <string.h>",
            "#include <stdarg.h>",
            "#include <pwd.h>",
            "# include <paths.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "int utmp_write_entry(struct logininfo *li);",
            "int utmpx_write_entry(struct logininfo *li);",
            "int wtmp_write_entry(struct logininfo *li);",
            "int wtmpx_write_entry(struct logininfo *li);",
            "int lastlog_write_entry(struct logininfo *li);",
            "int syslogin_write_entry(struct logininfo *li);",
            "int getlast_entry(struct logininfo *li);",
            "int lastlog_get_entry(struct logininfo *li);",
            "int utmpx_get_entry(struct logininfo *li);",
            "int wtmp_get_entry(struct logininfo *li);",
            "int wtmpx_get_entry(struct logininfo *li);"
          ],
          "called_functions": [],
          "contextual_snippet": "# include <util.h>\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"auth.h\"\n#include \"canohost.h\"\n#include \"packet.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"loginrec.h\"\n#include \"ssh.h\"\n#include \"hostfile.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdarg.h>\n#include <pwd.h>\n# include <paths.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint utmp_write_entry(struct logininfo *li);\nint utmpx_write_entry(struct logininfo *li);\nint wtmp_write_entry(struct logininfo *li);\nint wtmpx_write_entry(struct logininfo *li);\nint lastlog_write_entry(struct logininfo *li);\nint syslogin_write_entry(struct logininfo *li);\nint getlast_entry(struct logininfo *li);\nint lastlog_get_entry(struct logininfo *li);\nint utmpx_get_entry(struct logininfo *li);\nint wtmp_get_entry(struct logininfo *li);\nint wtmpx_get_entry(struct logininfo *li);\n\nint\nsyslogin_write_entry(struct logininfo *li)\n{\n\tswitch (li->type) {\n\tcase LTYPE_LOGIN:\n\t\treturn (syslogin_perform_login(li));\n\tcase LTYPE_LOGOUT:\n\t\treturn (syslogin_perform_logout(li));\n\tdefault:\n\t\tlogit(\"%s: Invalid type field\", __func__);\n\t\treturn (0);\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "login_set_current_time",
          "args": [
            "li"
          ],
          "line": 447
        },
        "resolved": true,
        "details": {
          "function_name": "login_set_current_time",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
          "lines": "406-415",
          "snippet": "void\nlogin_set_current_time(struct logininfo *li)\n{\n\tstruct timeval tv;\n\n\tgettimeofday(&tv, NULL);\n\n\tli->tv_sec = tv.tv_sec;\n\tli->tv_usec = tv.tv_usec;\n}",
          "includes": [
            "# include <util.h>",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"auth.h\"",
            "#include \"canohost.h\"",
            "#include \"packet.h\"",
            "#include \"atomicio.h\"",
            "#include \"log.h\"",
            "#include \"loginrec.h\"",
            "#include \"ssh.h\"",
            "#include \"hostfile.h\"",
            "#include \"sshkey.h\"",
            "#include \"xmalloc.h\"",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <string.h>",
            "#include <stdarg.h>",
            "#include <pwd.h>",
            "# include <paths.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "int utmp_write_entry(struct logininfo *li);",
            "int utmpx_write_entry(struct logininfo *li);",
            "int wtmp_write_entry(struct logininfo *li);",
            "int wtmpx_write_entry(struct logininfo *li);",
            "int lastlog_write_entry(struct logininfo *li);",
            "int syslogin_write_entry(struct logininfo *li);",
            "int getlast_entry(struct logininfo *li);",
            "int lastlog_get_entry(struct logininfo *li);",
            "int utmpx_get_entry(struct logininfo *li);",
            "int wtmp_get_entry(struct logininfo *li);",
            "int wtmpx_get_entry(struct logininfo *li);"
          ],
          "called_functions": [],
          "contextual_snippet": "# include <util.h>\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"auth.h\"\n#include \"canohost.h\"\n#include \"packet.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"loginrec.h\"\n#include \"ssh.h\"\n#include \"hostfile.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdarg.h>\n#include <pwd.h>\n# include <paths.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint utmp_write_entry(struct logininfo *li);\nint utmpx_write_entry(struct logininfo *li);\nint wtmp_write_entry(struct logininfo *li);\nint wtmpx_write_entry(struct logininfo *li);\nint lastlog_write_entry(struct logininfo *li);\nint syslogin_write_entry(struct logininfo *li);\nint getlast_entry(struct logininfo *li);\nint lastlog_get_entry(struct logininfo *li);\nint utmpx_get_entry(struct logininfo *li);\nint wtmp_get_entry(struct logininfo *li);\nint wtmpx_get_entry(struct logininfo *li);\n\nvoid\nlogin_set_current_time(struct logininfo *li)\n{\n\tstruct timeval tv;\n\n\tgettimeofday(&tv, NULL);\n\n\tli->tv_sec = tv.tv_sec;\n\tli->tv_usec = tv.tv_usec;\n}"
        }
      },
      {
        "call_info": {
          "callee": "geteuid",
          "args": [],
          "line": 440
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "# include <util.h>\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"auth.h\"\n#include \"canohost.h\"\n#include \"packet.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"loginrec.h\"\n#include \"ssh.h\"\n#include \"hostfile.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdarg.h>\n#include <pwd.h>\n# include <paths.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint utmp_write_entry(struct logininfo *li);\nint utmpx_write_entry(struct logininfo *li);\nint wtmp_write_entry(struct logininfo *li);\nint wtmpx_write_entry(struct logininfo *li);\nint lastlog_write_entry(struct logininfo *li);\nint syslogin_write_entry(struct logininfo *li);\nint getlast_entry(struct logininfo *li);\nint lastlog_get_entry(struct logininfo *li);\nint utmpx_get_entry(struct logininfo *li);\nint wtmp_get_entry(struct logininfo *li);\nint wtmpx_get_entry(struct logininfo *li);\nextern struct sshbuf *loginmsg;\n\nint\nlogin_write(struct logininfo *li)\n{\n#ifndef HAVE_CYGWIN\n\tif (geteuid() != 0) {\n\t\tlogit(\"Attempt to write login records by non-root user (aborting)\");\n\t\treturn (1);\n\t}\n#endif\n\n\t/* set the timestamp */\n\tlogin_set_current_time(li);\n#ifdef USE_LOGIN\n\tsyslogin_write_entry(li);\n#endif\n#ifdef USE_LASTLOG\n\tif (li->type == LTYPE_LOGIN)\n\t\tlastlog_write_entry(li);\n#endif\n#ifdef USE_UTMP\n\tutmp_write_entry(li);\n#endif\n#ifdef USE_WTMP\n\twtmp_write_entry(li);\n#endif\n#ifdef USE_UTMPX\n\tutmpx_write_entry(li);\n#endif\n#ifdef USE_WTMPX\n\twtmpx_write_entry(li);\n#endif\n#ifdef CUSTOM_SYS_AUTH_RECORD_LOGIN\n\tif (li->type == LTYPE_LOGIN &&\n\t    !sys_auth_record_login(li->username,li->hostname,li->line,\n\t    &loginmsg))\n\t\tlogit(\"Writing login record failed for %s\", li->username);\n#endif\n#ifdef SSH_AUDIT_EVENTS\n\tif (li->type == LTYPE_LOGIN)\n\t\taudit_session_open(li);\n\telse if (li->type == LTYPE_LOGOUT)\n\t\taudit_session_close(li);\n#endif\n\treturn (0);\n}"
  },
  {
    "function_name": "login_set_addr",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
    "lines": "418-429",
    "snippet": "void\nlogin_set_addr(struct logininfo *li, const struct sockaddr *sa,\n    const unsigned int sa_size)\n{\n\tunsigned int bufsize = sa_size;\n\n\t/* make sure we don't overrun our union */\n\tif (sizeof(li->hostaddr) < sa_size)\n\t\tbufsize = sizeof(li->hostaddr);\n\n\tmemcpy(&li->hostaddr.sa, sa, bufsize);\n}",
    "includes": [
      "# include <util.h>",
      "#include \"ssherr.h\"",
      "#include \"sshbuf.h\"",
      "#include \"auth.h\"",
      "#include \"canohost.h\"",
      "#include \"packet.h\"",
      "#include \"atomicio.h\"",
      "#include \"log.h\"",
      "#include \"loginrec.h\"",
      "#include \"ssh.h\"",
      "#include \"hostfile.h\"",
      "#include \"sshkey.h\"",
      "#include \"xmalloc.h\"",
      "#include <unistd.h>",
      "#include <time.h>",
      "#include <string.h>",
      "#include <stdarg.h>",
      "#include <pwd.h>",
      "# include <paths.h>",
      "#include <fcntl.h>",
      "#include <errno.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "int utmp_write_entry(struct logininfo *li);",
      "int utmpx_write_entry(struct logininfo *li);",
      "int wtmp_write_entry(struct logininfo *li);",
      "int wtmpx_write_entry(struct logininfo *li);",
      "int lastlog_write_entry(struct logininfo *li);",
      "int syslogin_write_entry(struct logininfo *li);",
      "int getlast_entry(struct logininfo *li);",
      "int lastlog_get_entry(struct logininfo *li);",
      "int utmpx_get_entry(struct logininfo *li);",
      "int wtmp_get_entry(struct logininfo *li);",
      "int wtmpx_get_entry(struct logininfo *li);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "memcpy",
          "args": [
            "&li->hostaddr.sa",
            "sa",
            "bufsize"
          ],
          "line": 428
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "# include <util.h>\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"auth.h\"\n#include \"canohost.h\"\n#include \"packet.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"loginrec.h\"\n#include \"ssh.h\"\n#include \"hostfile.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdarg.h>\n#include <pwd.h>\n# include <paths.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint utmp_write_entry(struct logininfo *li);\nint utmpx_write_entry(struct logininfo *li);\nint wtmp_write_entry(struct logininfo *li);\nint wtmpx_write_entry(struct logininfo *li);\nint lastlog_write_entry(struct logininfo *li);\nint syslogin_write_entry(struct logininfo *li);\nint getlast_entry(struct logininfo *li);\nint lastlog_get_entry(struct logininfo *li);\nint utmpx_get_entry(struct logininfo *li);\nint wtmp_get_entry(struct logininfo *li);\nint wtmpx_get_entry(struct logininfo *li);\n\nvoid\nlogin_set_addr(struct logininfo *li, const struct sockaddr *sa,\n    const unsigned int sa_size)\n{\n\tunsigned int bufsize = sa_size;\n\n\t/* make sure we don't overrun our union */\n\tif (sizeof(li->hostaddr) < sa_size)\n\t\tbufsize = sizeof(li->hostaddr);\n\n\tmemcpy(&li->hostaddr.sa, sa, bufsize);\n}"
  },
  {
    "function_name": "login_set_current_time",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
    "lines": "406-415",
    "snippet": "void\nlogin_set_current_time(struct logininfo *li)\n{\n\tstruct timeval tv;\n\n\tgettimeofday(&tv, NULL);\n\n\tli->tv_sec = tv.tv_sec;\n\tli->tv_usec = tv.tv_usec;\n}",
    "includes": [
      "# include <util.h>",
      "#include \"ssherr.h\"",
      "#include \"sshbuf.h\"",
      "#include \"auth.h\"",
      "#include \"canohost.h\"",
      "#include \"packet.h\"",
      "#include \"atomicio.h\"",
      "#include \"log.h\"",
      "#include \"loginrec.h\"",
      "#include \"ssh.h\"",
      "#include \"hostfile.h\"",
      "#include \"sshkey.h\"",
      "#include \"xmalloc.h\"",
      "#include <unistd.h>",
      "#include <time.h>",
      "#include <string.h>",
      "#include <stdarg.h>",
      "#include <pwd.h>",
      "# include <paths.h>",
      "#include <fcntl.h>",
      "#include <errno.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "int utmp_write_entry(struct logininfo *li);",
      "int utmpx_write_entry(struct logininfo *li);",
      "int wtmp_write_entry(struct logininfo *li);",
      "int wtmpx_write_entry(struct logininfo *li);",
      "int lastlog_write_entry(struct logininfo *li);",
      "int syslogin_write_entry(struct logininfo *li);",
      "int getlast_entry(struct logininfo *li);",
      "int lastlog_get_entry(struct logininfo *li);",
      "int utmpx_get_entry(struct logininfo *li);",
      "int wtmp_get_entry(struct logininfo *li);",
      "int wtmpx_get_entry(struct logininfo *li);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "gettimeofday",
          "args": [
            "&tv",
            "NULL"
          ],
          "line": 411
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "# include <util.h>\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"auth.h\"\n#include \"canohost.h\"\n#include \"packet.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"loginrec.h\"\n#include \"ssh.h\"\n#include \"hostfile.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdarg.h>\n#include <pwd.h>\n# include <paths.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint utmp_write_entry(struct logininfo *li);\nint utmpx_write_entry(struct logininfo *li);\nint wtmp_write_entry(struct logininfo *li);\nint wtmpx_write_entry(struct logininfo *li);\nint lastlog_write_entry(struct logininfo *li);\nint syslogin_write_entry(struct logininfo *li);\nint getlast_entry(struct logininfo *li);\nint lastlog_get_entry(struct logininfo *li);\nint utmpx_get_entry(struct logininfo *li);\nint wtmp_get_entry(struct logininfo *li);\nint wtmpx_get_entry(struct logininfo *li);\n\nvoid\nlogin_set_current_time(struct logininfo *li)\n{\n\tstruct timeval tv;\n\n\tgettimeofday(&tv, NULL);\n\n\tli->tv_sec = tv.tv_sec;\n\tli->tv_usec = tv.tv_usec;\n}"
  },
  {
    "function_name": "login_init_entry",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
    "lines": "369-397",
    "snippet": "int\nlogin_init_entry(struct logininfo *li, pid_t pid, const char *username,\n    const char *hostname, const char *line)\n{\n\tstruct passwd *pw;\n\n\tmemset(li, 0, sizeof(*li));\n\n\tli->pid = pid;\n\n\t/* set the line information */\n\tif (line)\n\t\tline_fullname(li->line, line, sizeof(li->line));\n\n\tif (username) {\n\t\tstrlcpy(li->username, username, sizeof(li->username));\n\t\tpw = getpwnam(li->username);\n\t\tif (pw == NULL) {\n\t\t\tfatal(\"%s: Cannot find user \\\"%s\\\"\", __func__,\n\t\t\t    li->username);\n\t\t}\n\t\tli->uid = pw->pw_uid;\n\t}\n\n\tif (hostname)\n\t\tstrlcpy(li->hostname, hostname, sizeof(li->hostname));\n\n\treturn (1);\n}",
    "includes": [
      "# include <util.h>",
      "#include \"ssherr.h\"",
      "#include \"sshbuf.h\"",
      "#include \"auth.h\"",
      "#include \"canohost.h\"",
      "#include \"packet.h\"",
      "#include \"atomicio.h\"",
      "#include \"log.h\"",
      "#include \"loginrec.h\"",
      "#include \"ssh.h\"",
      "#include \"hostfile.h\"",
      "#include \"sshkey.h\"",
      "#include \"xmalloc.h\"",
      "#include <unistd.h>",
      "#include <time.h>",
      "#include <string.h>",
      "#include <stdarg.h>",
      "#include <pwd.h>",
      "# include <paths.h>",
      "#include <fcntl.h>",
      "#include <errno.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "int utmp_write_entry(struct logininfo *li);",
      "int utmpx_write_entry(struct logininfo *li);",
      "int wtmp_write_entry(struct logininfo *li);",
      "int wtmpx_write_entry(struct logininfo *li);",
      "int lastlog_write_entry(struct logininfo *li);",
      "int syslogin_write_entry(struct logininfo *li);",
      "int getlast_entry(struct logininfo *li);",
      "int lastlog_get_entry(struct logininfo *li);",
      "int utmpx_get_entry(struct logininfo *li);",
      "int wtmp_get_entry(struct logininfo *li);",
      "int wtmpx_get_entry(struct logininfo *li);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "strlcpy",
          "args": [
            "li->hostname",
            "hostname",
            "sizeof(li->hostname)"
          ],
          "line": 394
        },
        "resolved": true,
        "details": {
          "function_name": "strlcpy",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/openbsd-compat/strlcpy.c",
          "lines": "32-56",
          "snippet": "size_t\nstrlcpy(char *dst, const char *src, size_t siz)\n{\n\tchar *d = dst;\n\tconst char *s = src;\n\tsize_t n = siz;\n\n\t/* Copy as many bytes as will fit */\n\tif (n != 0) {\n\t\twhile (--n != 0) {\n\t\t\tif ((*d++ = *s++) == '\\0')\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\t/* Not enough room in dst, add NUL and traverse rest of src */\n\tif (n == 0) {\n\t\tif (siz != 0)\n\t\t\t*d = '\\0';\t\t/* NUL-terminate dst */\n\t\twhile (*s++)\n\t\t\t;\n\t}\n\n\treturn(s - src - 1);\t/* count does not include NUL */\n}",
          "includes": [
            "#include <string.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nsize_t\nstrlcpy(char *dst, const char *src, size_t siz)\n{\n\tchar *d = dst;\n\tconst char *s = src;\n\tsize_t n = siz;\n\n\t/* Copy as many bytes as will fit */\n\tif (n != 0) {\n\t\twhile (--n != 0) {\n\t\t\tif ((*d++ = *s++) == '\\0')\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\t/* Not enough room in dst, add NUL and traverse rest of src */\n\tif (n == 0) {\n\t\tif (siz != 0)\n\t\t\t*d = '\\0';\t\t/* NUL-terminate dst */\n\t\twhile (*s++)\n\t\t\t;\n\t}\n\n\treturn(s - src - 1);\t/* count does not include NUL */\n}"
        }
      },
      {
        "call_info": {
          "callee": "fatal",
          "args": [
            "\"%s: Cannot find user \\\"%s\\\"\"",
            "__func__",
            "li->username"
          ],
          "line": 387
        },
        "resolved": true,
        "details": {
          "function_name": "fatal",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/fatal.c",
          "lines": "36-45",
          "snippet": "void\nfatal(const char *fmt,...)\n{\n\tva_list args;\n\n\tva_start(args, fmt);\n\tdo_log(SYSLOG_LEVEL_FATAL, fmt, args);\n\tva_end(args);\n\tcleanup_exit(255);\n}",
          "includes": [
            "#include \"log.h\"",
            "#include <stdarg.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n#include <stdarg.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\nfatal(const char *fmt,...)\n{\n\tva_list args;\n\n\tva_start(args, fmt);\n\tdo_log(SYSLOG_LEVEL_FATAL, fmt, args);\n\tva_end(args);\n\tcleanup_exit(255);\n}"
        }
      },
      {
        "call_info": {
          "callee": "getpwnam",
          "args": [
            "li->username"
          ],
          "line": 385
        },
        "resolved": true,
        "details": {
          "function_name": "getpwnamallow",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/auth.c",
          "lines": "560-632",
          "snippet": "struct passwd *\ngetpwnamallow(const char *user)\n{\n\tstruct ssh *ssh = active_state; /* XXX */\n#ifdef HAVE_LOGIN_CAP\n\textern login_cap_t *lc;\n#ifdef BSD_AUTH\n\tauth_session_t *as;\n#endif\n#endif\n\tstruct passwd *pw;\n\tstruct connection_info *ci = get_connection_info(1, options.use_dns);\n\n\tci->user = user;\n\tparse_server_match_config(&options, ci);\n\tlog_change_level(options.log_level);\n\tprocess_permitopen(ssh, &options);\n\n#if defined(_AIX) && defined(HAVE_SETAUTHDB)\n\taix_setauthdb(user);\n#endif\n\n\tpw = getpwnam(user);\n\n#if defined(_AIX) && defined(HAVE_SETAUTHDB)\n\taix_restoreauthdb();\n#endif\n#ifdef HAVE_CYGWIN\n\t/*\n\t * Windows usernames are case-insensitive.  To avoid later problems\n\t * when trying to match the username, the user is only allowed to\n\t * login if the username is given in the same case as stored in the\n\t * user database.\n\t */\n\tif (pw != NULL && strcmp(user, pw->pw_name) != 0) {\n\t\tlogit(\"Login name %.100s does not match stored username %.100s\",\n\t\t    user, pw->pw_name);\n\t\tpw = NULL;\n\t}\n#endif\n\tif (pw == NULL) {\n\t\tlogit(\"Invalid user %.100s from %.100s port %d\",\n\t\t    user, ssh_remote_ipaddr(ssh), ssh_remote_port(ssh));\n#ifdef CUSTOM_FAILED_LOGIN\n\t\trecord_failed_login(user,\n\t\t    auth_get_canonical_hostname(ssh, options.use_dns), \"ssh\");\n#endif\n#ifdef SSH_AUDIT_EVENTS\n\t\taudit_event(SSH_INVALID_USER);\n#endif /* SSH_AUDIT_EVENTS */\n\t\treturn (NULL);\n\t}\n\tif (!allowed_user(pw))\n\t\treturn (NULL);\n#ifdef HAVE_LOGIN_CAP\n\tif ((lc = login_getclass(pw->pw_class)) == NULL) {\n\t\tdebug(\"unable to get login class: %s\", user);\n\t\treturn (NULL);\n\t}\n#ifdef BSD_AUTH\n\tif ((as = auth_open()) == NULL || auth_setpwd(as, pw) != 0 ||\n\t    auth_approval(as, lc, pw->pw_name, \"ssh\") <= 0) {\n\t\tdebug(\"Approval failure for %s\", user);\n\t\tpw = NULL;\n\t}\n\tif (as != NULL)\n\t\tauth_close(as);\n#endif\n#endif\n\tif (pw != NULL)\n\t\treturn (pwcopy(pw));\n\treturn (NULL);\n}",
          "includes": [
            "#include \"channels.h\"",
            "#include \"compat.h\"",
            "#include \"ssherr.h\"",
            "#include \"authfile.h\"",
            "#include \"monitor_wrap.h\"",
            "#include \"authfile.h\"",
            "#include \"ssh-gss.h\"",
            "#include \"loginrec.h\"",
            "#include \"packet.h\"",
            "#include \"uidswap.h\"",
            "#include \"canohost.h\"",
            "#include \"auth-options.h\"",
            "#include \"auth.h\"",
            "#include \"hostfile.h\"",
            "#include \"sshkey.h\"",
            "#include \"servconf.h\"",
            "#include \"misc.h\"",
            "#include \"sshbuf.h\"",
            "#include \"log.h\"",
            "#include \"groupaccess.h\"",
            "#include \"match.h\"",
            "#include \"xmalloc.h\"",
            "#include <netdb.h>",
            "#include <limits.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <shadow.h>",
            "#include <login.h>",
            "#include <pwd.h>",
            "# include <paths.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <netinet/in.h>",
            "#include <sys/wait.h>",
            "#include <sys/socket.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "extern ServerOptions options;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"channels.h\"\n#include \"compat.h\"\n#include \"ssherr.h\"\n#include \"authfile.h\"\n#include \"monitor_wrap.h\"\n#include \"authfile.h\"\n#include \"ssh-gss.h\"\n#include \"loginrec.h\"\n#include \"packet.h\"\n#include \"uidswap.h\"\n#include \"canohost.h\"\n#include \"auth-options.h\"\n#include \"auth.h\"\n#include \"hostfile.h\"\n#include \"sshkey.h\"\n#include \"servconf.h\"\n#include \"misc.h\"\n#include \"sshbuf.h\"\n#include \"log.h\"\n#include \"groupaccess.h\"\n#include \"match.h\"\n#include \"xmalloc.h\"\n#include <netdb.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <shadow.h>\n#include <login.h>\n#include <pwd.h>\n# include <paths.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <netinet/in.h>\n#include <sys/wait.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nextern ServerOptions options;\n\nstruct passwd *\ngetpwnamallow(const char *user)\n{\n\tstruct ssh *ssh = active_state; /* XXX */\n#ifdef HAVE_LOGIN_CAP\n\textern login_cap_t *lc;\n#ifdef BSD_AUTH\n\tauth_session_t *as;\n#endif\n#endif\n\tstruct passwd *pw;\n\tstruct connection_info *ci = get_connection_info(1, options.use_dns);\n\n\tci->user = user;\n\tparse_server_match_config(&options, ci);\n\tlog_change_level(options.log_level);\n\tprocess_permitopen(ssh, &options);\n\n#if defined(_AIX) && defined(HAVE_SETAUTHDB)\n\taix_setauthdb(user);\n#endif\n\n\tpw = getpwnam(user);\n\n#if defined(_AIX) && defined(HAVE_SETAUTHDB)\n\taix_restoreauthdb();\n#endif\n#ifdef HAVE_CYGWIN\n\t/*\n\t * Windows usernames are case-insensitive.  To avoid later problems\n\t * when trying to match the username, the user is only allowed to\n\t * login if the username is given in the same case as stored in the\n\t * user database.\n\t */\n\tif (pw != NULL && strcmp(user, pw->pw_name) != 0) {\n\t\tlogit(\"Login name %.100s does not match stored username %.100s\",\n\t\t    user, pw->pw_name);\n\t\tpw = NULL;\n\t}\n#endif\n\tif (pw == NULL) {\n\t\tlogit(\"Invalid user %.100s from %.100s port %d\",\n\t\t    user, ssh_remote_ipaddr(ssh), ssh_remote_port(ssh));\n#ifdef CUSTOM_FAILED_LOGIN\n\t\trecord_failed_login(user,\n\t\t    auth_get_canonical_hostname(ssh, options.use_dns), \"ssh\");\n#endif\n#ifdef SSH_AUDIT_EVENTS\n\t\taudit_event(SSH_INVALID_USER);\n#endif /* SSH_AUDIT_EVENTS */\n\t\treturn (NULL);\n\t}\n\tif (!allowed_user(pw))\n\t\treturn (NULL);\n#ifdef HAVE_LOGIN_CAP\n\tif ((lc = login_getclass(pw->pw_class)) == NULL) {\n\t\tdebug(\"unable to get login class: %s\", user);\n\t\treturn (NULL);\n\t}\n#ifdef BSD_AUTH\n\tif ((as = auth_open()) == NULL || auth_setpwd(as, pw) != 0 ||\n\t    auth_approval(as, lc, pw->pw_name, \"ssh\") <= 0) {\n\t\tdebug(\"Approval failure for %s\", user);\n\t\tpw = NULL;\n\t}\n\tif (as != NULL)\n\t\tauth_close(as);\n#endif\n#endif\n\tif (pw != NULL)\n\t\treturn (pwcopy(pw));\n\treturn (NULL);\n}"
        }
      },
      {
        "call_info": {
          "callee": "line_fullname",
          "args": [
            "li->line",
            "line",
            "sizeof(li->line)"
          ],
          "line": 381
        },
        "resolved": true,
        "details": {
          "function_name": "line_fullname",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
          "lines": "563-574",
          "snippet": "char *\nline_fullname(char *dst, const char *src, u_int dstsize)\n{\n\tmemset(dst, '\\0', dstsize);\n\tif ((strncmp(src, \"/dev/\", 5) == 0) || (dstsize < (strlen(src) + 5)))\n\t\tstrlcpy(dst, src, dstsize);\n\telse {\n\t\tstrlcpy(dst, \"/dev/\", dstsize);\n\t\tstrlcat(dst, src, dstsize);\n\t}\n\treturn (dst);\n}",
          "includes": [
            "# include <util.h>",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"auth.h\"",
            "#include \"canohost.h\"",
            "#include \"packet.h\"",
            "#include \"atomicio.h\"",
            "#include \"log.h\"",
            "#include \"loginrec.h\"",
            "#include \"ssh.h\"",
            "#include \"hostfile.h\"",
            "#include \"sshkey.h\"",
            "#include \"xmalloc.h\"",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <string.h>",
            "#include <stdarg.h>",
            "#include <pwd.h>",
            "# include <paths.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <util.h>\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"auth.h\"\n#include \"canohost.h\"\n#include \"packet.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"loginrec.h\"\n#include \"ssh.h\"\n#include \"hostfile.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdarg.h>\n#include <pwd.h>\n# include <paths.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nchar *\nline_fullname(char *dst, const char *src, u_int dstsize)\n{\n\tmemset(dst, '\\0', dstsize);\n\tif ((strncmp(src, \"/dev/\", 5) == 0) || (dstsize < (strlen(src) + 5)))\n\t\tstrlcpy(dst, src, dstsize);\n\telse {\n\t\tstrlcpy(dst, \"/dev/\", dstsize);\n\t\tstrlcat(dst, src, dstsize);\n\t}\n\treturn (dst);\n}"
        }
      },
      {
        "call_info": {
          "callee": "memset",
          "args": [
            "li",
            "0",
            "sizeof(*li)"
          ],
          "line": 375
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "# include <util.h>\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"auth.h\"\n#include \"canohost.h\"\n#include \"packet.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"loginrec.h\"\n#include \"ssh.h\"\n#include \"hostfile.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdarg.h>\n#include <pwd.h>\n# include <paths.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint utmp_write_entry(struct logininfo *li);\nint utmpx_write_entry(struct logininfo *li);\nint wtmp_write_entry(struct logininfo *li);\nint wtmpx_write_entry(struct logininfo *li);\nint lastlog_write_entry(struct logininfo *li);\nint syslogin_write_entry(struct logininfo *li);\nint getlast_entry(struct logininfo *li);\nint lastlog_get_entry(struct logininfo *li);\nint utmpx_get_entry(struct logininfo *li);\nint wtmp_get_entry(struct logininfo *li);\nint wtmpx_get_entry(struct logininfo *li);\n\nint\nlogin_init_entry(struct logininfo *li, pid_t pid, const char *username,\n    const char *hostname, const char *line)\n{\n\tstruct passwd *pw;\n\n\tmemset(li, 0, sizeof(*li));\n\n\tli->pid = pid;\n\n\t/* set the line information */\n\tif (line)\n\t\tline_fullname(li->line, line, sizeof(li->line));\n\n\tif (username) {\n\t\tstrlcpy(li->username, username, sizeof(li->username));\n\t\tpw = getpwnam(li->username);\n\t\tif (pw == NULL) {\n\t\t\tfatal(\"%s: Cannot find user \\\"%s\\\"\", __func__,\n\t\t\t    li->username);\n\t\t}\n\t\tli->uid = pw->pw_uid;\n\t}\n\n\tif (hostname)\n\t\tstrlcpy(li->hostname, hostname, sizeof(li->hostname));\n\n\treturn (1);\n}"
  },
  {
    "function_name": "login_free_entry",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
    "lines": "354-358",
    "snippet": "void\nlogin_free_entry(struct logininfo *li)\n{\n\tfree(li);\n}",
    "includes": [
      "# include <util.h>",
      "#include \"ssherr.h\"",
      "#include \"sshbuf.h\"",
      "#include \"auth.h\"",
      "#include \"canohost.h\"",
      "#include \"packet.h\"",
      "#include \"atomicio.h\"",
      "#include \"log.h\"",
      "#include \"loginrec.h\"",
      "#include \"ssh.h\"",
      "#include \"hostfile.h\"",
      "#include \"sshkey.h\"",
      "#include \"xmalloc.h\"",
      "#include <unistd.h>",
      "#include <time.h>",
      "#include <string.h>",
      "#include <stdarg.h>",
      "#include <pwd.h>",
      "# include <paths.h>",
      "#include <fcntl.h>",
      "#include <errno.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "int utmp_write_entry(struct logininfo *li);",
      "int utmpx_write_entry(struct logininfo *li);",
      "int wtmp_write_entry(struct logininfo *li);",
      "int wtmpx_write_entry(struct logininfo *li);",
      "int lastlog_write_entry(struct logininfo *li);",
      "int syslogin_write_entry(struct logininfo *li);",
      "int getlast_entry(struct logininfo *li);",
      "int lastlog_get_entry(struct logininfo *li);",
      "int utmpx_get_entry(struct logininfo *li);",
      "int wtmp_get_entry(struct logininfo *li);",
      "int wtmpx_get_entry(struct logininfo *li);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "li"
          ],
          "line": 357
        },
        "resolved": true,
        "details": {
          "function_name": "login_free_entry",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
          "lines": "354-358",
          "snippet": "void\nlogin_free_entry(struct logininfo *li)\n{\n\tfree(li);\n}",
          "note": "cyclic_reference_detected"
        }
      }
    ],
    "contextual_snippet": "# include <util.h>\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"auth.h\"\n#include \"canohost.h\"\n#include \"packet.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"loginrec.h\"\n#include \"ssh.h\"\n#include \"hostfile.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdarg.h>\n#include <pwd.h>\n# include <paths.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint utmp_write_entry(struct logininfo *li);\nint utmpx_write_entry(struct logininfo *li);\nint wtmp_write_entry(struct logininfo *li);\nint wtmpx_write_entry(struct logininfo *li);\nint lastlog_write_entry(struct logininfo *li);\nint syslogin_write_entry(struct logininfo *li);\nint getlast_entry(struct logininfo *li);\nint lastlog_get_entry(struct logininfo *li);\nint utmpx_get_entry(struct logininfo *li);\nint wtmp_get_entry(struct logininfo *li);\nint wtmpx_get_entry(struct logininfo *li);\n\nvoid\nlogin_free_entry(struct logininfo *li)\n{\n\tfree(li);\n}"
  },
  {
    "function_name": "login_alloc_entry",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
    "lines": "341-350",
    "snippet": "struct\nlogininfo *login_alloc_entry(pid_t pid, const char *username,\n    const char *hostname, const char *line)\n{\n\tstruct logininfo *newli;\n\n\tnewli = xmalloc(sizeof(*newli));\n\tlogin_init_entry(newli, pid, username, hostname, line);\n\treturn (newli);\n}",
    "includes": [
      "# include <util.h>",
      "#include \"ssherr.h\"",
      "#include \"sshbuf.h\"",
      "#include \"auth.h\"",
      "#include \"canohost.h\"",
      "#include \"packet.h\"",
      "#include \"atomicio.h\"",
      "#include \"log.h\"",
      "#include \"loginrec.h\"",
      "#include \"ssh.h\"",
      "#include \"hostfile.h\"",
      "#include \"sshkey.h\"",
      "#include \"xmalloc.h\"",
      "#include <unistd.h>",
      "#include <time.h>",
      "#include <string.h>",
      "#include <stdarg.h>",
      "#include <pwd.h>",
      "# include <paths.h>",
      "#include <fcntl.h>",
      "#include <errno.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "login_init_entry",
          "args": [
            "newli",
            "pid",
            "username",
            "hostname",
            "line"
          ],
          "line": 348
        },
        "resolved": true,
        "details": {
          "function_name": "login_init_entry",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
          "lines": "369-397",
          "snippet": "int\nlogin_init_entry(struct logininfo *li, pid_t pid, const char *username,\n    const char *hostname, const char *line)\n{\n\tstruct passwd *pw;\n\n\tmemset(li, 0, sizeof(*li));\n\n\tli->pid = pid;\n\n\t/* set the line information */\n\tif (line)\n\t\tline_fullname(li->line, line, sizeof(li->line));\n\n\tif (username) {\n\t\tstrlcpy(li->username, username, sizeof(li->username));\n\t\tpw = getpwnam(li->username);\n\t\tif (pw == NULL) {\n\t\t\tfatal(\"%s: Cannot find user \\\"%s\\\"\", __func__,\n\t\t\t    li->username);\n\t\t}\n\t\tli->uid = pw->pw_uid;\n\t}\n\n\tif (hostname)\n\t\tstrlcpy(li->hostname, hostname, sizeof(li->hostname));\n\n\treturn (1);\n}",
          "includes": [
            "# include <util.h>",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"auth.h\"",
            "#include \"canohost.h\"",
            "#include \"packet.h\"",
            "#include \"atomicio.h\"",
            "#include \"log.h\"",
            "#include \"loginrec.h\"",
            "#include \"ssh.h\"",
            "#include \"hostfile.h\"",
            "#include \"sshkey.h\"",
            "#include \"xmalloc.h\"",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <string.h>",
            "#include <stdarg.h>",
            "#include <pwd.h>",
            "# include <paths.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "int utmp_write_entry(struct logininfo *li);",
            "int utmpx_write_entry(struct logininfo *li);",
            "int wtmp_write_entry(struct logininfo *li);",
            "int wtmpx_write_entry(struct logininfo *li);",
            "int lastlog_write_entry(struct logininfo *li);",
            "int syslogin_write_entry(struct logininfo *li);",
            "int getlast_entry(struct logininfo *li);",
            "int lastlog_get_entry(struct logininfo *li);",
            "int utmpx_get_entry(struct logininfo *li);",
            "int wtmp_get_entry(struct logininfo *li);",
            "int wtmpx_get_entry(struct logininfo *li);"
          ],
          "called_functions": [],
          "contextual_snippet": "# include <util.h>\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"auth.h\"\n#include \"canohost.h\"\n#include \"packet.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"loginrec.h\"\n#include \"ssh.h\"\n#include \"hostfile.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdarg.h>\n#include <pwd.h>\n# include <paths.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint utmp_write_entry(struct logininfo *li);\nint utmpx_write_entry(struct logininfo *li);\nint wtmp_write_entry(struct logininfo *li);\nint wtmpx_write_entry(struct logininfo *li);\nint lastlog_write_entry(struct logininfo *li);\nint syslogin_write_entry(struct logininfo *li);\nint getlast_entry(struct logininfo *li);\nint lastlog_get_entry(struct logininfo *li);\nint utmpx_get_entry(struct logininfo *li);\nint wtmp_get_entry(struct logininfo *li);\nint wtmpx_get_entry(struct logininfo *li);\n\nint\nlogin_init_entry(struct logininfo *li, pid_t pid, const char *username,\n    const char *hostname, const char *line)\n{\n\tstruct passwd *pw;\n\n\tmemset(li, 0, sizeof(*li));\n\n\tli->pid = pid;\n\n\t/* set the line information */\n\tif (line)\n\t\tline_fullname(li->line, line, sizeof(li->line));\n\n\tif (username) {\n\t\tstrlcpy(li->username, username, sizeof(li->username));\n\t\tpw = getpwnam(li->username);\n\t\tif (pw == NULL) {\n\t\t\tfatal(\"%s: Cannot find user \\\"%s\\\"\", __func__,\n\t\t\t    li->username);\n\t\t}\n\t\tli->uid = pw->pw_uid;\n\t}\n\n\tif (hostname)\n\t\tstrlcpy(li->hostname, hostname, sizeof(li->hostname));\n\n\treturn (1);\n}"
        }
      },
      {
        "call_info": {
          "callee": "xmalloc",
          "args": [
            "sizeof(*newli)"
          ],
          "line": 347
        },
        "resolved": true,
        "details": {
          "function_name": "xmalloc",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/xmalloc.c",
          "lines": "39-50",
          "snippet": "void *\nxmalloc(size_t size)\n{\n\tvoid *ptr;\n\n\tif (size == 0)\n\t\tfatal(\"xmalloc: zero size\");\n\tptr = malloc(size);\n\tif (ptr == NULL)\n\t\tfatal(\"xmalloc: out of memory (allocating %zu bytes)\", size);\n\treturn ptr;\n}",
          "includes": [
            "#include \"log.h\"",
            "#include \"xmalloc.h\"",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdint.h>",
            "#include <stdarg.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n#include \"xmalloc.h\"\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdint.h>\n#include <stdarg.h>\n#include \"includes.h\"\n\nvoid *\nxmalloc(size_t size)\n{\n\tvoid *ptr;\n\n\tif (size == 0)\n\t\tfatal(\"xmalloc: zero size\");\n\tptr = malloc(size);\n\tif (ptr == NULL)\n\t\tfatal(\"xmalloc: out of memory (allocating %zu bytes)\", size);\n\treturn ptr;\n}"
        }
      }
    ],
    "contextual_snippet": "# include <util.h>\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"auth.h\"\n#include \"canohost.h\"\n#include \"packet.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"loginrec.h\"\n#include \"ssh.h\"\n#include \"hostfile.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdarg.h>\n#include <pwd.h>\n# include <paths.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nstruct\nlogininfo *login_alloc_entry(pid_t pid, const char *username,\n    const char *hostname, const char *line)\n{\n\tstruct logininfo *newli;\n\n\tnewli = xmalloc(sizeof(*newli));\n\tlogin_init_entry(newli, pid, username, hostname, line);\n\treturn (newli);\n}"
  },
  {
    "function_name": "login_get_lastlog",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
    "lines": "299-329",
    "snippet": "struct logininfo *\nlogin_get_lastlog(struct logininfo *li, const uid_t uid)\n{\n\tstruct passwd *pw;\n\n\tmemset(li, '\\0', sizeof(*li));\n\tli->uid = uid;\n\n\t/*\n\t * If we don't have a 'real' lastlog, we need the username to\n\t * reliably search wtmp(x) for the last login (see\n\t * wtmp_get_entry().)\n\t */\n\tpw = getpwuid(uid);\n\tif (pw == NULL)\n\t\tfatal(\"%s: Cannot find account for uid %ld\", __func__,\n\t\t    (long)uid);\n\n\tif (strlcpy(li->username, pw->pw_name, sizeof(li->username)) >=\n\t    sizeof(li->username)) {\n\t\terror(\"%s: username too long (%lu > max %lu)\", __func__,\n\t\t    (unsigned long)strlen(pw->pw_name),\n\t\t    (unsigned long)sizeof(li->username) - 1);\n\t\treturn NULL;\n\t}\n\n\tif (getlast_entry(li))\n\t\treturn (li);\n\telse\n\t\treturn (NULL);\n}",
    "includes": [
      "# include <util.h>",
      "#include \"ssherr.h\"",
      "#include \"sshbuf.h\"",
      "#include \"auth.h\"",
      "#include \"canohost.h\"",
      "#include \"packet.h\"",
      "#include \"atomicio.h\"",
      "#include \"log.h\"",
      "#include \"loginrec.h\"",
      "#include \"ssh.h\"",
      "#include \"hostfile.h\"",
      "#include \"sshkey.h\"",
      "#include \"xmalloc.h\"",
      "#include <unistd.h>",
      "#include <time.h>",
      "#include <string.h>",
      "#include <stdarg.h>",
      "#include <pwd.h>",
      "# include <paths.h>",
      "#include <fcntl.h>",
      "#include <errno.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "int utmp_write_entry(struct logininfo *li);",
      "int utmpx_write_entry(struct logininfo *li);",
      "int wtmp_write_entry(struct logininfo *li);",
      "int wtmpx_write_entry(struct logininfo *li);",
      "int lastlog_write_entry(struct logininfo *li);",
      "int syslogin_write_entry(struct logininfo *li);",
      "int getlast_entry(struct logininfo *li);",
      "int lastlog_get_entry(struct logininfo *li);",
      "int utmpx_get_entry(struct logininfo *li);",
      "int wtmp_get_entry(struct logininfo *li);",
      "int wtmpx_get_entry(struct logininfo *li);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "getlast_entry",
          "args": [
            "li"
          ],
          "line": 325
        },
        "resolved": true,
        "details": {
          "function_name": "getlast_entry",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
          "lines": "510-538",
          "snippet": "int\ngetlast_entry(struct logininfo *li)\n{\n#ifdef USE_LASTLOG\n\treturn(lastlog_get_entry(li));\n#else /* !USE_LASTLOG */\n#if defined(USE_UTMPX) && defined(HAVE_SETUTXDB) && \\\n    defined(UTXDB_LASTLOGIN) && defined(HAVE_GETUTXUSER)\n\treturn (utmpx_get_entry(li));\n#endif\n\n#if defined(DISABLE_LASTLOG)\n\t/* On some systems we shouldn't even try to obtain last login\n\t * time, e.g. AIX */\n\treturn (0);\n# elif defined(USE_WTMP) && \\\n    (defined(HAVE_TIME_IN_UTMP) || defined(HAVE_TV_IN_UTMP))\n\t/* retrieve last login time from utmp */\n\treturn (wtmp_get_entry(li));\n# elif defined(USE_WTMPX) && \\\n    (defined(HAVE_TIME_IN_UTMPX) || defined(HAVE_TV_IN_UTMPX))\n\t/* If wtmp isn't available, try wtmpx */\n\treturn (wtmpx_get_entry(li));\n# else\n\t/* Give up: No means of retrieving last login time */\n\treturn (0);\n# endif /* DISABLE_LASTLOG */\n#endif /* USE_LASTLOG */\n}",
          "includes": [
            "# include <util.h>",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"auth.h\"",
            "#include \"canohost.h\"",
            "#include \"packet.h\"",
            "#include \"atomicio.h\"",
            "#include \"log.h\"",
            "#include \"loginrec.h\"",
            "#include \"ssh.h\"",
            "#include \"hostfile.h\"",
            "#include \"sshkey.h\"",
            "#include \"xmalloc.h\"",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <string.h>",
            "#include <stdarg.h>",
            "#include <pwd.h>",
            "# include <paths.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "int utmp_write_entry(struct logininfo *li);",
            "int utmpx_write_entry(struct logininfo *li);",
            "int wtmp_write_entry(struct logininfo *li);",
            "int wtmpx_write_entry(struct logininfo *li);",
            "int lastlog_write_entry(struct logininfo *li);",
            "int syslogin_write_entry(struct logininfo *li);",
            "int getlast_entry(struct logininfo *li);",
            "int lastlog_get_entry(struct logininfo *li);",
            "int utmpx_get_entry(struct logininfo *li);",
            "int wtmp_get_entry(struct logininfo *li);",
            "int wtmpx_get_entry(struct logininfo *li);"
          ],
          "called_functions": [],
          "contextual_snippet": "# include <util.h>\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"auth.h\"\n#include \"canohost.h\"\n#include \"packet.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"loginrec.h\"\n#include \"ssh.h\"\n#include \"hostfile.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdarg.h>\n#include <pwd.h>\n# include <paths.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint utmp_write_entry(struct logininfo *li);\nint utmpx_write_entry(struct logininfo *li);\nint wtmp_write_entry(struct logininfo *li);\nint wtmpx_write_entry(struct logininfo *li);\nint lastlog_write_entry(struct logininfo *li);\nint syslogin_write_entry(struct logininfo *li);\nint getlast_entry(struct logininfo *li);\nint lastlog_get_entry(struct logininfo *li);\nint utmpx_get_entry(struct logininfo *li);\nint wtmp_get_entry(struct logininfo *li);\nint wtmpx_get_entry(struct logininfo *li);\n\nint\ngetlast_entry(struct logininfo *li)\n{\n#ifdef USE_LASTLOG\n\treturn(lastlog_get_entry(li));\n#else /* !USE_LASTLOG */\n#if defined(USE_UTMPX) && defined(HAVE_SETUTXDB) && \\\n    defined(UTXDB_LASTLOGIN) && defined(HAVE_GETUTXUSER)\n\treturn (utmpx_get_entry(li));\n#endif\n\n#if defined(DISABLE_LASTLOG)\n\t/* On some systems we shouldn't even try to obtain last login\n\t * time, e.g. AIX */\n\treturn (0);\n# elif defined(USE_WTMP) && \\\n    (defined(HAVE_TIME_IN_UTMP) || defined(HAVE_TV_IN_UTMP))\n\t/* retrieve last login time from utmp */\n\treturn (wtmp_get_entry(li));\n# elif defined(USE_WTMPX) && \\\n    (defined(HAVE_TIME_IN_UTMPX) || defined(HAVE_TV_IN_UTMPX))\n\t/* If wtmp isn't available, try wtmpx */\n\treturn (wtmpx_get_entry(li));\n# else\n\t/* Give up: No means of retrieving last login time */\n\treturn (0);\n# endif /* DISABLE_LASTLOG */\n#endif /* USE_LASTLOG */\n}"
        }
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"%s: username too long (%lu > max %lu)\"",
            "__func__",
            "(unsigned long)strlen(pw->pw_name)",
            "(unsigned long)sizeof(li->username) - 1"
          ],
          "line": 319
        },
        "resolved": true,
        "details": {
          "function_name": "error",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/log.c",
          "lines": "162-170",
          "snippet": "void\nerror(const char *fmt,...)\n{\n\tva_list args;\n\n\tva_start(args, fmt);\n\tdo_log(SYSLOG_LEVEL_ERROR, fmt, args);\n\tva_end(args);\n}",
          "includes": [
            "#include \"log.h\"",
            "# include <vis.h>",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <syslog.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <fcntl.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n# include <vis.h>\n#include <errno.h>\n#include <unistd.h>\n#include <syslog.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <fcntl.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\nerror(const char *fmt,...)\n{\n\tva_list args;\n\n\tva_start(args, fmt);\n\tdo_log(SYSLOG_LEVEL_ERROR, fmt, args);\n\tva_end(args);\n}"
        }
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "pw->pw_name"
          ],
          "line": 320
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strlcpy",
          "args": [
            "li->username",
            "pw->pw_name",
            "sizeof(li->username)"
          ],
          "line": 317
        },
        "resolved": true,
        "details": {
          "function_name": "strlcpy",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/openbsd-compat/strlcpy.c",
          "lines": "32-56",
          "snippet": "size_t\nstrlcpy(char *dst, const char *src, size_t siz)\n{\n\tchar *d = dst;\n\tconst char *s = src;\n\tsize_t n = siz;\n\n\t/* Copy as many bytes as will fit */\n\tif (n != 0) {\n\t\twhile (--n != 0) {\n\t\t\tif ((*d++ = *s++) == '\\0')\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\t/* Not enough room in dst, add NUL and traverse rest of src */\n\tif (n == 0) {\n\t\tif (siz != 0)\n\t\t\t*d = '\\0';\t\t/* NUL-terminate dst */\n\t\twhile (*s++)\n\t\t\t;\n\t}\n\n\treturn(s - src - 1);\t/* count does not include NUL */\n}",
          "includes": [
            "#include <string.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nsize_t\nstrlcpy(char *dst, const char *src, size_t siz)\n{\n\tchar *d = dst;\n\tconst char *s = src;\n\tsize_t n = siz;\n\n\t/* Copy as many bytes as will fit */\n\tif (n != 0) {\n\t\twhile (--n != 0) {\n\t\t\tif ((*d++ = *s++) == '\\0')\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\t/* Not enough room in dst, add NUL and traverse rest of src */\n\tif (n == 0) {\n\t\tif (siz != 0)\n\t\t\t*d = '\\0';\t\t/* NUL-terminate dst */\n\t\twhile (*s++)\n\t\t\t;\n\t}\n\n\treturn(s - src - 1);\t/* count does not include NUL */\n}"
        }
      },
      {
        "call_info": {
          "callee": "fatal",
          "args": [
            "\"%s: Cannot find account for uid %ld\"",
            "__func__",
            "(long)uid"
          ],
          "line": 314
        },
        "resolved": true,
        "details": {
          "function_name": "fatal",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/fatal.c",
          "lines": "36-45",
          "snippet": "void\nfatal(const char *fmt,...)\n{\n\tva_list args;\n\n\tva_start(args, fmt);\n\tdo_log(SYSLOG_LEVEL_FATAL, fmt, args);\n\tva_end(args);\n\tcleanup_exit(255);\n}",
          "includes": [
            "#include \"log.h\"",
            "#include <stdarg.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n#include <stdarg.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\nfatal(const char *fmt,...)\n{\n\tva_list args;\n\n\tva_start(args, fmt);\n\tdo_log(SYSLOG_LEVEL_FATAL, fmt, args);\n\tva_end(args);\n\tcleanup_exit(255);\n}"
        }
      },
      {
        "call_info": {
          "callee": "getpwuid",
          "args": [
            "uid"
          ],
          "line": 312
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memset",
          "args": [
            "li",
            "'\\0'",
            "sizeof(*li)"
          ],
          "line": 304
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "# include <util.h>\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"auth.h\"\n#include \"canohost.h\"\n#include \"packet.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"loginrec.h\"\n#include \"ssh.h\"\n#include \"hostfile.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdarg.h>\n#include <pwd.h>\n# include <paths.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint utmp_write_entry(struct logininfo *li);\nint utmpx_write_entry(struct logininfo *li);\nint wtmp_write_entry(struct logininfo *li);\nint wtmpx_write_entry(struct logininfo *li);\nint lastlog_write_entry(struct logininfo *li);\nint syslogin_write_entry(struct logininfo *li);\nint getlast_entry(struct logininfo *li);\nint lastlog_get_entry(struct logininfo *li);\nint utmpx_get_entry(struct logininfo *li);\nint wtmp_get_entry(struct logininfo *li);\nint wtmpx_get_entry(struct logininfo *li);\n\nstruct logininfo *\nlogin_get_lastlog(struct logininfo *li, const uid_t uid)\n{\n\tstruct passwd *pw;\n\n\tmemset(li, '\\0', sizeof(*li));\n\tli->uid = uid;\n\n\t/*\n\t * If we don't have a 'real' lastlog, we need the username to\n\t * reliably search wtmp(x) for the last login (see\n\t * wtmp_get_entry().)\n\t */\n\tpw = getpwuid(uid);\n\tif (pw == NULL)\n\t\tfatal(\"%s: Cannot find account for uid %ld\", __func__,\n\t\t    (long)uid);\n\n\tif (strlcpy(li->username, pw->pw_name, sizeof(li->username)) >=\n\t    sizeof(li->username)) {\n\t\terror(\"%s: username too long (%lu > max %lu)\", __func__,\n\t\t    (unsigned long)strlen(pw->pw_name),\n\t\t    (unsigned long)sizeof(li->username) - 1);\n\t\treturn NULL;\n\t}\n\n\tif (getlast_entry(li))\n\t\treturn (li);\n\telse\n\t\treturn (NULL);\n}"
  },
  {
    "function_name": "login_get_lastlog_time",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
    "lines": "275-284",
    "snippet": "unsigned int\nlogin_get_lastlog_time(const uid_t uid)\n{\n\tstruct logininfo li;\n\n\tif (login_get_lastlog(&li, uid))\n\t\treturn (li.tv_sec);\n\telse\n\t\treturn (0);\n}",
    "includes": [
      "# include <util.h>",
      "#include \"ssherr.h\"",
      "#include \"sshbuf.h\"",
      "#include \"auth.h\"",
      "#include \"canohost.h\"",
      "#include \"packet.h\"",
      "#include \"atomicio.h\"",
      "#include \"log.h\"",
      "#include \"loginrec.h\"",
      "#include \"ssh.h\"",
      "#include \"hostfile.h\"",
      "#include \"sshkey.h\"",
      "#include \"xmalloc.h\"",
      "#include <unistd.h>",
      "#include <time.h>",
      "#include <string.h>",
      "#include <stdarg.h>",
      "#include <pwd.h>",
      "# include <paths.h>",
      "#include <fcntl.h>",
      "#include <errno.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "int utmp_write_entry(struct logininfo *li);",
      "int utmpx_write_entry(struct logininfo *li);",
      "int wtmp_write_entry(struct logininfo *li);",
      "int wtmpx_write_entry(struct logininfo *li);",
      "int lastlog_write_entry(struct logininfo *li);",
      "int syslogin_write_entry(struct logininfo *li);",
      "int getlast_entry(struct logininfo *li);",
      "int lastlog_get_entry(struct logininfo *li);",
      "int utmpx_get_entry(struct logininfo *li);",
      "int wtmp_get_entry(struct logininfo *li);",
      "int wtmpx_get_entry(struct logininfo *li);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "login_get_lastlog",
          "args": [
            "&li",
            "uid"
          ],
          "line": 280
        },
        "resolved": true,
        "details": {
          "function_name": "login_get_lastlog",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
          "lines": "299-329",
          "snippet": "struct logininfo *\nlogin_get_lastlog(struct logininfo *li, const uid_t uid)\n{\n\tstruct passwd *pw;\n\n\tmemset(li, '\\0', sizeof(*li));\n\tli->uid = uid;\n\n\t/*\n\t * If we don't have a 'real' lastlog, we need the username to\n\t * reliably search wtmp(x) for the last login (see\n\t * wtmp_get_entry().)\n\t */\n\tpw = getpwuid(uid);\n\tif (pw == NULL)\n\t\tfatal(\"%s: Cannot find account for uid %ld\", __func__,\n\t\t    (long)uid);\n\n\tif (strlcpy(li->username, pw->pw_name, sizeof(li->username)) >=\n\t    sizeof(li->username)) {\n\t\terror(\"%s: username too long (%lu > max %lu)\", __func__,\n\t\t    (unsigned long)strlen(pw->pw_name),\n\t\t    (unsigned long)sizeof(li->username) - 1);\n\t\treturn NULL;\n\t}\n\n\tif (getlast_entry(li))\n\t\treturn (li);\n\telse\n\t\treturn (NULL);\n}",
          "includes": [
            "# include <util.h>",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"auth.h\"",
            "#include \"canohost.h\"",
            "#include \"packet.h\"",
            "#include \"atomicio.h\"",
            "#include \"log.h\"",
            "#include \"loginrec.h\"",
            "#include \"ssh.h\"",
            "#include \"hostfile.h\"",
            "#include \"sshkey.h\"",
            "#include \"xmalloc.h\"",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <string.h>",
            "#include <stdarg.h>",
            "#include <pwd.h>",
            "# include <paths.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "int utmp_write_entry(struct logininfo *li);",
            "int utmpx_write_entry(struct logininfo *li);",
            "int wtmp_write_entry(struct logininfo *li);",
            "int wtmpx_write_entry(struct logininfo *li);",
            "int lastlog_write_entry(struct logininfo *li);",
            "int syslogin_write_entry(struct logininfo *li);",
            "int getlast_entry(struct logininfo *li);",
            "int lastlog_get_entry(struct logininfo *li);",
            "int utmpx_get_entry(struct logininfo *li);",
            "int wtmp_get_entry(struct logininfo *li);",
            "int wtmpx_get_entry(struct logininfo *li);"
          ],
          "called_functions": [],
          "contextual_snippet": "# include <util.h>\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"auth.h\"\n#include \"canohost.h\"\n#include \"packet.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"loginrec.h\"\n#include \"ssh.h\"\n#include \"hostfile.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdarg.h>\n#include <pwd.h>\n# include <paths.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint utmp_write_entry(struct logininfo *li);\nint utmpx_write_entry(struct logininfo *li);\nint wtmp_write_entry(struct logininfo *li);\nint wtmpx_write_entry(struct logininfo *li);\nint lastlog_write_entry(struct logininfo *li);\nint syslogin_write_entry(struct logininfo *li);\nint getlast_entry(struct logininfo *li);\nint lastlog_get_entry(struct logininfo *li);\nint utmpx_get_entry(struct logininfo *li);\nint wtmp_get_entry(struct logininfo *li);\nint wtmpx_get_entry(struct logininfo *li);\n\nstruct logininfo *\nlogin_get_lastlog(struct logininfo *li, const uid_t uid)\n{\n\tstruct passwd *pw;\n\n\tmemset(li, '\\0', sizeof(*li));\n\tli->uid = uid;\n\n\t/*\n\t * If we don't have a 'real' lastlog, we need the username to\n\t * reliably search wtmp(x) for the last login (see\n\t * wtmp_get_entry().)\n\t */\n\tpw = getpwuid(uid);\n\tif (pw == NULL)\n\t\tfatal(\"%s: Cannot find account for uid %ld\", __func__,\n\t\t    (long)uid);\n\n\tif (strlcpy(li->username, pw->pw_name, sizeof(li->username)) >=\n\t    sizeof(li->username)) {\n\t\terror(\"%s: username too long (%lu > max %lu)\", __func__,\n\t\t    (unsigned long)strlen(pw->pw_name),\n\t\t    (unsigned long)sizeof(li->username) - 1);\n\t\treturn NULL;\n\t}\n\n\tif (getlast_entry(li))\n\t\treturn (li);\n\telse\n\t\treturn (NULL);\n}"
        }
      }
    ],
    "contextual_snippet": "# include <util.h>\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"auth.h\"\n#include \"canohost.h\"\n#include \"packet.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"loginrec.h\"\n#include \"ssh.h\"\n#include \"hostfile.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdarg.h>\n#include <pwd.h>\n# include <paths.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint utmp_write_entry(struct logininfo *li);\nint utmpx_write_entry(struct logininfo *li);\nint wtmp_write_entry(struct logininfo *li);\nint wtmpx_write_entry(struct logininfo *li);\nint lastlog_write_entry(struct logininfo *li);\nint syslogin_write_entry(struct logininfo *li);\nint getlast_entry(struct logininfo *li);\nint lastlog_get_entry(struct logininfo *li);\nint utmpx_get_entry(struct logininfo *li);\nint wtmp_get_entry(struct logininfo *li);\nint wtmpx_get_entry(struct logininfo *li);\n\nunsigned int\nlogin_get_lastlog_time(const uid_t uid)\n{\n\tstruct logininfo li;\n\n\tif (login_get_lastlog(&li, uid))\n\t\treturn (li.tv_sec);\n\telse\n\t\treturn (0);\n}"
  },
  {
    "function_name": "login_logout",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
    "lines": "250-255",
    "snippet": "int\nlogin_logout(struct logininfo *li)\n{\n\tli->type = LTYPE_LOGOUT;\n\treturn (login_write(li));\n}",
    "includes": [
      "# include <util.h>",
      "#include \"ssherr.h\"",
      "#include \"sshbuf.h\"",
      "#include \"auth.h\"",
      "#include \"canohost.h\"",
      "#include \"packet.h\"",
      "#include \"atomicio.h\"",
      "#include \"log.h\"",
      "#include \"loginrec.h\"",
      "#include \"ssh.h\"",
      "#include \"hostfile.h\"",
      "#include \"sshkey.h\"",
      "#include \"xmalloc.h\"",
      "#include <unistd.h>",
      "#include <time.h>",
      "#include <string.h>",
      "#include <stdarg.h>",
      "#include <pwd.h>",
      "# include <paths.h>",
      "#include <fcntl.h>",
      "#include <errno.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "int utmp_write_entry(struct logininfo *li);",
      "int utmpx_write_entry(struct logininfo *li);",
      "int wtmp_write_entry(struct logininfo *li);",
      "int wtmpx_write_entry(struct logininfo *li);",
      "int lastlog_write_entry(struct logininfo *li);",
      "int syslogin_write_entry(struct logininfo *li);",
      "int getlast_entry(struct logininfo *li);",
      "int lastlog_get_entry(struct logininfo *li);",
      "int utmpx_get_entry(struct logininfo *li);",
      "int wtmp_get_entry(struct logininfo *li);",
      "int wtmpx_get_entry(struct logininfo *li);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "login_write",
          "args": [
            "li"
          ],
          "line": 254
        },
        "resolved": true,
        "details": {
          "function_name": "syslogin_write_entry",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
          "lines": "1446-1458",
          "snippet": "int\nsyslogin_write_entry(struct logininfo *li)\n{\n\tswitch (li->type) {\n\tcase LTYPE_LOGIN:\n\t\treturn (syslogin_perform_login(li));\n\tcase LTYPE_LOGOUT:\n\t\treturn (syslogin_perform_logout(li));\n\tdefault:\n\t\tlogit(\"%s: Invalid type field\", __func__);\n\t\treturn (0);\n\t}\n}",
          "includes": [
            "# include <util.h>",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"auth.h\"",
            "#include \"canohost.h\"",
            "#include \"packet.h\"",
            "#include \"atomicio.h\"",
            "#include \"log.h\"",
            "#include \"loginrec.h\"",
            "#include \"ssh.h\"",
            "#include \"hostfile.h\"",
            "#include \"sshkey.h\"",
            "#include \"xmalloc.h\"",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <string.h>",
            "#include <stdarg.h>",
            "#include <pwd.h>",
            "# include <paths.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "int utmp_write_entry(struct logininfo *li);",
            "int utmpx_write_entry(struct logininfo *li);",
            "int wtmp_write_entry(struct logininfo *li);",
            "int wtmpx_write_entry(struct logininfo *li);",
            "int lastlog_write_entry(struct logininfo *li);",
            "int syslogin_write_entry(struct logininfo *li);",
            "int getlast_entry(struct logininfo *li);",
            "int lastlog_get_entry(struct logininfo *li);",
            "int utmpx_get_entry(struct logininfo *li);",
            "int wtmp_get_entry(struct logininfo *li);",
            "int wtmpx_get_entry(struct logininfo *li);"
          ],
          "called_functions": [],
          "contextual_snippet": "# include <util.h>\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"auth.h\"\n#include \"canohost.h\"\n#include \"packet.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"loginrec.h\"\n#include \"ssh.h\"\n#include \"hostfile.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdarg.h>\n#include <pwd.h>\n# include <paths.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint utmp_write_entry(struct logininfo *li);\nint utmpx_write_entry(struct logininfo *li);\nint wtmp_write_entry(struct logininfo *li);\nint wtmpx_write_entry(struct logininfo *li);\nint lastlog_write_entry(struct logininfo *li);\nint syslogin_write_entry(struct logininfo *li);\nint getlast_entry(struct logininfo *li);\nint lastlog_get_entry(struct logininfo *li);\nint utmpx_get_entry(struct logininfo *li);\nint wtmp_get_entry(struct logininfo *li);\nint wtmpx_get_entry(struct logininfo *li);\n\nint\nsyslogin_write_entry(struct logininfo *li)\n{\n\tswitch (li->type) {\n\tcase LTYPE_LOGIN:\n\t\treturn (syslogin_perform_login(li));\n\tcase LTYPE_LOGOUT:\n\t\treturn (syslogin_perform_logout(li));\n\tdefault:\n\t\tlogit(\"%s: Invalid type field\", __func__);\n\t\treturn (0);\n\t}\n}"
        }
      }
    ],
    "contextual_snippet": "# include <util.h>\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"auth.h\"\n#include \"canohost.h\"\n#include \"packet.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"loginrec.h\"\n#include \"ssh.h\"\n#include \"hostfile.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdarg.h>\n#include <pwd.h>\n# include <paths.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint utmp_write_entry(struct logininfo *li);\nint utmpx_write_entry(struct logininfo *li);\nint wtmp_write_entry(struct logininfo *li);\nint wtmpx_write_entry(struct logininfo *li);\nint lastlog_write_entry(struct logininfo *li);\nint syslogin_write_entry(struct logininfo *li);\nint getlast_entry(struct logininfo *li);\nint lastlog_get_entry(struct logininfo *li);\nint utmpx_get_entry(struct logininfo *li);\nint wtmp_get_entry(struct logininfo *li);\nint wtmpx_get_entry(struct logininfo *li);\n\nint\nlogin_logout(struct logininfo *li)\n{\n\tli->type = LTYPE_LOGOUT;\n\treturn (login_write(li));\n}"
  },
  {
    "function_name": "login_login",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
    "lines": "233-238",
    "snippet": "int\nlogin_login(struct logininfo *li)\n{\n\tli->type = LTYPE_LOGIN;\n\treturn (login_write(li));\n}",
    "includes": [
      "# include <util.h>",
      "#include \"ssherr.h\"",
      "#include \"sshbuf.h\"",
      "#include \"auth.h\"",
      "#include \"canohost.h\"",
      "#include \"packet.h\"",
      "#include \"atomicio.h\"",
      "#include \"log.h\"",
      "#include \"loginrec.h\"",
      "#include \"ssh.h\"",
      "#include \"hostfile.h\"",
      "#include \"sshkey.h\"",
      "#include \"xmalloc.h\"",
      "#include <unistd.h>",
      "#include <time.h>",
      "#include <string.h>",
      "#include <stdarg.h>",
      "#include <pwd.h>",
      "# include <paths.h>",
      "#include <fcntl.h>",
      "#include <errno.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "int utmp_write_entry(struct logininfo *li);",
      "int utmpx_write_entry(struct logininfo *li);",
      "int wtmp_write_entry(struct logininfo *li);",
      "int wtmpx_write_entry(struct logininfo *li);",
      "int lastlog_write_entry(struct logininfo *li);",
      "int syslogin_write_entry(struct logininfo *li);",
      "int getlast_entry(struct logininfo *li);",
      "int lastlog_get_entry(struct logininfo *li);",
      "int utmpx_get_entry(struct logininfo *li);",
      "int wtmp_get_entry(struct logininfo *li);",
      "int wtmpx_get_entry(struct logininfo *li);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "login_write",
          "args": [
            "li"
          ],
          "line": 237
        },
        "resolved": true,
        "details": {
          "function_name": "syslogin_write_entry",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/loginrec.c",
          "lines": "1446-1458",
          "snippet": "int\nsyslogin_write_entry(struct logininfo *li)\n{\n\tswitch (li->type) {\n\tcase LTYPE_LOGIN:\n\t\treturn (syslogin_perform_login(li));\n\tcase LTYPE_LOGOUT:\n\t\treturn (syslogin_perform_logout(li));\n\tdefault:\n\t\tlogit(\"%s: Invalid type field\", __func__);\n\t\treturn (0);\n\t}\n}",
          "includes": [
            "# include <util.h>",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"auth.h\"",
            "#include \"canohost.h\"",
            "#include \"packet.h\"",
            "#include \"atomicio.h\"",
            "#include \"log.h\"",
            "#include \"loginrec.h\"",
            "#include \"ssh.h\"",
            "#include \"hostfile.h\"",
            "#include \"sshkey.h\"",
            "#include \"xmalloc.h\"",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <string.h>",
            "#include <stdarg.h>",
            "#include <pwd.h>",
            "# include <paths.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "int utmp_write_entry(struct logininfo *li);",
            "int utmpx_write_entry(struct logininfo *li);",
            "int wtmp_write_entry(struct logininfo *li);",
            "int wtmpx_write_entry(struct logininfo *li);",
            "int lastlog_write_entry(struct logininfo *li);",
            "int syslogin_write_entry(struct logininfo *li);",
            "int getlast_entry(struct logininfo *li);",
            "int lastlog_get_entry(struct logininfo *li);",
            "int utmpx_get_entry(struct logininfo *li);",
            "int wtmp_get_entry(struct logininfo *li);",
            "int wtmpx_get_entry(struct logininfo *li);"
          ],
          "called_functions": [],
          "contextual_snippet": "# include <util.h>\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"auth.h\"\n#include \"canohost.h\"\n#include \"packet.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"loginrec.h\"\n#include \"ssh.h\"\n#include \"hostfile.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdarg.h>\n#include <pwd.h>\n# include <paths.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint utmp_write_entry(struct logininfo *li);\nint utmpx_write_entry(struct logininfo *li);\nint wtmp_write_entry(struct logininfo *li);\nint wtmpx_write_entry(struct logininfo *li);\nint lastlog_write_entry(struct logininfo *li);\nint syslogin_write_entry(struct logininfo *li);\nint getlast_entry(struct logininfo *li);\nint lastlog_get_entry(struct logininfo *li);\nint utmpx_get_entry(struct logininfo *li);\nint wtmp_get_entry(struct logininfo *li);\nint wtmpx_get_entry(struct logininfo *li);\n\nint\nsyslogin_write_entry(struct logininfo *li)\n{\n\tswitch (li->type) {\n\tcase LTYPE_LOGIN:\n\t\treturn (syslogin_perform_login(li));\n\tcase LTYPE_LOGOUT:\n\t\treturn (syslogin_perform_logout(li));\n\tdefault:\n\t\tlogit(\"%s: Invalid type field\", __func__);\n\t\treturn (0);\n\t}\n}"
        }
      }
    ],
    "contextual_snippet": "# include <util.h>\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"auth.h\"\n#include \"canohost.h\"\n#include \"packet.h\"\n#include \"atomicio.h\"\n#include \"log.h\"\n#include \"loginrec.h\"\n#include \"ssh.h\"\n#include \"hostfile.h\"\n#include \"sshkey.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdarg.h>\n#include <pwd.h>\n# include <paths.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint utmp_write_entry(struct logininfo *li);\nint utmpx_write_entry(struct logininfo *li);\nint wtmp_write_entry(struct logininfo *li);\nint wtmpx_write_entry(struct logininfo *li);\nint lastlog_write_entry(struct logininfo *li);\nint syslogin_write_entry(struct logininfo *li);\nint getlast_entry(struct logininfo *li);\nint lastlog_get_entry(struct logininfo *li);\nint utmpx_get_entry(struct logininfo *li);\nint wtmp_get_entry(struct logininfo *li);\nint wtmpx_get_entry(struct logininfo *li);\n\nint\nlogin_login(struct logininfo *li)\n{\n\tli->type = LTYPE_LOGIN;\n\treturn (login_write(li));\n}"
  }
]