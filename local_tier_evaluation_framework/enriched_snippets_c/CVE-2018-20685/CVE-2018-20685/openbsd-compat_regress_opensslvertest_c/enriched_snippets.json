[
  {
    "function_name": "main",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/openbsd-compat/regress/opensslvertest.c",
    "lines": "54-69",
    "snippet": "int\nmain(void)\n{\n\tunsigned int i;\n\tint res;\n\tlong hver, lver;\n\n\tfor (i = 0; i < sizeof(version_tests) / sizeof(version_tests[0]); i++) {\n\t\thver = version_tests[i].headerver;\n\t\tlver = version_tests[i].libver;\n\t\tres = version_tests[i].result;\n\t\tif (ssh_compatible_openssl(hver, lver) != res)\n\t\t\tfail(hver, lver, res);\n\t}\n\texit(0);\n}",
    "includes": [
      "#include <stdlib.h>",
      "#include <stdio.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "int ssh_compatible_openssl(long, long);",
      "struct version_test {\n\tlong headerver;\n\tlong libver;\n\tint result;\n} version_tests[] = {\n\t/* built with 0.9.8b release headers */\n\t{ 0x0090802fL, 0x0090802fL, 1},\t/* exact match */\n\t{ 0x0090802fL, 0x0090804fL, 1},\t/* newer library fix version: ok */\n\t{ 0x0090802fL, 0x0090801fL, 1},\t/* older library fix version: ok */\n\t{ 0x0090802fL, 0x0090702fL, 0},\t/* older library minor version: NO */\n\t{ 0x0090802fL, 0x0090902fL, 0},\t/* newer library minor version: NO */\n\t{ 0x0090802fL, 0x0080802fL, 0},\t/* older library major version: NO */\n\t{ 0x0090802fL, 0x1000100fL, 0},\t/* newer library major version: NO */\n\n\t/* built with 1.0.1b release headers */\n\t{ 0x1000101fL, 0x1000101fL, 1},/* exact match */\n\t{ 0x1000101fL, 0x1000102fL, 1},\t/* newer library patch version: ok */\n\t{ 0x1000101fL, 0x1000100fL, 1},\t/* older library patch version: ok */\n\t{ 0x1000101fL, 0x1000201fL, 1},\t/* newer library fix version: ok */\n\t{ 0x1000101fL, 0x1000001fL, 0},\t/* older library fix version: NO */\n\t{ 0x1000101fL, 0x1010101fL, 0},\t/* newer library minor version: NO */\n\t{ 0x1000101fL, 0x0000101fL, 0},\t/* older library major version: NO */\n\t{ 0x1000101fL, 0x2000101fL, 0},\t/* newer library major version: NO */\n};"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "exit",
          "args": [
            "0"
          ],
          "line": 68
        },
        "resolved": true,
        "details": {
          "function_name": "sftp_server_cleanup_exit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sftp-server.c",
          "lines": "1474-1483",
          "snippet": "void\nsftp_server_cleanup_exit(int i)\n{\n\tif (pw != NULL && client_addr != NULL) {\n\t\thandle_log_exit();\n\t\tlogit(\"session closed for local user %s from [%s]\",\n\t\t    pw->pw_name, client_addr);\n\t}\n\t_exit(i);\n}",
          "includes": [
            "#include \"sftp-common.h\"",
            "#include \"sftp.h\"",
            "#include \"uidswap.h\"",
            "#include \"match.h\"",
            "#include \"misc.h\"",
            "#include \"log.h\"",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"xmalloc.h\"",
            "#include <stdarg.h>",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <pwd.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <dirent.h>",
            "#include <sys/statvfs.h>",
            "#include <sys/mount.h>",
            "# include <sys/time.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static struct passwd *pw = NULL;",
            "static char *client_addr = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"sftp-common.h\"\n#include \"sftp.h\"\n#include \"uidswap.h\"\n#include \"match.h\"\n#include \"misc.h\"\n#include \"log.h\"\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"xmalloc.h\"\n#include <stdarg.h>\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <pwd.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <dirent.h>\n#include <sys/statvfs.h>\n#include <sys/mount.h>\n# include <sys/time.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nstatic struct passwd *pw = NULL;\nstatic char *client_addr = NULL;\n\nvoid\nsftp_server_cleanup_exit(int i)\n{\n\tif (pw != NULL && client_addr != NULL) {\n\t\thandle_log_exit();\n\t\tlogit(\"session closed for local user %s from [%s]\",\n\t\t    pw->pw_name, client_addr);\n\t}\n\t_exit(i);\n}"
        }
      },
      {
        "call_info": {
          "callee": "fail",
          "args": [
            "hver",
            "lver",
            "res"
          ],
          "line": 66
        },
        "resolved": true,
        "details": {
          "function_name": "fail",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/openbsd-compat/regress/opensslvertest.c",
          "lines": "47-52",
          "snippet": "void\nfail(long hver, long lver, int result)\n{\n\tfprintf(stderr, \"opensslver: header %lx library %lx != %d \\n\", hver, lver, result);\n\texit(1);\n}",
          "includes": [
            "#include <stdlib.h>",
            "#include <stdio.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <stdlib.h>\n#include <stdio.h>\n\nvoid\nfail(long hver, long lver, int result)\n{\n\tfprintf(stderr, \"opensslver: header %lx library %lx != %d \\n\", hver, lver, result);\n\texit(1);\n}"
        }
      },
      {
        "call_info": {
          "callee": "ssh_compatible_openssl",
          "args": [
            "hver",
            "lver"
          ],
          "line": 65
        },
        "resolved": true,
        "details": {
          "function_name": "ssh_compatible_openssl",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/openbsd-compat/openssl-compat.c",
          "lines": "42-67",
          "snippet": "int\nssh_compatible_openssl(long headerver, long libver)\n{\n\tlong mask, hfix, lfix;\n\n\t/* exact match is always OK */\n\tif (headerver == libver)\n\t\treturn 1;\n\n\t/* for versions < 1.0.0, major,minor,fix,status must match */\n\tif (headerver < 0x1000000f) {\n\t\tmask = 0xfffff00fL; /* major,minor,fix,status */\n\t\treturn (headerver & mask) == (libver & mask);\n\t}\n\n\t/*\n\t * For versions >= 1.0.0, major,minor,status must match and library\n\t * fix version must be equal to or newer than the header.\n\t */\n\tmask = 0xfff0000fL; /* major,minor,status */\n\thfix = (headerver & 0x000ff000) >> 12;\n\tlfix = (libver & 0x000ff000) >> 12;\n\tif ( (headerver & mask) == (libver & mask) && lfix >= hfix)\n\t\treturn 1;\n\treturn 0;\n}",
          "includes": [
            "#include \"openssl-compat.h\"",
            "#include \"log.h\"",
            "# include <openssl/conf.h>",
            "# include <openssl/engine.h>",
            "#include <string.h>",
            "#include <stdarg.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"openssl-compat.h\"\n#include \"log.h\"\n# include <openssl/conf.h>\n# include <openssl/engine.h>\n#include <string.h>\n#include <stdarg.h>\n#include \"includes.h\"\n\nint\nssh_compatible_openssl(long headerver, long libver)\n{\n\tlong mask, hfix, lfix;\n\n\t/* exact match is always OK */\n\tif (headerver == libver)\n\t\treturn 1;\n\n\t/* for versions < 1.0.0, major,minor,fix,status must match */\n\tif (headerver < 0x1000000f) {\n\t\tmask = 0xfffff00fL; /* major,minor,fix,status */\n\t\treturn (headerver & mask) == (libver & mask);\n\t}\n\n\t/*\n\t * For versions >= 1.0.0, major,minor,status must match and library\n\t * fix version must be equal to or newer than the header.\n\t */\n\tmask = 0xfff0000fL; /* major,minor,status */\n\thfix = (headerver & 0x000ff000) >> 12;\n\tlfix = (libver & 0x000ff000) >> 12;\n\tif ( (headerver & mask) == (libver & mask) && lfix >= hfix)\n\t\treturn 1;\n\treturn 0;\n}"
        }
      }
    ],
    "contextual_snippet": "#include <stdlib.h>\n#include <stdio.h>\n\nint ssh_compatible_openssl(long, long);\nstruct version_test {\n\tlong headerver;\n\tlong libver;\n\tint result;\n} version_tests[] = {\n\t/* built with 0.9.8b release headers */\n\t{ 0x0090802fL, 0x0090802fL, 1},\t/* exact match */\n\t{ 0x0090802fL, 0x0090804fL, 1},\t/* newer library fix version: ok */\n\t{ 0x0090802fL, 0x0090801fL, 1},\t/* older library fix version: ok */\n\t{ 0x0090802fL, 0x0090702fL, 0},\t/* older library minor version: NO */\n\t{ 0x0090802fL, 0x0090902fL, 0},\t/* newer library minor version: NO */\n\t{ 0x0090802fL, 0x0080802fL, 0},\t/* older library major version: NO */\n\t{ 0x0090802fL, 0x1000100fL, 0},\t/* newer library major version: NO */\n\n\t/* built with 1.0.1b release headers */\n\t{ 0x1000101fL, 0x1000101fL, 1},/* exact match */\n\t{ 0x1000101fL, 0x1000102fL, 1},\t/* newer library patch version: ok */\n\t{ 0x1000101fL, 0x1000100fL, 1},\t/* older library patch version: ok */\n\t{ 0x1000101fL, 0x1000201fL, 1},\t/* newer library fix version: ok */\n\t{ 0x1000101fL, 0x1000001fL, 0},\t/* older library fix version: NO */\n\t{ 0x1000101fL, 0x1010101fL, 0},\t/* newer library minor version: NO */\n\t{ 0x1000101fL, 0x0000101fL, 0},\t/* older library major version: NO */\n\t{ 0x1000101fL, 0x2000101fL, 0},\t/* newer library major version: NO */\n};\n\nint\nmain(void)\n{\n\tunsigned int i;\n\tint res;\n\tlong hver, lver;\n\n\tfor (i = 0; i < sizeof(version_tests) / sizeof(version_tests[0]); i++) {\n\t\thver = version_tests[i].headerver;\n\t\tlver = version_tests[i].libver;\n\t\tres = version_tests[i].result;\n\t\tif (ssh_compatible_openssl(hver, lver) != res)\n\t\t\tfail(hver, lver, res);\n\t}\n\texit(0);\n}"
  },
  {
    "function_name": "fail",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/openbsd-compat/regress/opensslvertest.c",
    "lines": "47-52",
    "snippet": "void\nfail(long hver, long lver, int result)\n{\n\tfprintf(stderr, \"opensslver: header %lx library %lx != %d \\n\", hver, lver, result);\n\texit(1);\n}",
    "includes": [
      "#include <stdlib.h>",
      "#include <stdio.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "exit",
          "args": [
            "1"
          ],
          "line": 51
        },
        "resolved": true,
        "details": {
          "function_name": "sftp_server_cleanup_exit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sftp-server.c",
          "lines": "1474-1483",
          "snippet": "void\nsftp_server_cleanup_exit(int i)\n{\n\tif (pw != NULL && client_addr != NULL) {\n\t\thandle_log_exit();\n\t\tlogit(\"session closed for local user %s from [%s]\",\n\t\t    pw->pw_name, client_addr);\n\t}\n\t_exit(i);\n}",
          "includes": [
            "#include \"sftp-common.h\"",
            "#include \"sftp.h\"",
            "#include \"uidswap.h\"",
            "#include \"match.h\"",
            "#include \"misc.h\"",
            "#include \"log.h\"",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"xmalloc.h\"",
            "#include <stdarg.h>",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <pwd.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <dirent.h>",
            "#include <sys/statvfs.h>",
            "#include <sys/mount.h>",
            "# include <sys/time.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static struct passwd *pw = NULL;",
            "static char *client_addr = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"sftp-common.h\"\n#include \"sftp.h\"\n#include \"uidswap.h\"\n#include \"match.h\"\n#include \"misc.h\"\n#include \"log.h\"\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"xmalloc.h\"\n#include <stdarg.h>\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <pwd.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <dirent.h>\n#include <sys/statvfs.h>\n#include <sys/mount.h>\n# include <sys/time.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nstatic struct passwd *pw = NULL;\nstatic char *client_addr = NULL;\n\nvoid\nsftp_server_cleanup_exit(int i)\n{\n\tif (pw != NULL && client_addr != NULL) {\n\t\thandle_log_exit();\n\t\tlogit(\"session closed for local user %s from [%s]\",\n\t\t    pw->pw_name, client_addr);\n\t}\n\t_exit(i);\n}"
        }
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"opensslver: header %lx library %lx != %d \\n\"",
            "hver",
            "lver",
            "result"
          ],
          "line": 50
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <stdlib.h>\n#include <stdio.h>\n\nvoid\nfail(long hver, long lver, int result)\n{\n\tfprintf(stderr, \"opensslver: header %lx library %lx != %d \\n\", hver, lver, result);\n\texit(1);\n}"
  }
]