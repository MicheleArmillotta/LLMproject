[
  {
    "function_name": "sshpkt_add_padding",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
    "lines": "2677-2682",
    "snippet": "int\nsshpkt_add_padding(struct ssh *ssh, u_char pad)\n{\n\tssh->state->extra_pad = pad;\n\treturn 0;\n}",
    "includes": [
      "#include \"sshbuf.h\"",
      "#include \"ssherr.h\"",
      "#include \"packet.h\"",
      "#include \"ssh.h\"",
      "#include \"channels.h\"",
      "#include \"misc.h\"",
      "#include \"canohost.h\"",
      "#include \"log.h\"",
      "#include \"mac.h\"",
      "#include \"digest.h\"",
      "#include \"kex.h\"",
      "#include \"sshkey.h\"",
      "#include \"cipher.h\"",
      "#include \"ssh2.h\"",
      "#include \"compat.h\"",
      "#include \"crc32.h\"",
      "#include \"xmalloc.h\"",
      "#include <zlib.h>",
      "#  include <openssl/ec.h>",
      "# include <openssl/evp.h>",
      "# include <openssl/bn.h>",
      "#include <time.h>",
      "#include <signal.h>",
      "#include <limits.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <stdarg.h>",
      "#include <netdb.h>",
      "#include <errno.h>",
      "#include <arpa/inet.h>",
      "#include <netinet/ip.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include \"openbsd-compat/sys-queue.h\"",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshpkt_add_padding(struct ssh *ssh, u_char pad)\n{\n\tssh->state->extra_pad = pad;\n\treturn 0;\n}"
  },
  {
    "function_name": "sshpkt_disconnect",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
    "lines": "2656-2674",
    "snippet": "int\nsshpkt_disconnect(struct ssh *ssh, const char *fmt,...)\n{\n\tchar buf[1024];\n\tva_list args;\n\tint r;\n\n\tva_start(args, fmt);\n\tvsnprintf(buf, sizeof(buf), fmt, args);\n\tva_end(args);\n\n\tif ((r = sshpkt_start(ssh, SSH2_MSG_DISCONNECT)) != 0 ||\n\t    (r = sshpkt_put_u32(ssh, SSH2_DISCONNECT_PROTOCOL_ERROR)) != 0 ||\n\t    (r = sshpkt_put_cstring(ssh, buf)) != 0 ||\n\t    (r = sshpkt_put_cstring(ssh, \"\")) != 0 ||\n\t    (r = sshpkt_send(ssh)) != 0)\n\t\treturn r;\n\treturn 0;\n}",
    "includes": [
      "#include \"sshbuf.h\"",
      "#include \"ssherr.h\"",
      "#include \"packet.h\"",
      "#include \"ssh.h\"",
      "#include \"channels.h\"",
      "#include \"misc.h\"",
      "#include \"canohost.h\"",
      "#include \"log.h\"",
      "#include \"mac.h\"",
      "#include \"digest.h\"",
      "#include \"kex.h\"",
      "#include \"sshkey.h\"",
      "#include \"cipher.h\"",
      "#include \"ssh2.h\"",
      "#include \"compat.h\"",
      "#include \"crc32.h\"",
      "#include \"xmalloc.h\"",
      "#include <zlib.h>",
      "#  include <openssl/ec.h>",
      "# include <openssl/evp.h>",
      "# include <openssl/bn.h>",
      "#include <time.h>",
      "#include <signal.h>",
      "#include <limits.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <stdarg.h>",
      "#include <netdb.h>",
      "#include <errno.h>",
      "#include <arpa/inet.h>",
      "#include <netinet/ip.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include \"openbsd-compat/sys-queue.h\"",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "sshpkt_send",
          "args": [
            "ssh"
          ],
          "line": 2671
        },
        "resolved": true,
        "details": {
          "function_name": "sshpkt_send",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
          "lines": "2648-2654",
          "snippet": "int\nsshpkt_send(struct ssh *ssh)\n{\n\tif (ssh->state && ssh->state->mux)\n\t\treturn ssh_packet_send_mux(ssh);\n\treturn ssh_packet_send2(ssh);\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include \"packet.h\"",
            "#include \"ssh.h\"",
            "#include \"channels.h\"",
            "#include \"misc.h\"",
            "#include \"canohost.h\"",
            "#include \"log.h\"",
            "#include \"mac.h\"",
            "#include \"digest.h\"",
            "#include \"kex.h\"",
            "#include \"sshkey.h\"",
            "#include \"cipher.h\"",
            "#include \"ssh2.h\"",
            "#include \"compat.h\"",
            "#include \"crc32.h\"",
            "#include \"xmalloc.h\"",
            "#include <zlib.h>",
            "#  include <openssl/ec.h>",
            "# include <openssl/evp.h>",
            "# include <openssl/bn.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <limits.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <netdb.h>",
            "#include <errno.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include \"openbsd-compat/sys-queue.h\"",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshpkt_send(struct ssh *ssh)\n{\n\tif (ssh->state && ssh->state->mux)\n\t\treturn ssh_packet_send_mux(ssh);\n\treturn ssh_packet_send2(ssh);\n}"
        }
      },
      {
        "call_info": {
          "callee": "sshpkt_put_cstring",
          "args": [
            "ssh",
            "\"\""
          ],
          "line": 2670
        },
        "resolved": true,
        "details": {
          "function_name": "sshpkt_put_cstring",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
          "lines": "2459-2463",
          "snippet": "int\nsshpkt_put_cstring(struct ssh *ssh, const void *v)\n{\n\treturn sshbuf_put_cstring(ssh->state->outgoing_packet, v);\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include \"packet.h\"",
            "#include \"ssh.h\"",
            "#include \"channels.h\"",
            "#include \"misc.h\"",
            "#include \"canohost.h\"",
            "#include \"log.h\"",
            "#include \"mac.h\"",
            "#include \"digest.h\"",
            "#include \"kex.h\"",
            "#include \"sshkey.h\"",
            "#include \"cipher.h\"",
            "#include \"ssh2.h\"",
            "#include \"compat.h\"",
            "#include \"crc32.h\"",
            "#include \"xmalloc.h\"",
            "#include <zlib.h>",
            "#  include <openssl/ec.h>",
            "# include <openssl/evp.h>",
            "# include <openssl/bn.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <limits.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <netdb.h>",
            "#include <errno.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include \"openbsd-compat/sys-queue.h\"",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshpkt_put_cstring(struct ssh *ssh, const void *v)\n{\n\treturn sshbuf_put_cstring(ssh->state->outgoing_packet, v);\n}"
        }
      },
      {
        "call_info": {
          "callee": "sshpkt_put_u32",
          "args": [
            "ssh",
            "SSH2_DISCONNECT_PROTOCOL_ERROR"
          ],
          "line": 2668
        },
        "resolved": true,
        "details": {
          "function_name": "sshpkt_put_u32",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
          "lines": "2441-2445",
          "snippet": "int\nsshpkt_put_u32(struct ssh *ssh, u_int32_t val)\n{\n\treturn sshbuf_put_u32(ssh->state->outgoing_packet, val);\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include \"packet.h\"",
            "#include \"ssh.h\"",
            "#include \"channels.h\"",
            "#include \"misc.h\"",
            "#include \"canohost.h\"",
            "#include \"log.h\"",
            "#include \"mac.h\"",
            "#include \"digest.h\"",
            "#include \"kex.h\"",
            "#include \"sshkey.h\"",
            "#include \"cipher.h\"",
            "#include \"ssh2.h\"",
            "#include \"compat.h\"",
            "#include \"crc32.h\"",
            "#include \"xmalloc.h\"",
            "#include <zlib.h>",
            "#  include <openssl/ec.h>",
            "# include <openssl/evp.h>",
            "# include <openssl/bn.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <limits.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <netdb.h>",
            "#include <errno.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include \"openbsd-compat/sys-queue.h\"",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshpkt_put_u32(struct ssh *ssh, u_int32_t val)\n{\n\treturn sshbuf_put_u32(ssh->state->outgoing_packet, val);\n}"
        }
      },
      {
        "call_info": {
          "callee": "sshpkt_start",
          "args": [
            "ssh",
            "SSH2_MSG_DISCONNECT"
          ],
          "line": 2667
        },
        "resolved": true,
        "details": {
          "function_name": "sshpkt_start",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
          "lines": "2573-2583",
          "snippet": "int\nsshpkt_start(struct ssh *ssh, u_char type)\n{\n\tu_char buf[6]; /* u32 packet length, u8 pad len, u8 type */\n\n\tDBG(debug(\"packet_start[%d]\", type));\n\tmemset(buf, 0, sizeof(buf));\n\tbuf[sizeof(buf) - 1] = type;\n\tsshbuf_reset(ssh->state->outgoing_packet);\n\treturn sshbuf_put(ssh->state->outgoing_packet, buf, sizeof(buf));\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include \"packet.h\"",
            "#include \"ssh.h\"",
            "#include \"channels.h\"",
            "#include \"misc.h\"",
            "#include \"canohost.h\"",
            "#include \"log.h\"",
            "#include \"mac.h\"",
            "#include \"digest.h\"",
            "#include \"kex.h\"",
            "#include \"sshkey.h\"",
            "#include \"cipher.h\"",
            "#include \"ssh2.h\"",
            "#include \"compat.h\"",
            "#include \"crc32.h\"",
            "#include \"xmalloc.h\"",
            "#include <zlib.h>",
            "#  include <openssl/ec.h>",
            "# include <openssl/evp.h>",
            "# include <openssl/bn.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <limits.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <netdb.h>",
            "#include <errno.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include \"openbsd-compat/sys-queue.h\"",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshpkt_start(struct ssh *ssh, u_char type)\n{\n\tu_char buf[6]; /* u32 packet length, u8 pad len, u8 type */\n\n\tDBG(debug(\"packet_start[%d]\", type));\n\tmemset(buf, 0, sizeof(buf));\n\tbuf[sizeof(buf) - 1] = type;\n\tsshbuf_reset(ssh->state->outgoing_packet);\n\treturn sshbuf_put(ssh->state->outgoing_packet, buf, sizeof(buf));\n}"
        }
      },
      {
        "call_info": {
          "callee": "va_end",
          "args": [
            "args"
          ],
          "line": 2665
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "vsnprintf",
          "args": [
            "buf",
            "sizeof(buf)",
            "fmt",
            "args"
          ],
          "line": 2664
        },
        "resolved": true,
        "details": {
          "function_name": "vsnprintf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/openbsd-compat/bsd-snprintf.c",
          "lines": "861-865",
          "snippet": "int\nvsnprintf (char *str, size_t count, const char *fmt, va_list args)\n{\n\treturn dopr(str, count, fmt, args);\n}",
          "includes": [
            "#include <errno.h>",
            "#include <limits.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdarg.h>",
            "#include <ctype.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <errno.h>\n#include <limits.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdarg.h>\n#include <ctype.h>\n#include \"includes.h\"\n\nint\nvsnprintf (char *str, size_t count, const char *fmt, va_list args)\n{\n\treturn dopr(str, count, fmt, args);\n}"
        }
      },
      {
        "call_info": {
          "callee": "va_start",
          "args": [
            "args",
            "fmt"
          ],
          "line": 2663
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshpkt_disconnect(struct ssh *ssh, const char *fmt,...)\n{\n\tchar buf[1024];\n\tva_list args;\n\tint r;\n\n\tva_start(args, fmt);\n\tvsnprintf(buf, sizeof(buf), fmt, args);\n\tva_end(args);\n\n\tif ((r = sshpkt_start(ssh, SSH2_MSG_DISCONNECT)) != 0 ||\n\t    (r = sshpkt_put_u32(ssh, SSH2_DISCONNECT_PROTOCOL_ERROR)) != 0 ||\n\t    (r = sshpkt_put_cstring(ssh, buf)) != 0 ||\n\t    (r = sshpkt_put_cstring(ssh, \"\")) != 0 ||\n\t    (r = sshpkt_send(ssh)) != 0)\n\t\treturn r;\n\treturn 0;\n}"
  },
  {
    "function_name": "sshpkt_send",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
    "lines": "2648-2654",
    "snippet": "int\nsshpkt_send(struct ssh *ssh)\n{\n\tif (ssh->state && ssh->state->mux)\n\t\treturn ssh_packet_send_mux(ssh);\n\treturn ssh_packet_send2(ssh);\n}",
    "includes": [
      "#include \"sshbuf.h\"",
      "#include \"ssherr.h\"",
      "#include \"packet.h\"",
      "#include \"ssh.h\"",
      "#include \"channels.h\"",
      "#include \"misc.h\"",
      "#include \"canohost.h\"",
      "#include \"log.h\"",
      "#include \"mac.h\"",
      "#include \"digest.h\"",
      "#include \"kex.h\"",
      "#include \"sshkey.h\"",
      "#include \"cipher.h\"",
      "#include \"ssh2.h\"",
      "#include \"compat.h\"",
      "#include \"crc32.h\"",
      "#include \"xmalloc.h\"",
      "#include <zlib.h>",
      "#  include <openssl/ec.h>",
      "# include <openssl/evp.h>",
      "# include <openssl/bn.h>",
      "#include <time.h>",
      "#include <signal.h>",
      "#include <limits.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <stdarg.h>",
      "#include <netdb.h>",
      "#include <errno.h>",
      "#include <arpa/inet.h>",
      "#include <netinet/ip.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include \"openbsd-compat/sys-queue.h\"",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "ssh_packet_send2",
          "args": [
            "ssh"
          ],
          "line": 2653
        },
        "resolved": true,
        "details": {
          "function_name": "ssh_packet_send2",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
          "lines": "1196-1273",
          "snippet": "int\nssh_packet_send2(struct ssh *ssh)\n{\n\tstruct session_state *state = ssh->state;\n\tstruct packet *p;\n\tu_char type;\n\tint r, need_rekey;\n\n\tif (sshbuf_len(state->outgoing_packet) < 6)\n\t\treturn SSH_ERR_INTERNAL_ERROR;\n\ttype = sshbuf_ptr(state->outgoing_packet)[5];\n\tneed_rekey = !ssh_packet_type_is_kex(type) &&\n\t    ssh_packet_need_rekeying(ssh, sshbuf_len(state->outgoing_packet));\n\n\t/*\n\t * During rekeying we can only send key exchange messages.\n\t * Queue everything else.\n\t */\n\tif ((need_rekey || state->rekeying) && !ssh_packet_type_is_kex(type)) {\n\t\tif (need_rekey)\n\t\t\tdebug3(\"%s: rekex triggered\", __func__);\n\t\tdebug(\"enqueue packet: %u\", type);\n\t\tp = calloc(1, sizeof(*p));\n\t\tif (p == NULL)\n\t\t\treturn SSH_ERR_ALLOC_FAIL;\n\t\tp->type = type;\n\t\tp->payload = state->outgoing_packet;\n\t\tTAILQ_INSERT_TAIL(&state->outgoing, p, next);\n\t\tstate->outgoing_packet = sshbuf_new();\n\t\tif (state->outgoing_packet == NULL)\n\t\t\treturn SSH_ERR_ALLOC_FAIL;\n\t\tif (need_rekey) {\n\t\t\t/*\n\t\t\t * This packet triggered a rekey, so send the\n\t\t\t * KEXINIT now.\n\t\t\t * NB. reenters this function via kex_start_rekex().\n\t\t\t */\n\t\t\treturn kex_start_rekex(ssh);\n\t\t}\n\t\treturn 0;\n\t}\n\n\t/* rekeying starts with sending KEXINIT */\n\tif (type == SSH2_MSG_KEXINIT)\n\t\tstate->rekeying = 1;\n\n\tif ((r = ssh_packet_send2_wrapped(ssh)) != 0)\n\t\treturn r;\n\n\t/* after a NEWKEYS message we can send the complete queue */\n\tif (type == SSH2_MSG_NEWKEYS) {\n\t\tstate->rekeying = 0;\n\t\tstate->rekey_time = monotime();\n\t\twhile ((p = TAILQ_FIRST(&state->outgoing))) {\n\t\t\ttype = p->type;\n\t\t\t/*\n\t\t\t * If this packet triggers a rekex, then skip the\n\t\t\t * remaining packets in the queue for now.\n\t\t\t * NB. re-enters this function via kex_start_rekex.\n\t\t\t */\n\t\t\tif (ssh_packet_need_rekeying(ssh,\n\t\t\t    sshbuf_len(p->payload))) {\n\t\t\t\tdebug3(\"%s: queued packet triggered rekex\",\n\t\t\t\t    __func__);\n\t\t\t\treturn kex_start_rekex(ssh);\n\t\t\t}\n\t\t\tdebug(\"dequeue packet: %u\", type);\n\t\t\tsshbuf_free(state->outgoing_packet);\n\t\t\tstate->outgoing_packet = p->payload;\n\t\t\tTAILQ_REMOVE(&state->outgoing, p, next);\n\t\t\tmemset(p, 0, sizeof(*p));\n\t\t\tfree(p);\n\t\t\tif ((r = ssh_packet_send2_wrapped(ssh)) != 0)\n\t\t\t\treturn r;\n\t\t}\n\t}\n\treturn 0;\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include \"packet.h\"",
            "#include \"ssh.h\"",
            "#include \"channels.h\"",
            "#include \"misc.h\"",
            "#include \"canohost.h\"",
            "#include \"log.h\"",
            "#include \"mac.h\"",
            "#include \"digest.h\"",
            "#include \"kex.h\"",
            "#include \"sshkey.h\"",
            "#include \"cipher.h\"",
            "#include \"ssh2.h\"",
            "#include \"compat.h\"",
            "#include \"crc32.h\"",
            "#include \"xmalloc.h\"",
            "#include <zlib.h>",
            "#  include <openssl/ec.h>",
            "# include <openssl/evp.h>",
            "# include <openssl/bn.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <limits.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <netdb.h>",
            "#include <errno.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include \"openbsd-compat/sys-queue.h\"",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nssh_packet_send2(struct ssh *ssh)\n{\n\tstruct session_state *state = ssh->state;\n\tstruct packet *p;\n\tu_char type;\n\tint r, need_rekey;\n\n\tif (sshbuf_len(state->outgoing_packet) < 6)\n\t\treturn SSH_ERR_INTERNAL_ERROR;\n\ttype = sshbuf_ptr(state->outgoing_packet)[5];\n\tneed_rekey = !ssh_packet_type_is_kex(type) &&\n\t    ssh_packet_need_rekeying(ssh, sshbuf_len(state->outgoing_packet));\n\n\t/*\n\t * During rekeying we can only send key exchange messages.\n\t * Queue everything else.\n\t */\n\tif ((need_rekey || state->rekeying) && !ssh_packet_type_is_kex(type)) {\n\t\tif (need_rekey)\n\t\t\tdebug3(\"%s: rekex triggered\", __func__);\n\t\tdebug(\"enqueue packet: %u\", type);\n\t\tp = calloc(1, sizeof(*p));\n\t\tif (p == NULL)\n\t\t\treturn SSH_ERR_ALLOC_FAIL;\n\t\tp->type = type;\n\t\tp->payload = state->outgoing_packet;\n\t\tTAILQ_INSERT_TAIL(&state->outgoing, p, next);\n\t\tstate->outgoing_packet = sshbuf_new();\n\t\tif (state->outgoing_packet == NULL)\n\t\t\treturn SSH_ERR_ALLOC_FAIL;\n\t\tif (need_rekey) {\n\t\t\t/*\n\t\t\t * This packet triggered a rekey, so send the\n\t\t\t * KEXINIT now.\n\t\t\t * NB. reenters this function via kex_start_rekex().\n\t\t\t */\n\t\t\treturn kex_start_rekex(ssh);\n\t\t}\n\t\treturn 0;\n\t}\n\n\t/* rekeying starts with sending KEXINIT */\n\tif (type == SSH2_MSG_KEXINIT)\n\t\tstate->rekeying = 1;\n\n\tif ((r = ssh_packet_send2_wrapped(ssh)) != 0)\n\t\treturn r;\n\n\t/* after a NEWKEYS message we can send the complete queue */\n\tif (type == SSH2_MSG_NEWKEYS) {\n\t\tstate->rekeying = 0;\n\t\tstate->rekey_time = monotime();\n\t\twhile ((p = TAILQ_FIRST(&state->outgoing))) {\n\t\t\ttype = p->type;\n\t\t\t/*\n\t\t\t * If this packet triggers a rekex, then skip the\n\t\t\t * remaining packets in the queue for now.\n\t\t\t * NB. re-enters this function via kex_start_rekex.\n\t\t\t */\n\t\t\tif (ssh_packet_need_rekeying(ssh,\n\t\t\t    sshbuf_len(p->payload))) {\n\t\t\t\tdebug3(\"%s: queued packet triggered rekex\",\n\t\t\t\t    __func__);\n\t\t\t\treturn kex_start_rekex(ssh);\n\t\t\t}\n\t\t\tdebug(\"dequeue packet: %u\", type);\n\t\t\tsshbuf_free(state->outgoing_packet);\n\t\t\tstate->outgoing_packet = p->payload;\n\t\t\tTAILQ_REMOVE(&state->outgoing, p, next);\n\t\t\tmemset(p, 0, sizeof(*p));\n\t\t\tfree(p);\n\t\t\tif ((r = ssh_packet_send2_wrapped(ssh)) != 0)\n\t\t\t\treturn r;\n\t\t}\n\t}\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "ssh_packet_send_mux",
          "args": [
            "ssh"
          ],
          "line": 2652
        },
        "resolved": true,
        "details": {
          "function_name": "ssh_packet_send_mux",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
          "lines": "2585-2613",
          "snippet": "static int\nssh_packet_send_mux(struct ssh *ssh)\n{\n\tstruct session_state *state = ssh->state;\n\tu_char type, *cp;\n\tsize_t len;\n\tint r;\n\n\tif (ssh->kex)\n\t\treturn SSH_ERR_INTERNAL_ERROR;\n\tlen = sshbuf_len(state->outgoing_packet);\n\tif (len < 6)\n\t\treturn SSH_ERR_INTERNAL_ERROR;\n\tcp = sshbuf_mutable_ptr(state->outgoing_packet);\n\ttype = cp[5];\n\tif (ssh_packet_log_type(type))\n\t\tdebug3(\"%s: type %u\", __func__, type);\n\t/* drop everything, but the connection protocol */\n\tif (type >= SSH2_MSG_CONNECTION_MIN &&\n\t    type <= SSH2_MSG_CONNECTION_MAX) {\n\t\tPOKE_U32(cp, len - 4);\n\t\tif ((r = sshbuf_putb(state->output,\n\t\t    state->outgoing_packet)) != 0)\n\t\t\treturn r;\n\t\t/* sshbuf_dump(state->output, stderr); */\n\t}\n\tsshbuf_reset(state->outgoing_packet);\n\treturn 0;\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include \"packet.h\"",
            "#include \"ssh.h\"",
            "#include \"channels.h\"",
            "#include \"misc.h\"",
            "#include \"canohost.h\"",
            "#include \"log.h\"",
            "#include \"mac.h\"",
            "#include \"digest.h\"",
            "#include \"kex.h\"",
            "#include \"sshkey.h\"",
            "#include \"cipher.h\"",
            "#include \"ssh2.h\"",
            "#include \"compat.h\"",
            "#include \"crc32.h\"",
            "#include \"xmalloc.h\"",
            "#include <zlib.h>",
            "#  include <openssl/ec.h>",
            "# include <openssl/evp.h>",
            "# include <openssl/bn.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <limits.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <netdb.h>",
            "#include <errno.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include \"openbsd-compat/sys-queue.h\"",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nstatic int\nssh_packet_send_mux(struct ssh *ssh)\n{\n\tstruct session_state *state = ssh->state;\n\tu_char type, *cp;\n\tsize_t len;\n\tint r;\n\n\tif (ssh->kex)\n\t\treturn SSH_ERR_INTERNAL_ERROR;\n\tlen = sshbuf_len(state->outgoing_packet);\n\tif (len < 6)\n\t\treturn SSH_ERR_INTERNAL_ERROR;\n\tcp = sshbuf_mutable_ptr(state->outgoing_packet);\n\ttype = cp[5];\n\tif (ssh_packet_log_type(type))\n\t\tdebug3(\"%s: type %u\", __func__, type);\n\t/* drop everything, but the connection protocol */\n\tif (type >= SSH2_MSG_CONNECTION_MIN &&\n\t    type <= SSH2_MSG_CONNECTION_MAX) {\n\t\tPOKE_U32(cp, len - 4);\n\t\tif ((r = sshbuf_putb(state->output,\n\t\t    state->outgoing_packet)) != 0)\n\t\t\treturn r;\n\t\t/* sshbuf_dump(state->output, stderr); */\n\t}\n\tsshbuf_reset(state->outgoing_packet);\n\treturn 0;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshpkt_send(struct ssh *ssh)\n{\n\tif (ssh->state && ssh->state->mux)\n\t\treturn ssh_packet_send_mux(ssh);\n\treturn ssh_packet_send2(ssh);\n}"
  },
  {
    "function_name": "sshpkt_msg_ignore",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
    "lines": "2626-2644",
    "snippet": "int\nsshpkt_msg_ignore(struct ssh *ssh, u_int nbytes)\n{\n\tu_int32_t rnd = 0;\n\tint r;\n\tu_int i;\n\n\tif ((r = sshpkt_start(ssh, SSH2_MSG_IGNORE)) != 0 ||\n\t    (r = sshpkt_put_u32(ssh, nbytes)) != 0)\n\t\treturn r;\n\tfor (i = 0; i < nbytes; i++) {\n\t\tif (i % 4 == 0)\n\t\t\trnd = arc4random();\n\t\tif ((r = sshpkt_put_u8(ssh, (u_char)rnd & 0xff)) != 0)\n\t\t\treturn r;\n\t\trnd >>= 8;\n\t}\n\treturn 0;\n}",
    "includes": [
      "#include \"sshbuf.h\"",
      "#include \"ssherr.h\"",
      "#include \"packet.h\"",
      "#include \"ssh.h\"",
      "#include \"channels.h\"",
      "#include \"misc.h\"",
      "#include \"canohost.h\"",
      "#include \"log.h\"",
      "#include \"mac.h\"",
      "#include \"digest.h\"",
      "#include \"kex.h\"",
      "#include \"sshkey.h\"",
      "#include \"cipher.h\"",
      "#include \"ssh2.h\"",
      "#include \"compat.h\"",
      "#include \"crc32.h\"",
      "#include \"xmalloc.h\"",
      "#include <zlib.h>",
      "#  include <openssl/ec.h>",
      "# include <openssl/evp.h>",
      "# include <openssl/bn.h>",
      "#include <time.h>",
      "#include <signal.h>",
      "#include <limits.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <stdarg.h>",
      "#include <netdb.h>",
      "#include <errno.h>",
      "#include <arpa/inet.h>",
      "#include <netinet/ip.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include \"openbsd-compat/sys-queue.h\"",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "sshpkt_put_u8",
          "args": [
            "ssh",
            "(u_char)rnd & 0xff"
          ],
          "line": 2639
        },
        "resolved": true,
        "details": {
          "function_name": "sshpkt_put_u8",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
          "lines": "2435-2439",
          "snippet": "int\nsshpkt_put_u8(struct ssh *ssh, u_char val)\n{\n\treturn sshbuf_put_u8(ssh->state->outgoing_packet, val);\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include \"packet.h\"",
            "#include \"ssh.h\"",
            "#include \"channels.h\"",
            "#include \"misc.h\"",
            "#include \"canohost.h\"",
            "#include \"log.h\"",
            "#include \"mac.h\"",
            "#include \"digest.h\"",
            "#include \"kex.h\"",
            "#include \"sshkey.h\"",
            "#include \"cipher.h\"",
            "#include \"ssh2.h\"",
            "#include \"compat.h\"",
            "#include \"crc32.h\"",
            "#include \"xmalloc.h\"",
            "#include <zlib.h>",
            "#  include <openssl/ec.h>",
            "# include <openssl/evp.h>",
            "# include <openssl/bn.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <limits.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <netdb.h>",
            "#include <errno.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include \"openbsd-compat/sys-queue.h\"",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshpkt_put_u8(struct ssh *ssh, u_char val)\n{\n\treturn sshbuf_put_u8(ssh->state->outgoing_packet, val);\n}"
        }
      },
      {
        "call_info": {
          "callee": "arc4random",
          "args": [],
          "line": 2638
        },
        "resolved": true,
        "details": {
          "function_name": "arc4random",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/openbsd-compat/arc4random.c",
          "lines": "235-244",
          "snippet": "u_int32_t\narc4random(void)\n{\n\tu_int32_t val;\n\n\t_ARC4_LOCK();\n\t_rs_random_u32(&val);\n\t_ARC4_UNLOCK();\n\treturn val;\n}",
          "includes": [
            "#include <machine/pctr.h>",
            "#include <stdio.h>",
            "#include \"chacha_private.h\"",
            "#include \"log.h\"",
            "#include <openssl/err.h>",
            "#include <openssl/rand.h>",
            "# include <sys/random.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <fcntl.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <machine/pctr.h>\n#include <stdio.h>\n#include \"chacha_private.h\"\n#include \"log.h\"\n#include <openssl/err.h>\n#include <openssl/rand.h>\n# include <sys/random.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <fcntl.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nu_int32_t\narc4random(void)\n{\n\tu_int32_t val;\n\n\t_ARC4_LOCK();\n\t_rs_random_u32(&val);\n\t_ARC4_UNLOCK();\n\treturn val;\n}"
        }
      },
      {
        "call_info": {
          "callee": "sshpkt_put_u32",
          "args": [
            "ssh",
            "nbytes"
          ],
          "line": 2634
        },
        "resolved": true,
        "details": {
          "function_name": "sshpkt_put_u32",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
          "lines": "2441-2445",
          "snippet": "int\nsshpkt_put_u32(struct ssh *ssh, u_int32_t val)\n{\n\treturn sshbuf_put_u32(ssh->state->outgoing_packet, val);\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include \"packet.h\"",
            "#include \"ssh.h\"",
            "#include \"channels.h\"",
            "#include \"misc.h\"",
            "#include \"canohost.h\"",
            "#include \"log.h\"",
            "#include \"mac.h\"",
            "#include \"digest.h\"",
            "#include \"kex.h\"",
            "#include \"sshkey.h\"",
            "#include \"cipher.h\"",
            "#include \"ssh2.h\"",
            "#include \"compat.h\"",
            "#include \"crc32.h\"",
            "#include \"xmalloc.h\"",
            "#include <zlib.h>",
            "#  include <openssl/ec.h>",
            "# include <openssl/evp.h>",
            "# include <openssl/bn.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <limits.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <netdb.h>",
            "#include <errno.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include \"openbsd-compat/sys-queue.h\"",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshpkt_put_u32(struct ssh *ssh, u_int32_t val)\n{\n\treturn sshbuf_put_u32(ssh->state->outgoing_packet, val);\n}"
        }
      },
      {
        "call_info": {
          "callee": "sshpkt_start",
          "args": [
            "ssh",
            "SSH2_MSG_IGNORE"
          ],
          "line": 2633
        },
        "resolved": true,
        "details": {
          "function_name": "sshpkt_start",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
          "lines": "2573-2583",
          "snippet": "int\nsshpkt_start(struct ssh *ssh, u_char type)\n{\n\tu_char buf[6]; /* u32 packet length, u8 pad len, u8 type */\n\n\tDBG(debug(\"packet_start[%d]\", type));\n\tmemset(buf, 0, sizeof(buf));\n\tbuf[sizeof(buf) - 1] = type;\n\tsshbuf_reset(ssh->state->outgoing_packet);\n\treturn sshbuf_put(ssh->state->outgoing_packet, buf, sizeof(buf));\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include \"packet.h\"",
            "#include \"ssh.h\"",
            "#include \"channels.h\"",
            "#include \"misc.h\"",
            "#include \"canohost.h\"",
            "#include \"log.h\"",
            "#include \"mac.h\"",
            "#include \"digest.h\"",
            "#include \"kex.h\"",
            "#include \"sshkey.h\"",
            "#include \"cipher.h\"",
            "#include \"ssh2.h\"",
            "#include \"compat.h\"",
            "#include \"crc32.h\"",
            "#include \"xmalloc.h\"",
            "#include <zlib.h>",
            "#  include <openssl/ec.h>",
            "# include <openssl/evp.h>",
            "# include <openssl/bn.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <limits.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <netdb.h>",
            "#include <errno.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include \"openbsd-compat/sys-queue.h\"",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshpkt_start(struct ssh *ssh, u_char type)\n{\n\tu_char buf[6]; /* u32 packet length, u8 pad len, u8 type */\n\n\tDBG(debug(\"packet_start[%d]\", type));\n\tmemset(buf, 0, sizeof(buf));\n\tbuf[sizeof(buf) - 1] = type;\n\tsshbuf_reset(ssh->state->outgoing_packet);\n\treturn sshbuf_put(ssh->state->outgoing_packet, buf, sizeof(buf));\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshpkt_msg_ignore(struct ssh *ssh, u_int nbytes)\n{\n\tu_int32_t rnd = 0;\n\tint r;\n\tu_int i;\n\n\tif ((r = sshpkt_start(ssh, SSH2_MSG_IGNORE)) != 0 ||\n\t    (r = sshpkt_put_u32(ssh, nbytes)) != 0)\n\t\treturn r;\n\tfor (i = 0; i < nbytes; i++) {\n\t\tif (i % 4 == 0)\n\t\t\trnd = arc4random();\n\t\tif ((r = sshpkt_put_u8(ssh, (u_char)rnd & 0xff)) != 0)\n\t\t\treturn r;\n\t\trnd >>= 8;\n\t}\n\treturn 0;\n}"
  },
  {
    "function_name": "ssh_packet_send_mux",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
    "lines": "2585-2613",
    "snippet": "static int\nssh_packet_send_mux(struct ssh *ssh)\n{\n\tstruct session_state *state = ssh->state;\n\tu_char type, *cp;\n\tsize_t len;\n\tint r;\n\n\tif (ssh->kex)\n\t\treturn SSH_ERR_INTERNAL_ERROR;\n\tlen = sshbuf_len(state->outgoing_packet);\n\tif (len < 6)\n\t\treturn SSH_ERR_INTERNAL_ERROR;\n\tcp = sshbuf_mutable_ptr(state->outgoing_packet);\n\ttype = cp[5];\n\tif (ssh_packet_log_type(type))\n\t\tdebug3(\"%s: type %u\", __func__, type);\n\t/* drop everything, but the connection protocol */\n\tif (type >= SSH2_MSG_CONNECTION_MIN &&\n\t    type <= SSH2_MSG_CONNECTION_MAX) {\n\t\tPOKE_U32(cp, len - 4);\n\t\tif ((r = sshbuf_putb(state->output,\n\t\t    state->outgoing_packet)) != 0)\n\t\t\treturn r;\n\t\t/* sshbuf_dump(state->output, stderr); */\n\t}\n\tsshbuf_reset(state->outgoing_packet);\n\treturn 0;\n}",
    "includes": [
      "#include \"sshbuf.h\"",
      "#include \"ssherr.h\"",
      "#include \"packet.h\"",
      "#include \"ssh.h\"",
      "#include \"channels.h\"",
      "#include \"misc.h\"",
      "#include \"canohost.h\"",
      "#include \"log.h\"",
      "#include \"mac.h\"",
      "#include \"digest.h\"",
      "#include \"kex.h\"",
      "#include \"sshkey.h\"",
      "#include \"cipher.h\"",
      "#include \"ssh2.h\"",
      "#include \"compat.h\"",
      "#include \"crc32.h\"",
      "#include \"xmalloc.h\"",
      "#include <zlib.h>",
      "#  include <openssl/ec.h>",
      "# include <openssl/evp.h>",
      "# include <openssl/bn.h>",
      "#include <time.h>",
      "#include <signal.h>",
      "#include <limits.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <stdarg.h>",
      "#include <netdb.h>",
      "#include <errno.h>",
      "#include <arpa/inet.h>",
      "#include <netinet/ip.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include \"openbsd-compat/sys-queue.h\"",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "sshbuf_reset",
          "args": [
            "state->outgoing_packet"
          ],
          "line": 2611
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_reset",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf.c",
          "lines": "168-188",
          "snippet": "void\nsshbuf_reset(struct sshbuf *buf)\n{\n\tu_char *d;\n\n\tif (buf->readonly || buf->refcount > 1) {\n\t\t/* Nonsensical. Just make buffer appear empty */\n\t\tbuf->off = buf->size;\n\t\treturn;\n\t}\n\t(void) sshbuf_check_sanity(buf);\n\tbuf->off = buf->size = 0;\n\tif (buf->alloc != SSHBUF_SIZE_INIT) {\n\t\tif ((d = recallocarray(buf->d, buf->alloc, SSHBUF_SIZE_INIT,\n\t\t    1)) != NULL) {\n\t\t\tbuf->cd = buf->d = d;\n\t\t\tbuf->alloc = SSHBUF_SIZE_INIT;\n\t\t}\n\t}\n\texplicit_bzero(buf->d, SSHBUF_SIZE_INIT);\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <signal.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <signal.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\nsshbuf_reset(struct sshbuf *buf)\n{\n\tu_char *d;\n\n\tif (buf->readonly || buf->refcount > 1) {\n\t\t/* Nonsensical. Just make buffer appear empty */\n\t\tbuf->off = buf->size;\n\t\treturn;\n\t}\n\t(void) sshbuf_check_sanity(buf);\n\tbuf->off = buf->size = 0;\n\tif (buf->alloc != SSHBUF_SIZE_INIT) {\n\t\tif ((d = recallocarray(buf->d, buf->alloc, SSHBUF_SIZE_INIT,\n\t\t    1)) != NULL) {\n\t\t\tbuf->cd = buf->d = d;\n\t\t\tbuf->alloc = SSHBUF_SIZE_INIT;\n\t\t}\n\t}\n\texplicit_bzero(buf->d, SSHBUF_SIZE_INIT);\n}"
        }
      },
      {
        "call_info": {
          "callee": "sshbuf_putb",
          "args": [
            "state->output",
            "state->outgoing_packet"
          ],
          "line": 2606
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_putb",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf-getput-basic.c",
          "lines": "248-252",
          "snippet": "int\nsshbuf_putb(struct sshbuf *buf, const struct sshbuf *v)\n{\n\treturn sshbuf_put(buf, sshbuf_ptr(v), sshbuf_len(v));\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <stdarg.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <stdarg.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshbuf_putb(struct sshbuf *buf, const struct sshbuf *v)\n{\n\treturn sshbuf_put(buf, sshbuf_ptr(v), sshbuf_len(v));\n}"
        }
      },
      {
        "call_info": {
          "callee": "POKE_U32",
          "args": [
            "cp",
            "len - 4"
          ],
          "line": 2605
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug3",
          "args": [
            "\"%s: type %u\"",
            "__func__",
            "type"
          ],
          "line": 2601
        },
        "resolved": true,
        "details": {
          "function_name": "debug3",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/log.c",
          "lines": "242-250",
          "snippet": "void\ndebug3(const char *fmt,...)\n{\n\tva_list args;\n\n\tva_start(args, fmt);\n\tdo_log(SYSLOG_LEVEL_DEBUG3, fmt, args);\n\tva_end(args);\n}",
          "includes": [
            "#include \"log.h\"",
            "# include <vis.h>",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <syslog.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <fcntl.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n# include <vis.h>\n#include <errno.h>\n#include <unistd.h>\n#include <syslog.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <fcntl.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\ndebug3(const char *fmt,...)\n{\n\tva_list args;\n\n\tva_start(args, fmt);\n\tdo_log(SYSLOG_LEVEL_DEBUG3, fmt, args);\n\tva_end(args);\n}"
        }
      },
      {
        "call_info": {
          "callee": "ssh_packet_log_type",
          "args": [
            "type"
          ],
          "line": 2600
        },
        "resolved": true,
        "details": {
          "function_name": "ssh_packet_log_type",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
          "lines": "1010-1021",
          "snippet": "int\nssh_packet_log_type(u_char type)\n{\n\tswitch (type) {\n\tcase SSH2_MSG_CHANNEL_DATA:\n\tcase SSH2_MSG_CHANNEL_EXTENDED_DATA:\n\tcase SSH2_MSG_CHANNEL_WINDOW_ADJUST:\n\t\treturn 0;\n\tdefault:\n\t\treturn 1;\n\t}\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include \"packet.h\"",
            "#include \"ssh.h\"",
            "#include \"channels.h\"",
            "#include \"misc.h\"",
            "#include \"canohost.h\"",
            "#include \"log.h\"",
            "#include \"mac.h\"",
            "#include \"digest.h\"",
            "#include \"kex.h\"",
            "#include \"sshkey.h\"",
            "#include \"cipher.h\"",
            "#include \"ssh2.h\"",
            "#include \"compat.h\"",
            "#include \"crc32.h\"",
            "#include \"xmalloc.h\"",
            "#include <zlib.h>",
            "#  include <openssl/ec.h>",
            "# include <openssl/evp.h>",
            "# include <openssl/bn.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <limits.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <netdb.h>",
            "#include <errno.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include \"openbsd-compat/sys-queue.h\"",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nssh_packet_log_type(u_char type)\n{\n\tswitch (type) {\n\tcase SSH2_MSG_CHANNEL_DATA:\n\tcase SSH2_MSG_CHANNEL_EXTENDED_DATA:\n\tcase SSH2_MSG_CHANNEL_WINDOW_ADJUST:\n\t\treturn 0;\n\tdefault:\n\t\treturn 1;\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "sshbuf_mutable_ptr",
          "args": [
            "state->outgoing_packet"
          ],
          "line": 2598
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_mutable_ptr",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf.c",
          "lines": "276-282",
          "snippet": "u_char *\nsshbuf_mutable_ptr(const struct sshbuf *buf)\n{\n\tif (sshbuf_check_sanity(buf) != 0 || buf->readonly || buf->refcount > 1)\n\t\treturn NULL;\n\treturn buf->d + buf->off;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <signal.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <signal.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nu_char *\nsshbuf_mutable_ptr(const struct sshbuf *buf)\n{\n\tif (sshbuf_check_sanity(buf) != 0 || buf->readonly || buf->refcount > 1)\n\t\treturn NULL;\n\treturn buf->d + buf->off;\n}"
        }
      },
      {
        "call_info": {
          "callee": "sshbuf_len",
          "args": [
            "state->outgoing_packet"
          ],
          "line": 2595
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_len",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf.c",
          "lines": "252-258",
          "snippet": "size_t\nsshbuf_len(const struct sshbuf *buf)\n{\n\tif (sshbuf_check_sanity(buf) != 0)\n\t\treturn 0;\n\treturn buf->size - buf->off;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <signal.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <signal.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nsize_t\nsshbuf_len(const struct sshbuf *buf)\n{\n\tif (sshbuf_check_sanity(buf) != 0)\n\t\treturn 0;\n\treturn buf->size - buf->off;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nstatic int\nssh_packet_send_mux(struct ssh *ssh)\n{\n\tstruct session_state *state = ssh->state;\n\tu_char type, *cp;\n\tsize_t len;\n\tint r;\n\n\tif (ssh->kex)\n\t\treturn SSH_ERR_INTERNAL_ERROR;\n\tlen = sshbuf_len(state->outgoing_packet);\n\tif (len < 6)\n\t\treturn SSH_ERR_INTERNAL_ERROR;\n\tcp = sshbuf_mutable_ptr(state->outgoing_packet);\n\ttype = cp[5];\n\tif (ssh_packet_log_type(type))\n\t\tdebug3(\"%s: type %u\", __func__, type);\n\t/* drop everything, but the connection protocol */\n\tif (type >= SSH2_MSG_CONNECTION_MIN &&\n\t    type <= SSH2_MSG_CONNECTION_MAX) {\n\t\tPOKE_U32(cp, len - 4);\n\t\tif ((r = sshbuf_putb(state->output,\n\t\t    state->outgoing_packet)) != 0)\n\t\t\treturn r;\n\t\t/* sshbuf_dump(state->output, stderr); */\n\t}\n\tsshbuf_reset(state->outgoing_packet);\n\treturn 0;\n}"
  },
  {
    "function_name": "sshpkt_start",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
    "lines": "2573-2583",
    "snippet": "int\nsshpkt_start(struct ssh *ssh, u_char type)\n{\n\tu_char buf[6]; /* u32 packet length, u8 pad len, u8 type */\n\n\tDBG(debug(\"packet_start[%d]\", type));\n\tmemset(buf, 0, sizeof(buf));\n\tbuf[sizeof(buf) - 1] = type;\n\tsshbuf_reset(ssh->state->outgoing_packet);\n\treturn sshbuf_put(ssh->state->outgoing_packet, buf, sizeof(buf));\n}",
    "includes": [
      "#include \"sshbuf.h\"",
      "#include \"ssherr.h\"",
      "#include \"packet.h\"",
      "#include \"ssh.h\"",
      "#include \"channels.h\"",
      "#include \"misc.h\"",
      "#include \"canohost.h\"",
      "#include \"log.h\"",
      "#include \"mac.h\"",
      "#include \"digest.h\"",
      "#include \"kex.h\"",
      "#include \"sshkey.h\"",
      "#include \"cipher.h\"",
      "#include \"ssh2.h\"",
      "#include \"compat.h\"",
      "#include \"crc32.h\"",
      "#include \"xmalloc.h\"",
      "#include <zlib.h>",
      "#  include <openssl/ec.h>",
      "# include <openssl/evp.h>",
      "# include <openssl/bn.h>",
      "#include <time.h>",
      "#include <signal.h>",
      "#include <limits.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <stdarg.h>",
      "#include <netdb.h>",
      "#include <errno.h>",
      "#include <arpa/inet.h>",
      "#include <netinet/ip.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include \"openbsd-compat/sys-queue.h\"",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "sshbuf_put",
          "args": [
            "ssh->state->outgoing_packet",
            "buf",
            "sizeof(buf)"
          ],
          "line": 2582
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_putf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf-getput-basic.c",
          "lines": "254-264",
          "snippet": "int\nsshbuf_putf(struct sshbuf *buf, const char *fmt, ...)\n{\n\tva_list ap;\n\tint r;\n\n\tva_start(ap, fmt);\n\tr = sshbuf_putfv(buf, fmt, ap);\n\tva_end(ap);\n\treturn r;\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <stdarg.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <stdarg.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshbuf_putf(struct sshbuf *buf, const char *fmt, ...)\n{\n\tva_list ap;\n\tint r;\n\n\tva_start(ap, fmt);\n\tr = sshbuf_putfv(buf, fmt, ap);\n\tva_end(ap);\n\treturn r;\n}"
        }
      },
      {
        "call_info": {
          "callee": "sshbuf_reset",
          "args": [
            "ssh->state->outgoing_packet"
          ],
          "line": 2581
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_reset",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf.c",
          "lines": "168-188",
          "snippet": "void\nsshbuf_reset(struct sshbuf *buf)\n{\n\tu_char *d;\n\n\tif (buf->readonly || buf->refcount > 1) {\n\t\t/* Nonsensical. Just make buffer appear empty */\n\t\tbuf->off = buf->size;\n\t\treturn;\n\t}\n\t(void) sshbuf_check_sanity(buf);\n\tbuf->off = buf->size = 0;\n\tif (buf->alloc != SSHBUF_SIZE_INIT) {\n\t\tif ((d = recallocarray(buf->d, buf->alloc, SSHBUF_SIZE_INIT,\n\t\t    1)) != NULL) {\n\t\t\tbuf->cd = buf->d = d;\n\t\t\tbuf->alloc = SSHBUF_SIZE_INIT;\n\t\t}\n\t}\n\texplicit_bzero(buf->d, SSHBUF_SIZE_INIT);\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <signal.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <signal.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\nsshbuf_reset(struct sshbuf *buf)\n{\n\tu_char *d;\n\n\tif (buf->readonly || buf->refcount > 1) {\n\t\t/* Nonsensical. Just make buffer appear empty */\n\t\tbuf->off = buf->size;\n\t\treturn;\n\t}\n\t(void) sshbuf_check_sanity(buf);\n\tbuf->off = buf->size = 0;\n\tif (buf->alloc != SSHBUF_SIZE_INIT) {\n\t\tif ((d = recallocarray(buf->d, buf->alloc, SSHBUF_SIZE_INIT,\n\t\t    1)) != NULL) {\n\t\t\tbuf->cd = buf->d = d;\n\t\t\tbuf->alloc = SSHBUF_SIZE_INIT;\n\t\t}\n\t}\n\texplicit_bzero(buf->d, SSHBUF_SIZE_INIT);\n}"
        }
      },
      {
        "call_info": {
          "callee": "memset",
          "args": [
            "buf",
            "0",
            "sizeof(buf)"
          ],
          "line": 2579
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "debug(\"packet_start[%d]\", type)"
          ],
          "line": 2578
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug",
          "args": [
            "\"packet_start[%d]\"",
            "type"
          ],
          "line": 2578
        },
        "resolved": true,
        "details": {
          "function_name": "ssh_packet_send_debug",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
          "lines": "1771-1794",
          "snippet": "void\nssh_packet_send_debug(struct ssh *ssh, const char *fmt,...)\n{\n\tchar buf[1024];\n\tva_list args;\n\tint r;\n\n\tif ((ssh->compat & SSH_BUG_DEBUG))\n\t\treturn;\n\n\tva_start(args, fmt);\n\tvsnprintf(buf, sizeof(buf), fmt, args);\n\tva_end(args);\n\n\tdebug3(\"sending debug message: %s\", buf);\n\n\tif ((r = sshpkt_start(ssh, SSH2_MSG_DEBUG)) != 0 ||\n\t    (r = sshpkt_put_u8(ssh, 0)) != 0 || /* always display */\n\t    (r = sshpkt_put_cstring(ssh, buf)) != 0 ||\n\t    (r = sshpkt_put_cstring(ssh, \"\")) != 0 ||\n\t    (r = sshpkt_send(ssh)) != 0 ||\n\t    (r = ssh_packet_write_wait(ssh)) != 0)\n\t\tfatal(\"%s: %s\", __func__, ssh_err(r));\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include \"packet.h\"",
            "#include \"ssh.h\"",
            "#include \"channels.h\"",
            "#include \"misc.h\"",
            "#include \"canohost.h\"",
            "#include \"log.h\"",
            "#include \"mac.h\"",
            "#include \"digest.h\"",
            "#include \"kex.h\"",
            "#include \"sshkey.h\"",
            "#include \"cipher.h\"",
            "#include \"ssh2.h\"",
            "#include \"compat.h\"",
            "#include \"crc32.h\"",
            "#include \"xmalloc.h\"",
            "#include <zlib.h>",
            "#  include <openssl/ec.h>",
            "# include <openssl/evp.h>",
            "# include <openssl/bn.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <limits.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <netdb.h>",
            "#include <errno.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include \"openbsd-compat/sys-queue.h\"",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\nssh_packet_send_debug(struct ssh *ssh, const char *fmt,...)\n{\n\tchar buf[1024];\n\tva_list args;\n\tint r;\n\n\tif ((ssh->compat & SSH_BUG_DEBUG))\n\t\treturn;\n\n\tva_start(args, fmt);\n\tvsnprintf(buf, sizeof(buf), fmt, args);\n\tva_end(args);\n\n\tdebug3(\"sending debug message: %s\", buf);\n\n\tif ((r = sshpkt_start(ssh, SSH2_MSG_DEBUG)) != 0 ||\n\t    (r = sshpkt_put_u8(ssh, 0)) != 0 || /* always display */\n\t    (r = sshpkt_put_cstring(ssh, buf)) != 0 ||\n\t    (r = sshpkt_put_cstring(ssh, \"\")) != 0 ||\n\t    (r = sshpkt_send(ssh)) != 0 ||\n\t    (r = ssh_packet_write_wait(ssh)) != 0)\n\t\tfatal(\"%s: %s\", __func__, ssh_err(r));\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshpkt_start(struct ssh *ssh, u_char type)\n{\n\tu_char buf[6]; /* u32 packet length, u8 pad len, u8 type */\n\n\tDBG(debug(\"packet_start[%d]\", type));\n\tmemset(buf, 0, sizeof(buf));\n\tbuf[sizeof(buf) - 1] = type;\n\tsshbuf_reset(ssh->state->outgoing_packet);\n\treturn sshbuf_put(ssh->state->outgoing_packet, buf, sizeof(buf));\n}"
  },
  {
    "function_name": "sshpkt_ptr",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
    "lines": "2563-2569",
    "snippet": "const u_char *\nsshpkt_ptr(struct ssh *ssh, size_t *lenp)\n{\n\tif (lenp != NULL)\n\t\t*lenp = sshbuf_len(ssh->state->incoming_packet);\n\treturn sshbuf_ptr(ssh->state->incoming_packet);\n}",
    "includes": [
      "#include \"sshbuf.h\"",
      "#include \"ssherr.h\"",
      "#include \"packet.h\"",
      "#include \"ssh.h\"",
      "#include \"channels.h\"",
      "#include \"misc.h\"",
      "#include \"canohost.h\"",
      "#include \"log.h\"",
      "#include \"mac.h\"",
      "#include \"digest.h\"",
      "#include \"kex.h\"",
      "#include \"sshkey.h\"",
      "#include \"cipher.h\"",
      "#include \"ssh2.h\"",
      "#include \"compat.h\"",
      "#include \"crc32.h\"",
      "#include \"xmalloc.h\"",
      "#include <zlib.h>",
      "#  include <openssl/ec.h>",
      "# include <openssl/evp.h>",
      "# include <openssl/bn.h>",
      "#include <time.h>",
      "#include <signal.h>",
      "#include <limits.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <stdarg.h>",
      "#include <netdb.h>",
      "#include <errno.h>",
      "#include <arpa/inet.h>",
      "#include <netinet/ip.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include \"openbsd-compat/sys-queue.h\"",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "sshbuf_ptr",
          "args": [
            "ssh->state->incoming_packet"
          ],
          "line": 2568
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_ptr",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf.c",
          "lines": "268-274",
          "snippet": "const u_char *\nsshbuf_ptr(const struct sshbuf *buf)\n{\n\tif (sshbuf_check_sanity(buf) != 0)\n\t\treturn NULL;\n\treturn buf->cd + buf->off;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <signal.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <signal.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nconst u_char *\nsshbuf_ptr(const struct sshbuf *buf)\n{\n\tif (sshbuf_check_sanity(buf) != 0)\n\t\treturn NULL;\n\treturn buf->cd + buf->off;\n}"
        }
      },
      {
        "call_info": {
          "callee": "sshbuf_len",
          "args": [
            "ssh->state->incoming_packet"
          ],
          "line": 2567
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_len",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf.c",
          "lines": "252-258",
          "snippet": "size_t\nsshbuf_len(const struct sshbuf *buf)\n{\n\tif (sshbuf_check_sanity(buf) != 0)\n\t\treturn 0;\n\treturn buf->size - buf->off;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <signal.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <signal.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nsize_t\nsshbuf_len(const struct sshbuf *buf)\n{\n\tif (sshbuf_check_sanity(buf) != 0)\n\t\treturn 0;\n\treturn buf->size - buf->off;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nconst u_char *\nsshpkt_ptr(struct ssh *ssh, size_t *lenp)\n{\n\tif (lenp != NULL)\n\t\t*lenp = sshbuf_len(ssh->state->incoming_packet);\n\treturn sshbuf_ptr(ssh->state->incoming_packet);\n}"
  },
  {
    "function_name": "sshpkt_get_end",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
    "lines": "2555-2561",
    "snippet": "int\nsshpkt_get_end(struct ssh *ssh)\n{\n\tif (sshbuf_len(ssh->state->incoming_packet) > 0)\n\t\treturn SSH_ERR_UNEXPECTED_TRAILING_DATA;\n\treturn 0;\n}",
    "includes": [
      "#include \"sshbuf.h\"",
      "#include \"ssherr.h\"",
      "#include \"packet.h\"",
      "#include \"ssh.h\"",
      "#include \"channels.h\"",
      "#include \"misc.h\"",
      "#include \"canohost.h\"",
      "#include \"log.h\"",
      "#include \"mac.h\"",
      "#include \"digest.h\"",
      "#include \"kex.h\"",
      "#include \"sshkey.h\"",
      "#include \"cipher.h\"",
      "#include \"ssh2.h\"",
      "#include \"compat.h\"",
      "#include \"crc32.h\"",
      "#include \"xmalloc.h\"",
      "#include <zlib.h>",
      "#  include <openssl/ec.h>",
      "# include <openssl/evp.h>",
      "# include <openssl/bn.h>",
      "#include <time.h>",
      "#include <signal.h>",
      "#include <limits.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <stdarg.h>",
      "#include <netdb.h>",
      "#include <errno.h>",
      "#include <arpa/inet.h>",
      "#include <netinet/ip.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include \"openbsd-compat/sys-queue.h\"",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "sshbuf_len",
          "args": [
            "ssh->state->incoming_packet"
          ],
          "line": 2558
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_len",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf.c",
          "lines": "252-258",
          "snippet": "size_t\nsshbuf_len(const struct sshbuf *buf)\n{\n\tif (sshbuf_check_sanity(buf) != 0)\n\t\treturn 0;\n\treturn buf->size - buf->off;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <signal.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <signal.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nsize_t\nsshbuf_len(const struct sshbuf *buf)\n{\n\tif (sshbuf_check_sanity(buf) != 0)\n\t\treturn 0;\n\treturn buf->size - buf->off;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshpkt_get_end(struct ssh *ssh)\n{\n\tif (sshbuf_len(ssh->state->incoming_packet) > 0)\n\t\treturn SSH_ERR_UNEXPECTED_TRAILING_DATA;\n\treturn 0;\n}"
  },
  {
    "function_name": "sshpkt_get_bignum2",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
    "lines": "2548-2552",
    "snippet": "int\nsshpkt_get_bignum2(struct ssh *ssh, BIGNUM *v)\n{\n\treturn sshbuf_get_bignum2(ssh->state->incoming_packet, v);\n}",
    "includes": [
      "#include \"sshbuf.h\"",
      "#include \"ssherr.h\"",
      "#include \"packet.h\"",
      "#include \"ssh.h\"",
      "#include \"channels.h\"",
      "#include \"misc.h\"",
      "#include \"canohost.h\"",
      "#include \"log.h\"",
      "#include \"mac.h\"",
      "#include \"digest.h\"",
      "#include \"kex.h\"",
      "#include \"sshkey.h\"",
      "#include \"cipher.h\"",
      "#include \"ssh2.h\"",
      "#include \"compat.h\"",
      "#include \"crc32.h\"",
      "#include \"xmalloc.h\"",
      "#include <zlib.h>",
      "#  include <openssl/ec.h>",
      "# include <openssl/evp.h>",
      "# include <openssl/bn.h>",
      "#include <time.h>",
      "#include <signal.h>",
      "#include <limits.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <stdarg.h>",
      "#include <netdb.h>",
      "#include <errno.h>",
      "#include <arpa/inet.h>",
      "#include <netinet/ip.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include \"openbsd-compat/sys-queue.h\"",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "sshbuf_get_bignum2",
          "args": [
            "ssh->state->incoming_packet",
            "v"
          ],
          "line": 2551
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_get_bignum2",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf-getput-crypto.c",
          "lines": "34-46",
          "snippet": "int\nsshbuf_get_bignum2(struct sshbuf *buf, BIGNUM *v)\n{\n\tconst u_char *d;\n\tsize_t len;\n\tint r;\n\n\tif ((r = sshbuf_get_bignum2_bytes_direct(buf, &d, &len)) != 0)\n\t\treturn r;\n\tif (v != NULL && BN_bin2bn(d, len, v) == NULL)\n\t\treturn SSH_ERR_ALLOC_FAIL;\n\treturn 0;\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "# include <openssl/ec.h>",
            "#include <openssl/bn.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n# include <openssl/ec.h>\n#include <openssl/bn.h>\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshbuf_get_bignum2(struct sshbuf *buf, BIGNUM *v)\n{\n\tconst u_char *d;\n\tsize_t len;\n\tint r;\n\n\tif ((r = sshbuf_get_bignum2_bytes_direct(buf, &d, &len)) != 0)\n\t\treturn r;\n\tif (v != NULL && BN_bin2bn(d, len, v) == NULL)\n\t\treturn SSH_ERR_ALLOC_FAIL;\n\treturn 0;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshpkt_get_bignum2(struct ssh *ssh, BIGNUM *v)\n{\n\treturn sshbuf_get_bignum2(ssh->state->incoming_packet, v);\n}"
  },
  {
    "function_name": "sshpkt_get_ec",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
    "lines": "2540-2544",
    "snippet": "int\nsshpkt_get_ec(struct ssh *ssh, EC_POINT *v, const EC_GROUP *g)\n{\n\treturn sshbuf_get_ec(ssh->state->incoming_packet, v, g);\n}",
    "includes": [
      "#include \"sshbuf.h\"",
      "#include \"ssherr.h\"",
      "#include \"packet.h\"",
      "#include \"ssh.h\"",
      "#include \"channels.h\"",
      "#include \"misc.h\"",
      "#include \"canohost.h\"",
      "#include \"log.h\"",
      "#include \"mac.h\"",
      "#include \"digest.h\"",
      "#include \"kex.h\"",
      "#include \"sshkey.h\"",
      "#include \"cipher.h\"",
      "#include \"ssh2.h\"",
      "#include \"compat.h\"",
      "#include \"crc32.h\"",
      "#include \"xmalloc.h\"",
      "#include <zlib.h>",
      "#  include <openssl/ec.h>",
      "# include <openssl/evp.h>",
      "# include <openssl/bn.h>",
      "#include <time.h>",
      "#include <signal.h>",
      "#include <limits.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <stdarg.h>",
      "#include <netdb.h>",
      "#include <errno.h>",
      "#include <arpa/inet.h>",
      "#include <netinet/ip.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include \"openbsd-compat/sys-queue.h\"",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "sshbuf_get_ec",
          "args": [
            "ssh->state->incoming_packet",
            "v",
            "g"
          ],
          "line": 2543
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_get_ec",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf-getput-crypto.c",
          "lines": "89-108",
          "snippet": "int\nsshbuf_get_ec(struct sshbuf *buf, EC_POINT *v, const EC_GROUP *g)\n{\n\tconst u_char *d;\n\tsize_t len;\n\tint r;\n\n\tif ((r = sshbuf_peek_string_direct(buf, &d, &len)) < 0)\n\t\treturn r;\n\tif ((r = get_ec(d, len, v, g)) != 0)\n\t\treturn r;\n\t/* Skip string */\n\tif (sshbuf_get_string_direct(buf, NULL, NULL) != 0) {\n\t\t/* Shouldn't happen */\n\t\tSSHBUF_DBG((\"SSH_ERR_INTERNAL_ERROR\"));\n\t\tSSHBUF_ABORT();\n\t\treturn SSH_ERR_INTERNAL_ERROR;\n\t}\n\treturn 0;\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "# include <openssl/ec.h>",
            "#include <openssl/bn.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n# include <openssl/ec.h>\n#include <openssl/bn.h>\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshbuf_get_ec(struct sshbuf *buf, EC_POINT *v, const EC_GROUP *g)\n{\n\tconst u_char *d;\n\tsize_t len;\n\tint r;\n\n\tif ((r = sshbuf_peek_string_direct(buf, &d, &len)) < 0)\n\t\treturn r;\n\tif ((r = get_ec(d, len, v, g)) != 0)\n\t\treturn r;\n\t/* Skip string */\n\tif (sshbuf_get_string_direct(buf, NULL, NULL) != 0) {\n\t\t/* Shouldn't happen */\n\t\tSSHBUF_DBG((\"SSH_ERR_INTERNAL_ERROR\"));\n\t\tSSHBUF_ABORT();\n\t\treturn SSH_ERR_INTERNAL_ERROR;\n\t}\n\treturn 0;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshpkt_get_ec(struct ssh *ssh, EC_POINT *v, const EC_GROUP *g)\n{\n\treturn sshbuf_get_ec(ssh->state->incoming_packet, v, g);\n}"
  },
  {
    "function_name": "sshpkt_get_cstring",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
    "lines": "2532-2536",
    "snippet": "int\nsshpkt_get_cstring(struct ssh *ssh, char **valp, size_t *lenp)\n{\n\treturn sshbuf_get_cstring(ssh->state->incoming_packet, valp, lenp);\n}",
    "includes": [
      "#include \"sshbuf.h\"",
      "#include \"ssherr.h\"",
      "#include \"packet.h\"",
      "#include \"ssh.h\"",
      "#include \"channels.h\"",
      "#include \"misc.h\"",
      "#include \"canohost.h\"",
      "#include \"log.h\"",
      "#include \"mac.h\"",
      "#include \"digest.h\"",
      "#include \"kex.h\"",
      "#include \"sshkey.h\"",
      "#include \"cipher.h\"",
      "#include \"ssh2.h\"",
      "#include \"compat.h\"",
      "#include \"crc32.h\"",
      "#include \"xmalloc.h\"",
      "#include <zlib.h>",
      "#  include <openssl/ec.h>",
      "# include <openssl/evp.h>",
      "# include <openssl/bn.h>",
      "#include <time.h>",
      "#include <signal.h>",
      "#include <limits.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <stdarg.h>",
      "#include <netdb.h>",
      "#include <errno.h>",
      "#include <arpa/inet.h>",
      "#include <netinet/ip.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include \"openbsd-compat/sys-queue.h\"",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "sshbuf_get_cstring",
          "args": [
            "ssh->state->incoming_packet",
            "valp",
            "lenp"
          ],
          "line": 2535
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_get_cstring",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf-getput-basic.c",
          "lines": "180-213",
          "snippet": "int\nsshbuf_get_cstring(struct sshbuf *buf, char **valp, size_t *lenp)\n{\n\tsize_t len;\n\tconst u_char *p, *z;\n\tint r;\n\n\tif (valp != NULL)\n\t\t*valp = NULL;\n\tif (lenp != NULL)\n\t\t*lenp = 0;\n\tif ((r = sshbuf_peek_string_direct(buf, &p, &len)) != 0)\n\t\treturn r;\n\t/* Allow a \\0 only at the end of the string */\n\tif (len > 0 &&\n\t    (z = memchr(p , '\\0', len)) != NULL && z < p + len - 1) {\n\t\tSSHBUF_DBG((\"SSH_ERR_INVALID_FORMAT\"));\n\t\treturn SSH_ERR_INVALID_FORMAT;\n\t}\n\tif ((r = sshbuf_skip_string(buf)) != 0)\n\t\treturn -1;\n\tif (valp != NULL) {\n\t\tif ((*valp = malloc(len + 1)) == NULL) {\n\t\t\tSSHBUF_DBG((\"SSH_ERR_ALLOC_FAIL\"));\n\t\t\treturn SSH_ERR_ALLOC_FAIL;\n\t\t}\n\t\tif (len != 0)\n\t\t\tmemcpy(*valp, p, len);\n\t\t(*valp)[len] = '\\0';\n\t}\n\tif (lenp != NULL)\n\t\t*lenp = (size_t)len;\n\treturn 0;\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <stdarg.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <stdarg.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshbuf_get_cstring(struct sshbuf *buf, char **valp, size_t *lenp)\n{\n\tsize_t len;\n\tconst u_char *p, *z;\n\tint r;\n\n\tif (valp != NULL)\n\t\t*valp = NULL;\n\tif (lenp != NULL)\n\t\t*lenp = 0;\n\tif ((r = sshbuf_peek_string_direct(buf, &p, &len)) != 0)\n\t\treturn r;\n\t/* Allow a \\0 only at the end of the string */\n\tif (len > 0 &&\n\t    (z = memchr(p , '\\0', len)) != NULL && z < p + len - 1) {\n\t\tSSHBUF_DBG((\"SSH_ERR_INVALID_FORMAT\"));\n\t\treturn SSH_ERR_INVALID_FORMAT;\n\t}\n\tif ((r = sshbuf_skip_string(buf)) != 0)\n\t\treturn -1;\n\tif (valp != NULL) {\n\t\tif ((*valp = malloc(len + 1)) == NULL) {\n\t\t\tSSHBUF_DBG((\"SSH_ERR_ALLOC_FAIL\"));\n\t\t\treturn SSH_ERR_ALLOC_FAIL;\n\t\t}\n\t\tif (len != 0)\n\t\t\tmemcpy(*valp, p, len);\n\t\t(*valp)[len] = '\\0';\n\t}\n\tif (lenp != NULL)\n\t\t*lenp = (size_t)len;\n\treturn 0;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshpkt_get_cstring(struct ssh *ssh, char **valp, size_t *lenp)\n{\n\treturn sshbuf_get_cstring(ssh->state->incoming_packet, valp, lenp);\n}"
  },
  {
    "function_name": "sshpkt_peek_string_direct",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
    "lines": "2526-2530",
    "snippet": "int\nsshpkt_peek_string_direct(struct ssh *ssh, const u_char **valp, size_t *lenp)\n{\n\treturn sshbuf_peek_string_direct(ssh->state->incoming_packet, valp, lenp);\n}",
    "includes": [
      "#include \"sshbuf.h\"",
      "#include \"ssherr.h\"",
      "#include \"packet.h\"",
      "#include \"ssh.h\"",
      "#include \"channels.h\"",
      "#include \"misc.h\"",
      "#include \"canohost.h\"",
      "#include \"log.h\"",
      "#include \"mac.h\"",
      "#include \"digest.h\"",
      "#include \"kex.h\"",
      "#include \"sshkey.h\"",
      "#include \"cipher.h\"",
      "#include \"ssh2.h\"",
      "#include \"compat.h\"",
      "#include \"crc32.h\"",
      "#include \"xmalloc.h\"",
      "#include <zlib.h>",
      "#  include <openssl/ec.h>",
      "# include <openssl/evp.h>",
      "# include <openssl/bn.h>",
      "#include <time.h>",
      "#include <signal.h>",
      "#include <limits.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <stdarg.h>",
      "#include <netdb.h>",
      "#include <errno.h>",
      "#include <arpa/inet.h>",
      "#include <netinet/ip.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include \"openbsd-compat/sys-queue.h\"",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "sshbuf_peek_string_direct",
          "args": [
            "ssh->state->incoming_packet",
            "valp",
            "lenp"
          ],
          "line": 2529
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_peek_string_direct",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf-getput-basic.c",
          "lines": "149-178",
          "snippet": "int\nsshbuf_peek_string_direct(const struct sshbuf *buf, const u_char **valp,\n    size_t *lenp)\n{\n\tu_int32_t len;\n\tconst u_char *p = sshbuf_ptr(buf);\n\n\tif (valp != NULL)\n\t\t*valp = NULL;\n\tif (lenp != NULL)\n\t\t*lenp = 0;\n\tif (sshbuf_len(buf) < 4) {\n\t\tSSHBUF_DBG((\"SSH_ERR_MESSAGE_INCOMPLETE\"));\n\t\treturn SSH_ERR_MESSAGE_INCOMPLETE;\n\t}\n\tlen = PEEK_U32(p);\n\tif (len > SSHBUF_SIZE_MAX - 4) {\n\t\tSSHBUF_DBG((\"SSH_ERR_STRING_TOO_LARGE\"));\n\t\treturn SSH_ERR_STRING_TOO_LARGE;\n\t}\n\tif (sshbuf_len(buf) - 4 < len) {\n\t\tSSHBUF_DBG((\"SSH_ERR_MESSAGE_INCOMPLETE\"));\n\t\treturn SSH_ERR_MESSAGE_INCOMPLETE;\n\t}\n\tif (valp != NULL)\n\t\t*valp = p + 4;\n\tif (lenp != NULL)\n\t\t*lenp = len;\n\treturn 0;\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <stdarg.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <stdarg.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshbuf_peek_string_direct(const struct sshbuf *buf, const u_char **valp,\n    size_t *lenp)\n{\n\tu_int32_t len;\n\tconst u_char *p = sshbuf_ptr(buf);\n\n\tif (valp != NULL)\n\t\t*valp = NULL;\n\tif (lenp != NULL)\n\t\t*lenp = 0;\n\tif (sshbuf_len(buf) < 4) {\n\t\tSSHBUF_DBG((\"SSH_ERR_MESSAGE_INCOMPLETE\"));\n\t\treturn SSH_ERR_MESSAGE_INCOMPLETE;\n\t}\n\tlen = PEEK_U32(p);\n\tif (len > SSHBUF_SIZE_MAX - 4) {\n\t\tSSHBUF_DBG((\"SSH_ERR_STRING_TOO_LARGE\"));\n\t\treturn SSH_ERR_STRING_TOO_LARGE;\n\t}\n\tif (sshbuf_len(buf) - 4 < len) {\n\t\tSSHBUF_DBG((\"SSH_ERR_MESSAGE_INCOMPLETE\"));\n\t\treturn SSH_ERR_MESSAGE_INCOMPLETE;\n\t}\n\tif (valp != NULL)\n\t\t*valp = p + 4;\n\tif (lenp != NULL)\n\t\t*lenp = len;\n\treturn 0;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshpkt_peek_string_direct(struct ssh *ssh, const u_char **valp, size_t *lenp)\n{\n\treturn sshbuf_peek_string_direct(ssh->state->incoming_packet, valp, lenp);\n}"
  },
  {
    "function_name": "sshpkt_get_string_direct",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
    "lines": "2520-2524",
    "snippet": "int\nsshpkt_get_string_direct(struct ssh *ssh, const u_char **valp, size_t *lenp)\n{\n\treturn sshbuf_get_string_direct(ssh->state->incoming_packet, valp, lenp);\n}",
    "includes": [
      "#include \"sshbuf.h\"",
      "#include \"ssherr.h\"",
      "#include \"packet.h\"",
      "#include \"ssh.h\"",
      "#include \"channels.h\"",
      "#include \"misc.h\"",
      "#include \"canohost.h\"",
      "#include \"log.h\"",
      "#include \"mac.h\"",
      "#include \"digest.h\"",
      "#include \"kex.h\"",
      "#include \"sshkey.h\"",
      "#include \"cipher.h\"",
      "#include \"ssh2.h\"",
      "#include \"compat.h\"",
      "#include \"crc32.h\"",
      "#include \"xmalloc.h\"",
      "#include <zlib.h>",
      "#  include <openssl/ec.h>",
      "# include <openssl/evp.h>",
      "# include <openssl/bn.h>",
      "#include <time.h>",
      "#include <signal.h>",
      "#include <limits.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <stdarg.h>",
      "#include <netdb.h>",
      "#include <errno.h>",
      "#include <arpa/inet.h>",
      "#include <netinet/ip.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include \"openbsd-compat/sys-queue.h\"",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "sshbuf_get_string_direct",
          "args": [
            "ssh->state->incoming_packet",
            "valp",
            "lenp"
          ],
          "line": 2523
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_get_string_direct",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf-getput-basic.c",
          "lines": "123-147",
          "snippet": "int\nsshbuf_get_string_direct(struct sshbuf *buf, const u_char **valp, size_t *lenp)\n{\n\tsize_t len;\n\tconst u_char *p;\n\tint r;\n\n\tif (valp != NULL)\n\t\t*valp = NULL;\n\tif (lenp != NULL)\n\t\t*lenp = 0;\n\tif ((r = sshbuf_peek_string_direct(buf, &p, &len)) < 0)\n\t\treturn r;\n\tif (valp != NULL)\n\t\t*valp = p;\n\tif (lenp != NULL)\n\t\t*lenp = len;\n\tif (sshbuf_consume(buf, len + 4) != 0) {\n\t\t/* Shouldn't happen */\n\t\tSSHBUF_DBG((\"SSH_ERR_INTERNAL_ERROR\"));\n\t\tSSHBUF_ABORT();\n\t\treturn SSH_ERR_INTERNAL_ERROR;\n\t}\n\treturn 0;\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <stdarg.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <stdarg.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshbuf_get_string_direct(struct sshbuf *buf, const u_char **valp, size_t *lenp)\n{\n\tsize_t len;\n\tconst u_char *p;\n\tint r;\n\n\tif (valp != NULL)\n\t\t*valp = NULL;\n\tif (lenp != NULL)\n\t\t*lenp = 0;\n\tif ((r = sshbuf_peek_string_direct(buf, &p, &len)) < 0)\n\t\treturn r;\n\tif (valp != NULL)\n\t\t*valp = p;\n\tif (lenp != NULL)\n\t\t*lenp = len;\n\tif (sshbuf_consume(buf, len + 4) != 0) {\n\t\t/* Shouldn't happen */\n\t\tSSHBUF_DBG((\"SSH_ERR_INTERNAL_ERROR\"));\n\t\tSSHBUF_ABORT();\n\t\treturn SSH_ERR_INTERNAL_ERROR;\n\t}\n\treturn 0;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshpkt_get_string_direct(struct ssh *ssh, const u_char **valp, size_t *lenp)\n{\n\treturn sshbuf_get_string_direct(ssh->state->incoming_packet, valp, lenp);\n}"
  },
  {
    "function_name": "sshpkt_get_string",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
    "lines": "2514-2518",
    "snippet": "int\nsshpkt_get_string(struct ssh *ssh, u_char **valp, size_t *lenp)\n{\n\treturn sshbuf_get_string(ssh->state->incoming_packet, valp, lenp);\n}",
    "includes": [
      "#include \"sshbuf.h\"",
      "#include \"ssherr.h\"",
      "#include \"packet.h\"",
      "#include \"ssh.h\"",
      "#include \"channels.h\"",
      "#include \"misc.h\"",
      "#include \"canohost.h\"",
      "#include \"log.h\"",
      "#include \"mac.h\"",
      "#include \"digest.h\"",
      "#include \"kex.h\"",
      "#include \"sshkey.h\"",
      "#include \"cipher.h\"",
      "#include \"ssh2.h\"",
      "#include \"compat.h\"",
      "#include \"crc32.h\"",
      "#include \"xmalloc.h\"",
      "#include <zlib.h>",
      "#  include <openssl/ec.h>",
      "# include <openssl/evp.h>",
      "# include <openssl/bn.h>",
      "#include <time.h>",
      "#include <signal.h>",
      "#include <limits.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <stdarg.h>",
      "#include <netdb.h>",
      "#include <errno.h>",
      "#include <arpa/inet.h>",
      "#include <netinet/ip.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include \"openbsd-compat/sys-queue.h\"",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "sshbuf_get_string",
          "args": [
            "ssh->state->incoming_packet",
            "valp",
            "lenp"
          ],
          "line": 2517
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_get_string_direct",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf-getput-basic.c",
          "lines": "123-147",
          "snippet": "int\nsshbuf_get_string_direct(struct sshbuf *buf, const u_char **valp, size_t *lenp)\n{\n\tsize_t len;\n\tconst u_char *p;\n\tint r;\n\n\tif (valp != NULL)\n\t\t*valp = NULL;\n\tif (lenp != NULL)\n\t\t*lenp = 0;\n\tif ((r = sshbuf_peek_string_direct(buf, &p, &len)) < 0)\n\t\treturn r;\n\tif (valp != NULL)\n\t\t*valp = p;\n\tif (lenp != NULL)\n\t\t*lenp = len;\n\tif (sshbuf_consume(buf, len + 4) != 0) {\n\t\t/* Shouldn't happen */\n\t\tSSHBUF_DBG((\"SSH_ERR_INTERNAL_ERROR\"));\n\t\tSSHBUF_ABORT();\n\t\treturn SSH_ERR_INTERNAL_ERROR;\n\t}\n\treturn 0;\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <stdarg.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <stdarg.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshbuf_get_string_direct(struct sshbuf *buf, const u_char **valp, size_t *lenp)\n{\n\tsize_t len;\n\tconst u_char *p;\n\tint r;\n\n\tif (valp != NULL)\n\t\t*valp = NULL;\n\tif (lenp != NULL)\n\t\t*lenp = 0;\n\tif ((r = sshbuf_peek_string_direct(buf, &p, &len)) < 0)\n\t\treturn r;\n\tif (valp != NULL)\n\t\t*valp = p;\n\tif (lenp != NULL)\n\t\t*lenp = len;\n\tif (sshbuf_consume(buf, len + 4) != 0) {\n\t\t/* Shouldn't happen */\n\t\tSSHBUF_DBG((\"SSH_ERR_INTERNAL_ERROR\"));\n\t\tSSHBUF_ABORT();\n\t\treturn SSH_ERR_INTERNAL_ERROR;\n\t}\n\treturn 0;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshpkt_get_string(struct ssh *ssh, u_char **valp, size_t *lenp)\n{\n\treturn sshbuf_get_string(ssh->state->incoming_packet, valp, lenp);\n}"
  },
  {
    "function_name": "sshpkt_get_u64",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
    "lines": "2508-2512",
    "snippet": "int\nsshpkt_get_u64(struct ssh *ssh, u_int64_t *valp)\n{\n\treturn sshbuf_get_u64(ssh->state->incoming_packet, valp);\n}",
    "includes": [
      "#include \"sshbuf.h\"",
      "#include \"ssherr.h\"",
      "#include \"packet.h\"",
      "#include \"ssh.h\"",
      "#include \"channels.h\"",
      "#include \"misc.h\"",
      "#include \"canohost.h\"",
      "#include \"log.h\"",
      "#include \"mac.h\"",
      "#include \"digest.h\"",
      "#include \"kex.h\"",
      "#include \"sshkey.h\"",
      "#include \"cipher.h\"",
      "#include \"ssh2.h\"",
      "#include \"compat.h\"",
      "#include \"crc32.h\"",
      "#include \"xmalloc.h\"",
      "#include <zlib.h>",
      "#  include <openssl/ec.h>",
      "# include <openssl/evp.h>",
      "# include <openssl/bn.h>",
      "#include <time.h>",
      "#include <signal.h>",
      "#include <limits.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <stdarg.h>",
      "#include <netdb.h>",
      "#include <errno.h>",
      "#include <arpa/inet.h>",
      "#include <netinet/ip.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include \"openbsd-compat/sys-queue.h\"",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "sshbuf_get_u64",
          "args": [
            "ssh->state->incoming_packet",
            "valp"
          ],
          "line": 2511
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_get_u64",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf-getput-basic.c",
          "lines": "44-55",
          "snippet": "int\nsshbuf_get_u64(struct sshbuf *buf, u_int64_t *valp)\n{\n\tconst u_char *p = sshbuf_ptr(buf);\n\tint r;\n\n\tif ((r = sshbuf_consume(buf, 8)) < 0)\n\t\treturn r;\n\tif (valp != NULL)\n\t\t*valp = PEEK_U64(p);\n\treturn 0;\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <stdarg.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <stdarg.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshbuf_get_u64(struct sshbuf *buf, u_int64_t *valp)\n{\n\tconst u_char *p = sshbuf_ptr(buf);\n\tint r;\n\n\tif ((r = sshbuf_consume(buf, 8)) < 0)\n\t\treturn r;\n\tif (valp != NULL)\n\t\t*valp = PEEK_U64(p);\n\treturn 0;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshpkt_get_u64(struct ssh *ssh, u_int64_t *valp)\n{\n\treturn sshbuf_get_u64(ssh->state->incoming_packet, valp);\n}"
  },
  {
    "function_name": "sshpkt_get_u32",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
    "lines": "2502-2506",
    "snippet": "int\nsshpkt_get_u32(struct ssh *ssh, u_int32_t *valp)\n{\n\treturn sshbuf_get_u32(ssh->state->incoming_packet, valp);\n}",
    "includes": [
      "#include \"sshbuf.h\"",
      "#include \"ssherr.h\"",
      "#include \"packet.h\"",
      "#include \"ssh.h\"",
      "#include \"channels.h\"",
      "#include \"misc.h\"",
      "#include \"canohost.h\"",
      "#include \"log.h\"",
      "#include \"mac.h\"",
      "#include \"digest.h\"",
      "#include \"kex.h\"",
      "#include \"sshkey.h\"",
      "#include \"cipher.h\"",
      "#include \"ssh2.h\"",
      "#include \"compat.h\"",
      "#include \"crc32.h\"",
      "#include \"xmalloc.h\"",
      "#include <zlib.h>",
      "#  include <openssl/ec.h>",
      "# include <openssl/evp.h>",
      "# include <openssl/bn.h>",
      "#include <time.h>",
      "#include <signal.h>",
      "#include <limits.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <stdarg.h>",
      "#include <netdb.h>",
      "#include <errno.h>",
      "#include <arpa/inet.h>",
      "#include <netinet/ip.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include \"openbsd-compat/sys-queue.h\"",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "sshbuf_get_u32",
          "args": [
            "ssh->state->incoming_packet",
            "valp"
          ],
          "line": 2505
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_get_u32",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf-getput-basic.c",
          "lines": "57-68",
          "snippet": "int\nsshbuf_get_u32(struct sshbuf *buf, u_int32_t *valp)\n{\n\tconst u_char *p = sshbuf_ptr(buf);\n\tint r;\n\n\tif ((r = sshbuf_consume(buf, 4)) < 0)\n\t\treturn r;\n\tif (valp != NULL)\n\t\t*valp = PEEK_U32(p);\n\treturn 0;\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <stdarg.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <stdarg.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshbuf_get_u32(struct sshbuf *buf, u_int32_t *valp)\n{\n\tconst u_char *p = sshbuf_ptr(buf);\n\tint r;\n\n\tif ((r = sshbuf_consume(buf, 4)) < 0)\n\t\treturn r;\n\tif (valp != NULL)\n\t\t*valp = PEEK_U32(p);\n\treturn 0;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshpkt_get_u32(struct ssh *ssh, u_int32_t *valp)\n{\n\treturn sshbuf_get_u32(ssh->state->incoming_packet, valp);\n}"
  },
  {
    "function_name": "sshpkt_get_u8",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
    "lines": "2496-2500",
    "snippet": "int\nsshpkt_get_u8(struct ssh *ssh, u_char *valp)\n{\n\treturn sshbuf_get_u8(ssh->state->incoming_packet, valp);\n}",
    "includes": [
      "#include \"sshbuf.h\"",
      "#include \"ssherr.h\"",
      "#include \"packet.h\"",
      "#include \"ssh.h\"",
      "#include \"channels.h\"",
      "#include \"misc.h\"",
      "#include \"canohost.h\"",
      "#include \"log.h\"",
      "#include \"mac.h\"",
      "#include \"digest.h\"",
      "#include \"kex.h\"",
      "#include \"sshkey.h\"",
      "#include \"cipher.h\"",
      "#include \"ssh2.h\"",
      "#include \"compat.h\"",
      "#include \"crc32.h\"",
      "#include \"xmalloc.h\"",
      "#include <zlib.h>",
      "#  include <openssl/ec.h>",
      "# include <openssl/evp.h>",
      "# include <openssl/bn.h>",
      "#include <time.h>",
      "#include <signal.h>",
      "#include <limits.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <stdarg.h>",
      "#include <netdb.h>",
      "#include <errno.h>",
      "#include <arpa/inet.h>",
      "#include <netinet/ip.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include \"openbsd-compat/sys-queue.h\"",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "sshbuf_get_u8",
          "args": [
            "ssh->state->incoming_packet",
            "valp"
          ],
          "line": 2499
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_get_u8",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf-getput-basic.c",
          "lines": "83-94",
          "snippet": "int\nsshbuf_get_u8(struct sshbuf *buf, u_char *valp)\n{\n\tconst u_char *p = sshbuf_ptr(buf);\n\tint r;\n\n\tif ((r = sshbuf_consume(buf, 1)) < 0)\n\t\treturn r;\n\tif (valp != NULL)\n\t\t*valp = (u_int8_t)*p;\n\treturn 0;\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <stdarg.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <stdarg.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshbuf_get_u8(struct sshbuf *buf, u_char *valp)\n{\n\tconst u_char *p = sshbuf_ptr(buf);\n\tint r;\n\n\tif ((r = sshbuf_consume(buf, 1)) < 0)\n\t\treturn r;\n\tif (valp != NULL)\n\t\t*valp = (u_int8_t)*p;\n\treturn 0;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshpkt_get_u8(struct ssh *ssh, u_char *valp)\n{\n\treturn sshbuf_get_u8(ssh->state->incoming_packet, valp);\n}"
  },
  {
    "function_name": "sshpkt_get",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
    "lines": "2490-2494",
    "snippet": "int\nsshpkt_get(struct ssh *ssh, void *valp, size_t len)\n{\n\treturn sshbuf_get(ssh->state->incoming_packet, valp, len);\n}",
    "includes": [
      "#include \"sshbuf.h\"",
      "#include \"ssherr.h\"",
      "#include \"packet.h\"",
      "#include \"ssh.h\"",
      "#include \"channels.h\"",
      "#include \"misc.h\"",
      "#include \"canohost.h\"",
      "#include \"log.h\"",
      "#include \"mac.h\"",
      "#include \"digest.h\"",
      "#include \"kex.h\"",
      "#include \"sshkey.h\"",
      "#include \"cipher.h\"",
      "#include \"ssh2.h\"",
      "#include \"compat.h\"",
      "#include \"crc32.h\"",
      "#include \"xmalloc.h\"",
      "#include <zlib.h>",
      "#  include <openssl/ec.h>",
      "# include <openssl/evp.h>",
      "# include <openssl/bn.h>",
      "#include <time.h>",
      "#include <signal.h>",
      "#include <limits.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <stdarg.h>",
      "#include <netdb.h>",
      "#include <errno.h>",
      "#include <arpa/inet.h>",
      "#include <netinet/ip.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include \"openbsd-compat/sys-queue.h\"",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "sshbuf_get",
          "args": [
            "ssh->state->incoming_packet",
            "valp",
            "len"
          ],
          "line": 2493
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_get_bignum2_bytes_direct",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf-getput-basic.c",
          "lines": "430-464",
          "snippet": "int\nsshbuf_get_bignum2_bytes_direct(struct sshbuf *buf,\n    const u_char **valp, size_t *lenp)\n{\n\tconst u_char *d;\n\tsize_t len, olen;\n\tint r;\n\n\tif ((r = sshbuf_peek_string_direct(buf, &d, &olen)) < 0)\n\t\treturn r;\n\tlen = olen;\n\t/* Refuse negative (MSB set) bignums */\n\tif ((len != 0 && (*d & 0x80) != 0))\n\t\treturn SSH_ERR_BIGNUM_IS_NEGATIVE;\n\t/* Refuse overlong bignums, allow prepended \\0 to avoid MSB set */\n\tif (len > SSHBUF_MAX_BIGNUM + 1 ||\n\t    (len == SSHBUF_MAX_BIGNUM + 1 && *d != 0))\n\t\treturn SSH_ERR_BIGNUM_TOO_LARGE;\n\t/* Trim leading zeros */\n\twhile (len > 0 && *d == 0x00) {\n\t\td++;\n\t\tlen--;\n\t}\n\tif (valp != NULL)\n\t\t*valp = d;\n\tif (lenp != NULL)\n\t\t*lenp = len;\n\tif (sshbuf_consume(buf, olen + 4) != 0) {\n\t\t/* Shouldn't happen */\n\t\tSSHBUF_DBG((\"SSH_ERR_INTERNAL_ERROR\"));\n\t\tSSHBUF_ABORT();\n\t\treturn SSH_ERR_INTERNAL_ERROR;\n\t}\n\treturn 0;\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <stdarg.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <stdarg.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshbuf_get_bignum2_bytes_direct(struct sshbuf *buf,\n    const u_char **valp, size_t *lenp)\n{\n\tconst u_char *d;\n\tsize_t len, olen;\n\tint r;\n\n\tif ((r = sshbuf_peek_string_direct(buf, &d, &olen)) < 0)\n\t\treturn r;\n\tlen = olen;\n\t/* Refuse negative (MSB set) bignums */\n\tif ((len != 0 && (*d & 0x80) != 0))\n\t\treturn SSH_ERR_BIGNUM_IS_NEGATIVE;\n\t/* Refuse overlong bignums, allow prepended \\0 to avoid MSB set */\n\tif (len > SSHBUF_MAX_BIGNUM + 1 ||\n\t    (len == SSHBUF_MAX_BIGNUM + 1 && *d != 0))\n\t\treturn SSH_ERR_BIGNUM_TOO_LARGE;\n\t/* Trim leading zeros */\n\twhile (len > 0 && *d == 0x00) {\n\t\td++;\n\t\tlen--;\n\t}\n\tif (valp != NULL)\n\t\t*valp = d;\n\tif (lenp != NULL)\n\t\t*lenp = len;\n\tif (sshbuf_consume(buf, olen + 4) != 0) {\n\t\t/* Shouldn't happen */\n\t\tSSHBUF_DBG((\"SSH_ERR_INTERNAL_ERROR\"));\n\t\tSSHBUF_ABORT();\n\t\treturn SSH_ERR_INTERNAL_ERROR;\n\t}\n\treturn 0;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshpkt_get(struct ssh *ssh, void *valp, size_t len)\n{\n\treturn sshbuf_get(ssh->state->incoming_packet, valp, len);\n}"
  },
  {
    "function_name": "sshpkt_put_bignum2",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
    "lines": "2481-2485",
    "snippet": "int\nsshpkt_put_bignum2(struct ssh *ssh, const BIGNUM *v)\n{\n\treturn sshbuf_put_bignum2(ssh->state->outgoing_packet, v);\n}",
    "includes": [
      "#include \"sshbuf.h\"",
      "#include \"ssherr.h\"",
      "#include \"packet.h\"",
      "#include \"ssh.h\"",
      "#include \"channels.h\"",
      "#include \"misc.h\"",
      "#include \"canohost.h\"",
      "#include \"log.h\"",
      "#include \"mac.h\"",
      "#include \"digest.h\"",
      "#include \"kex.h\"",
      "#include \"sshkey.h\"",
      "#include \"cipher.h\"",
      "#include \"ssh2.h\"",
      "#include \"compat.h\"",
      "#include \"crc32.h\"",
      "#include \"xmalloc.h\"",
      "#include <zlib.h>",
      "#  include <openssl/ec.h>",
      "# include <openssl/evp.h>",
      "# include <openssl/bn.h>",
      "#include <time.h>",
      "#include <signal.h>",
      "#include <limits.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <stdarg.h>",
      "#include <netdb.h>",
      "#include <errno.h>",
      "#include <arpa/inet.h>",
      "#include <netinet/ip.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include \"openbsd-compat/sys-queue.h\"",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "sshbuf_put_bignum2",
          "args": [
            "ssh->state->outgoing_packet",
            "v"
          ],
          "line": 2484
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_put_bignum2",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf-getput-crypto.c",
          "lines": "146-166",
          "snippet": "int\nsshbuf_put_bignum2(struct sshbuf *buf, const BIGNUM *v)\n{\n\tu_char d[SSHBUF_MAX_BIGNUM + 1];\n\tint len = BN_num_bytes(v), prepend = 0, r;\n\n\tif (len < 0 || len > SSHBUF_MAX_BIGNUM)\n\t\treturn SSH_ERR_INVALID_ARGUMENT;\n\t*d = '\\0';\n\tif (BN_bn2bin(v, d + 1) != len)\n\t\treturn SSH_ERR_INTERNAL_ERROR; /* Shouldn't happen */\n\t/* If MSB is set, prepend a \\0 */\n\tif (len > 0 && (d[1] & 0x80) != 0)\n\t\tprepend = 1;\n\tif ((r = sshbuf_put_string(buf, d + 1 - prepend, len + prepend)) < 0) {\n\t\texplicit_bzero(d, sizeof(d));\n\t\treturn r;\n\t}\n\texplicit_bzero(d, sizeof(d));\n\treturn 0;\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "# include <openssl/ec.h>",
            "#include <openssl/bn.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n# include <openssl/ec.h>\n#include <openssl/bn.h>\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshbuf_put_bignum2(struct sshbuf *buf, const BIGNUM *v)\n{\n\tu_char d[SSHBUF_MAX_BIGNUM + 1];\n\tint len = BN_num_bytes(v), prepend = 0, r;\n\n\tif (len < 0 || len > SSHBUF_MAX_BIGNUM)\n\t\treturn SSH_ERR_INVALID_ARGUMENT;\n\t*d = '\\0';\n\tif (BN_bn2bin(v, d + 1) != len)\n\t\treturn SSH_ERR_INTERNAL_ERROR; /* Shouldn't happen */\n\t/* If MSB is set, prepend a \\0 */\n\tif (len > 0 && (d[1] & 0x80) != 0)\n\t\tprepend = 1;\n\tif ((r = sshbuf_put_string(buf, d + 1 - prepend, len + prepend)) < 0) {\n\t\texplicit_bzero(d, sizeof(d));\n\t\treturn r;\n\t}\n\texplicit_bzero(d, sizeof(d));\n\treturn 0;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshpkt_put_bignum2(struct ssh *ssh, const BIGNUM *v)\n{\n\treturn sshbuf_put_bignum2(ssh->state->outgoing_packet, v);\n}"
  },
  {
    "function_name": "sshpkt_put_ec",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
    "lines": "2473-2477",
    "snippet": "int\nsshpkt_put_ec(struct ssh *ssh, const EC_POINT *v, const EC_GROUP *g)\n{\n\treturn sshbuf_put_ec(ssh->state->outgoing_packet, v, g);\n}",
    "includes": [
      "#include \"sshbuf.h\"",
      "#include \"ssherr.h\"",
      "#include \"packet.h\"",
      "#include \"ssh.h\"",
      "#include \"channels.h\"",
      "#include \"misc.h\"",
      "#include \"canohost.h\"",
      "#include \"log.h\"",
      "#include \"mac.h\"",
      "#include \"digest.h\"",
      "#include \"kex.h\"",
      "#include \"sshkey.h\"",
      "#include \"cipher.h\"",
      "#include \"ssh2.h\"",
      "#include \"compat.h\"",
      "#include \"crc32.h\"",
      "#include \"xmalloc.h\"",
      "#include <zlib.h>",
      "#  include <openssl/ec.h>",
      "# include <openssl/evp.h>",
      "# include <openssl/bn.h>",
      "#include <time.h>",
      "#include <signal.h>",
      "#include <limits.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <stdarg.h>",
      "#include <netdb.h>",
      "#include <errno.h>",
      "#include <arpa/inet.h>",
      "#include <netinet/ip.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include \"openbsd-compat/sys-queue.h\"",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "sshbuf_put_ec",
          "args": [
            "ssh->state->outgoing_packet",
            "v",
            "g"
          ],
          "line": 2476
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_put_ec",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf-getput-crypto.c",
          "lines": "191-215",
          "snippet": "int\nsshbuf_put_ec(struct sshbuf *buf, const EC_POINT *v, const EC_GROUP *g)\n{\n\tu_char d[SSHBUF_MAX_ECPOINT];\n\tBN_CTX *bn_ctx;\n\tsize_t len;\n\tint ret;\n\n\tif ((bn_ctx = BN_CTX_new()) == NULL)\n\t\treturn SSH_ERR_ALLOC_FAIL;\n\tif ((len = EC_POINT_point2oct(g, v, POINT_CONVERSION_UNCOMPRESSED,\n\t    NULL, 0, bn_ctx)) > SSHBUF_MAX_ECPOINT) {\n\t\tBN_CTX_free(bn_ctx);\n\t\treturn SSH_ERR_INVALID_ARGUMENT;\n\t}\n\tif (EC_POINT_point2oct(g, v, POINT_CONVERSION_UNCOMPRESSED,\n\t    d, len, bn_ctx) != len) {\n\t\tBN_CTX_free(bn_ctx);\n\t\treturn SSH_ERR_INTERNAL_ERROR; /* Shouldn't happen */\n\t}\n\tBN_CTX_free(bn_ctx);\n\tret = sshbuf_put_string(buf, d, len);\n\texplicit_bzero(d, len);\n\treturn ret;\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "# include <openssl/ec.h>",
            "#include <openssl/bn.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n# include <openssl/ec.h>\n#include <openssl/bn.h>\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshbuf_put_ec(struct sshbuf *buf, const EC_POINT *v, const EC_GROUP *g)\n{\n\tu_char d[SSHBUF_MAX_ECPOINT];\n\tBN_CTX *bn_ctx;\n\tsize_t len;\n\tint ret;\n\n\tif ((bn_ctx = BN_CTX_new()) == NULL)\n\t\treturn SSH_ERR_ALLOC_FAIL;\n\tif ((len = EC_POINT_point2oct(g, v, POINT_CONVERSION_UNCOMPRESSED,\n\t    NULL, 0, bn_ctx)) > SSHBUF_MAX_ECPOINT) {\n\t\tBN_CTX_free(bn_ctx);\n\t\treturn SSH_ERR_INVALID_ARGUMENT;\n\t}\n\tif (EC_POINT_point2oct(g, v, POINT_CONVERSION_UNCOMPRESSED,\n\t    d, len, bn_ctx) != len) {\n\t\tBN_CTX_free(bn_ctx);\n\t\treturn SSH_ERR_INTERNAL_ERROR; /* Shouldn't happen */\n\t}\n\tBN_CTX_free(bn_ctx);\n\tret = sshbuf_put_string(buf, d, len);\n\texplicit_bzero(d, len);\n\treturn ret;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshpkt_put_ec(struct ssh *ssh, const EC_POINT *v, const EC_GROUP *g)\n{\n\treturn sshbuf_put_ec(ssh->state->outgoing_packet, v, g);\n}"
  },
  {
    "function_name": "sshpkt_put_stringb",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
    "lines": "2465-2469",
    "snippet": "int\nsshpkt_put_stringb(struct ssh *ssh, const struct sshbuf *v)\n{\n\treturn sshbuf_put_stringb(ssh->state->outgoing_packet, v);\n}",
    "includes": [
      "#include \"sshbuf.h\"",
      "#include \"ssherr.h\"",
      "#include \"packet.h\"",
      "#include \"ssh.h\"",
      "#include \"channels.h\"",
      "#include \"misc.h\"",
      "#include \"canohost.h\"",
      "#include \"log.h\"",
      "#include \"mac.h\"",
      "#include \"digest.h\"",
      "#include \"kex.h\"",
      "#include \"sshkey.h\"",
      "#include \"cipher.h\"",
      "#include \"ssh2.h\"",
      "#include \"compat.h\"",
      "#include \"crc32.h\"",
      "#include \"xmalloc.h\"",
      "#include <zlib.h>",
      "#  include <openssl/ec.h>",
      "# include <openssl/evp.h>",
      "# include <openssl/bn.h>",
      "#include <time.h>",
      "#include <signal.h>",
      "#include <limits.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <stdarg.h>",
      "#include <netdb.h>",
      "#include <errno.h>",
      "#include <arpa/inet.h>",
      "#include <netinet/ip.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include \"openbsd-compat/sys-queue.h\"",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "sshbuf_put_stringb",
          "args": [
            "ssh->state->outgoing_packet",
            "v"
          ],
          "line": 2468
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_put_stringb",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf-getput-basic.c",
          "lines": "371-375",
          "snippet": "int\nsshbuf_put_stringb(struct sshbuf *buf, const struct sshbuf *v)\n{\n\treturn sshbuf_put_string(buf, sshbuf_ptr(v), sshbuf_len(v));\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <stdarg.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <stdarg.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshbuf_put_stringb(struct sshbuf *buf, const struct sshbuf *v)\n{\n\treturn sshbuf_put_string(buf, sshbuf_ptr(v), sshbuf_len(v));\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshpkt_put_stringb(struct ssh *ssh, const struct sshbuf *v)\n{\n\treturn sshbuf_put_stringb(ssh->state->outgoing_packet, v);\n}"
  },
  {
    "function_name": "sshpkt_put_cstring",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
    "lines": "2459-2463",
    "snippet": "int\nsshpkt_put_cstring(struct ssh *ssh, const void *v)\n{\n\treturn sshbuf_put_cstring(ssh->state->outgoing_packet, v);\n}",
    "includes": [
      "#include \"sshbuf.h\"",
      "#include \"ssherr.h\"",
      "#include \"packet.h\"",
      "#include \"ssh.h\"",
      "#include \"channels.h\"",
      "#include \"misc.h\"",
      "#include \"canohost.h\"",
      "#include \"log.h\"",
      "#include \"mac.h\"",
      "#include \"digest.h\"",
      "#include \"kex.h\"",
      "#include \"sshkey.h\"",
      "#include \"cipher.h\"",
      "#include \"ssh2.h\"",
      "#include \"compat.h\"",
      "#include \"crc32.h\"",
      "#include \"xmalloc.h\"",
      "#include <zlib.h>",
      "#  include <openssl/ec.h>",
      "# include <openssl/evp.h>",
      "# include <openssl/bn.h>",
      "#include <time.h>",
      "#include <signal.h>",
      "#include <limits.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <stdarg.h>",
      "#include <netdb.h>",
      "#include <errno.h>",
      "#include <arpa/inet.h>",
      "#include <netinet/ip.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include \"openbsd-compat/sys-queue.h\"",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "sshbuf_put_cstring",
          "args": [
            "ssh->state->outgoing_packet",
            "v"
          ],
          "line": 2462
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_put_cstring",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf-getput-basic.c",
          "lines": "365-369",
          "snippet": "int\nsshbuf_put_cstring(struct sshbuf *buf, const char *v)\n{\n\treturn sshbuf_put_string(buf, v, v == NULL ? 0 : strlen(v));\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <stdarg.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <stdarg.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshbuf_put_cstring(struct sshbuf *buf, const char *v)\n{\n\treturn sshbuf_put_string(buf, v, v == NULL ? 0 : strlen(v));\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshpkt_put_cstring(struct ssh *ssh, const void *v)\n{\n\treturn sshbuf_put_cstring(ssh->state->outgoing_packet, v);\n}"
  },
  {
    "function_name": "sshpkt_put_string",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
    "lines": "2453-2457",
    "snippet": "int\nsshpkt_put_string(struct ssh *ssh, const void *v, size_t len)\n{\n\treturn sshbuf_put_string(ssh->state->outgoing_packet, v, len);\n}",
    "includes": [
      "#include \"sshbuf.h\"",
      "#include \"ssherr.h\"",
      "#include \"packet.h\"",
      "#include \"ssh.h\"",
      "#include \"channels.h\"",
      "#include \"misc.h\"",
      "#include \"canohost.h\"",
      "#include \"log.h\"",
      "#include \"mac.h\"",
      "#include \"digest.h\"",
      "#include \"kex.h\"",
      "#include \"sshkey.h\"",
      "#include \"cipher.h\"",
      "#include \"ssh2.h\"",
      "#include \"compat.h\"",
      "#include \"crc32.h\"",
      "#include \"xmalloc.h\"",
      "#include <zlib.h>",
      "#  include <openssl/ec.h>",
      "# include <openssl/evp.h>",
      "# include <openssl/bn.h>",
      "#include <time.h>",
      "#include <signal.h>",
      "#include <limits.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <stdarg.h>",
      "#include <netdb.h>",
      "#include <errno.h>",
      "#include <arpa/inet.h>",
      "#include <netinet/ip.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include \"openbsd-compat/sys-queue.h\"",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "sshbuf_put_string",
          "args": [
            "ssh->state->outgoing_packet",
            "v",
            "len"
          ],
          "line": 2456
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_put_string",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf-getput-basic.c",
          "lines": "347-363",
          "snippet": "int\nsshbuf_put_string(struct sshbuf *buf, const void *v, size_t len)\n{\n\tu_char *d;\n\tint r;\n\n\tif (len > SSHBUF_SIZE_MAX - 4) {\n\t\tSSHBUF_DBG((\"SSH_ERR_NO_BUFFER_SPACE\"));\n\t\treturn SSH_ERR_NO_BUFFER_SPACE;\n\t}\n\tif ((r = sshbuf_reserve(buf, len + 4, &d)) < 0)\n\t\treturn r;\n\tPOKE_U32(d, len);\n\tif (len != 0)\n\t\tmemcpy(d + 4, v, len);\n\treturn 0;\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <stdarg.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <stdarg.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshbuf_put_string(struct sshbuf *buf, const void *v, size_t len)\n{\n\tu_char *d;\n\tint r;\n\n\tif (len > SSHBUF_SIZE_MAX - 4) {\n\t\tSSHBUF_DBG((\"SSH_ERR_NO_BUFFER_SPACE\"));\n\t\treturn SSH_ERR_NO_BUFFER_SPACE;\n\t}\n\tif ((r = sshbuf_reserve(buf, len + 4, &d)) < 0)\n\t\treturn r;\n\tPOKE_U32(d, len);\n\tif (len != 0)\n\t\tmemcpy(d + 4, v, len);\n\treturn 0;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshpkt_put_string(struct ssh *ssh, const void *v, size_t len)\n{\n\treturn sshbuf_put_string(ssh->state->outgoing_packet, v, len);\n}"
  },
  {
    "function_name": "sshpkt_put_u64",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
    "lines": "2447-2451",
    "snippet": "int\nsshpkt_put_u64(struct ssh *ssh, u_int64_t val)\n{\n\treturn sshbuf_put_u64(ssh->state->outgoing_packet, val);\n}",
    "includes": [
      "#include \"sshbuf.h\"",
      "#include \"ssherr.h\"",
      "#include \"packet.h\"",
      "#include \"ssh.h\"",
      "#include \"channels.h\"",
      "#include \"misc.h\"",
      "#include \"canohost.h\"",
      "#include \"log.h\"",
      "#include \"mac.h\"",
      "#include \"digest.h\"",
      "#include \"kex.h\"",
      "#include \"sshkey.h\"",
      "#include \"cipher.h\"",
      "#include \"ssh2.h\"",
      "#include \"compat.h\"",
      "#include \"crc32.h\"",
      "#include \"xmalloc.h\"",
      "#include <zlib.h>",
      "#  include <openssl/ec.h>",
      "# include <openssl/evp.h>",
      "# include <openssl/bn.h>",
      "#include <time.h>",
      "#include <signal.h>",
      "#include <limits.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <stdarg.h>",
      "#include <netdb.h>",
      "#include <errno.h>",
      "#include <arpa/inet.h>",
      "#include <netinet/ip.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include \"openbsd-compat/sys-queue.h\"",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "sshbuf_put_u64",
          "args": [
            "ssh->state->outgoing_packet",
            "val"
          ],
          "line": 2450
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_put_u64",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf-getput-basic.c",
          "lines": "299-309",
          "snippet": "int\nsshbuf_put_u64(struct sshbuf *buf, u_int64_t val)\n{\n\tu_char *p;\n\tint r;\n\n\tif ((r = sshbuf_reserve(buf, 8, &p)) < 0)\n\t\treturn r;\n\tPOKE_U64(p, val);\n\treturn 0;\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <stdarg.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <stdarg.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshbuf_put_u64(struct sshbuf *buf, u_int64_t val)\n{\n\tu_char *p;\n\tint r;\n\n\tif ((r = sshbuf_reserve(buf, 8, &p)) < 0)\n\t\treturn r;\n\tPOKE_U64(p, val);\n\treturn 0;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshpkt_put_u64(struct ssh *ssh, u_int64_t val)\n{\n\treturn sshbuf_put_u64(ssh->state->outgoing_packet, val);\n}"
  },
  {
    "function_name": "sshpkt_put_u32",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
    "lines": "2441-2445",
    "snippet": "int\nsshpkt_put_u32(struct ssh *ssh, u_int32_t val)\n{\n\treturn sshbuf_put_u32(ssh->state->outgoing_packet, val);\n}",
    "includes": [
      "#include \"sshbuf.h\"",
      "#include \"ssherr.h\"",
      "#include \"packet.h\"",
      "#include \"ssh.h\"",
      "#include \"channels.h\"",
      "#include \"misc.h\"",
      "#include \"canohost.h\"",
      "#include \"log.h\"",
      "#include \"mac.h\"",
      "#include \"digest.h\"",
      "#include \"kex.h\"",
      "#include \"sshkey.h\"",
      "#include \"cipher.h\"",
      "#include \"ssh2.h\"",
      "#include \"compat.h\"",
      "#include \"crc32.h\"",
      "#include \"xmalloc.h\"",
      "#include <zlib.h>",
      "#  include <openssl/ec.h>",
      "# include <openssl/evp.h>",
      "# include <openssl/bn.h>",
      "#include <time.h>",
      "#include <signal.h>",
      "#include <limits.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <stdarg.h>",
      "#include <netdb.h>",
      "#include <errno.h>",
      "#include <arpa/inet.h>",
      "#include <netinet/ip.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include \"openbsd-compat/sys-queue.h\"",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "sshbuf_put_u32",
          "args": [
            "ssh->state->outgoing_packet",
            "val"
          ],
          "line": 2444
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_put_u32",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf-getput-basic.c",
          "lines": "311-321",
          "snippet": "int\nsshbuf_put_u32(struct sshbuf *buf, u_int32_t val)\n{\n\tu_char *p;\n\tint r;\n\n\tif ((r = sshbuf_reserve(buf, 4, &p)) < 0)\n\t\treturn r;\n\tPOKE_U32(p, val);\n\treturn 0;\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <stdarg.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <stdarg.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshbuf_put_u32(struct sshbuf *buf, u_int32_t val)\n{\n\tu_char *p;\n\tint r;\n\n\tif ((r = sshbuf_reserve(buf, 4, &p)) < 0)\n\t\treturn r;\n\tPOKE_U32(p, val);\n\treturn 0;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshpkt_put_u32(struct ssh *ssh, u_int32_t val)\n{\n\treturn sshbuf_put_u32(ssh->state->outgoing_packet, val);\n}"
  },
  {
    "function_name": "sshpkt_put_u8",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
    "lines": "2435-2439",
    "snippet": "int\nsshpkt_put_u8(struct ssh *ssh, u_char val)\n{\n\treturn sshbuf_put_u8(ssh->state->outgoing_packet, val);\n}",
    "includes": [
      "#include \"sshbuf.h\"",
      "#include \"ssherr.h\"",
      "#include \"packet.h\"",
      "#include \"ssh.h\"",
      "#include \"channels.h\"",
      "#include \"misc.h\"",
      "#include \"canohost.h\"",
      "#include \"log.h\"",
      "#include \"mac.h\"",
      "#include \"digest.h\"",
      "#include \"kex.h\"",
      "#include \"sshkey.h\"",
      "#include \"cipher.h\"",
      "#include \"ssh2.h\"",
      "#include \"compat.h\"",
      "#include \"crc32.h\"",
      "#include \"xmalloc.h\"",
      "#include <zlib.h>",
      "#  include <openssl/ec.h>",
      "# include <openssl/evp.h>",
      "# include <openssl/bn.h>",
      "#include <time.h>",
      "#include <signal.h>",
      "#include <limits.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <stdarg.h>",
      "#include <netdb.h>",
      "#include <errno.h>",
      "#include <arpa/inet.h>",
      "#include <netinet/ip.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include \"openbsd-compat/sys-queue.h\"",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "sshbuf_put_u8",
          "args": [
            "ssh->state->outgoing_packet",
            "val"
          ],
          "line": 2438
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_put_u8",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf-getput-basic.c",
          "lines": "335-345",
          "snippet": "int\nsshbuf_put_u8(struct sshbuf *buf, u_char val)\n{\n\tu_char *p;\n\tint r;\n\n\tif ((r = sshbuf_reserve(buf, 1, &p)) < 0)\n\t\treturn r;\n\tp[0] = val;\n\treturn 0;\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <stdarg.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <stdarg.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshbuf_put_u8(struct sshbuf *buf, u_char val)\n{\n\tu_char *p;\n\tint r;\n\n\tif ((r = sshbuf_reserve(buf, 1, &p)) < 0)\n\t\treturn r;\n\tp[0] = val;\n\treturn 0;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshpkt_put_u8(struct ssh *ssh, u_char val)\n{\n\treturn sshbuf_put_u8(ssh->state->outgoing_packet, val);\n}"
  },
  {
    "function_name": "sshpkt_putb",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
    "lines": "2429-2433",
    "snippet": "int\nsshpkt_putb(struct ssh *ssh, const struct sshbuf *b)\n{\n\treturn sshbuf_putb(ssh->state->outgoing_packet, b);\n}",
    "includes": [
      "#include \"sshbuf.h\"",
      "#include \"ssherr.h\"",
      "#include \"packet.h\"",
      "#include \"ssh.h\"",
      "#include \"channels.h\"",
      "#include \"misc.h\"",
      "#include \"canohost.h\"",
      "#include \"log.h\"",
      "#include \"mac.h\"",
      "#include \"digest.h\"",
      "#include \"kex.h\"",
      "#include \"sshkey.h\"",
      "#include \"cipher.h\"",
      "#include \"ssh2.h\"",
      "#include \"compat.h\"",
      "#include \"crc32.h\"",
      "#include \"xmalloc.h\"",
      "#include <zlib.h>",
      "#  include <openssl/ec.h>",
      "# include <openssl/evp.h>",
      "# include <openssl/bn.h>",
      "#include <time.h>",
      "#include <signal.h>",
      "#include <limits.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <stdarg.h>",
      "#include <netdb.h>",
      "#include <errno.h>",
      "#include <arpa/inet.h>",
      "#include <netinet/ip.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include \"openbsd-compat/sys-queue.h\"",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "sshbuf_putb",
          "args": [
            "ssh->state->outgoing_packet",
            "b"
          ],
          "line": 2432
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_putb",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf-getput-basic.c",
          "lines": "248-252",
          "snippet": "int\nsshbuf_putb(struct sshbuf *buf, const struct sshbuf *v)\n{\n\treturn sshbuf_put(buf, sshbuf_ptr(v), sshbuf_len(v));\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <stdarg.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <stdarg.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshbuf_putb(struct sshbuf *buf, const struct sshbuf *v)\n{\n\treturn sshbuf_put(buf, sshbuf_ptr(v), sshbuf_len(v));\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshpkt_putb(struct ssh *ssh, const struct sshbuf *b)\n{\n\treturn sshbuf_putb(ssh->state->outgoing_packet, b);\n}"
  },
  {
    "function_name": "sshpkt_put",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
    "lines": "2423-2427",
    "snippet": "int\nsshpkt_put(struct ssh *ssh, const void *v, size_t len)\n{\n\treturn sshbuf_put(ssh->state->outgoing_packet, v, len);\n}",
    "includes": [
      "#include \"sshbuf.h\"",
      "#include \"ssherr.h\"",
      "#include \"packet.h\"",
      "#include \"ssh.h\"",
      "#include \"channels.h\"",
      "#include \"misc.h\"",
      "#include \"canohost.h\"",
      "#include \"log.h\"",
      "#include \"mac.h\"",
      "#include \"digest.h\"",
      "#include \"kex.h\"",
      "#include \"sshkey.h\"",
      "#include \"cipher.h\"",
      "#include \"ssh2.h\"",
      "#include \"compat.h\"",
      "#include \"crc32.h\"",
      "#include \"xmalloc.h\"",
      "#include <zlib.h>",
      "#  include <openssl/ec.h>",
      "# include <openssl/evp.h>",
      "# include <openssl/bn.h>",
      "#include <time.h>",
      "#include <signal.h>",
      "#include <limits.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <stdarg.h>",
      "#include <netdb.h>",
      "#include <errno.h>",
      "#include <arpa/inet.h>",
      "#include <netinet/ip.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include \"openbsd-compat/sys-queue.h\"",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "sshbuf_put",
          "args": [
            "ssh->state->outgoing_packet",
            "v",
            "len"
          ],
          "line": 2426
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_putf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf-getput-basic.c",
          "lines": "254-264",
          "snippet": "int\nsshbuf_putf(struct sshbuf *buf, const char *fmt, ...)\n{\n\tva_list ap;\n\tint r;\n\n\tva_start(ap, fmt);\n\tr = sshbuf_putfv(buf, fmt, ap);\n\tva_end(ap);\n\treturn r;\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <stdarg.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <stdarg.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshbuf_putf(struct sshbuf *buf, const char *fmt, ...)\n{\n\tva_list ap;\n\tint r;\n\n\tva_start(ap, fmt);\n\tr = sshbuf_putfv(buf, fmt, ap);\n\tva_end(ap);\n\treturn r;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshpkt_put(struct ssh *ssh, const void *v, size_t len)\n{\n\treturn sshbuf_put(ssh->state->outgoing_packet, v, len);\n}"
  },
  {
    "function_name": "ssh_packet_set_state",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
    "lines": "2370-2417",
    "snippet": "int\nssh_packet_set_state(struct ssh *ssh, struct sshbuf *m)\n{\n\tstruct session_state *state = ssh->state;\n\tconst u_char *input, *output;\n\tsize_t ilen, olen;\n\tint r;\n\n\tif ((r = kex_from_blob(m, &ssh->kex)) != 0 ||\n\t    (r = newkeys_from_blob(m, ssh, MODE_OUT)) != 0 ||\n\t    (r = newkeys_from_blob(m, ssh, MODE_IN)) != 0 ||\n\t    (r = sshbuf_get_u64(m, &state->rekey_limit)) != 0 ||\n\t    (r = sshbuf_get_u32(m, &state->rekey_interval)) != 0 ||\n\t    (r = sshbuf_get_u32(m, &state->p_send.seqnr)) != 0 ||\n\t    (r = sshbuf_get_u64(m, &state->p_send.blocks)) != 0 ||\n\t    (r = sshbuf_get_u32(m, &state->p_send.packets)) != 0 ||\n\t    (r = sshbuf_get_u64(m, &state->p_send.bytes)) != 0 ||\n\t    (r = sshbuf_get_u32(m, &state->p_read.seqnr)) != 0 ||\n\t    (r = sshbuf_get_u64(m, &state->p_read.blocks)) != 0 ||\n\t    (r = sshbuf_get_u32(m, &state->p_read.packets)) != 0 ||\n\t    (r = sshbuf_get_u64(m, &state->p_read.bytes)) != 0)\n\t\treturn r;\n\t/*\n\t * We set the time here so that in post-auth privsep slave we\n\t * count from the completion of the authentication.\n\t */\n\tstate->rekey_time = monotime();\n\t/* XXX ssh_set_newkeys overrides p_read.packets? XXX */\n\tif ((r = ssh_set_newkeys(ssh, MODE_IN)) != 0 ||\n\t    (r = ssh_set_newkeys(ssh, MODE_OUT)) != 0)\n\t\treturn r;\n\n\tif ((r = ssh_packet_set_postauth(ssh)) != 0)\n\t\treturn r;\n\n\tsshbuf_reset(state->input);\n\tsshbuf_reset(state->output);\n\tif ((r = sshbuf_get_string_direct(m, &input, &ilen)) != 0 ||\n\t    (r = sshbuf_get_string_direct(m, &output, &olen)) != 0 ||\n\t    (r = sshbuf_put(state->input, input, ilen)) != 0 ||\n\t    (r = sshbuf_put(state->output, output, olen)) != 0)\n\t\treturn r;\n\n\tif (sshbuf_len(m))\n\t\treturn SSH_ERR_INVALID_FORMAT;\n\tdebug3(\"%s: done\", __func__);\n\treturn 0;\n}",
    "includes": [
      "#include \"sshbuf.h\"",
      "#include \"ssherr.h\"",
      "#include \"packet.h\"",
      "#include \"ssh.h\"",
      "#include \"channels.h\"",
      "#include \"misc.h\"",
      "#include \"canohost.h\"",
      "#include \"log.h\"",
      "#include \"mac.h\"",
      "#include \"digest.h\"",
      "#include \"kex.h\"",
      "#include \"sshkey.h\"",
      "#include \"cipher.h\"",
      "#include \"ssh2.h\"",
      "#include \"compat.h\"",
      "#include \"crc32.h\"",
      "#include \"xmalloc.h\"",
      "#include <zlib.h>",
      "#  include <openssl/ec.h>",
      "# include <openssl/evp.h>",
      "# include <openssl/bn.h>",
      "#include <time.h>",
      "#include <signal.h>",
      "#include <limits.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <stdarg.h>",
      "#include <netdb.h>",
      "#include <errno.h>",
      "#include <arpa/inet.h>",
      "#include <netinet/ip.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include \"openbsd-compat/sys-queue.h\"",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "debug3",
          "args": [
            "\"%s: done\"",
            "__func__"
          ],
          "line": 2415
        },
        "resolved": true,
        "details": {
          "function_name": "debug3",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/log.c",
          "lines": "242-250",
          "snippet": "void\ndebug3(const char *fmt,...)\n{\n\tva_list args;\n\n\tva_start(args, fmt);\n\tdo_log(SYSLOG_LEVEL_DEBUG3, fmt, args);\n\tva_end(args);\n}",
          "includes": [
            "#include \"log.h\"",
            "# include <vis.h>",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <syslog.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <fcntl.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n# include <vis.h>\n#include <errno.h>\n#include <unistd.h>\n#include <syslog.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <fcntl.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\ndebug3(const char *fmt,...)\n{\n\tva_list args;\n\n\tva_start(args, fmt);\n\tdo_log(SYSLOG_LEVEL_DEBUG3, fmt, args);\n\tva_end(args);\n}"
        }
      },
      {
        "call_info": {
          "callee": "sshbuf_len",
          "args": [
            "m"
          ],
          "line": 2413
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_len",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf.c",
          "lines": "252-258",
          "snippet": "size_t\nsshbuf_len(const struct sshbuf *buf)\n{\n\tif (sshbuf_check_sanity(buf) != 0)\n\t\treturn 0;\n\treturn buf->size - buf->off;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <signal.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <signal.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nsize_t\nsshbuf_len(const struct sshbuf *buf)\n{\n\tif (sshbuf_check_sanity(buf) != 0)\n\t\treturn 0;\n\treturn buf->size - buf->off;\n}"
        }
      },
      {
        "call_info": {
          "callee": "sshbuf_put",
          "args": [
            "state->output",
            "output",
            "olen"
          ],
          "line": 2410
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_putf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf-getput-basic.c",
          "lines": "254-264",
          "snippet": "int\nsshbuf_putf(struct sshbuf *buf, const char *fmt, ...)\n{\n\tva_list ap;\n\tint r;\n\n\tva_start(ap, fmt);\n\tr = sshbuf_putfv(buf, fmt, ap);\n\tva_end(ap);\n\treturn r;\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <stdarg.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <stdarg.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshbuf_putf(struct sshbuf *buf, const char *fmt, ...)\n{\n\tva_list ap;\n\tint r;\n\n\tva_start(ap, fmt);\n\tr = sshbuf_putfv(buf, fmt, ap);\n\tva_end(ap);\n\treturn r;\n}"
        }
      },
      {
        "call_info": {
          "callee": "sshbuf_get_string_direct",
          "args": [
            "m",
            "&output",
            "&olen"
          ],
          "line": 2408
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_get_string_direct",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf-getput-basic.c",
          "lines": "123-147",
          "snippet": "int\nsshbuf_get_string_direct(struct sshbuf *buf, const u_char **valp, size_t *lenp)\n{\n\tsize_t len;\n\tconst u_char *p;\n\tint r;\n\n\tif (valp != NULL)\n\t\t*valp = NULL;\n\tif (lenp != NULL)\n\t\t*lenp = 0;\n\tif ((r = sshbuf_peek_string_direct(buf, &p, &len)) < 0)\n\t\treturn r;\n\tif (valp != NULL)\n\t\t*valp = p;\n\tif (lenp != NULL)\n\t\t*lenp = len;\n\tif (sshbuf_consume(buf, len + 4) != 0) {\n\t\t/* Shouldn't happen */\n\t\tSSHBUF_DBG((\"SSH_ERR_INTERNAL_ERROR\"));\n\t\tSSHBUF_ABORT();\n\t\treturn SSH_ERR_INTERNAL_ERROR;\n\t}\n\treturn 0;\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <stdarg.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <stdarg.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshbuf_get_string_direct(struct sshbuf *buf, const u_char **valp, size_t *lenp)\n{\n\tsize_t len;\n\tconst u_char *p;\n\tint r;\n\n\tif (valp != NULL)\n\t\t*valp = NULL;\n\tif (lenp != NULL)\n\t\t*lenp = 0;\n\tif ((r = sshbuf_peek_string_direct(buf, &p, &len)) < 0)\n\t\treturn r;\n\tif (valp != NULL)\n\t\t*valp = p;\n\tif (lenp != NULL)\n\t\t*lenp = len;\n\tif (sshbuf_consume(buf, len + 4) != 0) {\n\t\t/* Shouldn't happen */\n\t\tSSHBUF_DBG((\"SSH_ERR_INTERNAL_ERROR\"));\n\t\tSSHBUF_ABORT();\n\t\treturn SSH_ERR_INTERNAL_ERROR;\n\t}\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "sshbuf_reset",
          "args": [
            "state->output"
          ],
          "line": 2406
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_reset",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf.c",
          "lines": "168-188",
          "snippet": "void\nsshbuf_reset(struct sshbuf *buf)\n{\n\tu_char *d;\n\n\tif (buf->readonly || buf->refcount > 1) {\n\t\t/* Nonsensical. Just make buffer appear empty */\n\t\tbuf->off = buf->size;\n\t\treturn;\n\t}\n\t(void) sshbuf_check_sanity(buf);\n\tbuf->off = buf->size = 0;\n\tif (buf->alloc != SSHBUF_SIZE_INIT) {\n\t\tif ((d = recallocarray(buf->d, buf->alloc, SSHBUF_SIZE_INIT,\n\t\t    1)) != NULL) {\n\t\t\tbuf->cd = buf->d = d;\n\t\t\tbuf->alloc = SSHBUF_SIZE_INIT;\n\t\t}\n\t}\n\texplicit_bzero(buf->d, SSHBUF_SIZE_INIT);\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <signal.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <signal.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\nsshbuf_reset(struct sshbuf *buf)\n{\n\tu_char *d;\n\n\tif (buf->readonly || buf->refcount > 1) {\n\t\t/* Nonsensical. Just make buffer appear empty */\n\t\tbuf->off = buf->size;\n\t\treturn;\n\t}\n\t(void) sshbuf_check_sanity(buf);\n\tbuf->off = buf->size = 0;\n\tif (buf->alloc != SSHBUF_SIZE_INIT) {\n\t\tif ((d = recallocarray(buf->d, buf->alloc, SSHBUF_SIZE_INIT,\n\t\t    1)) != NULL) {\n\t\t\tbuf->cd = buf->d = d;\n\t\t\tbuf->alloc = SSHBUF_SIZE_INIT;\n\t\t}\n\t}\n\texplicit_bzero(buf->d, SSHBUF_SIZE_INIT);\n}"
        }
      },
      {
        "call_info": {
          "callee": "ssh_packet_set_postauth",
          "args": [
            "ssh"
          ],
          "line": 2402
        },
        "resolved": true,
        "details": {
          "function_name": "ssh_packet_set_postauth",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
          "lines": "2147-2159",
          "snippet": "static int\nssh_packet_set_postauth(struct ssh *ssh)\n{\n\tint r;\n\n\tdebug(\"%s: called\", __func__);\n\t/* This was set in net child, but is not visible in user child */\n\tssh->state->after_authentication = 1;\n\tssh->state->rekeying = 0;\n\tif ((r = ssh_packet_enable_delayed_compress(ssh)) != 0)\n\t\treturn r;\n\treturn 0;\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include \"packet.h\"",
            "#include \"ssh.h\"",
            "#include \"channels.h\"",
            "#include \"misc.h\"",
            "#include \"canohost.h\"",
            "#include \"log.h\"",
            "#include \"mac.h\"",
            "#include \"digest.h\"",
            "#include \"kex.h\"",
            "#include \"sshkey.h\"",
            "#include \"cipher.h\"",
            "#include \"ssh2.h\"",
            "#include \"compat.h\"",
            "#include \"crc32.h\"",
            "#include \"xmalloc.h\"",
            "#include <zlib.h>",
            "#  include <openssl/ec.h>",
            "# include <openssl/evp.h>",
            "# include <openssl/bn.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <limits.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <netdb.h>",
            "#include <errno.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include \"openbsd-compat/sys-queue.h\"",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nstatic int\nssh_packet_set_postauth(struct ssh *ssh)\n{\n\tint r;\n\n\tdebug(\"%s: called\", __func__);\n\t/* This was set in net child, but is not visible in user child */\n\tssh->state->after_authentication = 1;\n\tssh->state->rekeying = 0;\n\tif ((r = ssh_packet_enable_delayed_compress(ssh)) != 0)\n\t\treturn r;\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "ssh_set_newkeys",
          "args": [
            "ssh",
            "MODE_OUT"
          ],
          "line": 2399
        },
        "resolved": true,
        "details": {
          "function_name": "ssh_set_newkeys",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
          "lines": "828-921",
          "snippet": "int\nssh_set_newkeys(struct ssh *ssh, int mode)\n{\n\tstruct session_state *state = ssh->state;\n\tstruct sshenc *enc;\n\tstruct sshmac *mac;\n\tstruct sshcomp *comp;\n\tstruct sshcipher_ctx **ccp;\n\tstruct packet_state *ps;\n\tu_int64_t *max_blocks;\n\tconst char *wmsg;\n\tint r, crypt_type;\n\n\tdebug2(\"set_newkeys: mode %d\", mode);\n\n\tif (mode == MODE_OUT) {\n\t\tccp = &state->send_context;\n\t\tcrypt_type = CIPHER_ENCRYPT;\n\t\tps = &state->p_send;\n\t\tmax_blocks = &state->max_blocks_out;\n\t} else {\n\t\tccp = &state->receive_context;\n\t\tcrypt_type = CIPHER_DECRYPT;\n\t\tps = &state->p_read;\n\t\tmax_blocks = &state->max_blocks_in;\n\t}\n\tif (state->newkeys[mode] != NULL) {\n\t\tdebug(\"set_newkeys: rekeying, input %llu bytes %llu blocks, \"\n\t\t   \"output %llu bytes %llu blocks\",\n\t\t   (unsigned long long)state->p_read.bytes,\n\t\t   (unsigned long long)state->p_read.blocks,\n\t\t   (unsigned long long)state->p_send.bytes,\n\t\t   (unsigned long long)state->p_send.blocks);\n\t\tcipher_free(*ccp);\n\t\t*ccp = NULL;\n\t\tkex_free_newkeys(state->newkeys[mode]);\n\t\tstate->newkeys[mode] = NULL;\n\t}\n\t/* note that both bytes and the seqnr are not reset */\n\tps->packets = ps->blocks = 0;\n\t/* move newkeys from kex to state */\n\tif ((state->newkeys[mode] = ssh->kex->newkeys[mode]) == NULL)\n\t\treturn SSH_ERR_INTERNAL_ERROR;\n\tssh->kex->newkeys[mode] = NULL;\n\tenc  = &state->newkeys[mode]->enc;\n\tmac  = &state->newkeys[mode]->mac;\n\tcomp = &state->newkeys[mode]->comp;\n\tif (cipher_authlen(enc->cipher) == 0) {\n\t\tif ((r = mac_init(mac)) != 0)\n\t\t\treturn r;\n\t}\n\tmac->enabled = 1;\n\tDBG(debug(\"cipher_init_context: %d\", mode));\n\tif ((r = cipher_init(ccp, enc->cipher, enc->key, enc->key_len,\n\t    enc->iv, enc->iv_len, crypt_type)) != 0)\n\t\treturn r;\n\tif (!state->cipher_warning_done &&\n\t    (wmsg = cipher_warning_message(*ccp)) != NULL) {\n\t\terror(\"Warning: %s\", wmsg);\n\t\tstate->cipher_warning_done = 1;\n\t}\n\t/* Deleting the keys does not gain extra security */\n\t/* explicit_bzero(enc->iv,  enc->block_size);\n\t   explicit_bzero(enc->key, enc->key_len);\n\t   explicit_bzero(mac->key, mac->key_len); */\n\tif ((comp->type == COMP_ZLIB ||\n\t    (comp->type == COMP_DELAYED &&\n\t     state->after_authentication)) && comp->enabled == 0) {\n\t\tif ((r = ssh_packet_init_compression(ssh)) < 0)\n\t\t\treturn r;\n\t\tif (mode == MODE_OUT) {\n\t\t\tif ((r = start_compression_out(ssh, 6)) != 0)\n\t\t\t\treturn r;\n\t\t} else {\n\t\t\tif ((r = start_compression_in(ssh)) != 0)\n\t\t\t\treturn r;\n\t\t}\n\t\tcomp->enabled = 1;\n\t}\n\t/*\n\t * The 2^(blocksize*2) limit is too expensive for 3DES,\n\t * so enforce a 1GB limit for small blocksizes.\n\t * See RFC4344 section 3.2.\n\t */\n\tif (enc->block_size >= 16)\n\t\t*max_blocks = (u_int64_t)1 << (enc->block_size*2);\n\telse\n\t\t*max_blocks = ((u_int64_t)1 << 30) / enc->block_size;\n\tif (state->rekey_limit)\n\t\t*max_blocks = MINIMUM(*max_blocks,\n\t\t    state->rekey_limit / enc->block_size);\n\tdebug(\"rekey after %llu blocks\", (unsigned long long)*max_blocks);\n\treturn 0;\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include \"packet.h\"",
            "#include \"ssh.h\"",
            "#include \"channels.h\"",
            "#include \"misc.h\"",
            "#include \"canohost.h\"",
            "#include \"log.h\"",
            "#include \"mac.h\"",
            "#include \"digest.h\"",
            "#include \"kex.h\"",
            "#include \"sshkey.h\"",
            "#include \"cipher.h\"",
            "#include \"ssh2.h\"",
            "#include \"compat.h\"",
            "#include \"crc32.h\"",
            "#include \"xmalloc.h\"",
            "#include <zlib.h>",
            "#  include <openssl/ec.h>",
            "# include <openssl/evp.h>",
            "# include <openssl/bn.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <limits.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <netdb.h>",
            "#include <errno.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include \"openbsd-compat/sys-queue.h\"",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nssh_set_newkeys(struct ssh *ssh, int mode)\n{\n\tstruct session_state *state = ssh->state;\n\tstruct sshenc *enc;\n\tstruct sshmac *mac;\n\tstruct sshcomp *comp;\n\tstruct sshcipher_ctx **ccp;\n\tstruct packet_state *ps;\n\tu_int64_t *max_blocks;\n\tconst char *wmsg;\n\tint r, crypt_type;\n\n\tdebug2(\"set_newkeys: mode %d\", mode);\n\n\tif (mode == MODE_OUT) {\n\t\tccp = &state->send_context;\n\t\tcrypt_type = CIPHER_ENCRYPT;\n\t\tps = &state->p_send;\n\t\tmax_blocks = &state->max_blocks_out;\n\t} else {\n\t\tccp = &state->receive_context;\n\t\tcrypt_type = CIPHER_DECRYPT;\n\t\tps = &state->p_read;\n\t\tmax_blocks = &state->max_blocks_in;\n\t}\n\tif (state->newkeys[mode] != NULL) {\n\t\tdebug(\"set_newkeys: rekeying, input %llu bytes %llu blocks, \"\n\t\t   \"output %llu bytes %llu blocks\",\n\t\t   (unsigned long long)state->p_read.bytes,\n\t\t   (unsigned long long)state->p_read.blocks,\n\t\t   (unsigned long long)state->p_send.bytes,\n\t\t   (unsigned long long)state->p_send.blocks);\n\t\tcipher_free(*ccp);\n\t\t*ccp = NULL;\n\t\tkex_free_newkeys(state->newkeys[mode]);\n\t\tstate->newkeys[mode] = NULL;\n\t}\n\t/* note that both bytes and the seqnr are not reset */\n\tps->packets = ps->blocks = 0;\n\t/* move newkeys from kex to state */\n\tif ((state->newkeys[mode] = ssh->kex->newkeys[mode]) == NULL)\n\t\treturn SSH_ERR_INTERNAL_ERROR;\n\tssh->kex->newkeys[mode] = NULL;\n\tenc  = &state->newkeys[mode]->enc;\n\tmac  = &state->newkeys[mode]->mac;\n\tcomp = &state->newkeys[mode]->comp;\n\tif (cipher_authlen(enc->cipher) == 0) {\n\t\tif ((r = mac_init(mac)) != 0)\n\t\t\treturn r;\n\t}\n\tmac->enabled = 1;\n\tDBG(debug(\"cipher_init_context: %d\", mode));\n\tif ((r = cipher_init(ccp, enc->cipher, enc->key, enc->key_len,\n\t    enc->iv, enc->iv_len, crypt_type)) != 0)\n\t\treturn r;\n\tif (!state->cipher_warning_done &&\n\t    (wmsg = cipher_warning_message(*ccp)) != NULL) {\n\t\terror(\"Warning: %s\", wmsg);\n\t\tstate->cipher_warning_done = 1;\n\t}\n\t/* Deleting the keys does not gain extra security */\n\t/* explicit_bzero(enc->iv,  enc->block_size);\n\t   explicit_bzero(enc->key, enc->key_len);\n\t   explicit_bzero(mac->key, mac->key_len); */\n\tif ((comp->type == COMP_ZLIB ||\n\t    (comp->type == COMP_DELAYED &&\n\t     state->after_authentication)) && comp->enabled == 0) {\n\t\tif ((r = ssh_packet_init_compression(ssh)) < 0)\n\t\t\treturn r;\n\t\tif (mode == MODE_OUT) {\n\t\t\tif ((r = start_compression_out(ssh, 6)) != 0)\n\t\t\t\treturn r;\n\t\t} else {\n\t\t\tif ((r = start_compression_in(ssh)) != 0)\n\t\t\t\treturn r;\n\t\t}\n\t\tcomp->enabled = 1;\n\t}\n\t/*\n\t * The 2^(blocksize*2) limit is too expensive for 3DES,\n\t * so enforce a 1GB limit for small blocksizes.\n\t * See RFC4344 section 3.2.\n\t */\n\tif (enc->block_size >= 16)\n\t\t*max_blocks = (u_int64_t)1 << (enc->block_size*2);\n\telse\n\t\t*max_blocks = ((u_int64_t)1 << 30) / enc->block_size;\n\tif (state->rekey_limit)\n\t\t*max_blocks = MINIMUM(*max_blocks,\n\t\t    state->rekey_limit / enc->block_size);\n\tdebug(\"rekey after %llu blocks\", (unsigned long long)*max_blocks);\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "monotime",
          "args": [],
          "line": 2396
        },
        "resolved": true,
        "details": {
          "function_name": "monotime_double",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/misc.c",
          "lines": "1324-1331",
          "snippet": "double\nmonotime_double(void)\n{\n\tstruct timespec ts;\n\n\tmonotime_ts(&ts);\n\treturn ts.tv_sec + ((double)ts.tv_nsec / 1000000000);\n}",
          "includes": [
            "#include \"platform.h\"",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"ssh.h\"",
            "#include \"log.h\"",
            "#include \"misc.h\"",
            "#include \"xmalloc.h\"",
            "#include <net/if.h>",
            "#include <pwd.h>",
            "# include <paths.h>",
            "#include <netdb.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <ctype.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/tcp.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in_systm.h>",
            "#include <netinet/in.h>",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <libgen.h>",
            "#include <limits.h>",
            "#include <sys/un.h>",
            "#include <sys/wait.h>",
            "#include <sys/time.h>",
            "#include <sys/stat.h>",
            "#include <sys/socket.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"platform.h\"\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"ssh.h\"\n#include \"log.h\"\n#include \"misc.h\"\n#include \"xmalloc.h\"\n#include <net/if.h>\n#include <pwd.h>\n# include <paths.h>\n#include <netdb.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <ctype.h>\n#include <arpa/inet.h>\n#include <netinet/tcp.h>\n#include <netinet/ip.h>\n#include <netinet/in_systm.h>\n#include <netinet/in.h>\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <libgen.h>\n#include <limits.h>\n#include <sys/un.h>\n#include <sys/wait.h>\n#include <sys/time.h>\n#include <sys/stat.h>\n#include <sys/socket.h>\n#include <sys/ioctl.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\ndouble\nmonotime_double(void)\n{\n\tstruct timespec ts;\n\n\tmonotime_ts(&ts);\n\treturn ts.tv_sec + ((double)ts.tv_nsec / 1000000000);\n}"
        }
      },
      {
        "call_info": {
          "callee": "sshbuf_get_u64",
          "args": [
            "m",
            "&state->p_read.bytes"
          ],
          "line": 2390
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_get_u64",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf-getput-basic.c",
          "lines": "44-55",
          "snippet": "int\nsshbuf_get_u64(struct sshbuf *buf, u_int64_t *valp)\n{\n\tconst u_char *p = sshbuf_ptr(buf);\n\tint r;\n\n\tif ((r = sshbuf_consume(buf, 8)) < 0)\n\t\treturn r;\n\tif (valp != NULL)\n\t\t*valp = PEEK_U64(p);\n\treturn 0;\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <stdarg.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <stdarg.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshbuf_get_u64(struct sshbuf *buf, u_int64_t *valp)\n{\n\tconst u_char *p = sshbuf_ptr(buf);\n\tint r;\n\n\tif ((r = sshbuf_consume(buf, 8)) < 0)\n\t\treturn r;\n\tif (valp != NULL)\n\t\t*valp = PEEK_U64(p);\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "sshbuf_get_u32",
          "args": [
            "m",
            "&state->p_read.packets"
          ],
          "line": 2389
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_get_u32",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf-getput-basic.c",
          "lines": "57-68",
          "snippet": "int\nsshbuf_get_u32(struct sshbuf *buf, u_int32_t *valp)\n{\n\tconst u_char *p = sshbuf_ptr(buf);\n\tint r;\n\n\tif ((r = sshbuf_consume(buf, 4)) < 0)\n\t\treturn r;\n\tif (valp != NULL)\n\t\t*valp = PEEK_U32(p);\n\treturn 0;\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <stdarg.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <stdarg.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshbuf_get_u32(struct sshbuf *buf, u_int32_t *valp)\n{\n\tconst u_char *p = sshbuf_ptr(buf);\n\tint r;\n\n\tif ((r = sshbuf_consume(buf, 4)) < 0)\n\t\treturn r;\n\tif (valp != NULL)\n\t\t*valp = PEEK_U32(p);\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "newkeys_from_blob",
          "args": [
            "m",
            "ssh",
            "MODE_IN"
          ],
          "line": 2380
        },
        "resolved": true,
        "details": {
          "function_name": "newkeys_from_blob",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
          "lines": "2257-2321",
          "snippet": "static int\nnewkeys_from_blob(struct sshbuf *m, struct ssh *ssh, int mode)\n{\n\tstruct sshbuf *b = NULL;\n\tstruct sshcomp *comp;\n\tstruct sshenc *enc;\n\tstruct sshmac *mac;\n\tstruct newkeys *newkey = NULL;\n\tsize_t keylen, ivlen, maclen;\n\tint r;\n\n\tif ((newkey = calloc(1, sizeof(*newkey))) == NULL) {\n\t\tr = SSH_ERR_ALLOC_FAIL;\n\t\tgoto out;\n\t}\n\tif ((r = sshbuf_froms(m, &b)) != 0)\n\t\tgoto out;\n#ifdef DEBUG_PK\n\tsshbuf_dump(b, stderr);\n#endif\n\tenc = &newkey->enc;\n\tmac = &newkey->mac;\n\tcomp = &newkey->comp;\n\n\tif ((r = sshbuf_get_cstring(b, &enc->name, NULL)) != 0 ||\n\t    (r = sshbuf_get_u32(b, (u_int *)&enc->enabled)) != 0 ||\n\t    (r = sshbuf_get_u32(b, &enc->block_size)) != 0 ||\n\t    (r = sshbuf_get_string(b, &enc->key, &keylen)) != 0 ||\n\t    (r = sshbuf_get_string(b, &enc->iv, &ivlen)) != 0)\n\t\tgoto out;\n\tif ((enc->cipher = cipher_by_name(enc->name)) == NULL) {\n\t\tr = SSH_ERR_INVALID_FORMAT;\n\t\tgoto out;\n\t}\n\tif (cipher_authlen(enc->cipher) == 0) {\n\t\tif ((r = sshbuf_get_cstring(b, &mac->name, NULL)) != 0)\n\t\t\tgoto out;\n\t\tif ((r = mac_setup(mac, mac->name)) != 0)\n\t\t\tgoto out;\n\t\tif ((r = sshbuf_get_u32(b, (u_int *)&mac->enabled)) != 0 ||\n\t\t    (r = sshbuf_get_string(b, &mac->key, &maclen)) != 0)\n\t\t\tgoto out;\n\t\tif (maclen > mac->key_len) {\n\t\t\tr = SSH_ERR_INVALID_FORMAT;\n\t\t\tgoto out;\n\t\t}\n\t\tmac->key_len = maclen;\n\t}\n\tif ((r = sshbuf_get_u32(b, &comp->type)) != 0 ||\n\t    (r = sshbuf_get_cstring(b, &comp->name, NULL)) != 0)\n\t\tgoto out;\n\tif (sshbuf_len(b) != 0) {\n\t\tr = SSH_ERR_INVALID_FORMAT;\n\t\tgoto out;\n\t}\n\tenc->key_len = keylen;\n\tenc->iv_len = ivlen;\n\tssh->kex->newkeys[mode] = newkey;\n\tnewkey = NULL;\n\tr = 0;\n out:\n\tfree(newkey);\n\tsshbuf_free(b);\n\treturn r;\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include \"packet.h\"",
            "#include \"ssh.h\"",
            "#include \"channels.h\"",
            "#include \"misc.h\"",
            "#include \"canohost.h\"",
            "#include \"log.h\"",
            "#include \"mac.h\"",
            "#include \"digest.h\"",
            "#include \"kex.h\"",
            "#include \"sshkey.h\"",
            "#include \"cipher.h\"",
            "#include \"ssh2.h\"",
            "#include \"compat.h\"",
            "#include \"crc32.h\"",
            "#include \"xmalloc.h\"",
            "#include <zlib.h>",
            "#  include <openssl/ec.h>",
            "# include <openssl/evp.h>",
            "# include <openssl/bn.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <limits.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <netdb.h>",
            "#include <errno.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include \"openbsd-compat/sys-queue.h\"",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nstatic int\nnewkeys_from_blob(struct sshbuf *m, struct ssh *ssh, int mode)\n{\n\tstruct sshbuf *b = NULL;\n\tstruct sshcomp *comp;\n\tstruct sshenc *enc;\n\tstruct sshmac *mac;\n\tstruct newkeys *newkey = NULL;\n\tsize_t keylen, ivlen, maclen;\n\tint r;\n\n\tif ((newkey = calloc(1, sizeof(*newkey))) == NULL) {\n\t\tr = SSH_ERR_ALLOC_FAIL;\n\t\tgoto out;\n\t}\n\tif ((r = sshbuf_froms(m, &b)) != 0)\n\t\tgoto out;\n#ifdef DEBUG_PK\n\tsshbuf_dump(b, stderr);\n#endif\n\tenc = &newkey->enc;\n\tmac = &newkey->mac;\n\tcomp = &newkey->comp;\n\n\tif ((r = sshbuf_get_cstring(b, &enc->name, NULL)) != 0 ||\n\t    (r = sshbuf_get_u32(b, (u_int *)&enc->enabled)) != 0 ||\n\t    (r = sshbuf_get_u32(b, &enc->block_size)) != 0 ||\n\t    (r = sshbuf_get_string(b, &enc->key, &keylen)) != 0 ||\n\t    (r = sshbuf_get_string(b, &enc->iv, &ivlen)) != 0)\n\t\tgoto out;\n\tif ((enc->cipher = cipher_by_name(enc->name)) == NULL) {\n\t\tr = SSH_ERR_INVALID_FORMAT;\n\t\tgoto out;\n\t}\n\tif (cipher_authlen(enc->cipher) == 0) {\n\t\tif ((r = sshbuf_get_cstring(b, &mac->name, NULL)) != 0)\n\t\t\tgoto out;\n\t\tif ((r = mac_setup(mac, mac->name)) != 0)\n\t\t\tgoto out;\n\t\tif ((r = sshbuf_get_u32(b, (u_int *)&mac->enabled)) != 0 ||\n\t\t    (r = sshbuf_get_string(b, &mac->key, &maclen)) != 0)\n\t\t\tgoto out;\n\t\tif (maclen > mac->key_len) {\n\t\t\tr = SSH_ERR_INVALID_FORMAT;\n\t\t\tgoto out;\n\t\t}\n\t\tmac->key_len = maclen;\n\t}\n\tif ((r = sshbuf_get_u32(b, &comp->type)) != 0 ||\n\t    (r = sshbuf_get_cstring(b, &comp->name, NULL)) != 0)\n\t\tgoto out;\n\tif (sshbuf_len(b) != 0) {\n\t\tr = SSH_ERR_INVALID_FORMAT;\n\t\tgoto out;\n\t}\n\tenc->key_len = keylen;\n\tenc->iv_len = ivlen;\n\tssh->kex->newkeys[mode] = newkey;\n\tnewkey = NULL;\n\tr = 0;\n out:\n\tfree(newkey);\n\tsshbuf_free(b);\n\treturn r;\n}"
        }
      },
      {
        "call_info": {
          "callee": "kex_from_blob",
          "args": [
            "m",
            "&ssh->kex"
          ],
          "line": 2378
        },
        "resolved": true,
        "details": {
          "function_name": "kex_from_blob",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
          "lines": "2324-2364",
          "snippet": "static int\nkex_from_blob(struct sshbuf *m, struct kex **kexp)\n{\n\tstruct kex *kex;\n\tint r;\n\n\tif ((kex = calloc(1, sizeof(struct kex))) == NULL ||\n\t    (kex->my = sshbuf_new()) == NULL ||\n\t    (kex->peer = sshbuf_new()) == NULL) {\n\t\tr = SSH_ERR_ALLOC_FAIL;\n\t\tgoto out;\n\t}\n\tif ((r = sshbuf_get_string(m, &kex->session_id, &kex->session_id_len)) != 0 ||\n\t    (r = sshbuf_get_u32(m, &kex->we_need)) != 0 ||\n\t    (r = sshbuf_get_cstring(m, &kex->hostkey_alg, NULL)) != 0 ||\n\t    (r = sshbuf_get_u32(m, (u_int *)&kex->hostkey_type)) != 0 ||\n\t    (r = sshbuf_get_u32(m, (u_int *)&kex->hostkey_nid)) != 0 ||\n\t    (r = sshbuf_get_u32(m, &kex->kex_type)) != 0 ||\n\t    (r = sshbuf_get_stringb(m, kex->my)) != 0 ||\n\t    (r = sshbuf_get_stringb(m, kex->peer)) != 0 ||\n\t    (r = sshbuf_get_u32(m, &kex->flags)) != 0 ||\n\t    (r = sshbuf_get_cstring(m, &kex->client_version_string, NULL)) != 0 ||\n\t    (r = sshbuf_get_cstring(m, &kex->server_version_string, NULL)) != 0)\n\t\tgoto out;\n\tkex->server = 1;\n\tkex->done = 1;\n\tr = 0;\n out:\n\tif (r != 0 || kexp == NULL) {\n\t\tif (kex != NULL) {\n\t\t\tsshbuf_free(kex->my);\n\t\t\tsshbuf_free(kex->peer);\n\t\t\tfree(kex);\n\t\t}\n\t\tif (kexp != NULL)\n\t\t\t*kexp = NULL;\n\t} else {\n\t\t*kexp = kex;\n\t}\n\treturn r;\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include \"packet.h\"",
            "#include \"ssh.h\"",
            "#include \"channels.h\"",
            "#include \"misc.h\"",
            "#include \"canohost.h\"",
            "#include \"log.h\"",
            "#include \"mac.h\"",
            "#include \"digest.h\"",
            "#include \"kex.h\"",
            "#include \"sshkey.h\"",
            "#include \"cipher.h\"",
            "#include \"ssh2.h\"",
            "#include \"compat.h\"",
            "#include \"crc32.h\"",
            "#include \"xmalloc.h\"",
            "#include <zlib.h>",
            "#  include <openssl/ec.h>",
            "# include <openssl/evp.h>",
            "# include <openssl/bn.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <limits.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <netdb.h>",
            "#include <errno.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include \"openbsd-compat/sys-queue.h\"",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nstatic int\nkex_from_blob(struct sshbuf *m, struct kex **kexp)\n{\n\tstruct kex *kex;\n\tint r;\n\n\tif ((kex = calloc(1, sizeof(struct kex))) == NULL ||\n\t    (kex->my = sshbuf_new()) == NULL ||\n\t    (kex->peer = sshbuf_new()) == NULL) {\n\t\tr = SSH_ERR_ALLOC_FAIL;\n\t\tgoto out;\n\t}\n\tif ((r = sshbuf_get_string(m, &kex->session_id, &kex->session_id_len)) != 0 ||\n\t    (r = sshbuf_get_u32(m, &kex->we_need)) != 0 ||\n\t    (r = sshbuf_get_cstring(m, &kex->hostkey_alg, NULL)) != 0 ||\n\t    (r = sshbuf_get_u32(m, (u_int *)&kex->hostkey_type)) != 0 ||\n\t    (r = sshbuf_get_u32(m, (u_int *)&kex->hostkey_nid)) != 0 ||\n\t    (r = sshbuf_get_u32(m, &kex->kex_type)) != 0 ||\n\t    (r = sshbuf_get_stringb(m, kex->my)) != 0 ||\n\t    (r = sshbuf_get_stringb(m, kex->peer)) != 0 ||\n\t    (r = sshbuf_get_u32(m, &kex->flags)) != 0 ||\n\t    (r = sshbuf_get_cstring(m, &kex->client_version_string, NULL)) != 0 ||\n\t    (r = sshbuf_get_cstring(m, &kex->server_version_string, NULL)) != 0)\n\t\tgoto out;\n\tkex->server = 1;\n\tkex->done = 1;\n\tr = 0;\n out:\n\tif (r != 0 || kexp == NULL) {\n\t\tif (kex != NULL) {\n\t\t\tsshbuf_free(kex->my);\n\t\t\tsshbuf_free(kex->peer);\n\t\t\tfree(kex);\n\t\t}\n\t\tif (kexp != NULL)\n\t\t\t*kexp = NULL;\n\t} else {\n\t\t*kexp = kex;\n\t}\n\treturn r;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nssh_packet_set_state(struct ssh *ssh, struct sshbuf *m)\n{\n\tstruct session_state *state = ssh->state;\n\tconst u_char *input, *output;\n\tsize_t ilen, olen;\n\tint r;\n\n\tif ((r = kex_from_blob(m, &ssh->kex)) != 0 ||\n\t    (r = newkeys_from_blob(m, ssh, MODE_OUT)) != 0 ||\n\t    (r = newkeys_from_blob(m, ssh, MODE_IN)) != 0 ||\n\t    (r = sshbuf_get_u64(m, &state->rekey_limit)) != 0 ||\n\t    (r = sshbuf_get_u32(m, &state->rekey_interval)) != 0 ||\n\t    (r = sshbuf_get_u32(m, &state->p_send.seqnr)) != 0 ||\n\t    (r = sshbuf_get_u64(m, &state->p_send.blocks)) != 0 ||\n\t    (r = sshbuf_get_u32(m, &state->p_send.packets)) != 0 ||\n\t    (r = sshbuf_get_u64(m, &state->p_send.bytes)) != 0 ||\n\t    (r = sshbuf_get_u32(m, &state->p_read.seqnr)) != 0 ||\n\t    (r = sshbuf_get_u64(m, &state->p_read.blocks)) != 0 ||\n\t    (r = sshbuf_get_u32(m, &state->p_read.packets)) != 0 ||\n\t    (r = sshbuf_get_u64(m, &state->p_read.bytes)) != 0)\n\t\treturn r;\n\t/*\n\t * We set the time here so that in post-auth privsep slave we\n\t * count from the completion of the authentication.\n\t */\n\tstate->rekey_time = monotime();\n\t/* XXX ssh_set_newkeys overrides p_read.packets? XXX */\n\tif ((r = ssh_set_newkeys(ssh, MODE_IN)) != 0 ||\n\t    (r = ssh_set_newkeys(ssh, MODE_OUT)) != 0)\n\t\treturn r;\n\n\tif ((r = ssh_packet_set_postauth(ssh)) != 0)\n\t\treturn r;\n\n\tsshbuf_reset(state->input);\n\tsshbuf_reset(state->output);\n\tif ((r = sshbuf_get_string_direct(m, &input, &ilen)) != 0 ||\n\t    (r = sshbuf_get_string_direct(m, &output, &olen)) != 0 ||\n\t    (r = sshbuf_put(state->input, input, ilen)) != 0 ||\n\t    (r = sshbuf_put(state->output, output, olen)) != 0)\n\t\treturn r;\n\n\tif (sshbuf_len(m))\n\t\treturn SSH_ERR_INVALID_FORMAT;\n\tdebug3(\"%s: done\", __func__);\n\treturn 0;\n}"
  },
  {
    "function_name": "kex_from_blob",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
    "lines": "2324-2364",
    "snippet": "static int\nkex_from_blob(struct sshbuf *m, struct kex **kexp)\n{\n\tstruct kex *kex;\n\tint r;\n\n\tif ((kex = calloc(1, sizeof(struct kex))) == NULL ||\n\t    (kex->my = sshbuf_new()) == NULL ||\n\t    (kex->peer = sshbuf_new()) == NULL) {\n\t\tr = SSH_ERR_ALLOC_FAIL;\n\t\tgoto out;\n\t}\n\tif ((r = sshbuf_get_string(m, &kex->session_id, &kex->session_id_len)) != 0 ||\n\t    (r = sshbuf_get_u32(m, &kex->we_need)) != 0 ||\n\t    (r = sshbuf_get_cstring(m, &kex->hostkey_alg, NULL)) != 0 ||\n\t    (r = sshbuf_get_u32(m, (u_int *)&kex->hostkey_type)) != 0 ||\n\t    (r = sshbuf_get_u32(m, (u_int *)&kex->hostkey_nid)) != 0 ||\n\t    (r = sshbuf_get_u32(m, &kex->kex_type)) != 0 ||\n\t    (r = sshbuf_get_stringb(m, kex->my)) != 0 ||\n\t    (r = sshbuf_get_stringb(m, kex->peer)) != 0 ||\n\t    (r = sshbuf_get_u32(m, &kex->flags)) != 0 ||\n\t    (r = sshbuf_get_cstring(m, &kex->client_version_string, NULL)) != 0 ||\n\t    (r = sshbuf_get_cstring(m, &kex->server_version_string, NULL)) != 0)\n\t\tgoto out;\n\tkex->server = 1;\n\tkex->done = 1;\n\tr = 0;\n out:\n\tif (r != 0 || kexp == NULL) {\n\t\tif (kex != NULL) {\n\t\t\tsshbuf_free(kex->my);\n\t\t\tsshbuf_free(kex->peer);\n\t\t\tfree(kex);\n\t\t}\n\t\tif (kexp != NULL)\n\t\t\t*kexp = NULL;\n\t} else {\n\t\t*kexp = kex;\n\t}\n\treturn r;\n}",
    "includes": [
      "#include \"sshbuf.h\"",
      "#include \"ssherr.h\"",
      "#include \"packet.h\"",
      "#include \"ssh.h\"",
      "#include \"channels.h\"",
      "#include \"misc.h\"",
      "#include \"canohost.h\"",
      "#include \"log.h\"",
      "#include \"mac.h\"",
      "#include \"digest.h\"",
      "#include \"kex.h\"",
      "#include \"sshkey.h\"",
      "#include \"cipher.h\"",
      "#include \"ssh2.h\"",
      "#include \"compat.h\"",
      "#include \"crc32.h\"",
      "#include \"xmalloc.h\"",
      "#include <zlib.h>",
      "#  include <openssl/ec.h>",
      "# include <openssl/evp.h>",
      "# include <openssl/bn.h>",
      "#include <time.h>",
      "#include <signal.h>",
      "#include <limits.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <stdarg.h>",
      "#include <netdb.h>",
      "#include <errno.h>",
      "#include <arpa/inet.h>",
      "#include <netinet/ip.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include \"openbsd-compat/sys-queue.h\"",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "kex"
          ],
          "line": 2356
        },
        "resolved": true,
        "details": {
          "function_name": "freeze",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/smult_curve25519_ref.c",
          "lines": "50-60",
          "snippet": "static void freeze(unsigned int a[32])\n{\n  unsigned int aorig[32];\n  unsigned int j;\n  unsigned int negative;\n\n  for (j = 0;j < 32;++j) aorig[j] = a[j];\n  add(a,a,minusp);\n  negative = -((a[31] >> 7) & 1);\n  for (j = 0;j < 32;++j) a[j] ^= negative & (aorig[j] ^ a[j]);\n}",
          "includes": [],
          "macros_used": [],
          "globals_used": [
            "static const unsigned int minusp[32] = {\n 19, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 128\n} ;"
          ],
          "called_functions": [],
          "contextual_snippet": "static const unsigned int minusp[32] = {\n 19, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 128\n} ;\n\nstatic void freeze(unsigned int a[32])\n{\n  unsigned int aorig[32];\n  unsigned int j;\n  unsigned int negative;\n\n  for (j = 0;j < 32;++j) aorig[j] = a[j];\n  add(a,a,minusp);\n  negative = -((a[31] >> 7) & 1);\n  for (j = 0;j < 32;++j) a[j] ^= negative & (aorig[j] ^ a[j]);\n}"
        }
      },
      {
        "call_info": {
          "callee": "sshbuf_free",
          "args": [
            "kex->peer"
          ],
          "line": 2355
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf.c",
          "lines": "133-166",
          "snippet": "void\nsshbuf_free(struct sshbuf *buf)\n{\n\tif (buf == NULL)\n\t\treturn;\n\t/*\n\t * The following will leak on insane buffers, but this is the safest\n\t * course of action - an invalid pointer or already-freed pointer may\n\t * have been passed to us and continuing to scribble over memory would\n\t * be bad.\n\t */\n\tif (sshbuf_check_sanity(buf) != 0)\n\t\treturn;\n\t/*\n\t * If we are a child, the free our parent to decrement its reference\n\t * count and possibly free it.\n\t */\n\tsshbuf_free(buf->parent);\n\tbuf->parent = NULL;\n\t/*\n\t * If we are a parent with still-extant children, then don't free just\n\t * yet. The last child's call to sshbuf_free should decrement our\n\t * refcount to 0 and trigger the actual free.\n\t */\n\tbuf->refcount--;\n\tif (buf->refcount > 0)\n\t\treturn;\n\tif (!buf->readonly) {\n\t\texplicit_bzero(buf->d, buf->alloc);\n\t\tfree(buf->d);\n\t}\n\texplicit_bzero(buf, sizeof(*buf));\n\tfree(buf);\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <signal.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <signal.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\nsshbuf_free(struct sshbuf *buf)\n{\n\tif (buf == NULL)\n\t\treturn;\n\t/*\n\t * The following will leak on insane buffers, but this is the safest\n\t * course of action - an invalid pointer or already-freed pointer may\n\t * have been passed to us and continuing to scribble over memory would\n\t * be bad.\n\t */\n\tif (sshbuf_check_sanity(buf) != 0)\n\t\treturn;\n\t/*\n\t * If we are a child, the free our parent to decrement its reference\n\t * count and possibly free it.\n\t */\n\tsshbuf_free(buf->parent);\n\tbuf->parent = NULL;\n\t/*\n\t * If we are a parent with still-extant children, then don't free just\n\t * yet. The last child's call to sshbuf_free should decrement our\n\t * refcount to 0 and trigger the actual free.\n\t */\n\tbuf->refcount--;\n\tif (buf->refcount > 0)\n\t\treturn;\n\tif (!buf->readonly) {\n\t\texplicit_bzero(buf->d, buf->alloc);\n\t\tfree(buf->d);\n\t}\n\texplicit_bzero(buf, sizeof(*buf));\n\tfree(buf);\n}"
        }
      },
      {
        "call_info": {
          "callee": "sshbuf_get_cstring",
          "args": [
            "m",
            "&kex->server_version_string",
            "NULL"
          ],
          "line": 2346
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_get_cstring",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf-getput-basic.c",
          "lines": "180-213",
          "snippet": "int\nsshbuf_get_cstring(struct sshbuf *buf, char **valp, size_t *lenp)\n{\n\tsize_t len;\n\tconst u_char *p, *z;\n\tint r;\n\n\tif (valp != NULL)\n\t\t*valp = NULL;\n\tif (lenp != NULL)\n\t\t*lenp = 0;\n\tif ((r = sshbuf_peek_string_direct(buf, &p, &len)) != 0)\n\t\treturn r;\n\t/* Allow a \\0 only at the end of the string */\n\tif (len > 0 &&\n\t    (z = memchr(p , '\\0', len)) != NULL && z < p + len - 1) {\n\t\tSSHBUF_DBG((\"SSH_ERR_INVALID_FORMAT\"));\n\t\treturn SSH_ERR_INVALID_FORMAT;\n\t}\n\tif ((r = sshbuf_skip_string(buf)) != 0)\n\t\treturn -1;\n\tif (valp != NULL) {\n\t\tif ((*valp = malloc(len + 1)) == NULL) {\n\t\t\tSSHBUF_DBG((\"SSH_ERR_ALLOC_FAIL\"));\n\t\t\treturn SSH_ERR_ALLOC_FAIL;\n\t\t}\n\t\tif (len != 0)\n\t\t\tmemcpy(*valp, p, len);\n\t\t(*valp)[len] = '\\0';\n\t}\n\tif (lenp != NULL)\n\t\t*lenp = (size_t)len;\n\treturn 0;\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <stdarg.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <stdarg.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshbuf_get_cstring(struct sshbuf *buf, char **valp, size_t *lenp)\n{\n\tsize_t len;\n\tconst u_char *p, *z;\n\tint r;\n\n\tif (valp != NULL)\n\t\t*valp = NULL;\n\tif (lenp != NULL)\n\t\t*lenp = 0;\n\tif ((r = sshbuf_peek_string_direct(buf, &p, &len)) != 0)\n\t\treturn r;\n\t/* Allow a \\0 only at the end of the string */\n\tif (len > 0 &&\n\t    (z = memchr(p , '\\0', len)) != NULL && z < p + len - 1) {\n\t\tSSHBUF_DBG((\"SSH_ERR_INVALID_FORMAT\"));\n\t\treturn SSH_ERR_INVALID_FORMAT;\n\t}\n\tif ((r = sshbuf_skip_string(buf)) != 0)\n\t\treturn -1;\n\tif (valp != NULL) {\n\t\tif ((*valp = malloc(len + 1)) == NULL) {\n\t\t\tSSHBUF_DBG((\"SSH_ERR_ALLOC_FAIL\"));\n\t\t\treturn SSH_ERR_ALLOC_FAIL;\n\t\t}\n\t\tif (len != 0)\n\t\t\tmemcpy(*valp, p, len);\n\t\t(*valp)[len] = '\\0';\n\t}\n\tif (lenp != NULL)\n\t\t*lenp = (size_t)len;\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "sshbuf_get_u32",
          "args": [
            "m",
            "&kex->flags"
          ],
          "line": 2344
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_get_u32",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf-getput-basic.c",
          "lines": "57-68",
          "snippet": "int\nsshbuf_get_u32(struct sshbuf *buf, u_int32_t *valp)\n{\n\tconst u_char *p = sshbuf_ptr(buf);\n\tint r;\n\n\tif ((r = sshbuf_consume(buf, 4)) < 0)\n\t\treturn r;\n\tif (valp != NULL)\n\t\t*valp = PEEK_U32(p);\n\treturn 0;\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <stdarg.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <stdarg.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshbuf_get_u32(struct sshbuf *buf, u_int32_t *valp)\n{\n\tconst u_char *p = sshbuf_ptr(buf);\n\tint r;\n\n\tif ((r = sshbuf_consume(buf, 4)) < 0)\n\t\treturn r;\n\tif (valp != NULL)\n\t\t*valp = PEEK_U32(p);\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "sshbuf_get_stringb",
          "args": [
            "m",
            "kex->peer"
          ],
          "line": 2343
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_get_stringb",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf-getput-basic.c",
          "lines": "215-233",
          "snippet": "int\nsshbuf_get_stringb(struct sshbuf *buf, struct sshbuf *v)\n{\n\tu_int32_t len;\n\tu_char *p;\n\tint r;\n\n\t/*\n\t * Use sshbuf_peek_string_direct() to figure out if there is\n\t * a complete string in 'buf' and copy the string directly\n\t * into 'v'.\n\t */\n\tif ((r = sshbuf_peek_string_direct(buf, NULL, NULL)) != 0 ||\n\t    (r = sshbuf_get_u32(buf, &len)) != 0 ||\n\t    (r = sshbuf_reserve(v, len, &p)) != 0 ||\n\t    (r = sshbuf_get(buf, p, len)) != 0)\n\t\treturn r;\n\treturn 0;\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <stdarg.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <stdarg.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshbuf_get_stringb(struct sshbuf *buf, struct sshbuf *v)\n{\n\tu_int32_t len;\n\tu_char *p;\n\tint r;\n\n\t/*\n\t * Use sshbuf_peek_string_direct() to figure out if there is\n\t * a complete string in 'buf' and copy the string directly\n\t * into 'v'.\n\t */\n\tif ((r = sshbuf_peek_string_direct(buf, NULL, NULL)) != 0 ||\n\t    (r = sshbuf_get_u32(buf, &len)) != 0 ||\n\t    (r = sshbuf_reserve(v, len, &p)) != 0 ||\n\t    (r = sshbuf_get(buf, p, len)) != 0)\n\t\treturn r;\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "sshbuf_get_string",
          "args": [
            "m",
            "&kex->session_id",
            "&kex->session_id_len"
          ],
          "line": 2336
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_get_string_direct",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf-getput-basic.c",
          "lines": "123-147",
          "snippet": "int\nsshbuf_get_string_direct(struct sshbuf *buf, const u_char **valp, size_t *lenp)\n{\n\tsize_t len;\n\tconst u_char *p;\n\tint r;\n\n\tif (valp != NULL)\n\t\t*valp = NULL;\n\tif (lenp != NULL)\n\t\t*lenp = 0;\n\tif ((r = sshbuf_peek_string_direct(buf, &p, &len)) < 0)\n\t\treturn r;\n\tif (valp != NULL)\n\t\t*valp = p;\n\tif (lenp != NULL)\n\t\t*lenp = len;\n\tif (sshbuf_consume(buf, len + 4) != 0) {\n\t\t/* Shouldn't happen */\n\t\tSSHBUF_DBG((\"SSH_ERR_INTERNAL_ERROR\"));\n\t\tSSHBUF_ABORT();\n\t\treturn SSH_ERR_INTERNAL_ERROR;\n\t}\n\treturn 0;\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <stdarg.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <stdarg.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshbuf_get_string_direct(struct sshbuf *buf, const u_char **valp, size_t *lenp)\n{\n\tsize_t len;\n\tconst u_char *p;\n\tint r;\n\n\tif (valp != NULL)\n\t\t*valp = NULL;\n\tif (lenp != NULL)\n\t\t*lenp = 0;\n\tif ((r = sshbuf_peek_string_direct(buf, &p, &len)) < 0)\n\t\treturn r;\n\tif (valp != NULL)\n\t\t*valp = p;\n\tif (lenp != NULL)\n\t\t*lenp = len;\n\tif (sshbuf_consume(buf, len + 4) != 0) {\n\t\t/* Shouldn't happen */\n\t\tSSHBUF_DBG((\"SSH_ERR_INTERNAL_ERROR\"));\n\t\tSSHBUF_ABORT();\n\t\treturn SSH_ERR_INTERNAL_ERROR;\n\t}\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "sshbuf_new",
          "args": [],
          "line": 2332
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_new",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf.c",
          "lines": "68-85",
          "snippet": "struct sshbuf *\nsshbuf_new(void)\n{\n\tstruct sshbuf *ret;\n\n\tif ((ret = calloc(sizeof(*ret), 1)) == NULL)\n\t\treturn NULL;\n\tret->alloc = SSHBUF_SIZE_INIT;\n\tret->max_size = SSHBUF_SIZE_MAX;\n\tret->readonly = 0;\n\tret->refcount = 1;\n\tret->parent = NULL;\n\tif ((ret->cd = ret->d = calloc(1, ret->alloc)) == NULL) {\n\t\tfree(ret);\n\t\treturn NULL;\n\t}\n\treturn ret;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <signal.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <signal.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nstruct sshbuf *\nsshbuf_new(void)\n{\n\tstruct sshbuf *ret;\n\n\tif ((ret = calloc(sizeof(*ret), 1)) == NULL)\n\t\treturn NULL;\n\tret->alloc = SSHBUF_SIZE_INIT;\n\tret->max_size = SSHBUF_SIZE_MAX;\n\tret->readonly = 0;\n\tret->refcount = 1;\n\tret->parent = NULL;\n\tif ((ret->cd = ret->d = calloc(1, ret->alloc)) == NULL) {\n\t\tfree(ret);\n\t\treturn NULL;\n\t}\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "calloc",
          "args": [
            "1",
            "sizeof(struct kex)"
          ],
          "line": 2330
        },
        "resolved": true,
        "details": {
          "function_name": "xcalloc",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/xmalloc.c",
          "lines": "52-66",
          "snippet": "void *\nxcalloc(size_t nmemb, size_t size)\n{\n\tvoid *ptr;\n\n\tif (size == 0 || nmemb == 0)\n\t\tfatal(\"xcalloc: zero size\");\n\tif (SIZE_MAX / nmemb < size)\n\t\tfatal(\"xcalloc: nmemb * size > SIZE_MAX\");\n\tptr = calloc(nmemb, size);\n\tif (ptr == NULL)\n\t\tfatal(\"xcalloc: out of memory (allocating %zu bytes)\",\n\t\t    size * nmemb);\n\treturn ptr;\n}",
          "includes": [
            "#include \"log.h\"",
            "#include \"xmalloc.h\"",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdint.h>",
            "#include <stdarg.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n#include \"xmalloc.h\"\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdint.h>\n#include <stdarg.h>\n#include \"includes.h\"\n\nvoid *\nxcalloc(size_t nmemb, size_t size)\n{\n\tvoid *ptr;\n\n\tif (size == 0 || nmemb == 0)\n\t\tfatal(\"xcalloc: zero size\");\n\tif (SIZE_MAX / nmemb < size)\n\t\tfatal(\"xcalloc: nmemb * size > SIZE_MAX\");\n\tptr = calloc(nmemb, size);\n\tif (ptr == NULL)\n\t\tfatal(\"xcalloc: out of memory (allocating %zu bytes)\",\n\t\t    size * nmemb);\n\treturn ptr;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nstatic int\nkex_from_blob(struct sshbuf *m, struct kex **kexp)\n{\n\tstruct kex *kex;\n\tint r;\n\n\tif ((kex = calloc(1, sizeof(struct kex))) == NULL ||\n\t    (kex->my = sshbuf_new()) == NULL ||\n\t    (kex->peer = sshbuf_new()) == NULL) {\n\t\tr = SSH_ERR_ALLOC_FAIL;\n\t\tgoto out;\n\t}\n\tif ((r = sshbuf_get_string(m, &kex->session_id, &kex->session_id_len)) != 0 ||\n\t    (r = sshbuf_get_u32(m, &kex->we_need)) != 0 ||\n\t    (r = sshbuf_get_cstring(m, &kex->hostkey_alg, NULL)) != 0 ||\n\t    (r = sshbuf_get_u32(m, (u_int *)&kex->hostkey_type)) != 0 ||\n\t    (r = sshbuf_get_u32(m, (u_int *)&kex->hostkey_nid)) != 0 ||\n\t    (r = sshbuf_get_u32(m, &kex->kex_type)) != 0 ||\n\t    (r = sshbuf_get_stringb(m, kex->my)) != 0 ||\n\t    (r = sshbuf_get_stringb(m, kex->peer)) != 0 ||\n\t    (r = sshbuf_get_u32(m, &kex->flags)) != 0 ||\n\t    (r = sshbuf_get_cstring(m, &kex->client_version_string, NULL)) != 0 ||\n\t    (r = sshbuf_get_cstring(m, &kex->server_version_string, NULL)) != 0)\n\t\tgoto out;\n\tkex->server = 1;\n\tkex->done = 1;\n\tr = 0;\n out:\n\tif (r != 0 || kexp == NULL) {\n\t\tif (kex != NULL) {\n\t\t\tsshbuf_free(kex->my);\n\t\t\tsshbuf_free(kex->peer);\n\t\t\tfree(kex);\n\t\t}\n\t\tif (kexp != NULL)\n\t\t\t*kexp = NULL;\n\t} else {\n\t\t*kexp = kex;\n\t}\n\treturn r;\n}"
  },
  {
    "function_name": "newkeys_from_blob",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
    "lines": "2257-2321",
    "snippet": "static int\nnewkeys_from_blob(struct sshbuf *m, struct ssh *ssh, int mode)\n{\n\tstruct sshbuf *b = NULL;\n\tstruct sshcomp *comp;\n\tstruct sshenc *enc;\n\tstruct sshmac *mac;\n\tstruct newkeys *newkey = NULL;\n\tsize_t keylen, ivlen, maclen;\n\tint r;\n\n\tif ((newkey = calloc(1, sizeof(*newkey))) == NULL) {\n\t\tr = SSH_ERR_ALLOC_FAIL;\n\t\tgoto out;\n\t}\n\tif ((r = sshbuf_froms(m, &b)) != 0)\n\t\tgoto out;\n#ifdef DEBUG_PK\n\tsshbuf_dump(b, stderr);\n#endif\n\tenc = &newkey->enc;\n\tmac = &newkey->mac;\n\tcomp = &newkey->comp;\n\n\tif ((r = sshbuf_get_cstring(b, &enc->name, NULL)) != 0 ||\n\t    (r = sshbuf_get_u32(b, (u_int *)&enc->enabled)) != 0 ||\n\t    (r = sshbuf_get_u32(b, &enc->block_size)) != 0 ||\n\t    (r = sshbuf_get_string(b, &enc->key, &keylen)) != 0 ||\n\t    (r = sshbuf_get_string(b, &enc->iv, &ivlen)) != 0)\n\t\tgoto out;\n\tif ((enc->cipher = cipher_by_name(enc->name)) == NULL) {\n\t\tr = SSH_ERR_INVALID_FORMAT;\n\t\tgoto out;\n\t}\n\tif (cipher_authlen(enc->cipher) == 0) {\n\t\tif ((r = sshbuf_get_cstring(b, &mac->name, NULL)) != 0)\n\t\t\tgoto out;\n\t\tif ((r = mac_setup(mac, mac->name)) != 0)\n\t\t\tgoto out;\n\t\tif ((r = sshbuf_get_u32(b, (u_int *)&mac->enabled)) != 0 ||\n\t\t    (r = sshbuf_get_string(b, &mac->key, &maclen)) != 0)\n\t\t\tgoto out;\n\t\tif (maclen > mac->key_len) {\n\t\t\tr = SSH_ERR_INVALID_FORMAT;\n\t\t\tgoto out;\n\t\t}\n\t\tmac->key_len = maclen;\n\t}\n\tif ((r = sshbuf_get_u32(b, &comp->type)) != 0 ||\n\t    (r = sshbuf_get_cstring(b, &comp->name, NULL)) != 0)\n\t\tgoto out;\n\tif (sshbuf_len(b) != 0) {\n\t\tr = SSH_ERR_INVALID_FORMAT;\n\t\tgoto out;\n\t}\n\tenc->key_len = keylen;\n\tenc->iv_len = ivlen;\n\tssh->kex->newkeys[mode] = newkey;\n\tnewkey = NULL;\n\tr = 0;\n out:\n\tfree(newkey);\n\tsshbuf_free(b);\n\treturn r;\n}",
    "includes": [
      "#include \"sshbuf.h\"",
      "#include \"ssherr.h\"",
      "#include \"packet.h\"",
      "#include \"ssh.h\"",
      "#include \"channels.h\"",
      "#include \"misc.h\"",
      "#include \"canohost.h\"",
      "#include \"log.h\"",
      "#include \"mac.h\"",
      "#include \"digest.h\"",
      "#include \"kex.h\"",
      "#include \"sshkey.h\"",
      "#include \"cipher.h\"",
      "#include \"ssh2.h\"",
      "#include \"compat.h\"",
      "#include \"crc32.h\"",
      "#include \"xmalloc.h\"",
      "#include <zlib.h>",
      "#  include <openssl/ec.h>",
      "# include <openssl/evp.h>",
      "# include <openssl/bn.h>",
      "#include <time.h>",
      "#include <signal.h>",
      "#include <limits.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <stdarg.h>",
      "#include <netdb.h>",
      "#include <errno.h>",
      "#include <arpa/inet.h>",
      "#include <netinet/ip.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include \"openbsd-compat/sys-queue.h\"",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "sshbuf_free",
          "args": [
            "b"
          ],
          "line": 2319
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf.c",
          "lines": "133-166",
          "snippet": "void\nsshbuf_free(struct sshbuf *buf)\n{\n\tif (buf == NULL)\n\t\treturn;\n\t/*\n\t * The following will leak on insane buffers, but this is the safest\n\t * course of action - an invalid pointer or already-freed pointer may\n\t * have been passed to us and continuing to scribble over memory would\n\t * be bad.\n\t */\n\tif (sshbuf_check_sanity(buf) != 0)\n\t\treturn;\n\t/*\n\t * If we are a child, the free our parent to decrement its reference\n\t * count and possibly free it.\n\t */\n\tsshbuf_free(buf->parent);\n\tbuf->parent = NULL;\n\t/*\n\t * If we are a parent with still-extant children, then don't free just\n\t * yet. The last child's call to sshbuf_free should decrement our\n\t * refcount to 0 and trigger the actual free.\n\t */\n\tbuf->refcount--;\n\tif (buf->refcount > 0)\n\t\treturn;\n\tif (!buf->readonly) {\n\t\texplicit_bzero(buf->d, buf->alloc);\n\t\tfree(buf->d);\n\t}\n\texplicit_bzero(buf, sizeof(*buf));\n\tfree(buf);\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <signal.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <signal.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\nsshbuf_free(struct sshbuf *buf)\n{\n\tif (buf == NULL)\n\t\treturn;\n\t/*\n\t * The following will leak on insane buffers, but this is the safest\n\t * course of action - an invalid pointer or already-freed pointer may\n\t * have been passed to us and continuing to scribble over memory would\n\t * be bad.\n\t */\n\tif (sshbuf_check_sanity(buf) != 0)\n\t\treturn;\n\t/*\n\t * If we are a child, the free our parent to decrement its reference\n\t * count and possibly free it.\n\t */\n\tsshbuf_free(buf->parent);\n\tbuf->parent = NULL;\n\t/*\n\t * If we are a parent with still-extant children, then don't free just\n\t * yet. The last child's call to sshbuf_free should decrement our\n\t * refcount to 0 and trigger the actual free.\n\t */\n\tbuf->refcount--;\n\tif (buf->refcount > 0)\n\t\treturn;\n\tif (!buf->readonly) {\n\t\texplicit_bzero(buf->d, buf->alloc);\n\t\tfree(buf->d);\n\t}\n\texplicit_bzero(buf, sizeof(*buf));\n\tfree(buf);\n}"
        }
      },
      {
        "call_info": {
          "callee": "free",
          "args": [
            "newkey"
          ],
          "line": 2318
        },
        "resolved": true,
        "details": {
          "function_name": "freeze",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/smult_curve25519_ref.c",
          "lines": "50-60",
          "snippet": "static void freeze(unsigned int a[32])\n{\n  unsigned int aorig[32];\n  unsigned int j;\n  unsigned int negative;\n\n  for (j = 0;j < 32;++j) aorig[j] = a[j];\n  add(a,a,minusp);\n  negative = -((a[31] >> 7) & 1);\n  for (j = 0;j < 32;++j) a[j] ^= negative & (aorig[j] ^ a[j]);\n}",
          "includes": [],
          "macros_used": [],
          "globals_used": [
            "static const unsigned int minusp[32] = {\n 19, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 128\n} ;"
          ],
          "called_functions": [],
          "contextual_snippet": "static const unsigned int minusp[32] = {\n 19, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 128\n} ;\n\nstatic void freeze(unsigned int a[32])\n{\n  unsigned int aorig[32];\n  unsigned int j;\n  unsigned int negative;\n\n  for (j = 0;j < 32;++j) aorig[j] = a[j];\n  add(a,a,minusp);\n  negative = -((a[31] >> 7) & 1);\n  for (j = 0;j < 32;++j) a[j] ^= negative & (aorig[j] ^ a[j]);\n}"
        }
      },
      {
        "call_info": {
          "callee": "sshbuf_len",
          "args": [
            "b"
          ],
          "line": 2308
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_len",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf.c",
          "lines": "252-258",
          "snippet": "size_t\nsshbuf_len(const struct sshbuf *buf)\n{\n\tif (sshbuf_check_sanity(buf) != 0)\n\t\treturn 0;\n\treturn buf->size - buf->off;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <signal.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <signal.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nsize_t\nsshbuf_len(const struct sshbuf *buf)\n{\n\tif (sshbuf_check_sanity(buf) != 0)\n\t\treturn 0;\n\treturn buf->size - buf->off;\n}"
        }
      },
      {
        "call_info": {
          "callee": "sshbuf_get_cstring",
          "args": [
            "b",
            "&comp->name",
            "NULL"
          ],
          "line": 2306
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_get_cstring",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf-getput-basic.c",
          "lines": "180-213",
          "snippet": "int\nsshbuf_get_cstring(struct sshbuf *buf, char **valp, size_t *lenp)\n{\n\tsize_t len;\n\tconst u_char *p, *z;\n\tint r;\n\n\tif (valp != NULL)\n\t\t*valp = NULL;\n\tif (lenp != NULL)\n\t\t*lenp = 0;\n\tif ((r = sshbuf_peek_string_direct(buf, &p, &len)) != 0)\n\t\treturn r;\n\t/* Allow a \\0 only at the end of the string */\n\tif (len > 0 &&\n\t    (z = memchr(p , '\\0', len)) != NULL && z < p + len - 1) {\n\t\tSSHBUF_DBG((\"SSH_ERR_INVALID_FORMAT\"));\n\t\treturn SSH_ERR_INVALID_FORMAT;\n\t}\n\tif ((r = sshbuf_skip_string(buf)) != 0)\n\t\treturn -1;\n\tif (valp != NULL) {\n\t\tif ((*valp = malloc(len + 1)) == NULL) {\n\t\t\tSSHBUF_DBG((\"SSH_ERR_ALLOC_FAIL\"));\n\t\t\treturn SSH_ERR_ALLOC_FAIL;\n\t\t}\n\t\tif (len != 0)\n\t\t\tmemcpy(*valp, p, len);\n\t\t(*valp)[len] = '\\0';\n\t}\n\tif (lenp != NULL)\n\t\t*lenp = (size_t)len;\n\treturn 0;\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <stdarg.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <stdarg.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshbuf_get_cstring(struct sshbuf *buf, char **valp, size_t *lenp)\n{\n\tsize_t len;\n\tconst u_char *p, *z;\n\tint r;\n\n\tif (valp != NULL)\n\t\t*valp = NULL;\n\tif (lenp != NULL)\n\t\t*lenp = 0;\n\tif ((r = sshbuf_peek_string_direct(buf, &p, &len)) != 0)\n\t\treturn r;\n\t/* Allow a \\0 only at the end of the string */\n\tif (len > 0 &&\n\t    (z = memchr(p , '\\0', len)) != NULL && z < p + len - 1) {\n\t\tSSHBUF_DBG((\"SSH_ERR_INVALID_FORMAT\"));\n\t\treturn SSH_ERR_INVALID_FORMAT;\n\t}\n\tif ((r = sshbuf_skip_string(buf)) != 0)\n\t\treturn -1;\n\tif (valp != NULL) {\n\t\tif ((*valp = malloc(len + 1)) == NULL) {\n\t\t\tSSHBUF_DBG((\"SSH_ERR_ALLOC_FAIL\"));\n\t\t\treturn SSH_ERR_ALLOC_FAIL;\n\t\t}\n\t\tif (len != 0)\n\t\t\tmemcpy(*valp, p, len);\n\t\t(*valp)[len] = '\\0';\n\t}\n\tif (lenp != NULL)\n\t\t*lenp = (size_t)len;\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "sshbuf_get_u32",
          "args": [
            "b",
            "&comp->type"
          ],
          "line": 2305
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_get_u32",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf-getput-basic.c",
          "lines": "57-68",
          "snippet": "int\nsshbuf_get_u32(struct sshbuf *buf, u_int32_t *valp)\n{\n\tconst u_char *p = sshbuf_ptr(buf);\n\tint r;\n\n\tif ((r = sshbuf_consume(buf, 4)) < 0)\n\t\treturn r;\n\tif (valp != NULL)\n\t\t*valp = PEEK_U32(p);\n\treturn 0;\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <stdarg.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <stdarg.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshbuf_get_u32(struct sshbuf *buf, u_int32_t *valp)\n{\n\tconst u_char *p = sshbuf_ptr(buf);\n\tint r;\n\n\tif ((r = sshbuf_consume(buf, 4)) < 0)\n\t\treturn r;\n\tif (valp != NULL)\n\t\t*valp = PEEK_U32(p);\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "sshbuf_get_string",
          "args": [
            "b",
            "&mac->key",
            "&maclen"
          ],
          "line": 2297
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_get_string_direct",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf-getput-basic.c",
          "lines": "123-147",
          "snippet": "int\nsshbuf_get_string_direct(struct sshbuf *buf, const u_char **valp, size_t *lenp)\n{\n\tsize_t len;\n\tconst u_char *p;\n\tint r;\n\n\tif (valp != NULL)\n\t\t*valp = NULL;\n\tif (lenp != NULL)\n\t\t*lenp = 0;\n\tif ((r = sshbuf_peek_string_direct(buf, &p, &len)) < 0)\n\t\treturn r;\n\tif (valp != NULL)\n\t\t*valp = p;\n\tif (lenp != NULL)\n\t\t*lenp = len;\n\tif (sshbuf_consume(buf, len + 4) != 0) {\n\t\t/* Shouldn't happen */\n\t\tSSHBUF_DBG((\"SSH_ERR_INTERNAL_ERROR\"));\n\t\tSSHBUF_ABORT();\n\t\treturn SSH_ERR_INTERNAL_ERROR;\n\t}\n\treturn 0;\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <stdarg.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <stdarg.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshbuf_get_string_direct(struct sshbuf *buf, const u_char **valp, size_t *lenp)\n{\n\tsize_t len;\n\tconst u_char *p;\n\tint r;\n\n\tif (valp != NULL)\n\t\t*valp = NULL;\n\tif (lenp != NULL)\n\t\t*lenp = 0;\n\tif ((r = sshbuf_peek_string_direct(buf, &p, &len)) < 0)\n\t\treturn r;\n\tif (valp != NULL)\n\t\t*valp = p;\n\tif (lenp != NULL)\n\t\t*lenp = len;\n\tif (sshbuf_consume(buf, len + 4) != 0) {\n\t\t/* Shouldn't happen */\n\t\tSSHBUF_DBG((\"SSH_ERR_INTERNAL_ERROR\"));\n\t\tSSHBUF_ABORT();\n\t\treturn SSH_ERR_INTERNAL_ERROR;\n\t}\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "mac_setup",
          "args": [
            "mac",
            "mac->name"
          ],
          "line": 2294
        },
        "resolved": true,
        "details": {
          "function_name": "mac_setup",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/mac.c",
          "lines": "127-140",
          "snippet": "int\nmac_setup(struct sshmac *mac, char *name)\n{\n\tconst struct macalg *m;\n\n\tfor (m = macs; m->name != NULL; m++) {\n\t\tif (strcmp(name, m->name) != 0)\n\t\t\tcontinue;\n\t\tif (mac != NULL)\n\t\t\treturn mac_setup_by_alg(mac, m);\n\t\treturn 0;\n\t}\n\treturn SSH_ERR_INVALID_ARGUMENT;\n}",
          "includes": [
            "#include \"openbsd-compat/openssl-compat.h\"",
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include \"misc.h\"",
            "#include \"mac.h\"",
            "#include \"umac.h\"",
            "#include \"hmac.h\"",
            "#include \"digest.h\"",
            "#include <stdio.h>",
            "#include <string.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static const struct macalg macs[] = {\n\t/* Encrypt-and-MAC (encrypt-and-authenticate) variants */\n\t{ \"hmac-sha1\",\t\t\t\tSSH_DIGEST, SSH_DIGEST_SHA1, 0, 0, 0, 0 },\n\t{ \"hmac-sha1-96\",\t\t\tSSH_DIGEST, SSH_DIGEST_SHA1, 96, 0, 0, 0 },\n#ifdef HAVE_EVP_SHA256\n\t{ \"hmac-sha2-256\",\t\t\tSSH_DIGEST, SSH_DIGEST_SHA256, 0, 0, 0, 0 },\n\t{ \"hmac-sha2-512\",\t\t\tSSH_DIGEST, SSH_DIGEST_SHA512, 0, 0, 0, 0 },\n#endif\n\t{ \"hmac-md5\",\t\t\t\tSSH_DIGEST, SSH_DIGEST_MD5, 0, 0, 0, 0 },\n\t{ \"hmac-md5-96\",\t\t\tSSH_DIGEST, SSH_DIGEST_MD5, 96, 0, 0, 0 },\n\t{ \"umac-64@openssh.com\",\t\tSSH_UMAC, 0, 0, 128, 64, 0 },\n\t{ \"umac-128@openssh.com\",\t\tSSH_UMAC128, 0, 0, 128, 128, 0 },\n\n\t/* Encrypt-then-MAC variants */\n\t{ \"hmac-sha1-etm@openssh.com\",\t\tSSH_DIGEST, SSH_DIGEST_SHA1, 0, 0, 0, 1 },\n\t{ \"hmac-sha1-96-etm@openssh.com\",\tSSH_DIGEST, SSH_DIGEST_SHA1, 96, 0, 0, 1 },\n#ifdef HAVE_EVP_SHA256\n\t{ \"hmac-sha2-256-etm@openssh.com\",\tSSH_DIGEST, SSH_DIGEST_SHA256, 0, 0, 0, 1 },\n\t{ \"hmac-sha2-512-etm@openssh.com\",\tSSH_DIGEST, SSH_DIGEST_SHA512, 0, 0, 0, 1 },\n#endif\n\t{ \"hmac-md5-etm@openssh.com\",\t\tSSH_DIGEST, SSH_DIGEST_MD5, 0, 0, 0, 1 },\n\t{ \"hmac-md5-96-etm@openssh.com\",\tSSH_DIGEST, SSH_DIGEST_MD5, 96, 0, 0, 1 },\n\t{ \"umac-64-etm@openssh.com\",\t\tSSH_UMAC, 0, 0, 128, 64, 1 },\n\t{ \"umac-128-etm@openssh.com\",\t\tSSH_UMAC128, 0, 0, 128, 128, 1 },\n\n\t{ NULL,\t\t\t\t\t0, 0, 0, 0, 0, 0 }\n};"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"openbsd-compat/openssl-compat.h\"\n#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"misc.h\"\n#include \"mac.h\"\n#include \"umac.h\"\n#include \"hmac.h\"\n#include \"digest.h\"\n#include <stdio.h>\n#include <string.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nstatic const struct macalg macs[] = {\n\t/* Encrypt-and-MAC (encrypt-and-authenticate) variants */\n\t{ \"hmac-sha1\",\t\t\t\tSSH_DIGEST, SSH_DIGEST_SHA1, 0, 0, 0, 0 },\n\t{ \"hmac-sha1-96\",\t\t\tSSH_DIGEST, SSH_DIGEST_SHA1, 96, 0, 0, 0 },\n#ifdef HAVE_EVP_SHA256\n\t{ \"hmac-sha2-256\",\t\t\tSSH_DIGEST, SSH_DIGEST_SHA256, 0, 0, 0, 0 },\n\t{ \"hmac-sha2-512\",\t\t\tSSH_DIGEST, SSH_DIGEST_SHA512, 0, 0, 0, 0 },\n#endif\n\t{ \"hmac-md5\",\t\t\t\tSSH_DIGEST, SSH_DIGEST_MD5, 0, 0, 0, 0 },\n\t{ \"hmac-md5-96\",\t\t\tSSH_DIGEST, SSH_DIGEST_MD5, 96, 0, 0, 0 },\n\t{ \"umac-64@openssh.com\",\t\tSSH_UMAC, 0, 0, 128, 64, 0 },\n\t{ \"umac-128@openssh.com\",\t\tSSH_UMAC128, 0, 0, 128, 128, 0 },\n\n\t/* Encrypt-then-MAC variants */\n\t{ \"hmac-sha1-etm@openssh.com\",\t\tSSH_DIGEST, SSH_DIGEST_SHA1, 0, 0, 0, 1 },\n\t{ \"hmac-sha1-96-etm@openssh.com\",\tSSH_DIGEST, SSH_DIGEST_SHA1, 96, 0, 0, 1 },\n#ifdef HAVE_EVP_SHA256\n\t{ \"hmac-sha2-256-etm@openssh.com\",\tSSH_DIGEST, SSH_DIGEST_SHA256, 0, 0, 0, 1 },\n\t{ \"hmac-sha2-512-etm@openssh.com\",\tSSH_DIGEST, SSH_DIGEST_SHA512, 0, 0, 0, 1 },\n#endif\n\t{ \"hmac-md5-etm@openssh.com\",\t\tSSH_DIGEST, SSH_DIGEST_MD5, 0, 0, 0, 1 },\n\t{ \"hmac-md5-96-etm@openssh.com\",\tSSH_DIGEST, SSH_DIGEST_MD5, 96, 0, 0, 1 },\n\t{ \"umac-64-etm@openssh.com\",\t\tSSH_UMAC, 0, 0, 128, 64, 1 },\n\t{ \"umac-128-etm@openssh.com\",\t\tSSH_UMAC128, 0, 0, 128, 128, 1 },\n\n\t{ NULL,\t\t\t\t\t0, 0, 0, 0, 0, 0 }\n};\n\nint\nmac_setup(struct sshmac *mac, char *name)\n{\n\tconst struct macalg *m;\n\n\tfor (m = macs; m->name != NULL; m++) {\n\t\tif (strcmp(name, m->name) != 0)\n\t\t\tcontinue;\n\t\tif (mac != NULL)\n\t\t\treturn mac_setup_by_alg(mac, m);\n\t\treturn 0;\n\t}\n\treturn SSH_ERR_INVALID_ARGUMENT;\n}"
        }
      },
      {
        "call_info": {
          "callee": "cipher_authlen",
          "args": [
            "enc->cipher"
          ],
          "line": 2291
        },
        "resolved": true,
        "details": {
          "function_name": "cipher_authlen",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/cipher.c",
          "lines": "163-167",
          "snippet": "u_int\ncipher_authlen(const struct sshcipher *c)\n{\n\treturn (c->auth_len);\n}",
          "includes": [
            "#include \"openbsd-compat/openssl-compat.h\"",
            "#include \"digest.h\"",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"misc.h\"",
            "#include \"cipher.h\"",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <string.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"openbsd-compat/openssl-compat.h\"\n#include \"digest.h\"\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"misc.h\"\n#include \"cipher.h\"\n#include <stdio.h>\n#include <stdarg.h>\n#include <string.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nu_int\ncipher_authlen(const struct sshcipher *c)\n{\n\treturn (c->auth_len);\n}"
        }
      },
      {
        "call_info": {
          "callee": "cipher_by_name",
          "args": [
            "enc->name"
          ],
          "line": 2287
        },
        "resolved": true,
        "details": {
          "function_name": "cipher_by_name",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/cipher.c",
          "lines": "192-200",
          "snippet": "const struct sshcipher *\ncipher_by_name(const char *name)\n{\n\tconst struct sshcipher *c;\n\tfor (c = ciphers; c->name != NULL; c++)\n\t\tif (strcmp(c->name, name) == 0)\n\t\t\treturn c;\n\treturn NULL;\n}",
          "includes": [
            "#include \"openbsd-compat/openssl-compat.h\"",
            "#include \"digest.h\"",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"misc.h\"",
            "#include \"cipher.h\"",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <string.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static const struct sshcipher ciphers[] = {\n#ifdef WITH_OPENSSL\n#ifndef OPENSSL_NO_DES\n\t{ \"3des-cbc\",\t\t8, 24, 0, 0, CFLAG_CBC, EVP_des_ede3_cbc },\n#endif\n\t{ \"aes128-cbc\",\t\t16, 16, 0, 0, CFLAG_CBC, EVP_aes_128_cbc },\n\t{ \"aes192-cbc\",\t\t16, 24, 0, 0, CFLAG_CBC, EVP_aes_192_cbc },\n\t{ \"aes256-cbc\",\t\t16, 32, 0, 0, CFLAG_CBC, EVP_aes_256_cbc },\n\t{ \"rijndael-cbc@lysator.liu.se\",\n\t\t\t\t16, 32, 0, 0, CFLAG_CBC, EVP_aes_256_cbc },\n\t{ \"aes128-ctr\",\t\t16, 16, 0, 0, 0, EVP_aes_128_ctr },\n\t{ \"aes192-ctr\",\t\t16, 24, 0, 0, 0, EVP_aes_192_ctr },\n\t{ \"aes256-ctr\",\t\t16, 32, 0, 0, 0, EVP_aes_256_ctr },\n# ifdef OPENSSL_HAVE_EVPGCM\n\t{ \"aes128-gcm@openssh.com\",\n\t\t\t\t16, 16, 12, 16, 0, EVP_aes_128_gcm },\n\t{ \"aes256-gcm@openssh.com\",\n\t\t\t\t16, 32, 12, 16, 0, EVP_aes_256_gcm },\n# endif /* OPENSSL_HAVE_EVPGCM */\n#else\n\t{ \"aes128-ctr\",\t\t16, 16, 0, 0, CFLAG_AESCTR, NULL },\n\t{ \"aes192-ctr\",\t\t16, 24, 0, 0, CFLAG_AESCTR, NULL },\n\t{ \"aes256-ctr\",\t\t16, 32, 0, 0, CFLAG_AESCTR, NULL },\n#endif\n\t{ \"chacha20-poly1305@openssh.com\",\n\t\t\t\t8, 64, 0, 16, CFLAG_CHACHAPOLY, NULL },\n\t{ \"none\",\t\t8, 0, 0, 0, CFLAG_NONE, NULL },\n\n\t{ NULL,\t\t\t0, 0, 0, 0, 0, NULL }\n};"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"openbsd-compat/openssl-compat.h\"\n#include \"digest.h\"\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"misc.h\"\n#include \"cipher.h\"\n#include <stdio.h>\n#include <stdarg.h>\n#include <string.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nstatic const struct sshcipher ciphers[] = {\n#ifdef WITH_OPENSSL\n#ifndef OPENSSL_NO_DES\n\t{ \"3des-cbc\",\t\t8, 24, 0, 0, CFLAG_CBC, EVP_des_ede3_cbc },\n#endif\n\t{ \"aes128-cbc\",\t\t16, 16, 0, 0, CFLAG_CBC, EVP_aes_128_cbc },\n\t{ \"aes192-cbc\",\t\t16, 24, 0, 0, CFLAG_CBC, EVP_aes_192_cbc },\n\t{ \"aes256-cbc\",\t\t16, 32, 0, 0, CFLAG_CBC, EVP_aes_256_cbc },\n\t{ \"rijndael-cbc@lysator.liu.se\",\n\t\t\t\t16, 32, 0, 0, CFLAG_CBC, EVP_aes_256_cbc },\n\t{ \"aes128-ctr\",\t\t16, 16, 0, 0, 0, EVP_aes_128_ctr },\n\t{ \"aes192-ctr\",\t\t16, 24, 0, 0, 0, EVP_aes_192_ctr },\n\t{ \"aes256-ctr\",\t\t16, 32, 0, 0, 0, EVP_aes_256_ctr },\n# ifdef OPENSSL_HAVE_EVPGCM\n\t{ \"aes128-gcm@openssh.com\",\n\t\t\t\t16, 16, 12, 16, 0, EVP_aes_128_gcm },\n\t{ \"aes256-gcm@openssh.com\",\n\t\t\t\t16, 32, 12, 16, 0, EVP_aes_256_gcm },\n# endif /* OPENSSL_HAVE_EVPGCM */\n#else\n\t{ \"aes128-ctr\",\t\t16, 16, 0, 0, CFLAG_AESCTR, NULL },\n\t{ \"aes192-ctr\",\t\t16, 24, 0, 0, CFLAG_AESCTR, NULL },\n\t{ \"aes256-ctr\",\t\t16, 32, 0, 0, CFLAG_AESCTR, NULL },\n#endif\n\t{ \"chacha20-poly1305@openssh.com\",\n\t\t\t\t8, 64, 0, 16, CFLAG_CHACHAPOLY, NULL },\n\t{ \"none\",\t\t8, 0, 0, 0, CFLAG_NONE, NULL },\n\n\t{ NULL,\t\t\t0, 0, 0, 0, 0, NULL }\n};\n\nconst struct sshcipher *\ncipher_by_name(const char *name)\n{\n\tconst struct sshcipher *c;\n\tfor (c = ciphers; c->name != NULL; c++)\n\t\tif (strcmp(c->name, name) == 0)\n\t\t\treturn c;\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "sshbuf_dump",
          "args": [
            "b",
            "stderr"
          ],
          "line": 2275
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_dump",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf-misc.c",
          "lines": "65-70",
          "snippet": "void\nsshbuf_dump(struct sshbuf *buf, FILE *f)\n{\n\tfprintf(f, \"buffer %p len = %zu\\n\", buf, sshbuf_len(buf));\n\tsshbuf_dump_data(sshbuf_ptr(buf), sshbuf_len(buf), f);\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include <ctype.h>",
            "#include <resolv.h>",
            "#include <string.h>",
            "#include <limits.h>",
            "#include <stdio.h>",
            "#include <stdint.h>",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include <netinet/in.h>",
            "#include <sys/socket.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include <ctype.h>\n#include <resolv.h>\n#include <string.h>\n#include <limits.h>\n#include <stdio.h>\n#include <stdint.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <netinet/in.h>\n#include <sys/socket.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\nsshbuf_dump(struct sshbuf *buf, FILE *f)\n{\n\tfprintf(f, \"buffer %p len = %zu\\n\", buf, sshbuf_len(buf));\n\tsshbuf_dump_data(sshbuf_ptr(buf), sshbuf_len(buf), f);\n}"
        }
      },
      {
        "call_info": {
          "callee": "sshbuf_froms",
          "args": [
            "m",
            "&b"
          ],
          "line": 2272
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_froms",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf-getput-basic.c",
          "lines": "377-399",
          "snippet": "int\nsshbuf_froms(struct sshbuf *buf, struct sshbuf **bufp)\n{\n\tconst u_char *p;\n\tsize_t len;\n\tstruct sshbuf *ret;\n\tint r;\n\n\tif (buf == NULL || bufp == NULL)\n\t\treturn SSH_ERR_INVALID_ARGUMENT;\n\t*bufp = NULL;\n\tif ((r = sshbuf_peek_string_direct(buf, &p, &len)) != 0)\n\t\treturn r;\n\tif ((ret = sshbuf_from(p, len)) == NULL)\n\t\treturn SSH_ERR_ALLOC_FAIL;\n\tif ((r = sshbuf_consume(buf, len + 4)) != 0 ||  /* Shouldn't happen */\n\t    (r = sshbuf_set_parent(ret, buf)) != 0) {\n\t\tsshbuf_free(ret);\n\t\treturn r;\n\t}\n\t*bufp = ret;\n\treturn 0;\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <stdarg.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <stdarg.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshbuf_froms(struct sshbuf *buf, struct sshbuf **bufp)\n{\n\tconst u_char *p;\n\tsize_t len;\n\tstruct sshbuf *ret;\n\tint r;\n\n\tif (buf == NULL || bufp == NULL)\n\t\treturn SSH_ERR_INVALID_ARGUMENT;\n\t*bufp = NULL;\n\tif ((r = sshbuf_peek_string_direct(buf, &p, &len)) != 0)\n\t\treturn r;\n\tif ((ret = sshbuf_from(p, len)) == NULL)\n\t\treturn SSH_ERR_ALLOC_FAIL;\n\tif ((r = sshbuf_consume(buf, len + 4)) != 0 ||  /* Shouldn't happen */\n\t    (r = sshbuf_set_parent(ret, buf)) != 0) {\n\t\tsshbuf_free(ret);\n\t\treturn r;\n\t}\n\t*bufp = ret;\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "calloc",
          "args": [
            "1",
            "sizeof(*newkey)"
          ],
          "line": 2268
        },
        "resolved": true,
        "details": {
          "function_name": "xcalloc",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/xmalloc.c",
          "lines": "52-66",
          "snippet": "void *\nxcalloc(size_t nmemb, size_t size)\n{\n\tvoid *ptr;\n\n\tif (size == 0 || nmemb == 0)\n\t\tfatal(\"xcalloc: zero size\");\n\tif (SIZE_MAX / nmemb < size)\n\t\tfatal(\"xcalloc: nmemb * size > SIZE_MAX\");\n\tptr = calloc(nmemb, size);\n\tif (ptr == NULL)\n\t\tfatal(\"xcalloc: out of memory (allocating %zu bytes)\",\n\t\t    size * nmemb);\n\treturn ptr;\n}",
          "includes": [
            "#include \"log.h\"",
            "#include \"xmalloc.h\"",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdint.h>",
            "#include <stdarg.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n#include \"xmalloc.h\"\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdint.h>\n#include <stdarg.h>\n#include \"includes.h\"\n\nvoid *\nxcalloc(size_t nmemb, size_t size)\n{\n\tvoid *ptr;\n\n\tif (size == 0 || nmemb == 0)\n\t\tfatal(\"xcalloc: zero size\");\n\tif (SIZE_MAX / nmemb < size)\n\t\tfatal(\"xcalloc: nmemb * size > SIZE_MAX\");\n\tptr = calloc(nmemb, size);\n\tif (ptr == NULL)\n\t\tfatal(\"xcalloc: out of memory (allocating %zu bytes)\",\n\t\t    size * nmemb);\n\treturn ptr;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nstatic int\nnewkeys_from_blob(struct sshbuf *m, struct ssh *ssh, int mode)\n{\n\tstruct sshbuf *b = NULL;\n\tstruct sshcomp *comp;\n\tstruct sshenc *enc;\n\tstruct sshmac *mac;\n\tstruct newkeys *newkey = NULL;\n\tsize_t keylen, ivlen, maclen;\n\tint r;\n\n\tif ((newkey = calloc(1, sizeof(*newkey))) == NULL) {\n\t\tr = SSH_ERR_ALLOC_FAIL;\n\t\tgoto out;\n\t}\n\tif ((r = sshbuf_froms(m, &b)) != 0)\n\t\tgoto out;\n#ifdef DEBUG_PK\n\tsshbuf_dump(b, stderr);\n#endif\n\tenc = &newkey->enc;\n\tmac = &newkey->mac;\n\tcomp = &newkey->comp;\n\n\tif ((r = sshbuf_get_cstring(b, &enc->name, NULL)) != 0 ||\n\t    (r = sshbuf_get_u32(b, (u_int *)&enc->enabled)) != 0 ||\n\t    (r = sshbuf_get_u32(b, &enc->block_size)) != 0 ||\n\t    (r = sshbuf_get_string(b, &enc->key, &keylen)) != 0 ||\n\t    (r = sshbuf_get_string(b, &enc->iv, &ivlen)) != 0)\n\t\tgoto out;\n\tif ((enc->cipher = cipher_by_name(enc->name)) == NULL) {\n\t\tr = SSH_ERR_INVALID_FORMAT;\n\t\tgoto out;\n\t}\n\tif (cipher_authlen(enc->cipher) == 0) {\n\t\tif ((r = sshbuf_get_cstring(b, &mac->name, NULL)) != 0)\n\t\t\tgoto out;\n\t\tif ((r = mac_setup(mac, mac->name)) != 0)\n\t\t\tgoto out;\n\t\tif ((r = sshbuf_get_u32(b, (u_int *)&mac->enabled)) != 0 ||\n\t\t    (r = sshbuf_get_string(b, &mac->key, &maclen)) != 0)\n\t\t\tgoto out;\n\t\tif (maclen > mac->key_len) {\n\t\t\tr = SSH_ERR_INVALID_FORMAT;\n\t\t\tgoto out;\n\t\t}\n\t\tmac->key_len = maclen;\n\t}\n\tif ((r = sshbuf_get_u32(b, &comp->type)) != 0 ||\n\t    (r = sshbuf_get_cstring(b, &comp->name, NULL)) != 0)\n\t\tgoto out;\n\tif (sshbuf_len(b) != 0) {\n\t\tr = SSH_ERR_INVALID_FORMAT;\n\t\tgoto out;\n\t}\n\tenc->key_len = keylen;\n\tenc->iv_len = ivlen;\n\tssh->kex->newkeys[mode] = newkey;\n\tnewkey = NULL;\n\tr = 0;\n out:\n\tfree(newkey);\n\tsshbuf_free(b);\n\treturn r;\n}"
  },
  {
    "function_name": "ssh_packet_get_state",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
    "lines": "2230-2254",
    "snippet": "int\nssh_packet_get_state(struct ssh *ssh, struct sshbuf *m)\n{\n\tstruct session_state *state = ssh->state;\n\tint r;\n\n\tif ((r = kex_to_blob(m, ssh->kex)) != 0 ||\n\t    (r = newkeys_to_blob(m, ssh, MODE_OUT)) != 0 ||\n\t    (r = newkeys_to_blob(m, ssh, MODE_IN)) != 0 ||\n\t    (r = sshbuf_put_u64(m, state->rekey_limit)) != 0 ||\n\t    (r = sshbuf_put_u32(m, state->rekey_interval)) != 0 ||\n\t    (r = sshbuf_put_u32(m, state->p_send.seqnr)) != 0 ||\n\t    (r = sshbuf_put_u64(m, state->p_send.blocks)) != 0 ||\n\t    (r = sshbuf_put_u32(m, state->p_send.packets)) != 0 ||\n\t    (r = sshbuf_put_u64(m, state->p_send.bytes)) != 0 ||\n\t    (r = sshbuf_put_u32(m, state->p_read.seqnr)) != 0 ||\n\t    (r = sshbuf_put_u64(m, state->p_read.blocks)) != 0 ||\n\t    (r = sshbuf_put_u32(m, state->p_read.packets)) != 0 ||\n\t    (r = sshbuf_put_u64(m, state->p_read.bytes)) != 0 ||\n\t    (r = sshbuf_put_stringb(m, state->input)) != 0 ||\n\t    (r = sshbuf_put_stringb(m, state->output)) != 0)\n\t\treturn r;\n\n\treturn 0;\n}",
    "includes": [
      "#include \"sshbuf.h\"",
      "#include \"ssherr.h\"",
      "#include \"packet.h\"",
      "#include \"ssh.h\"",
      "#include \"channels.h\"",
      "#include \"misc.h\"",
      "#include \"canohost.h\"",
      "#include \"log.h\"",
      "#include \"mac.h\"",
      "#include \"digest.h\"",
      "#include \"kex.h\"",
      "#include \"sshkey.h\"",
      "#include \"cipher.h\"",
      "#include \"ssh2.h\"",
      "#include \"compat.h\"",
      "#include \"crc32.h\"",
      "#include \"xmalloc.h\"",
      "#include <zlib.h>",
      "#  include <openssl/ec.h>",
      "# include <openssl/evp.h>",
      "# include <openssl/bn.h>",
      "#include <time.h>",
      "#include <signal.h>",
      "#include <limits.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <stdarg.h>",
      "#include <netdb.h>",
      "#include <errno.h>",
      "#include <arpa/inet.h>",
      "#include <netinet/ip.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include \"openbsd-compat/sys-queue.h\"",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "sshbuf_put_stringb",
          "args": [
            "m",
            "state->output"
          ],
          "line": 2250
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_put_stringb",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf-getput-basic.c",
          "lines": "371-375",
          "snippet": "int\nsshbuf_put_stringb(struct sshbuf *buf, const struct sshbuf *v)\n{\n\treturn sshbuf_put_string(buf, sshbuf_ptr(v), sshbuf_len(v));\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <stdarg.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <stdarg.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshbuf_put_stringb(struct sshbuf *buf, const struct sshbuf *v)\n{\n\treturn sshbuf_put_string(buf, sshbuf_ptr(v), sshbuf_len(v));\n}"
        }
      },
      {
        "call_info": {
          "callee": "sshbuf_put_u64",
          "args": [
            "m",
            "state->p_read.bytes"
          ],
          "line": 2248
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_put_u64",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf-getput-basic.c",
          "lines": "299-309",
          "snippet": "int\nsshbuf_put_u64(struct sshbuf *buf, u_int64_t val)\n{\n\tu_char *p;\n\tint r;\n\n\tif ((r = sshbuf_reserve(buf, 8, &p)) < 0)\n\t\treturn r;\n\tPOKE_U64(p, val);\n\treturn 0;\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <stdarg.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <stdarg.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshbuf_put_u64(struct sshbuf *buf, u_int64_t val)\n{\n\tu_char *p;\n\tint r;\n\n\tif ((r = sshbuf_reserve(buf, 8, &p)) < 0)\n\t\treturn r;\n\tPOKE_U64(p, val);\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "sshbuf_put_u32",
          "args": [
            "m",
            "state->p_read.packets"
          ],
          "line": 2247
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_put_u32",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf-getput-basic.c",
          "lines": "311-321",
          "snippet": "int\nsshbuf_put_u32(struct sshbuf *buf, u_int32_t val)\n{\n\tu_char *p;\n\tint r;\n\n\tif ((r = sshbuf_reserve(buf, 4, &p)) < 0)\n\t\treturn r;\n\tPOKE_U32(p, val);\n\treturn 0;\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <stdarg.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <stdarg.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshbuf_put_u32(struct sshbuf *buf, u_int32_t val)\n{\n\tu_char *p;\n\tint r;\n\n\tif ((r = sshbuf_reserve(buf, 4, &p)) < 0)\n\t\treturn r;\n\tPOKE_U32(p, val);\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "newkeys_to_blob",
          "args": [
            "m",
            "ssh",
            "MODE_IN"
          ],
          "line": 2238
        },
        "resolved": true,
        "details": {
          "function_name": "newkeys_to_blob",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
          "lines": "2186-2227",
          "snippet": "static int\nnewkeys_to_blob(struct sshbuf *m, struct ssh *ssh, int mode)\n{\n\tstruct sshbuf *b;\n\tstruct sshcipher_ctx *cc;\n\tstruct sshcomp *comp;\n\tstruct sshenc *enc;\n\tstruct sshmac *mac;\n\tstruct newkeys *newkey;\n\tint r;\n\n\tif ((newkey = ssh->state->newkeys[mode]) == NULL)\n\t\treturn SSH_ERR_INTERNAL_ERROR;\n\tenc = &newkey->enc;\n\tmac = &newkey->mac;\n\tcomp = &newkey->comp;\n\tcc = (mode == MODE_OUT) ? ssh->state->send_context :\n\t    ssh->state->receive_context;\n\tif ((r = cipher_get_keyiv(cc, enc->iv, enc->iv_len)) != 0)\n\t\treturn r;\n\tif ((b = sshbuf_new()) == NULL)\n\t\treturn SSH_ERR_ALLOC_FAIL;\n\tif ((r = sshbuf_put_cstring(b, enc->name)) != 0 ||\n\t    (r = sshbuf_put_u32(b, enc->enabled)) != 0 ||\n\t    (r = sshbuf_put_u32(b, enc->block_size)) != 0 ||\n\t    (r = sshbuf_put_string(b, enc->key, enc->key_len)) != 0 ||\n\t    (r = sshbuf_put_string(b, enc->iv, enc->iv_len)) != 0)\n\t\tgoto out;\n\tif (cipher_authlen(enc->cipher) == 0) {\n\t\tif ((r = sshbuf_put_cstring(b, mac->name)) != 0 ||\n\t\t    (r = sshbuf_put_u32(b, mac->enabled)) != 0 ||\n\t\t    (r = sshbuf_put_string(b, mac->key, mac->key_len)) != 0)\n\t\t\tgoto out;\n\t}\n\tif ((r = sshbuf_put_u32(b, comp->type)) != 0 ||\n\t    (r = sshbuf_put_cstring(b, comp->name)) != 0)\n\t\tgoto out;\n\tr = sshbuf_put_stringb(m, b);\n out:\n\tsshbuf_free(b);\n\treturn r;\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include \"packet.h\"",
            "#include \"ssh.h\"",
            "#include \"channels.h\"",
            "#include \"misc.h\"",
            "#include \"canohost.h\"",
            "#include \"log.h\"",
            "#include \"mac.h\"",
            "#include \"digest.h\"",
            "#include \"kex.h\"",
            "#include \"sshkey.h\"",
            "#include \"cipher.h\"",
            "#include \"ssh2.h\"",
            "#include \"compat.h\"",
            "#include \"crc32.h\"",
            "#include \"xmalloc.h\"",
            "#include <zlib.h>",
            "#  include <openssl/ec.h>",
            "# include <openssl/evp.h>",
            "# include <openssl/bn.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <limits.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <netdb.h>",
            "#include <errno.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include \"openbsd-compat/sys-queue.h\"",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nstatic int\nnewkeys_to_blob(struct sshbuf *m, struct ssh *ssh, int mode)\n{\n\tstruct sshbuf *b;\n\tstruct sshcipher_ctx *cc;\n\tstruct sshcomp *comp;\n\tstruct sshenc *enc;\n\tstruct sshmac *mac;\n\tstruct newkeys *newkey;\n\tint r;\n\n\tif ((newkey = ssh->state->newkeys[mode]) == NULL)\n\t\treturn SSH_ERR_INTERNAL_ERROR;\n\tenc = &newkey->enc;\n\tmac = &newkey->mac;\n\tcomp = &newkey->comp;\n\tcc = (mode == MODE_OUT) ? ssh->state->send_context :\n\t    ssh->state->receive_context;\n\tif ((r = cipher_get_keyiv(cc, enc->iv, enc->iv_len)) != 0)\n\t\treturn r;\n\tif ((b = sshbuf_new()) == NULL)\n\t\treturn SSH_ERR_ALLOC_FAIL;\n\tif ((r = sshbuf_put_cstring(b, enc->name)) != 0 ||\n\t    (r = sshbuf_put_u32(b, enc->enabled)) != 0 ||\n\t    (r = sshbuf_put_u32(b, enc->block_size)) != 0 ||\n\t    (r = sshbuf_put_string(b, enc->key, enc->key_len)) != 0 ||\n\t    (r = sshbuf_put_string(b, enc->iv, enc->iv_len)) != 0)\n\t\tgoto out;\n\tif (cipher_authlen(enc->cipher) == 0) {\n\t\tif ((r = sshbuf_put_cstring(b, mac->name)) != 0 ||\n\t\t    (r = sshbuf_put_u32(b, mac->enabled)) != 0 ||\n\t\t    (r = sshbuf_put_string(b, mac->key, mac->key_len)) != 0)\n\t\t\tgoto out;\n\t}\n\tif ((r = sshbuf_put_u32(b, comp->type)) != 0 ||\n\t    (r = sshbuf_put_cstring(b, comp->name)) != 0)\n\t\tgoto out;\n\tr = sshbuf_put_stringb(m, b);\n out:\n\tsshbuf_free(b);\n\treturn r;\n}"
        }
      },
      {
        "call_info": {
          "callee": "kex_to_blob",
          "args": [
            "m",
            "ssh->kex"
          ],
          "line": 2236
        },
        "resolved": true,
        "details": {
          "function_name": "kex_to_blob",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
          "lines": "2164-2183",
          "snippet": "static int\nkex_to_blob(struct sshbuf *m, struct kex *kex)\n{\n\tint r;\n\n\tif ((r = sshbuf_put_string(m, kex->session_id,\n\t    kex->session_id_len)) != 0 ||\n\t    (r = sshbuf_put_u32(m, kex->we_need)) != 0 ||\n\t    (r = sshbuf_put_cstring(m, kex->hostkey_alg)) != 0 ||\n\t    (r = sshbuf_put_u32(m, kex->hostkey_type)) != 0 ||\n\t    (r = sshbuf_put_u32(m, kex->hostkey_nid)) != 0 ||\n\t    (r = sshbuf_put_u32(m, kex->kex_type)) != 0 ||\n\t    (r = sshbuf_put_stringb(m, kex->my)) != 0 ||\n\t    (r = sshbuf_put_stringb(m, kex->peer)) != 0 ||\n\t    (r = sshbuf_put_u32(m, kex->flags)) != 0 ||\n\t    (r = sshbuf_put_cstring(m, kex->client_version_string)) != 0 ||\n\t    (r = sshbuf_put_cstring(m, kex->server_version_string)) != 0)\n\t\treturn r;\n\treturn 0;\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include \"packet.h\"",
            "#include \"ssh.h\"",
            "#include \"channels.h\"",
            "#include \"misc.h\"",
            "#include \"canohost.h\"",
            "#include \"log.h\"",
            "#include \"mac.h\"",
            "#include \"digest.h\"",
            "#include \"kex.h\"",
            "#include \"sshkey.h\"",
            "#include \"cipher.h\"",
            "#include \"ssh2.h\"",
            "#include \"compat.h\"",
            "#include \"crc32.h\"",
            "#include \"xmalloc.h\"",
            "#include <zlib.h>",
            "#  include <openssl/ec.h>",
            "# include <openssl/evp.h>",
            "# include <openssl/bn.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <limits.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <netdb.h>",
            "#include <errno.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include \"openbsd-compat/sys-queue.h\"",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nstatic int\nkex_to_blob(struct sshbuf *m, struct kex *kex)\n{\n\tint r;\n\n\tif ((r = sshbuf_put_string(m, kex->session_id,\n\t    kex->session_id_len)) != 0 ||\n\t    (r = sshbuf_put_u32(m, kex->we_need)) != 0 ||\n\t    (r = sshbuf_put_cstring(m, kex->hostkey_alg)) != 0 ||\n\t    (r = sshbuf_put_u32(m, kex->hostkey_type)) != 0 ||\n\t    (r = sshbuf_put_u32(m, kex->hostkey_nid)) != 0 ||\n\t    (r = sshbuf_put_u32(m, kex->kex_type)) != 0 ||\n\t    (r = sshbuf_put_stringb(m, kex->my)) != 0 ||\n\t    (r = sshbuf_put_stringb(m, kex->peer)) != 0 ||\n\t    (r = sshbuf_put_u32(m, kex->flags)) != 0 ||\n\t    (r = sshbuf_put_cstring(m, kex->client_version_string)) != 0 ||\n\t    (r = sshbuf_put_cstring(m, kex->server_version_string)) != 0)\n\t\treturn r;\n\treturn 0;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nssh_packet_get_state(struct ssh *ssh, struct sshbuf *m)\n{\n\tstruct session_state *state = ssh->state;\n\tint r;\n\n\tif ((r = kex_to_blob(m, ssh->kex)) != 0 ||\n\t    (r = newkeys_to_blob(m, ssh, MODE_OUT)) != 0 ||\n\t    (r = newkeys_to_blob(m, ssh, MODE_IN)) != 0 ||\n\t    (r = sshbuf_put_u64(m, state->rekey_limit)) != 0 ||\n\t    (r = sshbuf_put_u32(m, state->rekey_interval)) != 0 ||\n\t    (r = sshbuf_put_u32(m, state->p_send.seqnr)) != 0 ||\n\t    (r = sshbuf_put_u64(m, state->p_send.blocks)) != 0 ||\n\t    (r = sshbuf_put_u32(m, state->p_send.packets)) != 0 ||\n\t    (r = sshbuf_put_u64(m, state->p_send.bytes)) != 0 ||\n\t    (r = sshbuf_put_u32(m, state->p_read.seqnr)) != 0 ||\n\t    (r = sshbuf_put_u64(m, state->p_read.blocks)) != 0 ||\n\t    (r = sshbuf_put_u32(m, state->p_read.packets)) != 0 ||\n\t    (r = sshbuf_put_u64(m, state->p_read.bytes)) != 0 ||\n\t    (r = sshbuf_put_stringb(m, state->input)) != 0 ||\n\t    (r = sshbuf_put_stringb(m, state->output)) != 0)\n\t\treturn r;\n\n\treturn 0;\n}"
  },
  {
    "function_name": "newkeys_to_blob",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
    "lines": "2186-2227",
    "snippet": "static int\nnewkeys_to_blob(struct sshbuf *m, struct ssh *ssh, int mode)\n{\n\tstruct sshbuf *b;\n\tstruct sshcipher_ctx *cc;\n\tstruct sshcomp *comp;\n\tstruct sshenc *enc;\n\tstruct sshmac *mac;\n\tstruct newkeys *newkey;\n\tint r;\n\n\tif ((newkey = ssh->state->newkeys[mode]) == NULL)\n\t\treturn SSH_ERR_INTERNAL_ERROR;\n\tenc = &newkey->enc;\n\tmac = &newkey->mac;\n\tcomp = &newkey->comp;\n\tcc = (mode == MODE_OUT) ? ssh->state->send_context :\n\t    ssh->state->receive_context;\n\tif ((r = cipher_get_keyiv(cc, enc->iv, enc->iv_len)) != 0)\n\t\treturn r;\n\tif ((b = sshbuf_new()) == NULL)\n\t\treturn SSH_ERR_ALLOC_FAIL;\n\tif ((r = sshbuf_put_cstring(b, enc->name)) != 0 ||\n\t    (r = sshbuf_put_u32(b, enc->enabled)) != 0 ||\n\t    (r = sshbuf_put_u32(b, enc->block_size)) != 0 ||\n\t    (r = sshbuf_put_string(b, enc->key, enc->key_len)) != 0 ||\n\t    (r = sshbuf_put_string(b, enc->iv, enc->iv_len)) != 0)\n\t\tgoto out;\n\tif (cipher_authlen(enc->cipher) == 0) {\n\t\tif ((r = sshbuf_put_cstring(b, mac->name)) != 0 ||\n\t\t    (r = sshbuf_put_u32(b, mac->enabled)) != 0 ||\n\t\t    (r = sshbuf_put_string(b, mac->key, mac->key_len)) != 0)\n\t\t\tgoto out;\n\t}\n\tif ((r = sshbuf_put_u32(b, comp->type)) != 0 ||\n\t    (r = sshbuf_put_cstring(b, comp->name)) != 0)\n\t\tgoto out;\n\tr = sshbuf_put_stringb(m, b);\n out:\n\tsshbuf_free(b);\n\treturn r;\n}",
    "includes": [
      "#include \"sshbuf.h\"",
      "#include \"ssherr.h\"",
      "#include \"packet.h\"",
      "#include \"ssh.h\"",
      "#include \"channels.h\"",
      "#include \"misc.h\"",
      "#include \"canohost.h\"",
      "#include \"log.h\"",
      "#include \"mac.h\"",
      "#include \"digest.h\"",
      "#include \"kex.h\"",
      "#include \"sshkey.h\"",
      "#include \"cipher.h\"",
      "#include \"ssh2.h\"",
      "#include \"compat.h\"",
      "#include \"crc32.h\"",
      "#include \"xmalloc.h\"",
      "#include <zlib.h>",
      "#  include <openssl/ec.h>",
      "# include <openssl/evp.h>",
      "# include <openssl/bn.h>",
      "#include <time.h>",
      "#include <signal.h>",
      "#include <limits.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <stdarg.h>",
      "#include <netdb.h>",
      "#include <errno.h>",
      "#include <arpa/inet.h>",
      "#include <netinet/ip.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include \"openbsd-compat/sys-queue.h\"",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "sshbuf_free",
          "args": [
            "b"
          ],
          "line": 2225
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf.c",
          "lines": "133-166",
          "snippet": "void\nsshbuf_free(struct sshbuf *buf)\n{\n\tif (buf == NULL)\n\t\treturn;\n\t/*\n\t * The following will leak on insane buffers, but this is the safest\n\t * course of action - an invalid pointer or already-freed pointer may\n\t * have been passed to us and continuing to scribble over memory would\n\t * be bad.\n\t */\n\tif (sshbuf_check_sanity(buf) != 0)\n\t\treturn;\n\t/*\n\t * If we are a child, the free our parent to decrement its reference\n\t * count and possibly free it.\n\t */\n\tsshbuf_free(buf->parent);\n\tbuf->parent = NULL;\n\t/*\n\t * If we are a parent with still-extant children, then don't free just\n\t * yet. The last child's call to sshbuf_free should decrement our\n\t * refcount to 0 and trigger the actual free.\n\t */\n\tbuf->refcount--;\n\tif (buf->refcount > 0)\n\t\treturn;\n\tif (!buf->readonly) {\n\t\texplicit_bzero(buf->d, buf->alloc);\n\t\tfree(buf->d);\n\t}\n\texplicit_bzero(buf, sizeof(*buf));\n\tfree(buf);\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <signal.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <signal.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\nsshbuf_free(struct sshbuf *buf)\n{\n\tif (buf == NULL)\n\t\treturn;\n\t/*\n\t * The following will leak on insane buffers, but this is the safest\n\t * course of action - an invalid pointer or already-freed pointer may\n\t * have been passed to us and continuing to scribble over memory would\n\t * be bad.\n\t */\n\tif (sshbuf_check_sanity(buf) != 0)\n\t\treturn;\n\t/*\n\t * If we are a child, the free our parent to decrement its reference\n\t * count and possibly free it.\n\t */\n\tsshbuf_free(buf->parent);\n\tbuf->parent = NULL;\n\t/*\n\t * If we are a parent with still-extant children, then don't free just\n\t * yet. The last child's call to sshbuf_free should decrement our\n\t * refcount to 0 and trigger the actual free.\n\t */\n\tbuf->refcount--;\n\tif (buf->refcount > 0)\n\t\treturn;\n\tif (!buf->readonly) {\n\t\texplicit_bzero(buf->d, buf->alloc);\n\t\tfree(buf->d);\n\t}\n\texplicit_bzero(buf, sizeof(*buf));\n\tfree(buf);\n}"
        }
      },
      {
        "call_info": {
          "callee": "sshbuf_put_stringb",
          "args": [
            "m",
            "b"
          ],
          "line": 2223
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_put_stringb",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf-getput-basic.c",
          "lines": "371-375",
          "snippet": "int\nsshbuf_put_stringb(struct sshbuf *buf, const struct sshbuf *v)\n{\n\treturn sshbuf_put_string(buf, sshbuf_ptr(v), sshbuf_len(v));\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <stdarg.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <stdarg.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshbuf_put_stringb(struct sshbuf *buf, const struct sshbuf *v)\n{\n\treturn sshbuf_put_string(buf, sshbuf_ptr(v), sshbuf_len(v));\n}"
        }
      },
      {
        "call_info": {
          "callee": "sshbuf_put_cstring",
          "args": [
            "b",
            "comp->name"
          ],
          "line": 2221
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_put_cstring",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf-getput-basic.c",
          "lines": "365-369",
          "snippet": "int\nsshbuf_put_cstring(struct sshbuf *buf, const char *v)\n{\n\treturn sshbuf_put_string(buf, v, v == NULL ? 0 : strlen(v));\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <stdarg.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <stdarg.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshbuf_put_cstring(struct sshbuf *buf, const char *v)\n{\n\treturn sshbuf_put_string(buf, v, v == NULL ? 0 : strlen(v));\n}"
        }
      },
      {
        "call_info": {
          "callee": "sshbuf_put_u32",
          "args": [
            "b",
            "comp->type"
          ],
          "line": 2220
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_put_u32",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf-getput-basic.c",
          "lines": "311-321",
          "snippet": "int\nsshbuf_put_u32(struct sshbuf *buf, u_int32_t val)\n{\n\tu_char *p;\n\tint r;\n\n\tif ((r = sshbuf_reserve(buf, 4, &p)) < 0)\n\t\treturn r;\n\tPOKE_U32(p, val);\n\treturn 0;\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <stdarg.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <stdarg.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshbuf_put_u32(struct sshbuf *buf, u_int32_t val)\n{\n\tu_char *p;\n\tint r;\n\n\tif ((r = sshbuf_reserve(buf, 4, &p)) < 0)\n\t\treturn r;\n\tPOKE_U32(p, val);\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "sshbuf_put_string",
          "args": [
            "b",
            "mac->key",
            "mac->key_len"
          ],
          "line": 2217
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_put_string",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf-getput-basic.c",
          "lines": "347-363",
          "snippet": "int\nsshbuf_put_string(struct sshbuf *buf, const void *v, size_t len)\n{\n\tu_char *d;\n\tint r;\n\n\tif (len > SSHBUF_SIZE_MAX - 4) {\n\t\tSSHBUF_DBG((\"SSH_ERR_NO_BUFFER_SPACE\"));\n\t\treturn SSH_ERR_NO_BUFFER_SPACE;\n\t}\n\tif ((r = sshbuf_reserve(buf, len + 4, &d)) < 0)\n\t\treturn r;\n\tPOKE_U32(d, len);\n\tif (len != 0)\n\t\tmemcpy(d + 4, v, len);\n\treturn 0;\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <stdarg.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <stdarg.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshbuf_put_string(struct sshbuf *buf, const void *v, size_t len)\n{\n\tu_char *d;\n\tint r;\n\n\tif (len > SSHBUF_SIZE_MAX - 4) {\n\t\tSSHBUF_DBG((\"SSH_ERR_NO_BUFFER_SPACE\"));\n\t\treturn SSH_ERR_NO_BUFFER_SPACE;\n\t}\n\tif ((r = sshbuf_reserve(buf, len + 4, &d)) < 0)\n\t\treturn r;\n\tPOKE_U32(d, len);\n\tif (len != 0)\n\t\tmemcpy(d + 4, v, len);\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "cipher_authlen",
          "args": [
            "enc->cipher"
          ],
          "line": 2214
        },
        "resolved": true,
        "details": {
          "function_name": "cipher_authlen",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/cipher.c",
          "lines": "163-167",
          "snippet": "u_int\ncipher_authlen(const struct sshcipher *c)\n{\n\treturn (c->auth_len);\n}",
          "includes": [
            "#include \"openbsd-compat/openssl-compat.h\"",
            "#include \"digest.h\"",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"misc.h\"",
            "#include \"cipher.h\"",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <string.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"openbsd-compat/openssl-compat.h\"\n#include \"digest.h\"\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"misc.h\"\n#include \"cipher.h\"\n#include <stdio.h>\n#include <stdarg.h>\n#include <string.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nu_int\ncipher_authlen(const struct sshcipher *c)\n{\n\treturn (c->auth_len);\n}"
        }
      },
      {
        "call_info": {
          "callee": "sshbuf_new",
          "args": [],
          "line": 2206
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_new",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf.c",
          "lines": "68-85",
          "snippet": "struct sshbuf *\nsshbuf_new(void)\n{\n\tstruct sshbuf *ret;\n\n\tif ((ret = calloc(sizeof(*ret), 1)) == NULL)\n\t\treturn NULL;\n\tret->alloc = SSHBUF_SIZE_INIT;\n\tret->max_size = SSHBUF_SIZE_MAX;\n\tret->readonly = 0;\n\tret->refcount = 1;\n\tret->parent = NULL;\n\tif ((ret->cd = ret->d = calloc(1, ret->alloc)) == NULL) {\n\t\tfree(ret);\n\t\treturn NULL;\n\t}\n\treturn ret;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <signal.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <signal.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nstruct sshbuf *\nsshbuf_new(void)\n{\n\tstruct sshbuf *ret;\n\n\tif ((ret = calloc(sizeof(*ret), 1)) == NULL)\n\t\treturn NULL;\n\tret->alloc = SSHBUF_SIZE_INIT;\n\tret->max_size = SSHBUF_SIZE_MAX;\n\tret->readonly = 0;\n\tret->refcount = 1;\n\tret->parent = NULL;\n\tif ((ret->cd = ret->d = calloc(1, ret->alloc)) == NULL) {\n\t\tfree(ret);\n\t\treturn NULL;\n\t}\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "cipher_get_keyiv",
          "args": [
            "cc",
            "enc->iv",
            "enc->iv_len"
          ],
          "line": 2204
        },
        "resolved": true,
        "details": {
          "function_name": "cipher_get_keyiv",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/cipher.c",
          "lines": "448-491",
          "snippet": "int\ncipher_get_keyiv(struct sshcipher_ctx *cc, u_char *iv, size_t len)\n{\n#ifdef WITH_OPENSSL\n\tconst struct sshcipher *c = cc->cipher;\n\tint evplen;\n#endif\n\n\tif ((cc->cipher->flags & CFLAG_CHACHAPOLY) != 0) {\n\t\tif (len != 0)\n\t\t\treturn SSH_ERR_INVALID_ARGUMENT;\n\t\treturn 0;\n\t}\n\tif ((cc->cipher->flags & CFLAG_AESCTR) != 0) {\n\t\tif (len != sizeof(cc->ac_ctx.ctr))\n\t\t\treturn SSH_ERR_INVALID_ARGUMENT;\n\t\tmemcpy(iv, cc->ac_ctx.ctr, len);\n\t\treturn 0;\n\t}\n\tif ((cc->cipher->flags & CFLAG_NONE) != 0)\n\t\treturn 0;\n\n#ifdef WITH_OPENSSL\n\tevplen = EVP_CIPHER_CTX_iv_length(cc->evp);\n\tif (evplen == 0)\n\t\treturn 0;\n\telse if (evplen < 0)\n\t\treturn SSH_ERR_LIBCRYPTO_ERROR;\n\tif ((size_t)evplen != len)\n\t\treturn SSH_ERR_INVALID_ARGUMENT;\n#ifndef OPENSSL_HAVE_EVPCTR\n\tif (c->evptype == evp_aes_128_ctr)\n\t\tssh_aes_ctr_iv(cc->evp, 0, iv, len);\n\telse\n#endif\n\tif (cipher_authlen(c)) {\n\t\tif (!EVP_CIPHER_CTX_ctrl(cc->evp, EVP_CTRL_GCM_IV_GEN,\n\t\t   len, iv))\n\t\t       return SSH_ERR_LIBCRYPTO_ERROR;\n\t} else if (!EVP_CIPHER_CTX_get_iv(cc->evp, iv, len))\n\t       return SSH_ERR_LIBCRYPTO_ERROR;\n#endif\n\treturn 0;\n}",
          "includes": [
            "#include \"openbsd-compat/openssl-compat.h\"",
            "#include \"digest.h\"",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"misc.h\"",
            "#include \"cipher.h\"",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <string.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [
            "#define CFLAG_NONE\t\t(1<<3)",
            "#define CFLAG_AESCTR\t\t(1<<2)",
            "#define CFLAG_CHACHAPOLY\t(1<<1)"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"openbsd-compat/openssl-compat.h\"\n#include \"digest.h\"\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"misc.h\"\n#include \"cipher.h\"\n#include <stdio.h>\n#include <stdarg.h>\n#include <string.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\n#define CFLAG_NONE\t\t(1<<3)\n#define CFLAG_AESCTR\t\t(1<<2)\n#define CFLAG_CHACHAPOLY\t(1<<1)\n\nint\ncipher_get_keyiv(struct sshcipher_ctx *cc, u_char *iv, size_t len)\n{\n#ifdef WITH_OPENSSL\n\tconst struct sshcipher *c = cc->cipher;\n\tint evplen;\n#endif\n\n\tif ((cc->cipher->flags & CFLAG_CHACHAPOLY) != 0) {\n\t\tif (len != 0)\n\t\t\treturn SSH_ERR_INVALID_ARGUMENT;\n\t\treturn 0;\n\t}\n\tif ((cc->cipher->flags & CFLAG_AESCTR) != 0) {\n\t\tif (len != sizeof(cc->ac_ctx.ctr))\n\t\t\treturn SSH_ERR_INVALID_ARGUMENT;\n\t\tmemcpy(iv, cc->ac_ctx.ctr, len);\n\t\treturn 0;\n\t}\n\tif ((cc->cipher->flags & CFLAG_NONE) != 0)\n\t\treturn 0;\n\n#ifdef WITH_OPENSSL\n\tevplen = EVP_CIPHER_CTX_iv_length(cc->evp);\n\tif (evplen == 0)\n\t\treturn 0;\n\telse if (evplen < 0)\n\t\treturn SSH_ERR_LIBCRYPTO_ERROR;\n\tif ((size_t)evplen != len)\n\t\treturn SSH_ERR_INVALID_ARGUMENT;\n#ifndef OPENSSL_HAVE_EVPCTR\n\tif (c->evptype == evp_aes_128_ctr)\n\t\tssh_aes_ctr_iv(cc->evp, 0, iv, len);\n\telse\n#endif\n\tif (cipher_authlen(c)) {\n\t\tif (!EVP_CIPHER_CTX_ctrl(cc->evp, EVP_CTRL_GCM_IV_GEN,\n\t\t   len, iv))\n\t\t       return SSH_ERR_LIBCRYPTO_ERROR;\n\t} else if (!EVP_CIPHER_CTX_get_iv(cc->evp, iv, len))\n\t       return SSH_ERR_LIBCRYPTO_ERROR;\n#endif\n\treturn 0;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nstatic int\nnewkeys_to_blob(struct sshbuf *m, struct ssh *ssh, int mode)\n{\n\tstruct sshbuf *b;\n\tstruct sshcipher_ctx *cc;\n\tstruct sshcomp *comp;\n\tstruct sshenc *enc;\n\tstruct sshmac *mac;\n\tstruct newkeys *newkey;\n\tint r;\n\n\tif ((newkey = ssh->state->newkeys[mode]) == NULL)\n\t\treturn SSH_ERR_INTERNAL_ERROR;\n\tenc = &newkey->enc;\n\tmac = &newkey->mac;\n\tcomp = &newkey->comp;\n\tcc = (mode == MODE_OUT) ? ssh->state->send_context :\n\t    ssh->state->receive_context;\n\tif ((r = cipher_get_keyiv(cc, enc->iv, enc->iv_len)) != 0)\n\t\treturn r;\n\tif ((b = sshbuf_new()) == NULL)\n\t\treturn SSH_ERR_ALLOC_FAIL;\n\tif ((r = sshbuf_put_cstring(b, enc->name)) != 0 ||\n\t    (r = sshbuf_put_u32(b, enc->enabled)) != 0 ||\n\t    (r = sshbuf_put_u32(b, enc->block_size)) != 0 ||\n\t    (r = sshbuf_put_string(b, enc->key, enc->key_len)) != 0 ||\n\t    (r = sshbuf_put_string(b, enc->iv, enc->iv_len)) != 0)\n\t\tgoto out;\n\tif (cipher_authlen(enc->cipher) == 0) {\n\t\tif ((r = sshbuf_put_cstring(b, mac->name)) != 0 ||\n\t\t    (r = sshbuf_put_u32(b, mac->enabled)) != 0 ||\n\t\t    (r = sshbuf_put_string(b, mac->key, mac->key_len)) != 0)\n\t\t\tgoto out;\n\t}\n\tif ((r = sshbuf_put_u32(b, comp->type)) != 0 ||\n\t    (r = sshbuf_put_cstring(b, comp->name)) != 0)\n\t\tgoto out;\n\tr = sshbuf_put_stringb(m, b);\n out:\n\tsshbuf_free(b);\n\treturn r;\n}"
  },
  {
    "function_name": "kex_to_blob",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
    "lines": "2164-2183",
    "snippet": "static int\nkex_to_blob(struct sshbuf *m, struct kex *kex)\n{\n\tint r;\n\n\tif ((r = sshbuf_put_string(m, kex->session_id,\n\t    kex->session_id_len)) != 0 ||\n\t    (r = sshbuf_put_u32(m, kex->we_need)) != 0 ||\n\t    (r = sshbuf_put_cstring(m, kex->hostkey_alg)) != 0 ||\n\t    (r = sshbuf_put_u32(m, kex->hostkey_type)) != 0 ||\n\t    (r = sshbuf_put_u32(m, kex->hostkey_nid)) != 0 ||\n\t    (r = sshbuf_put_u32(m, kex->kex_type)) != 0 ||\n\t    (r = sshbuf_put_stringb(m, kex->my)) != 0 ||\n\t    (r = sshbuf_put_stringb(m, kex->peer)) != 0 ||\n\t    (r = sshbuf_put_u32(m, kex->flags)) != 0 ||\n\t    (r = sshbuf_put_cstring(m, kex->client_version_string)) != 0 ||\n\t    (r = sshbuf_put_cstring(m, kex->server_version_string)) != 0)\n\t\treturn r;\n\treturn 0;\n}",
    "includes": [
      "#include \"sshbuf.h\"",
      "#include \"ssherr.h\"",
      "#include \"packet.h\"",
      "#include \"ssh.h\"",
      "#include \"channels.h\"",
      "#include \"misc.h\"",
      "#include \"canohost.h\"",
      "#include \"log.h\"",
      "#include \"mac.h\"",
      "#include \"digest.h\"",
      "#include \"kex.h\"",
      "#include \"sshkey.h\"",
      "#include \"cipher.h\"",
      "#include \"ssh2.h\"",
      "#include \"compat.h\"",
      "#include \"crc32.h\"",
      "#include \"xmalloc.h\"",
      "#include <zlib.h>",
      "#  include <openssl/ec.h>",
      "# include <openssl/evp.h>",
      "# include <openssl/bn.h>",
      "#include <time.h>",
      "#include <signal.h>",
      "#include <limits.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <stdarg.h>",
      "#include <netdb.h>",
      "#include <errno.h>",
      "#include <arpa/inet.h>",
      "#include <netinet/ip.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include \"openbsd-compat/sys-queue.h\"",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "sshbuf_put_cstring",
          "args": [
            "m",
            "kex->server_version_string"
          ],
          "line": 2180
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_put_cstring",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf-getput-basic.c",
          "lines": "365-369",
          "snippet": "int\nsshbuf_put_cstring(struct sshbuf *buf, const char *v)\n{\n\treturn sshbuf_put_string(buf, v, v == NULL ? 0 : strlen(v));\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <stdarg.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <stdarg.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshbuf_put_cstring(struct sshbuf *buf, const char *v)\n{\n\treturn sshbuf_put_string(buf, v, v == NULL ? 0 : strlen(v));\n}"
        }
      },
      {
        "call_info": {
          "callee": "sshbuf_put_u32",
          "args": [
            "m",
            "kex->flags"
          ],
          "line": 2178
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_put_u32",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf-getput-basic.c",
          "lines": "311-321",
          "snippet": "int\nsshbuf_put_u32(struct sshbuf *buf, u_int32_t val)\n{\n\tu_char *p;\n\tint r;\n\n\tif ((r = sshbuf_reserve(buf, 4, &p)) < 0)\n\t\treturn r;\n\tPOKE_U32(p, val);\n\treturn 0;\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <stdarg.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <stdarg.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshbuf_put_u32(struct sshbuf *buf, u_int32_t val)\n{\n\tu_char *p;\n\tint r;\n\n\tif ((r = sshbuf_reserve(buf, 4, &p)) < 0)\n\t\treturn r;\n\tPOKE_U32(p, val);\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "sshbuf_put_stringb",
          "args": [
            "m",
            "kex->peer"
          ],
          "line": 2177
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_put_stringb",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf-getput-basic.c",
          "lines": "371-375",
          "snippet": "int\nsshbuf_put_stringb(struct sshbuf *buf, const struct sshbuf *v)\n{\n\treturn sshbuf_put_string(buf, sshbuf_ptr(v), sshbuf_len(v));\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <stdarg.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <stdarg.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshbuf_put_stringb(struct sshbuf *buf, const struct sshbuf *v)\n{\n\treturn sshbuf_put_string(buf, sshbuf_ptr(v), sshbuf_len(v));\n}"
        }
      },
      {
        "call_info": {
          "callee": "sshbuf_put_string",
          "args": [
            "m",
            "kex->session_id",
            "kex->session_id_len"
          ],
          "line": 2169
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_put_string",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf-getput-basic.c",
          "lines": "347-363",
          "snippet": "int\nsshbuf_put_string(struct sshbuf *buf, const void *v, size_t len)\n{\n\tu_char *d;\n\tint r;\n\n\tif (len > SSHBUF_SIZE_MAX - 4) {\n\t\tSSHBUF_DBG((\"SSH_ERR_NO_BUFFER_SPACE\"));\n\t\treturn SSH_ERR_NO_BUFFER_SPACE;\n\t}\n\tif ((r = sshbuf_reserve(buf, len + 4, &d)) < 0)\n\t\treturn r;\n\tPOKE_U32(d, len);\n\tif (len != 0)\n\t\tmemcpy(d + 4, v, len);\n\treturn 0;\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <stdarg.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <stdarg.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshbuf_put_string(struct sshbuf *buf, const void *v, size_t len)\n{\n\tu_char *d;\n\tint r;\n\n\tif (len > SSHBUF_SIZE_MAX - 4) {\n\t\tSSHBUF_DBG((\"SSH_ERR_NO_BUFFER_SPACE\"));\n\t\treturn SSH_ERR_NO_BUFFER_SPACE;\n\t}\n\tif ((r = sshbuf_reserve(buf, len + 4, &d)) < 0)\n\t\treturn r;\n\tPOKE_U32(d, len);\n\tif (len != 0)\n\t\tmemcpy(d + 4, v, len);\n\treturn 0;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nstatic int\nkex_to_blob(struct sshbuf *m, struct kex *kex)\n{\n\tint r;\n\n\tif ((r = sshbuf_put_string(m, kex->session_id,\n\t    kex->session_id_len)) != 0 ||\n\t    (r = sshbuf_put_u32(m, kex->we_need)) != 0 ||\n\t    (r = sshbuf_put_cstring(m, kex->hostkey_alg)) != 0 ||\n\t    (r = sshbuf_put_u32(m, kex->hostkey_type)) != 0 ||\n\t    (r = sshbuf_put_u32(m, kex->hostkey_nid)) != 0 ||\n\t    (r = sshbuf_put_u32(m, kex->kex_type)) != 0 ||\n\t    (r = sshbuf_put_stringb(m, kex->my)) != 0 ||\n\t    (r = sshbuf_put_stringb(m, kex->peer)) != 0 ||\n\t    (r = sshbuf_put_u32(m, kex->flags)) != 0 ||\n\t    (r = sshbuf_put_cstring(m, kex->client_version_string)) != 0 ||\n\t    (r = sshbuf_put_cstring(m, kex->server_version_string)) != 0)\n\t\treturn r;\n\treturn 0;\n}"
  },
  {
    "function_name": "ssh_packet_set_postauth",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
    "lines": "2147-2159",
    "snippet": "static int\nssh_packet_set_postauth(struct ssh *ssh)\n{\n\tint r;\n\n\tdebug(\"%s: called\", __func__);\n\t/* This was set in net child, but is not visible in user child */\n\tssh->state->after_authentication = 1;\n\tssh->state->rekeying = 0;\n\tif ((r = ssh_packet_enable_delayed_compress(ssh)) != 0)\n\t\treturn r;\n\treturn 0;\n}",
    "includes": [
      "#include \"sshbuf.h\"",
      "#include \"ssherr.h\"",
      "#include \"packet.h\"",
      "#include \"ssh.h\"",
      "#include \"channels.h\"",
      "#include \"misc.h\"",
      "#include \"canohost.h\"",
      "#include \"log.h\"",
      "#include \"mac.h\"",
      "#include \"digest.h\"",
      "#include \"kex.h\"",
      "#include \"sshkey.h\"",
      "#include \"cipher.h\"",
      "#include \"ssh2.h\"",
      "#include \"compat.h\"",
      "#include \"crc32.h\"",
      "#include \"xmalloc.h\"",
      "#include <zlib.h>",
      "#  include <openssl/ec.h>",
      "# include <openssl/evp.h>",
      "# include <openssl/bn.h>",
      "#include <time.h>",
      "#include <signal.h>",
      "#include <limits.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <stdarg.h>",
      "#include <netdb.h>",
      "#include <errno.h>",
      "#include <arpa/inet.h>",
      "#include <netinet/ip.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include \"openbsd-compat/sys-queue.h\"",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "ssh_packet_enable_delayed_compress",
          "args": [
            "ssh"
          ],
          "line": 2156
        },
        "resolved": true,
        "details": {
          "function_name": "ssh_packet_enable_delayed_compress",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
          "lines": "976-1007",
          "snippet": "static int\nssh_packet_enable_delayed_compress(struct ssh *ssh)\n{\n\tstruct session_state *state = ssh->state;\n\tstruct sshcomp *comp = NULL;\n\tint r, mode;\n\n\t/*\n\t * Remember that we are past the authentication step, so rekeying\n\t * with COMP_DELAYED will turn on compression immediately.\n\t */\n\tstate->after_authentication = 1;\n\tfor (mode = 0; mode < MODE_MAX; mode++) {\n\t\t/* protocol error: USERAUTH_SUCCESS received before NEWKEYS */\n\t\tif (state->newkeys[mode] == NULL)\n\t\t\tcontinue;\n\t\tcomp = &state->newkeys[mode]->comp;\n\t\tif (comp && !comp->enabled && comp->type == COMP_DELAYED) {\n\t\t\tif ((r = ssh_packet_init_compression(ssh)) != 0)\n\t\t\t\treturn r;\n\t\t\tif (mode == MODE_OUT) {\n\t\t\t\tif ((r = start_compression_out(ssh, 6)) != 0)\n\t\t\t\t\treturn r;\n\t\t\t} else {\n\t\t\t\tif ((r = start_compression_in(ssh)) != 0)\n\t\t\t\t\treturn r;\n\t\t\t}\n\t\t\tcomp->enabled = 1;\n\t\t}\n\t}\n\treturn 0;\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include \"packet.h\"",
            "#include \"ssh.h\"",
            "#include \"channels.h\"",
            "#include \"misc.h\"",
            "#include \"canohost.h\"",
            "#include \"log.h\"",
            "#include \"mac.h\"",
            "#include \"digest.h\"",
            "#include \"kex.h\"",
            "#include \"sshkey.h\"",
            "#include \"cipher.h\"",
            "#include \"ssh2.h\"",
            "#include \"compat.h\"",
            "#include \"crc32.h\"",
            "#include \"xmalloc.h\"",
            "#include <zlib.h>",
            "#  include <openssl/ec.h>",
            "# include <openssl/evp.h>",
            "# include <openssl/bn.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <limits.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <netdb.h>",
            "#include <errno.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include \"openbsd-compat/sys-queue.h\"",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nstatic int\nssh_packet_enable_delayed_compress(struct ssh *ssh)\n{\n\tstruct session_state *state = ssh->state;\n\tstruct sshcomp *comp = NULL;\n\tint r, mode;\n\n\t/*\n\t * Remember that we are past the authentication step, so rekeying\n\t * with COMP_DELAYED will turn on compression immediately.\n\t */\n\tstate->after_authentication = 1;\n\tfor (mode = 0; mode < MODE_MAX; mode++) {\n\t\t/* protocol error: USERAUTH_SUCCESS received before NEWKEYS */\n\t\tif (state->newkeys[mode] == NULL)\n\t\t\tcontinue;\n\t\tcomp = &state->newkeys[mode]->comp;\n\t\tif (comp && !comp->enabled && comp->type == COMP_DELAYED) {\n\t\t\tif ((r = ssh_packet_init_compression(ssh)) != 0)\n\t\t\t\treturn r;\n\t\t\tif (mode == MODE_OUT) {\n\t\t\t\tif ((r = start_compression_out(ssh, 6)) != 0)\n\t\t\t\t\treturn r;\n\t\t\t} else {\n\t\t\t\tif ((r = start_compression_in(ssh)) != 0)\n\t\t\t\t\treturn r;\n\t\t\t}\n\t\t\tcomp->enabled = 1;\n\t\t}\n\t}\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "debug",
          "args": [
            "\"%s: called\"",
            "__func__"
          ],
          "line": 2152
        },
        "resolved": true,
        "details": {
          "function_name": "ssh_packet_send_debug",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
          "lines": "1771-1794",
          "snippet": "void\nssh_packet_send_debug(struct ssh *ssh, const char *fmt,...)\n{\n\tchar buf[1024];\n\tva_list args;\n\tint r;\n\n\tif ((ssh->compat & SSH_BUG_DEBUG))\n\t\treturn;\n\n\tva_start(args, fmt);\n\tvsnprintf(buf, sizeof(buf), fmt, args);\n\tva_end(args);\n\n\tdebug3(\"sending debug message: %s\", buf);\n\n\tif ((r = sshpkt_start(ssh, SSH2_MSG_DEBUG)) != 0 ||\n\t    (r = sshpkt_put_u8(ssh, 0)) != 0 || /* always display */\n\t    (r = sshpkt_put_cstring(ssh, buf)) != 0 ||\n\t    (r = sshpkt_put_cstring(ssh, \"\")) != 0 ||\n\t    (r = sshpkt_send(ssh)) != 0 ||\n\t    (r = ssh_packet_write_wait(ssh)) != 0)\n\t\tfatal(\"%s: %s\", __func__, ssh_err(r));\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include \"packet.h\"",
            "#include \"ssh.h\"",
            "#include \"channels.h\"",
            "#include \"misc.h\"",
            "#include \"canohost.h\"",
            "#include \"log.h\"",
            "#include \"mac.h\"",
            "#include \"digest.h\"",
            "#include \"kex.h\"",
            "#include \"sshkey.h\"",
            "#include \"cipher.h\"",
            "#include \"ssh2.h\"",
            "#include \"compat.h\"",
            "#include \"crc32.h\"",
            "#include \"xmalloc.h\"",
            "#include <zlib.h>",
            "#  include <openssl/ec.h>",
            "# include <openssl/evp.h>",
            "# include <openssl/bn.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <limits.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <netdb.h>",
            "#include <errno.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include \"openbsd-compat/sys-queue.h\"",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\nssh_packet_send_debug(struct ssh *ssh, const char *fmt,...)\n{\n\tchar buf[1024];\n\tva_list args;\n\tint r;\n\n\tif ((ssh->compat & SSH_BUG_DEBUG))\n\t\treturn;\n\n\tva_start(args, fmt);\n\tvsnprintf(buf, sizeof(buf), fmt, args);\n\tva_end(args);\n\n\tdebug3(\"sending debug message: %s\", buf);\n\n\tif ((r = sshpkt_start(ssh, SSH2_MSG_DEBUG)) != 0 ||\n\t    (r = sshpkt_put_u8(ssh, 0)) != 0 || /* always display */\n\t    (r = sshpkt_put_cstring(ssh, buf)) != 0 ||\n\t    (r = sshpkt_put_cstring(ssh, \"\")) != 0 ||\n\t    (r = sshpkt_send(ssh)) != 0 ||\n\t    (r = ssh_packet_write_wait(ssh)) != 0)\n\t\tfatal(\"%s: %s\", __func__, ssh_err(r));\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nstatic int\nssh_packet_set_postauth(struct ssh *ssh)\n{\n\tint r;\n\n\tdebug(\"%s: called\", __func__);\n\t/* This was set in net child, but is not visible in user child */\n\tssh->state->after_authentication = 1;\n\tssh->state->rekeying = 0;\n\tif ((r = ssh_packet_enable_delayed_compress(ssh)) != 0)\n\t\treturn r;\n\treturn 0;\n}"
  },
  {
    "function_name": "ssh_packet_get_output",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
    "lines": "2140-2144",
    "snippet": "void *\nssh_packet_get_output(struct ssh *ssh)\n{\n\treturn (void *)ssh->state->output;\n}",
    "includes": [
      "#include \"sshbuf.h\"",
      "#include \"ssherr.h\"",
      "#include \"packet.h\"",
      "#include \"ssh.h\"",
      "#include \"channels.h\"",
      "#include \"misc.h\"",
      "#include \"canohost.h\"",
      "#include \"log.h\"",
      "#include \"mac.h\"",
      "#include \"digest.h\"",
      "#include \"kex.h\"",
      "#include \"sshkey.h\"",
      "#include \"cipher.h\"",
      "#include \"ssh2.h\"",
      "#include \"compat.h\"",
      "#include \"crc32.h\"",
      "#include \"xmalloc.h\"",
      "#include <zlib.h>",
      "#  include <openssl/ec.h>",
      "# include <openssl/evp.h>",
      "# include <openssl/bn.h>",
      "#include <time.h>",
      "#include <signal.h>",
      "#include <limits.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <stdarg.h>",
      "#include <netdb.h>",
      "#include <errno.h>",
      "#include <arpa/inet.h>",
      "#include <netinet/ip.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include \"openbsd-compat/sys-queue.h\"",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid *\nssh_packet_get_output(struct ssh *ssh)\n{\n\treturn (void *)ssh->state->output;\n}"
  },
  {
    "function_name": "ssh_packet_get_input",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
    "lines": "2134-2138",
    "snippet": "void *\nssh_packet_get_input(struct ssh *ssh)\n{\n\treturn (void *)ssh->state->input;\n}",
    "includes": [
      "#include \"sshbuf.h\"",
      "#include \"ssherr.h\"",
      "#include \"packet.h\"",
      "#include \"ssh.h\"",
      "#include \"channels.h\"",
      "#include \"misc.h\"",
      "#include \"canohost.h\"",
      "#include \"log.h\"",
      "#include \"mac.h\"",
      "#include \"digest.h\"",
      "#include \"kex.h\"",
      "#include \"sshkey.h\"",
      "#include \"cipher.h\"",
      "#include \"ssh2.h\"",
      "#include \"compat.h\"",
      "#include \"crc32.h\"",
      "#include \"xmalloc.h\"",
      "#include <zlib.h>",
      "#  include <openssl/ec.h>",
      "# include <openssl/evp.h>",
      "# include <openssl/bn.h>",
      "#include <time.h>",
      "#include <signal.h>",
      "#include <limits.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <stdarg.h>",
      "#include <netdb.h>",
      "#include <errno.h>",
      "#include <arpa/inet.h>",
      "#include <netinet/ip.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include \"openbsd-compat/sys-queue.h\"",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid *\nssh_packet_get_input(struct ssh *ssh)\n{\n\treturn (void *)ssh->state->input;\n}"
  },
  {
    "function_name": "ssh_packet_set_authenticated",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
    "lines": "2128-2132",
    "snippet": "void\nssh_packet_set_authenticated(struct ssh *ssh)\n{\n\tssh->state->after_authentication = 1;\n}",
    "includes": [
      "#include \"sshbuf.h\"",
      "#include \"ssherr.h\"",
      "#include \"packet.h\"",
      "#include \"ssh.h\"",
      "#include \"channels.h\"",
      "#include \"misc.h\"",
      "#include \"canohost.h\"",
      "#include \"log.h\"",
      "#include \"mac.h\"",
      "#include \"digest.h\"",
      "#include \"kex.h\"",
      "#include \"sshkey.h\"",
      "#include \"cipher.h\"",
      "#include \"ssh2.h\"",
      "#include \"compat.h\"",
      "#include \"crc32.h\"",
      "#include \"xmalloc.h\"",
      "#include <zlib.h>",
      "#  include <openssl/ec.h>",
      "# include <openssl/evp.h>",
      "# include <openssl/bn.h>",
      "#include <time.h>",
      "#include <signal.h>",
      "#include <limits.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <stdarg.h>",
      "#include <netdb.h>",
      "#include <errno.h>",
      "#include <arpa/inet.h>",
      "#include <netinet/ip.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include \"openbsd-compat/sys-queue.h\"",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\nssh_packet_set_authenticated(struct ssh *ssh)\n{\n\tssh->state->after_authentication = 1;\n}"
  },
  {
    "function_name": "ssh_packet_set_server",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
    "lines": "2122-2126",
    "snippet": "void\nssh_packet_set_server(struct ssh *ssh)\n{\n\tssh->state->server_side = 1;\n}",
    "includes": [
      "#include \"sshbuf.h\"",
      "#include \"ssherr.h\"",
      "#include \"packet.h\"",
      "#include \"ssh.h\"",
      "#include \"channels.h\"",
      "#include \"misc.h\"",
      "#include \"canohost.h\"",
      "#include \"log.h\"",
      "#include \"mac.h\"",
      "#include \"digest.h\"",
      "#include \"kex.h\"",
      "#include \"sshkey.h\"",
      "#include \"cipher.h\"",
      "#include \"ssh2.h\"",
      "#include \"compat.h\"",
      "#include \"crc32.h\"",
      "#include \"xmalloc.h\"",
      "#include <zlib.h>",
      "#  include <openssl/ec.h>",
      "# include <openssl/evp.h>",
      "# include <openssl/bn.h>",
      "#include <time.h>",
      "#include <signal.h>",
      "#include <limits.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <stdarg.h>",
      "#include <netdb.h>",
      "#include <errno.h>",
      "#include <arpa/inet.h>",
      "#include <netinet/ip.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include \"openbsd-compat/sys-queue.h\"",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\nssh_packet_set_server(struct ssh *ssh)\n{\n\tssh->state->server_side = 1;\n}"
  },
  {
    "function_name": "ssh_packet_get_rekey_timeout",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
    "lines": "2112-2120",
    "snippet": "time_t\nssh_packet_get_rekey_timeout(struct ssh *ssh)\n{\n\ttime_t seconds;\n\n\tseconds = ssh->state->rekey_time + ssh->state->rekey_interval -\n\t    monotime();\n\treturn (seconds <= 0 ? 1 : seconds);\n}",
    "includes": [
      "#include \"sshbuf.h\"",
      "#include \"ssherr.h\"",
      "#include \"packet.h\"",
      "#include \"ssh.h\"",
      "#include \"channels.h\"",
      "#include \"misc.h\"",
      "#include \"canohost.h\"",
      "#include \"log.h\"",
      "#include \"mac.h\"",
      "#include \"digest.h\"",
      "#include \"kex.h\"",
      "#include \"sshkey.h\"",
      "#include \"cipher.h\"",
      "#include \"ssh2.h\"",
      "#include \"compat.h\"",
      "#include \"crc32.h\"",
      "#include \"xmalloc.h\"",
      "#include <zlib.h>",
      "#  include <openssl/ec.h>",
      "# include <openssl/evp.h>",
      "# include <openssl/bn.h>",
      "#include <time.h>",
      "#include <signal.h>",
      "#include <limits.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <stdarg.h>",
      "#include <netdb.h>",
      "#include <errno.h>",
      "#include <arpa/inet.h>",
      "#include <netinet/ip.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include \"openbsd-compat/sys-queue.h\"",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "monotime",
          "args": [],
          "line": 2118
        },
        "resolved": true,
        "details": {
          "function_name": "monotime_double",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/misc.c",
          "lines": "1324-1331",
          "snippet": "double\nmonotime_double(void)\n{\n\tstruct timespec ts;\n\n\tmonotime_ts(&ts);\n\treturn ts.tv_sec + ((double)ts.tv_nsec / 1000000000);\n}",
          "includes": [
            "#include \"platform.h\"",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"ssh.h\"",
            "#include \"log.h\"",
            "#include \"misc.h\"",
            "#include \"xmalloc.h\"",
            "#include <net/if.h>",
            "#include <pwd.h>",
            "# include <paths.h>",
            "#include <netdb.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <ctype.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/tcp.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in_systm.h>",
            "#include <netinet/in.h>",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <libgen.h>",
            "#include <limits.h>",
            "#include <sys/un.h>",
            "#include <sys/wait.h>",
            "#include <sys/time.h>",
            "#include <sys/stat.h>",
            "#include <sys/socket.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"platform.h\"\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"ssh.h\"\n#include \"log.h\"\n#include \"misc.h\"\n#include \"xmalloc.h\"\n#include <net/if.h>\n#include <pwd.h>\n# include <paths.h>\n#include <netdb.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <ctype.h>\n#include <arpa/inet.h>\n#include <netinet/tcp.h>\n#include <netinet/ip.h>\n#include <netinet/in_systm.h>\n#include <netinet/in.h>\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <libgen.h>\n#include <limits.h>\n#include <sys/un.h>\n#include <sys/wait.h>\n#include <sys/time.h>\n#include <sys/stat.h>\n#include <sys/socket.h>\n#include <sys/ioctl.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\ndouble\nmonotime_double(void)\n{\n\tstruct timespec ts;\n\n\tmonotime_ts(&ts);\n\treturn ts.tv_sec + ((double)ts.tv_nsec / 1000000000);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\ntime_t\nssh_packet_get_rekey_timeout(struct ssh *ssh)\n{\n\ttime_t seconds;\n\n\tseconds = ssh->state->rekey_time + ssh->state->rekey_interval -\n\t    monotime();\n\treturn (seconds <= 0 ? 1 : seconds);\n}"
  },
  {
    "function_name": "ssh_packet_set_rekey_limits",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
    "lines": "2103-2110",
    "snippet": "void\nssh_packet_set_rekey_limits(struct ssh *ssh, u_int64_t bytes, u_int32_t seconds)\n{\n\tdebug3(\"rekey after %llu bytes, %u seconds\", (unsigned long long)bytes,\n\t    (unsigned int)seconds);\n\tssh->state->rekey_limit = bytes;\n\tssh->state->rekey_interval = seconds;\n}",
    "includes": [
      "#include \"sshbuf.h\"",
      "#include \"ssherr.h\"",
      "#include \"packet.h\"",
      "#include \"ssh.h\"",
      "#include \"channels.h\"",
      "#include \"misc.h\"",
      "#include \"canohost.h\"",
      "#include \"log.h\"",
      "#include \"mac.h\"",
      "#include \"digest.h\"",
      "#include \"kex.h\"",
      "#include \"sshkey.h\"",
      "#include \"cipher.h\"",
      "#include \"ssh2.h\"",
      "#include \"compat.h\"",
      "#include \"crc32.h\"",
      "#include \"xmalloc.h\"",
      "#include <zlib.h>",
      "#  include <openssl/ec.h>",
      "# include <openssl/evp.h>",
      "# include <openssl/bn.h>",
      "#include <time.h>",
      "#include <signal.h>",
      "#include <limits.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <stdarg.h>",
      "#include <netdb.h>",
      "#include <errno.h>",
      "#include <arpa/inet.h>",
      "#include <netinet/ip.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include \"openbsd-compat/sys-queue.h\"",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "debug3",
          "args": [
            "\"rekey after %llu bytes, %u seconds\"",
            "(unsigned long long)bytes",
            "(unsigned int)seconds"
          ],
          "line": 2106
        },
        "resolved": true,
        "details": {
          "function_name": "debug3",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/log.c",
          "lines": "242-250",
          "snippet": "void\ndebug3(const char *fmt,...)\n{\n\tva_list args;\n\n\tva_start(args, fmt);\n\tdo_log(SYSLOG_LEVEL_DEBUG3, fmt, args);\n\tva_end(args);\n}",
          "includes": [
            "#include \"log.h\"",
            "# include <vis.h>",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <syslog.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <fcntl.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n# include <vis.h>\n#include <errno.h>\n#include <unistd.h>\n#include <syslog.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <fcntl.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\ndebug3(const char *fmt,...)\n{\n\tva_list args;\n\n\tva_start(args, fmt);\n\tdo_log(SYSLOG_LEVEL_DEBUG3, fmt, args);\n\tva_end(args);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\nssh_packet_set_rekey_limits(struct ssh *ssh, u_int64_t bytes, u_int32_t seconds)\n{\n\tdebug3(\"rekey after %llu bytes, %u seconds\", (unsigned long long)bytes,\n\t    (unsigned int)seconds);\n\tssh->state->rekey_limit = bytes;\n\tssh->state->rekey_interval = seconds;\n}"
  },
  {
    "function_name": "ssh_packet_get_maxsize",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
    "lines": "2097-2101",
    "snippet": "u_int\nssh_packet_get_maxsize(struct ssh *ssh)\n{\n\treturn ssh->state->max_packet_size;\n}",
    "includes": [
      "#include \"sshbuf.h\"",
      "#include \"ssherr.h\"",
      "#include \"packet.h\"",
      "#include \"ssh.h\"",
      "#include \"channels.h\"",
      "#include \"misc.h\"",
      "#include \"canohost.h\"",
      "#include \"log.h\"",
      "#include \"mac.h\"",
      "#include \"digest.h\"",
      "#include \"kex.h\"",
      "#include \"sshkey.h\"",
      "#include \"cipher.h\"",
      "#include \"ssh2.h\"",
      "#include \"compat.h\"",
      "#include \"crc32.h\"",
      "#include \"xmalloc.h\"",
      "#include <zlib.h>",
      "#  include <openssl/ec.h>",
      "# include <openssl/evp.h>",
      "# include <openssl/bn.h>",
      "#include <time.h>",
      "#include <signal.h>",
      "#include <limits.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <stdarg.h>",
      "#include <netdb.h>",
      "#include <errno.h>",
      "#include <arpa/inet.h>",
      "#include <netinet/ip.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include \"openbsd-compat/sys-queue.h\"",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nu_int\nssh_packet_get_maxsize(struct ssh *ssh)\n{\n\treturn ssh->state->max_packet_size;\n}"
  },
  {
    "function_name": "ssh_packet_set_alive_timeouts",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
    "lines": "2091-2095",
    "snippet": "void\nssh_packet_set_alive_timeouts(struct ssh *ssh, int ka)\n{\n\tssh->state->keep_alive_timeouts = ka;\n}",
    "includes": [
      "#include \"sshbuf.h\"",
      "#include \"ssherr.h\"",
      "#include \"packet.h\"",
      "#include \"ssh.h\"",
      "#include \"channels.h\"",
      "#include \"misc.h\"",
      "#include \"canohost.h\"",
      "#include \"log.h\"",
      "#include \"mac.h\"",
      "#include \"digest.h\"",
      "#include \"kex.h\"",
      "#include \"sshkey.h\"",
      "#include \"cipher.h\"",
      "#include \"ssh2.h\"",
      "#include \"compat.h\"",
      "#include \"crc32.h\"",
      "#include \"xmalloc.h\"",
      "#include <zlib.h>",
      "#  include <openssl/ec.h>",
      "# include <openssl/evp.h>",
      "# include <openssl/bn.h>",
      "#include <time.h>",
      "#include <signal.h>",
      "#include <limits.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <stdarg.h>",
      "#include <netdb.h>",
      "#include <errno.h>",
      "#include <arpa/inet.h>",
      "#include <netinet/ip.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include \"openbsd-compat/sys-queue.h\"",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\nssh_packet_set_alive_timeouts(struct ssh *ssh, int ka)\n{\n\tssh->state->keep_alive_timeouts = ka;\n}"
  },
  {
    "function_name": "ssh_packet_inc_alive_timeouts",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
    "lines": "2085-2089",
    "snippet": "int\nssh_packet_inc_alive_timeouts(struct ssh *ssh)\n{\n\treturn ++ssh->state->keep_alive_timeouts;\n}",
    "includes": [
      "#include \"sshbuf.h\"",
      "#include \"ssherr.h\"",
      "#include \"packet.h\"",
      "#include \"ssh.h\"",
      "#include \"channels.h\"",
      "#include \"misc.h\"",
      "#include \"canohost.h\"",
      "#include \"log.h\"",
      "#include \"mac.h\"",
      "#include \"digest.h\"",
      "#include \"kex.h\"",
      "#include \"sshkey.h\"",
      "#include \"cipher.h\"",
      "#include \"ssh2.h\"",
      "#include \"compat.h\"",
      "#include \"crc32.h\"",
      "#include \"xmalloc.h\"",
      "#include <zlib.h>",
      "#  include <openssl/ec.h>",
      "# include <openssl/evp.h>",
      "# include <openssl/bn.h>",
      "#include <time.h>",
      "#include <signal.h>",
      "#include <limits.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <stdarg.h>",
      "#include <netdb.h>",
      "#include <errno.h>",
      "#include <arpa/inet.h>",
      "#include <netinet/ip.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include \"openbsd-compat/sys-queue.h\"",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nssh_packet_inc_alive_timeouts(struct ssh *ssh)\n{\n\treturn ++ssh->state->keep_alive_timeouts;\n}"
  },
  {
    "function_name": "ssh_packet_set_maxsize",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
    "lines": "2065-2083",
    "snippet": "int\nssh_packet_set_maxsize(struct ssh *ssh, u_int s)\n{\n\tstruct session_state *state = ssh->state;\n\n\tif (state->set_maxsize_called) {\n\t\tlogit(\"packet_set_maxsize: called twice: old %d new %d\",\n\t\t    state->max_packet_size, s);\n\t\treturn -1;\n\t}\n\tif (s < 4 * 1024 || s > 1024 * 1024) {\n\t\tlogit(\"packet_set_maxsize: bad size %d\", s);\n\t\treturn -1;\n\t}\n\tstate->set_maxsize_called = 1;\n\tdebug(\"packet_set_maxsize: setting to %d\", s);\n\tstate->max_packet_size = s;\n\treturn s;\n}",
    "includes": [
      "#include \"sshbuf.h\"",
      "#include \"ssherr.h\"",
      "#include \"packet.h\"",
      "#include \"ssh.h\"",
      "#include \"channels.h\"",
      "#include \"misc.h\"",
      "#include \"canohost.h\"",
      "#include \"log.h\"",
      "#include \"mac.h\"",
      "#include \"digest.h\"",
      "#include \"kex.h\"",
      "#include \"sshkey.h\"",
      "#include \"cipher.h\"",
      "#include \"ssh2.h\"",
      "#include \"compat.h\"",
      "#include \"crc32.h\"",
      "#include \"xmalloc.h\"",
      "#include <zlib.h>",
      "#  include <openssl/ec.h>",
      "# include <openssl/evp.h>",
      "# include <openssl/bn.h>",
      "#include <time.h>",
      "#include <signal.h>",
      "#include <limits.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <stdarg.h>",
      "#include <netdb.h>",
      "#include <errno.h>",
      "#include <arpa/inet.h>",
      "#include <netinet/ip.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include \"openbsd-compat/sys-queue.h\"",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "debug",
          "args": [
            "\"packet_set_maxsize: setting to %d\"",
            "s"
          ],
          "line": 2080
        },
        "resolved": true,
        "details": {
          "function_name": "ssh_packet_send_debug",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
          "lines": "1771-1794",
          "snippet": "void\nssh_packet_send_debug(struct ssh *ssh, const char *fmt,...)\n{\n\tchar buf[1024];\n\tva_list args;\n\tint r;\n\n\tif ((ssh->compat & SSH_BUG_DEBUG))\n\t\treturn;\n\n\tva_start(args, fmt);\n\tvsnprintf(buf, sizeof(buf), fmt, args);\n\tva_end(args);\n\n\tdebug3(\"sending debug message: %s\", buf);\n\n\tif ((r = sshpkt_start(ssh, SSH2_MSG_DEBUG)) != 0 ||\n\t    (r = sshpkt_put_u8(ssh, 0)) != 0 || /* always display */\n\t    (r = sshpkt_put_cstring(ssh, buf)) != 0 ||\n\t    (r = sshpkt_put_cstring(ssh, \"\")) != 0 ||\n\t    (r = sshpkt_send(ssh)) != 0 ||\n\t    (r = ssh_packet_write_wait(ssh)) != 0)\n\t\tfatal(\"%s: %s\", __func__, ssh_err(r));\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include \"packet.h\"",
            "#include \"ssh.h\"",
            "#include \"channels.h\"",
            "#include \"misc.h\"",
            "#include \"canohost.h\"",
            "#include \"log.h\"",
            "#include \"mac.h\"",
            "#include \"digest.h\"",
            "#include \"kex.h\"",
            "#include \"sshkey.h\"",
            "#include \"cipher.h\"",
            "#include \"ssh2.h\"",
            "#include \"compat.h\"",
            "#include \"crc32.h\"",
            "#include \"xmalloc.h\"",
            "#include <zlib.h>",
            "#  include <openssl/ec.h>",
            "# include <openssl/evp.h>",
            "# include <openssl/bn.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <limits.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <netdb.h>",
            "#include <errno.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include \"openbsd-compat/sys-queue.h\"",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\nssh_packet_send_debug(struct ssh *ssh, const char *fmt,...)\n{\n\tchar buf[1024];\n\tva_list args;\n\tint r;\n\n\tif ((ssh->compat & SSH_BUG_DEBUG))\n\t\treturn;\n\n\tva_start(args, fmt);\n\tvsnprintf(buf, sizeof(buf), fmt, args);\n\tva_end(args);\n\n\tdebug3(\"sending debug message: %s\", buf);\n\n\tif ((r = sshpkt_start(ssh, SSH2_MSG_DEBUG)) != 0 ||\n\t    (r = sshpkt_put_u8(ssh, 0)) != 0 || /* always display */\n\t    (r = sshpkt_put_cstring(ssh, buf)) != 0 ||\n\t    (r = sshpkt_put_cstring(ssh, \"\")) != 0 ||\n\t    (r = sshpkt_send(ssh)) != 0 ||\n\t    (r = ssh_packet_write_wait(ssh)) != 0)\n\t\tfatal(\"%s: %s\", __func__, ssh_err(r));\n}"
        }
      },
      {
        "call_info": {
          "callee": "logit",
          "args": [
            "\"packet_set_maxsize: bad size %d\"",
            "s"
          ],
          "line": 2076
        },
        "resolved": true,
        "details": {
          "function_name": "logit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/log.c",
          "lines": "198-206",
          "snippet": "void\nlogit(const char *fmt,...)\n{\n\tva_list args;\n\n\tva_start(args, fmt);\n\tdo_log(SYSLOG_LEVEL_INFO, fmt, args);\n\tva_end(args);\n}",
          "includes": [
            "#include \"log.h\"",
            "# include <vis.h>",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <syslog.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <fcntl.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n# include <vis.h>\n#include <errno.h>\n#include <unistd.h>\n#include <syslog.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <fcntl.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\nlogit(const char *fmt,...)\n{\n\tva_list args;\n\n\tva_start(args, fmt);\n\tdo_log(SYSLOG_LEVEL_INFO, fmt, args);\n\tva_end(args);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nssh_packet_set_maxsize(struct ssh *ssh, u_int s)\n{\n\tstruct session_state *state = ssh->state;\n\n\tif (state->set_maxsize_called) {\n\t\tlogit(\"packet_set_maxsize: called twice: old %d new %d\",\n\t\t    state->max_packet_size, s);\n\t\treturn -1;\n\t}\n\tif (s < 4 * 1024 || s > 1024 * 1024) {\n\t\tlogit(\"packet_set_maxsize: bad size %d\", s);\n\t\treturn -1;\n\t}\n\tstate->set_maxsize_called = 1;\n\tdebug(\"packet_set_maxsize: setting to %d\", s);\n\tstate->max_packet_size = s;\n\treturn s;\n}"
  },
  {
    "function_name": "ssh_packet_is_interactive",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
    "lines": "2059-2063",
    "snippet": "int\nssh_packet_is_interactive(struct ssh *ssh)\n{\n\treturn ssh->state->interactive_mode;\n}",
    "includes": [
      "#include \"sshbuf.h\"",
      "#include \"ssherr.h\"",
      "#include \"packet.h\"",
      "#include \"ssh.h\"",
      "#include \"channels.h\"",
      "#include \"misc.h\"",
      "#include \"canohost.h\"",
      "#include \"log.h\"",
      "#include \"mac.h\"",
      "#include \"digest.h\"",
      "#include \"kex.h\"",
      "#include \"sshkey.h\"",
      "#include \"cipher.h\"",
      "#include \"ssh2.h\"",
      "#include \"compat.h\"",
      "#include \"crc32.h\"",
      "#include \"xmalloc.h\"",
      "#include <zlib.h>",
      "#  include <openssl/ec.h>",
      "# include <openssl/evp.h>",
      "# include <openssl/bn.h>",
      "#include <time.h>",
      "#include <signal.h>",
      "#include <limits.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <stdarg.h>",
      "#include <netdb.h>",
      "#include <errno.h>",
      "#include <arpa/inet.h>",
      "#include <netinet/ip.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include \"openbsd-compat/sys-queue.h\"",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nssh_packet_is_interactive(struct ssh *ssh)\n{\n\treturn ssh->state->interactive_mode;\n}"
  },
  {
    "function_name": "ssh_packet_set_interactive",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
    "lines": "2037-2055",
    "snippet": "void\nssh_packet_set_interactive(struct ssh *ssh, int interactive, int qos_interactive, int qos_bulk)\n{\n\tstruct session_state *state = ssh->state;\n\n\tif (state->set_interactive_called)\n\t\treturn;\n\tstate->set_interactive_called = 1;\n\n\t/* Record that we are in interactive mode. */\n\tstate->interactive_mode = interactive;\n\n\t/* Only set socket options if using a socket.  */\n\tif (!ssh_packet_connection_is_on_socket(ssh))\n\t\treturn;\n\tset_nodelay(state->connection_in);\n\tssh_packet_set_tos(ssh, interactive ? qos_interactive :\n\t    qos_bulk);\n}",
    "includes": [
      "#include \"sshbuf.h\"",
      "#include \"ssherr.h\"",
      "#include \"packet.h\"",
      "#include \"ssh.h\"",
      "#include \"channels.h\"",
      "#include \"misc.h\"",
      "#include \"canohost.h\"",
      "#include \"log.h\"",
      "#include \"mac.h\"",
      "#include \"digest.h\"",
      "#include \"kex.h\"",
      "#include \"sshkey.h\"",
      "#include \"cipher.h\"",
      "#include \"ssh2.h\"",
      "#include \"compat.h\"",
      "#include \"crc32.h\"",
      "#include \"xmalloc.h\"",
      "#include <zlib.h>",
      "#  include <openssl/ec.h>",
      "# include <openssl/evp.h>",
      "# include <openssl/bn.h>",
      "#include <time.h>",
      "#include <signal.h>",
      "#include <limits.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <stdarg.h>",
      "#include <netdb.h>",
      "#include <errno.h>",
      "#include <arpa/inet.h>",
      "#include <netinet/ip.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include \"openbsd-compat/sys-queue.h\"",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "ssh_packet_set_tos",
          "args": [
            "ssh",
            "interactive ? qos_interactive :\n\t    qos_bulk"
          ],
          "line": 2053
        },
        "resolved": true,
        "details": {
          "function_name": "ssh_packet_set_tos",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
          "lines": "2006-2033",
          "snippet": "void\nssh_packet_set_tos(struct ssh *ssh, int tos)\n{\n#ifndef IP_TOS_IS_BROKEN\n\tif (!ssh_packet_connection_is_on_socket(ssh) || tos == INT_MAX)\n\t\treturn;\n\tswitch (ssh_packet_connection_af(ssh)) {\n# ifdef IP_TOS\n\tcase AF_INET:\n\t\tdebug3(\"%s: set IP_TOS 0x%02x\", __func__, tos);\n\t\tif (setsockopt(ssh->state->connection_in,\n\t\t    IPPROTO_IP, IP_TOS, &tos, sizeof(tos)) < 0)\n\t\t\terror(\"setsockopt IP_TOS %d: %.100s:\",\n\t\t\t    tos, strerror(errno));\n\t\tbreak;\n# endif /* IP_TOS */\n# ifdef IPV6_TCLASS\n\tcase AF_INET6:\n\t\tdebug3(\"%s: set IPV6_TCLASS 0x%02x\", __func__, tos);\n\t\tif (setsockopt(ssh->state->connection_in,\n\t\t    IPPROTO_IPV6, IPV6_TCLASS, &tos, sizeof(tos)) < 0)\n\t\t\terror(\"setsockopt IPV6_TCLASS %d: %.100s:\",\n\t\t\t    tos, strerror(errno));\n\t\tbreak;\n# endif /* IPV6_TCLASS */\n\t}\n#endif /* IP_TOS_IS_BROKEN */\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include \"packet.h\"",
            "#include \"ssh.h\"",
            "#include \"channels.h\"",
            "#include \"misc.h\"",
            "#include \"canohost.h\"",
            "#include \"log.h\"",
            "#include \"mac.h\"",
            "#include \"digest.h\"",
            "#include \"kex.h\"",
            "#include \"sshkey.h\"",
            "#include \"cipher.h\"",
            "#include \"ssh2.h\"",
            "#include \"compat.h\"",
            "#include \"crc32.h\"",
            "#include \"xmalloc.h\"",
            "#include <zlib.h>",
            "#  include <openssl/ec.h>",
            "# include <openssl/evp.h>",
            "# include <openssl/bn.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <limits.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <netdb.h>",
            "#include <errno.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include \"openbsd-compat/sys-queue.h\"",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\nssh_packet_set_tos(struct ssh *ssh, int tos)\n{\n#ifndef IP_TOS_IS_BROKEN\n\tif (!ssh_packet_connection_is_on_socket(ssh) || tos == INT_MAX)\n\t\treturn;\n\tswitch (ssh_packet_connection_af(ssh)) {\n# ifdef IP_TOS\n\tcase AF_INET:\n\t\tdebug3(\"%s: set IP_TOS 0x%02x\", __func__, tos);\n\t\tif (setsockopt(ssh->state->connection_in,\n\t\t    IPPROTO_IP, IP_TOS, &tos, sizeof(tos)) < 0)\n\t\t\terror(\"setsockopt IP_TOS %d: %.100s:\",\n\t\t\t    tos, strerror(errno));\n\t\tbreak;\n# endif /* IP_TOS */\n# ifdef IPV6_TCLASS\n\tcase AF_INET6:\n\t\tdebug3(\"%s: set IPV6_TCLASS 0x%02x\", __func__, tos);\n\t\tif (setsockopt(ssh->state->connection_in,\n\t\t    IPPROTO_IPV6, IPV6_TCLASS, &tos, sizeof(tos)) < 0)\n\t\t\terror(\"setsockopt IPV6_TCLASS %d: %.100s:\",\n\t\t\t    tos, strerror(errno));\n\t\tbreak;\n# endif /* IPV6_TCLASS */\n\t}\n#endif /* IP_TOS_IS_BROKEN */\n}"
        }
      },
      {
        "call_info": {
          "callee": "set_nodelay",
          "args": [
            "state->connection_in"
          ],
          "line": 2052
        },
        "resolved": true,
        "details": {
          "function_name": "set_nodelay",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/misc.c",
          "lines": "149-168",
          "snippet": "void\nset_nodelay(int fd)\n{\n\tint opt;\n\tsocklen_t optlen;\n\n\toptlen = sizeof opt;\n\tif (getsockopt(fd, IPPROTO_TCP, TCP_NODELAY, &opt, &optlen) == -1) {\n\t\tdebug(\"getsockopt TCP_NODELAY: %.100s\", strerror(errno));\n\t\treturn;\n\t}\n\tif (opt == 1) {\n\t\tdebug2(\"fd %d is TCP_NODELAY\", fd);\n\t\treturn;\n\t}\n\topt = 1;\n\tdebug2(\"fd %d setting TCP_NODELAY\", fd);\n\tif (setsockopt(fd, IPPROTO_TCP, TCP_NODELAY, &opt, sizeof opt) == -1)\n\t\terror(\"setsockopt TCP_NODELAY: %.100s\", strerror(errno));\n}",
          "includes": [
            "#include \"platform.h\"",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"ssh.h\"",
            "#include \"log.h\"",
            "#include \"misc.h\"",
            "#include \"xmalloc.h\"",
            "#include <net/if.h>",
            "#include <pwd.h>",
            "# include <paths.h>",
            "#include <netdb.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <ctype.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/tcp.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in_systm.h>",
            "#include <netinet/in.h>",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <libgen.h>",
            "#include <limits.h>",
            "#include <sys/un.h>",
            "#include <sys/wait.h>",
            "#include <sys/time.h>",
            "#include <sys/stat.h>",
            "#include <sys/socket.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"platform.h\"\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"ssh.h\"\n#include \"log.h\"\n#include \"misc.h\"\n#include \"xmalloc.h\"\n#include <net/if.h>\n#include <pwd.h>\n# include <paths.h>\n#include <netdb.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <ctype.h>\n#include <arpa/inet.h>\n#include <netinet/tcp.h>\n#include <netinet/ip.h>\n#include <netinet/in_systm.h>\n#include <netinet/in.h>\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <libgen.h>\n#include <limits.h>\n#include <sys/un.h>\n#include <sys/wait.h>\n#include <sys/time.h>\n#include <sys/stat.h>\n#include <sys/socket.h>\n#include <sys/ioctl.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\nset_nodelay(int fd)\n{\n\tint opt;\n\tsocklen_t optlen;\n\n\toptlen = sizeof opt;\n\tif (getsockopt(fd, IPPROTO_TCP, TCP_NODELAY, &opt, &optlen) == -1) {\n\t\tdebug(\"getsockopt TCP_NODELAY: %.100s\", strerror(errno));\n\t\treturn;\n\t}\n\tif (opt == 1) {\n\t\tdebug2(\"fd %d is TCP_NODELAY\", fd);\n\t\treturn;\n\t}\n\topt = 1;\n\tdebug2(\"fd %d setting TCP_NODELAY\", fd);\n\tif (setsockopt(fd, IPPROTO_TCP, TCP_NODELAY, &opt, sizeof opt) == -1)\n\t\terror(\"setsockopt TCP_NODELAY: %.100s\", strerror(errno));\n}"
        }
      },
      {
        "call_info": {
          "callee": "ssh_packet_connection_is_on_socket",
          "args": [
            "ssh"
          ],
          "line": 2050
        },
        "resolved": true,
        "details": {
          "function_name": "ssh_packet_connection_is_on_socket",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
          "lines": "421-452",
          "snippet": "int\nssh_packet_connection_is_on_socket(struct ssh *ssh)\n{\n\tstruct session_state *state;\n\tstruct sockaddr_storage from, to;\n\tsocklen_t fromlen, tolen;\n\n\tif (ssh == NULL || ssh->state == NULL)\n\t\treturn 0;\n\n\tstate = ssh->state;\n\tif (state->connection_in == -1 || state->connection_out == -1)\n\t\treturn 0;\n\t/* filedescriptors in and out are the same, so it's a socket */\n\tif (state->connection_in == state->connection_out)\n\t\treturn 1;\n\tfromlen = sizeof(from);\n\tmemset(&from, 0, sizeof(from));\n\tif (getpeername(state->connection_in, (struct sockaddr *)&from,\n\t    &fromlen) < 0)\n\t\treturn 0;\n\ttolen = sizeof(to);\n\tmemset(&to, 0, sizeof(to));\n\tif (getpeername(state->connection_out, (struct sockaddr *)&to,\n\t    &tolen) < 0)\n\t\treturn 0;\n\tif (fromlen != tolen || memcmp(&from, &to, fromlen) != 0)\n\t\treturn 0;\n\tif (from.ss_family != AF_INET && from.ss_family != AF_INET6)\n\t\treturn 0;\n\treturn 1;\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include \"packet.h\"",
            "#include \"ssh.h\"",
            "#include \"channels.h\"",
            "#include \"misc.h\"",
            "#include \"canohost.h\"",
            "#include \"log.h\"",
            "#include \"mac.h\"",
            "#include \"digest.h\"",
            "#include \"kex.h\"",
            "#include \"sshkey.h\"",
            "#include \"cipher.h\"",
            "#include \"ssh2.h\"",
            "#include \"compat.h\"",
            "#include \"crc32.h\"",
            "#include \"xmalloc.h\"",
            "#include <zlib.h>",
            "#  include <openssl/ec.h>",
            "# include <openssl/evp.h>",
            "# include <openssl/bn.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <limits.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <netdb.h>",
            "#include <errno.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include \"openbsd-compat/sys-queue.h\"",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nssh_packet_connection_is_on_socket(struct ssh *ssh)\n{\n\tstruct session_state *state;\n\tstruct sockaddr_storage from, to;\n\tsocklen_t fromlen, tolen;\n\n\tif (ssh == NULL || ssh->state == NULL)\n\t\treturn 0;\n\n\tstate = ssh->state;\n\tif (state->connection_in == -1 || state->connection_out == -1)\n\t\treturn 0;\n\t/* filedescriptors in and out are the same, so it's a socket */\n\tif (state->connection_in == state->connection_out)\n\t\treturn 1;\n\tfromlen = sizeof(from);\n\tmemset(&from, 0, sizeof(from));\n\tif (getpeername(state->connection_in, (struct sockaddr *)&from,\n\t    &fromlen) < 0)\n\t\treturn 0;\n\ttolen = sizeof(to);\n\tmemset(&to, 0, sizeof(to));\n\tif (getpeername(state->connection_out, (struct sockaddr *)&to,\n\t    &tolen) < 0)\n\t\treturn 0;\n\tif (fromlen != tolen || memcmp(&from, &to, fromlen) != 0)\n\t\treturn 0;\n\tif (from.ss_family != AF_INET && from.ss_family != AF_INET6)\n\t\treturn 0;\n\treturn 1;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\nssh_packet_set_interactive(struct ssh *ssh, int interactive, int qos_interactive, int qos_bulk)\n{\n\tstruct session_state *state = ssh->state;\n\n\tif (state->set_interactive_called)\n\t\treturn;\n\tstate->set_interactive_called = 1;\n\n\t/* Record that we are in interactive mode. */\n\tstate->interactive_mode = interactive;\n\n\t/* Only set socket options if using a socket.  */\n\tif (!ssh_packet_connection_is_on_socket(ssh))\n\t\treturn;\n\tset_nodelay(state->connection_in);\n\tssh_packet_set_tos(ssh, interactive ? qos_interactive :\n\t    qos_bulk);\n}"
  },
  {
    "function_name": "ssh_packet_set_tos",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
    "lines": "2006-2033",
    "snippet": "void\nssh_packet_set_tos(struct ssh *ssh, int tos)\n{\n#ifndef IP_TOS_IS_BROKEN\n\tif (!ssh_packet_connection_is_on_socket(ssh) || tos == INT_MAX)\n\t\treturn;\n\tswitch (ssh_packet_connection_af(ssh)) {\n# ifdef IP_TOS\n\tcase AF_INET:\n\t\tdebug3(\"%s: set IP_TOS 0x%02x\", __func__, tos);\n\t\tif (setsockopt(ssh->state->connection_in,\n\t\t    IPPROTO_IP, IP_TOS, &tos, sizeof(tos)) < 0)\n\t\t\terror(\"setsockopt IP_TOS %d: %.100s:\",\n\t\t\t    tos, strerror(errno));\n\t\tbreak;\n# endif /* IP_TOS */\n# ifdef IPV6_TCLASS\n\tcase AF_INET6:\n\t\tdebug3(\"%s: set IPV6_TCLASS 0x%02x\", __func__, tos);\n\t\tif (setsockopt(ssh->state->connection_in,\n\t\t    IPPROTO_IPV6, IPV6_TCLASS, &tos, sizeof(tos)) < 0)\n\t\t\terror(\"setsockopt IPV6_TCLASS %d: %.100s:\",\n\t\t\t    tos, strerror(errno));\n\t\tbreak;\n# endif /* IPV6_TCLASS */\n\t}\n#endif /* IP_TOS_IS_BROKEN */\n}",
    "includes": [
      "#include \"sshbuf.h\"",
      "#include \"ssherr.h\"",
      "#include \"packet.h\"",
      "#include \"ssh.h\"",
      "#include \"channels.h\"",
      "#include \"misc.h\"",
      "#include \"canohost.h\"",
      "#include \"log.h\"",
      "#include \"mac.h\"",
      "#include \"digest.h\"",
      "#include \"kex.h\"",
      "#include \"sshkey.h\"",
      "#include \"cipher.h\"",
      "#include \"ssh2.h\"",
      "#include \"compat.h\"",
      "#include \"crc32.h\"",
      "#include \"xmalloc.h\"",
      "#include <zlib.h>",
      "#  include <openssl/ec.h>",
      "# include <openssl/evp.h>",
      "# include <openssl/bn.h>",
      "#include <time.h>",
      "#include <signal.h>",
      "#include <limits.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <stdarg.h>",
      "#include <netdb.h>",
      "#include <errno.h>",
      "#include <arpa/inet.h>",
      "#include <netinet/ip.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include \"openbsd-compat/sys-queue.h\"",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"setsockopt IPV6_TCLASS %d: %.100s:\"",
            "tos",
            "strerror(errno)"
          ],
          "line": 2027
        },
        "resolved": true,
        "details": {
          "function_name": "error",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/log.c",
          "lines": "162-170",
          "snippet": "void\nerror(const char *fmt,...)\n{\n\tva_list args;\n\n\tva_start(args, fmt);\n\tdo_log(SYSLOG_LEVEL_ERROR, fmt, args);\n\tva_end(args);\n}",
          "includes": [
            "#include \"log.h\"",
            "# include <vis.h>",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <syslog.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <fcntl.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n# include <vis.h>\n#include <errno.h>\n#include <unistd.h>\n#include <syslog.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <fcntl.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\nerror(const char *fmt,...)\n{\n\tva_list args;\n\n\tva_start(args, fmt);\n\tdo_log(SYSLOG_LEVEL_ERROR, fmt, args);\n\tva_end(args);\n}"
        }
      },
      {
        "call_info": {
          "callee": "strerror",
          "args": [
            "errno"
          ],
          "line": 2028
        },
        "resolved": true,
        "details": {
          "function_name": "ssh_gai_strerror",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/misc.c",
          "lines": "140-146",
          "snippet": "const char *\nssh_gai_strerror(int gaierr)\n{\n\tif (gaierr == EAI_SYSTEM && errno != 0)\n\t\treturn strerror(errno);\n\treturn gai_strerror(gaierr);\n}",
          "includes": [
            "#include \"platform.h\"",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"ssh.h\"",
            "#include \"log.h\"",
            "#include \"misc.h\"",
            "#include \"xmalloc.h\"",
            "#include <net/if.h>",
            "#include <pwd.h>",
            "# include <paths.h>",
            "#include <netdb.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <ctype.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/tcp.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in_systm.h>",
            "#include <netinet/in.h>",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <libgen.h>",
            "#include <limits.h>",
            "#include <sys/un.h>",
            "#include <sys/wait.h>",
            "#include <sys/time.h>",
            "#include <sys/stat.h>",
            "#include <sys/socket.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"platform.h\"\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"ssh.h\"\n#include \"log.h\"\n#include \"misc.h\"\n#include \"xmalloc.h\"\n#include <net/if.h>\n#include <pwd.h>\n# include <paths.h>\n#include <netdb.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <ctype.h>\n#include <arpa/inet.h>\n#include <netinet/tcp.h>\n#include <netinet/ip.h>\n#include <netinet/in_systm.h>\n#include <netinet/in.h>\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <libgen.h>\n#include <limits.h>\n#include <sys/un.h>\n#include <sys/wait.h>\n#include <sys/time.h>\n#include <sys/stat.h>\n#include <sys/socket.h>\n#include <sys/ioctl.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nconst char *\nssh_gai_strerror(int gaierr)\n{\n\tif (gaierr == EAI_SYSTEM && errno != 0)\n\t\treturn strerror(errno);\n\treturn gai_strerror(gaierr);\n}"
        }
      },
      {
        "call_info": {
          "callee": "setsockopt",
          "args": [
            "ssh->state->connection_in",
            "IPPROTO_IPV6",
            "IPV6_TCLASS",
            "&tos",
            "sizeof(tos)"
          ],
          "line": 2025
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug3",
          "args": [
            "\"%s: set IPV6_TCLASS 0x%02x\"",
            "__func__",
            "tos"
          ],
          "line": 2024
        },
        "resolved": true,
        "details": {
          "function_name": "debug3",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/log.c",
          "lines": "242-250",
          "snippet": "void\ndebug3(const char *fmt,...)\n{\n\tva_list args;\n\n\tva_start(args, fmt);\n\tdo_log(SYSLOG_LEVEL_DEBUG3, fmt, args);\n\tva_end(args);\n}",
          "includes": [
            "#include \"log.h\"",
            "# include <vis.h>",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <syslog.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <fcntl.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n# include <vis.h>\n#include <errno.h>\n#include <unistd.h>\n#include <syslog.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <fcntl.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\ndebug3(const char *fmt,...)\n{\n\tva_list args;\n\n\tva_start(args, fmt);\n\tdo_log(SYSLOG_LEVEL_DEBUG3, fmt, args);\n\tva_end(args);\n}"
        }
      },
      {
        "call_info": {
          "callee": "setsockopt",
          "args": [
            "ssh->state->connection_in",
            "IPPROTO_IP",
            "IP_TOS",
            "&tos",
            "sizeof(tos)"
          ],
          "line": 2016
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ssh_packet_connection_af",
          "args": [
            "ssh"
          ],
          "line": 2012
        },
        "resolved": true,
        "details": {
          "function_name": "ssh_packet_connection_af",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
          "lines": "463-479",
          "snippet": "int\nssh_packet_connection_af(struct ssh *ssh)\n{\n\tstruct sockaddr_storage to;\n\tsocklen_t tolen = sizeof(to);\n\n\tmemset(&to, 0, sizeof(to));\n\tif (getsockname(ssh->state->connection_out, (struct sockaddr *)&to,\n\t    &tolen) < 0)\n\t\treturn 0;\n#ifdef IPV4_IN_IPV6\n\tif (to.ss_family == AF_INET6 &&\n\t    IN6_IS_ADDR_V4MAPPED(&((struct sockaddr_in6 *)&to)->sin6_addr))\n\t\treturn AF_INET;\n#endif\n\treturn to.ss_family;\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include \"packet.h\"",
            "#include \"ssh.h\"",
            "#include \"channels.h\"",
            "#include \"misc.h\"",
            "#include \"canohost.h\"",
            "#include \"log.h\"",
            "#include \"mac.h\"",
            "#include \"digest.h\"",
            "#include \"kex.h\"",
            "#include \"sshkey.h\"",
            "#include \"cipher.h\"",
            "#include \"ssh2.h\"",
            "#include \"compat.h\"",
            "#include \"crc32.h\"",
            "#include \"xmalloc.h\"",
            "#include <zlib.h>",
            "#  include <openssl/ec.h>",
            "# include <openssl/evp.h>",
            "# include <openssl/bn.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <limits.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <netdb.h>",
            "#include <errno.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include \"openbsd-compat/sys-queue.h\"",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nssh_packet_connection_af(struct ssh *ssh)\n{\n\tstruct sockaddr_storage to;\n\tsocklen_t tolen = sizeof(to);\n\n\tmemset(&to, 0, sizeof(to));\n\tif (getsockname(ssh->state->connection_out, (struct sockaddr *)&to,\n\t    &tolen) < 0)\n\t\treturn 0;\n#ifdef IPV4_IN_IPV6\n\tif (to.ss_family == AF_INET6 &&\n\t    IN6_IS_ADDR_V4MAPPED(&((struct sockaddr_in6 *)&to)->sin6_addr))\n\t\treturn AF_INET;\n#endif\n\treturn to.ss_family;\n}"
        }
      },
      {
        "call_info": {
          "callee": "ssh_packet_connection_is_on_socket",
          "args": [
            "ssh"
          ],
          "line": 2010
        },
        "resolved": true,
        "details": {
          "function_name": "ssh_packet_connection_is_on_socket",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
          "lines": "421-452",
          "snippet": "int\nssh_packet_connection_is_on_socket(struct ssh *ssh)\n{\n\tstruct session_state *state;\n\tstruct sockaddr_storage from, to;\n\tsocklen_t fromlen, tolen;\n\n\tif (ssh == NULL || ssh->state == NULL)\n\t\treturn 0;\n\n\tstate = ssh->state;\n\tif (state->connection_in == -1 || state->connection_out == -1)\n\t\treturn 0;\n\t/* filedescriptors in and out are the same, so it's a socket */\n\tif (state->connection_in == state->connection_out)\n\t\treturn 1;\n\tfromlen = sizeof(from);\n\tmemset(&from, 0, sizeof(from));\n\tif (getpeername(state->connection_in, (struct sockaddr *)&from,\n\t    &fromlen) < 0)\n\t\treturn 0;\n\ttolen = sizeof(to);\n\tmemset(&to, 0, sizeof(to));\n\tif (getpeername(state->connection_out, (struct sockaddr *)&to,\n\t    &tolen) < 0)\n\t\treturn 0;\n\tif (fromlen != tolen || memcmp(&from, &to, fromlen) != 0)\n\t\treturn 0;\n\tif (from.ss_family != AF_INET && from.ss_family != AF_INET6)\n\t\treturn 0;\n\treturn 1;\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include \"packet.h\"",
            "#include \"ssh.h\"",
            "#include \"channels.h\"",
            "#include \"misc.h\"",
            "#include \"canohost.h\"",
            "#include \"log.h\"",
            "#include \"mac.h\"",
            "#include \"digest.h\"",
            "#include \"kex.h\"",
            "#include \"sshkey.h\"",
            "#include \"cipher.h\"",
            "#include \"ssh2.h\"",
            "#include \"compat.h\"",
            "#include \"crc32.h\"",
            "#include \"xmalloc.h\"",
            "#include <zlib.h>",
            "#  include <openssl/ec.h>",
            "# include <openssl/evp.h>",
            "# include <openssl/bn.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <limits.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <netdb.h>",
            "#include <errno.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include \"openbsd-compat/sys-queue.h\"",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nssh_packet_connection_is_on_socket(struct ssh *ssh)\n{\n\tstruct session_state *state;\n\tstruct sockaddr_storage from, to;\n\tsocklen_t fromlen, tolen;\n\n\tif (ssh == NULL || ssh->state == NULL)\n\t\treturn 0;\n\n\tstate = ssh->state;\n\tif (state->connection_in == -1 || state->connection_out == -1)\n\t\treturn 0;\n\t/* filedescriptors in and out are the same, so it's a socket */\n\tif (state->connection_in == state->connection_out)\n\t\treturn 1;\n\tfromlen = sizeof(from);\n\tmemset(&from, 0, sizeof(from));\n\tif (getpeername(state->connection_in, (struct sockaddr *)&from,\n\t    &fromlen) < 0)\n\t\treturn 0;\n\ttolen = sizeof(to);\n\tmemset(&to, 0, sizeof(to));\n\tif (getpeername(state->connection_out, (struct sockaddr *)&to,\n\t    &tolen) < 0)\n\t\treturn 0;\n\tif (fromlen != tolen || memcmp(&from, &to, fromlen) != 0)\n\t\treturn 0;\n\tif (from.ss_family != AF_INET && from.ss_family != AF_INET6)\n\t\treturn 0;\n\treturn 1;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\nssh_packet_set_tos(struct ssh *ssh, int tos)\n{\n#ifndef IP_TOS_IS_BROKEN\n\tif (!ssh_packet_connection_is_on_socket(ssh) || tos == INT_MAX)\n\t\treturn;\n\tswitch (ssh_packet_connection_af(ssh)) {\n# ifdef IP_TOS\n\tcase AF_INET:\n\t\tdebug3(\"%s: set IP_TOS 0x%02x\", __func__, tos);\n\t\tif (setsockopt(ssh->state->connection_in,\n\t\t    IPPROTO_IP, IP_TOS, &tos, sizeof(tos)) < 0)\n\t\t\terror(\"setsockopt IP_TOS %d: %.100s:\",\n\t\t\t    tos, strerror(errno));\n\t\tbreak;\n# endif /* IP_TOS */\n# ifdef IPV6_TCLASS\n\tcase AF_INET6:\n\t\tdebug3(\"%s: set IPV6_TCLASS 0x%02x\", __func__, tos);\n\t\tif (setsockopt(ssh->state->connection_in,\n\t\t    IPPROTO_IPV6, IPV6_TCLASS, &tos, sizeof(tos)) < 0)\n\t\t\terror(\"setsockopt IPV6_TCLASS %d: %.100s:\",\n\t\t\t    tos, strerror(errno));\n\t\tbreak;\n# endif /* IPV6_TCLASS */\n\t}\n#endif /* IP_TOS_IS_BROKEN */\n}"
  },
  {
    "function_name": "ssh_packet_not_very_much_data_to_write",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
    "lines": "1997-2004",
    "snippet": "int\nssh_packet_not_very_much_data_to_write(struct ssh *ssh)\n{\n\tif (ssh->state->interactive_mode)\n\t\treturn sshbuf_len(ssh->state->output) < 16384;\n\telse\n\t\treturn sshbuf_len(ssh->state->output) < 128 * 1024;\n}",
    "includes": [
      "#include \"sshbuf.h\"",
      "#include \"ssherr.h\"",
      "#include \"packet.h\"",
      "#include \"ssh.h\"",
      "#include \"channels.h\"",
      "#include \"misc.h\"",
      "#include \"canohost.h\"",
      "#include \"log.h\"",
      "#include \"mac.h\"",
      "#include \"digest.h\"",
      "#include \"kex.h\"",
      "#include \"sshkey.h\"",
      "#include \"cipher.h\"",
      "#include \"ssh2.h\"",
      "#include \"compat.h\"",
      "#include \"crc32.h\"",
      "#include \"xmalloc.h\"",
      "#include <zlib.h>",
      "#  include <openssl/ec.h>",
      "# include <openssl/evp.h>",
      "# include <openssl/bn.h>",
      "#include <time.h>",
      "#include <signal.h>",
      "#include <limits.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <stdarg.h>",
      "#include <netdb.h>",
      "#include <errno.h>",
      "#include <arpa/inet.h>",
      "#include <netinet/ip.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include \"openbsd-compat/sys-queue.h\"",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "sshbuf_len",
          "args": [
            "ssh->state->output"
          ],
          "line": 2003
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_len",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf.c",
          "lines": "252-258",
          "snippet": "size_t\nsshbuf_len(const struct sshbuf *buf)\n{\n\tif (sshbuf_check_sanity(buf) != 0)\n\t\treturn 0;\n\treturn buf->size - buf->off;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <signal.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <signal.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nsize_t\nsshbuf_len(const struct sshbuf *buf)\n{\n\tif (sshbuf_check_sanity(buf) != 0)\n\t\treturn 0;\n\treturn buf->size - buf->off;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nssh_packet_not_very_much_data_to_write(struct ssh *ssh)\n{\n\tif (ssh->state->interactive_mode)\n\t\treturn sshbuf_len(ssh->state->output) < 16384;\n\telse\n\t\treturn sshbuf_len(ssh->state->output) < 128 * 1024;\n}"
  },
  {
    "function_name": "ssh_packet_have_data_to_write",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
    "lines": "1989-1993",
    "snippet": "int\nssh_packet_have_data_to_write(struct ssh *ssh)\n{\n\treturn sshbuf_len(ssh->state->output) != 0;\n}",
    "includes": [
      "#include \"sshbuf.h\"",
      "#include \"ssherr.h\"",
      "#include \"packet.h\"",
      "#include \"ssh.h\"",
      "#include \"channels.h\"",
      "#include \"misc.h\"",
      "#include \"canohost.h\"",
      "#include \"log.h\"",
      "#include \"mac.h\"",
      "#include \"digest.h\"",
      "#include \"kex.h\"",
      "#include \"sshkey.h\"",
      "#include \"cipher.h\"",
      "#include \"ssh2.h\"",
      "#include \"compat.h\"",
      "#include \"crc32.h\"",
      "#include \"xmalloc.h\"",
      "#include <zlib.h>",
      "#  include <openssl/ec.h>",
      "# include <openssl/evp.h>",
      "# include <openssl/bn.h>",
      "#include <time.h>",
      "#include <signal.h>",
      "#include <limits.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <stdarg.h>",
      "#include <netdb.h>",
      "#include <errno.h>",
      "#include <arpa/inet.h>",
      "#include <netinet/ip.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include \"openbsd-compat/sys-queue.h\"",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "sshbuf_len",
          "args": [
            "ssh->state->output"
          ],
          "line": 1992
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_len",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf.c",
          "lines": "252-258",
          "snippet": "size_t\nsshbuf_len(const struct sshbuf *buf)\n{\n\tif (sshbuf_check_sanity(buf) != 0)\n\t\treturn 0;\n\treturn buf->size - buf->off;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <signal.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <signal.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nsize_t\nsshbuf_len(const struct sshbuf *buf)\n{\n\tif (sshbuf_check_sanity(buf) != 0)\n\t\treturn 0;\n\treturn buf->size - buf->off;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nssh_packet_have_data_to_write(struct ssh *ssh)\n{\n\treturn sshbuf_len(ssh->state->output) != 0;\n}"
  },
  {
    "function_name": "ssh_packet_write_wait",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
    "lines": "1930-1985",
    "snippet": "int\nssh_packet_write_wait(struct ssh *ssh)\n{\n\tfd_set *setp;\n\tint ret, r, ms_remain = 0;\n\tstruct timeval start, timeout, *timeoutp = NULL;\n\tstruct session_state *state = ssh->state;\n\n\tsetp = calloc(howmany(state->connection_out + 1,\n\t    NFDBITS), sizeof(fd_mask));\n\tif (setp == NULL)\n\t\treturn SSH_ERR_ALLOC_FAIL;\n\tif ((r = ssh_packet_write_poll(ssh)) != 0) {\n\t\tfree(setp);\n\t\treturn r;\n\t}\n\twhile (ssh_packet_have_data_to_write(ssh)) {\n\t\tmemset(setp, 0, howmany(state->connection_out + 1,\n\t\t    NFDBITS) * sizeof(fd_mask));\n\t\tFD_SET(state->connection_out, setp);\n\n\t\tif (state->packet_timeout_ms > 0) {\n\t\t\tms_remain = state->packet_timeout_ms;\n\t\t\ttimeoutp = &timeout;\n\t\t}\n\t\tfor (;;) {\n\t\t\tif (state->packet_timeout_ms != -1) {\n\t\t\t\tms_to_timeval(&timeout, ms_remain);\n\t\t\t\tmonotime_tv(&start);\n\t\t\t}\n\t\t\tif ((ret = select(state->connection_out + 1,\n\t\t\t    NULL, setp, NULL, timeoutp)) >= 0)\n\t\t\t\tbreak;\n\t\t\tif (errno != EAGAIN && errno != EINTR &&\n\t\t\t    errno != EWOULDBLOCK)\n\t\t\t\tbreak;\n\t\t\tif (state->packet_timeout_ms == -1)\n\t\t\t\tcontinue;\n\t\t\tms_subtract_diff(&start, &ms_remain);\n\t\t\tif (ms_remain <= 0) {\n\t\t\t\tret = 0;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tif (ret == 0) {\n\t\t\tfree(setp);\n\t\t\treturn SSH_ERR_CONN_TIMEOUT;\n\t\t}\n\t\tif ((r = ssh_packet_write_poll(ssh)) != 0) {\n\t\t\tfree(setp);\n\t\t\treturn r;\n\t\t}\n\t}\n\tfree(setp);\n\treturn 0;\n}",
    "includes": [
      "#include \"sshbuf.h\"",
      "#include \"ssherr.h\"",
      "#include \"packet.h\"",
      "#include \"ssh.h\"",
      "#include \"channels.h\"",
      "#include \"misc.h\"",
      "#include \"canohost.h\"",
      "#include \"log.h\"",
      "#include \"mac.h\"",
      "#include \"digest.h\"",
      "#include \"kex.h\"",
      "#include \"sshkey.h\"",
      "#include \"cipher.h\"",
      "#include \"ssh2.h\"",
      "#include \"compat.h\"",
      "#include \"crc32.h\"",
      "#include \"xmalloc.h\"",
      "#include <zlib.h>",
      "#  include <openssl/ec.h>",
      "# include <openssl/evp.h>",
      "# include <openssl/bn.h>",
      "#include <time.h>",
      "#include <signal.h>",
      "#include <limits.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <stdarg.h>",
      "#include <netdb.h>",
      "#include <errno.h>",
      "#include <arpa/inet.h>",
      "#include <netinet/ip.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include \"openbsd-compat/sys-queue.h\"",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "setp"
          ],
          "line": 1983
        },
        "resolved": true,
        "details": {
          "function_name": "freeze",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/smult_curve25519_ref.c",
          "lines": "50-60",
          "snippet": "static void freeze(unsigned int a[32])\n{\n  unsigned int aorig[32];\n  unsigned int j;\n  unsigned int negative;\n\n  for (j = 0;j < 32;++j) aorig[j] = a[j];\n  add(a,a,minusp);\n  negative = -((a[31] >> 7) & 1);\n  for (j = 0;j < 32;++j) a[j] ^= negative & (aorig[j] ^ a[j]);\n}",
          "includes": [],
          "macros_used": [],
          "globals_used": [
            "static const unsigned int minusp[32] = {\n 19, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 128\n} ;"
          ],
          "called_functions": [],
          "contextual_snippet": "static const unsigned int minusp[32] = {\n 19, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 128\n} ;\n\nstatic void freeze(unsigned int a[32])\n{\n  unsigned int aorig[32];\n  unsigned int j;\n  unsigned int negative;\n\n  for (j = 0;j < 32;++j) aorig[j] = a[j];\n  add(a,a,minusp);\n  negative = -((a[31] >> 7) & 1);\n  for (j = 0;j < 32;++j) a[j] ^= negative & (aorig[j] ^ a[j]);\n}"
        }
      },
      {
        "call_info": {
          "callee": "ssh_packet_write_poll",
          "args": [
            "ssh"
          ],
          "line": 1978
        },
        "resolved": true,
        "details": {
          "function_name": "ssh_packet_write_poll",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
          "lines": "1902-1924",
          "snippet": "int\nssh_packet_write_poll(struct ssh *ssh)\n{\n\tstruct session_state *state = ssh->state;\n\tint len = sshbuf_len(state->output);\n\tint r;\n\n\tif (len > 0) {\n\t\tlen = write(state->connection_out,\n\t\t    sshbuf_ptr(state->output), len);\n\t\tif (len == -1) {\n\t\t\tif (errno == EINTR || errno == EAGAIN ||\n\t\t\t    errno == EWOULDBLOCK)\n\t\t\t\treturn 0;\n\t\t\treturn SSH_ERR_SYSTEM_ERROR;\n\t\t}\n\t\tif (len == 0)\n\t\t\treturn SSH_ERR_CONN_CLOSED;\n\t\tif ((r = sshbuf_consume(state->output, len)) != 0)\n\t\t\treturn r;\n\t}\n\treturn 0;\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include \"packet.h\"",
            "#include \"ssh.h\"",
            "#include \"channels.h\"",
            "#include \"misc.h\"",
            "#include \"canohost.h\"",
            "#include \"log.h\"",
            "#include \"mac.h\"",
            "#include \"digest.h\"",
            "#include \"kex.h\"",
            "#include \"sshkey.h\"",
            "#include \"cipher.h\"",
            "#include \"ssh2.h\"",
            "#include \"compat.h\"",
            "#include \"crc32.h\"",
            "#include \"xmalloc.h\"",
            "#include <zlib.h>",
            "#  include <openssl/ec.h>",
            "# include <openssl/evp.h>",
            "# include <openssl/bn.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <limits.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <netdb.h>",
            "#include <errno.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include \"openbsd-compat/sys-queue.h\"",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nssh_packet_write_poll(struct ssh *ssh)\n{\n\tstruct session_state *state = ssh->state;\n\tint len = sshbuf_len(state->output);\n\tint r;\n\n\tif (len > 0) {\n\t\tlen = write(state->connection_out,\n\t\t    sshbuf_ptr(state->output), len);\n\t\tif (len == -1) {\n\t\t\tif (errno == EINTR || errno == EAGAIN ||\n\t\t\t    errno == EWOULDBLOCK)\n\t\t\t\treturn 0;\n\t\t\treturn SSH_ERR_SYSTEM_ERROR;\n\t\t}\n\t\tif (len == 0)\n\t\t\treturn SSH_ERR_CONN_CLOSED;\n\t\tif ((r = sshbuf_consume(state->output, len)) != 0)\n\t\t\treturn r;\n\t}\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "ms_subtract_diff",
          "args": [
            "&start",
            "&ms_remain"
          ],
          "line": 1968
        },
        "resolved": true,
        "details": {
          "function_name": "ms_subtract_diff",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/misc.c",
          "lines": "1255-1263",
          "snippet": "void\nms_subtract_diff(struct timeval *start, int *ms)\n{\n\tstruct timeval diff, finish;\n\n\tmonotime_tv(&finish);\n\ttimersub(&finish, start, &diff);\n\t*ms -= (diff.tv_sec * 1000) + (diff.tv_usec / 1000);\n}",
          "includes": [
            "#include \"platform.h\"",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"ssh.h\"",
            "#include \"log.h\"",
            "#include \"misc.h\"",
            "#include \"xmalloc.h\"",
            "#include <net/if.h>",
            "#include <pwd.h>",
            "# include <paths.h>",
            "#include <netdb.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <ctype.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/tcp.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in_systm.h>",
            "#include <netinet/in.h>",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <libgen.h>",
            "#include <limits.h>",
            "#include <sys/un.h>",
            "#include <sys/wait.h>",
            "#include <sys/time.h>",
            "#include <sys/stat.h>",
            "#include <sys/socket.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"platform.h\"\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"ssh.h\"\n#include \"log.h\"\n#include \"misc.h\"\n#include \"xmalloc.h\"\n#include <net/if.h>\n#include <pwd.h>\n# include <paths.h>\n#include <netdb.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <ctype.h>\n#include <arpa/inet.h>\n#include <netinet/tcp.h>\n#include <netinet/ip.h>\n#include <netinet/in_systm.h>\n#include <netinet/in.h>\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <libgen.h>\n#include <limits.h>\n#include <sys/un.h>\n#include <sys/wait.h>\n#include <sys/time.h>\n#include <sys/stat.h>\n#include <sys/socket.h>\n#include <sys/ioctl.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\nms_subtract_diff(struct timeval *start, int *ms)\n{\n\tstruct timeval diff, finish;\n\n\tmonotime_tv(&finish);\n\ttimersub(&finish, start, &diff);\n\t*ms -= (diff.tv_sec * 1000) + (diff.tv_usec / 1000);\n}"
        }
      },
      {
        "call_info": {
          "callee": "select",
          "args": [
            "state->connection_out + 1",
            "NULL",
            "setp",
            "NULL",
            "timeoutp"
          ],
          "line": 1960
        },
        "resolved": true,
        "details": {
          "function_name": "select",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/smult_curve25519_ref.c",
          "lines": "110-122",
          "snippet": "static void select(unsigned int p[64],unsigned int q[64],const unsigned int r[64],const unsigned int s[64],unsigned int b)\n{\n  unsigned int j;\n  unsigned int t;\n  unsigned int bminus1;\n\n  bminus1 = b - 1;\n  for (j = 0;j < 64;++j) {\n    t = bminus1 & (r[j] ^ s[j]);\n    p[j] = s[j] ^ t;\n    q[j] = r[j] ^ t;\n  }\n}",
          "includes": [],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "static void select(unsigned int p[64],unsigned int q[64],const unsigned int r[64],const unsigned int s[64],unsigned int b)\n{\n  unsigned int j;\n  unsigned int t;\n  unsigned int bminus1;\n\n  bminus1 = b - 1;\n  for (j = 0;j < 64;++j) {\n    t = bminus1 & (r[j] ^ s[j]);\n    p[j] = s[j] ^ t;\n    q[j] = r[j] ^ t;\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "monotime_tv",
          "args": [
            "&start"
          ],
          "line": 1958
        },
        "resolved": true,
        "details": {
          "function_name": "monotime_tv",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/misc.c",
          "lines": "1305-1313",
          "snippet": "void\nmonotime_tv(struct timeval *tv)\n{\n\tstruct timespec ts;\n\n\tmonotime_ts(&ts);\n\ttv->tv_sec = ts.tv_sec;\n\ttv->tv_usec = ts.tv_nsec / 1000;\n}",
          "includes": [
            "#include \"platform.h\"",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"ssh.h\"",
            "#include \"log.h\"",
            "#include \"misc.h\"",
            "#include \"xmalloc.h\"",
            "#include <net/if.h>",
            "#include <pwd.h>",
            "# include <paths.h>",
            "#include <netdb.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <ctype.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/tcp.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in_systm.h>",
            "#include <netinet/in.h>",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <libgen.h>",
            "#include <limits.h>",
            "#include <sys/un.h>",
            "#include <sys/wait.h>",
            "#include <sys/time.h>",
            "#include <sys/stat.h>",
            "#include <sys/socket.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"platform.h\"\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"ssh.h\"\n#include \"log.h\"\n#include \"misc.h\"\n#include \"xmalloc.h\"\n#include <net/if.h>\n#include <pwd.h>\n# include <paths.h>\n#include <netdb.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <ctype.h>\n#include <arpa/inet.h>\n#include <netinet/tcp.h>\n#include <netinet/ip.h>\n#include <netinet/in_systm.h>\n#include <netinet/in.h>\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <libgen.h>\n#include <limits.h>\n#include <sys/un.h>\n#include <sys/wait.h>\n#include <sys/time.h>\n#include <sys/stat.h>\n#include <sys/socket.h>\n#include <sys/ioctl.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\nmonotime_tv(struct timeval *tv)\n{\n\tstruct timespec ts;\n\n\tmonotime_ts(&ts);\n\ttv->tv_sec = ts.tv_sec;\n\ttv->tv_usec = ts.tv_nsec / 1000;\n}"
        }
      },
      {
        "call_info": {
          "callee": "ms_to_timeval",
          "args": [
            "&timeout",
            "ms_remain"
          ],
          "line": 1957
        },
        "resolved": true,
        "details": {
          "function_name": "ms_to_timeval",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/misc.c",
          "lines": "1265-1272",
          "snippet": "void\nms_to_timeval(struct timeval *tv, int ms)\n{\n\tif (ms < 0)\n\t\tms = 0;\n\ttv->tv_sec = ms / 1000;\n\ttv->tv_usec = (ms % 1000) * 1000;\n}",
          "includes": [
            "#include \"platform.h\"",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"ssh.h\"",
            "#include \"log.h\"",
            "#include \"misc.h\"",
            "#include \"xmalloc.h\"",
            "#include <net/if.h>",
            "#include <pwd.h>",
            "# include <paths.h>",
            "#include <netdb.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <ctype.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/tcp.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in_systm.h>",
            "#include <netinet/in.h>",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <libgen.h>",
            "#include <limits.h>",
            "#include <sys/un.h>",
            "#include <sys/wait.h>",
            "#include <sys/time.h>",
            "#include <sys/stat.h>",
            "#include <sys/socket.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"platform.h\"\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"ssh.h\"\n#include \"log.h\"\n#include \"misc.h\"\n#include \"xmalloc.h\"\n#include <net/if.h>\n#include <pwd.h>\n# include <paths.h>\n#include <netdb.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <ctype.h>\n#include <arpa/inet.h>\n#include <netinet/tcp.h>\n#include <netinet/ip.h>\n#include <netinet/in_systm.h>\n#include <netinet/in.h>\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <libgen.h>\n#include <limits.h>\n#include <sys/un.h>\n#include <sys/wait.h>\n#include <sys/time.h>\n#include <sys/stat.h>\n#include <sys/socket.h>\n#include <sys/ioctl.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\nms_to_timeval(struct timeval *tv, int ms)\n{\n\tif (ms < 0)\n\t\tms = 0;\n\ttv->tv_sec = ms / 1000;\n\ttv->tv_usec = (ms % 1000) * 1000;\n}"
        }
      },
      {
        "call_info": {
          "callee": "FD_SET",
          "args": [
            "state->connection_out",
            "setp"
          ],
          "line": 1949
        },
        "resolved": true,
        "details": {
          "function_name": "kludge_FD_SET",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/openbsd-compat/kludge-fd_set.c",
          "lines": "19-21",
          "snippet": "void kludge_FD_SET(int n, fd_set *set) {\n\tFD_SET(n, set);\n}",
          "includes": [
            "#   include <sys/socket.h>",
            "# include <features.h>",
            "#include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#   include <sys/socket.h>\n# include <features.h>\n#include \"config.h\"\n\nvoid kludge_FD_SET(int n, fd_set *set) {\n\tFD_SET(n, set);\n}"
        }
      },
      {
        "call_info": {
          "callee": "memset",
          "args": [
            "setp",
            "0",
            "howmany(state->connection_out + 1,\n\t\t    NFDBITS) * sizeof(fd_mask)"
          ],
          "line": 1947
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "howmany",
          "args": [
            "state->connection_out + 1",
            "NFDBITS"
          ],
          "line": 1947
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ssh_packet_have_data_to_write",
          "args": [
            "ssh"
          ],
          "line": 1946
        },
        "resolved": true,
        "details": {
          "function_name": "ssh_packet_have_data_to_write",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
          "lines": "1989-1993",
          "snippet": "int\nssh_packet_have_data_to_write(struct ssh *ssh)\n{\n\treturn sshbuf_len(ssh->state->output) != 0;\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include \"packet.h\"",
            "#include \"ssh.h\"",
            "#include \"channels.h\"",
            "#include \"misc.h\"",
            "#include \"canohost.h\"",
            "#include \"log.h\"",
            "#include \"mac.h\"",
            "#include \"digest.h\"",
            "#include \"kex.h\"",
            "#include \"sshkey.h\"",
            "#include \"cipher.h\"",
            "#include \"ssh2.h\"",
            "#include \"compat.h\"",
            "#include \"crc32.h\"",
            "#include \"xmalloc.h\"",
            "#include <zlib.h>",
            "#  include <openssl/ec.h>",
            "# include <openssl/evp.h>",
            "# include <openssl/bn.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <limits.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <netdb.h>",
            "#include <errno.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include \"openbsd-compat/sys-queue.h\"",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nssh_packet_have_data_to_write(struct ssh *ssh)\n{\n\treturn sshbuf_len(ssh->state->output) != 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "calloc",
          "args": [
            "howmany(state->connection_out + 1,\n\t    NFDBITS)",
            "sizeof(fd_mask)"
          ],
          "line": 1938
        },
        "resolved": true,
        "details": {
          "function_name": "xcalloc",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/xmalloc.c",
          "lines": "52-66",
          "snippet": "void *\nxcalloc(size_t nmemb, size_t size)\n{\n\tvoid *ptr;\n\n\tif (size == 0 || nmemb == 0)\n\t\tfatal(\"xcalloc: zero size\");\n\tif (SIZE_MAX / nmemb < size)\n\t\tfatal(\"xcalloc: nmemb * size > SIZE_MAX\");\n\tptr = calloc(nmemb, size);\n\tif (ptr == NULL)\n\t\tfatal(\"xcalloc: out of memory (allocating %zu bytes)\",\n\t\t    size * nmemb);\n\treturn ptr;\n}",
          "includes": [
            "#include \"log.h\"",
            "#include \"xmalloc.h\"",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdint.h>",
            "#include <stdarg.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n#include \"xmalloc.h\"\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdint.h>\n#include <stdarg.h>\n#include \"includes.h\"\n\nvoid *\nxcalloc(size_t nmemb, size_t size)\n{\n\tvoid *ptr;\n\n\tif (size == 0 || nmemb == 0)\n\t\tfatal(\"xcalloc: zero size\");\n\tif (SIZE_MAX / nmemb < size)\n\t\tfatal(\"xcalloc: nmemb * size > SIZE_MAX\");\n\tptr = calloc(nmemb, size);\n\tif (ptr == NULL)\n\t\tfatal(\"xcalloc: out of memory (allocating %zu bytes)\",\n\t\t    size * nmemb);\n\treturn ptr;\n}"
        }
      },
      {
        "call_info": {
          "callee": "howmany",
          "args": [
            "state->connection_out + 1",
            "NFDBITS"
          ],
          "line": 1938
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nssh_packet_write_wait(struct ssh *ssh)\n{\n\tfd_set *setp;\n\tint ret, r, ms_remain = 0;\n\tstruct timeval start, timeout, *timeoutp = NULL;\n\tstruct session_state *state = ssh->state;\n\n\tsetp = calloc(howmany(state->connection_out + 1,\n\t    NFDBITS), sizeof(fd_mask));\n\tif (setp == NULL)\n\t\treturn SSH_ERR_ALLOC_FAIL;\n\tif ((r = ssh_packet_write_poll(ssh)) != 0) {\n\t\tfree(setp);\n\t\treturn r;\n\t}\n\twhile (ssh_packet_have_data_to_write(ssh)) {\n\t\tmemset(setp, 0, howmany(state->connection_out + 1,\n\t\t    NFDBITS) * sizeof(fd_mask));\n\t\tFD_SET(state->connection_out, setp);\n\n\t\tif (state->packet_timeout_ms > 0) {\n\t\t\tms_remain = state->packet_timeout_ms;\n\t\t\ttimeoutp = &timeout;\n\t\t}\n\t\tfor (;;) {\n\t\t\tif (state->packet_timeout_ms != -1) {\n\t\t\t\tms_to_timeval(&timeout, ms_remain);\n\t\t\t\tmonotime_tv(&start);\n\t\t\t}\n\t\t\tif ((ret = select(state->connection_out + 1,\n\t\t\t    NULL, setp, NULL, timeoutp)) >= 0)\n\t\t\t\tbreak;\n\t\t\tif (errno != EAGAIN && errno != EINTR &&\n\t\t\t    errno != EWOULDBLOCK)\n\t\t\t\tbreak;\n\t\t\tif (state->packet_timeout_ms == -1)\n\t\t\t\tcontinue;\n\t\t\tms_subtract_diff(&start, &ms_remain);\n\t\t\tif (ms_remain <= 0) {\n\t\t\t\tret = 0;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tif (ret == 0) {\n\t\t\tfree(setp);\n\t\t\treturn SSH_ERR_CONN_TIMEOUT;\n\t\t}\n\t\tif ((r = ssh_packet_write_poll(ssh)) != 0) {\n\t\t\tfree(setp);\n\t\t\treturn r;\n\t\t}\n\t}\n\tfree(setp);\n\treturn 0;\n}"
  },
  {
    "function_name": "ssh_packet_write_poll",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
    "lines": "1902-1924",
    "snippet": "int\nssh_packet_write_poll(struct ssh *ssh)\n{\n\tstruct session_state *state = ssh->state;\n\tint len = sshbuf_len(state->output);\n\tint r;\n\n\tif (len > 0) {\n\t\tlen = write(state->connection_out,\n\t\t    sshbuf_ptr(state->output), len);\n\t\tif (len == -1) {\n\t\t\tif (errno == EINTR || errno == EAGAIN ||\n\t\t\t    errno == EWOULDBLOCK)\n\t\t\t\treturn 0;\n\t\t\treturn SSH_ERR_SYSTEM_ERROR;\n\t\t}\n\t\tif (len == 0)\n\t\t\treturn SSH_ERR_CONN_CLOSED;\n\t\tif ((r = sshbuf_consume(state->output, len)) != 0)\n\t\t\treturn r;\n\t}\n\treturn 0;\n}",
    "includes": [
      "#include \"sshbuf.h\"",
      "#include \"ssherr.h\"",
      "#include \"packet.h\"",
      "#include \"ssh.h\"",
      "#include \"channels.h\"",
      "#include \"misc.h\"",
      "#include \"canohost.h\"",
      "#include \"log.h\"",
      "#include \"mac.h\"",
      "#include \"digest.h\"",
      "#include \"kex.h\"",
      "#include \"sshkey.h\"",
      "#include \"cipher.h\"",
      "#include \"ssh2.h\"",
      "#include \"compat.h\"",
      "#include \"crc32.h\"",
      "#include \"xmalloc.h\"",
      "#include <zlib.h>",
      "#  include <openssl/ec.h>",
      "# include <openssl/evp.h>",
      "# include <openssl/bn.h>",
      "#include <time.h>",
      "#include <signal.h>",
      "#include <limits.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <stdarg.h>",
      "#include <netdb.h>",
      "#include <errno.h>",
      "#include <arpa/inet.h>",
      "#include <netinet/ip.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include \"openbsd-compat/sys-queue.h\"",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "sshbuf_consume",
          "args": [
            "state->output",
            "len"
          ],
          "line": 1920
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_consume_end",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf.c",
          "lines": "383-398",
          "snippet": "int\nsshbuf_consume_end(struct sshbuf *buf, size_t len)\n{\n\tint r;\n\n\tSSHBUF_DBG((\"len = %zu\", len));\n\tif ((r = sshbuf_check_sanity(buf)) != 0)\n\t\treturn r;\n\tif (len == 0)\n\t\treturn 0;\n\tif (len > sshbuf_len(buf))\n\t\treturn SSH_ERR_MESSAGE_INCOMPLETE;\n\tbuf->size -= len;\n\tSSHBUF_TELL(\"done\");\n\treturn 0;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <signal.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <signal.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshbuf_consume_end(struct sshbuf *buf, size_t len)\n{\n\tint r;\n\n\tSSHBUF_DBG((\"len = %zu\", len));\n\tif ((r = sshbuf_check_sanity(buf)) != 0)\n\t\treturn r;\n\tif (len == 0)\n\t\treturn 0;\n\tif (len > sshbuf_len(buf))\n\t\treturn SSH_ERR_MESSAGE_INCOMPLETE;\n\tbuf->size -= len;\n\tSSHBUF_TELL(\"done\");\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "write",
          "args": [
            "state->connection_out",
            "sshbuf_ptr(state->output)",
            "len"
          ],
          "line": 1910
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sshbuf_ptr",
          "args": [
            "state->output"
          ],
          "line": 1911
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_ptr",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf.c",
          "lines": "268-274",
          "snippet": "const u_char *\nsshbuf_ptr(const struct sshbuf *buf)\n{\n\tif (sshbuf_check_sanity(buf) != 0)\n\t\treturn NULL;\n\treturn buf->cd + buf->off;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <signal.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <signal.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nconst u_char *\nsshbuf_ptr(const struct sshbuf *buf)\n{\n\tif (sshbuf_check_sanity(buf) != 0)\n\t\treturn NULL;\n\treturn buf->cd + buf->off;\n}"
        }
      },
      {
        "call_info": {
          "callee": "sshbuf_len",
          "args": [
            "state->output"
          ],
          "line": 1906
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_len",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf.c",
          "lines": "252-258",
          "snippet": "size_t\nsshbuf_len(const struct sshbuf *buf)\n{\n\tif (sshbuf_check_sanity(buf) != 0)\n\t\treturn 0;\n\treturn buf->size - buf->off;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <signal.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <signal.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nsize_t\nsshbuf_len(const struct sshbuf *buf)\n{\n\tif (sshbuf_check_sanity(buf) != 0)\n\t\treturn 0;\n\treturn buf->size - buf->off;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nssh_packet_write_poll(struct ssh *ssh)\n{\n\tstruct session_state *state = ssh->state;\n\tint len = sshbuf_len(state->output);\n\tint r;\n\n\tif (len > 0) {\n\t\tlen = write(state->connection_out,\n\t\t    sshbuf_ptr(state->output), len);\n\t\tif (len == -1) {\n\t\t\tif (errno == EINTR || errno == EAGAIN ||\n\t\t\t    errno == EWOULDBLOCK)\n\t\t\t\treturn 0;\n\t\t\treturn SSH_ERR_SYSTEM_ERROR;\n\t\t}\n\t\tif (len == 0)\n\t\t\treturn SSH_ERR_CONN_CLOSED;\n\t\tif ((r = sshbuf_consume(state->output, len)) != 0)\n\t\t\treturn r;\n\t}\n\treturn 0;\n}"
  },
  {
    "function_name": "ssh_packet_disconnect",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
    "lines": "1859-1896",
    "snippet": "void\nssh_packet_disconnect(struct ssh *ssh, const char *fmt,...)\n{\n\tchar buf[1024], remote_id[512];\n\tva_list args;\n\tstatic int disconnecting = 0;\n\tint r;\n\n\tif (disconnecting)\t/* Guard against recursive invocations. */\n\t\tfatal(\"packet_disconnect called recursively.\");\n\tdisconnecting = 1;\n\n\t/*\n\t * Format the message.  Note that the caller must make sure the\n\t * message is of limited size.\n\t */\n\tsshpkt_fmt_connection_id(ssh, remote_id, sizeof(remote_id));\n\tva_start(args, fmt);\n\tvsnprintf(buf, sizeof(buf), fmt, args);\n\tva_end(args);\n\n\t/* Display the error locally */\n\tlogit(\"Disconnecting %s: %.100s\", remote_id, buf);\n\n\t/*\n\t * Send the disconnect message to the other side, and wait\n\t * for it to get sent.\n\t */\n\tif ((r = sshpkt_disconnect(ssh, \"%s\", buf)) != 0)\n\t\tsshpkt_fatal(ssh, __func__, r);\n\n\tif ((r = ssh_packet_write_wait(ssh)) != 0)\n\t\tsshpkt_fatal(ssh, __func__, r);\n\n\t/* Close the connection. */\n\tssh_packet_close(ssh);\n\tcleanup_exit(255);\n}",
    "includes": [
      "#include \"sshbuf.h\"",
      "#include \"ssherr.h\"",
      "#include \"packet.h\"",
      "#include \"ssh.h\"",
      "#include \"channels.h\"",
      "#include \"misc.h\"",
      "#include \"canohost.h\"",
      "#include \"log.h\"",
      "#include \"mac.h\"",
      "#include \"digest.h\"",
      "#include \"kex.h\"",
      "#include \"sshkey.h\"",
      "#include \"cipher.h\"",
      "#include \"ssh2.h\"",
      "#include \"compat.h\"",
      "#include \"crc32.h\"",
      "#include \"xmalloc.h\"",
      "#include <zlib.h>",
      "#  include <openssl/ec.h>",
      "# include <openssl/evp.h>",
      "# include <openssl/bn.h>",
      "#include <time.h>",
      "#include <signal.h>",
      "#include <limits.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <stdarg.h>",
      "#include <netdb.h>",
      "#include <errno.h>",
      "#include <arpa/inet.h>",
      "#include <netinet/ip.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include \"openbsd-compat/sys-queue.h\"",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "cleanup_exit",
          "args": [
            "255"
          ],
          "line": 1895
        },
        "resolved": true,
        "details": {
          "function_name": "sftp_server_cleanup_exit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sftp-server.c",
          "lines": "1474-1483",
          "snippet": "void\nsftp_server_cleanup_exit(int i)\n{\n\tif (pw != NULL && client_addr != NULL) {\n\t\thandle_log_exit();\n\t\tlogit(\"session closed for local user %s from [%s]\",\n\t\t    pw->pw_name, client_addr);\n\t}\n\t_exit(i);\n}",
          "includes": [
            "#include \"sftp-common.h\"",
            "#include \"sftp.h\"",
            "#include \"uidswap.h\"",
            "#include \"match.h\"",
            "#include \"misc.h\"",
            "#include \"log.h\"",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"xmalloc.h\"",
            "#include <stdarg.h>",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <pwd.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <dirent.h>",
            "#include <sys/statvfs.h>",
            "#include <sys/mount.h>",
            "# include <sys/time.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static struct passwd *pw = NULL;",
            "static char *client_addr = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"sftp-common.h\"\n#include \"sftp.h\"\n#include \"uidswap.h\"\n#include \"match.h\"\n#include \"misc.h\"\n#include \"log.h\"\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"xmalloc.h\"\n#include <stdarg.h>\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <pwd.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <dirent.h>\n#include <sys/statvfs.h>\n#include <sys/mount.h>\n# include <sys/time.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nstatic struct passwd *pw = NULL;\nstatic char *client_addr = NULL;\n\nvoid\nsftp_server_cleanup_exit(int i)\n{\n\tif (pw != NULL && client_addr != NULL) {\n\t\thandle_log_exit();\n\t\tlogit(\"session closed for local user %s from [%s]\",\n\t\t    pw->pw_name, client_addr);\n\t}\n\t_exit(i);\n}"
        }
      },
      {
        "call_info": {
          "callee": "ssh_packet_close",
          "args": [
            "ssh"
          ],
          "line": 1894
        },
        "resolved": true,
        "details": {
          "function_name": "ssh_packet_close",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
          "lines": "646-650",
          "snippet": "void\nssh_packet_close(struct ssh *ssh)\n{\n\tssh_packet_close_internal(ssh, 1);\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include \"packet.h\"",
            "#include \"ssh.h\"",
            "#include \"channels.h\"",
            "#include \"misc.h\"",
            "#include \"canohost.h\"",
            "#include \"log.h\"",
            "#include \"mac.h\"",
            "#include \"digest.h\"",
            "#include \"kex.h\"",
            "#include \"sshkey.h\"",
            "#include \"cipher.h\"",
            "#include \"ssh2.h\"",
            "#include \"compat.h\"",
            "#include \"crc32.h\"",
            "#include \"xmalloc.h\"",
            "#include <zlib.h>",
            "#  include <openssl/ec.h>",
            "# include <openssl/evp.h>",
            "# include <openssl/bn.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <limits.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <netdb.h>",
            "#include <errno.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include \"openbsd-compat/sys-queue.h\"",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\nssh_packet_close(struct ssh *ssh)\n{\n\tssh_packet_close_internal(ssh, 1);\n}"
        }
      },
      {
        "call_info": {
          "callee": "sshpkt_fatal",
          "args": [
            "ssh",
            "__func__",
            "r"
          ],
          "line": 1891
        },
        "resolved": true,
        "details": {
          "function_name": "sshpkt_fatal",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
          "lines": "1808-1851",
          "snippet": "void\nsshpkt_fatal(struct ssh *ssh, const char *tag, int r)\n{\n\tchar remote_id[512];\n\n\tsshpkt_fmt_connection_id(ssh, remote_id, sizeof(remote_id));\n\n\tswitch (r) {\n\tcase SSH_ERR_CONN_CLOSED:\n\t\tssh_packet_clear_keys(ssh);\n\t\tlogdie(\"Connection closed by %s\", remote_id);\n\tcase SSH_ERR_CONN_TIMEOUT:\n\t\tssh_packet_clear_keys(ssh);\n\t\tlogdie(\"Connection %s %s timed out\",\n\t\t    ssh->state->server_side ? \"from\" : \"to\", remote_id);\n\tcase SSH_ERR_DISCONNECTED:\n\t\tssh_packet_clear_keys(ssh);\n\t\tlogdie(\"Disconnected from %s\", remote_id);\n\tcase SSH_ERR_SYSTEM_ERROR:\n\t\tif (errno == ECONNRESET) {\n\t\t\tssh_packet_clear_keys(ssh);\n\t\t\tlogdie(\"Connection reset by %s\", remote_id);\n\t\t}\n\t\t/* FALLTHROUGH */\n\tcase SSH_ERR_NO_CIPHER_ALG_MATCH:\n\tcase SSH_ERR_NO_MAC_ALG_MATCH:\n\tcase SSH_ERR_NO_COMPRESS_ALG_MATCH:\n\tcase SSH_ERR_NO_KEX_ALG_MATCH:\n\tcase SSH_ERR_NO_HOSTKEY_ALG_MATCH:\n\t\tif (ssh && ssh->kex && ssh->kex->failed_choice) {\n\t\t\tssh_packet_clear_keys(ssh);\n\t\t\tlogdie(\"Unable to negotiate with %s: %s. \"\n\t\t\t    \"Their offer: %s\", remote_id, ssh_err(r),\n\t\t\t    ssh->kex->failed_choice);\n\t\t}\n\t\t/* FALLTHROUGH */\n\tdefault:\n\t\tssh_packet_clear_keys(ssh);\n\t\tlogdie(\"%s%sConnection %s %s: %s\",\n\t\t    tag != NULL ? tag : \"\", tag != NULL ? \": \" : \"\",\n\t\t    ssh->state->server_side ? \"from\" : \"to\",\n\t\t    remote_id, ssh_err(r));\n\t}\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include \"packet.h\"",
            "#include \"ssh.h\"",
            "#include \"channels.h\"",
            "#include \"misc.h\"",
            "#include \"canohost.h\"",
            "#include \"log.h\"",
            "#include \"mac.h\"",
            "#include \"digest.h\"",
            "#include \"kex.h\"",
            "#include \"sshkey.h\"",
            "#include \"cipher.h\"",
            "#include \"ssh2.h\"",
            "#include \"compat.h\"",
            "#include \"crc32.h\"",
            "#include \"xmalloc.h\"",
            "#include <zlib.h>",
            "#  include <openssl/ec.h>",
            "# include <openssl/evp.h>",
            "# include <openssl/bn.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <limits.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <netdb.h>",
            "#include <errno.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include \"openbsd-compat/sys-queue.h\"",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\nsshpkt_fatal(struct ssh *ssh, const char *tag, int r)\n{\n\tchar remote_id[512];\n\n\tsshpkt_fmt_connection_id(ssh, remote_id, sizeof(remote_id));\n\n\tswitch (r) {\n\tcase SSH_ERR_CONN_CLOSED:\n\t\tssh_packet_clear_keys(ssh);\n\t\tlogdie(\"Connection closed by %s\", remote_id);\n\tcase SSH_ERR_CONN_TIMEOUT:\n\t\tssh_packet_clear_keys(ssh);\n\t\tlogdie(\"Connection %s %s timed out\",\n\t\t    ssh->state->server_side ? \"from\" : \"to\", remote_id);\n\tcase SSH_ERR_DISCONNECTED:\n\t\tssh_packet_clear_keys(ssh);\n\t\tlogdie(\"Disconnected from %s\", remote_id);\n\tcase SSH_ERR_SYSTEM_ERROR:\n\t\tif (errno == ECONNRESET) {\n\t\t\tssh_packet_clear_keys(ssh);\n\t\t\tlogdie(\"Connection reset by %s\", remote_id);\n\t\t}\n\t\t/* FALLTHROUGH */\n\tcase SSH_ERR_NO_CIPHER_ALG_MATCH:\n\tcase SSH_ERR_NO_MAC_ALG_MATCH:\n\tcase SSH_ERR_NO_COMPRESS_ALG_MATCH:\n\tcase SSH_ERR_NO_KEX_ALG_MATCH:\n\tcase SSH_ERR_NO_HOSTKEY_ALG_MATCH:\n\t\tif (ssh && ssh->kex && ssh->kex->failed_choice) {\n\t\t\tssh_packet_clear_keys(ssh);\n\t\t\tlogdie(\"Unable to negotiate with %s: %s. \"\n\t\t\t    \"Their offer: %s\", remote_id, ssh_err(r),\n\t\t\t    ssh->kex->failed_choice);\n\t\t}\n\t\t/* FALLTHROUGH */\n\tdefault:\n\t\tssh_packet_clear_keys(ssh);\n\t\tlogdie(\"%s%sConnection %s %s: %s\",\n\t\t    tag != NULL ? tag : \"\", tag != NULL ? \": \" : \"\",\n\t\t    ssh->state->server_side ? \"from\" : \"to\",\n\t\t    remote_id, ssh_err(r));\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "ssh_packet_write_wait",
          "args": [
            "ssh"
          ],
          "line": 1890
        },
        "resolved": true,
        "details": {
          "function_name": "ssh_packet_write_wait",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
          "lines": "1930-1985",
          "snippet": "int\nssh_packet_write_wait(struct ssh *ssh)\n{\n\tfd_set *setp;\n\tint ret, r, ms_remain = 0;\n\tstruct timeval start, timeout, *timeoutp = NULL;\n\tstruct session_state *state = ssh->state;\n\n\tsetp = calloc(howmany(state->connection_out + 1,\n\t    NFDBITS), sizeof(fd_mask));\n\tif (setp == NULL)\n\t\treturn SSH_ERR_ALLOC_FAIL;\n\tif ((r = ssh_packet_write_poll(ssh)) != 0) {\n\t\tfree(setp);\n\t\treturn r;\n\t}\n\twhile (ssh_packet_have_data_to_write(ssh)) {\n\t\tmemset(setp, 0, howmany(state->connection_out + 1,\n\t\t    NFDBITS) * sizeof(fd_mask));\n\t\tFD_SET(state->connection_out, setp);\n\n\t\tif (state->packet_timeout_ms > 0) {\n\t\t\tms_remain = state->packet_timeout_ms;\n\t\t\ttimeoutp = &timeout;\n\t\t}\n\t\tfor (;;) {\n\t\t\tif (state->packet_timeout_ms != -1) {\n\t\t\t\tms_to_timeval(&timeout, ms_remain);\n\t\t\t\tmonotime_tv(&start);\n\t\t\t}\n\t\t\tif ((ret = select(state->connection_out + 1,\n\t\t\t    NULL, setp, NULL, timeoutp)) >= 0)\n\t\t\t\tbreak;\n\t\t\tif (errno != EAGAIN && errno != EINTR &&\n\t\t\t    errno != EWOULDBLOCK)\n\t\t\t\tbreak;\n\t\t\tif (state->packet_timeout_ms == -1)\n\t\t\t\tcontinue;\n\t\t\tms_subtract_diff(&start, &ms_remain);\n\t\t\tif (ms_remain <= 0) {\n\t\t\t\tret = 0;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tif (ret == 0) {\n\t\t\tfree(setp);\n\t\t\treturn SSH_ERR_CONN_TIMEOUT;\n\t\t}\n\t\tif ((r = ssh_packet_write_poll(ssh)) != 0) {\n\t\t\tfree(setp);\n\t\t\treturn r;\n\t\t}\n\t}\n\tfree(setp);\n\treturn 0;\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include \"packet.h\"",
            "#include \"ssh.h\"",
            "#include \"channels.h\"",
            "#include \"misc.h\"",
            "#include \"canohost.h\"",
            "#include \"log.h\"",
            "#include \"mac.h\"",
            "#include \"digest.h\"",
            "#include \"kex.h\"",
            "#include \"sshkey.h\"",
            "#include \"cipher.h\"",
            "#include \"ssh2.h\"",
            "#include \"compat.h\"",
            "#include \"crc32.h\"",
            "#include \"xmalloc.h\"",
            "#include <zlib.h>",
            "#  include <openssl/ec.h>",
            "# include <openssl/evp.h>",
            "# include <openssl/bn.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <limits.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <netdb.h>",
            "#include <errno.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include \"openbsd-compat/sys-queue.h\"",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nssh_packet_write_wait(struct ssh *ssh)\n{\n\tfd_set *setp;\n\tint ret, r, ms_remain = 0;\n\tstruct timeval start, timeout, *timeoutp = NULL;\n\tstruct session_state *state = ssh->state;\n\n\tsetp = calloc(howmany(state->connection_out + 1,\n\t    NFDBITS), sizeof(fd_mask));\n\tif (setp == NULL)\n\t\treturn SSH_ERR_ALLOC_FAIL;\n\tif ((r = ssh_packet_write_poll(ssh)) != 0) {\n\t\tfree(setp);\n\t\treturn r;\n\t}\n\twhile (ssh_packet_have_data_to_write(ssh)) {\n\t\tmemset(setp, 0, howmany(state->connection_out + 1,\n\t\t    NFDBITS) * sizeof(fd_mask));\n\t\tFD_SET(state->connection_out, setp);\n\n\t\tif (state->packet_timeout_ms > 0) {\n\t\t\tms_remain = state->packet_timeout_ms;\n\t\t\ttimeoutp = &timeout;\n\t\t}\n\t\tfor (;;) {\n\t\t\tif (state->packet_timeout_ms != -1) {\n\t\t\t\tms_to_timeval(&timeout, ms_remain);\n\t\t\t\tmonotime_tv(&start);\n\t\t\t}\n\t\t\tif ((ret = select(state->connection_out + 1,\n\t\t\t    NULL, setp, NULL, timeoutp)) >= 0)\n\t\t\t\tbreak;\n\t\t\tif (errno != EAGAIN && errno != EINTR &&\n\t\t\t    errno != EWOULDBLOCK)\n\t\t\t\tbreak;\n\t\t\tif (state->packet_timeout_ms == -1)\n\t\t\t\tcontinue;\n\t\t\tms_subtract_diff(&start, &ms_remain);\n\t\t\tif (ms_remain <= 0) {\n\t\t\t\tret = 0;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tif (ret == 0) {\n\t\t\tfree(setp);\n\t\t\treturn SSH_ERR_CONN_TIMEOUT;\n\t\t}\n\t\tif ((r = ssh_packet_write_poll(ssh)) != 0) {\n\t\t\tfree(setp);\n\t\t\treturn r;\n\t\t}\n\t}\n\tfree(setp);\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "sshpkt_disconnect",
          "args": [
            "ssh",
            "\"%s\"",
            "buf"
          ],
          "line": 1887
        },
        "resolved": true,
        "details": {
          "function_name": "sshpkt_disconnect",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
          "lines": "2656-2674",
          "snippet": "int\nsshpkt_disconnect(struct ssh *ssh, const char *fmt,...)\n{\n\tchar buf[1024];\n\tva_list args;\n\tint r;\n\n\tva_start(args, fmt);\n\tvsnprintf(buf, sizeof(buf), fmt, args);\n\tva_end(args);\n\n\tif ((r = sshpkt_start(ssh, SSH2_MSG_DISCONNECT)) != 0 ||\n\t    (r = sshpkt_put_u32(ssh, SSH2_DISCONNECT_PROTOCOL_ERROR)) != 0 ||\n\t    (r = sshpkt_put_cstring(ssh, buf)) != 0 ||\n\t    (r = sshpkt_put_cstring(ssh, \"\")) != 0 ||\n\t    (r = sshpkt_send(ssh)) != 0)\n\t\treturn r;\n\treturn 0;\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include \"packet.h\"",
            "#include \"ssh.h\"",
            "#include \"channels.h\"",
            "#include \"misc.h\"",
            "#include \"canohost.h\"",
            "#include \"log.h\"",
            "#include \"mac.h\"",
            "#include \"digest.h\"",
            "#include \"kex.h\"",
            "#include \"sshkey.h\"",
            "#include \"cipher.h\"",
            "#include \"ssh2.h\"",
            "#include \"compat.h\"",
            "#include \"crc32.h\"",
            "#include \"xmalloc.h\"",
            "#include <zlib.h>",
            "#  include <openssl/ec.h>",
            "# include <openssl/evp.h>",
            "# include <openssl/bn.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <limits.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <netdb.h>",
            "#include <errno.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include \"openbsd-compat/sys-queue.h\"",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshpkt_disconnect(struct ssh *ssh, const char *fmt,...)\n{\n\tchar buf[1024];\n\tva_list args;\n\tint r;\n\n\tva_start(args, fmt);\n\tvsnprintf(buf, sizeof(buf), fmt, args);\n\tva_end(args);\n\n\tif ((r = sshpkt_start(ssh, SSH2_MSG_DISCONNECT)) != 0 ||\n\t    (r = sshpkt_put_u32(ssh, SSH2_DISCONNECT_PROTOCOL_ERROR)) != 0 ||\n\t    (r = sshpkt_put_cstring(ssh, buf)) != 0 ||\n\t    (r = sshpkt_put_cstring(ssh, \"\")) != 0 ||\n\t    (r = sshpkt_send(ssh)) != 0)\n\t\treturn r;\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "logit",
          "args": [
            "\"Disconnecting %s: %.100s\"",
            "remote_id",
            "buf"
          ],
          "line": 1881
        },
        "resolved": true,
        "details": {
          "function_name": "logit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/log.c",
          "lines": "198-206",
          "snippet": "void\nlogit(const char *fmt,...)\n{\n\tva_list args;\n\n\tva_start(args, fmt);\n\tdo_log(SYSLOG_LEVEL_INFO, fmt, args);\n\tva_end(args);\n}",
          "includes": [
            "#include \"log.h\"",
            "# include <vis.h>",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <syslog.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <fcntl.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n# include <vis.h>\n#include <errno.h>\n#include <unistd.h>\n#include <syslog.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <fcntl.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\nlogit(const char *fmt,...)\n{\n\tva_list args;\n\n\tva_start(args, fmt);\n\tdo_log(SYSLOG_LEVEL_INFO, fmt, args);\n\tva_end(args);\n}"
        }
      },
      {
        "call_info": {
          "callee": "va_end",
          "args": [
            "args"
          ],
          "line": 1878
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "vsnprintf",
          "args": [
            "buf",
            "sizeof(buf)",
            "fmt",
            "args"
          ],
          "line": 1877
        },
        "resolved": true,
        "details": {
          "function_name": "vsnprintf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/openbsd-compat/bsd-snprintf.c",
          "lines": "861-865",
          "snippet": "int\nvsnprintf (char *str, size_t count, const char *fmt, va_list args)\n{\n\treturn dopr(str, count, fmt, args);\n}",
          "includes": [
            "#include <errno.h>",
            "#include <limits.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdarg.h>",
            "#include <ctype.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <errno.h>\n#include <limits.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdarg.h>\n#include <ctype.h>\n#include \"includes.h\"\n\nint\nvsnprintf (char *str, size_t count, const char *fmt, va_list args)\n{\n\treturn dopr(str, count, fmt, args);\n}"
        }
      },
      {
        "call_info": {
          "callee": "va_start",
          "args": [
            "args",
            "fmt"
          ],
          "line": 1876
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sshpkt_fmt_connection_id",
          "args": [
            "ssh",
            "remote_id",
            "sizeof(remote_id)"
          ],
          "line": 1875
        },
        "resolved": true,
        "details": {
          "function_name": "sshpkt_fmt_connection_id",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
          "lines": "1796-1803",
          "snippet": "void\nsshpkt_fmt_connection_id(struct ssh *ssh, char *s, size_t l)\n{\n\tsnprintf(s, l, \"%.200s%s%s port %d\",\n\t    ssh->log_preamble ? ssh->log_preamble : \"\",\n\t    ssh->log_preamble ? \" \" : \"\",\n\t    ssh_remote_ipaddr(ssh), ssh_remote_port(ssh));\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include \"packet.h\"",
            "#include \"ssh.h\"",
            "#include \"channels.h\"",
            "#include \"misc.h\"",
            "#include \"canohost.h\"",
            "#include \"log.h\"",
            "#include \"mac.h\"",
            "#include \"digest.h\"",
            "#include \"kex.h\"",
            "#include \"sshkey.h\"",
            "#include \"cipher.h\"",
            "#include \"ssh2.h\"",
            "#include \"compat.h\"",
            "#include \"crc32.h\"",
            "#include \"xmalloc.h\"",
            "#include <zlib.h>",
            "#  include <openssl/ec.h>",
            "# include <openssl/evp.h>",
            "# include <openssl/bn.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <limits.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <netdb.h>",
            "#include <errno.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include \"openbsd-compat/sys-queue.h\"",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\nsshpkt_fmt_connection_id(struct ssh *ssh, char *s, size_t l)\n{\n\tsnprintf(s, l, \"%.200s%s%s port %d\",\n\t    ssh->log_preamble ? ssh->log_preamble : \"\",\n\t    ssh->log_preamble ? \" \" : \"\",\n\t    ssh_remote_ipaddr(ssh), ssh_remote_port(ssh));\n}"
        }
      },
      {
        "call_info": {
          "callee": "fatal",
          "args": [
            "\"packet_disconnect called recursively.\""
          ],
          "line": 1868
        },
        "resolved": true,
        "details": {
          "function_name": "fatal",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/fatal.c",
          "lines": "36-45",
          "snippet": "void\nfatal(const char *fmt,...)\n{\n\tva_list args;\n\n\tva_start(args, fmt);\n\tdo_log(SYSLOG_LEVEL_FATAL, fmt, args);\n\tva_end(args);\n\tcleanup_exit(255);\n}",
          "includes": [
            "#include \"log.h\"",
            "#include <stdarg.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n#include <stdarg.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\nfatal(const char *fmt,...)\n{\n\tva_list args;\n\n\tva_start(args, fmt);\n\tdo_log(SYSLOG_LEVEL_FATAL, fmt, args);\n\tva_end(args);\n\tcleanup_exit(255);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\nssh_packet_disconnect(struct ssh *ssh, const char *fmt,...)\n{\n\tchar buf[1024], remote_id[512];\n\tva_list args;\n\tstatic int disconnecting = 0;\n\tint r;\n\n\tif (disconnecting)\t/* Guard against recursive invocations. */\n\t\tfatal(\"packet_disconnect called recursively.\");\n\tdisconnecting = 1;\n\n\t/*\n\t * Format the message.  Note that the caller must make sure the\n\t * message is of limited size.\n\t */\n\tsshpkt_fmt_connection_id(ssh, remote_id, sizeof(remote_id));\n\tva_start(args, fmt);\n\tvsnprintf(buf, sizeof(buf), fmt, args);\n\tva_end(args);\n\n\t/* Display the error locally */\n\tlogit(\"Disconnecting %s: %.100s\", remote_id, buf);\n\n\t/*\n\t * Send the disconnect message to the other side, and wait\n\t * for it to get sent.\n\t */\n\tif ((r = sshpkt_disconnect(ssh, \"%s\", buf)) != 0)\n\t\tsshpkt_fatal(ssh, __func__, r);\n\n\tif ((r = ssh_packet_write_wait(ssh)) != 0)\n\t\tsshpkt_fatal(ssh, __func__, r);\n\n\t/* Close the connection. */\n\tssh_packet_close(ssh);\n\tcleanup_exit(255);\n}"
  },
  {
    "function_name": "sshpkt_fatal",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
    "lines": "1808-1851",
    "snippet": "void\nsshpkt_fatal(struct ssh *ssh, const char *tag, int r)\n{\n\tchar remote_id[512];\n\n\tsshpkt_fmt_connection_id(ssh, remote_id, sizeof(remote_id));\n\n\tswitch (r) {\n\tcase SSH_ERR_CONN_CLOSED:\n\t\tssh_packet_clear_keys(ssh);\n\t\tlogdie(\"Connection closed by %s\", remote_id);\n\tcase SSH_ERR_CONN_TIMEOUT:\n\t\tssh_packet_clear_keys(ssh);\n\t\tlogdie(\"Connection %s %s timed out\",\n\t\t    ssh->state->server_side ? \"from\" : \"to\", remote_id);\n\tcase SSH_ERR_DISCONNECTED:\n\t\tssh_packet_clear_keys(ssh);\n\t\tlogdie(\"Disconnected from %s\", remote_id);\n\tcase SSH_ERR_SYSTEM_ERROR:\n\t\tif (errno == ECONNRESET) {\n\t\t\tssh_packet_clear_keys(ssh);\n\t\t\tlogdie(\"Connection reset by %s\", remote_id);\n\t\t}\n\t\t/* FALLTHROUGH */\n\tcase SSH_ERR_NO_CIPHER_ALG_MATCH:\n\tcase SSH_ERR_NO_MAC_ALG_MATCH:\n\tcase SSH_ERR_NO_COMPRESS_ALG_MATCH:\n\tcase SSH_ERR_NO_KEX_ALG_MATCH:\n\tcase SSH_ERR_NO_HOSTKEY_ALG_MATCH:\n\t\tif (ssh && ssh->kex && ssh->kex->failed_choice) {\n\t\t\tssh_packet_clear_keys(ssh);\n\t\t\tlogdie(\"Unable to negotiate with %s: %s. \"\n\t\t\t    \"Their offer: %s\", remote_id, ssh_err(r),\n\t\t\t    ssh->kex->failed_choice);\n\t\t}\n\t\t/* FALLTHROUGH */\n\tdefault:\n\t\tssh_packet_clear_keys(ssh);\n\t\tlogdie(\"%s%sConnection %s %s: %s\",\n\t\t    tag != NULL ? tag : \"\", tag != NULL ? \": \" : \"\",\n\t\t    ssh->state->server_side ? \"from\" : \"to\",\n\t\t    remote_id, ssh_err(r));\n\t}\n}",
    "includes": [
      "#include \"sshbuf.h\"",
      "#include \"ssherr.h\"",
      "#include \"packet.h\"",
      "#include \"ssh.h\"",
      "#include \"channels.h\"",
      "#include \"misc.h\"",
      "#include \"canohost.h\"",
      "#include \"log.h\"",
      "#include \"mac.h\"",
      "#include \"digest.h\"",
      "#include \"kex.h\"",
      "#include \"sshkey.h\"",
      "#include \"cipher.h\"",
      "#include \"ssh2.h\"",
      "#include \"compat.h\"",
      "#include \"crc32.h\"",
      "#include \"xmalloc.h\"",
      "#include <zlib.h>",
      "#  include <openssl/ec.h>",
      "# include <openssl/evp.h>",
      "# include <openssl/bn.h>",
      "#include <time.h>",
      "#include <signal.h>",
      "#include <limits.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <stdarg.h>",
      "#include <netdb.h>",
      "#include <errno.h>",
      "#include <arpa/inet.h>",
      "#include <netinet/ip.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include \"openbsd-compat/sys-queue.h\"",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "logdie",
          "args": [
            "\"%s%sConnection %s %s: %s\"",
            "tag != NULL ? tag : \"\"",
            "tag != NULL ? \": \" : \"\"",
            "ssh->state->server_side ? \"from\" : \"to\"",
            "remote_id",
            "ssh_err(r)"
          ],
          "line": 1846
        },
        "resolved": true,
        "details": {
          "function_name": "logdie",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/log.c",
          "lines": "185-194",
          "snippet": "void\nlogdie(const char *fmt,...)\n{\n\tva_list args;\n\n\tva_start(args, fmt);\n\tdo_log(SYSLOG_LEVEL_INFO, fmt, args);\n\tva_end(args);\n\tcleanup_exit(255);\n}",
          "includes": [
            "#include \"log.h\"",
            "# include <vis.h>",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <syslog.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <fcntl.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n# include <vis.h>\n#include <errno.h>\n#include <unistd.h>\n#include <syslog.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <fcntl.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\nlogdie(const char *fmt,...)\n{\n\tva_list args;\n\n\tva_start(args, fmt);\n\tdo_log(SYSLOG_LEVEL_INFO, fmt, args);\n\tva_end(args);\n\tcleanup_exit(255);\n}"
        }
      },
      {
        "call_info": {
          "callee": "ssh_err",
          "args": [
            "r"
          ],
          "line": 1849
        },
        "resolved": true,
        "details": {
          "function_name": "ssh_err",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/ssherr.c",
          "lines": "22-147",
          "snippet": "const char *\nssh_err(int n)\n{\n\tswitch (n) {\n\tcase SSH_ERR_SUCCESS:\n\t\treturn \"success\";\n\tcase SSH_ERR_INTERNAL_ERROR:\n\t\treturn \"unexpected internal error\";\n\tcase SSH_ERR_ALLOC_FAIL:\n\t\treturn \"memory allocation failed\";\n\tcase SSH_ERR_MESSAGE_INCOMPLETE:\n\t\treturn \"incomplete message\";\n\tcase SSH_ERR_INVALID_FORMAT:\n\t\treturn \"invalid format\";\n\tcase SSH_ERR_BIGNUM_IS_NEGATIVE:\n\t\treturn \"bignum is negative\";\n\tcase SSH_ERR_STRING_TOO_LARGE:\n\t\treturn \"string is too large\";\n\tcase SSH_ERR_BIGNUM_TOO_LARGE:\n\t\treturn \"bignum is too large\";\n\tcase SSH_ERR_ECPOINT_TOO_LARGE:\n\t\treturn \"elliptic curve point is too large\";\n\tcase SSH_ERR_NO_BUFFER_SPACE:\n\t\treturn \"insufficient buffer space\";\n\tcase SSH_ERR_INVALID_ARGUMENT:\n\t\treturn \"invalid argument\";\n\tcase SSH_ERR_KEY_BITS_MISMATCH:\n\t\treturn \"key bits do not match\";\n\tcase SSH_ERR_EC_CURVE_INVALID:\n\t\treturn \"invalid elliptic curve\";\n\tcase SSH_ERR_KEY_TYPE_MISMATCH:\n\t\treturn \"key type does not match\";\n\tcase SSH_ERR_KEY_TYPE_UNKNOWN:\n\t\treturn \"unknown or unsupported key type\";\n\tcase SSH_ERR_EC_CURVE_MISMATCH:\n\t\treturn \"elliptic curve does not match\";\n\tcase SSH_ERR_EXPECTED_CERT:\n\t\treturn \"plain key provided where certificate required\";\n\tcase SSH_ERR_KEY_LACKS_CERTBLOB:\n\t\treturn \"key lacks certificate data\";\n\tcase SSH_ERR_KEY_CERT_UNKNOWN_TYPE:\n\t\treturn \"unknown/unsupported certificate type\";\n\tcase SSH_ERR_KEY_CERT_INVALID_SIGN_KEY:\n\t\treturn \"invalid certificate signing key\";\n\tcase SSH_ERR_KEY_INVALID_EC_VALUE:\n\t\treturn \"invalid elliptic curve value\";\n\tcase SSH_ERR_SIGNATURE_INVALID:\n\t\treturn \"incorrect signature\";\n\tcase SSH_ERR_LIBCRYPTO_ERROR:\n\t\treturn \"error in libcrypto\";  /* XXX fetch and return */\n\tcase SSH_ERR_UNEXPECTED_TRAILING_DATA:\n\t\treturn \"unexpected bytes remain after decoding\";\n\tcase SSH_ERR_SYSTEM_ERROR:\n\t\treturn strerror(errno);\n\tcase SSH_ERR_KEY_CERT_INVALID:\n\t\treturn \"invalid certificate\";\n\tcase SSH_ERR_AGENT_COMMUNICATION:\n\t\treturn \"communication with agent failed\";\n\tcase SSH_ERR_AGENT_FAILURE:\n\t\treturn \"agent refused operation\";\n\tcase SSH_ERR_DH_GEX_OUT_OF_RANGE:\n\t\treturn \"DH GEX group out of range\";\n\tcase SSH_ERR_DISCONNECTED:\n\t\treturn \"disconnected\";\n\tcase SSH_ERR_MAC_INVALID:\n\t\treturn \"message authentication code incorrect\";\n\tcase SSH_ERR_NO_CIPHER_ALG_MATCH:\n\t\treturn \"no matching cipher found\";\n\tcase SSH_ERR_NO_MAC_ALG_MATCH:\n\t\treturn \"no matching MAC found\";\n\tcase SSH_ERR_NO_COMPRESS_ALG_MATCH:\n\t\treturn \"no matching compression method found\";\n\tcase SSH_ERR_NO_KEX_ALG_MATCH:\n\t\treturn \"no matching key exchange method found\";\n\tcase SSH_ERR_NO_HOSTKEY_ALG_MATCH:\n\t\treturn \"no matching host key type found\";\n\tcase SSH_ERR_PROTOCOL_MISMATCH:\n\t\treturn \"protocol version mismatch\";\n\tcase SSH_ERR_NO_PROTOCOL_VERSION:\n\t\treturn \"could not read protocol version\";\n\tcase SSH_ERR_NO_HOSTKEY_LOADED:\n\t\treturn \"could not load host key\";\n\tcase SSH_ERR_NEED_REKEY:\n\t\treturn \"rekeying not supported by peer\";\n\tcase SSH_ERR_PASSPHRASE_TOO_SHORT:\n\t\treturn \"passphrase is too short (minimum five characters)\";\n\tcase SSH_ERR_FILE_CHANGED:\n\t\treturn \"file changed while reading\";\n\tcase SSH_ERR_KEY_UNKNOWN_CIPHER:\n\t\treturn \"key encrypted using unsupported cipher\";\n\tcase SSH_ERR_KEY_WRONG_PASSPHRASE:\n\t\treturn \"incorrect passphrase supplied to decrypt private key\";\n\tcase SSH_ERR_KEY_BAD_PERMISSIONS:\n\t\treturn \"bad permissions\";\n\tcase SSH_ERR_KEY_CERT_MISMATCH:\n\t\treturn \"certificate does not match key\";\n\tcase SSH_ERR_KEY_NOT_FOUND:\n\t\treturn \"key not found\";\n\tcase SSH_ERR_AGENT_NOT_PRESENT:\n\t\treturn \"agent not present\";\n\tcase SSH_ERR_AGENT_NO_IDENTITIES:\n\t\treturn \"agent contains no identities\";\n\tcase SSH_ERR_BUFFER_READ_ONLY:\n\t\treturn \"internal error: buffer is read-only\";\n\tcase SSH_ERR_KRL_BAD_MAGIC:\n\t\treturn \"KRL file has invalid magic number\";\n\tcase SSH_ERR_KEY_REVOKED:\n\t\treturn \"Key is revoked\";\n\tcase SSH_ERR_CONN_CLOSED:\n\t\treturn \"Connection closed\";\n\tcase SSH_ERR_CONN_TIMEOUT:\n\t\treturn \"Connection timed out\";\n\tcase SSH_ERR_CONN_CORRUPT:\n\t\treturn \"Connection corrupted\";\n\tcase SSH_ERR_PROTOCOL_ERROR:\n\t\treturn \"Protocol error\";\n\tcase SSH_ERR_KEY_LENGTH:\n\t\treturn \"Invalid key length\";\n\tcase SSH_ERR_NUMBER_TOO_LARGE:\n\t\treturn \"number is too large\";\n\tcase SSH_ERR_SIGN_ALG_UNSUPPORTED:\n\t\treturn \"signature algorithm not supported\";\n\tdefault:\n\t\treturn \"unknown error\";\n\t}\n}",
          "includes": [
            "#include \"ssherr.h\"",
            "#include <string.h>",
            "#include <errno.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"ssherr.h\"\n#include <string.h>\n#include <errno.h>\n\nconst char *\nssh_err(int n)\n{\n\tswitch (n) {\n\tcase SSH_ERR_SUCCESS:\n\t\treturn \"success\";\n\tcase SSH_ERR_INTERNAL_ERROR:\n\t\treturn \"unexpected internal error\";\n\tcase SSH_ERR_ALLOC_FAIL:\n\t\treturn \"memory allocation failed\";\n\tcase SSH_ERR_MESSAGE_INCOMPLETE:\n\t\treturn \"incomplete message\";\n\tcase SSH_ERR_INVALID_FORMAT:\n\t\treturn \"invalid format\";\n\tcase SSH_ERR_BIGNUM_IS_NEGATIVE:\n\t\treturn \"bignum is negative\";\n\tcase SSH_ERR_STRING_TOO_LARGE:\n\t\treturn \"string is too large\";\n\tcase SSH_ERR_BIGNUM_TOO_LARGE:\n\t\treturn \"bignum is too large\";\n\tcase SSH_ERR_ECPOINT_TOO_LARGE:\n\t\treturn \"elliptic curve point is too large\";\n\tcase SSH_ERR_NO_BUFFER_SPACE:\n\t\treturn \"insufficient buffer space\";\n\tcase SSH_ERR_INVALID_ARGUMENT:\n\t\treturn \"invalid argument\";\n\tcase SSH_ERR_KEY_BITS_MISMATCH:\n\t\treturn \"key bits do not match\";\n\tcase SSH_ERR_EC_CURVE_INVALID:\n\t\treturn \"invalid elliptic curve\";\n\tcase SSH_ERR_KEY_TYPE_MISMATCH:\n\t\treturn \"key type does not match\";\n\tcase SSH_ERR_KEY_TYPE_UNKNOWN:\n\t\treturn \"unknown or unsupported key type\";\n\tcase SSH_ERR_EC_CURVE_MISMATCH:\n\t\treturn \"elliptic curve does not match\";\n\tcase SSH_ERR_EXPECTED_CERT:\n\t\treturn \"plain key provided where certificate required\";\n\tcase SSH_ERR_KEY_LACKS_CERTBLOB:\n\t\treturn \"key lacks certificate data\";\n\tcase SSH_ERR_KEY_CERT_UNKNOWN_TYPE:\n\t\treturn \"unknown/unsupported certificate type\";\n\tcase SSH_ERR_KEY_CERT_INVALID_SIGN_KEY:\n\t\treturn \"invalid certificate signing key\";\n\tcase SSH_ERR_KEY_INVALID_EC_VALUE:\n\t\treturn \"invalid elliptic curve value\";\n\tcase SSH_ERR_SIGNATURE_INVALID:\n\t\treturn \"incorrect signature\";\n\tcase SSH_ERR_LIBCRYPTO_ERROR:\n\t\treturn \"error in libcrypto\";  /* XXX fetch and return */\n\tcase SSH_ERR_UNEXPECTED_TRAILING_DATA:\n\t\treturn \"unexpected bytes remain after decoding\";\n\tcase SSH_ERR_SYSTEM_ERROR:\n\t\treturn strerror(errno);\n\tcase SSH_ERR_KEY_CERT_INVALID:\n\t\treturn \"invalid certificate\";\n\tcase SSH_ERR_AGENT_COMMUNICATION:\n\t\treturn \"communication with agent failed\";\n\tcase SSH_ERR_AGENT_FAILURE:\n\t\treturn \"agent refused operation\";\n\tcase SSH_ERR_DH_GEX_OUT_OF_RANGE:\n\t\treturn \"DH GEX group out of range\";\n\tcase SSH_ERR_DISCONNECTED:\n\t\treturn \"disconnected\";\n\tcase SSH_ERR_MAC_INVALID:\n\t\treturn \"message authentication code incorrect\";\n\tcase SSH_ERR_NO_CIPHER_ALG_MATCH:\n\t\treturn \"no matching cipher found\";\n\tcase SSH_ERR_NO_MAC_ALG_MATCH:\n\t\treturn \"no matching MAC found\";\n\tcase SSH_ERR_NO_COMPRESS_ALG_MATCH:\n\t\treturn \"no matching compression method found\";\n\tcase SSH_ERR_NO_KEX_ALG_MATCH:\n\t\treturn \"no matching key exchange method found\";\n\tcase SSH_ERR_NO_HOSTKEY_ALG_MATCH:\n\t\treturn \"no matching host key type found\";\n\tcase SSH_ERR_PROTOCOL_MISMATCH:\n\t\treturn \"protocol version mismatch\";\n\tcase SSH_ERR_NO_PROTOCOL_VERSION:\n\t\treturn \"could not read protocol version\";\n\tcase SSH_ERR_NO_HOSTKEY_LOADED:\n\t\treturn \"could not load host key\";\n\tcase SSH_ERR_NEED_REKEY:\n\t\treturn \"rekeying not supported by peer\";\n\tcase SSH_ERR_PASSPHRASE_TOO_SHORT:\n\t\treturn \"passphrase is too short (minimum five characters)\";\n\tcase SSH_ERR_FILE_CHANGED:\n\t\treturn \"file changed while reading\";\n\tcase SSH_ERR_KEY_UNKNOWN_CIPHER:\n\t\treturn \"key encrypted using unsupported cipher\";\n\tcase SSH_ERR_KEY_WRONG_PASSPHRASE:\n\t\treturn \"incorrect passphrase supplied to decrypt private key\";\n\tcase SSH_ERR_KEY_BAD_PERMISSIONS:\n\t\treturn \"bad permissions\";\n\tcase SSH_ERR_KEY_CERT_MISMATCH:\n\t\treturn \"certificate does not match key\";\n\tcase SSH_ERR_KEY_NOT_FOUND:\n\t\treturn \"key not found\";\n\tcase SSH_ERR_AGENT_NOT_PRESENT:\n\t\treturn \"agent not present\";\n\tcase SSH_ERR_AGENT_NO_IDENTITIES:\n\t\treturn \"agent contains no identities\";\n\tcase SSH_ERR_BUFFER_READ_ONLY:\n\t\treturn \"internal error: buffer is read-only\";\n\tcase SSH_ERR_KRL_BAD_MAGIC:\n\t\treturn \"KRL file has invalid magic number\";\n\tcase SSH_ERR_KEY_REVOKED:\n\t\treturn \"Key is revoked\";\n\tcase SSH_ERR_CONN_CLOSED:\n\t\treturn \"Connection closed\";\n\tcase SSH_ERR_CONN_TIMEOUT:\n\t\treturn \"Connection timed out\";\n\tcase SSH_ERR_CONN_CORRUPT:\n\t\treturn \"Connection corrupted\";\n\tcase SSH_ERR_PROTOCOL_ERROR:\n\t\treturn \"Protocol error\";\n\tcase SSH_ERR_KEY_LENGTH:\n\t\treturn \"Invalid key length\";\n\tcase SSH_ERR_NUMBER_TOO_LARGE:\n\t\treturn \"number is too large\";\n\tcase SSH_ERR_SIGN_ALG_UNSUPPORTED:\n\t\treturn \"signature algorithm not supported\";\n\tdefault:\n\t\treturn \"unknown error\";\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "ssh_packet_clear_keys",
          "args": [
            "ssh"
          ],
          "line": 1845
        },
        "resolved": true,
        "details": {
          "function_name": "ssh_packet_clear_keys",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
          "lines": "652-656",
          "snippet": "void\nssh_packet_clear_keys(struct ssh *ssh)\n{\n\tssh_packet_close_internal(ssh, 0);\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include \"packet.h\"",
            "#include \"ssh.h\"",
            "#include \"channels.h\"",
            "#include \"misc.h\"",
            "#include \"canohost.h\"",
            "#include \"log.h\"",
            "#include \"mac.h\"",
            "#include \"digest.h\"",
            "#include \"kex.h\"",
            "#include \"sshkey.h\"",
            "#include \"cipher.h\"",
            "#include \"ssh2.h\"",
            "#include \"compat.h\"",
            "#include \"crc32.h\"",
            "#include \"xmalloc.h\"",
            "#include <zlib.h>",
            "#  include <openssl/ec.h>",
            "# include <openssl/evp.h>",
            "# include <openssl/bn.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <limits.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <netdb.h>",
            "#include <errno.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include \"openbsd-compat/sys-queue.h\"",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\nssh_packet_clear_keys(struct ssh *ssh)\n{\n\tssh_packet_close_internal(ssh, 0);\n}"
        }
      },
      {
        "call_info": {
          "callee": "sshpkt_fmt_connection_id",
          "args": [
            "ssh",
            "remote_id",
            "sizeof(remote_id)"
          ],
          "line": 1813
        },
        "resolved": true,
        "details": {
          "function_name": "sshpkt_fmt_connection_id",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
          "lines": "1796-1803",
          "snippet": "void\nsshpkt_fmt_connection_id(struct ssh *ssh, char *s, size_t l)\n{\n\tsnprintf(s, l, \"%.200s%s%s port %d\",\n\t    ssh->log_preamble ? ssh->log_preamble : \"\",\n\t    ssh->log_preamble ? \" \" : \"\",\n\t    ssh_remote_ipaddr(ssh), ssh_remote_port(ssh));\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include \"packet.h\"",
            "#include \"ssh.h\"",
            "#include \"channels.h\"",
            "#include \"misc.h\"",
            "#include \"canohost.h\"",
            "#include \"log.h\"",
            "#include \"mac.h\"",
            "#include \"digest.h\"",
            "#include \"kex.h\"",
            "#include \"sshkey.h\"",
            "#include \"cipher.h\"",
            "#include \"ssh2.h\"",
            "#include \"compat.h\"",
            "#include \"crc32.h\"",
            "#include \"xmalloc.h\"",
            "#include <zlib.h>",
            "#  include <openssl/ec.h>",
            "# include <openssl/evp.h>",
            "# include <openssl/bn.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <limits.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <netdb.h>",
            "#include <errno.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include \"openbsd-compat/sys-queue.h\"",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\nsshpkt_fmt_connection_id(struct ssh *ssh, char *s, size_t l)\n{\n\tsnprintf(s, l, \"%.200s%s%s port %d\",\n\t    ssh->log_preamble ? ssh->log_preamble : \"\",\n\t    ssh->log_preamble ? \" \" : \"\",\n\t    ssh_remote_ipaddr(ssh), ssh_remote_port(ssh));\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\nsshpkt_fatal(struct ssh *ssh, const char *tag, int r)\n{\n\tchar remote_id[512];\n\n\tsshpkt_fmt_connection_id(ssh, remote_id, sizeof(remote_id));\n\n\tswitch (r) {\n\tcase SSH_ERR_CONN_CLOSED:\n\t\tssh_packet_clear_keys(ssh);\n\t\tlogdie(\"Connection closed by %s\", remote_id);\n\tcase SSH_ERR_CONN_TIMEOUT:\n\t\tssh_packet_clear_keys(ssh);\n\t\tlogdie(\"Connection %s %s timed out\",\n\t\t    ssh->state->server_side ? \"from\" : \"to\", remote_id);\n\tcase SSH_ERR_DISCONNECTED:\n\t\tssh_packet_clear_keys(ssh);\n\t\tlogdie(\"Disconnected from %s\", remote_id);\n\tcase SSH_ERR_SYSTEM_ERROR:\n\t\tif (errno == ECONNRESET) {\n\t\t\tssh_packet_clear_keys(ssh);\n\t\t\tlogdie(\"Connection reset by %s\", remote_id);\n\t\t}\n\t\t/* FALLTHROUGH */\n\tcase SSH_ERR_NO_CIPHER_ALG_MATCH:\n\tcase SSH_ERR_NO_MAC_ALG_MATCH:\n\tcase SSH_ERR_NO_COMPRESS_ALG_MATCH:\n\tcase SSH_ERR_NO_KEX_ALG_MATCH:\n\tcase SSH_ERR_NO_HOSTKEY_ALG_MATCH:\n\t\tif (ssh && ssh->kex && ssh->kex->failed_choice) {\n\t\t\tssh_packet_clear_keys(ssh);\n\t\t\tlogdie(\"Unable to negotiate with %s: %s. \"\n\t\t\t    \"Their offer: %s\", remote_id, ssh_err(r),\n\t\t\t    ssh->kex->failed_choice);\n\t\t}\n\t\t/* FALLTHROUGH */\n\tdefault:\n\t\tssh_packet_clear_keys(ssh);\n\t\tlogdie(\"%s%sConnection %s %s: %s\",\n\t\t    tag != NULL ? tag : \"\", tag != NULL ? \": \" : \"\",\n\t\t    ssh->state->server_side ? \"from\" : \"to\",\n\t\t    remote_id, ssh_err(r));\n\t}\n}"
  },
  {
    "function_name": "sshpkt_fmt_connection_id",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
    "lines": "1796-1803",
    "snippet": "void\nsshpkt_fmt_connection_id(struct ssh *ssh, char *s, size_t l)\n{\n\tsnprintf(s, l, \"%.200s%s%s port %d\",\n\t    ssh->log_preamble ? ssh->log_preamble : \"\",\n\t    ssh->log_preamble ? \" \" : \"\",\n\t    ssh_remote_ipaddr(ssh), ssh_remote_port(ssh));\n}",
    "includes": [
      "#include \"sshbuf.h\"",
      "#include \"ssherr.h\"",
      "#include \"packet.h\"",
      "#include \"ssh.h\"",
      "#include \"channels.h\"",
      "#include \"misc.h\"",
      "#include \"canohost.h\"",
      "#include \"log.h\"",
      "#include \"mac.h\"",
      "#include \"digest.h\"",
      "#include \"kex.h\"",
      "#include \"sshkey.h\"",
      "#include \"cipher.h\"",
      "#include \"ssh2.h\"",
      "#include \"compat.h\"",
      "#include \"crc32.h\"",
      "#include \"xmalloc.h\"",
      "#include <zlib.h>",
      "#  include <openssl/ec.h>",
      "# include <openssl/evp.h>",
      "# include <openssl/bn.h>",
      "#include <time.h>",
      "#include <signal.h>",
      "#include <limits.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <stdarg.h>",
      "#include <netdb.h>",
      "#include <errno.h>",
      "#include <arpa/inet.h>",
      "#include <netinet/ip.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include \"openbsd-compat/sys-queue.h\"",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "snprintf",
          "args": [
            "s",
            "l",
            "\"%.200s%s%s port %d\"",
            "ssh->log_preamble ? ssh->log_preamble : \"\"",
            "ssh->log_preamble ? \" \" : \"\"",
            "ssh_remote_ipaddr(ssh)",
            "ssh_remote_port(ssh)"
          ],
          "line": 1799
        },
        "resolved": true,
        "details": {
          "function_name": "snprintf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/openbsd-compat/bsd-snprintf.c",
          "lines": "869-879",
          "snippet": "int\nsnprintf(char *str, size_t count, SNPRINTF_CONST char *fmt, ...)\n{\n\tsize_t ret;\n\tva_list ap;\n\n\tva_start(ap, fmt);\n\tret = vsnprintf(str, count, fmt, ap);\n\tva_end(ap);\n\treturn ret;\n}",
          "includes": [
            "#include <errno.h>",
            "#include <limits.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdarg.h>",
            "#include <ctype.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <errno.h>\n#include <limits.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdarg.h>\n#include <ctype.h>\n#include \"includes.h\"\n\nint\nsnprintf(char *str, size_t count, SNPRINTF_CONST char *fmt, ...)\n{\n\tsize_t ret;\n\tva_list ap;\n\n\tva_start(ap, fmt);\n\tret = vsnprintf(str, count, fmt, ap);\n\tva_end(ap);\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "ssh_remote_port",
          "args": [
            "ssh"
          ],
          "line": 1802
        },
        "resolved": true,
        "details": {
          "function_name": "ssh_remote_port",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
          "lines": "539-544",
          "snippet": "int\nssh_remote_port(struct ssh *ssh)\n{\n\t(void)ssh_remote_ipaddr(ssh); /* Will lookup and cache. */\n\treturn ssh->remote_port;\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include \"packet.h\"",
            "#include \"ssh.h\"",
            "#include \"channels.h\"",
            "#include \"misc.h\"",
            "#include \"canohost.h\"",
            "#include \"log.h\"",
            "#include \"mac.h\"",
            "#include \"digest.h\"",
            "#include \"kex.h\"",
            "#include \"sshkey.h\"",
            "#include \"cipher.h\"",
            "#include \"ssh2.h\"",
            "#include \"compat.h\"",
            "#include \"crc32.h\"",
            "#include \"xmalloc.h\"",
            "#include <zlib.h>",
            "#  include <openssl/ec.h>",
            "# include <openssl/evp.h>",
            "# include <openssl/bn.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <limits.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <netdb.h>",
            "#include <errno.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include \"openbsd-compat/sys-queue.h\"",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nssh_remote_port(struct ssh *ssh)\n{\n\t(void)ssh_remote_ipaddr(ssh); /* Will lookup and cache. */\n\treturn ssh->remote_port;\n}"
        }
      },
      {
        "call_info": {
          "callee": "ssh_remote_ipaddr",
          "args": [
            "ssh"
          ],
          "line": 1802
        },
        "resolved": true,
        "details": {
          "function_name": "ssh_remote_ipaddr",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
          "lines": "514-535",
          "snippet": "const char *\nssh_remote_ipaddr(struct ssh *ssh)\n{\n\tint sock;\n\n\t/* Check whether we have cached the ipaddr. */\n\tif (ssh->remote_ipaddr == NULL) {\n\t\tif (ssh_packet_connection_is_on_socket(ssh)) {\n\t\t\tsock = ssh->state->connection_in;\n\t\t\tssh->remote_ipaddr = get_peer_ipaddr(sock);\n\t\t\tssh->remote_port = get_peer_port(sock);\n\t\t\tssh->local_ipaddr = get_local_ipaddr(sock);\n\t\t\tssh->local_port = get_local_port(sock);\n\t\t} else {\n\t\t\tssh->remote_ipaddr = strdup(\"UNKNOWN\");\n\t\t\tssh->remote_port = 65535;\n\t\t\tssh->local_ipaddr = strdup(\"UNKNOWN\");\n\t\t\tssh->local_port = 65535;\n\t\t}\n\t}\n\treturn ssh->remote_ipaddr;\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include \"packet.h\"",
            "#include \"ssh.h\"",
            "#include \"channels.h\"",
            "#include \"misc.h\"",
            "#include \"canohost.h\"",
            "#include \"log.h\"",
            "#include \"mac.h\"",
            "#include \"digest.h\"",
            "#include \"kex.h\"",
            "#include \"sshkey.h\"",
            "#include \"cipher.h\"",
            "#include \"ssh2.h\"",
            "#include \"compat.h\"",
            "#include \"crc32.h\"",
            "#include \"xmalloc.h\"",
            "#include <zlib.h>",
            "#  include <openssl/ec.h>",
            "# include <openssl/evp.h>",
            "# include <openssl/bn.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <limits.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <netdb.h>",
            "#include <errno.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include \"openbsd-compat/sys-queue.h\"",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nconst char *\nssh_remote_ipaddr(struct ssh *ssh)\n{\n\tint sock;\n\n\t/* Check whether we have cached the ipaddr. */\n\tif (ssh->remote_ipaddr == NULL) {\n\t\tif (ssh_packet_connection_is_on_socket(ssh)) {\n\t\t\tsock = ssh->state->connection_in;\n\t\t\tssh->remote_ipaddr = get_peer_ipaddr(sock);\n\t\t\tssh->remote_port = get_peer_port(sock);\n\t\t\tssh->local_ipaddr = get_local_ipaddr(sock);\n\t\t\tssh->local_port = get_local_port(sock);\n\t\t} else {\n\t\t\tssh->remote_ipaddr = strdup(\"UNKNOWN\");\n\t\t\tssh->remote_port = 65535;\n\t\t\tssh->local_ipaddr = strdup(\"UNKNOWN\");\n\t\t\tssh->local_port = 65535;\n\t\t}\n\t}\n\treturn ssh->remote_ipaddr;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\nsshpkt_fmt_connection_id(struct ssh *ssh, char *s, size_t l)\n{\n\tsnprintf(s, l, \"%.200s%s%s port %d\",\n\t    ssh->log_preamble ? ssh->log_preamble : \"\",\n\t    ssh->log_preamble ? \" \" : \"\",\n\t    ssh_remote_ipaddr(ssh), ssh_remote_port(ssh));\n}"
  },
  {
    "function_name": "ssh_packet_send_debug",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
    "lines": "1771-1794",
    "snippet": "void\nssh_packet_send_debug(struct ssh *ssh, const char *fmt,...)\n{\n\tchar buf[1024];\n\tva_list args;\n\tint r;\n\n\tif ((ssh->compat & SSH_BUG_DEBUG))\n\t\treturn;\n\n\tva_start(args, fmt);\n\tvsnprintf(buf, sizeof(buf), fmt, args);\n\tva_end(args);\n\n\tdebug3(\"sending debug message: %s\", buf);\n\n\tif ((r = sshpkt_start(ssh, SSH2_MSG_DEBUG)) != 0 ||\n\t    (r = sshpkt_put_u8(ssh, 0)) != 0 || /* always display */\n\t    (r = sshpkt_put_cstring(ssh, buf)) != 0 ||\n\t    (r = sshpkt_put_cstring(ssh, \"\")) != 0 ||\n\t    (r = sshpkt_send(ssh)) != 0 ||\n\t    (r = ssh_packet_write_wait(ssh)) != 0)\n\t\tfatal(\"%s: %s\", __func__, ssh_err(r));\n}",
    "includes": [
      "#include \"sshbuf.h\"",
      "#include \"ssherr.h\"",
      "#include \"packet.h\"",
      "#include \"ssh.h\"",
      "#include \"channels.h\"",
      "#include \"misc.h\"",
      "#include \"canohost.h\"",
      "#include \"log.h\"",
      "#include \"mac.h\"",
      "#include \"digest.h\"",
      "#include \"kex.h\"",
      "#include \"sshkey.h\"",
      "#include \"cipher.h\"",
      "#include \"ssh2.h\"",
      "#include \"compat.h\"",
      "#include \"crc32.h\"",
      "#include \"xmalloc.h\"",
      "#include <zlib.h>",
      "#  include <openssl/ec.h>",
      "# include <openssl/evp.h>",
      "# include <openssl/bn.h>",
      "#include <time.h>",
      "#include <signal.h>",
      "#include <limits.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <stdarg.h>",
      "#include <netdb.h>",
      "#include <errno.h>",
      "#include <arpa/inet.h>",
      "#include <netinet/ip.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include \"openbsd-compat/sys-queue.h\"",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "fatal",
          "args": [
            "\"%s: %s\"",
            "__func__",
            "ssh_err(r)"
          ],
          "line": 1793
        },
        "resolved": true,
        "details": {
          "function_name": "sshpkt_fatal",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
          "lines": "1808-1851",
          "snippet": "void\nsshpkt_fatal(struct ssh *ssh, const char *tag, int r)\n{\n\tchar remote_id[512];\n\n\tsshpkt_fmt_connection_id(ssh, remote_id, sizeof(remote_id));\n\n\tswitch (r) {\n\tcase SSH_ERR_CONN_CLOSED:\n\t\tssh_packet_clear_keys(ssh);\n\t\tlogdie(\"Connection closed by %s\", remote_id);\n\tcase SSH_ERR_CONN_TIMEOUT:\n\t\tssh_packet_clear_keys(ssh);\n\t\tlogdie(\"Connection %s %s timed out\",\n\t\t    ssh->state->server_side ? \"from\" : \"to\", remote_id);\n\tcase SSH_ERR_DISCONNECTED:\n\t\tssh_packet_clear_keys(ssh);\n\t\tlogdie(\"Disconnected from %s\", remote_id);\n\tcase SSH_ERR_SYSTEM_ERROR:\n\t\tif (errno == ECONNRESET) {\n\t\t\tssh_packet_clear_keys(ssh);\n\t\t\tlogdie(\"Connection reset by %s\", remote_id);\n\t\t}\n\t\t/* FALLTHROUGH */\n\tcase SSH_ERR_NO_CIPHER_ALG_MATCH:\n\tcase SSH_ERR_NO_MAC_ALG_MATCH:\n\tcase SSH_ERR_NO_COMPRESS_ALG_MATCH:\n\tcase SSH_ERR_NO_KEX_ALG_MATCH:\n\tcase SSH_ERR_NO_HOSTKEY_ALG_MATCH:\n\t\tif (ssh && ssh->kex && ssh->kex->failed_choice) {\n\t\t\tssh_packet_clear_keys(ssh);\n\t\t\tlogdie(\"Unable to negotiate with %s: %s. \"\n\t\t\t    \"Their offer: %s\", remote_id, ssh_err(r),\n\t\t\t    ssh->kex->failed_choice);\n\t\t}\n\t\t/* FALLTHROUGH */\n\tdefault:\n\t\tssh_packet_clear_keys(ssh);\n\t\tlogdie(\"%s%sConnection %s %s: %s\",\n\t\t    tag != NULL ? tag : \"\", tag != NULL ? \": \" : \"\",\n\t\t    ssh->state->server_side ? \"from\" : \"to\",\n\t\t    remote_id, ssh_err(r));\n\t}\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include \"packet.h\"",
            "#include \"ssh.h\"",
            "#include \"channels.h\"",
            "#include \"misc.h\"",
            "#include \"canohost.h\"",
            "#include \"log.h\"",
            "#include \"mac.h\"",
            "#include \"digest.h\"",
            "#include \"kex.h\"",
            "#include \"sshkey.h\"",
            "#include \"cipher.h\"",
            "#include \"ssh2.h\"",
            "#include \"compat.h\"",
            "#include \"crc32.h\"",
            "#include \"xmalloc.h\"",
            "#include <zlib.h>",
            "#  include <openssl/ec.h>",
            "# include <openssl/evp.h>",
            "# include <openssl/bn.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <limits.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <netdb.h>",
            "#include <errno.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include \"openbsd-compat/sys-queue.h\"",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\nsshpkt_fatal(struct ssh *ssh, const char *tag, int r)\n{\n\tchar remote_id[512];\n\n\tsshpkt_fmt_connection_id(ssh, remote_id, sizeof(remote_id));\n\n\tswitch (r) {\n\tcase SSH_ERR_CONN_CLOSED:\n\t\tssh_packet_clear_keys(ssh);\n\t\tlogdie(\"Connection closed by %s\", remote_id);\n\tcase SSH_ERR_CONN_TIMEOUT:\n\t\tssh_packet_clear_keys(ssh);\n\t\tlogdie(\"Connection %s %s timed out\",\n\t\t    ssh->state->server_side ? \"from\" : \"to\", remote_id);\n\tcase SSH_ERR_DISCONNECTED:\n\t\tssh_packet_clear_keys(ssh);\n\t\tlogdie(\"Disconnected from %s\", remote_id);\n\tcase SSH_ERR_SYSTEM_ERROR:\n\t\tif (errno == ECONNRESET) {\n\t\t\tssh_packet_clear_keys(ssh);\n\t\t\tlogdie(\"Connection reset by %s\", remote_id);\n\t\t}\n\t\t/* FALLTHROUGH */\n\tcase SSH_ERR_NO_CIPHER_ALG_MATCH:\n\tcase SSH_ERR_NO_MAC_ALG_MATCH:\n\tcase SSH_ERR_NO_COMPRESS_ALG_MATCH:\n\tcase SSH_ERR_NO_KEX_ALG_MATCH:\n\tcase SSH_ERR_NO_HOSTKEY_ALG_MATCH:\n\t\tif (ssh && ssh->kex && ssh->kex->failed_choice) {\n\t\t\tssh_packet_clear_keys(ssh);\n\t\t\tlogdie(\"Unable to negotiate with %s: %s. \"\n\t\t\t    \"Their offer: %s\", remote_id, ssh_err(r),\n\t\t\t    ssh->kex->failed_choice);\n\t\t}\n\t\t/* FALLTHROUGH */\n\tdefault:\n\t\tssh_packet_clear_keys(ssh);\n\t\tlogdie(\"%s%sConnection %s %s: %s\",\n\t\t    tag != NULL ? tag : \"\", tag != NULL ? \": \" : \"\",\n\t\t    ssh->state->server_side ? \"from\" : \"to\",\n\t\t    remote_id, ssh_err(r));\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "ssh_err",
          "args": [
            "r"
          ],
          "line": 1793
        },
        "resolved": true,
        "details": {
          "function_name": "ssh_err",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/ssherr.c",
          "lines": "22-147",
          "snippet": "const char *\nssh_err(int n)\n{\n\tswitch (n) {\n\tcase SSH_ERR_SUCCESS:\n\t\treturn \"success\";\n\tcase SSH_ERR_INTERNAL_ERROR:\n\t\treturn \"unexpected internal error\";\n\tcase SSH_ERR_ALLOC_FAIL:\n\t\treturn \"memory allocation failed\";\n\tcase SSH_ERR_MESSAGE_INCOMPLETE:\n\t\treturn \"incomplete message\";\n\tcase SSH_ERR_INVALID_FORMAT:\n\t\treturn \"invalid format\";\n\tcase SSH_ERR_BIGNUM_IS_NEGATIVE:\n\t\treturn \"bignum is negative\";\n\tcase SSH_ERR_STRING_TOO_LARGE:\n\t\treturn \"string is too large\";\n\tcase SSH_ERR_BIGNUM_TOO_LARGE:\n\t\treturn \"bignum is too large\";\n\tcase SSH_ERR_ECPOINT_TOO_LARGE:\n\t\treturn \"elliptic curve point is too large\";\n\tcase SSH_ERR_NO_BUFFER_SPACE:\n\t\treturn \"insufficient buffer space\";\n\tcase SSH_ERR_INVALID_ARGUMENT:\n\t\treturn \"invalid argument\";\n\tcase SSH_ERR_KEY_BITS_MISMATCH:\n\t\treturn \"key bits do not match\";\n\tcase SSH_ERR_EC_CURVE_INVALID:\n\t\treturn \"invalid elliptic curve\";\n\tcase SSH_ERR_KEY_TYPE_MISMATCH:\n\t\treturn \"key type does not match\";\n\tcase SSH_ERR_KEY_TYPE_UNKNOWN:\n\t\treturn \"unknown or unsupported key type\";\n\tcase SSH_ERR_EC_CURVE_MISMATCH:\n\t\treturn \"elliptic curve does not match\";\n\tcase SSH_ERR_EXPECTED_CERT:\n\t\treturn \"plain key provided where certificate required\";\n\tcase SSH_ERR_KEY_LACKS_CERTBLOB:\n\t\treturn \"key lacks certificate data\";\n\tcase SSH_ERR_KEY_CERT_UNKNOWN_TYPE:\n\t\treturn \"unknown/unsupported certificate type\";\n\tcase SSH_ERR_KEY_CERT_INVALID_SIGN_KEY:\n\t\treturn \"invalid certificate signing key\";\n\tcase SSH_ERR_KEY_INVALID_EC_VALUE:\n\t\treturn \"invalid elliptic curve value\";\n\tcase SSH_ERR_SIGNATURE_INVALID:\n\t\treturn \"incorrect signature\";\n\tcase SSH_ERR_LIBCRYPTO_ERROR:\n\t\treturn \"error in libcrypto\";  /* XXX fetch and return */\n\tcase SSH_ERR_UNEXPECTED_TRAILING_DATA:\n\t\treturn \"unexpected bytes remain after decoding\";\n\tcase SSH_ERR_SYSTEM_ERROR:\n\t\treturn strerror(errno);\n\tcase SSH_ERR_KEY_CERT_INVALID:\n\t\treturn \"invalid certificate\";\n\tcase SSH_ERR_AGENT_COMMUNICATION:\n\t\treturn \"communication with agent failed\";\n\tcase SSH_ERR_AGENT_FAILURE:\n\t\treturn \"agent refused operation\";\n\tcase SSH_ERR_DH_GEX_OUT_OF_RANGE:\n\t\treturn \"DH GEX group out of range\";\n\tcase SSH_ERR_DISCONNECTED:\n\t\treturn \"disconnected\";\n\tcase SSH_ERR_MAC_INVALID:\n\t\treturn \"message authentication code incorrect\";\n\tcase SSH_ERR_NO_CIPHER_ALG_MATCH:\n\t\treturn \"no matching cipher found\";\n\tcase SSH_ERR_NO_MAC_ALG_MATCH:\n\t\treturn \"no matching MAC found\";\n\tcase SSH_ERR_NO_COMPRESS_ALG_MATCH:\n\t\treturn \"no matching compression method found\";\n\tcase SSH_ERR_NO_KEX_ALG_MATCH:\n\t\treturn \"no matching key exchange method found\";\n\tcase SSH_ERR_NO_HOSTKEY_ALG_MATCH:\n\t\treturn \"no matching host key type found\";\n\tcase SSH_ERR_PROTOCOL_MISMATCH:\n\t\treturn \"protocol version mismatch\";\n\tcase SSH_ERR_NO_PROTOCOL_VERSION:\n\t\treturn \"could not read protocol version\";\n\tcase SSH_ERR_NO_HOSTKEY_LOADED:\n\t\treturn \"could not load host key\";\n\tcase SSH_ERR_NEED_REKEY:\n\t\treturn \"rekeying not supported by peer\";\n\tcase SSH_ERR_PASSPHRASE_TOO_SHORT:\n\t\treturn \"passphrase is too short (minimum five characters)\";\n\tcase SSH_ERR_FILE_CHANGED:\n\t\treturn \"file changed while reading\";\n\tcase SSH_ERR_KEY_UNKNOWN_CIPHER:\n\t\treturn \"key encrypted using unsupported cipher\";\n\tcase SSH_ERR_KEY_WRONG_PASSPHRASE:\n\t\treturn \"incorrect passphrase supplied to decrypt private key\";\n\tcase SSH_ERR_KEY_BAD_PERMISSIONS:\n\t\treturn \"bad permissions\";\n\tcase SSH_ERR_KEY_CERT_MISMATCH:\n\t\treturn \"certificate does not match key\";\n\tcase SSH_ERR_KEY_NOT_FOUND:\n\t\treturn \"key not found\";\n\tcase SSH_ERR_AGENT_NOT_PRESENT:\n\t\treturn \"agent not present\";\n\tcase SSH_ERR_AGENT_NO_IDENTITIES:\n\t\treturn \"agent contains no identities\";\n\tcase SSH_ERR_BUFFER_READ_ONLY:\n\t\treturn \"internal error: buffer is read-only\";\n\tcase SSH_ERR_KRL_BAD_MAGIC:\n\t\treturn \"KRL file has invalid magic number\";\n\tcase SSH_ERR_KEY_REVOKED:\n\t\treturn \"Key is revoked\";\n\tcase SSH_ERR_CONN_CLOSED:\n\t\treturn \"Connection closed\";\n\tcase SSH_ERR_CONN_TIMEOUT:\n\t\treturn \"Connection timed out\";\n\tcase SSH_ERR_CONN_CORRUPT:\n\t\treturn \"Connection corrupted\";\n\tcase SSH_ERR_PROTOCOL_ERROR:\n\t\treturn \"Protocol error\";\n\tcase SSH_ERR_KEY_LENGTH:\n\t\treturn \"Invalid key length\";\n\tcase SSH_ERR_NUMBER_TOO_LARGE:\n\t\treturn \"number is too large\";\n\tcase SSH_ERR_SIGN_ALG_UNSUPPORTED:\n\t\treturn \"signature algorithm not supported\";\n\tdefault:\n\t\treturn \"unknown error\";\n\t}\n}",
          "includes": [
            "#include \"ssherr.h\"",
            "#include <string.h>",
            "#include <errno.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"ssherr.h\"\n#include <string.h>\n#include <errno.h>\n\nconst char *\nssh_err(int n)\n{\n\tswitch (n) {\n\tcase SSH_ERR_SUCCESS:\n\t\treturn \"success\";\n\tcase SSH_ERR_INTERNAL_ERROR:\n\t\treturn \"unexpected internal error\";\n\tcase SSH_ERR_ALLOC_FAIL:\n\t\treturn \"memory allocation failed\";\n\tcase SSH_ERR_MESSAGE_INCOMPLETE:\n\t\treturn \"incomplete message\";\n\tcase SSH_ERR_INVALID_FORMAT:\n\t\treturn \"invalid format\";\n\tcase SSH_ERR_BIGNUM_IS_NEGATIVE:\n\t\treturn \"bignum is negative\";\n\tcase SSH_ERR_STRING_TOO_LARGE:\n\t\treturn \"string is too large\";\n\tcase SSH_ERR_BIGNUM_TOO_LARGE:\n\t\treturn \"bignum is too large\";\n\tcase SSH_ERR_ECPOINT_TOO_LARGE:\n\t\treturn \"elliptic curve point is too large\";\n\tcase SSH_ERR_NO_BUFFER_SPACE:\n\t\treturn \"insufficient buffer space\";\n\tcase SSH_ERR_INVALID_ARGUMENT:\n\t\treturn \"invalid argument\";\n\tcase SSH_ERR_KEY_BITS_MISMATCH:\n\t\treturn \"key bits do not match\";\n\tcase SSH_ERR_EC_CURVE_INVALID:\n\t\treturn \"invalid elliptic curve\";\n\tcase SSH_ERR_KEY_TYPE_MISMATCH:\n\t\treturn \"key type does not match\";\n\tcase SSH_ERR_KEY_TYPE_UNKNOWN:\n\t\treturn \"unknown or unsupported key type\";\n\tcase SSH_ERR_EC_CURVE_MISMATCH:\n\t\treturn \"elliptic curve does not match\";\n\tcase SSH_ERR_EXPECTED_CERT:\n\t\treturn \"plain key provided where certificate required\";\n\tcase SSH_ERR_KEY_LACKS_CERTBLOB:\n\t\treturn \"key lacks certificate data\";\n\tcase SSH_ERR_KEY_CERT_UNKNOWN_TYPE:\n\t\treturn \"unknown/unsupported certificate type\";\n\tcase SSH_ERR_KEY_CERT_INVALID_SIGN_KEY:\n\t\treturn \"invalid certificate signing key\";\n\tcase SSH_ERR_KEY_INVALID_EC_VALUE:\n\t\treturn \"invalid elliptic curve value\";\n\tcase SSH_ERR_SIGNATURE_INVALID:\n\t\treturn \"incorrect signature\";\n\tcase SSH_ERR_LIBCRYPTO_ERROR:\n\t\treturn \"error in libcrypto\";  /* XXX fetch and return */\n\tcase SSH_ERR_UNEXPECTED_TRAILING_DATA:\n\t\treturn \"unexpected bytes remain after decoding\";\n\tcase SSH_ERR_SYSTEM_ERROR:\n\t\treturn strerror(errno);\n\tcase SSH_ERR_KEY_CERT_INVALID:\n\t\treturn \"invalid certificate\";\n\tcase SSH_ERR_AGENT_COMMUNICATION:\n\t\treturn \"communication with agent failed\";\n\tcase SSH_ERR_AGENT_FAILURE:\n\t\treturn \"agent refused operation\";\n\tcase SSH_ERR_DH_GEX_OUT_OF_RANGE:\n\t\treturn \"DH GEX group out of range\";\n\tcase SSH_ERR_DISCONNECTED:\n\t\treturn \"disconnected\";\n\tcase SSH_ERR_MAC_INVALID:\n\t\treturn \"message authentication code incorrect\";\n\tcase SSH_ERR_NO_CIPHER_ALG_MATCH:\n\t\treturn \"no matching cipher found\";\n\tcase SSH_ERR_NO_MAC_ALG_MATCH:\n\t\treturn \"no matching MAC found\";\n\tcase SSH_ERR_NO_COMPRESS_ALG_MATCH:\n\t\treturn \"no matching compression method found\";\n\tcase SSH_ERR_NO_KEX_ALG_MATCH:\n\t\treturn \"no matching key exchange method found\";\n\tcase SSH_ERR_NO_HOSTKEY_ALG_MATCH:\n\t\treturn \"no matching host key type found\";\n\tcase SSH_ERR_PROTOCOL_MISMATCH:\n\t\treturn \"protocol version mismatch\";\n\tcase SSH_ERR_NO_PROTOCOL_VERSION:\n\t\treturn \"could not read protocol version\";\n\tcase SSH_ERR_NO_HOSTKEY_LOADED:\n\t\treturn \"could not load host key\";\n\tcase SSH_ERR_NEED_REKEY:\n\t\treturn \"rekeying not supported by peer\";\n\tcase SSH_ERR_PASSPHRASE_TOO_SHORT:\n\t\treturn \"passphrase is too short (minimum five characters)\";\n\tcase SSH_ERR_FILE_CHANGED:\n\t\treturn \"file changed while reading\";\n\tcase SSH_ERR_KEY_UNKNOWN_CIPHER:\n\t\treturn \"key encrypted using unsupported cipher\";\n\tcase SSH_ERR_KEY_WRONG_PASSPHRASE:\n\t\treturn \"incorrect passphrase supplied to decrypt private key\";\n\tcase SSH_ERR_KEY_BAD_PERMISSIONS:\n\t\treturn \"bad permissions\";\n\tcase SSH_ERR_KEY_CERT_MISMATCH:\n\t\treturn \"certificate does not match key\";\n\tcase SSH_ERR_KEY_NOT_FOUND:\n\t\treturn \"key not found\";\n\tcase SSH_ERR_AGENT_NOT_PRESENT:\n\t\treturn \"agent not present\";\n\tcase SSH_ERR_AGENT_NO_IDENTITIES:\n\t\treturn \"agent contains no identities\";\n\tcase SSH_ERR_BUFFER_READ_ONLY:\n\t\treturn \"internal error: buffer is read-only\";\n\tcase SSH_ERR_KRL_BAD_MAGIC:\n\t\treturn \"KRL file has invalid magic number\";\n\tcase SSH_ERR_KEY_REVOKED:\n\t\treturn \"Key is revoked\";\n\tcase SSH_ERR_CONN_CLOSED:\n\t\treturn \"Connection closed\";\n\tcase SSH_ERR_CONN_TIMEOUT:\n\t\treturn \"Connection timed out\";\n\tcase SSH_ERR_CONN_CORRUPT:\n\t\treturn \"Connection corrupted\";\n\tcase SSH_ERR_PROTOCOL_ERROR:\n\t\treturn \"Protocol error\";\n\tcase SSH_ERR_KEY_LENGTH:\n\t\treturn \"Invalid key length\";\n\tcase SSH_ERR_NUMBER_TOO_LARGE:\n\t\treturn \"number is too large\";\n\tcase SSH_ERR_SIGN_ALG_UNSUPPORTED:\n\t\treturn \"signature algorithm not supported\";\n\tdefault:\n\t\treturn \"unknown error\";\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "ssh_packet_write_wait",
          "args": [
            "ssh"
          ],
          "line": 1792
        },
        "resolved": true,
        "details": {
          "function_name": "ssh_packet_write_wait",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
          "lines": "1930-1985",
          "snippet": "int\nssh_packet_write_wait(struct ssh *ssh)\n{\n\tfd_set *setp;\n\tint ret, r, ms_remain = 0;\n\tstruct timeval start, timeout, *timeoutp = NULL;\n\tstruct session_state *state = ssh->state;\n\n\tsetp = calloc(howmany(state->connection_out + 1,\n\t    NFDBITS), sizeof(fd_mask));\n\tif (setp == NULL)\n\t\treturn SSH_ERR_ALLOC_FAIL;\n\tif ((r = ssh_packet_write_poll(ssh)) != 0) {\n\t\tfree(setp);\n\t\treturn r;\n\t}\n\twhile (ssh_packet_have_data_to_write(ssh)) {\n\t\tmemset(setp, 0, howmany(state->connection_out + 1,\n\t\t    NFDBITS) * sizeof(fd_mask));\n\t\tFD_SET(state->connection_out, setp);\n\n\t\tif (state->packet_timeout_ms > 0) {\n\t\t\tms_remain = state->packet_timeout_ms;\n\t\t\ttimeoutp = &timeout;\n\t\t}\n\t\tfor (;;) {\n\t\t\tif (state->packet_timeout_ms != -1) {\n\t\t\t\tms_to_timeval(&timeout, ms_remain);\n\t\t\t\tmonotime_tv(&start);\n\t\t\t}\n\t\t\tif ((ret = select(state->connection_out + 1,\n\t\t\t    NULL, setp, NULL, timeoutp)) >= 0)\n\t\t\t\tbreak;\n\t\t\tif (errno != EAGAIN && errno != EINTR &&\n\t\t\t    errno != EWOULDBLOCK)\n\t\t\t\tbreak;\n\t\t\tif (state->packet_timeout_ms == -1)\n\t\t\t\tcontinue;\n\t\t\tms_subtract_diff(&start, &ms_remain);\n\t\t\tif (ms_remain <= 0) {\n\t\t\t\tret = 0;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tif (ret == 0) {\n\t\t\tfree(setp);\n\t\t\treturn SSH_ERR_CONN_TIMEOUT;\n\t\t}\n\t\tif ((r = ssh_packet_write_poll(ssh)) != 0) {\n\t\t\tfree(setp);\n\t\t\treturn r;\n\t\t}\n\t}\n\tfree(setp);\n\treturn 0;\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include \"packet.h\"",
            "#include \"ssh.h\"",
            "#include \"channels.h\"",
            "#include \"misc.h\"",
            "#include \"canohost.h\"",
            "#include \"log.h\"",
            "#include \"mac.h\"",
            "#include \"digest.h\"",
            "#include \"kex.h\"",
            "#include \"sshkey.h\"",
            "#include \"cipher.h\"",
            "#include \"ssh2.h\"",
            "#include \"compat.h\"",
            "#include \"crc32.h\"",
            "#include \"xmalloc.h\"",
            "#include <zlib.h>",
            "#  include <openssl/ec.h>",
            "# include <openssl/evp.h>",
            "# include <openssl/bn.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <limits.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <netdb.h>",
            "#include <errno.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include \"openbsd-compat/sys-queue.h\"",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nssh_packet_write_wait(struct ssh *ssh)\n{\n\tfd_set *setp;\n\tint ret, r, ms_remain = 0;\n\tstruct timeval start, timeout, *timeoutp = NULL;\n\tstruct session_state *state = ssh->state;\n\n\tsetp = calloc(howmany(state->connection_out + 1,\n\t    NFDBITS), sizeof(fd_mask));\n\tif (setp == NULL)\n\t\treturn SSH_ERR_ALLOC_FAIL;\n\tif ((r = ssh_packet_write_poll(ssh)) != 0) {\n\t\tfree(setp);\n\t\treturn r;\n\t}\n\twhile (ssh_packet_have_data_to_write(ssh)) {\n\t\tmemset(setp, 0, howmany(state->connection_out + 1,\n\t\t    NFDBITS) * sizeof(fd_mask));\n\t\tFD_SET(state->connection_out, setp);\n\n\t\tif (state->packet_timeout_ms > 0) {\n\t\t\tms_remain = state->packet_timeout_ms;\n\t\t\ttimeoutp = &timeout;\n\t\t}\n\t\tfor (;;) {\n\t\t\tif (state->packet_timeout_ms != -1) {\n\t\t\t\tms_to_timeval(&timeout, ms_remain);\n\t\t\t\tmonotime_tv(&start);\n\t\t\t}\n\t\t\tif ((ret = select(state->connection_out + 1,\n\t\t\t    NULL, setp, NULL, timeoutp)) >= 0)\n\t\t\t\tbreak;\n\t\t\tif (errno != EAGAIN && errno != EINTR &&\n\t\t\t    errno != EWOULDBLOCK)\n\t\t\t\tbreak;\n\t\t\tif (state->packet_timeout_ms == -1)\n\t\t\t\tcontinue;\n\t\t\tms_subtract_diff(&start, &ms_remain);\n\t\t\tif (ms_remain <= 0) {\n\t\t\t\tret = 0;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tif (ret == 0) {\n\t\t\tfree(setp);\n\t\t\treturn SSH_ERR_CONN_TIMEOUT;\n\t\t}\n\t\tif ((r = ssh_packet_write_poll(ssh)) != 0) {\n\t\t\tfree(setp);\n\t\t\treturn r;\n\t\t}\n\t}\n\tfree(setp);\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "sshpkt_send",
          "args": [
            "ssh"
          ],
          "line": 1791
        },
        "resolved": true,
        "details": {
          "function_name": "sshpkt_send",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
          "lines": "2648-2654",
          "snippet": "int\nsshpkt_send(struct ssh *ssh)\n{\n\tif (ssh->state && ssh->state->mux)\n\t\treturn ssh_packet_send_mux(ssh);\n\treturn ssh_packet_send2(ssh);\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include \"packet.h\"",
            "#include \"ssh.h\"",
            "#include \"channels.h\"",
            "#include \"misc.h\"",
            "#include \"canohost.h\"",
            "#include \"log.h\"",
            "#include \"mac.h\"",
            "#include \"digest.h\"",
            "#include \"kex.h\"",
            "#include \"sshkey.h\"",
            "#include \"cipher.h\"",
            "#include \"ssh2.h\"",
            "#include \"compat.h\"",
            "#include \"crc32.h\"",
            "#include \"xmalloc.h\"",
            "#include <zlib.h>",
            "#  include <openssl/ec.h>",
            "# include <openssl/evp.h>",
            "# include <openssl/bn.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <limits.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <netdb.h>",
            "#include <errno.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include \"openbsd-compat/sys-queue.h\"",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshpkt_send(struct ssh *ssh)\n{\n\tif (ssh->state && ssh->state->mux)\n\t\treturn ssh_packet_send_mux(ssh);\n\treturn ssh_packet_send2(ssh);\n}"
        }
      },
      {
        "call_info": {
          "callee": "sshpkt_put_cstring",
          "args": [
            "ssh",
            "\"\""
          ],
          "line": 1790
        },
        "resolved": true,
        "details": {
          "function_name": "sshpkt_put_cstring",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
          "lines": "2459-2463",
          "snippet": "int\nsshpkt_put_cstring(struct ssh *ssh, const void *v)\n{\n\treturn sshbuf_put_cstring(ssh->state->outgoing_packet, v);\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include \"packet.h\"",
            "#include \"ssh.h\"",
            "#include \"channels.h\"",
            "#include \"misc.h\"",
            "#include \"canohost.h\"",
            "#include \"log.h\"",
            "#include \"mac.h\"",
            "#include \"digest.h\"",
            "#include \"kex.h\"",
            "#include \"sshkey.h\"",
            "#include \"cipher.h\"",
            "#include \"ssh2.h\"",
            "#include \"compat.h\"",
            "#include \"crc32.h\"",
            "#include \"xmalloc.h\"",
            "#include <zlib.h>",
            "#  include <openssl/ec.h>",
            "# include <openssl/evp.h>",
            "# include <openssl/bn.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <limits.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <netdb.h>",
            "#include <errno.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include \"openbsd-compat/sys-queue.h\"",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshpkt_put_cstring(struct ssh *ssh, const void *v)\n{\n\treturn sshbuf_put_cstring(ssh->state->outgoing_packet, v);\n}"
        }
      },
      {
        "call_info": {
          "callee": "sshpkt_put_u8",
          "args": [
            "ssh",
            "0"
          ],
          "line": 1788
        },
        "resolved": true,
        "details": {
          "function_name": "sshpkt_put_u8",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
          "lines": "2435-2439",
          "snippet": "int\nsshpkt_put_u8(struct ssh *ssh, u_char val)\n{\n\treturn sshbuf_put_u8(ssh->state->outgoing_packet, val);\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include \"packet.h\"",
            "#include \"ssh.h\"",
            "#include \"channels.h\"",
            "#include \"misc.h\"",
            "#include \"canohost.h\"",
            "#include \"log.h\"",
            "#include \"mac.h\"",
            "#include \"digest.h\"",
            "#include \"kex.h\"",
            "#include \"sshkey.h\"",
            "#include \"cipher.h\"",
            "#include \"ssh2.h\"",
            "#include \"compat.h\"",
            "#include \"crc32.h\"",
            "#include \"xmalloc.h\"",
            "#include <zlib.h>",
            "#  include <openssl/ec.h>",
            "# include <openssl/evp.h>",
            "# include <openssl/bn.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <limits.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <netdb.h>",
            "#include <errno.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include \"openbsd-compat/sys-queue.h\"",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshpkt_put_u8(struct ssh *ssh, u_char val)\n{\n\treturn sshbuf_put_u8(ssh->state->outgoing_packet, val);\n}"
        }
      },
      {
        "call_info": {
          "callee": "sshpkt_start",
          "args": [
            "ssh",
            "SSH2_MSG_DEBUG"
          ],
          "line": 1787
        },
        "resolved": true,
        "details": {
          "function_name": "sshpkt_start",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
          "lines": "2573-2583",
          "snippet": "int\nsshpkt_start(struct ssh *ssh, u_char type)\n{\n\tu_char buf[6]; /* u32 packet length, u8 pad len, u8 type */\n\n\tDBG(debug(\"packet_start[%d]\", type));\n\tmemset(buf, 0, sizeof(buf));\n\tbuf[sizeof(buf) - 1] = type;\n\tsshbuf_reset(ssh->state->outgoing_packet);\n\treturn sshbuf_put(ssh->state->outgoing_packet, buf, sizeof(buf));\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include \"packet.h\"",
            "#include \"ssh.h\"",
            "#include \"channels.h\"",
            "#include \"misc.h\"",
            "#include \"canohost.h\"",
            "#include \"log.h\"",
            "#include \"mac.h\"",
            "#include \"digest.h\"",
            "#include \"kex.h\"",
            "#include \"sshkey.h\"",
            "#include \"cipher.h\"",
            "#include \"ssh2.h\"",
            "#include \"compat.h\"",
            "#include \"crc32.h\"",
            "#include \"xmalloc.h\"",
            "#include <zlib.h>",
            "#  include <openssl/ec.h>",
            "# include <openssl/evp.h>",
            "# include <openssl/bn.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <limits.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <netdb.h>",
            "#include <errno.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include \"openbsd-compat/sys-queue.h\"",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshpkt_start(struct ssh *ssh, u_char type)\n{\n\tu_char buf[6]; /* u32 packet length, u8 pad len, u8 type */\n\n\tDBG(debug(\"packet_start[%d]\", type));\n\tmemset(buf, 0, sizeof(buf));\n\tbuf[sizeof(buf) - 1] = type;\n\tsshbuf_reset(ssh->state->outgoing_packet);\n\treturn sshbuf_put(ssh->state->outgoing_packet, buf, sizeof(buf));\n}"
        }
      },
      {
        "call_info": {
          "callee": "debug3",
          "args": [
            "\"sending debug message: %s\"",
            "buf"
          ],
          "line": 1785
        },
        "resolved": true,
        "details": {
          "function_name": "debug3",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/log.c",
          "lines": "242-250",
          "snippet": "void\ndebug3(const char *fmt,...)\n{\n\tva_list args;\n\n\tva_start(args, fmt);\n\tdo_log(SYSLOG_LEVEL_DEBUG3, fmt, args);\n\tva_end(args);\n}",
          "includes": [
            "#include \"log.h\"",
            "# include <vis.h>",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <syslog.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <fcntl.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n# include <vis.h>\n#include <errno.h>\n#include <unistd.h>\n#include <syslog.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <fcntl.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\ndebug3(const char *fmt,...)\n{\n\tva_list args;\n\n\tva_start(args, fmt);\n\tdo_log(SYSLOG_LEVEL_DEBUG3, fmt, args);\n\tva_end(args);\n}"
        }
      },
      {
        "call_info": {
          "callee": "va_end",
          "args": [
            "args"
          ],
          "line": 1783
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "vsnprintf",
          "args": [
            "buf",
            "sizeof(buf)",
            "fmt",
            "args"
          ],
          "line": 1782
        },
        "resolved": true,
        "details": {
          "function_name": "vsnprintf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/openbsd-compat/bsd-snprintf.c",
          "lines": "861-865",
          "snippet": "int\nvsnprintf (char *str, size_t count, const char *fmt, va_list args)\n{\n\treturn dopr(str, count, fmt, args);\n}",
          "includes": [
            "#include <errno.h>",
            "#include <limits.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdarg.h>",
            "#include <ctype.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <errno.h>\n#include <limits.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdarg.h>\n#include <ctype.h>\n#include \"includes.h\"\n\nint\nvsnprintf (char *str, size_t count, const char *fmt, va_list args)\n{\n\treturn dopr(str, count, fmt, args);\n}"
        }
      },
      {
        "call_info": {
          "callee": "va_start",
          "args": [
            "args",
            "fmt"
          ],
          "line": 1781
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\nssh_packet_send_debug(struct ssh *ssh, const char *fmt,...)\n{\n\tchar buf[1024];\n\tva_list args;\n\tint r;\n\n\tif ((ssh->compat & SSH_BUG_DEBUG))\n\t\treturn;\n\n\tva_start(args, fmt);\n\tvsnprintf(buf, sizeof(buf), fmt, args);\n\tva_end(args);\n\n\tdebug3(\"sending debug message: %s\", buf);\n\n\tif ((r = sshpkt_start(ssh, SSH2_MSG_DEBUG)) != 0 ||\n\t    (r = sshpkt_put_u8(ssh, 0)) != 0 || /* always display */\n\t    (r = sshpkt_put_cstring(ssh, buf)) != 0 ||\n\t    (r = sshpkt_put_cstring(ssh, \"\")) != 0 ||\n\t    (r = sshpkt_send(ssh)) != 0 ||\n\t    (r = ssh_packet_write_wait(ssh)) != 0)\n\t\tfatal(\"%s: %s\", __func__, ssh_err(r));\n}"
  },
  {
    "function_name": "ssh_packet_remaining",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
    "lines": "1757-1761",
    "snippet": "int\nssh_packet_remaining(struct ssh *ssh)\n{\n\treturn sshbuf_len(ssh->state->incoming_packet);\n}",
    "includes": [
      "#include \"sshbuf.h\"",
      "#include \"ssherr.h\"",
      "#include \"packet.h\"",
      "#include \"ssh.h\"",
      "#include \"channels.h\"",
      "#include \"misc.h\"",
      "#include \"canohost.h\"",
      "#include \"log.h\"",
      "#include \"mac.h\"",
      "#include \"digest.h\"",
      "#include \"kex.h\"",
      "#include \"sshkey.h\"",
      "#include \"cipher.h\"",
      "#include \"ssh2.h\"",
      "#include \"compat.h\"",
      "#include \"crc32.h\"",
      "#include \"xmalloc.h\"",
      "#include <zlib.h>",
      "#  include <openssl/ec.h>",
      "# include <openssl/evp.h>",
      "# include <openssl/bn.h>",
      "#include <time.h>",
      "#include <signal.h>",
      "#include <limits.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <stdarg.h>",
      "#include <netdb.h>",
      "#include <errno.h>",
      "#include <arpa/inet.h>",
      "#include <netinet/ip.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include \"openbsd-compat/sys-queue.h\"",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "sshbuf_len",
          "args": [
            "ssh->state->incoming_packet"
          ],
          "line": 1760
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_len",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf.c",
          "lines": "252-258",
          "snippet": "size_t\nsshbuf_len(const struct sshbuf *buf)\n{\n\tif (sshbuf_check_sanity(buf) != 0)\n\t\treturn 0;\n\treturn buf->size - buf->off;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <signal.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <signal.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nsize_t\nsshbuf_len(const struct sshbuf *buf)\n{\n\tif (sshbuf_check_sanity(buf) != 0)\n\t\treturn 0;\n\treturn buf->size - buf->off;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nssh_packet_remaining(struct ssh *ssh)\n{\n\treturn sshbuf_len(ssh->state->incoming_packet);\n}"
  },
  {
    "function_name": "ssh_packet_process_incoming",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
    "lines": "1736-1755",
    "snippet": "int\nssh_packet_process_incoming(struct ssh *ssh, const char *buf, u_int len)\n{\n\tstruct session_state *state = ssh->state;\n\tint r;\n\n\tif (state->packet_discard) {\n\t\tstate->keep_alive_timeouts = 0; /* ?? */\n\t\tif (len >= state->packet_discard) {\n\t\t\tif ((r = ssh_packet_stop_discard(ssh)) != 0)\n\t\t\t\treturn r;\n\t\t}\n\t\tstate->packet_discard -= len;\n\t\treturn 0;\n\t}\n\tif ((r = sshbuf_put(ssh->state->input, buf, len)) != 0)\n\t\treturn r;\n\n\treturn 0;\n}",
    "includes": [
      "#include \"sshbuf.h\"",
      "#include \"ssherr.h\"",
      "#include \"packet.h\"",
      "#include \"ssh.h\"",
      "#include \"channels.h\"",
      "#include \"misc.h\"",
      "#include \"canohost.h\"",
      "#include \"log.h\"",
      "#include \"mac.h\"",
      "#include \"digest.h\"",
      "#include \"kex.h\"",
      "#include \"sshkey.h\"",
      "#include \"cipher.h\"",
      "#include \"ssh2.h\"",
      "#include \"compat.h\"",
      "#include \"crc32.h\"",
      "#include \"xmalloc.h\"",
      "#include <zlib.h>",
      "#  include <openssl/ec.h>",
      "# include <openssl/evp.h>",
      "# include <openssl/bn.h>",
      "#include <time.h>",
      "#include <signal.h>",
      "#include <limits.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <stdarg.h>",
      "#include <netdb.h>",
      "#include <errno.h>",
      "#include <arpa/inet.h>",
      "#include <netinet/ip.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include \"openbsd-compat/sys-queue.h\"",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "sshbuf_put",
          "args": [
            "ssh->state->input",
            "buf",
            "len"
          ],
          "line": 1751
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_putf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf-getput-basic.c",
          "lines": "254-264",
          "snippet": "int\nsshbuf_putf(struct sshbuf *buf, const char *fmt, ...)\n{\n\tva_list ap;\n\tint r;\n\n\tva_start(ap, fmt);\n\tr = sshbuf_putfv(buf, fmt, ap);\n\tva_end(ap);\n\treturn r;\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <stdarg.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <stdarg.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshbuf_putf(struct sshbuf *buf, const char *fmt, ...)\n{\n\tva_list ap;\n\tint r;\n\n\tva_start(ap, fmt);\n\tr = sshbuf_putfv(buf, fmt, ap);\n\tva_end(ap);\n\treturn r;\n}"
        }
      },
      {
        "call_info": {
          "callee": "ssh_packet_stop_discard",
          "args": [
            "ssh"
          ],
          "line": 1745
        },
        "resolved": true,
        "details": {
          "function_name": "ssh_packet_stop_discard",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
          "lines": "366-391",
          "snippet": "int\nssh_packet_stop_discard(struct ssh *ssh)\n{\n\tstruct session_state *state = ssh->state;\n\tint r;\n\n\tif (state->packet_discard_mac) {\n\t\tchar buf[1024];\n\t\tsize_t dlen = PACKET_MAX_SIZE;\n\n\t\tif (dlen > state->packet_discard_mac_already)\n\t\t\tdlen -= state->packet_discard_mac_already;\n\t\tmemset(buf, 'a', sizeof(buf));\n\t\twhile (sshbuf_len(state->incoming_packet) < dlen)\n\t\t\tif ((r = sshbuf_put(state->incoming_packet, buf,\n\t\t\t    sizeof(buf))) != 0)\n\t\t\t\treturn r;\n\t\t(void) mac_compute(state->packet_discard_mac,\n\t\t    state->p_read.seqnr,\n\t\t    sshbuf_ptr(state->incoming_packet), dlen,\n\t\t    NULL, 0);\n\t}\n\tlogit(\"Finished discarding for %.200s port %d\",\n\t    ssh_remote_ipaddr(ssh), ssh_remote_port(ssh));\n\treturn SSH_ERR_MAC_INVALID;\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include \"packet.h\"",
            "#include \"ssh.h\"",
            "#include \"channels.h\"",
            "#include \"misc.h\"",
            "#include \"canohost.h\"",
            "#include \"log.h\"",
            "#include \"mac.h\"",
            "#include \"digest.h\"",
            "#include \"kex.h\"",
            "#include \"sshkey.h\"",
            "#include \"cipher.h\"",
            "#include \"ssh2.h\"",
            "#include \"compat.h\"",
            "#include \"crc32.h\"",
            "#include \"xmalloc.h\"",
            "#include <zlib.h>",
            "#  include <openssl/ec.h>",
            "# include <openssl/evp.h>",
            "# include <openssl/bn.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <limits.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <netdb.h>",
            "#include <errno.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include \"openbsd-compat/sys-queue.h\"",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [
            "#define PACKET_MAX_SIZE (256 * 1024)"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\n#define PACKET_MAX_SIZE (256 * 1024)\n\nint\nssh_packet_stop_discard(struct ssh *ssh)\n{\n\tstruct session_state *state = ssh->state;\n\tint r;\n\n\tif (state->packet_discard_mac) {\n\t\tchar buf[1024];\n\t\tsize_t dlen = PACKET_MAX_SIZE;\n\n\t\tif (dlen > state->packet_discard_mac_already)\n\t\t\tdlen -= state->packet_discard_mac_already;\n\t\tmemset(buf, 'a', sizeof(buf));\n\t\twhile (sshbuf_len(state->incoming_packet) < dlen)\n\t\t\tif ((r = sshbuf_put(state->incoming_packet, buf,\n\t\t\t    sizeof(buf))) != 0)\n\t\t\t\treturn r;\n\t\t(void) mac_compute(state->packet_discard_mac,\n\t\t    state->p_read.seqnr,\n\t\t    sshbuf_ptr(state->incoming_packet), dlen,\n\t\t    NULL, 0);\n\t}\n\tlogit(\"Finished discarding for %.200s port %d\",\n\t    ssh_remote_ipaddr(ssh), ssh_remote_port(ssh));\n\treturn SSH_ERR_MAC_INVALID;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nssh_packet_process_incoming(struct ssh *ssh, const char *buf, u_int len)\n{\n\tstruct session_state *state = ssh->state;\n\tint r;\n\n\tif (state->packet_discard) {\n\t\tstate->keep_alive_timeouts = 0; /* ?? */\n\t\tif (len >= state->packet_discard) {\n\t\t\tif ((r = ssh_packet_stop_discard(ssh)) != 0)\n\t\t\t\treturn r;\n\t\t}\n\t\tstate->packet_discard -= len;\n\t\treturn 0;\n\t}\n\tif ((r = sshbuf_put(ssh->state->input, buf, len)) != 0)\n\t\treturn r;\n\n\treturn 0;\n}"
  },
  {
    "function_name": "ssh_packet_read_poll_seqnr",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
    "lines": "1675-1729",
    "snippet": "int\nssh_packet_read_poll_seqnr(struct ssh *ssh, u_char *typep, u_int32_t *seqnr_p)\n{\n\tstruct session_state *state = ssh->state;\n\tu_int reason, seqnr;\n\tint r;\n\tu_char *msg;\n\n\tfor (;;) {\n\t\tmsg = NULL;\n\t\tr = ssh_packet_read_poll2(ssh, typep, seqnr_p);\n\t\tif (r != 0)\n\t\t\treturn r;\n\t\tif (*typep) {\n\t\t\tstate->keep_alive_timeouts = 0;\n\t\t\tDBG(debug(\"received packet type %d\", *typep));\n\t\t}\n\t\tswitch (*typep) {\n\t\tcase SSH2_MSG_IGNORE:\n\t\t\tdebug3(\"Received SSH2_MSG_IGNORE\");\n\t\t\tbreak;\n\t\tcase SSH2_MSG_DEBUG:\n\t\t\tif ((r = sshpkt_get_u8(ssh, NULL)) != 0 ||\n\t\t\t    (r = sshpkt_get_string(ssh, &msg, NULL)) != 0 ||\n\t\t\t    (r = sshpkt_get_string(ssh, NULL, NULL)) != 0) {\n\t\t\t\tfree(msg);\n\t\t\t\treturn r;\n\t\t\t}\n\t\t\tdebug(\"Remote: %.900s\", msg);\n\t\t\tfree(msg);\n\t\t\tbreak;\n\t\tcase SSH2_MSG_DISCONNECT:\n\t\t\tif ((r = sshpkt_get_u32(ssh, &reason)) != 0 ||\n\t\t\t    (r = sshpkt_get_string(ssh, &msg, NULL)) != 0)\n\t\t\t\treturn r;\n\t\t\t/* Ignore normal client exit notifications */\n\t\t\tdo_log2(ssh->state->server_side &&\n\t\t\t    reason == SSH2_DISCONNECT_BY_APPLICATION ?\n\t\t\t    SYSLOG_LEVEL_INFO : SYSLOG_LEVEL_ERROR,\n\t\t\t    \"Received disconnect from %s port %d:\"\n\t\t\t    \"%u: %.400s\", ssh_remote_ipaddr(ssh),\n\t\t\t    ssh_remote_port(ssh), reason, msg);\n\t\t\tfree(msg);\n\t\t\treturn SSH_ERR_DISCONNECTED;\n\t\tcase SSH2_MSG_UNIMPLEMENTED:\n\t\t\tif ((r = sshpkt_get_u32(ssh, &seqnr)) != 0)\n\t\t\t\treturn r;\n\t\t\tdebug(\"Received SSH2_MSG_UNIMPLEMENTED for %u\",\n\t\t\t    seqnr);\n\t\t\tbreak;\n\t\tdefault:\n\t\t\treturn 0;\n\t\t}\n\t}\n}",
    "includes": [
      "#include \"sshbuf.h\"",
      "#include \"ssherr.h\"",
      "#include \"packet.h\"",
      "#include \"ssh.h\"",
      "#include \"channels.h\"",
      "#include \"misc.h\"",
      "#include \"canohost.h\"",
      "#include \"log.h\"",
      "#include \"mac.h\"",
      "#include \"digest.h\"",
      "#include \"kex.h\"",
      "#include \"sshkey.h\"",
      "#include \"cipher.h\"",
      "#include \"ssh2.h\"",
      "#include \"compat.h\"",
      "#include \"crc32.h\"",
      "#include \"xmalloc.h\"",
      "#include <zlib.h>",
      "#  include <openssl/ec.h>",
      "# include <openssl/evp.h>",
      "# include <openssl/bn.h>",
      "#include <time.h>",
      "#include <signal.h>",
      "#include <limits.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <stdarg.h>",
      "#include <netdb.h>",
      "#include <errno.h>",
      "#include <arpa/inet.h>",
      "#include <netinet/ip.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include \"openbsd-compat/sys-queue.h\"",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "debug",
          "args": [
            "\"Received SSH2_MSG_UNIMPLEMENTED for %u\"",
            "seqnr"
          ],
          "line": 1722
        },
        "resolved": true,
        "details": {
          "function_name": "ssh_packet_send_debug",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
          "lines": "1771-1794",
          "snippet": "void\nssh_packet_send_debug(struct ssh *ssh, const char *fmt,...)\n{\n\tchar buf[1024];\n\tva_list args;\n\tint r;\n\n\tif ((ssh->compat & SSH_BUG_DEBUG))\n\t\treturn;\n\n\tva_start(args, fmt);\n\tvsnprintf(buf, sizeof(buf), fmt, args);\n\tva_end(args);\n\n\tdebug3(\"sending debug message: %s\", buf);\n\n\tif ((r = sshpkt_start(ssh, SSH2_MSG_DEBUG)) != 0 ||\n\t    (r = sshpkt_put_u8(ssh, 0)) != 0 || /* always display */\n\t    (r = sshpkt_put_cstring(ssh, buf)) != 0 ||\n\t    (r = sshpkt_put_cstring(ssh, \"\")) != 0 ||\n\t    (r = sshpkt_send(ssh)) != 0 ||\n\t    (r = ssh_packet_write_wait(ssh)) != 0)\n\t\tfatal(\"%s: %s\", __func__, ssh_err(r));\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include \"packet.h\"",
            "#include \"ssh.h\"",
            "#include \"channels.h\"",
            "#include \"misc.h\"",
            "#include \"canohost.h\"",
            "#include \"log.h\"",
            "#include \"mac.h\"",
            "#include \"digest.h\"",
            "#include \"kex.h\"",
            "#include \"sshkey.h\"",
            "#include \"cipher.h\"",
            "#include \"ssh2.h\"",
            "#include \"compat.h\"",
            "#include \"crc32.h\"",
            "#include \"xmalloc.h\"",
            "#include <zlib.h>",
            "#  include <openssl/ec.h>",
            "# include <openssl/evp.h>",
            "# include <openssl/bn.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <limits.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <netdb.h>",
            "#include <errno.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include \"openbsd-compat/sys-queue.h\"",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\nssh_packet_send_debug(struct ssh *ssh, const char *fmt,...)\n{\n\tchar buf[1024];\n\tva_list args;\n\tint r;\n\n\tif ((ssh->compat & SSH_BUG_DEBUG))\n\t\treturn;\n\n\tva_start(args, fmt);\n\tvsnprintf(buf, sizeof(buf), fmt, args);\n\tva_end(args);\n\n\tdebug3(\"sending debug message: %s\", buf);\n\n\tif ((r = sshpkt_start(ssh, SSH2_MSG_DEBUG)) != 0 ||\n\t    (r = sshpkt_put_u8(ssh, 0)) != 0 || /* always display */\n\t    (r = sshpkt_put_cstring(ssh, buf)) != 0 ||\n\t    (r = sshpkt_put_cstring(ssh, \"\")) != 0 ||\n\t    (r = sshpkt_send(ssh)) != 0 ||\n\t    (r = ssh_packet_write_wait(ssh)) != 0)\n\t\tfatal(\"%s: %s\", __func__, ssh_err(r));\n}"
        }
      },
      {
        "call_info": {
          "callee": "sshpkt_get_u32",
          "args": [
            "ssh",
            "&seqnr"
          ],
          "line": 1720
        },
        "resolved": true,
        "details": {
          "function_name": "sshpkt_get_u32",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
          "lines": "2502-2506",
          "snippet": "int\nsshpkt_get_u32(struct ssh *ssh, u_int32_t *valp)\n{\n\treturn sshbuf_get_u32(ssh->state->incoming_packet, valp);\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include \"packet.h\"",
            "#include \"ssh.h\"",
            "#include \"channels.h\"",
            "#include \"misc.h\"",
            "#include \"canohost.h\"",
            "#include \"log.h\"",
            "#include \"mac.h\"",
            "#include \"digest.h\"",
            "#include \"kex.h\"",
            "#include \"sshkey.h\"",
            "#include \"cipher.h\"",
            "#include \"ssh2.h\"",
            "#include \"compat.h\"",
            "#include \"crc32.h\"",
            "#include \"xmalloc.h\"",
            "#include <zlib.h>",
            "#  include <openssl/ec.h>",
            "# include <openssl/evp.h>",
            "# include <openssl/bn.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <limits.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <netdb.h>",
            "#include <errno.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include \"openbsd-compat/sys-queue.h\"",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshpkt_get_u32(struct ssh *ssh, u_int32_t *valp)\n{\n\treturn sshbuf_get_u32(ssh->state->incoming_packet, valp);\n}"
        }
      },
      {
        "call_info": {
          "callee": "free",
          "args": [
            "msg"
          ],
          "line": 1717
        },
        "resolved": true,
        "details": {
          "function_name": "freeze",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/smult_curve25519_ref.c",
          "lines": "50-60",
          "snippet": "static void freeze(unsigned int a[32])\n{\n  unsigned int aorig[32];\n  unsigned int j;\n  unsigned int negative;\n\n  for (j = 0;j < 32;++j) aorig[j] = a[j];\n  add(a,a,minusp);\n  negative = -((a[31] >> 7) & 1);\n  for (j = 0;j < 32;++j) a[j] ^= negative & (aorig[j] ^ a[j]);\n}",
          "includes": [],
          "macros_used": [],
          "globals_used": [
            "static const unsigned int minusp[32] = {\n 19, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 128\n} ;"
          ],
          "called_functions": [],
          "contextual_snippet": "static const unsigned int minusp[32] = {\n 19, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 128\n} ;\n\nstatic void freeze(unsigned int a[32])\n{\n  unsigned int aorig[32];\n  unsigned int j;\n  unsigned int negative;\n\n  for (j = 0;j < 32;++j) aorig[j] = a[j];\n  add(a,a,minusp);\n  negative = -((a[31] >> 7) & 1);\n  for (j = 0;j < 32;++j) a[j] ^= negative & (aorig[j] ^ a[j]);\n}"
        }
      },
      {
        "call_info": {
          "callee": "do_log2",
          "args": [
            "ssh->state->server_side &&\n\t\t\t    reason == SSH2_DISCONNECT_BY_APPLICATION ?\n\t\t\t    SYSLOG_LEVEL_INFO : SYSLOG_LEVEL_ERROR",
            "\"Received disconnect from %s port %d:\"\n\t\t\t    \"%u: %.400s\"",
            "ssh_remote_ipaddr(ssh)",
            "ssh_remote_port(ssh)",
            "reason",
            "msg"
          ],
          "line": 1711
        },
        "resolved": true,
        "details": {
          "function_name": "do_log2",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/log.c",
          "lines": "390-398",
          "snippet": "void\ndo_log2(LogLevel level, const char *fmt,...)\n{\n\tva_list args;\n\n\tva_start(args, fmt);\n\tdo_log(level, fmt, args);\n\tva_end(args);\n}",
          "includes": [
            "#include \"log.h\"",
            "# include <vis.h>",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <syslog.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <fcntl.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n# include <vis.h>\n#include <errno.h>\n#include <unistd.h>\n#include <syslog.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <fcntl.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\ndo_log2(LogLevel level, const char *fmt,...)\n{\n\tva_list args;\n\n\tva_start(args, fmt);\n\tdo_log(level, fmt, args);\n\tva_end(args);\n}"
        }
      },
      {
        "call_info": {
          "callee": "ssh_remote_port",
          "args": [
            "ssh"
          ],
          "line": 1716
        },
        "resolved": true,
        "details": {
          "function_name": "ssh_remote_port",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
          "lines": "539-544",
          "snippet": "int\nssh_remote_port(struct ssh *ssh)\n{\n\t(void)ssh_remote_ipaddr(ssh); /* Will lookup and cache. */\n\treturn ssh->remote_port;\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include \"packet.h\"",
            "#include \"ssh.h\"",
            "#include \"channels.h\"",
            "#include \"misc.h\"",
            "#include \"canohost.h\"",
            "#include \"log.h\"",
            "#include \"mac.h\"",
            "#include \"digest.h\"",
            "#include \"kex.h\"",
            "#include \"sshkey.h\"",
            "#include \"cipher.h\"",
            "#include \"ssh2.h\"",
            "#include \"compat.h\"",
            "#include \"crc32.h\"",
            "#include \"xmalloc.h\"",
            "#include <zlib.h>",
            "#  include <openssl/ec.h>",
            "# include <openssl/evp.h>",
            "# include <openssl/bn.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <limits.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <netdb.h>",
            "#include <errno.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include \"openbsd-compat/sys-queue.h\"",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nssh_remote_port(struct ssh *ssh)\n{\n\t(void)ssh_remote_ipaddr(ssh); /* Will lookup and cache. */\n\treturn ssh->remote_port;\n}"
        }
      },
      {
        "call_info": {
          "callee": "ssh_remote_ipaddr",
          "args": [
            "ssh"
          ],
          "line": 1715
        },
        "resolved": true,
        "details": {
          "function_name": "ssh_remote_ipaddr",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
          "lines": "514-535",
          "snippet": "const char *\nssh_remote_ipaddr(struct ssh *ssh)\n{\n\tint sock;\n\n\t/* Check whether we have cached the ipaddr. */\n\tif (ssh->remote_ipaddr == NULL) {\n\t\tif (ssh_packet_connection_is_on_socket(ssh)) {\n\t\t\tsock = ssh->state->connection_in;\n\t\t\tssh->remote_ipaddr = get_peer_ipaddr(sock);\n\t\t\tssh->remote_port = get_peer_port(sock);\n\t\t\tssh->local_ipaddr = get_local_ipaddr(sock);\n\t\t\tssh->local_port = get_local_port(sock);\n\t\t} else {\n\t\t\tssh->remote_ipaddr = strdup(\"UNKNOWN\");\n\t\t\tssh->remote_port = 65535;\n\t\t\tssh->local_ipaddr = strdup(\"UNKNOWN\");\n\t\t\tssh->local_port = 65535;\n\t\t}\n\t}\n\treturn ssh->remote_ipaddr;\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include \"packet.h\"",
            "#include \"ssh.h\"",
            "#include \"channels.h\"",
            "#include \"misc.h\"",
            "#include \"canohost.h\"",
            "#include \"log.h\"",
            "#include \"mac.h\"",
            "#include \"digest.h\"",
            "#include \"kex.h\"",
            "#include \"sshkey.h\"",
            "#include \"cipher.h\"",
            "#include \"ssh2.h\"",
            "#include \"compat.h\"",
            "#include \"crc32.h\"",
            "#include \"xmalloc.h\"",
            "#include <zlib.h>",
            "#  include <openssl/ec.h>",
            "# include <openssl/evp.h>",
            "# include <openssl/bn.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <limits.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <netdb.h>",
            "#include <errno.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include \"openbsd-compat/sys-queue.h\"",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nconst char *\nssh_remote_ipaddr(struct ssh *ssh)\n{\n\tint sock;\n\n\t/* Check whether we have cached the ipaddr. */\n\tif (ssh->remote_ipaddr == NULL) {\n\t\tif (ssh_packet_connection_is_on_socket(ssh)) {\n\t\t\tsock = ssh->state->connection_in;\n\t\t\tssh->remote_ipaddr = get_peer_ipaddr(sock);\n\t\t\tssh->remote_port = get_peer_port(sock);\n\t\t\tssh->local_ipaddr = get_local_ipaddr(sock);\n\t\t\tssh->local_port = get_local_port(sock);\n\t\t} else {\n\t\t\tssh->remote_ipaddr = strdup(\"UNKNOWN\");\n\t\t\tssh->remote_port = 65535;\n\t\t\tssh->local_ipaddr = strdup(\"UNKNOWN\");\n\t\t\tssh->local_port = 65535;\n\t\t}\n\t}\n\treturn ssh->remote_ipaddr;\n}"
        }
      },
      {
        "call_info": {
          "callee": "sshpkt_get_string",
          "args": [
            "ssh",
            "&msg",
            "NULL"
          ],
          "line": 1708
        },
        "resolved": true,
        "details": {
          "function_name": "sshpkt_get_string_direct",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
          "lines": "2520-2524",
          "snippet": "int\nsshpkt_get_string_direct(struct ssh *ssh, const u_char **valp, size_t *lenp)\n{\n\treturn sshbuf_get_string_direct(ssh->state->incoming_packet, valp, lenp);\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include \"packet.h\"",
            "#include \"ssh.h\"",
            "#include \"channels.h\"",
            "#include \"misc.h\"",
            "#include \"canohost.h\"",
            "#include \"log.h\"",
            "#include \"mac.h\"",
            "#include \"digest.h\"",
            "#include \"kex.h\"",
            "#include \"sshkey.h\"",
            "#include \"cipher.h\"",
            "#include \"ssh2.h\"",
            "#include \"compat.h\"",
            "#include \"crc32.h\"",
            "#include \"xmalloc.h\"",
            "#include <zlib.h>",
            "#  include <openssl/ec.h>",
            "# include <openssl/evp.h>",
            "# include <openssl/bn.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <limits.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <netdb.h>",
            "#include <errno.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include \"openbsd-compat/sys-queue.h\"",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshpkt_get_string_direct(struct ssh *ssh, const u_char **valp, size_t *lenp)\n{\n\treturn sshbuf_get_string_direct(ssh->state->incoming_packet, valp, lenp);\n}"
        }
      },
      {
        "call_info": {
          "callee": "sshpkt_get_u8",
          "args": [
            "ssh",
            "NULL"
          ],
          "line": 1697
        },
        "resolved": true,
        "details": {
          "function_name": "sshpkt_get_u8",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
          "lines": "2496-2500",
          "snippet": "int\nsshpkt_get_u8(struct ssh *ssh, u_char *valp)\n{\n\treturn sshbuf_get_u8(ssh->state->incoming_packet, valp);\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include \"packet.h\"",
            "#include \"ssh.h\"",
            "#include \"channels.h\"",
            "#include \"misc.h\"",
            "#include \"canohost.h\"",
            "#include \"log.h\"",
            "#include \"mac.h\"",
            "#include \"digest.h\"",
            "#include \"kex.h\"",
            "#include \"sshkey.h\"",
            "#include \"cipher.h\"",
            "#include \"ssh2.h\"",
            "#include \"compat.h\"",
            "#include \"crc32.h\"",
            "#include \"xmalloc.h\"",
            "#include <zlib.h>",
            "#  include <openssl/ec.h>",
            "# include <openssl/evp.h>",
            "# include <openssl/bn.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <limits.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <netdb.h>",
            "#include <errno.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include \"openbsd-compat/sys-queue.h\"",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshpkt_get_u8(struct ssh *ssh, u_char *valp)\n{\n\treturn sshbuf_get_u8(ssh->state->incoming_packet, valp);\n}"
        }
      },
      {
        "call_info": {
          "callee": "debug3",
          "args": [
            "\"Received SSH2_MSG_IGNORE\""
          ],
          "line": 1694
        },
        "resolved": true,
        "details": {
          "function_name": "debug3",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/log.c",
          "lines": "242-250",
          "snippet": "void\ndebug3(const char *fmt,...)\n{\n\tva_list args;\n\n\tva_start(args, fmt);\n\tdo_log(SYSLOG_LEVEL_DEBUG3, fmt, args);\n\tva_end(args);\n}",
          "includes": [
            "#include \"log.h\"",
            "# include <vis.h>",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <syslog.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <fcntl.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n# include <vis.h>\n#include <errno.h>\n#include <unistd.h>\n#include <syslog.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <fcntl.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\ndebug3(const char *fmt,...)\n{\n\tva_list args;\n\n\tva_start(args, fmt);\n\tdo_log(SYSLOG_LEVEL_DEBUG3, fmt, args);\n\tva_end(args);\n}"
        }
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "debug(\"received packet type %d\", *typep)"
          ],
          "line": 1690
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ssh_packet_read_poll2",
          "args": [
            "ssh",
            "typep",
            "seqnr_p"
          ],
          "line": 1685
        },
        "resolved": true,
        "details": {
          "function_name": "ssh_packet_read_poll2",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
          "lines": "1443-1673",
          "snippet": "int\nssh_packet_read_poll2(struct ssh *ssh, u_char *typep, u_int32_t *seqnr_p)\n{\n\tstruct session_state *state = ssh->state;\n\tu_int padlen, need;\n\tu_char *cp;\n\tu_int maclen, aadlen = 0, authlen = 0, block_size;\n\tstruct sshenc *enc   = NULL;\n\tstruct sshmac *mac   = NULL;\n\tstruct sshcomp *comp = NULL;\n\tint r;\n\n\tif (state->mux)\n\t\treturn ssh_packet_read_poll2_mux(ssh, typep, seqnr_p);\n\n\t*typep = SSH_MSG_NONE;\n\n\tif (state->packet_discard)\n\t\treturn 0;\n\n\tif (state->newkeys[MODE_IN] != NULL) {\n\t\tenc  = &state->newkeys[MODE_IN]->enc;\n\t\tmac  = &state->newkeys[MODE_IN]->mac;\n\t\tcomp = &state->newkeys[MODE_IN]->comp;\n\t\t/* disable mac for authenticated encryption */\n\t\tif ((authlen = cipher_authlen(enc->cipher)) != 0)\n\t\t\tmac = NULL;\n\t}\n\tmaclen = mac && mac->enabled ? mac->mac_len : 0;\n\tblock_size = enc ? enc->block_size : 8;\n\taadlen = (mac && mac->enabled && mac->etm) || authlen ? 4 : 0;\n\n\tif (aadlen && state->packlen == 0) {\n\t\tif (cipher_get_length(state->receive_context,\n\t\t    &state->packlen, state->p_read.seqnr,\n\t\t    sshbuf_ptr(state->input), sshbuf_len(state->input)) != 0)\n\t\t\treturn 0;\n\t\tif (state->packlen < 1 + 4 ||\n\t\t    state->packlen > PACKET_MAX_SIZE) {\n#ifdef PACKET_DEBUG\n\t\t\tsshbuf_dump(state->input, stderr);\n#endif\n\t\t\tlogit(\"Bad packet length %u.\", state->packlen);\n\t\t\tif ((r = sshpkt_disconnect(ssh, \"Packet corrupt\")) != 0)\n\t\t\t\treturn r;\n\t\t\treturn SSH_ERR_CONN_CORRUPT;\n\t\t}\n\t\tsshbuf_reset(state->incoming_packet);\n\t} else if (state->packlen == 0) {\n\t\t/*\n\t\t * check if input size is less than the cipher block size,\n\t\t * decrypt first block and extract length of incoming packet\n\t\t */\n\t\tif (sshbuf_len(state->input) < block_size)\n\t\t\treturn 0;\n\t\tsshbuf_reset(state->incoming_packet);\n\t\tif ((r = sshbuf_reserve(state->incoming_packet, block_size,\n\t\t    &cp)) != 0)\n\t\t\tgoto out;\n\t\tif ((r = cipher_crypt(state->receive_context,\n\t\t    state->p_send.seqnr, cp, sshbuf_ptr(state->input),\n\t\t    block_size, 0, 0)) != 0)\n\t\t\tgoto out;\n\t\tstate->packlen = PEEK_U32(sshbuf_ptr(state->incoming_packet));\n\t\tif (state->packlen < 1 + 4 ||\n\t\t    state->packlen > PACKET_MAX_SIZE) {\n#ifdef PACKET_DEBUG\n\t\t\tfprintf(stderr, \"input: \\n\");\n\t\t\tsshbuf_dump(state->input, stderr);\n\t\t\tfprintf(stderr, \"incoming_packet: \\n\");\n\t\t\tsshbuf_dump(state->incoming_packet, stderr);\n#endif\n\t\t\tlogit(\"Bad packet length %u.\", state->packlen);\n\t\t\treturn ssh_packet_start_discard(ssh, enc, mac, 0,\n\t\t\t    PACKET_MAX_SIZE);\n\t\t}\n\t\tif ((r = sshbuf_consume(state->input, block_size)) != 0)\n\t\t\tgoto out;\n\t}\n\tDBG(debug(\"input: packet len %u\", state->packlen+4));\n\n\tif (aadlen) {\n\t\t/* only the payload is encrypted */\n\t\tneed = state->packlen;\n\t} else {\n\t\t/*\n\t\t * the payload size and the payload are encrypted, but we\n\t\t * have a partial packet of block_size bytes\n\t\t */\n\t\tneed = 4 + state->packlen - block_size;\n\t}\n\tDBG(debug(\"partial packet: block %d, need %d, maclen %d, authlen %d,\"\n\t    \" aadlen %d\", block_size, need, maclen, authlen, aadlen));\n\tif (need % block_size != 0) {\n\t\tlogit(\"padding error: need %d block %d mod %d\",\n\t\t    need, block_size, need % block_size);\n\t\treturn ssh_packet_start_discard(ssh, enc, mac, 0,\n\t\t    PACKET_MAX_SIZE - block_size);\n\t}\n\t/*\n\t * check if the entire packet has been received and\n\t * decrypt into incoming_packet:\n\t * 'aadlen' bytes are unencrypted, but authenticated.\n\t * 'need' bytes are encrypted, followed by either\n\t * 'authlen' bytes of authentication tag or\n\t * 'maclen' bytes of message authentication code.\n\t */\n\tif (sshbuf_len(state->input) < aadlen + need + authlen + maclen)\n\t\treturn 0; /* packet is incomplete */\n#ifdef PACKET_DEBUG\n\tfprintf(stderr, \"read_poll enc/full: \");\n\tsshbuf_dump(state->input, stderr);\n#endif\n\t/* EtM: check mac over encrypted input */\n\tif (mac && mac->enabled && mac->etm) {\n\t\tif ((r = mac_check(mac, state->p_read.seqnr,\n\t\t    sshbuf_ptr(state->input), aadlen + need,\n\t\t    sshbuf_ptr(state->input) + aadlen + need + authlen,\n\t\t    maclen)) != 0) {\n\t\t\tif (r == SSH_ERR_MAC_INVALID)\n\t\t\t\tlogit(\"Corrupted MAC on input.\");\n\t\t\tgoto out;\n\t\t}\n\t}\n\tif ((r = sshbuf_reserve(state->incoming_packet, aadlen + need,\n\t    &cp)) != 0)\n\t\tgoto out;\n\tif ((r = cipher_crypt(state->receive_context, state->p_read.seqnr, cp,\n\t    sshbuf_ptr(state->input), need, aadlen, authlen)) != 0)\n\t\tgoto out;\n\tif ((r = sshbuf_consume(state->input, aadlen + need + authlen)) != 0)\n\t\tgoto out;\n\tif (mac && mac->enabled) {\n\t\t/* Not EtM: check MAC over cleartext */\n\t\tif (!mac->etm && (r = mac_check(mac, state->p_read.seqnr,\n\t\t    sshbuf_ptr(state->incoming_packet),\n\t\t    sshbuf_len(state->incoming_packet),\n\t\t    sshbuf_ptr(state->input), maclen)) != 0) {\n\t\t\tif (r != SSH_ERR_MAC_INVALID)\n\t\t\t\tgoto out;\n\t\t\tlogit(\"Corrupted MAC on input.\");\n\t\t\tif (need + block_size > PACKET_MAX_SIZE)\n\t\t\t\treturn SSH_ERR_INTERNAL_ERROR;\n\t\t\treturn ssh_packet_start_discard(ssh, enc, mac,\n\t\t\t    sshbuf_len(state->incoming_packet),\n\t\t\t    PACKET_MAX_SIZE - need - block_size);\n\t\t}\n\t\t/* Remove MAC from input buffer */\n\t\tDBG(debug(\"MAC #%d ok\", state->p_read.seqnr));\n\t\tif ((r = sshbuf_consume(state->input, mac->mac_len)) != 0)\n\t\t\tgoto out;\n\t}\n\tif (seqnr_p != NULL)\n\t\t*seqnr_p = state->p_read.seqnr;\n\tif (++state->p_read.seqnr == 0)\n\t\tlogit(\"incoming seqnr wraps around\");\n\tif (++state->p_read.packets == 0)\n\t\tif (!(ssh->compat & SSH_BUG_NOREKEY))\n\t\t\treturn SSH_ERR_NEED_REKEY;\n\tstate->p_read.blocks += (state->packlen + 4) / block_size;\n\tstate->p_read.bytes += state->packlen + 4;\n\n\t/* get padlen */\n\tpadlen = sshbuf_ptr(state->incoming_packet)[4];\n\tDBG(debug(\"input: padlen %d\", padlen));\n\tif (padlen < 4)\t{\n\t\tif ((r = sshpkt_disconnect(ssh,\n\t\t    \"Corrupted padlen %d on input.\", padlen)) != 0 ||\n\t\t    (r = ssh_packet_write_wait(ssh)) != 0)\n\t\t\treturn r;\n\t\treturn SSH_ERR_CONN_CORRUPT;\n\t}\n\n\t/* skip packet size + padlen, discard padding */\n\tif ((r = sshbuf_consume(state->incoming_packet, 4 + 1)) != 0 ||\n\t    ((r = sshbuf_consume_end(state->incoming_packet, padlen)) != 0))\n\t\tgoto out;\n\n\tDBG(debug(\"input: len before de-compress %zd\",\n\t    sshbuf_len(state->incoming_packet)));\n\tif (comp && comp->enabled) {\n\t\tsshbuf_reset(state->compression_buffer);\n\t\tif ((r = uncompress_buffer(ssh, state->incoming_packet,\n\t\t    state->compression_buffer)) != 0)\n\t\t\tgoto out;\n\t\tsshbuf_reset(state->incoming_packet);\n\t\tif ((r = sshbuf_putb(state->incoming_packet,\n\t\t    state->compression_buffer)) != 0)\n\t\t\tgoto out;\n\t\tDBG(debug(\"input: len after de-compress %zd\",\n\t\t    sshbuf_len(state->incoming_packet)));\n\t}\n\t/*\n\t * get packet type, implies consume.\n\t * return length of payload (without type field)\n\t */\n\tif ((r = sshbuf_get_u8(state->incoming_packet, typep)) != 0)\n\t\tgoto out;\n\tif (ssh_packet_log_type(*typep))\n\t\tdebug3(\"receive packet: type %u\", *typep);\n\tif (*typep < SSH2_MSG_MIN || *typep >= SSH2_MSG_LOCAL_MIN) {\n\t\tif ((r = sshpkt_disconnect(ssh,\n\t\t    \"Invalid ssh2 packet type: %d\", *typep)) != 0 ||\n\t\t    (r = ssh_packet_write_wait(ssh)) != 0)\n\t\t\treturn r;\n\t\treturn SSH_ERR_PROTOCOL_ERROR;\n\t}\n\tif (state->hook_in != NULL &&\n\t    (r = state->hook_in(ssh, state->incoming_packet, typep,\n\t    state->hook_in_ctx)) != 0)\n\t\treturn r;\n\tif (*typep == SSH2_MSG_USERAUTH_SUCCESS && !state->server_side)\n\t\tr = ssh_packet_enable_delayed_compress(ssh);\n\telse\n\t\tr = 0;\n#ifdef PACKET_DEBUG\n\tfprintf(stderr, \"read/plain[%d]:\\r\\n\", *typep);\n\tsshbuf_dump(state->incoming_packet, stderr);\n#endif\n\t/* reset for next packet */\n\tstate->packlen = 0;\n\n\t/* do we need to rekey? */\n\tif (ssh_packet_need_rekeying(ssh, 0)) {\n\t\tdebug3(\"%s: rekex triggered\", __func__);\n\t\tif ((r = kex_start_rekex(ssh)) != 0)\n\t\t\treturn r;\n\t}\n out:\n\treturn r;\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include \"packet.h\"",
            "#include \"ssh.h\"",
            "#include \"channels.h\"",
            "#include \"misc.h\"",
            "#include \"canohost.h\"",
            "#include \"log.h\"",
            "#include \"mac.h\"",
            "#include \"digest.h\"",
            "#include \"kex.h\"",
            "#include \"sshkey.h\"",
            "#include \"cipher.h\"",
            "#include \"ssh2.h\"",
            "#include \"compat.h\"",
            "#include \"crc32.h\"",
            "#include \"xmalloc.h\"",
            "#include <zlib.h>",
            "#  include <openssl/ec.h>",
            "# include <openssl/evp.h>",
            "# include <openssl/bn.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <limits.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <netdb.h>",
            "#include <errno.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include \"openbsd-compat/sys-queue.h\"",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [
            "#define PACKET_MAX_SIZE (256 * 1024)"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\n#define PACKET_MAX_SIZE (256 * 1024)\n\nint\nssh_packet_read_poll2(struct ssh *ssh, u_char *typep, u_int32_t *seqnr_p)\n{\n\tstruct session_state *state = ssh->state;\n\tu_int padlen, need;\n\tu_char *cp;\n\tu_int maclen, aadlen = 0, authlen = 0, block_size;\n\tstruct sshenc *enc   = NULL;\n\tstruct sshmac *mac   = NULL;\n\tstruct sshcomp *comp = NULL;\n\tint r;\n\n\tif (state->mux)\n\t\treturn ssh_packet_read_poll2_mux(ssh, typep, seqnr_p);\n\n\t*typep = SSH_MSG_NONE;\n\n\tif (state->packet_discard)\n\t\treturn 0;\n\n\tif (state->newkeys[MODE_IN] != NULL) {\n\t\tenc  = &state->newkeys[MODE_IN]->enc;\n\t\tmac  = &state->newkeys[MODE_IN]->mac;\n\t\tcomp = &state->newkeys[MODE_IN]->comp;\n\t\t/* disable mac for authenticated encryption */\n\t\tif ((authlen = cipher_authlen(enc->cipher)) != 0)\n\t\t\tmac = NULL;\n\t}\n\tmaclen = mac && mac->enabled ? mac->mac_len : 0;\n\tblock_size = enc ? enc->block_size : 8;\n\taadlen = (mac && mac->enabled && mac->etm) || authlen ? 4 : 0;\n\n\tif (aadlen && state->packlen == 0) {\n\t\tif (cipher_get_length(state->receive_context,\n\t\t    &state->packlen, state->p_read.seqnr,\n\t\t    sshbuf_ptr(state->input), sshbuf_len(state->input)) != 0)\n\t\t\treturn 0;\n\t\tif (state->packlen < 1 + 4 ||\n\t\t    state->packlen > PACKET_MAX_SIZE) {\n#ifdef PACKET_DEBUG\n\t\t\tsshbuf_dump(state->input, stderr);\n#endif\n\t\t\tlogit(\"Bad packet length %u.\", state->packlen);\n\t\t\tif ((r = sshpkt_disconnect(ssh, \"Packet corrupt\")) != 0)\n\t\t\t\treturn r;\n\t\t\treturn SSH_ERR_CONN_CORRUPT;\n\t\t}\n\t\tsshbuf_reset(state->incoming_packet);\n\t} else if (state->packlen == 0) {\n\t\t/*\n\t\t * check if input size is less than the cipher block size,\n\t\t * decrypt first block and extract length of incoming packet\n\t\t */\n\t\tif (sshbuf_len(state->input) < block_size)\n\t\t\treturn 0;\n\t\tsshbuf_reset(state->incoming_packet);\n\t\tif ((r = sshbuf_reserve(state->incoming_packet, block_size,\n\t\t    &cp)) != 0)\n\t\t\tgoto out;\n\t\tif ((r = cipher_crypt(state->receive_context,\n\t\t    state->p_send.seqnr, cp, sshbuf_ptr(state->input),\n\t\t    block_size, 0, 0)) != 0)\n\t\t\tgoto out;\n\t\tstate->packlen = PEEK_U32(sshbuf_ptr(state->incoming_packet));\n\t\tif (state->packlen < 1 + 4 ||\n\t\t    state->packlen > PACKET_MAX_SIZE) {\n#ifdef PACKET_DEBUG\n\t\t\tfprintf(stderr, \"input: \\n\");\n\t\t\tsshbuf_dump(state->input, stderr);\n\t\t\tfprintf(stderr, \"incoming_packet: \\n\");\n\t\t\tsshbuf_dump(state->incoming_packet, stderr);\n#endif\n\t\t\tlogit(\"Bad packet length %u.\", state->packlen);\n\t\t\treturn ssh_packet_start_discard(ssh, enc, mac, 0,\n\t\t\t    PACKET_MAX_SIZE);\n\t\t}\n\t\tif ((r = sshbuf_consume(state->input, block_size)) != 0)\n\t\t\tgoto out;\n\t}\n\tDBG(debug(\"input: packet len %u\", state->packlen+4));\n\n\tif (aadlen) {\n\t\t/* only the payload is encrypted */\n\t\tneed = state->packlen;\n\t} else {\n\t\t/*\n\t\t * the payload size and the payload are encrypted, but we\n\t\t * have a partial packet of block_size bytes\n\t\t */\n\t\tneed = 4 + state->packlen - block_size;\n\t}\n\tDBG(debug(\"partial packet: block %d, need %d, maclen %d, authlen %d,\"\n\t    \" aadlen %d\", block_size, need, maclen, authlen, aadlen));\n\tif (need % block_size != 0) {\n\t\tlogit(\"padding error: need %d block %d mod %d\",\n\t\t    need, block_size, need % block_size);\n\t\treturn ssh_packet_start_discard(ssh, enc, mac, 0,\n\t\t    PACKET_MAX_SIZE - block_size);\n\t}\n\t/*\n\t * check if the entire packet has been received and\n\t * decrypt into incoming_packet:\n\t * 'aadlen' bytes are unencrypted, but authenticated.\n\t * 'need' bytes are encrypted, followed by either\n\t * 'authlen' bytes of authentication tag or\n\t * 'maclen' bytes of message authentication code.\n\t */\n\tif (sshbuf_len(state->input) < aadlen + need + authlen + maclen)\n\t\treturn 0; /* packet is incomplete */\n#ifdef PACKET_DEBUG\n\tfprintf(stderr, \"read_poll enc/full: \");\n\tsshbuf_dump(state->input, stderr);\n#endif\n\t/* EtM: check mac over encrypted input */\n\tif (mac && mac->enabled && mac->etm) {\n\t\tif ((r = mac_check(mac, state->p_read.seqnr,\n\t\t    sshbuf_ptr(state->input), aadlen + need,\n\t\t    sshbuf_ptr(state->input) + aadlen + need + authlen,\n\t\t    maclen)) != 0) {\n\t\t\tif (r == SSH_ERR_MAC_INVALID)\n\t\t\t\tlogit(\"Corrupted MAC on input.\");\n\t\t\tgoto out;\n\t\t}\n\t}\n\tif ((r = sshbuf_reserve(state->incoming_packet, aadlen + need,\n\t    &cp)) != 0)\n\t\tgoto out;\n\tif ((r = cipher_crypt(state->receive_context, state->p_read.seqnr, cp,\n\t    sshbuf_ptr(state->input), need, aadlen, authlen)) != 0)\n\t\tgoto out;\n\tif ((r = sshbuf_consume(state->input, aadlen + need + authlen)) != 0)\n\t\tgoto out;\n\tif (mac && mac->enabled) {\n\t\t/* Not EtM: check MAC over cleartext */\n\t\tif (!mac->etm && (r = mac_check(mac, state->p_read.seqnr,\n\t\t    sshbuf_ptr(state->incoming_packet),\n\t\t    sshbuf_len(state->incoming_packet),\n\t\t    sshbuf_ptr(state->input), maclen)) != 0) {\n\t\t\tif (r != SSH_ERR_MAC_INVALID)\n\t\t\t\tgoto out;\n\t\t\tlogit(\"Corrupted MAC on input.\");\n\t\t\tif (need + block_size > PACKET_MAX_SIZE)\n\t\t\t\treturn SSH_ERR_INTERNAL_ERROR;\n\t\t\treturn ssh_packet_start_discard(ssh, enc, mac,\n\t\t\t    sshbuf_len(state->incoming_packet),\n\t\t\t    PACKET_MAX_SIZE - need - block_size);\n\t\t}\n\t\t/* Remove MAC from input buffer */\n\t\tDBG(debug(\"MAC #%d ok\", state->p_read.seqnr));\n\t\tif ((r = sshbuf_consume(state->input, mac->mac_len)) != 0)\n\t\t\tgoto out;\n\t}\n\tif (seqnr_p != NULL)\n\t\t*seqnr_p = state->p_read.seqnr;\n\tif (++state->p_read.seqnr == 0)\n\t\tlogit(\"incoming seqnr wraps around\");\n\tif (++state->p_read.packets == 0)\n\t\tif (!(ssh->compat & SSH_BUG_NOREKEY))\n\t\t\treturn SSH_ERR_NEED_REKEY;\n\tstate->p_read.blocks += (state->packlen + 4) / block_size;\n\tstate->p_read.bytes += state->packlen + 4;\n\n\t/* get padlen */\n\tpadlen = sshbuf_ptr(state->incoming_packet)[4];\n\tDBG(debug(\"input: padlen %d\", padlen));\n\tif (padlen < 4)\t{\n\t\tif ((r = sshpkt_disconnect(ssh,\n\t\t    \"Corrupted padlen %d on input.\", padlen)) != 0 ||\n\t\t    (r = ssh_packet_write_wait(ssh)) != 0)\n\t\t\treturn r;\n\t\treturn SSH_ERR_CONN_CORRUPT;\n\t}\n\n\t/* skip packet size + padlen, discard padding */\n\tif ((r = sshbuf_consume(state->incoming_packet, 4 + 1)) != 0 ||\n\t    ((r = sshbuf_consume_end(state->incoming_packet, padlen)) != 0))\n\t\tgoto out;\n\n\tDBG(debug(\"input: len before de-compress %zd\",\n\t    sshbuf_len(state->incoming_packet)));\n\tif (comp && comp->enabled) {\n\t\tsshbuf_reset(state->compression_buffer);\n\t\tif ((r = uncompress_buffer(ssh, state->incoming_packet,\n\t\t    state->compression_buffer)) != 0)\n\t\t\tgoto out;\n\t\tsshbuf_reset(state->incoming_packet);\n\t\tif ((r = sshbuf_putb(state->incoming_packet,\n\t\t    state->compression_buffer)) != 0)\n\t\t\tgoto out;\n\t\tDBG(debug(\"input: len after de-compress %zd\",\n\t\t    sshbuf_len(state->incoming_packet)));\n\t}\n\t/*\n\t * get packet type, implies consume.\n\t * return length of payload (without type field)\n\t */\n\tif ((r = sshbuf_get_u8(state->incoming_packet, typep)) != 0)\n\t\tgoto out;\n\tif (ssh_packet_log_type(*typep))\n\t\tdebug3(\"receive packet: type %u\", *typep);\n\tif (*typep < SSH2_MSG_MIN || *typep >= SSH2_MSG_LOCAL_MIN) {\n\t\tif ((r = sshpkt_disconnect(ssh,\n\t\t    \"Invalid ssh2 packet type: %d\", *typep)) != 0 ||\n\t\t    (r = ssh_packet_write_wait(ssh)) != 0)\n\t\t\treturn r;\n\t\treturn SSH_ERR_PROTOCOL_ERROR;\n\t}\n\tif (state->hook_in != NULL &&\n\t    (r = state->hook_in(ssh, state->incoming_packet, typep,\n\t    state->hook_in_ctx)) != 0)\n\t\treturn r;\n\tif (*typep == SSH2_MSG_USERAUTH_SUCCESS && !state->server_side)\n\t\tr = ssh_packet_enable_delayed_compress(ssh);\n\telse\n\t\tr = 0;\n#ifdef PACKET_DEBUG\n\tfprintf(stderr, \"read/plain[%d]:\\r\\n\", *typep);\n\tsshbuf_dump(state->incoming_packet, stderr);\n#endif\n\t/* reset for next packet */\n\tstate->packlen = 0;\n\n\t/* do we need to rekey? */\n\tif (ssh_packet_need_rekeying(ssh, 0)) {\n\t\tdebug3(\"%s: rekex triggered\", __func__);\n\t\tif ((r = kex_start_rekex(ssh)) != 0)\n\t\t\treturn r;\n\t}\n out:\n\treturn r;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nssh_packet_read_poll_seqnr(struct ssh *ssh, u_char *typep, u_int32_t *seqnr_p)\n{\n\tstruct session_state *state = ssh->state;\n\tu_int reason, seqnr;\n\tint r;\n\tu_char *msg;\n\n\tfor (;;) {\n\t\tmsg = NULL;\n\t\tr = ssh_packet_read_poll2(ssh, typep, seqnr_p);\n\t\tif (r != 0)\n\t\t\treturn r;\n\t\tif (*typep) {\n\t\t\tstate->keep_alive_timeouts = 0;\n\t\t\tDBG(debug(\"received packet type %d\", *typep));\n\t\t}\n\t\tswitch (*typep) {\n\t\tcase SSH2_MSG_IGNORE:\n\t\t\tdebug3(\"Received SSH2_MSG_IGNORE\");\n\t\t\tbreak;\n\t\tcase SSH2_MSG_DEBUG:\n\t\t\tif ((r = sshpkt_get_u8(ssh, NULL)) != 0 ||\n\t\t\t    (r = sshpkt_get_string(ssh, &msg, NULL)) != 0 ||\n\t\t\t    (r = sshpkt_get_string(ssh, NULL, NULL)) != 0) {\n\t\t\t\tfree(msg);\n\t\t\t\treturn r;\n\t\t\t}\n\t\t\tdebug(\"Remote: %.900s\", msg);\n\t\t\tfree(msg);\n\t\t\tbreak;\n\t\tcase SSH2_MSG_DISCONNECT:\n\t\t\tif ((r = sshpkt_get_u32(ssh, &reason)) != 0 ||\n\t\t\t    (r = sshpkt_get_string(ssh, &msg, NULL)) != 0)\n\t\t\t\treturn r;\n\t\t\t/* Ignore normal client exit notifications */\n\t\t\tdo_log2(ssh->state->server_side &&\n\t\t\t    reason == SSH2_DISCONNECT_BY_APPLICATION ?\n\t\t\t    SYSLOG_LEVEL_INFO : SYSLOG_LEVEL_ERROR,\n\t\t\t    \"Received disconnect from %s port %d:\"\n\t\t\t    \"%u: %.400s\", ssh_remote_ipaddr(ssh),\n\t\t\t    ssh_remote_port(ssh), reason, msg);\n\t\t\tfree(msg);\n\t\t\treturn SSH_ERR_DISCONNECTED;\n\t\tcase SSH2_MSG_UNIMPLEMENTED:\n\t\t\tif ((r = sshpkt_get_u32(ssh, &seqnr)) != 0)\n\t\t\t\treturn r;\n\t\t\tdebug(\"Received SSH2_MSG_UNIMPLEMENTED for %u\",\n\t\t\t    seqnr);\n\t\t\tbreak;\n\t\tdefault:\n\t\t\treturn 0;\n\t\t}\n\t}\n}"
  },
  {
    "function_name": "ssh_packet_read_poll2",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
    "lines": "1443-1673",
    "snippet": "int\nssh_packet_read_poll2(struct ssh *ssh, u_char *typep, u_int32_t *seqnr_p)\n{\n\tstruct session_state *state = ssh->state;\n\tu_int padlen, need;\n\tu_char *cp;\n\tu_int maclen, aadlen = 0, authlen = 0, block_size;\n\tstruct sshenc *enc   = NULL;\n\tstruct sshmac *mac   = NULL;\n\tstruct sshcomp *comp = NULL;\n\tint r;\n\n\tif (state->mux)\n\t\treturn ssh_packet_read_poll2_mux(ssh, typep, seqnr_p);\n\n\t*typep = SSH_MSG_NONE;\n\n\tif (state->packet_discard)\n\t\treturn 0;\n\n\tif (state->newkeys[MODE_IN] != NULL) {\n\t\tenc  = &state->newkeys[MODE_IN]->enc;\n\t\tmac  = &state->newkeys[MODE_IN]->mac;\n\t\tcomp = &state->newkeys[MODE_IN]->comp;\n\t\t/* disable mac for authenticated encryption */\n\t\tif ((authlen = cipher_authlen(enc->cipher)) != 0)\n\t\t\tmac = NULL;\n\t}\n\tmaclen = mac && mac->enabled ? mac->mac_len : 0;\n\tblock_size = enc ? enc->block_size : 8;\n\taadlen = (mac && mac->enabled && mac->etm) || authlen ? 4 : 0;\n\n\tif (aadlen && state->packlen == 0) {\n\t\tif (cipher_get_length(state->receive_context,\n\t\t    &state->packlen, state->p_read.seqnr,\n\t\t    sshbuf_ptr(state->input), sshbuf_len(state->input)) != 0)\n\t\t\treturn 0;\n\t\tif (state->packlen < 1 + 4 ||\n\t\t    state->packlen > PACKET_MAX_SIZE) {\n#ifdef PACKET_DEBUG\n\t\t\tsshbuf_dump(state->input, stderr);\n#endif\n\t\t\tlogit(\"Bad packet length %u.\", state->packlen);\n\t\t\tif ((r = sshpkt_disconnect(ssh, \"Packet corrupt\")) != 0)\n\t\t\t\treturn r;\n\t\t\treturn SSH_ERR_CONN_CORRUPT;\n\t\t}\n\t\tsshbuf_reset(state->incoming_packet);\n\t} else if (state->packlen == 0) {\n\t\t/*\n\t\t * check if input size is less than the cipher block size,\n\t\t * decrypt first block and extract length of incoming packet\n\t\t */\n\t\tif (sshbuf_len(state->input) < block_size)\n\t\t\treturn 0;\n\t\tsshbuf_reset(state->incoming_packet);\n\t\tif ((r = sshbuf_reserve(state->incoming_packet, block_size,\n\t\t    &cp)) != 0)\n\t\t\tgoto out;\n\t\tif ((r = cipher_crypt(state->receive_context,\n\t\t    state->p_send.seqnr, cp, sshbuf_ptr(state->input),\n\t\t    block_size, 0, 0)) != 0)\n\t\t\tgoto out;\n\t\tstate->packlen = PEEK_U32(sshbuf_ptr(state->incoming_packet));\n\t\tif (state->packlen < 1 + 4 ||\n\t\t    state->packlen > PACKET_MAX_SIZE) {\n#ifdef PACKET_DEBUG\n\t\t\tfprintf(stderr, \"input: \\n\");\n\t\t\tsshbuf_dump(state->input, stderr);\n\t\t\tfprintf(stderr, \"incoming_packet: \\n\");\n\t\t\tsshbuf_dump(state->incoming_packet, stderr);\n#endif\n\t\t\tlogit(\"Bad packet length %u.\", state->packlen);\n\t\t\treturn ssh_packet_start_discard(ssh, enc, mac, 0,\n\t\t\t    PACKET_MAX_SIZE);\n\t\t}\n\t\tif ((r = sshbuf_consume(state->input, block_size)) != 0)\n\t\t\tgoto out;\n\t}\n\tDBG(debug(\"input: packet len %u\", state->packlen+4));\n\n\tif (aadlen) {\n\t\t/* only the payload is encrypted */\n\t\tneed = state->packlen;\n\t} else {\n\t\t/*\n\t\t * the payload size and the payload are encrypted, but we\n\t\t * have a partial packet of block_size bytes\n\t\t */\n\t\tneed = 4 + state->packlen - block_size;\n\t}\n\tDBG(debug(\"partial packet: block %d, need %d, maclen %d, authlen %d,\"\n\t    \" aadlen %d\", block_size, need, maclen, authlen, aadlen));\n\tif (need % block_size != 0) {\n\t\tlogit(\"padding error: need %d block %d mod %d\",\n\t\t    need, block_size, need % block_size);\n\t\treturn ssh_packet_start_discard(ssh, enc, mac, 0,\n\t\t    PACKET_MAX_SIZE - block_size);\n\t}\n\t/*\n\t * check if the entire packet has been received and\n\t * decrypt into incoming_packet:\n\t * 'aadlen' bytes are unencrypted, but authenticated.\n\t * 'need' bytes are encrypted, followed by either\n\t * 'authlen' bytes of authentication tag or\n\t * 'maclen' bytes of message authentication code.\n\t */\n\tif (sshbuf_len(state->input) < aadlen + need + authlen + maclen)\n\t\treturn 0; /* packet is incomplete */\n#ifdef PACKET_DEBUG\n\tfprintf(stderr, \"read_poll enc/full: \");\n\tsshbuf_dump(state->input, stderr);\n#endif\n\t/* EtM: check mac over encrypted input */\n\tif (mac && mac->enabled && mac->etm) {\n\t\tif ((r = mac_check(mac, state->p_read.seqnr,\n\t\t    sshbuf_ptr(state->input), aadlen + need,\n\t\t    sshbuf_ptr(state->input) + aadlen + need + authlen,\n\t\t    maclen)) != 0) {\n\t\t\tif (r == SSH_ERR_MAC_INVALID)\n\t\t\t\tlogit(\"Corrupted MAC on input.\");\n\t\t\tgoto out;\n\t\t}\n\t}\n\tif ((r = sshbuf_reserve(state->incoming_packet, aadlen + need,\n\t    &cp)) != 0)\n\t\tgoto out;\n\tif ((r = cipher_crypt(state->receive_context, state->p_read.seqnr, cp,\n\t    sshbuf_ptr(state->input), need, aadlen, authlen)) != 0)\n\t\tgoto out;\n\tif ((r = sshbuf_consume(state->input, aadlen + need + authlen)) != 0)\n\t\tgoto out;\n\tif (mac && mac->enabled) {\n\t\t/* Not EtM: check MAC over cleartext */\n\t\tif (!mac->etm && (r = mac_check(mac, state->p_read.seqnr,\n\t\t    sshbuf_ptr(state->incoming_packet),\n\t\t    sshbuf_len(state->incoming_packet),\n\t\t    sshbuf_ptr(state->input), maclen)) != 0) {\n\t\t\tif (r != SSH_ERR_MAC_INVALID)\n\t\t\t\tgoto out;\n\t\t\tlogit(\"Corrupted MAC on input.\");\n\t\t\tif (need + block_size > PACKET_MAX_SIZE)\n\t\t\t\treturn SSH_ERR_INTERNAL_ERROR;\n\t\t\treturn ssh_packet_start_discard(ssh, enc, mac,\n\t\t\t    sshbuf_len(state->incoming_packet),\n\t\t\t    PACKET_MAX_SIZE - need - block_size);\n\t\t}\n\t\t/* Remove MAC from input buffer */\n\t\tDBG(debug(\"MAC #%d ok\", state->p_read.seqnr));\n\t\tif ((r = sshbuf_consume(state->input, mac->mac_len)) != 0)\n\t\t\tgoto out;\n\t}\n\tif (seqnr_p != NULL)\n\t\t*seqnr_p = state->p_read.seqnr;\n\tif (++state->p_read.seqnr == 0)\n\t\tlogit(\"incoming seqnr wraps around\");\n\tif (++state->p_read.packets == 0)\n\t\tif (!(ssh->compat & SSH_BUG_NOREKEY))\n\t\t\treturn SSH_ERR_NEED_REKEY;\n\tstate->p_read.blocks += (state->packlen + 4) / block_size;\n\tstate->p_read.bytes += state->packlen + 4;\n\n\t/* get padlen */\n\tpadlen = sshbuf_ptr(state->incoming_packet)[4];\n\tDBG(debug(\"input: padlen %d\", padlen));\n\tif (padlen < 4)\t{\n\t\tif ((r = sshpkt_disconnect(ssh,\n\t\t    \"Corrupted padlen %d on input.\", padlen)) != 0 ||\n\t\t    (r = ssh_packet_write_wait(ssh)) != 0)\n\t\t\treturn r;\n\t\treturn SSH_ERR_CONN_CORRUPT;\n\t}\n\n\t/* skip packet size + padlen, discard padding */\n\tif ((r = sshbuf_consume(state->incoming_packet, 4 + 1)) != 0 ||\n\t    ((r = sshbuf_consume_end(state->incoming_packet, padlen)) != 0))\n\t\tgoto out;\n\n\tDBG(debug(\"input: len before de-compress %zd\",\n\t    sshbuf_len(state->incoming_packet)));\n\tif (comp && comp->enabled) {\n\t\tsshbuf_reset(state->compression_buffer);\n\t\tif ((r = uncompress_buffer(ssh, state->incoming_packet,\n\t\t    state->compression_buffer)) != 0)\n\t\t\tgoto out;\n\t\tsshbuf_reset(state->incoming_packet);\n\t\tif ((r = sshbuf_putb(state->incoming_packet,\n\t\t    state->compression_buffer)) != 0)\n\t\t\tgoto out;\n\t\tDBG(debug(\"input: len after de-compress %zd\",\n\t\t    sshbuf_len(state->incoming_packet)));\n\t}\n\t/*\n\t * get packet type, implies consume.\n\t * return length of payload (without type field)\n\t */\n\tif ((r = sshbuf_get_u8(state->incoming_packet, typep)) != 0)\n\t\tgoto out;\n\tif (ssh_packet_log_type(*typep))\n\t\tdebug3(\"receive packet: type %u\", *typep);\n\tif (*typep < SSH2_MSG_MIN || *typep >= SSH2_MSG_LOCAL_MIN) {\n\t\tif ((r = sshpkt_disconnect(ssh,\n\t\t    \"Invalid ssh2 packet type: %d\", *typep)) != 0 ||\n\t\t    (r = ssh_packet_write_wait(ssh)) != 0)\n\t\t\treturn r;\n\t\treturn SSH_ERR_PROTOCOL_ERROR;\n\t}\n\tif (state->hook_in != NULL &&\n\t    (r = state->hook_in(ssh, state->incoming_packet, typep,\n\t    state->hook_in_ctx)) != 0)\n\t\treturn r;\n\tif (*typep == SSH2_MSG_USERAUTH_SUCCESS && !state->server_side)\n\t\tr = ssh_packet_enable_delayed_compress(ssh);\n\telse\n\t\tr = 0;\n#ifdef PACKET_DEBUG\n\tfprintf(stderr, \"read/plain[%d]:\\r\\n\", *typep);\n\tsshbuf_dump(state->incoming_packet, stderr);\n#endif\n\t/* reset for next packet */\n\tstate->packlen = 0;\n\n\t/* do we need to rekey? */\n\tif (ssh_packet_need_rekeying(ssh, 0)) {\n\t\tdebug3(\"%s: rekex triggered\", __func__);\n\t\tif ((r = kex_start_rekex(ssh)) != 0)\n\t\t\treturn r;\n\t}\n out:\n\treturn r;\n}",
    "includes": [
      "#include \"sshbuf.h\"",
      "#include \"ssherr.h\"",
      "#include \"packet.h\"",
      "#include \"ssh.h\"",
      "#include \"channels.h\"",
      "#include \"misc.h\"",
      "#include \"canohost.h\"",
      "#include \"log.h\"",
      "#include \"mac.h\"",
      "#include \"digest.h\"",
      "#include \"kex.h\"",
      "#include \"sshkey.h\"",
      "#include \"cipher.h\"",
      "#include \"ssh2.h\"",
      "#include \"compat.h\"",
      "#include \"crc32.h\"",
      "#include \"xmalloc.h\"",
      "#include <zlib.h>",
      "#  include <openssl/ec.h>",
      "# include <openssl/evp.h>",
      "# include <openssl/bn.h>",
      "#include <time.h>",
      "#include <signal.h>",
      "#include <limits.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <stdarg.h>",
      "#include <netdb.h>",
      "#include <errno.h>",
      "#include <arpa/inet.h>",
      "#include <netinet/ip.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include \"openbsd-compat/sys-queue.h\"",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [
      "#define PACKET_MAX_SIZE (256 * 1024)"
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "kex_start_rekex",
          "args": [
            "ssh"
          ],
          "line": 1668
        },
        "resolved": true,
        "details": {
          "function_name": "kex_start_rekex",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/kex.c",
          "lines": "683-696",
          "snippet": "int\nkex_start_rekex(struct ssh *ssh)\n{\n\tif (ssh->kex == NULL) {\n\t\terror(\"%s: no kex\", __func__);\n\t\treturn SSH_ERR_INTERNAL_ERROR;\n\t}\n\tif (ssh->kex->done == 0) {\n\t\terror(\"%s: requested twice\", __func__);\n\t\treturn SSH_ERR_INTERNAL_ERROR;\n\t}\n\tssh->kex->done = 0;\n\treturn kex_send_kexinit(ssh);\n}",
          "includes": [
            "#include \"digest.h\"",
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include \"monitor.h\"",
            "#include \"dispatch.h\"",
            "#include \"misc.h\"",
            "#include \"match.h\"",
            "#include \"mac.h\"",
            "#include \"log.h\"",
            "#include \"kex.h\"",
            "#include \"sshkey.h\"",
            "#include \"cipher.h\"",
            "#include \"compat.h\"",
            "#include \"packet.h\"",
            "#include \"ssh2.h\"",
            "#include <openssl/dh.h>",
            "#include <openssl/crypto.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static int kex_choose_conf(struct ssh *);",
            "static int kex_input_newkeys(int, u_int32_t, struct ssh *);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"digest.h\"\n#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"monitor.h\"\n#include \"dispatch.h\"\n#include \"misc.h\"\n#include \"match.h\"\n#include \"mac.h\"\n#include \"log.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"compat.h\"\n#include \"packet.h\"\n#include \"ssh2.h\"\n#include <openssl/dh.h>\n#include <openssl/crypto.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <signal.h>\n#include \"includes.h\"\n\nstatic int kex_choose_conf(struct ssh *);\nstatic int kex_input_newkeys(int, u_int32_t, struct ssh *);\n\nint\nkex_start_rekex(struct ssh *ssh)\n{\n\tif (ssh->kex == NULL) {\n\t\terror(\"%s: no kex\", __func__);\n\t\treturn SSH_ERR_INTERNAL_ERROR;\n\t}\n\tif (ssh->kex->done == 0) {\n\t\terror(\"%s: requested twice\", __func__);\n\t\treturn SSH_ERR_INTERNAL_ERROR;\n\t}\n\tssh->kex->done = 0;\n\treturn kex_send_kexinit(ssh);\n}"
        }
      },
      {
        "call_info": {
          "callee": "debug3",
          "args": [
            "\"%s: rekex triggered\"",
            "__func__"
          ],
          "line": 1667
        },
        "resolved": true,
        "details": {
          "function_name": "debug3",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/log.c",
          "lines": "242-250",
          "snippet": "void\ndebug3(const char *fmt,...)\n{\n\tva_list args;\n\n\tva_start(args, fmt);\n\tdo_log(SYSLOG_LEVEL_DEBUG3, fmt, args);\n\tva_end(args);\n}",
          "includes": [
            "#include \"log.h\"",
            "# include <vis.h>",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <syslog.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <fcntl.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n# include <vis.h>\n#include <errno.h>\n#include <unistd.h>\n#include <syslog.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <fcntl.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\ndebug3(const char *fmt,...)\n{\n\tva_list args;\n\n\tva_start(args, fmt);\n\tdo_log(SYSLOG_LEVEL_DEBUG3, fmt, args);\n\tva_end(args);\n}"
        }
      },
      {
        "call_info": {
          "callee": "ssh_packet_need_rekeying",
          "args": [
            "ssh",
            "0"
          ],
          "line": 1666
        },
        "resolved": true,
        "details": {
          "function_name": "ssh_packet_need_rekeying",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
          "lines": "924-969",
          "snippet": "static int\nssh_packet_need_rekeying(struct ssh *ssh, u_int outbound_packet_len)\n{\n\tstruct session_state *state = ssh->state;\n\tu_int32_t out_blocks;\n\n\t/* XXX client can't cope with rekeying pre-auth */\n\tif (!state->after_authentication)\n\t\treturn 0;\n\n\t/* Haven't keyed yet or KEX in progress. */\n\tif (ssh->kex == NULL || ssh_packet_is_rekeying(ssh))\n\t\treturn 0;\n\n\t/* Peer can't rekey */\n\tif (ssh->compat & SSH_BUG_NOREKEY)\n\t\treturn 0;\n\n\t/*\n\t * Permit one packet in or out per rekey - this allows us to\n\t * make progress when rekey limits are very small.\n\t */\n\tif (state->p_send.packets == 0 && state->p_read.packets == 0)\n\t\treturn 0;\n\n\t/* Time-based rekeying */\n\tif (state->rekey_interval != 0 &&\n\t    (int64_t)state->rekey_time + state->rekey_interval <= monotime())\n\t\treturn 1;\n\n\t/*\n\t * Always rekey when MAX_PACKETS sent in either direction \n\t * As per RFC4344 section 3.1 we do this after 2^31 packets.\n\t */\n\tif (state->p_send.packets > MAX_PACKETS ||\n\t    state->p_read.packets > MAX_PACKETS)\n\t\treturn 1;\n\n\t/* Rekey after (cipher-specific) maximum blocks */\n\tout_blocks = ROUNDUP(outbound_packet_len,\n\t    state->newkeys[MODE_OUT]->enc.block_size);\n\treturn (state->max_blocks_out &&\n\t    (state->p_send.blocks + out_blocks > state->max_blocks_out)) ||\n\t    (state->max_blocks_in &&\n\t    (state->p_read.blocks > state->max_blocks_in));\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include \"packet.h\"",
            "#include \"ssh.h\"",
            "#include \"channels.h\"",
            "#include \"misc.h\"",
            "#include \"canohost.h\"",
            "#include \"log.h\"",
            "#include \"mac.h\"",
            "#include \"digest.h\"",
            "#include \"kex.h\"",
            "#include \"sshkey.h\"",
            "#include \"cipher.h\"",
            "#include \"ssh2.h\"",
            "#include \"compat.h\"",
            "#include \"crc32.h\"",
            "#include \"xmalloc.h\"",
            "#include <zlib.h>",
            "#  include <openssl/ec.h>",
            "# include <openssl/evp.h>",
            "# include <openssl/bn.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <limits.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <netdb.h>",
            "#include <errno.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include \"openbsd-compat/sys-queue.h\"",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [
            "#define MAX_PACKETS\t(1U<<31)"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\n#define MAX_PACKETS\t(1U<<31)\n\nstatic int\nssh_packet_need_rekeying(struct ssh *ssh, u_int outbound_packet_len)\n{\n\tstruct session_state *state = ssh->state;\n\tu_int32_t out_blocks;\n\n\t/* XXX client can't cope with rekeying pre-auth */\n\tif (!state->after_authentication)\n\t\treturn 0;\n\n\t/* Haven't keyed yet or KEX in progress. */\n\tif (ssh->kex == NULL || ssh_packet_is_rekeying(ssh))\n\t\treturn 0;\n\n\t/* Peer can't rekey */\n\tif (ssh->compat & SSH_BUG_NOREKEY)\n\t\treturn 0;\n\n\t/*\n\t * Permit one packet in or out per rekey - this allows us to\n\t * make progress when rekey limits are very small.\n\t */\n\tif (state->p_send.packets == 0 && state->p_read.packets == 0)\n\t\treturn 0;\n\n\t/* Time-based rekeying */\n\tif (state->rekey_interval != 0 &&\n\t    (int64_t)state->rekey_time + state->rekey_interval <= monotime())\n\t\treturn 1;\n\n\t/*\n\t * Always rekey when MAX_PACKETS sent in either direction \n\t * As per RFC4344 section 3.1 we do this after 2^31 packets.\n\t */\n\tif (state->p_send.packets > MAX_PACKETS ||\n\t    state->p_read.packets > MAX_PACKETS)\n\t\treturn 1;\n\n\t/* Rekey after (cipher-specific) maximum blocks */\n\tout_blocks = ROUNDUP(outbound_packet_len,\n\t    state->newkeys[MODE_OUT]->enc.block_size);\n\treturn (state->max_blocks_out &&\n\t    (state->p_send.blocks + out_blocks > state->max_blocks_out)) ||\n\t    (state->max_blocks_in &&\n\t    (state->p_read.blocks > state->max_blocks_in));\n}"
        }
      },
      {
        "call_info": {
          "callee": "sshbuf_dump",
          "args": [
            "state->incoming_packet",
            "stderr"
          ],
          "line": 1660
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_dump",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf-misc.c",
          "lines": "65-70",
          "snippet": "void\nsshbuf_dump(struct sshbuf *buf, FILE *f)\n{\n\tfprintf(f, \"buffer %p len = %zu\\n\", buf, sshbuf_len(buf));\n\tsshbuf_dump_data(sshbuf_ptr(buf), sshbuf_len(buf), f);\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include <ctype.h>",
            "#include <resolv.h>",
            "#include <string.h>",
            "#include <limits.h>",
            "#include <stdio.h>",
            "#include <stdint.h>",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include <netinet/in.h>",
            "#include <sys/socket.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include <ctype.h>\n#include <resolv.h>\n#include <string.h>\n#include <limits.h>\n#include <stdio.h>\n#include <stdint.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <netinet/in.h>\n#include <sys/socket.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\nsshbuf_dump(struct sshbuf *buf, FILE *f)\n{\n\tfprintf(f, \"buffer %p len = %zu\\n\", buf, sshbuf_len(buf));\n\tsshbuf_dump_data(sshbuf_ptr(buf), sshbuf_len(buf), f);\n}"
        }
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"read/plain[%d]:\\r\\n\"",
            "*typep"
          ],
          "line": 1659
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ssh_packet_enable_delayed_compress",
          "args": [
            "ssh"
          ],
          "line": 1655
        },
        "resolved": true,
        "details": {
          "function_name": "ssh_packet_enable_delayed_compress",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
          "lines": "976-1007",
          "snippet": "static int\nssh_packet_enable_delayed_compress(struct ssh *ssh)\n{\n\tstruct session_state *state = ssh->state;\n\tstruct sshcomp *comp = NULL;\n\tint r, mode;\n\n\t/*\n\t * Remember that we are past the authentication step, so rekeying\n\t * with COMP_DELAYED will turn on compression immediately.\n\t */\n\tstate->after_authentication = 1;\n\tfor (mode = 0; mode < MODE_MAX; mode++) {\n\t\t/* protocol error: USERAUTH_SUCCESS received before NEWKEYS */\n\t\tif (state->newkeys[mode] == NULL)\n\t\t\tcontinue;\n\t\tcomp = &state->newkeys[mode]->comp;\n\t\tif (comp && !comp->enabled && comp->type == COMP_DELAYED) {\n\t\t\tif ((r = ssh_packet_init_compression(ssh)) != 0)\n\t\t\t\treturn r;\n\t\t\tif (mode == MODE_OUT) {\n\t\t\t\tif ((r = start_compression_out(ssh, 6)) != 0)\n\t\t\t\t\treturn r;\n\t\t\t} else {\n\t\t\t\tif ((r = start_compression_in(ssh)) != 0)\n\t\t\t\t\treturn r;\n\t\t\t}\n\t\t\tcomp->enabled = 1;\n\t\t}\n\t}\n\treturn 0;\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include \"packet.h\"",
            "#include \"ssh.h\"",
            "#include \"channels.h\"",
            "#include \"misc.h\"",
            "#include \"canohost.h\"",
            "#include \"log.h\"",
            "#include \"mac.h\"",
            "#include \"digest.h\"",
            "#include \"kex.h\"",
            "#include \"sshkey.h\"",
            "#include \"cipher.h\"",
            "#include \"ssh2.h\"",
            "#include \"compat.h\"",
            "#include \"crc32.h\"",
            "#include \"xmalloc.h\"",
            "#include <zlib.h>",
            "#  include <openssl/ec.h>",
            "# include <openssl/evp.h>",
            "# include <openssl/bn.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <limits.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <netdb.h>",
            "#include <errno.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include \"openbsd-compat/sys-queue.h\"",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nstatic int\nssh_packet_enable_delayed_compress(struct ssh *ssh)\n{\n\tstruct session_state *state = ssh->state;\n\tstruct sshcomp *comp = NULL;\n\tint r, mode;\n\n\t/*\n\t * Remember that we are past the authentication step, so rekeying\n\t * with COMP_DELAYED will turn on compression immediately.\n\t */\n\tstate->after_authentication = 1;\n\tfor (mode = 0; mode < MODE_MAX; mode++) {\n\t\t/* protocol error: USERAUTH_SUCCESS received before NEWKEYS */\n\t\tif (state->newkeys[mode] == NULL)\n\t\t\tcontinue;\n\t\tcomp = &state->newkeys[mode]->comp;\n\t\tif (comp && !comp->enabled && comp->type == COMP_DELAYED) {\n\t\t\tif ((r = ssh_packet_init_compression(ssh)) != 0)\n\t\t\t\treturn r;\n\t\t\tif (mode == MODE_OUT) {\n\t\t\t\tif ((r = start_compression_out(ssh, 6)) != 0)\n\t\t\t\t\treturn r;\n\t\t\t} else {\n\t\t\t\tif ((r = start_compression_in(ssh)) != 0)\n\t\t\t\t\treturn r;\n\t\t\t}\n\t\t\tcomp->enabled = 1;\n\t\t}\n\t}\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "state->hook_in",
          "args": [
            "ssh",
            "state->incoming_packet",
            "typep",
            "state->hook_in_ctx"
          ],
          "line": 1651
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ssh_packet_write_wait",
          "args": [
            "ssh"
          ],
          "line": 1646
        },
        "resolved": true,
        "details": {
          "function_name": "ssh_packet_write_wait",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
          "lines": "1930-1985",
          "snippet": "int\nssh_packet_write_wait(struct ssh *ssh)\n{\n\tfd_set *setp;\n\tint ret, r, ms_remain = 0;\n\tstruct timeval start, timeout, *timeoutp = NULL;\n\tstruct session_state *state = ssh->state;\n\n\tsetp = calloc(howmany(state->connection_out + 1,\n\t    NFDBITS), sizeof(fd_mask));\n\tif (setp == NULL)\n\t\treturn SSH_ERR_ALLOC_FAIL;\n\tif ((r = ssh_packet_write_poll(ssh)) != 0) {\n\t\tfree(setp);\n\t\treturn r;\n\t}\n\twhile (ssh_packet_have_data_to_write(ssh)) {\n\t\tmemset(setp, 0, howmany(state->connection_out + 1,\n\t\t    NFDBITS) * sizeof(fd_mask));\n\t\tFD_SET(state->connection_out, setp);\n\n\t\tif (state->packet_timeout_ms > 0) {\n\t\t\tms_remain = state->packet_timeout_ms;\n\t\t\ttimeoutp = &timeout;\n\t\t}\n\t\tfor (;;) {\n\t\t\tif (state->packet_timeout_ms != -1) {\n\t\t\t\tms_to_timeval(&timeout, ms_remain);\n\t\t\t\tmonotime_tv(&start);\n\t\t\t}\n\t\t\tif ((ret = select(state->connection_out + 1,\n\t\t\t    NULL, setp, NULL, timeoutp)) >= 0)\n\t\t\t\tbreak;\n\t\t\tif (errno != EAGAIN && errno != EINTR &&\n\t\t\t    errno != EWOULDBLOCK)\n\t\t\t\tbreak;\n\t\t\tif (state->packet_timeout_ms == -1)\n\t\t\t\tcontinue;\n\t\t\tms_subtract_diff(&start, &ms_remain);\n\t\t\tif (ms_remain <= 0) {\n\t\t\t\tret = 0;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tif (ret == 0) {\n\t\t\tfree(setp);\n\t\t\treturn SSH_ERR_CONN_TIMEOUT;\n\t\t}\n\t\tif ((r = ssh_packet_write_poll(ssh)) != 0) {\n\t\t\tfree(setp);\n\t\t\treturn r;\n\t\t}\n\t}\n\tfree(setp);\n\treturn 0;\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include \"packet.h\"",
            "#include \"ssh.h\"",
            "#include \"channels.h\"",
            "#include \"misc.h\"",
            "#include \"canohost.h\"",
            "#include \"log.h\"",
            "#include \"mac.h\"",
            "#include \"digest.h\"",
            "#include \"kex.h\"",
            "#include \"sshkey.h\"",
            "#include \"cipher.h\"",
            "#include \"ssh2.h\"",
            "#include \"compat.h\"",
            "#include \"crc32.h\"",
            "#include \"xmalloc.h\"",
            "#include <zlib.h>",
            "#  include <openssl/ec.h>",
            "# include <openssl/evp.h>",
            "# include <openssl/bn.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <limits.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <netdb.h>",
            "#include <errno.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include \"openbsd-compat/sys-queue.h\"",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nssh_packet_write_wait(struct ssh *ssh)\n{\n\tfd_set *setp;\n\tint ret, r, ms_remain = 0;\n\tstruct timeval start, timeout, *timeoutp = NULL;\n\tstruct session_state *state = ssh->state;\n\n\tsetp = calloc(howmany(state->connection_out + 1,\n\t    NFDBITS), sizeof(fd_mask));\n\tif (setp == NULL)\n\t\treturn SSH_ERR_ALLOC_FAIL;\n\tif ((r = ssh_packet_write_poll(ssh)) != 0) {\n\t\tfree(setp);\n\t\treturn r;\n\t}\n\twhile (ssh_packet_have_data_to_write(ssh)) {\n\t\tmemset(setp, 0, howmany(state->connection_out + 1,\n\t\t    NFDBITS) * sizeof(fd_mask));\n\t\tFD_SET(state->connection_out, setp);\n\n\t\tif (state->packet_timeout_ms > 0) {\n\t\t\tms_remain = state->packet_timeout_ms;\n\t\t\ttimeoutp = &timeout;\n\t\t}\n\t\tfor (;;) {\n\t\t\tif (state->packet_timeout_ms != -1) {\n\t\t\t\tms_to_timeval(&timeout, ms_remain);\n\t\t\t\tmonotime_tv(&start);\n\t\t\t}\n\t\t\tif ((ret = select(state->connection_out + 1,\n\t\t\t    NULL, setp, NULL, timeoutp)) >= 0)\n\t\t\t\tbreak;\n\t\t\tif (errno != EAGAIN && errno != EINTR &&\n\t\t\t    errno != EWOULDBLOCK)\n\t\t\t\tbreak;\n\t\t\tif (state->packet_timeout_ms == -1)\n\t\t\t\tcontinue;\n\t\t\tms_subtract_diff(&start, &ms_remain);\n\t\t\tif (ms_remain <= 0) {\n\t\t\t\tret = 0;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tif (ret == 0) {\n\t\t\tfree(setp);\n\t\t\treturn SSH_ERR_CONN_TIMEOUT;\n\t\t}\n\t\tif ((r = ssh_packet_write_poll(ssh)) != 0) {\n\t\t\tfree(setp);\n\t\t\treturn r;\n\t\t}\n\t}\n\tfree(setp);\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "sshpkt_disconnect",
          "args": [
            "ssh",
            "\"Invalid ssh2 packet type: %d\"",
            "*typep"
          ],
          "line": 1644
        },
        "resolved": true,
        "details": {
          "function_name": "sshpkt_disconnect",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
          "lines": "2656-2674",
          "snippet": "int\nsshpkt_disconnect(struct ssh *ssh, const char *fmt,...)\n{\n\tchar buf[1024];\n\tva_list args;\n\tint r;\n\n\tva_start(args, fmt);\n\tvsnprintf(buf, sizeof(buf), fmt, args);\n\tva_end(args);\n\n\tif ((r = sshpkt_start(ssh, SSH2_MSG_DISCONNECT)) != 0 ||\n\t    (r = sshpkt_put_u32(ssh, SSH2_DISCONNECT_PROTOCOL_ERROR)) != 0 ||\n\t    (r = sshpkt_put_cstring(ssh, buf)) != 0 ||\n\t    (r = sshpkt_put_cstring(ssh, \"\")) != 0 ||\n\t    (r = sshpkt_send(ssh)) != 0)\n\t\treturn r;\n\treturn 0;\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include \"packet.h\"",
            "#include \"ssh.h\"",
            "#include \"channels.h\"",
            "#include \"misc.h\"",
            "#include \"canohost.h\"",
            "#include \"log.h\"",
            "#include \"mac.h\"",
            "#include \"digest.h\"",
            "#include \"kex.h\"",
            "#include \"sshkey.h\"",
            "#include \"cipher.h\"",
            "#include \"ssh2.h\"",
            "#include \"compat.h\"",
            "#include \"crc32.h\"",
            "#include \"xmalloc.h\"",
            "#include <zlib.h>",
            "#  include <openssl/ec.h>",
            "# include <openssl/evp.h>",
            "# include <openssl/bn.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <limits.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <netdb.h>",
            "#include <errno.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include \"openbsd-compat/sys-queue.h\"",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshpkt_disconnect(struct ssh *ssh, const char *fmt,...)\n{\n\tchar buf[1024];\n\tva_list args;\n\tint r;\n\n\tva_start(args, fmt);\n\tvsnprintf(buf, sizeof(buf), fmt, args);\n\tva_end(args);\n\n\tif ((r = sshpkt_start(ssh, SSH2_MSG_DISCONNECT)) != 0 ||\n\t    (r = sshpkt_put_u32(ssh, SSH2_DISCONNECT_PROTOCOL_ERROR)) != 0 ||\n\t    (r = sshpkt_put_cstring(ssh, buf)) != 0 ||\n\t    (r = sshpkt_put_cstring(ssh, \"\")) != 0 ||\n\t    (r = sshpkt_send(ssh)) != 0)\n\t\treturn r;\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "ssh_packet_log_type",
          "args": [
            "*typep"
          ],
          "line": 1641
        },
        "resolved": true,
        "details": {
          "function_name": "ssh_packet_log_type",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
          "lines": "1010-1021",
          "snippet": "int\nssh_packet_log_type(u_char type)\n{\n\tswitch (type) {\n\tcase SSH2_MSG_CHANNEL_DATA:\n\tcase SSH2_MSG_CHANNEL_EXTENDED_DATA:\n\tcase SSH2_MSG_CHANNEL_WINDOW_ADJUST:\n\t\treturn 0;\n\tdefault:\n\t\treturn 1;\n\t}\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include \"packet.h\"",
            "#include \"ssh.h\"",
            "#include \"channels.h\"",
            "#include \"misc.h\"",
            "#include \"canohost.h\"",
            "#include \"log.h\"",
            "#include \"mac.h\"",
            "#include \"digest.h\"",
            "#include \"kex.h\"",
            "#include \"sshkey.h\"",
            "#include \"cipher.h\"",
            "#include \"ssh2.h\"",
            "#include \"compat.h\"",
            "#include \"crc32.h\"",
            "#include \"xmalloc.h\"",
            "#include <zlib.h>",
            "#  include <openssl/ec.h>",
            "# include <openssl/evp.h>",
            "# include <openssl/bn.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <limits.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <netdb.h>",
            "#include <errno.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include \"openbsd-compat/sys-queue.h\"",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nssh_packet_log_type(u_char type)\n{\n\tswitch (type) {\n\tcase SSH2_MSG_CHANNEL_DATA:\n\tcase SSH2_MSG_CHANNEL_EXTENDED_DATA:\n\tcase SSH2_MSG_CHANNEL_WINDOW_ADJUST:\n\t\treturn 0;\n\tdefault:\n\t\treturn 1;\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "sshbuf_get_u8",
          "args": [
            "state->incoming_packet",
            "typep"
          ],
          "line": 1639
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_get_u8",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf-getput-basic.c",
          "lines": "83-94",
          "snippet": "int\nsshbuf_get_u8(struct sshbuf *buf, u_char *valp)\n{\n\tconst u_char *p = sshbuf_ptr(buf);\n\tint r;\n\n\tif ((r = sshbuf_consume(buf, 1)) < 0)\n\t\treturn r;\n\tif (valp != NULL)\n\t\t*valp = (u_int8_t)*p;\n\treturn 0;\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <stdarg.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <stdarg.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshbuf_get_u8(struct sshbuf *buf, u_char *valp)\n{\n\tconst u_char *p = sshbuf_ptr(buf);\n\tint r;\n\n\tif ((r = sshbuf_consume(buf, 1)) < 0)\n\t\treturn r;\n\tif (valp != NULL)\n\t\t*valp = (u_int8_t)*p;\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "debug(\"input: len after de-compress %zd\",\n\t\t    sshbuf_len(state->incoming_packet))"
          ],
          "line": 1632
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug",
          "args": [
            "\"input: len after de-compress %zd\"",
            "sshbuf_len(state->incoming_packet)"
          ],
          "line": 1632
        },
        "resolved": true,
        "details": {
          "function_name": "ssh_packet_send_debug",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
          "lines": "1771-1794",
          "snippet": "void\nssh_packet_send_debug(struct ssh *ssh, const char *fmt,...)\n{\n\tchar buf[1024];\n\tva_list args;\n\tint r;\n\n\tif ((ssh->compat & SSH_BUG_DEBUG))\n\t\treturn;\n\n\tva_start(args, fmt);\n\tvsnprintf(buf, sizeof(buf), fmt, args);\n\tva_end(args);\n\n\tdebug3(\"sending debug message: %s\", buf);\n\n\tif ((r = sshpkt_start(ssh, SSH2_MSG_DEBUG)) != 0 ||\n\t    (r = sshpkt_put_u8(ssh, 0)) != 0 || /* always display */\n\t    (r = sshpkt_put_cstring(ssh, buf)) != 0 ||\n\t    (r = sshpkt_put_cstring(ssh, \"\")) != 0 ||\n\t    (r = sshpkt_send(ssh)) != 0 ||\n\t    (r = ssh_packet_write_wait(ssh)) != 0)\n\t\tfatal(\"%s: %s\", __func__, ssh_err(r));\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include \"packet.h\"",
            "#include \"ssh.h\"",
            "#include \"channels.h\"",
            "#include \"misc.h\"",
            "#include \"canohost.h\"",
            "#include \"log.h\"",
            "#include \"mac.h\"",
            "#include \"digest.h\"",
            "#include \"kex.h\"",
            "#include \"sshkey.h\"",
            "#include \"cipher.h\"",
            "#include \"ssh2.h\"",
            "#include \"compat.h\"",
            "#include \"crc32.h\"",
            "#include \"xmalloc.h\"",
            "#include <zlib.h>",
            "#  include <openssl/ec.h>",
            "# include <openssl/evp.h>",
            "# include <openssl/bn.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <limits.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <netdb.h>",
            "#include <errno.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include \"openbsd-compat/sys-queue.h\"",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\nssh_packet_send_debug(struct ssh *ssh, const char *fmt,...)\n{\n\tchar buf[1024];\n\tva_list args;\n\tint r;\n\n\tif ((ssh->compat & SSH_BUG_DEBUG))\n\t\treturn;\n\n\tva_start(args, fmt);\n\tvsnprintf(buf, sizeof(buf), fmt, args);\n\tva_end(args);\n\n\tdebug3(\"sending debug message: %s\", buf);\n\n\tif ((r = sshpkt_start(ssh, SSH2_MSG_DEBUG)) != 0 ||\n\t    (r = sshpkt_put_u8(ssh, 0)) != 0 || /* always display */\n\t    (r = sshpkt_put_cstring(ssh, buf)) != 0 ||\n\t    (r = sshpkt_put_cstring(ssh, \"\")) != 0 ||\n\t    (r = sshpkt_send(ssh)) != 0 ||\n\t    (r = ssh_packet_write_wait(ssh)) != 0)\n\t\tfatal(\"%s: %s\", __func__, ssh_err(r));\n}"
        }
      },
      {
        "call_info": {
          "callee": "sshbuf_len",
          "args": [
            "state->incoming_packet"
          ],
          "line": 1633
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_len",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf.c",
          "lines": "252-258",
          "snippet": "size_t\nsshbuf_len(const struct sshbuf *buf)\n{\n\tif (sshbuf_check_sanity(buf) != 0)\n\t\treturn 0;\n\treturn buf->size - buf->off;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <signal.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <signal.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nsize_t\nsshbuf_len(const struct sshbuf *buf)\n{\n\tif (sshbuf_check_sanity(buf) != 0)\n\t\treturn 0;\n\treturn buf->size - buf->off;\n}"
        }
      },
      {
        "call_info": {
          "callee": "sshbuf_putb",
          "args": [
            "state->incoming_packet",
            "state->compression_buffer"
          ],
          "line": 1629
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_putb",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf-getput-basic.c",
          "lines": "248-252",
          "snippet": "int\nsshbuf_putb(struct sshbuf *buf, const struct sshbuf *v)\n{\n\treturn sshbuf_put(buf, sshbuf_ptr(v), sshbuf_len(v));\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <stdarg.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <stdarg.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshbuf_putb(struct sshbuf *buf, const struct sshbuf *v)\n{\n\treturn sshbuf_put(buf, sshbuf_ptr(v), sshbuf_len(v));\n}"
        }
      },
      {
        "call_info": {
          "callee": "sshbuf_reset",
          "args": [
            "state->incoming_packet"
          ],
          "line": 1628
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_reset",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf.c",
          "lines": "168-188",
          "snippet": "void\nsshbuf_reset(struct sshbuf *buf)\n{\n\tu_char *d;\n\n\tif (buf->readonly || buf->refcount > 1) {\n\t\t/* Nonsensical. Just make buffer appear empty */\n\t\tbuf->off = buf->size;\n\t\treturn;\n\t}\n\t(void) sshbuf_check_sanity(buf);\n\tbuf->off = buf->size = 0;\n\tif (buf->alloc != SSHBUF_SIZE_INIT) {\n\t\tif ((d = recallocarray(buf->d, buf->alloc, SSHBUF_SIZE_INIT,\n\t\t    1)) != NULL) {\n\t\t\tbuf->cd = buf->d = d;\n\t\t\tbuf->alloc = SSHBUF_SIZE_INIT;\n\t\t}\n\t}\n\texplicit_bzero(buf->d, SSHBUF_SIZE_INIT);\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <signal.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <signal.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\nsshbuf_reset(struct sshbuf *buf)\n{\n\tu_char *d;\n\n\tif (buf->readonly || buf->refcount > 1) {\n\t\t/* Nonsensical. Just make buffer appear empty */\n\t\tbuf->off = buf->size;\n\t\treturn;\n\t}\n\t(void) sshbuf_check_sanity(buf);\n\tbuf->off = buf->size = 0;\n\tif (buf->alloc != SSHBUF_SIZE_INIT) {\n\t\tif ((d = recallocarray(buf->d, buf->alloc, SSHBUF_SIZE_INIT,\n\t\t    1)) != NULL) {\n\t\t\tbuf->cd = buf->d = d;\n\t\t\tbuf->alloc = SSHBUF_SIZE_INIT;\n\t\t}\n\t}\n\texplicit_bzero(buf->d, SSHBUF_SIZE_INIT);\n}"
        }
      },
      {
        "call_info": {
          "callee": "uncompress_buffer",
          "args": [
            "ssh",
            "state->incoming_packet",
            "state->compression_buffer"
          ],
          "line": 1625
        },
        "resolved": true,
        "details": {
          "function_name": "uncompress_buffer",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
          "lines": "772-817",
          "snippet": "static int\nuncompress_buffer(struct ssh *ssh, struct sshbuf *in, struct sshbuf *out)\n{\n\tu_char buf[4096];\n\tint r, status;\n\n\tif (ssh->state->compression_in_started != 1)\n\t\treturn SSH_ERR_INTERNAL_ERROR;\n\n\tif ((ssh->state->compression_in_stream.next_in =\n\t    sshbuf_mutable_ptr(in)) == NULL)\n\t\treturn SSH_ERR_INTERNAL_ERROR;\n\tssh->state->compression_in_stream.avail_in = sshbuf_len(in);\n\n\tfor (;;) {\n\t\t/* Set up fixed-size output buffer. */\n\t\tssh->state->compression_in_stream.next_out = buf;\n\t\tssh->state->compression_in_stream.avail_out = sizeof(buf);\n\n\t\tstatus = inflate(&ssh->state->compression_in_stream,\n\t\t    Z_PARTIAL_FLUSH);\n\t\tswitch (status) {\n\t\tcase Z_OK:\n\t\t\tif ((r = sshbuf_put(out, buf, sizeof(buf) -\n\t\t\t    ssh->state->compression_in_stream.avail_out)) != 0)\n\t\t\t\treturn r;\n\t\t\tbreak;\n\t\tcase Z_BUF_ERROR:\n\t\t\t/*\n\t\t\t * Comments in zlib.h say that we should keep calling\n\t\t\t * inflate() until we get an error.  This appears to\n\t\t\t * be the error that we get.\n\t\t\t */\n\t\t\treturn 0;\n\t\tcase Z_DATA_ERROR:\n\t\t\treturn SSH_ERR_INVALID_FORMAT;\n\t\tcase Z_MEM_ERROR:\n\t\t\treturn SSH_ERR_ALLOC_FAIL;\n\t\tcase Z_STREAM_ERROR:\n\t\tdefault:\n\t\t\tssh->state->compression_in_failures++;\n\t\t\treturn SSH_ERR_INTERNAL_ERROR;\n\t\t}\n\t}\n\t/* NOTREACHED */\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include \"packet.h\"",
            "#include \"ssh.h\"",
            "#include \"channels.h\"",
            "#include \"misc.h\"",
            "#include \"canohost.h\"",
            "#include \"log.h\"",
            "#include \"mac.h\"",
            "#include \"digest.h\"",
            "#include \"kex.h\"",
            "#include \"sshkey.h\"",
            "#include \"cipher.h\"",
            "#include \"ssh2.h\"",
            "#include \"compat.h\"",
            "#include \"crc32.h\"",
            "#include \"xmalloc.h\"",
            "#include <zlib.h>",
            "#  include <openssl/ec.h>",
            "# include <openssl/evp.h>",
            "# include <openssl/bn.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <limits.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <netdb.h>",
            "#include <errno.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include \"openbsd-compat/sys-queue.h\"",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nstatic int\nuncompress_buffer(struct ssh *ssh, struct sshbuf *in, struct sshbuf *out)\n{\n\tu_char buf[4096];\n\tint r, status;\n\n\tif (ssh->state->compression_in_started != 1)\n\t\treturn SSH_ERR_INTERNAL_ERROR;\n\n\tif ((ssh->state->compression_in_stream.next_in =\n\t    sshbuf_mutable_ptr(in)) == NULL)\n\t\treturn SSH_ERR_INTERNAL_ERROR;\n\tssh->state->compression_in_stream.avail_in = sshbuf_len(in);\n\n\tfor (;;) {\n\t\t/* Set up fixed-size output buffer. */\n\t\tssh->state->compression_in_stream.next_out = buf;\n\t\tssh->state->compression_in_stream.avail_out = sizeof(buf);\n\n\t\tstatus = inflate(&ssh->state->compression_in_stream,\n\t\t    Z_PARTIAL_FLUSH);\n\t\tswitch (status) {\n\t\tcase Z_OK:\n\t\t\tif ((r = sshbuf_put(out, buf, sizeof(buf) -\n\t\t\t    ssh->state->compression_in_stream.avail_out)) != 0)\n\t\t\t\treturn r;\n\t\t\tbreak;\n\t\tcase Z_BUF_ERROR:\n\t\t\t/*\n\t\t\t * Comments in zlib.h say that we should keep calling\n\t\t\t * inflate() until we get an error.  This appears to\n\t\t\t * be the error that we get.\n\t\t\t */\n\t\t\treturn 0;\n\t\tcase Z_DATA_ERROR:\n\t\t\treturn SSH_ERR_INVALID_FORMAT;\n\t\tcase Z_MEM_ERROR:\n\t\t\treturn SSH_ERR_ALLOC_FAIL;\n\t\tcase Z_STREAM_ERROR:\n\t\tdefault:\n\t\t\tssh->state->compression_in_failures++;\n\t\t\treturn SSH_ERR_INTERNAL_ERROR;\n\t\t}\n\t}\n\t/* NOTREACHED */\n}"
        }
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "debug(\"input: len before de-compress %zd\",\n\t    sshbuf_len(state->incoming_packet))"
          ],
          "line": 1621
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sshbuf_consume_end",
          "args": [
            "state->incoming_packet",
            "padlen"
          ],
          "line": 1618
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_consume_end",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf.c",
          "lines": "383-398",
          "snippet": "int\nsshbuf_consume_end(struct sshbuf *buf, size_t len)\n{\n\tint r;\n\n\tSSHBUF_DBG((\"len = %zu\", len));\n\tif ((r = sshbuf_check_sanity(buf)) != 0)\n\t\treturn r;\n\tif (len == 0)\n\t\treturn 0;\n\tif (len > sshbuf_len(buf))\n\t\treturn SSH_ERR_MESSAGE_INCOMPLETE;\n\tbuf->size -= len;\n\tSSHBUF_TELL(\"done\");\n\treturn 0;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <signal.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <signal.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshbuf_consume_end(struct sshbuf *buf, size_t len)\n{\n\tint r;\n\n\tSSHBUF_DBG((\"len = %zu\", len));\n\tif ((r = sshbuf_check_sanity(buf)) != 0)\n\t\treturn r;\n\tif (len == 0)\n\t\treturn 0;\n\tif (len > sshbuf_len(buf))\n\t\treturn SSH_ERR_MESSAGE_INCOMPLETE;\n\tbuf->size -= len;\n\tSSHBUF_TELL(\"done\");\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "debug(\"input: padlen %d\", padlen)"
          ],
          "line": 1607
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sshbuf_ptr",
          "args": [
            "state->incoming_packet"
          ],
          "line": 1606
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_ptr",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf.c",
          "lines": "268-274",
          "snippet": "const u_char *\nsshbuf_ptr(const struct sshbuf *buf)\n{\n\tif (sshbuf_check_sanity(buf) != 0)\n\t\treturn NULL;\n\treturn buf->cd + buf->off;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <signal.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <signal.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nconst u_char *\nsshbuf_ptr(const struct sshbuf *buf)\n{\n\tif (sshbuf_check_sanity(buf) != 0)\n\t\treturn NULL;\n\treturn buf->cd + buf->off;\n}"
        }
      },
      {
        "call_info": {
          "callee": "logit",
          "args": [
            "\"incoming seqnr wraps around\""
          ],
          "line": 1598
        },
        "resolved": true,
        "details": {
          "function_name": "logit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/log.c",
          "lines": "198-206",
          "snippet": "void\nlogit(const char *fmt,...)\n{\n\tva_list args;\n\n\tva_start(args, fmt);\n\tdo_log(SYSLOG_LEVEL_INFO, fmt, args);\n\tva_end(args);\n}",
          "includes": [
            "#include \"log.h\"",
            "# include <vis.h>",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <syslog.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <fcntl.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n# include <vis.h>\n#include <errno.h>\n#include <unistd.h>\n#include <syslog.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <fcntl.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\nlogit(const char *fmt,...)\n{\n\tva_list args;\n\n\tva_start(args, fmt);\n\tdo_log(SYSLOG_LEVEL_INFO, fmt, args);\n\tva_end(args);\n}"
        }
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "debug(\"MAC #%d ok\", state->p_read.seqnr)"
          ],
          "line": 1591
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ssh_packet_start_discard",
          "args": [
            "ssh",
            "enc",
            "mac",
            "sshbuf_len(state->incoming_packet)",
            "PACKET_MAX_SIZE - need - block_size"
          ],
          "line": 1586
        },
        "resolved": true,
        "details": {
          "function_name": "ssh_packet_start_discard",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
          "lines": "393-417",
          "snippet": "static int\nssh_packet_start_discard(struct ssh *ssh, struct sshenc *enc,\n    struct sshmac *mac, size_t mac_already, u_int discard)\n{\n\tstruct session_state *state = ssh->state;\n\tint r;\n\n\tif (enc == NULL || !cipher_is_cbc(enc->cipher) || (mac && mac->etm)) {\n\t\tif ((r = sshpkt_disconnect(ssh, \"Packet corrupt\")) != 0)\n\t\t\treturn r;\n\t\treturn SSH_ERR_MAC_INVALID;\n\t}\n\t/*\n\t * Record number of bytes over which the mac has already\n\t * been computed in order to minimize timing attacks.\n\t */\n\tif (mac && mac->enabled) {\n\t\tstate->packet_discard_mac = mac;\n\t\tstate->packet_discard_mac_already = mac_already;\n\t}\n\tif (sshbuf_len(state->input) >= discard)\n\t\treturn ssh_packet_stop_discard(ssh);\n\tstate->packet_discard = discard - sshbuf_len(state->input);\n\treturn 0;\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include \"packet.h\"",
            "#include \"ssh.h\"",
            "#include \"channels.h\"",
            "#include \"misc.h\"",
            "#include \"canohost.h\"",
            "#include \"log.h\"",
            "#include \"mac.h\"",
            "#include \"digest.h\"",
            "#include \"kex.h\"",
            "#include \"sshkey.h\"",
            "#include \"cipher.h\"",
            "#include \"ssh2.h\"",
            "#include \"compat.h\"",
            "#include \"crc32.h\"",
            "#include \"xmalloc.h\"",
            "#include <zlib.h>",
            "#  include <openssl/ec.h>",
            "# include <openssl/evp.h>",
            "# include <openssl/bn.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <limits.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <netdb.h>",
            "#include <errno.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include \"openbsd-compat/sys-queue.h\"",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nstatic int\nssh_packet_start_discard(struct ssh *ssh, struct sshenc *enc,\n    struct sshmac *mac, size_t mac_already, u_int discard)\n{\n\tstruct session_state *state = ssh->state;\n\tint r;\n\n\tif (enc == NULL || !cipher_is_cbc(enc->cipher) || (mac && mac->etm)) {\n\t\tif ((r = sshpkt_disconnect(ssh, \"Packet corrupt\")) != 0)\n\t\t\treturn r;\n\t\treturn SSH_ERR_MAC_INVALID;\n\t}\n\t/*\n\t * Record number of bytes over which the mac has already\n\t * been computed in order to minimize timing attacks.\n\t */\n\tif (mac && mac->enabled) {\n\t\tstate->packet_discard_mac = mac;\n\t\tstate->packet_discard_mac_already = mac_already;\n\t}\n\tif (sshbuf_len(state->input) >= discard)\n\t\treturn ssh_packet_stop_discard(ssh);\n\tstate->packet_discard = discard - sshbuf_len(state->input);\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "mac_check",
          "args": [
            "mac",
            "state->p_read.seqnr",
            "sshbuf_ptr(state->incoming_packet)",
            "sshbuf_len(state->incoming_packet)",
            "sshbuf_ptr(state->input)",
            "maclen"
          ],
          "line": 1577
        },
        "resolved": true,
        "details": {
          "function_name": "mac_check",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/mac.c",
          "lines": "212-228",
          "snippet": "int\nmac_check(struct sshmac *mac, u_int32_t seqno,\n    const u_char *data, size_t dlen,\n    const u_char *theirmac, size_t mlen)\n{\n\tu_char ourmac[SSH_DIGEST_MAX_LENGTH];\n\tint r;\n\n\tif (mac->mac_len > mlen)\n\t\treturn SSH_ERR_INVALID_ARGUMENT;\n\tif ((r = mac_compute(mac, seqno, data, dlen,\n\t    ourmac, sizeof(ourmac))) != 0)\n\t\treturn r;\n\tif (timingsafe_bcmp(ourmac, theirmac, mac->mac_len) != 0)\n\t\treturn SSH_ERR_MAC_INVALID;\n\treturn 0;\n}",
          "includes": [
            "#include \"openbsd-compat/openssl-compat.h\"",
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include \"misc.h\"",
            "#include \"mac.h\"",
            "#include \"umac.h\"",
            "#include \"hmac.h\"",
            "#include \"digest.h\"",
            "#include <stdio.h>",
            "#include <string.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"openbsd-compat/openssl-compat.h\"\n#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"misc.h\"\n#include \"mac.h\"\n#include \"umac.h\"\n#include \"hmac.h\"\n#include \"digest.h\"\n#include <stdio.h>\n#include <string.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nmac_check(struct sshmac *mac, u_int32_t seqno,\n    const u_char *data, size_t dlen,\n    const u_char *theirmac, size_t mlen)\n{\n\tu_char ourmac[SSH_DIGEST_MAX_LENGTH];\n\tint r;\n\n\tif (mac->mac_len > mlen)\n\t\treturn SSH_ERR_INVALID_ARGUMENT;\n\tif ((r = mac_compute(mac, seqno, data, dlen,\n\t    ourmac, sizeof(ourmac))) != 0)\n\t\treturn r;\n\tif (timingsafe_bcmp(ourmac, theirmac, mac->mac_len) != 0)\n\t\treturn SSH_ERR_MAC_INVALID;\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "cipher_crypt",
          "args": [
            "state->receive_context",
            "state->p_read.seqnr",
            "cp",
            "sshbuf_ptr(state->input)",
            "need",
            "aadlen",
            "authlen"
          ],
          "line": 1570
        },
        "resolved": true,
        "details": {
          "function_name": "cipher_crypt",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/cipher.c",
          "lines": "334-394",
          "snippet": "int\ncipher_crypt(struct sshcipher_ctx *cc, u_int seqnr, u_char *dest,\n   const u_char *src, u_int len, u_int aadlen, u_int authlen)\n{\n\tif ((cc->cipher->flags & CFLAG_CHACHAPOLY) != 0) {\n\t\treturn chachapoly_crypt(&cc->cp_ctx, seqnr, dest, src,\n\t\t    len, aadlen, authlen, cc->encrypt);\n\t}\n\tif ((cc->cipher->flags & CFLAG_NONE) != 0) {\n\t\tmemcpy(dest, src, aadlen + len);\n\t\treturn 0;\n\t}\n#ifndef WITH_OPENSSL\n\tif ((cc->cipher->flags & CFLAG_AESCTR) != 0) {\n\t\tif (aadlen)\n\t\t\tmemcpy(dest, src, aadlen);\n\t\taesctr_encrypt_bytes(&cc->ac_ctx, src + aadlen,\n\t\t    dest + aadlen, len);\n\t\treturn 0;\n\t}\n\treturn SSH_ERR_INVALID_ARGUMENT;\n#else\n\tif (authlen) {\n\t\tu_char lastiv[1];\n\n\t\tif (authlen != cipher_authlen(cc->cipher))\n\t\t\treturn SSH_ERR_INVALID_ARGUMENT;\n\t\t/* increment IV */\n\t\tif (!EVP_CIPHER_CTX_ctrl(cc->evp, EVP_CTRL_GCM_IV_GEN,\n\t\t    1, lastiv))\n\t\t\treturn SSH_ERR_LIBCRYPTO_ERROR;\n\t\t/* set tag on decyption */\n\t\tif (!cc->encrypt &&\n\t\t    !EVP_CIPHER_CTX_ctrl(cc->evp, EVP_CTRL_GCM_SET_TAG,\n\t\t    authlen, (u_char *)src + aadlen + len))\n\t\t\treturn SSH_ERR_LIBCRYPTO_ERROR;\n\t}\n\tif (aadlen) {\n\t\tif (authlen &&\n\t\t    EVP_Cipher(cc->evp, NULL, (u_char *)src, aadlen) < 0)\n\t\t\treturn SSH_ERR_LIBCRYPTO_ERROR;\n\t\tmemcpy(dest, src, aadlen);\n\t}\n\tif (len % cc->cipher->block_size)\n\t\treturn SSH_ERR_INVALID_ARGUMENT;\n\tif (EVP_Cipher(cc->evp, dest + aadlen, (u_char *)src + aadlen,\n\t    len) < 0)\n\t\treturn SSH_ERR_LIBCRYPTO_ERROR;\n\tif (authlen) {\n\t\t/* compute tag (on encrypt) or verify tag (on decrypt) */\n\t\tif (EVP_Cipher(cc->evp, NULL, NULL, 0) < 0)\n\t\t\treturn cc->encrypt ?\n\t\t\t    SSH_ERR_LIBCRYPTO_ERROR : SSH_ERR_MAC_INVALID;\n\t\tif (cc->encrypt &&\n\t\t    !EVP_CIPHER_CTX_ctrl(cc->evp, EVP_CTRL_GCM_GET_TAG,\n\t\t    authlen, dest + aadlen + len))\n\t\t\treturn SSH_ERR_LIBCRYPTO_ERROR;\n\t}\n\treturn 0;\n#endif\n}",
          "includes": [
            "#include \"openbsd-compat/openssl-compat.h\"",
            "#include \"digest.h\"",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"misc.h\"",
            "#include \"cipher.h\"",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <string.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [
            "#define CFLAG_NONE\t\t(1<<3)",
            "#define CFLAG_AESCTR\t\t(1<<2)",
            "#define CFLAG_CHACHAPOLY\t(1<<1)"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"openbsd-compat/openssl-compat.h\"\n#include \"digest.h\"\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"misc.h\"\n#include \"cipher.h\"\n#include <stdio.h>\n#include <stdarg.h>\n#include <string.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\n#define CFLAG_NONE\t\t(1<<3)\n#define CFLAG_AESCTR\t\t(1<<2)\n#define CFLAG_CHACHAPOLY\t(1<<1)\n\nint\ncipher_crypt(struct sshcipher_ctx *cc, u_int seqnr, u_char *dest,\n   const u_char *src, u_int len, u_int aadlen, u_int authlen)\n{\n\tif ((cc->cipher->flags & CFLAG_CHACHAPOLY) != 0) {\n\t\treturn chachapoly_crypt(&cc->cp_ctx, seqnr, dest, src,\n\t\t    len, aadlen, authlen, cc->encrypt);\n\t}\n\tif ((cc->cipher->flags & CFLAG_NONE) != 0) {\n\t\tmemcpy(dest, src, aadlen + len);\n\t\treturn 0;\n\t}\n#ifndef WITH_OPENSSL\n\tif ((cc->cipher->flags & CFLAG_AESCTR) != 0) {\n\t\tif (aadlen)\n\t\t\tmemcpy(dest, src, aadlen);\n\t\taesctr_encrypt_bytes(&cc->ac_ctx, src + aadlen,\n\t\t    dest + aadlen, len);\n\t\treturn 0;\n\t}\n\treturn SSH_ERR_INVALID_ARGUMENT;\n#else\n\tif (authlen) {\n\t\tu_char lastiv[1];\n\n\t\tif (authlen != cipher_authlen(cc->cipher))\n\t\t\treturn SSH_ERR_INVALID_ARGUMENT;\n\t\t/* increment IV */\n\t\tif (!EVP_CIPHER_CTX_ctrl(cc->evp, EVP_CTRL_GCM_IV_GEN,\n\t\t    1, lastiv))\n\t\t\treturn SSH_ERR_LIBCRYPTO_ERROR;\n\t\t/* set tag on decyption */\n\t\tif (!cc->encrypt &&\n\t\t    !EVP_CIPHER_CTX_ctrl(cc->evp, EVP_CTRL_GCM_SET_TAG,\n\t\t    authlen, (u_char *)src + aadlen + len))\n\t\t\treturn SSH_ERR_LIBCRYPTO_ERROR;\n\t}\n\tif (aadlen) {\n\t\tif (authlen &&\n\t\t    EVP_Cipher(cc->evp, NULL, (u_char *)src, aadlen) < 0)\n\t\t\treturn SSH_ERR_LIBCRYPTO_ERROR;\n\t\tmemcpy(dest, src, aadlen);\n\t}\n\tif (len % cc->cipher->block_size)\n\t\treturn SSH_ERR_INVALID_ARGUMENT;\n\tif (EVP_Cipher(cc->evp, dest + aadlen, (u_char *)src + aadlen,\n\t    len) < 0)\n\t\treturn SSH_ERR_LIBCRYPTO_ERROR;\n\tif (authlen) {\n\t\t/* compute tag (on encrypt) or verify tag (on decrypt) */\n\t\tif (EVP_Cipher(cc->evp, NULL, NULL, 0) < 0)\n\t\t\treturn cc->encrypt ?\n\t\t\t    SSH_ERR_LIBCRYPTO_ERROR : SSH_ERR_MAC_INVALID;\n\t\tif (cc->encrypt &&\n\t\t    !EVP_CIPHER_CTX_ctrl(cc->evp, EVP_CTRL_GCM_GET_TAG,\n\t\t    authlen, dest + aadlen + len))\n\t\t\treturn SSH_ERR_LIBCRYPTO_ERROR;\n\t}\n\treturn 0;\n#endif\n}"
        }
      },
      {
        "call_info": {
          "callee": "sshbuf_reserve",
          "args": [
            "state->incoming_packet",
            "aadlen + need",
            "&cp"
          ],
          "line": 1567
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_reserve",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf.c",
          "lines": "343-361",
          "snippet": "int\nsshbuf_reserve(struct sshbuf *buf, size_t len, u_char **dpp)\n{\n\tu_char *dp;\n\tint r;\n\n\tif (dpp != NULL)\n\t\t*dpp = NULL;\n\n\tSSHBUF_DBG((\"reserve buf = %p len = %zu\", buf, len));\n\tif ((r = sshbuf_allocate(buf, len)) != 0)\n\t\treturn r;\n\n\tdp = buf->d + buf->size;\n\tbuf->size += len;\n\tif (dpp != NULL)\n\t\t*dpp = dp;\n\treturn 0;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <signal.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <signal.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshbuf_reserve(struct sshbuf *buf, size_t len, u_char **dpp)\n{\n\tu_char *dp;\n\tint r;\n\n\tif (dpp != NULL)\n\t\t*dpp = NULL;\n\n\tSSHBUF_DBG((\"reserve buf = %p len = %zu\", buf, len));\n\tif ((r = sshbuf_allocate(buf, len)) != 0)\n\t\treturn r;\n\n\tdp = buf->d + buf->size;\n\tbuf->size += len;\n\tif (dpp != NULL)\n\t\t*dpp = dp;\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"read_poll enc/full: \""
          ],
          "line": 1553
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "debug(\"partial packet: block %d, need %d, maclen %d, authlen %d,\"\n\t    \" aadlen %d\", block_size, need, maclen, authlen, aadlen)"
          ],
          "line": 1534
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "debug(\"input: packet len %u\", state->packlen+4)"
          ],
          "line": 1522
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"incoming_packet: \\n\""
          ],
          "line": 1512
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"input: \\n\""
          ],
          "line": 1510
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "PEEK_U32",
          "args": [
            "sshbuf_ptr(state->incoming_packet)"
          ],
          "line": 1506
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "cipher_get_length",
          "args": [
            "state->receive_context",
            "&state->packlen",
            "state->p_read.seqnr",
            "sshbuf_ptr(state->input)",
            "sshbuf_len(state->input)"
          ],
          "line": 1476
        },
        "resolved": true,
        "details": {
          "function_name": "cipher_get_length",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/cipher.c",
          "lines": "397-408",
          "snippet": "int\ncipher_get_length(struct sshcipher_ctx *cc, u_int *plenp, u_int seqnr,\n    const u_char *cp, u_int len)\n{\n\tif ((cc->cipher->flags & CFLAG_CHACHAPOLY) != 0)\n\t\treturn chachapoly_get_length(&cc->cp_ctx, plenp, seqnr,\n\t\t    cp, len);\n\tif (len < 4)\n\t\treturn SSH_ERR_MESSAGE_INCOMPLETE;\n\t*plenp = PEEK_U32(cp);\n\treturn 0;\n}",
          "includes": [
            "#include \"openbsd-compat/openssl-compat.h\"",
            "#include \"digest.h\"",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"misc.h\"",
            "#include \"cipher.h\"",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <string.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [
            "#define CFLAG_CHACHAPOLY\t(1<<1)"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"openbsd-compat/openssl-compat.h\"\n#include \"digest.h\"\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"misc.h\"\n#include \"cipher.h\"\n#include <stdio.h>\n#include <stdarg.h>\n#include <string.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\n#define CFLAG_CHACHAPOLY\t(1<<1)\n\nint\ncipher_get_length(struct sshcipher_ctx *cc, u_int *plenp, u_int seqnr,\n    const u_char *cp, u_int len)\n{\n\tif ((cc->cipher->flags & CFLAG_CHACHAPOLY) != 0)\n\t\treturn chachapoly_get_length(&cc->cp_ctx, plenp, seqnr,\n\t\t    cp, len);\n\tif (len < 4)\n\t\treturn SSH_ERR_MESSAGE_INCOMPLETE;\n\t*plenp = PEEK_U32(cp);\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "cipher_authlen",
          "args": [
            "enc->cipher"
          ],
          "line": 1468
        },
        "resolved": true,
        "details": {
          "function_name": "cipher_authlen",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/cipher.c",
          "lines": "163-167",
          "snippet": "u_int\ncipher_authlen(const struct sshcipher *c)\n{\n\treturn (c->auth_len);\n}",
          "includes": [
            "#include \"openbsd-compat/openssl-compat.h\"",
            "#include \"digest.h\"",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"misc.h\"",
            "#include \"cipher.h\"",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <string.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"openbsd-compat/openssl-compat.h\"\n#include \"digest.h\"\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"misc.h\"\n#include \"cipher.h\"\n#include <stdio.h>\n#include <stdarg.h>\n#include <string.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nu_int\ncipher_authlen(const struct sshcipher *c)\n{\n\treturn (c->auth_len);\n}"
        }
      },
      {
        "call_info": {
          "callee": "ssh_packet_read_poll2_mux",
          "args": [
            "ssh",
            "typep",
            "seqnr_p"
          ],
          "line": 1456
        },
        "resolved": true,
        "details": {
          "function_name": "ssh_packet_read_poll2_mux",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
          "lines": "1405-1441",
          "snippet": "static int\nssh_packet_read_poll2_mux(struct ssh *ssh, u_char *typep, u_int32_t *seqnr_p)\n{\n\tstruct session_state *state = ssh->state;\n\tconst u_char *cp;\n\tsize_t need;\n\tint r;\n\n\tif (ssh->kex)\n\t\treturn SSH_ERR_INTERNAL_ERROR;\n\t*typep = SSH_MSG_NONE;\n\tcp = sshbuf_ptr(state->input);\n\tif (state->packlen == 0) {\n\t\tif (sshbuf_len(state->input) < 4 + 1)\n\t\t\treturn 0; /* packet is incomplete */\n\t\tstate->packlen = PEEK_U32(cp);\n\t\tif (state->packlen < 4 + 1 ||\n\t\t    state->packlen > PACKET_MAX_SIZE)\n\t\t\treturn SSH_ERR_MESSAGE_INCOMPLETE;\n\t}\n\tneed = state->packlen + 4;\n\tif (sshbuf_len(state->input) < need)\n\t\treturn 0; /* packet is incomplete */\n\tsshbuf_reset(state->incoming_packet);\n\tif ((r = sshbuf_put(state->incoming_packet, cp + 4,\n\t    state->packlen)) != 0 ||\n\t    (r = sshbuf_consume(state->input, need)) != 0 ||\n\t    (r = sshbuf_get_u8(state->incoming_packet, NULL)) != 0 ||\n\t    (r = sshbuf_get_u8(state->incoming_packet, typep)) != 0)\n\t\treturn r;\n\tif (ssh_packet_log_type(*typep))\n\t\tdebug3(\"%s: type %u\", __func__, *typep);\n\t/* sshbuf_dump(state->incoming_packet, stderr); */\n\t/* reset for next packet */\n\tstate->packlen = 0;\n\treturn r;\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include \"packet.h\"",
            "#include \"ssh.h\"",
            "#include \"channels.h\"",
            "#include \"misc.h\"",
            "#include \"canohost.h\"",
            "#include \"log.h\"",
            "#include \"mac.h\"",
            "#include \"digest.h\"",
            "#include \"kex.h\"",
            "#include \"sshkey.h\"",
            "#include \"cipher.h\"",
            "#include \"ssh2.h\"",
            "#include \"compat.h\"",
            "#include \"crc32.h\"",
            "#include \"xmalloc.h\"",
            "#include <zlib.h>",
            "#  include <openssl/ec.h>",
            "# include <openssl/evp.h>",
            "# include <openssl/bn.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <limits.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <netdb.h>",
            "#include <errno.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include \"openbsd-compat/sys-queue.h\"",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [
            "#define PACKET_MAX_SIZE (256 * 1024)"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\n#define PACKET_MAX_SIZE (256 * 1024)\n\nstatic int\nssh_packet_read_poll2_mux(struct ssh *ssh, u_char *typep, u_int32_t *seqnr_p)\n{\n\tstruct session_state *state = ssh->state;\n\tconst u_char *cp;\n\tsize_t need;\n\tint r;\n\n\tif (ssh->kex)\n\t\treturn SSH_ERR_INTERNAL_ERROR;\n\t*typep = SSH_MSG_NONE;\n\tcp = sshbuf_ptr(state->input);\n\tif (state->packlen == 0) {\n\t\tif (sshbuf_len(state->input) < 4 + 1)\n\t\t\treturn 0; /* packet is incomplete */\n\t\tstate->packlen = PEEK_U32(cp);\n\t\tif (state->packlen < 4 + 1 ||\n\t\t    state->packlen > PACKET_MAX_SIZE)\n\t\t\treturn SSH_ERR_MESSAGE_INCOMPLETE;\n\t}\n\tneed = state->packlen + 4;\n\tif (sshbuf_len(state->input) < need)\n\t\treturn 0; /* packet is incomplete */\n\tsshbuf_reset(state->incoming_packet);\n\tif ((r = sshbuf_put(state->incoming_packet, cp + 4,\n\t    state->packlen)) != 0 ||\n\t    (r = sshbuf_consume(state->input, need)) != 0 ||\n\t    (r = sshbuf_get_u8(state->incoming_packet, NULL)) != 0 ||\n\t    (r = sshbuf_get_u8(state->incoming_packet, typep)) != 0)\n\t\treturn r;\n\tif (ssh_packet_log_type(*typep))\n\t\tdebug3(\"%s: type %u\", __func__, *typep);\n\t/* sshbuf_dump(state->incoming_packet, stderr); */\n\t/* reset for next packet */\n\tstate->packlen = 0;\n\treturn r;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\n#define PACKET_MAX_SIZE (256 * 1024)\n\nint\nssh_packet_read_poll2(struct ssh *ssh, u_char *typep, u_int32_t *seqnr_p)\n{\n\tstruct session_state *state = ssh->state;\n\tu_int padlen, need;\n\tu_char *cp;\n\tu_int maclen, aadlen = 0, authlen = 0, block_size;\n\tstruct sshenc *enc   = NULL;\n\tstruct sshmac *mac   = NULL;\n\tstruct sshcomp *comp = NULL;\n\tint r;\n\n\tif (state->mux)\n\t\treturn ssh_packet_read_poll2_mux(ssh, typep, seqnr_p);\n\n\t*typep = SSH_MSG_NONE;\n\n\tif (state->packet_discard)\n\t\treturn 0;\n\n\tif (state->newkeys[MODE_IN] != NULL) {\n\t\tenc  = &state->newkeys[MODE_IN]->enc;\n\t\tmac  = &state->newkeys[MODE_IN]->mac;\n\t\tcomp = &state->newkeys[MODE_IN]->comp;\n\t\t/* disable mac for authenticated encryption */\n\t\tif ((authlen = cipher_authlen(enc->cipher)) != 0)\n\t\t\tmac = NULL;\n\t}\n\tmaclen = mac && mac->enabled ? mac->mac_len : 0;\n\tblock_size = enc ? enc->block_size : 8;\n\taadlen = (mac && mac->enabled && mac->etm) || authlen ? 4 : 0;\n\n\tif (aadlen && state->packlen == 0) {\n\t\tif (cipher_get_length(state->receive_context,\n\t\t    &state->packlen, state->p_read.seqnr,\n\t\t    sshbuf_ptr(state->input), sshbuf_len(state->input)) != 0)\n\t\t\treturn 0;\n\t\tif (state->packlen < 1 + 4 ||\n\t\t    state->packlen > PACKET_MAX_SIZE) {\n#ifdef PACKET_DEBUG\n\t\t\tsshbuf_dump(state->input, stderr);\n#endif\n\t\t\tlogit(\"Bad packet length %u.\", state->packlen);\n\t\t\tif ((r = sshpkt_disconnect(ssh, \"Packet corrupt\")) != 0)\n\t\t\t\treturn r;\n\t\t\treturn SSH_ERR_CONN_CORRUPT;\n\t\t}\n\t\tsshbuf_reset(state->incoming_packet);\n\t} else if (state->packlen == 0) {\n\t\t/*\n\t\t * check if input size is less than the cipher block size,\n\t\t * decrypt first block and extract length of incoming packet\n\t\t */\n\t\tif (sshbuf_len(state->input) < block_size)\n\t\t\treturn 0;\n\t\tsshbuf_reset(state->incoming_packet);\n\t\tif ((r = sshbuf_reserve(state->incoming_packet, block_size,\n\t\t    &cp)) != 0)\n\t\t\tgoto out;\n\t\tif ((r = cipher_crypt(state->receive_context,\n\t\t    state->p_send.seqnr, cp, sshbuf_ptr(state->input),\n\t\t    block_size, 0, 0)) != 0)\n\t\t\tgoto out;\n\t\tstate->packlen = PEEK_U32(sshbuf_ptr(state->incoming_packet));\n\t\tif (state->packlen < 1 + 4 ||\n\t\t    state->packlen > PACKET_MAX_SIZE) {\n#ifdef PACKET_DEBUG\n\t\t\tfprintf(stderr, \"input: \\n\");\n\t\t\tsshbuf_dump(state->input, stderr);\n\t\t\tfprintf(stderr, \"incoming_packet: \\n\");\n\t\t\tsshbuf_dump(state->incoming_packet, stderr);\n#endif\n\t\t\tlogit(\"Bad packet length %u.\", state->packlen);\n\t\t\treturn ssh_packet_start_discard(ssh, enc, mac, 0,\n\t\t\t    PACKET_MAX_SIZE);\n\t\t}\n\t\tif ((r = sshbuf_consume(state->input, block_size)) != 0)\n\t\t\tgoto out;\n\t}\n\tDBG(debug(\"input: packet len %u\", state->packlen+4));\n\n\tif (aadlen) {\n\t\t/* only the payload is encrypted */\n\t\tneed = state->packlen;\n\t} else {\n\t\t/*\n\t\t * the payload size and the payload are encrypted, but we\n\t\t * have a partial packet of block_size bytes\n\t\t */\n\t\tneed = 4 + state->packlen - block_size;\n\t}\n\tDBG(debug(\"partial packet: block %d, need %d, maclen %d, authlen %d,\"\n\t    \" aadlen %d\", block_size, need, maclen, authlen, aadlen));\n\tif (need % block_size != 0) {\n\t\tlogit(\"padding error: need %d block %d mod %d\",\n\t\t    need, block_size, need % block_size);\n\t\treturn ssh_packet_start_discard(ssh, enc, mac, 0,\n\t\t    PACKET_MAX_SIZE - block_size);\n\t}\n\t/*\n\t * check if the entire packet has been received and\n\t * decrypt into incoming_packet:\n\t * 'aadlen' bytes are unencrypted, but authenticated.\n\t * 'need' bytes are encrypted, followed by either\n\t * 'authlen' bytes of authentication tag or\n\t * 'maclen' bytes of message authentication code.\n\t */\n\tif (sshbuf_len(state->input) < aadlen + need + authlen + maclen)\n\t\treturn 0; /* packet is incomplete */\n#ifdef PACKET_DEBUG\n\tfprintf(stderr, \"read_poll enc/full: \");\n\tsshbuf_dump(state->input, stderr);\n#endif\n\t/* EtM: check mac over encrypted input */\n\tif (mac && mac->enabled && mac->etm) {\n\t\tif ((r = mac_check(mac, state->p_read.seqnr,\n\t\t    sshbuf_ptr(state->input), aadlen + need,\n\t\t    sshbuf_ptr(state->input) + aadlen + need + authlen,\n\t\t    maclen)) != 0) {\n\t\t\tif (r == SSH_ERR_MAC_INVALID)\n\t\t\t\tlogit(\"Corrupted MAC on input.\");\n\t\t\tgoto out;\n\t\t}\n\t}\n\tif ((r = sshbuf_reserve(state->incoming_packet, aadlen + need,\n\t    &cp)) != 0)\n\t\tgoto out;\n\tif ((r = cipher_crypt(state->receive_context, state->p_read.seqnr, cp,\n\t    sshbuf_ptr(state->input), need, aadlen, authlen)) != 0)\n\t\tgoto out;\n\tif ((r = sshbuf_consume(state->input, aadlen + need + authlen)) != 0)\n\t\tgoto out;\n\tif (mac && mac->enabled) {\n\t\t/* Not EtM: check MAC over cleartext */\n\t\tif (!mac->etm && (r = mac_check(mac, state->p_read.seqnr,\n\t\t    sshbuf_ptr(state->incoming_packet),\n\t\t    sshbuf_len(state->incoming_packet),\n\t\t    sshbuf_ptr(state->input), maclen)) != 0) {\n\t\t\tif (r != SSH_ERR_MAC_INVALID)\n\t\t\t\tgoto out;\n\t\t\tlogit(\"Corrupted MAC on input.\");\n\t\t\tif (need + block_size > PACKET_MAX_SIZE)\n\t\t\t\treturn SSH_ERR_INTERNAL_ERROR;\n\t\t\treturn ssh_packet_start_discard(ssh, enc, mac,\n\t\t\t    sshbuf_len(state->incoming_packet),\n\t\t\t    PACKET_MAX_SIZE - need - block_size);\n\t\t}\n\t\t/* Remove MAC from input buffer */\n\t\tDBG(debug(\"MAC #%d ok\", state->p_read.seqnr));\n\t\tif ((r = sshbuf_consume(state->input, mac->mac_len)) != 0)\n\t\t\tgoto out;\n\t}\n\tif (seqnr_p != NULL)\n\t\t*seqnr_p = state->p_read.seqnr;\n\tif (++state->p_read.seqnr == 0)\n\t\tlogit(\"incoming seqnr wraps around\");\n\tif (++state->p_read.packets == 0)\n\t\tif (!(ssh->compat & SSH_BUG_NOREKEY))\n\t\t\treturn SSH_ERR_NEED_REKEY;\n\tstate->p_read.blocks += (state->packlen + 4) / block_size;\n\tstate->p_read.bytes += state->packlen + 4;\n\n\t/* get padlen */\n\tpadlen = sshbuf_ptr(state->incoming_packet)[4];\n\tDBG(debug(\"input: padlen %d\", padlen));\n\tif (padlen < 4)\t{\n\t\tif ((r = sshpkt_disconnect(ssh,\n\t\t    \"Corrupted padlen %d on input.\", padlen)) != 0 ||\n\t\t    (r = ssh_packet_write_wait(ssh)) != 0)\n\t\t\treturn r;\n\t\treturn SSH_ERR_CONN_CORRUPT;\n\t}\n\n\t/* skip packet size + padlen, discard padding */\n\tif ((r = sshbuf_consume(state->incoming_packet, 4 + 1)) != 0 ||\n\t    ((r = sshbuf_consume_end(state->incoming_packet, padlen)) != 0))\n\t\tgoto out;\n\n\tDBG(debug(\"input: len before de-compress %zd\",\n\t    sshbuf_len(state->incoming_packet)));\n\tif (comp && comp->enabled) {\n\t\tsshbuf_reset(state->compression_buffer);\n\t\tif ((r = uncompress_buffer(ssh, state->incoming_packet,\n\t\t    state->compression_buffer)) != 0)\n\t\t\tgoto out;\n\t\tsshbuf_reset(state->incoming_packet);\n\t\tif ((r = sshbuf_putb(state->incoming_packet,\n\t\t    state->compression_buffer)) != 0)\n\t\t\tgoto out;\n\t\tDBG(debug(\"input: len after de-compress %zd\",\n\t\t    sshbuf_len(state->incoming_packet)));\n\t}\n\t/*\n\t * get packet type, implies consume.\n\t * return length of payload (without type field)\n\t */\n\tif ((r = sshbuf_get_u8(state->incoming_packet, typep)) != 0)\n\t\tgoto out;\n\tif (ssh_packet_log_type(*typep))\n\t\tdebug3(\"receive packet: type %u\", *typep);\n\tif (*typep < SSH2_MSG_MIN || *typep >= SSH2_MSG_LOCAL_MIN) {\n\t\tif ((r = sshpkt_disconnect(ssh,\n\t\t    \"Invalid ssh2 packet type: %d\", *typep)) != 0 ||\n\t\t    (r = ssh_packet_write_wait(ssh)) != 0)\n\t\t\treturn r;\n\t\treturn SSH_ERR_PROTOCOL_ERROR;\n\t}\n\tif (state->hook_in != NULL &&\n\t    (r = state->hook_in(ssh, state->incoming_packet, typep,\n\t    state->hook_in_ctx)) != 0)\n\t\treturn r;\n\tif (*typep == SSH2_MSG_USERAUTH_SUCCESS && !state->server_side)\n\t\tr = ssh_packet_enable_delayed_compress(ssh);\n\telse\n\t\tr = 0;\n#ifdef PACKET_DEBUG\n\tfprintf(stderr, \"read/plain[%d]:\\r\\n\", *typep);\n\tsshbuf_dump(state->incoming_packet, stderr);\n#endif\n\t/* reset for next packet */\n\tstate->packlen = 0;\n\n\t/* do we need to rekey? */\n\tif (ssh_packet_need_rekeying(ssh, 0)) {\n\t\tdebug3(\"%s: rekex triggered\", __func__);\n\t\tif ((r = kex_start_rekex(ssh)) != 0)\n\t\t\treturn r;\n\t}\n out:\n\treturn r;\n}"
  },
  {
    "function_name": "ssh_packet_read_poll2_mux",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
    "lines": "1405-1441",
    "snippet": "static int\nssh_packet_read_poll2_mux(struct ssh *ssh, u_char *typep, u_int32_t *seqnr_p)\n{\n\tstruct session_state *state = ssh->state;\n\tconst u_char *cp;\n\tsize_t need;\n\tint r;\n\n\tif (ssh->kex)\n\t\treturn SSH_ERR_INTERNAL_ERROR;\n\t*typep = SSH_MSG_NONE;\n\tcp = sshbuf_ptr(state->input);\n\tif (state->packlen == 0) {\n\t\tif (sshbuf_len(state->input) < 4 + 1)\n\t\t\treturn 0; /* packet is incomplete */\n\t\tstate->packlen = PEEK_U32(cp);\n\t\tif (state->packlen < 4 + 1 ||\n\t\t    state->packlen > PACKET_MAX_SIZE)\n\t\t\treturn SSH_ERR_MESSAGE_INCOMPLETE;\n\t}\n\tneed = state->packlen + 4;\n\tif (sshbuf_len(state->input) < need)\n\t\treturn 0; /* packet is incomplete */\n\tsshbuf_reset(state->incoming_packet);\n\tif ((r = sshbuf_put(state->incoming_packet, cp + 4,\n\t    state->packlen)) != 0 ||\n\t    (r = sshbuf_consume(state->input, need)) != 0 ||\n\t    (r = sshbuf_get_u8(state->incoming_packet, NULL)) != 0 ||\n\t    (r = sshbuf_get_u8(state->incoming_packet, typep)) != 0)\n\t\treturn r;\n\tif (ssh_packet_log_type(*typep))\n\t\tdebug3(\"%s: type %u\", __func__, *typep);\n\t/* sshbuf_dump(state->incoming_packet, stderr); */\n\t/* reset for next packet */\n\tstate->packlen = 0;\n\treturn r;\n}",
    "includes": [
      "#include \"sshbuf.h\"",
      "#include \"ssherr.h\"",
      "#include \"packet.h\"",
      "#include \"ssh.h\"",
      "#include \"channels.h\"",
      "#include \"misc.h\"",
      "#include \"canohost.h\"",
      "#include \"log.h\"",
      "#include \"mac.h\"",
      "#include \"digest.h\"",
      "#include \"kex.h\"",
      "#include \"sshkey.h\"",
      "#include \"cipher.h\"",
      "#include \"ssh2.h\"",
      "#include \"compat.h\"",
      "#include \"crc32.h\"",
      "#include \"xmalloc.h\"",
      "#include <zlib.h>",
      "#  include <openssl/ec.h>",
      "# include <openssl/evp.h>",
      "# include <openssl/bn.h>",
      "#include <time.h>",
      "#include <signal.h>",
      "#include <limits.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <stdarg.h>",
      "#include <netdb.h>",
      "#include <errno.h>",
      "#include <arpa/inet.h>",
      "#include <netinet/ip.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include \"openbsd-compat/sys-queue.h\"",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [
      "#define PACKET_MAX_SIZE (256 * 1024)"
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "debug3",
          "args": [
            "\"%s: type %u\"",
            "__func__",
            "*typep"
          ],
          "line": 1436
        },
        "resolved": true,
        "details": {
          "function_name": "debug3",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/log.c",
          "lines": "242-250",
          "snippet": "void\ndebug3(const char *fmt,...)\n{\n\tva_list args;\n\n\tva_start(args, fmt);\n\tdo_log(SYSLOG_LEVEL_DEBUG3, fmt, args);\n\tva_end(args);\n}",
          "includes": [
            "#include \"log.h\"",
            "# include <vis.h>",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <syslog.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <fcntl.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n# include <vis.h>\n#include <errno.h>\n#include <unistd.h>\n#include <syslog.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <fcntl.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\ndebug3(const char *fmt,...)\n{\n\tva_list args;\n\n\tva_start(args, fmt);\n\tdo_log(SYSLOG_LEVEL_DEBUG3, fmt, args);\n\tva_end(args);\n}"
        }
      },
      {
        "call_info": {
          "callee": "ssh_packet_log_type",
          "args": [
            "*typep"
          ],
          "line": 1435
        },
        "resolved": true,
        "details": {
          "function_name": "ssh_packet_log_type",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
          "lines": "1010-1021",
          "snippet": "int\nssh_packet_log_type(u_char type)\n{\n\tswitch (type) {\n\tcase SSH2_MSG_CHANNEL_DATA:\n\tcase SSH2_MSG_CHANNEL_EXTENDED_DATA:\n\tcase SSH2_MSG_CHANNEL_WINDOW_ADJUST:\n\t\treturn 0;\n\tdefault:\n\t\treturn 1;\n\t}\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include \"packet.h\"",
            "#include \"ssh.h\"",
            "#include \"channels.h\"",
            "#include \"misc.h\"",
            "#include \"canohost.h\"",
            "#include \"log.h\"",
            "#include \"mac.h\"",
            "#include \"digest.h\"",
            "#include \"kex.h\"",
            "#include \"sshkey.h\"",
            "#include \"cipher.h\"",
            "#include \"ssh2.h\"",
            "#include \"compat.h\"",
            "#include \"crc32.h\"",
            "#include \"xmalloc.h\"",
            "#include <zlib.h>",
            "#  include <openssl/ec.h>",
            "# include <openssl/evp.h>",
            "# include <openssl/bn.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <limits.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <netdb.h>",
            "#include <errno.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include \"openbsd-compat/sys-queue.h\"",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nssh_packet_log_type(u_char type)\n{\n\tswitch (type) {\n\tcase SSH2_MSG_CHANNEL_DATA:\n\tcase SSH2_MSG_CHANNEL_EXTENDED_DATA:\n\tcase SSH2_MSG_CHANNEL_WINDOW_ADJUST:\n\t\treturn 0;\n\tdefault:\n\t\treturn 1;\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "sshbuf_get_u8",
          "args": [
            "state->incoming_packet",
            "typep"
          ],
          "line": 1433
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_get_u8",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf-getput-basic.c",
          "lines": "83-94",
          "snippet": "int\nsshbuf_get_u8(struct sshbuf *buf, u_char *valp)\n{\n\tconst u_char *p = sshbuf_ptr(buf);\n\tint r;\n\n\tif ((r = sshbuf_consume(buf, 1)) < 0)\n\t\treturn r;\n\tif (valp != NULL)\n\t\t*valp = (u_int8_t)*p;\n\treturn 0;\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <stdarg.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <stdarg.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshbuf_get_u8(struct sshbuf *buf, u_char *valp)\n{\n\tconst u_char *p = sshbuf_ptr(buf);\n\tint r;\n\n\tif ((r = sshbuf_consume(buf, 1)) < 0)\n\t\treturn r;\n\tif (valp != NULL)\n\t\t*valp = (u_int8_t)*p;\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "sshbuf_consume",
          "args": [
            "state->input",
            "need"
          ],
          "line": 1431
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_consume_end",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf.c",
          "lines": "383-398",
          "snippet": "int\nsshbuf_consume_end(struct sshbuf *buf, size_t len)\n{\n\tint r;\n\n\tSSHBUF_DBG((\"len = %zu\", len));\n\tif ((r = sshbuf_check_sanity(buf)) != 0)\n\t\treturn r;\n\tif (len == 0)\n\t\treturn 0;\n\tif (len > sshbuf_len(buf))\n\t\treturn SSH_ERR_MESSAGE_INCOMPLETE;\n\tbuf->size -= len;\n\tSSHBUF_TELL(\"done\");\n\treturn 0;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <signal.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <signal.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshbuf_consume_end(struct sshbuf *buf, size_t len)\n{\n\tint r;\n\n\tSSHBUF_DBG((\"len = %zu\", len));\n\tif ((r = sshbuf_check_sanity(buf)) != 0)\n\t\treturn r;\n\tif (len == 0)\n\t\treturn 0;\n\tif (len > sshbuf_len(buf))\n\t\treturn SSH_ERR_MESSAGE_INCOMPLETE;\n\tbuf->size -= len;\n\tSSHBUF_TELL(\"done\");\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "sshbuf_put",
          "args": [
            "state->incoming_packet",
            "cp + 4",
            "state->packlen"
          ],
          "line": 1429
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_putf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf-getput-basic.c",
          "lines": "254-264",
          "snippet": "int\nsshbuf_putf(struct sshbuf *buf, const char *fmt, ...)\n{\n\tva_list ap;\n\tint r;\n\n\tva_start(ap, fmt);\n\tr = sshbuf_putfv(buf, fmt, ap);\n\tva_end(ap);\n\treturn r;\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <stdarg.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <stdarg.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshbuf_putf(struct sshbuf *buf, const char *fmt, ...)\n{\n\tva_list ap;\n\tint r;\n\n\tva_start(ap, fmt);\n\tr = sshbuf_putfv(buf, fmt, ap);\n\tva_end(ap);\n\treturn r;\n}"
        }
      },
      {
        "call_info": {
          "callee": "sshbuf_reset",
          "args": [
            "state->incoming_packet"
          ],
          "line": 1428
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_reset",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf.c",
          "lines": "168-188",
          "snippet": "void\nsshbuf_reset(struct sshbuf *buf)\n{\n\tu_char *d;\n\n\tif (buf->readonly || buf->refcount > 1) {\n\t\t/* Nonsensical. Just make buffer appear empty */\n\t\tbuf->off = buf->size;\n\t\treturn;\n\t}\n\t(void) sshbuf_check_sanity(buf);\n\tbuf->off = buf->size = 0;\n\tif (buf->alloc != SSHBUF_SIZE_INIT) {\n\t\tif ((d = recallocarray(buf->d, buf->alloc, SSHBUF_SIZE_INIT,\n\t\t    1)) != NULL) {\n\t\t\tbuf->cd = buf->d = d;\n\t\t\tbuf->alloc = SSHBUF_SIZE_INIT;\n\t\t}\n\t}\n\texplicit_bzero(buf->d, SSHBUF_SIZE_INIT);\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <signal.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <signal.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\nsshbuf_reset(struct sshbuf *buf)\n{\n\tu_char *d;\n\n\tif (buf->readonly || buf->refcount > 1) {\n\t\t/* Nonsensical. Just make buffer appear empty */\n\t\tbuf->off = buf->size;\n\t\treturn;\n\t}\n\t(void) sshbuf_check_sanity(buf);\n\tbuf->off = buf->size = 0;\n\tif (buf->alloc != SSHBUF_SIZE_INIT) {\n\t\tif ((d = recallocarray(buf->d, buf->alloc, SSHBUF_SIZE_INIT,\n\t\t    1)) != NULL) {\n\t\t\tbuf->cd = buf->d = d;\n\t\t\tbuf->alloc = SSHBUF_SIZE_INIT;\n\t\t}\n\t}\n\texplicit_bzero(buf->d, SSHBUF_SIZE_INIT);\n}"
        }
      },
      {
        "call_info": {
          "callee": "sshbuf_len",
          "args": [
            "state->input"
          ],
          "line": 1426
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_len",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf.c",
          "lines": "252-258",
          "snippet": "size_t\nsshbuf_len(const struct sshbuf *buf)\n{\n\tif (sshbuf_check_sanity(buf) != 0)\n\t\treturn 0;\n\treturn buf->size - buf->off;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <signal.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <signal.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nsize_t\nsshbuf_len(const struct sshbuf *buf)\n{\n\tif (sshbuf_check_sanity(buf) != 0)\n\t\treturn 0;\n\treturn buf->size - buf->off;\n}"
        }
      },
      {
        "call_info": {
          "callee": "PEEK_U32",
          "args": [
            "cp"
          ],
          "line": 1420
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sshbuf_ptr",
          "args": [
            "state->input"
          ],
          "line": 1416
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_ptr",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf.c",
          "lines": "268-274",
          "snippet": "const u_char *\nsshbuf_ptr(const struct sshbuf *buf)\n{\n\tif (sshbuf_check_sanity(buf) != 0)\n\t\treturn NULL;\n\treturn buf->cd + buf->off;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <signal.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <signal.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nconst u_char *\nsshbuf_ptr(const struct sshbuf *buf)\n{\n\tif (sshbuf_check_sanity(buf) != 0)\n\t\treturn NULL;\n\treturn buf->cd + buf->off;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\n#define PACKET_MAX_SIZE (256 * 1024)\n\nstatic int\nssh_packet_read_poll2_mux(struct ssh *ssh, u_char *typep, u_int32_t *seqnr_p)\n{\n\tstruct session_state *state = ssh->state;\n\tconst u_char *cp;\n\tsize_t need;\n\tint r;\n\n\tif (ssh->kex)\n\t\treturn SSH_ERR_INTERNAL_ERROR;\n\t*typep = SSH_MSG_NONE;\n\tcp = sshbuf_ptr(state->input);\n\tif (state->packlen == 0) {\n\t\tif (sshbuf_len(state->input) < 4 + 1)\n\t\t\treturn 0; /* packet is incomplete */\n\t\tstate->packlen = PEEK_U32(cp);\n\t\tif (state->packlen < 4 + 1 ||\n\t\t    state->packlen > PACKET_MAX_SIZE)\n\t\t\treturn SSH_ERR_MESSAGE_INCOMPLETE;\n\t}\n\tneed = state->packlen + 4;\n\tif (sshbuf_len(state->input) < need)\n\t\treturn 0; /* packet is incomplete */\n\tsshbuf_reset(state->incoming_packet);\n\tif ((r = sshbuf_put(state->incoming_packet, cp + 4,\n\t    state->packlen)) != 0 ||\n\t    (r = sshbuf_consume(state->input, need)) != 0 ||\n\t    (r = sshbuf_get_u8(state->incoming_packet, NULL)) != 0 ||\n\t    (r = sshbuf_get_u8(state->incoming_packet, typep)) != 0)\n\t\treturn r;\n\tif (ssh_packet_log_type(*typep))\n\t\tdebug3(\"%s: type %u\", __func__, *typep);\n\t/* sshbuf_dump(state->incoming_packet, stderr); */\n\t/* reset for next packet */\n\tstate->packlen = 0;\n\treturn r;\n}"
  },
  {
    "function_name": "ssh_packet_read_expect",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
    "lines": "1387-1403",
    "snippet": "int\nssh_packet_read_expect(struct ssh *ssh, u_int expected_type)\n{\n\tint r;\n\tu_char type;\n\n\tif ((r = ssh_packet_read_seqnr(ssh, &type, NULL)) != 0)\n\t\treturn r;\n\tif (type != expected_type) {\n\t\tif ((r = sshpkt_disconnect(ssh,\n\t\t    \"Protocol error: expected packet type %d, got %d\",\n\t\t    expected_type, type)) != 0)\n\t\t\treturn r;\n\t\treturn SSH_ERR_PROTOCOL_ERROR;\n\t}\n\treturn 0;\n}",
    "includes": [
      "#include \"sshbuf.h\"",
      "#include \"ssherr.h\"",
      "#include \"packet.h\"",
      "#include \"ssh.h\"",
      "#include \"channels.h\"",
      "#include \"misc.h\"",
      "#include \"canohost.h\"",
      "#include \"log.h\"",
      "#include \"mac.h\"",
      "#include \"digest.h\"",
      "#include \"kex.h\"",
      "#include \"sshkey.h\"",
      "#include \"cipher.h\"",
      "#include \"ssh2.h\"",
      "#include \"compat.h\"",
      "#include \"crc32.h\"",
      "#include \"xmalloc.h\"",
      "#include <zlib.h>",
      "#  include <openssl/ec.h>",
      "# include <openssl/evp.h>",
      "# include <openssl/bn.h>",
      "#include <time.h>",
      "#include <signal.h>",
      "#include <limits.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <stdarg.h>",
      "#include <netdb.h>",
      "#include <errno.h>",
      "#include <arpa/inet.h>",
      "#include <netinet/ip.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include \"openbsd-compat/sys-queue.h\"",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "sshpkt_disconnect",
          "args": [
            "ssh",
            "\"Protocol error: expected packet type %d, got %d\"",
            "expected_type",
            "type"
          ],
          "line": 1396
        },
        "resolved": true,
        "details": {
          "function_name": "sshpkt_disconnect",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
          "lines": "2656-2674",
          "snippet": "int\nsshpkt_disconnect(struct ssh *ssh, const char *fmt,...)\n{\n\tchar buf[1024];\n\tva_list args;\n\tint r;\n\n\tva_start(args, fmt);\n\tvsnprintf(buf, sizeof(buf), fmt, args);\n\tva_end(args);\n\n\tif ((r = sshpkt_start(ssh, SSH2_MSG_DISCONNECT)) != 0 ||\n\t    (r = sshpkt_put_u32(ssh, SSH2_DISCONNECT_PROTOCOL_ERROR)) != 0 ||\n\t    (r = sshpkt_put_cstring(ssh, buf)) != 0 ||\n\t    (r = sshpkt_put_cstring(ssh, \"\")) != 0 ||\n\t    (r = sshpkt_send(ssh)) != 0)\n\t\treturn r;\n\treturn 0;\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include \"packet.h\"",
            "#include \"ssh.h\"",
            "#include \"channels.h\"",
            "#include \"misc.h\"",
            "#include \"canohost.h\"",
            "#include \"log.h\"",
            "#include \"mac.h\"",
            "#include \"digest.h\"",
            "#include \"kex.h\"",
            "#include \"sshkey.h\"",
            "#include \"cipher.h\"",
            "#include \"ssh2.h\"",
            "#include \"compat.h\"",
            "#include \"crc32.h\"",
            "#include \"xmalloc.h\"",
            "#include <zlib.h>",
            "#  include <openssl/ec.h>",
            "# include <openssl/evp.h>",
            "# include <openssl/bn.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <limits.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <netdb.h>",
            "#include <errno.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include \"openbsd-compat/sys-queue.h\"",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshpkt_disconnect(struct ssh *ssh, const char *fmt,...)\n{\n\tchar buf[1024];\n\tva_list args;\n\tint r;\n\n\tva_start(args, fmt);\n\tvsnprintf(buf, sizeof(buf), fmt, args);\n\tva_end(args);\n\n\tif ((r = sshpkt_start(ssh, SSH2_MSG_DISCONNECT)) != 0 ||\n\t    (r = sshpkt_put_u32(ssh, SSH2_DISCONNECT_PROTOCOL_ERROR)) != 0 ||\n\t    (r = sshpkt_put_cstring(ssh, buf)) != 0 ||\n\t    (r = sshpkt_put_cstring(ssh, \"\")) != 0 ||\n\t    (r = sshpkt_send(ssh)) != 0)\n\t\treturn r;\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "ssh_packet_read_seqnr",
          "args": [
            "ssh",
            "&type",
            "NULL"
          ],
          "line": 1393
        },
        "resolved": true,
        "details": {
          "function_name": "ssh_packet_read_seqnr",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
          "lines": "1281-1369",
          "snippet": "int\nssh_packet_read_seqnr(struct ssh *ssh, u_char *typep, u_int32_t *seqnr_p)\n{\n\tstruct session_state *state = ssh->state;\n\tint len, r, ms_remain;\n\tfd_set *setp;\n\tchar buf[8192];\n\tstruct timeval timeout, start, *timeoutp = NULL;\n\n\tDBG(debug(\"packet_read()\"));\n\n\tsetp = calloc(howmany(state->connection_in + 1,\n\t    NFDBITS), sizeof(fd_mask));\n\tif (setp == NULL)\n\t\treturn SSH_ERR_ALLOC_FAIL;\n\n\t/*\n\t * Since we are blocking, ensure that all written packets have\n\t * been sent.\n\t */\n\tif ((r = ssh_packet_write_wait(ssh)) != 0)\n\t\tgoto out;\n\n\t/* Stay in the loop until we have received a complete packet. */\n\tfor (;;) {\n\t\t/* Try to read a packet from the buffer. */\n\t\tr = ssh_packet_read_poll_seqnr(ssh, typep, seqnr_p);\n\t\tif (r != 0)\n\t\t\tbreak;\n\t\t/* If we got a packet, return it. */\n\t\tif (*typep != SSH_MSG_NONE)\n\t\t\tbreak;\n\t\t/*\n\t\t * Otherwise, wait for some data to arrive, add it to the\n\t\t * buffer, and try again.\n\t\t */\n\t\tmemset(setp, 0, howmany(state->connection_in + 1,\n\t\t    NFDBITS) * sizeof(fd_mask));\n\t\tFD_SET(state->connection_in, setp);\n\n\t\tif (state->packet_timeout_ms > 0) {\n\t\t\tms_remain = state->packet_timeout_ms;\n\t\t\ttimeoutp = &timeout;\n\t\t}\n\t\t/* Wait for some data to arrive. */\n\t\tfor (;;) {\n\t\t\tif (state->packet_timeout_ms != -1) {\n\t\t\t\tms_to_timeval(&timeout, ms_remain);\n\t\t\t\tmonotime_tv(&start);\n\t\t\t}\n\t\t\tif ((r = select(state->connection_in + 1, setp,\n\t\t\t    NULL, NULL, timeoutp)) >= 0)\n\t\t\t\tbreak;\n\t\t\tif (errno != EAGAIN && errno != EINTR &&\n\t\t\t    errno != EWOULDBLOCK) {\n\t\t\t\tr = SSH_ERR_SYSTEM_ERROR;\n\t\t\t\tgoto out;\n\t\t\t}\n\t\t\tif (state->packet_timeout_ms == -1)\n\t\t\t\tcontinue;\n\t\t\tms_subtract_diff(&start, &ms_remain);\n\t\t\tif (ms_remain <= 0) {\n\t\t\t\tr = 0;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tif (r == 0) {\n\t\t\tr = SSH_ERR_CONN_TIMEOUT;\n\t\t\tgoto out;\n\t\t}\n\t\t/* Read data from the socket. */\n\t\tlen = read(state->connection_in, buf, sizeof(buf));\n\t\tif (len == 0) {\n\t\t\tr = SSH_ERR_CONN_CLOSED;\n\t\t\tgoto out;\n\t\t}\n\t\tif (len < 0) {\n\t\t\tr = SSH_ERR_SYSTEM_ERROR;\n\t\t\tgoto out;\n\t\t}\n\n\t\t/* Append it to the buffer. */\n\t\tif ((r = ssh_packet_process_incoming(ssh, buf, len)) != 0)\n\t\t\tgoto out;\n\t}\n out:\n\tfree(setp);\n\treturn r;\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include \"packet.h\"",
            "#include \"ssh.h\"",
            "#include \"channels.h\"",
            "#include \"misc.h\"",
            "#include \"canohost.h\"",
            "#include \"log.h\"",
            "#include \"mac.h\"",
            "#include \"digest.h\"",
            "#include \"kex.h\"",
            "#include \"sshkey.h\"",
            "#include \"cipher.h\"",
            "#include \"ssh2.h\"",
            "#include \"compat.h\"",
            "#include \"crc32.h\"",
            "#include \"xmalloc.h\"",
            "#include <zlib.h>",
            "#  include <openssl/ec.h>",
            "# include <openssl/evp.h>",
            "# include <openssl/bn.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <limits.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <netdb.h>",
            "#include <errno.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include \"openbsd-compat/sys-queue.h\"",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nssh_packet_read_seqnr(struct ssh *ssh, u_char *typep, u_int32_t *seqnr_p)\n{\n\tstruct session_state *state = ssh->state;\n\tint len, r, ms_remain;\n\tfd_set *setp;\n\tchar buf[8192];\n\tstruct timeval timeout, start, *timeoutp = NULL;\n\n\tDBG(debug(\"packet_read()\"));\n\n\tsetp = calloc(howmany(state->connection_in + 1,\n\t    NFDBITS), sizeof(fd_mask));\n\tif (setp == NULL)\n\t\treturn SSH_ERR_ALLOC_FAIL;\n\n\t/*\n\t * Since we are blocking, ensure that all written packets have\n\t * been sent.\n\t */\n\tif ((r = ssh_packet_write_wait(ssh)) != 0)\n\t\tgoto out;\n\n\t/* Stay in the loop until we have received a complete packet. */\n\tfor (;;) {\n\t\t/* Try to read a packet from the buffer. */\n\t\tr = ssh_packet_read_poll_seqnr(ssh, typep, seqnr_p);\n\t\tif (r != 0)\n\t\t\tbreak;\n\t\t/* If we got a packet, return it. */\n\t\tif (*typep != SSH_MSG_NONE)\n\t\t\tbreak;\n\t\t/*\n\t\t * Otherwise, wait for some data to arrive, add it to the\n\t\t * buffer, and try again.\n\t\t */\n\t\tmemset(setp, 0, howmany(state->connection_in + 1,\n\t\t    NFDBITS) * sizeof(fd_mask));\n\t\tFD_SET(state->connection_in, setp);\n\n\t\tif (state->packet_timeout_ms > 0) {\n\t\t\tms_remain = state->packet_timeout_ms;\n\t\t\ttimeoutp = &timeout;\n\t\t}\n\t\t/* Wait for some data to arrive. */\n\t\tfor (;;) {\n\t\t\tif (state->packet_timeout_ms != -1) {\n\t\t\t\tms_to_timeval(&timeout, ms_remain);\n\t\t\t\tmonotime_tv(&start);\n\t\t\t}\n\t\t\tif ((r = select(state->connection_in + 1, setp,\n\t\t\t    NULL, NULL, timeoutp)) >= 0)\n\t\t\t\tbreak;\n\t\t\tif (errno != EAGAIN && errno != EINTR &&\n\t\t\t    errno != EWOULDBLOCK) {\n\t\t\t\tr = SSH_ERR_SYSTEM_ERROR;\n\t\t\t\tgoto out;\n\t\t\t}\n\t\t\tif (state->packet_timeout_ms == -1)\n\t\t\t\tcontinue;\n\t\t\tms_subtract_diff(&start, &ms_remain);\n\t\t\tif (ms_remain <= 0) {\n\t\t\t\tr = 0;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tif (r == 0) {\n\t\t\tr = SSH_ERR_CONN_TIMEOUT;\n\t\t\tgoto out;\n\t\t}\n\t\t/* Read data from the socket. */\n\t\tlen = read(state->connection_in, buf, sizeof(buf));\n\t\tif (len == 0) {\n\t\t\tr = SSH_ERR_CONN_CLOSED;\n\t\t\tgoto out;\n\t\t}\n\t\tif (len < 0) {\n\t\t\tr = SSH_ERR_SYSTEM_ERROR;\n\t\t\tgoto out;\n\t\t}\n\n\t\t/* Append it to the buffer. */\n\t\tif ((r = ssh_packet_process_incoming(ssh, buf, len)) != 0)\n\t\t\tgoto out;\n\t}\n out:\n\tfree(setp);\n\treturn r;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nssh_packet_read_expect(struct ssh *ssh, u_int expected_type)\n{\n\tint r;\n\tu_char type;\n\n\tif ((r = ssh_packet_read_seqnr(ssh, &type, NULL)) != 0)\n\t\treturn r;\n\tif (type != expected_type) {\n\t\tif ((r = sshpkt_disconnect(ssh,\n\t\t    \"Protocol error: expected packet type %d, got %d\",\n\t\t    expected_type, type)) != 0)\n\t\t\treturn r;\n\t\treturn SSH_ERR_PROTOCOL_ERROR;\n\t}\n\treturn 0;\n}"
  },
  {
    "function_name": "ssh_packet_read",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
    "lines": "1371-1380",
    "snippet": "int\nssh_packet_read(struct ssh *ssh)\n{\n\tu_char type;\n\tint r;\n\n\tif ((r = ssh_packet_read_seqnr(ssh, &type, NULL)) != 0)\n\t\tfatal(\"%s: %s\", __func__, ssh_err(r));\n\treturn type;\n}",
    "includes": [
      "#include \"sshbuf.h\"",
      "#include \"ssherr.h\"",
      "#include \"packet.h\"",
      "#include \"ssh.h\"",
      "#include \"channels.h\"",
      "#include \"misc.h\"",
      "#include \"canohost.h\"",
      "#include \"log.h\"",
      "#include \"mac.h\"",
      "#include \"digest.h\"",
      "#include \"kex.h\"",
      "#include \"sshkey.h\"",
      "#include \"cipher.h\"",
      "#include \"ssh2.h\"",
      "#include \"compat.h\"",
      "#include \"crc32.h\"",
      "#include \"xmalloc.h\"",
      "#include <zlib.h>",
      "#  include <openssl/ec.h>",
      "# include <openssl/evp.h>",
      "# include <openssl/bn.h>",
      "#include <time.h>",
      "#include <signal.h>",
      "#include <limits.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <stdarg.h>",
      "#include <netdb.h>",
      "#include <errno.h>",
      "#include <arpa/inet.h>",
      "#include <netinet/ip.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include \"openbsd-compat/sys-queue.h\"",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "fatal",
          "args": [
            "\"%s: %s\"",
            "__func__",
            "ssh_err(r)"
          ],
          "line": 1378
        },
        "resolved": true,
        "details": {
          "function_name": "sshpkt_fatal",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
          "lines": "1808-1851",
          "snippet": "void\nsshpkt_fatal(struct ssh *ssh, const char *tag, int r)\n{\n\tchar remote_id[512];\n\n\tsshpkt_fmt_connection_id(ssh, remote_id, sizeof(remote_id));\n\n\tswitch (r) {\n\tcase SSH_ERR_CONN_CLOSED:\n\t\tssh_packet_clear_keys(ssh);\n\t\tlogdie(\"Connection closed by %s\", remote_id);\n\tcase SSH_ERR_CONN_TIMEOUT:\n\t\tssh_packet_clear_keys(ssh);\n\t\tlogdie(\"Connection %s %s timed out\",\n\t\t    ssh->state->server_side ? \"from\" : \"to\", remote_id);\n\tcase SSH_ERR_DISCONNECTED:\n\t\tssh_packet_clear_keys(ssh);\n\t\tlogdie(\"Disconnected from %s\", remote_id);\n\tcase SSH_ERR_SYSTEM_ERROR:\n\t\tif (errno == ECONNRESET) {\n\t\t\tssh_packet_clear_keys(ssh);\n\t\t\tlogdie(\"Connection reset by %s\", remote_id);\n\t\t}\n\t\t/* FALLTHROUGH */\n\tcase SSH_ERR_NO_CIPHER_ALG_MATCH:\n\tcase SSH_ERR_NO_MAC_ALG_MATCH:\n\tcase SSH_ERR_NO_COMPRESS_ALG_MATCH:\n\tcase SSH_ERR_NO_KEX_ALG_MATCH:\n\tcase SSH_ERR_NO_HOSTKEY_ALG_MATCH:\n\t\tif (ssh && ssh->kex && ssh->kex->failed_choice) {\n\t\t\tssh_packet_clear_keys(ssh);\n\t\t\tlogdie(\"Unable to negotiate with %s: %s. \"\n\t\t\t    \"Their offer: %s\", remote_id, ssh_err(r),\n\t\t\t    ssh->kex->failed_choice);\n\t\t}\n\t\t/* FALLTHROUGH */\n\tdefault:\n\t\tssh_packet_clear_keys(ssh);\n\t\tlogdie(\"%s%sConnection %s %s: %s\",\n\t\t    tag != NULL ? tag : \"\", tag != NULL ? \": \" : \"\",\n\t\t    ssh->state->server_side ? \"from\" : \"to\",\n\t\t    remote_id, ssh_err(r));\n\t}\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include \"packet.h\"",
            "#include \"ssh.h\"",
            "#include \"channels.h\"",
            "#include \"misc.h\"",
            "#include \"canohost.h\"",
            "#include \"log.h\"",
            "#include \"mac.h\"",
            "#include \"digest.h\"",
            "#include \"kex.h\"",
            "#include \"sshkey.h\"",
            "#include \"cipher.h\"",
            "#include \"ssh2.h\"",
            "#include \"compat.h\"",
            "#include \"crc32.h\"",
            "#include \"xmalloc.h\"",
            "#include <zlib.h>",
            "#  include <openssl/ec.h>",
            "# include <openssl/evp.h>",
            "# include <openssl/bn.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <limits.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <netdb.h>",
            "#include <errno.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include \"openbsd-compat/sys-queue.h\"",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\nsshpkt_fatal(struct ssh *ssh, const char *tag, int r)\n{\n\tchar remote_id[512];\n\n\tsshpkt_fmt_connection_id(ssh, remote_id, sizeof(remote_id));\n\n\tswitch (r) {\n\tcase SSH_ERR_CONN_CLOSED:\n\t\tssh_packet_clear_keys(ssh);\n\t\tlogdie(\"Connection closed by %s\", remote_id);\n\tcase SSH_ERR_CONN_TIMEOUT:\n\t\tssh_packet_clear_keys(ssh);\n\t\tlogdie(\"Connection %s %s timed out\",\n\t\t    ssh->state->server_side ? \"from\" : \"to\", remote_id);\n\tcase SSH_ERR_DISCONNECTED:\n\t\tssh_packet_clear_keys(ssh);\n\t\tlogdie(\"Disconnected from %s\", remote_id);\n\tcase SSH_ERR_SYSTEM_ERROR:\n\t\tif (errno == ECONNRESET) {\n\t\t\tssh_packet_clear_keys(ssh);\n\t\t\tlogdie(\"Connection reset by %s\", remote_id);\n\t\t}\n\t\t/* FALLTHROUGH */\n\tcase SSH_ERR_NO_CIPHER_ALG_MATCH:\n\tcase SSH_ERR_NO_MAC_ALG_MATCH:\n\tcase SSH_ERR_NO_COMPRESS_ALG_MATCH:\n\tcase SSH_ERR_NO_KEX_ALG_MATCH:\n\tcase SSH_ERR_NO_HOSTKEY_ALG_MATCH:\n\t\tif (ssh && ssh->kex && ssh->kex->failed_choice) {\n\t\t\tssh_packet_clear_keys(ssh);\n\t\t\tlogdie(\"Unable to negotiate with %s: %s. \"\n\t\t\t    \"Their offer: %s\", remote_id, ssh_err(r),\n\t\t\t    ssh->kex->failed_choice);\n\t\t}\n\t\t/* FALLTHROUGH */\n\tdefault:\n\t\tssh_packet_clear_keys(ssh);\n\t\tlogdie(\"%s%sConnection %s %s: %s\",\n\t\t    tag != NULL ? tag : \"\", tag != NULL ? \": \" : \"\",\n\t\t    ssh->state->server_side ? \"from\" : \"to\",\n\t\t    remote_id, ssh_err(r));\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "ssh_err",
          "args": [
            "r"
          ],
          "line": 1378
        },
        "resolved": true,
        "details": {
          "function_name": "ssh_err",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/ssherr.c",
          "lines": "22-147",
          "snippet": "const char *\nssh_err(int n)\n{\n\tswitch (n) {\n\tcase SSH_ERR_SUCCESS:\n\t\treturn \"success\";\n\tcase SSH_ERR_INTERNAL_ERROR:\n\t\treturn \"unexpected internal error\";\n\tcase SSH_ERR_ALLOC_FAIL:\n\t\treturn \"memory allocation failed\";\n\tcase SSH_ERR_MESSAGE_INCOMPLETE:\n\t\treturn \"incomplete message\";\n\tcase SSH_ERR_INVALID_FORMAT:\n\t\treturn \"invalid format\";\n\tcase SSH_ERR_BIGNUM_IS_NEGATIVE:\n\t\treturn \"bignum is negative\";\n\tcase SSH_ERR_STRING_TOO_LARGE:\n\t\treturn \"string is too large\";\n\tcase SSH_ERR_BIGNUM_TOO_LARGE:\n\t\treturn \"bignum is too large\";\n\tcase SSH_ERR_ECPOINT_TOO_LARGE:\n\t\treturn \"elliptic curve point is too large\";\n\tcase SSH_ERR_NO_BUFFER_SPACE:\n\t\treturn \"insufficient buffer space\";\n\tcase SSH_ERR_INVALID_ARGUMENT:\n\t\treturn \"invalid argument\";\n\tcase SSH_ERR_KEY_BITS_MISMATCH:\n\t\treturn \"key bits do not match\";\n\tcase SSH_ERR_EC_CURVE_INVALID:\n\t\treturn \"invalid elliptic curve\";\n\tcase SSH_ERR_KEY_TYPE_MISMATCH:\n\t\treturn \"key type does not match\";\n\tcase SSH_ERR_KEY_TYPE_UNKNOWN:\n\t\treturn \"unknown or unsupported key type\";\n\tcase SSH_ERR_EC_CURVE_MISMATCH:\n\t\treturn \"elliptic curve does not match\";\n\tcase SSH_ERR_EXPECTED_CERT:\n\t\treturn \"plain key provided where certificate required\";\n\tcase SSH_ERR_KEY_LACKS_CERTBLOB:\n\t\treturn \"key lacks certificate data\";\n\tcase SSH_ERR_KEY_CERT_UNKNOWN_TYPE:\n\t\treturn \"unknown/unsupported certificate type\";\n\tcase SSH_ERR_KEY_CERT_INVALID_SIGN_KEY:\n\t\treturn \"invalid certificate signing key\";\n\tcase SSH_ERR_KEY_INVALID_EC_VALUE:\n\t\treturn \"invalid elliptic curve value\";\n\tcase SSH_ERR_SIGNATURE_INVALID:\n\t\treturn \"incorrect signature\";\n\tcase SSH_ERR_LIBCRYPTO_ERROR:\n\t\treturn \"error in libcrypto\";  /* XXX fetch and return */\n\tcase SSH_ERR_UNEXPECTED_TRAILING_DATA:\n\t\treturn \"unexpected bytes remain after decoding\";\n\tcase SSH_ERR_SYSTEM_ERROR:\n\t\treturn strerror(errno);\n\tcase SSH_ERR_KEY_CERT_INVALID:\n\t\treturn \"invalid certificate\";\n\tcase SSH_ERR_AGENT_COMMUNICATION:\n\t\treturn \"communication with agent failed\";\n\tcase SSH_ERR_AGENT_FAILURE:\n\t\treturn \"agent refused operation\";\n\tcase SSH_ERR_DH_GEX_OUT_OF_RANGE:\n\t\treturn \"DH GEX group out of range\";\n\tcase SSH_ERR_DISCONNECTED:\n\t\treturn \"disconnected\";\n\tcase SSH_ERR_MAC_INVALID:\n\t\treturn \"message authentication code incorrect\";\n\tcase SSH_ERR_NO_CIPHER_ALG_MATCH:\n\t\treturn \"no matching cipher found\";\n\tcase SSH_ERR_NO_MAC_ALG_MATCH:\n\t\treturn \"no matching MAC found\";\n\tcase SSH_ERR_NO_COMPRESS_ALG_MATCH:\n\t\treturn \"no matching compression method found\";\n\tcase SSH_ERR_NO_KEX_ALG_MATCH:\n\t\treturn \"no matching key exchange method found\";\n\tcase SSH_ERR_NO_HOSTKEY_ALG_MATCH:\n\t\treturn \"no matching host key type found\";\n\tcase SSH_ERR_PROTOCOL_MISMATCH:\n\t\treturn \"protocol version mismatch\";\n\tcase SSH_ERR_NO_PROTOCOL_VERSION:\n\t\treturn \"could not read protocol version\";\n\tcase SSH_ERR_NO_HOSTKEY_LOADED:\n\t\treturn \"could not load host key\";\n\tcase SSH_ERR_NEED_REKEY:\n\t\treturn \"rekeying not supported by peer\";\n\tcase SSH_ERR_PASSPHRASE_TOO_SHORT:\n\t\treturn \"passphrase is too short (minimum five characters)\";\n\tcase SSH_ERR_FILE_CHANGED:\n\t\treturn \"file changed while reading\";\n\tcase SSH_ERR_KEY_UNKNOWN_CIPHER:\n\t\treturn \"key encrypted using unsupported cipher\";\n\tcase SSH_ERR_KEY_WRONG_PASSPHRASE:\n\t\treturn \"incorrect passphrase supplied to decrypt private key\";\n\tcase SSH_ERR_KEY_BAD_PERMISSIONS:\n\t\treturn \"bad permissions\";\n\tcase SSH_ERR_KEY_CERT_MISMATCH:\n\t\treturn \"certificate does not match key\";\n\tcase SSH_ERR_KEY_NOT_FOUND:\n\t\treturn \"key not found\";\n\tcase SSH_ERR_AGENT_NOT_PRESENT:\n\t\treturn \"agent not present\";\n\tcase SSH_ERR_AGENT_NO_IDENTITIES:\n\t\treturn \"agent contains no identities\";\n\tcase SSH_ERR_BUFFER_READ_ONLY:\n\t\treturn \"internal error: buffer is read-only\";\n\tcase SSH_ERR_KRL_BAD_MAGIC:\n\t\treturn \"KRL file has invalid magic number\";\n\tcase SSH_ERR_KEY_REVOKED:\n\t\treturn \"Key is revoked\";\n\tcase SSH_ERR_CONN_CLOSED:\n\t\treturn \"Connection closed\";\n\tcase SSH_ERR_CONN_TIMEOUT:\n\t\treturn \"Connection timed out\";\n\tcase SSH_ERR_CONN_CORRUPT:\n\t\treturn \"Connection corrupted\";\n\tcase SSH_ERR_PROTOCOL_ERROR:\n\t\treturn \"Protocol error\";\n\tcase SSH_ERR_KEY_LENGTH:\n\t\treturn \"Invalid key length\";\n\tcase SSH_ERR_NUMBER_TOO_LARGE:\n\t\treturn \"number is too large\";\n\tcase SSH_ERR_SIGN_ALG_UNSUPPORTED:\n\t\treturn \"signature algorithm not supported\";\n\tdefault:\n\t\treturn \"unknown error\";\n\t}\n}",
          "includes": [
            "#include \"ssherr.h\"",
            "#include <string.h>",
            "#include <errno.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"ssherr.h\"\n#include <string.h>\n#include <errno.h>\n\nconst char *\nssh_err(int n)\n{\n\tswitch (n) {\n\tcase SSH_ERR_SUCCESS:\n\t\treturn \"success\";\n\tcase SSH_ERR_INTERNAL_ERROR:\n\t\treturn \"unexpected internal error\";\n\tcase SSH_ERR_ALLOC_FAIL:\n\t\treturn \"memory allocation failed\";\n\tcase SSH_ERR_MESSAGE_INCOMPLETE:\n\t\treturn \"incomplete message\";\n\tcase SSH_ERR_INVALID_FORMAT:\n\t\treturn \"invalid format\";\n\tcase SSH_ERR_BIGNUM_IS_NEGATIVE:\n\t\treturn \"bignum is negative\";\n\tcase SSH_ERR_STRING_TOO_LARGE:\n\t\treturn \"string is too large\";\n\tcase SSH_ERR_BIGNUM_TOO_LARGE:\n\t\treturn \"bignum is too large\";\n\tcase SSH_ERR_ECPOINT_TOO_LARGE:\n\t\treturn \"elliptic curve point is too large\";\n\tcase SSH_ERR_NO_BUFFER_SPACE:\n\t\treturn \"insufficient buffer space\";\n\tcase SSH_ERR_INVALID_ARGUMENT:\n\t\treturn \"invalid argument\";\n\tcase SSH_ERR_KEY_BITS_MISMATCH:\n\t\treturn \"key bits do not match\";\n\tcase SSH_ERR_EC_CURVE_INVALID:\n\t\treturn \"invalid elliptic curve\";\n\tcase SSH_ERR_KEY_TYPE_MISMATCH:\n\t\treturn \"key type does not match\";\n\tcase SSH_ERR_KEY_TYPE_UNKNOWN:\n\t\treturn \"unknown or unsupported key type\";\n\tcase SSH_ERR_EC_CURVE_MISMATCH:\n\t\treturn \"elliptic curve does not match\";\n\tcase SSH_ERR_EXPECTED_CERT:\n\t\treturn \"plain key provided where certificate required\";\n\tcase SSH_ERR_KEY_LACKS_CERTBLOB:\n\t\treturn \"key lacks certificate data\";\n\tcase SSH_ERR_KEY_CERT_UNKNOWN_TYPE:\n\t\treturn \"unknown/unsupported certificate type\";\n\tcase SSH_ERR_KEY_CERT_INVALID_SIGN_KEY:\n\t\treturn \"invalid certificate signing key\";\n\tcase SSH_ERR_KEY_INVALID_EC_VALUE:\n\t\treturn \"invalid elliptic curve value\";\n\tcase SSH_ERR_SIGNATURE_INVALID:\n\t\treturn \"incorrect signature\";\n\tcase SSH_ERR_LIBCRYPTO_ERROR:\n\t\treturn \"error in libcrypto\";  /* XXX fetch and return */\n\tcase SSH_ERR_UNEXPECTED_TRAILING_DATA:\n\t\treturn \"unexpected bytes remain after decoding\";\n\tcase SSH_ERR_SYSTEM_ERROR:\n\t\treturn strerror(errno);\n\tcase SSH_ERR_KEY_CERT_INVALID:\n\t\treturn \"invalid certificate\";\n\tcase SSH_ERR_AGENT_COMMUNICATION:\n\t\treturn \"communication with agent failed\";\n\tcase SSH_ERR_AGENT_FAILURE:\n\t\treturn \"agent refused operation\";\n\tcase SSH_ERR_DH_GEX_OUT_OF_RANGE:\n\t\treturn \"DH GEX group out of range\";\n\tcase SSH_ERR_DISCONNECTED:\n\t\treturn \"disconnected\";\n\tcase SSH_ERR_MAC_INVALID:\n\t\treturn \"message authentication code incorrect\";\n\tcase SSH_ERR_NO_CIPHER_ALG_MATCH:\n\t\treturn \"no matching cipher found\";\n\tcase SSH_ERR_NO_MAC_ALG_MATCH:\n\t\treturn \"no matching MAC found\";\n\tcase SSH_ERR_NO_COMPRESS_ALG_MATCH:\n\t\treturn \"no matching compression method found\";\n\tcase SSH_ERR_NO_KEX_ALG_MATCH:\n\t\treturn \"no matching key exchange method found\";\n\tcase SSH_ERR_NO_HOSTKEY_ALG_MATCH:\n\t\treturn \"no matching host key type found\";\n\tcase SSH_ERR_PROTOCOL_MISMATCH:\n\t\treturn \"protocol version mismatch\";\n\tcase SSH_ERR_NO_PROTOCOL_VERSION:\n\t\treturn \"could not read protocol version\";\n\tcase SSH_ERR_NO_HOSTKEY_LOADED:\n\t\treturn \"could not load host key\";\n\tcase SSH_ERR_NEED_REKEY:\n\t\treturn \"rekeying not supported by peer\";\n\tcase SSH_ERR_PASSPHRASE_TOO_SHORT:\n\t\treturn \"passphrase is too short (minimum five characters)\";\n\tcase SSH_ERR_FILE_CHANGED:\n\t\treturn \"file changed while reading\";\n\tcase SSH_ERR_KEY_UNKNOWN_CIPHER:\n\t\treturn \"key encrypted using unsupported cipher\";\n\tcase SSH_ERR_KEY_WRONG_PASSPHRASE:\n\t\treturn \"incorrect passphrase supplied to decrypt private key\";\n\tcase SSH_ERR_KEY_BAD_PERMISSIONS:\n\t\treturn \"bad permissions\";\n\tcase SSH_ERR_KEY_CERT_MISMATCH:\n\t\treturn \"certificate does not match key\";\n\tcase SSH_ERR_KEY_NOT_FOUND:\n\t\treturn \"key not found\";\n\tcase SSH_ERR_AGENT_NOT_PRESENT:\n\t\treturn \"agent not present\";\n\tcase SSH_ERR_AGENT_NO_IDENTITIES:\n\t\treturn \"agent contains no identities\";\n\tcase SSH_ERR_BUFFER_READ_ONLY:\n\t\treturn \"internal error: buffer is read-only\";\n\tcase SSH_ERR_KRL_BAD_MAGIC:\n\t\treturn \"KRL file has invalid magic number\";\n\tcase SSH_ERR_KEY_REVOKED:\n\t\treturn \"Key is revoked\";\n\tcase SSH_ERR_CONN_CLOSED:\n\t\treturn \"Connection closed\";\n\tcase SSH_ERR_CONN_TIMEOUT:\n\t\treturn \"Connection timed out\";\n\tcase SSH_ERR_CONN_CORRUPT:\n\t\treturn \"Connection corrupted\";\n\tcase SSH_ERR_PROTOCOL_ERROR:\n\t\treturn \"Protocol error\";\n\tcase SSH_ERR_KEY_LENGTH:\n\t\treturn \"Invalid key length\";\n\tcase SSH_ERR_NUMBER_TOO_LARGE:\n\t\treturn \"number is too large\";\n\tcase SSH_ERR_SIGN_ALG_UNSUPPORTED:\n\t\treturn \"signature algorithm not supported\";\n\tdefault:\n\t\treturn \"unknown error\";\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "ssh_packet_read_seqnr",
          "args": [
            "ssh",
            "&type",
            "NULL"
          ],
          "line": 1377
        },
        "resolved": true,
        "details": {
          "function_name": "ssh_packet_read_seqnr",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
          "lines": "1281-1369",
          "snippet": "int\nssh_packet_read_seqnr(struct ssh *ssh, u_char *typep, u_int32_t *seqnr_p)\n{\n\tstruct session_state *state = ssh->state;\n\tint len, r, ms_remain;\n\tfd_set *setp;\n\tchar buf[8192];\n\tstruct timeval timeout, start, *timeoutp = NULL;\n\n\tDBG(debug(\"packet_read()\"));\n\n\tsetp = calloc(howmany(state->connection_in + 1,\n\t    NFDBITS), sizeof(fd_mask));\n\tif (setp == NULL)\n\t\treturn SSH_ERR_ALLOC_FAIL;\n\n\t/*\n\t * Since we are blocking, ensure that all written packets have\n\t * been sent.\n\t */\n\tif ((r = ssh_packet_write_wait(ssh)) != 0)\n\t\tgoto out;\n\n\t/* Stay in the loop until we have received a complete packet. */\n\tfor (;;) {\n\t\t/* Try to read a packet from the buffer. */\n\t\tr = ssh_packet_read_poll_seqnr(ssh, typep, seqnr_p);\n\t\tif (r != 0)\n\t\t\tbreak;\n\t\t/* If we got a packet, return it. */\n\t\tif (*typep != SSH_MSG_NONE)\n\t\t\tbreak;\n\t\t/*\n\t\t * Otherwise, wait for some data to arrive, add it to the\n\t\t * buffer, and try again.\n\t\t */\n\t\tmemset(setp, 0, howmany(state->connection_in + 1,\n\t\t    NFDBITS) * sizeof(fd_mask));\n\t\tFD_SET(state->connection_in, setp);\n\n\t\tif (state->packet_timeout_ms > 0) {\n\t\t\tms_remain = state->packet_timeout_ms;\n\t\t\ttimeoutp = &timeout;\n\t\t}\n\t\t/* Wait for some data to arrive. */\n\t\tfor (;;) {\n\t\t\tif (state->packet_timeout_ms != -1) {\n\t\t\t\tms_to_timeval(&timeout, ms_remain);\n\t\t\t\tmonotime_tv(&start);\n\t\t\t}\n\t\t\tif ((r = select(state->connection_in + 1, setp,\n\t\t\t    NULL, NULL, timeoutp)) >= 0)\n\t\t\t\tbreak;\n\t\t\tif (errno != EAGAIN && errno != EINTR &&\n\t\t\t    errno != EWOULDBLOCK) {\n\t\t\t\tr = SSH_ERR_SYSTEM_ERROR;\n\t\t\t\tgoto out;\n\t\t\t}\n\t\t\tif (state->packet_timeout_ms == -1)\n\t\t\t\tcontinue;\n\t\t\tms_subtract_diff(&start, &ms_remain);\n\t\t\tif (ms_remain <= 0) {\n\t\t\t\tr = 0;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tif (r == 0) {\n\t\t\tr = SSH_ERR_CONN_TIMEOUT;\n\t\t\tgoto out;\n\t\t}\n\t\t/* Read data from the socket. */\n\t\tlen = read(state->connection_in, buf, sizeof(buf));\n\t\tif (len == 0) {\n\t\t\tr = SSH_ERR_CONN_CLOSED;\n\t\t\tgoto out;\n\t\t}\n\t\tif (len < 0) {\n\t\t\tr = SSH_ERR_SYSTEM_ERROR;\n\t\t\tgoto out;\n\t\t}\n\n\t\t/* Append it to the buffer. */\n\t\tif ((r = ssh_packet_process_incoming(ssh, buf, len)) != 0)\n\t\t\tgoto out;\n\t}\n out:\n\tfree(setp);\n\treturn r;\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include \"packet.h\"",
            "#include \"ssh.h\"",
            "#include \"channels.h\"",
            "#include \"misc.h\"",
            "#include \"canohost.h\"",
            "#include \"log.h\"",
            "#include \"mac.h\"",
            "#include \"digest.h\"",
            "#include \"kex.h\"",
            "#include \"sshkey.h\"",
            "#include \"cipher.h\"",
            "#include \"ssh2.h\"",
            "#include \"compat.h\"",
            "#include \"crc32.h\"",
            "#include \"xmalloc.h\"",
            "#include <zlib.h>",
            "#  include <openssl/ec.h>",
            "# include <openssl/evp.h>",
            "# include <openssl/bn.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <limits.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <netdb.h>",
            "#include <errno.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include \"openbsd-compat/sys-queue.h\"",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nssh_packet_read_seqnr(struct ssh *ssh, u_char *typep, u_int32_t *seqnr_p)\n{\n\tstruct session_state *state = ssh->state;\n\tint len, r, ms_remain;\n\tfd_set *setp;\n\tchar buf[8192];\n\tstruct timeval timeout, start, *timeoutp = NULL;\n\n\tDBG(debug(\"packet_read()\"));\n\n\tsetp = calloc(howmany(state->connection_in + 1,\n\t    NFDBITS), sizeof(fd_mask));\n\tif (setp == NULL)\n\t\treturn SSH_ERR_ALLOC_FAIL;\n\n\t/*\n\t * Since we are blocking, ensure that all written packets have\n\t * been sent.\n\t */\n\tif ((r = ssh_packet_write_wait(ssh)) != 0)\n\t\tgoto out;\n\n\t/* Stay in the loop until we have received a complete packet. */\n\tfor (;;) {\n\t\t/* Try to read a packet from the buffer. */\n\t\tr = ssh_packet_read_poll_seqnr(ssh, typep, seqnr_p);\n\t\tif (r != 0)\n\t\t\tbreak;\n\t\t/* If we got a packet, return it. */\n\t\tif (*typep != SSH_MSG_NONE)\n\t\t\tbreak;\n\t\t/*\n\t\t * Otherwise, wait for some data to arrive, add it to the\n\t\t * buffer, and try again.\n\t\t */\n\t\tmemset(setp, 0, howmany(state->connection_in + 1,\n\t\t    NFDBITS) * sizeof(fd_mask));\n\t\tFD_SET(state->connection_in, setp);\n\n\t\tif (state->packet_timeout_ms > 0) {\n\t\t\tms_remain = state->packet_timeout_ms;\n\t\t\ttimeoutp = &timeout;\n\t\t}\n\t\t/* Wait for some data to arrive. */\n\t\tfor (;;) {\n\t\t\tif (state->packet_timeout_ms != -1) {\n\t\t\t\tms_to_timeval(&timeout, ms_remain);\n\t\t\t\tmonotime_tv(&start);\n\t\t\t}\n\t\t\tif ((r = select(state->connection_in + 1, setp,\n\t\t\t    NULL, NULL, timeoutp)) >= 0)\n\t\t\t\tbreak;\n\t\t\tif (errno != EAGAIN && errno != EINTR &&\n\t\t\t    errno != EWOULDBLOCK) {\n\t\t\t\tr = SSH_ERR_SYSTEM_ERROR;\n\t\t\t\tgoto out;\n\t\t\t}\n\t\t\tif (state->packet_timeout_ms == -1)\n\t\t\t\tcontinue;\n\t\t\tms_subtract_diff(&start, &ms_remain);\n\t\t\tif (ms_remain <= 0) {\n\t\t\t\tr = 0;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tif (r == 0) {\n\t\t\tr = SSH_ERR_CONN_TIMEOUT;\n\t\t\tgoto out;\n\t\t}\n\t\t/* Read data from the socket. */\n\t\tlen = read(state->connection_in, buf, sizeof(buf));\n\t\tif (len == 0) {\n\t\t\tr = SSH_ERR_CONN_CLOSED;\n\t\t\tgoto out;\n\t\t}\n\t\tif (len < 0) {\n\t\t\tr = SSH_ERR_SYSTEM_ERROR;\n\t\t\tgoto out;\n\t\t}\n\n\t\t/* Append it to the buffer. */\n\t\tif ((r = ssh_packet_process_incoming(ssh, buf, len)) != 0)\n\t\t\tgoto out;\n\t}\n out:\n\tfree(setp);\n\treturn r;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nssh_packet_read(struct ssh *ssh)\n{\n\tu_char type;\n\tint r;\n\n\tif ((r = ssh_packet_read_seqnr(ssh, &type, NULL)) != 0)\n\t\tfatal(\"%s: %s\", __func__, ssh_err(r));\n\treturn type;\n}"
  },
  {
    "function_name": "ssh_packet_read_seqnr",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
    "lines": "1281-1369",
    "snippet": "int\nssh_packet_read_seqnr(struct ssh *ssh, u_char *typep, u_int32_t *seqnr_p)\n{\n\tstruct session_state *state = ssh->state;\n\tint len, r, ms_remain;\n\tfd_set *setp;\n\tchar buf[8192];\n\tstruct timeval timeout, start, *timeoutp = NULL;\n\n\tDBG(debug(\"packet_read()\"));\n\n\tsetp = calloc(howmany(state->connection_in + 1,\n\t    NFDBITS), sizeof(fd_mask));\n\tif (setp == NULL)\n\t\treturn SSH_ERR_ALLOC_FAIL;\n\n\t/*\n\t * Since we are blocking, ensure that all written packets have\n\t * been sent.\n\t */\n\tif ((r = ssh_packet_write_wait(ssh)) != 0)\n\t\tgoto out;\n\n\t/* Stay in the loop until we have received a complete packet. */\n\tfor (;;) {\n\t\t/* Try to read a packet from the buffer. */\n\t\tr = ssh_packet_read_poll_seqnr(ssh, typep, seqnr_p);\n\t\tif (r != 0)\n\t\t\tbreak;\n\t\t/* If we got a packet, return it. */\n\t\tif (*typep != SSH_MSG_NONE)\n\t\t\tbreak;\n\t\t/*\n\t\t * Otherwise, wait for some data to arrive, add it to the\n\t\t * buffer, and try again.\n\t\t */\n\t\tmemset(setp, 0, howmany(state->connection_in + 1,\n\t\t    NFDBITS) * sizeof(fd_mask));\n\t\tFD_SET(state->connection_in, setp);\n\n\t\tif (state->packet_timeout_ms > 0) {\n\t\t\tms_remain = state->packet_timeout_ms;\n\t\t\ttimeoutp = &timeout;\n\t\t}\n\t\t/* Wait for some data to arrive. */\n\t\tfor (;;) {\n\t\t\tif (state->packet_timeout_ms != -1) {\n\t\t\t\tms_to_timeval(&timeout, ms_remain);\n\t\t\t\tmonotime_tv(&start);\n\t\t\t}\n\t\t\tif ((r = select(state->connection_in + 1, setp,\n\t\t\t    NULL, NULL, timeoutp)) >= 0)\n\t\t\t\tbreak;\n\t\t\tif (errno != EAGAIN && errno != EINTR &&\n\t\t\t    errno != EWOULDBLOCK) {\n\t\t\t\tr = SSH_ERR_SYSTEM_ERROR;\n\t\t\t\tgoto out;\n\t\t\t}\n\t\t\tif (state->packet_timeout_ms == -1)\n\t\t\t\tcontinue;\n\t\t\tms_subtract_diff(&start, &ms_remain);\n\t\t\tif (ms_remain <= 0) {\n\t\t\t\tr = 0;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tif (r == 0) {\n\t\t\tr = SSH_ERR_CONN_TIMEOUT;\n\t\t\tgoto out;\n\t\t}\n\t\t/* Read data from the socket. */\n\t\tlen = read(state->connection_in, buf, sizeof(buf));\n\t\tif (len == 0) {\n\t\t\tr = SSH_ERR_CONN_CLOSED;\n\t\t\tgoto out;\n\t\t}\n\t\tif (len < 0) {\n\t\t\tr = SSH_ERR_SYSTEM_ERROR;\n\t\t\tgoto out;\n\t\t}\n\n\t\t/* Append it to the buffer. */\n\t\tif ((r = ssh_packet_process_incoming(ssh, buf, len)) != 0)\n\t\t\tgoto out;\n\t}\n out:\n\tfree(setp);\n\treturn r;\n}",
    "includes": [
      "#include \"sshbuf.h\"",
      "#include \"ssherr.h\"",
      "#include \"packet.h\"",
      "#include \"ssh.h\"",
      "#include \"channels.h\"",
      "#include \"misc.h\"",
      "#include \"canohost.h\"",
      "#include \"log.h\"",
      "#include \"mac.h\"",
      "#include \"digest.h\"",
      "#include \"kex.h\"",
      "#include \"sshkey.h\"",
      "#include \"cipher.h\"",
      "#include \"ssh2.h\"",
      "#include \"compat.h\"",
      "#include \"crc32.h\"",
      "#include \"xmalloc.h\"",
      "#include <zlib.h>",
      "#  include <openssl/ec.h>",
      "# include <openssl/evp.h>",
      "# include <openssl/bn.h>",
      "#include <time.h>",
      "#include <signal.h>",
      "#include <limits.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <stdarg.h>",
      "#include <netdb.h>",
      "#include <errno.h>",
      "#include <arpa/inet.h>",
      "#include <netinet/ip.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include \"openbsd-compat/sys-queue.h\"",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "setp"
          ],
          "line": 1367
        },
        "resolved": true,
        "details": {
          "function_name": "freeze",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/smult_curve25519_ref.c",
          "lines": "50-60",
          "snippet": "static void freeze(unsigned int a[32])\n{\n  unsigned int aorig[32];\n  unsigned int j;\n  unsigned int negative;\n\n  for (j = 0;j < 32;++j) aorig[j] = a[j];\n  add(a,a,minusp);\n  negative = -((a[31] >> 7) & 1);\n  for (j = 0;j < 32;++j) a[j] ^= negative & (aorig[j] ^ a[j]);\n}",
          "includes": [],
          "macros_used": [],
          "globals_used": [
            "static const unsigned int minusp[32] = {\n 19, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 128\n} ;"
          ],
          "called_functions": [],
          "contextual_snippet": "static const unsigned int minusp[32] = {\n 19, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 128\n} ;\n\nstatic void freeze(unsigned int a[32])\n{\n  unsigned int aorig[32];\n  unsigned int j;\n  unsigned int negative;\n\n  for (j = 0;j < 32;++j) aorig[j] = a[j];\n  add(a,a,minusp);\n  negative = -((a[31] >> 7) & 1);\n  for (j = 0;j < 32;++j) a[j] ^= negative & (aorig[j] ^ a[j]);\n}"
        }
      },
      {
        "call_info": {
          "callee": "ssh_packet_process_incoming",
          "args": [
            "ssh",
            "buf",
            "len"
          ],
          "line": 1363
        },
        "resolved": true,
        "details": {
          "function_name": "ssh_packet_process_incoming",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
          "lines": "1736-1755",
          "snippet": "int\nssh_packet_process_incoming(struct ssh *ssh, const char *buf, u_int len)\n{\n\tstruct session_state *state = ssh->state;\n\tint r;\n\n\tif (state->packet_discard) {\n\t\tstate->keep_alive_timeouts = 0; /* ?? */\n\t\tif (len >= state->packet_discard) {\n\t\t\tif ((r = ssh_packet_stop_discard(ssh)) != 0)\n\t\t\t\treturn r;\n\t\t}\n\t\tstate->packet_discard -= len;\n\t\treturn 0;\n\t}\n\tif ((r = sshbuf_put(ssh->state->input, buf, len)) != 0)\n\t\treturn r;\n\n\treturn 0;\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include \"packet.h\"",
            "#include \"ssh.h\"",
            "#include \"channels.h\"",
            "#include \"misc.h\"",
            "#include \"canohost.h\"",
            "#include \"log.h\"",
            "#include \"mac.h\"",
            "#include \"digest.h\"",
            "#include \"kex.h\"",
            "#include \"sshkey.h\"",
            "#include \"cipher.h\"",
            "#include \"ssh2.h\"",
            "#include \"compat.h\"",
            "#include \"crc32.h\"",
            "#include \"xmalloc.h\"",
            "#include <zlib.h>",
            "#  include <openssl/ec.h>",
            "# include <openssl/evp.h>",
            "# include <openssl/bn.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <limits.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <netdb.h>",
            "#include <errno.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include \"openbsd-compat/sys-queue.h\"",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nssh_packet_process_incoming(struct ssh *ssh, const char *buf, u_int len)\n{\n\tstruct session_state *state = ssh->state;\n\tint r;\n\n\tif (state->packet_discard) {\n\t\tstate->keep_alive_timeouts = 0; /* ?? */\n\t\tif (len >= state->packet_discard) {\n\t\t\tif ((r = ssh_packet_stop_discard(ssh)) != 0)\n\t\t\t\treturn r;\n\t\t}\n\t\tstate->packet_discard -= len;\n\t\treturn 0;\n\t}\n\tif ((r = sshbuf_put(ssh->state->input, buf, len)) != 0)\n\t\treturn r;\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "read",
          "args": [
            "state->connection_in",
            "buf",
            "sizeof(buf)"
          ],
          "line": 1352
        },
        "resolved": true,
        "details": {
          "function_name": "ssh_packet_read_poll_seqnr",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
          "lines": "1675-1729",
          "snippet": "int\nssh_packet_read_poll_seqnr(struct ssh *ssh, u_char *typep, u_int32_t *seqnr_p)\n{\n\tstruct session_state *state = ssh->state;\n\tu_int reason, seqnr;\n\tint r;\n\tu_char *msg;\n\n\tfor (;;) {\n\t\tmsg = NULL;\n\t\tr = ssh_packet_read_poll2(ssh, typep, seqnr_p);\n\t\tif (r != 0)\n\t\t\treturn r;\n\t\tif (*typep) {\n\t\t\tstate->keep_alive_timeouts = 0;\n\t\t\tDBG(debug(\"received packet type %d\", *typep));\n\t\t}\n\t\tswitch (*typep) {\n\t\tcase SSH2_MSG_IGNORE:\n\t\t\tdebug3(\"Received SSH2_MSG_IGNORE\");\n\t\t\tbreak;\n\t\tcase SSH2_MSG_DEBUG:\n\t\t\tif ((r = sshpkt_get_u8(ssh, NULL)) != 0 ||\n\t\t\t    (r = sshpkt_get_string(ssh, &msg, NULL)) != 0 ||\n\t\t\t    (r = sshpkt_get_string(ssh, NULL, NULL)) != 0) {\n\t\t\t\tfree(msg);\n\t\t\t\treturn r;\n\t\t\t}\n\t\t\tdebug(\"Remote: %.900s\", msg);\n\t\t\tfree(msg);\n\t\t\tbreak;\n\t\tcase SSH2_MSG_DISCONNECT:\n\t\t\tif ((r = sshpkt_get_u32(ssh, &reason)) != 0 ||\n\t\t\t    (r = sshpkt_get_string(ssh, &msg, NULL)) != 0)\n\t\t\t\treturn r;\n\t\t\t/* Ignore normal client exit notifications */\n\t\t\tdo_log2(ssh->state->server_side &&\n\t\t\t    reason == SSH2_DISCONNECT_BY_APPLICATION ?\n\t\t\t    SYSLOG_LEVEL_INFO : SYSLOG_LEVEL_ERROR,\n\t\t\t    \"Received disconnect from %s port %d:\"\n\t\t\t    \"%u: %.400s\", ssh_remote_ipaddr(ssh),\n\t\t\t    ssh_remote_port(ssh), reason, msg);\n\t\t\tfree(msg);\n\t\t\treturn SSH_ERR_DISCONNECTED;\n\t\tcase SSH2_MSG_UNIMPLEMENTED:\n\t\t\tif ((r = sshpkt_get_u32(ssh, &seqnr)) != 0)\n\t\t\t\treturn r;\n\t\t\tdebug(\"Received SSH2_MSG_UNIMPLEMENTED for %u\",\n\t\t\t    seqnr);\n\t\t\tbreak;\n\t\tdefault:\n\t\t\treturn 0;\n\t\t}\n\t}\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include \"packet.h\"",
            "#include \"ssh.h\"",
            "#include \"channels.h\"",
            "#include \"misc.h\"",
            "#include \"canohost.h\"",
            "#include \"log.h\"",
            "#include \"mac.h\"",
            "#include \"digest.h\"",
            "#include \"kex.h\"",
            "#include \"sshkey.h\"",
            "#include \"cipher.h\"",
            "#include \"ssh2.h\"",
            "#include \"compat.h\"",
            "#include \"crc32.h\"",
            "#include \"xmalloc.h\"",
            "#include <zlib.h>",
            "#  include <openssl/ec.h>",
            "# include <openssl/evp.h>",
            "# include <openssl/bn.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <limits.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <netdb.h>",
            "#include <errno.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include \"openbsd-compat/sys-queue.h\"",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nssh_packet_read_poll_seqnr(struct ssh *ssh, u_char *typep, u_int32_t *seqnr_p)\n{\n\tstruct session_state *state = ssh->state;\n\tu_int reason, seqnr;\n\tint r;\n\tu_char *msg;\n\n\tfor (;;) {\n\t\tmsg = NULL;\n\t\tr = ssh_packet_read_poll2(ssh, typep, seqnr_p);\n\t\tif (r != 0)\n\t\t\treturn r;\n\t\tif (*typep) {\n\t\t\tstate->keep_alive_timeouts = 0;\n\t\t\tDBG(debug(\"received packet type %d\", *typep));\n\t\t}\n\t\tswitch (*typep) {\n\t\tcase SSH2_MSG_IGNORE:\n\t\t\tdebug3(\"Received SSH2_MSG_IGNORE\");\n\t\t\tbreak;\n\t\tcase SSH2_MSG_DEBUG:\n\t\t\tif ((r = sshpkt_get_u8(ssh, NULL)) != 0 ||\n\t\t\t    (r = sshpkt_get_string(ssh, &msg, NULL)) != 0 ||\n\t\t\t    (r = sshpkt_get_string(ssh, NULL, NULL)) != 0) {\n\t\t\t\tfree(msg);\n\t\t\t\treturn r;\n\t\t\t}\n\t\t\tdebug(\"Remote: %.900s\", msg);\n\t\t\tfree(msg);\n\t\t\tbreak;\n\t\tcase SSH2_MSG_DISCONNECT:\n\t\t\tif ((r = sshpkt_get_u32(ssh, &reason)) != 0 ||\n\t\t\t    (r = sshpkt_get_string(ssh, &msg, NULL)) != 0)\n\t\t\t\treturn r;\n\t\t\t/* Ignore normal client exit notifications */\n\t\t\tdo_log2(ssh->state->server_side &&\n\t\t\t    reason == SSH2_DISCONNECT_BY_APPLICATION ?\n\t\t\t    SYSLOG_LEVEL_INFO : SYSLOG_LEVEL_ERROR,\n\t\t\t    \"Received disconnect from %s port %d:\"\n\t\t\t    \"%u: %.400s\", ssh_remote_ipaddr(ssh),\n\t\t\t    ssh_remote_port(ssh), reason, msg);\n\t\t\tfree(msg);\n\t\t\treturn SSH_ERR_DISCONNECTED;\n\t\tcase SSH2_MSG_UNIMPLEMENTED:\n\t\t\tif ((r = sshpkt_get_u32(ssh, &seqnr)) != 0)\n\t\t\t\treturn r;\n\t\t\tdebug(\"Received SSH2_MSG_UNIMPLEMENTED for %u\",\n\t\t\t    seqnr);\n\t\t\tbreak;\n\t\tdefault:\n\t\t\treturn 0;\n\t\t}\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "ms_subtract_diff",
          "args": [
            "&start",
            "&ms_remain"
          ],
          "line": 1341
        },
        "resolved": true,
        "details": {
          "function_name": "ms_subtract_diff",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/misc.c",
          "lines": "1255-1263",
          "snippet": "void\nms_subtract_diff(struct timeval *start, int *ms)\n{\n\tstruct timeval diff, finish;\n\n\tmonotime_tv(&finish);\n\ttimersub(&finish, start, &diff);\n\t*ms -= (diff.tv_sec * 1000) + (diff.tv_usec / 1000);\n}",
          "includes": [
            "#include \"platform.h\"",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"ssh.h\"",
            "#include \"log.h\"",
            "#include \"misc.h\"",
            "#include \"xmalloc.h\"",
            "#include <net/if.h>",
            "#include <pwd.h>",
            "# include <paths.h>",
            "#include <netdb.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <ctype.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/tcp.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in_systm.h>",
            "#include <netinet/in.h>",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <libgen.h>",
            "#include <limits.h>",
            "#include <sys/un.h>",
            "#include <sys/wait.h>",
            "#include <sys/time.h>",
            "#include <sys/stat.h>",
            "#include <sys/socket.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"platform.h\"\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"ssh.h\"\n#include \"log.h\"\n#include \"misc.h\"\n#include \"xmalloc.h\"\n#include <net/if.h>\n#include <pwd.h>\n# include <paths.h>\n#include <netdb.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <ctype.h>\n#include <arpa/inet.h>\n#include <netinet/tcp.h>\n#include <netinet/ip.h>\n#include <netinet/in_systm.h>\n#include <netinet/in.h>\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <libgen.h>\n#include <limits.h>\n#include <sys/un.h>\n#include <sys/wait.h>\n#include <sys/time.h>\n#include <sys/stat.h>\n#include <sys/socket.h>\n#include <sys/ioctl.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\nms_subtract_diff(struct timeval *start, int *ms)\n{\n\tstruct timeval diff, finish;\n\n\tmonotime_tv(&finish);\n\ttimersub(&finish, start, &diff);\n\t*ms -= (diff.tv_sec * 1000) + (diff.tv_usec / 1000);\n}"
        }
      },
      {
        "call_info": {
          "callee": "select",
          "args": [
            "state->connection_in + 1",
            "setp",
            "NULL",
            "NULL",
            "timeoutp"
          ],
          "line": 1331
        },
        "resolved": true,
        "details": {
          "function_name": "select",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/smult_curve25519_ref.c",
          "lines": "110-122",
          "snippet": "static void select(unsigned int p[64],unsigned int q[64],const unsigned int r[64],const unsigned int s[64],unsigned int b)\n{\n  unsigned int j;\n  unsigned int t;\n  unsigned int bminus1;\n\n  bminus1 = b - 1;\n  for (j = 0;j < 64;++j) {\n    t = bminus1 & (r[j] ^ s[j]);\n    p[j] = s[j] ^ t;\n    q[j] = r[j] ^ t;\n  }\n}",
          "includes": [],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "static void select(unsigned int p[64],unsigned int q[64],const unsigned int r[64],const unsigned int s[64],unsigned int b)\n{\n  unsigned int j;\n  unsigned int t;\n  unsigned int bminus1;\n\n  bminus1 = b - 1;\n  for (j = 0;j < 64;++j) {\n    t = bminus1 & (r[j] ^ s[j]);\n    p[j] = s[j] ^ t;\n    q[j] = r[j] ^ t;\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "monotime_tv",
          "args": [
            "&start"
          ],
          "line": 1329
        },
        "resolved": true,
        "details": {
          "function_name": "monotime_tv",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/misc.c",
          "lines": "1305-1313",
          "snippet": "void\nmonotime_tv(struct timeval *tv)\n{\n\tstruct timespec ts;\n\n\tmonotime_ts(&ts);\n\ttv->tv_sec = ts.tv_sec;\n\ttv->tv_usec = ts.tv_nsec / 1000;\n}",
          "includes": [
            "#include \"platform.h\"",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"ssh.h\"",
            "#include \"log.h\"",
            "#include \"misc.h\"",
            "#include \"xmalloc.h\"",
            "#include <net/if.h>",
            "#include <pwd.h>",
            "# include <paths.h>",
            "#include <netdb.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <ctype.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/tcp.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in_systm.h>",
            "#include <netinet/in.h>",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <libgen.h>",
            "#include <limits.h>",
            "#include <sys/un.h>",
            "#include <sys/wait.h>",
            "#include <sys/time.h>",
            "#include <sys/stat.h>",
            "#include <sys/socket.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"platform.h\"\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"ssh.h\"\n#include \"log.h\"\n#include \"misc.h\"\n#include \"xmalloc.h\"\n#include <net/if.h>\n#include <pwd.h>\n# include <paths.h>\n#include <netdb.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <ctype.h>\n#include <arpa/inet.h>\n#include <netinet/tcp.h>\n#include <netinet/ip.h>\n#include <netinet/in_systm.h>\n#include <netinet/in.h>\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <libgen.h>\n#include <limits.h>\n#include <sys/un.h>\n#include <sys/wait.h>\n#include <sys/time.h>\n#include <sys/stat.h>\n#include <sys/socket.h>\n#include <sys/ioctl.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\nmonotime_tv(struct timeval *tv)\n{\n\tstruct timespec ts;\n\n\tmonotime_ts(&ts);\n\ttv->tv_sec = ts.tv_sec;\n\ttv->tv_usec = ts.tv_nsec / 1000;\n}"
        }
      },
      {
        "call_info": {
          "callee": "ms_to_timeval",
          "args": [
            "&timeout",
            "ms_remain"
          ],
          "line": 1328
        },
        "resolved": true,
        "details": {
          "function_name": "ms_to_timeval",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/misc.c",
          "lines": "1265-1272",
          "snippet": "void\nms_to_timeval(struct timeval *tv, int ms)\n{\n\tif (ms < 0)\n\t\tms = 0;\n\ttv->tv_sec = ms / 1000;\n\ttv->tv_usec = (ms % 1000) * 1000;\n}",
          "includes": [
            "#include \"platform.h\"",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"ssh.h\"",
            "#include \"log.h\"",
            "#include \"misc.h\"",
            "#include \"xmalloc.h\"",
            "#include <net/if.h>",
            "#include <pwd.h>",
            "# include <paths.h>",
            "#include <netdb.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <ctype.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/tcp.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in_systm.h>",
            "#include <netinet/in.h>",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <libgen.h>",
            "#include <limits.h>",
            "#include <sys/un.h>",
            "#include <sys/wait.h>",
            "#include <sys/time.h>",
            "#include <sys/stat.h>",
            "#include <sys/socket.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"platform.h\"\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"ssh.h\"\n#include \"log.h\"\n#include \"misc.h\"\n#include \"xmalloc.h\"\n#include <net/if.h>\n#include <pwd.h>\n# include <paths.h>\n#include <netdb.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <ctype.h>\n#include <arpa/inet.h>\n#include <netinet/tcp.h>\n#include <netinet/ip.h>\n#include <netinet/in_systm.h>\n#include <netinet/in.h>\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <libgen.h>\n#include <limits.h>\n#include <sys/un.h>\n#include <sys/wait.h>\n#include <sys/time.h>\n#include <sys/stat.h>\n#include <sys/socket.h>\n#include <sys/ioctl.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\nms_to_timeval(struct timeval *tv, int ms)\n{\n\tif (ms < 0)\n\t\tms = 0;\n\ttv->tv_sec = ms / 1000;\n\ttv->tv_usec = (ms % 1000) * 1000;\n}"
        }
      },
      {
        "call_info": {
          "callee": "FD_SET",
          "args": [
            "state->connection_in",
            "setp"
          ],
          "line": 1319
        },
        "resolved": true,
        "details": {
          "function_name": "kludge_FD_SET",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/openbsd-compat/kludge-fd_set.c",
          "lines": "19-21",
          "snippet": "void kludge_FD_SET(int n, fd_set *set) {\n\tFD_SET(n, set);\n}",
          "includes": [
            "#   include <sys/socket.h>",
            "# include <features.h>",
            "#include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#   include <sys/socket.h>\n# include <features.h>\n#include \"config.h\"\n\nvoid kludge_FD_SET(int n, fd_set *set) {\n\tFD_SET(n, set);\n}"
        }
      },
      {
        "call_info": {
          "callee": "memset",
          "args": [
            "setp",
            "0",
            "howmany(state->connection_in + 1,\n\t\t    NFDBITS) * sizeof(fd_mask)"
          ],
          "line": 1317
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "howmany",
          "args": [
            "state->connection_in + 1",
            "NFDBITS"
          ],
          "line": 1317
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ssh_packet_write_wait",
          "args": [
            "ssh"
          ],
          "line": 1301
        },
        "resolved": true,
        "details": {
          "function_name": "ssh_packet_write_wait",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
          "lines": "1930-1985",
          "snippet": "int\nssh_packet_write_wait(struct ssh *ssh)\n{\n\tfd_set *setp;\n\tint ret, r, ms_remain = 0;\n\tstruct timeval start, timeout, *timeoutp = NULL;\n\tstruct session_state *state = ssh->state;\n\n\tsetp = calloc(howmany(state->connection_out + 1,\n\t    NFDBITS), sizeof(fd_mask));\n\tif (setp == NULL)\n\t\treturn SSH_ERR_ALLOC_FAIL;\n\tif ((r = ssh_packet_write_poll(ssh)) != 0) {\n\t\tfree(setp);\n\t\treturn r;\n\t}\n\twhile (ssh_packet_have_data_to_write(ssh)) {\n\t\tmemset(setp, 0, howmany(state->connection_out + 1,\n\t\t    NFDBITS) * sizeof(fd_mask));\n\t\tFD_SET(state->connection_out, setp);\n\n\t\tif (state->packet_timeout_ms > 0) {\n\t\t\tms_remain = state->packet_timeout_ms;\n\t\t\ttimeoutp = &timeout;\n\t\t}\n\t\tfor (;;) {\n\t\t\tif (state->packet_timeout_ms != -1) {\n\t\t\t\tms_to_timeval(&timeout, ms_remain);\n\t\t\t\tmonotime_tv(&start);\n\t\t\t}\n\t\t\tif ((ret = select(state->connection_out + 1,\n\t\t\t    NULL, setp, NULL, timeoutp)) >= 0)\n\t\t\t\tbreak;\n\t\t\tif (errno != EAGAIN && errno != EINTR &&\n\t\t\t    errno != EWOULDBLOCK)\n\t\t\t\tbreak;\n\t\t\tif (state->packet_timeout_ms == -1)\n\t\t\t\tcontinue;\n\t\t\tms_subtract_diff(&start, &ms_remain);\n\t\t\tif (ms_remain <= 0) {\n\t\t\t\tret = 0;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tif (ret == 0) {\n\t\t\tfree(setp);\n\t\t\treturn SSH_ERR_CONN_TIMEOUT;\n\t\t}\n\t\tif ((r = ssh_packet_write_poll(ssh)) != 0) {\n\t\t\tfree(setp);\n\t\t\treturn r;\n\t\t}\n\t}\n\tfree(setp);\n\treturn 0;\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include \"packet.h\"",
            "#include \"ssh.h\"",
            "#include \"channels.h\"",
            "#include \"misc.h\"",
            "#include \"canohost.h\"",
            "#include \"log.h\"",
            "#include \"mac.h\"",
            "#include \"digest.h\"",
            "#include \"kex.h\"",
            "#include \"sshkey.h\"",
            "#include \"cipher.h\"",
            "#include \"ssh2.h\"",
            "#include \"compat.h\"",
            "#include \"crc32.h\"",
            "#include \"xmalloc.h\"",
            "#include <zlib.h>",
            "#  include <openssl/ec.h>",
            "# include <openssl/evp.h>",
            "# include <openssl/bn.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <limits.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <netdb.h>",
            "#include <errno.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include \"openbsd-compat/sys-queue.h\"",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nssh_packet_write_wait(struct ssh *ssh)\n{\n\tfd_set *setp;\n\tint ret, r, ms_remain = 0;\n\tstruct timeval start, timeout, *timeoutp = NULL;\n\tstruct session_state *state = ssh->state;\n\n\tsetp = calloc(howmany(state->connection_out + 1,\n\t    NFDBITS), sizeof(fd_mask));\n\tif (setp == NULL)\n\t\treturn SSH_ERR_ALLOC_FAIL;\n\tif ((r = ssh_packet_write_poll(ssh)) != 0) {\n\t\tfree(setp);\n\t\treturn r;\n\t}\n\twhile (ssh_packet_have_data_to_write(ssh)) {\n\t\tmemset(setp, 0, howmany(state->connection_out + 1,\n\t\t    NFDBITS) * sizeof(fd_mask));\n\t\tFD_SET(state->connection_out, setp);\n\n\t\tif (state->packet_timeout_ms > 0) {\n\t\t\tms_remain = state->packet_timeout_ms;\n\t\t\ttimeoutp = &timeout;\n\t\t}\n\t\tfor (;;) {\n\t\t\tif (state->packet_timeout_ms != -1) {\n\t\t\t\tms_to_timeval(&timeout, ms_remain);\n\t\t\t\tmonotime_tv(&start);\n\t\t\t}\n\t\t\tif ((ret = select(state->connection_out + 1,\n\t\t\t    NULL, setp, NULL, timeoutp)) >= 0)\n\t\t\t\tbreak;\n\t\t\tif (errno != EAGAIN && errno != EINTR &&\n\t\t\t    errno != EWOULDBLOCK)\n\t\t\t\tbreak;\n\t\t\tif (state->packet_timeout_ms == -1)\n\t\t\t\tcontinue;\n\t\t\tms_subtract_diff(&start, &ms_remain);\n\t\t\tif (ms_remain <= 0) {\n\t\t\t\tret = 0;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tif (ret == 0) {\n\t\t\tfree(setp);\n\t\t\treturn SSH_ERR_CONN_TIMEOUT;\n\t\t}\n\t\tif ((r = ssh_packet_write_poll(ssh)) != 0) {\n\t\t\tfree(setp);\n\t\t\treturn r;\n\t\t}\n\t}\n\tfree(setp);\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "calloc",
          "args": [
            "howmany(state->connection_in + 1,\n\t    NFDBITS)",
            "sizeof(fd_mask)"
          ],
          "line": 1292
        },
        "resolved": true,
        "details": {
          "function_name": "xcalloc",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/xmalloc.c",
          "lines": "52-66",
          "snippet": "void *\nxcalloc(size_t nmemb, size_t size)\n{\n\tvoid *ptr;\n\n\tif (size == 0 || nmemb == 0)\n\t\tfatal(\"xcalloc: zero size\");\n\tif (SIZE_MAX / nmemb < size)\n\t\tfatal(\"xcalloc: nmemb * size > SIZE_MAX\");\n\tptr = calloc(nmemb, size);\n\tif (ptr == NULL)\n\t\tfatal(\"xcalloc: out of memory (allocating %zu bytes)\",\n\t\t    size * nmemb);\n\treturn ptr;\n}",
          "includes": [
            "#include \"log.h\"",
            "#include \"xmalloc.h\"",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdint.h>",
            "#include <stdarg.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n#include \"xmalloc.h\"\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdint.h>\n#include <stdarg.h>\n#include \"includes.h\"\n\nvoid *\nxcalloc(size_t nmemb, size_t size)\n{\n\tvoid *ptr;\n\n\tif (size == 0 || nmemb == 0)\n\t\tfatal(\"xcalloc: zero size\");\n\tif (SIZE_MAX / nmemb < size)\n\t\tfatal(\"xcalloc: nmemb * size > SIZE_MAX\");\n\tptr = calloc(nmemb, size);\n\tif (ptr == NULL)\n\t\tfatal(\"xcalloc: out of memory (allocating %zu bytes)\",\n\t\t    size * nmemb);\n\treturn ptr;\n}"
        }
      },
      {
        "call_info": {
          "callee": "howmany",
          "args": [
            "state->connection_in + 1",
            "NFDBITS"
          ],
          "line": 1292
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "debug(\"packet_read()\")"
          ],
          "line": 1290
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug",
          "args": [
            "\"packet_read()\""
          ],
          "line": 1290
        },
        "resolved": true,
        "details": {
          "function_name": "debug3",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/log.c",
          "lines": "242-250",
          "snippet": "void\ndebug3(const char *fmt,...)\n{\n\tva_list args;\n\n\tva_start(args, fmt);\n\tdo_log(SYSLOG_LEVEL_DEBUG3, fmt, args);\n\tva_end(args);\n}",
          "includes": [
            "#include \"log.h\"",
            "# include <vis.h>",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <syslog.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <fcntl.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n# include <vis.h>\n#include <errno.h>\n#include <unistd.h>\n#include <syslog.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <fcntl.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\ndebug3(const char *fmt,...)\n{\n\tva_list args;\n\n\tva_start(args, fmt);\n\tdo_log(SYSLOG_LEVEL_DEBUG3, fmt, args);\n\tva_end(args);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nssh_packet_read_seqnr(struct ssh *ssh, u_char *typep, u_int32_t *seqnr_p)\n{\n\tstruct session_state *state = ssh->state;\n\tint len, r, ms_remain;\n\tfd_set *setp;\n\tchar buf[8192];\n\tstruct timeval timeout, start, *timeoutp = NULL;\n\n\tDBG(debug(\"packet_read()\"));\n\n\tsetp = calloc(howmany(state->connection_in + 1,\n\t    NFDBITS), sizeof(fd_mask));\n\tif (setp == NULL)\n\t\treturn SSH_ERR_ALLOC_FAIL;\n\n\t/*\n\t * Since we are blocking, ensure that all written packets have\n\t * been sent.\n\t */\n\tif ((r = ssh_packet_write_wait(ssh)) != 0)\n\t\tgoto out;\n\n\t/* Stay in the loop until we have received a complete packet. */\n\tfor (;;) {\n\t\t/* Try to read a packet from the buffer. */\n\t\tr = ssh_packet_read_poll_seqnr(ssh, typep, seqnr_p);\n\t\tif (r != 0)\n\t\t\tbreak;\n\t\t/* If we got a packet, return it. */\n\t\tif (*typep != SSH_MSG_NONE)\n\t\t\tbreak;\n\t\t/*\n\t\t * Otherwise, wait for some data to arrive, add it to the\n\t\t * buffer, and try again.\n\t\t */\n\t\tmemset(setp, 0, howmany(state->connection_in + 1,\n\t\t    NFDBITS) * sizeof(fd_mask));\n\t\tFD_SET(state->connection_in, setp);\n\n\t\tif (state->packet_timeout_ms > 0) {\n\t\t\tms_remain = state->packet_timeout_ms;\n\t\t\ttimeoutp = &timeout;\n\t\t}\n\t\t/* Wait for some data to arrive. */\n\t\tfor (;;) {\n\t\t\tif (state->packet_timeout_ms != -1) {\n\t\t\t\tms_to_timeval(&timeout, ms_remain);\n\t\t\t\tmonotime_tv(&start);\n\t\t\t}\n\t\t\tif ((r = select(state->connection_in + 1, setp,\n\t\t\t    NULL, NULL, timeoutp)) >= 0)\n\t\t\t\tbreak;\n\t\t\tif (errno != EAGAIN && errno != EINTR &&\n\t\t\t    errno != EWOULDBLOCK) {\n\t\t\t\tr = SSH_ERR_SYSTEM_ERROR;\n\t\t\t\tgoto out;\n\t\t\t}\n\t\t\tif (state->packet_timeout_ms == -1)\n\t\t\t\tcontinue;\n\t\t\tms_subtract_diff(&start, &ms_remain);\n\t\t\tif (ms_remain <= 0) {\n\t\t\t\tr = 0;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tif (r == 0) {\n\t\t\tr = SSH_ERR_CONN_TIMEOUT;\n\t\t\tgoto out;\n\t\t}\n\t\t/* Read data from the socket. */\n\t\tlen = read(state->connection_in, buf, sizeof(buf));\n\t\tif (len == 0) {\n\t\t\tr = SSH_ERR_CONN_CLOSED;\n\t\t\tgoto out;\n\t\t}\n\t\tif (len < 0) {\n\t\t\tr = SSH_ERR_SYSTEM_ERROR;\n\t\t\tgoto out;\n\t\t}\n\n\t\t/* Append it to the buffer. */\n\t\tif ((r = ssh_packet_process_incoming(ssh, buf, len)) != 0)\n\t\t\tgoto out;\n\t}\n out:\n\tfree(setp);\n\treturn r;\n}"
  },
  {
    "function_name": "ssh_packet_send2",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
    "lines": "1196-1273",
    "snippet": "int\nssh_packet_send2(struct ssh *ssh)\n{\n\tstruct session_state *state = ssh->state;\n\tstruct packet *p;\n\tu_char type;\n\tint r, need_rekey;\n\n\tif (sshbuf_len(state->outgoing_packet) < 6)\n\t\treturn SSH_ERR_INTERNAL_ERROR;\n\ttype = sshbuf_ptr(state->outgoing_packet)[5];\n\tneed_rekey = !ssh_packet_type_is_kex(type) &&\n\t    ssh_packet_need_rekeying(ssh, sshbuf_len(state->outgoing_packet));\n\n\t/*\n\t * During rekeying we can only send key exchange messages.\n\t * Queue everything else.\n\t */\n\tif ((need_rekey || state->rekeying) && !ssh_packet_type_is_kex(type)) {\n\t\tif (need_rekey)\n\t\t\tdebug3(\"%s: rekex triggered\", __func__);\n\t\tdebug(\"enqueue packet: %u\", type);\n\t\tp = calloc(1, sizeof(*p));\n\t\tif (p == NULL)\n\t\t\treturn SSH_ERR_ALLOC_FAIL;\n\t\tp->type = type;\n\t\tp->payload = state->outgoing_packet;\n\t\tTAILQ_INSERT_TAIL(&state->outgoing, p, next);\n\t\tstate->outgoing_packet = sshbuf_new();\n\t\tif (state->outgoing_packet == NULL)\n\t\t\treturn SSH_ERR_ALLOC_FAIL;\n\t\tif (need_rekey) {\n\t\t\t/*\n\t\t\t * This packet triggered a rekey, so send the\n\t\t\t * KEXINIT now.\n\t\t\t * NB. reenters this function via kex_start_rekex().\n\t\t\t */\n\t\t\treturn kex_start_rekex(ssh);\n\t\t}\n\t\treturn 0;\n\t}\n\n\t/* rekeying starts with sending KEXINIT */\n\tif (type == SSH2_MSG_KEXINIT)\n\t\tstate->rekeying = 1;\n\n\tif ((r = ssh_packet_send2_wrapped(ssh)) != 0)\n\t\treturn r;\n\n\t/* after a NEWKEYS message we can send the complete queue */\n\tif (type == SSH2_MSG_NEWKEYS) {\n\t\tstate->rekeying = 0;\n\t\tstate->rekey_time = monotime();\n\t\twhile ((p = TAILQ_FIRST(&state->outgoing))) {\n\t\t\ttype = p->type;\n\t\t\t/*\n\t\t\t * If this packet triggers a rekex, then skip the\n\t\t\t * remaining packets in the queue for now.\n\t\t\t * NB. re-enters this function via kex_start_rekex.\n\t\t\t */\n\t\t\tif (ssh_packet_need_rekeying(ssh,\n\t\t\t    sshbuf_len(p->payload))) {\n\t\t\t\tdebug3(\"%s: queued packet triggered rekex\",\n\t\t\t\t    __func__);\n\t\t\t\treturn kex_start_rekex(ssh);\n\t\t\t}\n\t\t\tdebug(\"dequeue packet: %u\", type);\n\t\t\tsshbuf_free(state->outgoing_packet);\n\t\t\tstate->outgoing_packet = p->payload;\n\t\t\tTAILQ_REMOVE(&state->outgoing, p, next);\n\t\t\tmemset(p, 0, sizeof(*p));\n\t\t\tfree(p);\n\t\t\tif ((r = ssh_packet_send2_wrapped(ssh)) != 0)\n\t\t\t\treturn r;\n\t\t}\n\t}\n\treturn 0;\n}",
    "includes": [
      "#include \"sshbuf.h\"",
      "#include \"ssherr.h\"",
      "#include \"packet.h\"",
      "#include \"ssh.h\"",
      "#include \"channels.h\"",
      "#include \"misc.h\"",
      "#include \"canohost.h\"",
      "#include \"log.h\"",
      "#include \"mac.h\"",
      "#include \"digest.h\"",
      "#include \"kex.h\"",
      "#include \"sshkey.h\"",
      "#include \"cipher.h\"",
      "#include \"ssh2.h\"",
      "#include \"compat.h\"",
      "#include \"crc32.h\"",
      "#include \"xmalloc.h\"",
      "#include <zlib.h>",
      "#  include <openssl/ec.h>",
      "# include <openssl/evp.h>",
      "# include <openssl/bn.h>",
      "#include <time.h>",
      "#include <signal.h>",
      "#include <limits.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <stdarg.h>",
      "#include <netdb.h>",
      "#include <errno.h>",
      "#include <arpa/inet.h>",
      "#include <netinet/ip.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include \"openbsd-compat/sys-queue.h\"",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "ssh_packet_send2_wrapped",
          "args": [
            "ssh"
          ],
          "line": 1268
        },
        "resolved": true,
        "details": {
          "function_name": "ssh_packet_send2_wrapped",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
          "lines": "1026-1182",
          "snippet": "int\nssh_packet_send2_wrapped(struct ssh *ssh)\n{\n\tstruct session_state *state = ssh->state;\n\tu_char type, *cp, macbuf[SSH_DIGEST_MAX_LENGTH];\n\tu_char tmp, padlen, pad = 0;\n\tu_int authlen = 0, aadlen = 0;\n\tu_int len;\n\tstruct sshenc *enc   = NULL;\n\tstruct sshmac *mac   = NULL;\n\tstruct sshcomp *comp = NULL;\n\tint r, block_size;\n\n\tif (state->newkeys[MODE_OUT] != NULL) {\n\t\tenc  = &state->newkeys[MODE_OUT]->enc;\n\t\tmac  = &state->newkeys[MODE_OUT]->mac;\n\t\tcomp = &state->newkeys[MODE_OUT]->comp;\n\t\t/* disable mac for authenticated encryption */\n\t\tif ((authlen = cipher_authlen(enc->cipher)) != 0)\n\t\t\tmac = NULL;\n\t}\n\tblock_size = enc ? enc->block_size : 8;\n\taadlen = (mac && mac->enabled && mac->etm) || authlen ? 4 : 0;\n\n\ttype = (sshbuf_ptr(state->outgoing_packet))[5];\n\tif (ssh_packet_log_type(type))\n\t\tdebug3(\"send packet: type %u\", type);\n#ifdef PACKET_DEBUG\n\tfprintf(stderr, \"plain:     \");\n\tsshbuf_dump(state->outgoing_packet, stderr);\n#endif\n\n\tif (comp && comp->enabled) {\n\t\tlen = sshbuf_len(state->outgoing_packet);\n\t\t/* skip header, compress only payload */\n\t\tif ((r = sshbuf_consume(state->outgoing_packet, 5)) != 0)\n\t\t\tgoto out;\n\t\tsshbuf_reset(state->compression_buffer);\n\t\tif ((r = compress_buffer(ssh, state->outgoing_packet,\n\t\t    state->compression_buffer)) != 0)\n\t\t\tgoto out;\n\t\tsshbuf_reset(state->outgoing_packet);\n\t\tif ((r = sshbuf_put(state->outgoing_packet,\n\t\t    \"\\0\\0\\0\\0\\0\", 5)) != 0 ||\n\t\t    (r = sshbuf_putb(state->outgoing_packet,\n\t\t    state->compression_buffer)) != 0)\n\t\t\tgoto out;\n\t\tDBG(debug(\"compression: raw %d compressed %zd\", len,\n\t\t    sshbuf_len(state->outgoing_packet)));\n\t}\n\n\t/* sizeof (packet_len + pad_len + payload) */\n\tlen = sshbuf_len(state->outgoing_packet);\n\n\t/*\n\t * calc size of padding, alloc space, get random data,\n\t * minimum padding is 4 bytes\n\t */\n\tlen -= aadlen; /* packet length is not encrypted for EtM modes */\n\tpadlen = block_size - (len % block_size);\n\tif (padlen < 4)\n\t\tpadlen += block_size;\n\tif (state->extra_pad) {\n\t\ttmp = state->extra_pad;\n\t\tstate->extra_pad =\n\t\t    ROUNDUP(state->extra_pad, block_size);\n\t\t/* check if roundup overflowed */\n\t\tif (state->extra_pad < tmp)\n\t\t\treturn SSH_ERR_INVALID_ARGUMENT;\n\t\ttmp = (len + padlen) % state->extra_pad;\n\t\t/* Check whether pad calculation below will underflow */\n\t\tif (tmp > state->extra_pad)\n\t\t\treturn SSH_ERR_INVALID_ARGUMENT;\n\t\tpad = state->extra_pad - tmp;\n\t\tDBG(debug3(\"%s: adding %d (len %d padlen %d extra_pad %d)\",\n\t\t    __func__, pad, len, padlen, state->extra_pad));\n\t\ttmp = padlen;\n\t\tpadlen += pad;\n\t\t/* Check whether padlen calculation overflowed */\n\t\tif (padlen < tmp)\n\t\t\treturn SSH_ERR_INVALID_ARGUMENT; /* overflow */\n\t\tstate->extra_pad = 0;\n\t}\n\tif ((r = sshbuf_reserve(state->outgoing_packet, padlen, &cp)) != 0)\n\t\tgoto out;\n\tif (enc && !cipher_ctx_is_plaintext(state->send_context)) {\n\t\t/* random padding */\n\t\tarc4random_buf(cp, padlen);\n\t} else {\n\t\t/* clear padding */\n\t\texplicit_bzero(cp, padlen);\n\t}\n\t/* sizeof (packet_len + pad_len + payload + padding) */\n\tlen = sshbuf_len(state->outgoing_packet);\n\tcp = sshbuf_mutable_ptr(state->outgoing_packet);\n\tif (cp == NULL) {\n\t\tr = SSH_ERR_INTERNAL_ERROR;\n\t\tgoto out;\n\t}\n\t/* packet_length includes payload, padding and padding length field */\n\tPOKE_U32(cp, len - 4);\n\tcp[4] = padlen;\n\tDBG(debug(\"send: len %d (includes padlen %d, aadlen %d)\",\n\t    len, padlen, aadlen));\n\n\t/* compute MAC over seqnr and packet(length fields, payload, padding) */\n\tif (mac && mac->enabled && !mac->etm) {\n\t\tif ((r = mac_compute(mac, state->p_send.seqnr,\n\t\t    sshbuf_ptr(state->outgoing_packet), len,\n\t\t    macbuf, sizeof(macbuf))) != 0)\n\t\t\tgoto out;\n\t\tDBG(debug(\"done calc MAC out #%d\", state->p_send.seqnr));\n\t}\n\t/* encrypt packet and append to output buffer. */\n\tif ((r = sshbuf_reserve(state->output,\n\t    sshbuf_len(state->outgoing_packet) + authlen, &cp)) != 0)\n\t\tgoto out;\n\tif ((r = cipher_crypt(state->send_context, state->p_send.seqnr, cp,\n\t    sshbuf_ptr(state->outgoing_packet),\n\t    len - aadlen, aadlen, authlen)) != 0)\n\t\tgoto out;\n\t/* append unencrypted MAC */\n\tif (mac && mac->enabled) {\n\t\tif (mac->etm) {\n\t\t\t/* EtM: compute mac over aadlen + cipher text */\n\t\t\tif ((r = mac_compute(mac, state->p_send.seqnr,\n\t\t\t    cp, len, macbuf, sizeof(macbuf))) != 0)\n\t\t\t\tgoto out;\n\t\t\tDBG(debug(\"done calc MAC(EtM) out #%d\",\n\t\t\t    state->p_send.seqnr));\n\t\t}\n\t\tif ((r = sshbuf_put(state->output, macbuf, mac->mac_len)) != 0)\n\t\t\tgoto out;\n\t}\n#ifdef PACKET_DEBUG\n\tfprintf(stderr, \"encrypted: \");\n\tsshbuf_dump(state->output, stderr);\n#endif\n\t/* increment sequence number for outgoing packets */\n\tif (++state->p_send.seqnr == 0)\n\t\tlogit(\"outgoing seqnr wraps around\");\n\tif (++state->p_send.packets == 0)\n\t\tif (!(ssh->compat & SSH_BUG_NOREKEY))\n\t\t\treturn SSH_ERR_NEED_REKEY;\n\tstate->p_send.blocks += len / block_size;\n\tstate->p_send.bytes += len;\n\tsshbuf_reset(state->outgoing_packet);\n\n\tif (type == SSH2_MSG_NEWKEYS)\n\t\tr = ssh_set_newkeys(ssh, MODE_OUT);\n\telse if (type == SSH2_MSG_USERAUTH_SUCCESS && state->server_side)\n\t\tr = ssh_packet_enable_delayed_compress(ssh);\n\telse\n\t\tr = 0;\n out:\n\treturn r;\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include \"packet.h\"",
            "#include \"ssh.h\"",
            "#include \"channels.h\"",
            "#include \"misc.h\"",
            "#include \"canohost.h\"",
            "#include \"log.h\"",
            "#include \"mac.h\"",
            "#include \"digest.h\"",
            "#include \"kex.h\"",
            "#include \"sshkey.h\"",
            "#include \"cipher.h\"",
            "#include \"ssh2.h\"",
            "#include \"compat.h\"",
            "#include \"crc32.h\"",
            "#include \"xmalloc.h\"",
            "#include <zlib.h>",
            "#  include <openssl/ec.h>",
            "# include <openssl/evp.h>",
            "# include <openssl/bn.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <limits.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <netdb.h>",
            "#include <errno.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include \"openbsd-compat/sys-queue.h\"",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nssh_packet_send2_wrapped(struct ssh *ssh)\n{\n\tstruct session_state *state = ssh->state;\n\tu_char type, *cp, macbuf[SSH_DIGEST_MAX_LENGTH];\n\tu_char tmp, padlen, pad = 0;\n\tu_int authlen = 0, aadlen = 0;\n\tu_int len;\n\tstruct sshenc *enc   = NULL;\n\tstruct sshmac *mac   = NULL;\n\tstruct sshcomp *comp = NULL;\n\tint r, block_size;\n\n\tif (state->newkeys[MODE_OUT] != NULL) {\n\t\tenc  = &state->newkeys[MODE_OUT]->enc;\n\t\tmac  = &state->newkeys[MODE_OUT]->mac;\n\t\tcomp = &state->newkeys[MODE_OUT]->comp;\n\t\t/* disable mac for authenticated encryption */\n\t\tif ((authlen = cipher_authlen(enc->cipher)) != 0)\n\t\t\tmac = NULL;\n\t}\n\tblock_size = enc ? enc->block_size : 8;\n\taadlen = (mac && mac->enabled && mac->etm) || authlen ? 4 : 0;\n\n\ttype = (sshbuf_ptr(state->outgoing_packet))[5];\n\tif (ssh_packet_log_type(type))\n\t\tdebug3(\"send packet: type %u\", type);\n#ifdef PACKET_DEBUG\n\tfprintf(stderr, \"plain:     \");\n\tsshbuf_dump(state->outgoing_packet, stderr);\n#endif\n\n\tif (comp && comp->enabled) {\n\t\tlen = sshbuf_len(state->outgoing_packet);\n\t\t/* skip header, compress only payload */\n\t\tif ((r = sshbuf_consume(state->outgoing_packet, 5)) != 0)\n\t\t\tgoto out;\n\t\tsshbuf_reset(state->compression_buffer);\n\t\tif ((r = compress_buffer(ssh, state->outgoing_packet,\n\t\t    state->compression_buffer)) != 0)\n\t\t\tgoto out;\n\t\tsshbuf_reset(state->outgoing_packet);\n\t\tif ((r = sshbuf_put(state->outgoing_packet,\n\t\t    \"\\0\\0\\0\\0\\0\", 5)) != 0 ||\n\t\t    (r = sshbuf_putb(state->outgoing_packet,\n\t\t    state->compression_buffer)) != 0)\n\t\t\tgoto out;\n\t\tDBG(debug(\"compression: raw %d compressed %zd\", len,\n\t\t    sshbuf_len(state->outgoing_packet)));\n\t}\n\n\t/* sizeof (packet_len + pad_len + payload) */\n\tlen = sshbuf_len(state->outgoing_packet);\n\n\t/*\n\t * calc size of padding, alloc space, get random data,\n\t * minimum padding is 4 bytes\n\t */\n\tlen -= aadlen; /* packet length is not encrypted for EtM modes */\n\tpadlen = block_size - (len % block_size);\n\tif (padlen < 4)\n\t\tpadlen += block_size;\n\tif (state->extra_pad) {\n\t\ttmp = state->extra_pad;\n\t\tstate->extra_pad =\n\t\t    ROUNDUP(state->extra_pad, block_size);\n\t\t/* check if roundup overflowed */\n\t\tif (state->extra_pad < tmp)\n\t\t\treturn SSH_ERR_INVALID_ARGUMENT;\n\t\ttmp = (len + padlen) % state->extra_pad;\n\t\t/* Check whether pad calculation below will underflow */\n\t\tif (tmp > state->extra_pad)\n\t\t\treturn SSH_ERR_INVALID_ARGUMENT;\n\t\tpad = state->extra_pad - tmp;\n\t\tDBG(debug3(\"%s: adding %d (len %d padlen %d extra_pad %d)\",\n\t\t    __func__, pad, len, padlen, state->extra_pad));\n\t\ttmp = padlen;\n\t\tpadlen += pad;\n\t\t/* Check whether padlen calculation overflowed */\n\t\tif (padlen < tmp)\n\t\t\treturn SSH_ERR_INVALID_ARGUMENT; /* overflow */\n\t\tstate->extra_pad = 0;\n\t}\n\tif ((r = sshbuf_reserve(state->outgoing_packet, padlen, &cp)) != 0)\n\t\tgoto out;\n\tif (enc && !cipher_ctx_is_plaintext(state->send_context)) {\n\t\t/* random padding */\n\t\tarc4random_buf(cp, padlen);\n\t} else {\n\t\t/* clear padding */\n\t\texplicit_bzero(cp, padlen);\n\t}\n\t/* sizeof (packet_len + pad_len + payload + padding) */\n\tlen = sshbuf_len(state->outgoing_packet);\n\tcp = sshbuf_mutable_ptr(state->outgoing_packet);\n\tif (cp == NULL) {\n\t\tr = SSH_ERR_INTERNAL_ERROR;\n\t\tgoto out;\n\t}\n\t/* packet_length includes payload, padding and padding length field */\n\tPOKE_U32(cp, len - 4);\n\tcp[4] = padlen;\n\tDBG(debug(\"send: len %d (includes padlen %d, aadlen %d)\",\n\t    len, padlen, aadlen));\n\n\t/* compute MAC over seqnr and packet(length fields, payload, padding) */\n\tif (mac && mac->enabled && !mac->etm) {\n\t\tif ((r = mac_compute(mac, state->p_send.seqnr,\n\t\t    sshbuf_ptr(state->outgoing_packet), len,\n\t\t    macbuf, sizeof(macbuf))) != 0)\n\t\t\tgoto out;\n\t\tDBG(debug(\"done calc MAC out #%d\", state->p_send.seqnr));\n\t}\n\t/* encrypt packet and append to output buffer. */\n\tif ((r = sshbuf_reserve(state->output,\n\t    sshbuf_len(state->outgoing_packet) + authlen, &cp)) != 0)\n\t\tgoto out;\n\tif ((r = cipher_crypt(state->send_context, state->p_send.seqnr, cp,\n\t    sshbuf_ptr(state->outgoing_packet),\n\t    len - aadlen, aadlen, authlen)) != 0)\n\t\tgoto out;\n\t/* append unencrypted MAC */\n\tif (mac && mac->enabled) {\n\t\tif (mac->etm) {\n\t\t\t/* EtM: compute mac over aadlen + cipher text */\n\t\t\tif ((r = mac_compute(mac, state->p_send.seqnr,\n\t\t\t    cp, len, macbuf, sizeof(macbuf))) != 0)\n\t\t\t\tgoto out;\n\t\t\tDBG(debug(\"done calc MAC(EtM) out #%d\",\n\t\t\t    state->p_send.seqnr));\n\t\t}\n\t\tif ((r = sshbuf_put(state->output, macbuf, mac->mac_len)) != 0)\n\t\t\tgoto out;\n\t}\n#ifdef PACKET_DEBUG\n\tfprintf(stderr, \"encrypted: \");\n\tsshbuf_dump(state->output, stderr);\n#endif\n\t/* increment sequence number for outgoing packets */\n\tif (++state->p_send.seqnr == 0)\n\t\tlogit(\"outgoing seqnr wraps around\");\n\tif (++state->p_send.packets == 0)\n\t\tif (!(ssh->compat & SSH_BUG_NOREKEY))\n\t\t\treturn SSH_ERR_NEED_REKEY;\n\tstate->p_send.blocks += len / block_size;\n\tstate->p_send.bytes += len;\n\tsshbuf_reset(state->outgoing_packet);\n\n\tif (type == SSH2_MSG_NEWKEYS)\n\t\tr = ssh_set_newkeys(ssh, MODE_OUT);\n\telse if (type == SSH2_MSG_USERAUTH_SUCCESS && state->server_side)\n\t\tr = ssh_packet_enable_delayed_compress(ssh);\n\telse\n\t\tr = 0;\n out:\n\treturn r;\n}"
        }
      },
      {
        "call_info": {
          "callee": "free",
          "args": [
            "p"
          ],
          "line": 1267
        },
        "resolved": true,
        "details": {
          "function_name": "freeze",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/smult_curve25519_ref.c",
          "lines": "50-60",
          "snippet": "static void freeze(unsigned int a[32])\n{\n  unsigned int aorig[32];\n  unsigned int j;\n  unsigned int negative;\n\n  for (j = 0;j < 32;++j) aorig[j] = a[j];\n  add(a,a,minusp);\n  negative = -((a[31] >> 7) & 1);\n  for (j = 0;j < 32;++j) a[j] ^= negative & (aorig[j] ^ a[j]);\n}",
          "includes": [],
          "macros_used": [],
          "globals_used": [
            "static const unsigned int minusp[32] = {\n 19, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 128\n} ;"
          ],
          "called_functions": [],
          "contextual_snippet": "static const unsigned int minusp[32] = {\n 19, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 128\n} ;\n\nstatic void freeze(unsigned int a[32])\n{\n  unsigned int aorig[32];\n  unsigned int j;\n  unsigned int negative;\n\n  for (j = 0;j < 32;++j) aorig[j] = a[j];\n  add(a,a,minusp);\n  negative = -((a[31] >> 7) & 1);\n  for (j = 0;j < 32;++j) a[j] ^= negative & (aorig[j] ^ a[j]);\n}"
        }
      },
      {
        "call_info": {
          "callee": "memset",
          "args": [
            "p",
            "0",
            "sizeof(*p)"
          ],
          "line": 1266
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "TAILQ_REMOVE",
          "args": [
            "&state->outgoing",
            "p",
            "next"
          ],
          "line": 1265
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sshbuf_free",
          "args": [
            "state->outgoing_packet"
          ],
          "line": 1263
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf.c",
          "lines": "133-166",
          "snippet": "void\nsshbuf_free(struct sshbuf *buf)\n{\n\tif (buf == NULL)\n\t\treturn;\n\t/*\n\t * The following will leak on insane buffers, but this is the safest\n\t * course of action - an invalid pointer or already-freed pointer may\n\t * have been passed to us and continuing to scribble over memory would\n\t * be bad.\n\t */\n\tif (sshbuf_check_sanity(buf) != 0)\n\t\treturn;\n\t/*\n\t * If we are a child, the free our parent to decrement its reference\n\t * count and possibly free it.\n\t */\n\tsshbuf_free(buf->parent);\n\tbuf->parent = NULL;\n\t/*\n\t * If we are a parent with still-extant children, then don't free just\n\t * yet. The last child's call to sshbuf_free should decrement our\n\t * refcount to 0 and trigger the actual free.\n\t */\n\tbuf->refcount--;\n\tif (buf->refcount > 0)\n\t\treturn;\n\tif (!buf->readonly) {\n\t\texplicit_bzero(buf->d, buf->alloc);\n\t\tfree(buf->d);\n\t}\n\texplicit_bzero(buf, sizeof(*buf));\n\tfree(buf);\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <signal.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <signal.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\nsshbuf_free(struct sshbuf *buf)\n{\n\tif (buf == NULL)\n\t\treturn;\n\t/*\n\t * The following will leak on insane buffers, but this is the safest\n\t * course of action - an invalid pointer or already-freed pointer may\n\t * have been passed to us and continuing to scribble over memory would\n\t * be bad.\n\t */\n\tif (sshbuf_check_sanity(buf) != 0)\n\t\treturn;\n\t/*\n\t * If we are a child, the free our parent to decrement its reference\n\t * count and possibly free it.\n\t */\n\tsshbuf_free(buf->parent);\n\tbuf->parent = NULL;\n\t/*\n\t * If we are a parent with still-extant children, then don't free just\n\t * yet. The last child's call to sshbuf_free should decrement our\n\t * refcount to 0 and trigger the actual free.\n\t */\n\tbuf->refcount--;\n\tif (buf->refcount > 0)\n\t\treturn;\n\tif (!buf->readonly) {\n\t\texplicit_bzero(buf->d, buf->alloc);\n\t\tfree(buf->d);\n\t}\n\texplicit_bzero(buf, sizeof(*buf));\n\tfree(buf);\n}"
        }
      },
      {
        "call_info": {
          "callee": "debug",
          "args": [
            "\"dequeue packet: %u\"",
            "type"
          ],
          "line": 1262
        },
        "resolved": true,
        "details": {
          "function_name": "ssh_packet_send_debug",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
          "lines": "1771-1794",
          "snippet": "void\nssh_packet_send_debug(struct ssh *ssh, const char *fmt,...)\n{\n\tchar buf[1024];\n\tva_list args;\n\tint r;\n\n\tif ((ssh->compat & SSH_BUG_DEBUG))\n\t\treturn;\n\n\tva_start(args, fmt);\n\tvsnprintf(buf, sizeof(buf), fmt, args);\n\tva_end(args);\n\n\tdebug3(\"sending debug message: %s\", buf);\n\n\tif ((r = sshpkt_start(ssh, SSH2_MSG_DEBUG)) != 0 ||\n\t    (r = sshpkt_put_u8(ssh, 0)) != 0 || /* always display */\n\t    (r = sshpkt_put_cstring(ssh, buf)) != 0 ||\n\t    (r = sshpkt_put_cstring(ssh, \"\")) != 0 ||\n\t    (r = sshpkt_send(ssh)) != 0 ||\n\t    (r = ssh_packet_write_wait(ssh)) != 0)\n\t\tfatal(\"%s: %s\", __func__, ssh_err(r));\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include \"packet.h\"",
            "#include \"ssh.h\"",
            "#include \"channels.h\"",
            "#include \"misc.h\"",
            "#include \"canohost.h\"",
            "#include \"log.h\"",
            "#include \"mac.h\"",
            "#include \"digest.h\"",
            "#include \"kex.h\"",
            "#include \"sshkey.h\"",
            "#include \"cipher.h\"",
            "#include \"ssh2.h\"",
            "#include \"compat.h\"",
            "#include \"crc32.h\"",
            "#include \"xmalloc.h\"",
            "#include <zlib.h>",
            "#  include <openssl/ec.h>",
            "# include <openssl/evp.h>",
            "# include <openssl/bn.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <limits.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <netdb.h>",
            "#include <errno.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include \"openbsd-compat/sys-queue.h\"",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\nssh_packet_send_debug(struct ssh *ssh, const char *fmt,...)\n{\n\tchar buf[1024];\n\tva_list args;\n\tint r;\n\n\tif ((ssh->compat & SSH_BUG_DEBUG))\n\t\treturn;\n\n\tva_start(args, fmt);\n\tvsnprintf(buf, sizeof(buf), fmt, args);\n\tva_end(args);\n\n\tdebug3(\"sending debug message: %s\", buf);\n\n\tif ((r = sshpkt_start(ssh, SSH2_MSG_DEBUG)) != 0 ||\n\t    (r = sshpkt_put_u8(ssh, 0)) != 0 || /* always display */\n\t    (r = sshpkt_put_cstring(ssh, buf)) != 0 ||\n\t    (r = sshpkt_put_cstring(ssh, \"\")) != 0 ||\n\t    (r = sshpkt_send(ssh)) != 0 ||\n\t    (r = ssh_packet_write_wait(ssh)) != 0)\n\t\tfatal(\"%s: %s\", __func__, ssh_err(r));\n}"
        }
      },
      {
        "call_info": {
          "callee": "kex_start_rekex",
          "args": [
            "ssh"
          ],
          "line": 1260
        },
        "resolved": true,
        "details": {
          "function_name": "kex_start_rekex",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/kex.c",
          "lines": "683-696",
          "snippet": "int\nkex_start_rekex(struct ssh *ssh)\n{\n\tif (ssh->kex == NULL) {\n\t\terror(\"%s: no kex\", __func__);\n\t\treturn SSH_ERR_INTERNAL_ERROR;\n\t}\n\tif (ssh->kex->done == 0) {\n\t\terror(\"%s: requested twice\", __func__);\n\t\treturn SSH_ERR_INTERNAL_ERROR;\n\t}\n\tssh->kex->done = 0;\n\treturn kex_send_kexinit(ssh);\n}",
          "includes": [
            "#include \"digest.h\"",
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include \"monitor.h\"",
            "#include \"dispatch.h\"",
            "#include \"misc.h\"",
            "#include \"match.h\"",
            "#include \"mac.h\"",
            "#include \"log.h\"",
            "#include \"kex.h\"",
            "#include \"sshkey.h\"",
            "#include \"cipher.h\"",
            "#include \"compat.h\"",
            "#include \"packet.h\"",
            "#include \"ssh2.h\"",
            "#include <openssl/dh.h>",
            "#include <openssl/crypto.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static int kex_choose_conf(struct ssh *);",
            "static int kex_input_newkeys(int, u_int32_t, struct ssh *);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"digest.h\"\n#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"monitor.h\"\n#include \"dispatch.h\"\n#include \"misc.h\"\n#include \"match.h\"\n#include \"mac.h\"\n#include \"log.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"compat.h\"\n#include \"packet.h\"\n#include \"ssh2.h\"\n#include <openssl/dh.h>\n#include <openssl/crypto.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <signal.h>\n#include \"includes.h\"\n\nstatic int kex_choose_conf(struct ssh *);\nstatic int kex_input_newkeys(int, u_int32_t, struct ssh *);\n\nint\nkex_start_rekex(struct ssh *ssh)\n{\n\tif (ssh->kex == NULL) {\n\t\terror(\"%s: no kex\", __func__);\n\t\treturn SSH_ERR_INTERNAL_ERROR;\n\t}\n\tif (ssh->kex->done == 0) {\n\t\terror(\"%s: requested twice\", __func__);\n\t\treturn SSH_ERR_INTERNAL_ERROR;\n\t}\n\tssh->kex->done = 0;\n\treturn kex_send_kexinit(ssh);\n}"
        }
      },
      {
        "call_info": {
          "callee": "debug3",
          "args": [
            "\"%s: queued packet triggered rekex\"",
            "__func__"
          ],
          "line": 1258
        },
        "resolved": true,
        "details": {
          "function_name": "debug3",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/log.c",
          "lines": "242-250",
          "snippet": "void\ndebug3(const char *fmt,...)\n{\n\tva_list args;\n\n\tva_start(args, fmt);\n\tdo_log(SYSLOG_LEVEL_DEBUG3, fmt, args);\n\tva_end(args);\n}",
          "includes": [
            "#include \"log.h\"",
            "# include <vis.h>",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <syslog.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <fcntl.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n# include <vis.h>\n#include <errno.h>\n#include <unistd.h>\n#include <syslog.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <fcntl.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\ndebug3(const char *fmt,...)\n{\n\tva_list args;\n\n\tva_start(args, fmt);\n\tdo_log(SYSLOG_LEVEL_DEBUG3, fmt, args);\n\tva_end(args);\n}"
        }
      },
      {
        "call_info": {
          "callee": "ssh_packet_need_rekeying",
          "args": [
            "ssh",
            "sshbuf_len(p->payload)"
          ],
          "line": 1256
        },
        "resolved": true,
        "details": {
          "function_name": "ssh_packet_need_rekeying",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
          "lines": "924-969",
          "snippet": "static int\nssh_packet_need_rekeying(struct ssh *ssh, u_int outbound_packet_len)\n{\n\tstruct session_state *state = ssh->state;\n\tu_int32_t out_blocks;\n\n\t/* XXX client can't cope with rekeying pre-auth */\n\tif (!state->after_authentication)\n\t\treturn 0;\n\n\t/* Haven't keyed yet or KEX in progress. */\n\tif (ssh->kex == NULL || ssh_packet_is_rekeying(ssh))\n\t\treturn 0;\n\n\t/* Peer can't rekey */\n\tif (ssh->compat & SSH_BUG_NOREKEY)\n\t\treturn 0;\n\n\t/*\n\t * Permit one packet in or out per rekey - this allows us to\n\t * make progress when rekey limits are very small.\n\t */\n\tif (state->p_send.packets == 0 && state->p_read.packets == 0)\n\t\treturn 0;\n\n\t/* Time-based rekeying */\n\tif (state->rekey_interval != 0 &&\n\t    (int64_t)state->rekey_time + state->rekey_interval <= monotime())\n\t\treturn 1;\n\n\t/*\n\t * Always rekey when MAX_PACKETS sent in either direction \n\t * As per RFC4344 section 3.1 we do this after 2^31 packets.\n\t */\n\tif (state->p_send.packets > MAX_PACKETS ||\n\t    state->p_read.packets > MAX_PACKETS)\n\t\treturn 1;\n\n\t/* Rekey after (cipher-specific) maximum blocks */\n\tout_blocks = ROUNDUP(outbound_packet_len,\n\t    state->newkeys[MODE_OUT]->enc.block_size);\n\treturn (state->max_blocks_out &&\n\t    (state->p_send.blocks + out_blocks > state->max_blocks_out)) ||\n\t    (state->max_blocks_in &&\n\t    (state->p_read.blocks > state->max_blocks_in));\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include \"packet.h\"",
            "#include \"ssh.h\"",
            "#include \"channels.h\"",
            "#include \"misc.h\"",
            "#include \"canohost.h\"",
            "#include \"log.h\"",
            "#include \"mac.h\"",
            "#include \"digest.h\"",
            "#include \"kex.h\"",
            "#include \"sshkey.h\"",
            "#include \"cipher.h\"",
            "#include \"ssh2.h\"",
            "#include \"compat.h\"",
            "#include \"crc32.h\"",
            "#include \"xmalloc.h\"",
            "#include <zlib.h>",
            "#  include <openssl/ec.h>",
            "# include <openssl/evp.h>",
            "# include <openssl/bn.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <limits.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <netdb.h>",
            "#include <errno.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include \"openbsd-compat/sys-queue.h\"",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [
            "#define MAX_PACKETS\t(1U<<31)"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\n#define MAX_PACKETS\t(1U<<31)\n\nstatic int\nssh_packet_need_rekeying(struct ssh *ssh, u_int outbound_packet_len)\n{\n\tstruct session_state *state = ssh->state;\n\tu_int32_t out_blocks;\n\n\t/* XXX client can't cope with rekeying pre-auth */\n\tif (!state->after_authentication)\n\t\treturn 0;\n\n\t/* Haven't keyed yet or KEX in progress. */\n\tif (ssh->kex == NULL || ssh_packet_is_rekeying(ssh))\n\t\treturn 0;\n\n\t/* Peer can't rekey */\n\tif (ssh->compat & SSH_BUG_NOREKEY)\n\t\treturn 0;\n\n\t/*\n\t * Permit one packet in or out per rekey - this allows us to\n\t * make progress when rekey limits are very small.\n\t */\n\tif (state->p_send.packets == 0 && state->p_read.packets == 0)\n\t\treturn 0;\n\n\t/* Time-based rekeying */\n\tif (state->rekey_interval != 0 &&\n\t    (int64_t)state->rekey_time + state->rekey_interval <= monotime())\n\t\treturn 1;\n\n\t/*\n\t * Always rekey when MAX_PACKETS sent in either direction \n\t * As per RFC4344 section 3.1 we do this after 2^31 packets.\n\t */\n\tif (state->p_send.packets > MAX_PACKETS ||\n\t    state->p_read.packets > MAX_PACKETS)\n\t\treturn 1;\n\n\t/* Rekey after (cipher-specific) maximum blocks */\n\tout_blocks = ROUNDUP(outbound_packet_len,\n\t    state->newkeys[MODE_OUT]->enc.block_size);\n\treturn (state->max_blocks_out &&\n\t    (state->p_send.blocks + out_blocks > state->max_blocks_out)) ||\n\t    (state->max_blocks_in &&\n\t    (state->p_read.blocks > state->max_blocks_in));\n}"
        }
      },
      {
        "call_info": {
          "callee": "sshbuf_len",
          "args": [
            "p->payload"
          ],
          "line": 1257
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_len",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf.c",
          "lines": "252-258",
          "snippet": "size_t\nsshbuf_len(const struct sshbuf *buf)\n{\n\tif (sshbuf_check_sanity(buf) != 0)\n\t\treturn 0;\n\treturn buf->size - buf->off;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <signal.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <signal.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nsize_t\nsshbuf_len(const struct sshbuf *buf)\n{\n\tif (sshbuf_check_sanity(buf) != 0)\n\t\treturn 0;\n\treturn buf->size - buf->off;\n}"
        }
      },
      {
        "call_info": {
          "callee": "TAILQ_FIRST",
          "args": [
            "&state->outgoing"
          ],
          "line": 1249
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "monotime",
          "args": [],
          "line": 1248
        },
        "resolved": true,
        "details": {
          "function_name": "monotime_double",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/misc.c",
          "lines": "1324-1331",
          "snippet": "double\nmonotime_double(void)\n{\n\tstruct timespec ts;\n\n\tmonotime_ts(&ts);\n\treturn ts.tv_sec + ((double)ts.tv_nsec / 1000000000);\n}",
          "includes": [
            "#include \"platform.h\"",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"ssh.h\"",
            "#include \"log.h\"",
            "#include \"misc.h\"",
            "#include \"xmalloc.h\"",
            "#include <net/if.h>",
            "#include <pwd.h>",
            "# include <paths.h>",
            "#include <netdb.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <ctype.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/tcp.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in_systm.h>",
            "#include <netinet/in.h>",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <libgen.h>",
            "#include <limits.h>",
            "#include <sys/un.h>",
            "#include <sys/wait.h>",
            "#include <sys/time.h>",
            "#include <sys/stat.h>",
            "#include <sys/socket.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"platform.h\"\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"ssh.h\"\n#include \"log.h\"\n#include \"misc.h\"\n#include \"xmalloc.h\"\n#include <net/if.h>\n#include <pwd.h>\n# include <paths.h>\n#include <netdb.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <ctype.h>\n#include <arpa/inet.h>\n#include <netinet/tcp.h>\n#include <netinet/ip.h>\n#include <netinet/in_systm.h>\n#include <netinet/in.h>\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <libgen.h>\n#include <limits.h>\n#include <sys/un.h>\n#include <sys/wait.h>\n#include <sys/time.h>\n#include <sys/stat.h>\n#include <sys/socket.h>\n#include <sys/ioctl.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\ndouble\nmonotime_double(void)\n{\n\tstruct timespec ts;\n\n\tmonotime_ts(&ts);\n\treturn ts.tv_sec + ((double)ts.tv_nsec / 1000000000);\n}"
        }
      },
      {
        "call_info": {
          "callee": "sshbuf_new",
          "args": [],
          "line": 1224
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_new",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf.c",
          "lines": "68-85",
          "snippet": "struct sshbuf *\nsshbuf_new(void)\n{\n\tstruct sshbuf *ret;\n\n\tif ((ret = calloc(sizeof(*ret), 1)) == NULL)\n\t\treturn NULL;\n\tret->alloc = SSHBUF_SIZE_INIT;\n\tret->max_size = SSHBUF_SIZE_MAX;\n\tret->readonly = 0;\n\tret->refcount = 1;\n\tret->parent = NULL;\n\tif ((ret->cd = ret->d = calloc(1, ret->alloc)) == NULL) {\n\t\tfree(ret);\n\t\treturn NULL;\n\t}\n\treturn ret;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <signal.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <signal.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nstruct sshbuf *\nsshbuf_new(void)\n{\n\tstruct sshbuf *ret;\n\n\tif ((ret = calloc(sizeof(*ret), 1)) == NULL)\n\t\treturn NULL;\n\tret->alloc = SSHBUF_SIZE_INIT;\n\tret->max_size = SSHBUF_SIZE_MAX;\n\tret->readonly = 0;\n\tret->refcount = 1;\n\tret->parent = NULL;\n\tif ((ret->cd = ret->d = calloc(1, ret->alloc)) == NULL) {\n\t\tfree(ret);\n\t\treturn NULL;\n\t}\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "TAILQ_INSERT_TAIL",
          "args": [
            "&state->outgoing",
            "p",
            "next"
          ],
          "line": 1223
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "calloc",
          "args": [
            "1",
            "sizeof(*p)"
          ],
          "line": 1218
        },
        "resolved": true,
        "details": {
          "function_name": "xcalloc",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/xmalloc.c",
          "lines": "52-66",
          "snippet": "void *\nxcalloc(size_t nmemb, size_t size)\n{\n\tvoid *ptr;\n\n\tif (size == 0 || nmemb == 0)\n\t\tfatal(\"xcalloc: zero size\");\n\tif (SIZE_MAX / nmemb < size)\n\t\tfatal(\"xcalloc: nmemb * size > SIZE_MAX\");\n\tptr = calloc(nmemb, size);\n\tif (ptr == NULL)\n\t\tfatal(\"xcalloc: out of memory (allocating %zu bytes)\",\n\t\t    size * nmemb);\n\treturn ptr;\n}",
          "includes": [
            "#include \"log.h\"",
            "#include \"xmalloc.h\"",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdint.h>",
            "#include <stdarg.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n#include \"xmalloc.h\"\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdint.h>\n#include <stdarg.h>\n#include \"includes.h\"\n\nvoid *\nxcalloc(size_t nmemb, size_t size)\n{\n\tvoid *ptr;\n\n\tif (size == 0 || nmemb == 0)\n\t\tfatal(\"xcalloc: zero size\");\n\tif (SIZE_MAX / nmemb < size)\n\t\tfatal(\"xcalloc: nmemb * size > SIZE_MAX\");\n\tptr = calloc(nmemb, size);\n\tif (ptr == NULL)\n\t\tfatal(\"xcalloc: out of memory (allocating %zu bytes)\",\n\t\t    size * nmemb);\n\treturn ptr;\n}"
        }
      },
      {
        "call_info": {
          "callee": "ssh_packet_type_is_kex",
          "args": [
            "type"
          ],
          "line": 1214
        },
        "resolved": true,
        "details": {
          "function_name": "ssh_packet_type_is_kex",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
          "lines": "1185-1194",
          "snippet": "static int\nssh_packet_type_is_kex(u_char type)\n{\n\treturn\n\t    type >= SSH2_MSG_TRANSPORT_MIN &&\n\t    type <= SSH2_MSG_TRANSPORT_MAX &&\n\t    type != SSH2_MSG_SERVICE_REQUEST &&\n\t    type != SSH2_MSG_SERVICE_ACCEPT &&\n\t    type != SSH2_MSG_EXT_INFO;\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include \"packet.h\"",
            "#include \"ssh.h\"",
            "#include \"channels.h\"",
            "#include \"misc.h\"",
            "#include \"canohost.h\"",
            "#include \"log.h\"",
            "#include \"mac.h\"",
            "#include \"digest.h\"",
            "#include \"kex.h\"",
            "#include \"sshkey.h\"",
            "#include \"cipher.h\"",
            "#include \"ssh2.h\"",
            "#include \"compat.h\"",
            "#include \"crc32.h\"",
            "#include \"xmalloc.h\"",
            "#include <zlib.h>",
            "#  include <openssl/ec.h>",
            "# include <openssl/evp.h>",
            "# include <openssl/bn.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <limits.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <netdb.h>",
            "#include <errno.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include \"openbsd-compat/sys-queue.h\"",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nstatic int\nssh_packet_type_is_kex(u_char type)\n{\n\treturn\n\t    type >= SSH2_MSG_TRANSPORT_MIN &&\n\t    type <= SSH2_MSG_TRANSPORT_MAX &&\n\t    type != SSH2_MSG_SERVICE_REQUEST &&\n\t    type != SSH2_MSG_SERVICE_ACCEPT &&\n\t    type != SSH2_MSG_EXT_INFO;\n}"
        }
      },
      {
        "call_info": {
          "callee": "sshbuf_ptr",
          "args": [
            "state->outgoing_packet"
          ],
          "line": 1206
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_ptr",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf.c",
          "lines": "268-274",
          "snippet": "const u_char *\nsshbuf_ptr(const struct sshbuf *buf)\n{\n\tif (sshbuf_check_sanity(buf) != 0)\n\t\treturn NULL;\n\treturn buf->cd + buf->off;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <signal.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <signal.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nconst u_char *\nsshbuf_ptr(const struct sshbuf *buf)\n{\n\tif (sshbuf_check_sanity(buf) != 0)\n\t\treturn NULL;\n\treturn buf->cd + buf->off;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nssh_packet_send2(struct ssh *ssh)\n{\n\tstruct session_state *state = ssh->state;\n\tstruct packet *p;\n\tu_char type;\n\tint r, need_rekey;\n\n\tif (sshbuf_len(state->outgoing_packet) < 6)\n\t\treturn SSH_ERR_INTERNAL_ERROR;\n\ttype = sshbuf_ptr(state->outgoing_packet)[5];\n\tneed_rekey = !ssh_packet_type_is_kex(type) &&\n\t    ssh_packet_need_rekeying(ssh, sshbuf_len(state->outgoing_packet));\n\n\t/*\n\t * During rekeying we can only send key exchange messages.\n\t * Queue everything else.\n\t */\n\tif ((need_rekey || state->rekeying) && !ssh_packet_type_is_kex(type)) {\n\t\tif (need_rekey)\n\t\t\tdebug3(\"%s: rekex triggered\", __func__);\n\t\tdebug(\"enqueue packet: %u\", type);\n\t\tp = calloc(1, sizeof(*p));\n\t\tif (p == NULL)\n\t\t\treturn SSH_ERR_ALLOC_FAIL;\n\t\tp->type = type;\n\t\tp->payload = state->outgoing_packet;\n\t\tTAILQ_INSERT_TAIL(&state->outgoing, p, next);\n\t\tstate->outgoing_packet = sshbuf_new();\n\t\tif (state->outgoing_packet == NULL)\n\t\t\treturn SSH_ERR_ALLOC_FAIL;\n\t\tif (need_rekey) {\n\t\t\t/*\n\t\t\t * This packet triggered a rekey, so send the\n\t\t\t * KEXINIT now.\n\t\t\t * NB. reenters this function via kex_start_rekex().\n\t\t\t */\n\t\t\treturn kex_start_rekex(ssh);\n\t\t}\n\t\treturn 0;\n\t}\n\n\t/* rekeying starts with sending KEXINIT */\n\tif (type == SSH2_MSG_KEXINIT)\n\t\tstate->rekeying = 1;\n\n\tif ((r = ssh_packet_send2_wrapped(ssh)) != 0)\n\t\treturn r;\n\n\t/* after a NEWKEYS message we can send the complete queue */\n\tif (type == SSH2_MSG_NEWKEYS) {\n\t\tstate->rekeying = 0;\n\t\tstate->rekey_time = monotime();\n\t\twhile ((p = TAILQ_FIRST(&state->outgoing))) {\n\t\t\ttype = p->type;\n\t\t\t/*\n\t\t\t * If this packet triggers a rekex, then skip the\n\t\t\t * remaining packets in the queue for now.\n\t\t\t * NB. re-enters this function via kex_start_rekex.\n\t\t\t */\n\t\t\tif (ssh_packet_need_rekeying(ssh,\n\t\t\t    sshbuf_len(p->payload))) {\n\t\t\t\tdebug3(\"%s: queued packet triggered rekex\",\n\t\t\t\t    __func__);\n\t\t\t\treturn kex_start_rekex(ssh);\n\t\t\t}\n\t\t\tdebug(\"dequeue packet: %u\", type);\n\t\t\tsshbuf_free(state->outgoing_packet);\n\t\t\tstate->outgoing_packet = p->payload;\n\t\t\tTAILQ_REMOVE(&state->outgoing, p, next);\n\t\t\tmemset(p, 0, sizeof(*p));\n\t\t\tfree(p);\n\t\t\tif ((r = ssh_packet_send2_wrapped(ssh)) != 0)\n\t\t\t\treturn r;\n\t\t}\n\t}\n\treturn 0;\n}"
  },
  {
    "function_name": "ssh_packet_type_is_kex",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
    "lines": "1185-1194",
    "snippet": "static int\nssh_packet_type_is_kex(u_char type)\n{\n\treturn\n\t    type >= SSH2_MSG_TRANSPORT_MIN &&\n\t    type <= SSH2_MSG_TRANSPORT_MAX &&\n\t    type != SSH2_MSG_SERVICE_REQUEST &&\n\t    type != SSH2_MSG_SERVICE_ACCEPT &&\n\t    type != SSH2_MSG_EXT_INFO;\n}",
    "includes": [
      "#include \"sshbuf.h\"",
      "#include \"ssherr.h\"",
      "#include \"packet.h\"",
      "#include \"ssh.h\"",
      "#include \"channels.h\"",
      "#include \"misc.h\"",
      "#include \"canohost.h\"",
      "#include \"log.h\"",
      "#include \"mac.h\"",
      "#include \"digest.h\"",
      "#include \"kex.h\"",
      "#include \"sshkey.h\"",
      "#include \"cipher.h\"",
      "#include \"ssh2.h\"",
      "#include \"compat.h\"",
      "#include \"crc32.h\"",
      "#include \"xmalloc.h\"",
      "#include <zlib.h>",
      "#  include <openssl/ec.h>",
      "# include <openssl/evp.h>",
      "# include <openssl/bn.h>",
      "#include <time.h>",
      "#include <signal.h>",
      "#include <limits.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <stdarg.h>",
      "#include <netdb.h>",
      "#include <errno.h>",
      "#include <arpa/inet.h>",
      "#include <netinet/ip.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include \"openbsd-compat/sys-queue.h\"",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nstatic int\nssh_packet_type_is_kex(u_char type)\n{\n\treturn\n\t    type >= SSH2_MSG_TRANSPORT_MIN &&\n\t    type <= SSH2_MSG_TRANSPORT_MAX &&\n\t    type != SSH2_MSG_SERVICE_REQUEST &&\n\t    type != SSH2_MSG_SERVICE_ACCEPT &&\n\t    type != SSH2_MSG_EXT_INFO;\n}"
  },
  {
    "function_name": "ssh_packet_send2_wrapped",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
    "lines": "1026-1182",
    "snippet": "int\nssh_packet_send2_wrapped(struct ssh *ssh)\n{\n\tstruct session_state *state = ssh->state;\n\tu_char type, *cp, macbuf[SSH_DIGEST_MAX_LENGTH];\n\tu_char tmp, padlen, pad = 0;\n\tu_int authlen = 0, aadlen = 0;\n\tu_int len;\n\tstruct sshenc *enc   = NULL;\n\tstruct sshmac *mac   = NULL;\n\tstruct sshcomp *comp = NULL;\n\tint r, block_size;\n\n\tif (state->newkeys[MODE_OUT] != NULL) {\n\t\tenc  = &state->newkeys[MODE_OUT]->enc;\n\t\tmac  = &state->newkeys[MODE_OUT]->mac;\n\t\tcomp = &state->newkeys[MODE_OUT]->comp;\n\t\t/* disable mac for authenticated encryption */\n\t\tif ((authlen = cipher_authlen(enc->cipher)) != 0)\n\t\t\tmac = NULL;\n\t}\n\tblock_size = enc ? enc->block_size : 8;\n\taadlen = (mac && mac->enabled && mac->etm) || authlen ? 4 : 0;\n\n\ttype = (sshbuf_ptr(state->outgoing_packet))[5];\n\tif (ssh_packet_log_type(type))\n\t\tdebug3(\"send packet: type %u\", type);\n#ifdef PACKET_DEBUG\n\tfprintf(stderr, \"plain:     \");\n\tsshbuf_dump(state->outgoing_packet, stderr);\n#endif\n\n\tif (comp && comp->enabled) {\n\t\tlen = sshbuf_len(state->outgoing_packet);\n\t\t/* skip header, compress only payload */\n\t\tif ((r = sshbuf_consume(state->outgoing_packet, 5)) != 0)\n\t\t\tgoto out;\n\t\tsshbuf_reset(state->compression_buffer);\n\t\tif ((r = compress_buffer(ssh, state->outgoing_packet,\n\t\t    state->compression_buffer)) != 0)\n\t\t\tgoto out;\n\t\tsshbuf_reset(state->outgoing_packet);\n\t\tif ((r = sshbuf_put(state->outgoing_packet,\n\t\t    \"\\0\\0\\0\\0\\0\", 5)) != 0 ||\n\t\t    (r = sshbuf_putb(state->outgoing_packet,\n\t\t    state->compression_buffer)) != 0)\n\t\t\tgoto out;\n\t\tDBG(debug(\"compression: raw %d compressed %zd\", len,\n\t\t    sshbuf_len(state->outgoing_packet)));\n\t}\n\n\t/* sizeof (packet_len + pad_len + payload) */\n\tlen = sshbuf_len(state->outgoing_packet);\n\n\t/*\n\t * calc size of padding, alloc space, get random data,\n\t * minimum padding is 4 bytes\n\t */\n\tlen -= aadlen; /* packet length is not encrypted for EtM modes */\n\tpadlen = block_size - (len % block_size);\n\tif (padlen < 4)\n\t\tpadlen += block_size;\n\tif (state->extra_pad) {\n\t\ttmp = state->extra_pad;\n\t\tstate->extra_pad =\n\t\t    ROUNDUP(state->extra_pad, block_size);\n\t\t/* check if roundup overflowed */\n\t\tif (state->extra_pad < tmp)\n\t\t\treturn SSH_ERR_INVALID_ARGUMENT;\n\t\ttmp = (len + padlen) % state->extra_pad;\n\t\t/* Check whether pad calculation below will underflow */\n\t\tif (tmp > state->extra_pad)\n\t\t\treturn SSH_ERR_INVALID_ARGUMENT;\n\t\tpad = state->extra_pad - tmp;\n\t\tDBG(debug3(\"%s: adding %d (len %d padlen %d extra_pad %d)\",\n\t\t    __func__, pad, len, padlen, state->extra_pad));\n\t\ttmp = padlen;\n\t\tpadlen += pad;\n\t\t/* Check whether padlen calculation overflowed */\n\t\tif (padlen < tmp)\n\t\t\treturn SSH_ERR_INVALID_ARGUMENT; /* overflow */\n\t\tstate->extra_pad = 0;\n\t}\n\tif ((r = sshbuf_reserve(state->outgoing_packet, padlen, &cp)) != 0)\n\t\tgoto out;\n\tif (enc && !cipher_ctx_is_plaintext(state->send_context)) {\n\t\t/* random padding */\n\t\tarc4random_buf(cp, padlen);\n\t} else {\n\t\t/* clear padding */\n\t\texplicit_bzero(cp, padlen);\n\t}\n\t/* sizeof (packet_len + pad_len + payload + padding) */\n\tlen = sshbuf_len(state->outgoing_packet);\n\tcp = sshbuf_mutable_ptr(state->outgoing_packet);\n\tif (cp == NULL) {\n\t\tr = SSH_ERR_INTERNAL_ERROR;\n\t\tgoto out;\n\t}\n\t/* packet_length includes payload, padding and padding length field */\n\tPOKE_U32(cp, len - 4);\n\tcp[4] = padlen;\n\tDBG(debug(\"send: len %d (includes padlen %d, aadlen %d)\",\n\t    len, padlen, aadlen));\n\n\t/* compute MAC over seqnr and packet(length fields, payload, padding) */\n\tif (mac && mac->enabled && !mac->etm) {\n\t\tif ((r = mac_compute(mac, state->p_send.seqnr,\n\t\t    sshbuf_ptr(state->outgoing_packet), len,\n\t\t    macbuf, sizeof(macbuf))) != 0)\n\t\t\tgoto out;\n\t\tDBG(debug(\"done calc MAC out #%d\", state->p_send.seqnr));\n\t}\n\t/* encrypt packet and append to output buffer. */\n\tif ((r = sshbuf_reserve(state->output,\n\t    sshbuf_len(state->outgoing_packet) + authlen, &cp)) != 0)\n\t\tgoto out;\n\tif ((r = cipher_crypt(state->send_context, state->p_send.seqnr, cp,\n\t    sshbuf_ptr(state->outgoing_packet),\n\t    len - aadlen, aadlen, authlen)) != 0)\n\t\tgoto out;\n\t/* append unencrypted MAC */\n\tif (mac && mac->enabled) {\n\t\tif (mac->etm) {\n\t\t\t/* EtM: compute mac over aadlen + cipher text */\n\t\t\tif ((r = mac_compute(mac, state->p_send.seqnr,\n\t\t\t    cp, len, macbuf, sizeof(macbuf))) != 0)\n\t\t\t\tgoto out;\n\t\t\tDBG(debug(\"done calc MAC(EtM) out #%d\",\n\t\t\t    state->p_send.seqnr));\n\t\t}\n\t\tif ((r = sshbuf_put(state->output, macbuf, mac->mac_len)) != 0)\n\t\t\tgoto out;\n\t}\n#ifdef PACKET_DEBUG\n\tfprintf(stderr, \"encrypted: \");\n\tsshbuf_dump(state->output, stderr);\n#endif\n\t/* increment sequence number for outgoing packets */\n\tif (++state->p_send.seqnr == 0)\n\t\tlogit(\"outgoing seqnr wraps around\");\n\tif (++state->p_send.packets == 0)\n\t\tif (!(ssh->compat & SSH_BUG_NOREKEY))\n\t\t\treturn SSH_ERR_NEED_REKEY;\n\tstate->p_send.blocks += len / block_size;\n\tstate->p_send.bytes += len;\n\tsshbuf_reset(state->outgoing_packet);\n\n\tif (type == SSH2_MSG_NEWKEYS)\n\t\tr = ssh_set_newkeys(ssh, MODE_OUT);\n\telse if (type == SSH2_MSG_USERAUTH_SUCCESS && state->server_side)\n\t\tr = ssh_packet_enable_delayed_compress(ssh);\n\telse\n\t\tr = 0;\n out:\n\treturn r;\n}",
    "includes": [
      "#include \"sshbuf.h\"",
      "#include \"ssherr.h\"",
      "#include \"packet.h\"",
      "#include \"ssh.h\"",
      "#include \"channels.h\"",
      "#include \"misc.h\"",
      "#include \"canohost.h\"",
      "#include \"log.h\"",
      "#include \"mac.h\"",
      "#include \"digest.h\"",
      "#include \"kex.h\"",
      "#include \"sshkey.h\"",
      "#include \"cipher.h\"",
      "#include \"ssh2.h\"",
      "#include \"compat.h\"",
      "#include \"crc32.h\"",
      "#include \"xmalloc.h\"",
      "#include <zlib.h>",
      "#  include <openssl/ec.h>",
      "# include <openssl/evp.h>",
      "# include <openssl/bn.h>",
      "#include <time.h>",
      "#include <signal.h>",
      "#include <limits.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <stdarg.h>",
      "#include <netdb.h>",
      "#include <errno.h>",
      "#include <arpa/inet.h>",
      "#include <netinet/ip.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include \"openbsd-compat/sys-queue.h\"",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "ssh_packet_enable_delayed_compress",
          "args": [
            "ssh"
          ],
          "line": 1177
        },
        "resolved": true,
        "details": {
          "function_name": "ssh_packet_enable_delayed_compress",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
          "lines": "976-1007",
          "snippet": "static int\nssh_packet_enable_delayed_compress(struct ssh *ssh)\n{\n\tstruct session_state *state = ssh->state;\n\tstruct sshcomp *comp = NULL;\n\tint r, mode;\n\n\t/*\n\t * Remember that we are past the authentication step, so rekeying\n\t * with COMP_DELAYED will turn on compression immediately.\n\t */\n\tstate->after_authentication = 1;\n\tfor (mode = 0; mode < MODE_MAX; mode++) {\n\t\t/* protocol error: USERAUTH_SUCCESS received before NEWKEYS */\n\t\tif (state->newkeys[mode] == NULL)\n\t\t\tcontinue;\n\t\tcomp = &state->newkeys[mode]->comp;\n\t\tif (comp && !comp->enabled && comp->type == COMP_DELAYED) {\n\t\t\tif ((r = ssh_packet_init_compression(ssh)) != 0)\n\t\t\t\treturn r;\n\t\t\tif (mode == MODE_OUT) {\n\t\t\t\tif ((r = start_compression_out(ssh, 6)) != 0)\n\t\t\t\t\treturn r;\n\t\t\t} else {\n\t\t\t\tif ((r = start_compression_in(ssh)) != 0)\n\t\t\t\t\treturn r;\n\t\t\t}\n\t\t\tcomp->enabled = 1;\n\t\t}\n\t}\n\treturn 0;\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include \"packet.h\"",
            "#include \"ssh.h\"",
            "#include \"channels.h\"",
            "#include \"misc.h\"",
            "#include \"canohost.h\"",
            "#include \"log.h\"",
            "#include \"mac.h\"",
            "#include \"digest.h\"",
            "#include \"kex.h\"",
            "#include \"sshkey.h\"",
            "#include \"cipher.h\"",
            "#include \"ssh2.h\"",
            "#include \"compat.h\"",
            "#include \"crc32.h\"",
            "#include \"xmalloc.h\"",
            "#include <zlib.h>",
            "#  include <openssl/ec.h>",
            "# include <openssl/evp.h>",
            "# include <openssl/bn.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <limits.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <netdb.h>",
            "#include <errno.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include \"openbsd-compat/sys-queue.h\"",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nstatic int\nssh_packet_enable_delayed_compress(struct ssh *ssh)\n{\n\tstruct session_state *state = ssh->state;\n\tstruct sshcomp *comp = NULL;\n\tint r, mode;\n\n\t/*\n\t * Remember that we are past the authentication step, so rekeying\n\t * with COMP_DELAYED will turn on compression immediately.\n\t */\n\tstate->after_authentication = 1;\n\tfor (mode = 0; mode < MODE_MAX; mode++) {\n\t\t/* protocol error: USERAUTH_SUCCESS received before NEWKEYS */\n\t\tif (state->newkeys[mode] == NULL)\n\t\t\tcontinue;\n\t\tcomp = &state->newkeys[mode]->comp;\n\t\tif (comp && !comp->enabled && comp->type == COMP_DELAYED) {\n\t\t\tif ((r = ssh_packet_init_compression(ssh)) != 0)\n\t\t\t\treturn r;\n\t\t\tif (mode == MODE_OUT) {\n\t\t\t\tif ((r = start_compression_out(ssh, 6)) != 0)\n\t\t\t\t\treturn r;\n\t\t\t} else {\n\t\t\t\tif ((r = start_compression_in(ssh)) != 0)\n\t\t\t\t\treturn r;\n\t\t\t}\n\t\t\tcomp->enabled = 1;\n\t\t}\n\t}\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "ssh_set_newkeys",
          "args": [
            "ssh",
            "MODE_OUT"
          ],
          "line": 1175
        },
        "resolved": true,
        "details": {
          "function_name": "ssh_set_newkeys",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
          "lines": "828-921",
          "snippet": "int\nssh_set_newkeys(struct ssh *ssh, int mode)\n{\n\tstruct session_state *state = ssh->state;\n\tstruct sshenc *enc;\n\tstruct sshmac *mac;\n\tstruct sshcomp *comp;\n\tstruct sshcipher_ctx **ccp;\n\tstruct packet_state *ps;\n\tu_int64_t *max_blocks;\n\tconst char *wmsg;\n\tint r, crypt_type;\n\n\tdebug2(\"set_newkeys: mode %d\", mode);\n\n\tif (mode == MODE_OUT) {\n\t\tccp = &state->send_context;\n\t\tcrypt_type = CIPHER_ENCRYPT;\n\t\tps = &state->p_send;\n\t\tmax_blocks = &state->max_blocks_out;\n\t} else {\n\t\tccp = &state->receive_context;\n\t\tcrypt_type = CIPHER_DECRYPT;\n\t\tps = &state->p_read;\n\t\tmax_blocks = &state->max_blocks_in;\n\t}\n\tif (state->newkeys[mode] != NULL) {\n\t\tdebug(\"set_newkeys: rekeying, input %llu bytes %llu blocks, \"\n\t\t   \"output %llu bytes %llu blocks\",\n\t\t   (unsigned long long)state->p_read.bytes,\n\t\t   (unsigned long long)state->p_read.blocks,\n\t\t   (unsigned long long)state->p_send.bytes,\n\t\t   (unsigned long long)state->p_send.blocks);\n\t\tcipher_free(*ccp);\n\t\t*ccp = NULL;\n\t\tkex_free_newkeys(state->newkeys[mode]);\n\t\tstate->newkeys[mode] = NULL;\n\t}\n\t/* note that both bytes and the seqnr are not reset */\n\tps->packets = ps->blocks = 0;\n\t/* move newkeys from kex to state */\n\tif ((state->newkeys[mode] = ssh->kex->newkeys[mode]) == NULL)\n\t\treturn SSH_ERR_INTERNAL_ERROR;\n\tssh->kex->newkeys[mode] = NULL;\n\tenc  = &state->newkeys[mode]->enc;\n\tmac  = &state->newkeys[mode]->mac;\n\tcomp = &state->newkeys[mode]->comp;\n\tif (cipher_authlen(enc->cipher) == 0) {\n\t\tif ((r = mac_init(mac)) != 0)\n\t\t\treturn r;\n\t}\n\tmac->enabled = 1;\n\tDBG(debug(\"cipher_init_context: %d\", mode));\n\tif ((r = cipher_init(ccp, enc->cipher, enc->key, enc->key_len,\n\t    enc->iv, enc->iv_len, crypt_type)) != 0)\n\t\treturn r;\n\tif (!state->cipher_warning_done &&\n\t    (wmsg = cipher_warning_message(*ccp)) != NULL) {\n\t\terror(\"Warning: %s\", wmsg);\n\t\tstate->cipher_warning_done = 1;\n\t}\n\t/* Deleting the keys does not gain extra security */\n\t/* explicit_bzero(enc->iv,  enc->block_size);\n\t   explicit_bzero(enc->key, enc->key_len);\n\t   explicit_bzero(mac->key, mac->key_len); */\n\tif ((comp->type == COMP_ZLIB ||\n\t    (comp->type == COMP_DELAYED &&\n\t     state->after_authentication)) && comp->enabled == 0) {\n\t\tif ((r = ssh_packet_init_compression(ssh)) < 0)\n\t\t\treturn r;\n\t\tif (mode == MODE_OUT) {\n\t\t\tif ((r = start_compression_out(ssh, 6)) != 0)\n\t\t\t\treturn r;\n\t\t} else {\n\t\t\tif ((r = start_compression_in(ssh)) != 0)\n\t\t\t\treturn r;\n\t\t}\n\t\tcomp->enabled = 1;\n\t}\n\t/*\n\t * The 2^(blocksize*2) limit is too expensive for 3DES,\n\t * so enforce a 1GB limit for small blocksizes.\n\t * See RFC4344 section 3.2.\n\t */\n\tif (enc->block_size >= 16)\n\t\t*max_blocks = (u_int64_t)1 << (enc->block_size*2);\n\telse\n\t\t*max_blocks = ((u_int64_t)1 << 30) / enc->block_size;\n\tif (state->rekey_limit)\n\t\t*max_blocks = MINIMUM(*max_blocks,\n\t\t    state->rekey_limit / enc->block_size);\n\tdebug(\"rekey after %llu blocks\", (unsigned long long)*max_blocks);\n\treturn 0;\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include \"packet.h\"",
            "#include \"ssh.h\"",
            "#include \"channels.h\"",
            "#include \"misc.h\"",
            "#include \"canohost.h\"",
            "#include \"log.h\"",
            "#include \"mac.h\"",
            "#include \"digest.h\"",
            "#include \"kex.h\"",
            "#include \"sshkey.h\"",
            "#include \"cipher.h\"",
            "#include \"ssh2.h\"",
            "#include \"compat.h\"",
            "#include \"crc32.h\"",
            "#include \"xmalloc.h\"",
            "#include <zlib.h>",
            "#  include <openssl/ec.h>",
            "# include <openssl/evp.h>",
            "# include <openssl/bn.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <limits.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <netdb.h>",
            "#include <errno.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include \"openbsd-compat/sys-queue.h\"",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nssh_set_newkeys(struct ssh *ssh, int mode)\n{\n\tstruct session_state *state = ssh->state;\n\tstruct sshenc *enc;\n\tstruct sshmac *mac;\n\tstruct sshcomp *comp;\n\tstruct sshcipher_ctx **ccp;\n\tstruct packet_state *ps;\n\tu_int64_t *max_blocks;\n\tconst char *wmsg;\n\tint r, crypt_type;\n\n\tdebug2(\"set_newkeys: mode %d\", mode);\n\n\tif (mode == MODE_OUT) {\n\t\tccp = &state->send_context;\n\t\tcrypt_type = CIPHER_ENCRYPT;\n\t\tps = &state->p_send;\n\t\tmax_blocks = &state->max_blocks_out;\n\t} else {\n\t\tccp = &state->receive_context;\n\t\tcrypt_type = CIPHER_DECRYPT;\n\t\tps = &state->p_read;\n\t\tmax_blocks = &state->max_blocks_in;\n\t}\n\tif (state->newkeys[mode] != NULL) {\n\t\tdebug(\"set_newkeys: rekeying, input %llu bytes %llu blocks, \"\n\t\t   \"output %llu bytes %llu blocks\",\n\t\t   (unsigned long long)state->p_read.bytes,\n\t\t   (unsigned long long)state->p_read.blocks,\n\t\t   (unsigned long long)state->p_send.bytes,\n\t\t   (unsigned long long)state->p_send.blocks);\n\t\tcipher_free(*ccp);\n\t\t*ccp = NULL;\n\t\tkex_free_newkeys(state->newkeys[mode]);\n\t\tstate->newkeys[mode] = NULL;\n\t}\n\t/* note that both bytes and the seqnr are not reset */\n\tps->packets = ps->blocks = 0;\n\t/* move newkeys from kex to state */\n\tif ((state->newkeys[mode] = ssh->kex->newkeys[mode]) == NULL)\n\t\treturn SSH_ERR_INTERNAL_ERROR;\n\tssh->kex->newkeys[mode] = NULL;\n\tenc  = &state->newkeys[mode]->enc;\n\tmac  = &state->newkeys[mode]->mac;\n\tcomp = &state->newkeys[mode]->comp;\n\tif (cipher_authlen(enc->cipher) == 0) {\n\t\tif ((r = mac_init(mac)) != 0)\n\t\t\treturn r;\n\t}\n\tmac->enabled = 1;\n\tDBG(debug(\"cipher_init_context: %d\", mode));\n\tif ((r = cipher_init(ccp, enc->cipher, enc->key, enc->key_len,\n\t    enc->iv, enc->iv_len, crypt_type)) != 0)\n\t\treturn r;\n\tif (!state->cipher_warning_done &&\n\t    (wmsg = cipher_warning_message(*ccp)) != NULL) {\n\t\terror(\"Warning: %s\", wmsg);\n\t\tstate->cipher_warning_done = 1;\n\t}\n\t/* Deleting the keys does not gain extra security */\n\t/* explicit_bzero(enc->iv,  enc->block_size);\n\t   explicit_bzero(enc->key, enc->key_len);\n\t   explicit_bzero(mac->key, mac->key_len); */\n\tif ((comp->type == COMP_ZLIB ||\n\t    (comp->type == COMP_DELAYED &&\n\t     state->after_authentication)) && comp->enabled == 0) {\n\t\tif ((r = ssh_packet_init_compression(ssh)) < 0)\n\t\t\treturn r;\n\t\tif (mode == MODE_OUT) {\n\t\t\tif ((r = start_compression_out(ssh, 6)) != 0)\n\t\t\t\treturn r;\n\t\t} else {\n\t\t\tif ((r = start_compression_in(ssh)) != 0)\n\t\t\t\treturn r;\n\t\t}\n\t\tcomp->enabled = 1;\n\t}\n\t/*\n\t * The 2^(blocksize*2) limit is too expensive for 3DES,\n\t * so enforce a 1GB limit for small blocksizes.\n\t * See RFC4344 section 3.2.\n\t */\n\tif (enc->block_size >= 16)\n\t\t*max_blocks = (u_int64_t)1 << (enc->block_size*2);\n\telse\n\t\t*max_blocks = ((u_int64_t)1 << 30) / enc->block_size;\n\tif (state->rekey_limit)\n\t\t*max_blocks = MINIMUM(*max_blocks,\n\t\t    state->rekey_limit / enc->block_size);\n\tdebug(\"rekey after %llu blocks\", (unsigned long long)*max_blocks);\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "sshbuf_reset",
          "args": [
            "state->outgoing_packet"
          ],
          "line": 1172
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_reset",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf.c",
          "lines": "168-188",
          "snippet": "void\nsshbuf_reset(struct sshbuf *buf)\n{\n\tu_char *d;\n\n\tif (buf->readonly || buf->refcount > 1) {\n\t\t/* Nonsensical. Just make buffer appear empty */\n\t\tbuf->off = buf->size;\n\t\treturn;\n\t}\n\t(void) sshbuf_check_sanity(buf);\n\tbuf->off = buf->size = 0;\n\tif (buf->alloc != SSHBUF_SIZE_INIT) {\n\t\tif ((d = recallocarray(buf->d, buf->alloc, SSHBUF_SIZE_INIT,\n\t\t    1)) != NULL) {\n\t\t\tbuf->cd = buf->d = d;\n\t\t\tbuf->alloc = SSHBUF_SIZE_INIT;\n\t\t}\n\t}\n\texplicit_bzero(buf->d, SSHBUF_SIZE_INIT);\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <signal.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <signal.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\nsshbuf_reset(struct sshbuf *buf)\n{\n\tu_char *d;\n\n\tif (buf->readonly || buf->refcount > 1) {\n\t\t/* Nonsensical. Just make buffer appear empty */\n\t\tbuf->off = buf->size;\n\t\treturn;\n\t}\n\t(void) sshbuf_check_sanity(buf);\n\tbuf->off = buf->size = 0;\n\tif (buf->alloc != SSHBUF_SIZE_INIT) {\n\t\tif ((d = recallocarray(buf->d, buf->alloc, SSHBUF_SIZE_INIT,\n\t\t    1)) != NULL) {\n\t\t\tbuf->cd = buf->d = d;\n\t\t\tbuf->alloc = SSHBUF_SIZE_INIT;\n\t\t}\n\t}\n\texplicit_bzero(buf->d, SSHBUF_SIZE_INIT);\n}"
        }
      },
      {
        "call_info": {
          "callee": "logit",
          "args": [
            "\"outgoing seqnr wraps around\""
          ],
          "line": 1166
        },
        "resolved": true,
        "details": {
          "function_name": "logit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/log.c",
          "lines": "198-206",
          "snippet": "void\nlogit(const char *fmt,...)\n{\n\tva_list args;\n\n\tva_start(args, fmt);\n\tdo_log(SYSLOG_LEVEL_INFO, fmt, args);\n\tva_end(args);\n}",
          "includes": [
            "#include \"log.h\"",
            "# include <vis.h>",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <syslog.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <fcntl.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n# include <vis.h>\n#include <errno.h>\n#include <unistd.h>\n#include <syslog.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <fcntl.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\nlogit(const char *fmt,...)\n{\n\tva_list args;\n\n\tva_start(args, fmt);\n\tdo_log(SYSLOG_LEVEL_INFO, fmt, args);\n\tva_end(args);\n}"
        }
      },
      {
        "call_info": {
          "callee": "sshbuf_dump",
          "args": [
            "state->output",
            "stderr"
          ],
          "line": 1162
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_dump",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf-misc.c",
          "lines": "65-70",
          "snippet": "void\nsshbuf_dump(struct sshbuf *buf, FILE *f)\n{\n\tfprintf(f, \"buffer %p len = %zu\\n\", buf, sshbuf_len(buf));\n\tsshbuf_dump_data(sshbuf_ptr(buf), sshbuf_len(buf), f);\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include <ctype.h>",
            "#include <resolv.h>",
            "#include <string.h>",
            "#include <limits.h>",
            "#include <stdio.h>",
            "#include <stdint.h>",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include <netinet/in.h>",
            "#include <sys/socket.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include <ctype.h>\n#include <resolv.h>\n#include <string.h>\n#include <limits.h>\n#include <stdio.h>\n#include <stdint.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <netinet/in.h>\n#include <sys/socket.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\nsshbuf_dump(struct sshbuf *buf, FILE *f)\n{\n\tfprintf(f, \"buffer %p len = %zu\\n\", buf, sshbuf_len(buf));\n\tsshbuf_dump_data(sshbuf_ptr(buf), sshbuf_len(buf), f);\n}"
        }
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"encrypted: \""
          ],
          "line": 1161
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sshbuf_put",
          "args": [
            "state->output",
            "macbuf",
            "mac->mac_len"
          ],
          "line": 1157
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_putf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf-getput-basic.c",
          "lines": "254-264",
          "snippet": "int\nsshbuf_putf(struct sshbuf *buf, const char *fmt, ...)\n{\n\tva_list ap;\n\tint r;\n\n\tva_start(ap, fmt);\n\tr = sshbuf_putfv(buf, fmt, ap);\n\tva_end(ap);\n\treturn r;\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <stdarg.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <stdarg.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshbuf_putf(struct sshbuf *buf, const char *fmt, ...)\n{\n\tva_list ap;\n\tint r;\n\n\tva_start(ap, fmt);\n\tr = sshbuf_putfv(buf, fmt, ap);\n\tva_end(ap);\n\treturn r;\n}"
        }
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "debug(\"done calc MAC(EtM) out #%d\",\n\t\t\t    state->p_send.seqnr)"
          ],
          "line": 1154
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug",
          "args": [
            "\"done calc MAC(EtM) out #%d\"",
            "state->p_send.seqnr"
          ],
          "line": 1154
        },
        "resolved": true,
        "details": {
          "function_name": "ssh_packet_send_debug",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
          "lines": "1771-1794",
          "snippet": "void\nssh_packet_send_debug(struct ssh *ssh, const char *fmt,...)\n{\n\tchar buf[1024];\n\tva_list args;\n\tint r;\n\n\tif ((ssh->compat & SSH_BUG_DEBUG))\n\t\treturn;\n\n\tva_start(args, fmt);\n\tvsnprintf(buf, sizeof(buf), fmt, args);\n\tva_end(args);\n\n\tdebug3(\"sending debug message: %s\", buf);\n\n\tif ((r = sshpkt_start(ssh, SSH2_MSG_DEBUG)) != 0 ||\n\t    (r = sshpkt_put_u8(ssh, 0)) != 0 || /* always display */\n\t    (r = sshpkt_put_cstring(ssh, buf)) != 0 ||\n\t    (r = sshpkt_put_cstring(ssh, \"\")) != 0 ||\n\t    (r = sshpkt_send(ssh)) != 0 ||\n\t    (r = ssh_packet_write_wait(ssh)) != 0)\n\t\tfatal(\"%s: %s\", __func__, ssh_err(r));\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include \"packet.h\"",
            "#include \"ssh.h\"",
            "#include \"channels.h\"",
            "#include \"misc.h\"",
            "#include \"canohost.h\"",
            "#include \"log.h\"",
            "#include \"mac.h\"",
            "#include \"digest.h\"",
            "#include \"kex.h\"",
            "#include \"sshkey.h\"",
            "#include \"cipher.h\"",
            "#include \"ssh2.h\"",
            "#include \"compat.h\"",
            "#include \"crc32.h\"",
            "#include \"xmalloc.h\"",
            "#include <zlib.h>",
            "#  include <openssl/ec.h>",
            "# include <openssl/evp.h>",
            "# include <openssl/bn.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <limits.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <netdb.h>",
            "#include <errno.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include \"openbsd-compat/sys-queue.h\"",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\nssh_packet_send_debug(struct ssh *ssh, const char *fmt,...)\n{\n\tchar buf[1024];\n\tva_list args;\n\tint r;\n\n\tif ((ssh->compat & SSH_BUG_DEBUG))\n\t\treturn;\n\n\tva_start(args, fmt);\n\tvsnprintf(buf, sizeof(buf), fmt, args);\n\tva_end(args);\n\n\tdebug3(\"sending debug message: %s\", buf);\n\n\tif ((r = sshpkt_start(ssh, SSH2_MSG_DEBUG)) != 0 ||\n\t    (r = sshpkt_put_u8(ssh, 0)) != 0 || /* always display */\n\t    (r = sshpkt_put_cstring(ssh, buf)) != 0 ||\n\t    (r = sshpkt_put_cstring(ssh, \"\")) != 0 ||\n\t    (r = sshpkt_send(ssh)) != 0 ||\n\t    (r = ssh_packet_write_wait(ssh)) != 0)\n\t\tfatal(\"%s: %s\", __func__, ssh_err(r));\n}"
        }
      },
      {
        "call_info": {
          "callee": "mac_compute",
          "args": [
            "mac",
            "state->p_send.seqnr",
            "cp",
            "len",
            "macbuf",
            "sizeof(macbuf)"
          ],
          "line": 1151
        },
        "resolved": true,
        "details": {
          "function_name": "mac_compute",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/mac.c",
          "lines": "166-210",
          "snippet": "int\nmac_compute(struct sshmac *mac, u_int32_t seqno,\n    const u_char *data, int datalen,\n    u_char *digest, size_t dlen)\n{\n\tstatic union {\n\t\tu_char m[SSH_DIGEST_MAX_LENGTH];\n\t\tu_int64_t for_align;\n\t} u;\n\tu_char b[4];\n\tu_char nonce[8];\n\n\tif (mac->mac_len > sizeof(u))\n\t\treturn SSH_ERR_INTERNAL_ERROR;\n\n\tswitch (mac->type) {\n\tcase SSH_DIGEST:\n\t\tput_u32(b, seqno);\n\t\t/* reset HMAC context */\n\t\tif (ssh_hmac_init(mac->hmac_ctx, NULL, 0) < 0 ||\n\t\t    ssh_hmac_update(mac->hmac_ctx, b, sizeof(b)) < 0 ||\n\t\t    ssh_hmac_update(mac->hmac_ctx, data, datalen) < 0 ||\n\t\t    ssh_hmac_final(mac->hmac_ctx, u.m, sizeof(u.m)) < 0)\n\t\t\treturn SSH_ERR_LIBCRYPTO_ERROR;\n\t\tbreak;\n\tcase SSH_UMAC:\n\t\tPOKE_U64(nonce, seqno);\n\t\tumac_update(mac->umac_ctx, data, datalen);\n\t\tumac_final(mac->umac_ctx, u.m, nonce);\n\t\tbreak;\n\tcase SSH_UMAC128:\n\t\tput_u64(nonce, seqno);\n\t\tumac128_update(mac->umac_ctx, data, datalen);\n\t\tumac128_final(mac->umac_ctx, u.m, nonce);\n\t\tbreak;\n\tdefault:\n\t\treturn SSH_ERR_INVALID_ARGUMENT;\n\t}\n\tif (digest != NULL) {\n\t\tif (dlen > mac->mac_len)\n\t\t\tdlen = mac->mac_len;\n\t\tmemcpy(digest, u.m, dlen);\n\t}\n\treturn 0;\n}",
          "includes": [
            "#include \"openbsd-compat/openssl-compat.h\"",
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include \"misc.h\"",
            "#include \"mac.h\"",
            "#include \"umac.h\"",
            "#include \"hmac.h\"",
            "#include \"digest.h\"",
            "#include <stdio.h>",
            "#include <string.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [
            "#define SSH_UMAC128\t3",
            "#define SSH_UMAC\t2\t/* UMAC (not integrated with OpenSSL) */",
            "#define SSH_DIGEST\t1\t/* SSH_DIGEST_XXX */"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"openbsd-compat/openssl-compat.h\"\n#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"misc.h\"\n#include \"mac.h\"\n#include \"umac.h\"\n#include \"hmac.h\"\n#include \"digest.h\"\n#include <stdio.h>\n#include <string.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\n#define SSH_UMAC128\t3\n#define SSH_UMAC\t2\t/* UMAC (not integrated with OpenSSL) */\n#define SSH_DIGEST\t1\t/* SSH_DIGEST_XXX */\n\nint\nmac_compute(struct sshmac *mac, u_int32_t seqno,\n    const u_char *data, int datalen,\n    u_char *digest, size_t dlen)\n{\n\tstatic union {\n\t\tu_char m[SSH_DIGEST_MAX_LENGTH];\n\t\tu_int64_t for_align;\n\t} u;\n\tu_char b[4];\n\tu_char nonce[8];\n\n\tif (mac->mac_len > sizeof(u))\n\t\treturn SSH_ERR_INTERNAL_ERROR;\n\n\tswitch (mac->type) {\n\tcase SSH_DIGEST:\n\t\tput_u32(b, seqno);\n\t\t/* reset HMAC context */\n\t\tif (ssh_hmac_init(mac->hmac_ctx, NULL, 0) < 0 ||\n\t\t    ssh_hmac_update(mac->hmac_ctx, b, sizeof(b)) < 0 ||\n\t\t    ssh_hmac_update(mac->hmac_ctx, data, datalen) < 0 ||\n\t\t    ssh_hmac_final(mac->hmac_ctx, u.m, sizeof(u.m)) < 0)\n\t\t\treturn SSH_ERR_LIBCRYPTO_ERROR;\n\t\tbreak;\n\tcase SSH_UMAC:\n\t\tPOKE_U64(nonce, seqno);\n\t\tumac_update(mac->umac_ctx, data, datalen);\n\t\tumac_final(mac->umac_ctx, u.m, nonce);\n\t\tbreak;\n\tcase SSH_UMAC128:\n\t\tput_u64(nonce, seqno);\n\t\tumac128_update(mac->umac_ctx, data, datalen);\n\t\tumac128_final(mac->umac_ctx, u.m, nonce);\n\t\tbreak;\n\tdefault:\n\t\treturn SSH_ERR_INVALID_ARGUMENT;\n\t}\n\tif (digest != NULL) {\n\t\tif (dlen > mac->mac_len)\n\t\t\tdlen = mac->mac_len;\n\t\tmemcpy(digest, u.m, dlen);\n\t}\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "cipher_crypt",
          "args": [
            "state->send_context",
            "state->p_send.seqnr",
            "cp",
            "sshbuf_ptr(state->outgoing_packet)",
            "len - aadlen",
            "aadlen",
            "authlen"
          ],
          "line": 1143
        },
        "resolved": true,
        "details": {
          "function_name": "cipher_crypt",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/cipher.c",
          "lines": "334-394",
          "snippet": "int\ncipher_crypt(struct sshcipher_ctx *cc, u_int seqnr, u_char *dest,\n   const u_char *src, u_int len, u_int aadlen, u_int authlen)\n{\n\tif ((cc->cipher->flags & CFLAG_CHACHAPOLY) != 0) {\n\t\treturn chachapoly_crypt(&cc->cp_ctx, seqnr, dest, src,\n\t\t    len, aadlen, authlen, cc->encrypt);\n\t}\n\tif ((cc->cipher->flags & CFLAG_NONE) != 0) {\n\t\tmemcpy(dest, src, aadlen + len);\n\t\treturn 0;\n\t}\n#ifndef WITH_OPENSSL\n\tif ((cc->cipher->flags & CFLAG_AESCTR) != 0) {\n\t\tif (aadlen)\n\t\t\tmemcpy(dest, src, aadlen);\n\t\taesctr_encrypt_bytes(&cc->ac_ctx, src + aadlen,\n\t\t    dest + aadlen, len);\n\t\treturn 0;\n\t}\n\treturn SSH_ERR_INVALID_ARGUMENT;\n#else\n\tif (authlen) {\n\t\tu_char lastiv[1];\n\n\t\tif (authlen != cipher_authlen(cc->cipher))\n\t\t\treturn SSH_ERR_INVALID_ARGUMENT;\n\t\t/* increment IV */\n\t\tif (!EVP_CIPHER_CTX_ctrl(cc->evp, EVP_CTRL_GCM_IV_GEN,\n\t\t    1, lastiv))\n\t\t\treturn SSH_ERR_LIBCRYPTO_ERROR;\n\t\t/* set tag on decyption */\n\t\tif (!cc->encrypt &&\n\t\t    !EVP_CIPHER_CTX_ctrl(cc->evp, EVP_CTRL_GCM_SET_TAG,\n\t\t    authlen, (u_char *)src + aadlen + len))\n\t\t\treturn SSH_ERR_LIBCRYPTO_ERROR;\n\t}\n\tif (aadlen) {\n\t\tif (authlen &&\n\t\t    EVP_Cipher(cc->evp, NULL, (u_char *)src, aadlen) < 0)\n\t\t\treturn SSH_ERR_LIBCRYPTO_ERROR;\n\t\tmemcpy(dest, src, aadlen);\n\t}\n\tif (len % cc->cipher->block_size)\n\t\treturn SSH_ERR_INVALID_ARGUMENT;\n\tif (EVP_Cipher(cc->evp, dest + aadlen, (u_char *)src + aadlen,\n\t    len) < 0)\n\t\treturn SSH_ERR_LIBCRYPTO_ERROR;\n\tif (authlen) {\n\t\t/* compute tag (on encrypt) or verify tag (on decrypt) */\n\t\tif (EVP_Cipher(cc->evp, NULL, NULL, 0) < 0)\n\t\t\treturn cc->encrypt ?\n\t\t\t    SSH_ERR_LIBCRYPTO_ERROR : SSH_ERR_MAC_INVALID;\n\t\tif (cc->encrypt &&\n\t\t    !EVP_CIPHER_CTX_ctrl(cc->evp, EVP_CTRL_GCM_GET_TAG,\n\t\t    authlen, dest + aadlen + len))\n\t\t\treturn SSH_ERR_LIBCRYPTO_ERROR;\n\t}\n\treturn 0;\n#endif\n}",
          "includes": [
            "#include \"openbsd-compat/openssl-compat.h\"",
            "#include \"digest.h\"",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"misc.h\"",
            "#include \"cipher.h\"",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <string.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [
            "#define CFLAG_NONE\t\t(1<<3)",
            "#define CFLAG_AESCTR\t\t(1<<2)",
            "#define CFLAG_CHACHAPOLY\t(1<<1)"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"openbsd-compat/openssl-compat.h\"\n#include \"digest.h\"\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"misc.h\"\n#include \"cipher.h\"\n#include <stdio.h>\n#include <stdarg.h>\n#include <string.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\n#define CFLAG_NONE\t\t(1<<3)\n#define CFLAG_AESCTR\t\t(1<<2)\n#define CFLAG_CHACHAPOLY\t(1<<1)\n\nint\ncipher_crypt(struct sshcipher_ctx *cc, u_int seqnr, u_char *dest,\n   const u_char *src, u_int len, u_int aadlen, u_int authlen)\n{\n\tif ((cc->cipher->flags & CFLAG_CHACHAPOLY) != 0) {\n\t\treturn chachapoly_crypt(&cc->cp_ctx, seqnr, dest, src,\n\t\t    len, aadlen, authlen, cc->encrypt);\n\t}\n\tif ((cc->cipher->flags & CFLAG_NONE) != 0) {\n\t\tmemcpy(dest, src, aadlen + len);\n\t\treturn 0;\n\t}\n#ifndef WITH_OPENSSL\n\tif ((cc->cipher->flags & CFLAG_AESCTR) != 0) {\n\t\tif (aadlen)\n\t\t\tmemcpy(dest, src, aadlen);\n\t\taesctr_encrypt_bytes(&cc->ac_ctx, src + aadlen,\n\t\t    dest + aadlen, len);\n\t\treturn 0;\n\t}\n\treturn SSH_ERR_INVALID_ARGUMENT;\n#else\n\tif (authlen) {\n\t\tu_char lastiv[1];\n\n\t\tif (authlen != cipher_authlen(cc->cipher))\n\t\t\treturn SSH_ERR_INVALID_ARGUMENT;\n\t\t/* increment IV */\n\t\tif (!EVP_CIPHER_CTX_ctrl(cc->evp, EVP_CTRL_GCM_IV_GEN,\n\t\t    1, lastiv))\n\t\t\treturn SSH_ERR_LIBCRYPTO_ERROR;\n\t\t/* set tag on decyption */\n\t\tif (!cc->encrypt &&\n\t\t    !EVP_CIPHER_CTX_ctrl(cc->evp, EVP_CTRL_GCM_SET_TAG,\n\t\t    authlen, (u_char *)src + aadlen + len))\n\t\t\treturn SSH_ERR_LIBCRYPTO_ERROR;\n\t}\n\tif (aadlen) {\n\t\tif (authlen &&\n\t\t    EVP_Cipher(cc->evp, NULL, (u_char *)src, aadlen) < 0)\n\t\t\treturn SSH_ERR_LIBCRYPTO_ERROR;\n\t\tmemcpy(dest, src, aadlen);\n\t}\n\tif (len % cc->cipher->block_size)\n\t\treturn SSH_ERR_INVALID_ARGUMENT;\n\tif (EVP_Cipher(cc->evp, dest + aadlen, (u_char *)src + aadlen,\n\t    len) < 0)\n\t\treturn SSH_ERR_LIBCRYPTO_ERROR;\n\tif (authlen) {\n\t\t/* compute tag (on encrypt) or verify tag (on decrypt) */\n\t\tif (EVP_Cipher(cc->evp, NULL, NULL, 0) < 0)\n\t\t\treturn cc->encrypt ?\n\t\t\t    SSH_ERR_LIBCRYPTO_ERROR : SSH_ERR_MAC_INVALID;\n\t\tif (cc->encrypt &&\n\t\t    !EVP_CIPHER_CTX_ctrl(cc->evp, EVP_CTRL_GCM_GET_TAG,\n\t\t    authlen, dest + aadlen + len))\n\t\t\treturn SSH_ERR_LIBCRYPTO_ERROR;\n\t}\n\treturn 0;\n#endif\n}"
        }
      },
      {
        "call_info": {
          "callee": "sshbuf_ptr",
          "args": [
            "state->outgoing_packet"
          ],
          "line": 1144
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_ptr",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf.c",
          "lines": "268-274",
          "snippet": "const u_char *\nsshbuf_ptr(const struct sshbuf *buf)\n{\n\tif (sshbuf_check_sanity(buf) != 0)\n\t\treturn NULL;\n\treturn buf->cd + buf->off;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <signal.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <signal.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nconst u_char *\nsshbuf_ptr(const struct sshbuf *buf)\n{\n\tif (sshbuf_check_sanity(buf) != 0)\n\t\treturn NULL;\n\treturn buf->cd + buf->off;\n}"
        }
      },
      {
        "call_info": {
          "callee": "sshbuf_reserve",
          "args": [
            "state->output",
            "sshbuf_len(state->outgoing_packet) + authlen",
            "&cp"
          ],
          "line": 1140
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_reserve",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf.c",
          "lines": "343-361",
          "snippet": "int\nsshbuf_reserve(struct sshbuf *buf, size_t len, u_char **dpp)\n{\n\tu_char *dp;\n\tint r;\n\n\tif (dpp != NULL)\n\t\t*dpp = NULL;\n\n\tSSHBUF_DBG((\"reserve buf = %p len = %zu\", buf, len));\n\tif ((r = sshbuf_allocate(buf, len)) != 0)\n\t\treturn r;\n\n\tdp = buf->d + buf->size;\n\tbuf->size += len;\n\tif (dpp != NULL)\n\t\t*dpp = dp;\n\treturn 0;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <signal.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <signal.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshbuf_reserve(struct sshbuf *buf, size_t len, u_char **dpp)\n{\n\tu_char *dp;\n\tint r;\n\n\tif (dpp != NULL)\n\t\t*dpp = NULL;\n\n\tSSHBUF_DBG((\"reserve buf = %p len = %zu\", buf, len));\n\tif ((r = sshbuf_allocate(buf, len)) != 0)\n\t\treturn r;\n\n\tdp = buf->d + buf->size;\n\tbuf->size += len;\n\tif (dpp != NULL)\n\t\t*dpp = dp;\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "sshbuf_len",
          "args": [
            "state->outgoing_packet"
          ],
          "line": 1141
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_len",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf.c",
          "lines": "252-258",
          "snippet": "size_t\nsshbuf_len(const struct sshbuf *buf)\n{\n\tif (sshbuf_check_sanity(buf) != 0)\n\t\treturn 0;\n\treturn buf->size - buf->off;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <signal.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <signal.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nsize_t\nsshbuf_len(const struct sshbuf *buf)\n{\n\tif (sshbuf_check_sanity(buf) != 0)\n\t\treturn 0;\n\treturn buf->size - buf->off;\n}"
        }
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "debug(\"done calc MAC out #%d\", state->p_send.seqnr)"
          ],
          "line": 1137
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "debug(\"send: len %d (includes padlen %d, aadlen %d)\",\n\t    len, padlen, aadlen)"
          ],
          "line": 1128
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "POKE_U32",
          "args": [
            "cp",
            "len - 4"
          ],
          "line": 1126
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sshbuf_mutable_ptr",
          "args": [
            "state->outgoing_packet"
          ],
          "line": 1120
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_mutable_ptr",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf.c",
          "lines": "276-282",
          "snippet": "u_char *\nsshbuf_mutable_ptr(const struct sshbuf *buf)\n{\n\tif (sshbuf_check_sanity(buf) != 0 || buf->readonly || buf->refcount > 1)\n\t\treturn NULL;\n\treturn buf->d + buf->off;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <signal.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <signal.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nu_char *\nsshbuf_mutable_ptr(const struct sshbuf *buf)\n{\n\tif (sshbuf_check_sanity(buf) != 0 || buf->readonly || buf->refcount > 1)\n\t\treturn NULL;\n\treturn buf->d + buf->off;\n}"
        }
      },
      {
        "call_info": {
          "callee": "explicit_bzero",
          "args": [
            "cp",
            "padlen"
          ],
          "line": 1116
        },
        "resolved": true,
        "details": {
          "function_name": "explicit_bzero",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/openbsd-compat/explicit_bzero.c",
          "lines": "36-53",
          "snippet": "void\nexplicit_bzero(void *p, size_t n)\n{\n\tif (n == 0)\n\t\treturn;\n\t/*\n\t * clang -fsanitize=memory needs to intercept memset-like functions\n\t * to correctly detect memory initialisation. Make sure one is called\n\t * directly since our indirection trick above successfully confuses it.\n\t */\n#if defined(__has_feature)\n# if __has_feature(memory_sanitizer)\n\tmemset(p, 0, n);\n# endif\n#endif\n\n\tssh_bzero(p, n);\n}",
          "includes": [
            "#include <string.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include \"includes.h\"\n\nvoid\nexplicit_bzero(void *p, size_t n)\n{\n\tif (n == 0)\n\t\treturn;\n\t/*\n\t * clang -fsanitize=memory needs to intercept memset-like functions\n\t * to correctly detect memory initialisation. Make sure one is called\n\t * directly since our indirection trick above successfully confuses it.\n\t */\n#if defined(__has_feature)\n# if __has_feature(memory_sanitizer)\n\tmemset(p, 0, n);\n# endif\n#endif\n\n\tssh_bzero(p, n);\n}"
        }
      },
      {
        "call_info": {
          "callee": "arc4random_buf",
          "args": [
            "cp",
            "padlen"
          ],
          "line": 1113
        },
        "resolved": true,
        "details": {
          "function_name": "arc4random_buf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/openbsd-compat/arc4random.c",
          "lines": "263-277",
          "snippet": "void\narc4random_buf(void *_buf, size_t n)\n{\n\tsize_t i;\n\tu_int32_t r = 0;\n\tchar *buf = (char *)_buf;\n\n\tfor (i = 0; i < n; i++) {\n\t\tif (i % 4 == 0)\n\t\t\tr = arc4random();\n\t\tbuf[i] = r & 0xff;\n\t\tr >>= 8;\n\t}\n\texplicit_bzero(&r, sizeof(r));\n}",
          "includes": [
            "#include <machine/pctr.h>",
            "#include <stdio.h>",
            "#include \"chacha_private.h\"",
            "#include \"log.h\"",
            "#include <openssl/err.h>",
            "#include <openssl/rand.h>",
            "# include <sys/random.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <fcntl.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <machine/pctr.h>\n#include <stdio.h>\n#include \"chacha_private.h\"\n#include \"log.h\"\n#include <openssl/err.h>\n#include <openssl/rand.h>\n# include <sys/random.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <fcntl.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\narc4random_buf(void *_buf, size_t n)\n{\n\tsize_t i;\n\tu_int32_t r = 0;\n\tchar *buf = (char *)_buf;\n\n\tfor (i = 0; i < n; i++) {\n\t\tif (i % 4 == 0)\n\t\t\tr = arc4random();\n\t\tbuf[i] = r & 0xff;\n\t\tr >>= 8;\n\t}\n\texplicit_bzero(&r, sizeof(r));\n}"
        }
      },
      {
        "call_info": {
          "callee": "cipher_ctx_is_plaintext",
          "args": [
            "state->send_context"
          ],
          "line": 1111
        },
        "resolved": true,
        "details": {
          "function_name": "cipher_ctx_is_plaintext",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/cipher.c",
          "lines": "186-190",
          "snippet": "u_int\ncipher_ctx_is_plaintext(struct sshcipher_ctx *cc)\n{\n\treturn cc->plaintext;\n}",
          "includes": [
            "#include \"openbsd-compat/openssl-compat.h\"",
            "#include \"digest.h\"",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"misc.h\"",
            "#include \"cipher.h\"",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <string.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"openbsd-compat/openssl-compat.h\"\n#include \"digest.h\"\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"misc.h\"\n#include \"cipher.h\"\n#include <stdio.h>\n#include <stdarg.h>\n#include <string.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nu_int\ncipher_ctx_is_plaintext(struct sshcipher_ctx *cc)\n{\n\treturn cc->plaintext;\n}"
        }
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "debug3(\"%s: adding %d (len %d padlen %d extra_pad %d)\",\n\t\t    __func__, pad, len, padlen, state->extra_pad)"
          ],
          "line": 1100
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug3",
          "args": [
            "\"%s: adding %d (len %d padlen %d extra_pad %d)\"",
            "__func__",
            "pad",
            "len",
            "padlen",
            "state->extra_pad"
          ],
          "line": 1100
        },
        "resolved": true,
        "details": {
          "function_name": "debug3",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/log.c",
          "lines": "242-250",
          "snippet": "void\ndebug3(const char *fmt,...)\n{\n\tva_list args;\n\n\tva_start(args, fmt);\n\tdo_log(SYSLOG_LEVEL_DEBUG3, fmt, args);\n\tva_end(args);\n}",
          "includes": [
            "#include \"log.h\"",
            "# include <vis.h>",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <syslog.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <fcntl.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n# include <vis.h>\n#include <errno.h>\n#include <unistd.h>\n#include <syslog.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <fcntl.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\ndebug3(const char *fmt,...)\n{\n\tva_list args;\n\n\tva_start(args, fmt);\n\tdo_log(SYSLOG_LEVEL_DEBUG3, fmt, args);\n\tva_end(args);\n}"
        }
      },
      {
        "call_info": {
          "callee": "ROUNDUP",
          "args": [
            "state->extra_pad",
            "block_size"
          ],
          "line": 1091
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "debug(\"compression: raw %d compressed %zd\", len,\n\t\t    sshbuf_len(state->outgoing_packet))"
          ],
          "line": 1073
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sshbuf_putb",
          "args": [
            "state->outgoing_packet",
            "state->compression_buffer"
          ],
          "line": 1070
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_putb",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf-getput-basic.c",
          "lines": "248-252",
          "snippet": "int\nsshbuf_putb(struct sshbuf *buf, const struct sshbuf *v)\n{\n\treturn sshbuf_put(buf, sshbuf_ptr(v), sshbuf_len(v));\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <stdarg.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <stdarg.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshbuf_putb(struct sshbuf *buf, const struct sshbuf *v)\n{\n\treturn sshbuf_put(buf, sshbuf_ptr(v), sshbuf_len(v));\n}"
        }
      },
      {
        "call_info": {
          "callee": "compress_buffer",
          "args": [
            "ssh",
            "state->outgoing_packet",
            "state->compression_buffer"
          ],
          "line": 1064
        },
        "resolved": true,
        "details": {
          "function_name": "uncompress_buffer",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
          "lines": "772-817",
          "snippet": "static int\nuncompress_buffer(struct ssh *ssh, struct sshbuf *in, struct sshbuf *out)\n{\n\tu_char buf[4096];\n\tint r, status;\n\n\tif (ssh->state->compression_in_started != 1)\n\t\treturn SSH_ERR_INTERNAL_ERROR;\n\n\tif ((ssh->state->compression_in_stream.next_in =\n\t    sshbuf_mutable_ptr(in)) == NULL)\n\t\treturn SSH_ERR_INTERNAL_ERROR;\n\tssh->state->compression_in_stream.avail_in = sshbuf_len(in);\n\n\tfor (;;) {\n\t\t/* Set up fixed-size output buffer. */\n\t\tssh->state->compression_in_stream.next_out = buf;\n\t\tssh->state->compression_in_stream.avail_out = sizeof(buf);\n\n\t\tstatus = inflate(&ssh->state->compression_in_stream,\n\t\t    Z_PARTIAL_FLUSH);\n\t\tswitch (status) {\n\t\tcase Z_OK:\n\t\t\tif ((r = sshbuf_put(out, buf, sizeof(buf) -\n\t\t\t    ssh->state->compression_in_stream.avail_out)) != 0)\n\t\t\t\treturn r;\n\t\t\tbreak;\n\t\tcase Z_BUF_ERROR:\n\t\t\t/*\n\t\t\t * Comments in zlib.h say that we should keep calling\n\t\t\t * inflate() until we get an error.  This appears to\n\t\t\t * be the error that we get.\n\t\t\t */\n\t\t\treturn 0;\n\t\tcase Z_DATA_ERROR:\n\t\t\treturn SSH_ERR_INVALID_FORMAT;\n\t\tcase Z_MEM_ERROR:\n\t\t\treturn SSH_ERR_ALLOC_FAIL;\n\t\tcase Z_STREAM_ERROR:\n\t\tdefault:\n\t\t\tssh->state->compression_in_failures++;\n\t\t\treturn SSH_ERR_INTERNAL_ERROR;\n\t\t}\n\t}\n\t/* NOTREACHED */\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include \"packet.h\"",
            "#include \"ssh.h\"",
            "#include \"channels.h\"",
            "#include \"misc.h\"",
            "#include \"canohost.h\"",
            "#include \"log.h\"",
            "#include \"mac.h\"",
            "#include \"digest.h\"",
            "#include \"kex.h\"",
            "#include \"sshkey.h\"",
            "#include \"cipher.h\"",
            "#include \"ssh2.h\"",
            "#include \"compat.h\"",
            "#include \"crc32.h\"",
            "#include \"xmalloc.h\"",
            "#include <zlib.h>",
            "#  include <openssl/ec.h>",
            "# include <openssl/evp.h>",
            "# include <openssl/bn.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <limits.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <netdb.h>",
            "#include <errno.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include \"openbsd-compat/sys-queue.h\"",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nstatic int\nuncompress_buffer(struct ssh *ssh, struct sshbuf *in, struct sshbuf *out)\n{\n\tu_char buf[4096];\n\tint r, status;\n\n\tif (ssh->state->compression_in_started != 1)\n\t\treturn SSH_ERR_INTERNAL_ERROR;\n\n\tif ((ssh->state->compression_in_stream.next_in =\n\t    sshbuf_mutable_ptr(in)) == NULL)\n\t\treturn SSH_ERR_INTERNAL_ERROR;\n\tssh->state->compression_in_stream.avail_in = sshbuf_len(in);\n\n\tfor (;;) {\n\t\t/* Set up fixed-size output buffer. */\n\t\tssh->state->compression_in_stream.next_out = buf;\n\t\tssh->state->compression_in_stream.avail_out = sizeof(buf);\n\n\t\tstatus = inflate(&ssh->state->compression_in_stream,\n\t\t    Z_PARTIAL_FLUSH);\n\t\tswitch (status) {\n\t\tcase Z_OK:\n\t\t\tif ((r = sshbuf_put(out, buf, sizeof(buf) -\n\t\t\t    ssh->state->compression_in_stream.avail_out)) != 0)\n\t\t\t\treturn r;\n\t\t\tbreak;\n\t\tcase Z_BUF_ERROR:\n\t\t\t/*\n\t\t\t * Comments in zlib.h say that we should keep calling\n\t\t\t * inflate() until we get an error.  This appears to\n\t\t\t * be the error that we get.\n\t\t\t */\n\t\t\treturn 0;\n\t\tcase Z_DATA_ERROR:\n\t\t\treturn SSH_ERR_INVALID_FORMAT;\n\t\tcase Z_MEM_ERROR:\n\t\t\treturn SSH_ERR_ALLOC_FAIL;\n\t\tcase Z_STREAM_ERROR:\n\t\tdefault:\n\t\t\tssh->state->compression_in_failures++;\n\t\t\treturn SSH_ERR_INTERNAL_ERROR;\n\t\t}\n\t}\n\t/* NOTREACHED */\n}"
        }
      },
      {
        "call_info": {
          "callee": "sshbuf_consume",
          "args": [
            "state->outgoing_packet",
            "5"
          ],
          "line": 1061
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_consume_end",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf.c",
          "lines": "383-398",
          "snippet": "int\nsshbuf_consume_end(struct sshbuf *buf, size_t len)\n{\n\tint r;\n\n\tSSHBUF_DBG((\"len = %zu\", len));\n\tif ((r = sshbuf_check_sanity(buf)) != 0)\n\t\treturn r;\n\tif (len == 0)\n\t\treturn 0;\n\tif (len > sshbuf_len(buf))\n\t\treturn SSH_ERR_MESSAGE_INCOMPLETE;\n\tbuf->size -= len;\n\tSSHBUF_TELL(\"done\");\n\treturn 0;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <signal.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <signal.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshbuf_consume_end(struct sshbuf *buf, size_t len)\n{\n\tint r;\n\n\tSSHBUF_DBG((\"len = %zu\", len));\n\tif ((r = sshbuf_check_sanity(buf)) != 0)\n\t\treturn r;\n\tif (len == 0)\n\t\treturn 0;\n\tif (len > sshbuf_len(buf))\n\t\treturn SSH_ERR_MESSAGE_INCOMPLETE;\n\tbuf->size -= len;\n\tSSHBUF_TELL(\"done\");\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"plain:     \""
          ],
          "line": 1054
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ssh_packet_log_type",
          "args": [
            "type"
          ],
          "line": 1051
        },
        "resolved": true,
        "details": {
          "function_name": "ssh_packet_log_type",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
          "lines": "1010-1021",
          "snippet": "int\nssh_packet_log_type(u_char type)\n{\n\tswitch (type) {\n\tcase SSH2_MSG_CHANNEL_DATA:\n\tcase SSH2_MSG_CHANNEL_EXTENDED_DATA:\n\tcase SSH2_MSG_CHANNEL_WINDOW_ADJUST:\n\t\treturn 0;\n\tdefault:\n\t\treturn 1;\n\t}\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include \"packet.h\"",
            "#include \"ssh.h\"",
            "#include \"channels.h\"",
            "#include \"misc.h\"",
            "#include \"canohost.h\"",
            "#include \"log.h\"",
            "#include \"mac.h\"",
            "#include \"digest.h\"",
            "#include \"kex.h\"",
            "#include \"sshkey.h\"",
            "#include \"cipher.h\"",
            "#include \"ssh2.h\"",
            "#include \"compat.h\"",
            "#include \"crc32.h\"",
            "#include \"xmalloc.h\"",
            "#include <zlib.h>",
            "#  include <openssl/ec.h>",
            "# include <openssl/evp.h>",
            "# include <openssl/bn.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <limits.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <netdb.h>",
            "#include <errno.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include \"openbsd-compat/sys-queue.h\"",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nssh_packet_log_type(u_char type)\n{\n\tswitch (type) {\n\tcase SSH2_MSG_CHANNEL_DATA:\n\tcase SSH2_MSG_CHANNEL_EXTENDED_DATA:\n\tcase SSH2_MSG_CHANNEL_WINDOW_ADJUST:\n\t\treturn 0;\n\tdefault:\n\t\treturn 1;\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "cipher_authlen",
          "args": [
            "enc->cipher"
          ],
          "line": 1044
        },
        "resolved": true,
        "details": {
          "function_name": "cipher_authlen",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/cipher.c",
          "lines": "163-167",
          "snippet": "u_int\ncipher_authlen(const struct sshcipher *c)\n{\n\treturn (c->auth_len);\n}",
          "includes": [
            "#include \"openbsd-compat/openssl-compat.h\"",
            "#include \"digest.h\"",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"misc.h\"",
            "#include \"cipher.h\"",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <string.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"openbsd-compat/openssl-compat.h\"\n#include \"digest.h\"\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"misc.h\"\n#include \"cipher.h\"\n#include <stdio.h>\n#include <stdarg.h>\n#include <string.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nu_int\ncipher_authlen(const struct sshcipher *c)\n{\n\treturn (c->auth_len);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nssh_packet_send2_wrapped(struct ssh *ssh)\n{\n\tstruct session_state *state = ssh->state;\n\tu_char type, *cp, macbuf[SSH_DIGEST_MAX_LENGTH];\n\tu_char tmp, padlen, pad = 0;\n\tu_int authlen = 0, aadlen = 0;\n\tu_int len;\n\tstruct sshenc *enc   = NULL;\n\tstruct sshmac *mac   = NULL;\n\tstruct sshcomp *comp = NULL;\n\tint r, block_size;\n\n\tif (state->newkeys[MODE_OUT] != NULL) {\n\t\tenc  = &state->newkeys[MODE_OUT]->enc;\n\t\tmac  = &state->newkeys[MODE_OUT]->mac;\n\t\tcomp = &state->newkeys[MODE_OUT]->comp;\n\t\t/* disable mac for authenticated encryption */\n\t\tif ((authlen = cipher_authlen(enc->cipher)) != 0)\n\t\t\tmac = NULL;\n\t}\n\tblock_size = enc ? enc->block_size : 8;\n\taadlen = (mac && mac->enabled && mac->etm) || authlen ? 4 : 0;\n\n\ttype = (sshbuf_ptr(state->outgoing_packet))[5];\n\tif (ssh_packet_log_type(type))\n\t\tdebug3(\"send packet: type %u\", type);\n#ifdef PACKET_DEBUG\n\tfprintf(stderr, \"plain:     \");\n\tsshbuf_dump(state->outgoing_packet, stderr);\n#endif\n\n\tif (comp && comp->enabled) {\n\t\tlen = sshbuf_len(state->outgoing_packet);\n\t\t/* skip header, compress only payload */\n\t\tif ((r = sshbuf_consume(state->outgoing_packet, 5)) != 0)\n\t\t\tgoto out;\n\t\tsshbuf_reset(state->compression_buffer);\n\t\tif ((r = compress_buffer(ssh, state->outgoing_packet,\n\t\t    state->compression_buffer)) != 0)\n\t\t\tgoto out;\n\t\tsshbuf_reset(state->outgoing_packet);\n\t\tif ((r = sshbuf_put(state->outgoing_packet,\n\t\t    \"\\0\\0\\0\\0\\0\", 5)) != 0 ||\n\t\t    (r = sshbuf_putb(state->outgoing_packet,\n\t\t    state->compression_buffer)) != 0)\n\t\t\tgoto out;\n\t\tDBG(debug(\"compression: raw %d compressed %zd\", len,\n\t\t    sshbuf_len(state->outgoing_packet)));\n\t}\n\n\t/* sizeof (packet_len + pad_len + payload) */\n\tlen = sshbuf_len(state->outgoing_packet);\n\n\t/*\n\t * calc size of padding, alloc space, get random data,\n\t * minimum padding is 4 bytes\n\t */\n\tlen -= aadlen; /* packet length is not encrypted for EtM modes */\n\tpadlen = block_size - (len % block_size);\n\tif (padlen < 4)\n\t\tpadlen += block_size;\n\tif (state->extra_pad) {\n\t\ttmp = state->extra_pad;\n\t\tstate->extra_pad =\n\t\t    ROUNDUP(state->extra_pad, block_size);\n\t\t/* check if roundup overflowed */\n\t\tif (state->extra_pad < tmp)\n\t\t\treturn SSH_ERR_INVALID_ARGUMENT;\n\t\ttmp = (len + padlen) % state->extra_pad;\n\t\t/* Check whether pad calculation below will underflow */\n\t\tif (tmp > state->extra_pad)\n\t\t\treturn SSH_ERR_INVALID_ARGUMENT;\n\t\tpad = state->extra_pad - tmp;\n\t\tDBG(debug3(\"%s: adding %d (len %d padlen %d extra_pad %d)\",\n\t\t    __func__, pad, len, padlen, state->extra_pad));\n\t\ttmp = padlen;\n\t\tpadlen += pad;\n\t\t/* Check whether padlen calculation overflowed */\n\t\tif (padlen < tmp)\n\t\t\treturn SSH_ERR_INVALID_ARGUMENT; /* overflow */\n\t\tstate->extra_pad = 0;\n\t}\n\tif ((r = sshbuf_reserve(state->outgoing_packet, padlen, &cp)) != 0)\n\t\tgoto out;\n\tif (enc && !cipher_ctx_is_plaintext(state->send_context)) {\n\t\t/* random padding */\n\t\tarc4random_buf(cp, padlen);\n\t} else {\n\t\t/* clear padding */\n\t\texplicit_bzero(cp, padlen);\n\t}\n\t/* sizeof (packet_len + pad_len + payload + padding) */\n\tlen = sshbuf_len(state->outgoing_packet);\n\tcp = sshbuf_mutable_ptr(state->outgoing_packet);\n\tif (cp == NULL) {\n\t\tr = SSH_ERR_INTERNAL_ERROR;\n\t\tgoto out;\n\t}\n\t/* packet_length includes payload, padding and padding length field */\n\tPOKE_U32(cp, len - 4);\n\tcp[4] = padlen;\n\tDBG(debug(\"send: len %d (includes padlen %d, aadlen %d)\",\n\t    len, padlen, aadlen));\n\n\t/* compute MAC over seqnr and packet(length fields, payload, padding) */\n\tif (mac && mac->enabled && !mac->etm) {\n\t\tif ((r = mac_compute(mac, state->p_send.seqnr,\n\t\t    sshbuf_ptr(state->outgoing_packet), len,\n\t\t    macbuf, sizeof(macbuf))) != 0)\n\t\t\tgoto out;\n\t\tDBG(debug(\"done calc MAC out #%d\", state->p_send.seqnr));\n\t}\n\t/* encrypt packet and append to output buffer. */\n\tif ((r = sshbuf_reserve(state->output,\n\t    sshbuf_len(state->outgoing_packet) + authlen, &cp)) != 0)\n\t\tgoto out;\n\tif ((r = cipher_crypt(state->send_context, state->p_send.seqnr, cp,\n\t    sshbuf_ptr(state->outgoing_packet),\n\t    len - aadlen, aadlen, authlen)) != 0)\n\t\tgoto out;\n\t/* append unencrypted MAC */\n\tif (mac && mac->enabled) {\n\t\tif (mac->etm) {\n\t\t\t/* EtM: compute mac over aadlen + cipher text */\n\t\t\tif ((r = mac_compute(mac, state->p_send.seqnr,\n\t\t\t    cp, len, macbuf, sizeof(macbuf))) != 0)\n\t\t\t\tgoto out;\n\t\t\tDBG(debug(\"done calc MAC(EtM) out #%d\",\n\t\t\t    state->p_send.seqnr));\n\t\t}\n\t\tif ((r = sshbuf_put(state->output, macbuf, mac->mac_len)) != 0)\n\t\t\tgoto out;\n\t}\n#ifdef PACKET_DEBUG\n\tfprintf(stderr, \"encrypted: \");\n\tsshbuf_dump(state->output, stderr);\n#endif\n\t/* increment sequence number for outgoing packets */\n\tif (++state->p_send.seqnr == 0)\n\t\tlogit(\"outgoing seqnr wraps around\");\n\tif (++state->p_send.packets == 0)\n\t\tif (!(ssh->compat & SSH_BUG_NOREKEY))\n\t\t\treturn SSH_ERR_NEED_REKEY;\n\tstate->p_send.blocks += len / block_size;\n\tstate->p_send.bytes += len;\n\tsshbuf_reset(state->outgoing_packet);\n\n\tif (type == SSH2_MSG_NEWKEYS)\n\t\tr = ssh_set_newkeys(ssh, MODE_OUT);\n\telse if (type == SSH2_MSG_USERAUTH_SUCCESS && state->server_side)\n\t\tr = ssh_packet_enable_delayed_compress(ssh);\n\telse\n\t\tr = 0;\n out:\n\treturn r;\n}"
  },
  {
    "function_name": "ssh_packet_log_type",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
    "lines": "1010-1021",
    "snippet": "int\nssh_packet_log_type(u_char type)\n{\n\tswitch (type) {\n\tcase SSH2_MSG_CHANNEL_DATA:\n\tcase SSH2_MSG_CHANNEL_EXTENDED_DATA:\n\tcase SSH2_MSG_CHANNEL_WINDOW_ADJUST:\n\t\treturn 0;\n\tdefault:\n\t\treturn 1;\n\t}\n}",
    "includes": [
      "#include \"sshbuf.h\"",
      "#include \"ssherr.h\"",
      "#include \"packet.h\"",
      "#include \"ssh.h\"",
      "#include \"channels.h\"",
      "#include \"misc.h\"",
      "#include \"canohost.h\"",
      "#include \"log.h\"",
      "#include \"mac.h\"",
      "#include \"digest.h\"",
      "#include \"kex.h\"",
      "#include \"sshkey.h\"",
      "#include \"cipher.h\"",
      "#include \"ssh2.h\"",
      "#include \"compat.h\"",
      "#include \"crc32.h\"",
      "#include \"xmalloc.h\"",
      "#include <zlib.h>",
      "#  include <openssl/ec.h>",
      "# include <openssl/evp.h>",
      "# include <openssl/bn.h>",
      "#include <time.h>",
      "#include <signal.h>",
      "#include <limits.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <stdarg.h>",
      "#include <netdb.h>",
      "#include <errno.h>",
      "#include <arpa/inet.h>",
      "#include <netinet/ip.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include \"openbsd-compat/sys-queue.h\"",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nssh_packet_log_type(u_char type)\n{\n\tswitch (type) {\n\tcase SSH2_MSG_CHANNEL_DATA:\n\tcase SSH2_MSG_CHANNEL_EXTENDED_DATA:\n\tcase SSH2_MSG_CHANNEL_WINDOW_ADJUST:\n\t\treturn 0;\n\tdefault:\n\t\treturn 1;\n\t}\n}"
  },
  {
    "function_name": "ssh_packet_enable_delayed_compress",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
    "lines": "976-1007",
    "snippet": "static int\nssh_packet_enable_delayed_compress(struct ssh *ssh)\n{\n\tstruct session_state *state = ssh->state;\n\tstruct sshcomp *comp = NULL;\n\tint r, mode;\n\n\t/*\n\t * Remember that we are past the authentication step, so rekeying\n\t * with COMP_DELAYED will turn on compression immediately.\n\t */\n\tstate->after_authentication = 1;\n\tfor (mode = 0; mode < MODE_MAX; mode++) {\n\t\t/* protocol error: USERAUTH_SUCCESS received before NEWKEYS */\n\t\tif (state->newkeys[mode] == NULL)\n\t\t\tcontinue;\n\t\tcomp = &state->newkeys[mode]->comp;\n\t\tif (comp && !comp->enabled && comp->type == COMP_DELAYED) {\n\t\t\tif ((r = ssh_packet_init_compression(ssh)) != 0)\n\t\t\t\treturn r;\n\t\t\tif (mode == MODE_OUT) {\n\t\t\t\tif ((r = start_compression_out(ssh, 6)) != 0)\n\t\t\t\t\treturn r;\n\t\t\t} else {\n\t\t\t\tif ((r = start_compression_in(ssh)) != 0)\n\t\t\t\t\treturn r;\n\t\t\t}\n\t\t\tcomp->enabled = 1;\n\t\t}\n\t}\n\treturn 0;\n}",
    "includes": [
      "#include \"sshbuf.h\"",
      "#include \"ssherr.h\"",
      "#include \"packet.h\"",
      "#include \"ssh.h\"",
      "#include \"channels.h\"",
      "#include \"misc.h\"",
      "#include \"canohost.h\"",
      "#include \"log.h\"",
      "#include \"mac.h\"",
      "#include \"digest.h\"",
      "#include \"kex.h\"",
      "#include \"sshkey.h\"",
      "#include \"cipher.h\"",
      "#include \"ssh2.h\"",
      "#include \"compat.h\"",
      "#include \"crc32.h\"",
      "#include \"xmalloc.h\"",
      "#include <zlib.h>",
      "#  include <openssl/ec.h>",
      "# include <openssl/evp.h>",
      "# include <openssl/bn.h>",
      "#include <time.h>",
      "#include <signal.h>",
      "#include <limits.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <stdarg.h>",
      "#include <netdb.h>",
      "#include <errno.h>",
      "#include <arpa/inet.h>",
      "#include <netinet/ip.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include \"openbsd-compat/sys-queue.h\"",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "start_compression_in",
          "args": [
            "ssh"
          ],
          "line": 1000
        },
        "resolved": true,
        "details": {
          "function_name": "start_compression_in",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
          "lines": "708-723",
          "snippet": "static int\nstart_compression_in(struct ssh *ssh)\n{\n\tif (ssh->state->compression_in_started == 1)\n\t\tinflateEnd(&ssh->state->compression_in_stream);\n\tswitch (inflateInit(&ssh->state->compression_in_stream)) {\n\tcase Z_OK:\n\t\tssh->state->compression_in_started = 1;\n\t\tbreak;\n\tcase Z_MEM_ERROR:\n\t\treturn SSH_ERR_ALLOC_FAIL;\n\tdefault:\n\t\treturn SSH_ERR_INTERNAL_ERROR;\n\t}\n\treturn 0;\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include \"packet.h\"",
            "#include \"ssh.h\"",
            "#include \"channels.h\"",
            "#include \"misc.h\"",
            "#include \"canohost.h\"",
            "#include \"log.h\"",
            "#include \"mac.h\"",
            "#include \"digest.h\"",
            "#include \"kex.h\"",
            "#include \"sshkey.h\"",
            "#include \"cipher.h\"",
            "#include \"ssh2.h\"",
            "#include \"compat.h\"",
            "#include \"crc32.h\"",
            "#include \"xmalloc.h\"",
            "#include <zlib.h>",
            "#  include <openssl/ec.h>",
            "# include <openssl/evp.h>",
            "# include <openssl/bn.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <limits.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <netdb.h>",
            "#include <errno.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include \"openbsd-compat/sys-queue.h\"",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nstatic int\nstart_compression_in(struct ssh *ssh)\n{\n\tif (ssh->state->compression_in_started == 1)\n\t\tinflateEnd(&ssh->state->compression_in_stream);\n\tswitch (inflateInit(&ssh->state->compression_in_stream)) {\n\tcase Z_OK:\n\t\tssh->state->compression_in_started = 1;\n\t\tbreak;\n\tcase Z_MEM_ERROR:\n\t\treturn SSH_ERR_ALLOC_FAIL;\n\tdefault:\n\t\treturn SSH_ERR_INTERNAL_ERROR;\n\t}\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "start_compression_out",
          "args": [
            "ssh",
            "6"
          ],
          "line": 997
        },
        "resolved": true,
        "details": {
          "function_name": "start_compression_out",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
          "lines": "688-706",
          "snippet": "static int\nstart_compression_out(struct ssh *ssh, int level)\n{\n\tif (level < 1 || level > 9)\n\t\treturn SSH_ERR_INVALID_ARGUMENT;\n\tdebug(\"Enabling compression at level %d.\", level);\n\tif (ssh->state->compression_out_started == 1)\n\t\tdeflateEnd(&ssh->state->compression_out_stream);\n\tswitch (deflateInit(&ssh->state->compression_out_stream, level)) {\n\tcase Z_OK:\n\t\tssh->state->compression_out_started = 1;\n\t\tbreak;\n\tcase Z_MEM_ERROR:\n\t\treturn SSH_ERR_ALLOC_FAIL;\n\tdefault:\n\t\treturn SSH_ERR_INTERNAL_ERROR;\n\t}\n\treturn 0;\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include \"packet.h\"",
            "#include \"ssh.h\"",
            "#include \"channels.h\"",
            "#include \"misc.h\"",
            "#include \"canohost.h\"",
            "#include \"log.h\"",
            "#include \"mac.h\"",
            "#include \"digest.h\"",
            "#include \"kex.h\"",
            "#include \"sshkey.h\"",
            "#include \"cipher.h\"",
            "#include \"ssh2.h\"",
            "#include \"compat.h\"",
            "#include \"crc32.h\"",
            "#include \"xmalloc.h\"",
            "#include <zlib.h>",
            "#  include <openssl/ec.h>",
            "# include <openssl/evp.h>",
            "# include <openssl/bn.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <limits.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <netdb.h>",
            "#include <errno.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include \"openbsd-compat/sys-queue.h\"",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nstatic int\nstart_compression_out(struct ssh *ssh, int level)\n{\n\tif (level < 1 || level > 9)\n\t\treturn SSH_ERR_INVALID_ARGUMENT;\n\tdebug(\"Enabling compression at level %d.\", level);\n\tif (ssh->state->compression_out_started == 1)\n\t\tdeflateEnd(&ssh->state->compression_out_stream);\n\tswitch (deflateInit(&ssh->state->compression_out_stream, level)) {\n\tcase Z_OK:\n\t\tssh->state->compression_out_started = 1;\n\t\tbreak;\n\tcase Z_MEM_ERROR:\n\t\treturn SSH_ERR_ALLOC_FAIL;\n\tdefault:\n\t\treturn SSH_ERR_INTERNAL_ERROR;\n\t}\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "ssh_packet_init_compression",
          "args": [
            "ssh"
          ],
          "line": 994
        },
        "resolved": true,
        "details": {
          "function_name": "ssh_packet_init_compression",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
          "lines": "679-686",
          "snippet": "static int\nssh_packet_init_compression(struct ssh *ssh)\n{\n\tif (!ssh->state->compression_buffer &&\n\t   ((ssh->state->compression_buffer = sshbuf_new()) == NULL))\n\t\treturn SSH_ERR_ALLOC_FAIL;\n\treturn 0;\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include \"packet.h\"",
            "#include \"ssh.h\"",
            "#include \"channels.h\"",
            "#include \"misc.h\"",
            "#include \"canohost.h\"",
            "#include \"log.h\"",
            "#include \"mac.h\"",
            "#include \"digest.h\"",
            "#include \"kex.h\"",
            "#include \"sshkey.h\"",
            "#include \"cipher.h\"",
            "#include \"ssh2.h\"",
            "#include \"compat.h\"",
            "#include \"crc32.h\"",
            "#include \"xmalloc.h\"",
            "#include <zlib.h>",
            "#  include <openssl/ec.h>",
            "# include <openssl/evp.h>",
            "# include <openssl/bn.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <limits.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <netdb.h>",
            "#include <errno.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include \"openbsd-compat/sys-queue.h\"",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nstatic int\nssh_packet_init_compression(struct ssh *ssh)\n{\n\tif (!ssh->state->compression_buffer &&\n\t   ((ssh->state->compression_buffer = sshbuf_new()) == NULL))\n\t\treturn SSH_ERR_ALLOC_FAIL;\n\treturn 0;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nstatic int\nssh_packet_enable_delayed_compress(struct ssh *ssh)\n{\n\tstruct session_state *state = ssh->state;\n\tstruct sshcomp *comp = NULL;\n\tint r, mode;\n\n\t/*\n\t * Remember that we are past the authentication step, so rekeying\n\t * with COMP_DELAYED will turn on compression immediately.\n\t */\n\tstate->after_authentication = 1;\n\tfor (mode = 0; mode < MODE_MAX; mode++) {\n\t\t/* protocol error: USERAUTH_SUCCESS received before NEWKEYS */\n\t\tif (state->newkeys[mode] == NULL)\n\t\t\tcontinue;\n\t\tcomp = &state->newkeys[mode]->comp;\n\t\tif (comp && !comp->enabled && comp->type == COMP_DELAYED) {\n\t\t\tif ((r = ssh_packet_init_compression(ssh)) != 0)\n\t\t\t\treturn r;\n\t\t\tif (mode == MODE_OUT) {\n\t\t\t\tif ((r = start_compression_out(ssh, 6)) != 0)\n\t\t\t\t\treturn r;\n\t\t\t} else {\n\t\t\t\tif ((r = start_compression_in(ssh)) != 0)\n\t\t\t\t\treturn r;\n\t\t\t}\n\t\t\tcomp->enabled = 1;\n\t\t}\n\t}\n\treturn 0;\n}"
  },
  {
    "function_name": "ssh_packet_need_rekeying",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
    "lines": "924-969",
    "snippet": "static int\nssh_packet_need_rekeying(struct ssh *ssh, u_int outbound_packet_len)\n{\n\tstruct session_state *state = ssh->state;\n\tu_int32_t out_blocks;\n\n\t/* XXX client can't cope with rekeying pre-auth */\n\tif (!state->after_authentication)\n\t\treturn 0;\n\n\t/* Haven't keyed yet or KEX in progress. */\n\tif (ssh->kex == NULL || ssh_packet_is_rekeying(ssh))\n\t\treturn 0;\n\n\t/* Peer can't rekey */\n\tif (ssh->compat & SSH_BUG_NOREKEY)\n\t\treturn 0;\n\n\t/*\n\t * Permit one packet in or out per rekey - this allows us to\n\t * make progress when rekey limits are very small.\n\t */\n\tif (state->p_send.packets == 0 && state->p_read.packets == 0)\n\t\treturn 0;\n\n\t/* Time-based rekeying */\n\tif (state->rekey_interval != 0 &&\n\t    (int64_t)state->rekey_time + state->rekey_interval <= monotime())\n\t\treturn 1;\n\n\t/*\n\t * Always rekey when MAX_PACKETS sent in either direction \n\t * As per RFC4344 section 3.1 we do this after 2^31 packets.\n\t */\n\tif (state->p_send.packets > MAX_PACKETS ||\n\t    state->p_read.packets > MAX_PACKETS)\n\t\treturn 1;\n\n\t/* Rekey after (cipher-specific) maximum blocks */\n\tout_blocks = ROUNDUP(outbound_packet_len,\n\t    state->newkeys[MODE_OUT]->enc.block_size);\n\treturn (state->max_blocks_out &&\n\t    (state->p_send.blocks + out_blocks > state->max_blocks_out)) ||\n\t    (state->max_blocks_in &&\n\t    (state->p_read.blocks > state->max_blocks_in));\n}",
    "includes": [
      "#include \"sshbuf.h\"",
      "#include \"ssherr.h\"",
      "#include \"packet.h\"",
      "#include \"ssh.h\"",
      "#include \"channels.h\"",
      "#include \"misc.h\"",
      "#include \"canohost.h\"",
      "#include \"log.h\"",
      "#include \"mac.h\"",
      "#include \"digest.h\"",
      "#include \"kex.h\"",
      "#include \"sshkey.h\"",
      "#include \"cipher.h\"",
      "#include \"ssh2.h\"",
      "#include \"compat.h\"",
      "#include \"crc32.h\"",
      "#include \"xmalloc.h\"",
      "#include <zlib.h>",
      "#  include <openssl/ec.h>",
      "# include <openssl/evp.h>",
      "# include <openssl/bn.h>",
      "#include <time.h>",
      "#include <signal.h>",
      "#include <limits.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <stdarg.h>",
      "#include <netdb.h>",
      "#include <errno.h>",
      "#include <arpa/inet.h>",
      "#include <netinet/ip.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include \"openbsd-compat/sys-queue.h\"",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [
      "#define MAX_PACKETS\t(1U<<31)"
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "ROUNDUP",
          "args": [
            "outbound_packet_len",
            "state->newkeys[MODE_OUT]->enc.block_size"
          ],
          "line": 963
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "monotime",
          "args": [],
          "line": 951
        },
        "resolved": true,
        "details": {
          "function_name": "monotime_double",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/misc.c",
          "lines": "1324-1331",
          "snippet": "double\nmonotime_double(void)\n{\n\tstruct timespec ts;\n\n\tmonotime_ts(&ts);\n\treturn ts.tv_sec + ((double)ts.tv_nsec / 1000000000);\n}",
          "includes": [
            "#include \"platform.h\"",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"ssh.h\"",
            "#include \"log.h\"",
            "#include \"misc.h\"",
            "#include \"xmalloc.h\"",
            "#include <net/if.h>",
            "#include <pwd.h>",
            "# include <paths.h>",
            "#include <netdb.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <ctype.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/tcp.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in_systm.h>",
            "#include <netinet/in.h>",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <libgen.h>",
            "#include <limits.h>",
            "#include <sys/un.h>",
            "#include <sys/wait.h>",
            "#include <sys/time.h>",
            "#include <sys/stat.h>",
            "#include <sys/socket.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"platform.h\"\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"ssh.h\"\n#include \"log.h\"\n#include \"misc.h\"\n#include \"xmalloc.h\"\n#include <net/if.h>\n#include <pwd.h>\n# include <paths.h>\n#include <netdb.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <ctype.h>\n#include <arpa/inet.h>\n#include <netinet/tcp.h>\n#include <netinet/ip.h>\n#include <netinet/in_systm.h>\n#include <netinet/in.h>\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <libgen.h>\n#include <limits.h>\n#include <sys/un.h>\n#include <sys/wait.h>\n#include <sys/time.h>\n#include <sys/stat.h>\n#include <sys/socket.h>\n#include <sys/ioctl.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\ndouble\nmonotime_double(void)\n{\n\tstruct timespec ts;\n\n\tmonotime_ts(&ts);\n\treturn ts.tv_sec + ((double)ts.tv_nsec / 1000000000);\n}"
        }
      },
      {
        "call_info": {
          "callee": "ssh_packet_is_rekeying",
          "args": [
            "ssh"
          ],
          "line": 935
        },
        "resolved": true,
        "details": {
          "function_name": "ssh_packet_is_rekeying",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
          "lines": "272-277",
          "snippet": "int\nssh_packet_is_rekeying(struct ssh *ssh)\n{\n\treturn ssh->state->rekeying ||\n\t    (ssh->kex != NULL && ssh->kex->done == 0);\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include \"packet.h\"",
            "#include \"ssh.h\"",
            "#include \"channels.h\"",
            "#include \"misc.h\"",
            "#include \"canohost.h\"",
            "#include \"log.h\"",
            "#include \"mac.h\"",
            "#include \"digest.h\"",
            "#include \"kex.h\"",
            "#include \"sshkey.h\"",
            "#include \"cipher.h\"",
            "#include \"ssh2.h\"",
            "#include \"compat.h\"",
            "#include \"crc32.h\"",
            "#include \"xmalloc.h\"",
            "#include <zlib.h>",
            "#  include <openssl/ec.h>",
            "# include <openssl/evp.h>",
            "# include <openssl/bn.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <limits.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <netdb.h>",
            "#include <errno.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include \"openbsd-compat/sys-queue.h\"",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nssh_packet_is_rekeying(struct ssh *ssh)\n{\n\treturn ssh->state->rekeying ||\n\t    (ssh->kex != NULL && ssh->kex->done == 0);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\n#define MAX_PACKETS\t(1U<<31)\n\nstatic int\nssh_packet_need_rekeying(struct ssh *ssh, u_int outbound_packet_len)\n{\n\tstruct session_state *state = ssh->state;\n\tu_int32_t out_blocks;\n\n\t/* XXX client can't cope with rekeying pre-auth */\n\tif (!state->after_authentication)\n\t\treturn 0;\n\n\t/* Haven't keyed yet or KEX in progress. */\n\tif (ssh->kex == NULL || ssh_packet_is_rekeying(ssh))\n\t\treturn 0;\n\n\t/* Peer can't rekey */\n\tif (ssh->compat & SSH_BUG_NOREKEY)\n\t\treturn 0;\n\n\t/*\n\t * Permit one packet in or out per rekey - this allows us to\n\t * make progress when rekey limits are very small.\n\t */\n\tif (state->p_send.packets == 0 && state->p_read.packets == 0)\n\t\treturn 0;\n\n\t/* Time-based rekeying */\n\tif (state->rekey_interval != 0 &&\n\t    (int64_t)state->rekey_time + state->rekey_interval <= monotime())\n\t\treturn 1;\n\n\t/*\n\t * Always rekey when MAX_PACKETS sent in either direction \n\t * As per RFC4344 section 3.1 we do this after 2^31 packets.\n\t */\n\tif (state->p_send.packets > MAX_PACKETS ||\n\t    state->p_read.packets > MAX_PACKETS)\n\t\treturn 1;\n\n\t/* Rekey after (cipher-specific) maximum blocks */\n\tout_blocks = ROUNDUP(outbound_packet_len,\n\t    state->newkeys[MODE_OUT]->enc.block_size);\n\treturn (state->max_blocks_out &&\n\t    (state->p_send.blocks + out_blocks > state->max_blocks_out)) ||\n\t    (state->max_blocks_in &&\n\t    (state->p_read.blocks > state->max_blocks_in));\n}"
  },
  {
    "function_name": "ssh_set_newkeys",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
    "lines": "828-921",
    "snippet": "int\nssh_set_newkeys(struct ssh *ssh, int mode)\n{\n\tstruct session_state *state = ssh->state;\n\tstruct sshenc *enc;\n\tstruct sshmac *mac;\n\tstruct sshcomp *comp;\n\tstruct sshcipher_ctx **ccp;\n\tstruct packet_state *ps;\n\tu_int64_t *max_blocks;\n\tconst char *wmsg;\n\tint r, crypt_type;\n\n\tdebug2(\"set_newkeys: mode %d\", mode);\n\n\tif (mode == MODE_OUT) {\n\t\tccp = &state->send_context;\n\t\tcrypt_type = CIPHER_ENCRYPT;\n\t\tps = &state->p_send;\n\t\tmax_blocks = &state->max_blocks_out;\n\t} else {\n\t\tccp = &state->receive_context;\n\t\tcrypt_type = CIPHER_DECRYPT;\n\t\tps = &state->p_read;\n\t\tmax_blocks = &state->max_blocks_in;\n\t}\n\tif (state->newkeys[mode] != NULL) {\n\t\tdebug(\"set_newkeys: rekeying, input %llu bytes %llu blocks, \"\n\t\t   \"output %llu bytes %llu blocks\",\n\t\t   (unsigned long long)state->p_read.bytes,\n\t\t   (unsigned long long)state->p_read.blocks,\n\t\t   (unsigned long long)state->p_send.bytes,\n\t\t   (unsigned long long)state->p_send.blocks);\n\t\tcipher_free(*ccp);\n\t\t*ccp = NULL;\n\t\tkex_free_newkeys(state->newkeys[mode]);\n\t\tstate->newkeys[mode] = NULL;\n\t}\n\t/* note that both bytes and the seqnr are not reset */\n\tps->packets = ps->blocks = 0;\n\t/* move newkeys from kex to state */\n\tif ((state->newkeys[mode] = ssh->kex->newkeys[mode]) == NULL)\n\t\treturn SSH_ERR_INTERNAL_ERROR;\n\tssh->kex->newkeys[mode] = NULL;\n\tenc  = &state->newkeys[mode]->enc;\n\tmac  = &state->newkeys[mode]->mac;\n\tcomp = &state->newkeys[mode]->comp;\n\tif (cipher_authlen(enc->cipher) == 0) {\n\t\tif ((r = mac_init(mac)) != 0)\n\t\t\treturn r;\n\t}\n\tmac->enabled = 1;\n\tDBG(debug(\"cipher_init_context: %d\", mode));\n\tif ((r = cipher_init(ccp, enc->cipher, enc->key, enc->key_len,\n\t    enc->iv, enc->iv_len, crypt_type)) != 0)\n\t\treturn r;\n\tif (!state->cipher_warning_done &&\n\t    (wmsg = cipher_warning_message(*ccp)) != NULL) {\n\t\terror(\"Warning: %s\", wmsg);\n\t\tstate->cipher_warning_done = 1;\n\t}\n\t/* Deleting the keys does not gain extra security */\n\t/* explicit_bzero(enc->iv,  enc->block_size);\n\t   explicit_bzero(enc->key, enc->key_len);\n\t   explicit_bzero(mac->key, mac->key_len); */\n\tif ((comp->type == COMP_ZLIB ||\n\t    (comp->type == COMP_DELAYED &&\n\t     state->after_authentication)) && comp->enabled == 0) {\n\t\tif ((r = ssh_packet_init_compression(ssh)) < 0)\n\t\t\treturn r;\n\t\tif (mode == MODE_OUT) {\n\t\t\tif ((r = start_compression_out(ssh, 6)) != 0)\n\t\t\t\treturn r;\n\t\t} else {\n\t\t\tif ((r = start_compression_in(ssh)) != 0)\n\t\t\t\treturn r;\n\t\t}\n\t\tcomp->enabled = 1;\n\t}\n\t/*\n\t * The 2^(blocksize*2) limit is too expensive for 3DES,\n\t * so enforce a 1GB limit for small blocksizes.\n\t * See RFC4344 section 3.2.\n\t */\n\tif (enc->block_size >= 16)\n\t\t*max_blocks = (u_int64_t)1 << (enc->block_size*2);\n\telse\n\t\t*max_blocks = ((u_int64_t)1 << 30) / enc->block_size;\n\tif (state->rekey_limit)\n\t\t*max_blocks = MINIMUM(*max_blocks,\n\t\t    state->rekey_limit / enc->block_size);\n\tdebug(\"rekey after %llu blocks\", (unsigned long long)*max_blocks);\n\treturn 0;\n}",
    "includes": [
      "#include \"sshbuf.h\"",
      "#include \"ssherr.h\"",
      "#include \"packet.h\"",
      "#include \"ssh.h\"",
      "#include \"channels.h\"",
      "#include \"misc.h\"",
      "#include \"canohost.h\"",
      "#include \"log.h\"",
      "#include \"mac.h\"",
      "#include \"digest.h\"",
      "#include \"kex.h\"",
      "#include \"sshkey.h\"",
      "#include \"cipher.h\"",
      "#include \"ssh2.h\"",
      "#include \"compat.h\"",
      "#include \"crc32.h\"",
      "#include \"xmalloc.h\"",
      "#include <zlib.h>",
      "#  include <openssl/ec.h>",
      "# include <openssl/evp.h>",
      "# include <openssl/bn.h>",
      "#include <time.h>",
      "#include <signal.h>",
      "#include <limits.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <stdarg.h>",
      "#include <netdb.h>",
      "#include <errno.h>",
      "#include <arpa/inet.h>",
      "#include <netinet/ip.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include \"openbsd-compat/sys-queue.h\"",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "debug",
          "args": [
            "\"rekey after %llu blocks\"",
            "(unsigned long long)*max_blocks"
          ],
          "line": 919
        },
        "resolved": true,
        "details": {
          "function_name": "ssh_packet_send_debug",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
          "lines": "1771-1794",
          "snippet": "void\nssh_packet_send_debug(struct ssh *ssh, const char *fmt,...)\n{\n\tchar buf[1024];\n\tva_list args;\n\tint r;\n\n\tif ((ssh->compat & SSH_BUG_DEBUG))\n\t\treturn;\n\n\tva_start(args, fmt);\n\tvsnprintf(buf, sizeof(buf), fmt, args);\n\tva_end(args);\n\n\tdebug3(\"sending debug message: %s\", buf);\n\n\tif ((r = sshpkt_start(ssh, SSH2_MSG_DEBUG)) != 0 ||\n\t    (r = sshpkt_put_u8(ssh, 0)) != 0 || /* always display */\n\t    (r = sshpkt_put_cstring(ssh, buf)) != 0 ||\n\t    (r = sshpkt_put_cstring(ssh, \"\")) != 0 ||\n\t    (r = sshpkt_send(ssh)) != 0 ||\n\t    (r = ssh_packet_write_wait(ssh)) != 0)\n\t\tfatal(\"%s: %s\", __func__, ssh_err(r));\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include \"packet.h\"",
            "#include \"ssh.h\"",
            "#include \"channels.h\"",
            "#include \"misc.h\"",
            "#include \"canohost.h\"",
            "#include \"log.h\"",
            "#include \"mac.h\"",
            "#include \"digest.h\"",
            "#include \"kex.h\"",
            "#include \"sshkey.h\"",
            "#include \"cipher.h\"",
            "#include \"ssh2.h\"",
            "#include \"compat.h\"",
            "#include \"crc32.h\"",
            "#include \"xmalloc.h\"",
            "#include <zlib.h>",
            "#  include <openssl/ec.h>",
            "# include <openssl/evp.h>",
            "# include <openssl/bn.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <limits.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <netdb.h>",
            "#include <errno.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include \"openbsd-compat/sys-queue.h\"",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\nssh_packet_send_debug(struct ssh *ssh, const char *fmt,...)\n{\n\tchar buf[1024];\n\tva_list args;\n\tint r;\n\n\tif ((ssh->compat & SSH_BUG_DEBUG))\n\t\treturn;\n\n\tva_start(args, fmt);\n\tvsnprintf(buf, sizeof(buf), fmt, args);\n\tva_end(args);\n\n\tdebug3(\"sending debug message: %s\", buf);\n\n\tif ((r = sshpkt_start(ssh, SSH2_MSG_DEBUG)) != 0 ||\n\t    (r = sshpkt_put_u8(ssh, 0)) != 0 || /* always display */\n\t    (r = sshpkt_put_cstring(ssh, buf)) != 0 ||\n\t    (r = sshpkt_put_cstring(ssh, \"\")) != 0 ||\n\t    (r = sshpkt_send(ssh)) != 0 ||\n\t    (r = ssh_packet_write_wait(ssh)) != 0)\n\t\tfatal(\"%s: %s\", __func__, ssh_err(r));\n}"
        }
      },
      {
        "call_info": {
          "callee": "MINIMUM",
          "args": [
            "*max_blocks",
            "state->rekey_limit / enc->block_size"
          ],
          "line": 917
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "start_compression_in",
          "args": [
            "ssh"
          ],
          "line": 902
        },
        "resolved": true,
        "details": {
          "function_name": "start_compression_in",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
          "lines": "708-723",
          "snippet": "static int\nstart_compression_in(struct ssh *ssh)\n{\n\tif (ssh->state->compression_in_started == 1)\n\t\tinflateEnd(&ssh->state->compression_in_stream);\n\tswitch (inflateInit(&ssh->state->compression_in_stream)) {\n\tcase Z_OK:\n\t\tssh->state->compression_in_started = 1;\n\t\tbreak;\n\tcase Z_MEM_ERROR:\n\t\treturn SSH_ERR_ALLOC_FAIL;\n\tdefault:\n\t\treturn SSH_ERR_INTERNAL_ERROR;\n\t}\n\treturn 0;\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include \"packet.h\"",
            "#include \"ssh.h\"",
            "#include \"channels.h\"",
            "#include \"misc.h\"",
            "#include \"canohost.h\"",
            "#include \"log.h\"",
            "#include \"mac.h\"",
            "#include \"digest.h\"",
            "#include \"kex.h\"",
            "#include \"sshkey.h\"",
            "#include \"cipher.h\"",
            "#include \"ssh2.h\"",
            "#include \"compat.h\"",
            "#include \"crc32.h\"",
            "#include \"xmalloc.h\"",
            "#include <zlib.h>",
            "#  include <openssl/ec.h>",
            "# include <openssl/evp.h>",
            "# include <openssl/bn.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <limits.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <netdb.h>",
            "#include <errno.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include \"openbsd-compat/sys-queue.h\"",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nstatic int\nstart_compression_in(struct ssh *ssh)\n{\n\tif (ssh->state->compression_in_started == 1)\n\t\tinflateEnd(&ssh->state->compression_in_stream);\n\tswitch (inflateInit(&ssh->state->compression_in_stream)) {\n\tcase Z_OK:\n\t\tssh->state->compression_in_started = 1;\n\t\tbreak;\n\tcase Z_MEM_ERROR:\n\t\treturn SSH_ERR_ALLOC_FAIL;\n\tdefault:\n\t\treturn SSH_ERR_INTERNAL_ERROR;\n\t}\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "start_compression_out",
          "args": [
            "ssh",
            "6"
          ],
          "line": 899
        },
        "resolved": true,
        "details": {
          "function_name": "start_compression_out",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
          "lines": "688-706",
          "snippet": "static int\nstart_compression_out(struct ssh *ssh, int level)\n{\n\tif (level < 1 || level > 9)\n\t\treturn SSH_ERR_INVALID_ARGUMENT;\n\tdebug(\"Enabling compression at level %d.\", level);\n\tif (ssh->state->compression_out_started == 1)\n\t\tdeflateEnd(&ssh->state->compression_out_stream);\n\tswitch (deflateInit(&ssh->state->compression_out_stream, level)) {\n\tcase Z_OK:\n\t\tssh->state->compression_out_started = 1;\n\t\tbreak;\n\tcase Z_MEM_ERROR:\n\t\treturn SSH_ERR_ALLOC_FAIL;\n\tdefault:\n\t\treturn SSH_ERR_INTERNAL_ERROR;\n\t}\n\treturn 0;\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include \"packet.h\"",
            "#include \"ssh.h\"",
            "#include \"channels.h\"",
            "#include \"misc.h\"",
            "#include \"canohost.h\"",
            "#include \"log.h\"",
            "#include \"mac.h\"",
            "#include \"digest.h\"",
            "#include \"kex.h\"",
            "#include \"sshkey.h\"",
            "#include \"cipher.h\"",
            "#include \"ssh2.h\"",
            "#include \"compat.h\"",
            "#include \"crc32.h\"",
            "#include \"xmalloc.h\"",
            "#include <zlib.h>",
            "#  include <openssl/ec.h>",
            "# include <openssl/evp.h>",
            "# include <openssl/bn.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <limits.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <netdb.h>",
            "#include <errno.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include \"openbsd-compat/sys-queue.h\"",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nstatic int\nstart_compression_out(struct ssh *ssh, int level)\n{\n\tif (level < 1 || level > 9)\n\t\treturn SSH_ERR_INVALID_ARGUMENT;\n\tdebug(\"Enabling compression at level %d.\", level);\n\tif (ssh->state->compression_out_started == 1)\n\t\tdeflateEnd(&ssh->state->compression_out_stream);\n\tswitch (deflateInit(&ssh->state->compression_out_stream, level)) {\n\tcase Z_OK:\n\t\tssh->state->compression_out_started = 1;\n\t\tbreak;\n\tcase Z_MEM_ERROR:\n\t\treturn SSH_ERR_ALLOC_FAIL;\n\tdefault:\n\t\treturn SSH_ERR_INTERNAL_ERROR;\n\t}\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "ssh_packet_init_compression",
          "args": [
            "ssh"
          ],
          "line": 896
        },
        "resolved": true,
        "details": {
          "function_name": "ssh_packet_init_compression",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
          "lines": "679-686",
          "snippet": "static int\nssh_packet_init_compression(struct ssh *ssh)\n{\n\tif (!ssh->state->compression_buffer &&\n\t   ((ssh->state->compression_buffer = sshbuf_new()) == NULL))\n\t\treturn SSH_ERR_ALLOC_FAIL;\n\treturn 0;\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include \"packet.h\"",
            "#include \"ssh.h\"",
            "#include \"channels.h\"",
            "#include \"misc.h\"",
            "#include \"canohost.h\"",
            "#include \"log.h\"",
            "#include \"mac.h\"",
            "#include \"digest.h\"",
            "#include \"kex.h\"",
            "#include \"sshkey.h\"",
            "#include \"cipher.h\"",
            "#include \"ssh2.h\"",
            "#include \"compat.h\"",
            "#include \"crc32.h\"",
            "#include \"xmalloc.h\"",
            "#include <zlib.h>",
            "#  include <openssl/ec.h>",
            "# include <openssl/evp.h>",
            "# include <openssl/bn.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <limits.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <netdb.h>",
            "#include <errno.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include \"openbsd-compat/sys-queue.h\"",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nstatic int\nssh_packet_init_compression(struct ssh *ssh)\n{\n\tif (!ssh->state->compression_buffer &&\n\t   ((ssh->state->compression_buffer = sshbuf_new()) == NULL))\n\t\treturn SSH_ERR_ALLOC_FAIL;\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"Warning: %s\"",
            "wmsg"
          ],
          "line": 886
        },
        "resolved": true,
        "details": {
          "function_name": "error",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/log.c",
          "lines": "162-170",
          "snippet": "void\nerror(const char *fmt,...)\n{\n\tva_list args;\n\n\tva_start(args, fmt);\n\tdo_log(SYSLOG_LEVEL_ERROR, fmt, args);\n\tva_end(args);\n}",
          "includes": [
            "#include \"log.h\"",
            "# include <vis.h>",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <syslog.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <fcntl.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n# include <vis.h>\n#include <errno.h>\n#include <unistd.h>\n#include <syslog.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <fcntl.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\nerror(const char *fmt,...)\n{\n\tva_list args;\n\n\tva_start(args, fmt);\n\tdo_log(SYSLOG_LEVEL_ERROR, fmt, args);\n\tva_end(args);\n}"
        }
      },
      {
        "call_info": {
          "callee": "cipher_warning_message",
          "args": [
            "*ccp"
          ],
          "line": 885
        },
        "resolved": true,
        "details": {
          "function_name": "cipher_warning_message",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/cipher.c",
          "lines": "226-233",
          "snippet": "const char *\ncipher_warning_message(const struct sshcipher_ctx *cc)\n{\n\tif (cc == NULL || cc->cipher == NULL)\n\t\treturn NULL;\n\t/* XXX repurpose for CBC warning */\n\treturn NULL;\n}",
          "includes": [
            "#include \"openbsd-compat/openssl-compat.h\"",
            "#include \"digest.h\"",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"misc.h\"",
            "#include \"cipher.h\"",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <string.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"openbsd-compat/openssl-compat.h\"\n#include \"digest.h\"\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"misc.h\"\n#include \"cipher.h\"\n#include <stdio.h>\n#include <stdarg.h>\n#include <string.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nconst char *\ncipher_warning_message(const struct sshcipher_ctx *cc)\n{\n\tif (cc == NULL || cc->cipher == NULL)\n\t\treturn NULL;\n\t/* XXX repurpose for CBC warning */\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "cipher_init",
          "args": [
            "ccp",
            "enc->cipher",
            "enc->key",
            "enc->key_len",
            "enc->iv",
            "enc->iv_len",
            "crypt_type"
          ],
          "line": 881
        },
        "resolved": true,
        "details": {
          "function_name": "cipher_init",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/cipher.c",
          "lines": "235-322",
          "snippet": "int\ncipher_init(struct sshcipher_ctx **ccp, const struct sshcipher *cipher,\n    const u_char *key, u_int keylen, const u_char *iv, u_int ivlen,\n    int do_encrypt)\n{\n\tstruct sshcipher_ctx *cc = NULL;\n\tint ret = SSH_ERR_INTERNAL_ERROR;\n#ifdef WITH_OPENSSL\n\tconst EVP_CIPHER *type;\n\tint klen;\n#endif\n\n\t*ccp = NULL;\n\tif ((cc = calloc(sizeof(*cc), 1)) == NULL)\n\t\treturn SSH_ERR_ALLOC_FAIL;\n\n\tcc->plaintext = (cipher->flags & CFLAG_NONE) != 0;\n\tcc->encrypt = do_encrypt;\n\n\tif (keylen < cipher->key_len ||\n\t    (iv != NULL && ivlen < cipher_ivlen(cipher))) {\n\t\tret = SSH_ERR_INVALID_ARGUMENT;\n\t\tgoto out;\n\t}\n\n\tcc->cipher = cipher;\n\tif ((cc->cipher->flags & CFLAG_CHACHAPOLY) != 0) {\n\t\tret = chachapoly_init(&cc->cp_ctx, key, keylen);\n\t\tgoto out;\n\t}\n\tif ((cc->cipher->flags & CFLAG_NONE) != 0) {\n\t\tret = 0;\n\t\tgoto out;\n\t}\n#ifndef WITH_OPENSSL\n\tif ((cc->cipher->flags & CFLAG_AESCTR) != 0) {\n\t\taesctr_keysetup(&cc->ac_ctx, key, 8 * keylen, 8 * ivlen);\n\t\taesctr_ivsetup(&cc->ac_ctx, iv);\n\t\tret = 0;\n\t\tgoto out;\n\t}\n\tret = SSH_ERR_INVALID_ARGUMENT;\n\tgoto out;\n#else /* WITH_OPENSSL */\n\ttype = (*cipher->evptype)();\n\tif ((cc->evp = EVP_CIPHER_CTX_new()) == NULL) {\n\t\tret = SSH_ERR_ALLOC_FAIL;\n\t\tgoto out;\n\t}\n\tif (EVP_CipherInit(cc->evp, type, NULL, (u_char *)iv,\n\t    (do_encrypt == CIPHER_ENCRYPT)) == 0) {\n\t\tret = SSH_ERR_LIBCRYPTO_ERROR;\n\t\tgoto out;\n\t}\n\tif (cipher_authlen(cipher) &&\n\t    !EVP_CIPHER_CTX_ctrl(cc->evp, EVP_CTRL_GCM_SET_IV_FIXED,\n\t    -1, (u_char *)iv)) {\n\t\tret = SSH_ERR_LIBCRYPTO_ERROR;\n\t\tgoto out;\n\t}\n\tklen = EVP_CIPHER_CTX_key_length(cc->evp);\n\tif (klen > 0 && keylen != (u_int)klen) {\n\t\tif (EVP_CIPHER_CTX_set_key_length(cc->evp, keylen) == 0) {\n\t\t\tret = SSH_ERR_LIBCRYPTO_ERROR;\n\t\t\tgoto out;\n\t\t}\n\t}\n\tif (EVP_CipherInit(cc->evp, NULL, (u_char *)key, NULL, -1) == 0) {\n\t\tret = SSH_ERR_LIBCRYPTO_ERROR;\n\t\tgoto out;\n\t}\n\tret = 0;\n#endif /* WITH_OPENSSL */\n out:\n\tif (ret == 0) {\n\t\t/* success */\n\t\t*ccp = cc;\n\t} else {\n\t\tif (cc != NULL) {\n#ifdef WITH_OPENSSL\n\t\t\tEVP_CIPHER_CTX_free(cc->evp);\n#endif /* WITH_OPENSSL */\n\t\t\texplicit_bzero(cc, sizeof(*cc));\n\t\t\tfree(cc);\n\t\t}\n\t}\n\treturn ret;\n}",
          "includes": [
            "#include \"openbsd-compat/openssl-compat.h\"",
            "#include \"digest.h\"",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"misc.h\"",
            "#include \"cipher.h\"",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <string.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [
            "#define CFLAG_NONE\t\t(1<<3)",
            "#define CFLAG_AESCTR\t\t(1<<2)",
            "#define CFLAG_CHACHAPOLY\t(1<<1)"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"openbsd-compat/openssl-compat.h\"\n#include \"digest.h\"\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"misc.h\"\n#include \"cipher.h\"\n#include <stdio.h>\n#include <stdarg.h>\n#include <string.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\n#define CFLAG_NONE\t\t(1<<3)\n#define CFLAG_AESCTR\t\t(1<<2)\n#define CFLAG_CHACHAPOLY\t(1<<1)\n\nint\ncipher_init(struct sshcipher_ctx **ccp, const struct sshcipher *cipher,\n    const u_char *key, u_int keylen, const u_char *iv, u_int ivlen,\n    int do_encrypt)\n{\n\tstruct sshcipher_ctx *cc = NULL;\n\tint ret = SSH_ERR_INTERNAL_ERROR;\n#ifdef WITH_OPENSSL\n\tconst EVP_CIPHER *type;\n\tint klen;\n#endif\n\n\t*ccp = NULL;\n\tif ((cc = calloc(sizeof(*cc), 1)) == NULL)\n\t\treturn SSH_ERR_ALLOC_FAIL;\n\n\tcc->plaintext = (cipher->flags & CFLAG_NONE) != 0;\n\tcc->encrypt = do_encrypt;\n\n\tif (keylen < cipher->key_len ||\n\t    (iv != NULL && ivlen < cipher_ivlen(cipher))) {\n\t\tret = SSH_ERR_INVALID_ARGUMENT;\n\t\tgoto out;\n\t}\n\n\tcc->cipher = cipher;\n\tif ((cc->cipher->flags & CFLAG_CHACHAPOLY) != 0) {\n\t\tret = chachapoly_init(&cc->cp_ctx, key, keylen);\n\t\tgoto out;\n\t}\n\tif ((cc->cipher->flags & CFLAG_NONE) != 0) {\n\t\tret = 0;\n\t\tgoto out;\n\t}\n#ifndef WITH_OPENSSL\n\tif ((cc->cipher->flags & CFLAG_AESCTR) != 0) {\n\t\taesctr_keysetup(&cc->ac_ctx, key, 8 * keylen, 8 * ivlen);\n\t\taesctr_ivsetup(&cc->ac_ctx, iv);\n\t\tret = 0;\n\t\tgoto out;\n\t}\n\tret = SSH_ERR_INVALID_ARGUMENT;\n\tgoto out;\n#else /* WITH_OPENSSL */\n\ttype = (*cipher->evptype)();\n\tif ((cc->evp = EVP_CIPHER_CTX_new()) == NULL) {\n\t\tret = SSH_ERR_ALLOC_FAIL;\n\t\tgoto out;\n\t}\n\tif (EVP_CipherInit(cc->evp, type, NULL, (u_char *)iv,\n\t    (do_encrypt == CIPHER_ENCRYPT)) == 0) {\n\t\tret = SSH_ERR_LIBCRYPTO_ERROR;\n\t\tgoto out;\n\t}\n\tif (cipher_authlen(cipher) &&\n\t    !EVP_CIPHER_CTX_ctrl(cc->evp, EVP_CTRL_GCM_SET_IV_FIXED,\n\t    -1, (u_char *)iv)) {\n\t\tret = SSH_ERR_LIBCRYPTO_ERROR;\n\t\tgoto out;\n\t}\n\tklen = EVP_CIPHER_CTX_key_length(cc->evp);\n\tif (klen > 0 && keylen != (u_int)klen) {\n\t\tif (EVP_CIPHER_CTX_set_key_length(cc->evp, keylen) == 0) {\n\t\t\tret = SSH_ERR_LIBCRYPTO_ERROR;\n\t\t\tgoto out;\n\t\t}\n\t}\n\tif (EVP_CipherInit(cc->evp, NULL, (u_char *)key, NULL, -1) == 0) {\n\t\tret = SSH_ERR_LIBCRYPTO_ERROR;\n\t\tgoto out;\n\t}\n\tret = 0;\n#endif /* WITH_OPENSSL */\n out:\n\tif (ret == 0) {\n\t\t/* success */\n\t\t*ccp = cc;\n\t} else {\n\t\tif (cc != NULL) {\n#ifdef WITH_OPENSSL\n\t\t\tEVP_CIPHER_CTX_free(cc->evp);\n#endif /* WITH_OPENSSL */\n\t\t\texplicit_bzero(cc, sizeof(*cc));\n\t\t\tfree(cc);\n\t\t}\n\t}\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "debug(\"cipher_init_context: %d\", mode)"
          ],
          "line": 880
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "mac_init",
          "args": [
            "mac"
          ],
          "line": 876
        },
        "resolved": true,
        "details": {
          "function_name": "mac_init",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/mac.c",
          "lines": "142-164",
          "snippet": "int\nmac_init(struct sshmac *mac)\n{\n\tif (mac->key == NULL)\n\t\treturn SSH_ERR_INVALID_ARGUMENT;\n\tswitch (mac->type) {\n\tcase SSH_DIGEST:\n\t\tif (mac->hmac_ctx == NULL ||\n\t\t    ssh_hmac_init(mac->hmac_ctx, mac->key, mac->key_len) < 0)\n\t\t\treturn SSH_ERR_INVALID_ARGUMENT;\n\t\treturn 0;\n\tcase SSH_UMAC:\n\t\tif ((mac->umac_ctx = umac_new(mac->key)) == NULL)\n\t\t\treturn SSH_ERR_ALLOC_FAIL;\n\t\treturn 0;\n\tcase SSH_UMAC128:\n\t\tif ((mac->umac_ctx = umac128_new(mac->key)) == NULL)\n\t\t\treturn SSH_ERR_ALLOC_FAIL;\n\t\treturn 0;\n\tdefault:\n\t\treturn SSH_ERR_INVALID_ARGUMENT;\n\t}\n}",
          "includes": [
            "#include \"openbsd-compat/openssl-compat.h\"",
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include \"misc.h\"",
            "#include \"mac.h\"",
            "#include \"umac.h\"",
            "#include \"hmac.h\"",
            "#include \"digest.h\"",
            "#include <stdio.h>",
            "#include <string.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [
            "#define SSH_UMAC128\t3",
            "#define SSH_UMAC\t2\t/* UMAC (not integrated with OpenSSL) */",
            "#define SSH_DIGEST\t1\t/* SSH_DIGEST_XXX */"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"openbsd-compat/openssl-compat.h\"\n#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"misc.h\"\n#include \"mac.h\"\n#include \"umac.h\"\n#include \"hmac.h\"\n#include \"digest.h\"\n#include <stdio.h>\n#include <string.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\n#define SSH_UMAC128\t3\n#define SSH_UMAC\t2\t/* UMAC (not integrated with OpenSSL) */\n#define SSH_DIGEST\t1\t/* SSH_DIGEST_XXX */\n\nint\nmac_init(struct sshmac *mac)\n{\n\tif (mac->key == NULL)\n\t\treturn SSH_ERR_INVALID_ARGUMENT;\n\tswitch (mac->type) {\n\tcase SSH_DIGEST:\n\t\tif (mac->hmac_ctx == NULL ||\n\t\t    ssh_hmac_init(mac->hmac_ctx, mac->key, mac->key_len) < 0)\n\t\t\treturn SSH_ERR_INVALID_ARGUMENT;\n\t\treturn 0;\n\tcase SSH_UMAC:\n\t\tif ((mac->umac_ctx = umac_new(mac->key)) == NULL)\n\t\t\treturn SSH_ERR_ALLOC_FAIL;\n\t\treturn 0;\n\tcase SSH_UMAC128:\n\t\tif ((mac->umac_ctx = umac128_new(mac->key)) == NULL)\n\t\t\treturn SSH_ERR_ALLOC_FAIL;\n\t\treturn 0;\n\tdefault:\n\t\treturn SSH_ERR_INVALID_ARGUMENT;\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "cipher_authlen",
          "args": [
            "enc->cipher"
          ],
          "line": 875
        },
        "resolved": true,
        "details": {
          "function_name": "cipher_authlen",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/cipher.c",
          "lines": "163-167",
          "snippet": "u_int\ncipher_authlen(const struct sshcipher *c)\n{\n\treturn (c->auth_len);\n}",
          "includes": [
            "#include \"openbsd-compat/openssl-compat.h\"",
            "#include \"digest.h\"",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"misc.h\"",
            "#include \"cipher.h\"",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <string.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"openbsd-compat/openssl-compat.h\"\n#include \"digest.h\"\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"misc.h\"\n#include \"cipher.h\"\n#include <stdio.h>\n#include <stdarg.h>\n#include <string.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nu_int\ncipher_authlen(const struct sshcipher *c)\n{\n\treturn (c->auth_len);\n}"
        }
      },
      {
        "call_info": {
          "callee": "kex_free_newkeys",
          "args": [
            "state->newkeys[mode]"
          ],
          "line": 863
        },
        "resolved": true,
        "details": {
          "function_name": "kex_free_newkeys",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/kex.c",
          "lines": "607-636",
          "snippet": "void\nkex_free_newkeys(struct newkeys *newkeys)\n{\n\tif (newkeys == NULL)\n\t\treturn;\n\tif (newkeys->enc.key) {\n\t\texplicit_bzero(newkeys->enc.key, newkeys->enc.key_len);\n\t\tfree(newkeys->enc.key);\n\t\tnewkeys->enc.key = NULL;\n\t}\n\tif (newkeys->enc.iv) {\n\t\texplicit_bzero(newkeys->enc.iv, newkeys->enc.iv_len);\n\t\tfree(newkeys->enc.iv);\n\t\tnewkeys->enc.iv = NULL;\n\t}\n\tfree(newkeys->enc.name);\n\texplicit_bzero(&newkeys->enc, sizeof(newkeys->enc));\n\tfree(newkeys->comp.name);\n\texplicit_bzero(&newkeys->comp, sizeof(newkeys->comp));\n\tmac_clear(&newkeys->mac);\n\tif (newkeys->mac.key) {\n\t\texplicit_bzero(newkeys->mac.key, newkeys->mac.key_len);\n\t\tfree(newkeys->mac.key);\n\t\tnewkeys->mac.key = NULL;\n\t}\n\tfree(newkeys->mac.name);\n\texplicit_bzero(&newkeys->mac, sizeof(newkeys->mac));\n\texplicit_bzero(newkeys, sizeof(*newkeys));\n\tfree(newkeys);\n}",
          "includes": [
            "#include \"digest.h\"",
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include \"monitor.h\"",
            "#include \"dispatch.h\"",
            "#include \"misc.h\"",
            "#include \"match.h\"",
            "#include \"mac.h\"",
            "#include \"log.h\"",
            "#include \"kex.h\"",
            "#include \"sshkey.h\"",
            "#include \"cipher.h\"",
            "#include \"compat.h\"",
            "#include \"packet.h\"",
            "#include \"ssh2.h\"",
            "#include <openssl/dh.h>",
            "#include <openssl/crypto.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"digest.h\"\n#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"monitor.h\"\n#include \"dispatch.h\"\n#include \"misc.h\"\n#include \"match.h\"\n#include \"mac.h\"\n#include \"log.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"compat.h\"\n#include \"packet.h\"\n#include \"ssh2.h\"\n#include <openssl/dh.h>\n#include <openssl/crypto.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <signal.h>\n#include \"includes.h\"\n\nvoid\nkex_free_newkeys(struct newkeys *newkeys)\n{\n\tif (newkeys == NULL)\n\t\treturn;\n\tif (newkeys->enc.key) {\n\t\texplicit_bzero(newkeys->enc.key, newkeys->enc.key_len);\n\t\tfree(newkeys->enc.key);\n\t\tnewkeys->enc.key = NULL;\n\t}\n\tif (newkeys->enc.iv) {\n\t\texplicit_bzero(newkeys->enc.iv, newkeys->enc.iv_len);\n\t\tfree(newkeys->enc.iv);\n\t\tnewkeys->enc.iv = NULL;\n\t}\n\tfree(newkeys->enc.name);\n\texplicit_bzero(&newkeys->enc, sizeof(newkeys->enc));\n\tfree(newkeys->comp.name);\n\texplicit_bzero(&newkeys->comp, sizeof(newkeys->comp));\n\tmac_clear(&newkeys->mac);\n\tif (newkeys->mac.key) {\n\t\texplicit_bzero(newkeys->mac.key, newkeys->mac.key_len);\n\t\tfree(newkeys->mac.key);\n\t\tnewkeys->mac.key = NULL;\n\t}\n\tfree(newkeys->mac.name);\n\texplicit_bzero(&newkeys->mac, sizeof(newkeys->mac));\n\texplicit_bzero(newkeys, sizeof(*newkeys));\n\tfree(newkeys);\n}"
        }
      },
      {
        "call_info": {
          "callee": "cipher_free",
          "args": [
            "*ccp"
          ],
          "line": 861
        },
        "resolved": true,
        "details": {
          "function_name": "cipher_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/cipher.c",
          "lines": "410-425",
          "snippet": "void\ncipher_free(struct sshcipher_ctx *cc)\n{\n\tif (cc == NULL)\n\t\treturn;\n\tif ((cc->cipher->flags & CFLAG_CHACHAPOLY) != 0)\n\t\texplicit_bzero(&cc->cp_ctx, sizeof(cc->cp_ctx));\n\telse if ((cc->cipher->flags & CFLAG_AESCTR) != 0)\n\t\texplicit_bzero(&cc->ac_ctx, sizeof(cc->ac_ctx));\n#ifdef WITH_OPENSSL\n\tEVP_CIPHER_CTX_free(cc->evp);\n\tcc->evp = NULL;\n#endif\n\texplicit_bzero(cc, sizeof(*cc));\n\tfree(cc);\n}",
          "includes": [
            "#include \"openbsd-compat/openssl-compat.h\"",
            "#include \"digest.h\"",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"misc.h\"",
            "#include \"cipher.h\"",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <string.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [
            "#define CFLAG_AESCTR\t\t(1<<2)",
            "#define CFLAG_CHACHAPOLY\t(1<<1)"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"openbsd-compat/openssl-compat.h\"\n#include \"digest.h\"\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"misc.h\"\n#include \"cipher.h\"\n#include <stdio.h>\n#include <stdarg.h>\n#include <string.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\n#define CFLAG_AESCTR\t\t(1<<2)\n#define CFLAG_CHACHAPOLY\t(1<<1)\n\nvoid\ncipher_free(struct sshcipher_ctx *cc)\n{\n\tif (cc == NULL)\n\t\treturn;\n\tif ((cc->cipher->flags & CFLAG_CHACHAPOLY) != 0)\n\t\texplicit_bzero(&cc->cp_ctx, sizeof(cc->cp_ctx));\n\telse if ((cc->cipher->flags & CFLAG_AESCTR) != 0)\n\t\texplicit_bzero(&cc->ac_ctx, sizeof(cc->ac_ctx));\n#ifdef WITH_OPENSSL\n\tEVP_CIPHER_CTX_free(cc->evp);\n\tcc->evp = NULL;\n#endif\n\texplicit_bzero(cc, sizeof(*cc));\n\tfree(cc);\n}"
        }
      },
      {
        "call_info": {
          "callee": "debug2",
          "args": [
            "\"set_newkeys: mode %d\"",
            "mode"
          ],
          "line": 841
        },
        "resolved": true,
        "details": {
          "function_name": "debug2",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/log.c",
          "lines": "232-240",
          "snippet": "void\ndebug2(const char *fmt,...)\n{\n\tva_list args;\n\n\tva_start(args, fmt);\n\tdo_log(SYSLOG_LEVEL_DEBUG2, fmt, args);\n\tva_end(args);\n}",
          "includes": [
            "#include \"log.h\"",
            "# include <vis.h>",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <syslog.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <fcntl.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n# include <vis.h>\n#include <errno.h>\n#include <unistd.h>\n#include <syslog.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <fcntl.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\ndebug2(const char *fmt,...)\n{\n\tva_list args;\n\n\tva_start(args, fmt);\n\tdo_log(SYSLOG_LEVEL_DEBUG2, fmt, args);\n\tva_end(args);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nssh_set_newkeys(struct ssh *ssh, int mode)\n{\n\tstruct session_state *state = ssh->state;\n\tstruct sshenc *enc;\n\tstruct sshmac *mac;\n\tstruct sshcomp *comp;\n\tstruct sshcipher_ctx **ccp;\n\tstruct packet_state *ps;\n\tu_int64_t *max_blocks;\n\tconst char *wmsg;\n\tint r, crypt_type;\n\n\tdebug2(\"set_newkeys: mode %d\", mode);\n\n\tif (mode == MODE_OUT) {\n\t\tccp = &state->send_context;\n\t\tcrypt_type = CIPHER_ENCRYPT;\n\t\tps = &state->p_send;\n\t\tmax_blocks = &state->max_blocks_out;\n\t} else {\n\t\tccp = &state->receive_context;\n\t\tcrypt_type = CIPHER_DECRYPT;\n\t\tps = &state->p_read;\n\t\tmax_blocks = &state->max_blocks_in;\n\t}\n\tif (state->newkeys[mode] != NULL) {\n\t\tdebug(\"set_newkeys: rekeying, input %llu bytes %llu blocks, \"\n\t\t   \"output %llu bytes %llu blocks\",\n\t\t   (unsigned long long)state->p_read.bytes,\n\t\t   (unsigned long long)state->p_read.blocks,\n\t\t   (unsigned long long)state->p_send.bytes,\n\t\t   (unsigned long long)state->p_send.blocks);\n\t\tcipher_free(*ccp);\n\t\t*ccp = NULL;\n\t\tkex_free_newkeys(state->newkeys[mode]);\n\t\tstate->newkeys[mode] = NULL;\n\t}\n\t/* note that both bytes and the seqnr are not reset */\n\tps->packets = ps->blocks = 0;\n\t/* move newkeys from kex to state */\n\tif ((state->newkeys[mode] = ssh->kex->newkeys[mode]) == NULL)\n\t\treturn SSH_ERR_INTERNAL_ERROR;\n\tssh->kex->newkeys[mode] = NULL;\n\tenc  = &state->newkeys[mode]->enc;\n\tmac  = &state->newkeys[mode]->mac;\n\tcomp = &state->newkeys[mode]->comp;\n\tif (cipher_authlen(enc->cipher) == 0) {\n\t\tif ((r = mac_init(mac)) != 0)\n\t\t\treturn r;\n\t}\n\tmac->enabled = 1;\n\tDBG(debug(\"cipher_init_context: %d\", mode));\n\tif ((r = cipher_init(ccp, enc->cipher, enc->key, enc->key_len,\n\t    enc->iv, enc->iv_len, crypt_type)) != 0)\n\t\treturn r;\n\tif (!state->cipher_warning_done &&\n\t    (wmsg = cipher_warning_message(*ccp)) != NULL) {\n\t\terror(\"Warning: %s\", wmsg);\n\t\tstate->cipher_warning_done = 1;\n\t}\n\t/* Deleting the keys does not gain extra security */\n\t/* explicit_bzero(enc->iv,  enc->block_size);\n\t   explicit_bzero(enc->key, enc->key_len);\n\t   explicit_bzero(mac->key, mac->key_len); */\n\tif ((comp->type == COMP_ZLIB ||\n\t    (comp->type == COMP_DELAYED &&\n\t     state->after_authentication)) && comp->enabled == 0) {\n\t\tif ((r = ssh_packet_init_compression(ssh)) < 0)\n\t\t\treturn r;\n\t\tif (mode == MODE_OUT) {\n\t\t\tif ((r = start_compression_out(ssh, 6)) != 0)\n\t\t\t\treturn r;\n\t\t} else {\n\t\t\tif ((r = start_compression_in(ssh)) != 0)\n\t\t\t\treturn r;\n\t\t}\n\t\tcomp->enabled = 1;\n\t}\n\t/*\n\t * The 2^(blocksize*2) limit is too expensive for 3DES,\n\t * so enforce a 1GB limit for small blocksizes.\n\t * See RFC4344 section 3.2.\n\t */\n\tif (enc->block_size >= 16)\n\t\t*max_blocks = (u_int64_t)1 << (enc->block_size*2);\n\telse\n\t\t*max_blocks = ((u_int64_t)1 << 30) / enc->block_size;\n\tif (state->rekey_limit)\n\t\t*max_blocks = MINIMUM(*max_blocks,\n\t\t    state->rekey_limit / enc->block_size);\n\tdebug(\"rekey after %llu blocks\", (unsigned long long)*max_blocks);\n\treturn 0;\n}"
  },
  {
    "function_name": "ssh_clear_newkeys",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
    "lines": "819-826",
    "snippet": "void\nssh_clear_newkeys(struct ssh *ssh, int mode)\n{\n\tif (ssh->kex && ssh->kex->newkeys[mode]) {\n\t\tkex_free_newkeys(ssh->kex->newkeys[mode]);\n\t\tssh->kex->newkeys[mode] = NULL;\n\t}\n}",
    "includes": [
      "#include \"sshbuf.h\"",
      "#include \"ssherr.h\"",
      "#include \"packet.h\"",
      "#include \"ssh.h\"",
      "#include \"channels.h\"",
      "#include \"misc.h\"",
      "#include \"canohost.h\"",
      "#include \"log.h\"",
      "#include \"mac.h\"",
      "#include \"digest.h\"",
      "#include \"kex.h\"",
      "#include \"sshkey.h\"",
      "#include \"cipher.h\"",
      "#include \"ssh2.h\"",
      "#include \"compat.h\"",
      "#include \"crc32.h\"",
      "#include \"xmalloc.h\"",
      "#include <zlib.h>",
      "#  include <openssl/ec.h>",
      "# include <openssl/evp.h>",
      "# include <openssl/bn.h>",
      "#include <time.h>",
      "#include <signal.h>",
      "#include <limits.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <stdarg.h>",
      "#include <netdb.h>",
      "#include <errno.h>",
      "#include <arpa/inet.h>",
      "#include <netinet/ip.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include \"openbsd-compat/sys-queue.h\"",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "kex_free_newkeys",
          "args": [
            "ssh->kex->newkeys[mode]"
          ],
          "line": 823
        },
        "resolved": true,
        "details": {
          "function_name": "kex_free_newkeys",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/kex.c",
          "lines": "607-636",
          "snippet": "void\nkex_free_newkeys(struct newkeys *newkeys)\n{\n\tif (newkeys == NULL)\n\t\treturn;\n\tif (newkeys->enc.key) {\n\t\texplicit_bzero(newkeys->enc.key, newkeys->enc.key_len);\n\t\tfree(newkeys->enc.key);\n\t\tnewkeys->enc.key = NULL;\n\t}\n\tif (newkeys->enc.iv) {\n\t\texplicit_bzero(newkeys->enc.iv, newkeys->enc.iv_len);\n\t\tfree(newkeys->enc.iv);\n\t\tnewkeys->enc.iv = NULL;\n\t}\n\tfree(newkeys->enc.name);\n\texplicit_bzero(&newkeys->enc, sizeof(newkeys->enc));\n\tfree(newkeys->comp.name);\n\texplicit_bzero(&newkeys->comp, sizeof(newkeys->comp));\n\tmac_clear(&newkeys->mac);\n\tif (newkeys->mac.key) {\n\t\texplicit_bzero(newkeys->mac.key, newkeys->mac.key_len);\n\t\tfree(newkeys->mac.key);\n\t\tnewkeys->mac.key = NULL;\n\t}\n\tfree(newkeys->mac.name);\n\texplicit_bzero(&newkeys->mac, sizeof(newkeys->mac));\n\texplicit_bzero(newkeys, sizeof(*newkeys));\n\tfree(newkeys);\n}",
          "includes": [
            "#include \"digest.h\"",
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include \"monitor.h\"",
            "#include \"dispatch.h\"",
            "#include \"misc.h\"",
            "#include \"match.h\"",
            "#include \"mac.h\"",
            "#include \"log.h\"",
            "#include \"kex.h\"",
            "#include \"sshkey.h\"",
            "#include \"cipher.h\"",
            "#include \"compat.h\"",
            "#include \"packet.h\"",
            "#include \"ssh2.h\"",
            "#include <openssl/dh.h>",
            "#include <openssl/crypto.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"digest.h\"\n#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"monitor.h\"\n#include \"dispatch.h\"\n#include \"misc.h\"\n#include \"match.h\"\n#include \"mac.h\"\n#include \"log.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"compat.h\"\n#include \"packet.h\"\n#include \"ssh2.h\"\n#include <openssl/dh.h>\n#include <openssl/crypto.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <signal.h>\n#include \"includes.h\"\n\nvoid\nkex_free_newkeys(struct newkeys *newkeys)\n{\n\tif (newkeys == NULL)\n\t\treturn;\n\tif (newkeys->enc.key) {\n\t\texplicit_bzero(newkeys->enc.key, newkeys->enc.key_len);\n\t\tfree(newkeys->enc.key);\n\t\tnewkeys->enc.key = NULL;\n\t}\n\tif (newkeys->enc.iv) {\n\t\texplicit_bzero(newkeys->enc.iv, newkeys->enc.iv_len);\n\t\tfree(newkeys->enc.iv);\n\t\tnewkeys->enc.iv = NULL;\n\t}\n\tfree(newkeys->enc.name);\n\texplicit_bzero(&newkeys->enc, sizeof(newkeys->enc));\n\tfree(newkeys->comp.name);\n\texplicit_bzero(&newkeys->comp, sizeof(newkeys->comp));\n\tmac_clear(&newkeys->mac);\n\tif (newkeys->mac.key) {\n\t\texplicit_bzero(newkeys->mac.key, newkeys->mac.key_len);\n\t\tfree(newkeys->mac.key);\n\t\tnewkeys->mac.key = NULL;\n\t}\n\tfree(newkeys->mac.name);\n\texplicit_bzero(&newkeys->mac, sizeof(newkeys->mac));\n\texplicit_bzero(newkeys, sizeof(*newkeys));\n\tfree(newkeys);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\nssh_clear_newkeys(struct ssh *ssh, int mode)\n{\n\tif (ssh->kex && ssh->kex->newkeys[mode]) {\n\t\tkex_free_newkeys(ssh->kex->newkeys[mode]);\n\t\tssh->kex->newkeys[mode] = NULL;\n\t}\n}"
  },
  {
    "function_name": "uncompress_buffer",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
    "lines": "772-817",
    "snippet": "static int\nuncompress_buffer(struct ssh *ssh, struct sshbuf *in, struct sshbuf *out)\n{\n\tu_char buf[4096];\n\tint r, status;\n\n\tif (ssh->state->compression_in_started != 1)\n\t\treturn SSH_ERR_INTERNAL_ERROR;\n\n\tif ((ssh->state->compression_in_stream.next_in =\n\t    sshbuf_mutable_ptr(in)) == NULL)\n\t\treturn SSH_ERR_INTERNAL_ERROR;\n\tssh->state->compression_in_stream.avail_in = sshbuf_len(in);\n\n\tfor (;;) {\n\t\t/* Set up fixed-size output buffer. */\n\t\tssh->state->compression_in_stream.next_out = buf;\n\t\tssh->state->compression_in_stream.avail_out = sizeof(buf);\n\n\t\tstatus = inflate(&ssh->state->compression_in_stream,\n\t\t    Z_PARTIAL_FLUSH);\n\t\tswitch (status) {\n\t\tcase Z_OK:\n\t\t\tif ((r = sshbuf_put(out, buf, sizeof(buf) -\n\t\t\t    ssh->state->compression_in_stream.avail_out)) != 0)\n\t\t\t\treturn r;\n\t\t\tbreak;\n\t\tcase Z_BUF_ERROR:\n\t\t\t/*\n\t\t\t * Comments in zlib.h say that we should keep calling\n\t\t\t * inflate() until we get an error.  This appears to\n\t\t\t * be the error that we get.\n\t\t\t */\n\t\t\treturn 0;\n\t\tcase Z_DATA_ERROR:\n\t\t\treturn SSH_ERR_INVALID_FORMAT;\n\t\tcase Z_MEM_ERROR:\n\t\t\treturn SSH_ERR_ALLOC_FAIL;\n\t\tcase Z_STREAM_ERROR:\n\t\tdefault:\n\t\t\tssh->state->compression_in_failures++;\n\t\t\treturn SSH_ERR_INTERNAL_ERROR;\n\t\t}\n\t}\n\t/* NOTREACHED */\n}",
    "includes": [
      "#include \"sshbuf.h\"",
      "#include \"ssherr.h\"",
      "#include \"packet.h\"",
      "#include \"ssh.h\"",
      "#include \"channels.h\"",
      "#include \"misc.h\"",
      "#include \"canohost.h\"",
      "#include \"log.h\"",
      "#include \"mac.h\"",
      "#include \"digest.h\"",
      "#include \"kex.h\"",
      "#include \"sshkey.h\"",
      "#include \"cipher.h\"",
      "#include \"ssh2.h\"",
      "#include \"compat.h\"",
      "#include \"crc32.h\"",
      "#include \"xmalloc.h\"",
      "#include <zlib.h>",
      "#  include <openssl/ec.h>",
      "# include <openssl/evp.h>",
      "# include <openssl/bn.h>",
      "#include <time.h>",
      "#include <signal.h>",
      "#include <limits.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <stdarg.h>",
      "#include <netdb.h>",
      "#include <errno.h>",
      "#include <arpa/inet.h>",
      "#include <netinet/ip.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include \"openbsd-compat/sys-queue.h\"",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "sshbuf_put",
          "args": [
            "out",
            "buf",
            "sizeof(buf) -\n\t\t\t    ssh->state->compression_in_stream.avail_out"
          ],
          "line": 795
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_putf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf-getput-basic.c",
          "lines": "254-264",
          "snippet": "int\nsshbuf_putf(struct sshbuf *buf, const char *fmt, ...)\n{\n\tva_list ap;\n\tint r;\n\n\tva_start(ap, fmt);\n\tr = sshbuf_putfv(buf, fmt, ap);\n\tva_end(ap);\n\treturn r;\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <stdarg.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <stdarg.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshbuf_putf(struct sshbuf *buf, const char *fmt, ...)\n{\n\tva_list ap;\n\tint r;\n\n\tva_start(ap, fmt);\n\tr = sshbuf_putfv(buf, fmt, ap);\n\tva_end(ap);\n\treturn r;\n}"
        }
      },
      {
        "call_info": {
          "callee": "inflate",
          "args": [
            "&ssh->state->compression_in_stream",
            "Z_PARTIAL_FLUSH"
          ],
          "line": 791
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sshbuf_len",
          "args": [
            "in"
          ],
          "line": 784
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_len",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf.c",
          "lines": "252-258",
          "snippet": "size_t\nsshbuf_len(const struct sshbuf *buf)\n{\n\tif (sshbuf_check_sanity(buf) != 0)\n\t\treturn 0;\n\treturn buf->size - buf->off;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <signal.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <signal.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nsize_t\nsshbuf_len(const struct sshbuf *buf)\n{\n\tif (sshbuf_check_sanity(buf) != 0)\n\t\treturn 0;\n\treturn buf->size - buf->off;\n}"
        }
      },
      {
        "call_info": {
          "callee": "sshbuf_mutable_ptr",
          "args": [
            "in"
          ],
          "line": 782
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_mutable_ptr",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf.c",
          "lines": "276-282",
          "snippet": "u_char *\nsshbuf_mutable_ptr(const struct sshbuf *buf)\n{\n\tif (sshbuf_check_sanity(buf) != 0 || buf->readonly || buf->refcount > 1)\n\t\treturn NULL;\n\treturn buf->d + buf->off;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <signal.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <signal.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nu_char *\nsshbuf_mutable_ptr(const struct sshbuf *buf)\n{\n\tif (sshbuf_check_sanity(buf) != 0 || buf->readonly || buf->refcount > 1)\n\t\treturn NULL;\n\treturn buf->d + buf->off;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nstatic int\nuncompress_buffer(struct ssh *ssh, struct sshbuf *in, struct sshbuf *out)\n{\n\tu_char buf[4096];\n\tint r, status;\n\n\tif (ssh->state->compression_in_started != 1)\n\t\treturn SSH_ERR_INTERNAL_ERROR;\n\n\tif ((ssh->state->compression_in_stream.next_in =\n\t    sshbuf_mutable_ptr(in)) == NULL)\n\t\treturn SSH_ERR_INTERNAL_ERROR;\n\tssh->state->compression_in_stream.avail_in = sshbuf_len(in);\n\n\tfor (;;) {\n\t\t/* Set up fixed-size output buffer. */\n\t\tssh->state->compression_in_stream.next_out = buf;\n\t\tssh->state->compression_in_stream.avail_out = sizeof(buf);\n\n\t\tstatus = inflate(&ssh->state->compression_in_stream,\n\t\t    Z_PARTIAL_FLUSH);\n\t\tswitch (status) {\n\t\tcase Z_OK:\n\t\t\tif ((r = sshbuf_put(out, buf, sizeof(buf) -\n\t\t\t    ssh->state->compression_in_stream.avail_out)) != 0)\n\t\t\t\treturn r;\n\t\t\tbreak;\n\t\tcase Z_BUF_ERROR:\n\t\t\t/*\n\t\t\t * Comments in zlib.h say that we should keep calling\n\t\t\t * inflate() until we get an error.  This appears to\n\t\t\t * be the error that we get.\n\t\t\t */\n\t\t\treturn 0;\n\t\tcase Z_DATA_ERROR:\n\t\t\treturn SSH_ERR_INVALID_FORMAT;\n\t\tcase Z_MEM_ERROR:\n\t\t\treturn SSH_ERR_ALLOC_FAIL;\n\t\tcase Z_STREAM_ERROR:\n\t\tdefault:\n\t\t\tssh->state->compression_in_failures++;\n\t\t\treturn SSH_ERR_INTERNAL_ERROR;\n\t\t}\n\t}\n\t/* NOTREACHED */\n}"
  },
  {
    "function_name": "compress_buffer",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
    "lines": "726-770",
    "snippet": "static int\ncompress_buffer(struct ssh *ssh, struct sshbuf *in, struct sshbuf *out)\n{\n\tu_char buf[4096];\n\tint r, status;\n\n\tif (ssh->state->compression_out_started != 1)\n\t\treturn SSH_ERR_INTERNAL_ERROR;\n\n\t/* This case is not handled below. */\n\tif (sshbuf_len(in) == 0)\n\t\treturn 0;\n\n\t/* Input is the contents of the input buffer. */\n\tif ((ssh->state->compression_out_stream.next_in =\n\t    sshbuf_mutable_ptr(in)) == NULL)\n\t\treturn SSH_ERR_INTERNAL_ERROR;\n\tssh->state->compression_out_stream.avail_in = sshbuf_len(in);\n\n\t/* Loop compressing until deflate() returns with avail_out != 0. */\n\tdo {\n\t\t/* Set up fixed-size output buffer. */\n\t\tssh->state->compression_out_stream.next_out = buf;\n\t\tssh->state->compression_out_stream.avail_out = sizeof(buf);\n\n\t\t/* Compress as much data into the buffer as possible. */\n\t\tstatus = deflate(&ssh->state->compression_out_stream,\n\t\t    Z_PARTIAL_FLUSH);\n\t\tswitch (status) {\n\t\tcase Z_MEM_ERROR:\n\t\t\treturn SSH_ERR_ALLOC_FAIL;\n\t\tcase Z_OK:\n\t\t\t/* Append compressed data to output_buffer. */\n\t\t\tif ((r = sshbuf_put(out, buf, sizeof(buf) -\n\t\t\t    ssh->state->compression_out_stream.avail_out)) != 0)\n\t\t\t\treturn r;\n\t\t\tbreak;\n\t\tcase Z_STREAM_ERROR:\n\t\tdefault:\n\t\t\tssh->state->compression_out_failures++;\n\t\t\treturn SSH_ERR_INVALID_FORMAT;\n\t\t}\n\t} while (ssh->state->compression_out_stream.avail_out == 0);\n\treturn 0;\n}",
    "includes": [
      "#include \"sshbuf.h\"",
      "#include \"ssherr.h\"",
      "#include \"packet.h\"",
      "#include \"ssh.h\"",
      "#include \"channels.h\"",
      "#include \"misc.h\"",
      "#include \"canohost.h\"",
      "#include \"log.h\"",
      "#include \"mac.h\"",
      "#include \"digest.h\"",
      "#include \"kex.h\"",
      "#include \"sshkey.h\"",
      "#include \"cipher.h\"",
      "#include \"ssh2.h\"",
      "#include \"compat.h\"",
      "#include \"crc32.h\"",
      "#include \"xmalloc.h\"",
      "#include <zlib.h>",
      "#  include <openssl/ec.h>",
      "# include <openssl/evp.h>",
      "# include <openssl/bn.h>",
      "#include <time.h>",
      "#include <signal.h>",
      "#include <limits.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <stdarg.h>",
      "#include <netdb.h>",
      "#include <errno.h>",
      "#include <arpa/inet.h>",
      "#include <netinet/ip.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include \"openbsd-compat/sys-queue.h\"",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "sshbuf_put",
          "args": [
            "out",
            "buf",
            "sizeof(buf) -\n\t\t\t    ssh->state->compression_out_stream.avail_out"
          ],
          "line": 759
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_putf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf-getput-basic.c",
          "lines": "254-264",
          "snippet": "int\nsshbuf_putf(struct sshbuf *buf, const char *fmt, ...)\n{\n\tva_list ap;\n\tint r;\n\n\tva_start(ap, fmt);\n\tr = sshbuf_putfv(buf, fmt, ap);\n\tva_end(ap);\n\treturn r;\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <stdarg.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <stdarg.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshbuf_putf(struct sshbuf *buf, const char *fmt, ...)\n{\n\tva_list ap;\n\tint r;\n\n\tva_start(ap, fmt);\n\tr = sshbuf_putfv(buf, fmt, ap);\n\tva_end(ap);\n\treturn r;\n}"
        }
      },
      {
        "call_info": {
          "callee": "deflate",
          "args": [
            "&ssh->state->compression_out_stream",
            "Z_PARTIAL_FLUSH"
          ],
          "line": 752
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sshbuf_len",
          "args": [
            "in"
          ],
          "line": 743
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_len",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf.c",
          "lines": "252-258",
          "snippet": "size_t\nsshbuf_len(const struct sshbuf *buf)\n{\n\tif (sshbuf_check_sanity(buf) != 0)\n\t\treturn 0;\n\treturn buf->size - buf->off;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <signal.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <signal.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nsize_t\nsshbuf_len(const struct sshbuf *buf)\n{\n\tif (sshbuf_check_sanity(buf) != 0)\n\t\treturn 0;\n\treturn buf->size - buf->off;\n}"
        }
      },
      {
        "call_info": {
          "callee": "sshbuf_mutable_ptr",
          "args": [
            "in"
          ],
          "line": 741
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_mutable_ptr",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf.c",
          "lines": "276-282",
          "snippet": "u_char *\nsshbuf_mutable_ptr(const struct sshbuf *buf)\n{\n\tif (sshbuf_check_sanity(buf) != 0 || buf->readonly || buf->refcount > 1)\n\t\treturn NULL;\n\treturn buf->d + buf->off;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <signal.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <signal.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nu_char *\nsshbuf_mutable_ptr(const struct sshbuf *buf)\n{\n\tif (sshbuf_check_sanity(buf) != 0 || buf->readonly || buf->refcount > 1)\n\t\treturn NULL;\n\treturn buf->d + buf->off;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nstatic int\ncompress_buffer(struct ssh *ssh, struct sshbuf *in, struct sshbuf *out)\n{\n\tu_char buf[4096];\n\tint r, status;\n\n\tif (ssh->state->compression_out_started != 1)\n\t\treturn SSH_ERR_INTERNAL_ERROR;\n\n\t/* This case is not handled below. */\n\tif (sshbuf_len(in) == 0)\n\t\treturn 0;\n\n\t/* Input is the contents of the input buffer. */\n\tif ((ssh->state->compression_out_stream.next_in =\n\t    sshbuf_mutable_ptr(in)) == NULL)\n\t\treturn SSH_ERR_INTERNAL_ERROR;\n\tssh->state->compression_out_stream.avail_in = sshbuf_len(in);\n\n\t/* Loop compressing until deflate() returns with avail_out != 0. */\n\tdo {\n\t\t/* Set up fixed-size output buffer. */\n\t\tssh->state->compression_out_stream.next_out = buf;\n\t\tssh->state->compression_out_stream.avail_out = sizeof(buf);\n\n\t\t/* Compress as much data into the buffer as possible. */\n\t\tstatus = deflate(&ssh->state->compression_out_stream,\n\t\t    Z_PARTIAL_FLUSH);\n\t\tswitch (status) {\n\t\tcase Z_MEM_ERROR:\n\t\t\treturn SSH_ERR_ALLOC_FAIL;\n\t\tcase Z_OK:\n\t\t\t/* Append compressed data to output_buffer. */\n\t\t\tif ((r = sshbuf_put(out, buf, sizeof(buf) -\n\t\t\t    ssh->state->compression_out_stream.avail_out)) != 0)\n\t\t\t\treturn r;\n\t\t\tbreak;\n\t\tcase Z_STREAM_ERROR:\n\t\tdefault:\n\t\t\tssh->state->compression_out_failures++;\n\t\t\treturn SSH_ERR_INVALID_FORMAT;\n\t\t}\n\t} while (ssh->state->compression_out_stream.avail_out == 0);\n\treturn 0;\n}"
  },
  {
    "function_name": "start_compression_in",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
    "lines": "708-723",
    "snippet": "static int\nstart_compression_in(struct ssh *ssh)\n{\n\tif (ssh->state->compression_in_started == 1)\n\t\tinflateEnd(&ssh->state->compression_in_stream);\n\tswitch (inflateInit(&ssh->state->compression_in_stream)) {\n\tcase Z_OK:\n\t\tssh->state->compression_in_started = 1;\n\t\tbreak;\n\tcase Z_MEM_ERROR:\n\t\treturn SSH_ERR_ALLOC_FAIL;\n\tdefault:\n\t\treturn SSH_ERR_INTERNAL_ERROR;\n\t}\n\treturn 0;\n}",
    "includes": [
      "#include \"sshbuf.h\"",
      "#include \"ssherr.h\"",
      "#include \"packet.h\"",
      "#include \"ssh.h\"",
      "#include \"channels.h\"",
      "#include \"misc.h\"",
      "#include \"canohost.h\"",
      "#include \"log.h\"",
      "#include \"mac.h\"",
      "#include \"digest.h\"",
      "#include \"kex.h\"",
      "#include \"sshkey.h\"",
      "#include \"cipher.h\"",
      "#include \"ssh2.h\"",
      "#include \"compat.h\"",
      "#include \"crc32.h\"",
      "#include \"xmalloc.h\"",
      "#include <zlib.h>",
      "#  include <openssl/ec.h>",
      "# include <openssl/evp.h>",
      "# include <openssl/bn.h>",
      "#include <time.h>",
      "#include <signal.h>",
      "#include <limits.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <stdarg.h>",
      "#include <netdb.h>",
      "#include <errno.h>",
      "#include <arpa/inet.h>",
      "#include <netinet/ip.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include \"openbsd-compat/sys-queue.h\"",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "inflateInit",
          "args": [
            "&ssh->state->compression_in_stream"
          ],
          "line": 713
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "inflateEnd",
          "args": [
            "&ssh->state->compression_in_stream"
          ],
          "line": 712
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nstatic int\nstart_compression_in(struct ssh *ssh)\n{\n\tif (ssh->state->compression_in_started == 1)\n\t\tinflateEnd(&ssh->state->compression_in_stream);\n\tswitch (inflateInit(&ssh->state->compression_in_stream)) {\n\tcase Z_OK:\n\t\tssh->state->compression_in_started = 1;\n\t\tbreak;\n\tcase Z_MEM_ERROR:\n\t\treturn SSH_ERR_ALLOC_FAIL;\n\tdefault:\n\t\treturn SSH_ERR_INTERNAL_ERROR;\n\t}\n\treturn 0;\n}"
  },
  {
    "function_name": "start_compression_out",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
    "lines": "688-706",
    "snippet": "static int\nstart_compression_out(struct ssh *ssh, int level)\n{\n\tif (level < 1 || level > 9)\n\t\treturn SSH_ERR_INVALID_ARGUMENT;\n\tdebug(\"Enabling compression at level %d.\", level);\n\tif (ssh->state->compression_out_started == 1)\n\t\tdeflateEnd(&ssh->state->compression_out_stream);\n\tswitch (deflateInit(&ssh->state->compression_out_stream, level)) {\n\tcase Z_OK:\n\t\tssh->state->compression_out_started = 1;\n\t\tbreak;\n\tcase Z_MEM_ERROR:\n\t\treturn SSH_ERR_ALLOC_FAIL;\n\tdefault:\n\t\treturn SSH_ERR_INTERNAL_ERROR;\n\t}\n\treturn 0;\n}",
    "includes": [
      "#include \"sshbuf.h\"",
      "#include \"ssherr.h\"",
      "#include \"packet.h\"",
      "#include \"ssh.h\"",
      "#include \"channels.h\"",
      "#include \"misc.h\"",
      "#include \"canohost.h\"",
      "#include \"log.h\"",
      "#include \"mac.h\"",
      "#include \"digest.h\"",
      "#include \"kex.h\"",
      "#include \"sshkey.h\"",
      "#include \"cipher.h\"",
      "#include \"ssh2.h\"",
      "#include \"compat.h\"",
      "#include \"crc32.h\"",
      "#include \"xmalloc.h\"",
      "#include <zlib.h>",
      "#  include <openssl/ec.h>",
      "# include <openssl/evp.h>",
      "# include <openssl/bn.h>",
      "#include <time.h>",
      "#include <signal.h>",
      "#include <limits.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <stdarg.h>",
      "#include <netdb.h>",
      "#include <errno.h>",
      "#include <arpa/inet.h>",
      "#include <netinet/ip.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include \"openbsd-compat/sys-queue.h\"",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "deflateInit",
          "args": [
            "&ssh->state->compression_out_stream",
            "level"
          ],
          "line": 696
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "deflateEnd",
          "args": [
            "&ssh->state->compression_out_stream"
          ],
          "line": 695
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug",
          "args": [
            "\"Enabling compression at level %d.\"",
            "level"
          ],
          "line": 693
        },
        "resolved": true,
        "details": {
          "function_name": "ssh_packet_send_debug",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
          "lines": "1771-1794",
          "snippet": "void\nssh_packet_send_debug(struct ssh *ssh, const char *fmt,...)\n{\n\tchar buf[1024];\n\tva_list args;\n\tint r;\n\n\tif ((ssh->compat & SSH_BUG_DEBUG))\n\t\treturn;\n\n\tva_start(args, fmt);\n\tvsnprintf(buf, sizeof(buf), fmt, args);\n\tva_end(args);\n\n\tdebug3(\"sending debug message: %s\", buf);\n\n\tif ((r = sshpkt_start(ssh, SSH2_MSG_DEBUG)) != 0 ||\n\t    (r = sshpkt_put_u8(ssh, 0)) != 0 || /* always display */\n\t    (r = sshpkt_put_cstring(ssh, buf)) != 0 ||\n\t    (r = sshpkt_put_cstring(ssh, \"\")) != 0 ||\n\t    (r = sshpkt_send(ssh)) != 0 ||\n\t    (r = ssh_packet_write_wait(ssh)) != 0)\n\t\tfatal(\"%s: %s\", __func__, ssh_err(r));\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include \"packet.h\"",
            "#include \"ssh.h\"",
            "#include \"channels.h\"",
            "#include \"misc.h\"",
            "#include \"canohost.h\"",
            "#include \"log.h\"",
            "#include \"mac.h\"",
            "#include \"digest.h\"",
            "#include \"kex.h\"",
            "#include \"sshkey.h\"",
            "#include \"cipher.h\"",
            "#include \"ssh2.h\"",
            "#include \"compat.h\"",
            "#include \"crc32.h\"",
            "#include \"xmalloc.h\"",
            "#include <zlib.h>",
            "#  include <openssl/ec.h>",
            "# include <openssl/evp.h>",
            "# include <openssl/bn.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <limits.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <netdb.h>",
            "#include <errno.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include \"openbsd-compat/sys-queue.h\"",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\nssh_packet_send_debug(struct ssh *ssh, const char *fmt,...)\n{\n\tchar buf[1024];\n\tva_list args;\n\tint r;\n\n\tif ((ssh->compat & SSH_BUG_DEBUG))\n\t\treturn;\n\n\tva_start(args, fmt);\n\tvsnprintf(buf, sizeof(buf), fmt, args);\n\tva_end(args);\n\n\tdebug3(\"sending debug message: %s\", buf);\n\n\tif ((r = sshpkt_start(ssh, SSH2_MSG_DEBUG)) != 0 ||\n\t    (r = sshpkt_put_u8(ssh, 0)) != 0 || /* always display */\n\t    (r = sshpkt_put_cstring(ssh, buf)) != 0 ||\n\t    (r = sshpkt_put_cstring(ssh, \"\")) != 0 ||\n\t    (r = sshpkt_send(ssh)) != 0 ||\n\t    (r = ssh_packet_write_wait(ssh)) != 0)\n\t\tfatal(\"%s: %s\", __func__, ssh_err(r));\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nstatic int\nstart_compression_out(struct ssh *ssh, int level)\n{\n\tif (level < 1 || level > 9)\n\t\treturn SSH_ERR_INVALID_ARGUMENT;\n\tdebug(\"Enabling compression at level %d.\", level);\n\tif (ssh->state->compression_out_started == 1)\n\t\tdeflateEnd(&ssh->state->compression_out_stream);\n\tswitch (deflateInit(&ssh->state->compression_out_stream, level)) {\n\tcase Z_OK:\n\t\tssh->state->compression_out_started = 1;\n\t\tbreak;\n\tcase Z_MEM_ERROR:\n\t\treturn SSH_ERR_ALLOC_FAIL;\n\tdefault:\n\t\treturn SSH_ERR_INTERNAL_ERROR;\n\t}\n\treturn 0;\n}"
  },
  {
    "function_name": "ssh_packet_init_compression",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
    "lines": "679-686",
    "snippet": "static int\nssh_packet_init_compression(struct ssh *ssh)\n{\n\tif (!ssh->state->compression_buffer &&\n\t   ((ssh->state->compression_buffer = sshbuf_new()) == NULL))\n\t\treturn SSH_ERR_ALLOC_FAIL;\n\treturn 0;\n}",
    "includes": [
      "#include \"sshbuf.h\"",
      "#include \"ssherr.h\"",
      "#include \"packet.h\"",
      "#include \"ssh.h\"",
      "#include \"channels.h\"",
      "#include \"misc.h\"",
      "#include \"canohost.h\"",
      "#include \"log.h\"",
      "#include \"mac.h\"",
      "#include \"digest.h\"",
      "#include \"kex.h\"",
      "#include \"sshkey.h\"",
      "#include \"cipher.h\"",
      "#include \"ssh2.h\"",
      "#include \"compat.h\"",
      "#include \"crc32.h\"",
      "#include \"xmalloc.h\"",
      "#include <zlib.h>",
      "#  include <openssl/ec.h>",
      "# include <openssl/evp.h>",
      "# include <openssl/bn.h>",
      "#include <time.h>",
      "#include <signal.h>",
      "#include <limits.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <stdarg.h>",
      "#include <netdb.h>",
      "#include <errno.h>",
      "#include <arpa/inet.h>",
      "#include <netinet/ip.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include \"openbsd-compat/sys-queue.h\"",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "sshbuf_new",
          "args": [],
          "line": 683
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_new",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf.c",
          "lines": "68-85",
          "snippet": "struct sshbuf *\nsshbuf_new(void)\n{\n\tstruct sshbuf *ret;\n\n\tif ((ret = calloc(sizeof(*ret), 1)) == NULL)\n\t\treturn NULL;\n\tret->alloc = SSHBUF_SIZE_INIT;\n\tret->max_size = SSHBUF_SIZE_MAX;\n\tret->readonly = 0;\n\tret->refcount = 1;\n\tret->parent = NULL;\n\tif ((ret->cd = ret->d = calloc(1, ret->alloc)) == NULL) {\n\t\tfree(ret);\n\t\treturn NULL;\n\t}\n\treturn ret;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <signal.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <signal.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nstruct sshbuf *\nsshbuf_new(void)\n{\n\tstruct sshbuf *ret;\n\n\tif ((ret = calloc(sizeof(*ret), 1)) == NULL)\n\t\treturn NULL;\n\tret->alloc = SSHBUF_SIZE_INIT;\n\tret->max_size = SSHBUF_SIZE_MAX;\n\tret->readonly = 0;\n\tret->refcount = 1;\n\tret->parent = NULL;\n\tif ((ret->cd = ret->d = calloc(1, ret->alloc)) == NULL) {\n\t\tfree(ret);\n\t\treturn NULL;\n\t}\n\treturn ret;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nstatic int\nssh_packet_init_compression(struct ssh *ssh)\n{\n\tif (!ssh->state->compression_buffer &&\n\t   ((ssh->state->compression_buffer = sshbuf_new()) == NULL))\n\t\treturn SSH_ERR_ALLOC_FAIL;\n\treturn 0;\n}"
  },
  {
    "function_name": "ssh_packet_get_protocol_flags",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
    "lines": "668-672",
    "snippet": "u_int\nssh_packet_get_protocol_flags(struct ssh *ssh)\n{\n\treturn ssh->state->remote_protocol_flags;\n}",
    "includes": [
      "#include \"sshbuf.h\"",
      "#include \"ssherr.h\"",
      "#include \"packet.h\"",
      "#include \"ssh.h\"",
      "#include \"channels.h\"",
      "#include \"misc.h\"",
      "#include \"canohost.h\"",
      "#include \"log.h\"",
      "#include \"mac.h\"",
      "#include \"digest.h\"",
      "#include \"kex.h\"",
      "#include \"sshkey.h\"",
      "#include \"cipher.h\"",
      "#include \"ssh2.h\"",
      "#include \"compat.h\"",
      "#include \"crc32.h\"",
      "#include \"xmalloc.h\"",
      "#include <zlib.h>",
      "#  include <openssl/ec.h>",
      "# include <openssl/evp.h>",
      "# include <openssl/bn.h>",
      "#include <time.h>",
      "#include <signal.h>",
      "#include <limits.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <stdarg.h>",
      "#include <netdb.h>",
      "#include <errno.h>",
      "#include <arpa/inet.h>",
      "#include <netinet/ip.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include \"openbsd-compat/sys-queue.h\"",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nu_int\nssh_packet_get_protocol_flags(struct ssh *ssh)\n{\n\treturn ssh->state->remote_protocol_flags;\n}"
  },
  {
    "function_name": "ssh_packet_set_protocol_flags",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
    "lines": "660-664",
    "snippet": "void\nssh_packet_set_protocol_flags(struct ssh *ssh, u_int protocol_flags)\n{\n\tssh->state->remote_protocol_flags = protocol_flags;\n}",
    "includes": [
      "#include \"sshbuf.h\"",
      "#include \"ssherr.h\"",
      "#include \"packet.h\"",
      "#include \"ssh.h\"",
      "#include \"channels.h\"",
      "#include \"misc.h\"",
      "#include \"canohost.h\"",
      "#include \"log.h\"",
      "#include \"mac.h\"",
      "#include \"digest.h\"",
      "#include \"kex.h\"",
      "#include \"sshkey.h\"",
      "#include \"cipher.h\"",
      "#include \"ssh2.h\"",
      "#include \"compat.h\"",
      "#include \"crc32.h\"",
      "#include \"xmalloc.h\"",
      "#include <zlib.h>",
      "#  include <openssl/ec.h>",
      "# include <openssl/evp.h>",
      "# include <openssl/bn.h>",
      "#include <time.h>",
      "#include <signal.h>",
      "#include <limits.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <stdarg.h>",
      "#include <netdb.h>",
      "#include <errno.h>",
      "#include <arpa/inet.h>",
      "#include <netinet/ip.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include \"openbsd-compat/sys-queue.h\"",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\nssh_packet_set_protocol_flags(struct ssh *ssh, u_int protocol_flags)\n{\n\tssh->state->remote_protocol_flags = protocol_flags;\n}"
  },
  {
    "function_name": "ssh_packet_clear_keys",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
    "lines": "652-656",
    "snippet": "void\nssh_packet_clear_keys(struct ssh *ssh)\n{\n\tssh_packet_close_internal(ssh, 0);\n}",
    "includes": [
      "#include \"sshbuf.h\"",
      "#include \"ssherr.h\"",
      "#include \"packet.h\"",
      "#include \"ssh.h\"",
      "#include \"channels.h\"",
      "#include \"misc.h\"",
      "#include \"canohost.h\"",
      "#include \"log.h\"",
      "#include \"mac.h\"",
      "#include \"digest.h\"",
      "#include \"kex.h\"",
      "#include \"sshkey.h\"",
      "#include \"cipher.h\"",
      "#include \"ssh2.h\"",
      "#include \"compat.h\"",
      "#include \"crc32.h\"",
      "#include \"xmalloc.h\"",
      "#include <zlib.h>",
      "#  include <openssl/ec.h>",
      "# include <openssl/evp.h>",
      "# include <openssl/bn.h>",
      "#include <time.h>",
      "#include <signal.h>",
      "#include <limits.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <stdarg.h>",
      "#include <netdb.h>",
      "#include <errno.h>",
      "#include <arpa/inet.h>",
      "#include <netinet/ip.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include \"openbsd-compat/sys-queue.h\"",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "ssh_packet_close_internal",
          "args": [
            "ssh",
            "0"
          ],
          "line": 655
        },
        "resolved": true,
        "details": {
          "function_name": "ssh_packet_close_internal",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
          "lines": "581-644",
          "snippet": "static void\nssh_packet_close_internal(struct ssh *ssh, int do_close)\n{\n\tstruct session_state *state = ssh->state;\n\tu_int mode;\n\n\tif (!state->initialized)\n\t\treturn;\n\tstate->initialized = 0;\n\tif (do_close) {\n\t\tif (state->connection_in == state->connection_out) {\n\t\t\tclose(state->connection_out);\n\t\t} else {\n\t\t\tclose(state->connection_in);\n\t\t\tclose(state->connection_out);\n\t\t}\n\t}\n\tsshbuf_free(state->input);\n\tsshbuf_free(state->output);\n\tsshbuf_free(state->outgoing_packet);\n\tsshbuf_free(state->incoming_packet);\n\tfor (mode = 0; mode < MODE_MAX; mode++) {\n\t\tkex_free_newkeys(state->newkeys[mode]);\t/* current keys */\n\t\tstate->newkeys[mode] = NULL;\n\t\tssh_clear_newkeys(ssh, mode);\t\t/* next keys */\n\t}\n\t/* compression state is in shared mem, so we can only release it once */\n\tif (do_close && state->compression_buffer) {\n\t\tsshbuf_free(state->compression_buffer);\n\t\tif (state->compression_out_started) {\n\t\t\tz_streamp stream = &state->compression_out_stream;\n\t\t\tdebug(\"compress outgoing: \"\n\t\t\t    \"raw data %llu, compressed %llu, factor %.2f\",\n\t\t\t\t(unsigned long long)stream->total_in,\n\t\t\t\t(unsigned long long)stream->total_out,\n\t\t\t\tstream->total_in == 0 ? 0.0 :\n\t\t\t\t(double) stream->total_out / stream->total_in);\n\t\t\tif (state->compression_out_failures == 0)\n\t\t\t\tdeflateEnd(stream);\n\t\t}\n\t\tif (state->compression_in_started) {\n\t\t\tz_streamp stream = &state->compression_in_stream;\n\t\t\tdebug(\"compress incoming: \"\n\t\t\t    \"raw data %llu, compressed %llu, factor %.2f\",\n\t\t\t    (unsigned long long)stream->total_out,\n\t\t\t    (unsigned long long)stream->total_in,\n\t\t\t    stream->total_out == 0 ? 0.0 :\n\t\t\t    (double) stream->total_in / stream->total_out);\n\t\t\tif (state->compression_in_failures == 0)\n\t\t\t\tinflateEnd(stream);\n\t\t}\n\t}\n\tcipher_free(state->send_context);\n\tcipher_free(state->receive_context);\n\tstate->send_context = state->receive_context = NULL;\n\tif (do_close) {\n\t\tfree(ssh->local_ipaddr);\n\t\tssh->local_ipaddr = NULL;\n\t\tfree(ssh->remote_ipaddr);\n\t\tssh->remote_ipaddr = NULL;\n\t\tfree(ssh->state);\n\t\tssh->state = NULL;\n\t}\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include \"packet.h\"",
            "#include \"ssh.h\"",
            "#include \"channels.h\"",
            "#include \"misc.h\"",
            "#include \"canohost.h\"",
            "#include \"log.h\"",
            "#include \"mac.h\"",
            "#include \"digest.h\"",
            "#include \"kex.h\"",
            "#include \"sshkey.h\"",
            "#include \"cipher.h\"",
            "#include \"ssh2.h\"",
            "#include \"compat.h\"",
            "#include \"crc32.h\"",
            "#include \"xmalloc.h\"",
            "#include <zlib.h>",
            "#  include <openssl/ec.h>",
            "# include <openssl/evp.h>",
            "# include <openssl/bn.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <limits.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <netdb.h>",
            "#include <errno.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include \"openbsd-compat/sys-queue.h\"",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nstatic void\nssh_packet_close_internal(struct ssh *ssh, int do_close)\n{\n\tstruct session_state *state = ssh->state;\n\tu_int mode;\n\n\tif (!state->initialized)\n\t\treturn;\n\tstate->initialized = 0;\n\tif (do_close) {\n\t\tif (state->connection_in == state->connection_out) {\n\t\t\tclose(state->connection_out);\n\t\t} else {\n\t\t\tclose(state->connection_in);\n\t\t\tclose(state->connection_out);\n\t\t}\n\t}\n\tsshbuf_free(state->input);\n\tsshbuf_free(state->output);\n\tsshbuf_free(state->outgoing_packet);\n\tsshbuf_free(state->incoming_packet);\n\tfor (mode = 0; mode < MODE_MAX; mode++) {\n\t\tkex_free_newkeys(state->newkeys[mode]);\t/* current keys */\n\t\tstate->newkeys[mode] = NULL;\n\t\tssh_clear_newkeys(ssh, mode);\t\t/* next keys */\n\t}\n\t/* compression state is in shared mem, so we can only release it once */\n\tif (do_close && state->compression_buffer) {\n\t\tsshbuf_free(state->compression_buffer);\n\t\tif (state->compression_out_started) {\n\t\t\tz_streamp stream = &state->compression_out_stream;\n\t\t\tdebug(\"compress outgoing: \"\n\t\t\t    \"raw data %llu, compressed %llu, factor %.2f\",\n\t\t\t\t(unsigned long long)stream->total_in,\n\t\t\t\t(unsigned long long)stream->total_out,\n\t\t\t\tstream->total_in == 0 ? 0.0 :\n\t\t\t\t(double) stream->total_out / stream->total_in);\n\t\t\tif (state->compression_out_failures == 0)\n\t\t\t\tdeflateEnd(stream);\n\t\t}\n\t\tif (state->compression_in_started) {\n\t\t\tz_streamp stream = &state->compression_in_stream;\n\t\t\tdebug(\"compress incoming: \"\n\t\t\t    \"raw data %llu, compressed %llu, factor %.2f\",\n\t\t\t    (unsigned long long)stream->total_out,\n\t\t\t    (unsigned long long)stream->total_in,\n\t\t\t    stream->total_out == 0 ? 0.0 :\n\t\t\t    (double) stream->total_in / stream->total_out);\n\t\t\tif (state->compression_in_failures == 0)\n\t\t\t\tinflateEnd(stream);\n\t\t}\n\t}\n\tcipher_free(state->send_context);\n\tcipher_free(state->receive_context);\n\tstate->send_context = state->receive_context = NULL;\n\tif (do_close) {\n\t\tfree(ssh->local_ipaddr);\n\t\tssh->local_ipaddr = NULL;\n\t\tfree(ssh->remote_ipaddr);\n\t\tssh->remote_ipaddr = NULL;\n\t\tfree(ssh->state);\n\t\tssh->state = NULL;\n\t}\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\nssh_packet_clear_keys(struct ssh *ssh)\n{\n\tssh_packet_close_internal(ssh, 0);\n}"
  },
  {
    "function_name": "ssh_packet_close",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
    "lines": "646-650",
    "snippet": "void\nssh_packet_close(struct ssh *ssh)\n{\n\tssh_packet_close_internal(ssh, 1);\n}",
    "includes": [
      "#include \"sshbuf.h\"",
      "#include \"ssherr.h\"",
      "#include \"packet.h\"",
      "#include \"ssh.h\"",
      "#include \"channels.h\"",
      "#include \"misc.h\"",
      "#include \"canohost.h\"",
      "#include \"log.h\"",
      "#include \"mac.h\"",
      "#include \"digest.h\"",
      "#include \"kex.h\"",
      "#include \"sshkey.h\"",
      "#include \"cipher.h\"",
      "#include \"ssh2.h\"",
      "#include \"compat.h\"",
      "#include \"crc32.h\"",
      "#include \"xmalloc.h\"",
      "#include <zlib.h>",
      "#  include <openssl/ec.h>",
      "# include <openssl/evp.h>",
      "# include <openssl/bn.h>",
      "#include <time.h>",
      "#include <signal.h>",
      "#include <limits.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <stdarg.h>",
      "#include <netdb.h>",
      "#include <errno.h>",
      "#include <arpa/inet.h>",
      "#include <netinet/ip.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include \"openbsd-compat/sys-queue.h\"",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "ssh_packet_close_internal",
          "args": [
            "ssh",
            "1"
          ],
          "line": 649
        },
        "resolved": true,
        "details": {
          "function_name": "ssh_packet_close_internal",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
          "lines": "581-644",
          "snippet": "static void\nssh_packet_close_internal(struct ssh *ssh, int do_close)\n{\n\tstruct session_state *state = ssh->state;\n\tu_int mode;\n\n\tif (!state->initialized)\n\t\treturn;\n\tstate->initialized = 0;\n\tif (do_close) {\n\t\tif (state->connection_in == state->connection_out) {\n\t\t\tclose(state->connection_out);\n\t\t} else {\n\t\t\tclose(state->connection_in);\n\t\t\tclose(state->connection_out);\n\t\t}\n\t}\n\tsshbuf_free(state->input);\n\tsshbuf_free(state->output);\n\tsshbuf_free(state->outgoing_packet);\n\tsshbuf_free(state->incoming_packet);\n\tfor (mode = 0; mode < MODE_MAX; mode++) {\n\t\tkex_free_newkeys(state->newkeys[mode]);\t/* current keys */\n\t\tstate->newkeys[mode] = NULL;\n\t\tssh_clear_newkeys(ssh, mode);\t\t/* next keys */\n\t}\n\t/* compression state is in shared mem, so we can only release it once */\n\tif (do_close && state->compression_buffer) {\n\t\tsshbuf_free(state->compression_buffer);\n\t\tif (state->compression_out_started) {\n\t\t\tz_streamp stream = &state->compression_out_stream;\n\t\t\tdebug(\"compress outgoing: \"\n\t\t\t    \"raw data %llu, compressed %llu, factor %.2f\",\n\t\t\t\t(unsigned long long)stream->total_in,\n\t\t\t\t(unsigned long long)stream->total_out,\n\t\t\t\tstream->total_in == 0 ? 0.0 :\n\t\t\t\t(double) stream->total_out / stream->total_in);\n\t\t\tif (state->compression_out_failures == 0)\n\t\t\t\tdeflateEnd(stream);\n\t\t}\n\t\tif (state->compression_in_started) {\n\t\t\tz_streamp stream = &state->compression_in_stream;\n\t\t\tdebug(\"compress incoming: \"\n\t\t\t    \"raw data %llu, compressed %llu, factor %.2f\",\n\t\t\t    (unsigned long long)stream->total_out,\n\t\t\t    (unsigned long long)stream->total_in,\n\t\t\t    stream->total_out == 0 ? 0.0 :\n\t\t\t    (double) stream->total_in / stream->total_out);\n\t\t\tif (state->compression_in_failures == 0)\n\t\t\t\tinflateEnd(stream);\n\t\t}\n\t}\n\tcipher_free(state->send_context);\n\tcipher_free(state->receive_context);\n\tstate->send_context = state->receive_context = NULL;\n\tif (do_close) {\n\t\tfree(ssh->local_ipaddr);\n\t\tssh->local_ipaddr = NULL;\n\t\tfree(ssh->remote_ipaddr);\n\t\tssh->remote_ipaddr = NULL;\n\t\tfree(ssh->state);\n\t\tssh->state = NULL;\n\t}\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include \"packet.h\"",
            "#include \"ssh.h\"",
            "#include \"channels.h\"",
            "#include \"misc.h\"",
            "#include \"canohost.h\"",
            "#include \"log.h\"",
            "#include \"mac.h\"",
            "#include \"digest.h\"",
            "#include \"kex.h\"",
            "#include \"sshkey.h\"",
            "#include \"cipher.h\"",
            "#include \"ssh2.h\"",
            "#include \"compat.h\"",
            "#include \"crc32.h\"",
            "#include \"xmalloc.h\"",
            "#include <zlib.h>",
            "#  include <openssl/ec.h>",
            "# include <openssl/evp.h>",
            "# include <openssl/bn.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <limits.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <netdb.h>",
            "#include <errno.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include \"openbsd-compat/sys-queue.h\"",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nstatic void\nssh_packet_close_internal(struct ssh *ssh, int do_close)\n{\n\tstruct session_state *state = ssh->state;\n\tu_int mode;\n\n\tif (!state->initialized)\n\t\treturn;\n\tstate->initialized = 0;\n\tif (do_close) {\n\t\tif (state->connection_in == state->connection_out) {\n\t\t\tclose(state->connection_out);\n\t\t} else {\n\t\t\tclose(state->connection_in);\n\t\t\tclose(state->connection_out);\n\t\t}\n\t}\n\tsshbuf_free(state->input);\n\tsshbuf_free(state->output);\n\tsshbuf_free(state->outgoing_packet);\n\tsshbuf_free(state->incoming_packet);\n\tfor (mode = 0; mode < MODE_MAX; mode++) {\n\t\tkex_free_newkeys(state->newkeys[mode]);\t/* current keys */\n\t\tstate->newkeys[mode] = NULL;\n\t\tssh_clear_newkeys(ssh, mode);\t\t/* next keys */\n\t}\n\t/* compression state is in shared mem, so we can only release it once */\n\tif (do_close && state->compression_buffer) {\n\t\tsshbuf_free(state->compression_buffer);\n\t\tif (state->compression_out_started) {\n\t\t\tz_streamp stream = &state->compression_out_stream;\n\t\t\tdebug(\"compress outgoing: \"\n\t\t\t    \"raw data %llu, compressed %llu, factor %.2f\",\n\t\t\t\t(unsigned long long)stream->total_in,\n\t\t\t\t(unsigned long long)stream->total_out,\n\t\t\t\tstream->total_in == 0 ? 0.0 :\n\t\t\t\t(double) stream->total_out / stream->total_in);\n\t\t\tif (state->compression_out_failures == 0)\n\t\t\t\tdeflateEnd(stream);\n\t\t}\n\t\tif (state->compression_in_started) {\n\t\t\tz_streamp stream = &state->compression_in_stream;\n\t\t\tdebug(\"compress incoming: \"\n\t\t\t    \"raw data %llu, compressed %llu, factor %.2f\",\n\t\t\t    (unsigned long long)stream->total_out,\n\t\t\t    (unsigned long long)stream->total_in,\n\t\t\t    stream->total_out == 0 ? 0.0 :\n\t\t\t    (double) stream->total_in / stream->total_out);\n\t\t\tif (state->compression_in_failures == 0)\n\t\t\t\tinflateEnd(stream);\n\t\t}\n\t}\n\tcipher_free(state->send_context);\n\tcipher_free(state->receive_context);\n\tstate->send_context = state->receive_context = NULL;\n\tif (do_close) {\n\t\tfree(ssh->local_ipaddr);\n\t\tssh->local_ipaddr = NULL;\n\t\tfree(ssh->remote_ipaddr);\n\t\tssh->remote_ipaddr = NULL;\n\t\tfree(ssh->state);\n\t\tssh->state = NULL;\n\t}\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\nssh_packet_close(struct ssh *ssh)\n{\n\tssh_packet_close_internal(ssh, 1);\n}"
  },
  {
    "function_name": "ssh_packet_close_internal",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
    "lines": "581-644",
    "snippet": "static void\nssh_packet_close_internal(struct ssh *ssh, int do_close)\n{\n\tstruct session_state *state = ssh->state;\n\tu_int mode;\n\n\tif (!state->initialized)\n\t\treturn;\n\tstate->initialized = 0;\n\tif (do_close) {\n\t\tif (state->connection_in == state->connection_out) {\n\t\t\tclose(state->connection_out);\n\t\t} else {\n\t\t\tclose(state->connection_in);\n\t\t\tclose(state->connection_out);\n\t\t}\n\t}\n\tsshbuf_free(state->input);\n\tsshbuf_free(state->output);\n\tsshbuf_free(state->outgoing_packet);\n\tsshbuf_free(state->incoming_packet);\n\tfor (mode = 0; mode < MODE_MAX; mode++) {\n\t\tkex_free_newkeys(state->newkeys[mode]);\t/* current keys */\n\t\tstate->newkeys[mode] = NULL;\n\t\tssh_clear_newkeys(ssh, mode);\t\t/* next keys */\n\t}\n\t/* compression state is in shared mem, so we can only release it once */\n\tif (do_close && state->compression_buffer) {\n\t\tsshbuf_free(state->compression_buffer);\n\t\tif (state->compression_out_started) {\n\t\t\tz_streamp stream = &state->compression_out_stream;\n\t\t\tdebug(\"compress outgoing: \"\n\t\t\t    \"raw data %llu, compressed %llu, factor %.2f\",\n\t\t\t\t(unsigned long long)stream->total_in,\n\t\t\t\t(unsigned long long)stream->total_out,\n\t\t\t\tstream->total_in == 0 ? 0.0 :\n\t\t\t\t(double) stream->total_out / stream->total_in);\n\t\t\tif (state->compression_out_failures == 0)\n\t\t\t\tdeflateEnd(stream);\n\t\t}\n\t\tif (state->compression_in_started) {\n\t\t\tz_streamp stream = &state->compression_in_stream;\n\t\t\tdebug(\"compress incoming: \"\n\t\t\t    \"raw data %llu, compressed %llu, factor %.2f\",\n\t\t\t    (unsigned long long)stream->total_out,\n\t\t\t    (unsigned long long)stream->total_in,\n\t\t\t    stream->total_out == 0 ? 0.0 :\n\t\t\t    (double) stream->total_in / stream->total_out);\n\t\t\tif (state->compression_in_failures == 0)\n\t\t\t\tinflateEnd(stream);\n\t\t}\n\t}\n\tcipher_free(state->send_context);\n\tcipher_free(state->receive_context);\n\tstate->send_context = state->receive_context = NULL;\n\tif (do_close) {\n\t\tfree(ssh->local_ipaddr);\n\t\tssh->local_ipaddr = NULL;\n\t\tfree(ssh->remote_ipaddr);\n\t\tssh->remote_ipaddr = NULL;\n\t\tfree(ssh->state);\n\t\tssh->state = NULL;\n\t}\n}",
    "includes": [
      "#include \"sshbuf.h\"",
      "#include \"ssherr.h\"",
      "#include \"packet.h\"",
      "#include \"ssh.h\"",
      "#include \"channels.h\"",
      "#include \"misc.h\"",
      "#include \"canohost.h\"",
      "#include \"log.h\"",
      "#include \"mac.h\"",
      "#include \"digest.h\"",
      "#include \"kex.h\"",
      "#include \"sshkey.h\"",
      "#include \"cipher.h\"",
      "#include \"ssh2.h\"",
      "#include \"compat.h\"",
      "#include \"crc32.h\"",
      "#include \"xmalloc.h\"",
      "#include <zlib.h>",
      "#  include <openssl/ec.h>",
      "# include <openssl/evp.h>",
      "# include <openssl/bn.h>",
      "#include <time.h>",
      "#include <signal.h>",
      "#include <limits.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <stdarg.h>",
      "#include <netdb.h>",
      "#include <errno.h>",
      "#include <arpa/inet.h>",
      "#include <netinet/ip.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include \"openbsd-compat/sys-queue.h\"",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "ssh->state"
          ],
          "line": 641
        },
        "resolved": true,
        "details": {
          "function_name": "freeze",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/smult_curve25519_ref.c",
          "lines": "50-60",
          "snippet": "static void freeze(unsigned int a[32])\n{\n  unsigned int aorig[32];\n  unsigned int j;\n  unsigned int negative;\n\n  for (j = 0;j < 32;++j) aorig[j] = a[j];\n  add(a,a,minusp);\n  negative = -((a[31] >> 7) & 1);\n  for (j = 0;j < 32;++j) a[j] ^= negative & (aorig[j] ^ a[j]);\n}",
          "includes": [],
          "macros_used": [],
          "globals_used": [
            "static const unsigned int minusp[32] = {\n 19, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 128\n} ;"
          ],
          "called_functions": [],
          "contextual_snippet": "static const unsigned int minusp[32] = {\n 19, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 128\n} ;\n\nstatic void freeze(unsigned int a[32])\n{\n  unsigned int aorig[32];\n  unsigned int j;\n  unsigned int negative;\n\n  for (j = 0;j < 32;++j) aorig[j] = a[j];\n  add(a,a,minusp);\n  negative = -((a[31] >> 7) & 1);\n  for (j = 0;j < 32;++j) a[j] ^= negative & (aorig[j] ^ a[j]);\n}"
        }
      },
      {
        "call_info": {
          "callee": "cipher_free",
          "args": [
            "state->receive_context"
          ],
          "line": 634
        },
        "resolved": true,
        "details": {
          "function_name": "cipher_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/cipher.c",
          "lines": "410-425",
          "snippet": "void\ncipher_free(struct sshcipher_ctx *cc)\n{\n\tif (cc == NULL)\n\t\treturn;\n\tif ((cc->cipher->flags & CFLAG_CHACHAPOLY) != 0)\n\t\texplicit_bzero(&cc->cp_ctx, sizeof(cc->cp_ctx));\n\telse if ((cc->cipher->flags & CFLAG_AESCTR) != 0)\n\t\texplicit_bzero(&cc->ac_ctx, sizeof(cc->ac_ctx));\n#ifdef WITH_OPENSSL\n\tEVP_CIPHER_CTX_free(cc->evp);\n\tcc->evp = NULL;\n#endif\n\texplicit_bzero(cc, sizeof(*cc));\n\tfree(cc);\n}",
          "includes": [
            "#include \"openbsd-compat/openssl-compat.h\"",
            "#include \"digest.h\"",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"misc.h\"",
            "#include \"cipher.h\"",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <string.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [
            "#define CFLAG_AESCTR\t\t(1<<2)",
            "#define CFLAG_CHACHAPOLY\t(1<<1)"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"openbsd-compat/openssl-compat.h\"\n#include \"digest.h\"\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"misc.h\"\n#include \"cipher.h\"\n#include <stdio.h>\n#include <stdarg.h>\n#include <string.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\n#define CFLAG_AESCTR\t\t(1<<2)\n#define CFLAG_CHACHAPOLY\t(1<<1)\n\nvoid\ncipher_free(struct sshcipher_ctx *cc)\n{\n\tif (cc == NULL)\n\t\treturn;\n\tif ((cc->cipher->flags & CFLAG_CHACHAPOLY) != 0)\n\t\texplicit_bzero(&cc->cp_ctx, sizeof(cc->cp_ctx));\n\telse if ((cc->cipher->flags & CFLAG_AESCTR) != 0)\n\t\texplicit_bzero(&cc->ac_ctx, sizeof(cc->ac_ctx));\n#ifdef WITH_OPENSSL\n\tEVP_CIPHER_CTX_free(cc->evp);\n\tcc->evp = NULL;\n#endif\n\texplicit_bzero(cc, sizeof(*cc));\n\tfree(cc);\n}"
        }
      },
      {
        "call_info": {
          "callee": "inflateEnd",
          "args": [
            "stream"
          ],
          "line": 630
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug",
          "args": [
            "\"compress incoming: \"\n\t\t\t    \"raw data %llu, compressed %llu, factor %.2f\"",
            "(unsigned long long)stream->total_out",
            "(unsigned long long)stream->total_in",
            "stream->total_out == 0 ? 0.0 :\n\t\t\t    (double) stream->total_in / stream->total_out"
          ],
          "line": 623
        },
        "resolved": true,
        "details": {
          "function_name": "ssh_packet_send_debug",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
          "lines": "1771-1794",
          "snippet": "void\nssh_packet_send_debug(struct ssh *ssh, const char *fmt,...)\n{\n\tchar buf[1024];\n\tva_list args;\n\tint r;\n\n\tif ((ssh->compat & SSH_BUG_DEBUG))\n\t\treturn;\n\n\tva_start(args, fmt);\n\tvsnprintf(buf, sizeof(buf), fmt, args);\n\tva_end(args);\n\n\tdebug3(\"sending debug message: %s\", buf);\n\n\tif ((r = sshpkt_start(ssh, SSH2_MSG_DEBUG)) != 0 ||\n\t    (r = sshpkt_put_u8(ssh, 0)) != 0 || /* always display */\n\t    (r = sshpkt_put_cstring(ssh, buf)) != 0 ||\n\t    (r = sshpkt_put_cstring(ssh, \"\")) != 0 ||\n\t    (r = sshpkt_send(ssh)) != 0 ||\n\t    (r = ssh_packet_write_wait(ssh)) != 0)\n\t\tfatal(\"%s: %s\", __func__, ssh_err(r));\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include \"packet.h\"",
            "#include \"ssh.h\"",
            "#include \"channels.h\"",
            "#include \"misc.h\"",
            "#include \"canohost.h\"",
            "#include \"log.h\"",
            "#include \"mac.h\"",
            "#include \"digest.h\"",
            "#include \"kex.h\"",
            "#include \"sshkey.h\"",
            "#include \"cipher.h\"",
            "#include \"ssh2.h\"",
            "#include \"compat.h\"",
            "#include \"crc32.h\"",
            "#include \"xmalloc.h\"",
            "#include <zlib.h>",
            "#  include <openssl/ec.h>",
            "# include <openssl/evp.h>",
            "# include <openssl/bn.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <limits.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <netdb.h>",
            "#include <errno.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include \"openbsd-compat/sys-queue.h\"",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\nssh_packet_send_debug(struct ssh *ssh, const char *fmt,...)\n{\n\tchar buf[1024];\n\tva_list args;\n\tint r;\n\n\tif ((ssh->compat & SSH_BUG_DEBUG))\n\t\treturn;\n\n\tva_start(args, fmt);\n\tvsnprintf(buf, sizeof(buf), fmt, args);\n\tva_end(args);\n\n\tdebug3(\"sending debug message: %s\", buf);\n\n\tif ((r = sshpkt_start(ssh, SSH2_MSG_DEBUG)) != 0 ||\n\t    (r = sshpkt_put_u8(ssh, 0)) != 0 || /* always display */\n\t    (r = sshpkt_put_cstring(ssh, buf)) != 0 ||\n\t    (r = sshpkt_put_cstring(ssh, \"\")) != 0 ||\n\t    (r = sshpkt_send(ssh)) != 0 ||\n\t    (r = ssh_packet_write_wait(ssh)) != 0)\n\t\tfatal(\"%s: %s\", __func__, ssh_err(r));\n}"
        }
      },
      {
        "call_info": {
          "callee": "deflateEnd",
          "args": [
            "stream"
          ],
          "line": 619
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sshbuf_free",
          "args": [
            "state->compression_buffer"
          ],
          "line": 609
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf.c",
          "lines": "133-166",
          "snippet": "void\nsshbuf_free(struct sshbuf *buf)\n{\n\tif (buf == NULL)\n\t\treturn;\n\t/*\n\t * The following will leak on insane buffers, but this is the safest\n\t * course of action - an invalid pointer or already-freed pointer may\n\t * have been passed to us and continuing to scribble over memory would\n\t * be bad.\n\t */\n\tif (sshbuf_check_sanity(buf) != 0)\n\t\treturn;\n\t/*\n\t * If we are a child, the free our parent to decrement its reference\n\t * count and possibly free it.\n\t */\n\tsshbuf_free(buf->parent);\n\tbuf->parent = NULL;\n\t/*\n\t * If we are a parent with still-extant children, then don't free just\n\t * yet. The last child's call to sshbuf_free should decrement our\n\t * refcount to 0 and trigger the actual free.\n\t */\n\tbuf->refcount--;\n\tif (buf->refcount > 0)\n\t\treturn;\n\tif (!buf->readonly) {\n\t\texplicit_bzero(buf->d, buf->alloc);\n\t\tfree(buf->d);\n\t}\n\texplicit_bzero(buf, sizeof(*buf));\n\tfree(buf);\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <signal.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <signal.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\nsshbuf_free(struct sshbuf *buf)\n{\n\tif (buf == NULL)\n\t\treturn;\n\t/*\n\t * The following will leak on insane buffers, but this is the safest\n\t * course of action - an invalid pointer or already-freed pointer may\n\t * have been passed to us and continuing to scribble over memory would\n\t * be bad.\n\t */\n\tif (sshbuf_check_sanity(buf) != 0)\n\t\treturn;\n\t/*\n\t * If we are a child, the free our parent to decrement its reference\n\t * count and possibly free it.\n\t */\n\tsshbuf_free(buf->parent);\n\tbuf->parent = NULL;\n\t/*\n\t * If we are a parent with still-extant children, then don't free just\n\t * yet. The last child's call to sshbuf_free should decrement our\n\t * refcount to 0 and trigger the actual free.\n\t */\n\tbuf->refcount--;\n\tif (buf->refcount > 0)\n\t\treturn;\n\tif (!buf->readonly) {\n\t\texplicit_bzero(buf->d, buf->alloc);\n\t\tfree(buf->d);\n\t}\n\texplicit_bzero(buf, sizeof(*buf));\n\tfree(buf);\n}"
        }
      },
      {
        "call_info": {
          "callee": "ssh_clear_newkeys",
          "args": [
            "ssh",
            "mode"
          ],
          "line": 605
        },
        "resolved": true,
        "details": {
          "function_name": "ssh_clear_newkeys",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
          "lines": "819-826",
          "snippet": "void\nssh_clear_newkeys(struct ssh *ssh, int mode)\n{\n\tif (ssh->kex && ssh->kex->newkeys[mode]) {\n\t\tkex_free_newkeys(ssh->kex->newkeys[mode]);\n\t\tssh->kex->newkeys[mode] = NULL;\n\t}\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include \"packet.h\"",
            "#include \"ssh.h\"",
            "#include \"channels.h\"",
            "#include \"misc.h\"",
            "#include \"canohost.h\"",
            "#include \"log.h\"",
            "#include \"mac.h\"",
            "#include \"digest.h\"",
            "#include \"kex.h\"",
            "#include \"sshkey.h\"",
            "#include \"cipher.h\"",
            "#include \"ssh2.h\"",
            "#include \"compat.h\"",
            "#include \"crc32.h\"",
            "#include \"xmalloc.h\"",
            "#include <zlib.h>",
            "#  include <openssl/ec.h>",
            "# include <openssl/evp.h>",
            "# include <openssl/bn.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <limits.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <netdb.h>",
            "#include <errno.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include \"openbsd-compat/sys-queue.h\"",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\nssh_clear_newkeys(struct ssh *ssh, int mode)\n{\n\tif (ssh->kex && ssh->kex->newkeys[mode]) {\n\t\tkex_free_newkeys(ssh->kex->newkeys[mode]);\n\t\tssh->kex->newkeys[mode] = NULL;\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "kex_free_newkeys",
          "args": [
            "state->newkeys[mode]"
          ],
          "line": 603
        },
        "resolved": true,
        "details": {
          "function_name": "kex_free_newkeys",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/kex.c",
          "lines": "607-636",
          "snippet": "void\nkex_free_newkeys(struct newkeys *newkeys)\n{\n\tif (newkeys == NULL)\n\t\treturn;\n\tif (newkeys->enc.key) {\n\t\texplicit_bzero(newkeys->enc.key, newkeys->enc.key_len);\n\t\tfree(newkeys->enc.key);\n\t\tnewkeys->enc.key = NULL;\n\t}\n\tif (newkeys->enc.iv) {\n\t\texplicit_bzero(newkeys->enc.iv, newkeys->enc.iv_len);\n\t\tfree(newkeys->enc.iv);\n\t\tnewkeys->enc.iv = NULL;\n\t}\n\tfree(newkeys->enc.name);\n\texplicit_bzero(&newkeys->enc, sizeof(newkeys->enc));\n\tfree(newkeys->comp.name);\n\texplicit_bzero(&newkeys->comp, sizeof(newkeys->comp));\n\tmac_clear(&newkeys->mac);\n\tif (newkeys->mac.key) {\n\t\texplicit_bzero(newkeys->mac.key, newkeys->mac.key_len);\n\t\tfree(newkeys->mac.key);\n\t\tnewkeys->mac.key = NULL;\n\t}\n\tfree(newkeys->mac.name);\n\texplicit_bzero(&newkeys->mac, sizeof(newkeys->mac));\n\texplicit_bzero(newkeys, sizeof(*newkeys));\n\tfree(newkeys);\n}",
          "includes": [
            "#include \"digest.h\"",
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include \"monitor.h\"",
            "#include \"dispatch.h\"",
            "#include \"misc.h\"",
            "#include \"match.h\"",
            "#include \"mac.h\"",
            "#include \"log.h\"",
            "#include \"kex.h\"",
            "#include \"sshkey.h\"",
            "#include \"cipher.h\"",
            "#include \"compat.h\"",
            "#include \"packet.h\"",
            "#include \"ssh2.h\"",
            "#include <openssl/dh.h>",
            "#include <openssl/crypto.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"digest.h\"\n#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"monitor.h\"\n#include \"dispatch.h\"\n#include \"misc.h\"\n#include \"match.h\"\n#include \"mac.h\"\n#include \"log.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"compat.h\"\n#include \"packet.h\"\n#include \"ssh2.h\"\n#include <openssl/dh.h>\n#include <openssl/crypto.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <signal.h>\n#include \"includes.h\"\n\nvoid\nkex_free_newkeys(struct newkeys *newkeys)\n{\n\tif (newkeys == NULL)\n\t\treturn;\n\tif (newkeys->enc.key) {\n\t\texplicit_bzero(newkeys->enc.key, newkeys->enc.key_len);\n\t\tfree(newkeys->enc.key);\n\t\tnewkeys->enc.key = NULL;\n\t}\n\tif (newkeys->enc.iv) {\n\t\texplicit_bzero(newkeys->enc.iv, newkeys->enc.iv_len);\n\t\tfree(newkeys->enc.iv);\n\t\tnewkeys->enc.iv = NULL;\n\t}\n\tfree(newkeys->enc.name);\n\texplicit_bzero(&newkeys->enc, sizeof(newkeys->enc));\n\tfree(newkeys->comp.name);\n\texplicit_bzero(&newkeys->comp, sizeof(newkeys->comp));\n\tmac_clear(&newkeys->mac);\n\tif (newkeys->mac.key) {\n\t\texplicit_bzero(newkeys->mac.key, newkeys->mac.key_len);\n\t\tfree(newkeys->mac.key);\n\t\tnewkeys->mac.key = NULL;\n\t}\n\tfree(newkeys->mac.name);\n\texplicit_bzero(&newkeys->mac, sizeof(newkeys->mac));\n\texplicit_bzero(newkeys, sizeof(*newkeys));\n\tfree(newkeys);\n}"
        }
      },
      {
        "call_info": {
          "callee": "close",
          "args": [
            "state->connection_out"
          ],
          "line": 595
        },
        "resolved": true,
        "details": {
          "function_name": "ssh_packet_close",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
          "lines": "646-650",
          "snippet": "void\nssh_packet_close(struct ssh *ssh)\n{\n\tssh_packet_close_internal(ssh, 1);\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include \"packet.h\"",
            "#include \"ssh.h\"",
            "#include \"channels.h\"",
            "#include \"misc.h\"",
            "#include \"canohost.h\"",
            "#include \"log.h\"",
            "#include \"mac.h\"",
            "#include \"digest.h\"",
            "#include \"kex.h\"",
            "#include \"sshkey.h\"",
            "#include \"cipher.h\"",
            "#include \"ssh2.h\"",
            "#include \"compat.h\"",
            "#include \"crc32.h\"",
            "#include \"xmalloc.h\"",
            "#include <zlib.h>",
            "#  include <openssl/ec.h>",
            "# include <openssl/evp.h>",
            "# include <openssl/bn.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <limits.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <netdb.h>",
            "#include <errno.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include \"openbsd-compat/sys-queue.h\"",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\nssh_packet_close(struct ssh *ssh)\n{\n\tssh_packet_close_internal(ssh, 1);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nstatic void\nssh_packet_close_internal(struct ssh *ssh, int do_close)\n{\n\tstruct session_state *state = ssh->state;\n\tu_int mode;\n\n\tif (!state->initialized)\n\t\treturn;\n\tstate->initialized = 0;\n\tif (do_close) {\n\t\tif (state->connection_in == state->connection_out) {\n\t\t\tclose(state->connection_out);\n\t\t} else {\n\t\t\tclose(state->connection_in);\n\t\t\tclose(state->connection_out);\n\t\t}\n\t}\n\tsshbuf_free(state->input);\n\tsshbuf_free(state->output);\n\tsshbuf_free(state->outgoing_packet);\n\tsshbuf_free(state->incoming_packet);\n\tfor (mode = 0; mode < MODE_MAX; mode++) {\n\t\tkex_free_newkeys(state->newkeys[mode]);\t/* current keys */\n\t\tstate->newkeys[mode] = NULL;\n\t\tssh_clear_newkeys(ssh, mode);\t\t/* next keys */\n\t}\n\t/* compression state is in shared mem, so we can only release it once */\n\tif (do_close && state->compression_buffer) {\n\t\tsshbuf_free(state->compression_buffer);\n\t\tif (state->compression_out_started) {\n\t\t\tz_streamp stream = &state->compression_out_stream;\n\t\t\tdebug(\"compress outgoing: \"\n\t\t\t    \"raw data %llu, compressed %llu, factor %.2f\",\n\t\t\t\t(unsigned long long)stream->total_in,\n\t\t\t\t(unsigned long long)stream->total_out,\n\t\t\t\tstream->total_in == 0 ? 0.0 :\n\t\t\t\t(double) stream->total_out / stream->total_in);\n\t\t\tif (state->compression_out_failures == 0)\n\t\t\t\tdeflateEnd(stream);\n\t\t}\n\t\tif (state->compression_in_started) {\n\t\t\tz_streamp stream = &state->compression_in_stream;\n\t\t\tdebug(\"compress incoming: \"\n\t\t\t    \"raw data %llu, compressed %llu, factor %.2f\",\n\t\t\t    (unsigned long long)stream->total_out,\n\t\t\t    (unsigned long long)stream->total_in,\n\t\t\t    stream->total_out == 0 ? 0.0 :\n\t\t\t    (double) stream->total_in / stream->total_out);\n\t\t\tif (state->compression_in_failures == 0)\n\t\t\t\tinflateEnd(stream);\n\t\t}\n\t}\n\tcipher_free(state->send_context);\n\tcipher_free(state->receive_context);\n\tstate->send_context = state->receive_context = NULL;\n\tif (do_close) {\n\t\tfree(ssh->local_ipaddr);\n\t\tssh->local_ipaddr = NULL;\n\t\tfree(ssh->remote_ipaddr);\n\t\tssh->remote_ipaddr = NULL;\n\t\tfree(ssh->state);\n\t\tssh->state = NULL;\n\t}\n}"
  },
  {
    "function_name": "ssh_packet_rdomain_in",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
    "lines": "568-577",
    "snippet": "const char *\nssh_packet_rdomain_in(struct ssh *ssh)\n{\n\tif (ssh->rdomain_in != NULL)\n\t\treturn ssh->rdomain_in;\n\tif (!ssh_packet_connection_is_on_socket(ssh))\n\t\treturn NULL;\n\tssh->rdomain_in = get_rdomain(ssh->state->connection_in);\n\treturn ssh->rdomain_in;\n}",
    "includes": [
      "#include \"sshbuf.h\"",
      "#include \"ssherr.h\"",
      "#include \"packet.h\"",
      "#include \"ssh.h\"",
      "#include \"channels.h\"",
      "#include \"misc.h\"",
      "#include \"canohost.h\"",
      "#include \"log.h\"",
      "#include \"mac.h\"",
      "#include \"digest.h\"",
      "#include \"kex.h\"",
      "#include \"sshkey.h\"",
      "#include \"cipher.h\"",
      "#include \"ssh2.h\"",
      "#include \"compat.h\"",
      "#include \"crc32.h\"",
      "#include \"xmalloc.h\"",
      "#include <zlib.h>",
      "#  include <openssl/ec.h>",
      "# include <openssl/evp.h>",
      "# include <openssl/bn.h>",
      "#include <time.h>",
      "#include <signal.h>",
      "#include <limits.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <stdarg.h>",
      "#include <netdb.h>",
      "#include <errno.h>",
      "#include <arpa/inet.h>",
      "#include <netinet/ip.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include \"openbsd-compat/sys-queue.h\"",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "get_rdomain",
          "args": [
            "ssh->state->connection_in"
          ],
          "line": 575
        },
        "resolved": true,
        "details": {
          "function_name": "get_rdomain",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/misc.c",
          "lines": "184-204",
          "snippet": "char *\nget_rdomain(int fd)\n{\n#if defined(HAVE_SYS_GET_RDOMAIN)\n\treturn sys_get_rdomain(fd);\n#elif defined(__OpenBSD__)\n\tint rtable;\n\tchar *ret;\n\tsocklen_t len = sizeof(rtable);\n\n\tif (getsockopt(fd, SOL_SOCKET, SO_RTABLE, &rtable, &len) == -1) {\n\t\terror(\"Failed to get routing domain for fd %d: %s\",\n\t\t    fd, strerror(errno));\n\t\treturn NULL;\n\t}\n\txasprintf(&ret, \"%d\", rtable);\n\treturn ret;\n#else /* defined(__OpenBSD__) */\n\treturn NULL;\n#endif\n}",
          "includes": [
            "#include \"platform.h\"",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"ssh.h\"",
            "#include \"log.h\"",
            "#include \"misc.h\"",
            "#include \"xmalloc.h\"",
            "#include <net/if.h>",
            "#include <pwd.h>",
            "# include <paths.h>",
            "#include <netdb.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <ctype.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/tcp.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in_systm.h>",
            "#include <netinet/in.h>",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <libgen.h>",
            "#include <limits.h>",
            "#include <sys/un.h>",
            "#include <sys/wait.h>",
            "#include <sys/time.h>",
            "#include <sys/stat.h>",
            "#include <sys/socket.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"platform.h\"\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"ssh.h\"\n#include \"log.h\"\n#include \"misc.h\"\n#include \"xmalloc.h\"\n#include <net/if.h>\n#include <pwd.h>\n# include <paths.h>\n#include <netdb.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <ctype.h>\n#include <arpa/inet.h>\n#include <netinet/tcp.h>\n#include <netinet/ip.h>\n#include <netinet/in_systm.h>\n#include <netinet/in.h>\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <libgen.h>\n#include <limits.h>\n#include <sys/un.h>\n#include <sys/wait.h>\n#include <sys/time.h>\n#include <sys/stat.h>\n#include <sys/socket.h>\n#include <sys/ioctl.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nchar *\nget_rdomain(int fd)\n{\n#if defined(HAVE_SYS_GET_RDOMAIN)\n\treturn sys_get_rdomain(fd);\n#elif defined(__OpenBSD__)\n\tint rtable;\n\tchar *ret;\n\tsocklen_t len = sizeof(rtable);\n\n\tif (getsockopt(fd, SOL_SOCKET, SO_RTABLE, &rtable, &len) == -1) {\n\t\terror(\"Failed to get routing domain for fd %d: %s\",\n\t\t    fd, strerror(errno));\n\t\treturn NULL;\n\t}\n\txasprintf(&ret, \"%d\", rtable);\n\treturn ret;\n#else /* defined(__OpenBSD__) */\n\treturn NULL;\n#endif\n}"
        }
      },
      {
        "call_info": {
          "callee": "ssh_packet_connection_is_on_socket",
          "args": [
            "ssh"
          ],
          "line": 573
        },
        "resolved": true,
        "details": {
          "function_name": "ssh_packet_connection_is_on_socket",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
          "lines": "421-452",
          "snippet": "int\nssh_packet_connection_is_on_socket(struct ssh *ssh)\n{\n\tstruct session_state *state;\n\tstruct sockaddr_storage from, to;\n\tsocklen_t fromlen, tolen;\n\n\tif (ssh == NULL || ssh->state == NULL)\n\t\treturn 0;\n\n\tstate = ssh->state;\n\tif (state->connection_in == -1 || state->connection_out == -1)\n\t\treturn 0;\n\t/* filedescriptors in and out are the same, so it's a socket */\n\tif (state->connection_in == state->connection_out)\n\t\treturn 1;\n\tfromlen = sizeof(from);\n\tmemset(&from, 0, sizeof(from));\n\tif (getpeername(state->connection_in, (struct sockaddr *)&from,\n\t    &fromlen) < 0)\n\t\treturn 0;\n\ttolen = sizeof(to);\n\tmemset(&to, 0, sizeof(to));\n\tif (getpeername(state->connection_out, (struct sockaddr *)&to,\n\t    &tolen) < 0)\n\t\treturn 0;\n\tif (fromlen != tolen || memcmp(&from, &to, fromlen) != 0)\n\t\treturn 0;\n\tif (from.ss_family != AF_INET && from.ss_family != AF_INET6)\n\t\treturn 0;\n\treturn 1;\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include \"packet.h\"",
            "#include \"ssh.h\"",
            "#include \"channels.h\"",
            "#include \"misc.h\"",
            "#include \"canohost.h\"",
            "#include \"log.h\"",
            "#include \"mac.h\"",
            "#include \"digest.h\"",
            "#include \"kex.h\"",
            "#include \"sshkey.h\"",
            "#include \"cipher.h\"",
            "#include \"ssh2.h\"",
            "#include \"compat.h\"",
            "#include \"crc32.h\"",
            "#include \"xmalloc.h\"",
            "#include <zlib.h>",
            "#  include <openssl/ec.h>",
            "# include <openssl/evp.h>",
            "# include <openssl/bn.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <limits.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <netdb.h>",
            "#include <errno.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include \"openbsd-compat/sys-queue.h\"",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nssh_packet_connection_is_on_socket(struct ssh *ssh)\n{\n\tstruct session_state *state;\n\tstruct sockaddr_storage from, to;\n\tsocklen_t fromlen, tolen;\n\n\tif (ssh == NULL || ssh->state == NULL)\n\t\treturn 0;\n\n\tstate = ssh->state;\n\tif (state->connection_in == -1 || state->connection_out == -1)\n\t\treturn 0;\n\t/* filedescriptors in and out are the same, so it's a socket */\n\tif (state->connection_in == state->connection_out)\n\t\treturn 1;\n\tfromlen = sizeof(from);\n\tmemset(&from, 0, sizeof(from));\n\tif (getpeername(state->connection_in, (struct sockaddr *)&from,\n\t    &fromlen) < 0)\n\t\treturn 0;\n\ttolen = sizeof(to);\n\tmemset(&to, 0, sizeof(to));\n\tif (getpeername(state->connection_out, (struct sockaddr *)&to,\n\t    &tolen) < 0)\n\t\treturn 0;\n\tif (fromlen != tolen || memcmp(&from, &to, fromlen) != 0)\n\t\treturn 0;\n\tif (from.ss_family != AF_INET && from.ss_family != AF_INET6)\n\t\treturn 0;\n\treturn 1;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nconst char *\nssh_packet_rdomain_in(struct ssh *ssh)\n{\n\tif (ssh->rdomain_in != NULL)\n\t\treturn ssh->rdomain_in;\n\tif (!ssh_packet_connection_is_on_socket(ssh))\n\t\treturn NULL;\n\tssh->rdomain_in = get_rdomain(ssh->state->connection_in);\n\treturn ssh->rdomain_in;\n}"
  },
  {
    "function_name": "ssh_local_port",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
    "lines": "560-565",
    "snippet": "int\nssh_local_port(struct ssh *ssh)\n{\n\t(void)ssh_remote_ipaddr(ssh); /* Will lookup and cache. */\n\treturn ssh->local_port;\n}",
    "includes": [
      "#include \"sshbuf.h\"",
      "#include \"ssherr.h\"",
      "#include \"packet.h\"",
      "#include \"ssh.h\"",
      "#include \"channels.h\"",
      "#include \"misc.h\"",
      "#include \"canohost.h\"",
      "#include \"log.h\"",
      "#include \"mac.h\"",
      "#include \"digest.h\"",
      "#include \"kex.h\"",
      "#include \"sshkey.h\"",
      "#include \"cipher.h\"",
      "#include \"ssh2.h\"",
      "#include \"compat.h\"",
      "#include \"crc32.h\"",
      "#include \"xmalloc.h\"",
      "#include <zlib.h>",
      "#  include <openssl/ec.h>",
      "# include <openssl/evp.h>",
      "# include <openssl/bn.h>",
      "#include <time.h>",
      "#include <signal.h>",
      "#include <limits.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <stdarg.h>",
      "#include <netdb.h>",
      "#include <errno.h>",
      "#include <arpa/inet.h>",
      "#include <netinet/ip.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include \"openbsd-compat/sys-queue.h\"",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "ssh_remote_ipaddr",
          "args": [
            "ssh"
          ],
          "line": 563
        },
        "resolved": true,
        "details": {
          "function_name": "ssh_remote_ipaddr",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
          "lines": "514-535",
          "snippet": "const char *\nssh_remote_ipaddr(struct ssh *ssh)\n{\n\tint sock;\n\n\t/* Check whether we have cached the ipaddr. */\n\tif (ssh->remote_ipaddr == NULL) {\n\t\tif (ssh_packet_connection_is_on_socket(ssh)) {\n\t\t\tsock = ssh->state->connection_in;\n\t\t\tssh->remote_ipaddr = get_peer_ipaddr(sock);\n\t\t\tssh->remote_port = get_peer_port(sock);\n\t\t\tssh->local_ipaddr = get_local_ipaddr(sock);\n\t\t\tssh->local_port = get_local_port(sock);\n\t\t} else {\n\t\t\tssh->remote_ipaddr = strdup(\"UNKNOWN\");\n\t\t\tssh->remote_port = 65535;\n\t\t\tssh->local_ipaddr = strdup(\"UNKNOWN\");\n\t\t\tssh->local_port = 65535;\n\t\t}\n\t}\n\treturn ssh->remote_ipaddr;\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include \"packet.h\"",
            "#include \"ssh.h\"",
            "#include \"channels.h\"",
            "#include \"misc.h\"",
            "#include \"canohost.h\"",
            "#include \"log.h\"",
            "#include \"mac.h\"",
            "#include \"digest.h\"",
            "#include \"kex.h\"",
            "#include \"sshkey.h\"",
            "#include \"cipher.h\"",
            "#include \"ssh2.h\"",
            "#include \"compat.h\"",
            "#include \"crc32.h\"",
            "#include \"xmalloc.h\"",
            "#include <zlib.h>",
            "#  include <openssl/ec.h>",
            "# include <openssl/evp.h>",
            "# include <openssl/bn.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <limits.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <netdb.h>",
            "#include <errno.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include \"openbsd-compat/sys-queue.h\"",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nconst char *\nssh_remote_ipaddr(struct ssh *ssh)\n{\n\tint sock;\n\n\t/* Check whether we have cached the ipaddr. */\n\tif (ssh->remote_ipaddr == NULL) {\n\t\tif (ssh_packet_connection_is_on_socket(ssh)) {\n\t\t\tsock = ssh->state->connection_in;\n\t\t\tssh->remote_ipaddr = get_peer_ipaddr(sock);\n\t\t\tssh->remote_port = get_peer_port(sock);\n\t\t\tssh->local_ipaddr = get_local_ipaddr(sock);\n\t\t\tssh->local_port = get_local_port(sock);\n\t\t} else {\n\t\t\tssh->remote_ipaddr = strdup(\"UNKNOWN\");\n\t\t\tssh->remote_port = 65535;\n\t\t\tssh->local_ipaddr = strdup(\"UNKNOWN\");\n\t\t\tssh->local_port = 65535;\n\t\t}\n\t}\n\treturn ssh->remote_ipaddr;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nssh_local_port(struct ssh *ssh)\n{\n\t(void)ssh_remote_ipaddr(ssh); /* Will lookup and cache. */\n\treturn ssh->local_port;\n}"
  },
  {
    "function_name": "ssh_local_ipaddr",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
    "lines": "551-556",
    "snippet": "const char *\nssh_local_ipaddr(struct ssh *ssh)\n{\n\t(void)ssh_remote_ipaddr(ssh); /* Will lookup and cache. */\n\treturn ssh->local_ipaddr;\n}",
    "includes": [
      "#include \"sshbuf.h\"",
      "#include \"ssherr.h\"",
      "#include \"packet.h\"",
      "#include \"ssh.h\"",
      "#include \"channels.h\"",
      "#include \"misc.h\"",
      "#include \"canohost.h\"",
      "#include \"log.h\"",
      "#include \"mac.h\"",
      "#include \"digest.h\"",
      "#include \"kex.h\"",
      "#include \"sshkey.h\"",
      "#include \"cipher.h\"",
      "#include \"ssh2.h\"",
      "#include \"compat.h\"",
      "#include \"crc32.h\"",
      "#include \"xmalloc.h\"",
      "#include <zlib.h>",
      "#  include <openssl/ec.h>",
      "# include <openssl/evp.h>",
      "# include <openssl/bn.h>",
      "#include <time.h>",
      "#include <signal.h>",
      "#include <limits.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <stdarg.h>",
      "#include <netdb.h>",
      "#include <errno.h>",
      "#include <arpa/inet.h>",
      "#include <netinet/ip.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include \"openbsd-compat/sys-queue.h\"",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "ssh_remote_ipaddr",
          "args": [
            "ssh"
          ],
          "line": 554
        },
        "resolved": true,
        "details": {
          "function_name": "ssh_remote_ipaddr",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
          "lines": "514-535",
          "snippet": "const char *\nssh_remote_ipaddr(struct ssh *ssh)\n{\n\tint sock;\n\n\t/* Check whether we have cached the ipaddr. */\n\tif (ssh->remote_ipaddr == NULL) {\n\t\tif (ssh_packet_connection_is_on_socket(ssh)) {\n\t\t\tsock = ssh->state->connection_in;\n\t\t\tssh->remote_ipaddr = get_peer_ipaddr(sock);\n\t\t\tssh->remote_port = get_peer_port(sock);\n\t\t\tssh->local_ipaddr = get_local_ipaddr(sock);\n\t\t\tssh->local_port = get_local_port(sock);\n\t\t} else {\n\t\t\tssh->remote_ipaddr = strdup(\"UNKNOWN\");\n\t\t\tssh->remote_port = 65535;\n\t\t\tssh->local_ipaddr = strdup(\"UNKNOWN\");\n\t\t\tssh->local_port = 65535;\n\t\t}\n\t}\n\treturn ssh->remote_ipaddr;\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include \"packet.h\"",
            "#include \"ssh.h\"",
            "#include \"channels.h\"",
            "#include \"misc.h\"",
            "#include \"canohost.h\"",
            "#include \"log.h\"",
            "#include \"mac.h\"",
            "#include \"digest.h\"",
            "#include \"kex.h\"",
            "#include \"sshkey.h\"",
            "#include \"cipher.h\"",
            "#include \"ssh2.h\"",
            "#include \"compat.h\"",
            "#include \"crc32.h\"",
            "#include \"xmalloc.h\"",
            "#include <zlib.h>",
            "#  include <openssl/ec.h>",
            "# include <openssl/evp.h>",
            "# include <openssl/bn.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <limits.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <netdb.h>",
            "#include <errno.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include \"openbsd-compat/sys-queue.h\"",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nconst char *\nssh_remote_ipaddr(struct ssh *ssh)\n{\n\tint sock;\n\n\t/* Check whether we have cached the ipaddr. */\n\tif (ssh->remote_ipaddr == NULL) {\n\t\tif (ssh_packet_connection_is_on_socket(ssh)) {\n\t\t\tsock = ssh->state->connection_in;\n\t\t\tssh->remote_ipaddr = get_peer_ipaddr(sock);\n\t\t\tssh->remote_port = get_peer_port(sock);\n\t\t\tssh->local_ipaddr = get_local_ipaddr(sock);\n\t\t\tssh->local_port = get_local_port(sock);\n\t\t} else {\n\t\t\tssh->remote_ipaddr = strdup(\"UNKNOWN\");\n\t\t\tssh->remote_port = 65535;\n\t\t\tssh->local_ipaddr = strdup(\"UNKNOWN\");\n\t\t\tssh->local_port = 65535;\n\t\t}\n\t}\n\treturn ssh->remote_ipaddr;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nconst char *\nssh_local_ipaddr(struct ssh *ssh)\n{\n\t(void)ssh_remote_ipaddr(ssh); /* Will lookup and cache. */\n\treturn ssh->local_ipaddr;\n}"
  },
  {
    "function_name": "ssh_remote_port",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
    "lines": "539-544",
    "snippet": "int\nssh_remote_port(struct ssh *ssh)\n{\n\t(void)ssh_remote_ipaddr(ssh); /* Will lookup and cache. */\n\treturn ssh->remote_port;\n}",
    "includes": [
      "#include \"sshbuf.h\"",
      "#include \"ssherr.h\"",
      "#include \"packet.h\"",
      "#include \"ssh.h\"",
      "#include \"channels.h\"",
      "#include \"misc.h\"",
      "#include \"canohost.h\"",
      "#include \"log.h\"",
      "#include \"mac.h\"",
      "#include \"digest.h\"",
      "#include \"kex.h\"",
      "#include \"sshkey.h\"",
      "#include \"cipher.h\"",
      "#include \"ssh2.h\"",
      "#include \"compat.h\"",
      "#include \"crc32.h\"",
      "#include \"xmalloc.h\"",
      "#include <zlib.h>",
      "#  include <openssl/ec.h>",
      "# include <openssl/evp.h>",
      "# include <openssl/bn.h>",
      "#include <time.h>",
      "#include <signal.h>",
      "#include <limits.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <stdarg.h>",
      "#include <netdb.h>",
      "#include <errno.h>",
      "#include <arpa/inet.h>",
      "#include <netinet/ip.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include \"openbsd-compat/sys-queue.h\"",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "ssh_remote_ipaddr",
          "args": [
            "ssh"
          ],
          "line": 542
        },
        "resolved": true,
        "details": {
          "function_name": "ssh_remote_ipaddr",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
          "lines": "514-535",
          "snippet": "const char *\nssh_remote_ipaddr(struct ssh *ssh)\n{\n\tint sock;\n\n\t/* Check whether we have cached the ipaddr. */\n\tif (ssh->remote_ipaddr == NULL) {\n\t\tif (ssh_packet_connection_is_on_socket(ssh)) {\n\t\t\tsock = ssh->state->connection_in;\n\t\t\tssh->remote_ipaddr = get_peer_ipaddr(sock);\n\t\t\tssh->remote_port = get_peer_port(sock);\n\t\t\tssh->local_ipaddr = get_local_ipaddr(sock);\n\t\t\tssh->local_port = get_local_port(sock);\n\t\t} else {\n\t\t\tssh->remote_ipaddr = strdup(\"UNKNOWN\");\n\t\t\tssh->remote_port = 65535;\n\t\t\tssh->local_ipaddr = strdup(\"UNKNOWN\");\n\t\t\tssh->local_port = 65535;\n\t\t}\n\t}\n\treturn ssh->remote_ipaddr;\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include \"packet.h\"",
            "#include \"ssh.h\"",
            "#include \"channels.h\"",
            "#include \"misc.h\"",
            "#include \"canohost.h\"",
            "#include \"log.h\"",
            "#include \"mac.h\"",
            "#include \"digest.h\"",
            "#include \"kex.h\"",
            "#include \"sshkey.h\"",
            "#include \"cipher.h\"",
            "#include \"ssh2.h\"",
            "#include \"compat.h\"",
            "#include \"crc32.h\"",
            "#include \"xmalloc.h\"",
            "#include <zlib.h>",
            "#  include <openssl/ec.h>",
            "# include <openssl/evp.h>",
            "# include <openssl/bn.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <limits.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <netdb.h>",
            "#include <errno.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include \"openbsd-compat/sys-queue.h\"",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nconst char *\nssh_remote_ipaddr(struct ssh *ssh)\n{\n\tint sock;\n\n\t/* Check whether we have cached the ipaddr. */\n\tif (ssh->remote_ipaddr == NULL) {\n\t\tif (ssh_packet_connection_is_on_socket(ssh)) {\n\t\t\tsock = ssh->state->connection_in;\n\t\t\tssh->remote_ipaddr = get_peer_ipaddr(sock);\n\t\t\tssh->remote_port = get_peer_port(sock);\n\t\t\tssh->local_ipaddr = get_local_ipaddr(sock);\n\t\t\tssh->local_port = get_local_port(sock);\n\t\t} else {\n\t\t\tssh->remote_ipaddr = strdup(\"UNKNOWN\");\n\t\t\tssh->remote_port = 65535;\n\t\t\tssh->local_ipaddr = strdup(\"UNKNOWN\");\n\t\t\tssh->local_port = 65535;\n\t\t}\n\t}\n\treturn ssh->remote_ipaddr;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nssh_remote_port(struct ssh *ssh)\n{\n\t(void)ssh_remote_ipaddr(ssh); /* Will lookup and cache. */\n\treturn ssh->remote_port;\n}"
  },
  {
    "function_name": "ssh_remote_ipaddr",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
    "lines": "514-535",
    "snippet": "const char *\nssh_remote_ipaddr(struct ssh *ssh)\n{\n\tint sock;\n\n\t/* Check whether we have cached the ipaddr. */\n\tif (ssh->remote_ipaddr == NULL) {\n\t\tif (ssh_packet_connection_is_on_socket(ssh)) {\n\t\t\tsock = ssh->state->connection_in;\n\t\t\tssh->remote_ipaddr = get_peer_ipaddr(sock);\n\t\t\tssh->remote_port = get_peer_port(sock);\n\t\t\tssh->local_ipaddr = get_local_ipaddr(sock);\n\t\t\tssh->local_port = get_local_port(sock);\n\t\t} else {\n\t\t\tssh->remote_ipaddr = strdup(\"UNKNOWN\");\n\t\t\tssh->remote_port = 65535;\n\t\t\tssh->local_ipaddr = strdup(\"UNKNOWN\");\n\t\t\tssh->local_port = 65535;\n\t\t}\n\t}\n\treturn ssh->remote_ipaddr;\n}",
    "includes": [
      "#include \"sshbuf.h\"",
      "#include \"ssherr.h\"",
      "#include \"packet.h\"",
      "#include \"ssh.h\"",
      "#include \"channels.h\"",
      "#include \"misc.h\"",
      "#include \"canohost.h\"",
      "#include \"log.h\"",
      "#include \"mac.h\"",
      "#include \"digest.h\"",
      "#include \"kex.h\"",
      "#include \"sshkey.h\"",
      "#include \"cipher.h\"",
      "#include \"ssh2.h\"",
      "#include \"compat.h\"",
      "#include \"crc32.h\"",
      "#include \"xmalloc.h\"",
      "#include <zlib.h>",
      "#  include <openssl/ec.h>",
      "# include <openssl/evp.h>",
      "# include <openssl/bn.h>",
      "#include <time.h>",
      "#include <signal.h>",
      "#include <limits.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <stdarg.h>",
      "#include <netdb.h>",
      "#include <errno.h>",
      "#include <arpa/inet.h>",
      "#include <netinet/ip.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include \"openbsd-compat/sys-queue.h\"",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "strdup",
          "args": [
            "\"UNKNOWN\""
          ],
          "line": 530
        },
        "resolved": true,
        "details": {
          "function_name": "xstrdup",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/xmalloc.c",
          "lines": "92-102",
          "snippet": "char *\nxstrdup(const char *str)\n{\n\tsize_t len;\n\tchar *cp;\n\n\tlen = strlen(str) + 1;\n\tcp = xmalloc(len);\n\tstrlcpy(cp, str, len);\n\treturn cp;\n}",
          "includes": [
            "#include \"log.h\"",
            "#include \"xmalloc.h\"",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdint.h>",
            "#include <stdarg.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n#include \"xmalloc.h\"\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdint.h>\n#include <stdarg.h>\n#include \"includes.h\"\n\nchar *\nxstrdup(const char *str)\n{\n\tsize_t len;\n\tchar *cp;\n\n\tlen = strlen(str) + 1;\n\tcp = xmalloc(len);\n\tstrlcpy(cp, str, len);\n\treturn cp;\n}"
        }
      },
      {
        "call_info": {
          "callee": "get_local_port",
          "args": [
            "sock"
          ],
          "line": 526
        },
        "resolved": true,
        "details": {
          "function_name": "get_local_port",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/canohost.c",
          "lines": "200-204",
          "snippet": "int\nget_local_port(int sock)\n{\n\treturn get_sock_port(sock, 1);\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include \"canohost.h\"",
            "#include \"log.h\"",
            "#include \"packet.h\"",
            "#include \"xmalloc.h\"",
            "#include <unistd.h>",
            "#include <stdarg.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <netdb.h>",
            "#include <errno.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/in.h>",
            "#include <sys/un.h>",
            "#include <sys/socket.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"packet.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <stdarg.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/in.h>\n#include <sys/un.h>\n#include <sys/socket.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nget_local_port(int sock)\n{\n\treturn get_sock_port(sock, 1);\n}"
        }
      },
      {
        "call_info": {
          "callee": "get_local_ipaddr",
          "args": [
            "sock"
          ],
          "line": 525
        },
        "resolved": true,
        "details": {
          "function_name": "get_local_ipaddr",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/canohost.c",
          "lines": "123-131",
          "snippet": "char *\nget_local_ipaddr(int sock)\n{\n\tchar *p;\n\n\tif ((p = get_socket_address(sock, 0, NI_NUMERICHOST)) != NULL)\n\t\treturn p;\n\treturn xstrdup(\"UNKNOWN\");\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include \"canohost.h\"",
            "#include \"log.h\"",
            "#include \"packet.h\"",
            "#include \"xmalloc.h\"",
            "#include <unistd.h>",
            "#include <stdarg.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <netdb.h>",
            "#include <errno.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/in.h>",
            "#include <sys/un.h>",
            "#include <sys/socket.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"packet.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <stdarg.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/in.h>\n#include <sys/un.h>\n#include <sys/socket.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nchar *\nget_local_ipaddr(int sock)\n{\n\tchar *p;\n\n\tif ((p = get_socket_address(sock, 0, NI_NUMERICHOST)) != NULL)\n\t\treturn p;\n\treturn xstrdup(\"UNKNOWN\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "get_peer_port",
          "args": [
            "sock"
          ],
          "line": 524
        },
        "resolved": true,
        "details": {
          "function_name": "get_peer_port",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/canohost.c",
          "lines": "194-198",
          "snippet": "int\nget_peer_port(int sock)\n{\n\treturn get_sock_port(sock, 0);\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include \"canohost.h\"",
            "#include \"log.h\"",
            "#include \"packet.h\"",
            "#include \"xmalloc.h\"",
            "#include <unistd.h>",
            "#include <stdarg.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <netdb.h>",
            "#include <errno.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/in.h>",
            "#include <sys/un.h>",
            "#include <sys/socket.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"packet.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <stdarg.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/in.h>\n#include <sys/un.h>\n#include <sys/socket.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nget_peer_port(int sock)\n{\n\treturn get_sock_port(sock, 0);\n}"
        }
      },
      {
        "call_info": {
          "callee": "get_peer_ipaddr",
          "args": [
            "sock"
          ],
          "line": 523
        },
        "resolved": true,
        "details": {
          "function_name": "get_peer_ipaddr",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/canohost.c",
          "lines": "113-121",
          "snippet": "char *\nget_peer_ipaddr(int sock)\n{\n\tchar *p;\n\n\tif ((p = get_socket_address(sock, 1, NI_NUMERICHOST)) != NULL)\n\t\treturn p;\n\treturn xstrdup(\"UNKNOWN\");\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include \"canohost.h\"",
            "#include \"log.h\"",
            "#include \"packet.h\"",
            "#include \"xmalloc.h\"",
            "#include <unistd.h>",
            "#include <stdarg.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <netdb.h>",
            "#include <errno.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/in.h>",
            "#include <sys/un.h>",
            "#include <sys/socket.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"packet.h\"\n#include \"xmalloc.h\"\n#include <unistd.h>\n#include <stdarg.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/in.h>\n#include <sys/un.h>\n#include <sys/socket.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nchar *\nget_peer_ipaddr(int sock)\n{\n\tchar *p;\n\n\tif ((p = get_socket_address(sock, 1, NI_NUMERICHOST)) != NULL)\n\t\treturn p;\n\treturn xstrdup(\"UNKNOWN\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "ssh_packet_connection_is_on_socket",
          "args": [
            "ssh"
          ],
          "line": 521
        },
        "resolved": true,
        "details": {
          "function_name": "ssh_packet_connection_is_on_socket",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
          "lines": "421-452",
          "snippet": "int\nssh_packet_connection_is_on_socket(struct ssh *ssh)\n{\n\tstruct session_state *state;\n\tstruct sockaddr_storage from, to;\n\tsocklen_t fromlen, tolen;\n\n\tif (ssh == NULL || ssh->state == NULL)\n\t\treturn 0;\n\n\tstate = ssh->state;\n\tif (state->connection_in == -1 || state->connection_out == -1)\n\t\treturn 0;\n\t/* filedescriptors in and out are the same, so it's a socket */\n\tif (state->connection_in == state->connection_out)\n\t\treturn 1;\n\tfromlen = sizeof(from);\n\tmemset(&from, 0, sizeof(from));\n\tif (getpeername(state->connection_in, (struct sockaddr *)&from,\n\t    &fromlen) < 0)\n\t\treturn 0;\n\ttolen = sizeof(to);\n\tmemset(&to, 0, sizeof(to));\n\tif (getpeername(state->connection_out, (struct sockaddr *)&to,\n\t    &tolen) < 0)\n\t\treturn 0;\n\tif (fromlen != tolen || memcmp(&from, &to, fromlen) != 0)\n\t\treturn 0;\n\tif (from.ss_family != AF_INET && from.ss_family != AF_INET6)\n\t\treturn 0;\n\treturn 1;\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include \"packet.h\"",
            "#include \"ssh.h\"",
            "#include \"channels.h\"",
            "#include \"misc.h\"",
            "#include \"canohost.h\"",
            "#include \"log.h\"",
            "#include \"mac.h\"",
            "#include \"digest.h\"",
            "#include \"kex.h\"",
            "#include \"sshkey.h\"",
            "#include \"cipher.h\"",
            "#include \"ssh2.h\"",
            "#include \"compat.h\"",
            "#include \"crc32.h\"",
            "#include \"xmalloc.h\"",
            "#include <zlib.h>",
            "#  include <openssl/ec.h>",
            "# include <openssl/evp.h>",
            "# include <openssl/bn.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <limits.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <netdb.h>",
            "#include <errno.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include \"openbsd-compat/sys-queue.h\"",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nssh_packet_connection_is_on_socket(struct ssh *ssh)\n{\n\tstruct session_state *state;\n\tstruct sockaddr_storage from, to;\n\tsocklen_t fromlen, tolen;\n\n\tif (ssh == NULL || ssh->state == NULL)\n\t\treturn 0;\n\n\tstate = ssh->state;\n\tif (state->connection_in == -1 || state->connection_out == -1)\n\t\treturn 0;\n\t/* filedescriptors in and out are the same, so it's a socket */\n\tif (state->connection_in == state->connection_out)\n\t\treturn 1;\n\tfromlen = sizeof(from);\n\tmemset(&from, 0, sizeof(from));\n\tif (getpeername(state->connection_in, (struct sockaddr *)&from,\n\t    &fromlen) < 0)\n\t\treturn 0;\n\ttolen = sizeof(to);\n\tmemset(&to, 0, sizeof(to));\n\tif (getpeername(state->connection_out, (struct sockaddr *)&to,\n\t    &tolen) < 0)\n\t\treturn 0;\n\tif (fromlen != tolen || memcmp(&from, &to, fromlen) != 0)\n\t\treturn 0;\n\tif (from.ss_family != AF_INET && from.ss_family != AF_INET6)\n\t\treturn 0;\n\treturn 1;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nconst char *\nssh_remote_ipaddr(struct ssh *ssh)\n{\n\tint sock;\n\n\t/* Check whether we have cached the ipaddr. */\n\tif (ssh->remote_ipaddr == NULL) {\n\t\tif (ssh_packet_connection_is_on_socket(ssh)) {\n\t\t\tsock = ssh->state->connection_in;\n\t\t\tssh->remote_ipaddr = get_peer_ipaddr(sock);\n\t\t\tssh->remote_port = get_peer_port(sock);\n\t\t\tssh->local_ipaddr = get_local_ipaddr(sock);\n\t\t\tssh->local_port = get_local_port(sock);\n\t\t} else {\n\t\t\tssh->remote_ipaddr = strdup(\"UNKNOWN\");\n\t\t\tssh->remote_port = 65535;\n\t\t\tssh->local_ipaddr = strdup(\"UNKNOWN\");\n\t\t\tssh->local_port = 65535;\n\t\t}\n\t}\n\treturn ssh->remote_ipaddr;\n}"
  },
  {
    "function_name": "ssh_packet_get_connection_out",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
    "lines": "503-507",
    "snippet": "int\nssh_packet_get_connection_out(struct ssh *ssh)\n{\n\treturn ssh->state->connection_out;\n}",
    "includes": [
      "#include \"sshbuf.h\"",
      "#include \"ssherr.h\"",
      "#include \"packet.h\"",
      "#include \"ssh.h\"",
      "#include \"channels.h\"",
      "#include \"misc.h\"",
      "#include \"canohost.h\"",
      "#include \"log.h\"",
      "#include \"mac.h\"",
      "#include \"digest.h\"",
      "#include \"kex.h\"",
      "#include \"sshkey.h\"",
      "#include \"cipher.h\"",
      "#include \"ssh2.h\"",
      "#include \"compat.h\"",
      "#include \"crc32.h\"",
      "#include \"xmalloc.h\"",
      "#include <zlib.h>",
      "#  include <openssl/ec.h>",
      "# include <openssl/evp.h>",
      "# include <openssl/bn.h>",
      "#include <time.h>",
      "#include <signal.h>",
      "#include <limits.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <stdarg.h>",
      "#include <netdb.h>",
      "#include <errno.h>",
      "#include <arpa/inet.h>",
      "#include <netinet/ip.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include \"openbsd-compat/sys-queue.h\"",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nssh_packet_get_connection_out(struct ssh *ssh)\n{\n\treturn ssh->state->connection_out;\n}"
  },
  {
    "function_name": "ssh_packet_get_connection_in",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
    "lines": "495-499",
    "snippet": "int\nssh_packet_get_connection_in(struct ssh *ssh)\n{\n\treturn ssh->state->connection_in;\n}",
    "includes": [
      "#include \"sshbuf.h\"",
      "#include \"ssherr.h\"",
      "#include \"packet.h\"",
      "#include \"ssh.h\"",
      "#include \"channels.h\"",
      "#include \"misc.h\"",
      "#include \"canohost.h\"",
      "#include \"log.h\"",
      "#include \"mac.h\"",
      "#include \"digest.h\"",
      "#include \"kex.h\"",
      "#include \"sshkey.h\"",
      "#include \"cipher.h\"",
      "#include \"ssh2.h\"",
      "#include \"compat.h\"",
      "#include \"crc32.h\"",
      "#include \"xmalloc.h\"",
      "#include <zlib.h>",
      "#  include <openssl/ec.h>",
      "# include <openssl/evp.h>",
      "# include <openssl/bn.h>",
      "#include <time.h>",
      "#include <signal.h>",
      "#include <limits.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <stdarg.h>",
      "#include <netdb.h>",
      "#include <errno.h>",
      "#include <arpa/inet.h>",
      "#include <netinet/ip.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include \"openbsd-compat/sys-queue.h\"",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nssh_packet_get_connection_in(struct ssh *ssh)\n{\n\treturn ssh->state->connection_in;\n}"
  },
  {
    "function_name": "ssh_packet_set_nonblocking",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
    "lines": "483-491",
    "snippet": "void\nssh_packet_set_nonblocking(struct ssh *ssh)\n{\n\t/* Set the socket into non-blocking mode. */\n\tset_nonblock(ssh->state->connection_in);\n\n\tif (ssh->state->connection_out != ssh->state->connection_in)\n\t\tset_nonblock(ssh->state->connection_out);\n}",
    "includes": [
      "#include \"sshbuf.h\"",
      "#include \"ssherr.h\"",
      "#include \"packet.h\"",
      "#include \"ssh.h\"",
      "#include \"channels.h\"",
      "#include \"misc.h\"",
      "#include \"canohost.h\"",
      "#include \"log.h\"",
      "#include \"mac.h\"",
      "#include \"digest.h\"",
      "#include \"kex.h\"",
      "#include \"sshkey.h\"",
      "#include \"cipher.h\"",
      "#include \"ssh2.h\"",
      "#include \"compat.h\"",
      "#include \"crc32.h\"",
      "#include \"xmalloc.h\"",
      "#include <zlib.h>",
      "#  include <openssl/ec.h>",
      "# include <openssl/evp.h>",
      "# include <openssl/bn.h>",
      "#include <time.h>",
      "#include <signal.h>",
      "#include <limits.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <stdarg.h>",
      "#include <netdb.h>",
      "#include <errno.h>",
      "#include <arpa/inet.h>",
      "#include <netinet/ip.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include \"openbsd-compat/sys-queue.h\"",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "set_nonblock",
          "args": [
            "ssh->state->connection_out"
          ],
          "line": 490
        },
        "resolved": true,
        "details": {
          "function_name": "ssh_packet_set_nonblocking",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
          "lines": "483-491",
          "snippet": "void\nssh_packet_set_nonblocking(struct ssh *ssh)\n{\n\t/* Set the socket into non-blocking mode. */\n\tset_nonblock(ssh->state->connection_in);\n\n\tif (ssh->state->connection_out != ssh->state->connection_in)\n\t\tset_nonblock(ssh->state->connection_out);\n}",
          "note": "cyclic_reference_detected"
        }
      }
    ],
    "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\nssh_packet_set_nonblocking(struct ssh *ssh)\n{\n\t/* Set the socket into non-blocking mode. */\n\tset_nonblock(ssh->state->connection_in);\n\n\tif (ssh->state->connection_out != ssh->state->connection_in)\n\t\tset_nonblock(ssh->state->connection_out);\n}"
  },
  {
    "function_name": "ssh_packet_connection_af",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
    "lines": "463-479",
    "snippet": "int\nssh_packet_connection_af(struct ssh *ssh)\n{\n\tstruct sockaddr_storage to;\n\tsocklen_t tolen = sizeof(to);\n\n\tmemset(&to, 0, sizeof(to));\n\tif (getsockname(ssh->state->connection_out, (struct sockaddr *)&to,\n\t    &tolen) < 0)\n\t\treturn 0;\n#ifdef IPV4_IN_IPV6\n\tif (to.ss_family == AF_INET6 &&\n\t    IN6_IS_ADDR_V4MAPPED(&((struct sockaddr_in6 *)&to)->sin6_addr))\n\t\treturn AF_INET;\n#endif\n\treturn to.ss_family;\n}",
    "includes": [
      "#include \"sshbuf.h\"",
      "#include \"ssherr.h\"",
      "#include \"packet.h\"",
      "#include \"ssh.h\"",
      "#include \"channels.h\"",
      "#include \"misc.h\"",
      "#include \"canohost.h\"",
      "#include \"log.h\"",
      "#include \"mac.h\"",
      "#include \"digest.h\"",
      "#include \"kex.h\"",
      "#include \"sshkey.h\"",
      "#include \"cipher.h\"",
      "#include \"ssh2.h\"",
      "#include \"compat.h\"",
      "#include \"crc32.h\"",
      "#include \"xmalloc.h\"",
      "#include <zlib.h>",
      "#  include <openssl/ec.h>",
      "# include <openssl/evp.h>",
      "# include <openssl/bn.h>",
      "#include <time.h>",
      "#include <signal.h>",
      "#include <limits.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <stdarg.h>",
      "#include <netdb.h>",
      "#include <errno.h>",
      "#include <arpa/inet.h>",
      "#include <netinet/ip.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include \"openbsd-compat/sys-queue.h\"",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "IN6_IS_ADDR_V4MAPPED",
          "args": [
            "&((struct sockaddr_in6 *)&to)->sin6_addr"
          ],
          "line": 475
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "getsockname",
          "args": [
            "ssh->state->connection_out",
            "(struct sockaddr *)&to",
            "&tolen"
          ],
          "line": 470
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memset",
          "args": [
            "&to",
            "0",
            "sizeof(to)"
          ],
          "line": 469
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nssh_packet_connection_af(struct ssh *ssh)\n{\n\tstruct sockaddr_storage to;\n\tsocklen_t tolen = sizeof(to);\n\n\tmemset(&to, 0, sizeof(to));\n\tif (getsockname(ssh->state->connection_out, (struct sockaddr *)&to,\n\t    &tolen) < 0)\n\t\treturn 0;\n#ifdef IPV4_IN_IPV6\n\tif (to.ss_family == AF_INET6 &&\n\t    IN6_IS_ADDR_V4MAPPED(&((struct sockaddr_in6 *)&to)->sin6_addr))\n\t\treturn AF_INET;\n#endif\n\treturn to.ss_family;\n}"
  },
  {
    "function_name": "ssh_packet_get_bytes",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
    "lines": "454-461",
    "snippet": "void\nssh_packet_get_bytes(struct ssh *ssh, u_int64_t *ibytes, u_int64_t *obytes)\n{\n\tif (ibytes)\n\t\t*ibytes = ssh->state->p_read.bytes;\n\tif (obytes)\n\t\t*obytes = ssh->state->p_send.bytes;\n}",
    "includes": [
      "#include \"sshbuf.h\"",
      "#include \"ssherr.h\"",
      "#include \"packet.h\"",
      "#include \"ssh.h\"",
      "#include \"channels.h\"",
      "#include \"misc.h\"",
      "#include \"canohost.h\"",
      "#include \"log.h\"",
      "#include \"mac.h\"",
      "#include \"digest.h\"",
      "#include \"kex.h\"",
      "#include \"sshkey.h\"",
      "#include \"cipher.h\"",
      "#include \"ssh2.h\"",
      "#include \"compat.h\"",
      "#include \"crc32.h\"",
      "#include \"xmalloc.h\"",
      "#include <zlib.h>",
      "#  include <openssl/ec.h>",
      "# include <openssl/evp.h>",
      "# include <openssl/bn.h>",
      "#include <time.h>",
      "#include <signal.h>",
      "#include <limits.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <stdarg.h>",
      "#include <netdb.h>",
      "#include <errno.h>",
      "#include <arpa/inet.h>",
      "#include <netinet/ip.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include \"openbsd-compat/sys-queue.h\"",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\nssh_packet_get_bytes(struct ssh *ssh, u_int64_t *ibytes, u_int64_t *obytes)\n{\n\tif (ibytes)\n\t\t*ibytes = ssh->state->p_read.bytes;\n\tif (obytes)\n\t\t*obytes = ssh->state->p_send.bytes;\n}"
  },
  {
    "function_name": "ssh_packet_connection_is_on_socket",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
    "lines": "421-452",
    "snippet": "int\nssh_packet_connection_is_on_socket(struct ssh *ssh)\n{\n\tstruct session_state *state;\n\tstruct sockaddr_storage from, to;\n\tsocklen_t fromlen, tolen;\n\n\tif (ssh == NULL || ssh->state == NULL)\n\t\treturn 0;\n\n\tstate = ssh->state;\n\tif (state->connection_in == -1 || state->connection_out == -1)\n\t\treturn 0;\n\t/* filedescriptors in and out are the same, so it's a socket */\n\tif (state->connection_in == state->connection_out)\n\t\treturn 1;\n\tfromlen = sizeof(from);\n\tmemset(&from, 0, sizeof(from));\n\tif (getpeername(state->connection_in, (struct sockaddr *)&from,\n\t    &fromlen) < 0)\n\t\treturn 0;\n\ttolen = sizeof(to);\n\tmemset(&to, 0, sizeof(to));\n\tif (getpeername(state->connection_out, (struct sockaddr *)&to,\n\t    &tolen) < 0)\n\t\treturn 0;\n\tif (fromlen != tolen || memcmp(&from, &to, fromlen) != 0)\n\t\treturn 0;\n\tif (from.ss_family != AF_INET && from.ss_family != AF_INET6)\n\t\treturn 0;\n\treturn 1;\n}",
    "includes": [
      "#include \"sshbuf.h\"",
      "#include \"ssherr.h\"",
      "#include \"packet.h\"",
      "#include \"ssh.h\"",
      "#include \"channels.h\"",
      "#include \"misc.h\"",
      "#include \"canohost.h\"",
      "#include \"log.h\"",
      "#include \"mac.h\"",
      "#include \"digest.h\"",
      "#include \"kex.h\"",
      "#include \"sshkey.h\"",
      "#include \"cipher.h\"",
      "#include \"ssh2.h\"",
      "#include \"compat.h\"",
      "#include \"crc32.h\"",
      "#include \"xmalloc.h\"",
      "#include <zlib.h>",
      "#  include <openssl/ec.h>",
      "# include <openssl/evp.h>",
      "# include <openssl/bn.h>",
      "#include <time.h>",
      "#include <signal.h>",
      "#include <limits.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <stdarg.h>",
      "#include <netdb.h>",
      "#include <errno.h>",
      "#include <arpa/inet.h>",
      "#include <netinet/ip.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include \"openbsd-compat/sys-queue.h\"",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "memcmp",
          "args": [
            "&from",
            "&to",
            "fromlen"
          ],
          "line": 447
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "getpeername",
          "args": [
            "state->connection_out",
            "(struct sockaddr *)&to",
            "&tolen"
          ],
          "line": 444
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memset",
          "args": [
            "&to",
            "0",
            "sizeof(to)"
          ],
          "line": 443
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "getpeername",
          "args": [
            "state->connection_in",
            "(struct sockaddr *)&from",
            "&fromlen"
          ],
          "line": 439
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memset",
          "args": [
            "&from",
            "0",
            "sizeof(from)"
          ],
          "line": 438
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nssh_packet_connection_is_on_socket(struct ssh *ssh)\n{\n\tstruct session_state *state;\n\tstruct sockaddr_storage from, to;\n\tsocklen_t fromlen, tolen;\n\n\tif (ssh == NULL || ssh->state == NULL)\n\t\treturn 0;\n\n\tstate = ssh->state;\n\tif (state->connection_in == -1 || state->connection_out == -1)\n\t\treturn 0;\n\t/* filedescriptors in and out are the same, so it's a socket */\n\tif (state->connection_in == state->connection_out)\n\t\treturn 1;\n\tfromlen = sizeof(from);\n\tmemset(&from, 0, sizeof(from));\n\tif (getpeername(state->connection_in, (struct sockaddr *)&from,\n\t    &fromlen) < 0)\n\t\treturn 0;\n\ttolen = sizeof(to);\n\tmemset(&to, 0, sizeof(to));\n\tif (getpeername(state->connection_out, (struct sockaddr *)&to,\n\t    &tolen) < 0)\n\t\treturn 0;\n\tif (fromlen != tolen || memcmp(&from, &to, fromlen) != 0)\n\t\treturn 0;\n\tif (from.ss_family != AF_INET && from.ss_family != AF_INET6)\n\t\treturn 0;\n\treturn 1;\n}"
  },
  {
    "function_name": "ssh_packet_start_discard",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
    "lines": "393-417",
    "snippet": "static int\nssh_packet_start_discard(struct ssh *ssh, struct sshenc *enc,\n    struct sshmac *mac, size_t mac_already, u_int discard)\n{\n\tstruct session_state *state = ssh->state;\n\tint r;\n\n\tif (enc == NULL || !cipher_is_cbc(enc->cipher) || (mac && mac->etm)) {\n\t\tif ((r = sshpkt_disconnect(ssh, \"Packet corrupt\")) != 0)\n\t\t\treturn r;\n\t\treturn SSH_ERR_MAC_INVALID;\n\t}\n\t/*\n\t * Record number of bytes over which the mac has already\n\t * been computed in order to minimize timing attacks.\n\t */\n\tif (mac && mac->enabled) {\n\t\tstate->packet_discard_mac = mac;\n\t\tstate->packet_discard_mac_already = mac_already;\n\t}\n\tif (sshbuf_len(state->input) >= discard)\n\t\treturn ssh_packet_stop_discard(ssh);\n\tstate->packet_discard = discard - sshbuf_len(state->input);\n\treturn 0;\n}",
    "includes": [
      "#include \"sshbuf.h\"",
      "#include \"ssherr.h\"",
      "#include \"packet.h\"",
      "#include \"ssh.h\"",
      "#include \"channels.h\"",
      "#include \"misc.h\"",
      "#include \"canohost.h\"",
      "#include \"log.h\"",
      "#include \"mac.h\"",
      "#include \"digest.h\"",
      "#include \"kex.h\"",
      "#include \"sshkey.h\"",
      "#include \"cipher.h\"",
      "#include \"ssh2.h\"",
      "#include \"compat.h\"",
      "#include \"crc32.h\"",
      "#include \"xmalloc.h\"",
      "#include <zlib.h>",
      "#  include <openssl/ec.h>",
      "# include <openssl/evp.h>",
      "# include <openssl/bn.h>",
      "#include <time.h>",
      "#include <signal.h>",
      "#include <limits.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <stdarg.h>",
      "#include <netdb.h>",
      "#include <errno.h>",
      "#include <arpa/inet.h>",
      "#include <netinet/ip.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include \"openbsd-compat/sys-queue.h\"",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "sshbuf_len",
          "args": [
            "state->input"
          ],
          "line": 415
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_len",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf.c",
          "lines": "252-258",
          "snippet": "size_t\nsshbuf_len(const struct sshbuf *buf)\n{\n\tif (sshbuf_check_sanity(buf) != 0)\n\t\treturn 0;\n\treturn buf->size - buf->off;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <signal.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <signal.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nsize_t\nsshbuf_len(const struct sshbuf *buf)\n{\n\tif (sshbuf_check_sanity(buf) != 0)\n\t\treturn 0;\n\treturn buf->size - buf->off;\n}"
        }
      },
      {
        "call_info": {
          "callee": "ssh_packet_stop_discard",
          "args": [
            "ssh"
          ],
          "line": 414
        },
        "resolved": true,
        "details": {
          "function_name": "ssh_packet_stop_discard",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
          "lines": "366-391",
          "snippet": "int\nssh_packet_stop_discard(struct ssh *ssh)\n{\n\tstruct session_state *state = ssh->state;\n\tint r;\n\n\tif (state->packet_discard_mac) {\n\t\tchar buf[1024];\n\t\tsize_t dlen = PACKET_MAX_SIZE;\n\n\t\tif (dlen > state->packet_discard_mac_already)\n\t\t\tdlen -= state->packet_discard_mac_already;\n\t\tmemset(buf, 'a', sizeof(buf));\n\t\twhile (sshbuf_len(state->incoming_packet) < dlen)\n\t\t\tif ((r = sshbuf_put(state->incoming_packet, buf,\n\t\t\t    sizeof(buf))) != 0)\n\t\t\t\treturn r;\n\t\t(void) mac_compute(state->packet_discard_mac,\n\t\t    state->p_read.seqnr,\n\t\t    sshbuf_ptr(state->incoming_packet), dlen,\n\t\t    NULL, 0);\n\t}\n\tlogit(\"Finished discarding for %.200s port %d\",\n\t    ssh_remote_ipaddr(ssh), ssh_remote_port(ssh));\n\treturn SSH_ERR_MAC_INVALID;\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include \"packet.h\"",
            "#include \"ssh.h\"",
            "#include \"channels.h\"",
            "#include \"misc.h\"",
            "#include \"canohost.h\"",
            "#include \"log.h\"",
            "#include \"mac.h\"",
            "#include \"digest.h\"",
            "#include \"kex.h\"",
            "#include \"sshkey.h\"",
            "#include \"cipher.h\"",
            "#include \"ssh2.h\"",
            "#include \"compat.h\"",
            "#include \"crc32.h\"",
            "#include \"xmalloc.h\"",
            "#include <zlib.h>",
            "#  include <openssl/ec.h>",
            "# include <openssl/evp.h>",
            "# include <openssl/bn.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <limits.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <netdb.h>",
            "#include <errno.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include \"openbsd-compat/sys-queue.h\"",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [
            "#define PACKET_MAX_SIZE (256 * 1024)"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\n#define PACKET_MAX_SIZE (256 * 1024)\n\nint\nssh_packet_stop_discard(struct ssh *ssh)\n{\n\tstruct session_state *state = ssh->state;\n\tint r;\n\n\tif (state->packet_discard_mac) {\n\t\tchar buf[1024];\n\t\tsize_t dlen = PACKET_MAX_SIZE;\n\n\t\tif (dlen > state->packet_discard_mac_already)\n\t\t\tdlen -= state->packet_discard_mac_already;\n\t\tmemset(buf, 'a', sizeof(buf));\n\t\twhile (sshbuf_len(state->incoming_packet) < dlen)\n\t\t\tif ((r = sshbuf_put(state->incoming_packet, buf,\n\t\t\t    sizeof(buf))) != 0)\n\t\t\t\treturn r;\n\t\t(void) mac_compute(state->packet_discard_mac,\n\t\t    state->p_read.seqnr,\n\t\t    sshbuf_ptr(state->incoming_packet), dlen,\n\t\t    NULL, 0);\n\t}\n\tlogit(\"Finished discarding for %.200s port %d\",\n\t    ssh_remote_ipaddr(ssh), ssh_remote_port(ssh));\n\treturn SSH_ERR_MAC_INVALID;\n}"
        }
      },
      {
        "call_info": {
          "callee": "sshpkt_disconnect",
          "args": [
            "ssh",
            "\"Packet corrupt\""
          ],
          "line": 401
        },
        "resolved": true,
        "details": {
          "function_name": "sshpkt_disconnect",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
          "lines": "2656-2674",
          "snippet": "int\nsshpkt_disconnect(struct ssh *ssh, const char *fmt,...)\n{\n\tchar buf[1024];\n\tva_list args;\n\tint r;\n\n\tva_start(args, fmt);\n\tvsnprintf(buf, sizeof(buf), fmt, args);\n\tva_end(args);\n\n\tif ((r = sshpkt_start(ssh, SSH2_MSG_DISCONNECT)) != 0 ||\n\t    (r = sshpkt_put_u32(ssh, SSH2_DISCONNECT_PROTOCOL_ERROR)) != 0 ||\n\t    (r = sshpkt_put_cstring(ssh, buf)) != 0 ||\n\t    (r = sshpkt_put_cstring(ssh, \"\")) != 0 ||\n\t    (r = sshpkt_send(ssh)) != 0)\n\t\treturn r;\n\treturn 0;\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include \"packet.h\"",
            "#include \"ssh.h\"",
            "#include \"channels.h\"",
            "#include \"misc.h\"",
            "#include \"canohost.h\"",
            "#include \"log.h\"",
            "#include \"mac.h\"",
            "#include \"digest.h\"",
            "#include \"kex.h\"",
            "#include \"sshkey.h\"",
            "#include \"cipher.h\"",
            "#include \"ssh2.h\"",
            "#include \"compat.h\"",
            "#include \"crc32.h\"",
            "#include \"xmalloc.h\"",
            "#include <zlib.h>",
            "#  include <openssl/ec.h>",
            "# include <openssl/evp.h>",
            "# include <openssl/bn.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <limits.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <netdb.h>",
            "#include <errno.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include \"openbsd-compat/sys-queue.h\"",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshpkt_disconnect(struct ssh *ssh, const char *fmt,...)\n{\n\tchar buf[1024];\n\tva_list args;\n\tint r;\n\n\tva_start(args, fmt);\n\tvsnprintf(buf, sizeof(buf), fmt, args);\n\tva_end(args);\n\n\tif ((r = sshpkt_start(ssh, SSH2_MSG_DISCONNECT)) != 0 ||\n\t    (r = sshpkt_put_u32(ssh, SSH2_DISCONNECT_PROTOCOL_ERROR)) != 0 ||\n\t    (r = sshpkt_put_cstring(ssh, buf)) != 0 ||\n\t    (r = sshpkt_put_cstring(ssh, \"\")) != 0 ||\n\t    (r = sshpkt_send(ssh)) != 0)\n\t\treturn r;\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "cipher_is_cbc",
          "args": [
            "enc->cipher"
          ],
          "line": 400
        },
        "resolved": true,
        "details": {
          "function_name": "cipher_is_cbc",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/cipher.c",
          "lines": "180-184",
          "snippet": "u_int\ncipher_is_cbc(const struct sshcipher *c)\n{\n\treturn (c->flags & CFLAG_CBC) != 0;\n}",
          "includes": [
            "#include \"openbsd-compat/openssl-compat.h\"",
            "#include \"digest.h\"",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"misc.h\"",
            "#include \"cipher.h\"",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <string.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [
            "#define CFLAG_CBC\t\t(1<<0)"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"openbsd-compat/openssl-compat.h\"\n#include \"digest.h\"\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"misc.h\"\n#include \"cipher.h\"\n#include <stdio.h>\n#include <stdarg.h>\n#include <string.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\n#define CFLAG_CBC\t\t(1<<0)\n\nu_int\ncipher_is_cbc(const struct sshcipher *c)\n{\n\treturn (c->flags & CFLAG_CBC) != 0;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nstatic int\nssh_packet_start_discard(struct ssh *ssh, struct sshenc *enc,\n    struct sshmac *mac, size_t mac_already, u_int discard)\n{\n\tstruct session_state *state = ssh->state;\n\tint r;\n\n\tif (enc == NULL || !cipher_is_cbc(enc->cipher) || (mac && mac->etm)) {\n\t\tif ((r = sshpkt_disconnect(ssh, \"Packet corrupt\")) != 0)\n\t\t\treturn r;\n\t\treturn SSH_ERR_MAC_INVALID;\n\t}\n\t/*\n\t * Record number of bytes over which the mac has already\n\t * been computed in order to minimize timing attacks.\n\t */\n\tif (mac && mac->enabled) {\n\t\tstate->packet_discard_mac = mac;\n\t\tstate->packet_discard_mac_already = mac_already;\n\t}\n\tif (sshbuf_len(state->input) >= discard)\n\t\treturn ssh_packet_stop_discard(ssh);\n\tstate->packet_discard = discard - sshbuf_len(state->input);\n\treturn 0;\n}"
  },
  {
    "function_name": "ssh_packet_stop_discard",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
    "lines": "366-391",
    "snippet": "int\nssh_packet_stop_discard(struct ssh *ssh)\n{\n\tstruct session_state *state = ssh->state;\n\tint r;\n\n\tif (state->packet_discard_mac) {\n\t\tchar buf[1024];\n\t\tsize_t dlen = PACKET_MAX_SIZE;\n\n\t\tif (dlen > state->packet_discard_mac_already)\n\t\t\tdlen -= state->packet_discard_mac_already;\n\t\tmemset(buf, 'a', sizeof(buf));\n\t\twhile (sshbuf_len(state->incoming_packet) < dlen)\n\t\t\tif ((r = sshbuf_put(state->incoming_packet, buf,\n\t\t\t    sizeof(buf))) != 0)\n\t\t\t\treturn r;\n\t\t(void) mac_compute(state->packet_discard_mac,\n\t\t    state->p_read.seqnr,\n\t\t    sshbuf_ptr(state->incoming_packet), dlen,\n\t\t    NULL, 0);\n\t}\n\tlogit(\"Finished discarding for %.200s port %d\",\n\t    ssh_remote_ipaddr(ssh), ssh_remote_port(ssh));\n\treturn SSH_ERR_MAC_INVALID;\n}",
    "includes": [
      "#include \"sshbuf.h\"",
      "#include \"ssherr.h\"",
      "#include \"packet.h\"",
      "#include \"ssh.h\"",
      "#include \"channels.h\"",
      "#include \"misc.h\"",
      "#include \"canohost.h\"",
      "#include \"log.h\"",
      "#include \"mac.h\"",
      "#include \"digest.h\"",
      "#include \"kex.h\"",
      "#include \"sshkey.h\"",
      "#include \"cipher.h\"",
      "#include \"ssh2.h\"",
      "#include \"compat.h\"",
      "#include \"crc32.h\"",
      "#include \"xmalloc.h\"",
      "#include <zlib.h>",
      "#  include <openssl/ec.h>",
      "# include <openssl/evp.h>",
      "# include <openssl/bn.h>",
      "#include <time.h>",
      "#include <signal.h>",
      "#include <limits.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <stdarg.h>",
      "#include <netdb.h>",
      "#include <errno.h>",
      "#include <arpa/inet.h>",
      "#include <netinet/ip.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include \"openbsd-compat/sys-queue.h\"",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [
      "#define PACKET_MAX_SIZE (256 * 1024)"
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "logit",
          "args": [
            "\"Finished discarding for %.200s port %d\"",
            "ssh_remote_ipaddr(ssh)",
            "ssh_remote_port(ssh)"
          ],
          "line": 388
        },
        "resolved": true,
        "details": {
          "function_name": "logit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/log.c",
          "lines": "198-206",
          "snippet": "void\nlogit(const char *fmt,...)\n{\n\tva_list args;\n\n\tva_start(args, fmt);\n\tdo_log(SYSLOG_LEVEL_INFO, fmt, args);\n\tva_end(args);\n}",
          "includes": [
            "#include \"log.h\"",
            "# include <vis.h>",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <syslog.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <fcntl.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n# include <vis.h>\n#include <errno.h>\n#include <unistd.h>\n#include <syslog.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <fcntl.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\nlogit(const char *fmt,...)\n{\n\tva_list args;\n\n\tva_start(args, fmt);\n\tdo_log(SYSLOG_LEVEL_INFO, fmt, args);\n\tva_end(args);\n}"
        }
      },
      {
        "call_info": {
          "callee": "ssh_remote_port",
          "args": [
            "ssh"
          ],
          "line": 389
        },
        "resolved": true,
        "details": {
          "function_name": "ssh_remote_port",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
          "lines": "539-544",
          "snippet": "int\nssh_remote_port(struct ssh *ssh)\n{\n\t(void)ssh_remote_ipaddr(ssh); /* Will lookup and cache. */\n\treturn ssh->remote_port;\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include \"packet.h\"",
            "#include \"ssh.h\"",
            "#include \"channels.h\"",
            "#include \"misc.h\"",
            "#include \"canohost.h\"",
            "#include \"log.h\"",
            "#include \"mac.h\"",
            "#include \"digest.h\"",
            "#include \"kex.h\"",
            "#include \"sshkey.h\"",
            "#include \"cipher.h\"",
            "#include \"ssh2.h\"",
            "#include \"compat.h\"",
            "#include \"crc32.h\"",
            "#include \"xmalloc.h\"",
            "#include <zlib.h>",
            "#  include <openssl/ec.h>",
            "# include <openssl/evp.h>",
            "# include <openssl/bn.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <limits.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <netdb.h>",
            "#include <errno.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include \"openbsd-compat/sys-queue.h\"",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nssh_remote_port(struct ssh *ssh)\n{\n\t(void)ssh_remote_ipaddr(ssh); /* Will lookup and cache. */\n\treturn ssh->remote_port;\n}"
        }
      },
      {
        "call_info": {
          "callee": "ssh_remote_ipaddr",
          "args": [
            "ssh"
          ],
          "line": 389
        },
        "resolved": true,
        "details": {
          "function_name": "ssh_remote_ipaddr",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
          "lines": "514-535",
          "snippet": "const char *\nssh_remote_ipaddr(struct ssh *ssh)\n{\n\tint sock;\n\n\t/* Check whether we have cached the ipaddr. */\n\tif (ssh->remote_ipaddr == NULL) {\n\t\tif (ssh_packet_connection_is_on_socket(ssh)) {\n\t\t\tsock = ssh->state->connection_in;\n\t\t\tssh->remote_ipaddr = get_peer_ipaddr(sock);\n\t\t\tssh->remote_port = get_peer_port(sock);\n\t\t\tssh->local_ipaddr = get_local_ipaddr(sock);\n\t\t\tssh->local_port = get_local_port(sock);\n\t\t} else {\n\t\t\tssh->remote_ipaddr = strdup(\"UNKNOWN\");\n\t\t\tssh->remote_port = 65535;\n\t\t\tssh->local_ipaddr = strdup(\"UNKNOWN\");\n\t\t\tssh->local_port = 65535;\n\t\t}\n\t}\n\treturn ssh->remote_ipaddr;\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include \"packet.h\"",
            "#include \"ssh.h\"",
            "#include \"channels.h\"",
            "#include \"misc.h\"",
            "#include \"canohost.h\"",
            "#include \"log.h\"",
            "#include \"mac.h\"",
            "#include \"digest.h\"",
            "#include \"kex.h\"",
            "#include \"sshkey.h\"",
            "#include \"cipher.h\"",
            "#include \"ssh2.h\"",
            "#include \"compat.h\"",
            "#include \"crc32.h\"",
            "#include \"xmalloc.h\"",
            "#include <zlib.h>",
            "#  include <openssl/ec.h>",
            "# include <openssl/evp.h>",
            "# include <openssl/bn.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <limits.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <netdb.h>",
            "#include <errno.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include \"openbsd-compat/sys-queue.h\"",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nconst char *\nssh_remote_ipaddr(struct ssh *ssh)\n{\n\tint sock;\n\n\t/* Check whether we have cached the ipaddr. */\n\tif (ssh->remote_ipaddr == NULL) {\n\t\tif (ssh_packet_connection_is_on_socket(ssh)) {\n\t\t\tsock = ssh->state->connection_in;\n\t\t\tssh->remote_ipaddr = get_peer_ipaddr(sock);\n\t\t\tssh->remote_port = get_peer_port(sock);\n\t\t\tssh->local_ipaddr = get_local_ipaddr(sock);\n\t\t\tssh->local_port = get_local_port(sock);\n\t\t} else {\n\t\t\tssh->remote_ipaddr = strdup(\"UNKNOWN\");\n\t\t\tssh->remote_port = 65535;\n\t\t\tssh->local_ipaddr = strdup(\"UNKNOWN\");\n\t\t\tssh->local_port = 65535;\n\t\t}\n\t}\n\treturn ssh->remote_ipaddr;\n}"
        }
      },
      {
        "call_info": {
          "callee": "mac_compute",
          "args": [
            "state->packet_discard_mac",
            "state->p_read.seqnr",
            "sshbuf_ptr(state->incoming_packet)",
            "dlen",
            "NULL",
            "0"
          ],
          "line": 383
        },
        "resolved": true,
        "details": {
          "function_name": "mac_compute",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/mac.c",
          "lines": "166-210",
          "snippet": "int\nmac_compute(struct sshmac *mac, u_int32_t seqno,\n    const u_char *data, int datalen,\n    u_char *digest, size_t dlen)\n{\n\tstatic union {\n\t\tu_char m[SSH_DIGEST_MAX_LENGTH];\n\t\tu_int64_t for_align;\n\t} u;\n\tu_char b[4];\n\tu_char nonce[8];\n\n\tif (mac->mac_len > sizeof(u))\n\t\treturn SSH_ERR_INTERNAL_ERROR;\n\n\tswitch (mac->type) {\n\tcase SSH_DIGEST:\n\t\tput_u32(b, seqno);\n\t\t/* reset HMAC context */\n\t\tif (ssh_hmac_init(mac->hmac_ctx, NULL, 0) < 0 ||\n\t\t    ssh_hmac_update(mac->hmac_ctx, b, sizeof(b)) < 0 ||\n\t\t    ssh_hmac_update(mac->hmac_ctx, data, datalen) < 0 ||\n\t\t    ssh_hmac_final(mac->hmac_ctx, u.m, sizeof(u.m)) < 0)\n\t\t\treturn SSH_ERR_LIBCRYPTO_ERROR;\n\t\tbreak;\n\tcase SSH_UMAC:\n\t\tPOKE_U64(nonce, seqno);\n\t\tumac_update(mac->umac_ctx, data, datalen);\n\t\tumac_final(mac->umac_ctx, u.m, nonce);\n\t\tbreak;\n\tcase SSH_UMAC128:\n\t\tput_u64(nonce, seqno);\n\t\tumac128_update(mac->umac_ctx, data, datalen);\n\t\tumac128_final(mac->umac_ctx, u.m, nonce);\n\t\tbreak;\n\tdefault:\n\t\treturn SSH_ERR_INVALID_ARGUMENT;\n\t}\n\tif (digest != NULL) {\n\t\tif (dlen > mac->mac_len)\n\t\t\tdlen = mac->mac_len;\n\t\tmemcpy(digest, u.m, dlen);\n\t}\n\treturn 0;\n}",
          "includes": [
            "#include \"openbsd-compat/openssl-compat.h\"",
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include \"misc.h\"",
            "#include \"mac.h\"",
            "#include \"umac.h\"",
            "#include \"hmac.h\"",
            "#include \"digest.h\"",
            "#include <stdio.h>",
            "#include <string.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [
            "#define SSH_UMAC128\t3",
            "#define SSH_UMAC\t2\t/* UMAC (not integrated with OpenSSL) */",
            "#define SSH_DIGEST\t1\t/* SSH_DIGEST_XXX */"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"openbsd-compat/openssl-compat.h\"\n#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"misc.h\"\n#include \"mac.h\"\n#include \"umac.h\"\n#include \"hmac.h\"\n#include \"digest.h\"\n#include <stdio.h>\n#include <string.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\n#define SSH_UMAC128\t3\n#define SSH_UMAC\t2\t/* UMAC (not integrated with OpenSSL) */\n#define SSH_DIGEST\t1\t/* SSH_DIGEST_XXX */\n\nint\nmac_compute(struct sshmac *mac, u_int32_t seqno,\n    const u_char *data, int datalen,\n    u_char *digest, size_t dlen)\n{\n\tstatic union {\n\t\tu_char m[SSH_DIGEST_MAX_LENGTH];\n\t\tu_int64_t for_align;\n\t} u;\n\tu_char b[4];\n\tu_char nonce[8];\n\n\tif (mac->mac_len > sizeof(u))\n\t\treturn SSH_ERR_INTERNAL_ERROR;\n\n\tswitch (mac->type) {\n\tcase SSH_DIGEST:\n\t\tput_u32(b, seqno);\n\t\t/* reset HMAC context */\n\t\tif (ssh_hmac_init(mac->hmac_ctx, NULL, 0) < 0 ||\n\t\t    ssh_hmac_update(mac->hmac_ctx, b, sizeof(b)) < 0 ||\n\t\t    ssh_hmac_update(mac->hmac_ctx, data, datalen) < 0 ||\n\t\t    ssh_hmac_final(mac->hmac_ctx, u.m, sizeof(u.m)) < 0)\n\t\t\treturn SSH_ERR_LIBCRYPTO_ERROR;\n\t\tbreak;\n\tcase SSH_UMAC:\n\t\tPOKE_U64(nonce, seqno);\n\t\tumac_update(mac->umac_ctx, data, datalen);\n\t\tumac_final(mac->umac_ctx, u.m, nonce);\n\t\tbreak;\n\tcase SSH_UMAC128:\n\t\tput_u64(nonce, seqno);\n\t\tumac128_update(mac->umac_ctx, data, datalen);\n\t\tumac128_final(mac->umac_ctx, u.m, nonce);\n\t\tbreak;\n\tdefault:\n\t\treturn SSH_ERR_INVALID_ARGUMENT;\n\t}\n\tif (digest != NULL) {\n\t\tif (dlen > mac->mac_len)\n\t\t\tdlen = mac->mac_len;\n\t\tmemcpy(digest, u.m, dlen);\n\t}\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "sshbuf_ptr",
          "args": [
            "state->incoming_packet"
          ],
          "line": 385
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_ptr",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf.c",
          "lines": "268-274",
          "snippet": "const u_char *\nsshbuf_ptr(const struct sshbuf *buf)\n{\n\tif (sshbuf_check_sanity(buf) != 0)\n\t\treturn NULL;\n\treturn buf->cd + buf->off;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <signal.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <signal.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nconst u_char *\nsshbuf_ptr(const struct sshbuf *buf)\n{\n\tif (sshbuf_check_sanity(buf) != 0)\n\t\treturn NULL;\n\treturn buf->cd + buf->off;\n}"
        }
      },
      {
        "call_info": {
          "callee": "sshbuf_put",
          "args": [
            "state->incoming_packet",
            "buf",
            "sizeof(buf)"
          ],
          "line": 380
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_putf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf-getput-basic.c",
          "lines": "254-264",
          "snippet": "int\nsshbuf_putf(struct sshbuf *buf, const char *fmt, ...)\n{\n\tva_list ap;\n\tint r;\n\n\tva_start(ap, fmt);\n\tr = sshbuf_putfv(buf, fmt, ap);\n\tva_end(ap);\n\treturn r;\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <stdarg.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <stdarg.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshbuf_putf(struct sshbuf *buf, const char *fmt, ...)\n{\n\tva_list ap;\n\tint r;\n\n\tva_start(ap, fmt);\n\tr = sshbuf_putfv(buf, fmt, ap);\n\tva_end(ap);\n\treturn r;\n}"
        }
      },
      {
        "call_info": {
          "callee": "sshbuf_len",
          "args": [
            "state->incoming_packet"
          ],
          "line": 379
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_len",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf.c",
          "lines": "252-258",
          "snippet": "size_t\nsshbuf_len(const struct sshbuf *buf)\n{\n\tif (sshbuf_check_sanity(buf) != 0)\n\t\treturn 0;\n\treturn buf->size - buf->off;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <signal.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <signal.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nsize_t\nsshbuf_len(const struct sshbuf *buf)\n{\n\tif (sshbuf_check_sanity(buf) != 0)\n\t\treturn 0;\n\treturn buf->size - buf->off;\n}"
        }
      },
      {
        "call_info": {
          "callee": "memset",
          "args": [
            "buf",
            "'a'",
            "sizeof(buf)"
          ],
          "line": 378
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\n#define PACKET_MAX_SIZE (256 * 1024)\n\nint\nssh_packet_stop_discard(struct ssh *ssh)\n{\n\tstruct session_state *state = ssh->state;\n\tint r;\n\n\tif (state->packet_discard_mac) {\n\t\tchar buf[1024];\n\t\tsize_t dlen = PACKET_MAX_SIZE;\n\n\t\tif (dlen > state->packet_discard_mac_already)\n\t\t\tdlen -= state->packet_discard_mac_already;\n\t\tmemset(buf, 'a', sizeof(buf));\n\t\twhile (sshbuf_len(state->incoming_packet) < dlen)\n\t\t\tif ((r = sshbuf_put(state->incoming_packet, buf,\n\t\t\t    sizeof(buf))) != 0)\n\t\t\t\treturn r;\n\t\t(void) mac_compute(state->packet_discard_mac,\n\t\t    state->p_read.seqnr,\n\t\t    sshbuf_ptr(state->incoming_packet), dlen,\n\t\t    NULL, 0);\n\t}\n\tlogit(\"Finished discarding for %.200s port %d\",\n\t    ssh_remote_ipaddr(ssh), ssh_remote_port(ssh));\n\treturn SSH_ERR_MAC_INVALID;\n}"
  },
  {
    "function_name": "ssh_packet_set_log_preamble",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
    "lines": "347-364",
    "snippet": "int\nssh_packet_set_log_preamble(struct ssh *ssh, const char *fmt, ...)\n{\n\tva_list args;\n\tint r;\n\n\tfree(ssh->log_preamble);\n\tif (fmt == NULL)\n\t\tssh->log_preamble = NULL;\n\telse {\n\t\tva_start(args, fmt);\n\t\tr = vasprintf(&ssh->log_preamble, fmt, args);\n\t\tva_end(args);\n\t\tif (r < 0 || ssh->log_preamble == NULL)\n\t\t\treturn SSH_ERR_ALLOC_FAIL;\n\t}\n\treturn 0;\n}",
    "includes": [
      "#include \"sshbuf.h\"",
      "#include \"ssherr.h\"",
      "#include \"packet.h\"",
      "#include \"ssh.h\"",
      "#include \"channels.h\"",
      "#include \"misc.h\"",
      "#include \"canohost.h\"",
      "#include \"log.h\"",
      "#include \"mac.h\"",
      "#include \"digest.h\"",
      "#include \"kex.h\"",
      "#include \"sshkey.h\"",
      "#include \"cipher.h\"",
      "#include \"ssh2.h\"",
      "#include \"compat.h\"",
      "#include \"crc32.h\"",
      "#include \"xmalloc.h\"",
      "#include <zlib.h>",
      "#  include <openssl/ec.h>",
      "# include <openssl/evp.h>",
      "# include <openssl/bn.h>",
      "#include <time.h>",
      "#include <signal.h>",
      "#include <limits.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <stdarg.h>",
      "#include <netdb.h>",
      "#include <errno.h>",
      "#include <arpa/inet.h>",
      "#include <netinet/ip.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include \"openbsd-compat/sys-queue.h\"",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "va_end",
          "args": [
            "args"
          ],
          "line": 359
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "vasprintf",
          "args": [
            "&ssh->log_preamble",
            "fmt",
            "args"
          ],
          "line": 358
        },
        "resolved": true,
        "details": {
          "function_name": "vasprintf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/openbsd-compat/bsd-asprintf.c",
          "lines": "39-82",
          "snippet": "int\nvasprintf(char **str, const char *fmt, va_list ap)\n{\n\tint ret = -1;\n\tva_list ap2;\n\tchar *string, *newstr;\n\tsize_t len;\n\n\tVA_COPY(ap2, ap);\n\tif ((string = malloc(INIT_SZ)) == NULL)\n\t\tgoto fail;\n\n\tret = vsnprintf(string, INIT_SZ, fmt, ap2);\n\tif (ret >= 0 && ret < INIT_SZ) { /* succeeded with initial alloc */\n\t\t*str = string;\n\t} else if (ret == INT_MAX || ret < 0) { /* Bad length */\n\t\tfree(string);\n\t\tgoto fail;\n\t} else {\t/* bigger than initial, realloc allowing for nul */\n\t\tlen = (size_t)ret + 1;\n\t\tif ((newstr = realloc(string, len)) == NULL) {\n\t\t\tfree(string);\n\t\t\tgoto fail;\n\t\t} else {\n\t\t\tva_end(ap2);\n\t\t\tVA_COPY(ap2, ap);\n\t\t\tret = vsnprintf(newstr, len, fmt, ap2);\n\t\t\tif (ret >= 0 && (size_t)ret < len) {\n\t\t\t\t*str = newstr;\n\t\t\t} else { /* failed with realloc'ed string, give up */\n\t\t\t\tfree(newstr);\n\t\t\t\tgoto fail;\n\t\t\t}\n\t\t}\n\t}\n\tva_end(ap2);\n\treturn (ret);\n\nfail:\n\t*str = NULL;\n\terrno = ENOMEM;\n\tva_end(ap2);\n\treturn (-1);\n}",
          "includes": [
            "#include <stdlib.h>",
            "#include <stdarg.h>",
            "#include <errno.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [
            "#define INIT_SZ\t128"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <stdlib.h>\n#include <stdarg.h>\n#include <errno.h>\n#include \"includes.h\"\n\n#define INIT_SZ\t128\n\nint\nvasprintf(char **str, const char *fmt, va_list ap)\n{\n\tint ret = -1;\n\tva_list ap2;\n\tchar *string, *newstr;\n\tsize_t len;\n\n\tVA_COPY(ap2, ap);\n\tif ((string = malloc(INIT_SZ)) == NULL)\n\t\tgoto fail;\n\n\tret = vsnprintf(string, INIT_SZ, fmt, ap2);\n\tif (ret >= 0 && ret < INIT_SZ) { /* succeeded with initial alloc */\n\t\t*str = string;\n\t} else if (ret == INT_MAX || ret < 0) { /* Bad length */\n\t\tfree(string);\n\t\tgoto fail;\n\t} else {\t/* bigger than initial, realloc allowing for nul */\n\t\tlen = (size_t)ret + 1;\n\t\tif ((newstr = realloc(string, len)) == NULL) {\n\t\t\tfree(string);\n\t\t\tgoto fail;\n\t\t} else {\n\t\t\tva_end(ap2);\n\t\t\tVA_COPY(ap2, ap);\n\t\t\tret = vsnprintf(newstr, len, fmt, ap2);\n\t\t\tif (ret >= 0 && (size_t)ret < len) {\n\t\t\t\t*str = newstr;\n\t\t\t} else { /* failed with realloc'ed string, give up */\n\t\t\t\tfree(newstr);\n\t\t\t\tgoto fail;\n\t\t\t}\n\t\t}\n\t}\n\tva_end(ap2);\n\treturn (ret);\n\nfail:\n\t*str = NULL;\n\terrno = ENOMEM;\n\tva_end(ap2);\n\treturn (-1);\n}"
        }
      },
      {
        "call_info": {
          "callee": "va_start",
          "args": [
            "args",
            "fmt"
          ],
          "line": 357
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "free",
          "args": [
            "ssh->log_preamble"
          ],
          "line": 353
        },
        "resolved": true,
        "details": {
          "function_name": "freeze",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/smult_curve25519_ref.c",
          "lines": "50-60",
          "snippet": "static void freeze(unsigned int a[32])\n{\n  unsigned int aorig[32];\n  unsigned int j;\n  unsigned int negative;\n\n  for (j = 0;j < 32;++j) aorig[j] = a[j];\n  add(a,a,minusp);\n  negative = -((a[31] >> 7) & 1);\n  for (j = 0;j < 32;++j) a[j] ^= negative & (aorig[j] ^ a[j]);\n}",
          "includes": [],
          "macros_used": [],
          "globals_used": [
            "static const unsigned int minusp[32] = {\n 19, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 128\n} ;"
          ],
          "called_functions": [],
          "contextual_snippet": "static const unsigned int minusp[32] = {\n 19, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 128\n} ;\n\nstatic void freeze(unsigned int a[32])\n{\n  unsigned int aorig[32];\n  unsigned int j;\n  unsigned int negative;\n\n  for (j = 0;j < 32;++j) aorig[j] = a[j];\n  add(a,a,minusp);\n  negative = -((a[31] >> 7) & 1);\n  for (j = 0;j < 32;++j) a[j] ^= negative & (aorig[j] ^ a[j]);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nssh_packet_set_log_preamble(struct ssh *ssh, const char *fmt, ...)\n{\n\tva_list args;\n\tint r;\n\n\tfree(ssh->log_preamble);\n\tif (fmt == NULL)\n\t\tssh->log_preamble = NULL;\n\telse {\n\t\tva_start(args, fmt);\n\t\tr = vasprintf(&ssh->log_preamble, fmt, args);\n\t\tva_end(args);\n\t\tif (r < 0 || ssh->log_preamble == NULL)\n\t\t\treturn SSH_ERR_ALLOC_FAIL;\n\t}\n\treturn 0;\n}"
  },
  {
    "function_name": "ssh_packet_get_mux",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
    "lines": "341-345",
    "snippet": "int\nssh_packet_get_mux(struct ssh *ssh)\n{\n\treturn ssh->state->mux;\n}",
    "includes": [
      "#include \"sshbuf.h\"",
      "#include \"ssherr.h\"",
      "#include \"packet.h\"",
      "#include \"ssh.h\"",
      "#include \"channels.h\"",
      "#include \"misc.h\"",
      "#include \"canohost.h\"",
      "#include \"log.h\"",
      "#include \"mac.h\"",
      "#include \"digest.h\"",
      "#include \"kex.h\"",
      "#include \"sshkey.h\"",
      "#include \"cipher.h\"",
      "#include \"ssh2.h\"",
      "#include \"compat.h\"",
      "#include \"crc32.h\"",
      "#include \"xmalloc.h\"",
      "#include <zlib.h>",
      "#  include <openssl/ec.h>",
      "# include <openssl/evp.h>",
      "# include <openssl/bn.h>",
      "#include <time.h>",
      "#include <signal.h>",
      "#include <limits.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <stdarg.h>",
      "#include <netdb.h>",
      "#include <errno.h>",
      "#include <arpa/inet.h>",
      "#include <netinet/ip.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include \"openbsd-compat/sys-queue.h\"",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nssh_packet_get_mux(struct ssh *ssh)\n{\n\treturn ssh->state->mux;\n}"
  },
  {
    "function_name": "ssh_packet_set_mux",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
    "lines": "334-339",
    "snippet": "void\nssh_packet_set_mux(struct ssh *ssh)\n{\n\tssh->state->mux = 1;\n\tssh->state->rekeying = 0;\n}",
    "includes": [
      "#include \"sshbuf.h\"",
      "#include \"ssherr.h\"",
      "#include \"packet.h\"",
      "#include \"ssh.h\"",
      "#include \"channels.h\"",
      "#include \"misc.h\"",
      "#include \"canohost.h\"",
      "#include \"log.h\"",
      "#include \"mac.h\"",
      "#include \"digest.h\"",
      "#include \"kex.h\"",
      "#include \"sshkey.h\"",
      "#include \"cipher.h\"",
      "#include \"ssh2.h\"",
      "#include \"compat.h\"",
      "#include \"crc32.h\"",
      "#include \"xmalloc.h\"",
      "#include <zlib.h>",
      "#  include <openssl/ec.h>",
      "# include <openssl/evp.h>",
      "# include <openssl/bn.h>",
      "#include <time.h>",
      "#include <signal.h>",
      "#include <limits.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <stdarg.h>",
      "#include <netdb.h>",
      "#include <errno.h>",
      "#include <arpa/inet.h>",
      "#include <netinet/ip.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include \"openbsd-compat/sys-queue.h\"",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\nssh_packet_set_mux(struct ssh *ssh)\n{\n\tssh->state->mux = 1;\n\tssh->state->rekeying = 0;\n}"
  },
  {
    "function_name": "ssh_packet_set_timeout",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
    "lines": "319-332",
    "snippet": "void\nssh_packet_set_timeout(struct ssh *ssh, int timeout, int count)\n{\n\tstruct session_state *state = ssh->state;\n\n\tif (timeout <= 0 || count <= 0) {\n\t\tstate->packet_timeout_ms = -1;\n\t\treturn;\n\t}\n\tif ((INT_MAX / 1000) / count < timeout)\n\t\tstate->packet_timeout_ms = INT_MAX;\n\telse\n\t\tstate->packet_timeout_ms = timeout * count * 1000;\n}",
    "includes": [
      "#include \"sshbuf.h\"",
      "#include \"ssherr.h\"",
      "#include \"packet.h\"",
      "#include \"ssh.h\"",
      "#include \"channels.h\"",
      "#include \"misc.h\"",
      "#include \"canohost.h\"",
      "#include \"log.h\"",
      "#include \"mac.h\"",
      "#include \"digest.h\"",
      "#include \"kex.h\"",
      "#include \"sshkey.h\"",
      "#include \"cipher.h\"",
      "#include \"ssh2.h\"",
      "#include \"compat.h\"",
      "#include \"crc32.h\"",
      "#include \"xmalloc.h\"",
      "#include <zlib.h>",
      "#  include <openssl/ec.h>",
      "# include <openssl/evp.h>",
      "# include <openssl/bn.h>",
      "#include <time.h>",
      "#include <signal.h>",
      "#include <limits.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <stdarg.h>",
      "#include <netdb.h>",
      "#include <errno.h>",
      "#include <arpa/inet.h>",
      "#include <netinet/ip.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include \"openbsd-compat/sys-queue.h\"",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\nssh_packet_set_timeout(struct ssh *ssh, int timeout, int count)\n{\n\tstruct session_state *state = ssh->state;\n\n\tif (timeout <= 0 || count <= 0) {\n\t\tstate->packet_timeout_ms = -1;\n\t\treturn;\n\t}\n\tif ((INT_MAX / 1000) / count < timeout)\n\t\tstate->packet_timeout_ms = INT_MAX;\n\telse\n\t\tstate->packet_timeout_ms = timeout * count * 1000;\n}"
  },
  {
    "function_name": "ssh_packet_set_connection",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
    "lines": "282-317",
    "snippet": "struct ssh *\nssh_packet_set_connection(struct ssh *ssh, int fd_in, int fd_out)\n{\n\tstruct session_state *state;\n\tconst struct sshcipher *none = cipher_by_name(\"none\");\n\tint r;\n\n\tif (none == NULL) {\n\t\terror(\"%s: cannot load cipher 'none'\", __func__);\n\t\treturn NULL;\n\t}\n\tif (ssh == NULL)\n\t\tssh = ssh_alloc_session_state();\n\tif (ssh == NULL) {\n\t\terror(\"%s: cound not allocate state\", __func__);\n\t\treturn NULL;\n\t}\n\tstate = ssh->state;\n\tstate->connection_in = fd_in;\n\tstate->connection_out = fd_out;\n\tif ((r = cipher_init(&state->send_context, none,\n\t    (const u_char *)\"\", 0, NULL, 0, CIPHER_ENCRYPT)) != 0 ||\n\t    (r = cipher_init(&state->receive_context, none,\n\t    (const u_char *)\"\", 0, NULL, 0, CIPHER_DECRYPT)) != 0) {\n\t\terror(\"%s: cipher_init failed: %s\", __func__, ssh_err(r));\n\t\tfree(ssh); /* XXX need ssh_free_session_state? */\n\t\treturn NULL;\n\t}\n\tstate->newkeys[MODE_IN] = state->newkeys[MODE_OUT] = NULL;\n\t/*\n\t * Cache the IP address of the remote connection for use in error\n\t * messages that might be generated after the connection has closed.\n\t */\n\t(void)ssh_remote_ipaddr(ssh);\n\treturn ssh;\n}",
    "includes": [
      "#include \"sshbuf.h\"",
      "#include \"ssherr.h\"",
      "#include \"packet.h\"",
      "#include \"ssh.h\"",
      "#include \"channels.h\"",
      "#include \"misc.h\"",
      "#include \"canohost.h\"",
      "#include \"log.h\"",
      "#include \"mac.h\"",
      "#include \"digest.h\"",
      "#include \"kex.h\"",
      "#include \"sshkey.h\"",
      "#include \"cipher.h\"",
      "#include \"ssh2.h\"",
      "#include \"compat.h\"",
      "#include \"crc32.h\"",
      "#include \"xmalloc.h\"",
      "#include <zlib.h>",
      "#  include <openssl/ec.h>",
      "# include <openssl/evp.h>",
      "# include <openssl/bn.h>",
      "#include <time.h>",
      "#include <signal.h>",
      "#include <limits.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <stdarg.h>",
      "#include <netdb.h>",
      "#include <errno.h>",
      "#include <arpa/inet.h>",
      "#include <netinet/ip.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include \"openbsd-compat/sys-queue.h\"",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "ssh_remote_ipaddr",
          "args": [
            "ssh"
          ],
          "line": 315
        },
        "resolved": true,
        "details": {
          "function_name": "ssh_remote_ipaddr",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
          "lines": "514-535",
          "snippet": "const char *\nssh_remote_ipaddr(struct ssh *ssh)\n{\n\tint sock;\n\n\t/* Check whether we have cached the ipaddr. */\n\tif (ssh->remote_ipaddr == NULL) {\n\t\tif (ssh_packet_connection_is_on_socket(ssh)) {\n\t\t\tsock = ssh->state->connection_in;\n\t\t\tssh->remote_ipaddr = get_peer_ipaddr(sock);\n\t\t\tssh->remote_port = get_peer_port(sock);\n\t\t\tssh->local_ipaddr = get_local_ipaddr(sock);\n\t\t\tssh->local_port = get_local_port(sock);\n\t\t} else {\n\t\t\tssh->remote_ipaddr = strdup(\"UNKNOWN\");\n\t\t\tssh->remote_port = 65535;\n\t\t\tssh->local_ipaddr = strdup(\"UNKNOWN\");\n\t\t\tssh->local_port = 65535;\n\t\t}\n\t}\n\treturn ssh->remote_ipaddr;\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include \"packet.h\"",
            "#include \"ssh.h\"",
            "#include \"channels.h\"",
            "#include \"misc.h\"",
            "#include \"canohost.h\"",
            "#include \"log.h\"",
            "#include \"mac.h\"",
            "#include \"digest.h\"",
            "#include \"kex.h\"",
            "#include \"sshkey.h\"",
            "#include \"cipher.h\"",
            "#include \"ssh2.h\"",
            "#include \"compat.h\"",
            "#include \"crc32.h\"",
            "#include \"xmalloc.h\"",
            "#include <zlib.h>",
            "#  include <openssl/ec.h>",
            "# include <openssl/evp.h>",
            "# include <openssl/bn.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <limits.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <netdb.h>",
            "#include <errno.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include \"openbsd-compat/sys-queue.h\"",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nconst char *\nssh_remote_ipaddr(struct ssh *ssh)\n{\n\tint sock;\n\n\t/* Check whether we have cached the ipaddr. */\n\tif (ssh->remote_ipaddr == NULL) {\n\t\tif (ssh_packet_connection_is_on_socket(ssh)) {\n\t\t\tsock = ssh->state->connection_in;\n\t\t\tssh->remote_ipaddr = get_peer_ipaddr(sock);\n\t\t\tssh->remote_port = get_peer_port(sock);\n\t\t\tssh->local_ipaddr = get_local_ipaddr(sock);\n\t\t\tssh->local_port = get_local_port(sock);\n\t\t} else {\n\t\t\tssh->remote_ipaddr = strdup(\"UNKNOWN\");\n\t\t\tssh->remote_port = 65535;\n\t\t\tssh->local_ipaddr = strdup(\"UNKNOWN\");\n\t\t\tssh->local_port = 65535;\n\t\t}\n\t}\n\treturn ssh->remote_ipaddr;\n}"
        }
      },
      {
        "call_info": {
          "callee": "free",
          "args": [
            "ssh"
          ],
          "line": 307
        },
        "resolved": true,
        "details": {
          "function_name": "freeze",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/smult_curve25519_ref.c",
          "lines": "50-60",
          "snippet": "static void freeze(unsigned int a[32])\n{\n  unsigned int aorig[32];\n  unsigned int j;\n  unsigned int negative;\n\n  for (j = 0;j < 32;++j) aorig[j] = a[j];\n  add(a,a,minusp);\n  negative = -((a[31] >> 7) & 1);\n  for (j = 0;j < 32;++j) a[j] ^= negative & (aorig[j] ^ a[j]);\n}",
          "includes": [],
          "macros_used": [],
          "globals_used": [
            "static const unsigned int minusp[32] = {\n 19, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 128\n} ;"
          ],
          "called_functions": [],
          "contextual_snippet": "static const unsigned int minusp[32] = {\n 19, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 128\n} ;\n\nstatic void freeze(unsigned int a[32])\n{\n  unsigned int aorig[32];\n  unsigned int j;\n  unsigned int negative;\n\n  for (j = 0;j < 32;++j) aorig[j] = a[j];\n  add(a,a,minusp);\n  negative = -((a[31] >> 7) & 1);\n  for (j = 0;j < 32;++j) a[j] ^= negative & (aorig[j] ^ a[j]);\n}"
        }
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"%s: cipher_init failed: %s\"",
            "__func__",
            "ssh_err(r)"
          ],
          "line": 306
        },
        "resolved": true,
        "details": {
          "function_name": "error",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/log.c",
          "lines": "162-170",
          "snippet": "void\nerror(const char *fmt,...)\n{\n\tva_list args;\n\n\tva_start(args, fmt);\n\tdo_log(SYSLOG_LEVEL_ERROR, fmt, args);\n\tva_end(args);\n}",
          "includes": [
            "#include \"log.h\"",
            "# include <vis.h>",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <syslog.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <fcntl.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n# include <vis.h>\n#include <errno.h>\n#include <unistd.h>\n#include <syslog.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <fcntl.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\nerror(const char *fmt,...)\n{\n\tva_list args;\n\n\tva_start(args, fmt);\n\tdo_log(SYSLOG_LEVEL_ERROR, fmt, args);\n\tva_end(args);\n}"
        }
      },
      {
        "call_info": {
          "callee": "ssh_err",
          "args": [
            "r"
          ],
          "line": 306
        },
        "resolved": true,
        "details": {
          "function_name": "ssh_err",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/ssherr.c",
          "lines": "22-147",
          "snippet": "const char *\nssh_err(int n)\n{\n\tswitch (n) {\n\tcase SSH_ERR_SUCCESS:\n\t\treturn \"success\";\n\tcase SSH_ERR_INTERNAL_ERROR:\n\t\treturn \"unexpected internal error\";\n\tcase SSH_ERR_ALLOC_FAIL:\n\t\treturn \"memory allocation failed\";\n\tcase SSH_ERR_MESSAGE_INCOMPLETE:\n\t\treturn \"incomplete message\";\n\tcase SSH_ERR_INVALID_FORMAT:\n\t\treturn \"invalid format\";\n\tcase SSH_ERR_BIGNUM_IS_NEGATIVE:\n\t\treturn \"bignum is negative\";\n\tcase SSH_ERR_STRING_TOO_LARGE:\n\t\treturn \"string is too large\";\n\tcase SSH_ERR_BIGNUM_TOO_LARGE:\n\t\treturn \"bignum is too large\";\n\tcase SSH_ERR_ECPOINT_TOO_LARGE:\n\t\treturn \"elliptic curve point is too large\";\n\tcase SSH_ERR_NO_BUFFER_SPACE:\n\t\treturn \"insufficient buffer space\";\n\tcase SSH_ERR_INVALID_ARGUMENT:\n\t\treturn \"invalid argument\";\n\tcase SSH_ERR_KEY_BITS_MISMATCH:\n\t\treturn \"key bits do not match\";\n\tcase SSH_ERR_EC_CURVE_INVALID:\n\t\treturn \"invalid elliptic curve\";\n\tcase SSH_ERR_KEY_TYPE_MISMATCH:\n\t\treturn \"key type does not match\";\n\tcase SSH_ERR_KEY_TYPE_UNKNOWN:\n\t\treturn \"unknown or unsupported key type\";\n\tcase SSH_ERR_EC_CURVE_MISMATCH:\n\t\treturn \"elliptic curve does not match\";\n\tcase SSH_ERR_EXPECTED_CERT:\n\t\treturn \"plain key provided where certificate required\";\n\tcase SSH_ERR_KEY_LACKS_CERTBLOB:\n\t\treturn \"key lacks certificate data\";\n\tcase SSH_ERR_KEY_CERT_UNKNOWN_TYPE:\n\t\treturn \"unknown/unsupported certificate type\";\n\tcase SSH_ERR_KEY_CERT_INVALID_SIGN_KEY:\n\t\treturn \"invalid certificate signing key\";\n\tcase SSH_ERR_KEY_INVALID_EC_VALUE:\n\t\treturn \"invalid elliptic curve value\";\n\tcase SSH_ERR_SIGNATURE_INVALID:\n\t\treturn \"incorrect signature\";\n\tcase SSH_ERR_LIBCRYPTO_ERROR:\n\t\treturn \"error in libcrypto\";  /* XXX fetch and return */\n\tcase SSH_ERR_UNEXPECTED_TRAILING_DATA:\n\t\treturn \"unexpected bytes remain after decoding\";\n\tcase SSH_ERR_SYSTEM_ERROR:\n\t\treturn strerror(errno);\n\tcase SSH_ERR_KEY_CERT_INVALID:\n\t\treturn \"invalid certificate\";\n\tcase SSH_ERR_AGENT_COMMUNICATION:\n\t\treturn \"communication with agent failed\";\n\tcase SSH_ERR_AGENT_FAILURE:\n\t\treturn \"agent refused operation\";\n\tcase SSH_ERR_DH_GEX_OUT_OF_RANGE:\n\t\treturn \"DH GEX group out of range\";\n\tcase SSH_ERR_DISCONNECTED:\n\t\treturn \"disconnected\";\n\tcase SSH_ERR_MAC_INVALID:\n\t\treturn \"message authentication code incorrect\";\n\tcase SSH_ERR_NO_CIPHER_ALG_MATCH:\n\t\treturn \"no matching cipher found\";\n\tcase SSH_ERR_NO_MAC_ALG_MATCH:\n\t\treturn \"no matching MAC found\";\n\tcase SSH_ERR_NO_COMPRESS_ALG_MATCH:\n\t\treturn \"no matching compression method found\";\n\tcase SSH_ERR_NO_KEX_ALG_MATCH:\n\t\treturn \"no matching key exchange method found\";\n\tcase SSH_ERR_NO_HOSTKEY_ALG_MATCH:\n\t\treturn \"no matching host key type found\";\n\tcase SSH_ERR_PROTOCOL_MISMATCH:\n\t\treturn \"protocol version mismatch\";\n\tcase SSH_ERR_NO_PROTOCOL_VERSION:\n\t\treturn \"could not read protocol version\";\n\tcase SSH_ERR_NO_HOSTKEY_LOADED:\n\t\treturn \"could not load host key\";\n\tcase SSH_ERR_NEED_REKEY:\n\t\treturn \"rekeying not supported by peer\";\n\tcase SSH_ERR_PASSPHRASE_TOO_SHORT:\n\t\treturn \"passphrase is too short (minimum five characters)\";\n\tcase SSH_ERR_FILE_CHANGED:\n\t\treturn \"file changed while reading\";\n\tcase SSH_ERR_KEY_UNKNOWN_CIPHER:\n\t\treturn \"key encrypted using unsupported cipher\";\n\tcase SSH_ERR_KEY_WRONG_PASSPHRASE:\n\t\treturn \"incorrect passphrase supplied to decrypt private key\";\n\tcase SSH_ERR_KEY_BAD_PERMISSIONS:\n\t\treturn \"bad permissions\";\n\tcase SSH_ERR_KEY_CERT_MISMATCH:\n\t\treturn \"certificate does not match key\";\n\tcase SSH_ERR_KEY_NOT_FOUND:\n\t\treturn \"key not found\";\n\tcase SSH_ERR_AGENT_NOT_PRESENT:\n\t\treturn \"agent not present\";\n\tcase SSH_ERR_AGENT_NO_IDENTITIES:\n\t\treturn \"agent contains no identities\";\n\tcase SSH_ERR_BUFFER_READ_ONLY:\n\t\treturn \"internal error: buffer is read-only\";\n\tcase SSH_ERR_KRL_BAD_MAGIC:\n\t\treturn \"KRL file has invalid magic number\";\n\tcase SSH_ERR_KEY_REVOKED:\n\t\treturn \"Key is revoked\";\n\tcase SSH_ERR_CONN_CLOSED:\n\t\treturn \"Connection closed\";\n\tcase SSH_ERR_CONN_TIMEOUT:\n\t\treturn \"Connection timed out\";\n\tcase SSH_ERR_CONN_CORRUPT:\n\t\treturn \"Connection corrupted\";\n\tcase SSH_ERR_PROTOCOL_ERROR:\n\t\treturn \"Protocol error\";\n\tcase SSH_ERR_KEY_LENGTH:\n\t\treturn \"Invalid key length\";\n\tcase SSH_ERR_NUMBER_TOO_LARGE:\n\t\treturn \"number is too large\";\n\tcase SSH_ERR_SIGN_ALG_UNSUPPORTED:\n\t\treturn \"signature algorithm not supported\";\n\tdefault:\n\t\treturn \"unknown error\";\n\t}\n}",
          "includes": [
            "#include \"ssherr.h\"",
            "#include <string.h>",
            "#include <errno.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"ssherr.h\"\n#include <string.h>\n#include <errno.h>\n\nconst char *\nssh_err(int n)\n{\n\tswitch (n) {\n\tcase SSH_ERR_SUCCESS:\n\t\treturn \"success\";\n\tcase SSH_ERR_INTERNAL_ERROR:\n\t\treturn \"unexpected internal error\";\n\tcase SSH_ERR_ALLOC_FAIL:\n\t\treturn \"memory allocation failed\";\n\tcase SSH_ERR_MESSAGE_INCOMPLETE:\n\t\treturn \"incomplete message\";\n\tcase SSH_ERR_INVALID_FORMAT:\n\t\treturn \"invalid format\";\n\tcase SSH_ERR_BIGNUM_IS_NEGATIVE:\n\t\treturn \"bignum is negative\";\n\tcase SSH_ERR_STRING_TOO_LARGE:\n\t\treturn \"string is too large\";\n\tcase SSH_ERR_BIGNUM_TOO_LARGE:\n\t\treturn \"bignum is too large\";\n\tcase SSH_ERR_ECPOINT_TOO_LARGE:\n\t\treturn \"elliptic curve point is too large\";\n\tcase SSH_ERR_NO_BUFFER_SPACE:\n\t\treturn \"insufficient buffer space\";\n\tcase SSH_ERR_INVALID_ARGUMENT:\n\t\treturn \"invalid argument\";\n\tcase SSH_ERR_KEY_BITS_MISMATCH:\n\t\treturn \"key bits do not match\";\n\tcase SSH_ERR_EC_CURVE_INVALID:\n\t\treturn \"invalid elliptic curve\";\n\tcase SSH_ERR_KEY_TYPE_MISMATCH:\n\t\treturn \"key type does not match\";\n\tcase SSH_ERR_KEY_TYPE_UNKNOWN:\n\t\treturn \"unknown or unsupported key type\";\n\tcase SSH_ERR_EC_CURVE_MISMATCH:\n\t\treturn \"elliptic curve does not match\";\n\tcase SSH_ERR_EXPECTED_CERT:\n\t\treturn \"plain key provided where certificate required\";\n\tcase SSH_ERR_KEY_LACKS_CERTBLOB:\n\t\treturn \"key lacks certificate data\";\n\tcase SSH_ERR_KEY_CERT_UNKNOWN_TYPE:\n\t\treturn \"unknown/unsupported certificate type\";\n\tcase SSH_ERR_KEY_CERT_INVALID_SIGN_KEY:\n\t\treturn \"invalid certificate signing key\";\n\tcase SSH_ERR_KEY_INVALID_EC_VALUE:\n\t\treturn \"invalid elliptic curve value\";\n\tcase SSH_ERR_SIGNATURE_INVALID:\n\t\treturn \"incorrect signature\";\n\tcase SSH_ERR_LIBCRYPTO_ERROR:\n\t\treturn \"error in libcrypto\";  /* XXX fetch and return */\n\tcase SSH_ERR_UNEXPECTED_TRAILING_DATA:\n\t\treturn \"unexpected bytes remain after decoding\";\n\tcase SSH_ERR_SYSTEM_ERROR:\n\t\treturn strerror(errno);\n\tcase SSH_ERR_KEY_CERT_INVALID:\n\t\treturn \"invalid certificate\";\n\tcase SSH_ERR_AGENT_COMMUNICATION:\n\t\treturn \"communication with agent failed\";\n\tcase SSH_ERR_AGENT_FAILURE:\n\t\treturn \"agent refused operation\";\n\tcase SSH_ERR_DH_GEX_OUT_OF_RANGE:\n\t\treturn \"DH GEX group out of range\";\n\tcase SSH_ERR_DISCONNECTED:\n\t\treturn \"disconnected\";\n\tcase SSH_ERR_MAC_INVALID:\n\t\treturn \"message authentication code incorrect\";\n\tcase SSH_ERR_NO_CIPHER_ALG_MATCH:\n\t\treturn \"no matching cipher found\";\n\tcase SSH_ERR_NO_MAC_ALG_MATCH:\n\t\treturn \"no matching MAC found\";\n\tcase SSH_ERR_NO_COMPRESS_ALG_MATCH:\n\t\treturn \"no matching compression method found\";\n\tcase SSH_ERR_NO_KEX_ALG_MATCH:\n\t\treturn \"no matching key exchange method found\";\n\tcase SSH_ERR_NO_HOSTKEY_ALG_MATCH:\n\t\treturn \"no matching host key type found\";\n\tcase SSH_ERR_PROTOCOL_MISMATCH:\n\t\treturn \"protocol version mismatch\";\n\tcase SSH_ERR_NO_PROTOCOL_VERSION:\n\t\treturn \"could not read protocol version\";\n\tcase SSH_ERR_NO_HOSTKEY_LOADED:\n\t\treturn \"could not load host key\";\n\tcase SSH_ERR_NEED_REKEY:\n\t\treturn \"rekeying not supported by peer\";\n\tcase SSH_ERR_PASSPHRASE_TOO_SHORT:\n\t\treturn \"passphrase is too short (minimum five characters)\";\n\tcase SSH_ERR_FILE_CHANGED:\n\t\treturn \"file changed while reading\";\n\tcase SSH_ERR_KEY_UNKNOWN_CIPHER:\n\t\treturn \"key encrypted using unsupported cipher\";\n\tcase SSH_ERR_KEY_WRONG_PASSPHRASE:\n\t\treturn \"incorrect passphrase supplied to decrypt private key\";\n\tcase SSH_ERR_KEY_BAD_PERMISSIONS:\n\t\treturn \"bad permissions\";\n\tcase SSH_ERR_KEY_CERT_MISMATCH:\n\t\treturn \"certificate does not match key\";\n\tcase SSH_ERR_KEY_NOT_FOUND:\n\t\treturn \"key not found\";\n\tcase SSH_ERR_AGENT_NOT_PRESENT:\n\t\treturn \"agent not present\";\n\tcase SSH_ERR_AGENT_NO_IDENTITIES:\n\t\treturn \"agent contains no identities\";\n\tcase SSH_ERR_BUFFER_READ_ONLY:\n\t\treturn \"internal error: buffer is read-only\";\n\tcase SSH_ERR_KRL_BAD_MAGIC:\n\t\treturn \"KRL file has invalid magic number\";\n\tcase SSH_ERR_KEY_REVOKED:\n\t\treturn \"Key is revoked\";\n\tcase SSH_ERR_CONN_CLOSED:\n\t\treturn \"Connection closed\";\n\tcase SSH_ERR_CONN_TIMEOUT:\n\t\treturn \"Connection timed out\";\n\tcase SSH_ERR_CONN_CORRUPT:\n\t\treturn \"Connection corrupted\";\n\tcase SSH_ERR_PROTOCOL_ERROR:\n\t\treturn \"Protocol error\";\n\tcase SSH_ERR_KEY_LENGTH:\n\t\treturn \"Invalid key length\";\n\tcase SSH_ERR_NUMBER_TOO_LARGE:\n\t\treturn \"number is too large\";\n\tcase SSH_ERR_SIGN_ALG_UNSUPPORTED:\n\t\treturn \"signature algorithm not supported\";\n\tdefault:\n\t\treturn \"unknown error\";\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "cipher_init",
          "args": [
            "&state->receive_context",
            "none",
            "(const u_char *)\"\"",
            "0",
            "NULL",
            "0",
            "CIPHER_DECRYPT"
          ],
          "line": 304
        },
        "resolved": true,
        "details": {
          "function_name": "cipher_init",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/cipher.c",
          "lines": "235-322",
          "snippet": "int\ncipher_init(struct sshcipher_ctx **ccp, const struct sshcipher *cipher,\n    const u_char *key, u_int keylen, const u_char *iv, u_int ivlen,\n    int do_encrypt)\n{\n\tstruct sshcipher_ctx *cc = NULL;\n\tint ret = SSH_ERR_INTERNAL_ERROR;\n#ifdef WITH_OPENSSL\n\tconst EVP_CIPHER *type;\n\tint klen;\n#endif\n\n\t*ccp = NULL;\n\tif ((cc = calloc(sizeof(*cc), 1)) == NULL)\n\t\treturn SSH_ERR_ALLOC_FAIL;\n\n\tcc->plaintext = (cipher->flags & CFLAG_NONE) != 0;\n\tcc->encrypt = do_encrypt;\n\n\tif (keylen < cipher->key_len ||\n\t    (iv != NULL && ivlen < cipher_ivlen(cipher))) {\n\t\tret = SSH_ERR_INVALID_ARGUMENT;\n\t\tgoto out;\n\t}\n\n\tcc->cipher = cipher;\n\tif ((cc->cipher->flags & CFLAG_CHACHAPOLY) != 0) {\n\t\tret = chachapoly_init(&cc->cp_ctx, key, keylen);\n\t\tgoto out;\n\t}\n\tif ((cc->cipher->flags & CFLAG_NONE) != 0) {\n\t\tret = 0;\n\t\tgoto out;\n\t}\n#ifndef WITH_OPENSSL\n\tif ((cc->cipher->flags & CFLAG_AESCTR) != 0) {\n\t\taesctr_keysetup(&cc->ac_ctx, key, 8 * keylen, 8 * ivlen);\n\t\taesctr_ivsetup(&cc->ac_ctx, iv);\n\t\tret = 0;\n\t\tgoto out;\n\t}\n\tret = SSH_ERR_INVALID_ARGUMENT;\n\tgoto out;\n#else /* WITH_OPENSSL */\n\ttype = (*cipher->evptype)();\n\tif ((cc->evp = EVP_CIPHER_CTX_new()) == NULL) {\n\t\tret = SSH_ERR_ALLOC_FAIL;\n\t\tgoto out;\n\t}\n\tif (EVP_CipherInit(cc->evp, type, NULL, (u_char *)iv,\n\t    (do_encrypt == CIPHER_ENCRYPT)) == 0) {\n\t\tret = SSH_ERR_LIBCRYPTO_ERROR;\n\t\tgoto out;\n\t}\n\tif (cipher_authlen(cipher) &&\n\t    !EVP_CIPHER_CTX_ctrl(cc->evp, EVP_CTRL_GCM_SET_IV_FIXED,\n\t    -1, (u_char *)iv)) {\n\t\tret = SSH_ERR_LIBCRYPTO_ERROR;\n\t\tgoto out;\n\t}\n\tklen = EVP_CIPHER_CTX_key_length(cc->evp);\n\tif (klen > 0 && keylen != (u_int)klen) {\n\t\tif (EVP_CIPHER_CTX_set_key_length(cc->evp, keylen) == 0) {\n\t\t\tret = SSH_ERR_LIBCRYPTO_ERROR;\n\t\t\tgoto out;\n\t\t}\n\t}\n\tif (EVP_CipherInit(cc->evp, NULL, (u_char *)key, NULL, -1) == 0) {\n\t\tret = SSH_ERR_LIBCRYPTO_ERROR;\n\t\tgoto out;\n\t}\n\tret = 0;\n#endif /* WITH_OPENSSL */\n out:\n\tif (ret == 0) {\n\t\t/* success */\n\t\t*ccp = cc;\n\t} else {\n\t\tif (cc != NULL) {\n#ifdef WITH_OPENSSL\n\t\t\tEVP_CIPHER_CTX_free(cc->evp);\n#endif /* WITH_OPENSSL */\n\t\t\texplicit_bzero(cc, sizeof(*cc));\n\t\t\tfree(cc);\n\t\t}\n\t}\n\treturn ret;\n}",
          "includes": [
            "#include \"openbsd-compat/openssl-compat.h\"",
            "#include \"digest.h\"",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"misc.h\"",
            "#include \"cipher.h\"",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <string.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [
            "#define CFLAG_NONE\t\t(1<<3)",
            "#define CFLAG_AESCTR\t\t(1<<2)",
            "#define CFLAG_CHACHAPOLY\t(1<<1)"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"openbsd-compat/openssl-compat.h\"\n#include \"digest.h\"\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"misc.h\"\n#include \"cipher.h\"\n#include <stdio.h>\n#include <stdarg.h>\n#include <string.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\n#define CFLAG_NONE\t\t(1<<3)\n#define CFLAG_AESCTR\t\t(1<<2)\n#define CFLAG_CHACHAPOLY\t(1<<1)\n\nint\ncipher_init(struct sshcipher_ctx **ccp, const struct sshcipher *cipher,\n    const u_char *key, u_int keylen, const u_char *iv, u_int ivlen,\n    int do_encrypt)\n{\n\tstruct sshcipher_ctx *cc = NULL;\n\tint ret = SSH_ERR_INTERNAL_ERROR;\n#ifdef WITH_OPENSSL\n\tconst EVP_CIPHER *type;\n\tint klen;\n#endif\n\n\t*ccp = NULL;\n\tif ((cc = calloc(sizeof(*cc), 1)) == NULL)\n\t\treturn SSH_ERR_ALLOC_FAIL;\n\n\tcc->plaintext = (cipher->flags & CFLAG_NONE) != 0;\n\tcc->encrypt = do_encrypt;\n\n\tif (keylen < cipher->key_len ||\n\t    (iv != NULL && ivlen < cipher_ivlen(cipher))) {\n\t\tret = SSH_ERR_INVALID_ARGUMENT;\n\t\tgoto out;\n\t}\n\n\tcc->cipher = cipher;\n\tif ((cc->cipher->flags & CFLAG_CHACHAPOLY) != 0) {\n\t\tret = chachapoly_init(&cc->cp_ctx, key, keylen);\n\t\tgoto out;\n\t}\n\tif ((cc->cipher->flags & CFLAG_NONE) != 0) {\n\t\tret = 0;\n\t\tgoto out;\n\t}\n#ifndef WITH_OPENSSL\n\tif ((cc->cipher->flags & CFLAG_AESCTR) != 0) {\n\t\taesctr_keysetup(&cc->ac_ctx, key, 8 * keylen, 8 * ivlen);\n\t\taesctr_ivsetup(&cc->ac_ctx, iv);\n\t\tret = 0;\n\t\tgoto out;\n\t}\n\tret = SSH_ERR_INVALID_ARGUMENT;\n\tgoto out;\n#else /* WITH_OPENSSL */\n\ttype = (*cipher->evptype)();\n\tif ((cc->evp = EVP_CIPHER_CTX_new()) == NULL) {\n\t\tret = SSH_ERR_ALLOC_FAIL;\n\t\tgoto out;\n\t}\n\tif (EVP_CipherInit(cc->evp, type, NULL, (u_char *)iv,\n\t    (do_encrypt == CIPHER_ENCRYPT)) == 0) {\n\t\tret = SSH_ERR_LIBCRYPTO_ERROR;\n\t\tgoto out;\n\t}\n\tif (cipher_authlen(cipher) &&\n\t    !EVP_CIPHER_CTX_ctrl(cc->evp, EVP_CTRL_GCM_SET_IV_FIXED,\n\t    -1, (u_char *)iv)) {\n\t\tret = SSH_ERR_LIBCRYPTO_ERROR;\n\t\tgoto out;\n\t}\n\tklen = EVP_CIPHER_CTX_key_length(cc->evp);\n\tif (klen > 0 && keylen != (u_int)klen) {\n\t\tif (EVP_CIPHER_CTX_set_key_length(cc->evp, keylen) == 0) {\n\t\t\tret = SSH_ERR_LIBCRYPTO_ERROR;\n\t\t\tgoto out;\n\t\t}\n\t}\n\tif (EVP_CipherInit(cc->evp, NULL, (u_char *)key, NULL, -1) == 0) {\n\t\tret = SSH_ERR_LIBCRYPTO_ERROR;\n\t\tgoto out;\n\t}\n\tret = 0;\n#endif /* WITH_OPENSSL */\n out:\n\tif (ret == 0) {\n\t\t/* success */\n\t\t*ccp = cc;\n\t} else {\n\t\tif (cc != NULL) {\n#ifdef WITH_OPENSSL\n\t\t\tEVP_CIPHER_CTX_free(cc->evp);\n#endif /* WITH_OPENSSL */\n\t\t\texplicit_bzero(cc, sizeof(*cc));\n\t\t\tfree(cc);\n\t\t}\n\t}\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "ssh_alloc_session_state",
          "args": [],
          "line": 294
        },
        "resolved": true,
        "details": {
          "function_name": "ssh_alloc_session_state",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
          "lines": "223-262",
          "snippet": "struct ssh *\nssh_alloc_session_state(void)\n{\n\tstruct ssh *ssh = NULL;\n\tstruct session_state *state = NULL;\n\n\tif ((ssh = calloc(1, sizeof(*ssh))) == NULL ||\n\t    (state = calloc(1, sizeof(*state))) == NULL ||\n\t    (state->input = sshbuf_new()) == NULL ||\n\t    (state->output = sshbuf_new()) == NULL ||\n\t    (state->outgoing_packet = sshbuf_new()) == NULL ||\n\t    (state->incoming_packet = sshbuf_new()) == NULL)\n\t\tgoto fail;\n\tTAILQ_INIT(&state->outgoing);\n\tTAILQ_INIT(&ssh->private_keys);\n\tTAILQ_INIT(&ssh->public_keys);\n\tstate->connection_in = -1;\n\tstate->connection_out = -1;\n\tstate->max_packet_size = 32768;\n\tstate->packet_timeout_ms = -1;\n\tstate->p_send.packets = state->p_read.packets = 0;\n\tstate->initialized = 1;\n\t/*\n\t * ssh_packet_send2() needs to queue packets until\n\t * we've done the initial key exchange.\n\t */\n\tstate->rekeying = 1;\n\tssh->state = state;\n\treturn ssh;\n fail:\n\tif (state) {\n\t\tsshbuf_free(state->input);\n\t\tsshbuf_free(state->output);\n\t\tsshbuf_free(state->incoming_packet);\n\t\tsshbuf_free(state->outgoing_packet);\n\t\tfree(state);\n\t}\n\tfree(ssh);\n\treturn NULL;\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include \"packet.h\"",
            "#include \"ssh.h\"",
            "#include \"channels.h\"",
            "#include \"misc.h\"",
            "#include \"canohost.h\"",
            "#include \"log.h\"",
            "#include \"mac.h\"",
            "#include \"digest.h\"",
            "#include \"kex.h\"",
            "#include \"sshkey.h\"",
            "#include \"cipher.h\"",
            "#include \"ssh2.h\"",
            "#include \"compat.h\"",
            "#include \"crc32.h\"",
            "#include \"xmalloc.h\"",
            "#include <zlib.h>",
            "#  include <openssl/ec.h>",
            "# include <openssl/evp.h>",
            "# include <openssl/bn.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <limits.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <netdb.h>",
            "#include <errno.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include \"openbsd-compat/sys-queue.h\"",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nstruct ssh *\nssh_alloc_session_state(void)\n{\n\tstruct ssh *ssh = NULL;\n\tstruct session_state *state = NULL;\n\n\tif ((ssh = calloc(1, sizeof(*ssh))) == NULL ||\n\t    (state = calloc(1, sizeof(*state))) == NULL ||\n\t    (state->input = sshbuf_new()) == NULL ||\n\t    (state->output = sshbuf_new()) == NULL ||\n\t    (state->outgoing_packet = sshbuf_new()) == NULL ||\n\t    (state->incoming_packet = sshbuf_new()) == NULL)\n\t\tgoto fail;\n\tTAILQ_INIT(&state->outgoing);\n\tTAILQ_INIT(&ssh->private_keys);\n\tTAILQ_INIT(&ssh->public_keys);\n\tstate->connection_in = -1;\n\tstate->connection_out = -1;\n\tstate->max_packet_size = 32768;\n\tstate->packet_timeout_ms = -1;\n\tstate->p_send.packets = state->p_read.packets = 0;\n\tstate->initialized = 1;\n\t/*\n\t * ssh_packet_send2() needs to queue packets until\n\t * we've done the initial key exchange.\n\t */\n\tstate->rekeying = 1;\n\tssh->state = state;\n\treturn ssh;\n fail:\n\tif (state) {\n\t\tsshbuf_free(state->input);\n\t\tsshbuf_free(state->output);\n\t\tsshbuf_free(state->incoming_packet);\n\t\tsshbuf_free(state->outgoing_packet);\n\t\tfree(state);\n\t}\n\tfree(ssh);\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "cipher_by_name",
          "args": [
            "\"none\""
          ],
          "line": 286
        },
        "resolved": true,
        "details": {
          "function_name": "cipher_by_name",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/cipher.c",
          "lines": "192-200",
          "snippet": "const struct sshcipher *\ncipher_by_name(const char *name)\n{\n\tconst struct sshcipher *c;\n\tfor (c = ciphers; c->name != NULL; c++)\n\t\tif (strcmp(c->name, name) == 0)\n\t\t\treturn c;\n\treturn NULL;\n}",
          "includes": [
            "#include \"openbsd-compat/openssl-compat.h\"",
            "#include \"digest.h\"",
            "#include \"ssherr.h\"",
            "#include \"sshbuf.h\"",
            "#include \"misc.h\"",
            "#include \"cipher.h\"",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <string.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static const struct sshcipher ciphers[] = {\n#ifdef WITH_OPENSSL\n#ifndef OPENSSL_NO_DES\n\t{ \"3des-cbc\",\t\t8, 24, 0, 0, CFLAG_CBC, EVP_des_ede3_cbc },\n#endif\n\t{ \"aes128-cbc\",\t\t16, 16, 0, 0, CFLAG_CBC, EVP_aes_128_cbc },\n\t{ \"aes192-cbc\",\t\t16, 24, 0, 0, CFLAG_CBC, EVP_aes_192_cbc },\n\t{ \"aes256-cbc\",\t\t16, 32, 0, 0, CFLAG_CBC, EVP_aes_256_cbc },\n\t{ \"rijndael-cbc@lysator.liu.se\",\n\t\t\t\t16, 32, 0, 0, CFLAG_CBC, EVP_aes_256_cbc },\n\t{ \"aes128-ctr\",\t\t16, 16, 0, 0, 0, EVP_aes_128_ctr },\n\t{ \"aes192-ctr\",\t\t16, 24, 0, 0, 0, EVP_aes_192_ctr },\n\t{ \"aes256-ctr\",\t\t16, 32, 0, 0, 0, EVP_aes_256_ctr },\n# ifdef OPENSSL_HAVE_EVPGCM\n\t{ \"aes128-gcm@openssh.com\",\n\t\t\t\t16, 16, 12, 16, 0, EVP_aes_128_gcm },\n\t{ \"aes256-gcm@openssh.com\",\n\t\t\t\t16, 32, 12, 16, 0, EVP_aes_256_gcm },\n# endif /* OPENSSL_HAVE_EVPGCM */\n#else\n\t{ \"aes128-ctr\",\t\t16, 16, 0, 0, CFLAG_AESCTR, NULL },\n\t{ \"aes192-ctr\",\t\t16, 24, 0, 0, CFLAG_AESCTR, NULL },\n\t{ \"aes256-ctr\",\t\t16, 32, 0, 0, CFLAG_AESCTR, NULL },\n#endif\n\t{ \"chacha20-poly1305@openssh.com\",\n\t\t\t\t8, 64, 0, 16, CFLAG_CHACHAPOLY, NULL },\n\t{ \"none\",\t\t8, 0, 0, 0, CFLAG_NONE, NULL },\n\n\t{ NULL,\t\t\t0, 0, 0, 0, 0, NULL }\n};"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"openbsd-compat/openssl-compat.h\"\n#include \"digest.h\"\n#include \"ssherr.h\"\n#include \"sshbuf.h\"\n#include \"misc.h\"\n#include \"cipher.h\"\n#include <stdio.h>\n#include <stdarg.h>\n#include <string.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nstatic const struct sshcipher ciphers[] = {\n#ifdef WITH_OPENSSL\n#ifndef OPENSSL_NO_DES\n\t{ \"3des-cbc\",\t\t8, 24, 0, 0, CFLAG_CBC, EVP_des_ede3_cbc },\n#endif\n\t{ \"aes128-cbc\",\t\t16, 16, 0, 0, CFLAG_CBC, EVP_aes_128_cbc },\n\t{ \"aes192-cbc\",\t\t16, 24, 0, 0, CFLAG_CBC, EVP_aes_192_cbc },\n\t{ \"aes256-cbc\",\t\t16, 32, 0, 0, CFLAG_CBC, EVP_aes_256_cbc },\n\t{ \"rijndael-cbc@lysator.liu.se\",\n\t\t\t\t16, 32, 0, 0, CFLAG_CBC, EVP_aes_256_cbc },\n\t{ \"aes128-ctr\",\t\t16, 16, 0, 0, 0, EVP_aes_128_ctr },\n\t{ \"aes192-ctr\",\t\t16, 24, 0, 0, 0, EVP_aes_192_ctr },\n\t{ \"aes256-ctr\",\t\t16, 32, 0, 0, 0, EVP_aes_256_ctr },\n# ifdef OPENSSL_HAVE_EVPGCM\n\t{ \"aes128-gcm@openssh.com\",\n\t\t\t\t16, 16, 12, 16, 0, EVP_aes_128_gcm },\n\t{ \"aes256-gcm@openssh.com\",\n\t\t\t\t16, 32, 12, 16, 0, EVP_aes_256_gcm },\n# endif /* OPENSSL_HAVE_EVPGCM */\n#else\n\t{ \"aes128-ctr\",\t\t16, 16, 0, 0, CFLAG_AESCTR, NULL },\n\t{ \"aes192-ctr\",\t\t16, 24, 0, 0, CFLAG_AESCTR, NULL },\n\t{ \"aes256-ctr\",\t\t16, 32, 0, 0, CFLAG_AESCTR, NULL },\n#endif\n\t{ \"chacha20-poly1305@openssh.com\",\n\t\t\t\t8, 64, 0, 16, CFLAG_CHACHAPOLY, NULL },\n\t{ \"none\",\t\t8, 0, 0, 0, CFLAG_NONE, NULL },\n\n\t{ NULL,\t\t\t0, 0, 0, 0, 0, NULL }\n};\n\nconst struct sshcipher *\ncipher_by_name(const char *name)\n{\n\tconst struct sshcipher *c;\n\tfor (c = ciphers; c->name != NULL; c++)\n\t\tif (strcmp(c->name, name) == 0)\n\t\t\treturn c;\n\treturn NULL;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nstruct ssh *\nssh_packet_set_connection(struct ssh *ssh, int fd_in, int fd_out)\n{\n\tstruct session_state *state;\n\tconst struct sshcipher *none = cipher_by_name(\"none\");\n\tint r;\n\n\tif (none == NULL) {\n\t\terror(\"%s: cannot load cipher 'none'\", __func__);\n\t\treturn NULL;\n\t}\n\tif (ssh == NULL)\n\t\tssh = ssh_alloc_session_state();\n\tif (ssh == NULL) {\n\t\terror(\"%s: cound not allocate state\", __func__);\n\t\treturn NULL;\n\t}\n\tstate = ssh->state;\n\tstate->connection_in = fd_in;\n\tstate->connection_out = fd_out;\n\tif ((r = cipher_init(&state->send_context, none,\n\t    (const u_char *)\"\", 0, NULL, 0, CIPHER_ENCRYPT)) != 0 ||\n\t    (r = cipher_init(&state->receive_context, none,\n\t    (const u_char *)\"\", 0, NULL, 0, CIPHER_DECRYPT)) != 0) {\n\t\terror(\"%s: cipher_init failed: %s\", __func__, ssh_err(r));\n\t\tfree(ssh); /* XXX need ssh_free_session_state? */\n\t\treturn NULL;\n\t}\n\tstate->newkeys[MODE_IN] = state->newkeys[MODE_OUT] = NULL;\n\t/*\n\t * Cache the IP address of the remote connection for use in error\n\t * messages that might be generated after the connection has closed.\n\t */\n\t(void)ssh_remote_ipaddr(ssh);\n\treturn ssh;\n}"
  },
  {
    "function_name": "ssh_packet_is_rekeying",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
    "lines": "272-277",
    "snippet": "int\nssh_packet_is_rekeying(struct ssh *ssh)\n{\n\treturn ssh->state->rekeying ||\n\t    (ssh->kex != NULL && ssh->kex->done == 0);\n}",
    "includes": [
      "#include \"sshbuf.h\"",
      "#include \"ssherr.h\"",
      "#include \"packet.h\"",
      "#include \"ssh.h\"",
      "#include \"channels.h\"",
      "#include \"misc.h\"",
      "#include \"canohost.h\"",
      "#include \"log.h\"",
      "#include \"mac.h\"",
      "#include \"digest.h\"",
      "#include \"kex.h\"",
      "#include \"sshkey.h\"",
      "#include \"cipher.h\"",
      "#include \"ssh2.h\"",
      "#include \"compat.h\"",
      "#include \"crc32.h\"",
      "#include \"xmalloc.h\"",
      "#include <zlib.h>",
      "#  include <openssl/ec.h>",
      "# include <openssl/evp.h>",
      "# include <openssl/bn.h>",
      "#include <time.h>",
      "#include <signal.h>",
      "#include <limits.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <stdarg.h>",
      "#include <netdb.h>",
      "#include <errno.h>",
      "#include <arpa/inet.h>",
      "#include <netinet/ip.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include \"openbsd-compat/sys-queue.h\"",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nssh_packet_is_rekeying(struct ssh *ssh)\n{\n\treturn ssh->state->rekeying ||\n\t    (ssh->kex != NULL && ssh->kex->done == 0);\n}"
  },
  {
    "function_name": "ssh_packet_set_input_hook",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
    "lines": "264-269",
    "snippet": "void\nssh_packet_set_input_hook(struct ssh *ssh, ssh_packet_hook_fn *hook, void *ctx)\n{\n\tssh->state->hook_in = hook;\n\tssh->state->hook_in_ctx = ctx;\n}",
    "includes": [
      "#include \"sshbuf.h\"",
      "#include \"ssherr.h\"",
      "#include \"packet.h\"",
      "#include \"ssh.h\"",
      "#include \"channels.h\"",
      "#include \"misc.h\"",
      "#include \"canohost.h\"",
      "#include \"log.h\"",
      "#include \"mac.h\"",
      "#include \"digest.h\"",
      "#include \"kex.h\"",
      "#include \"sshkey.h\"",
      "#include \"cipher.h\"",
      "#include \"ssh2.h\"",
      "#include \"compat.h\"",
      "#include \"crc32.h\"",
      "#include \"xmalloc.h\"",
      "#include <zlib.h>",
      "#  include <openssl/ec.h>",
      "# include <openssl/evp.h>",
      "# include <openssl/bn.h>",
      "#include <time.h>",
      "#include <signal.h>",
      "#include <limits.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <stdarg.h>",
      "#include <netdb.h>",
      "#include <errno.h>",
      "#include <arpa/inet.h>",
      "#include <netinet/ip.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include \"openbsd-compat/sys-queue.h\"",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\nssh_packet_set_input_hook(struct ssh *ssh, ssh_packet_hook_fn *hook, void *ctx)\n{\n\tssh->state->hook_in = hook;\n\tssh->state->hook_in_ctx = ctx;\n}"
  },
  {
    "function_name": "ssh_alloc_session_state",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
    "lines": "223-262",
    "snippet": "struct ssh *\nssh_alloc_session_state(void)\n{\n\tstruct ssh *ssh = NULL;\n\tstruct session_state *state = NULL;\n\n\tif ((ssh = calloc(1, sizeof(*ssh))) == NULL ||\n\t    (state = calloc(1, sizeof(*state))) == NULL ||\n\t    (state->input = sshbuf_new()) == NULL ||\n\t    (state->output = sshbuf_new()) == NULL ||\n\t    (state->outgoing_packet = sshbuf_new()) == NULL ||\n\t    (state->incoming_packet = sshbuf_new()) == NULL)\n\t\tgoto fail;\n\tTAILQ_INIT(&state->outgoing);\n\tTAILQ_INIT(&ssh->private_keys);\n\tTAILQ_INIT(&ssh->public_keys);\n\tstate->connection_in = -1;\n\tstate->connection_out = -1;\n\tstate->max_packet_size = 32768;\n\tstate->packet_timeout_ms = -1;\n\tstate->p_send.packets = state->p_read.packets = 0;\n\tstate->initialized = 1;\n\t/*\n\t * ssh_packet_send2() needs to queue packets until\n\t * we've done the initial key exchange.\n\t */\n\tstate->rekeying = 1;\n\tssh->state = state;\n\treturn ssh;\n fail:\n\tif (state) {\n\t\tsshbuf_free(state->input);\n\t\tsshbuf_free(state->output);\n\t\tsshbuf_free(state->incoming_packet);\n\t\tsshbuf_free(state->outgoing_packet);\n\t\tfree(state);\n\t}\n\tfree(ssh);\n\treturn NULL;\n}",
    "includes": [
      "#include \"sshbuf.h\"",
      "#include \"ssherr.h\"",
      "#include \"packet.h\"",
      "#include \"ssh.h\"",
      "#include \"channels.h\"",
      "#include \"misc.h\"",
      "#include \"canohost.h\"",
      "#include \"log.h\"",
      "#include \"mac.h\"",
      "#include \"digest.h\"",
      "#include \"kex.h\"",
      "#include \"sshkey.h\"",
      "#include \"cipher.h\"",
      "#include \"ssh2.h\"",
      "#include \"compat.h\"",
      "#include \"crc32.h\"",
      "#include \"xmalloc.h\"",
      "#include <zlib.h>",
      "#  include <openssl/ec.h>",
      "# include <openssl/evp.h>",
      "# include <openssl/bn.h>",
      "#include <time.h>",
      "#include <signal.h>",
      "#include <limits.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <stdarg.h>",
      "#include <netdb.h>",
      "#include <errno.h>",
      "#include <arpa/inet.h>",
      "#include <netinet/ip.h>",
      "#include <netinet/in.h>",
      "# include <sys/time.h>",
      "#include <sys/socket.h>",
      "#include \"openbsd-compat/sys-queue.h\"",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "ssh"
          ],
          "line": 260
        },
        "resolved": true,
        "details": {
          "function_name": "freeze",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/smult_curve25519_ref.c",
          "lines": "50-60",
          "snippet": "static void freeze(unsigned int a[32])\n{\n  unsigned int aorig[32];\n  unsigned int j;\n  unsigned int negative;\n\n  for (j = 0;j < 32;++j) aorig[j] = a[j];\n  add(a,a,minusp);\n  negative = -((a[31] >> 7) & 1);\n  for (j = 0;j < 32;++j) a[j] ^= negative & (aorig[j] ^ a[j]);\n}",
          "includes": [],
          "macros_used": [],
          "globals_used": [
            "static const unsigned int minusp[32] = {\n 19, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 128\n} ;"
          ],
          "called_functions": [],
          "contextual_snippet": "static const unsigned int minusp[32] = {\n 19, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 128\n} ;\n\nstatic void freeze(unsigned int a[32])\n{\n  unsigned int aorig[32];\n  unsigned int j;\n  unsigned int negative;\n\n  for (j = 0;j < 32;++j) aorig[j] = a[j];\n  add(a,a,minusp);\n  negative = -((a[31] >> 7) & 1);\n  for (j = 0;j < 32;++j) a[j] ^= negative & (aorig[j] ^ a[j]);\n}"
        }
      },
      {
        "call_info": {
          "callee": "sshbuf_free",
          "args": [
            "state->outgoing_packet"
          ],
          "line": 257
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf.c",
          "lines": "133-166",
          "snippet": "void\nsshbuf_free(struct sshbuf *buf)\n{\n\tif (buf == NULL)\n\t\treturn;\n\t/*\n\t * The following will leak on insane buffers, but this is the safest\n\t * course of action - an invalid pointer or already-freed pointer may\n\t * have been passed to us and continuing to scribble over memory would\n\t * be bad.\n\t */\n\tif (sshbuf_check_sanity(buf) != 0)\n\t\treturn;\n\t/*\n\t * If we are a child, the free our parent to decrement its reference\n\t * count and possibly free it.\n\t */\n\tsshbuf_free(buf->parent);\n\tbuf->parent = NULL;\n\t/*\n\t * If we are a parent with still-extant children, then don't free just\n\t * yet. The last child's call to sshbuf_free should decrement our\n\t * refcount to 0 and trigger the actual free.\n\t */\n\tbuf->refcount--;\n\tif (buf->refcount > 0)\n\t\treturn;\n\tif (!buf->readonly) {\n\t\texplicit_bzero(buf->d, buf->alloc);\n\t\tfree(buf->d);\n\t}\n\texplicit_bzero(buf, sizeof(*buf));\n\tfree(buf);\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <signal.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <signal.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\nsshbuf_free(struct sshbuf *buf)\n{\n\tif (buf == NULL)\n\t\treturn;\n\t/*\n\t * The following will leak on insane buffers, but this is the safest\n\t * course of action - an invalid pointer or already-freed pointer may\n\t * have been passed to us and continuing to scribble over memory would\n\t * be bad.\n\t */\n\tif (sshbuf_check_sanity(buf) != 0)\n\t\treturn;\n\t/*\n\t * If we are a child, the free our parent to decrement its reference\n\t * count and possibly free it.\n\t */\n\tsshbuf_free(buf->parent);\n\tbuf->parent = NULL;\n\t/*\n\t * If we are a parent with still-extant children, then don't free just\n\t * yet. The last child's call to sshbuf_free should decrement our\n\t * refcount to 0 and trigger the actual free.\n\t */\n\tbuf->refcount--;\n\tif (buf->refcount > 0)\n\t\treturn;\n\tif (!buf->readonly) {\n\t\texplicit_bzero(buf->d, buf->alloc);\n\t\tfree(buf->d);\n\t}\n\texplicit_bzero(buf, sizeof(*buf));\n\tfree(buf);\n}"
        }
      },
      {
        "call_info": {
          "callee": "TAILQ_INIT",
          "args": [
            "&ssh->public_keys"
          ],
          "line": 238
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "TAILQ_INIT",
          "args": [
            "&ssh->private_keys"
          ],
          "line": 237
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "TAILQ_INIT",
          "args": [
            "&state->outgoing"
          ],
          "line": 236
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sshbuf_new",
          "args": [],
          "line": 234
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_new",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf.c",
          "lines": "68-85",
          "snippet": "struct sshbuf *\nsshbuf_new(void)\n{\n\tstruct sshbuf *ret;\n\n\tif ((ret = calloc(sizeof(*ret), 1)) == NULL)\n\t\treturn NULL;\n\tret->alloc = SSHBUF_SIZE_INIT;\n\tret->max_size = SSHBUF_SIZE_MAX;\n\tret->readonly = 0;\n\tret->refcount = 1;\n\tret->parent = NULL;\n\tif ((ret->cd = ret->d = calloc(1, ret->alloc)) == NULL) {\n\t\tfree(ret);\n\t\treturn NULL;\n\t}\n\treturn ret;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <signal.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <signal.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nstruct sshbuf *\nsshbuf_new(void)\n{\n\tstruct sshbuf *ret;\n\n\tif ((ret = calloc(sizeof(*ret), 1)) == NULL)\n\t\treturn NULL;\n\tret->alloc = SSHBUF_SIZE_INIT;\n\tret->max_size = SSHBUF_SIZE_MAX;\n\tret->readonly = 0;\n\tret->refcount = 1;\n\tret->parent = NULL;\n\tif ((ret->cd = ret->d = calloc(1, ret->alloc)) == NULL) {\n\t\tfree(ret);\n\t\treturn NULL;\n\t}\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "calloc",
          "args": [
            "1",
            "sizeof(*state)"
          ],
          "line": 230
        },
        "resolved": true,
        "details": {
          "function_name": "xcalloc",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/xmalloc.c",
          "lines": "52-66",
          "snippet": "void *\nxcalloc(size_t nmemb, size_t size)\n{\n\tvoid *ptr;\n\n\tif (size == 0 || nmemb == 0)\n\t\tfatal(\"xcalloc: zero size\");\n\tif (SIZE_MAX / nmemb < size)\n\t\tfatal(\"xcalloc: nmemb * size > SIZE_MAX\");\n\tptr = calloc(nmemb, size);\n\tif (ptr == NULL)\n\t\tfatal(\"xcalloc: out of memory (allocating %zu bytes)\",\n\t\t    size * nmemb);\n\treturn ptr;\n}",
          "includes": [
            "#include \"log.h\"",
            "#include \"xmalloc.h\"",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdint.h>",
            "#include <stdarg.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n#include \"xmalloc.h\"\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdint.h>\n#include <stdarg.h>\n#include \"includes.h\"\n\nvoid *\nxcalloc(size_t nmemb, size_t size)\n{\n\tvoid *ptr;\n\n\tif (size == 0 || nmemb == 0)\n\t\tfatal(\"xcalloc: zero size\");\n\tif (SIZE_MAX / nmemb < size)\n\t\tfatal(\"xcalloc: nmemb * size > SIZE_MAX\");\n\tptr = calloc(nmemb, size);\n\tif (ptr == NULL)\n\t\tfatal(\"xcalloc: out of memory (allocating %zu bytes)\",\n\t\t    size * nmemb);\n\treturn ptr;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nstruct ssh *\nssh_alloc_session_state(void)\n{\n\tstruct ssh *ssh = NULL;\n\tstruct session_state *state = NULL;\n\n\tif ((ssh = calloc(1, sizeof(*ssh))) == NULL ||\n\t    (state = calloc(1, sizeof(*state))) == NULL ||\n\t    (state->input = sshbuf_new()) == NULL ||\n\t    (state->output = sshbuf_new()) == NULL ||\n\t    (state->outgoing_packet = sshbuf_new()) == NULL ||\n\t    (state->incoming_packet = sshbuf_new()) == NULL)\n\t\tgoto fail;\n\tTAILQ_INIT(&state->outgoing);\n\tTAILQ_INIT(&ssh->private_keys);\n\tTAILQ_INIT(&ssh->public_keys);\n\tstate->connection_in = -1;\n\tstate->connection_out = -1;\n\tstate->max_packet_size = 32768;\n\tstate->packet_timeout_ms = -1;\n\tstate->p_send.packets = state->p_read.packets = 0;\n\tstate->initialized = 1;\n\t/*\n\t * ssh_packet_send2() needs to queue packets until\n\t * we've done the initial key exchange.\n\t */\n\tstate->rekeying = 1;\n\tssh->state = state;\n\treturn ssh;\n fail:\n\tif (state) {\n\t\tsshbuf_free(state->input);\n\t\tsshbuf_free(state->output);\n\t\tsshbuf_free(state->incoming_packet);\n\t\tsshbuf_free(state->outgoing_packet);\n\t\tfree(state);\n\t}\n\tfree(ssh);\n\treturn NULL;\n}"
  }
]