[
  {
    "function_name": "sshbuf_put_eckey",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf-getput-crypto.c",
    "lines": "217-222",
    "snippet": "int\nsshbuf_put_eckey(struct sshbuf *buf, const EC_KEY *v)\n{\n\treturn sshbuf_put_ec(buf, EC_KEY_get0_public_key(v),\n\t    EC_KEY_get0_group(v));\n}",
    "includes": [
      "#include \"sshbuf.h\"",
      "#include \"ssherr.h\"",
      "# include <openssl/ec.h>",
      "#include <openssl/bn.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <stdlib.h>",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "sshbuf_put_ec",
          "args": [
            "buf",
            "EC_KEY_get0_public_key(v)",
            "EC_KEY_get0_group(v)"
          ],
          "line": 220
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_put_ec",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf-getput-crypto.c",
          "lines": "191-215",
          "snippet": "int\nsshbuf_put_ec(struct sshbuf *buf, const EC_POINT *v, const EC_GROUP *g)\n{\n\tu_char d[SSHBUF_MAX_ECPOINT];\n\tBN_CTX *bn_ctx;\n\tsize_t len;\n\tint ret;\n\n\tif ((bn_ctx = BN_CTX_new()) == NULL)\n\t\treturn SSH_ERR_ALLOC_FAIL;\n\tif ((len = EC_POINT_point2oct(g, v, POINT_CONVERSION_UNCOMPRESSED,\n\t    NULL, 0, bn_ctx)) > SSHBUF_MAX_ECPOINT) {\n\t\tBN_CTX_free(bn_ctx);\n\t\treturn SSH_ERR_INVALID_ARGUMENT;\n\t}\n\tif (EC_POINT_point2oct(g, v, POINT_CONVERSION_UNCOMPRESSED,\n\t    d, len, bn_ctx) != len) {\n\t\tBN_CTX_free(bn_ctx);\n\t\treturn SSH_ERR_INTERNAL_ERROR; /* Shouldn't happen */\n\t}\n\tBN_CTX_free(bn_ctx);\n\tret = sshbuf_put_string(buf, d, len);\n\texplicit_bzero(d, len);\n\treturn ret;\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "# include <openssl/ec.h>",
            "#include <openssl/bn.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n# include <openssl/ec.h>\n#include <openssl/bn.h>\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshbuf_put_ec(struct sshbuf *buf, const EC_POINT *v, const EC_GROUP *g)\n{\n\tu_char d[SSHBUF_MAX_ECPOINT];\n\tBN_CTX *bn_ctx;\n\tsize_t len;\n\tint ret;\n\n\tif ((bn_ctx = BN_CTX_new()) == NULL)\n\t\treturn SSH_ERR_ALLOC_FAIL;\n\tif ((len = EC_POINT_point2oct(g, v, POINT_CONVERSION_UNCOMPRESSED,\n\t    NULL, 0, bn_ctx)) > SSHBUF_MAX_ECPOINT) {\n\t\tBN_CTX_free(bn_ctx);\n\t\treturn SSH_ERR_INVALID_ARGUMENT;\n\t}\n\tif (EC_POINT_point2oct(g, v, POINT_CONVERSION_UNCOMPRESSED,\n\t    d, len, bn_ctx) != len) {\n\t\tBN_CTX_free(bn_ctx);\n\t\treturn SSH_ERR_INTERNAL_ERROR; /* Shouldn't happen */\n\t}\n\tBN_CTX_free(bn_ctx);\n\tret = sshbuf_put_string(buf, d, len);\n\texplicit_bzero(d, len);\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "EC_KEY_get0_group",
          "args": [
            "v"
          ],
          "line": 221
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "EC_KEY_get0_public_key",
          "args": [
            "v"
          ],
          "line": 220
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n# include <openssl/ec.h>\n#include <openssl/bn.h>\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshbuf_put_eckey(struct sshbuf *buf, const EC_KEY *v)\n{\n\treturn sshbuf_put_ec(buf, EC_KEY_get0_public_key(v),\n\t    EC_KEY_get0_group(v));\n}"
  },
  {
    "function_name": "sshbuf_put_ec",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf-getput-crypto.c",
    "lines": "191-215",
    "snippet": "int\nsshbuf_put_ec(struct sshbuf *buf, const EC_POINT *v, const EC_GROUP *g)\n{\n\tu_char d[SSHBUF_MAX_ECPOINT];\n\tBN_CTX *bn_ctx;\n\tsize_t len;\n\tint ret;\n\n\tif ((bn_ctx = BN_CTX_new()) == NULL)\n\t\treturn SSH_ERR_ALLOC_FAIL;\n\tif ((len = EC_POINT_point2oct(g, v, POINT_CONVERSION_UNCOMPRESSED,\n\t    NULL, 0, bn_ctx)) > SSHBUF_MAX_ECPOINT) {\n\t\tBN_CTX_free(bn_ctx);\n\t\treturn SSH_ERR_INVALID_ARGUMENT;\n\t}\n\tif (EC_POINT_point2oct(g, v, POINT_CONVERSION_UNCOMPRESSED,\n\t    d, len, bn_ctx) != len) {\n\t\tBN_CTX_free(bn_ctx);\n\t\treturn SSH_ERR_INTERNAL_ERROR; /* Shouldn't happen */\n\t}\n\tBN_CTX_free(bn_ctx);\n\tret = sshbuf_put_string(buf, d, len);\n\texplicit_bzero(d, len);\n\treturn ret;\n}",
    "includes": [
      "#include \"sshbuf.h\"",
      "#include \"ssherr.h\"",
      "# include <openssl/ec.h>",
      "#include <openssl/bn.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <stdlib.h>",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "explicit_bzero",
          "args": [
            "d",
            "len"
          ],
          "line": 213
        },
        "resolved": true,
        "details": {
          "function_name": "explicit_bzero",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/openbsd-compat/explicit_bzero.c",
          "lines": "36-53",
          "snippet": "void\nexplicit_bzero(void *p, size_t n)\n{\n\tif (n == 0)\n\t\treturn;\n\t/*\n\t * clang -fsanitize=memory needs to intercept memset-like functions\n\t * to correctly detect memory initialisation. Make sure one is called\n\t * directly since our indirection trick above successfully confuses it.\n\t */\n#if defined(__has_feature)\n# if __has_feature(memory_sanitizer)\n\tmemset(p, 0, n);\n# endif\n#endif\n\n\tssh_bzero(p, n);\n}",
          "includes": [
            "#include <string.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include \"includes.h\"\n\nvoid\nexplicit_bzero(void *p, size_t n)\n{\n\tif (n == 0)\n\t\treturn;\n\t/*\n\t * clang -fsanitize=memory needs to intercept memset-like functions\n\t * to correctly detect memory initialisation. Make sure one is called\n\t * directly since our indirection trick above successfully confuses it.\n\t */\n#if defined(__has_feature)\n# if __has_feature(memory_sanitizer)\n\tmemset(p, 0, n);\n# endif\n#endif\n\n\tssh_bzero(p, n);\n}"
        }
      },
      {
        "call_info": {
          "callee": "sshbuf_put_string",
          "args": [
            "buf",
            "d",
            "len"
          ],
          "line": 212
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_put_string",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf-getput-basic.c",
          "lines": "347-363",
          "snippet": "int\nsshbuf_put_string(struct sshbuf *buf, const void *v, size_t len)\n{\n\tu_char *d;\n\tint r;\n\n\tif (len > SSHBUF_SIZE_MAX - 4) {\n\t\tSSHBUF_DBG((\"SSH_ERR_NO_BUFFER_SPACE\"));\n\t\treturn SSH_ERR_NO_BUFFER_SPACE;\n\t}\n\tif ((r = sshbuf_reserve(buf, len + 4, &d)) < 0)\n\t\treturn r;\n\tPOKE_U32(d, len);\n\tif (len != 0)\n\t\tmemcpy(d + 4, v, len);\n\treturn 0;\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <stdarg.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <stdarg.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshbuf_put_string(struct sshbuf *buf, const void *v, size_t len)\n{\n\tu_char *d;\n\tint r;\n\n\tif (len > SSHBUF_SIZE_MAX - 4) {\n\t\tSSHBUF_DBG((\"SSH_ERR_NO_BUFFER_SPACE\"));\n\t\treturn SSH_ERR_NO_BUFFER_SPACE;\n\t}\n\tif ((r = sshbuf_reserve(buf, len + 4, &d)) < 0)\n\t\treturn r;\n\tPOKE_U32(d, len);\n\tif (len != 0)\n\t\tmemcpy(d + 4, v, len);\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "BN_CTX_free",
          "args": [
            "bn_ctx"
          ],
          "line": 211
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "BN_CTX_free",
          "args": [
            "bn_ctx"
          ],
          "line": 208
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "EC_POINT_point2oct",
          "args": [
            "g",
            "v",
            "POINT_CONVERSION_UNCOMPRESSED",
            "d",
            "len",
            "bn_ctx"
          ],
          "line": 206
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "BN_CTX_free",
          "args": [
            "bn_ctx"
          ],
          "line": 203
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "EC_POINT_point2oct",
          "args": [
            "g",
            "v",
            "POINT_CONVERSION_UNCOMPRESSED",
            "NULL",
            "0",
            "bn_ctx"
          ],
          "line": 201
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "BN_CTX_new",
          "args": [],
          "line": 199
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n# include <openssl/ec.h>\n#include <openssl/bn.h>\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshbuf_put_ec(struct sshbuf *buf, const EC_POINT *v, const EC_GROUP *g)\n{\n\tu_char d[SSHBUF_MAX_ECPOINT];\n\tBN_CTX *bn_ctx;\n\tsize_t len;\n\tint ret;\n\n\tif ((bn_ctx = BN_CTX_new()) == NULL)\n\t\treturn SSH_ERR_ALLOC_FAIL;\n\tif ((len = EC_POINT_point2oct(g, v, POINT_CONVERSION_UNCOMPRESSED,\n\t    NULL, 0, bn_ctx)) > SSHBUF_MAX_ECPOINT) {\n\t\tBN_CTX_free(bn_ctx);\n\t\treturn SSH_ERR_INVALID_ARGUMENT;\n\t}\n\tif (EC_POINT_point2oct(g, v, POINT_CONVERSION_UNCOMPRESSED,\n\t    d, len, bn_ctx) != len) {\n\t\tBN_CTX_free(bn_ctx);\n\t\treturn SSH_ERR_INTERNAL_ERROR; /* Shouldn't happen */\n\t}\n\tBN_CTX_free(bn_ctx);\n\tret = sshbuf_put_string(buf, d, len);\n\texplicit_bzero(d, len);\n\treturn ret;\n}"
  },
  {
    "function_name": "sshbuf_put_bignum1",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf-getput-crypto.c",
    "lines": "168-188",
    "snippet": "int\nsshbuf_put_bignum1(struct sshbuf *buf, const BIGNUM *v)\n{\n\tint r, len_bits = BN_num_bits(v);\n\tsize_t len_bytes = (len_bits + 7) / 8;\n\tu_char d[SSHBUF_MAX_BIGNUM], *dp;\n\n\tif (len_bits < 0 || len_bytes > SSHBUF_MAX_BIGNUM)\n\t\treturn SSH_ERR_INVALID_ARGUMENT;\n\tif (BN_bn2bin(v, d) != (int)len_bytes)\n\t\treturn SSH_ERR_INTERNAL_ERROR; /* Shouldn't happen */\n\tif ((r = sshbuf_reserve(buf, len_bytes + 2, &dp)) < 0) {\n\t\texplicit_bzero(d, sizeof(d));\n\t\treturn r;\n\t}\n\tPOKE_U16(dp, len_bits);\n\tif (len_bytes != 0)\n\t\tmemcpy(dp + 2, d, len_bytes);\n\texplicit_bzero(d, sizeof(d));\n\treturn 0;\n}",
    "includes": [
      "#include \"sshbuf.h\"",
      "#include \"ssherr.h\"",
      "# include <openssl/ec.h>",
      "#include <openssl/bn.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <stdlib.h>",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "explicit_bzero",
          "args": [
            "d",
            "sizeof(d)"
          ],
          "line": 186
        },
        "resolved": true,
        "details": {
          "function_name": "explicit_bzero",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/openbsd-compat/explicit_bzero.c",
          "lines": "36-53",
          "snippet": "void\nexplicit_bzero(void *p, size_t n)\n{\n\tif (n == 0)\n\t\treturn;\n\t/*\n\t * clang -fsanitize=memory needs to intercept memset-like functions\n\t * to correctly detect memory initialisation. Make sure one is called\n\t * directly since our indirection trick above successfully confuses it.\n\t */\n#if defined(__has_feature)\n# if __has_feature(memory_sanitizer)\n\tmemset(p, 0, n);\n# endif\n#endif\n\n\tssh_bzero(p, n);\n}",
          "includes": [
            "#include <string.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include \"includes.h\"\n\nvoid\nexplicit_bzero(void *p, size_t n)\n{\n\tif (n == 0)\n\t\treturn;\n\t/*\n\t * clang -fsanitize=memory needs to intercept memset-like functions\n\t * to correctly detect memory initialisation. Make sure one is called\n\t * directly since our indirection trick above successfully confuses it.\n\t */\n#if defined(__has_feature)\n# if __has_feature(memory_sanitizer)\n\tmemset(p, 0, n);\n# endif\n#endif\n\n\tssh_bzero(p, n);\n}"
        }
      },
      {
        "call_info": {
          "callee": "memcpy",
          "args": [
            "dp + 2",
            "d",
            "len_bytes"
          ],
          "line": 185
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "POKE_U16",
          "args": [
            "dp",
            "len_bits"
          ],
          "line": 183
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sshbuf_reserve",
          "args": [
            "buf",
            "len_bytes + 2",
            "&dp"
          ],
          "line": 179
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_reserve",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf.c",
          "lines": "343-361",
          "snippet": "int\nsshbuf_reserve(struct sshbuf *buf, size_t len, u_char **dpp)\n{\n\tu_char *dp;\n\tint r;\n\n\tif (dpp != NULL)\n\t\t*dpp = NULL;\n\n\tSSHBUF_DBG((\"reserve buf = %p len = %zu\", buf, len));\n\tif ((r = sshbuf_allocate(buf, len)) != 0)\n\t\treturn r;\n\n\tdp = buf->d + buf->size;\n\tbuf->size += len;\n\tif (dpp != NULL)\n\t\t*dpp = dp;\n\treturn 0;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <signal.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <signal.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshbuf_reserve(struct sshbuf *buf, size_t len, u_char **dpp)\n{\n\tu_char *dp;\n\tint r;\n\n\tif (dpp != NULL)\n\t\t*dpp = NULL;\n\n\tSSHBUF_DBG((\"reserve buf = %p len = %zu\", buf, len));\n\tif ((r = sshbuf_allocate(buf, len)) != 0)\n\t\treturn r;\n\n\tdp = buf->d + buf->size;\n\tbuf->size += len;\n\tif (dpp != NULL)\n\t\t*dpp = dp;\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "BN_bn2bin",
          "args": [
            "v",
            "d"
          ],
          "line": 177
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "BN_num_bits",
          "args": [
            "v"
          ],
          "line": 171
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n# include <openssl/ec.h>\n#include <openssl/bn.h>\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshbuf_put_bignum1(struct sshbuf *buf, const BIGNUM *v)\n{\n\tint r, len_bits = BN_num_bits(v);\n\tsize_t len_bytes = (len_bits + 7) / 8;\n\tu_char d[SSHBUF_MAX_BIGNUM], *dp;\n\n\tif (len_bits < 0 || len_bytes > SSHBUF_MAX_BIGNUM)\n\t\treturn SSH_ERR_INVALID_ARGUMENT;\n\tif (BN_bn2bin(v, d) != (int)len_bytes)\n\t\treturn SSH_ERR_INTERNAL_ERROR; /* Shouldn't happen */\n\tif ((r = sshbuf_reserve(buf, len_bytes + 2, &dp)) < 0) {\n\t\texplicit_bzero(d, sizeof(d));\n\t\treturn r;\n\t}\n\tPOKE_U16(dp, len_bits);\n\tif (len_bytes != 0)\n\t\tmemcpy(dp + 2, d, len_bytes);\n\texplicit_bzero(d, sizeof(d));\n\treturn 0;\n}"
  },
  {
    "function_name": "sshbuf_put_bignum2",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf-getput-crypto.c",
    "lines": "146-166",
    "snippet": "int\nsshbuf_put_bignum2(struct sshbuf *buf, const BIGNUM *v)\n{\n\tu_char d[SSHBUF_MAX_BIGNUM + 1];\n\tint len = BN_num_bytes(v), prepend = 0, r;\n\n\tif (len < 0 || len > SSHBUF_MAX_BIGNUM)\n\t\treturn SSH_ERR_INVALID_ARGUMENT;\n\t*d = '\\0';\n\tif (BN_bn2bin(v, d + 1) != len)\n\t\treturn SSH_ERR_INTERNAL_ERROR; /* Shouldn't happen */\n\t/* If MSB is set, prepend a \\0 */\n\tif (len > 0 && (d[1] & 0x80) != 0)\n\t\tprepend = 1;\n\tif ((r = sshbuf_put_string(buf, d + 1 - prepend, len + prepend)) < 0) {\n\t\texplicit_bzero(d, sizeof(d));\n\t\treturn r;\n\t}\n\texplicit_bzero(d, sizeof(d));\n\treturn 0;\n}",
    "includes": [
      "#include \"sshbuf.h\"",
      "#include \"ssherr.h\"",
      "# include <openssl/ec.h>",
      "#include <openssl/bn.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <stdlib.h>",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "explicit_bzero",
          "args": [
            "d",
            "sizeof(d)"
          ],
          "line": 164
        },
        "resolved": true,
        "details": {
          "function_name": "explicit_bzero",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/openbsd-compat/explicit_bzero.c",
          "lines": "36-53",
          "snippet": "void\nexplicit_bzero(void *p, size_t n)\n{\n\tif (n == 0)\n\t\treturn;\n\t/*\n\t * clang -fsanitize=memory needs to intercept memset-like functions\n\t * to correctly detect memory initialisation. Make sure one is called\n\t * directly since our indirection trick above successfully confuses it.\n\t */\n#if defined(__has_feature)\n# if __has_feature(memory_sanitizer)\n\tmemset(p, 0, n);\n# endif\n#endif\n\n\tssh_bzero(p, n);\n}",
          "includes": [
            "#include <string.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include \"includes.h\"\n\nvoid\nexplicit_bzero(void *p, size_t n)\n{\n\tif (n == 0)\n\t\treturn;\n\t/*\n\t * clang -fsanitize=memory needs to intercept memset-like functions\n\t * to correctly detect memory initialisation. Make sure one is called\n\t * directly since our indirection trick above successfully confuses it.\n\t */\n#if defined(__has_feature)\n# if __has_feature(memory_sanitizer)\n\tmemset(p, 0, n);\n# endif\n#endif\n\n\tssh_bzero(p, n);\n}"
        }
      },
      {
        "call_info": {
          "callee": "sshbuf_put_string",
          "args": [
            "buf",
            "d + 1 - prepend",
            "len + prepend"
          ],
          "line": 160
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_put_string",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf-getput-basic.c",
          "lines": "347-363",
          "snippet": "int\nsshbuf_put_string(struct sshbuf *buf, const void *v, size_t len)\n{\n\tu_char *d;\n\tint r;\n\n\tif (len > SSHBUF_SIZE_MAX - 4) {\n\t\tSSHBUF_DBG((\"SSH_ERR_NO_BUFFER_SPACE\"));\n\t\treturn SSH_ERR_NO_BUFFER_SPACE;\n\t}\n\tif ((r = sshbuf_reserve(buf, len + 4, &d)) < 0)\n\t\treturn r;\n\tPOKE_U32(d, len);\n\tif (len != 0)\n\t\tmemcpy(d + 4, v, len);\n\treturn 0;\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <stdarg.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <stdarg.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshbuf_put_string(struct sshbuf *buf, const void *v, size_t len)\n{\n\tu_char *d;\n\tint r;\n\n\tif (len > SSHBUF_SIZE_MAX - 4) {\n\t\tSSHBUF_DBG((\"SSH_ERR_NO_BUFFER_SPACE\"));\n\t\treturn SSH_ERR_NO_BUFFER_SPACE;\n\t}\n\tif ((r = sshbuf_reserve(buf, len + 4, &d)) < 0)\n\t\treturn r;\n\tPOKE_U32(d, len);\n\tif (len != 0)\n\t\tmemcpy(d + 4, v, len);\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "BN_bn2bin",
          "args": [
            "v",
            "d + 1"
          ],
          "line": 155
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "BN_num_bytes",
          "args": [
            "v"
          ],
          "line": 150
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n# include <openssl/ec.h>\n#include <openssl/bn.h>\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshbuf_put_bignum2(struct sshbuf *buf, const BIGNUM *v)\n{\n\tu_char d[SSHBUF_MAX_BIGNUM + 1];\n\tint len = BN_num_bytes(v), prepend = 0, r;\n\n\tif (len < 0 || len > SSHBUF_MAX_BIGNUM)\n\t\treturn SSH_ERR_INVALID_ARGUMENT;\n\t*d = '\\0';\n\tif (BN_bn2bin(v, d + 1) != len)\n\t\treturn SSH_ERR_INTERNAL_ERROR; /* Shouldn't happen */\n\t/* If MSB is set, prepend a \\0 */\n\tif (len > 0 && (d[1] & 0x80) != 0)\n\t\tprepend = 1;\n\tif ((r = sshbuf_put_string(buf, d + 1 - prepend, len + prepend)) < 0) {\n\t\texplicit_bzero(d, sizeof(d));\n\t\treturn r;\n\t}\n\texplicit_bzero(d, sizeof(d));\n\treturn 0;\n}"
  },
  {
    "function_name": "sshbuf_get_eckey",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf-getput-crypto.c",
    "lines": "110-143",
    "snippet": "int\nsshbuf_get_eckey(struct sshbuf *buf, EC_KEY *v)\n{\n\tEC_POINT *pt = EC_POINT_new(EC_KEY_get0_group(v));\n\tint r;\n\tconst u_char *d;\n\tsize_t len;\n\n\tif (pt == NULL) {\n\t\tSSHBUF_DBG((\"SSH_ERR_ALLOC_FAIL\"));\n\t\treturn SSH_ERR_ALLOC_FAIL;\n\t}\n\tif ((r = sshbuf_peek_string_direct(buf, &d, &len)) < 0) {\n\t\tEC_POINT_free(pt);\n\t\treturn r;\n\t}\n\tif ((r = get_ec(d, len, pt, EC_KEY_get0_group(v))) != 0) {\n\t\tEC_POINT_free(pt);\n\t\treturn r;\n\t}\n\tif (EC_KEY_set_public_key(v, pt) != 1) {\n\t\tEC_POINT_free(pt);\n\t\treturn SSH_ERR_ALLOC_FAIL; /* XXX assumption */\n\t}\n\tEC_POINT_free(pt);\n\t/* Skip string */\n\tif (sshbuf_get_string_direct(buf, NULL, NULL) != 0) {\n\t\t/* Shouldn't happen */\n\t\tSSHBUF_DBG((\"SSH_ERR_INTERNAL_ERROR\"));\n\t\tSSHBUF_ABORT();\n\t\treturn SSH_ERR_INTERNAL_ERROR;\n\t}\n\treturn 0;\t\n}",
    "includes": [
      "#include \"sshbuf.h\"",
      "#include \"ssherr.h\"",
      "# include <openssl/ec.h>",
      "#include <openssl/bn.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <stdlib.h>",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "SSHBUF_ABORT",
          "args": [],
          "line": 139
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "SSHBUF_DBG",
          "args": [
            "(\"SSH_ERR_INTERNAL_ERROR\")"
          ],
          "line": 138
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sshbuf_get_string_direct",
          "args": [
            "buf",
            "NULL",
            "NULL"
          ],
          "line": 136
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_get_string_direct",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf-getput-basic.c",
          "lines": "123-147",
          "snippet": "int\nsshbuf_get_string_direct(struct sshbuf *buf, const u_char **valp, size_t *lenp)\n{\n\tsize_t len;\n\tconst u_char *p;\n\tint r;\n\n\tif (valp != NULL)\n\t\t*valp = NULL;\n\tif (lenp != NULL)\n\t\t*lenp = 0;\n\tif ((r = sshbuf_peek_string_direct(buf, &p, &len)) < 0)\n\t\treturn r;\n\tif (valp != NULL)\n\t\t*valp = p;\n\tif (lenp != NULL)\n\t\t*lenp = len;\n\tif (sshbuf_consume(buf, len + 4) != 0) {\n\t\t/* Shouldn't happen */\n\t\tSSHBUF_DBG((\"SSH_ERR_INTERNAL_ERROR\"));\n\t\tSSHBUF_ABORT();\n\t\treturn SSH_ERR_INTERNAL_ERROR;\n\t}\n\treturn 0;\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <stdarg.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <stdarg.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshbuf_get_string_direct(struct sshbuf *buf, const u_char **valp, size_t *lenp)\n{\n\tsize_t len;\n\tconst u_char *p;\n\tint r;\n\n\tif (valp != NULL)\n\t\t*valp = NULL;\n\tif (lenp != NULL)\n\t\t*lenp = 0;\n\tif ((r = sshbuf_peek_string_direct(buf, &p, &len)) < 0)\n\t\treturn r;\n\tif (valp != NULL)\n\t\t*valp = p;\n\tif (lenp != NULL)\n\t\t*lenp = len;\n\tif (sshbuf_consume(buf, len + 4) != 0) {\n\t\t/* Shouldn't happen */\n\t\tSSHBUF_DBG((\"SSH_ERR_INTERNAL_ERROR\"));\n\t\tSSHBUF_ABORT();\n\t\treturn SSH_ERR_INTERNAL_ERROR;\n\t}\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "EC_POINT_free",
          "args": [
            "pt"
          ],
          "line": 134
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "EC_POINT_free",
          "args": [
            "pt"
          ],
          "line": 131
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "EC_KEY_set_public_key",
          "args": [
            "v",
            "pt"
          ],
          "line": 130
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "EC_POINT_free",
          "args": [
            "pt"
          ],
          "line": 127
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "get_ec",
          "args": [
            "d",
            "len",
            "pt",
            "EC_KEY_get0_group(v)"
          ],
          "line": 126
        },
        "resolved": true,
        "details": {
          "function_name": "get_ec",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf-getput-crypto.c",
          "lines": "75-87",
          "snippet": "static int\nget_ec(const u_char *d, size_t len, EC_POINT *v, const EC_GROUP *g)\n{\n\t/* Refuse overlong bignums */\n\tif (len == 0 || len > SSHBUF_MAX_ECPOINT)\n\t\treturn SSH_ERR_ECPOINT_TOO_LARGE;\n\t/* Only handle uncompressed points */\n\tif (*d != POINT_CONVERSION_UNCOMPRESSED)\n\t\treturn SSH_ERR_INVALID_FORMAT;\n\tif (v != NULL && EC_POINT_oct2point(g, v, d, len, NULL) != 1)\n\t\treturn SSH_ERR_INVALID_FORMAT; /* XXX assumption */\n\treturn 0;\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "# include <openssl/ec.h>",
            "#include <openssl/bn.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n# include <openssl/ec.h>\n#include <openssl/bn.h>\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nstatic int\nget_ec(const u_char *d, size_t len, EC_POINT *v, const EC_GROUP *g)\n{\n\t/* Refuse overlong bignums */\n\tif (len == 0 || len > SSHBUF_MAX_ECPOINT)\n\t\treturn SSH_ERR_ECPOINT_TOO_LARGE;\n\t/* Only handle uncompressed points */\n\tif (*d != POINT_CONVERSION_UNCOMPRESSED)\n\t\treturn SSH_ERR_INVALID_FORMAT;\n\tif (v != NULL && EC_POINT_oct2point(g, v, d, len, NULL) != 1)\n\t\treturn SSH_ERR_INVALID_FORMAT; /* XXX assumption */\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "EC_KEY_get0_group",
          "args": [
            "v"
          ],
          "line": 126
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "EC_POINT_free",
          "args": [
            "pt"
          ],
          "line": 123
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sshbuf_peek_string_direct",
          "args": [
            "buf",
            "&d",
            "&len"
          ],
          "line": 122
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_peek_string_direct",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf-getput-basic.c",
          "lines": "149-178",
          "snippet": "int\nsshbuf_peek_string_direct(const struct sshbuf *buf, const u_char **valp,\n    size_t *lenp)\n{\n\tu_int32_t len;\n\tconst u_char *p = sshbuf_ptr(buf);\n\n\tif (valp != NULL)\n\t\t*valp = NULL;\n\tif (lenp != NULL)\n\t\t*lenp = 0;\n\tif (sshbuf_len(buf) < 4) {\n\t\tSSHBUF_DBG((\"SSH_ERR_MESSAGE_INCOMPLETE\"));\n\t\treturn SSH_ERR_MESSAGE_INCOMPLETE;\n\t}\n\tlen = PEEK_U32(p);\n\tif (len > SSHBUF_SIZE_MAX - 4) {\n\t\tSSHBUF_DBG((\"SSH_ERR_STRING_TOO_LARGE\"));\n\t\treturn SSH_ERR_STRING_TOO_LARGE;\n\t}\n\tif (sshbuf_len(buf) - 4 < len) {\n\t\tSSHBUF_DBG((\"SSH_ERR_MESSAGE_INCOMPLETE\"));\n\t\treturn SSH_ERR_MESSAGE_INCOMPLETE;\n\t}\n\tif (valp != NULL)\n\t\t*valp = p + 4;\n\tif (lenp != NULL)\n\t\t*lenp = len;\n\treturn 0;\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <stdarg.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <stdarg.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshbuf_peek_string_direct(const struct sshbuf *buf, const u_char **valp,\n    size_t *lenp)\n{\n\tu_int32_t len;\n\tconst u_char *p = sshbuf_ptr(buf);\n\n\tif (valp != NULL)\n\t\t*valp = NULL;\n\tif (lenp != NULL)\n\t\t*lenp = 0;\n\tif (sshbuf_len(buf) < 4) {\n\t\tSSHBUF_DBG((\"SSH_ERR_MESSAGE_INCOMPLETE\"));\n\t\treturn SSH_ERR_MESSAGE_INCOMPLETE;\n\t}\n\tlen = PEEK_U32(p);\n\tif (len > SSHBUF_SIZE_MAX - 4) {\n\t\tSSHBUF_DBG((\"SSH_ERR_STRING_TOO_LARGE\"));\n\t\treturn SSH_ERR_STRING_TOO_LARGE;\n\t}\n\tif (sshbuf_len(buf) - 4 < len) {\n\t\tSSHBUF_DBG((\"SSH_ERR_MESSAGE_INCOMPLETE\"));\n\t\treturn SSH_ERR_MESSAGE_INCOMPLETE;\n\t}\n\tif (valp != NULL)\n\t\t*valp = p + 4;\n\tif (lenp != NULL)\n\t\t*lenp = len;\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "SSHBUF_DBG",
          "args": [
            "(\"SSH_ERR_ALLOC_FAIL\")"
          ],
          "line": 119
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "EC_POINT_new",
          "args": [
            "EC_KEY_get0_group(v)"
          ],
          "line": 113
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "EC_KEY_get0_group",
          "args": [
            "v"
          ],
          "line": 113
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n# include <openssl/ec.h>\n#include <openssl/bn.h>\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshbuf_get_eckey(struct sshbuf *buf, EC_KEY *v)\n{\n\tEC_POINT *pt = EC_POINT_new(EC_KEY_get0_group(v));\n\tint r;\n\tconst u_char *d;\n\tsize_t len;\n\n\tif (pt == NULL) {\n\t\tSSHBUF_DBG((\"SSH_ERR_ALLOC_FAIL\"));\n\t\treturn SSH_ERR_ALLOC_FAIL;\n\t}\n\tif ((r = sshbuf_peek_string_direct(buf, &d, &len)) < 0) {\n\t\tEC_POINT_free(pt);\n\t\treturn r;\n\t}\n\tif ((r = get_ec(d, len, pt, EC_KEY_get0_group(v))) != 0) {\n\t\tEC_POINT_free(pt);\n\t\treturn r;\n\t}\n\tif (EC_KEY_set_public_key(v, pt) != 1) {\n\t\tEC_POINT_free(pt);\n\t\treturn SSH_ERR_ALLOC_FAIL; /* XXX assumption */\n\t}\n\tEC_POINT_free(pt);\n\t/* Skip string */\n\tif (sshbuf_get_string_direct(buf, NULL, NULL) != 0) {\n\t\t/* Shouldn't happen */\n\t\tSSHBUF_DBG((\"SSH_ERR_INTERNAL_ERROR\"));\n\t\tSSHBUF_ABORT();\n\t\treturn SSH_ERR_INTERNAL_ERROR;\n\t}\n\treturn 0;\t\n}"
  },
  {
    "function_name": "sshbuf_get_ec",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf-getput-crypto.c",
    "lines": "89-108",
    "snippet": "int\nsshbuf_get_ec(struct sshbuf *buf, EC_POINT *v, const EC_GROUP *g)\n{\n\tconst u_char *d;\n\tsize_t len;\n\tint r;\n\n\tif ((r = sshbuf_peek_string_direct(buf, &d, &len)) < 0)\n\t\treturn r;\n\tif ((r = get_ec(d, len, v, g)) != 0)\n\t\treturn r;\n\t/* Skip string */\n\tif (sshbuf_get_string_direct(buf, NULL, NULL) != 0) {\n\t\t/* Shouldn't happen */\n\t\tSSHBUF_DBG((\"SSH_ERR_INTERNAL_ERROR\"));\n\t\tSSHBUF_ABORT();\n\t\treturn SSH_ERR_INTERNAL_ERROR;\n\t}\n\treturn 0;\n}",
    "includes": [
      "#include \"sshbuf.h\"",
      "#include \"ssherr.h\"",
      "# include <openssl/ec.h>",
      "#include <openssl/bn.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <stdlib.h>",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "SSHBUF_ABORT",
          "args": [],
          "line": 104
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "SSHBUF_DBG",
          "args": [
            "(\"SSH_ERR_INTERNAL_ERROR\")"
          ],
          "line": 103
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sshbuf_get_string_direct",
          "args": [
            "buf",
            "NULL",
            "NULL"
          ],
          "line": 101
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_get_string_direct",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf-getput-basic.c",
          "lines": "123-147",
          "snippet": "int\nsshbuf_get_string_direct(struct sshbuf *buf, const u_char **valp, size_t *lenp)\n{\n\tsize_t len;\n\tconst u_char *p;\n\tint r;\n\n\tif (valp != NULL)\n\t\t*valp = NULL;\n\tif (lenp != NULL)\n\t\t*lenp = 0;\n\tif ((r = sshbuf_peek_string_direct(buf, &p, &len)) < 0)\n\t\treturn r;\n\tif (valp != NULL)\n\t\t*valp = p;\n\tif (lenp != NULL)\n\t\t*lenp = len;\n\tif (sshbuf_consume(buf, len + 4) != 0) {\n\t\t/* Shouldn't happen */\n\t\tSSHBUF_DBG((\"SSH_ERR_INTERNAL_ERROR\"));\n\t\tSSHBUF_ABORT();\n\t\treturn SSH_ERR_INTERNAL_ERROR;\n\t}\n\treturn 0;\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <stdarg.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <stdarg.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshbuf_get_string_direct(struct sshbuf *buf, const u_char **valp, size_t *lenp)\n{\n\tsize_t len;\n\tconst u_char *p;\n\tint r;\n\n\tif (valp != NULL)\n\t\t*valp = NULL;\n\tif (lenp != NULL)\n\t\t*lenp = 0;\n\tif ((r = sshbuf_peek_string_direct(buf, &p, &len)) < 0)\n\t\treturn r;\n\tif (valp != NULL)\n\t\t*valp = p;\n\tif (lenp != NULL)\n\t\t*lenp = len;\n\tif (sshbuf_consume(buf, len + 4) != 0) {\n\t\t/* Shouldn't happen */\n\t\tSSHBUF_DBG((\"SSH_ERR_INTERNAL_ERROR\"));\n\t\tSSHBUF_ABORT();\n\t\treturn SSH_ERR_INTERNAL_ERROR;\n\t}\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "get_ec",
          "args": [
            "d",
            "len",
            "v",
            "g"
          ],
          "line": 98
        },
        "resolved": true,
        "details": {
          "function_name": "get_ec",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf-getput-crypto.c",
          "lines": "75-87",
          "snippet": "static int\nget_ec(const u_char *d, size_t len, EC_POINT *v, const EC_GROUP *g)\n{\n\t/* Refuse overlong bignums */\n\tif (len == 0 || len > SSHBUF_MAX_ECPOINT)\n\t\treturn SSH_ERR_ECPOINT_TOO_LARGE;\n\t/* Only handle uncompressed points */\n\tif (*d != POINT_CONVERSION_UNCOMPRESSED)\n\t\treturn SSH_ERR_INVALID_FORMAT;\n\tif (v != NULL && EC_POINT_oct2point(g, v, d, len, NULL) != 1)\n\t\treturn SSH_ERR_INVALID_FORMAT; /* XXX assumption */\n\treturn 0;\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "# include <openssl/ec.h>",
            "#include <openssl/bn.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n# include <openssl/ec.h>\n#include <openssl/bn.h>\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nstatic int\nget_ec(const u_char *d, size_t len, EC_POINT *v, const EC_GROUP *g)\n{\n\t/* Refuse overlong bignums */\n\tif (len == 0 || len > SSHBUF_MAX_ECPOINT)\n\t\treturn SSH_ERR_ECPOINT_TOO_LARGE;\n\t/* Only handle uncompressed points */\n\tif (*d != POINT_CONVERSION_UNCOMPRESSED)\n\t\treturn SSH_ERR_INVALID_FORMAT;\n\tif (v != NULL && EC_POINT_oct2point(g, v, d, len, NULL) != 1)\n\t\treturn SSH_ERR_INVALID_FORMAT; /* XXX assumption */\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "sshbuf_peek_string_direct",
          "args": [
            "buf",
            "&d",
            "&len"
          ],
          "line": 96
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_peek_string_direct",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf-getput-basic.c",
          "lines": "149-178",
          "snippet": "int\nsshbuf_peek_string_direct(const struct sshbuf *buf, const u_char **valp,\n    size_t *lenp)\n{\n\tu_int32_t len;\n\tconst u_char *p = sshbuf_ptr(buf);\n\n\tif (valp != NULL)\n\t\t*valp = NULL;\n\tif (lenp != NULL)\n\t\t*lenp = 0;\n\tif (sshbuf_len(buf) < 4) {\n\t\tSSHBUF_DBG((\"SSH_ERR_MESSAGE_INCOMPLETE\"));\n\t\treturn SSH_ERR_MESSAGE_INCOMPLETE;\n\t}\n\tlen = PEEK_U32(p);\n\tif (len > SSHBUF_SIZE_MAX - 4) {\n\t\tSSHBUF_DBG((\"SSH_ERR_STRING_TOO_LARGE\"));\n\t\treturn SSH_ERR_STRING_TOO_LARGE;\n\t}\n\tif (sshbuf_len(buf) - 4 < len) {\n\t\tSSHBUF_DBG((\"SSH_ERR_MESSAGE_INCOMPLETE\"));\n\t\treturn SSH_ERR_MESSAGE_INCOMPLETE;\n\t}\n\tif (valp != NULL)\n\t\t*valp = p + 4;\n\tif (lenp != NULL)\n\t\t*lenp = len;\n\treturn 0;\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <stdarg.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <stdarg.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshbuf_peek_string_direct(const struct sshbuf *buf, const u_char **valp,\n    size_t *lenp)\n{\n\tu_int32_t len;\n\tconst u_char *p = sshbuf_ptr(buf);\n\n\tif (valp != NULL)\n\t\t*valp = NULL;\n\tif (lenp != NULL)\n\t\t*lenp = 0;\n\tif (sshbuf_len(buf) < 4) {\n\t\tSSHBUF_DBG((\"SSH_ERR_MESSAGE_INCOMPLETE\"));\n\t\treturn SSH_ERR_MESSAGE_INCOMPLETE;\n\t}\n\tlen = PEEK_U32(p);\n\tif (len > SSHBUF_SIZE_MAX - 4) {\n\t\tSSHBUF_DBG((\"SSH_ERR_STRING_TOO_LARGE\"));\n\t\treturn SSH_ERR_STRING_TOO_LARGE;\n\t}\n\tif (sshbuf_len(buf) - 4 < len) {\n\t\tSSHBUF_DBG((\"SSH_ERR_MESSAGE_INCOMPLETE\"));\n\t\treturn SSH_ERR_MESSAGE_INCOMPLETE;\n\t}\n\tif (valp != NULL)\n\t\t*valp = p + 4;\n\tif (lenp != NULL)\n\t\t*lenp = len;\n\treturn 0;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n# include <openssl/ec.h>\n#include <openssl/bn.h>\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshbuf_get_ec(struct sshbuf *buf, EC_POINT *v, const EC_GROUP *g)\n{\n\tconst u_char *d;\n\tsize_t len;\n\tint r;\n\n\tif ((r = sshbuf_peek_string_direct(buf, &d, &len)) < 0)\n\t\treturn r;\n\tif ((r = get_ec(d, len, v, g)) != 0)\n\t\treturn r;\n\t/* Skip string */\n\tif (sshbuf_get_string_direct(buf, NULL, NULL) != 0) {\n\t\t/* Shouldn't happen */\n\t\tSSHBUF_DBG((\"SSH_ERR_INTERNAL_ERROR\"));\n\t\tSSHBUF_ABORT();\n\t\treturn SSH_ERR_INTERNAL_ERROR;\n\t}\n\treturn 0;\n}"
  },
  {
    "function_name": "get_ec",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf-getput-crypto.c",
    "lines": "75-87",
    "snippet": "static int\nget_ec(const u_char *d, size_t len, EC_POINT *v, const EC_GROUP *g)\n{\n\t/* Refuse overlong bignums */\n\tif (len == 0 || len > SSHBUF_MAX_ECPOINT)\n\t\treturn SSH_ERR_ECPOINT_TOO_LARGE;\n\t/* Only handle uncompressed points */\n\tif (*d != POINT_CONVERSION_UNCOMPRESSED)\n\t\treturn SSH_ERR_INVALID_FORMAT;\n\tif (v != NULL && EC_POINT_oct2point(g, v, d, len, NULL) != 1)\n\t\treturn SSH_ERR_INVALID_FORMAT; /* XXX assumption */\n\treturn 0;\n}",
    "includes": [
      "#include \"sshbuf.h\"",
      "#include \"ssherr.h\"",
      "# include <openssl/ec.h>",
      "#include <openssl/bn.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <stdlib.h>",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "EC_POINT_oct2point",
          "args": [
            "g",
            "v",
            "d",
            "len",
            "NULL"
          ],
          "line": 84
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n# include <openssl/ec.h>\n#include <openssl/bn.h>\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nstatic int\nget_ec(const u_char *d, size_t len, EC_POINT *v, const EC_GROUP *g)\n{\n\t/* Refuse overlong bignums */\n\tif (len == 0 || len > SSHBUF_MAX_ECPOINT)\n\t\treturn SSH_ERR_ECPOINT_TOO_LARGE;\n\t/* Only handle uncompressed points */\n\tif (*d != POINT_CONVERSION_UNCOMPRESSED)\n\t\treturn SSH_ERR_INVALID_FORMAT;\n\tif (v != NULL && EC_POINT_oct2point(g, v, d, len, NULL) != 1)\n\t\treturn SSH_ERR_INVALID_FORMAT; /* XXX assumption */\n\treturn 0;\n}"
  },
  {
    "function_name": "sshbuf_get_bignum1",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf-getput-crypto.c",
    "lines": "48-72",
    "snippet": "int\nsshbuf_get_bignum1(struct sshbuf *buf, BIGNUM *v)\n{\n\tconst u_char *d = sshbuf_ptr(buf);\n\tu_int16_t len_bits;\n\tsize_t len_bytes;\n\n\t/* Length in bits */\n\tif (sshbuf_len(buf) < 2)\n\t\treturn SSH_ERR_MESSAGE_INCOMPLETE;\n\tlen_bits = PEEK_U16(d);\n\tlen_bytes = (len_bits + 7) >> 3;\n\tif (len_bytes > SSHBUF_MAX_BIGNUM)\n\t\treturn SSH_ERR_BIGNUM_TOO_LARGE;\n\tif (sshbuf_len(buf) < 2 + len_bytes)\n\t\treturn SSH_ERR_MESSAGE_INCOMPLETE;\n\tif (v != NULL && BN_bin2bn(d + 2, len_bytes, v) == NULL)\n\t\treturn SSH_ERR_ALLOC_FAIL;\n\tif (sshbuf_consume(buf, 2 + len_bytes) != 0) {\n\t\tSSHBUF_DBG((\"SSH_ERR_INTERNAL_ERROR\"));\n\t\tSSHBUF_ABORT();\n\t\treturn SSH_ERR_INTERNAL_ERROR;\n\t}\n\treturn 0;\n}",
    "includes": [
      "#include \"sshbuf.h\"",
      "#include \"ssherr.h\"",
      "# include <openssl/ec.h>",
      "#include <openssl/bn.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <stdlib.h>",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "SSHBUF_ABORT",
          "args": [],
          "line": 68
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "SSHBUF_DBG",
          "args": [
            "(\"SSH_ERR_INTERNAL_ERROR\")"
          ],
          "line": 67
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sshbuf_consume",
          "args": [
            "buf",
            "2 + len_bytes"
          ],
          "line": 66
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_consume_end",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf.c",
          "lines": "383-398",
          "snippet": "int\nsshbuf_consume_end(struct sshbuf *buf, size_t len)\n{\n\tint r;\n\n\tSSHBUF_DBG((\"len = %zu\", len));\n\tif ((r = sshbuf_check_sanity(buf)) != 0)\n\t\treturn r;\n\tif (len == 0)\n\t\treturn 0;\n\tif (len > sshbuf_len(buf))\n\t\treturn SSH_ERR_MESSAGE_INCOMPLETE;\n\tbuf->size -= len;\n\tSSHBUF_TELL(\"done\");\n\treturn 0;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <signal.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <signal.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshbuf_consume_end(struct sshbuf *buf, size_t len)\n{\n\tint r;\n\n\tSSHBUF_DBG((\"len = %zu\", len));\n\tif ((r = sshbuf_check_sanity(buf)) != 0)\n\t\treturn r;\n\tif (len == 0)\n\t\treturn 0;\n\tif (len > sshbuf_len(buf))\n\t\treturn SSH_ERR_MESSAGE_INCOMPLETE;\n\tbuf->size -= len;\n\tSSHBUF_TELL(\"done\");\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "BN_bin2bn",
          "args": [
            "d + 2",
            "len_bytes",
            "v"
          ],
          "line": 64
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sshbuf_len",
          "args": [
            "buf"
          ],
          "line": 62
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_len",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf.c",
          "lines": "252-258",
          "snippet": "size_t\nsshbuf_len(const struct sshbuf *buf)\n{\n\tif (sshbuf_check_sanity(buf) != 0)\n\t\treturn 0;\n\treturn buf->size - buf->off;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <signal.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <signal.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nsize_t\nsshbuf_len(const struct sshbuf *buf)\n{\n\tif (sshbuf_check_sanity(buf) != 0)\n\t\treturn 0;\n\treturn buf->size - buf->off;\n}"
        }
      },
      {
        "call_info": {
          "callee": "PEEK_U16",
          "args": [
            "d"
          ],
          "line": 58
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sshbuf_ptr",
          "args": [
            "buf"
          ],
          "line": 51
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_ptr",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf.c",
          "lines": "268-274",
          "snippet": "const u_char *\nsshbuf_ptr(const struct sshbuf *buf)\n{\n\tif (sshbuf_check_sanity(buf) != 0)\n\t\treturn NULL;\n\treturn buf->cd + buf->off;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <signal.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <signal.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nconst u_char *\nsshbuf_ptr(const struct sshbuf *buf)\n{\n\tif (sshbuf_check_sanity(buf) != 0)\n\t\treturn NULL;\n\treturn buf->cd + buf->off;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n# include <openssl/ec.h>\n#include <openssl/bn.h>\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshbuf_get_bignum1(struct sshbuf *buf, BIGNUM *v)\n{\n\tconst u_char *d = sshbuf_ptr(buf);\n\tu_int16_t len_bits;\n\tsize_t len_bytes;\n\n\t/* Length in bits */\n\tif (sshbuf_len(buf) < 2)\n\t\treturn SSH_ERR_MESSAGE_INCOMPLETE;\n\tlen_bits = PEEK_U16(d);\n\tlen_bytes = (len_bits + 7) >> 3;\n\tif (len_bytes > SSHBUF_MAX_BIGNUM)\n\t\treturn SSH_ERR_BIGNUM_TOO_LARGE;\n\tif (sshbuf_len(buf) < 2 + len_bytes)\n\t\treturn SSH_ERR_MESSAGE_INCOMPLETE;\n\tif (v != NULL && BN_bin2bn(d + 2, len_bytes, v) == NULL)\n\t\treturn SSH_ERR_ALLOC_FAIL;\n\tif (sshbuf_consume(buf, 2 + len_bytes) != 0) {\n\t\tSSHBUF_DBG((\"SSH_ERR_INTERNAL_ERROR\"));\n\t\tSSHBUF_ABORT();\n\t\treturn SSH_ERR_INTERNAL_ERROR;\n\t}\n\treturn 0;\n}"
  },
  {
    "function_name": "sshbuf_get_bignum2",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf-getput-crypto.c",
    "lines": "34-46",
    "snippet": "int\nsshbuf_get_bignum2(struct sshbuf *buf, BIGNUM *v)\n{\n\tconst u_char *d;\n\tsize_t len;\n\tint r;\n\n\tif ((r = sshbuf_get_bignum2_bytes_direct(buf, &d, &len)) != 0)\n\t\treturn r;\n\tif (v != NULL && BN_bin2bn(d, len, v) == NULL)\n\t\treturn SSH_ERR_ALLOC_FAIL;\n\treturn 0;\n}",
    "includes": [
      "#include \"sshbuf.h\"",
      "#include \"ssherr.h\"",
      "# include <openssl/ec.h>",
      "#include <openssl/bn.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <stdlib.h>",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "BN_bin2bn",
          "args": [
            "d",
            "len",
            "v"
          ],
          "line": 43
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sshbuf_get_bignum2_bytes_direct",
          "args": [
            "buf",
            "&d",
            "&len"
          ],
          "line": 41
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_get_bignum2_bytes_direct",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf-getput-basic.c",
          "lines": "430-464",
          "snippet": "int\nsshbuf_get_bignum2_bytes_direct(struct sshbuf *buf,\n    const u_char **valp, size_t *lenp)\n{\n\tconst u_char *d;\n\tsize_t len, olen;\n\tint r;\n\n\tif ((r = sshbuf_peek_string_direct(buf, &d, &olen)) < 0)\n\t\treturn r;\n\tlen = olen;\n\t/* Refuse negative (MSB set) bignums */\n\tif ((len != 0 && (*d & 0x80) != 0))\n\t\treturn SSH_ERR_BIGNUM_IS_NEGATIVE;\n\t/* Refuse overlong bignums, allow prepended \\0 to avoid MSB set */\n\tif (len > SSHBUF_MAX_BIGNUM + 1 ||\n\t    (len == SSHBUF_MAX_BIGNUM + 1 && *d != 0))\n\t\treturn SSH_ERR_BIGNUM_TOO_LARGE;\n\t/* Trim leading zeros */\n\twhile (len > 0 && *d == 0x00) {\n\t\td++;\n\t\tlen--;\n\t}\n\tif (valp != NULL)\n\t\t*valp = d;\n\tif (lenp != NULL)\n\t\t*lenp = len;\n\tif (sshbuf_consume(buf, olen + 4) != 0) {\n\t\t/* Shouldn't happen */\n\t\tSSHBUF_DBG((\"SSH_ERR_INTERNAL_ERROR\"));\n\t\tSSHBUF_ABORT();\n\t\treturn SSH_ERR_INTERNAL_ERROR;\n\t}\n\treturn 0;\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <stdarg.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <stdarg.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshbuf_get_bignum2_bytes_direct(struct sshbuf *buf,\n    const u_char **valp, size_t *lenp)\n{\n\tconst u_char *d;\n\tsize_t len, olen;\n\tint r;\n\n\tif ((r = sshbuf_peek_string_direct(buf, &d, &olen)) < 0)\n\t\treturn r;\n\tlen = olen;\n\t/* Refuse negative (MSB set) bignums */\n\tif ((len != 0 && (*d & 0x80) != 0))\n\t\treturn SSH_ERR_BIGNUM_IS_NEGATIVE;\n\t/* Refuse overlong bignums, allow prepended \\0 to avoid MSB set */\n\tif (len > SSHBUF_MAX_BIGNUM + 1 ||\n\t    (len == SSHBUF_MAX_BIGNUM + 1 && *d != 0))\n\t\treturn SSH_ERR_BIGNUM_TOO_LARGE;\n\t/* Trim leading zeros */\n\twhile (len > 0 && *d == 0x00) {\n\t\td++;\n\t\tlen--;\n\t}\n\tif (valp != NULL)\n\t\t*valp = d;\n\tif (lenp != NULL)\n\t\t*lenp = len;\n\tif (sshbuf_consume(buf, olen + 4) != 0) {\n\t\t/* Shouldn't happen */\n\t\tSSHBUF_DBG((\"SSH_ERR_INTERNAL_ERROR\"));\n\t\tSSHBUF_ABORT();\n\t\treturn SSH_ERR_INTERNAL_ERROR;\n\t}\n\treturn 0;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n# include <openssl/ec.h>\n#include <openssl/bn.h>\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshbuf_get_bignum2(struct sshbuf *buf, BIGNUM *v)\n{\n\tconst u_char *d;\n\tsize_t len;\n\tint r;\n\n\tif ((r = sshbuf_get_bignum2_bytes_direct(buf, &d, &len)) != 0)\n\t\treturn r;\n\tif (v != NULL && BN_bin2bn(d, len, v) == NULL)\n\t\treturn SSH_ERR_ALLOC_FAIL;\n\treturn 0;\n}"
  }
]