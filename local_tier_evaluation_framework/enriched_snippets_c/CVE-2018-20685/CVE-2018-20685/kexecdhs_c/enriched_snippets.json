[
  {
    "function_name": "input_kex_ecdh_init",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/kexecdhs.c",
    "lines": "60-201",
    "snippet": "static int\ninput_kex_ecdh_init(int type, u_int32_t seq, struct ssh *ssh)\n{\n\tstruct kex *kex = ssh->kex;\n\tEC_POINT *client_public;\n\tEC_KEY *server_key = NULL;\n\tconst EC_GROUP *group;\n\tconst EC_POINT *public_key;\n\tBIGNUM *shared_secret = NULL;\n\tstruct sshkey *server_host_private, *server_host_public;\n\tu_char *server_host_key_blob = NULL, *signature = NULL;\n\tu_char *kbuf = NULL;\n\tu_char hash[SSH_DIGEST_MAX_LENGTH];\n\tsize_t slen, sbloblen;\n\tsize_t klen = 0, hashlen;\n\tint r;\n\n\tif ((server_key = EC_KEY_new_by_curve_name(kex->ec_nid)) == NULL) {\n\t\tr = SSH_ERR_ALLOC_FAIL;\n\t\tgoto out;\n\t}\n\tif (EC_KEY_generate_key(server_key) != 1) {\n\t\tr = SSH_ERR_LIBCRYPTO_ERROR;\n\t\tgoto out;\n\t}\n\tgroup = EC_KEY_get0_group(server_key);\n\n#ifdef DEBUG_KEXECDH\n\tfputs(\"server private key:\\n\", stderr);\n\tsshkey_dump_ec_key(server_key);\n#endif\n\n\tif (kex->load_host_public_key == NULL ||\n\t    kex->load_host_private_key == NULL) {\n\t\tr = SSH_ERR_INVALID_ARGUMENT;\n\t\tgoto out;\n\t}\n\tserver_host_public = kex->load_host_public_key(kex->hostkey_type,\n\t    kex->hostkey_nid, ssh);\n\tserver_host_private = kex->load_host_private_key(kex->hostkey_type,\n\t    kex->hostkey_nid, ssh);\n\tif (server_host_public == NULL) {\n\t\tr = SSH_ERR_NO_HOSTKEY_LOADED;\n\t\tgoto out;\n\t}\n\tif ((client_public = EC_POINT_new(group)) == NULL) {\n\t\tr = SSH_ERR_ALLOC_FAIL;\n\t\tgoto out;\n\t}\n\tif ((r = sshpkt_get_ec(ssh, client_public, group)) != 0 ||\n\t    (r = sshpkt_get_end(ssh)) != 0)\n\t\tgoto out;\n\n#ifdef DEBUG_KEXECDH\n\tfputs(\"client public key:\\n\", stderr);\n\tsshkey_dump_ec_point(group, client_public);\n#endif\n\tif (sshkey_ec_validate_public(group, client_public) != 0) {\n\t\tsshpkt_disconnect(ssh, \"invalid client public key\");\n\t\tr = SSH_ERR_MESSAGE_INCOMPLETE;\n\t\tgoto out;\n\t}\n\n\t/* Calculate shared_secret */\n\tklen = (EC_GROUP_get_degree(group) + 7) / 8;\n\tif ((kbuf = malloc(klen)) == NULL ||\n\t    (shared_secret = BN_new()) == NULL) {\n\t\tr = SSH_ERR_ALLOC_FAIL;\n\t\tgoto out;\n\t}\n\tif (ECDH_compute_key(kbuf, klen, client_public,\n\t    server_key, NULL) != (int)klen ||\n\t    BN_bin2bn(kbuf, klen, shared_secret) == NULL) {\n\t\tr = SSH_ERR_LIBCRYPTO_ERROR;\n\t\tgoto out;\n\t}\n\n#ifdef DEBUG_KEXECDH\n\tdump_digest(\"shared secret\", kbuf, klen);\n#endif\n\t/* calc H */\n\tif ((r = sshkey_to_blob(server_host_public, &server_host_key_blob,\n\t    &sbloblen)) != 0)\n\t\tgoto out;\n\thashlen = sizeof(hash);\n\tif ((r = kex_ecdh_hash(\n\t    kex->hash_alg,\n\t    group,\n\t    kex->client_version_string,\n\t    kex->server_version_string,\n\t    sshbuf_ptr(kex->peer), sshbuf_len(kex->peer),\n\t    sshbuf_ptr(kex->my), sshbuf_len(kex->my),\n\t    server_host_key_blob, sbloblen,\n\t    client_public,\n\t    EC_KEY_get0_public_key(server_key),\n\t    shared_secret,\n\t    hash, &hashlen)) != 0)\n\t\tgoto out;\n\n\t/* save session id := H */\n\tif (kex->session_id == NULL) {\n\t\tkex->session_id_len = hashlen;\n\t\tkex->session_id = malloc(kex->session_id_len);\n\t\tif (kex->session_id == NULL) {\n\t\t\tr = SSH_ERR_ALLOC_FAIL;\n\t\t\tgoto out;\n\t\t}\n\t\tmemcpy(kex->session_id, hash, kex->session_id_len);\n\t}\n\n\t/* sign H */\n\tif ((r = kex->sign(server_host_private, server_host_public, &signature,\n\t     &slen, hash, hashlen, kex->hostkey_alg, ssh->compat)) < 0)\n\t\tgoto out;\n\n\t/* destroy_sensitive_data(); */\n\n\tpublic_key = EC_KEY_get0_public_key(server_key);\n\t/* send server hostkey, ECDH pubkey 'Q_S' and signed H */\n\tif ((r = sshpkt_start(ssh, SSH2_MSG_KEX_ECDH_REPLY)) != 0 ||\n\t    (r = sshpkt_put_string(ssh, server_host_key_blob, sbloblen)) != 0 ||\n\t    (r = sshpkt_put_ec(ssh, public_key, group)) != 0 ||\n\t    (r = sshpkt_put_string(ssh, signature, slen)) != 0 ||\n\t    (r = sshpkt_send(ssh)) != 0)\n\t\tgoto out;\n\n\tif ((r = kex_derive_keys_bn(ssh, hash, hashlen, shared_secret)) == 0)\n\t\tr = kex_send_newkeys(ssh);\n out:\n\texplicit_bzero(hash, sizeof(hash));\n\tEC_KEY_free(kex->ec_client_key);\n\tkex->ec_client_key = NULL;\n\tEC_KEY_free(server_key);\n\tif (kbuf) {\n\t\texplicit_bzero(kbuf, klen);\n\t\tfree(kbuf);\n\t}\n\tBN_clear_free(shared_secret);\n\tfree(server_host_key_blob);\n\tfree(signature);\n\treturn r;\n}",
    "includes": [
      "#include \"sshbuf.h\"",
      "#include \"ssherr.h\"",
      "#include \"compat.h\"",
      "#include \"dispatch.h\"",
      "#include \"ssh2.h\"",
      "#include \"packet.h\"",
      "#include \"log.h\"",
      "#include \"kex.h\"",
      "#include \"digest.h\"",
      "#include \"cipher.h\"",
      "#include \"sshkey.h\"",
      "#include <openssl/ecdh.h>",
      "#include <signal.h>",
      "#include <string.h>",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "signature"
          ],
          "line": 199
        },
        "resolved": true,
        "details": {
          "function_name": "freeze",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/smult_curve25519_ref.c",
          "lines": "50-60",
          "snippet": "static void freeze(unsigned int a[32])\n{\n  unsigned int aorig[32];\n  unsigned int j;\n  unsigned int negative;\n\n  for (j = 0;j < 32;++j) aorig[j] = a[j];\n  add(a,a,minusp);\n  negative = -((a[31] >> 7) & 1);\n  for (j = 0;j < 32;++j) a[j] ^= negative & (aorig[j] ^ a[j]);\n}",
          "includes": [],
          "macros_used": [],
          "globals_used": [
            "static const unsigned int minusp[32] = {\n 19, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 128\n} ;"
          ],
          "called_functions": [],
          "contextual_snippet": "static const unsigned int minusp[32] = {\n 19, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 128\n} ;\n\nstatic void freeze(unsigned int a[32])\n{\n  unsigned int aorig[32];\n  unsigned int j;\n  unsigned int negative;\n\n  for (j = 0;j < 32;++j) aorig[j] = a[j];\n  add(a,a,minusp);\n  negative = -((a[31] >> 7) & 1);\n  for (j = 0;j < 32;++j) a[j] ^= negative & (aorig[j] ^ a[j]);\n}"
        }
      },
      {
        "call_info": {
          "callee": "BN_clear_free",
          "args": [
            "shared_secret"
          ],
          "line": 197
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "explicit_bzero",
          "args": [
            "kbuf",
            "klen"
          ],
          "line": 194
        },
        "resolved": true,
        "details": {
          "function_name": "explicit_bzero",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/openbsd-compat/explicit_bzero.c",
          "lines": "36-53",
          "snippet": "void\nexplicit_bzero(void *p, size_t n)\n{\n\tif (n == 0)\n\t\treturn;\n\t/*\n\t * clang -fsanitize=memory needs to intercept memset-like functions\n\t * to correctly detect memory initialisation. Make sure one is called\n\t * directly since our indirection trick above successfully confuses it.\n\t */\n#if defined(__has_feature)\n# if __has_feature(memory_sanitizer)\n\tmemset(p, 0, n);\n# endif\n#endif\n\n\tssh_bzero(p, n);\n}",
          "includes": [
            "#include <string.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include \"includes.h\"\n\nvoid\nexplicit_bzero(void *p, size_t n)\n{\n\tif (n == 0)\n\t\treturn;\n\t/*\n\t * clang -fsanitize=memory needs to intercept memset-like functions\n\t * to correctly detect memory initialisation. Make sure one is called\n\t * directly since our indirection trick above successfully confuses it.\n\t */\n#if defined(__has_feature)\n# if __has_feature(memory_sanitizer)\n\tmemset(p, 0, n);\n# endif\n#endif\n\n\tssh_bzero(p, n);\n}"
        }
      },
      {
        "call_info": {
          "callee": "EC_KEY_free",
          "args": [
            "server_key"
          ],
          "line": 192
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "EC_KEY_free",
          "args": [
            "kex->ec_client_key"
          ],
          "line": 190
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kex_send_newkeys",
          "args": [
            "ssh"
          ],
          "line": 187
        },
        "resolved": true,
        "details": {
          "function_name": "kex_send_newkeys",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/kex.c",
          "lines": "420-436",
          "snippet": "int\nkex_send_newkeys(struct ssh *ssh)\n{\n\tint r;\n\n\tkex_reset_dispatch(ssh);\n\tif ((r = sshpkt_start(ssh, SSH2_MSG_NEWKEYS)) != 0 ||\n\t    (r = sshpkt_send(ssh)) != 0)\n\t\treturn r;\n\tdebug(\"SSH2_MSG_NEWKEYS sent\");\n\tdebug(\"expecting SSH2_MSG_NEWKEYS\");\n\tssh_dispatch_set(ssh, SSH2_MSG_NEWKEYS, &kex_input_newkeys);\n\tif (ssh->kex->ext_info_c)\n\t\tif ((r = kex_send_ext_info(ssh)) != 0)\n\t\t\treturn r;\n\treturn 0;\n}",
          "includes": [
            "#include \"digest.h\"",
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include \"monitor.h\"",
            "#include \"dispatch.h\"",
            "#include \"misc.h\"",
            "#include \"match.h\"",
            "#include \"mac.h\"",
            "#include \"log.h\"",
            "#include \"kex.h\"",
            "#include \"sshkey.h\"",
            "#include \"cipher.h\"",
            "#include \"compat.h\"",
            "#include \"packet.h\"",
            "#include \"ssh2.h\"",
            "#include <openssl/dh.h>",
            "#include <openssl/crypto.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static int kex_choose_conf(struct ssh *);",
            "static int kex_input_newkeys(int, u_int32_t, struct ssh *);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"digest.h\"\n#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"monitor.h\"\n#include \"dispatch.h\"\n#include \"misc.h\"\n#include \"match.h\"\n#include \"mac.h\"\n#include \"log.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"compat.h\"\n#include \"packet.h\"\n#include \"ssh2.h\"\n#include <openssl/dh.h>\n#include <openssl/crypto.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <signal.h>\n#include \"includes.h\"\n\nstatic int kex_choose_conf(struct ssh *);\nstatic int kex_input_newkeys(int, u_int32_t, struct ssh *);\n\nint\nkex_send_newkeys(struct ssh *ssh)\n{\n\tint r;\n\n\tkex_reset_dispatch(ssh);\n\tif ((r = sshpkt_start(ssh, SSH2_MSG_NEWKEYS)) != 0 ||\n\t    (r = sshpkt_send(ssh)) != 0)\n\t\treturn r;\n\tdebug(\"SSH2_MSG_NEWKEYS sent\");\n\tdebug(\"expecting SSH2_MSG_NEWKEYS\");\n\tssh_dispatch_set(ssh, SSH2_MSG_NEWKEYS, &kex_input_newkeys);\n\tif (ssh->kex->ext_info_c)\n\t\tif ((r = kex_send_ext_info(ssh)) != 0)\n\t\t\treturn r;\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "kex_derive_keys_bn",
          "args": [
            "ssh",
            "hash",
            "hashlen",
            "shared_secret"
          ],
          "line": 186
        },
        "resolved": true,
        "details": {
          "function_name": "kex_derive_keys_bn",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/kex.c",
          "lines": "1019-1032",
          "snippet": "int\nkex_derive_keys_bn(struct ssh *ssh, u_char *hash, u_int hashlen,\n    const BIGNUM *secret)\n{\n\tstruct sshbuf *shared_secret;\n\tint r;\n\n\tif ((shared_secret = sshbuf_new()) == NULL)\n\t\treturn SSH_ERR_ALLOC_FAIL;\n\tif ((r = sshbuf_put_bignum2(shared_secret, secret)) == 0)\n\t\tr = kex_derive_keys(ssh, hash, hashlen, shared_secret);\n\tsshbuf_free(shared_secret);\n\treturn r;\n}",
          "includes": [
            "#include \"digest.h\"",
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include \"monitor.h\"",
            "#include \"dispatch.h\"",
            "#include \"misc.h\"",
            "#include \"match.h\"",
            "#include \"mac.h\"",
            "#include \"log.h\"",
            "#include \"kex.h\"",
            "#include \"sshkey.h\"",
            "#include \"cipher.h\"",
            "#include \"compat.h\"",
            "#include \"packet.h\"",
            "#include \"ssh2.h\"",
            "#include <openssl/dh.h>",
            "#include <openssl/crypto.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static int kex_choose_conf(struct ssh *);",
            "static int kex_input_newkeys(int, u_int32_t, struct ssh *);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"digest.h\"\n#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"monitor.h\"\n#include \"dispatch.h\"\n#include \"misc.h\"\n#include \"match.h\"\n#include \"mac.h\"\n#include \"log.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"compat.h\"\n#include \"packet.h\"\n#include \"ssh2.h\"\n#include <openssl/dh.h>\n#include <openssl/crypto.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <signal.h>\n#include \"includes.h\"\n\nstatic int kex_choose_conf(struct ssh *);\nstatic int kex_input_newkeys(int, u_int32_t, struct ssh *);\n\nint\nkex_derive_keys_bn(struct ssh *ssh, u_char *hash, u_int hashlen,\n    const BIGNUM *secret)\n{\n\tstruct sshbuf *shared_secret;\n\tint r;\n\n\tif ((shared_secret = sshbuf_new()) == NULL)\n\t\treturn SSH_ERR_ALLOC_FAIL;\n\tif ((r = sshbuf_put_bignum2(shared_secret, secret)) == 0)\n\t\tr = kex_derive_keys(ssh, hash, hashlen, shared_secret);\n\tsshbuf_free(shared_secret);\n\treturn r;\n}"
        }
      },
      {
        "call_info": {
          "callee": "sshpkt_send",
          "args": [
            "ssh"
          ],
          "line": 183
        },
        "resolved": true,
        "details": {
          "function_name": "sshpkt_send",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
          "lines": "2648-2654",
          "snippet": "int\nsshpkt_send(struct ssh *ssh)\n{\n\tif (ssh->state && ssh->state->mux)\n\t\treturn ssh_packet_send_mux(ssh);\n\treturn ssh_packet_send2(ssh);\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include \"packet.h\"",
            "#include \"ssh.h\"",
            "#include \"channels.h\"",
            "#include \"misc.h\"",
            "#include \"canohost.h\"",
            "#include \"log.h\"",
            "#include \"mac.h\"",
            "#include \"digest.h\"",
            "#include \"kex.h\"",
            "#include \"sshkey.h\"",
            "#include \"cipher.h\"",
            "#include \"ssh2.h\"",
            "#include \"compat.h\"",
            "#include \"crc32.h\"",
            "#include \"xmalloc.h\"",
            "#include <zlib.h>",
            "#  include <openssl/ec.h>",
            "# include <openssl/evp.h>",
            "# include <openssl/bn.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <limits.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <netdb.h>",
            "#include <errno.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include \"openbsd-compat/sys-queue.h\"",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshpkt_send(struct ssh *ssh)\n{\n\tif (ssh->state && ssh->state->mux)\n\t\treturn ssh_packet_send_mux(ssh);\n\treturn ssh_packet_send2(ssh);\n}"
        }
      },
      {
        "call_info": {
          "callee": "sshpkt_put_string",
          "args": [
            "ssh",
            "signature",
            "slen"
          ],
          "line": 182
        },
        "resolved": true,
        "details": {
          "function_name": "sshpkt_put_string",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
          "lines": "2453-2457",
          "snippet": "int\nsshpkt_put_string(struct ssh *ssh, const void *v, size_t len)\n{\n\treturn sshbuf_put_string(ssh->state->outgoing_packet, v, len);\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include \"packet.h\"",
            "#include \"ssh.h\"",
            "#include \"channels.h\"",
            "#include \"misc.h\"",
            "#include \"canohost.h\"",
            "#include \"log.h\"",
            "#include \"mac.h\"",
            "#include \"digest.h\"",
            "#include \"kex.h\"",
            "#include \"sshkey.h\"",
            "#include \"cipher.h\"",
            "#include \"ssh2.h\"",
            "#include \"compat.h\"",
            "#include \"crc32.h\"",
            "#include \"xmalloc.h\"",
            "#include <zlib.h>",
            "#  include <openssl/ec.h>",
            "# include <openssl/evp.h>",
            "# include <openssl/bn.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <limits.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <netdb.h>",
            "#include <errno.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include \"openbsd-compat/sys-queue.h\"",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshpkt_put_string(struct ssh *ssh, const void *v, size_t len)\n{\n\treturn sshbuf_put_string(ssh->state->outgoing_packet, v, len);\n}"
        }
      },
      {
        "call_info": {
          "callee": "sshpkt_put_ec",
          "args": [
            "ssh",
            "public_key",
            "group"
          ],
          "line": 181
        },
        "resolved": true,
        "details": {
          "function_name": "sshpkt_put_ec",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
          "lines": "2473-2477",
          "snippet": "int\nsshpkt_put_ec(struct ssh *ssh, const EC_POINT *v, const EC_GROUP *g)\n{\n\treturn sshbuf_put_ec(ssh->state->outgoing_packet, v, g);\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include \"packet.h\"",
            "#include \"ssh.h\"",
            "#include \"channels.h\"",
            "#include \"misc.h\"",
            "#include \"canohost.h\"",
            "#include \"log.h\"",
            "#include \"mac.h\"",
            "#include \"digest.h\"",
            "#include \"kex.h\"",
            "#include \"sshkey.h\"",
            "#include \"cipher.h\"",
            "#include \"ssh2.h\"",
            "#include \"compat.h\"",
            "#include \"crc32.h\"",
            "#include \"xmalloc.h\"",
            "#include <zlib.h>",
            "#  include <openssl/ec.h>",
            "# include <openssl/evp.h>",
            "# include <openssl/bn.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <limits.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <netdb.h>",
            "#include <errno.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include \"openbsd-compat/sys-queue.h\"",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshpkt_put_ec(struct ssh *ssh, const EC_POINT *v, const EC_GROUP *g)\n{\n\treturn sshbuf_put_ec(ssh->state->outgoing_packet, v, g);\n}"
        }
      },
      {
        "call_info": {
          "callee": "sshpkt_start",
          "args": [
            "ssh",
            "SSH2_MSG_KEX_ECDH_REPLY"
          ],
          "line": 179
        },
        "resolved": true,
        "details": {
          "function_name": "sshpkt_start",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
          "lines": "2573-2583",
          "snippet": "int\nsshpkt_start(struct ssh *ssh, u_char type)\n{\n\tu_char buf[6]; /* u32 packet length, u8 pad len, u8 type */\n\n\tDBG(debug(\"packet_start[%d]\", type));\n\tmemset(buf, 0, sizeof(buf));\n\tbuf[sizeof(buf) - 1] = type;\n\tsshbuf_reset(ssh->state->outgoing_packet);\n\treturn sshbuf_put(ssh->state->outgoing_packet, buf, sizeof(buf));\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include \"packet.h\"",
            "#include \"ssh.h\"",
            "#include \"channels.h\"",
            "#include \"misc.h\"",
            "#include \"canohost.h\"",
            "#include \"log.h\"",
            "#include \"mac.h\"",
            "#include \"digest.h\"",
            "#include \"kex.h\"",
            "#include \"sshkey.h\"",
            "#include \"cipher.h\"",
            "#include \"ssh2.h\"",
            "#include \"compat.h\"",
            "#include \"crc32.h\"",
            "#include \"xmalloc.h\"",
            "#include <zlib.h>",
            "#  include <openssl/ec.h>",
            "# include <openssl/evp.h>",
            "# include <openssl/bn.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <limits.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <netdb.h>",
            "#include <errno.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include \"openbsd-compat/sys-queue.h\"",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshpkt_start(struct ssh *ssh, u_char type)\n{\n\tu_char buf[6]; /* u32 packet length, u8 pad len, u8 type */\n\n\tDBG(debug(\"packet_start[%d]\", type));\n\tmemset(buf, 0, sizeof(buf));\n\tbuf[sizeof(buf) - 1] = type;\n\tsshbuf_reset(ssh->state->outgoing_packet);\n\treturn sshbuf_put(ssh->state->outgoing_packet, buf, sizeof(buf));\n}"
        }
      },
      {
        "call_info": {
          "callee": "EC_KEY_get0_public_key",
          "args": [
            "server_key"
          ],
          "line": 177
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kex->sign",
          "args": [
            "server_host_private",
            "server_host_public",
            "&signature",
            "&slen",
            "hash",
            "hashlen",
            "kex->hostkey_alg",
            "ssh->compat"
          ],
          "line": 171
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memcpy",
          "args": [
            "kex->session_id",
            "hash",
            "kex->session_id_len"
          ],
          "line": 167
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "malloc",
          "args": [
            "kex->session_id_len"
          ],
          "line": 162
        },
        "resolved": true,
        "details": {
          "function_name": "xmalloc",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/xmalloc.c",
          "lines": "39-50",
          "snippet": "void *\nxmalloc(size_t size)\n{\n\tvoid *ptr;\n\n\tif (size == 0)\n\t\tfatal(\"xmalloc: zero size\");\n\tptr = malloc(size);\n\tif (ptr == NULL)\n\t\tfatal(\"xmalloc: out of memory (allocating %zu bytes)\", size);\n\treturn ptr;\n}",
          "includes": [
            "#include \"log.h\"",
            "#include \"xmalloc.h\"",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdint.h>",
            "#include <stdarg.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n#include \"xmalloc.h\"\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdint.h>\n#include <stdarg.h>\n#include \"includes.h\"\n\nvoid *\nxmalloc(size_t size)\n{\n\tvoid *ptr;\n\n\tif (size == 0)\n\t\tfatal(\"xmalloc: zero size\");\n\tptr = malloc(size);\n\tif (ptr == NULL)\n\t\tfatal(\"xmalloc: out of memory (allocating %zu bytes)\", size);\n\treturn ptr;\n}"
        }
      },
      {
        "call_info": {
          "callee": "kex_ecdh_hash",
          "args": [
            "kex->hash_alg",
            "group",
            "kex->client_version_string",
            "kex->server_version_string",
            "sshbuf_ptr(kex->peer)",
            "sshbuf_len(kex->peer)",
            "sshbuf_ptr(kex->my)",
            "sshbuf_len(kex->my)",
            "server_host_key_blob",
            "sbloblen",
            "client_public",
            "EC_KEY_get0_public_key(server_key)",
            "shared_secret",
            "hash",
            "&hashlen"
          ],
          "line": 145
        },
        "resolved": true,
        "details": {
          "function_name": "kex_ecdh_hash",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/kexecdh.c",
          "lines": "49-99",
          "snippet": "int\nkex_ecdh_hash(\n    int hash_alg,\n    const EC_GROUP *ec_group,\n    const char *client_version_string,\n    const char *server_version_string,\n    const u_char *ckexinit, size_t ckexinitlen,\n    const u_char *skexinit, size_t skexinitlen,\n    const u_char *serverhostkeyblob, size_t sbloblen,\n    const EC_POINT *client_dh_pub,\n    const EC_POINT *server_dh_pub,\n    const BIGNUM *shared_secret,\n    u_char *hash, size_t *hashlen)\n{\n\tstruct sshbuf *b;\n\tint r;\n\n\tif (*hashlen < ssh_digest_bytes(hash_alg))\n\t\treturn SSH_ERR_INVALID_ARGUMENT;\n\tif ((b = sshbuf_new()) == NULL)\n\t\treturn SSH_ERR_ALLOC_FAIL;\n\tif ((r = sshbuf_put_cstring(b, client_version_string)) != 0 ||\n\t    (r = sshbuf_put_cstring(b, server_version_string)) != 0 ||\n\t    /* kexinit messages: fake header: len+SSH2_MSG_KEXINIT */\n\t    (r = sshbuf_put_u32(b, ckexinitlen+1)) != 0 ||\n\t    (r = sshbuf_put_u8(b, SSH2_MSG_KEXINIT)) != 0 ||\n\t    (r = sshbuf_put(b, ckexinit, ckexinitlen)) != 0 ||\n\t    (r = sshbuf_put_u32(b, skexinitlen+1)) != 0 ||\n\t    (r = sshbuf_put_u8(b, SSH2_MSG_KEXINIT)) != 0 ||\n\t    (r = sshbuf_put(b, skexinit, skexinitlen)) != 0 ||\n\t    (r = sshbuf_put_string(b, serverhostkeyblob, sbloblen)) != 0 ||\n\t    (r = sshbuf_put_ec(b, client_dh_pub, ec_group)) != 0 ||\n\t    (r = sshbuf_put_ec(b, server_dh_pub, ec_group)) != 0 ||\n\t    (r = sshbuf_put_bignum2(b, shared_secret)) != 0) {\n\t\tsshbuf_free(b);\n\t\treturn r;\n\t}\n#ifdef DEBUG_KEX\n\tsshbuf_dump(b, stderr);\n#endif\n\tif (ssh_digest_buffer(hash_alg, b, hash, *hashlen) != 0) {\n\t\tsshbuf_free(b);\n\t\treturn SSH_ERR_LIBCRYPTO_ERROR;\n\t}\n\tsshbuf_free(b);\n\t*hashlen = ssh_digest_bytes(hash_alg);\n#ifdef DEBUG_KEX\n\tdump_digest(\"hash\", hash, *hashlen);\n#endif\n\treturn 0;\n}",
          "includes": [
            "#include \"ssherr.h\"",
            "#include \"digest.h\"",
            "#include \"sshbuf.h\"",
            "#include \"kex.h\"",
            "#include \"cipher.h\"",
            "#include \"sshkey.h\"",
            "#include \"ssh2.h\"",
            "#include <openssl/ecdh.h>",
            "#include <openssl/ec.h>",
            "#include <openssl/evp.h>",
            "#include <openssl/bn.h>",
            "#include <string.h>",
            "#include <signal.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"ssherr.h\"\n#include \"digest.h\"\n#include \"sshbuf.h\"\n#include \"kex.h\"\n#include \"cipher.h\"\n#include \"sshkey.h\"\n#include \"ssh2.h\"\n#include <openssl/ecdh.h>\n#include <openssl/ec.h>\n#include <openssl/evp.h>\n#include <openssl/bn.h>\n#include <string.h>\n#include <signal.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nkex_ecdh_hash(\n    int hash_alg,\n    const EC_GROUP *ec_group,\n    const char *client_version_string,\n    const char *server_version_string,\n    const u_char *ckexinit, size_t ckexinitlen,\n    const u_char *skexinit, size_t skexinitlen,\n    const u_char *serverhostkeyblob, size_t sbloblen,\n    const EC_POINT *client_dh_pub,\n    const EC_POINT *server_dh_pub,\n    const BIGNUM *shared_secret,\n    u_char *hash, size_t *hashlen)\n{\n\tstruct sshbuf *b;\n\tint r;\n\n\tif (*hashlen < ssh_digest_bytes(hash_alg))\n\t\treturn SSH_ERR_INVALID_ARGUMENT;\n\tif ((b = sshbuf_new()) == NULL)\n\t\treturn SSH_ERR_ALLOC_FAIL;\n\tif ((r = sshbuf_put_cstring(b, client_version_string)) != 0 ||\n\t    (r = sshbuf_put_cstring(b, server_version_string)) != 0 ||\n\t    /* kexinit messages: fake header: len+SSH2_MSG_KEXINIT */\n\t    (r = sshbuf_put_u32(b, ckexinitlen+1)) != 0 ||\n\t    (r = sshbuf_put_u8(b, SSH2_MSG_KEXINIT)) != 0 ||\n\t    (r = sshbuf_put(b, ckexinit, ckexinitlen)) != 0 ||\n\t    (r = sshbuf_put_u32(b, skexinitlen+1)) != 0 ||\n\t    (r = sshbuf_put_u8(b, SSH2_MSG_KEXINIT)) != 0 ||\n\t    (r = sshbuf_put(b, skexinit, skexinitlen)) != 0 ||\n\t    (r = sshbuf_put_string(b, serverhostkeyblob, sbloblen)) != 0 ||\n\t    (r = sshbuf_put_ec(b, client_dh_pub, ec_group)) != 0 ||\n\t    (r = sshbuf_put_ec(b, server_dh_pub, ec_group)) != 0 ||\n\t    (r = sshbuf_put_bignum2(b, shared_secret)) != 0) {\n\t\tsshbuf_free(b);\n\t\treturn r;\n\t}\n#ifdef DEBUG_KEX\n\tsshbuf_dump(b, stderr);\n#endif\n\tif (ssh_digest_buffer(hash_alg, b, hash, *hashlen) != 0) {\n\t\tsshbuf_free(b);\n\t\treturn SSH_ERR_LIBCRYPTO_ERROR;\n\t}\n\tsshbuf_free(b);\n\t*hashlen = ssh_digest_bytes(hash_alg);\n#ifdef DEBUG_KEX\n\tdump_digest(\"hash\", hash, *hashlen);\n#endif\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "EC_KEY_get0_public_key",
          "args": [
            "server_key"
          ],
          "line": 154
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sshbuf_len",
          "args": [
            "kex->my"
          ],
          "line": 151
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_len",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf.c",
          "lines": "252-258",
          "snippet": "size_t\nsshbuf_len(const struct sshbuf *buf)\n{\n\tif (sshbuf_check_sanity(buf) != 0)\n\t\treturn 0;\n\treturn buf->size - buf->off;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <signal.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <signal.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nsize_t\nsshbuf_len(const struct sshbuf *buf)\n{\n\tif (sshbuf_check_sanity(buf) != 0)\n\t\treturn 0;\n\treturn buf->size - buf->off;\n}"
        }
      },
      {
        "call_info": {
          "callee": "sshbuf_ptr",
          "args": [
            "kex->my"
          ],
          "line": 151
        },
        "resolved": true,
        "details": {
          "function_name": "sshbuf_ptr",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshbuf.c",
          "lines": "268-274",
          "snippet": "const u_char *\nsshbuf_ptr(const struct sshbuf *buf)\n{\n\tif (sshbuf_check_sanity(buf) != 0)\n\t\treturn NULL;\n\treturn buf->cd + buf->off;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <signal.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <signal.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nconst u_char *\nsshbuf_ptr(const struct sshbuf *buf)\n{\n\tif (sshbuf_check_sanity(buf) != 0)\n\t\treturn NULL;\n\treturn buf->cd + buf->off;\n}"
        }
      },
      {
        "call_info": {
          "callee": "sshkey_to_blob",
          "args": [
            "server_host_public",
            "&server_host_key_blob",
            "&sbloblen"
          ],
          "line": 141
        },
        "resolved": true,
        "details": {
          "function_name": "sshkey_to_blob",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshkey.c",
          "lines": "880-884",
          "snippet": "int\nsshkey_to_blob(const struct sshkey *key, u_char **blobp, size_t *lenp)\n{\n\treturn to_blob(key, blobp, lenp, 0, SSHKEY_SERIALIZE_DEFAULT);\n}",
          "includes": [
            "#include \"openbsd-compat/openssl-compat.h\"",
            "#include \"xmss_fast.h\"",
            "#include \"match.h\"",
            "#include \"sshkey-xmss.h\"",
            "#include \"sshkey.h\"",
            "#include \"digest.h\"",
            "#include \"cipher.h\"",
            "#include \"sshbuf.h\"",
            "#include \"misc.h\"",
            "#include \"ssherr.h\"",
            "#include \"ssh2.h\"",
            "#include <util.h>",
            "#include <resolv.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <limits.h>",
            "#include <errno.h>",
            "#include \"crypto_api.h\"",
            "#include <openssl/pem.h>",
            "#include <openssl/err.h>",
            "#include <openssl/evp.h>",
            "#include <netinet/in.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"openbsd-compat/openssl-compat.h\"\n#include \"xmss_fast.h\"\n#include \"match.h\"\n#include \"sshkey-xmss.h\"\n#include \"sshkey.h\"\n#include \"digest.h\"\n#include \"cipher.h\"\n#include \"sshbuf.h\"\n#include \"misc.h\"\n#include \"ssherr.h\"\n#include \"ssh2.h\"\n#include <util.h>\n#include <resolv.h>\n#include <string.h>\n#include <stdio.h>\n#include <limits.h>\n#include <errno.h>\n#include \"crypto_api.h\"\n#include <openssl/pem.h>\n#include <openssl/err.h>\n#include <openssl/evp.h>\n#include <netinet/in.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshkey_to_blob(const struct sshkey *key, u_char **blobp, size_t *lenp)\n{\n\treturn to_blob(key, blobp, lenp, 0, SSHKEY_SERIALIZE_DEFAULT);\n}"
        }
      },
      {
        "call_info": {
          "callee": "dump_digest",
          "args": [
            "\"shared secret\"",
            "kbuf",
            "klen"
          ],
          "line": 138
        },
        "resolved": true,
        "details": {
          "function_name": "dump_digest",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/kex.c",
          "lines": "1037-1042",
          "snippet": "void\ndump_digest(char *msg, u_char *digest, int len)\n{\n\tfprintf(stderr, \"%s\\n\", msg);\n\tsshbuf_dump_data(digest, len, stderr);\n}",
          "includes": [
            "#include \"digest.h\"",
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include \"monitor.h\"",
            "#include \"dispatch.h\"",
            "#include \"misc.h\"",
            "#include \"match.h\"",
            "#include \"mac.h\"",
            "#include \"log.h\"",
            "#include \"kex.h\"",
            "#include \"sshkey.h\"",
            "#include \"cipher.h\"",
            "#include \"compat.h\"",
            "#include \"packet.h\"",
            "#include \"ssh2.h\"",
            "#include <openssl/dh.h>",
            "#include <openssl/crypto.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"digest.h\"\n#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"monitor.h\"\n#include \"dispatch.h\"\n#include \"misc.h\"\n#include \"match.h\"\n#include \"mac.h\"\n#include \"log.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"compat.h\"\n#include \"packet.h\"\n#include \"ssh2.h\"\n#include <openssl/dh.h>\n#include <openssl/crypto.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <signal.h>\n#include \"includes.h\"\n\nvoid\ndump_digest(char *msg, u_char *digest, int len)\n{\n\tfprintf(stderr, \"%s\\n\", msg);\n\tsshbuf_dump_data(digest, len, stderr);\n}"
        }
      },
      {
        "call_info": {
          "callee": "BN_bin2bn",
          "args": [
            "kbuf",
            "klen",
            "shared_secret"
          ],
          "line": 132
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ECDH_compute_key",
          "args": [
            "kbuf",
            "klen",
            "client_public",
            "server_key",
            "NULL"
          ],
          "line": 130
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "BN_new",
          "args": [],
          "line": 126
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "EC_GROUP_get_degree",
          "args": [
            "group"
          ],
          "line": 124
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sshpkt_disconnect",
          "args": [
            "ssh",
            "\"invalid client public key\""
          ],
          "line": 118
        },
        "resolved": true,
        "details": {
          "function_name": "sshpkt_disconnect",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
          "lines": "2656-2674",
          "snippet": "int\nsshpkt_disconnect(struct ssh *ssh, const char *fmt,...)\n{\n\tchar buf[1024];\n\tva_list args;\n\tint r;\n\n\tva_start(args, fmt);\n\tvsnprintf(buf, sizeof(buf), fmt, args);\n\tva_end(args);\n\n\tif ((r = sshpkt_start(ssh, SSH2_MSG_DISCONNECT)) != 0 ||\n\t    (r = sshpkt_put_u32(ssh, SSH2_DISCONNECT_PROTOCOL_ERROR)) != 0 ||\n\t    (r = sshpkt_put_cstring(ssh, buf)) != 0 ||\n\t    (r = sshpkt_put_cstring(ssh, \"\")) != 0 ||\n\t    (r = sshpkt_send(ssh)) != 0)\n\t\treturn r;\n\treturn 0;\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include \"packet.h\"",
            "#include \"ssh.h\"",
            "#include \"channels.h\"",
            "#include \"misc.h\"",
            "#include \"canohost.h\"",
            "#include \"log.h\"",
            "#include \"mac.h\"",
            "#include \"digest.h\"",
            "#include \"kex.h\"",
            "#include \"sshkey.h\"",
            "#include \"cipher.h\"",
            "#include \"ssh2.h\"",
            "#include \"compat.h\"",
            "#include \"crc32.h\"",
            "#include \"xmalloc.h\"",
            "#include <zlib.h>",
            "#  include <openssl/ec.h>",
            "# include <openssl/evp.h>",
            "# include <openssl/bn.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <limits.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <netdb.h>",
            "#include <errno.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include \"openbsd-compat/sys-queue.h\"",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshpkt_disconnect(struct ssh *ssh, const char *fmt,...)\n{\n\tchar buf[1024];\n\tva_list args;\n\tint r;\n\n\tva_start(args, fmt);\n\tvsnprintf(buf, sizeof(buf), fmt, args);\n\tva_end(args);\n\n\tif ((r = sshpkt_start(ssh, SSH2_MSG_DISCONNECT)) != 0 ||\n\t    (r = sshpkt_put_u32(ssh, SSH2_DISCONNECT_PROTOCOL_ERROR)) != 0 ||\n\t    (r = sshpkt_put_cstring(ssh, buf)) != 0 ||\n\t    (r = sshpkt_put_cstring(ssh, \"\")) != 0 ||\n\t    (r = sshpkt_send(ssh)) != 0)\n\t\treturn r;\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "sshkey_ec_validate_public",
          "args": [
            "group",
            "client_public"
          ],
          "line": 117
        },
        "resolved": true,
        "details": {
          "function_name": "sshkey_ec_validate_public",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshkey.c",
          "lines": "3224-3299",
          "snippet": "int\nsshkey_ec_validate_public(const EC_GROUP *group, const EC_POINT *public)\n{\n\tBN_CTX *bnctx;\n\tEC_POINT *nq = NULL;\n\tBIGNUM *order, *x, *y, *tmp;\n\tint ret = SSH_ERR_KEY_INVALID_EC_VALUE;\n\n\t/*\n\t * NB. This assumes OpenSSL has already verified that the public\n\t * point lies on the curve. This is done by EC_POINT_oct2point()\n\t * implicitly calling EC_POINT_is_on_curve(). If this code is ever\n\t * reachable with public points not unmarshalled using\n\t * EC_POINT_oct2point then the caller will need to explicitly check.\n\t */\n\n\tif ((bnctx = BN_CTX_new()) == NULL)\n\t\treturn SSH_ERR_ALLOC_FAIL;\n\tBN_CTX_start(bnctx);\n\n\t/*\n\t * We shouldn't ever hit this case because bignum_get_ecpoint()\n\t * refuses to load GF2m points.\n\t */\n\tif (EC_METHOD_get_field_type(EC_GROUP_method_of(group)) !=\n\t    NID_X9_62_prime_field)\n\t\tgoto out;\n\n\t/* Q != infinity */\n\tif (EC_POINT_is_at_infinity(group, public))\n\t\tgoto out;\n\n\tif ((x = BN_CTX_get(bnctx)) == NULL ||\n\t    (y = BN_CTX_get(bnctx)) == NULL ||\n\t    (order = BN_CTX_get(bnctx)) == NULL ||\n\t    (tmp = BN_CTX_get(bnctx)) == NULL) {\n\t\tret = SSH_ERR_ALLOC_FAIL;\n\t\tgoto out;\n\t}\n\n\t/* log2(x) > log2(order)/2, log2(y) > log2(order)/2 */\n\tif (EC_GROUP_get_order(group, order, bnctx) != 1 ||\n\t    EC_POINT_get_affine_coordinates_GFp(group, public,\n\t    x, y, bnctx) != 1) {\n\t\tret = SSH_ERR_LIBCRYPTO_ERROR;\n\t\tgoto out;\n\t}\n\tif (BN_num_bits(x) <= BN_num_bits(order) / 2 ||\n\t    BN_num_bits(y) <= BN_num_bits(order) / 2)\n\t\tgoto out;\n\n\t/* nQ == infinity (n == order of subgroup) */\n\tif ((nq = EC_POINT_new(group)) == NULL) {\n\t\tret = SSH_ERR_ALLOC_FAIL;\n\t\tgoto out;\n\t}\n\tif (EC_POINT_mul(group, nq, NULL, public, order, bnctx) != 1) {\n\t\tret = SSH_ERR_LIBCRYPTO_ERROR;\n\t\tgoto out;\n\t}\n\tif (EC_POINT_is_at_infinity(group, nq) != 1)\n\t\tgoto out;\n\n\t/* x < order - 1, y < order - 1 */\n\tif (!BN_sub(tmp, order, BN_value_one())) {\n\t\tret = SSH_ERR_LIBCRYPTO_ERROR;\n\t\tgoto out;\n\t}\n\tif (BN_cmp(x, tmp) >= 0 || BN_cmp(y, tmp) >= 0)\n\t\tgoto out;\n\tret = 0;\n out:\n\tBN_CTX_free(bnctx);\n\tEC_POINT_free(nq);\n\treturn ret;\n}",
          "includes": [
            "#include \"openbsd-compat/openssl-compat.h\"",
            "#include \"xmss_fast.h\"",
            "#include \"match.h\"",
            "#include \"sshkey-xmss.h\"",
            "#include \"sshkey.h\"",
            "#include \"digest.h\"",
            "#include \"cipher.h\"",
            "#include \"sshbuf.h\"",
            "#include \"misc.h\"",
            "#include \"ssherr.h\"",
            "#include \"ssh2.h\"",
            "#include <util.h>",
            "#include <resolv.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <limits.h>",
            "#include <errno.h>",
            "#include \"crypto_api.h\"",
            "#include <openssl/pem.h>",
            "#include <openssl/err.h>",
            "#include <openssl/evp.h>",
            "#include <netinet/in.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"openbsd-compat/openssl-compat.h\"\n#include \"xmss_fast.h\"\n#include \"match.h\"\n#include \"sshkey-xmss.h\"\n#include \"sshkey.h\"\n#include \"digest.h\"\n#include \"cipher.h\"\n#include \"sshbuf.h\"\n#include \"misc.h\"\n#include \"ssherr.h\"\n#include \"ssh2.h\"\n#include <util.h>\n#include <resolv.h>\n#include <string.h>\n#include <stdio.h>\n#include <limits.h>\n#include <errno.h>\n#include \"crypto_api.h\"\n#include <openssl/pem.h>\n#include <openssl/err.h>\n#include <openssl/evp.h>\n#include <netinet/in.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshkey_ec_validate_public(const EC_GROUP *group, const EC_POINT *public)\n{\n\tBN_CTX *bnctx;\n\tEC_POINT *nq = NULL;\n\tBIGNUM *order, *x, *y, *tmp;\n\tint ret = SSH_ERR_KEY_INVALID_EC_VALUE;\n\n\t/*\n\t * NB. This assumes OpenSSL has already verified that the public\n\t * point lies on the curve. This is done by EC_POINT_oct2point()\n\t * implicitly calling EC_POINT_is_on_curve(). If this code is ever\n\t * reachable with public points not unmarshalled using\n\t * EC_POINT_oct2point then the caller will need to explicitly check.\n\t */\n\n\tif ((bnctx = BN_CTX_new()) == NULL)\n\t\treturn SSH_ERR_ALLOC_FAIL;\n\tBN_CTX_start(bnctx);\n\n\t/*\n\t * We shouldn't ever hit this case because bignum_get_ecpoint()\n\t * refuses to load GF2m points.\n\t */\n\tif (EC_METHOD_get_field_type(EC_GROUP_method_of(group)) !=\n\t    NID_X9_62_prime_field)\n\t\tgoto out;\n\n\t/* Q != infinity */\n\tif (EC_POINT_is_at_infinity(group, public))\n\t\tgoto out;\n\n\tif ((x = BN_CTX_get(bnctx)) == NULL ||\n\t    (y = BN_CTX_get(bnctx)) == NULL ||\n\t    (order = BN_CTX_get(bnctx)) == NULL ||\n\t    (tmp = BN_CTX_get(bnctx)) == NULL) {\n\t\tret = SSH_ERR_ALLOC_FAIL;\n\t\tgoto out;\n\t}\n\n\t/* log2(x) > log2(order)/2, log2(y) > log2(order)/2 */\n\tif (EC_GROUP_get_order(group, order, bnctx) != 1 ||\n\t    EC_POINT_get_affine_coordinates_GFp(group, public,\n\t    x, y, bnctx) != 1) {\n\t\tret = SSH_ERR_LIBCRYPTO_ERROR;\n\t\tgoto out;\n\t}\n\tif (BN_num_bits(x) <= BN_num_bits(order) / 2 ||\n\t    BN_num_bits(y) <= BN_num_bits(order) / 2)\n\t\tgoto out;\n\n\t/* nQ == infinity (n == order of subgroup) */\n\tif ((nq = EC_POINT_new(group)) == NULL) {\n\t\tret = SSH_ERR_ALLOC_FAIL;\n\t\tgoto out;\n\t}\n\tif (EC_POINT_mul(group, nq, NULL, public, order, bnctx) != 1) {\n\t\tret = SSH_ERR_LIBCRYPTO_ERROR;\n\t\tgoto out;\n\t}\n\tif (EC_POINT_is_at_infinity(group, nq) != 1)\n\t\tgoto out;\n\n\t/* x < order - 1, y < order - 1 */\n\tif (!BN_sub(tmp, order, BN_value_one())) {\n\t\tret = SSH_ERR_LIBCRYPTO_ERROR;\n\t\tgoto out;\n\t}\n\tif (BN_cmp(x, tmp) >= 0 || BN_cmp(y, tmp) >= 0)\n\t\tgoto out;\n\tret = 0;\n out:\n\tBN_CTX_free(bnctx);\n\tEC_POINT_free(nq);\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "sshkey_dump_ec_point",
          "args": [
            "group",
            "client_public"
          ],
          "line": 115
        },
        "resolved": true,
        "details": {
          "function_name": "sshkey_dump_ec_point",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshkey.c",
          "lines": "3340-3377",
          "snippet": "void\nsshkey_dump_ec_point(const EC_GROUP *group, const EC_POINT *point)\n{\n\tBIGNUM *x, *y;\n\tBN_CTX *bnctx;\n\n\tif (point == NULL) {\n\t\tfputs(\"point=(NULL)\\n\", stderr);\n\t\treturn;\n\t}\n\tif ((bnctx = BN_CTX_new()) == NULL) {\n\t\tfprintf(stderr, \"%s: BN_CTX_new failed\\n\", __func__);\n\t\treturn;\n\t}\n\tBN_CTX_start(bnctx);\n\tif ((x = BN_CTX_get(bnctx)) == NULL ||\n\t    (y = BN_CTX_get(bnctx)) == NULL) {\n\t\tfprintf(stderr, \"%s: BN_CTX_get failed\\n\", __func__);\n\t\treturn;\n\t}\n\tif (EC_METHOD_get_field_type(EC_GROUP_method_of(group)) !=\n\t    NID_X9_62_prime_field) {\n\t\tfprintf(stderr, \"%s: group is not a prime field\\n\", __func__);\n\t\treturn;\n\t}\n\tif (EC_POINT_get_affine_coordinates_GFp(group, point, x, y,\n\t    bnctx) != 1) {\n\t\tfprintf(stderr, \"%s: EC_POINT_get_affine_coordinates_GFp\\n\",\n\t\t    __func__);\n\t\treturn;\n\t}\n\tfputs(\"x=\", stderr);\n\tBN_print_fp(stderr, x);\n\tfputs(\"\\ny=\", stderr);\n\tBN_print_fp(stderr, y);\n\tfputs(\"\\n\", stderr);\n\tBN_CTX_free(bnctx);\n}",
          "includes": [
            "#include \"openbsd-compat/openssl-compat.h\"",
            "#include \"xmss_fast.h\"",
            "#include \"match.h\"",
            "#include \"sshkey-xmss.h\"",
            "#include \"sshkey.h\"",
            "#include \"digest.h\"",
            "#include \"cipher.h\"",
            "#include \"sshbuf.h\"",
            "#include \"misc.h\"",
            "#include \"ssherr.h\"",
            "#include \"ssh2.h\"",
            "#include <util.h>",
            "#include <resolv.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <limits.h>",
            "#include <errno.h>",
            "#include \"crypto_api.h\"",
            "#include <openssl/pem.h>",
            "#include <openssl/err.h>",
            "#include <openssl/evp.h>",
            "#include <netinet/in.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"openbsd-compat/openssl-compat.h\"\n#include \"xmss_fast.h\"\n#include \"match.h\"\n#include \"sshkey-xmss.h\"\n#include \"sshkey.h\"\n#include \"digest.h\"\n#include \"cipher.h\"\n#include \"sshbuf.h\"\n#include \"misc.h\"\n#include \"ssherr.h\"\n#include \"ssh2.h\"\n#include <util.h>\n#include <resolv.h>\n#include <string.h>\n#include <stdio.h>\n#include <limits.h>\n#include <errno.h>\n#include \"crypto_api.h\"\n#include <openssl/pem.h>\n#include <openssl/err.h>\n#include <openssl/evp.h>\n#include <netinet/in.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\nsshkey_dump_ec_point(const EC_GROUP *group, const EC_POINT *point)\n{\n\tBIGNUM *x, *y;\n\tBN_CTX *bnctx;\n\n\tif (point == NULL) {\n\t\tfputs(\"point=(NULL)\\n\", stderr);\n\t\treturn;\n\t}\n\tif ((bnctx = BN_CTX_new()) == NULL) {\n\t\tfprintf(stderr, \"%s: BN_CTX_new failed\\n\", __func__);\n\t\treturn;\n\t}\n\tBN_CTX_start(bnctx);\n\tif ((x = BN_CTX_get(bnctx)) == NULL ||\n\t    (y = BN_CTX_get(bnctx)) == NULL) {\n\t\tfprintf(stderr, \"%s: BN_CTX_get failed\\n\", __func__);\n\t\treturn;\n\t}\n\tif (EC_METHOD_get_field_type(EC_GROUP_method_of(group)) !=\n\t    NID_X9_62_prime_field) {\n\t\tfprintf(stderr, \"%s: group is not a prime field\\n\", __func__);\n\t\treturn;\n\t}\n\tif (EC_POINT_get_affine_coordinates_GFp(group, point, x, y,\n\t    bnctx) != 1) {\n\t\tfprintf(stderr, \"%s: EC_POINT_get_affine_coordinates_GFp\\n\",\n\t\t    __func__);\n\t\treturn;\n\t}\n\tfputs(\"x=\", stderr);\n\tBN_print_fp(stderr, x);\n\tfputs(\"\\ny=\", stderr);\n\tBN_print_fp(stderr, y);\n\tfputs(\"\\n\", stderr);\n\tBN_CTX_free(bnctx);\n}"
        }
      },
      {
        "call_info": {
          "callee": "fputs",
          "args": [
            "\"client public key:\\n\"",
            "stderr"
          ],
          "line": 114
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sshpkt_get_end",
          "args": [
            "ssh"
          ],
          "line": 110
        },
        "resolved": true,
        "details": {
          "function_name": "sshpkt_get_end",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
          "lines": "2555-2561",
          "snippet": "int\nsshpkt_get_end(struct ssh *ssh)\n{\n\tif (sshbuf_len(ssh->state->incoming_packet) > 0)\n\t\treturn SSH_ERR_UNEXPECTED_TRAILING_DATA;\n\treturn 0;\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include \"packet.h\"",
            "#include \"ssh.h\"",
            "#include \"channels.h\"",
            "#include \"misc.h\"",
            "#include \"canohost.h\"",
            "#include \"log.h\"",
            "#include \"mac.h\"",
            "#include \"digest.h\"",
            "#include \"kex.h\"",
            "#include \"sshkey.h\"",
            "#include \"cipher.h\"",
            "#include \"ssh2.h\"",
            "#include \"compat.h\"",
            "#include \"crc32.h\"",
            "#include \"xmalloc.h\"",
            "#include <zlib.h>",
            "#  include <openssl/ec.h>",
            "# include <openssl/evp.h>",
            "# include <openssl/bn.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <limits.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <netdb.h>",
            "#include <errno.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include \"openbsd-compat/sys-queue.h\"",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshpkt_get_end(struct ssh *ssh)\n{\n\tif (sshbuf_len(ssh->state->incoming_packet) > 0)\n\t\treturn SSH_ERR_UNEXPECTED_TRAILING_DATA;\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "sshpkt_get_ec",
          "args": [
            "ssh",
            "client_public",
            "group"
          ],
          "line": 109
        },
        "resolved": true,
        "details": {
          "function_name": "sshpkt_get_ec",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/packet.c",
          "lines": "2540-2544",
          "snippet": "int\nsshpkt_get_ec(struct ssh *ssh, EC_POINT *v, const EC_GROUP *g)\n{\n\treturn sshbuf_get_ec(ssh->state->incoming_packet, v, g);\n}",
          "includes": [
            "#include \"sshbuf.h\"",
            "#include \"ssherr.h\"",
            "#include \"packet.h\"",
            "#include \"ssh.h\"",
            "#include \"channels.h\"",
            "#include \"misc.h\"",
            "#include \"canohost.h\"",
            "#include \"log.h\"",
            "#include \"mac.h\"",
            "#include \"digest.h\"",
            "#include \"kex.h\"",
            "#include \"sshkey.h\"",
            "#include \"cipher.h\"",
            "#include \"ssh2.h\"",
            "#include \"compat.h\"",
            "#include \"crc32.h\"",
            "#include \"xmalloc.h\"",
            "#include <zlib.h>",
            "#  include <openssl/ec.h>",
            "# include <openssl/evp.h>",
            "# include <openssl/bn.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <limits.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <netdb.h>",
            "#include <errno.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in.h>",
            "# include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include \"openbsd-compat/sys-queue.h\"",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"packet.h\"\n#include \"ssh.h\"\n#include \"channels.h\"\n#include \"misc.h\"\n#include \"canohost.h\"\n#include \"log.h\"\n#include \"mac.h\"\n#include \"digest.h\"\n#include \"kex.h\"\n#include \"sshkey.h\"\n#include \"cipher.h\"\n#include \"ssh2.h\"\n#include \"compat.h\"\n#include \"crc32.h\"\n#include \"xmalloc.h\"\n#include <zlib.h>\n#  include <openssl/ec.h>\n# include <openssl/evp.h>\n# include <openssl/bn.h>\n#include <time.h>\n#include <signal.h>\n#include <limits.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <netdb.h>\n#include <errno.h>\n#include <arpa/inet.h>\n#include <netinet/ip.h>\n#include <netinet/in.h>\n# include <sys/time.h>\n#include <sys/socket.h>\n#include \"openbsd-compat/sys-queue.h\"\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nsshpkt_get_ec(struct ssh *ssh, EC_POINT *v, const EC_GROUP *g)\n{\n\treturn sshbuf_get_ec(ssh->state->incoming_packet, v, g);\n}"
        }
      },
      {
        "call_info": {
          "callee": "EC_POINT_new",
          "args": [
            "group"
          ],
          "line": 105
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kex->load_host_private_key",
          "args": [
            "kex->hostkey_type",
            "kex->hostkey_nid",
            "ssh"
          ],
          "line": 99
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kex->load_host_public_key",
          "args": [
            "kex->hostkey_type",
            "kex->hostkey_nid",
            "ssh"
          ],
          "line": 97
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sshkey_dump_ec_key",
          "args": [
            "server_key"
          ],
          "line": 89
        },
        "resolved": true,
        "details": {
          "function_name": "sshkey_dump_ec_key",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/sshkey.c",
          "lines": "3379-3392",
          "snippet": "void\nsshkey_dump_ec_key(const EC_KEY *key)\n{\n\tconst BIGNUM *exponent;\n\n\tsshkey_dump_ec_point(EC_KEY_get0_group(key),\n\t    EC_KEY_get0_public_key(key));\n\tfputs(\"exponent=\", stderr);\n\tif ((exponent = EC_KEY_get0_private_key(key)) == NULL)\n\t\tfputs(\"(NULL)\", stderr);\n\telse\n\t\tBN_print_fp(stderr, EC_KEY_get0_private_key(key));\n\tfputs(\"\\n\", stderr);\n}",
          "includes": [
            "#include \"openbsd-compat/openssl-compat.h\"",
            "#include \"xmss_fast.h\"",
            "#include \"match.h\"",
            "#include \"sshkey-xmss.h\"",
            "#include \"sshkey.h\"",
            "#include \"digest.h\"",
            "#include \"cipher.h\"",
            "#include \"sshbuf.h\"",
            "#include \"misc.h\"",
            "#include \"ssherr.h\"",
            "#include \"ssh2.h\"",
            "#include <util.h>",
            "#include <resolv.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <limits.h>",
            "#include <errno.h>",
            "#include \"crypto_api.h\"",
            "#include <openssl/pem.h>",
            "#include <openssl/err.h>",
            "#include <openssl/evp.h>",
            "#include <netinet/in.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"openbsd-compat/openssl-compat.h\"\n#include \"xmss_fast.h\"\n#include \"match.h\"\n#include \"sshkey-xmss.h\"\n#include \"sshkey.h\"\n#include \"digest.h\"\n#include \"cipher.h\"\n#include \"sshbuf.h\"\n#include \"misc.h\"\n#include \"ssherr.h\"\n#include \"ssh2.h\"\n#include <util.h>\n#include <resolv.h>\n#include <string.h>\n#include <stdio.h>\n#include <limits.h>\n#include <errno.h>\n#include \"crypto_api.h\"\n#include <openssl/pem.h>\n#include <openssl/err.h>\n#include <openssl/evp.h>\n#include <netinet/in.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\nsshkey_dump_ec_key(const EC_KEY *key)\n{\n\tconst BIGNUM *exponent;\n\n\tsshkey_dump_ec_point(EC_KEY_get0_group(key),\n\t    EC_KEY_get0_public_key(key));\n\tfputs(\"exponent=\", stderr);\n\tif ((exponent = EC_KEY_get0_private_key(key)) == NULL)\n\t\tfputs(\"(NULL)\", stderr);\n\telse\n\t\tBN_print_fp(stderr, EC_KEY_get0_private_key(key));\n\tfputs(\"\\n\", stderr);\n}"
        }
      },
      {
        "call_info": {
          "callee": "fputs",
          "args": [
            "\"server private key:\\n\"",
            "stderr"
          ],
          "line": 88
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "EC_KEY_get0_group",
          "args": [
            "server_key"
          ],
          "line": 85
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "EC_KEY_generate_key",
          "args": [
            "server_key"
          ],
          "line": 81
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "EC_KEY_new_by_curve_name",
          "args": [
            "kex->ec_nid"
          ],
          "line": 77
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"compat.h\"\n#include \"dispatch.h\"\n#include \"ssh2.h\"\n#include \"packet.h\"\n#include \"log.h\"\n#include \"kex.h\"\n#include \"digest.h\"\n#include \"cipher.h\"\n#include \"sshkey.h\"\n#include <openssl/ecdh.h>\n#include <signal.h>\n#include <string.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nstatic int\ninput_kex_ecdh_init(int type, u_int32_t seq, struct ssh *ssh)\n{\n\tstruct kex *kex = ssh->kex;\n\tEC_POINT *client_public;\n\tEC_KEY *server_key = NULL;\n\tconst EC_GROUP *group;\n\tconst EC_POINT *public_key;\n\tBIGNUM *shared_secret = NULL;\n\tstruct sshkey *server_host_private, *server_host_public;\n\tu_char *server_host_key_blob = NULL, *signature = NULL;\n\tu_char *kbuf = NULL;\n\tu_char hash[SSH_DIGEST_MAX_LENGTH];\n\tsize_t slen, sbloblen;\n\tsize_t klen = 0, hashlen;\n\tint r;\n\n\tif ((server_key = EC_KEY_new_by_curve_name(kex->ec_nid)) == NULL) {\n\t\tr = SSH_ERR_ALLOC_FAIL;\n\t\tgoto out;\n\t}\n\tif (EC_KEY_generate_key(server_key) != 1) {\n\t\tr = SSH_ERR_LIBCRYPTO_ERROR;\n\t\tgoto out;\n\t}\n\tgroup = EC_KEY_get0_group(server_key);\n\n#ifdef DEBUG_KEXECDH\n\tfputs(\"server private key:\\n\", stderr);\n\tsshkey_dump_ec_key(server_key);\n#endif\n\n\tif (kex->load_host_public_key == NULL ||\n\t    kex->load_host_private_key == NULL) {\n\t\tr = SSH_ERR_INVALID_ARGUMENT;\n\t\tgoto out;\n\t}\n\tserver_host_public = kex->load_host_public_key(kex->hostkey_type,\n\t    kex->hostkey_nid, ssh);\n\tserver_host_private = kex->load_host_private_key(kex->hostkey_type,\n\t    kex->hostkey_nid, ssh);\n\tif (server_host_public == NULL) {\n\t\tr = SSH_ERR_NO_HOSTKEY_LOADED;\n\t\tgoto out;\n\t}\n\tif ((client_public = EC_POINT_new(group)) == NULL) {\n\t\tr = SSH_ERR_ALLOC_FAIL;\n\t\tgoto out;\n\t}\n\tif ((r = sshpkt_get_ec(ssh, client_public, group)) != 0 ||\n\t    (r = sshpkt_get_end(ssh)) != 0)\n\t\tgoto out;\n\n#ifdef DEBUG_KEXECDH\n\tfputs(\"client public key:\\n\", stderr);\n\tsshkey_dump_ec_point(group, client_public);\n#endif\n\tif (sshkey_ec_validate_public(group, client_public) != 0) {\n\t\tsshpkt_disconnect(ssh, \"invalid client public key\");\n\t\tr = SSH_ERR_MESSAGE_INCOMPLETE;\n\t\tgoto out;\n\t}\n\n\t/* Calculate shared_secret */\n\tklen = (EC_GROUP_get_degree(group) + 7) / 8;\n\tif ((kbuf = malloc(klen)) == NULL ||\n\t    (shared_secret = BN_new()) == NULL) {\n\t\tr = SSH_ERR_ALLOC_FAIL;\n\t\tgoto out;\n\t}\n\tif (ECDH_compute_key(kbuf, klen, client_public,\n\t    server_key, NULL) != (int)klen ||\n\t    BN_bin2bn(kbuf, klen, shared_secret) == NULL) {\n\t\tr = SSH_ERR_LIBCRYPTO_ERROR;\n\t\tgoto out;\n\t}\n\n#ifdef DEBUG_KEXECDH\n\tdump_digest(\"shared secret\", kbuf, klen);\n#endif\n\t/* calc H */\n\tif ((r = sshkey_to_blob(server_host_public, &server_host_key_blob,\n\t    &sbloblen)) != 0)\n\t\tgoto out;\n\thashlen = sizeof(hash);\n\tif ((r = kex_ecdh_hash(\n\t    kex->hash_alg,\n\t    group,\n\t    kex->client_version_string,\n\t    kex->server_version_string,\n\t    sshbuf_ptr(kex->peer), sshbuf_len(kex->peer),\n\t    sshbuf_ptr(kex->my), sshbuf_len(kex->my),\n\t    server_host_key_blob, sbloblen,\n\t    client_public,\n\t    EC_KEY_get0_public_key(server_key),\n\t    shared_secret,\n\t    hash, &hashlen)) != 0)\n\t\tgoto out;\n\n\t/* save session id := H */\n\tif (kex->session_id == NULL) {\n\t\tkex->session_id_len = hashlen;\n\t\tkex->session_id = malloc(kex->session_id_len);\n\t\tif (kex->session_id == NULL) {\n\t\t\tr = SSH_ERR_ALLOC_FAIL;\n\t\t\tgoto out;\n\t\t}\n\t\tmemcpy(kex->session_id, hash, kex->session_id_len);\n\t}\n\n\t/* sign H */\n\tif ((r = kex->sign(server_host_private, server_host_public, &signature,\n\t     &slen, hash, hashlen, kex->hostkey_alg, ssh->compat)) < 0)\n\t\tgoto out;\n\n\t/* destroy_sensitive_data(); */\n\n\tpublic_key = EC_KEY_get0_public_key(server_key);\n\t/* send server hostkey, ECDH pubkey 'Q_S' and signed H */\n\tif ((r = sshpkt_start(ssh, SSH2_MSG_KEX_ECDH_REPLY)) != 0 ||\n\t    (r = sshpkt_put_string(ssh, server_host_key_blob, sbloblen)) != 0 ||\n\t    (r = sshpkt_put_ec(ssh, public_key, group)) != 0 ||\n\t    (r = sshpkt_put_string(ssh, signature, slen)) != 0 ||\n\t    (r = sshpkt_send(ssh)) != 0)\n\t\tgoto out;\n\n\tif ((r = kex_derive_keys_bn(ssh, hash, hashlen, shared_secret)) == 0)\n\t\tr = kex_send_newkeys(ssh);\n out:\n\texplicit_bzero(hash, sizeof(hash));\n\tEC_KEY_free(kex->ec_client_key);\n\tkex->ec_client_key = NULL;\n\tEC_KEY_free(server_key);\n\tif (kbuf) {\n\t\texplicit_bzero(kbuf, klen);\n\t\tfree(kbuf);\n\t}\n\tBN_clear_free(shared_secret);\n\tfree(server_host_key_blob);\n\tfree(signature);\n\treturn r;\n}"
  },
  {
    "function_name": "kexecdh_server",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/kexecdhs.c",
    "lines": "52-58",
    "snippet": "int\nkexecdh_server(struct ssh *ssh)\n{\n\tdebug(\"expecting SSH2_MSG_KEX_ECDH_INIT\");\n\tssh_dispatch_set(ssh, SSH2_MSG_KEX_ECDH_INIT, &input_kex_ecdh_init);\n\treturn 0;\n}",
    "includes": [
      "#include \"sshbuf.h\"",
      "#include \"ssherr.h\"",
      "#include \"compat.h\"",
      "#include \"dispatch.h\"",
      "#include \"ssh2.h\"",
      "#include \"packet.h\"",
      "#include \"log.h\"",
      "#include \"kex.h\"",
      "#include \"digest.h\"",
      "#include \"cipher.h\"",
      "#include \"sshkey.h\"",
      "#include <openssl/ecdh.h>",
      "#include <signal.h>",
      "#include <string.h>",
      "#include <sys/types.h>",
      "#include \"includes.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "ssh_dispatch_set",
          "args": [
            "ssh",
            "SSH2_MSG_KEX_ECDH_INIT",
            "&input_kex_ecdh_init"
          ],
          "line": 56
        },
        "resolved": true,
        "details": {
          "function_name": "ssh_dispatch_set",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/dispatch.c",
          "lines": "81-85",
          "snippet": "void\nssh_dispatch_set(struct ssh *ssh, int type, dispatch_fn *fn)\n{\n\tssh->dispatch[type] = fn;\n}",
          "includes": [
            "#include \"ssherr.h\"",
            "#include \"compat.h\"",
            "#include \"packet.h\"",
            "#include \"dispatch.h\"",
            "#include \"log.h\"",
            "#include \"ssh2.h\"",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"ssherr.h\"\n#include \"compat.h\"\n#include \"packet.h\"\n#include \"dispatch.h\"\n#include \"log.h\"\n#include \"ssh2.h\"\n#include <stdarg.h>\n#include <signal.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\nssh_dispatch_set(struct ssh *ssh, int type, dispatch_fn *fn)\n{\n\tssh->dispatch[type] = fn;\n}"
        }
      },
      {
        "call_info": {
          "callee": "debug",
          "args": [
            "\"expecting SSH2_MSG_KEX_ECDH_INIT\""
          ],
          "line": 55
        },
        "resolved": true,
        "details": {
          "function_name": "debug3",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-20685/repo/log.c",
          "lines": "242-250",
          "snippet": "void\ndebug3(const char *fmt,...)\n{\n\tva_list args;\n\n\tva_start(args, fmt);\n\tdo_log(SYSLOG_LEVEL_DEBUG3, fmt, args);\n\tva_end(args);\n}",
          "includes": [
            "#include \"log.h\"",
            "# include <vis.h>",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <syslog.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <fcntl.h>",
            "#include <sys/types.h>",
            "#include \"includes.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n# include <vis.h>\n#include <errno.h>\n#include <unistd.h>\n#include <syslog.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <fcntl.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nvoid\ndebug3(const char *fmt,...)\n{\n\tva_list args;\n\n\tva_start(args, fmt);\n\tdo_log(SYSLOG_LEVEL_DEBUG3, fmt, args);\n\tva_end(args);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"sshbuf.h\"\n#include \"ssherr.h\"\n#include \"compat.h\"\n#include \"dispatch.h\"\n#include \"ssh2.h\"\n#include \"packet.h\"\n#include \"log.h\"\n#include \"kex.h\"\n#include \"digest.h\"\n#include \"cipher.h\"\n#include \"sshkey.h\"\n#include <openssl/ecdh.h>\n#include <signal.h>\n#include <string.h>\n#include <sys/types.h>\n#include \"includes.h\"\n\nint\nkexecdh_server(struct ssh *ssh)\n{\n\tdebug(\"expecting SSH2_MSG_KEX_ECDH_INIT\");\n\tssh_dispatch_set(ssh, SSH2_MSG_KEX_ECDH_INIT, &input_kex_ecdh_init);\n\treturn 0;\n}"
  }
]