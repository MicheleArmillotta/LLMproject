[
  {
    "function_name": "vmx_has_waitpkg",
    "container": null,
    "file": "output_repos_c_ICV/CVE-2021-3656/repo/arch/x86/kvm/vmx/vmx.h",
    "lines": "527-531",
    "snippet": "static inline bool vmx_has_waitpkg(struct vcpu_vmx *vmx)\n{\n\treturn vmx->secondary_exec_control &\n\t\tSECONDARY_EXEC_ENABLE_USR_WAIT_PAUSE;\n}",
    "includes": [
      "#include \"vmcs.h\"",
      "#include \"ops.h\"",
      "#include \"capabilities.h\"",
      "#include <asm/intel_pt.h>",
      "#include <asm/kvm.h>",
      "#include <linux/kvm_host.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"vmcs.h\"\n#include \"ops.h\"\n#include \"capabilities.h\"\n#include <asm/intel_pt.h>\n#include <asm/kvm.h>\n#include <linux/kvm_host.h>\n\nstatic inline bool vmx_has_waitpkg(struct vcpu_vmx *vmx)\n{\n\treturn vmx->secondary_exec_control &\n\t\tSECONDARY_EXEC_ENABLE_USR_WAIT_PAUSE;\n}"
  },
  {
    "function_name": "decache_tsc_multiplier",
    "container": null,
    "file": "output_repos_c_ICV/CVE-2021-3656/repo/arch/x86/kvm/vmx/vmx.h",
    "lines": "521-525",
    "snippet": "static inline void decache_tsc_multiplier(struct vcpu_vmx *vmx)\n{\n\tvmx->current_tsc_ratio = vmx->vcpu.arch.tsc_scaling_ratio;\n\tvmcs_write64(TSC_MULTIPLIER, vmx->current_tsc_ratio);\n}",
    "includes": [
      "#include \"vmcs.h\"",
      "#include \"ops.h\"",
      "#include \"capabilities.h\"",
      "#include <asm/intel_pt.h>",
      "#include <asm/kvm.h>",
      "#include <linux/kvm_host.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "vmcs_write64",
          "args": [
            "TSC_MULTIPLIER",
            "vmx->current_tsc_ratio"
          ],
          "line": 524
        },
        "resolved": true,
        "details": {
          "function_name": "vmcs_write64",
          "container": null,
          "file": "output_repos_c_ICV/CVE-2021-3656/repo/arch/x86/kvm/vmx/ops.h",
          "lines": "193-203",
          "snippet": "static __always_inline void vmcs_write64(unsigned long field, u64 value)\n{\n\tvmcs_check64(field);\n\tif (static_branch_unlikely(&enable_evmcs))\n\t\treturn evmcs_write64(field, value);\n\n\t__vmcs_writel(field, value);\n#ifndef CONFIG_X86_64\n\t__vmcs_writel(field+1, value >> 32);\n#endif\n}",
          "includes": [
            "#include \"vmcs.h\"",
            "#include \"evmcs.h\"",
            "#include <asm/vmx.h>",
            "#include <asm/kvm_host.h>",
            "#include <linux/nospec.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"vmcs.h\"\n#include \"evmcs.h\"\n#include <asm/vmx.h>\n#include <asm/kvm_host.h>\n#include <linux/nospec.h>\n\nstatic __always_inline void vmcs_write64(unsigned long field, u64 value)\n{\n\tvmcs_check64(field);\n\tif (static_branch_unlikely(&enable_evmcs))\n\t\treturn evmcs_write64(field, value);\n\n\t__vmcs_writel(field, value);\n#ifndef CONFIG_X86_64\n\t__vmcs_writel(field+1, value >> 32);\n#endif\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"vmcs.h\"\n#include \"ops.h\"\n#include \"capabilities.h\"\n#include <asm/intel_pt.h>\n#include <asm/kvm.h>\n#include <linux/kvm_host.h>\n\nstatic inline void decache_tsc_multiplier(struct vcpu_vmx *vmx)\n{\n\tvmx->current_tsc_ratio = vmx->vcpu.arch.tsc_scaling_ratio;\n\tvmcs_write64(TSC_MULTIPLIER, vmx->current_tsc_ratio);\n}"
  },
  {
    "function_name": "vmx_flush_tlb",
    "container": null,
    "file": "output_repos_c_ICV/CVE-2021-3656/repo/arch/x86/kvm/vmx/vmx.h",
    "lines": "516-519",
    "snippet": "static inline void vmx_flush_tlb(struct kvm_vcpu *vcpu, bool invalidate_gpa)\n{\n\t__vmx_flush_tlb(vcpu, to_vmx(vcpu)->vpid, invalidate_gpa);\n}",
    "includes": [
      "#include \"vmcs.h\"",
      "#include \"ops.h\"",
      "#include \"capabilities.h\"",
      "#include <asm/intel_pt.h>",
      "#include <asm/kvm.h>",
      "#include <linux/kvm_host.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "__vmx_flush_tlb",
          "args": [
            "vcpu",
            "to_vmx(vcpu)->vpid",
            "invalidate_gpa"
          ],
          "line": 518
        },
        "resolved": true,
        "details": {
          "function_name": "__vmx_flush_tlb",
          "container": null,
          "file": "output_repos_c_ICV/CVE-2021-3656/repo/arch/x86/kvm/vmx/vmx.h",
          "lines": "503-514",
          "snippet": "static inline void __vmx_flush_tlb(struct kvm_vcpu *vcpu, int vpid,\n\t\t\t\tbool invalidate_gpa)\n{\n\tif (enable_ept && (invalidate_gpa || !enable_vpid)) {\n\t\tif (!VALID_PAGE(vcpu->arch.mmu->root_hpa))\n\t\t\treturn;\n\t\tept_sync_context(construct_eptp(vcpu,\n\t\t\t\t\t\tvcpu->arch.mmu->root_hpa));\n\t} else {\n\t\tvpid_sync_context(vpid);\n\t}\n}",
          "includes": [
            "#include \"vmcs.h\"",
            "#include \"ops.h\"",
            "#include \"capabilities.h\"",
            "#include <asm/intel_pt.h>",
            "#include <asm/kvm.h>",
            "#include <linux/kvm_host.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"vmcs.h\"\n#include \"ops.h\"\n#include \"capabilities.h\"\n#include <asm/intel_pt.h>\n#include <asm/kvm.h>\n#include <linux/kvm_host.h>\n\nstatic inline void __vmx_flush_tlb(struct kvm_vcpu *vcpu, int vpid,\n\t\t\t\tbool invalidate_gpa)\n{\n\tif (enable_ept && (invalidate_gpa || !enable_vpid)) {\n\t\tif (!VALID_PAGE(vcpu->arch.mmu->root_hpa))\n\t\t\treturn;\n\t\tept_sync_context(construct_eptp(vcpu,\n\t\t\t\t\t\tvcpu->arch.mmu->root_hpa));\n\t} else {\n\t\tvpid_sync_context(vpid);\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "to_vmx",
          "args": [
            "vcpu"
          ],
          "line": 518
        },
        "resolved": true,
        "details": {
          "function_name": "to_vmx",
          "container": null,
          "file": "output_repos_c_ICV/CVE-2021-3656/repo/arch/x86/kvm/vmx/vmx.h",
          "lines": "479-482",
          "snippet": "static inline struct vcpu_vmx *to_vmx(struct kvm_vcpu *vcpu)\n{\n\treturn container_of(vcpu, struct vcpu_vmx, vcpu);\n}",
          "includes": [
            "#include \"vmcs.h\"",
            "#include \"ops.h\"",
            "#include \"capabilities.h\"",
            "#include <asm/intel_pt.h>",
            "#include <asm/kvm.h>",
            "#include <linux/kvm_host.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"vmcs.h\"\n#include \"ops.h\"\n#include \"capabilities.h\"\n#include <asm/intel_pt.h>\n#include <asm/kvm.h>\n#include <linux/kvm_host.h>\n\nstatic inline struct vcpu_vmx *to_vmx(struct kvm_vcpu *vcpu)\n{\n\treturn container_of(vcpu, struct vcpu_vmx, vcpu);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"vmcs.h\"\n#include \"ops.h\"\n#include \"capabilities.h\"\n#include <asm/intel_pt.h>\n#include <asm/kvm.h>\n#include <linux/kvm_host.h>\n\nstatic inline void vmx_flush_tlb(struct kvm_vcpu *vcpu, bool invalidate_gpa)\n{\n\t__vmx_flush_tlb(vcpu, to_vmx(vcpu)->vpid, invalidate_gpa);\n}"
  },
  {
    "function_name": "__vmx_flush_tlb",
    "container": null,
    "file": "output_repos_c_ICV/CVE-2021-3656/repo/arch/x86/kvm/vmx/vmx.h",
    "lines": "503-514",
    "snippet": "static inline void __vmx_flush_tlb(struct kvm_vcpu *vcpu, int vpid,\n\t\t\t\tbool invalidate_gpa)\n{\n\tif (enable_ept && (invalidate_gpa || !enable_vpid)) {\n\t\tif (!VALID_PAGE(vcpu->arch.mmu->root_hpa))\n\t\t\treturn;\n\t\tept_sync_context(construct_eptp(vcpu,\n\t\t\t\t\t\tvcpu->arch.mmu->root_hpa));\n\t} else {\n\t\tvpid_sync_context(vpid);\n\t}\n}",
    "includes": [
      "#include \"vmcs.h\"",
      "#include \"ops.h\"",
      "#include \"capabilities.h\"",
      "#include <asm/intel_pt.h>",
      "#include <asm/kvm.h>",
      "#include <linux/kvm_host.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "vpid_sync_context",
          "args": [
            "vpid"
          ],
          "line": 512
        },
        "resolved": true,
        "details": {
          "function_name": "vpid_sync_context",
          "container": null,
          "file": "output_repos_c_ICV/CVE-2021-3656/repo/arch/x86/kvm/vmx/ops.h",
          "lines": "299-305",
          "snippet": "static inline void vpid_sync_context(int vpid)\n{\n\tif (cpu_has_vmx_invvpid_single())\n\t\tvpid_sync_vcpu_single(vpid);\n\telse\n\t\tvpid_sync_vcpu_global();\n}",
          "includes": [
            "#include \"vmcs.h\"",
            "#include \"evmcs.h\"",
            "#include <asm/vmx.h>",
            "#include <asm/kvm_host.h>",
            "#include <linux/nospec.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"vmcs.h\"\n#include \"evmcs.h\"\n#include <asm/vmx.h>\n#include <asm/kvm_host.h>\n#include <linux/nospec.h>\n\nstatic inline void vpid_sync_context(int vpid)\n{\n\tif (cpu_has_vmx_invvpid_single())\n\t\tvpid_sync_vcpu_single(vpid);\n\telse\n\t\tvpid_sync_vcpu_global();\n}"
        }
      },
      {
        "call_info": {
          "callee": "ept_sync_context",
          "args": [
            "construct_eptp(vcpu,\n\t\t\t\t\t\tvcpu->arch.mmu->root_hpa)"
          ],
          "line": 509
        },
        "resolved": true,
        "details": {
          "function_name": "ept_sync_context",
          "container": null,
          "file": "output_repos_c_ICV/CVE-2021-3656/repo/arch/x86/kvm/vmx/ops.h",
          "lines": "312-318",
          "snippet": "static inline void ept_sync_context(u64 eptp)\n{\n\tif (cpu_has_vmx_invept_context())\n\t\t__invept(VMX_EPT_EXTENT_CONTEXT, eptp, 0);\n\telse\n\t\tept_sync_global();\n}",
          "includes": [
            "#include \"vmcs.h\"",
            "#include \"evmcs.h\"",
            "#include <asm/vmx.h>",
            "#include <asm/kvm_host.h>",
            "#include <linux/nospec.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"vmcs.h\"\n#include \"evmcs.h\"\n#include <asm/vmx.h>\n#include <asm/kvm_host.h>\n#include <linux/nospec.h>\n\nstatic inline void ept_sync_context(u64 eptp)\n{\n\tif (cpu_has_vmx_invept_context())\n\t\t__invept(VMX_EPT_EXTENT_CONTEXT, eptp, 0);\n\telse\n\t\tept_sync_global();\n}"
        }
      },
      {
        "call_info": {
          "callee": "construct_eptp",
          "args": [
            "vcpu",
            "vcpu->arch.mmu->root_hpa"
          ],
          "line": 509
        },
        "resolved": true,
        "details": {
          "function_name": "construct_eptp",
          "container": null,
          "file": "output_repos_c_ICV/CVE-2021-3656/repo/arch/x86/kvm/vmx/vmx.c",
          "lines": "2977-2989",
          "snippet": "u64 construct_eptp(struct kvm_vcpu *vcpu, unsigned long root_hpa)\n{\n\tu64 eptp = VMX_EPTP_MT_WB;\n\n\teptp |= (get_ept_level(vcpu) == 5) ? VMX_EPTP_PWL_5 : VMX_EPTP_PWL_4;\n\n\tif (enable_ept_ad_bits &&\n\t    (!is_guest_mode(vcpu) || nested_ept_ad_enabled(vcpu)))\n\t\teptp |= VMX_EPTP_AD_ENABLE_BIT;\n\teptp |= (root_hpa & PAGE_MASK);\n\n\treturn eptp;\n}",
          "includes": [
            "#include \"x86.h\"",
            "#include \"vmx.h\"",
            "#include \"vmcs12.h\"",
            "#include \"vmcs.h\"",
            "#include \"trace.h\"",
            "#include \"pmu.h\"",
            "#include \"ops.h\"",
            "#include \"nested.h\"",
            "#include \"mmu.h\"",
            "#include \"lapic.h\"",
            "#include \"kvm_cache_regs.h\"",
            "#include \"irq.h\"",
            "#include \"evmcs.h\"",
            "#include \"cpuid.h\"",
            "#include \"capabilities.h\"",
            "#include <asm/vmx.h>",
            "#include <asm/virtext.h>",
            "#include <asm/spec-ctrl.h>",
            "#include <asm/mwait.h>",
            "#include <asm/mshyperv.h>",
            "#include <asm/mmu_context.h>",
            "#include <asm/mce.h>",
            "#include <asm/perf_event.h>",
            "#include <asm/kexec.h>",
            "#include <asm/irq_remapping.h>",
            "#include <asm/io.h>",
            "#include <asm/fpu/internal.h>",
            "#include <asm/desc.h>",
            "#include <asm/debugreg.h>",
            "#include <asm/cpu_device_id.h>",
            "#include <asm/cpu.h>",
            "#include <asm/asm.h>",
            "#include <asm/apic.h>",
            "#include <linux/trace_events.h>",
            "#include <linux/tboot.h>",
            "#include <linux/slab.h>",
            "#include <linux/sched/smt.h>",
            "#include <linux/sched.h>",
            "#include <linux/mm.h>",
            "#include <linux/mod_devicetable.h>",
            "#include <linux/moduleparam.h>",
            "#include <linux/module.h>",
            "#include <linux/kvm_host.h>",
            "#include <linux/kernel.h>",
            "#include <linux/hrtimer.h>",
            "#include <linux/highmem.h>",
            "#include <linux/frame.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static bool guest_state_valid(struct kvm_vcpu *vcpu);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"x86.h\"\n#include \"vmx.h\"\n#include \"vmcs12.h\"\n#include \"vmcs.h\"\n#include \"trace.h\"\n#include \"pmu.h\"\n#include \"ops.h\"\n#include \"nested.h\"\n#include \"mmu.h\"\n#include \"lapic.h\"\n#include \"kvm_cache_regs.h\"\n#include \"irq.h\"\n#include \"evmcs.h\"\n#include \"cpuid.h\"\n#include \"capabilities.h\"\n#include <asm/vmx.h>\n#include <asm/virtext.h>\n#include <asm/spec-ctrl.h>\n#include <asm/mwait.h>\n#include <asm/mshyperv.h>\n#include <asm/mmu_context.h>\n#include <asm/mce.h>\n#include <asm/perf_event.h>\n#include <asm/kexec.h>\n#include <asm/irq_remapping.h>\n#include <asm/io.h>\n#include <asm/fpu/internal.h>\n#include <asm/desc.h>\n#include <asm/debugreg.h>\n#include <asm/cpu_device_id.h>\n#include <asm/cpu.h>\n#include <asm/asm.h>\n#include <asm/apic.h>\n#include <linux/trace_events.h>\n#include <linux/tboot.h>\n#include <linux/slab.h>\n#include <linux/sched/smt.h>\n#include <linux/sched.h>\n#include <linux/mm.h>\n#include <linux/mod_devicetable.h>\n#include <linux/moduleparam.h>\n#include <linux/module.h>\n#include <linux/kvm_host.h>\n#include <linux/kernel.h>\n#include <linux/hrtimer.h>\n#include <linux/highmem.h>\n#include <linux/frame.h>\n\nstatic bool guest_state_valid(struct kvm_vcpu *vcpu);\n\nu64 construct_eptp(struct kvm_vcpu *vcpu, unsigned long root_hpa)\n{\n\tu64 eptp = VMX_EPTP_MT_WB;\n\n\teptp |= (get_ept_level(vcpu) == 5) ? VMX_EPTP_PWL_5 : VMX_EPTP_PWL_4;\n\n\tif (enable_ept_ad_bits &&\n\t    (!is_guest_mode(vcpu) || nested_ept_ad_enabled(vcpu)))\n\t\teptp |= VMX_EPTP_AD_ENABLE_BIT;\n\teptp |= (root_hpa & PAGE_MASK);\n\n\treturn eptp;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VALID_PAGE",
          "args": [
            "vcpu->arch.mmu->root_hpa"
          ],
          "line": 507
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"vmcs.h\"\n#include \"ops.h\"\n#include \"capabilities.h\"\n#include <asm/intel_pt.h>\n#include <asm/kvm.h>\n#include <linux/kvm_host.h>\n\nstatic inline void __vmx_flush_tlb(struct kvm_vcpu *vcpu, int vpid,\n\t\t\t\tbool invalidate_gpa)\n{\n\tif (enable_ept && (invalidate_gpa || !enable_vpid)) {\n\t\tif (!VALID_PAGE(vcpu->arch.mmu->root_hpa))\n\t\t\treturn;\n\t\tept_sync_context(construct_eptp(vcpu,\n\t\t\t\t\t\tvcpu->arch.mmu->root_hpa));\n\t} else {\n\t\tvpid_sync_context(vpid);\n\t}\n}"
  },
  {
    "function_name": "alloc_vmcs",
    "container": null,
    "file": "output_repos_c_ICV/CVE-2021-3656/repo/arch/x86/kvm/vmx/vmx.h",
    "lines": "495-499",
    "snippet": "static inline struct vmcs *alloc_vmcs(bool shadow)\n{\n\treturn alloc_vmcs_cpu(shadow, raw_smp_processor_id(),\n\t\t\t      GFP_KERNEL_ACCOUNT);\n}",
    "includes": [
      "#include \"vmcs.h\"",
      "#include \"ops.h\"",
      "#include \"capabilities.h\"",
      "#include <asm/intel_pt.h>",
      "#include <asm/kvm.h>",
      "#include <linux/kvm_host.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "alloc_vmcs_cpu",
          "args": [
            "shadow",
            "raw_smp_processor_id()",
            "GFP_KERNEL_ACCOUNT"
          ],
          "line": 497
        },
        "resolved": true,
        "details": {
          "function_name": "alloc_vmcs_cpu",
          "container": null,
          "file": "output_repos_c_ICV/CVE-2021-3656/repo/arch/x86/kvm/vmx/vmx.c",
          "lines": "2534-2555",
          "snippet": "struct vmcs *alloc_vmcs_cpu(bool shadow, int cpu, gfp_t flags)\n{\n\tint node = cpu_to_node(cpu);\n\tstruct page *pages;\n\tstruct vmcs *vmcs;\n\n\tpages = __alloc_pages_node(node, flags, vmcs_config.order);\n\tif (!pages)\n\t\treturn NULL;\n\tvmcs = page_address(pages);\n\tmemset(vmcs, 0, vmcs_config.size);\n\n\t/* KVM supports Enlightened VMCS v1 only */\n\tif (static_branch_unlikely(&enable_evmcs))\n\t\tvmcs->hdr.revision_id = KVM_EVMCS_VERSION;\n\telse\n\t\tvmcs->hdr.revision_id = vmcs_config.revision_id;\n\n\tif (shadow)\n\t\tvmcs->hdr.shadow_vmcs = 1;\n\treturn vmcs;\n}",
          "includes": [
            "#include \"x86.h\"",
            "#include \"vmx.h\"",
            "#include \"vmcs12.h\"",
            "#include \"vmcs.h\"",
            "#include \"trace.h\"",
            "#include \"pmu.h\"",
            "#include \"ops.h\"",
            "#include \"nested.h\"",
            "#include \"mmu.h\"",
            "#include \"lapic.h\"",
            "#include \"kvm_cache_regs.h\"",
            "#include \"irq.h\"",
            "#include \"evmcs.h\"",
            "#include \"cpuid.h\"",
            "#include \"capabilities.h\"",
            "#include <asm/vmx.h>",
            "#include <asm/virtext.h>",
            "#include <asm/spec-ctrl.h>",
            "#include <asm/mwait.h>",
            "#include <asm/mshyperv.h>",
            "#include <asm/mmu_context.h>",
            "#include <asm/mce.h>",
            "#include <asm/perf_event.h>",
            "#include <asm/kexec.h>",
            "#include <asm/irq_remapping.h>",
            "#include <asm/io.h>",
            "#include <asm/fpu/internal.h>",
            "#include <asm/desc.h>",
            "#include <asm/debugreg.h>",
            "#include <asm/cpu_device_id.h>",
            "#include <asm/cpu.h>",
            "#include <asm/asm.h>",
            "#include <asm/apic.h>",
            "#include <linux/trace_events.h>",
            "#include <linux/tboot.h>",
            "#include <linux/slab.h>",
            "#include <linux/sched/smt.h>",
            "#include <linux/sched.h>",
            "#include <linux/mm.h>",
            "#include <linux/mod_devicetable.h>",
            "#include <linux/moduleparam.h>",
            "#include <linux/module.h>",
            "#include <linux/kvm_host.h>",
            "#include <linux/kernel.h>",
            "#include <linux/hrtimer.h>",
            "#include <linux/highmem.h>",
            "#include <linux/frame.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "struct vmcs_config vmcs_config;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"x86.h\"\n#include \"vmx.h\"\n#include \"vmcs12.h\"\n#include \"vmcs.h\"\n#include \"trace.h\"\n#include \"pmu.h\"\n#include \"ops.h\"\n#include \"nested.h\"\n#include \"mmu.h\"\n#include \"lapic.h\"\n#include \"kvm_cache_regs.h\"\n#include \"irq.h\"\n#include \"evmcs.h\"\n#include \"cpuid.h\"\n#include \"capabilities.h\"\n#include <asm/vmx.h>\n#include <asm/virtext.h>\n#include <asm/spec-ctrl.h>\n#include <asm/mwait.h>\n#include <asm/mshyperv.h>\n#include <asm/mmu_context.h>\n#include <asm/mce.h>\n#include <asm/perf_event.h>\n#include <asm/kexec.h>\n#include <asm/irq_remapping.h>\n#include <asm/io.h>\n#include <asm/fpu/internal.h>\n#include <asm/desc.h>\n#include <asm/debugreg.h>\n#include <asm/cpu_device_id.h>\n#include <asm/cpu.h>\n#include <asm/asm.h>\n#include <asm/apic.h>\n#include <linux/trace_events.h>\n#include <linux/tboot.h>\n#include <linux/slab.h>\n#include <linux/sched/smt.h>\n#include <linux/sched.h>\n#include <linux/mm.h>\n#include <linux/mod_devicetable.h>\n#include <linux/moduleparam.h>\n#include <linux/module.h>\n#include <linux/kvm_host.h>\n#include <linux/kernel.h>\n#include <linux/hrtimer.h>\n#include <linux/highmem.h>\n#include <linux/frame.h>\n\nstruct vmcs_config vmcs_config;\n\nstruct vmcs *alloc_vmcs_cpu(bool shadow, int cpu, gfp_t flags)\n{\n\tint node = cpu_to_node(cpu);\n\tstruct page *pages;\n\tstruct vmcs *vmcs;\n\n\tpages = __alloc_pages_node(node, flags, vmcs_config.order);\n\tif (!pages)\n\t\treturn NULL;\n\tvmcs = page_address(pages);\n\tmemset(vmcs, 0, vmcs_config.size);\n\n\t/* KVM supports Enlightened VMCS v1 only */\n\tif (static_branch_unlikely(&enable_evmcs))\n\t\tvmcs->hdr.revision_id = KVM_EVMCS_VERSION;\n\telse\n\t\tvmcs->hdr.revision_id = vmcs_config.revision_id;\n\n\tif (shadow)\n\t\tvmcs->hdr.shadow_vmcs = 1;\n\treturn vmcs;\n}"
        }
      },
      {
        "call_info": {
          "callee": "raw_smp_processor_id",
          "args": [],
          "line": 497
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"vmcs.h\"\n#include \"ops.h\"\n#include \"capabilities.h\"\n#include <asm/intel_pt.h>\n#include <asm/kvm.h>\n#include <linux/kvm_host.h>\n\nstatic inline struct vmcs *alloc_vmcs(bool shadow)\n{\n\treturn alloc_vmcs_cpu(shadow, raw_smp_processor_id(),\n\t\t\t      GFP_KERNEL_ACCOUNT);\n}"
  },
  {
    "function_name": "vcpu_to_pi_desc",
    "container": null,
    "file": "output_repos_c_ICV/CVE-2021-3656/repo/arch/x86/kvm/vmx/vmx.h",
    "lines": "484-487",
    "snippet": "static inline struct pi_desc *vcpu_to_pi_desc(struct kvm_vcpu *vcpu)\n{\n\treturn &(to_vmx(vcpu)->pi_desc);\n}",
    "includes": [
      "#include \"vmcs.h\"",
      "#include \"ops.h\"",
      "#include \"capabilities.h\"",
      "#include <asm/intel_pt.h>",
      "#include <asm/kvm.h>",
      "#include <linux/kvm_host.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "to_vmx",
          "args": [
            "vcpu"
          ],
          "line": 486
        },
        "resolved": true,
        "details": {
          "function_name": "to_vmx",
          "container": null,
          "file": "output_repos_c_ICV/CVE-2021-3656/repo/arch/x86/kvm/vmx/vmx.h",
          "lines": "479-482",
          "snippet": "static inline struct vcpu_vmx *to_vmx(struct kvm_vcpu *vcpu)\n{\n\treturn container_of(vcpu, struct vcpu_vmx, vcpu);\n}",
          "includes": [
            "#include \"vmcs.h\"",
            "#include \"ops.h\"",
            "#include \"capabilities.h\"",
            "#include <asm/intel_pt.h>",
            "#include <asm/kvm.h>",
            "#include <linux/kvm_host.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"vmcs.h\"\n#include \"ops.h\"\n#include \"capabilities.h\"\n#include <asm/intel_pt.h>\n#include <asm/kvm.h>\n#include <linux/kvm_host.h>\n\nstatic inline struct vcpu_vmx *to_vmx(struct kvm_vcpu *vcpu)\n{\n\treturn container_of(vcpu, struct vcpu_vmx, vcpu);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"vmcs.h\"\n#include \"ops.h\"\n#include \"capabilities.h\"\n#include <asm/intel_pt.h>\n#include <asm/kvm.h>\n#include <linux/kvm_host.h>\n\nstatic inline struct pi_desc *vcpu_to_pi_desc(struct kvm_vcpu *vcpu)\n{\n\treturn &(to_vmx(vcpu)->pi_desc);\n}"
  },
  {
    "function_name": "to_vmx",
    "container": null,
    "file": "output_repos_c_ICV/CVE-2021-3656/repo/arch/x86/kvm/vmx/vmx.h",
    "lines": "479-482",
    "snippet": "static inline struct vcpu_vmx *to_vmx(struct kvm_vcpu *vcpu)\n{\n\treturn container_of(vcpu, struct vcpu_vmx, vcpu);\n}",
    "includes": [
      "#include \"vmcs.h\"",
      "#include \"ops.h\"",
      "#include \"capabilities.h\"",
      "#include <asm/intel_pt.h>",
      "#include <asm/kvm.h>",
      "#include <linux/kvm_host.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "container_of",
          "args": [
            "vcpu",
            "structvcpu_vmx",
            "vcpu"
          ],
          "line": 481
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"vmcs.h\"\n#include \"ops.h\"\n#include \"capabilities.h\"\n#include <asm/intel_pt.h>\n#include <asm/kvm.h>\n#include <linux/kvm_host.h>\n\nstatic inline struct vcpu_vmx *to_vmx(struct kvm_vcpu *vcpu)\n{\n\treturn container_of(vcpu, struct vcpu_vmx, vcpu);\n}"
  },
  {
    "function_name": "to_kvm_vmx",
    "container": null,
    "file": "output_repos_c_ICV/CVE-2021-3656/repo/arch/x86/kvm/vmx/vmx.h",
    "lines": "474-477",
    "snippet": "static inline struct kvm_vmx *to_kvm_vmx(struct kvm *kvm)\n{\n\treturn container_of(kvm, struct kvm_vmx, kvm);\n}",
    "includes": [
      "#include \"vmcs.h\"",
      "#include \"ops.h\"",
      "#include \"capabilities.h\"",
      "#include <asm/intel_pt.h>",
      "#include <asm/kvm.h>",
      "#include <linux/kvm_host.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "container_of",
          "args": [
            "kvm",
            "structkvm_vmx",
            "kvm"
          ],
          "line": 476
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"vmcs.h\"\n#include \"ops.h\"\n#include \"capabilities.h\"\n#include <asm/intel_pt.h>\n#include <asm/kvm.h>\n#include <linux/kvm_host.h>\n\nstatic inline struct kvm_vmx *to_kvm_vmx(struct kvm *kvm)\n{\n\treturn container_of(kvm, struct kvm_vmx, kvm);\n}"
  },
  {
    "function_name": "vmx_vmexit_ctrl",
    "container": null,
    "file": "output_repos_c_ICV/CVE-2021-3656/repo/arch/x86/kvm/vmx/vmx.h",
    "lines": "460-469",
    "snippet": "static inline u32 vmx_vmexit_ctrl(void)\n{\n\tu32 vmexit_ctrl = vmcs_config.vmexit_ctrl;\n\tif (vmx_pt_mode_is_system())\n\t\tvmexit_ctrl &= ~(VM_EXIT_PT_CONCEAL_PIP |\n\t\t\t\t VM_EXIT_CLEAR_IA32_RTIT_CTL);\n\t/* Loading of EFER and PERF_GLOBAL_CTRL are toggled dynamically */\n\treturn vmexit_ctrl &\n\t\t~(VM_EXIT_LOAD_IA32_PERF_GLOBAL_CTRL | VM_EXIT_LOAD_IA32_EFER);\n}",
    "includes": [
      "#include \"vmcs.h\"",
      "#include \"ops.h\"",
      "#include \"capabilities.h\"",
      "#include <asm/intel_pt.h>",
      "#include <asm/kvm.h>",
      "#include <linux/kvm_host.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "vmx_pt_mode_is_system",
          "args": [],
          "line": 463
        },
        "resolved": true,
        "details": {
          "function_name": "vmx_pt_mode_is_system",
          "container": null,
          "file": "output_repos_c_ICV/CVE-2021-3656/repo/arch/x86/kvm/vmx/capabilities.h",
          "lines": "361-364",
          "snippet": "static inline bool vmx_pt_mode_is_system(void)\n{\n\treturn pt_mode == PT_MODE_SYSTEM;\n}",
          "includes": [
            "#include \"lapic.h\"",
            "#include <asm/vmx.h>"
          ],
          "macros_used": [
            "#define PT_MODE_SYSTEM\t\t0"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"lapic.h\"\n#include <asm/vmx.h>\n\n#define PT_MODE_SYSTEM\t\t0\n\nstatic inline bool vmx_pt_mode_is_system(void)\n{\n\treturn pt_mode == PT_MODE_SYSTEM;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"vmcs.h\"\n#include \"ops.h\"\n#include \"capabilities.h\"\n#include <asm/intel_pt.h>\n#include <asm/kvm.h>\n#include <linux/kvm_host.h>\n\nstatic inline u32 vmx_vmexit_ctrl(void)\n{\n\tu32 vmexit_ctrl = vmcs_config.vmexit_ctrl;\n\tif (vmx_pt_mode_is_system())\n\t\tvmexit_ctrl &= ~(VM_EXIT_PT_CONCEAL_PIP |\n\t\t\t\t VM_EXIT_CLEAR_IA32_RTIT_CTL);\n\t/* Loading of EFER and PERF_GLOBAL_CTRL are toggled dynamically */\n\treturn vmexit_ctrl &\n\t\t~(VM_EXIT_LOAD_IA32_PERF_GLOBAL_CTRL | VM_EXIT_LOAD_IA32_EFER);\n}"
  },
  {
    "function_name": "vmx_vmentry_ctrl",
    "container": null,
    "file": "output_repos_c_ICV/CVE-2021-3656/repo/arch/x86/kvm/vmx/vmx.h",
    "lines": "449-458",
    "snippet": "static inline u32 vmx_vmentry_ctrl(void)\n{\n\tu32 vmentry_ctrl = vmcs_config.vmentry_ctrl;\n\tif (vmx_pt_mode_is_system())\n\t\tvmentry_ctrl &= ~(VM_ENTRY_PT_CONCEAL_PIP |\n\t\t\t\t  VM_ENTRY_LOAD_IA32_RTIT_CTL);\n\t/* Loading of EFER and PERF_GLOBAL_CTRL are toggled dynamically */\n\treturn vmentry_ctrl &\n\t\t~(VM_ENTRY_LOAD_IA32_PERF_GLOBAL_CTRL | VM_ENTRY_LOAD_IA32_EFER);\n}",
    "includes": [
      "#include \"vmcs.h\"",
      "#include \"ops.h\"",
      "#include \"capabilities.h\"",
      "#include <asm/intel_pt.h>",
      "#include <asm/kvm.h>",
      "#include <linux/kvm_host.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "vmx_pt_mode_is_system",
          "args": [],
          "line": 452
        },
        "resolved": true,
        "details": {
          "function_name": "vmx_pt_mode_is_system",
          "container": null,
          "file": "output_repos_c_ICV/CVE-2021-3656/repo/arch/x86/kvm/vmx/capabilities.h",
          "lines": "361-364",
          "snippet": "static inline bool vmx_pt_mode_is_system(void)\n{\n\treturn pt_mode == PT_MODE_SYSTEM;\n}",
          "includes": [
            "#include \"lapic.h\"",
            "#include <asm/vmx.h>"
          ],
          "macros_used": [
            "#define PT_MODE_SYSTEM\t\t0"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"lapic.h\"\n#include <asm/vmx.h>\n\n#define PT_MODE_SYSTEM\t\t0\n\nstatic inline bool vmx_pt_mode_is_system(void)\n{\n\treturn pt_mode == PT_MODE_SYSTEM;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"vmcs.h\"\n#include \"ops.h\"\n#include \"capabilities.h\"\n#include <asm/intel_pt.h>\n#include <asm/kvm.h>\n#include <linux/kvm_host.h>\n\nstatic inline u32 vmx_vmentry_ctrl(void)\n{\n\tu32 vmentry_ctrl = vmcs_config.vmentry_ctrl;\n\tif (vmx_pt_mode_is_system())\n\t\tvmentry_ctrl &= ~(VM_ENTRY_PT_CONCEAL_PIP |\n\t\t\t\t  VM_ENTRY_LOAD_IA32_RTIT_CTL);\n\t/* Loading of EFER and PERF_GLOBAL_CTRL are toggled dynamically */\n\treturn vmentry_ctrl &\n\t\t~(VM_ENTRY_LOAD_IA32_PERF_GLOBAL_CTRL | VM_ENTRY_LOAD_IA32_EFER);\n}"
  },
  {
    "function_name": "vmx_segment_cache_clear",
    "container": null,
    "file": "output_repos_c_ICV/CVE-2021-3656/repo/arch/x86/kvm/vmx/vmx.h",
    "lines": "444-447",
    "snippet": "static inline void vmx_segment_cache_clear(struct vcpu_vmx *vmx)\n{\n\tvmx->segment_cache.bitmask = 0;\n}",
    "includes": [
      "#include \"vmcs.h\"",
      "#include \"ops.h\"",
      "#include \"capabilities.h\"",
      "#include <asm/intel_pt.h>",
      "#include <asm/kvm.h>",
      "#include <linux/kvm_host.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"vmcs.h\"\n#include \"ops.h\"\n#include \"capabilities.h\"\n#include <asm/intel_pt.h>\n#include <asm/kvm.h>\n#include <linux/kvm_host.h>\n\nstatic inline void vmx_segment_cache_clear(struct vcpu_vmx *vmx)\n{\n\tvmx->segment_cache.bitmask = 0;\n}"
  },
  {
    "function_name": "vmx_get_rvi",
    "container": null,
    "file": "output_repos_c_ICV/CVE-2021-3656/repo/arch/x86/kvm/vmx/vmx.h",
    "lines": "413-416",
    "snippet": "static inline u8 vmx_get_rvi(void)\n{\n\treturn vmcs_read16(GUEST_INTR_STATUS) & 0xff;\n}",
    "includes": [
      "#include \"vmcs.h\"",
      "#include \"ops.h\"",
      "#include \"capabilities.h\"",
      "#include <asm/intel_pt.h>",
      "#include <asm/kvm.h>",
      "#include <linux/kvm_host.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "vmcs_read16",
          "args": [
            "GUEST_INTR_STATUS"
          ],
          "line": 415
        },
        "resolved": true,
        "details": {
          "function_name": "vmcs_read16",
          "container": null,
          "file": "output_repos_c_ICV/CVE-2021-3656/repo/arch/x86/kvm/vmx/ops.h",
          "lines": "104-110",
          "snippet": "static __always_inline u16 vmcs_read16(unsigned long field)\n{\n\tvmcs_check16(field);\n\tif (static_branch_unlikely(&enable_evmcs))\n\t\treturn evmcs_read16(field);\n\treturn __vmcs_readl(field);\n}",
          "includes": [
            "#include \"vmcs.h\"",
            "#include \"evmcs.h\"",
            "#include <asm/vmx.h>",
            "#include <asm/kvm_host.h>",
            "#include <linux/nospec.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"vmcs.h\"\n#include \"evmcs.h\"\n#include <asm/vmx.h>\n#include <asm/kvm_host.h>\n#include <linux/nospec.h>\n\nstatic __always_inline u16 vmcs_read16(unsigned long field)\n{\n\tvmcs_check16(field);\n\tif (static_branch_unlikely(&enable_evmcs))\n\t\treturn evmcs_read16(field);\n\treturn __vmcs_readl(field);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"vmcs.h\"\n#include \"ops.h\"\n#include \"capabilities.h\"\n#include <asm/intel_pt.h>\n#include <asm/kvm.h>\n#include <linux/kvm_host.h>\n\nstatic inline u8 vmx_get_rvi(void)\n{\n\treturn vmcs_read16(GUEST_INTR_STATUS) & 0xff;\n}"
  },
  {
    "function_name": "pi_test_sn",
    "container": null,
    "file": "output_repos_c_ICV/CVE-2021-3656/repo/arch/x86/kvm/vmx/vmx.h",
    "lines": "407-411",
    "snippet": "static inline int pi_test_sn(struct pi_desc *pi_desc)\n{\n\treturn test_bit(POSTED_INTR_SN,\n\t\t\t(unsigned long *)&pi_desc->control);\n}",
    "includes": [
      "#include \"vmcs.h\"",
      "#include \"ops.h\"",
      "#include \"capabilities.h\"",
      "#include <asm/intel_pt.h>",
      "#include <asm/kvm.h>",
      "#include <linux/kvm_host.h>"
    ],
    "macros_used": [
      "#define POSTED_INTR_SN  1"
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "test_bit",
          "args": [
            "POSTED_INTR_SN",
            "(unsigned long *)&pi_desc->control"
          ],
          "line": 409
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"vmcs.h\"\n#include \"ops.h\"\n#include \"capabilities.h\"\n#include <asm/intel_pt.h>\n#include <asm/kvm.h>\n#include <linux/kvm_host.h>\n\n#define POSTED_INTR_SN  1\n\nstatic inline int pi_test_sn(struct pi_desc *pi_desc)\n{\n\treturn test_bit(POSTED_INTR_SN,\n\t\t\t(unsigned long *)&pi_desc->control);\n}"
  },
  {
    "function_name": "pi_test_on",
    "container": null,
    "file": "output_repos_c_ICV/CVE-2021-3656/repo/arch/x86/kvm/vmx/vmx.h",
    "lines": "401-405",
    "snippet": "static inline int pi_test_on(struct pi_desc *pi_desc)\n{\n\treturn test_bit(POSTED_INTR_ON,\n\t\t\t(unsigned long *)&pi_desc->control);\n}",
    "includes": [
      "#include \"vmcs.h\"",
      "#include \"ops.h\"",
      "#include \"capabilities.h\"",
      "#include <asm/intel_pt.h>",
      "#include <asm/kvm.h>",
      "#include <linux/kvm_host.h>"
    ],
    "macros_used": [
      "#define POSTED_INTR_ON  0"
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "test_bit",
          "args": [
            "POSTED_INTR_ON",
            "(unsigned long *)&pi_desc->control"
          ],
          "line": 403
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"vmcs.h\"\n#include \"ops.h\"\n#include \"capabilities.h\"\n#include <asm/intel_pt.h>\n#include <asm/kvm.h>\n#include <linux/kvm_host.h>\n\n#define POSTED_INTR_ON  0\n\nstatic inline int pi_test_on(struct pi_desc *pi_desc)\n{\n\treturn test_bit(POSTED_INTR_ON,\n\t\t\t(unsigned long *)&pi_desc->control);\n}"
  },
  {
    "function_name": "pi_clear_sn",
    "container": null,
    "file": "output_repos_c_ICV/CVE-2021-3656/repo/arch/x86/kvm/vmx/vmx.h",
    "lines": "395-399",
    "snippet": "static inline void pi_clear_sn(struct pi_desc *pi_desc)\n{\n\tclear_bit(POSTED_INTR_SN,\n\t\t(unsigned long *)&pi_desc->control);\n}",
    "includes": [
      "#include \"vmcs.h\"",
      "#include \"ops.h\"",
      "#include \"capabilities.h\"",
      "#include <asm/intel_pt.h>",
      "#include <asm/kvm.h>",
      "#include <linux/kvm_host.h>"
    ],
    "macros_used": [
      "#define POSTED_INTR_SN  1"
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "clear_bit",
          "args": [
            "POSTED_INTR_SN",
            "(unsigned long *)&pi_desc->control"
          ],
          "line": 397
        },
        "resolved": true,
        "details": {
          "function_name": "vmcs_clear_bits",
          "container": null,
          "file": "output_repos_c_ICV/CVE-2021-3656/repo/arch/x86/kvm/vmx/ops.h",
          "lines": "214-222",
          "snippet": "static __always_inline void vmcs_clear_bits(unsigned long field, u32 mask)\n{\n\tBUILD_BUG_ON_MSG(__builtin_constant_p(field) && ((field) & 0x6000) == 0x2000,\n\t\t\t \"vmcs_clear_bits does not support 64-bit fields\");\n\tif (static_branch_unlikely(&enable_evmcs))\n\t\treturn evmcs_write32(field, evmcs_read32(field) & ~mask);\n\n\t__vmcs_writel(field, __vmcs_readl(field) & ~mask);\n}",
          "includes": [
            "#include \"vmcs.h\"",
            "#include \"evmcs.h\"",
            "#include <asm/vmx.h>",
            "#include <asm/kvm_host.h>",
            "#include <linux/nospec.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"vmcs.h\"\n#include \"evmcs.h\"\n#include <asm/vmx.h>\n#include <asm/kvm_host.h>\n#include <linux/nospec.h>\n\nstatic __always_inline void vmcs_clear_bits(unsigned long field, u32 mask)\n{\n\tBUILD_BUG_ON_MSG(__builtin_constant_p(field) && ((field) & 0x6000) == 0x2000,\n\t\t\t \"vmcs_clear_bits does not support 64-bit fields\");\n\tif (static_branch_unlikely(&enable_evmcs))\n\t\treturn evmcs_write32(field, evmcs_read32(field) & ~mask);\n\n\t__vmcs_writel(field, __vmcs_readl(field) & ~mask);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"vmcs.h\"\n#include \"ops.h\"\n#include \"capabilities.h\"\n#include <asm/intel_pt.h>\n#include <asm/kvm.h>\n#include <linux/kvm_host.h>\n\n#define POSTED_INTR_SN  1\n\nstatic inline void pi_clear_sn(struct pi_desc *pi_desc)\n{\n\tclear_bit(POSTED_INTR_SN,\n\t\t(unsigned long *)&pi_desc->control);\n}"
  },
  {
    "function_name": "pi_clear_on",
    "container": null,
    "file": "output_repos_c_ICV/CVE-2021-3656/repo/arch/x86/kvm/vmx/vmx.h",
    "lines": "389-393",
    "snippet": "static inline void pi_clear_on(struct pi_desc *pi_desc)\n{\n\tclear_bit(POSTED_INTR_ON,\n\t\t(unsigned long *)&pi_desc->control);\n}",
    "includes": [
      "#include \"vmcs.h\"",
      "#include \"ops.h\"",
      "#include \"capabilities.h\"",
      "#include <asm/intel_pt.h>",
      "#include <asm/kvm.h>",
      "#include <linux/kvm_host.h>"
    ],
    "macros_used": [
      "#define POSTED_INTR_ON  0"
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "clear_bit",
          "args": [
            "POSTED_INTR_ON",
            "(unsigned long *)&pi_desc->control"
          ],
          "line": 391
        },
        "resolved": true,
        "details": {
          "function_name": "vmcs_clear_bits",
          "container": null,
          "file": "output_repos_c_ICV/CVE-2021-3656/repo/arch/x86/kvm/vmx/ops.h",
          "lines": "214-222",
          "snippet": "static __always_inline void vmcs_clear_bits(unsigned long field, u32 mask)\n{\n\tBUILD_BUG_ON_MSG(__builtin_constant_p(field) && ((field) & 0x6000) == 0x2000,\n\t\t\t \"vmcs_clear_bits does not support 64-bit fields\");\n\tif (static_branch_unlikely(&enable_evmcs))\n\t\treturn evmcs_write32(field, evmcs_read32(field) & ~mask);\n\n\t__vmcs_writel(field, __vmcs_readl(field) & ~mask);\n}",
          "includes": [
            "#include \"vmcs.h\"",
            "#include \"evmcs.h\"",
            "#include <asm/vmx.h>",
            "#include <asm/kvm_host.h>",
            "#include <linux/nospec.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"vmcs.h\"\n#include \"evmcs.h\"\n#include <asm/vmx.h>\n#include <asm/kvm_host.h>\n#include <linux/nospec.h>\n\nstatic __always_inline void vmcs_clear_bits(unsigned long field, u32 mask)\n{\n\tBUILD_BUG_ON_MSG(__builtin_constant_p(field) && ((field) & 0x6000) == 0x2000,\n\t\t\t \"vmcs_clear_bits does not support 64-bit fields\");\n\tif (static_branch_unlikely(&enable_evmcs))\n\t\treturn evmcs_write32(field, evmcs_read32(field) & ~mask);\n\n\t__vmcs_writel(field, __vmcs_readl(field) & ~mask);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"vmcs.h\"\n#include \"ops.h\"\n#include \"capabilities.h\"\n#include <asm/intel_pt.h>\n#include <asm/kvm.h>\n#include <linux/kvm_host.h>\n\n#define POSTED_INTR_ON  0\n\nstatic inline void pi_clear_on(struct pi_desc *pi_desc)\n{\n\tclear_bit(POSTED_INTR_ON,\n\t\t(unsigned long *)&pi_desc->control);\n}"
  },
  {
    "function_name": "pi_set_on",
    "container": null,
    "file": "output_repos_c_ICV/CVE-2021-3656/repo/arch/x86/kvm/vmx/vmx.h",
    "lines": "383-387",
    "snippet": "static inline void pi_set_on(struct pi_desc *pi_desc)\n{\n\tset_bit(POSTED_INTR_ON,\n\t\t(unsigned long *)&pi_desc->control);\n}",
    "includes": [
      "#include \"vmcs.h\"",
      "#include \"ops.h\"",
      "#include \"capabilities.h\"",
      "#include <asm/intel_pt.h>",
      "#include <asm/kvm.h>",
      "#include <linux/kvm_host.h>"
    ],
    "macros_used": [
      "#define POSTED_INTR_ON  0"
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "set_bit",
          "args": [
            "POSTED_INTR_ON",
            "(unsigned long *)&pi_desc->control"
          ],
          "line": 385
        },
        "resolved": true,
        "details": {
          "function_name": "vmcs_set_bits",
          "container": null,
          "file": "output_repos_c_ICV/CVE-2021-3656/repo/arch/x86/kvm/vmx/ops.h",
          "lines": "224-232",
          "snippet": "static __always_inline void vmcs_set_bits(unsigned long field, u32 mask)\n{\n\tBUILD_BUG_ON_MSG(__builtin_constant_p(field) && ((field) & 0x6000) == 0x2000,\n\t\t\t \"vmcs_set_bits does not support 64-bit fields\");\n\tif (static_branch_unlikely(&enable_evmcs))\n\t\treturn evmcs_write32(field, evmcs_read32(field) | mask);\n\n\t__vmcs_writel(field, __vmcs_readl(field) | mask);\n}",
          "includes": [
            "#include \"vmcs.h\"",
            "#include \"evmcs.h\"",
            "#include <asm/vmx.h>",
            "#include <asm/kvm_host.h>",
            "#include <linux/nospec.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"vmcs.h\"\n#include \"evmcs.h\"\n#include <asm/vmx.h>\n#include <asm/kvm_host.h>\n#include <linux/nospec.h>\n\nstatic __always_inline void vmcs_set_bits(unsigned long field, u32 mask)\n{\n\tBUILD_BUG_ON_MSG(__builtin_constant_p(field) && ((field) & 0x6000) == 0x2000,\n\t\t\t \"vmcs_set_bits does not support 64-bit fields\");\n\tif (static_branch_unlikely(&enable_evmcs))\n\t\treturn evmcs_write32(field, evmcs_read32(field) | mask);\n\n\t__vmcs_writel(field, __vmcs_readl(field) | mask);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"vmcs.h\"\n#include \"ops.h\"\n#include \"capabilities.h\"\n#include <asm/intel_pt.h>\n#include <asm/kvm.h>\n#include <linux/kvm_host.h>\n\n#define POSTED_INTR_ON  0\n\nstatic inline void pi_set_on(struct pi_desc *pi_desc)\n{\n\tset_bit(POSTED_INTR_ON,\n\t\t(unsigned long *)&pi_desc->control);\n}"
  },
  {
    "function_name": "pi_set_sn",
    "container": null,
    "file": "output_repos_c_ICV/CVE-2021-3656/repo/arch/x86/kvm/vmx/vmx.h",
    "lines": "377-381",
    "snippet": "static inline void pi_set_sn(struct pi_desc *pi_desc)\n{\n\tset_bit(POSTED_INTR_SN,\n\t\t(unsigned long *)&pi_desc->control);\n}",
    "includes": [
      "#include \"vmcs.h\"",
      "#include \"ops.h\"",
      "#include \"capabilities.h\"",
      "#include <asm/intel_pt.h>",
      "#include <asm/kvm.h>",
      "#include <linux/kvm_host.h>"
    ],
    "macros_used": [
      "#define POSTED_INTR_SN  1"
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "set_bit",
          "args": [
            "POSTED_INTR_SN",
            "(unsigned long *)&pi_desc->control"
          ],
          "line": 379
        },
        "resolved": true,
        "details": {
          "function_name": "vmcs_set_bits",
          "container": null,
          "file": "output_repos_c_ICV/CVE-2021-3656/repo/arch/x86/kvm/vmx/ops.h",
          "lines": "224-232",
          "snippet": "static __always_inline void vmcs_set_bits(unsigned long field, u32 mask)\n{\n\tBUILD_BUG_ON_MSG(__builtin_constant_p(field) && ((field) & 0x6000) == 0x2000,\n\t\t\t \"vmcs_set_bits does not support 64-bit fields\");\n\tif (static_branch_unlikely(&enable_evmcs))\n\t\treturn evmcs_write32(field, evmcs_read32(field) | mask);\n\n\t__vmcs_writel(field, __vmcs_readl(field) | mask);\n}",
          "includes": [
            "#include \"vmcs.h\"",
            "#include \"evmcs.h\"",
            "#include <asm/vmx.h>",
            "#include <asm/kvm_host.h>",
            "#include <linux/nospec.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"vmcs.h\"\n#include \"evmcs.h\"\n#include <asm/vmx.h>\n#include <asm/kvm_host.h>\n#include <linux/nospec.h>\n\nstatic __always_inline void vmcs_set_bits(unsigned long field, u32 mask)\n{\n\tBUILD_BUG_ON_MSG(__builtin_constant_p(field) && ((field) & 0x6000) == 0x2000,\n\t\t\t \"vmcs_set_bits does not support 64-bit fields\");\n\tif (static_branch_unlikely(&enable_evmcs))\n\t\treturn evmcs_write32(field, evmcs_read32(field) | mask);\n\n\t__vmcs_writel(field, __vmcs_readl(field) | mask);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"vmcs.h\"\n#include \"ops.h\"\n#include \"capabilities.h\"\n#include <asm/intel_pt.h>\n#include <asm/kvm.h>\n#include <linux/kvm_host.h>\n\n#define POSTED_INTR_SN  1\n\nstatic inline void pi_set_sn(struct pi_desc *pi_desc)\n{\n\tset_bit(POSTED_INTR_SN,\n\t\t(unsigned long *)&pi_desc->control);\n}"
  },
  {
    "function_name": "pi_is_pir_empty",
    "container": null,
    "file": "output_repos_c_ICV/CVE-2021-3656/repo/arch/x86/kvm/vmx/vmx.h",
    "lines": "372-375",
    "snippet": "static inline bool pi_is_pir_empty(struct pi_desc *pi_desc)\n{\n\treturn bitmap_empty((unsigned long *)pi_desc->pir, NR_VECTORS);\n}",
    "includes": [
      "#include \"vmcs.h\"",
      "#include \"ops.h\"",
      "#include \"capabilities.h\"",
      "#include <asm/intel_pt.h>",
      "#include <asm/kvm.h>",
      "#include <linux/kvm_host.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "bitmap_empty",
          "args": [
            "(unsigned long *)pi_desc->pir",
            "NR_VECTORS"
          ],
          "line": 374
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"vmcs.h\"\n#include \"ops.h\"\n#include \"capabilities.h\"\n#include <asm/intel_pt.h>\n#include <asm/kvm.h>\n#include <linux/kvm_host.h>\n\nstatic inline bool pi_is_pir_empty(struct pi_desc *pi_desc)\n{\n\treturn bitmap_empty((unsigned long *)pi_desc->pir, NR_VECTORS);\n}"
  },
  {
    "function_name": "pi_test_and_set_pir",
    "container": null,
    "file": "output_repos_c_ICV/CVE-2021-3656/repo/arch/x86/kvm/vmx/vmx.h",
    "lines": "367-370",
    "snippet": "static inline int pi_test_and_set_pir(int vector, struct pi_desc *pi_desc)\n{\n\treturn test_and_set_bit(vector, (unsigned long *)pi_desc->pir);\n}",
    "includes": [
      "#include \"vmcs.h\"",
      "#include \"ops.h\"",
      "#include \"capabilities.h\"",
      "#include <asm/intel_pt.h>",
      "#include <asm/kvm.h>",
      "#include <linux/kvm_host.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "test_and_set_bit",
          "args": [
            "vector",
            "(unsigned long *)pi_desc->pir"
          ],
          "line": 369
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"vmcs.h\"\n#include \"ops.h\"\n#include \"capabilities.h\"\n#include <asm/intel_pt.h>\n#include <asm/kvm.h>\n#include <linux/kvm_host.h>\n\nstatic inline int pi_test_and_set_pir(int vector, struct pi_desc *pi_desc)\n{\n\treturn test_and_set_bit(vector, (unsigned long *)pi_desc->pir);\n}"
  },
  {
    "function_name": "pi_test_and_clear_on",
    "container": null,
    "file": "output_repos_c_ICV/CVE-2021-3656/repo/arch/x86/kvm/vmx/vmx.h",
    "lines": "361-365",
    "snippet": "static inline bool pi_test_and_clear_on(struct pi_desc *pi_desc)\n{\n\treturn test_and_clear_bit(POSTED_INTR_ON,\n\t\t\t(unsigned long *)&pi_desc->control);\n}",
    "includes": [
      "#include \"vmcs.h\"",
      "#include \"ops.h\"",
      "#include \"capabilities.h\"",
      "#include <asm/intel_pt.h>",
      "#include <asm/kvm.h>",
      "#include <linux/kvm_host.h>"
    ],
    "macros_used": [
      "#define POSTED_INTR_ON  0"
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "test_and_clear_bit",
          "args": [
            "POSTED_INTR_ON",
            "(unsigned long *)&pi_desc->control"
          ],
          "line": 363
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"vmcs.h\"\n#include \"ops.h\"\n#include \"capabilities.h\"\n#include <asm/intel_pt.h>\n#include <asm/kvm.h>\n#include <linux/kvm_host.h>\n\n#define POSTED_INTR_ON  0\n\nstatic inline bool pi_test_and_clear_on(struct pi_desc *pi_desc)\n{\n\treturn test_and_clear_bit(POSTED_INTR_ON,\n\t\t\t(unsigned long *)&pi_desc->control);\n}"
  },
  {
    "function_name": "pi_test_and_set_on",
    "container": null,
    "file": "output_repos_c_ICV/CVE-2021-3656/repo/arch/x86/kvm/vmx/vmx.h",
    "lines": "355-359",
    "snippet": "static inline bool pi_test_and_set_on(struct pi_desc *pi_desc)\n{\n\treturn test_and_set_bit(POSTED_INTR_ON,\n\t\t\t(unsigned long *)&pi_desc->control);\n}",
    "includes": [
      "#include \"vmcs.h\"",
      "#include \"ops.h\"",
      "#include \"capabilities.h\"",
      "#include <asm/intel_pt.h>",
      "#include <asm/kvm.h>",
      "#include <linux/kvm_host.h>"
    ],
    "macros_used": [
      "#define POSTED_INTR_ON  0"
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "test_and_set_bit",
          "args": [
            "POSTED_INTR_ON",
            "(unsigned long *)&pi_desc->control"
          ],
          "line": 357
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"vmcs.h\"\n#include \"ops.h\"\n#include \"capabilities.h\"\n#include <asm/intel_pt.h>\n#include <asm/kvm.h>\n#include <linux/kvm_host.h>\n\n#define POSTED_INTR_ON  0\n\nstatic inline bool pi_test_and_set_on(struct pi_desc *pi_desc)\n{\n\treturn test_and_set_bit(POSTED_INTR_ON,\n\t\t\t(unsigned long *)&pi_desc->control);\n}"
  }
]