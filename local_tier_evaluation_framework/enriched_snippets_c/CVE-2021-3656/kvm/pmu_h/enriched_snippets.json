[
  {
    "function_name": "get_sample_period",
    "container": null,
    "file": "output_repos_c_ICV/CVE-2021-3656/repo/arch/x86/kvm/pmu.h",
    "lines": "132-139",
    "snippet": "static inline u64 get_sample_period(struct kvm_pmc *pmc, u64 counter_value)\n{\n\tu64 sample_period = (-counter_value) & pmc_bitmask(pmc);\n\n\tif (!sample_period)\n\t\tsample_period = pmc_bitmask(pmc) + 1;\n\treturn sample_period;\n}",
    "includes": [
      "#include <linux/nospec.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "pmc_bitmask",
          "args": [
            "pmc"
          ],
          "line": 137
        },
        "resolved": true,
        "details": {
          "function_name": "pmc_bitmask",
          "container": null,
          "file": "output_repos_c_ICV/CVE-2021-3656/repo/arch/x86/kvm/pmu.h",
          "lines": "42-47",
          "snippet": "static inline u64 pmc_bitmask(struct kvm_pmc *pmc)\n{\n\tstruct kvm_pmu *pmu = pmc_to_pmu(pmc);\n\n\treturn pmu->counter_bitmask[pmc->type];\n}",
          "includes": [
            "#include <linux/nospec.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/nospec.h>\n\nstatic inline u64 pmc_bitmask(struct kvm_pmc *pmc)\n{\n\tstruct kvm_pmu *pmu = pmc_to_pmu(pmc);\n\n\treturn pmu->counter_bitmask[pmc->type];\n}"
        }
      }
    ],
    "contextual_snippet": "#include <linux/nospec.h>\n\nstatic inline u64 get_sample_period(struct kvm_pmc *pmc, u64 counter_value)\n{\n\tu64 sample_period = (-counter_value) & pmc_bitmask(pmc);\n\n\tif (!sample_period)\n\t\tsample_period = pmc_bitmask(pmc) + 1;\n\treturn sample_period;\n}"
  },
  {
    "function_name": "get_fixed_pmc",
    "container": null,
    "file": "output_repos_c_ICV/CVE-2021-3656/repo/arch/x86/kvm/pmu.h",
    "lines": "118-130",
    "snippet": "static inline struct kvm_pmc *get_fixed_pmc(struct kvm_pmu *pmu, u32 msr)\n{\n\tint base = MSR_CORE_PERF_FIXED_CTR0;\n\n\tif (msr >= base && msr < base + pmu->nr_arch_fixed_counters) {\n\t\tu32 index = array_index_nospec(msr - base,\n\t\t\t\t\t       pmu->nr_arch_fixed_counters);\n\n\t\treturn &pmu->fixed_counters[index];\n\t}\n\n\treturn NULL;\n}",
    "includes": [
      "#include <linux/nospec.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "array_index_nospec",
          "args": [
            "msr - base",
            "pmu->nr_arch_fixed_counters"
          ],
          "line": 123
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <linux/nospec.h>\n\nstatic inline struct kvm_pmc *get_fixed_pmc(struct kvm_pmu *pmu, u32 msr)\n{\n\tint base = MSR_CORE_PERF_FIXED_CTR0;\n\n\tif (msr >= base && msr < base + pmu->nr_arch_fixed_counters) {\n\t\tu32 index = array_index_nospec(msr - base,\n\t\t\t\t\t       pmu->nr_arch_fixed_counters);\n\n\t\treturn &pmu->fixed_counters[index];\n\t}\n\n\treturn NULL;\n}"
  },
  {
    "function_name": "get_gp_pmc",
    "container": null,
    "file": "output_repos_c_ICV/CVE-2021-3656/repo/arch/x86/kvm/pmu.h",
    "lines": "104-115",
    "snippet": "static inline struct kvm_pmc *get_gp_pmc(struct kvm_pmu *pmu, u32 msr,\n\t\t\t\t\t u32 base)\n{\n\tif (msr >= base && msr < base + pmu->nr_arch_gp_counters) {\n\t\tu32 index = array_index_nospec(msr - base,\n\t\t\t\t\t       pmu->nr_arch_gp_counters);\n\n\t\treturn &pmu->gp_counters[index];\n\t}\n\n\treturn NULL;\n}",
    "includes": [
      "#include <linux/nospec.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "array_index_nospec",
          "args": [
            "msr - base",
            "pmu->nr_arch_gp_counters"
          ],
          "line": 108
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <linux/nospec.h>\n\nstatic inline struct kvm_pmc *get_gp_pmc(struct kvm_pmu *pmu, u32 msr,\n\t\t\t\t\t u32 base)\n{\n\tif (msr >= base && msr < base + pmu->nr_arch_gp_counters) {\n\t\tu32 index = array_index_nospec(msr - base,\n\t\t\t\t\t       pmu->nr_arch_gp_counters);\n\n\t\treturn &pmu->gp_counters[index];\n\t}\n\n\treturn NULL;\n}"
  },
  {
    "function_name": "kvm_valid_perf_global_ctrl",
    "container": null,
    "file": "output_repos_c_ICV/CVE-2021-3656/repo/arch/x86/kvm/pmu.h",
    "lines": "94-98",
    "snippet": "static inline bool kvm_valid_perf_global_ctrl(struct kvm_pmu *pmu,\n\t\t\t\t\t\t u64 data)\n{\n\treturn !(pmu->global_ctrl_mask & data);\n}",
    "includes": [
      "#include <linux/nospec.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include <linux/nospec.h>\n\nstatic inline bool kvm_valid_perf_global_ctrl(struct kvm_pmu *pmu,\n\t\t\t\t\t\t u64 data)\n{\n\treturn !(pmu->global_ctrl_mask & data);\n}"
  },
  {
    "function_name": "pmc_is_enabled",
    "container": null,
    "file": "output_repos_c_ICV/CVE-2021-3656/repo/arch/x86/kvm/pmu.h",
    "lines": "89-92",
    "snippet": "static inline bool pmc_is_enabled(struct kvm_pmc *pmc)\n{\n\treturn kvm_x86_ops.pmu_ops->pmc_is_enabled(pmc);\n}",
    "includes": [
      "#include <linux/nospec.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "kvm_x86_ops.pmu_ops->pmc_is_enabled",
          "args": [
            "pmc"
          ],
          "line": 91
        },
        "resolved": true,
        "details": {
          "function_name": "pmc_is_enabled",
          "container": null,
          "file": "output_repos_c_ICV/CVE-2021-3656/repo/arch/x86/kvm/pmu.h",
          "lines": "89-92",
          "snippet": "static inline bool pmc_is_enabled(struct kvm_pmc *pmc)\n{\n\treturn kvm_x86_ops.pmu_ops->pmc_is_enabled(pmc);\n}",
          "note": "cyclic_reference_detected"
        }
      }
    ],
    "contextual_snippet": "#include <linux/nospec.h>\n\nstatic inline bool pmc_is_enabled(struct kvm_pmc *pmc)\n{\n\treturn kvm_x86_ops.pmu_ops->pmc_is_enabled(pmc);\n}"
  },
  {
    "function_name": "pmc_is_fixed",
    "container": null,
    "file": "output_repos_c_ICV/CVE-2021-3656/repo/arch/x86/kvm/pmu.h",
    "lines": "84-87",
    "snippet": "static inline bool pmc_is_fixed(struct kvm_pmc *pmc)\n{\n\treturn pmc->type == KVM_PMC_FIXED;\n}",
    "includes": [
      "#include <linux/nospec.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include <linux/nospec.h>\n\nstatic inline bool pmc_is_fixed(struct kvm_pmc *pmc)\n{\n\treturn pmc->type == KVM_PMC_FIXED;\n}"
  },
  {
    "function_name": "pmc_is_gp",
    "container": null,
    "file": "output_repos_c_ICV/CVE-2021-3656/repo/arch/x86/kvm/pmu.h",
    "lines": "79-82",
    "snippet": "static inline bool pmc_is_gp(struct kvm_pmc *pmc)\n{\n\treturn pmc->type == KVM_PMC_GP;\n}",
    "includes": [
      "#include <linux/nospec.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include <linux/nospec.h>\n\nstatic inline bool pmc_is_gp(struct kvm_pmc *pmc)\n{\n\treturn pmc->type == KVM_PMC_GP;\n}"
  },
  {
    "function_name": "pmc_stop_counter",
    "container": null,
    "file": "output_repos_c_ICV/CVE-2021-3656/repo/arch/x86/kvm/pmu.h",
    "lines": "71-77",
    "snippet": "static inline void pmc_stop_counter(struct kvm_pmc *pmc)\n{\n\tif (pmc->perf_event) {\n\t\tpmc->counter = pmc_read_counter(pmc);\n\t\tpmc_release_perf_event(pmc);\n\t}\n}",
    "includes": [
      "#include <linux/nospec.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "pmc_release_perf_event",
          "args": [
            "pmc"
          ],
          "line": 75
        },
        "resolved": true,
        "details": {
          "function_name": "pmc_release_perf_event",
          "container": null,
          "file": "output_repos_c_ICV/CVE-2021-3656/repo/arch/x86/kvm/pmu.h",
          "lines": "61-69",
          "snippet": "static inline void pmc_release_perf_event(struct kvm_pmc *pmc)\n{\n\tif (pmc->perf_event) {\n\t\tperf_event_release_kernel(pmc->perf_event);\n\t\tpmc->perf_event = NULL;\n\t\tpmc->current_config = 0;\n\t\tpmc_to_pmu(pmc)->event_count--;\n\t}\n}",
          "includes": [
            "#include <linux/nospec.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/nospec.h>\n\nstatic inline void pmc_release_perf_event(struct kvm_pmc *pmc)\n{\n\tif (pmc->perf_event) {\n\t\tperf_event_release_kernel(pmc->perf_event);\n\t\tpmc->perf_event = NULL;\n\t\tpmc->current_config = 0;\n\t\tpmc_to_pmu(pmc)->event_count--;\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "pmc_read_counter",
          "args": [
            "pmc"
          ],
          "line": 74
        },
        "resolved": true,
        "details": {
          "function_name": "pmc_read_counter",
          "container": null,
          "file": "output_repos_c_ICV/CVE-2021-3656/repo/arch/x86/kvm/pmu.h",
          "lines": "49-59",
          "snippet": "static inline u64 pmc_read_counter(struct kvm_pmc *pmc)\n{\n\tu64 counter, enabled, running;\n\n\tcounter = pmc->counter;\n\tif (pmc->perf_event)\n\t\tcounter += perf_event_read_value(pmc->perf_event,\n\t\t\t\t\t\t &enabled, &running);\n\t/* FIXME: Scaling needed? */\n\treturn counter & pmc_bitmask(pmc);\n}",
          "includes": [
            "#include <linux/nospec.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/nospec.h>\n\nstatic inline u64 pmc_read_counter(struct kvm_pmc *pmc)\n{\n\tu64 counter, enabled, running;\n\n\tcounter = pmc->counter;\n\tif (pmc->perf_event)\n\t\tcounter += perf_event_read_value(pmc->perf_event,\n\t\t\t\t\t\t &enabled, &running);\n\t/* FIXME: Scaling needed? */\n\treturn counter & pmc_bitmask(pmc);\n}"
        }
      }
    ],
    "contextual_snippet": "#include <linux/nospec.h>\n\nstatic inline void pmc_stop_counter(struct kvm_pmc *pmc)\n{\n\tif (pmc->perf_event) {\n\t\tpmc->counter = pmc_read_counter(pmc);\n\t\tpmc_release_perf_event(pmc);\n\t}\n}"
  },
  {
    "function_name": "pmc_release_perf_event",
    "container": null,
    "file": "output_repos_c_ICV/CVE-2021-3656/repo/arch/x86/kvm/pmu.h",
    "lines": "61-69",
    "snippet": "static inline void pmc_release_perf_event(struct kvm_pmc *pmc)\n{\n\tif (pmc->perf_event) {\n\t\tperf_event_release_kernel(pmc->perf_event);\n\t\tpmc->perf_event = NULL;\n\t\tpmc->current_config = 0;\n\t\tpmc_to_pmu(pmc)->event_count--;\n\t}\n}",
    "includes": [
      "#include <linux/nospec.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "pmc_to_pmu",
          "args": [
            "pmc"
          ],
          "line": 67
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "perf_event_release_kernel",
          "args": [
            "pmc->perf_event"
          ],
          "line": 64
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <linux/nospec.h>\n\nstatic inline void pmc_release_perf_event(struct kvm_pmc *pmc)\n{\n\tif (pmc->perf_event) {\n\t\tperf_event_release_kernel(pmc->perf_event);\n\t\tpmc->perf_event = NULL;\n\t\tpmc->current_config = 0;\n\t\tpmc_to_pmu(pmc)->event_count--;\n\t}\n}"
  },
  {
    "function_name": "pmc_read_counter",
    "container": null,
    "file": "output_repos_c_ICV/CVE-2021-3656/repo/arch/x86/kvm/pmu.h",
    "lines": "49-59",
    "snippet": "static inline u64 pmc_read_counter(struct kvm_pmc *pmc)\n{\n\tu64 counter, enabled, running;\n\n\tcounter = pmc->counter;\n\tif (pmc->perf_event)\n\t\tcounter += perf_event_read_value(pmc->perf_event,\n\t\t\t\t\t\t &enabled, &running);\n\t/* FIXME: Scaling needed? */\n\treturn counter & pmc_bitmask(pmc);\n}",
    "includes": [
      "#include <linux/nospec.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "pmc_bitmask",
          "args": [
            "pmc"
          ],
          "line": 58
        },
        "resolved": true,
        "details": {
          "function_name": "pmc_bitmask",
          "container": null,
          "file": "output_repos_c_ICV/CVE-2021-3656/repo/arch/x86/kvm/pmu.h",
          "lines": "42-47",
          "snippet": "static inline u64 pmc_bitmask(struct kvm_pmc *pmc)\n{\n\tstruct kvm_pmu *pmu = pmc_to_pmu(pmc);\n\n\treturn pmu->counter_bitmask[pmc->type];\n}",
          "includes": [
            "#include <linux/nospec.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/nospec.h>\n\nstatic inline u64 pmc_bitmask(struct kvm_pmc *pmc)\n{\n\tstruct kvm_pmu *pmu = pmc_to_pmu(pmc);\n\n\treturn pmu->counter_bitmask[pmc->type];\n}"
        }
      },
      {
        "call_info": {
          "callee": "perf_event_read_value",
          "args": [
            "pmc->perf_event",
            "&enabled",
            "&running"
          ],
          "line": 55
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <linux/nospec.h>\n\nstatic inline u64 pmc_read_counter(struct kvm_pmc *pmc)\n{\n\tu64 counter, enabled, running;\n\n\tcounter = pmc->counter;\n\tif (pmc->perf_event)\n\t\tcounter += perf_event_read_value(pmc->perf_event,\n\t\t\t\t\t\t &enabled, &running);\n\t/* FIXME: Scaling needed? */\n\treturn counter & pmc_bitmask(pmc);\n}"
  },
  {
    "function_name": "pmc_bitmask",
    "container": null,
    "file": "output_repos_c_ICV/CVE-2021-3656/repo/arch/x86/kvm/pmu.h",
    "lines": "42-47",
    "snippet": "static inline u64 pmc_bitmask(struct kvm_pmc *pmc)\n{\n\tstruct kvm_pmu *pmu = pmc_to_pmu(pmc);\n\n\treturn pmu->counter_bitmask[pmc->type];\n}",
    "includes": [
      "#include <linux/nospec.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "pmc_to_pmu",
          "args": [
            "pmc"
          ],
          "line": 44
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <linux/nospec.h>\n\nstatic inline u64 pmc_bitmask(struct kvm_pmc *pmc)\n{\n\tstruct kvm_pmu *pmu = pmc_to_pmu(pmc);\n\n\treturn pmu->counter_bitmask[pmc->type];\n}"
  }
]