[
  {
    "function_name": "arch_get_ima_policy",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-27777/repo/arch/powerpc/kernel/ima_arch.c",
    "lines": "63-78",
    "snippet": "const char *const *arch_get_ima_policy(void)\n{\n\tif (is_ppc_secureboot_enabled()) {\n\t\tif (IS_ENABLED(CONFIG_MODULE_SIG))\n\t\t\tset_module_sig_enforced();\n\n\t\tif (is_ppc_trustedboot_enabled())\n\t\t\treturn secure_and_trusted_rules;\n\t\telse\n\t\t\treturn secure_rules;\n\t} else if (is_ppc_trustedboot_enabled()) {\n\t\treturn trusted_rules;\n\t}\n\n\treturn NULL;\n}",
    "includes": [
      "#include <asm/secure_boot.h>",
      "#include <linux/ima.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static const char *const secure_rules[] = {\n\t\"appraise func=KEXEC_KERNEL_CHECK appraise_flag=check_blacklist appraise_type=imasig|modsig\",\n#ifndef CONFIG_MODULE_SIG\n\t\"appraise func=MODULE_CHECK appraise_flag=check_blacklist appraise_type=imasig|modsig\",\n#endif\n\tNULL\n};",
      "static const char *const trusted_rules[] = {\n\t\"measure func=KEXEC_KERNEL_CHECK\",\n\t\"measure func=MODULE_CHECK\",\n\tNULL\n};",
      "static const char *const secure_and_trusted_rules[] = {\n\t\"measure func=KEXEC_KERNEL_CHECK template=ima-modsig\",\n\t\"measure func=MODULE_CHECK template=ima-modsig\",\n\t\"appraise func=KEXEC_KERNEL_CHECK appraise_flag=check_blacklist appraise_type=imasig|modsig\",\n#ifndef CONFIG_MODULE_SIG\n\t\"appraise func=MODULE_CHECK appraise_flag=check_blacklist appraise_type=imasig|modsig\",\n#endif\n\tNULL\n};"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "is_ppc_trustedboot_enabled",
          "args": [],
          "line": 73
        },
        "resolved": true,
        "details": {
          "function_name": "is_ppc_trustedboot_enabled",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-27777/repo/arch/powerpc/kernel/secure_boot.c",
          "lines": "44-64",
          "snippet": "bool is_ppc_trustedboot_enabled(void)\n{\n\tstruct device_node *node;\n\tbool enabled = false;\n\tu32 trustedboot;\n\n\tnode = get_ppc_fw_sb_node();\n\tenabled = of_property_read_bool(node, \"trusted-enabled\");\n\tof_node_put(node);\n\n\tif (enabled)\n\t\tgoto out;\n\n\tif (!of_property_read_u32(of_root, \"ibm,trusted-boot\", &trustedboot))\n\t\tenabled = (trustedboot > 0);\n\nout:\n\tpr_info(\"Trusted boot mode %s\\n\", enabled ? \"enabled\" : \"disabled\");\n\n\treturn enabled;\n}",
          "includes": [
            "#include <asm/secure_boot.h>",
            "#include <linux/of.h>",
            "#include <linux/types.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <asm/secure_boot.h>\n#include <linux/of.h>\n#include <linux/types.h>\n\nbool is_ppc_trustedboot_enabled(void)\n{\n\tstruct device_node *node;\n\tbool enabled = false;\n\tu32 trustedboot;\n\n\tnode = get_ppc_fw_sb_node();\n\tenabled = of_property_read_bool(node, \"trusted-enabled\");\n\tof_node_put(node);\n\n\tif (enabled)\n\t\tgoto out;\n\n\tif (!of_property_read_u32(of_root, \"ibm,trusted-boot\", &trustedboot))\n\t\tenabled = (trustedboot > 0);\n\nout:\n\tpr_info(\"Trusted boot mode %s\\n\", enabled ? \"enabled\" : \"disabled\");\n\n\treturn enabled;\n}"
        }
      },
      {
        "call_info": {
          "callee": "set_module_sig_enforced",
          "args": [],
          "line": 67
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "IS_ENABLED",
          "args": [
            "CONFIG_MODULE_SIG"
          ],
          "line": 66
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "is_ppc_secureboot_enabled",
          "args": [],
          "line": 65
        },
        "resolved": true,
        "details": {
          "function_name": "is_ppc_secureboot_enabled",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-27777/repo/arch/powerpc/kernel/secure_boot.c",
          "lines": "22-42",
          "snippet": "bool is_ppc_secureboot_enabled(void)\n{\n\tstruct device_node *node;\n\tbool enabled = false;\n\tu32 secureboot;\n\n\tnode = get_ppc_fw_sb_node();\n\tenabled = of_property_read_bool(node, \"os-secureboot-enforcing\");\n\tof_node_put(node);\n\n\tif (enabled)\n\t\tgoto out;\n\n\tif (!of_property_read_u32(of_root, \"ibm,secure-boot\", &secureboot))\n\t\tenabled = (secureboot > 1);\n\nout:\n\tpr_info(\"Secure boot mode %s\\n\", enabled ? \"enabled\" : \"disabled\");\n\n\treturn enabled;\n}",
          "includes": [
            "#include <asm/secure_boot.h>",
            "#include <linux/of.h>",
            "#include <linux/types.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <asm/secure_boot.h>\n#include <linux/of.h>\n#include <linux/types.h>\n\nbool is_ppc_secureboot_enabled(void)\n{\n\tstruct device_node *node;\n\tbool enabled = false;\n\tu32 secureboot;\n\n\tnode = get_ppc_fw_sb_node();\n\tenabled = of_property_read_bool(node, \"os-secureboot-enforcing\");\n\tof_node_put(node);\n\n\tif (enabled)\n\t\tgoto out;\n\n\tif (!of_property_read_u32(of_root, \"ibm,secure-boot\", &secureboot))\n\t\tenabled = (secureboot > 1);\n\nout:\n\tpr_info(\"Secure boot mode %s\\n\", enabled ? \"enabled\" : \"disabled\");\n\n\treturn enabled;\n}"
        }
      }
    ],
    "contextual_snippet": "#include <asm/secure_boot.h>\n#include <linux/ima.h>\n\nstatic const char *const secure_rules[] = {\n\t\"appraise func=KEXEC_KERNEL_CHECK appraise_flag=check_blacklist appraise_type=imasig|modsig\",\n#ifndef CONFIG_MODULE_SIG\n\t\"appraise func=MODULE_CHECK appraise_flag=check_blacklist appraise_type=imasig|modsig\",\n#endif\n\tNULL\n};\nstatic const char *const trusted_rules[] = {\n\t\"measure func=KEXEC_KERNEL_CHECK\",\n\t\"measure func=MODULE_CHECK\",\n\tNULL\n};\nstatic const char *const secure_and_trusted_rules[] = {\n\t\"measure func=KEXEC_KERNEL_CHECK template=ima-modsig\",\n\t\"measure func=MODULE_CHECK template=ima-modsig\",\n\t\"appraise func=KEXEC_KERNEL_CHECK appraise_flag=check_blacklist appraise_type=imasig|modsig\",\n#ifndef CONFIG_MODULE_SIG\n\t\"appraise func=MODULE_CHECK appraise_flag=check_blacklist appraise_type=imasig|modsig\",\n#endif\n\tNULL\n};\n\nconst char *const *arch_get_ima_policy(void)\n{\n\tif (is_ppc_secureboot_enabled()) {\n\t\tif (IS_ENABLED(CONFIG_MODULE_SIG))\n\t\t\tset_module_sig_enforced();\n\n\t\tif (is_ppc_trustedboot_enabled())\n\t\t\treturn secure_and_trusted_rules;\n\t\telse\n\t\t\treturn secure_rules;\n\t} else if (is_ppc_trustedboot_enabled()) {\n\t\treturn trusted_rules;\n\t}\n\n\treturn NULL;\n}"
  },
  {
    "function_name": "arch_ima_get_secureboot",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-27777/repo/arch/powerpc/kernel/ima_arch.c",
    "lines": "10-13",
    "snippet": "bool arch_ima_get_secureboot(void)\n{\n\treturn is_ppc_secureboot_enabled();\n}",
    "includes": [
      "#include <asm/secure_boot.h>",
      "#include <linux/ima.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "is_ppc_secureboot_enabled",
          "args": [],
          "line": 12
        },
        "resolved": true,
        "details": {
          "function_name": "is_ppc_secureboot_enabled",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-27777/repo/arch/powerpc/kernel/secure_boot.c",
          "lines": "22-42",
          "snippet": "bool is_ppc_secureboot_enabled(void)\n{\n\tstruct device_node *node;\n\tbool enabled = false;\n\tu32 secureboot;\n\n\tnode = get_ppc_fw_sb_node();\n\tenabled = of_property_read_bool(node, \"os-secureboot-enforcing\");\n\tof_node_put(node);\n\n\tif (enabled)\n\t\tgoto out;\n\n\tif (!of_property_read_u32(of_root, \"ibm,secure-boot\", &secureboot))\n\t\tenabled = (secureboot > 1);\n\nout:\n\tpr_info(\"Secure boot mode %s\\n\", enabled ? \"enabled\" : \"disabled\");\n\n\treturn enabled;\n}",
          "includes": [
            "#include <asm/secure_boot.h>",
            "#include <linux/of.h>",
            "#include <linux/types.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <asm/secure_boot.h>\n#include <linux/of.h>\n#include <linux/types.h>\n\nbool is_ppc_secureboot_enabled(void)\n{\n\tstruct device_node *node;\n\tbool enabled = false;\n\tu32 secureboot;\n\n\tnode = get_ppc_fw_sb_node();\n\tenabled = of_property_read_bool(node, \"os-secureboot-enforcing\");\n\tof_node_put(node);\n\n\tif (enabled)\n\t\tgoto out;\n\n\tif (!of_property_read_u32(of_root, \"ibm,secure-boot\", &secureboot))\n\t\tenabled = (secureboot > 1);\n\nout:\n\tpr_info(\"Secure boot mode %s\\n\", enabled ? \"enabled\" : \"disabled\");\n\n\treturn enabled;\n}"
        }
      }
    ],
    "contextual_snippet": "#include <asm/secure_boot.h>\n#include <linux/ima.h>\n\nbool arch_ima_get_secureboot(void)\n{\n\treturn is_ppc_secureboot_enabled();\n}"
  }
]