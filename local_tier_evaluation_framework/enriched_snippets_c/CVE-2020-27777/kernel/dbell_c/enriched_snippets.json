[
  {
    "function_name": "doorbell_exception",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-27777/repo/arch/powerpc/kernel/dbell.c",
    "lines": "42-45",
    "snippet": "void doorbell_exception(struct pt_regs *regs)\n{\n\tprintk(KERN_WARNING \"Received doorbell on non-smp system\\n\");\n}",
    "includes": [
      "#include <asm/trace.h>",
      "#include <asm/kvm_ppc.h>",
      "#include <asm/irq_regs.h>",
      "#include <asm/dbell.h>",
      "#include <linux/hardirq.h>",
      "#include <linux/threads.h>",
      "#include <linux/smp.h>",
      "#include <linux/kernel.h>",
      "#include <linux/stddef.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "printk",
          "args": [
            "KERN_WARNING \"Received doorbell on non-smp system\\n\""
          ],
          "line": 44
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <asm/trace.h>\n#include <asm/kvm_ppc.h>\n#include <asm/irq_regs.h>\n#include <asm/dbell.h>\n#include <linux/hardirq.h>\n#include <linux/threads.h>\n#include <linux/smp.h>\n#include <linux/kernel.h>\n#include <linux/stddef.h>\n\nvoid doorbell_exception(struct pt_regs *regs)\n{\n\tprintk(KERN_WARNING \"Received doorbell on non-smp system\\n\");\n}"
  },
  {
    "function_name": "doorbell_exception",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-27777/repo/arch/powerpc/kernel/dbell.c",
    "lines": "21-40",
    "snippet": "void doorbell_exception(struct pt_regs *regs)\n{\n\tstruct pt_regs *old_regs = set_irq_regs(regs);\n\n\tirq_enter();\n\ttrace_doorbell_entry(regs);\n\n\tppc_msgsync();\n\n\tmay_hard_irq_enable();\n\n\tkvmppc_clear_host_ipi(smp_processor_id());\n\t__this_cpu_inc(irq_stat.doorbell_irqs);\n\n\tsmp_ipi_demux_relaxed(); /* already performed the barrier */\n\n\ttrace_doorbell_exit(regs);\n\tirq_exit();\n\tset_irq_regs(old_regs);\n}",
    "includes": [
      "#include <asm/trace.h>",
      "#include <asm/kvm_ppc.h>",
      "#include <asm/irq_regs.h>",
      "#include <asm/dbell.h>",
      "#include <linux/hardirq.h>",
      "#include <linux/threads.h>",
      "#include <linux/smp.h>",
      "#include <linux/kernel.h>",
      "#include <linux/stddef.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "set_irq_regs",
          "args": [
            "old_regs"
          ],
          "line": 39
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "irq_exit",
          "args": [],
          "line": 38
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "trace_doorbell_exit",
          "args": [
            "regs"
          ],
          "line": 37
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "smp_ipi_demux_relaxed",
          "args": [],
          "line": 35
        },
        "resolved": true,
        "details": {
          "function_name": "smp_ipi_demux_relaxed",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-27777/repo/arch/powerpc/kernel/smp.c",
          "lines": "295-329",
          "snippet": "irqreturn_t smp_ipi_demux_relaxed(void)\n{\n\tstruct cpu_messages *info;\n\tunsigned long all;\n\n\tinfo = this_cpu_ptr(&ipi_message);\n\tdo {\n\t\tall = xchg(&info->messages, 0);\n#if defined(CONFIG_KVM_XICS) && defined(CONFIG_KVM_BOOK3S_HV_POSSIBLE)\n\t\t/*\n\t\t * Must check for PPC_MSG_RM_HOST_ACTION messages\n\t\t * before PPC_MSG_CALL_FUNCTION messages because when\n\t\t * a VM is destroyed, we call kick_all_cpus_sync()\n\t\t * to ensure that any pending PPC_MSG_RM_HOST_ACTION\n\t\t * messages have completed before we free any VCPUs.\n\t\t */\n\t\tif (all & IPI_MESSAGE(PPC_MSG_RM_HOST_ACTION))\n\t\t\tkvmppc_xics_ipi_action();\n#endif\n\t\tif (all & IPI_MESSAGE(PPC_MSG_CALL_FUNCTION))\n\t\t\tgeneric_smp_call_function_interrupt();\n\t\tif (all & IPI_MESSAGE(PPC_MSG_RESCHEDULE))\n\t\t\tscheduler_ipi();\n#ifdef CONFIG_GENERIC_CLOCKEVENTS_BROADCAST\n\t\tif (all & IPI_MESSAGE(PPC_MSG_TICK_BROADCAST))\n\t\t\ttimer_broadcast_interrupt();\n#endif\n#ifdef CONFIG_NMI_IPI\n\t\tif (all & IPI_MESSAGE(PPC_MSG_NMI_IPI))\n\t\t\tnmi_ipi_action(0, NULL);\n#endif\n\t} while (info->messages);\n\n\treturn IRQ_HANDLED;\n}",
          "includes": [
            "#include <asm/udbg.h>",
            "#include <asm/kup.h>",
            "#include <asm/ftrace.h>",
            "#include <asm/cpu_has_feature.h>",
            "#include <asm/asm-prototypes.h>",
            "#include <asm/kexec.h>",
            "#include <asm/debug.h>",
            "#include <asm/vdso.h>",
            "#include <asm/paca.h>",
            "#include <asm/vdso_datapage.h>",
            "#include <asm/mpic.h>",
            "#include <asm/cputable.h>",
            "#include <asm/cputhreads.h>",
            "#include <asm/machdep.h>",
            "#include <asm/time.h>",
            "#include <asm/smp.h>",
            "#include <asm/prom.h>",
            "#include <asm/page.h>",
            "#include <asm/dbell.h>",
            "#include <asm/kvm_ppc.h>",
            "#include <asm/hw_irq.h>",
            "#include <asm/irq.h>",
            "#include <linux/atomic.h>",
            "#include <asm/ptrace.h>",
            "#include <linux/pgtable.h>",
            "#include <linux/stackprotector.h>",
            "#include <linux/random.h>",
            "#include <linux/processor.h>",
            "#include <linux/profile.h>",
            "#include <linux/topology.h>",
            "#include <linux/notifier.h>",
            "#include <linux/cpu.h>",
            "#include <linux/device.h>",
            "#include <linux/err.h>",
            "#include <linux/cache.h>",
            "#include <linux/spinlock.h>",
            "#include <linux/init.h>",
            "#include <linux/delay.h>",
            "#include <linux/interrupt.h>",
            "#include <linux/smp.h>",
            "#include <linux/sched/topology.h>",
            "#include <linux/sched/task_stack.h>",
            "#include <linux/sched/mm.h>",
            "#include <linux/export.h>",
            "#include <linux/kernel.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <asm/udbg.h>\n#include <asm/kup.h>\n#include <asm/ftrace.h>\n#include <asm/cpu_has_feature.h>\n#include <asm/asm-prototypes.h>\n#include <asm/kexec.h>\n#include <asm/debug.h>\n#include <asm/vdso.h>\n#include <asm/paca.h>\n#include <asm/vdso_datapage.h>\n#include <asm/mpic.h>\n#include <asm/cputable.h>\n#include <asm/cputhreads.h>\n#include <asm/machdep.h>\n#include <asm/time.h>\n#include <asm/smp.h>\n#include <asm/prom.h>\n#include <asm/page.h>\n#include <asm/dbell.h>\n#include <asm/kvm_ppc.h>\n#include <asm/hw_irq.h>\n#include <asm/irq.h>\n#include <linux/atomic.h>\n#include <asm/ptrace.h>\n#include <linux/pgtable.h>\n#include <linux/stackprotector.h>\n#include <linux/random.h>\n#include <linux/processor.h>\n#include <linux/profile.h>\n#include <linux/topology.h>\n#include <linux/notifier.h>\n#include <linux/cpu.h>\n#include <linux/device.h>\n#include <linux/err.h>\n#include <linux/cache.h>\n#include <linux/spinlock.h>\n#include <linux/init.h>\n#include <linux/delay.h>\n#include <linux/interrupt.h>\n#include <linux/smp.h>\n#include <linux/sched/topology.h>\n#include <linux/sched/task_stack.h>\n#include <linux/sched/mm.h>\n#include <linux/export.h>\n#include <linux/kernel.h>\n\nirqreturn_t smp_ipi_demux_relaxed(void)\n{\n\tstruct cpu_messages *info;\n\tunsigned long all;\n\n\tinfo = this_cpu_ptr(&ipi_message);\n\tdo {\n\t\tall = xchg(&info->messages, 0);\n#if defined(CONFIG_KVM_XICS) && defined(CONFIG_KVM_BOOK3S_HV_POSSIBLE)\n\t\t/*\n\t\t * Must check for PPC_MSG_RM_HOST_ACTION messages\n\t\t * before PPC_MSG_CALL_FUNCTION messages because when\n\t\t * a VM is destroyed, we call kick_all_cpus_sync()\n\t\t * to ensure that any pending PPC_MSG_RM_HOST_ACTION\n\t\t * messages have completed before we free any VCPUs.\n\t\t */\n\t\tif (all & IPI_MESSAGE(PPC_MSG_RM_HOST_ACTION))\n\t\t\tkvmppc_xics_ipi_action();\n#endif\n\t\tif (all & IPI_MESSAGE(PPC_MSG_CALL_FUNCTION))\n\t\t\tgeneric_smp_call_function_interrupt();\n\t\tif (all & IPI_MESSAGE(PPC_MSG_RESCHEDULE))\n\t\t\tscheduler_ipi();\n#ifdef CONFIG_GENERIC_CLOCKEVENTS_BROADCAST\n\t\tif (all & IPI_MESSAGE(PPC_MSG_TICK_BROADCAST))\n\t\t\ttimer_broadcast_interrupt();\n#endif\n#ifdef CONFIG_NMI_IPI\n\t\tif (all & IPI_MESSAGE(PPC_MSG_NMI_IPI))\n\t\t\tnmi_ipi_action(0, NULL);\n#endif\n\t} while (info->messages);\n\n\treturn IRQ_HANDLED;\n}"
        }
      },
      {
        "call_info": {
          "callee": "__this_cpu_inc",
          "args": [
            "irq_stat.doorbell_irqs"
          ],
          "line": 33
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kvmppc_clear_host_ipi",
          "args": [
            "smp_processor_id()"
          ],
          "line": 32
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "smp_processor_id",
          "args": [],
          "line": 32
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "may_hard_irq_enable",
          "args": [],
          "line": 30
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ppc_msgsync",
          "args": [],
          "line": 28
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "trace_doorbell_entry",
          "args": [
            "regs"
          ],
          "line": 26
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "irq_enter",
          "args": [],
          "line": 25
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "set_irq_regs",
          "args": [
            "regs"
          ],
          "line": 23
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <asm/trace.h>\n#include <asm/kvm_ppc.h>\n#include <asm/irq_regs.h>\n#include <asm/dbell.h>\n#include <linux/hardirq.h>\n#include <linux/threads.h>\n#include <linux/smp.h>\n#include <linux/kernel.h>\n#include <linux/stddef.h>\n\nvoid doorbell_exception(struct pt_regs *regs)\n{\n\tstruct pt_regs *old_regs = set_irq_regs(regs);\n\n\tirq_enter();\n\ttrace_doorbell_entry(regs);\n\n\tppc_msgsync();\n\n\tmay_hard_irq_enable();\n\n\tkvmppc_clear_host_ipi(smp_processor_id());\n\t__this_cpu_inc(irq_stat.doorbell_irqs);\n\n\tsmp_ipi_demux_relaxed(); /* already performed the barrier */\n\n\ttrace_doorbell_exit(regs);\n\tirq_exit();\n\tset_irq_regs(old_regs);\n}"
  }
]