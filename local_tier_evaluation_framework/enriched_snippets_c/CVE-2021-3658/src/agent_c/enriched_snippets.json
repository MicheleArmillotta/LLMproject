[
  {
    "function_name": "btd_agent_cleanup",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/agent.c",
    "lines": "1046-1053",
    "snippet": "void btd_agent_cleanup(void)\n{\n\tg_dbus_unregister_interface(btd_get_dbus_connection(),\n\t\t\t\t\"/org/bluez\", \"org.bluez.AgentManager1\");\n\n\tg_hash_table_destroy(agent_list);\n\tqueue_destroy(default_agents, NULL);\n}",
    "includes": [
      "#include \"shared/queue.h\"",
      "#include \"agent.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"dbus-common.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/socket.h>",
      "#include <stdbool.h>",
      "#include <stdlib.h>",
      "#include <errno.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static GHashTable *agent_list;",
      "struct queue *default_agents = NULL;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "queue_destroy",
          "args": [
            "default_agents",
            "NULL"
          ],
          "line": 1052
        },
        "resolved": true,
        "details": {
          "function_name": "queue_destroy",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "68-76",
          "snippet": "void queue_destroy(struct queue *queue, queue_destroy_func_t destroy)\n{\n\tif (!queue)\n\t\treturn;\n\n\tqueue_remove_all(queue, NULL, NULL, destroy);\n\n\tqueue_unref(queue);\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nvoid queue_destroy(struct queue *queue, queue_destroy_func_t destroy)\n{\n\tif (!queue)\n\t\treturn;\n\n\tqueue_remove_all(queue, NULL, NULL, destroy);\n\n\tqueue_unref(queue);\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_hash_table_destroy",
          "args": [
            "agent_list"
          ],
          "line": 1051
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_dbus_unregister_interface",
          "args": [
            "btd_get_dbus_connection()",
            "\"/org/bluez\"",
            "\"org.bluez.AgentManager1\""
          ],
          "line": 1048
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_get_dbus_connection",
          "args": [],
          "line": 1048
        },
        "resolved": true,
        "details": {
          "function_name": "btd_get_dbus_connection",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/dbus-common.c",
          "lines": "61-64",
          "snippet": "DBusConnection *btd_get_dbus_connection(void)\n{\n\treturn connection;\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <stdint.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static DBusConnection *connection = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <stdint.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *connection = NULL;\n\nDBusConnection *btd_get_dbus_connection(void)\n{\n\treturn connection;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"shared/queue.h\"\n#include \"agent.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"dbus-common.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <sys/ioctl.h>\n#include <sys/socket.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic GHashTable *agent_list;\nstruct queue *default_agents = NULL;\n\nvoid btd_agent_cleanup(void)\n{\n\tg_dbus_unregister_interface(btd_get_dbus_connection(),\n\t\t\t\t\"/org/bluez\", \"org.bluez.AgentManager1\");\n\n\tg_hash_table_destroy(agent_list);\n\tqueue_destroy(default_agents, NULL);\n}"
  },
  {
    "function_name": "btd_agent_init",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/agent.c",
    "lines": "1034-1044",
    "snippet": "void btd_agent_init(void)\n{\n\tagent_list = g_hash_table_new_full(g_str_hash, g_str_equal,\n\t\t\t\t\t\tNULL, agent_destroy);\n\n\tdefault_agents = queue_new();\n\n\tg_dbus_register_interface(btd_get_dbus_connection(),\n\t\t\t\t\"/org/bluez\", \"org.bluez.AgentManager1\",\n\t\t\t\tmethods, NULL, NULL, NULL, NULL);\n}",
    "includes": [
      "#include \"shared/queue.h\"",
      "#include \"agent.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"dbus-common.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/socket.h>",
      "#include <stdbool.h>",
      "#include <stdlib.h>",
      "#include <errno.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static GHashTable *agent_list;",
      "struct queue *default_agents = NULL;",
      "static const GDBusMethodTable methods[] = {\n\t{ GDBUS_METHOD(\"RegisterAgent\",\n\t\t\tGDBUS_ARGS({ \"agent\", \"o\"}, { \"capability\", \"s\" }),\n\t\t\tNULL, register_agent) },\n\t{ GDBUS_METHOD(\"UnregisterAgent\", GDBUS_ARGS({ \"agent\", \"o\" }),\n\t\t\tNULL, unregister_agent) },\n\t{ GDBUS_METHOD(\"RequestDefaultAgent\", GDBUS_ARGS({ \"agent\", \"o\" }),\n\t\t\tNULL, request_default ) },\n\t{ }\n};"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_dbus_register_interface",
          "args": [
            "btd_get_dbus_connection()",
            "\"/org/bluez\"",
            "\"org.bluez.AgentManager1\"",
            "methods",
            "NULL",
            "NULL",
            "NULL",
            "NULL"
          ],
          "line": 1041
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_get_dbus_connection",
          "args": [],
          "line": 1041
        },
        "resolved": true,
        "details": {
          "function_name": "btd_get_dbus_connection",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/dbus-common.c",
          "lines": "61-64",
          "snippet": "DBusConnection *btd_get_dbus_connection(void)\n{\n\treturn connection;\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <stdint.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static DBusConnection *connection = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <stdint.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *connection = NULL;\n\nDBusConnection *btd_get_dbus_connection(void)\n{\n\treturn connection;\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_new",
          "args": [],
          "line": 1039
        },
        "resolved": true,
        "details": {
          "function_name": "queue_new",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "56-66",
          "snippet": "struct queue *queue_new(void)\n{\n\tstruct queue *queue;\n\n\tqueue = new0(struct queue, 1);\n\tqueue->head = NULL;\n\tqueue->tail = NULL;\n\tqueue->entries = 0;\n\n\treturn queue_ref(queue);\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nstruct queue *queue_new(void)\n{\n\tstruct queue *queue;\n\n\tqueue = new0(struct queue, 1);\n\tqueue->head = NULL;\n\tqueue->tail = NULL;\n\tqueue->entries = 0;\n\n\treturn queue_ref(queue);\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_hash_table_new_full",
          "args": [
            "g_str_hash",
            "g_str_equal",
            "NULL",
            "agent_destroy"
          ],
          "line": 1036
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"shared/queue.h\"\n#include \"agent.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"dbus-common.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <sys/ioctl.h>\n#include <sys/socket.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic GHashTable *agent_list;\nstruct queue *default_agents = NULL;\nstatic const GDBusMethodTable methods[] = {\n\t{ GDBUS_METHOD(\"RegisterAgent\",\n\t\t\tGDBUS_ARGS({ \"agent\", \"o\"}, { \"capability\", \"s\" }),\n\t\t\tNULL, register_agent) },\n\t{ GDBUS_METHOD(\"UnregisterAgent\", GDBUS_ARGS({ \"agent\", \"o\" }),\n\t\t\tNULL, unregister_agent) },\n\t{ GDBUS_METHOD(\"RequestDefaultAgent\", GDBUS_ARGS({ \"agent\", \"o\" }),\n\t\t\tNULL, request_default ) },\n\t{ }\n};\n\nvoid btd_agent_init(void)\n{\n\tagent_list = g_hash_table_new_full(g_str_hash, g_str_equal,\n\t\t\t\t\t\tNULL, agent_destroy);\n\n\tdefault_agents = queue_new();\n\n\tg_dbus_register_interface(btd_get_dbus_connection(),\n\t\t\t\t\"/org/bluez\", \"org.bluez.AgentManager1\",\n\t\t\t\tmethods, NULL, NULL, NULL, NULL);\n}"
  },
  {
    "function_name": "request_default",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/agent.c",
    "lines": "998-1021",
    "snippet": "static DBusMessage *request_default(DBusConnection *conn, DBusMessage *msg,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct agent *agent;\n\tconst char *sender, *path;\n\n\tsender = dbus_message_get_sender(msg);\n\n\tagent = g_hash_table_lookup(agent_list, sender);\n\tif (!agent)\n\t\treturn btd_error_does_not_exist(msg);\n\n\tif (dbus_message_get_args(msg, NULL, DBUS_TYPE_OBJECT_PATH, &path,\n\t\t\t\t\t\tDBUS_TYPE_INVALID) == FALSE)\n\t\treturn btd_error_invalid_args(msg);\n\n\tif (g_str_equal(path, agent->path) == FALSE)\n\t\treturn btd_error_does_not_exist(msg);\n\n\tif (!add_default_agent(agent))\n\t\treturn btd_error_failed(msg, \"Failed to set as default\");\n\n\treturn dbus_message_new_method_return(msg);\n}",
    "includes": [
      "#include \"shared/queue.h\"",
      "#include \"agent.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"dbus-common.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/socket.h>",
      "#include <stdbool.h>",
      "#include <stdlib.h>",
      "#include <errno.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static GHashTable *agent_list;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "dbus_message_new_method_return",
          "args": [
            "msg"
          ],
          "line": 1020
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_error_failed",
          "args": [
            "msg",
            "\"Failed to set as default\""
          ],
          "line": 1018
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_failed",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "124-128",
          "snippet": "DBusMessage *btd_error_failed(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE\n\t\t\t\t\t\".Failed\", \"%s\", str);\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_failed(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE\n\t\t\t\t\t\".Failed\", \"%s\", str);\n}"
        }
      },
      {
        "call_info": {
          "callee": "add_default_agent",
          "args": [
            "agent"
          ],
          "line": 1017
        },
        "resolved": true,
        "details": {
          "function_name": "add_default_agent",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/agent.c",
          "lines": "151-166",
          "snippet": "static bool add_default_agent(struct agent *agent)\n{\n\tif (queue_peek_head(default_agents) == agent)\n\t\treturn true;\n\n\tqueue_remove(default_agents, agent);\n\n\tif (!queue_push_head(default_agents, agent))\n\t\treturn false;\n\n\tDBG(\"Default agent set to %s %s\", agent->owner, agent->path);\n\n\tadapter_foreach(set_io_cap, agent);\n\n\treturn true;\n}",
          "includes": [
            "#include \"shared/queue.h\"",
            "#include \"agent.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"dbus-common.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/socket.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "struct queue *default_agents = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"shared/queue.h\"\n#include \"agent.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"dbus-common.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <sys/ioctl.h>\n#include <sys/socket.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstruct queue *default_agents = NULL;\n\nstatic bool add_default_agent(struct agent *agent)\n{\n\tif (queue_peek_head(default_agents) == agent)\n\t\treturn true;\n\n\tqueue_remove(default_agents, agent);\n\n\tif (!queue_push_head(default_agents, agent))\n\t\treturn false;\n\n\tDBG(\"Default agent set to %s %s\", agent->owner, agent->path);\n\n\tadapter_foreach(set_io_cap, agent);\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_error_does_not_exist",
          "args": [
            "msg"
          ],
          "line": 1015
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_does_not_exist",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "88-92",
          "snippet": "DBusMessage *btd_error_does_not_exist(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".DoesNotExist\",\n\t\t\t\t\t\"Does Not Exist\");\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_does_not_exist(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".DoesNotExist\",\n\t\t\t\t\t\"Does Not Exist\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_str_equal",
          "args": [
            "path",
            "agent->path"
          ],
          "line": 1014
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_error_invalid_args",
          "args": [
            "msg"
          ],
          "line": 1012
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_invalid_args",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "34-38",
          "snippet": "DBusMessage *btd_error_invalid_args(DBusMessage *msg)\n{\n\treturn btd_error_invalid_args_str(msg,\n\t\t\t\t\t\"Invalid arguments in method call\");\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_invalid_args(DBusMessage *msg)\n{\n\treturn btd_error_invalid_args_str(msg,\n\t\t\t\t\t\"Invalid arguments in method call\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_message_get_args",
          "args": [
            "msg",
            "NULL",
            "DBUS_TYPE_OBJECT_PATH",
            "&path",
            "DBUS_TYPE_INVALID"
          ],
          "line": 1010
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_hash_table_lookup",
          "args": [
            "agent_list",
            "sender"
          ],
          "line": 1006
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_get_sender",
          "args": [
            "msg"
          ],
          "line": 1004
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"shared/queue.h\"\n#include \"agent.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"dbus-common.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <sys/ioctl.h>\n#include <sys/socket.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic GHashTable *agent_list;\n\nstatic DBusMessage *request_default(DBusConnection *conn, DBusMessage *msg,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct agent *agent;\n\tconst char *sender, *path;\n\n\tsender = dbus_message_get_sender(msg);\n\n\tagent = g_hash_table_lookup(agent_list, sender);\n\tif (!agent)\n\t\treturn btd_error_does_not_exist(msg);\n\n\tif (dbus_message_get_args(msg, NULL, DBUS_TYPE_OBJECT_PATH, &path,\n\t\t\t\t\t\tDBUS_TYPE_INVALID) == FALSE)\n\t\treturn btd_error_invalid_args(msg);\n\n\tif (g_str_equal(path, agent->path) == FALSE)\n\t\treturn btd_error_does_not_exist(msg);\n\n\tif (!add_default_agent(agent))\n\t\treturn btd_error_failed(msg, \"Failed to set as default\");\n\n\treturn dbus_message_new_method_return(msg);\n}"
  },
  {
    "function_name": "unregister_agent",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/agent.c",
    "lines": "972-996",
    "snippet": "static DBusMessage *unregister_agent(DBusConnection *conn,\n\t\t\t\t\tDBusMessage *msg, void *user_data)\n{\n\tstruct agent *agent;\n\tconst char *sender, *path;\n\n\tsender = dbus_message_get_sender(msg);\n\n\tagent = g_hash_table_lookup(agent_list, sender);\n\tif (!agent)\n\t\treturn btd_error_does_not_exist(msg);\n\n\tDBG(\"agent %s\", agent->owner);\n\n\tif (dbus_message_get_args(msg, NULL, DBUS_TYPE_OBJECT_PATH, &path,\n\t\t\t\t\t\tDBUS_TYPE_INVALID) == FALSE)\n\t\treturn btd_error_invalid_args(msg);\n\n\tif (g_str_equal(path, agent->path) == FALSE)\n\t\treturn btd_error_does_not_exist(msg);\n\n\tagent_disconnect(conn, agent);\n\n\treturn dbus_message_new_method_return(msg);\n}",
    "includes": [
      "#include \"shared/queue.h\"",
      "#include \"agent.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"dbus-common.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/socket.h>",
      "#include <stdbool.h>",
      "#include <stdlib.h>",
      "#include <errno.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static GHashTable *agent_list;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "dbus_message_new_method_return",
          "args": [
            "msg"
          ],
          "line": 995
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "agent_disconnect",
          "args": [
            "conn",
            "agent"
          ],
          "line": 993
        },
        "resolved": true,
        "details": {
          "function_name": "agent_disconnect",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/agent.c",
          "lines": "186-200",
          "snippet": "static void agent_disconnect(DBusConnection *conn, void *user_data)\n{\n\tstruct agent *agent = user_data;\n\n\tDBG(\"Agent %s disconnected\", agent->owner);\n\n\tif (agent->watch > 0) {\n\t\tg_dbus_remove_watch(conn, agent->watch);\n\t\tagent->watch = 0;\n\t}\n\n\tremove_default_agent(agent);\n\n\tg_hash_table_remove(agent_list, agent->owner);\n}",
          "includes": [
            "#include \"shared/queue.h\"",
            "#include \"agent.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"dbus-common.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/socket.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static GHashTable *agent_list;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"shared/queue.h\"\n#include \"agent.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"dbus-common.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <sys/ioctl.h>\n#include <sys/socket.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic GHashTable *agent_list;\n\nstatic void agent_disconnect(DBusConnection *conn, void *user_data)\n{\n\tstruct agent *agent = user_data;\n\n\tDBG(\"Agent %s disconnected\", agent->owner);\n\n\tif (agent->watch > 0) {\n\t\tg_dbus_remove_watch(conn, agent->watch);\n\t\tagent->watch = 0;\n\t}\n\n\tremove_default_agent(agent);\n\n\tg_hash_table_remove(agent_list, agent->owner);\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_error_does_not_exist",
          "args": [
            "msg"
          ],
          "line": 991
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_does_not_exist",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "88-92",
          "snippet": "DBusMessage *btd_error_does_not_exist(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".DoesNotExist\",\n\t\t\t\t\t\"Does Not Exist\");\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_does_not_exist(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".DoesNotExist\",\n\t\t\t\t\t\"Does Not Exist\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_str_equal",
          "args": [
            "path",
            "agent->path"
          ],
          "line": 990
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_error_invalid_args",
          "args": [
            "msg"
          ],
          "line": 988
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_invalid_args",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "34-38",
          "snippet": "DBusMessage *btd_error_invalid_args(DBusMessage *msg)\n{\n\treturn btd_error_invalid_args_str(msg,\n\t\t\t\t\t\"Invalid arguments in method call\");\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_invalid_args(DBusMessage *msg)\n{\n\treturn btd_error_invalid_args_str(msg,\n\t\t\t\t\t\"Invalid arguments in method call\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_message_get_args",
          "args": [
            "msg",
            "NULL",
            "DBUS_TYPE_OBJECT_PATH",
            "&path",
            "DBUS_TYPE_INVALID"
          ],
          "line": 986
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"agent %s\"",
            "agent->owner"
          ],
          "line": 984
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_hash_table_lookup",
          "args": [
            "agent_list",
            "sender"
          ],
          "line": 980
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_get_sender",
          "args": [
            "msg"
          ],
          "line": 978
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"shared/queue.h\"\n#include \"agent.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"dbus-common.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <sys/ioctl.h>\n#include <sys/socket.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic GHashTable *agent_list;\n\nstatic DBusMessage *unregister_agent(DBusConnection *conn,\n\t\t\t\t\tDBusMessage *msg, void *user_data)\n{\n\tstruct agent *agent;\n\tconst char *sender, *path;\n\n\tsender = dbus_message_get_sender(msg);\n\n\tagent = g_hash_table_lookup(agent_list, sender);\n\tif (!agent)\n\t\treturn btd_error_does_not_exist(msg);\n\n\tDBG(\"agent %s\", agent->owner);\n\n\tif (dbus_message_get_args(msg, NULL, DBUS_TYPE_OBJECT_PATH, &path,\n\t\t\t\t\t\tDBUS_TYPE_INVALID) == FALSE)\n\t\treturn btd_error_invalid_args(msg);\n\n\tif (g_str_equal(path, agent->path) == FALSE)\n\t\treturn btd_error_does_not_exist(msg);\n\n\tagent_disconnect(conn, agent);\n\n\treturn dbus_message_new_method_return(msg);\n}"
  },
  {
    "function_name": "register_agent",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/agent.c",
    "lines": "939-970",
    "snippet": "static DBusMessage *register_agent(DBusConnection *conn,\n\t\t\t\t\tDBusMessage *msg, void *user_data)\n{\n\tstruct agent *agent;\n\tconst char *sender, *path, *capability;\n\tuint8_t cap;\n\n\tsender = dbus_message_get_sender(msg);\n\n\tagent = g_hash_table_lookup(agent_list, sender);\n\tif (agent)\n\t\treturn btd_error_already_exists(msg);\n\n\tif (dbus_message_get_args(msg, NULL, DBUS_TYPE_OBJECT_PATH, &path,\n\t\t\t\t\t\tDBUS_TYPE_STRING, &capability,\n\t\t\t\t\t\tDBUS_TYPE_INVALID) == FALSE)\n\t\treturn btd_error_invalid_args(msg);\n\n\tcap = parse_io_capability(capability);\n\tif (cap == IO_CAPABILITY_INVALID)\n\t\treturn btd_error_invalid_args(msg);\n\n\tagent = agent_create(sender, path, cap);\n\tif (!agent)\n\t\treturn btd_error_invalid_args(msg);\n\n\tDBG(\"agent %s\", agent->owner);\n\n\tg_hash_table_replace(agent_list, agent->owner, agent);\n\n\treturn dbus_message_new_method_return(msg);\n}",
    "includes": [
      "#include \"shared/queue.h\"",
      "#include \"agent.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"dbus-common.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/socket.h>",
      "#include <stdbool.h>",
      "#include <stdlib.h>",
      "#include <errno.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static GHashTable *agent_list;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "dbus_message_new_method_return",
          "args": [
            "msg"
          ],
          "line": 969
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_hash_table_replace",
          "args": [
            "agent_list",
            "agent->owner",
            "agent"
          ],
          "line": 967
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"agent %s\"",
            "agent->owner"
          ],
          "line": 965
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_error_invalid_args",
          "args": [
            "msg"
          ],
          "line": 963
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_invalid_args",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "34-38",
          "snippet": "DBusMessage *btd_error_invalid_args(DBusMessage *msg)\n{\n\treturn btd_error_invalid_args_str(msg,\n\t\t\t\t\t\"Invalid arguments in method call\");\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_invalid_args(DBusMessage *msg)\n{\n\treturn btd_error_invalid_args_str(msg,\n\t\t\t\t\t\"Invalid arguments in method call\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "agent_create",
          "args": [
            "sender",
            "path",
            "cap"
          ],
          "line": 961
        },
        "resolved": true,
        "details": {
          "function_name": "agent_create",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/agent.c",
          "lines": "275-296",
          "snippet": "static struct agent *agent_create( const char *name, const char *path,\n\t\t\t\t\t\t\tuint8_t capability)\n{\n\tstruct agent *agent;\n\n\tagent = g_new0(struct agent, 1);\n\n\tagent->owner = g_strdup(name);\n\tagent->path = g_strdup(path);\n\tagent->capability = capability;\n\n\tagent->watch = g_dbus_add_disconnect_watch(btd_get_dbus_connection(),\n\t\t\t\t\t\t\tname, agent_disconnect,\n\t\t\t\t\t\t\tagent, NULL);\n\n\tif (queue_isempty(default_agents))\n\t\tadd_default_agent(agent);\n\telse\n\t\tqueue_push_tail(default_agents, agent);\n\n\treturn agent_ref(agent);\n}",
          "includes": [
            "#include \"shared/queue.h\"",
            "#include \"agent.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"dbus-common.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/socket.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "struct queue *default_agents = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"shared/queue.h\"\n#include \"agent.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"dbus-common.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <sys/ioctl.h>\n#include <sys/socket.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstruct queue *default_agents = NULL;\n\nstatic struct agent *agent_create( const char *name, const char *path,\n\t\t\t\t\t\t\tuint8_t capability)\n{\n\tstruct agent *agent;\n\n\tagent = g_new0(struct agent, 1);\n\n\tagent->owner = g_strdup(name);\n\tagent->path = g_strdup(path);\n\tagent->capability = capability;\n\n\tagent->watch = g_dbus_add_disconnect_watch(btd_get_dbus_connection(),\n\t\t\t\t\t\t\tname, agent_disconnect,\n\t\t\t\t\t\t\tagent, NULL);\n\n\tif (queue_isempty(default_agents))\n\t\tadd_default_agent(agent);\n\telse\n\t\tqueue_push_tail(default_agents, agent);\n\n\treturn agent_ref(agent);\n}"
        }
      },
      {
        "call_info": {
          "callee": "parse_io_capability",
          "args": [
            "capability"
          ],
          "line": 957
        },
        "resolved": true,
        "details": {
          "function_name": "parse_io_capability",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/agent.c",
          "lines": "922-937",
          "snippet": "static uint8_t parse_io_capability(const char *capability)\n{\n\tif (g_str_equal(capability, \"\"))\n\t\treturn IO_CAPABILITY_KEYBOARDDISPLAY;\n\tif (g_str_equal(capability, \"DisplayOnly\"))\n\t\treturn IO_CAPABILITY_DISPLAYONLY;\n\tif (g_str_equal(capability, \"DisplayYesNo\"))\n\t\treturn IO_CAPABILITY_DISPLAYYESNO;\n\tif (g_str_equal(capability, \"KeyboardOnly\"))\n\t\treturn IO_CAPABILITY_KEYBOARDONLY;\n\tif (g_str_equal(capability, \"NoInputNoOutput\"))\n\t\treturn IO_CAPABILITY_NOINPUTNOOUTPUT;\n\tif (g_str_equal(capability, \"KeyboardDisplay\"))\n\t\treturn IO_CAPABILITY_KEYBOARDDISPLAY;\n\treturn IO_CAPABILITY_INVALID;\n}",
          "includes": [
            "#include \"shared/queue.h\"",
            "#include \"agent.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"dbus-common.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/socket.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"shared/queue.h\"\n#include \"agent.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"dbus-common.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <sys/ioctl.h>\n#include <sys/socket.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic uint8_t parse_io_capability(const char *capability)\n{\n\tif (g_str_equal(capability, \"\"))\n\t\treturn IO_CAPABILITY_KEYBOARDDISPLAY;\n\tif (g_str_equal(capability, \"DisplayOnly\"))\n\t\treturn IO_CAPABILITY_DISPLAYONLY;\n\tif (g_str_equal(capability, \"DisplayYesNo\"))\n\t\treturn IO_CAPABILITY_DISPLAYYESNO;\n\tif (g_str_equal(capability, \"KeyboardOnly\"))\n\t\treturn IO_CAPABILITY_KEYBOARDONLY;\n\tif (g_str_equal(capability, \"NoInputNoOutput\"))\n\t\treturn IO_CAPABILITY_NOINPUTNOOUTPUT;\n\tif (g_str_equal(capability, \"KeyboardDisplay\"))\n\t\treturn IO_CAPABILITY_KEYBOARDDISPLAY;\n\treturn IO_CAPABILITY_INVALID;\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_message_get_args",
          "args": [
            "msg",
            "NULL",
            "DBUS_TYPE_OBJECT_PATH",
            "&path",
            "DBUS_TYPE_STRING",
            "&capability",
            "DBUS_TYPE_INVALID"
          ],
          "line": 952
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_error_already_exists",
          "args": [
            "msg"
          ],
          "line": 950
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_already_exists",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "52-56",
          "snippet": "DBusMessage *btd_error_already_exists(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".AlreadyExists\",\n\t\t\t\t\t\"Already Exists\");\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_already_exists(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".AlreadyExists\",\n\t\t\t\t\t\"Already Exists\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_hash_table_lookup",
          "args": [
            "agent_list",
            "sender"
          ],
          "line": 948
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_get_sender",
          "args": [
            "msg"
          ],
          "line": 946
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"shared/queue.h\"\n#include \"agent.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"dbus-common.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <sys/ioctl.h>\n#include <sys/socket.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic GHashTable *agent_list;\n\nstatic DBusMessage *register_agent(DBusConnection *conn,\n\t\t\t\t\tDBusMessage *msg, void *user_data)\n{\n\tstruct agent *agent;\n\tconst char *sender, *path, *capability;\n\tuint8_t cap;\n\n\tsender = dbus_message_get_sender(msg);\n\n\tagent = g_hash_table_lookup(agent_list, sender);\n\tif (agent)\n\t\treturn btd_error_already_exists(msg);\n\n\tif (dbus_message_get_args(msg, NULL, DBUS_TYPE_OBJECT_PATH, &path,\n\t\t\t\t\t\tDBUS_TYPE_STRING, &capability,\n\t\t\t\t\t\tDBUS_TYPE_INVALID) == FALSE)\n\t\treturn btd_error_invalid_args(msg);\n\n\tcap = parse_io_capability(capability);\n\tif (cap == IO_CAPABILITY_INVALID)\n\t\treturn btd_error_invalid_args(msg);\n\n\tagent = agent_create(sender, path, cap);\n\tif (!agent)\n\t\treturn btd_error_invalid_args(msg);\n\n\tDBG(\"agent %s\", agent->owner);\n\n\tg_hash_table_replace(agent_list, agent->owner, agent);\n\n\treturn dbus_message_new_method_return(msg);\n}"
  },
  {
    "function_name": "parse_io_capability",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/agent.c",
    "lines": "922-937",
    "snippet": "static uint8_t parse_io_capability(const char *capability)\n{\n\tif (g_str_equal(capability, \"\"))\n\t\treturn IO_CAPABILITY_KEYBOARDDISPLAY;\n\tif (g_str_equal(capability, \"DisplayOnly\"))\n\t\treturn IO_CAPABILITY_DISPLAYONLY;\n\tif (g_str_equal(capability, \"DisplayYesNo\"))\n\t\treturn IO_CAPABILITY_DISPLAYYESNO;\n\tif (g_str_equal(capability, \"KeyboardOnly\"))\n\t\treturn IO_CAPABILITY_KEYBOARDONLY;\n\tif (g_str_equal(capability, \"NoInputNoOutput\"))\n\t\treturn IO_CAPABILITY_NOINPUTNOOUTPUT;\n\tif (g_str_equal(capability, \"KeyboardDisplay\"))\n\t\treturn IO_CAPABILITY_KEYBOARDDISPLAY;\n\treturn IO_CAPABILITY_INVALID;\n}",
    "includes": [
      "#include \"shared/queue.h\"",
      "#include \"agent.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"dbus-common.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/socket.h>",
      "#include <stdbool.h>",
      "#include <stdlib.h>",
      "#include <errno.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_str_equal",
          "args": [
            "capability",
            "\"KeyboardDisplay\""
          ],
          "line": 934
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_str_equal",
          "args": [
            "capability",
            "\"NoInputNoOutput\""
          ],
          "line": 932
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_str_equal",
          "args": [
            "capability",
            "\"KeyboardOnly\""
          ],
          "line": 930
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_str_equal",
          "args": [
            "capability",
            "\"DisplayYesNo\""
          ],
          "line": 928
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_str_equal",
          "args": [
            "capability",
            "\"DisplayOnly\""
          ],
          "line": 926
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_str_equal",
          "args": [
            "capability",
            "\"\""
          ],
          "line": 924
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"shared/queue.h\"\n#include \"agent.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"dbus-common.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <sys/ioctl.h>\n#include <sys/socket.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic uint8_t parse_io_capability(const char *capability)\n{\n\tif (g_str_equal(capability, \"\"))\n\t\treturn IO_CAPABILITY_KEYBOARDDISPLAY;\n\tif (g_str_equal(capability, \"DisplayOnly\"))\n\t\treturn IO_CAPABILITY_DISPLAYONLY;\n\tif (g_str_equal(capability, \"DisplayYesNo\"))\n\t\treturn IO_CAPABILITY_DISPLAYYESNO;\n\tif (g_str_equal(capability, \"KeyboardOnly\"))\n\t\treturn IO_CAPABILITY_KEYBOARDONLY;\n\tif (g_str_equal(capability, \"NoInputNoOutput\"))\n\t\treturn IO_CAPABILITY_NOINPUTNOOUTPUT;\n\tif (g_str_equal(capability, \"KeyboardDisplay\"))\n\t\treturn IO_CAPABILITY_KEYBOARDDISPLAY;\n\treturn IO_CAPABILITY_INVALID;\n}"
  },
  {
    "function_name": "agent_destroy",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/agent.c",
    "lines": "905-920",
    "snippet": "static void agent_destroy(gpointer data)\n{\n\tstruct agent *agent = data;\n\n\tDBG(\"agent %s\", agent->owner);\n\n\tif (agent->watch > 0) {\n\t\tg_dbus_remove_watch(btd_get_dbus_connection(), agent->watch);\n\t\tagent->watch = 0;\n\t\tagent_release(agent);\n\t}\n\n\tremove_default_agent(agent);\n\n\tagent_unref(agent);\n}",
    "includes": [
      "#include \"shared/queue.h\"",
      "#include \"agent.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"dbus-common.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/socket.h>",
      "#include <stdbool.h>",
      "#include <stdlib.h>",
      "#include <errno.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "agent_unref",
          "args": [
            "agent"
          ],
          "line": 919
        },
        "resolved": true,
        "details": {
          "function_name": "agent_unref",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/agent.c",
          "lines": "211-257",
          "snippet": "void agent_unref(struct agent *agent)\n{\n\tagent->ref--;\n\n\tDBG(\"%p: ref=%d\", agent, agent->ref);\n\n\tif (agent->ref > 0)\n\t\treturn;\n\n\tif (agent->request) {\n\t\tDBusError err;\n\t\tagent_pincode_cb pincode_cb;\n\t\tagent_passkey_cb passkey_cb;\n\t\tagent_cb cb;\n\n\t\tdbus_error_init(&err);\n\t\tdbus_set_error_const(&err, ERROR_INTERFACE \".Failed\",\n\t\t\t\t\t\t\t\t\"Canceled\");\n\n\t\tswitch (agent->request->type) {\n\t\tcase AGENT_REQUEST_PINCODE:\n\t\t\tpincode_cb = agent->request->cb;\n\t\t\tpincode_cb(agent, &err, NULL, agent->request->user_data);\n\t\t\tbreak;\n\t\tcase AGENT_REQUEST_PASSKEY:\n\t\t\tpasskey_cb = agent->request->cb;\n\t\t\tpasskey_cb(agent, &err, 0, agent->request->user_data);\n\t\t\tbreak;\n\t\tcase AGENT_REQUEST_CONFIRMATION:\n\t\tcase AGENT_REQUEST_AUTHORIZATION:\n\t\tcase AGENT_REQUEST_AUTHORIZE_SERVICE:\n\t\tcase AGENT_REQUEST_DISPLAY_PINCODE:\n\t\tdefault:\n\t\t\tcb = agent->request->cb;\n\t\t\tcb(agent, &err, agent->request->user_data);\n\t\t}\n\n\t\tdbus_error_free(&err);\n\n\t\tagent_cancel(agent);\n\t}\n\n\tg_free(agent->owner);\n\tg_free(agent->path);\n\n\tg_free(agent);\n}",
          "includes": [
            "#include \"shared/queue.h\"",
            "#include \"agent.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"dbus-common.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/socket.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"shared/queue.h\"\n#include \"agent.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"dbus-common.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <sys/ioctl.h>\n#include <sys/socket.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nvoid agent_unref(struct agent *agent)\n{\n\tagent->ref--;\n\n\tDBG(\"%p: ref=%d\", agent, agent->ref);\n\n\tif (agent->ref > 0)\n\t\treturn;\n\n\tif (agent->request) {\n\t\tDBusError err;\n\t\tagent_pincode_cb pincode_cb;\n\t\tagent_passkey_cb passkey_cb;\n\t\tagent_cb cb;\n\n\t\tdbus_error_init(&err);\n\t\tdbus_set_error_const(&err, ERROR_INTERFACE \".Failed\",\n\t\t\t\t\t\t\t\t\"Canceled\");\n\n\t\tswitch (agent->request->type) {\n\t\tcase AGENT_REQUEST_PINCODE:\n\t\t\tpincode_cb = agent->request->cb;\n\t\t\tpincode_cb(agent, &err, NULL, agent->request->user_data);\n\t\t\tbreak;\n\t\tcase AGENT_REQUEST_PASSKEY:\n\t\t\tpasskey_cb = agent->request->cb;\n\t\t\tpasskey_cb(agent, &err, 0, agent->request->user_data);\n\t\t\tbreak;\n\t\tcase AGENT_REQUEST_CONFIRMATION:\n\t\tcase AGENT_REQUEST_AUTHORIZATION:\n\t\tcase AGENT_REQUEST_AUTHORIZE_SERVICE:\n\t\tcase AGENT_REQUEST_DISPLAY_PINCODE:\n\t\tdefault:\n\t\t\tcb = agent->request->cb;\n\t\t\tcb(agent, &err, agent->request->user_data);\n\t\t}\n\n\t\tdbus_error_free(&err);\n\n\t\tagent_cancel(agent);\n\t}\n\n\tg_free(agent->owner);\n\tg_free(agent->path);\n\n\tg_free(agent);\n}"
        }
      },
      {
        "call_info": {
          "callee": "remove_default_agent",
          "args": [
            "agent"
          ],
          "line": 917
        },
        "resolved": true,
        "details": {
          "function_name": "remove_default_agent",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/agent.c",
          "lines": "168-184",
          "snippet": "static void remove_default_agent(struct agent *agent)\n{\n\tif (queue_peek_head(default_agents) != agent) {\n\t\tqueue_remove(default_agents, agent);\n\t\treturn;\n\t}\n\n\tqueue_remove(default_agents, agent);\n\n\tagent = queue_peek_head(default_agents);\n\tif (agent)\n\t\tDBG(\"Default agent set to %s %s\", agent->owner, agent->path);\n\telse\n\t\tDBG(\"Default agent cleared\");\n\n\tadapter_foreach(set_io_cap, agent);\n}",
          "includes": [
            "#include \"shared/queue.h\"",
            "#include \"agent.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"dbus-common.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/socket.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "struct queue *default_agents = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"shared/queue.h\"\n#include \"agent.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"dbus-common.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <sys/ioctl.h>\n#include <sys/socket.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstruct queue *default_agents = NULL;\n\nstatic void remove_default_agent(struct agent *agent)\n{\n\tif (queue_peek_head(default_agents) != agent) {\n\t\tqueue_remove(default_agents, agent);\n\t\treturn;\n\t}\n\n\tqueue_remove(default_agents, agent);\n\n\tagent = queue_peek_head(default_agents);\n\tif (agent)\n\t\tDBG(\"Default agent set to %s %s\", agent->owner, agent->path);\n\telse\n\t\tDBG(\"Default agent cleared\");\n\n\tadapter_foreach(set_io_cap, agent);\n}"
        }
      },
      {
        "call_info": {
          "callee": "agent_release",
          "args": [
            "agent"
          ],
          "line": 914
        },
        "resolved": true,
        "details": {
          "function_name": "agent_release",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/agent.c",
          "lines": "87-104",
          "snippet": "static void agent_release(struct agent *agent)\n{\n\tDBusMessage *message;\n\n\tDBG(\"Releasing agent %s, %s\", agent->owner, agent->path);\n\n\tif (agent->request)\n\t\tagent_cancel(agent);\n\n\tmessage = dbus_message_new_method_call(agent->owner, agent->path,\n\t\t\t\t\t\tAGENT_INTERFACE, \"Release\");\n\tif (message == NULL) {\n\t\terror(\"Couldn't allocate D-Bus message\");\n\t\treturn;\n\t}\n\n\tg_dbus_send_message(btd_get_dbus_connection(), message);\n}",
          "includes": [
            "#include \"shared/queue.h\"",
            "#include \"agent.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"dbus-common.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/socket.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define AGENT_INTERFACE \"org.bluez.Agent1\""
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"shared/queue.h\"\n#include \"agent.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"dbus-common.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <sys/ioctl.h>\n#include <sys/socket.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\n#define AGENT_INTERFACE \"org.bluez.Agent1\"\n\nstatic void agent_release(struct agent *agent)\n{\n\tDBusMessage *message;\n\n\tDBG(\"Releasing agent %s, %s\", agent->owner, agent->path);\n\n\tif (agent->request)\n\t\tagent_cancel(agent);\n\n\tmessage = dbus_message_new_method_call(agent->owner, agent->path,\n\t\t\t\t\t\tAGENT_INTERFACE, \"Release\");\n\tif (message == NULL) {\n\t\terror(\"Couldn't allocate D-Bus message\");\n\t\treturn;\n\t}\n\n\tg_dbus_send_message(btd_get_dbus_connection(), message);\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_dbus_remove_watch",
          "args": [
            "btd_get_dbus_connection()",
            "agent->watch"
          ],
          "line": 912
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_get_dbus_connection",
          "args": [],
          "line": 912
        },
        "resolved": true,
        "details": {
          "function_name": "btd_get_dbus_connection",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/dbus-common.c",
          "lines": "61-64",
          "snippet": "DBusConnection *btd_get_dbus_connection(void)\n{\n\treturn connection;\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <stdint.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static DBusConnection *connection = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <stdint.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *connection = NULL;\n\nDBusConnection *btd_get_dbus_connection(void)\n{\n\treturn connection;\n}"
        }
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"agent %s\"",
            "agent->owner"
          ],
          "line": 909
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"shared/queue.h\"\n#include \"agent.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"dbus-common.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <sys/ioctl.h>\n#include <sys/socket.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void agent_destroy(gpointer data)\n{\n\tstruct agent *agent = data;\n\n\tDBG(\"agent %s\", agent->owner);\n\n\tif (agent->watch > 0) {\n\t\tg_dbus_remove_watch(btd_get_dbus_connection(), agent->watch);\n\t\tagent->watch = 0;\n\t\tagent_release(agent);\n\t}\n\n\tremove_default_agent(agent);\n\n\tagent_unref(agent);\n}"
  },
  {
    "function_name": "agent_get_io_capability",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/agent.c",
    "lines": "900-903",
    "snippet": "uint8_t agent_get_io_capability(struct agent *agent)\n{\n\treturn agent->capability;\n}",
    "includes": [
      "#include \"shared/queue.h\"",
      "#include \"agent.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"dbus-common.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/socket.h>",
      "#include <stdbool.h>",
      "#include <stdlib.h>",
      "#include <errno.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"shared/queue.h\"\n#include \"agent.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"dbus-common.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <sys/ioctl.h>\n#include <sys/socket.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nuint8_t agent_get_io_capability(struct agent *agent)\n{\n\treturn agent->capability;\n}"
  },
  {
    "function_name": "agent_display_pincode",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/agent.c",
    "lines": "870-898",
    "snippet": "int agent_display_pincode(struct agent *agent, struct btd_device *device,\n\t\t\t\tconst char *pincode, agent_cb cb,\n\t\t\t\tvoid *user_data, GDestroyNotify destroy)\n{\n\tstruct agent_request *req;\n\tconst char *dev_path = device_get_path(device);\n\tint err;\n\n\tif (agent->request)\n\t\treturn -EBUSY;\n\n\tDBG(\"Calling Agent.DisplayPinCode: name=%s, path=%s, pincode=%s\",\n\t\t\t\t\tagent->owner, agent->path, pincode);\n\n\treq = agent_request_new(agent, AGENT_REQUEST_DISPLAY_PINCODE, cb,\n\t\t\t\t\t\t\tuser_data, destroy);\n\n\terr = display_pincode_request_new(req, dev_path, pincode);\n\tif (err < 0)\n\t\tgoto failed;\n\n\tagent->request = req;\n\n\treturn 0;\n\nfailed:\n\tagent_request_free(req, FALSE);\n\treturn err;\n}",
    "includes": [
      "#include \"shared/queue.h\"",
      "#include \"agent.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"dbus-common.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/socket.h>",
      "#include <stdbool.h>",
      "#include <stdlib.h>",
      "#include <errno.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "agent_request_free",
          "args": [
            "req",
            "FALSE"
          ],
          "line": 896
        },
        "resolved": true,
        "details": {
          "function_name": "agent_request_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/agent.c",
          "lines": "125-136",
          "snippet": "static void agent_request_free(struct agent_request *req, gboolean destroy)\n{\n\tif (req->msg)\n\t\tdbus_message_unref(req->msg);\n\tif (req->call)\n\t\tdbus_pending_call_unref(req->call);\n\tif (req->agent && req->agent->request)\n\t\treq->agent->request = NULL;\n\tif (destroy && req->destroy)\n\t\treq->destroy(req->user_data);\n\tg_free(req);\n}",
          "includes": [
            "#include \"shared/queue.h\"",
            "#include \"agent.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"dbus-common.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/socket.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"shared/queue.h\"\n#include \"agent.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"dbus-common.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <sys/ioctl.h>\n#include <sys/socket.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void agent_request_free(struct agent_request *req, gboolean destroy)\n{\n\tif (req->msg)\n\t\tdbus_message_unref(req->msg);\n\tif (req->call)\n\t\tdbus_pending_call_unref(req->call);\n\tif (req->agent && req->agent->request)\n\t\treq->agent->request = NULL;\n\tif (destroy && req->destroy)\n\t\treq->destroy(req->user_data);\n\tg_free(req);\n}"
        }
      },
      {
        "call_info": {
          "callee": "display_pincode_request_new",
          "args": [
            "req",
            "dev_path",
            "pincode"
          ],
          "line": 887
        },
        "resolved": true,
        "details": {
          "function_name": "display_pincode_request_new",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/agent.c",
          "lines": "840-868",
          "snippet": "static int display_pincode_request_new(struct agent_request *req,\n\t\t\t\t\tconst char *device_path,\n\t\t\t\t\tconst char *pincode)\n{\n\tstruct agent *agent = req->agent;\n\n\treq->msg = dbus_message_new_method_call(agent->owner, agent->path,\n\t\t\t\t\tAGENT_INTERFACE, \"DisplayPinCode\");\n\tif (req->msg == NULL) {\n\t\terror(\"Couldn't allocate D-Bus message\");\n\t\treturn -ENOMEM;\n\t}\n\n\tdbus_message_append_args(req->msg,\n\t\t\t\t\tDBUS_TYPE_OBJECT_PATH, &device_path,\n\t\t\t\t\tDBUS_TYPE_STRING, &pincode,\n\t\t\t\t\tDBUS_TYPE_INVALID);\n\n\tif (g_dbus_send_message_with_reply(btd_get_dbus_connection(), req->msg,\n\t\t\t\t&req->call, REQUEST_TIMEOUT) == FALSE) {\n\t\terror(\"D-Bus send failed\");\n\t\treturn -EIO;\n\t}\n\n\tdbus_pending_call_set_notify(req->call, display_pincode_reply,\n\t\t\t\t\t\t\t\treq, NULL);\n\n\treturn 0;\n}",
          "includes": [
            "#include \"shared/queue.h\"",
            "#include \"agent.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"dbus-common.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/socket.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define AGENT_INTERFACE \"org.bluez.Agent1\"",
            "#define REQUEST_TIMEOUT (60 * 1000)\t\t/* 60 seconds */"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"shared/queue.h\"\n#include \"agent.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"dbus-common.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <sys/ioctl.h>\n#include <sys/socket.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\n#define AGENT_INTERFACE \"org.bluez.Agent1\"\n#define REQUEST_TIMEOUT (60 * 1000)\t\t/* 60 seconds */\n\nstatic int display_pincode_request_new(struct agent_request *req,\n\t\t\t\t\tconst char *device_path,\n\t\t\t\t\tconst char *pincode)\n{\n\tstruct agent *agent = req->agent;\n\n\treq->msg = dbus_message_new_method_call(agent->owner, agent->path,\n\t\t\t\t\tAGENT_INTERFACE, \"DisplayPinCode\");\n\tif (req->msg == NULL) {\n\t\terror(\"Couldn't allocate D-Bus message\");\n\t\treturn -ENOMEM;\n\t}\n\n\tdbus_message_append_args(req->msg,\n\t\t\t\t\tDBUS_TYPE_OBJECT_PATH, &device_path,\n\t\t\t\t\tDBUS_TYPE_STRING, &pincode,\n\t\t\t\t\tDBUS_TYPE_INVALID);\n\n\tif (g_dbus_send_message_with_reply(btd_get_dbus_connection(), req->msg,\n\t\t\t\t&req->call, REQUEST_TIMEOUT) == FALSE) {\n\t\terror(\"D-Bus send failed\");\n\t\treturn -EIO;\n\t}\n\n\tdbus_pending_call_set_notify(req->call, display_pincode_reply,\n\t\t\t\t\t\t\t\treq, NULL);\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "agent_request_new",
          "args": [
            "agent",
            "AGENT_REQUEST_DISPLAY_PINCODE",
            "cb",
            "user_data",
            "destroy"
          ],
          "line": 884
        },
        "resolved": true,
        "details": {
          "function_name": "agent_request_new",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/agent.c",
          "lines": "298-315",
          "snippet": "static struct agent_request *agent_request_new(struct agent *agent,\n\t\t\t\t\t\tagent_request_type_t type,\n\t\t\t\t\t\tvoid *cb,\n\t\t\t\t\t\tvoid *user_data,\n\t\t\t\t\t\tGDestroyNotify destroy)\n{\n\tstruct agent_request *req;\n\n\treq = g_new0(struct agent_request, 1);\n\n\treq->agent = agent;\n\treq->type = type;\n\treq->cb = cb;\n\treq->user_data = user_data;\n\treq->destroy = destroy;\n\n\treturn req;\n}",
          "includes": [
            "#include \"shared/queue.h\"",
            "#include \"agent.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"dbus-common.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/socket.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"shared/queue.h\"\n#include \"agent.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"dbus-common.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <sys/ioctl.h>\n#include <sys/socket.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic struct agent_request *agent_request_new(struct agent *agent,\n\t\t\t\t\t\tagent_request_type_t type,\n\t\t\t\t\t\tvoid *cb,\n\t\t\t\t\t\tvoid *user_data,\n\t\t\t\t\t\tGDestroyNotify destroy)\n{\n\tstruct agent_request *req;\n\n\treq = g_new0(struct agent_request, 1);\n\n\treq->agent = agent;\n\treq->type = type;\n\treq->cb = cb;\n\treq->user_data = user_data;\n\treq->destroy = destroy;\n\n\treturn req;\n}"
        }
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"Calling Agent.DisplayPinCode: name=%s, path=%s, pincode=%s\"",
            "agent->owner",
            "agent->path",
            "pincode"
          ],
          "line": 881
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "device_get_path",
          "args": [
            "device"
          ],
          "line": 875
        },
        "resolved": true,
        "details": {
          "function_name": "device_get_path",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "5323-5329",
          "snippet": "const char *device_get_path(const struct btd_device *device)\n{\n\tif (!device)\n\t\treturn NULL;\n\n\treturn device->path;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nconst char *device_get_path(const struct btd_device *device)\n{\n\tif (!device)\n\t\treturn NULL;\n\n\treturn device->path;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"shared/queue.h\"\n#include \"agent.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"dbus-common.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <sys/ioctl.h>\n#include <sys/socket.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nint agent_display_pincode(struct agent *agent, struct btd_device *device,\n\t\t\t\tconst char *pincode, agent_cb cb,\n\t\t\t\tvoid *user_data, GDestroyNotify destroy)\n{\n\tstruct agent_request *req;\n\tconst char *dev_path = device_get_path(device);\n\tint err;\n\n\tif (agent->request)\n\t\treturn -EBUSY;\n\n\tDBG(\"Calling Agent.DisplayPinCode: name=%s, path=%s, pincode=%s\",\n\t\t\t\t\tagent->owner, agent->path, pincode);\n\n\treq = agent_request_new(agent, AGENT_REQUEST_DISPLAY_PINCODE, cb,\n\t\t\t\t\t\t\tuser_data, destroy);\n\n\terr = display_pincode_request_new(req, dev_path, pincode);\n\tif (err < 0)\n\t\tgoto failed;\n\n\tagent->request = req;\n\n\treturn 0;\n\nfailed:\n\tagent_request_free(req, FALSE);\n\treturn err;\n}"
  },
  {
    "function_name": "display_pincode_request_new",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/agent.c",
    "lines": "840-868",
    "snippet": "static int display_pincode_request_new(struct agent_request *req,\n\t\t\t\t\tconst char *device_path,\n\t\t\t\t\tconst char *pincode)\n{\n\tstruct agent *agent = req->agent;\n\n\treq->msg = dbus_message_new_method_call(agent->owner, agent->path,\n\t\t\t\t\tAGENT_INTERFACE, \"DisplayPinCode\");\n\tif (req->msg == NULL) {\n\t\terror(\"Couldn't allocate D-Bus message\");\n\t\treturn -ENOMEM;\n\t}\n\n\tdbus_message_append_args(req->msg,\n\t\t\t\t\tDBUS_TYPE_OBJECT_PATH, &device_path,\n\t\t\t\t\tDBUS_TYPE_STRING, &pincode,\n\t\t\t\t\tDBUS_TYPE_INVALID);\n\n\tif (g_dbus_send_message_with_reply(btd_get_dbus_connection(), req->msg,\n\t\t\t\t&req->call, REQUEST_TIMEOUT) == FALSE) {\n\t\terror(\"D-Bus send failed\");\n\t\treturn -EIO;\n\t}\n\n\tdbus_pending_call_set_notify(req->call, display_pincode_reply,\n\t\t\t\t\t\t\t\treq, NULL);\n\n\treturn 0;\n}",
    "includes": [
      "#include \"shared/queue.h\"",
      "#include \"agent.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"dbus-common.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/socket.h>",
      "#include <stdbool.h>",
      "#include <stdlib.h>",
      "#include <errno.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define AGENT_INTERFACE \"org.bluez.Agent1\"",
      "#define REQUEST_TIMEOUT (60 * 1000)\t\t/* 60 seconds */"
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "dbus_pending_call_set_notify",
          "args": [
            "req->call",
            "display_pincode_reply",
            "req",
            "NULL"
          ],
          "line": 864
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"D-Bus send failed\""
          ],
          "line": 860
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_not_ready",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "118-122",
          "snippet": "DBusMessage *btd_error_not_ready(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".NotReady\",\n\t\t\t\t\t\"Resource Not Ready\");\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_not_ready(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".NotReady\",\n\t\t\t\t\t\"Resource Not Ready\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_dbus_send_message_with_reply",
          "args": [
            "btd_get_dbus_connection()",
            "req->msg",
            "&req->call",
            "REQUEST_TIMEOUT"
          ],
          "line": 858
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_get_dbus_connection",
          "args": [],
          "line": 858
        },
        "resolved": true,
        "details": {
          "function_name": "btd_get_dbus_connection",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/dbus-common.c",
          "lines": "61-64",
          "snippet": "DBusConnection *btd_get_dbus_connection(void)\n{\n\treturn connection;\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <stdint.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static DBusConnection *connection = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <stdint.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *connection = NULL;\n\nDBusConnection *btd_get_dbus_connection(void)\n{\n\treturn connection;\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_message_append_args",
          "args": [
            "req->msg",
            "DBUS_TYPE_OBJECT_PATH",
            "&device_path",
            "DBUS_TYPE_STRING",
            "&pincode",
            "DBUS_TYPE_INVALID"
          ],
          "line": 853
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_new_method_call",
          "args": [
            "agent->owner",
            "agent->path",
            "AGENT_INTERFACE",
            "\"DisplayPinCode\""
          ],
          "line": 846
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"shared/queue.h\"\n#include \"agent.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"dbus-common.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <sys/ioctl.h>\n#include <sys/socket.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\n#define AGENT_INTERFACE \"org.bluez.Agent1\"\n#define REQUEST_TIMEOUT (60 * 1000)\t\t/* 60 seconds */\n\nstatic int display_pincode_request_new(struct agent_request *req,\n\t\t\t\t\tconst char *device_path,\n\t\t\t\t\tconst char *pincode)\n{\n\tstruct agent *agent = req->agent;\n\n\treq->msg = dbus_message_new_method_call(agent->owner, agent->path,\n\t\t\t\t\tAGENT_INTERFACE, \"DisplayPinCode\");\n\tif (req->msg == NULL) {\n\t\terror(\"Couldn't allocate D-Bus message\");\n\t\treturn -ENOMEM;\n\t}\n\n\tdbus_message_append_args(req->msg,\n\t\t\t\t\tDBUS_TYPE_OBJECT_PATH, &device_path,\n\t\t\t\t\tDBUS_TYPE_STRING, &pincode,\n\t\t\t\t\tDBUS_TYPE_INVALID);\n\n\tif (g_dbus_send_message_with_reply(btd_get_dbus_connection(), req->msg,\n\t\t\t\t&req->call, REQUEST_TIMEOUT) == FALSE) {\n\t\terror(\"D-Bus send failed\");\n\t\treturn -EIO;\n\t}\n\n\tdbus_pending_call_set_notify(req->call, display_pincode_reply,\n\t\t\t\t\t\t\t\treq, NULL);\n\n\treturn 0;\n}"
  },
  {
    "function_name": "display_pincode_reply",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/agent.c",
    "lines": "792-838",
    "snippet": "static void display_pincode_reply(DBusPendingCall *call, void *user_data)\n{\n\tstruct agent_request *req = user_data;\n\tstruct agent *agent = req->agent;\n\tDBusMessage *message;\n\tDBusError err;\n\tagent_cb cb = req->cb;\n\n\t/* clear agent->request early; our callback will likely try\n\t * another request */\n\tagent->request = NULL;\n\n\t/* steal_reply will always return non-NULL since the callback\n\t * is only called after a reply has been received */\n\tmessage = dbus_pending_call_steal_reply(call);\n\n\tdbus_error_init(&err);\n\tif (dbus_set_error_from_message(&err, message)) {\n\t\terror(\"Agent replied with an error: %s, %s\",\n\t\t\t\t\t\terr.name, err.message);\n\n\t\tcb(agent, &err, req->user_data);\n\n\t\tif (dbus_error_has_name(&err, DBUS_ERROR_NO_REPLY)) {\n\t\t\tagent_cancel(agent);\n\t\t\tdbus_message_unref(message);\n\t\t\tdbus_error_free(&err);\n\t\t\treturn;\n\t\t}\n\n\t\tdbus_error_free(&err);\n\t\tgoto done;\n\t}\n\n\tif (!dbus_message_get_args(message, &err, DBUS_TYPE_INVALID)) {\n\t\terror(\"Wrong reply signature: %s\", err.message);\n\t\tcb(agent, &err, req->user_data);\n\t\tdbus_error_free(&err);\n\t\tgoto done;\n\t}\n\n\tcb(agent, NULL, req->user_data);\ndone:\n\tdbus_message_unref(message);\n\n\tagent_request_free(req, TRUE);\n}",
    "includes": [
      "#include \"shared/queue.h\"",
      "#include \"agent.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"dbus-common.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/socket.h>",
      "#include <stdbool.h>",
      "#include <stdlib.h>",
      "#include <errno.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "agent_request_free",
          "args": [
            "req",
            "TRUE"
          ],
          "line": 837
        },
        "resolved": true,
        "details": {
          "function_name": "agent_request_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/agent.c",
          "lines": "125-136",
          "snippet": "static void agent_request_free(struct agent_request *req, gboolean destroy)\n{\n\tif (req->msg)\n\t\tdbus_message_unref(req->msg);\n\tif (req->call)\n\t\tdbus_pending_call_unref(req->call);\n\tif (req->agent && req->agent->request)\n\t\treq->agent->request = NULL;\n\tif (destroy && req->destroy)\n\t\treq->destroy(req->user_data);\n\tg_free(req);\n}",
          "includes": [
            "#include \"shared/queue.h\"",
            "#include \"agent.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"dbus-common.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/socket.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"shared/queue.h\"\n#include \"agent.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"dbus-common.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <sys/ioctl.h>\n#include <sys/socket.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void agent_request_free(struct agent_request *req, gboolean destroy)\n{\n\tif (req->msg)\n\t\tdbus_message_unref(req->msg);\n\tif (req->call)\n\t\tdbus_pending_call_unref(req->call);\n\tif (req->agent && req->agent->request)\n\t\treq->agent->request = NULL;\n\tif (destroy && req->destroy)\n\t\treq->destroy(req->user_data);\n\tg_free(req);\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_message_unref",
          "args": [
            "message"
          ],
          "line": 835
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "cb",
          "args": [
            "agent",
            "NULL",
            "req->user_data"
          ],
          "line": 833
        },
        "resolved": true,
        "details": {
          "function_name": "channel_watch_cb",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/attrib-server.c",
          "lines": "981-987",
          "snippet": "static gboolean channel_watch_cb(GIOChannel *io, GIOCondition cond,\n\t\t\t\t\t\tgpointer user_data)\n{\n\tchannel_remove(user_data);\n\n\treturn FALSE;\n}",
          "includes": [
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"attrib/att-database.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"backtrace.h\"",
            "#include \"log.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <sys/stat.h>",
            "#include <glib.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdbool.h>",
            "#include <stdint.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"attrib/att-database.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"src/shared/util.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <sys/stat.h>\n#include <glib.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdbool.h>\n#include <stdint.h>\n#include <errno.h>\n#include <config.h>\n\nstatic gboolean channel_watch_cb(GIOChannel *io, GIOCondition cond,\n\t\t\t\t\t\tgpointer user_data)\n{\n\tchannel_remove(user_data);\n\n\treturn FALSE;\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_error_free",
          "args": [
            "&err"
          ],
          "line": 829
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"Wrong reply signature: %s\"",
            "err.message"
          ],
          "line": 827
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_failed",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "124-128",
          "snippet": "DBusMessage *btd_error_failed(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE\n\t\t\t\t\t\".Failed\", \"%s\", str);\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_failed(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE\n\t\t\t\t\t\".Failed\", \"%s\", str);\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_message_get_args",
          "args": [
            "message",
            "&err",
            "DBUS_TYPE_INVALID"
          ],
          "line": 826
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_error_free",
          "args": [
            "&err"
          ],
          "line": 822
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_error_free",
          "args": [
            "&err"
          ],
          "line": 818
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_unref",
          "args": [
            "message"
          ],
          "line": 817
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "agent_cancel",
          "args": [
            "agent"
          ],
          "line": 816
        },
        "resolved": true,
        "details": {
          "function_name": "agent_cancel",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/agent.c",
          "lines": "317-331",
          "snippet": "int agent_cancel(struct agent *agent)\n{\n\tif (!agent->request)\n\t\treturn -EINVAL;\n\n\tif (agent->request->call) {\n\t\tdbus_pending_call_cancel(agent->request->call);\n\t\tsend_cancel_request(agent->request);\n\t}\n\n\tagent_request_free(agent->request, TRUE);\n\tagent->request = NULL;\n\n\treturn 0;\n}",
          "includes": [
            "#include \"shared/queue.h\"",
            "#include \"agent.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"dbus-common.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/socket.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"shared/queue.h\"\n#include \"agent.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"dbus-common.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <sys/ioctl.h>\n#include <sys/socket.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nint agent_cancel(struct agent *agent)\n{\n\tif (!agent->request)\n\t\treturn -EINVAL;\n\n\tif (agent->request->call) {\n\t\tdbus_pending_call_cancel(agent->request->call);\n\t\tsend_cancel_request(agent->request);\n\t}\n\n\tagent_request_free(agent->request, TRUE);\n\tagent->request = NULL;\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_error_has_name",
          "args": [
            "&err",
            "DBUS_ERROR_NO_REPLY"
          ],
          "line": 815
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"Agent replied with an error: %s, %s\"",
            "err.name",
            "err.message"
          ],
          "line": 810
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/log.c",
          "lines": "199-213",
          "snippet": "void btd_error(uint16_t index, const char *format, ...)\n{\n\tva_list ap;\n\n\tva_start(ap, format);\n\tvsyslog(LOG_ERR, format, ap);\n\tva_end(ap);\n\n\tif (logging_fd < 0)\n\t\treturn;\n\n\tva_start(ap, format);\n\tlogging_log(index, LOG_ERR, format, ap);\n\tva_end(ap);\n}",
          "includes": [
            "#include \"log.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/hci.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <sys/socket.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <stdarg.h>",
            "#include <syslog.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int logging_fd = -1;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n#include \"src/shared/util.h\"\n#include \"lib/hci.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <sys/socket.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdarg.h>\n#include <syslog.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic int logging_fd = -1;\n\nvoid btd_error(uint16_t index, const char *format, ...)\n{\n\tva_list ap;\n\n\tva_start(ap, format);\n\tvsyslog(LOG_ERR, format, ap);\n\tva_end(ap);\n\n\tif (logging_fd < 0)\n\t\treturn;\n\n\tva_start(ap, format);\n\tlogging_log(index, LOG_ERR, format, ap);\n\tva_end(ap);\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_set_error_from_message",
          "args": [
            "&err",
            "message"
          ],
          "line": 809
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_error_init",
          "args": [
            "&err"
          ],
          "line": 808
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_pending_call_steal_reply",
          "args": [
            "call"
          ],
          "line": 806
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"shared/queue.h\"\n#include \"agent.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"dbus-common.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <sys/ioctl.h>\n#include <sys/socket.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void display_pincode_reply(DBusPendingCall *call, void *user_data)\n{\n\tstruct agent_request *req = user_data;\n\tstruct agent *agent = req->agent;\n\tDBusMessage *message;\n\tDBusError err;\n\tagent_cb cb = req->cb;\n\n\t/* clear agent->request early; our callback will likely try\n\t * another request */\n\tagent->request = NULL;\n\n\t/* steal_reply will always return non-NULL since the callback\n\t * is only called after a reply has been received */\n\tmessage = dbus_pending_call_steal_reply(call);\n\n\tdbus_error_init(&err);\n\tif (dbus_set_error_from_message(&err, message)) {\n\t\terror(\"Agent replied with an error: %s, %s\",\n\t\t\t\t\t\terr.name, err.message);\n\n\t\tcb(agent, &err, req->user_data);\n\n\t\tif (dbus_error_has_name(&err, DBUS_ERROR_NO_REPLY)) {\n\t\t\tagent_cancel(agent);\n\t\t\tdbus_message_unref(message);\n\t\t\tdbus_error_free(&err);\n\t\t\treturn;\n\t\t}\n\n\t\tdbus_error_free(&err);\n\t\tgoto done;\n\t}\n\n\tif (!dbus_message_get_args(message, &err, DBUS_TYPE_INVALID)) {\n\t\terror(\"Wrong reply signature: %s\", err.message);\n\t\tcb(agent, &err, req->user_data);\n\t\tdbus_error_free(&err);\n\t\tgoto done;\n\t}\n\n\tcb(agent, NULL, req->user_data);\ndone:\n\tdbus_message_unref(message);\n\n\tagent_request_free(req, TRUE);\n}"
  },
  {
    "function_name": "agent_display_passkey",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/agent.c",
    "lines": "765-790",
    "snippet": "int agent_display_passkey(struct agent *agent, struct btd_device *device,\n\t\t\t\tuint32_t passkey, uint16_t entered)\n{\n\tDBusMessage *message;\n\tconst char *dev_path = device_get_path(device);\n\n\tmessage = dbus_message_new_method_call(agent->owner, agent->path,\n\t\t\t\t\tAGENT_INTERFACE, \"DisplayPasskey\");\n\tif (!message) {\n\t\terror(\"Couldn't allocate D-Bus message\");\n\t\treturn -1;\n\t}\n\n\tdbus_message_append_args(message,\n\t\t\t\tDBUS_TYPE_OBJECT_PATH, &dev_path,\n\t\t\t\tDBUS_TYPE_UINT32, &passkey,\n\t\t\t\tDBUS_TYPE_UINT16, &entered,\n\t\t\t\tDBUS_TYPE_INVALID);\n\n\tif (!g_dbus_send_message(btd_get_dbus_connection(), message)) {\n\t\terror(\"D-Bus send failed\");\n\t\treturn -1;\n\t}\n\n\treturn 0;\n}",
    "includes": [
      "#include \"shared/queue.h\"",
      "#include \"agent.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"dbus-common.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/socket.h>",
      "#include <stdbool.h>",
      "#include <stdlib.h>",
      "#include <errno.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define AGENT_INTERFACE \"org.bluez.Agent1\""
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"D-Bus send failed\""
          ],
          "line": 785
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_not_ready",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "118-122",
          "snippet": "DBusMessage *btd_error_not_ready(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".NotReady\",\n\t\t\t\t\t\"Resource Not Ready\");\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_not_ready(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".NotReady\",\n\t\t\t\t\t\"Resource Not Ready\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_dbus_send_message",
          "args": [
            "btd_get_dbus_connection()",
            "message"
          ],
          "line": 784
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_get_dbus_connection",
          "args": [],
          "line": 784
        },
        "resolved": true,
        "details": {
          "function_name": "btd_get_dbus_connection",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/dbus-common.c",
          "lines": "61-64",
          "snippet": "DBusConnection *btd_get_dbus_connection(void)\n{\n\treturn connection;\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <stdint.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static DBusConnection *connection = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <stdint.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *connection = NULL;\n\nDBusConnection *btd_get_dbus_connection(void)\n{\n\treturn connection;\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_message_append_args",
          "args": [
            "message",
            "DBUS_TYPE_OBJECT_PATH",
            "&dev_path",
            "DBUS_TYPE_UINT32",
            "&passkey",
            "DBUS_TYPE_UINT16",
            "&entered",
            "DBUS_TYPE_INVALID"
          ],
          "line": 778
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_new_method_call",
          "args": [
            "agent->owner",
            "agent->path",
            "AGENT_INTERFACE",
            "\"DisplayPasskey\""
          ],
          "line": 771
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "device_get_path",
          "args": [
            "device"
          ],
          "line": 769
        },
        "resolved": true,
        "details": {
          "function_name": "device_get_path",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "5323-5329",
          "snippet": "const char *device_get_path(const struct btd_device *device)\n{\n\tif (!device)\n\t\treturn NULL;\n\n\treturn device->path;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nconst char *device_get_path(const struct btd_device *device)\n{\n\tif (!device)\n\t\treturn NULL;\n\n\treturn device->path;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"shared/queue.h\"\n#include \"agent.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"dbus-common.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <sys/ioctl.h>\n#include <sys/socket.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\n#define AGENT_INTERFACE \"org.bluez.Agent1\"\n\nint agent_display_passkey(struct agent *agent, struct btd_device *device,\n\t\t\t\tuint32_t passkey, uint16_t entered)\n{\n\tDBusMessage *message;\n\tconst char *dev_path = device_get_path(device);\n\n\tmessage = dbus_message_new_method_call(agent->owner, agent->path,\n\t\t\t\t\tAGENT_INTERFACE, \"DisplayPasskey\");\n\tif (!message) {\n\t\terror(\"Couldn't allocate D-Bus message\");\n\t\treturn -1;\n\t}\n\n\tdbus_message_append_args(message,\n\t\t\t\tDBUS_TYPE_OBJECT_PATH, &dev_path,\n\t\t\t\tDBUS_TYPE_UINT32, &passkey,\n\t\t\t\tDBUS_TYPE_UINT16, &entered,\n\t\t\t\tDBUS_TYPE_INVALID);\n\n\tif (!g_dbus_send_message(btd_get_dbus_connection(), message)) {\n\t\terror(\"D-Bus send failed\");\n\t\treturn -1;\n\t}\n\n\treturn 0;\n}"
  },
  {
    "function_name": "agent_request_authorization",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/agent.c",
    "lines": "735-763",
    "snippet": "int agent_request_authorization(struct agent *agent, struct btd_device *device,\n\t\t\t\t\t\tagent_cb cb, void *user_data,\n\t\t\t\t\t\tGDestroyNotify destroy)\n{\n\tstruct agent_request *req;\n\tconst char *dev_path = device_get_path(device);\n\tint err;\n\n\tif (agent->request)\n\t\treturn -EBUSY;\n\n\tDBG(\"Calling Agent.RequestAuthorization: name=%s, path=%s\",\n\t\t\t\t\t\tagent->owner, agent->path);\n\n\treq = agent_request_new(agent, AGENT_REQUEST_AUTHORIZATION, cb,\n\t\t\t\tuser_data, destroy);\n\n\terr = authorization_request_new(req, dev_path);\n\tif (err < 0)\n\t\tgoto failed;\n\n\tagent->request = req;\n\n\treturn 0;\n\nfailed:\n\tagent_request_free(req, FALSE);\n\treturn err;\n}",
    "includes": [
      "#include \"shared/queue.h\"",
      "#include \"agent.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"dbus-common.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/socket.h>",
      "#include <stdbool.h>",
      "#include <stdlib.h>",
      "#include <errno.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "agent_request_free",
          "args": [
            "req",
            "FALSE"
          ],
          "line": 761
        },
        "resolved": true,
        "details": {
          "function_name": "agent_request_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/agent.c",
          "lines": "125-136",
          "snippet": "static void agent_request_free(struct agent_request *req, gboolean destroy)\n{\n\tif (req->msg)\n\t\tdbus_message_unref(req->msg);\n\tif (req->call)\n\t\tdbus_pending_call_unref(req->call);\n\tif (req->agent && req->agent->request)\n\t\treq->agent->request = NULL;\n\tif (destroy && req->destroy)\n\t\treq->destroy(req->user_data);\n\tg_free(req);\n}",
          "includes": [
            "#include \"shared/queue.h\"",
            "#include \"agent.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"dbus-common.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/socket.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"shared/queue.h\"\n#include \"agent.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"dbus-common.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <sys/ioctl.h>\n#include <sys/socket.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void agent_request_free(struct agent_request *req, gboolean destroy)\n{\n\tif (req->msg)\n\t\tdbus_message_unref(req->msg);\n\tif (req->call)\n\t\tdbus_pending_call_unref(req->call);\n\tif (req->agent && req->agent->request)\n\t\treq->agent->request = NULL;\n\tif (destroy && req->destroy)\n\t\treq->destroy(req->user_data);\n\tg_free(req);\n}"
        }
      },
      {
        "call_info": {
          "callee": "authorization_request_new",
          "args": [
            "req",
            "dev_path"
          ],
          "line": 752
        },
        "resolved": true,
        "details": {
          "function_name": "authorization_request_new",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/agent.c",
          "lines": "708-733",
          "snippet": "static int authorization_request_new(struct agent_request *req,\n\t\t\t\t\t\tconst char *device_path)\n{\n\tstruct agent *agent = req->agent;\n\n\treq->msg = dbus_message_new_method_call(agent->owner, agent->path,\n\t\t\t\tAGENT_INTERFACE, \"RequestAuthorization\");\n\tif (req->msg == NULL) {\n\t\terror(\"Couldn't allocate D-Bus message\");\n\t\treturn -ENOMEM;\n\t}\n\n\tdbus_message_append_args(req->msg,\n\t\t\t\tDBUS_TYPE_OBJECT_PATH, &device_path,\n\t\t\t\tDBUS_TYPE_INVALID);\n\n\tif (g_dbus_send_message_with_reply(btd_get_dbus_connection(), req->msg,\n\t\t\t\t&req->call, REQUEST_TIMEOUT) == FALSE) {\n\t\terror(\"D-Bus send failed\");\n\t\treturn -EIO;\n\t}\n\n\tdbus_pending_call_set_notify(req->call, simple_agent_reply, req, NULL);\n\n\treturn 0;\n}",
          "includes": [
            "#include \"shared/queue.h\"",
            "#include \"agent.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"dbus-common.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/socket.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define AGENT_INTERFACE \"org.bluez.Agent1\"",
            "#define REQUEST_TIMEOUT (60 * 1000)\t\t/* 60 seconds */"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"shared/queue.h\"\n#include \"agent.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"dbus-common.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <sys/ioctl.h>\n#include <sys/socket.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\n#define AGENT_INTERFACE \"org.bluez.Agent1\"\n#define REQUEST_TIMEOUT (60 * 1000)\t\t/* 60 seconds */\n\nstatic int authorization_request_new(struct agent_request *req,\n\t\t\t\t\t\tconst char *device_path)\n{\n\tstruct agent *agent = req->agent;\n\n\treq->msg = dbus_message_new_method_call(agent->owner, agent->path,\n\t\t\t\tAGENT_INTERFACE, \"RequestAuthorization\");\n\tif (req->msg == NULL) {\n\t\terror(\"Couldn't allocate D-Bus message\");\n\t\treturn -ENOMEM;\n\t}\n\n\tdbus_message_append_args(req->msg,\n\t\t\t\tDBUS_TYPE_OBJECT_PATH, &device_path,\n\t\t\t\tDBUS_TYPE_INVALID);\n\n\tif (g_dbus_send_message_with_reply(btd_get_dbus_connection(), req->msg,\n\t\t\t\t&req->call, REQUEST_TIMEOUT) == FALSE) {\n\t\terror(\"D-Bus send failed\");\n\t\treturn -EIO;\n\t}\n\n\tdbus_pending_call_set_notify(req->call, simple_agent_reply, req, NULL);\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "agent_request_new",
          "args": [
            "agent",
            "AGENT_REQUEST_AUTHORIZATION",
            "cb",
            "user_data",
            "destroy"
          ],
          "line": 749
        },
        "resolved": true,
        "details": {
          "function_name": "agent_request_new",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/agent.c",
          "lines": "298-315",
          "snippet": "static struct agent_request *agent_request_new(struct agent *agent,\n\t\t\t\t\t\tagent_request_type_t type,\n\t\t\t\t\t\tvoid *cb,\n\t\t\t\t\t\tvoid *user_data,\n\t\t\t\t\t\tGDestroyNotify destroy)\n{\n\tstruct agent_request *req;\n\n\treq = g_new0(struct agent_request, 1);\n\n\treq->agent = agent;\n\treq->type = type;\n\treq->cb = cb;\n\treq->user_data = user_data;\n\treq->destroy = destroy;\n\n\treturn req;\n}",
          "includes": [
            "#include \"shared/queue.h\"",
            "#include \"agent.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"dbus-common.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/socket.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"shared/queue.h\"\n#include \"agent.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"dbus-common.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <sys/ioctl.h>\n#include <sys/socket.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic struct agent_request *agent_request_new(struct agent *agent,\n\t\t\t\t\t\tagent_request_type_t type,\n\t\t\t\t\t\tvoid *cb,\n\t\t\t\t\t\tvoid *user_data,\n\t\t\t\t\t\tGDestroyNotify destroy)\n{\n\tstruct agent_request *req;\n\n\treq = g_new0(struct agent_request, 1);\n\n\treq->agent = agent;\n\treq->type = type;\n\treq->cb = cb;\n\treq->user_data = user_data;\n\treq->destroy = destroy;\n\n\treturn req;\n}"
        }
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"Calling Agent.RequestAuthorization: name=%s, path=%s\"",
            "agent->owner",
            "agent->path"
          ],
          "line": 746
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "device_get_path",
          "args": [
            "device"
          ],
          "line": 740
        },
        "resolved": true,
        "details": {
          "function_name": "device_get_path",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "5323-5329",
          "snippet": "const char *device_get_path(const struct btd_device *device)\n{\n\tif (!device)\n\t\treturn NULL;\n\n\treturn device->path;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nconst char *device_get_path(const struct btd_device *device)\n{\n\tif (!device)\n\t\treturn NULL;\n\n\treturn device->path;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"shared/queue.h\"\n#include \"agent.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"dbus-common.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <sys/ioctl.h>\n#include <sys/socket.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nint agent_request_authorization(struct agent *agent, struct btd_device *device,\n\t\t\t\t\t\tagent_cb cb, void *user_data,\n\t\t\t\t\t\tGDestroyNotify destroy)\n{\n\tstruct agent_request *req;\n\tconst char *dev_path = device_get_path(device);\n\tint err;\n\n\tif (agent->request)\n\t\treturn -EBUSY;\n\n\tDBG(\"Calling Agent.RequestAuthorization: name=%s, path=%s\",\n\t\t\t\t\t\tagent->owner, agent->path);\n\n\treq = agent_request_new(agent, AGENT_REQUEST_AUTHORIZATION, cb,\n\t\t\t\tuser_data, destroy);\n\n\terr = authorization_request_new(req, dev_path);\n\tif (err < 0)\n\t\tgoto failed;\n\n\tagent->request = req;\n\n\treturn 0;\n\nfailed:\n\tagent_request_free(req, FALSE);\n\treturn err;\n}"
  },
  {
    "function_name": "authorization_request_new",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/agent.c",
    "lines": "708-733",
    "snippet": "static int authorization_request_new(struct agent_request *req,\n\t\t\t\t\t\tconst char *device_path)\n{\n\tstruct agent *agent = req->agent;\n\n\treq->msg = dbus_message_new_method_call(agent->owner, agent->path,\n\t\t\t\tAGENT_INTERFACE, \"RequestAuthorization\");\n\tif (req->msg == NULL) {\n\t\terror(\"Couldn't allocate D-Bus message\");\n\t\treturn -ENOMEM;\n\t}\n\n\tdbus_message_append_args(req->msg,\n\t\t\t\tDBUS_TYPE_OBJECT_PATH, &device_path,\n\t\t\t\tDBUS_TYPE_INVALID);\n\n\tif (g_dbus_send_message_with_reply(btd_get_dbus_connection(), req->msg,\n\t\t\t\t&req->call, REQUEST_TIMEOUT) == FALSE) {\n\t\terror(\"D-Bus send failed\");\n\t\treturn -EIO;\n\t}\n\n\tdbus_pending_call_set_notify(req->call, simple_agent_reply, req, NULL);\n\n\treturn 0;\n}",
    "includes": [
      "#include \"shared/queue.h\"",
      "#include \"agent.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"dbus-common.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/socket.h>",
      "#include <stdbool.h>",
      "#include <stdlib.h>",
      "#include <errno.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define AGENT_INTERFACE \"org.bluez.Agent1\"",
      "#define REQUEST_TIMEOUT (60 * 1000)\t\t/* 60 seconds */"
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "dbus_pending_call_set_notify",
          "args": [
            "req->call",
            "simple_agent_reply",
            "req",
            "NULL"
          ],
          "line": 730
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"D-Bus send failed\""
          ],
          "line": 726
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_not_ready",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "118-122",
          "snippet": "DBusMessage *btd_error_not_ready(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".NotReady\",\n\t\t\t\t\t\"Resource Not Ready\");\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_not_ready(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".NotReady\",\n\t\t\t\t\t\"Resource Not Ready\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_dbus_send_message_with_reply",
          "args": [
            "btd_get_dbus_connection()",
            "req->msg",
            "&req->call",
            "REQUEST_TIMEOUT"
          ],
          "line": 724
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_get_dbus_connection",
          "args": [],
          "line": 724
        },
        "resolved": true,
        "details": {
          "function_name": "btd_get_dbus_connection",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/dbus-common.c",
          "lines": "61-64",
          "snippet": "DBusConnection *btd_get_dbus_connection(void)\n{\n\treturn connection;\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <stdint.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static DBusConnection *connection = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <stdint.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *connection = NULL;\n\nDBusConnection *btd_get_dbus_connection(void)\n{\n\treturn connection;\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_message_append_args",
          "args": [
            "req->msg",
            "DBUS_TYPE_OBJECT_PATH",
            "&device_path",
            "DBUS_TYPE_INVALID"
          ],
          "line": 720
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_new_method_call",
          "args": [
            "agent->owner",
            "agent->path",
            "AGENT_INTERFACE",
            "\"RequestAuthorization\""
          ],
          "line": 713
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"shared/queue.h\"\n#include \"agent.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"dbus-common.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <sys/ioctl.h>\n#include <sys/socket.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\n#define AGENT_INTERFACE \"org.bluez.Agent1\"\n#define REQUEST_TIMEOUT (60 * 1000)\t\t/* 60 seconds */\n\nstatic int authorization_request_new(struct agent_request *req,\n\t\t\t\t\t\tconst char *device_path)\n{\n\tstruct agent *agent = req->agent;\n\n\treq->msg = dbus_message_new_method_call(agent->owner, agent->path,\n\t\t\t\tAGENT_INTERFACE, \"RequestAuthorization\");\n\tif (req->msg == NULL) {\n\t\terror(\"Couldn't allocate D-Bus message\");\n\t\treturn -ENOMEM;\n\t}\n\n\tdbus_message_append_args(req->msg,\n\t\t\t\tDBUS_TYPE_OBJECT_PATH, &device_path,\n\t\t\t\tDBUS_TYPE_INVALID);\n\n\tif (g_dbus_send_message_with_reply(btd_get_dbus_connection(), req->msg,\n\t\t\t\t&req->call, REQUEST_TIMEOUT) == FALSE) {\n\t\terror(\"D-Bus send failed\");\n\t\treturn -EIO;\n\t}\n\n\tdbus_pending_call_set_notify(req->call, simple_agent_reply, req, NULL);\n\n\treturn 0;\n}"
  },
  {
    "function_name": "agent_request_confirmation",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/agent.c",
    "lines": "678-706",
    "snippet": "int agent_request_confirmation(struct agent *agent, struct btd_device *device,\n\t\t\t\tuint32_t passkey, agent_cb cb,\n\t\t\t\tvoid *user_data, GDestroyNotify destroy)\n{\n\tstruct agent_request *req;\n\tconst char *dev_path = device_get_path(device);\n\tint err;\n\n\tif (agent->request)\n\t\treturn -EBUSY;\n\n\tDBG(\"Calling Agent.RequestConfirmation: name=%s, path=%s, passkey=%06u\",\n\t\t\tagent->owner, agent->path, passkey);\n\n\treq = agent_request_new(agent, AGENT_REQUEST_CONFIRMATION, cb,\n\t\t\t\tuser_data, destroy);\n\n\terr = confirmation_request_new(req, dev_path, passkey);\n\tif (err < 0)\n\t\tgoto failed;\n\n\tagent->request = req;\n\n\treturn 0;\n\nfailed:\n\tagent_request_free(req, FALSE);\n\treturn err;\n}",
    "includes": [
      "#include \"shared/queue.h\"",
      "#include \"agent.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"dbus-common.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/socket.h>",
      "#include <stdbool.h>",
      "#include <stdlib.h>",
      "#include <errno.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "agent_request_free",
          "args": [
            "req",
            "FALSE"
          ],
          "line": 704
        },
        "resolved": true,
        "details": {
          "function_name": "agent_request_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/agent.c",
          "lines": "125-136",
          "snippet": "static void agent_request_free(struct agent_request *req, gboolean destroy)\n{\n\tif (req->msg)\n\t\tdbus_message_unref(req->msg);\n\tif (req->call)\n\t\tdbus_pending_call_unref(req->call);\n\tif (req->agent && req->agent->request)\n\t\treq->agent->request = NULL;\n\tif (destroy && req->destroy)\n\t\treq->destroy(req->user_data);\n\tg_free(req);\n}",
          "includes": [
            "#include \"shared/queue.h\"",
            "#include \"agent.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"dbus-common.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/socket.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"shared/queue.h\"\n#include \"agent.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"dbus-common.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <sys/ioctl.h>\n#include <sys/socket.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void agent_request_free(struct agent_request *req, gboolean destroy)\n{\n\tif (req->msg)\n\t\tdbus_message_unref(req->msg);\n\tif (req->call)\n\t\tdbus_pending_call_unref(req->call);\n\tif (req->agent && req->agent->request)\n\t\treq->agent->request = NULL;\n\tif (destroy && req->destroy)\n\t\treq->destroy(req->user_data);\n\tg_free(req);\n}"
        }
      },
      {
        "call_info": {
          "callee": "confirmation_request_new",
          "args": [
            "req",
            "dev_path",
            "passkey"
          ],
          "line": 695
        },
        "resolved": true,
        "details": {
          "function_name": "confirmation_request_new",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/agent.c",
          "lines": "649-676",
          "snippet": "static int confirmation_request_new(struct agent_request *req,\n\t\t\t\t\tconst char *device_path,\n\t\t\t\t\tuint32_t passkey)\n{\n\tstruct agent *agent = req->agent;\n\n\treq->msg = dbus_message_new_method_call(agent->owner, agent->path,\n\t\t\t\tAGENT_INTERFACE, \"RequestConfirmation\");\n\tif (req->msg == NULL) {\n\t\terror(\"Couldn't allocate D-Bus message\");\n\t\treturn -ENOMEM;\n\t}\n\n\tdbus_message_append_args(req->msg,\n\t\t\t\tDBUS_TYPE_OBJECT_PATH, &device_path,\n\t\t\t\tDBUS_TYPE_UINT32, &passkey,\n\t\t\t\tDBUS_TYPE_INVALID);\n\n\tif (g_dbus_send_message_with_reply(btd_get_dbus_connection(), req->msg,\n\t\t\t\t&req->call, REQUEST_TIMEOUT) == FALSE) {\n\t\terror(\"D-Bus send failed\");\n\t\treturn -EIO;\n\t}\n\n\tdbus_pending_call_set_notify(req->call, simple_agent_reply, req, NULL);\n\n\treturn 0;\n}",
          "includes": [
            "#include \"shared/queue.h\"",
            "#include \"agent.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"dbus-common.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/socket.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define AGENT_INTERFACE \"org.bluez.Agent1\"",
            "#define REQUEST_TIMEOUT (60 * 1000)\t\t/* 60 seconds */"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"shared/queue.h\"\n#include \"agent.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"dbus-common.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <sys/ioctl.h>\n#include <sys/socket.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\n#define AGENT_INTERFACE \"org.bluez.Agent1\"\n#define REQUEST_TIMEOUT (60 * 1000)\t\t/* 60 seconds */\n\nstatic int confirmation_request_new(struct agent_request *req,\n\t\t\t\t\tconst char *device_path,\n\t\t\t\t\tuint32_t passkey)\n{\n\tstruct agent *agent = req->agent;\n\n\treq->msg = dbus_message_new_method_call(agent->owner, agent->path,\n\t\t\t\tAGENT_INTERFACE, \"RequestConfirmation\");\n\tif (req->msg == NULL) {\n\t\terror(\"Couldn't allocate D-Bus message\");\n\t\treturn -ENOMEM;\n\t}\n\n\tdbus_message_append_args(req->msg,\n\t\t\t\tDBUS_TYPE_OBJECT_PATH, &device_path,\n\t\t\t\tDBUS_TYPE_UINT32, &passkey,\n\t\t\t\tDBUS_TYPE_INVALID);\n\n\tif (g_dbus_send_message_with_reply(btd_get_dbus_connection(), req->msg,\n\t\t\t\t&req->call, REQUEST_TIMEOUT) == FALSE) {\n\t\terror(\"D-Bus send failed\");\n\t\treturn -EIO;\n\t}\n\n\tdbus_pending_call_set_notify(req->call, simple_agent_reply, req, NULL);\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "agent_request_new",
          "args": [
            "agent",
            "AGENT_REQUEST_CONFIRMATION",
            "cb",
            "user_data",
            "destroy"
          ],
          "line": 692
        },
        "resolved": true,
        "details": {
          "function_name": "agent_request_new",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/agent.c",
          "lines": "298-315",
          "snippet": "static struct agent_request *agent_request_new(struct agent *agent,\n\t\t\t\t\t\tagent_request_type_t type,\n\t\t\t\t\t\tvoid *cb,\n\t\t\t\t\t\tvoid *user_data,\n\t\t\t\t\t\tGDestroyNotify destroy)\n{\n\tstruct agent_request *req;\n\n\treq = g_new0(struct agent_request, 1);\n\n\treq->agent = agent;\n\treq->type = type;\n\treq->cb = cb;\n\treq->user_data = user_data;\n\treq->destroy = destroy;\n\n\treturn req;\n}",
          "includes": [
            "#include \"shared/queue.h\"",
            "#include \"agent.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"dbus-common.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/socket.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"shared/queue.h\"\n#include \"agent.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"dbus-common.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <sys/ioctl.h>\n#include <sys/socket.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic struct agent_request *agent_request_new(struct agent *agent,\n\t\t\t\t\t\tagent_request_type_t type,\n\t\t\t\t\t\tvoid *cb,\n\t\t\t\t\t\tvoid *user_data,\n\t\t\t\t\t\tGDestroyNotify destroy)\n{\n\tstruct agent_request *req;\n\n\treq = g_new0(struct agent_request, 1);\n\n\treq->agent = agent;\n\treq->type = type;\n\treq->cb = cb;\n\treq->user_data = user_data;\n\treq->destroy = destroy;\n\n\treturn req;\n}"
        }
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"Calling Agent.RequestConfirmation: name=%s, path=%s, passkey=%06u\"",
            "agent->owner",
            "agent->path",
            "passkey"
          ],
          "line": 689
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "device_get_path",
          "args": [
            "device"
          ],
          "line": 683
        },
        "resolved": true,
        "details": {
          "function_name": "device_get_path",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "5323-5329",
          "snippet": "const char *device_get_path(const struct btd_device *device)\n{\n\tif (!device)\n\t\treturn NULL;\n\n\treturn device->path;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nconst char *device_get_path(const struct btd_device *device)\n{\n\tif (!device)\n\t\treturn NULL;\n\n\treturn device->path;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"shared/queue.h\"\n#include \"agent.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"dbus-common.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <sys/ioctl.h>\n#include <sys/socket.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nint agent_request_confirmation(struct agent *agent, struct btd_device *device,\n\t\t\t\tuint32_t passkey, agent_cb cb,\n\t\t\t\tvoid *user_data, GDestroyNotify destroy)\n{\n\tstruct agent_request *req;\n\tconst char *dev_path = device_get_path(device);\n\tint err;\n\n\tif (agent->request)\n\t\treturn -EBUSY;\n\n\tDBG(\"Calling Agent.RequestConfirmation: name=%s, path=%s, passkey=%06u\",\n\t\t\tagent->owner, agent->path, passkey);\n\n\treq = agent_request_new(agent, AGENT_REQUEST_CONFIRMATION, cb,\n\t\t\t\tuser_data, destroy);\n\n\terr = confirmation_request_new(req, dev_path, passkey);\n\tif (err < 0)\n\t\tgoto failed;\n\n\tagent->request = req;\n\n\treturn 0;\n\nfailed:\n\tagent_request_free(req, FALSE);\n\treturn err;\n}"
  },
  {
    "function_name": "confirmation_request_new",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/agent.c",
    "lines": "649-676",
    "snippet": "static int confirmation_request_new(struct agent_request *req,\n\t\t\t\t\tconst char *device_path,\n\t\t\t\t\tuint32_t passkey)\n{\n\tstruct agent *agent = req->agent;\n\n\treq->msg = dbus_message_new_method_call(agent->owner, agent->path,\n\t\t\t\tAGENT_INTERFACE, \"RequestConfirmation\");\n\tif (req->msg == NULL) {\n\t\terror(\"Couldn't allocate D-Bus message\");\n\t\treturn -ENOMEM;\n\t}\n\n\tdbus_message_append_args(req->msg,\n\t\t\t\tDBUS_TYPE_OBJECT_PATH, &device_path,\n\t\t\t\tDBUS_TYPE_UINT32, &passkey,\n\t\t\t\tDBUS_TYPE_INVALID);\n\n\tif (g_dbus_send_message_with_reply(btd_get_dbus_connection(), req->msg,\n\t\t\t\t&req->call, REQUEST_TIMEOUT) == FALSE) {\n\t\terror(\"D-Bus send failed\");\n\t\treturn -EIO;\n\t}\n\n\tdbus_pending_call_set_notify(req->call, simple_agent_reply, req, NULL);\n\n\treturn 0;\n}",
    "includes": [
      "#include \"shared/queue.h\"",
      "#include \"agent.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"dbus-common.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/socket.h>",
      "#include <stdbool.h>",
      "#include <stdlib.h>",
      "#include <errno.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define AGENT_INTERFACE \"org.bluez.Agent1\"",
      "#define REQUEST_TIMEOUT (60 * 1000)\t\t/* 60 seconds */"
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "dbus_pending_call_set_notify",
          "args": [
            "req->call",
            "simple_agent_reply",
            "req",
            "NULL"
          ],
          "line": 673
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"D-Bus send failed\""
          ],
          "line": 669
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_not_ready",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "118-122",
          "snippet": "DBusMessage *btd_error_not_ready(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".NotReady\",\n\t\t\t\t\t\"Resource Not Ready\");\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_not_ready(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".NotReady\",\n\t\t\t\t\t\"Resource Not Ready\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_dbus_send_message_with_reply",
          "args": [
            "btd_get_dbus_connection()",
            "req->msg",
            "&req->call",
            "REQUEST_TIMEOUT"
          ],
          "line": 667
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_get_dbus_connection",
          "args": [],
          "line": 667
        },
        "resolved": true,
        "details": {
          "function_name": "btd_get_dbus_connection",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/dbus-common.c",
          "lines": "61-64",
          "snippet": "DBusConnection *btd_get_dbus_connection(void)\n{\n\treturn connection;\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <stdint.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static DBusConnection *connection = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <stdint.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *connection = NULL;\n\nDBusConnection *btd_get_dbus_connection(void)\n{\n\treturn connection;\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_message_append_args",
          "args": [
            "req->msg",
            "DBUS_TYPE_OBJECT_PATH",
            "&device_path",
            "DBUS_TYPE_UINT32",
            "&passkey",
            "DBUS_TYPE_INVALID"
          ],
          "line": 662
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_new_method_call",
          "args": [
            "agent->owner",
            "agent->path",
            "AGENT_INTERFACE",
            "\"RequestConfirmation\""
          ],
          "line": 655
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"shared/queue.h\"\n#include \"agent.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"dbus-common.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <sys/ioctl.h>\n#include <sys/socket.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\n#define AGENT_INTERFACE \"org.bluez.Agent1\"\n#define REQUEST_TIMEOUT (60 * 1000)\t\t/* 60 seconds */\n\nstatic int confirmation_request_new(struct agent_request *req,\n\t\t\t\t\tconst char *device_path,\n\t\t\t\t\tuint32_t passkey)\n{\n\tstruct agent *agent = req->agent;\n\n\treq->msg = dbus_message_new_method_call(agent->owner, agent->path,\n\t\t\t\tAGENT_INTERFACE, \"RequestConfirmation\");\n\tif (req->msg == NULL) {\n\t\terror(\"Couldn't allocate D-Bus message\");\n\t\treturn -ENOMEM;\n\t}\n\n\tdbus_message_append_args(req->msg,\n\t\t\t\tDBUS_TYPE_OBJECT_PATH, &device_path,\n\t\t\t\tDBUS_TYPE_UINT32, &passkey,\n\t\t\t\tDBUS_TYPE_INVALID);\n\n\tif (g_dbus_send_message_with_reply(btd_get_dbus_connection(), req->msg,\n\t\t\t\t&req->call, REQUEST_TIMEOUT) == FALSE) {\n\t\terror(\"D-Bus send failed\");\n\t\treturn -EIO;\n\t}\n\n\tdbus_pending_call_set_notify(req->call, simple_agent_reply, req, NULL);\n\n\treturn 0;\n}"
  },
  {
    "function_name": "agent_request_passkey",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/agent.c",
    "lines": "619-647",
    "snippet": "int agent_request_passkey(struct agent *agent, struct btd_device *device,\n\t\t\t\tagent_passkey_cb cb, void *user_data,\n\t\t\t\tGDestroyNotify destroy)\n{\n\tstruct agent_request *req;\n\tconst char *dev_path = device_get_path(device);\n\tint err;\n\n\tif (agent->request)\n\t\treturn -EBUSY;\n\n\tDBG(\"Calling Agent.RequestPasskey: name=%s, path=%s\",\n\t\t\tagent->owner, agent->path);\n\n\treq = agent_request_new(agent, AGENT_REQUEST_PASSKEY, cb,\n\t\t\t\t\t\t\tuser_data, destroy);\n\n\terr = passkey_request_new(req, dev_path);\n\tif (err < 0)\n\t\tgoto failed;\n\n\tagent->request = req;\n\n\treturn 0;\n\nfailed:\n\tagent_request_free(req, FALSE);\n\treturn err;\n}",
    "includes": [
      "#include \"shared/queue.h\"",
      "#include \"agent.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"dbus-common.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/socket.h>",
      "#include <stdbool.h>",
      "#include <stdlib.h>",
      "#include <errno.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "agent_request_free",
          "args": [
            "req",
            "FALSE"
          ],
          "line": 645
        },
        "resolved": true,
        "details": {
          "function_name": "agent_request_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/agent.c",
          "lines": "125-136",
          "snippet": "static void agent_request_free(struct agent_request *req, gboolean destroy)\n{\n\tif (req->msg)\n\t\tdbus_message_unref(req->msg);\n\tif (req->call)\n\t\tdbus_pending_call_unref(req->call);\n\tif (req->agent && req->agent->request)\n\t\treq->agent->request = NULL;\n\tif (destroy && req->destroy)\n\t\treq->destroy(req->user_data);\n\tg_free(req);\n}",
          "includes": [
            "#include \"shared/queue.h\"",
            "#include \"agent.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"dbus-common.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/socket.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"shared/queue.h\"\n#include \"agent.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"dbus-common.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <sys/ioctl.h>\n#include <sys/socket.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void agent_request_free(struct agent_request *req, gboolean destroy)\n{\n\tif (req->msg)\n\t\tdbus_message_unref(req->msg);\n\tif (req->call)\n\t\tdbus_pending_call_unref(req->call);\n\tif (req->agent && req->agent->request)\n\t\treq->agent->request = NULL;\n\tif (destroy && req->destroy)\n\t\treq->destroy(req->user_data);\n\tg_free(req);\n}"
        }
      },
      {
        "call_info": {
          "callee": "passkey_request_new",
          "args": [
            "req",
            "dev_path"
          ],
          "line": 636
        },
        "resolved": true,
        "details": {
          "function_name": "passkey_request_new",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/agent.c",
          "lines": "594-617",
          "snippet": "static int passkey_request_new(struct agent_request *req,\n\t\t\t\tconst char *device_path)\n{\n\tstruct agent *agent = req->agent;\n\n\treq->msg = dbus_message_new_method_call(agent->owner, agent->path,\n\t\t\t\t\tAGENT_INTERFACE, \"RequestPasskey\");\n\tif (req->msg == NULL) {\n\t\terror(\"Couldn't allocate D-Bus message\");\n\t\treturn -ENOMEM;\n\t}\n\n\tdbus_message_append_args(req->msg, DBUS_TYPE_OBJECT_PATH, &device_path,\n\t\t\t\t\tDBUS_TYPE_INVALID);\n\n\tif (g_dbus_send_message_with_reply(btd_get_dbus_connection(), req->msg,\n\t\t\t\t\t&req->call, REQUEST_TIMEOUT) == FALSE) {\n\t\terror(\"D-Bus send failed\");\n\t\treturn -EIO;\n\t}\n\n\tdbus_pending_call_set_notify(req->call, passkey_reply, req, NULL);\n\treturn 0;\n}",
          "includes": [
            "#include \"shared/queue.h\"",
            "#include \"agent.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"dbus-common.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/socket.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define AGENT_INTERFACE \"org.bluez.Agent1\"",
            "#define REQUEST_TIMEOUT (60 * 1000)\t\t/* 60 seconds */"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"shared/queue.h\"\n#include \"agent.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"dbus-common.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <sys/ioctl.h>\n#include <sys/socket.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\n#define AGENT_INTERFACE \"org.bluez.Agent1\"\n#define REQUEST_TIMEOUT (60 * 1000)\t\t/* 60 seconds */\n\nstatic int passkey_request_new(struct agent_request *req,\n\t\t\t\tconst char *device_path)\n{\n\tstruct agent *agent = req->agent;\n\n\treq->msg = dbus_message_new_method_call(agent->owner, agent->path,\n\t\t\t\t\tAGENT_INTERFACE, \"RequestPasskey\");\n\tif (req->msg == NULL) {\n\t\terror(\"Couldn't allocate D-Bus message\");\n\t\treturn -ENOMEM;\n\t}\n\n\tdbus_message_append_args(req->msg, DBUS_TYPE_OBJECT_PATH, &device_path,\n\t\t\t\t\tDBUS_TYPE_INVALID);\n\n\tif (g_dbus_send_message_with_reply(btd_get_dbus_connection(), req->msg,\n\t\t\t\t\t&req->call, REQUEST_TIMEOUT) == FALSE) {\n\t\terror(\"D-Bus send failed\");\n\t\treturn -EIO;\n\t}\n\n\tdbus_pending_call_set_notify(req->call, passkey_reply, req, NULL);\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "agent_request_new",
          "args": [
            "agent",
            "AGENT_REQUEST_PASSKEY",
            "cb",
            "user_data",
            "destroy"
          ],
          "line": 633
        },
        "resolved": true,
        "details": {
          "function_name": "agent_request_new",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/agent.c",
          "lines": "298-315",
          "snippet": "static struct agent_request *agent_request_new(struct agent *agent,\n\t\t\t\t\t\tagent_request_type_t type,\n\t\t\t\t\t\tvoid *cb,\n\t\t\t\t\t\tvoid *user_data,\n\t\t\t\t\t\tGDestroyNotify destroy)\n{\n\tstruct agent_request *req;\n\n\treq = g_new0(struct agent_request, 1);\n\n\treq->agent = agent;\n\treq->type = type;\n\treq->cb = cb;\n\treq->user_data = user_data;\n\treq->destroy = destroy;\n\n\treturn req;\n}",
          "includes": [
            "#include \"shared/queue.h\"",
            "#include \"agent.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"dbus-common.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/socket.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"shared/queue.h\"\n#include \"agent.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"dbus-common.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <sys/ioctl.h>\n#include <sys/socket.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic struct agent_request *agent_request_new(struct agent *agent,\n\t\t\t\t\t\tagent_request_type_t type,\n\t\t\t\t\t\tvoid *cb,\n\t\t\t\t\t\tvoid *user_data,\n\t\t\t\t\t\tGDestroyNotify destroy)\n{\n\tstruct agent_request *req;\n\n\treq = g_new0(struct agent_request, 1);\n\n\treq->agent = agent;\n\treq->type = type;\n\treq->cb = cb;\n\treq->user_data = user_data;\n\treq->destroy = destroy;\n\n\treturn req;\n}"
        }
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"Calling Agent.RequestPasskey: name=%s, path=%s\"",
            "agent->owner",
            "agent->path"
          ],
          "line": 630
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "device_get_path",
          "args": [
            "device"
          ],
          "line": 624
        },
        "resolved": true,
        "details": {
          "function_name": "device_get_path",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "5323-5329",
          "snippet": "const char *device_get_path(const struct btd_device *device)\n{\n\tif (!device)\n\t\treturn NULL;\n\n\treturn device->path;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nconst char *device_get_path(const struct btd_device *device)\n{\n\tif (!device)\n\t\treturn NULL;\n\n\treturn device->path;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"shared/queue.h\"\n#include \"agent.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"dbus-common.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <sys/ioctl.h>\n#include <sys/socket.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nint agent_request_passkey(struct agent *agent, struct btd_device *device,\n\t\t\t\tagent_passkey_cb cb, void *user_data,\n\t\t\t\tGDestroyNotify destroy)\n{\n\tstruct agent_request *req;\n\tconst char *dev_path = device_get_path(device);\n\tint err;\n\n\tif (agent->request)\n\t\treturn -EBUSY;\n\n\tDBG(\"Calling Agent.RequestPasskey: name=%s, path=%s\",\n\t\t\tagent->owner, agent->path);\n\n\treq = agent_request_new(agent, AGENT_REQUEST_PASSKEY, cb,\n\t\t\t\t\t\t\tuser_data, destroy);\n\n\terr = passkey_request_new(req, dev_path);\n\tif (err < 0)\n\t\tgoto failed;\n\n\tagent->request = req;\n\n\treturn 0;\n\nfailed:\n\tagent_request_free(req, FALSE);\n\treturn err;\n}"
  },
  {
    "function_name": "passkey_request_new",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/agent.c",
    "lines": "594-617",
    "snippet": "static int passkey_request_new(struct agent_request *req,\n\t\t\t\tconst char *device_path)\n{\n\tstruct agent *agent = req->agent;\n\n\treq->msg = dbus_message_new_method_call(agent->owner, agent->path,\n\t\t\t\t\tAGENT_INTERFACE, \"RequestPasskey\");\n\tif (req->msg == NULL) {\n\t\terror(\"Couldn't allocate D-Bus message\");\n\t\treturn -ENOMEM;\n\t}\n\n\tdbus_message_append_args(req->msg, DBUS_TYPE_OBJECT_PATH, &device_path,\n\t\t\t\t\tDBUS_TYPE_INVALID);\n\n\tif (g_dbus_send_message_with_reply(btd_get_dbus_connection(), req->msg,\n\t\t\t\t\t&req->call, REQUEST_TIMEOUT) == FALSE) {\n\t\terror(\"D-Bus send failed\");\n\t\treturn -EIO;\n\t}\n\n\tdbus_pending_call_set_notify(req->call, passkey_reply, req, NULL);\n\treturn 0;\n}",
    "includes": [
      "#include \"shared/queue.h\"",
      "#include \"agent.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"dbus-common.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/socket.h>",
      "#include <stdbool.h>",
      "#include <stdlib.h>",
      "#include <errno.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define AGENT_INTERFACE \"org.bluez.Agent1\"",
      "#define REQUEST_TIMEOUT (60 * 1000)\t\t/* 60 seconds */"
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "dbus_pending_call_set_notify",
          "args": [
            "req->call",
            "passkey_reply",
            "req",
            "NULL"
          ],
          "line": 615
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"D-Bus send failed\""
          ],
          "line": 611
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_not_ready",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "118-122",
          "snippet": "DBusMessage *btd_error_not_ready(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".NotReady\",\n\t\t\t\t\t\"Resource Not Ready\");\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_not_ready(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".NotReady\",\n\t\t\t\t\t\"Resource Not Ready\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_dbus_send_message_with_reply",
          "args": [
            "btd_get_dbus_connection()",
            "req->msg",
            "&req->call",
            "REQUEST_TIMEOUT"
          ],
          "line": 609
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_get_dbus_connection",
          "args": [],
          "line": 609
        },
        "resolved": true,
        "details": {
          "function_name": "btd_get_dbus_connection",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/dbus-common.c",
          "lines": "61-64",
          "snippet": "DBusConnection *btd_get_dbus_connection(void)\n{\n\treturn connection;\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <stdint.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static DBusConnection *connection = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <stdint.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *connection = NULL;\n\nDBusConnection *btd_get_dbus_connection(void)\n{\n\treturn connection;\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_message_append_args",
          "args": [
            "req->msg",
            "DBUS_TYPE_OBJECT_PATH",
            "&device_path",
            "DBUS_TYPE_INVALID"
          ],
          "line": 606
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_new_method_call",
          "args": [
            "agent->owner",
            "agent->path",
            "AGENT_INTERFACE",
            "\"RequestPasskey\""
          ],
          "line": 599
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"shared/queue.h\"\n#include \"agent.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"dbus-common.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <sys/ioctl.h>\n#include <sys/socket.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\n#define AGENT_INTERFACE \"org.bluez.Agent1\"\n#define REQUEST_TIMEOUT (60 * 1000)\t\t/* 60 seconds */\n\nstatic int passkey_request_new(struct agent_request *req,\n\t\t\t\tconst char *device_path)\n{\n\tstruct agent *agent = req->agent;\n\n\treq->msg = dbus_message_new_method_call(agent->owner, agent->path,\n\t\t\t\t\tAGENT_INTERFACE, \"RequestPasskey\");\n\tif (req->msg == NULL) {\n\t\terror(\"Couldn't allocate D-Bus message\");\n\t\treturn -ENOMEM;\n\t}\n\n\tdbus_message_append_args(req->msg, DBUS_TYPE_OBJECT_PATH, &device_path,\n\t\t\t\t\tDBUS_TYPE_INVALID);\n\n\tif (g_dbus_send_message_with_reply(btd_get_dbus_connection(), req->msg,\n\t\t\t\t\t&req->call, REQUEST_TIMEOUT) == FALSE) {\n\t\terror(\"D-Bus send failed\");\n\t\treturn -EIO;\n\t}\n\n\tdbus_pending_call_set_notify(req->call, passkey_reply, req, NULL);\n\treturn 0;\n}"
  },
  {
    "function_name": "passkey_reply",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/agent.c",
    "lines": "552-592",
    "snippet": "static void passkey_reply(DBusPendingCall *call, void *user_data)\n{\n\tstruct agent_request *req = user_data;\n\tstruct agent *agent = req->agent;\n\tagent_passkey_cb cb = req->cb;\n\tDBusMessage *message;\n\tDBusError err;\n\tuint32_t passkey;\n\n\t/* steal_reply will always return non-NULL since the callback\n\t * is only called after a reply has been received */\n\tmessage = dbus_pending_call_steal_reply(call);\n\n\tdbus_error_init(&err);\n\tif (dbus_set_error_from_message(&err, message)) {\n\t\terror(\"Agent replied with an error: %s, %s\",\n\t\t\t\t\t\terr.name, err.message);\n\t\tcb(agent, &err, 0, req->user_data);\n\t\tdbus_error_free(&err);\n\t\tgoto done;\n\t}\n\n\tif (!dbus_message_get_args(message, &err,\n\t\t\t\tDBUS_TYPE_UINT32, &passkey,\n\t\t\t\tDBUS_TYPE_INVALID)) {\n\t\terror(\"Wrong passkey reply signature: %s\", err.message);\n\t\tcb(agent, &err, 0, req->user_data);\n\t\tdbus_error_free(&err);\n\t\tgoto done;\n\t}\n\n\tcb(agent, NULL, passkey, req->user_data);\n\ndone:\n\tif (message)\n\t\tdbus_message_unref(message);\n\n\tdbus_pending_call_cancel(req->call);\n\tagent->request = NULL;\n\tagent_request_free(req, TRUE);\n}",
    "includes": [
      "#include \"shared/queue.h\"",
      "#include \"agent.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"dbus-common.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/socket.h>",
      "#include <stdbool.h>",
      "#include <stdlib.h>",
      "#include <errno.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "agent_request_free",
          "args": [
            "req",
            "TRUE"
          ],
          "line": 591
        },
        "resolved": true,
        "details": {
          "function_name": "agent_request_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/agent.c",
          "lines": "125-136",
          "snippet": "static void agent_request_free(struct agent_request *req, gboolean destroy)\n{\n\tif (req->msg)\n\t\tdbus_message_unref(req->msg);\n\tif (req->call)\n\t\tdbus_pending_call_unref(req->call);\n\tif (req->agent && req->agent->request)\n\t\treq->agent->request = NULL;\n\tif (destroy && req->destroy)\n\t\treq->destroy(req->user_data);\n\tg_free(req);\n}",
          "includes": [
            "#include \"shared/queue.h\"",
            "#include \"agent.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"dbus-common.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/socket.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"shared/queue.h\"\n#include \"agent.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"dbus-common.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <sys/ioctl.h>\n#include <sys/socket.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void agent_request_free(struct agent_request *req, gboolean destroy)\n{\n\tif (req->msg)\n\t\tdbus_message_unref(req->msg);\n\tif (req->call)\n\t\tdbus_pending_call_unref(req->call);\n\tif (req->agent && req->agent->request)\n\t\treq->agent->request = NULL;\n\tif (destroy && req->destroy)\n\t\treq->destroy(req->user_data);\n\tg_free(req);\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_pending_call_cancel",
          "args": [
            "req->call"
          ],
          "line": 589
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_unref",
          "args": [
            "message"
          ],
          "line": 587
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "cb",
          "args": [
            "agent",
            "NULL",
            "passkey",
            "req->user_data"
          ],
          "line": 583
        },
        "resolved": true,
        "details": {
          "function_name": "passkey_cb",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "5954-5972",
          "snippet": "static void passkey_cb(struct agent *agent, DBusError *err,\n\t\t\t\t\t\tuint32_t passkey, void *data)\n{\n\tstruct authentication_req *auth = data;\n\tstruct btd_device *device = auth->device;\n\n\t/* No need to reply anything if the authentication already failed */\n\tif (auth->agent == NULL)\n\t\treturn;\n\n\tif (err)\n\t\tpasskey = INVALID_PASSKEY;\n\n\tbtd_adapter_passkey_reply(device->adapter, &device->bdaddr,\n\t\t\t\t\t\tauth->addr_type, passkey);\n\n\tagent_unref(device->authr->agent);\n\tdevice->authr->agent = NULL;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void passkey_cb(struct agent *agent, DBusError *err,\n\t\t\t\t\t\tuint32_t passkey, void *data)\n{\n\tstruct authentication_req *auth = data;\n\tstruct btd_device *device = auth->device;\n\n\t/* No need to reply anything if the authentication already failed */\n\tif (auth->agent == NULL)\n\t\treturn;\n\n\tif (err)\n\t\tpasskey = INVALID_PASSKEY;\n\n\tbtd_adapter_passkey_reply(device->adapter, &device->bdaddr,\n\t\t\t\t\t\tauth->addr_type, passkey);\n\n\tagent_unref(device->authr->agent);\n\tdevice->authr->agent = NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_error_free",
          "args": [
            "&err"
          ],
          "line": 579
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"Wrong passkey reply signature: %s\"",
            "err.message"
          ],
          "line": 577
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_failed",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "124-128",
          "snippet": "DBusMessage *btd_error_failed(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE\n\t\t\t\t\t\".Failed\", \"%s\", str);\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_failed(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE\n\t\t\t\t\t\".Failed\", \"%s\", str);\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_message_get_args",
          "args": [
            "message",
            "&err",
            "DBUS_TYPE_UINT32",
            "&passkey",
            "DBUS_TYPE_INVALID"
          ],
          "line": 574
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_error_free",
          "args": [
            "&err"
          ],
          "line": 570
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"Agent replied with an error: %s, %s\"",
            "err.name",
            "err.message"
          ],
          "line": 567
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/log.c",
          "lines": "199-213",
          "snippet": "void btd_error(uint16_t index, const char *format, ...)\n{\n\tva_list ap;\n\n\tva_start(ap, format);\n\tvsyslog(LOG_ERR, format, ap);\n\tva_end(ap);\n\n\tif (logging_fd < 0)\n\t\treturn;\n\n\tva_start(ap, format);\n\tlogging_log(index, LOG_ERR, format, ap);\n\tva_end(ap);\n}",
          "includes": [
            "#include \"log.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/hci.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <sys/socket.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <stdarg.h>",
            "#include <syslog.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int logging_fd = -1;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n#include \"src/shared/util.h\"\n#include \"lib/hci.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <sys/socket.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdarg.h>\n#include <syslog.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic int logging_fd = -1;\n\nvoid btd_error(uint16_t index, const char *format, ...)\n{\n\tva_list ap;\n\n\tva_start(ap, format);\n\tvsyslog(LOG_ERR, format, ap);\n\tva_end(ap);\n\n\tif (logging_fd < 0)\n\t\treturn;\n\n\tva_start(ap, format);\n\tlogging_log(index, LOG_ERR, format, ap);\n\tva_end(ap);\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_set_error_from_message",
          "args": [
            "&err",
            "message"
          ],
          "line": 566
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_error_init",
          "args": [
            "&err"
          ],
          "line": 565
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_pending_call_steal_reply",
          "args": [
            "call"
          ],
          "line": 563
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"shared/queue.h\"\n#include \"agent.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"dbus-common.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <sys/ioctl.h>\n#include <sys/socket.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void passkey_reply(DBusPendingCall *call, void *user_data)\n{\n\tstruct agent_request *req = user_data;\n\tstruct agent *agent = req->agent;\n\tagent_passkey_cb cb = req->cb;\n\tDBusMessage *message;\n\tDBusError err;\n\tuint32_t passkey;\n\n\t/* steal_reply will always return non-NULL since the callback\n\t * is only called after a reply has been received */\n\tmessage = dbus_pending_call_steal_reply(call);\n\n\tdbus_error_init(&err);\n\tif (dbus_set_error_from_message(&err, message)) {\n\t\terror(\"Agent replied with an error: %s, %s\",\n\t\t\t\t\t\terr.name, err.message);\n\t\tcb(agent, &err, 0, req->user_data);\n\t\tdbus_error_free(&err);\n\t\tgoto done;\n\t}\n\n\tif (!dbus_message_get_args(message, &err,\n\t\t\t\tDBUS_TYPE_UINT32, &passkey,\n\t\t\t\tDBUS_TYPE_INVALID)) {\n\t\terror(\"Wrong passkey reply signature: %s\", err.message);\n\t\tcb(agent, &err, 0, req->user_data);\n\t\tdbus_error_free(&err);\n\t\tgoto done;\n\t}\n\n\tcb(agent, NULL, passkey, req->user_data);\n\ndone:\n\tif (message)\n\t\tdbus_message_unref(message);\n\n\tdbus_pending_call_cancel(req->call);\n\tagent->request = NULL;\n\tagent_request_free(req, TRUE);\n}"
  },
  {
    "function_name": "agent_request_pincode",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/agent.c",
    "lines": "525-550",
    "snippet": "int agent_request_pincode(struct agent *agent, struct btd_device *device,\n\t\t\t\tagent_pincode_cb cb, gboolean secure,\n\t\t\t\tvoid *user_data, GDestroyNotify destroy)\n{\n\tstruct agent_request *req;\n\tconst char *dev_path = device_get_path(device);\n\tint err;\n\n\tif (agent->request)\n\t\treturn -EBUSY;\n\n\treq = agent_request_new(agent, AGENT_REQUEST_PINCODE, cb,\n\t\t\t\t\t\t\tuser_data, destroy);\n\n\terr = pincode_request_new(req, dev_path, secure);\n\tif (err < 0)\n\t\tgoto failed;\n\n\tagent->request = req;\n\n\treturn 0;\n\nfailed:\n\tagent_request_free(req, FALSE);\n\treturn err;\n}",
    "includes": [
      "#include \"shared/queue.h\"",
      "#include \"agent.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"dbus-common.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/socket.h>",
      "#include <stdbool.h>",
      "#include <stdlib.h>",
      "#include <errno.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "agent_request_free",
          "args": [
            "req",
            "FALSE"
          ],
          "line": 548
        },
        "resolved": true,
        "details": {
          "function_name": "agent_request_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/agent.c",
          "lines": "125-136",
          "snippet": "static void agent_request_free(struct agent_request *req, gboolean destroy)\n{\n\tif (req->msg)\n\t\tdbus_message_unref(req->msg);\n\tif (req->call)\n\t\tdbus_pending_call_unref(req->call);\n\tif (req->agent && req->agent->request)\n\t\treq->agent->request = NULL;\n\tif (destroy && req->destroy)\n\t\treq->destroy(req->user_data);\n\tg_free(req);\n}",
          "includes": [
            "#include \"shared/queue.h\"",
            "#include \"agent.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"dbus-common.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/socket.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"shared/queue.h\"\n#include \"agent.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"dbus-common.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <sys/ioctl.h>\n#include <sys/socket.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void agent_request_free(struct agent_request *req, gboolean destroy)\n{\n\tif (req->msg)\n\t\tdbus_message_unref(req->msg);\n\tif (req->call)\n\t\tdbus_pending_call_unref(req->call);\n\tif (req->agent && req->agent->request)\n\t\treq->agent->request = NULL;\n\tif (destroy && req->destroy)\n\t\treq->destroy(req->user_data);\n\tg_free(req);\n}"
        }
      },
      {
        "call_info": {
          "callee": "pincode_request_new",
          "args": [
            "req",
            "dev_path",
            "secure"
          ],
          "line": 539
        },
        "resolved": true,
        "details": {
          "function_name": "display_pincode_request_new",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/agent.c",
          "lines": "840-868",
          "snippet": "static int display_pincode_request_new(struct agent_request *req,\n\t\t\t\t\tconst char *device_path,\n\t\t\t\t\tconst char *pincode)\n{\n\tstruct agent *agent = req->agent;\n\n\treq->msg = dbus_message_new_method_call(agent->owner, agent->path,\n\t\t\t\t\tAGENT_INTERFACE, \"DisplayPinCode\");\n\tif (req->msg == NULL) {\n\t\terror(\"Couldn't allocate D-Bus message\");\n\t\treturn -ENOMEM;\n\t}\n\n\tdbus_message_append_args(req->msg,\n\t\t\t\t\tDBUS_TYPE_OBJECT_PATH, &device_path,\n\t\t\t\t\tDBUS_TYPE_STRING, &pincode,\n\t\t\t\t\tDBUS_TYPE_INVALID);\n\n\tif (g_dbus_send_message_with_reply(btd_get_dbus_connection(), req->msg,\n\t\t\t\t&req->call, REQUEST_TIMEOUT) == FALSE) {\n\t\terror(\"D-Bus send failed\");\n\t\treturn -EIO;\n\t}\n\n\tdbus_pending_call_set_notify(req->call, display_pincode_reply,\n\t\t\t\t\t\t\t\treq, NULL);\n\n\treturn 0;\n}",
          "includes": [
            "#include \"shared/queue.h\"",
            "#include \"agent.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"dbus-common.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/socket.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define AGENT_INTERFACE \"org.bluez.Agent1\"",
            "#define REQUEST_TIMEOUT (60 * 1000)\t\t/* 60 seconds */"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"shared/queue.h\"\n#include \"agent.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"dbus-common.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <sys/ioctl.h>\n#include <sys/socket.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\n#define AGENT_INTERFACE \"org.bluez.Agent1\"\n#define REQUEST_TIMEOUT (60 * 1000)\t\t/* 60 seconds */\n\nstatic int display_pincode_request_new(struct agent_request *req,\n\t\t\t\t\tconst char *device_path,\n\t\t\t\t\tconst char *pincode)\n{\n\tstruct agent *agent = req->agent;\n\n\treq->msg = dbus_message_new_method_call(agent->owner, agent->path,\n\t\t\t\t\tAGENT_INTERFACE, \"DisplayPinCode\");\n\tif (req->msg == NULL) {\n\t\terror(\"Couldn't allocate D-Bus message\");\n\t\treturn -ENOMEM;\n\t}\n\n\tdbus_message_append_args(req->msg,\n\t\t\t\t\tDBUS_TYPE_OBJECT_PATH, &device_path,\n\t\t\t\t\tDBUS_TYPE_STRING, &pincode,\n\t\t\t\t\tDBUS_TYPE_INVALID);\n\n\tif (g_dbus_send_message_with_reply(btd_get_dbus_connection(), req->msg,\n\t\t\t\t&req->call, REQUEST_TIMEOUT) == FALSE) {\n\t\terror(\"D-Bus send failed\");\n\t\treturn -EIO;\n\t}\n\n\tdbus_pending_call_set_notify(req->call, display_pincode_reply,\n\t\t\t\t\t\t\t\treq, NULL);\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "agent_request_new",
          "args": [
            "agent",
            "AGENT_REQUEST_PINCODE",
            "cb",
            "user_data",
            "destroy"
          ],
          "line": 536
        },
        "resolved": true,
        "details": {
          "function_name": "agent_request_new",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/agent.c",
          "lines": "298-315",
          "snippet": "static struct agent_request *agent_request_new(struct agent *agent,\n\t\t\t\t\t\tagent_request_type_t type,\n\t\t\t\t\t\tvoid *cb,\n\t\t\t\t\t\tvoid *user_data,\n\t\t\t\t\t\tGDestroyNotify destroy)\n{\n\tstruct agent_request *req;\n\n\treq = g_new0(struct agent_request, 1);\n\n\treq->agent = agent;\n\treq->type = type;\n\treq->cb = cb;\n\treq->user_data = user_data;\n\treq->destroy = destroy;\n\n\treturn req;\n}",
          "includes": [
            "#include \"shared/queue.h\"",
            "#include \"agent.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"dbus-common.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/socket.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"shared/queue.h\"\n#include \"agent.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"dbus-common.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <sys/ioctl.h>\n#include <sys/socket.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic struct agent_request *agent_request_new(struct agent *agent,\n\t\t\t\t\t\tagent_request_type_t type,\n\t\t\t\t\t\tvoid *cb,\n\t\t\t\t\t\tvoid *user_data,\n\t\t\t\t\t\tGDestroyNotify destroy)\n{\n\tstruct agent_request *req;\n\n\treq = g_new0(struct agent_request, 1);\n\n\treq->agent = agent;\n\treq->type = type;\n\treq->cb = cb;\n\treq->user_data = user_data;\n\treq->destroy = destroy;\n\n\treturn req;\n}"
        }
      },
      {
        "call_info": {
          "callee": "device_get_path",
          "args": [
            "device"
          ],
          "line": 530
        },
        "resolved": true,
        "details": {
          "function_name": "device_get_path",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "5323-5329",
          "snippet": "const char *device_get_path(const struct btd_device *device)\n{\n\tif (!device)\n\t\treturn NULL;\n\n\treturn device->path;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nconst char *device_get_path(const struct btd_device *device)\n{\n\tif (!device)\n\t\treturn NULL;\n\n\treturn device->path;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"shared/queue.h\"\n#include \"agent.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"dbus-common.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <sys/ioctl.h>\n#include <sys/socket.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nint agent_request_pincode(struct agent *agent, struct btd_device *device,\n\t\t\t\tagent_pincode_cb cb, gboolean secure,\n\t\t\t\tvoid *user_data, GDestroyNotify destroy)\n{\n\tstruct agent_request *req;\n\tconst char *dev_path = device_get_path(device);\n\tint err;\n\n\tif (agent->request)\n\t\treturn -EBUSY;\n\n\treq = agent_request_new(agent, AGENT_REQUEST_PINCODE, cb,\n\t\t\t\t\t\t\tuser_data, destroy);\n\n\terr = pincode_request_new(req, dev_path, secure);\n\tif (err < 0)\n\t\tgoto failed;\n\n\tagent->request = req;\n\n\treturn 0;\n\nfailed:\n\tagent_request_free(req, FALSE);\n\treturn err;\n}"
  },
  {
    "function_name": "pincode_request_new",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/agent.c",
    "lines": "497-523",
    "snippet": "static int pincode_request_new(struct agent_request *req, const char *device_path,\n\t\t\t\tdbus_bool_t secure)\n{\n\tstruct agent *agent = req->agent;\n\n\t/* TODO: Add a new method or a new param to Agent interface to request\n\t\tsecure pin. */\n\n\treq->msg = dbus_message_new_method_call(agent->owner, agent->path,\n\t\t\t\t\tAGENT_INTERFACE, \"RequestPinCode\");\n\tif (req->msg == NULL) {\n\t\terror(\"Couldn't allocate D-Bus message\");\n\t\treturn -ENOMEM;\n\t}\n\n\tdbus_message_append_args(req->msg, DBUS_TYPE_OBJECT_PATH, &device_path,\n\t\t\t\t\tDBUS_TYPE_INVALID);\n\n\tif (g_dbus_send_message_with_reply(btd_get_dbus_connection(), req->msg,\n\t\t\t\t\t&req->call, REQUEST_TIMEOUT) == FALSE) {\n\t\terror(\"D-Bus send failed\");\n\t\treturn -EIO;\n\t}\n\n\tdbus_pending_call_set_notify(req->call, pincode_reply, req, NULL);\n\treturn 0;\n}",
    "includes": [
      "#include \"shared/queue.h\"",
      "#include \"agent.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"dbus-common.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/socket.h>",
      "#include <stdbool.h>",
      "#include <stdlib.h>",
      "#include <errno.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define AGENT_INTERFACE \"org.bluez.Agent1\"",
      "#define REQUEST_TIMEOUT (60 * 1000)\t\t/* 60 seconds */"
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "dbus_pending_call_set_notify",
          "args": [
            "req->call",
            "pincode_reply",
            "req",
            "NULL"
          ],
          "line": 521
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"D-Bus send failed\""
          ],
          "line": 517
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_not_ready",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "118-122",
          "snippet": "DBusMessage *btd_error_not_ready(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".NotReady\",\n\t\t\t\t\t\"Resource Not Ready\");\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_not_ready(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".NotReady\",\n\t\t\t\t\t\"Resource Not Ready\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_dbus_send_message_with_reply",
          "args": [
            "btd_get_dbus_connection()",
            "req->msg",
            "&req->call",
            "REQUEST_TIMEOUT"
          ],
          "line": 515
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_get_dbus_connection",
          "args": [],
          "line": 515
        },
        "resolved": true,
        "details": {
          "function_name": "btd_get_dbus_connection",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/dbus-common.c",
          "lines": "61-64",
          "snippet": "DBusConnection *btd_get_dbus_connection(void)\n{\n\treturn connection;\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <stdint.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static DBusConnection *connection = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <stdint.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *connection = NULL;\n\nDBusConnection *btd_get_dbus_connection(void)\n{\n\treturn connection;\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_message_append_args",
          "args": [
            "req->msg",
            "DBUS_TYPE_OBJECT_PATH",
            "&device_path",
            "DBUS_TYPE_INVALID"
          ],
          "line": 512
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_new_method_call",
          "args": [
            "agent->owner",
            "agent->path",
            "AGENT_INTERFACE",
            "\"RequestPinCode\""
          ],
          "line": 505
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"shared/queue.h\"\n#include \"agent.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"dbus-common.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <sys/ioctl.h>\n#include <sys/socket.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\n#define AGENT_INTERFACE \"org.bluez.Agent1\"\n#define REQUEST_TIMEOUT (60 * 1000)\t\t/* 60 seconds */\n\nstatic int pincode_request_new(struct agent_request *req, const char *device_path,\n\t\t\t\tdbus_bool_t secure)\n{\n\tstruct agent *agent = req->agent;\n\n\t/* TODO: Add a new method or a new param to Agent interface to request\n\t\tsecure pin. */\n\n\treq->msg = dbus_message_new_method_call(agent->owner, agent->path,\n\t\t\t\t\tAGENT_INTERFACE, \"RequestPinCode\");\n\tif (req->msg == NULL) {\n\t\terror(\"Couldn't allocate D-Bus message\");\n\t\treturn -ENOMEM;\n\t}\n\n\tdbus_message_append_args(req->msg, DBUS_TYPE_OBJECT_PATH, &device_path,\n\t\t\t\t\tDBUS_TYPE_INVALID);\n\n\tif (g_dbus_send_message_with_reply(btd_get_dbus_connection(), req->msg,\n\t\t\t\t\t&req->call, REQUEST_TIMEOUT) == FALSE) {\n\t\terror(\"D-Bus send failed\");\n\t\treturn -EIO;\n\t}\n\n\tdbus_pending_call_set_notify(req->call, pincode_reply, req, NULL);\n\treturn 0;\n}"
  },
  {
    "function_name": "pincode_reply",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/agent.c",
    "lines": "438-495",
    "snippet": "static void pincode_reply(DBusPendingCall *call, void *user_data)\n{\n\tstruct agent_request *req = user_data;\n\tstruct agent *agent = req->agent;\n\tagent_pincode_cb cb = req->cb;\n\tDBusMessage *message;\n\tDBusError err;\n\tsize_t len;\n\tchar *pin;\n\n\t/* steal_reply will always return non-NULL since the callback\n\t * is only called after a reply has been received */\n\tmessage = dbus_pending_call_steal_reply(call);\n\n\t/* Protect from the callback freeing the agent */\n\tagent_ref(agent);\n\n\tdbus_error_init(&err);\n\tif (dbus_set_error_from_message(&err, message)) {\n\t\terror(\"Agent %s replied with an error: %s, %s\",\n\t\t\t\tagent->path, err.name, err.message);\n\n\t\tcb(agent, &err, NULL, req->user_data);\n\t\tdbus_error_free(&err);\n\t\tgoto done;\n\t}\n\n\tif (!dbus_message_get_args(message, &err,\n\t\t\t\tDBUS_TYPE_STRING, &pin,\n\t\t\t\tDBUS_TYPE_INVALID)) {\n\t\terror(\"Wrong passkey reply signature: %s\", err.message);\n\t\tcb(agent, &err, NULL, req->user_data);\n\t\tdbus_error_free(&err);\n\t\tgoto done;\n\t}\n\n\tlen = strlen(pin);\n\n\tif (len > 16 || len < 1) {\n\t\terror(\"Invalid PIN length (%zu) from agent\", len);\n\t\tdbus_set_error_const(&err, ERROR_INTERFACE \".InvalidArgs\",\n\t\t\t\t\t\"Invalid passkey length\");\n\t\tcb(agent, &err, NULL, req->user_data);\n\t\tdbus_error_free(&err);\n\t\tgoto done;\n\t}\n\n\tcb(agent, NULL, pin, req->user_data);\n\ndone:\n\tif (message)\n\t\tdbus_message_unref(message);\n\n\tdbus_pending_call_cancel(req->call);\n\tagent->request = NULL;\n\tagent_request_free(req, TRUE);\n\tagent_unref(agent);\n}",
    "includes": [
      "#include \"shared/queue.h\"",
      "#include \"agent.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"dbus-common.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/socket.h>",
      "#include <stdbool.h>",
      "#include <stdlib.h>",
      "#include <errno.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "agent_unref",
          "args": [
            "agent"
          ],
          "line": 494
        },
        "resolved": true,
        "details": {
          "function_name": "agent_unref",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/agent.c",
          "lines": "211-257",
          "snippet": "void agent_unref(struct agent *agent)\n{\n\tagent->ref--;\n\n\tDBG(\"%p: ref=%d\", agent, agent->ref);\n\n\tif (agent->ref > 0)\n\t\treturn;\n\n\tif (agent->request) {\n\t\tDBusError err;\n\t\tagent_pincode_cb pincode_cb;\n\t\tagent_passkey_cb passkey_cb;\n\t\tagent_cb cb;\n\n\t\tdbus_error_init(&err);\n\t\tdbus_set_error_const(&err, ERROR_INTERFACE \".Failed\",\n\t\t\t\t\t\t\t\t\"Canceled\");\n\n\t\tswitch (agent->request->type) {\n\t\tcase AGENT_REQUEST_PINCODE:\n\t\t\tpincode_cb = agent->request->cb;\n\t\t\tpincode_cb(agent, &err, NULL, agent->request->user_data);\n\t\t\tbreak;\n\t\tcase AGENT_REQUEST_PASSKEY:\n\t\t\tpasskey_cb = agent->request->cb;\n\t\t\tpasskey_cb(agent, &err, 0, agent->request->user_data);\n\t\t\tbreak;\n\t\tcase AGENT_REQUEST_CONFIRMATION:\n\t\tcase AGENT_REQUEST_AUTHORIZATION:\n\t\tcase AGENT_REQUEST_AUTHORIZE_SERVICE:\n\t\tcase AGENT_REQUEST_DISPLAY_PINCODE:\n\t\tdefault:\n\t\t\tcb = agent->request->cb;\n\t\t\tcb(agent, &err, agent->request->user_data);\n\t\t}\n\n\t\tdbus_error_free(&err);\n\n\t\tagent_cancel(agent);\n\t}\n\n\tg_free(agent->owner);\n\tg_free(agent->path);\n\n\tg_free(agent);\n}",
          "includes": [
            "#include \"shared/queue.h\"",
            "#include \"agent.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"dbus-common.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/socket.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"shared/queue.h\"\n#include \"agent.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"dbus-common.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <sys/ioctl.h>\n#include <sys/socket.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nvoid agent_unref(struct agent *agent)\n{\n\tagent->ref--;\n\n\tDBG(\"%p: ref=%d\", agent, agent->ref);\n\n\tif (agent->ref > 0)\n\t\treturn;\n\n\tif (agent->request) {\n\t\tDBusError err;\n\t\tagent_pincode_cb pincode_cb;\n\t\tagent_passkey_cb passkey_cb;\n\t\tagent_cb cb;\n\n\t\tdbus_error_init(&err);\n\t\tdbus_set_error_const(&err, ERROR_INTERFACE \".Failed\",\n\t\t\t\t\t\t\t\t\"Canceled\");\n\n\t\tswitch (agent->request->type) {\n\t\tcase AGENT_REQUEST_PINCODE:\n\t\t\tpincode_cb = agent->request->cb;\n\t\t\tpincode_cb(agent, &err, NULL, agent->request->user_data);\n\t\t\tbreak;\n\t\tcase AGENT_REQUEST_PASSKEY:\n\t\t\tpasskey_cb = agent->request->cb;\n\t\t\tpasskey_cb(agent, &err, 0, agent->request->user_data);\n\t\t\tbreak;\n\t\tcase AGENT_REQUEST_CONFIRMATION:\n\t\tcase AGENT_REQUEST_AUTHORIZATION:\n\t\tcase AGENT_REQUEST_AUTHORIZE_SERVICE:\n\t\tcase AGENT_REQUEST_DISPLAY_PINCODE:\n\t\tdefault:\n\t\t\tcb = agent->request->cb;\n\t\t\tcb(agent, &err, agent->request->user_data);\n\t\t}\n\n\t\tdbus_error_free(&err);\n\n\t\tagent_cancel(agent);\n\t}\n\n\tg_free(agent->owner);\n\tg_free(agent->path);\n\n\tg_free(agent);\n}"
        }
      },
      {
        "call_info": {
          "callee": "agent_request_free",
          "args": [
            "req",
            "TRUE"
          ],
          "line": 493
        },
        "resolved": true,
        "details": {
          "function_name": "agent_request_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/agent.c",
          "lines": "125-136",
          "snippet": "static void agent_request_free(struct agent_request *req, gboolean destroy)\n{\n\tif (req->msg)\n\t\tdbus_message_unref(req->msg);\n\tif (req->call)\n\t\tdbus_pending_call_unref(req->call);\n\tif (req->agent && req->agent->request)\n\t\treq->agent->request = NULL;\n\tif (destroy && req->destroy)\n\t\treq->destroy(req->user_data);\n\tg_free(req);\n}",
          "includes": [
            "#include \"shared/queue.h\"",
            "#include \"agent.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"dbus-common.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/socket.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"shared/queue.h\"\n#include \"agent.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"dbus-common.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <sys/ioctl.h>\n#include <sys/socket.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void agent_request_free(struct agent_request *req, gboolean destroy)\n{\n\tif (req->msg)\n\t\tdbus_message_unref(req->msg);\n\tif (req->call)\n\t\tdbus_pending_call_unref(req->call);\n\tif (req->agent && req->agent->request)\n\t\treq->agent->request = NULL;\n\tif (destroy && req->destroy)\n\t\treq->destroy(req->user_data);\n\tg_free(req);\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_pending_call_cancel",
          "args": [
            "req->call"
          ],
          "line": 491
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_unref",
          "args": [
            "message"
          ],
          "line": 489
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "cb",
          "args": [
            "agent",
            "NULL",
            "pin",
            "req->user_data"
          ],
          "line": 485
        },
        "resolved": true,
        "details": {
          "function_name": "passkey_cb",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "5954-5972",
          "snippet": "static void passkey_cb(struct agent *agent, DBusError *err,\n\t\t\t\t\t\tuint32_t passkey, void *data)\n{\n\tstruct authentication_req *auth = data;\n\tstruct btd_device *device = auth->device;\n\n\t/* No need to reply anything if the authentication already failed */\n\tif (auth->agent == NULL)\n\t\treturn;\n\n\tif (err)\n\t\tpasskey = INVALID_PASSKEY;\n\n\tbtd_adapter_passkey_reply(device->adapter, &device->bdaddr,\n\t\t\t\t\t\tauth->addr_type, passkey);\n\n\tagent_unref(device->authr->agent);\n\tdevice->authr->agent = NULL;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void passkey_cb(struct agent *agent, DBusError *err,\n\t\t\t\t\t\tuint32_t passkey, void *data)\n{\n\tstruct authentication_req *auth = data;\n\tstruct btd_device *device = auth->device;\n\n\t/* No need to reply anything if the authentication already failed */\n\tif (auth->agent == NULL)\n\t\treturn;\n\n\tif (err)\n\t\tpasskey = INVALID_PASSKEY;\n\n\tbtd_adapter_passkey_reply(device->adapter, &device->bdaddr,\n\t\t\t\t\t\tauth->addr_type, passkey);\n\n\tagent_unref(device->authr->agent);\n\tdevice->authr->agent = NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_error_free",
          "args": [
            "&err"
          ],
          "line": 481
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_set_error_const",
          "args": [
            "&err",
            "ERROR_INTERFACE \".InvalidArgs\"",
            "\"Invalid passkey length\""
          ],
          "line": 478
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"Invalid PIN length (%zu) from agent\"",
            "len"
          ],
          "line": 477
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_failed",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "124-128",
          "snippet": "DBusMessage *btd_error_failed(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE\n\t\t\t\t\t\".Failed\", \"%s\", str);\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_failed(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE\n\t\t\t\t\t\".Failed\", \"%s\", str);\n}"
        }
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "pin"
          ],
          "line": 474
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_error_free",
          "args": [
            "&err"
          ],
          "line": 470
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_get_args",
          "args": [
            "message",
            "&err",
            "DBUS_TYPE_STRING",
            "&pin",
            "DBUS_TYPE_INVALID"
          ],
          "line": 465
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_error_free",
          "args": [
            "&err"
          ],
          "line": 461
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"Agent %s replied with an error: %s, %s\"",
            "agent->path",
            "err.name",
            "err.message"
          ],
          "line": 457
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/log.c",
          "lines": "199-213",
          "snippet": "void btd_error(uint16_t index, const char *format, ...)\n{\n\tva_list ap;\n\n\tva_start(ap, format);\n\tvsyslog(LOG_ERR, format, ap);\n\tva_end(ap);\n\n\tif (logging_fd < 0)\n\t\treturn;\n\n\tva_start(ap, format);\n\tlogging_log(index, LOG_ERR, format, ap);\n\tva_end(ap);\n}",
          "includes": [
            "#include \"log.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/hci.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <sys/socket.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <stdarg.h>",
            "#include <syslog.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int logging_fd = -1;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n#include \"src/shared/util.h\"\n#include \"lib/hci.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <sys/socket.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdarg.h>\n#include <syslog.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic int logging_fd = -1;\n\nvoid btd_error(uint16_t index, const char *format, ...)\n{\n\tva_list ap;\n\n\tva_start(ap, format);\n\tvsyslog(LOG_ERR, format, ap);\n\tva_end(ap);\n\n\tif (logging_fd < 0)\n\t\treturn;\n\n\tva_start(ap, format);\n\tlogging_log(index, LOG_ERR, format, ap);\n\tva_end(ap);\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_set_error_from_message",
          "args": [
            "&err",
            "message"
          ],
          "line": 456
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_error_init",
          "args": [
            "&err"
          ],
          "line": 455
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "agent_ref",
          "args": [
            "agent"
          ],
          "line": 453
        },
        "resolved": true,
        "details": {
          "function_name": "agent_ref",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/agent.c",
          "lines": "202-209",
          "snippet": "struct agent *agent_ref(struct agent *agent)\n{\n\tagent->ref++;\n\n\tDBG(\"%p: ref=%d\", agent, agent->ref);\n\n\treturn agent;\n}",
          "includes": [
            "#include \"shared/queue.h\"",
            "#include \"agent.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"dbus-common.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/socket.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"shared/queue.h\"\n#include \"agent.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"dbus-common.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <sys/ioctl.h>\n#include <sys/socket.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstruct agent *agent_ref(struct agent *agent)\n{\n\tagent->ref++;\n\n\tDBG(\"%p: ref=%d\", agent, agent->ref);\n\n\treturn agent;\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_pending_call_steal_reply",
          "args": [
            "call"
          ],
          "line": 450
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"shared/queue.h\"\n#include \"agent.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"dbus-common.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <sys/ioctl.h>\n#include <sys/socket.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void pincode_reply(DBusPendingCall *call, void *user_data)\n{\n\tstruct agent_request *req = user_data;\n\tstruct agent *agent = req->agent;\n\tagent_pincode_cb cb = req->cb;\n\tDBusMessage *message;\n\tDBusError err;\n\tsize_t len;\n\tchar *pin;\n\n\t/* steal_reply will always return non-NULL since the callback\n\t * is only called after a reply has been received */\n\tmessage = dbus_pending_call_steal_reply(call);\n\n\t/* Protect from the callback freeing the agent */\n\tagent_ref(agent);\n\n\tdbus_error_init(&err);\n\tif (dbus_set_error_from_message(&err, message)) {\n\t\terror(\"Agent %s replied with an error: %s, %s\",\n\t\t\t\tagent->path, err.name, err.message);\n\n\t\tcb(agent, &err, NULL, req->user_data);\n\t\tdbus_error_free(&err);\n\t\tgoto done;\n\t}\n\n\tif (!dbus_message_get_args(message, &err,\n\t\t\t\tDBUS_TYPE_STRING, &pin,\n\t\t\t\tDBUS_TYPE_INVALID)) {\n\t\terror(\"Wrong passkey reply signature: %s\", err.message);\n\t\tcb(agent, &err, NULL, req->user_data);\n\t\tdbus_error_free(&err);\n\t\tgoto done;\n\t}\n\n\tlen = strlen(pin);\n\n\tif (len > 16 || len < 1) {\n\t\terror(\"Invalid PIN length (%zu) from agent\", len);\n\t\tdbus_set_error_const(&err, ERROR_INTERFACE \".InvalidArgs\",\n\t\t\t\t\t\"Invalid passkey length\");\n\t\tcb(agent, &err, NULL, req->user_data);\n\t\tdbus_error_free(&err);\n\t\tgoto done;\n\t}\n\n\tcb(agent, NULL, pin, req->user_data);\n\ndone:\n\tif (message)\n\t\tdbus_message_unref(message);\n\n\tdbus_pending_call_cancel(req->call);\n\tagent->request = NULL;\n\tagent_request_free(req, TRUE);\n\tagent_unref(agent);\n}"
  },
  {
    "function_name": "agent_authorize_service",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/agent.c",
    "lines": "412-436",
    "snippet": "int agent_authorize_service(struct agent *agent, const char *path,\n\t\t\t\tconst char *uuid, agent_cb cb,\n\t\t\t\tvoid *user_data, GDestroyNotify destroy)\n{\n\tstruct agent_request *req;\n\tint err;\n\n\tif (agent->request)\n\t\treturn -EBUSY;\n\n\treq = agent_request_new(agent, AGENT_REQUEST_AUTHORIZE_SERVICE, cb,\n\t\t\t\t\t\t\tuser_data, destroy);\n\n\terr = agent_call_authorize_service(req, path, uuid);\n\tif (err < 0) {\n\t\tagent_request_free(req, FALSE);\n\t\treturn -ENOMEM;\n\t}\n\n\tagent->request = req;\n\n\tDBG(\"authorize service request was sent for %s\", path);\n\n\treturn 0;\n}",
    "includes": [
      "#include \"shared/queue.h\"",
      "#include \"agent.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"dbus-common.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/socket.h>",
      "#include <stdbool.h>",
      "#include <stdlib.h>",
      "#include <errno.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"authorize service request was sent for %s\"",
            "path"
          ],
          "line": 433
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "agent_request_free",
          "args": [
            "req",
            "FALSE"
          ],
          "line": 427
        },
        "resolved": true,
        "details": {
          "function_name": "agent_request_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/agent.c",
          "lines": "125-136",
          "snippet": "static void agent_request_free(struct agent_request *req, gboolean destroy)\n{\n\tif (req->msg)\n\t\tdbus_message_unref(req->msg);\n\tif (req->call)\n\t\tdbus_pending_call_unref(req->call);\n\tif (req->agent && req->agent->request)\n\t\treq->agent->request = NULL;\n\tif (destroy && req->destroy)\n\t\treq->destroy(req->user_data);\n\tg_free(req);\n}",
          "includes": [
            "#include \"shared/queue.h\"",
            "#include \"agent.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"dbus-common.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/socket.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"shared/queue.h\"\n#include \"agent.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"dbus-common.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <sys/ioctl.h>\n#include <sys/socket.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void agent_request_free(struct agent_request *req, gboolean destroy)\n{\n\tif (req->msg)\n\t\tdbus_message_unref(req->msg);\n\tif (req->call)\n\t\tdbus_pending_call_unref(req->call);\n\tif (req->agent && req->agent->request)\n\t\treq->agent->request = NULL;\n\tif (destroy && req->destroy)\n\t\treq->destroy(req->user_data);\n\tg_free(req);\n}"
        }
      },
      {
        "call_info": {
          "callee": "agent_call_authorize_service",
          "args": [
            "req",
            "path",
            "uuid"
          ],
          "line": 425
        },
        "resolved": true,
        "details": {
          "function_name": "agent_call_authorize_service",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/agent.c",
          "lines": "383-410",
          "snippet": "static int agent_call_authorize_service(struct agent_request *req,\n\t\t\t\t\t\tconst char *device_path,\n\t\t\t\t\t\tconst char *uuid)\n{\n\tstruct agent *agent = req->agent;\n\n\treq->msg = dbus_message_new_method_call(agent->owner, agent->path,\n\t\t\t\t\tAGENT_INTERFACE, \"AuthorizeService\");\n\tif (!req->msg) {\n\t\terror(\"Couldn't allocate D-Bus message\");\n\t\treturn -ENOMEM;\n\t}\n\n\tdbus_message_append_args(req->msg,\n\t\t\t\tDBUS_TYPE_OBJECT_PATH, &device_path,\n\t\t\t\tDBUS_TYPE_STRING, &uuid,\n\t\t\t\tDBUS_TYPE_INVALID);\n\n\tif (g_dbus_send_message_with_reply(btd_get_dbus_connection(),\n\t\t\t\t\t\treq->msg, &req->call,\n\t\t\t\t\t\tREQUEST_TIMEOUT) == FALSE) {\n\t\terror(\"D-Bus send failed\");\n\t\treturn -EIO;\n\t}\n\n\tdbus_pending_call_set_notify(req->call, simple_agent_reply, req, NULL);\n\treturn 0;\n}",
          "includes": [
            "#include \"shared/queue.h\"",
            "#include \"agent.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"dbus-common.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/socket.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define AGENT_INTERFACE \"org.bluez.Agent1\"",
            "#define REQUEST_TIMEOUT (60 * 1000)\t\t/* 60 seconds */"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"shared/queue.h\"\n#include \"agent.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"dbus-common.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <sys/ioctl.h>\n#include <sys/socket.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\n#define AGENT_INTERFACE \"org.bluez.Agent1\"\n#define REQUEST_TIMEOUT (60 * 1000)\t\t/* 60 seconds */\n\nstatic int agent_call_authorize_service(struct agent_request *req,\n\t\t\t\t\t\tconst char *device_path,\n\t\t\t\t\t\tconst char *uuid)\n{\n\tstruct agent *agent = req->agent;\n\n\treq->msg = dbus_message_new_method_call(agent->owner, agent->path,\n\t\t\t\t\tAGENT_INTERFACE, \"AuthorizeService\");\n\tif (!req->msg) {\n\t\terror(\"Couldn't allocate D-Bus message\");\n\t\treturn -ENOMEM;\n\t}\n\n\tdbus_message_append_args(req->msg,\n\t\t\t\tDBUS_TYPE_OBJECT_PATH, &device_path,\n\t\t\t\tDBUS_TYPE_STRING, &uuid,\n\t\t\t\tDBUS_TYPE_INVALID);\n\n\tif (g_dbus_send_message_with_reply(btd_get_dbus_connection(),\n\t\t\t\t\t\treq->msg, &req->call,\n\t\t\t\t\t\tREQUEST_TIMEOUT) == FALSE) {\n\t\terror(\"D-Bus send failed\");\n\t\treturn -EIO;\n\t}\n\n\tdbus_pending_call_set_notify(req->call, simple_agent_reply, req, NULL);\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "agent_request_new",
          "args": [
            "agent",
            "AGENT_REQUEST_AUTHORIZE_SERVICE",
            "cb",
            "user_data",
            "destroy"
          ],
          "line": 422
        },
        "resolved": true,
        "details": {
          "function_name": "agent_request_new",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/agent.c",
          "lines": "298-315",
          "snippet": "static struct agent_request *agent_request_new(struct agent *agent,\n\t\t\t\t\t\tagent_request_type_t type,\n\t\t\t\t\t\tvoid *cb,\n\t\t\t\t\t\tvoid *user_data,\n\t\t\t\t\t\tGDestroyNotify destroy)\n{\n\tstruct agent_request *req;\n\n\treq = g_new0(struct agent_request, 1);\n\n\treq->agent = agent;\n\treq->type = type;\n\treq->cb = cb;\n\treq->user_data = user_data;\n\treq->destroy = destroy;\n\n\treturn req;\n}",
          "includes": [
            "#include \"shared/queue.h\"",
            "#include \"agent.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"dbus-common.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/socket.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"shared/queue.h\"\n#include \"agent.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"dbus-common.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <sys/ioctl.h>\n#include <sys/socket.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic struct agent_request *agent_request_new(struct agent *agent,\n\t\t\t\t\t\tagent_request_type_t type,\n\t\t\t\t\t\tvoid *cb,\n\t\t\t\t\t\tvoid *user_data,\n\t\t\t\t\t\tGDestroyNotify destroy)\n{\n\tstruct agent_request *req;\n\n\treq = g_new0(struct agent_request, 1);\n\n\treq->agent = agent;\n\treq->type = type;\n\treq->cb = cb;\n\treq->user_data = user_data;\n\treq->destroy = destroy;\n\n\treturn req;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"shared/queue.h\"\n#include \"agent.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"dbus-common.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <sys/ioctl.h>\n#include <sys/socket.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nint agent_authorize_service(struct agent *agent, const char *path,\n\t\t\t\tconst char *uuid, agent_cb cb,\n\t\t\t\tvoid *user_data, GDestroyNotify destroy)\n{\n\tstruct agent_request *req;\n\tint err;\n\n\tif (agent->request)\n\t\treturn -EBUSY;\n\n\treq = agent_request_new(agent, AGENT_REQUEST_AUTHORIZE_SERVICE, cb,\n\t\t\t\t\t\t\tuser_data, destroy);\n\n\terr = agent_call_authorize_service(req, path, uuid);\n\tif (err < 0) {\n\t\tagent_request_free(req, FALSE);\n\t\treturn -ENOMEM;\n\t}\n\n\tagent->request = req;\n\n\tDBG(\"authorize service request was sent for %s\", path);\n\n\treturn 0;\n}"
  },
  {
    "function_name": "agent_call_authorize_service",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/agent.c",
    "lines": "383-410",
    "snippet": "static int agent_call_authorize_service(struct agent_request *req,\n\t\t\t\t\t\tconst char *device_path,\n\t\t\t\t\t\tconst char *uuid)\n{\n\tstruct agent *agent = req->agent;\n\n\treq->msg = dbus_message_new_method_call(agent->owner, agent->path,\n\t\t\t\t\tAGENT_INTERFACE, \"AuthorizeService\");\n\tif (!req->msg) {\n\t\terror(\"Couldn't allocate D-Bus message\");\n\t\treturn -ENOMEM;\n\t}\n\n\tdbus_message_append_args(req->msg,\n\t\t\t\tDBUS_TYPE_OBJECT_PATH, &device_path,\n\t\t\t\tDBUS_TYPE_STRING, &uuid,\n\t\t\t\tDBUS_TYPE_INVALID);\n\n\tif (g_dbus_send_message_with_reply(btd_get_dbus_connection(),\n\t\t\t\t\t\treq->msg, &req->call,\n\t\t\t\t\t\tREQUEST_TIMEOUT) == FALSE) {\n\t\terror(\"D-Bus send failed\");\n\t\treturn -EIO;\n\t}\n\n\tdbus_pending_call_set_notify(req->call, simple_agent_reply, req, NULL);\n\treturn 0;\n}",
    "includes": [
      "#include \"shared/queue.h\"",
      "#include \"agent.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"dbus-common.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/socket.h>",
      "#include <stdbool.h>",
      "#include <stdlib.h>",
      "#include <errno.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define AGENT_INTERFACE \"org.bluez.Agent1\"",
      "#define REQUEST_TIMEOUT (60 * 1000)\t\t/* 60 seconds */"
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "dbus_pending_call_set_notify",
          "args": [
            "req->call",
            "simple_agent_reply",
            "req",
            "NULL"
          ],
          "line": 408
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"D-Bus send failed\""
          ],
          "line": 404
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_not_ready",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "118-122",
          "snippet": "DBusMessage *btd_error_not_ready(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".NotReady\",\n\t\t\t\t\t\"Resource Not Ready\");\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_not_ready(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".NotReady\",\n\t\t\t\t\t\"Resource Not Ready\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_dbus_send_message_with_reply",
          "args": [
            "btd_get_dbus_connection()",
            "req->msg",
            "&req->call",
            "REQUEST_TIMEOUT"
          ],
          "line": 401
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_get_dbus_connection",
          "args": [],
          "line": 401
        },
        "resolved": true,
        "details": {
          "function_name": "btd_get_dbus_connection",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/dbus-common.c",
          "lines": "61-64",
          "snippet": "DBusConnection *btd_get_dbus_connection(void)\n{\n\treturn connection;\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <stdint.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static DBusConnection *connection = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <stdint.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *connection = NULL;\n\nDBusConnection *btd_get_dbus_connection(void)\n{\n\treturn connection;\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_message_append_args",
          "args": [
            "req->msg",
            "DBUS_TYPE_OBJECT_PATH",
            "&device_path",
            "DBUS_TYPE_STRING",
            "&uuid",
            "DBUS_TYPE_INVALID"
          ],
          "line": 396
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_new_method_call",
          "args": [
            "agent->owner",
            "agent->path",
            "AGENT_INTERFACE",
            "\"AuthorizeService\""
          ],
          "line": 389
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"shared/queue.h\"\n#include \"agent.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"dbus-common.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <sys/ioctl.h>\n#include <sys/socket.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\n#define AGENT_INTERFACE \"org.bluez.Agent1\"\n#define REQUEST_TIMEOUT (60 * 1000)\t\t/* 60 seconds */\n\nstatic int agent_call_authorize_service(struct agent_request *req,\n\t\t\t\t\t\tconst char *device_path,\n\t\t\t\t\t\tconst char *uuid)\n{\n\tstruct agent *agent = req->agent;\n\n\treq->msg = dbus_message_new_method_call(agent->owner, agent->path,\n\t\t\t\t\tAGENT_INTERFACE, \"AuthorizeService\");\n\tif (!req->msg) {\n\t\terror(\"Couldn't allocate D-Bus message\");\n\t\treturn -ENOMEM;\n\t}\n\n\tdbus_message_append_args(req->msg,\n\t\t\t\tDBUS_TYPE_OBJECT_PATH, &device_path,\n\t\t\t\tDBUS_TYPE_STRING, &uuid,\n\t\t\t\tDBUS_TYPE_INVALID);\n\n\tif (g_dbus_send_message_with_reply(btd_get_dbus_connection(),\n\t\t\t\t\t\treq->msg, &req->call,\n\t\t\t\t\t\tREQUEST_TIMEOUT) == FALSE) {\n\t\terror(\"D-Bus send failed\");\n\t\treturn -EIO;\n\t}\n\n\tdbus_pending_call_set_notify(req->call, simple_agent_reply, req, NULL);\n\treturn 0;\n}"
  },
  {
    "function_name": "simple_agent_reply",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/agent.c",
    "lines": "333-381",
    "snippet": "static void simple_agent_reply(DBusPendingCall *call, void *user_data)\n{\n\tstruct agent_request *req = user_data;\n\tstruct agent *agent = req->agent;\n\tDBusMessage *message;\n\tDBusError err;\n\tagent_cb cb = req->cb;\n\n\t/* steal_reply will always return non-NULL since the callback\n\t * is only called after a reply has been received */\n\tmessage = dbus_pending_call_steal_reply(call);\n\n\t/* Protect from the callback freeing the agent */\n\tagent_ref(agent);\n\n\tdbus_error_init(&err);\n\tif (dbus_set_error_from_message(&err, message)) {\n\t\tDBG(\"agent error reply: %s, %s\", err.name, err.message);\n\n\t\tcb(agent, &err, req->user_data);\n\n\t\tif (dbus_error_has_name(&err, DBUS_ERROR_NO_REPLY)) {\n\t\t\terror(\"Timed out waiting for reply from agent\");\n\t\t\tagent_cancel(agent);\n\t\t\tdbus_message_unref(message);\n\t\t\tdbus_error_free(&err);\n\t\t\tagent_unref(agent);\n\t\t\treturn;\n\t\t}\n\n\t\tdbus_error_free(&err);\n\t\tgoto done;\n\t}\n\n\tif (!dbus_message_get_args(message, &err, DBUS_TYPE_INVALID)) {\n\t\terror(\"Wrong reply signature: %s\", err.message);\n\t\tcb(agent, &err, req->user_data);\n\t\tdbus_error_free(&err);\n\t\tgoto done;\n\t}\n\n\tcb(agent, NULL, req->user_data);\ndone:\n\tdbus_message_unref(message);\n\n\tagent->request = NULL;\n\tagent_request_free(req, TRUE);\n\tagent_unref(agent);\n}",
    "includes": [
      "#include \"shared/queue.h\"",
      "#include \"agent.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"dbus-common.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/socket.h>",
      "#include <stdbool.h>",
      "#include <stdlib.h>",
      "#include <errno.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "agent_unref",
          "args": [
            "agent"
          ],
          "line": 380
        },
        "resolved": true,
        "details": {
          "function_name": "agent_unref",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/agent.c",
          "lines": "211-257",
          "snippet": "void agent_unref(struct agent *agent)\n{\n\tagent->ref--;\n\n\tDBG(\"%p: ref=%d\", agent, agent->ref);\n\n\tif (agent->ref > 0)\n\t\treturn;\n\n\tif (agent->request) {\n\t\tDBusError err;\n\t\tagent_pincode_cb pincode_cb;\n\t\tagent_passkey_cb passkey_cb;\n\t\tagent_cb cb;\n\n\t\tdbus_error_init(&err);\n\t\tdbus_set_error_const(&err, ERROR_INTERFACE \".Failed\",\n\t\t\t\t\t\t\t\t\"Canceled\");\n\n\t\tswitch (agent->request->type) {\n\t\tcase AGENT_REQUEST_PINCODE:\n\t\t\tpincode_cb = agent->request->cb;\n\t\t\tpincode_cb(agent, &err, NULL, agent->request->user_data);\n\t\t\tbreak;\n\t\tcase AGENT_REQUEST_PASSKEY:\n\t\t\tpasskey_cb = agent->request->cb;\n\t\t\tpasskey_cb(agent, &err, 0, agent->request->user_data);\n\t\t\tbreak;\n\t\tcase AGENT_REQUEST_CONFIRMATION:\n\t\tcase AGENT_REQUEST_AUTHORIZATION:\n\t\tcase AGENT_REQUEST_AUTHORIZE_SERVICE:\n\t\tcase AGENT_REQUEST_DISPLAY_PINCODE:\n\t\tdefault:\n\t\t\tcb = agent->request->cb;\n\t\t\tcb(agent, &err, agent->request->user_data);\n\t\t}\n\n\t\tdbus_error_free(&err);\n\n\t\tagent_cancel(agent);\n\t}\n\n\tg_free(agent->owner);\n\tg_free(agent->path);\n\n\tg_free(agent);\n}",
          "includes": [
            "#include \"shared/queue.h\"",
            "#include \"agent.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"dbus-common.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/socket.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"shared/queue.h\"\n#include \"agent.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"dbus-common.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <sys/ioctl.h>\n#include <sys/socket.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nvoid agent_unref(struct agent *agent)\n{\n\tagent->ref--;\n\n\tDBG(\"%p: ref=%d\", agent, agent->ref);\n\n\tif (agent->ref > 0)\n\t\treturn;\n\n\tif (agent->request) {\n\t\tDBusError err;\n\t\tagent_pincode_cb pincode_cb;\n\t\tagent_passkey_cb passkey_cb;\n\t\tagent_cb cb;\n\n\t\tdbus_error_init(&err);\n\t\tdbus_set_error_const(&err, ERROR_INTERFACE \".Failed\",\n\t\t\t\t\t\t\t\t\"Canceled\");\n\n\t\tswitch (agent->request->type) {\n\t\tcase AGENT_REQUEST_PINCODE:\n\t\t\tpincode_cb = agent->request->cb;\n\t\t\tpincode_cb(agent, &err, NULL, agent->request->user_data);\n\t\t\tbreak;\n\t\tcase AGENT_REQUEST_PASSKEY:\n\t\t\tpasskey_cb = agent->request->cb;\n\t\t\tpasskey_cb(agent, &err, 0, agent->request->user_data);\n\t\t\tbreak;\n\t\tcase AGENT_REQUEST_CONFIRMATION:\n\t\tcase AGENT_REQUEST_AUTHORIZATION:\n\t\tcase AGENT_REQUEST_AUTHORIZE_SERVICE:\n\t\tcase AGENT_REQUEST_DISPLAY_PINCODE:\n\t\tdefault:\n\t\t\tcb = agent->request->cb;\n\t\t\tcb(agent, &err, agent->request->user_data);\n\t\t}\n\n\t\tdbus_error_free(&err);\n\n\t\tagent_cancel(agent);\n\t}\n\n\tg_free(agent->owner);\n\tg_free(agent->path);\n\n\tg_free(agent);\n}"
        }
      },
      {
        "call_info": {
          "callee": "agent_request_free",
          "args": [
            "req",
            "TRUE"
          ],
          "line": 379
        },
        "resolved": true,
        "details": {
          "function_name": "agent_request_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/agent.c",
          "lines": "125-136",
          "snippet": "static void agent_request_free(struct agent_request *req, gboolean destroy)\n{\n\tif (req->msg)\n\t\tdbus_message_unref(req->msg);\n\tif (req->call)\n\t\tdbus_pending_call_unref(req->call);\n\tif (req->agent && req->agent->request)\n\t\treq->agent->request = NULL;\n\tif (destroy && req->destroy)\n\t\treq->destroy(req->user_data);\n\tg_free(req);\n}",
          "includes": [
            "#include \"shared/queue.h\"",
            "#include \"agent.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"dbus-common.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/socket.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"shared/queue.h\"\n#include \"agent.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"dbus-common.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <sys/ioctl.h>\n#include <sys/socket.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void agent_request_free(struct agent_request *req, gboolean destroy)\n{\n\tif (req->msg)\n\t\tdbus_message_unref(req->msg);\n\tif (req->call)\n\t\tdbus_pending_call_unref(req->call);\n\tif (req->agent && req->agent->request)\n\t\treq->agent->request = NULL;\n\tif (destroy && req->destroy)\n\t\treq->destroy(req->user_data);\n\tg_free(req);\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_message_unref",
          "args": [
            "message"
          ],
          "line": 376
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "cb",
          "args": [
            "agent",
            "NULL",
            "req->user_data"
          ],
          "line": 374
        },
        "resolved": true,
        "details": {
          "function_name": "channel_watch_cb",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/attrib-server.c",
          "lines": "981-987",
          "snippet": "static gboolean channel_watch_cb(GIOChannel *io, GIOCondition cond,\n\t\t\t\t\t\tgpointer user_data)\n{\n\tchannel_remove(user_data);\n\n\treturn FALSE;\n}",
          "includes": [
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"attrib/att-database.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"backtrace.h\"",
            "#include \"log.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <sys/stat.h>",
            "#include <glib.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdbool.h>",
            "#include <stdint.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"attrib/att-database.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"src/shared/util.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <sys/stat.h>\n#include <glib.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdbool.h>\n#include <stdint.h>\n#include <errno.h>\n#include <config.h>\n\nstatic gboolean channel_watch_cb(GIOChannel *io, GIOCondition cond,\n\t\t\t\t\t\tgpointer user_data)\n{\n\tchannel_remove(user_data);\n\n\treturn FALSE;\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_error_free",
          "args": [
            "&err"
          ],
          "line": 370
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"Wrong reply signature: %s\"",
            "err.message"
          ],
          "line": 368
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_failed",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "124-128",
          "snippet": "DBusMessage *btd_error_failed(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE\n\t\t\t\t\t\".Failed\", \"%s\", str);\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_failed(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE\n\t\t\t\t\t\".Failed\", \"%s\", str);\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_message_get_args",
          "args": [
            "message",
            "&err",
            "DBUS_TYPE_INVALID"
          ],
          "line": 367
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_error_free",
          "args": [
            "&err"
          ],
          "line": 363
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_error_free",
          "args": [
            "&err"
          ],
          "line": 358
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_unref",
          "args": [
            "message"
          ],
          "line": 357
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "agent_cancel",
          "args": [
            "agent"
          ],
          "line": 356
        },
        "resolved": true,
        "details": {
          "function_name": "agent_cancel",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/agent.c",
          "lines": "317-331",
          "snippet": "int agent_cancel(struct agent *agent)\n{\n\tif (!agent->request)\n\t\treturn -EINVAL;\n\n\tif (agent->request->call) {\n\t\tdbus_pending_call_cancel(agent->request->call);\n\t\tsend_cancel_request(agent->request);\n\t}\n\n\tagent_request_free(agent->request, TRUE);\n\tagent->request = NULL;\n\n\treturn 0;\n}",
          "includes": [
            "#include \"shared/queue.h\"",
            "#include \"agent.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"dbus-common.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/socket.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"shared/queue.h\"\n#include \"agent.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"dbus-common.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <sys/ioctl.h>\n#include <sys/socket.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nint agent_cancel(struct agent *agent)\n{\n\tif (!agent->request)\n\t\treturn -EINVAL;\n\n\tif (agent->request->call) {\n\t\tdbus_pending_call_cancel(agent->request->call);\n\t\tsend_cancel_request(agent->request);\n\t}\n\n\tagent_request_free(agent->request, TRUE);\n\tagent->request = NULL;\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"Timed out waiting for reply from agent\""
          ],
          "line": 355
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_not_ready",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "118-122",
          "snippet": "DBusMessage *btd_error_not_ready(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".NotReady\",\n\t\t\t\t\t\"Resource Not Ready\");\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_not_ready(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".NotReady\",\n\t\t\t\t\t\"Resource Not Ready\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_error_has_name",
          "args": [
            "&err",
            "DBUS_ERROR_NO_REPLY"
          ],
          "line": 354
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"agent error reply: %s, %s\"",
            "err.name",
            "err.message"
          ],
          "line": 350
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_set_error_from_message",
          "args": [
            "&err",
            "message"
          ],
          "line": 349
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_error_init",
          "args": [
            "&err"
          ],
          "line": 348
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "agent_ref",
          "args": [
            "agent"
          ],
          "line": 346
        },
        "resolved": true,
        "details": {
          "function_name": "agent_ref",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/agent.c",
          "lines": "202-209",
          "snippet": "struct agent *agent_ref(struct agent *agent)\n{\n\tagent->ref++;\n\n\tDBG(\"%p: ref=%d\", agent, agent->ref);\n\n\treturn agent;\n}",
          "includes": [
            "#include \"shared/queue.h\"",
            "#include \"agent.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"dbus-common.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/socket.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"shared/queue.h\"\n#include \"agent.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"dbus-common.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <sys/ioctl.h>\n#include <sys/socket.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstruct agent *agent_ref(struct agent *agent)\n{\n\tagent->ref++;\n\n\tDBG(\"%p: ref=%d\", agent, agent->ref);\n\n\treturn agent;\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_pending_call_steal_reply",
          "args": [
            "call"
          ],
          "line": 343
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"shared/queue.h\"\n#include \"agent.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"dbus-common.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <sys/ioctl.h>\n#include <sys/socket.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void simple_agent_reply(DBusPendingCall *call, void *user_data)\n{\n\tstruct agent_request *req = user_data;\n\tstruct agent *agent = req->agent;\n\tDBusMessage *message;\n\tDBusError err;\n\tagent_cb cb = req->cb;\n\n\t/* steal_reply will always return non-NULL since the callback\n\t * is only called after a reply has been received */\n\tmessage = dbus_pending_call_steal_reply(call);\n\n\t/* Protect from the callback freeing the agent */\n\tagent_ref(agent);\n\n\tdbus_error_init(&err);\n\tif (dbus_set_error_from_message(&err, message)) {\n\t\tDBG(\"agent error reply: %s, %s\", err.name, err.message);\n\n\t\tcb(agent, &err, req->user_data);\n\n\t\tif (dbus_error_has_name(&err, DBUS_ERROR_NO_REPLY)) {\n\t\t\terror(\"Timed out waiting for reply from agent\");\n\t\t\tagent_cancel(agent);\n\t\t\tdbus_message_unref(message);\n\t\t\tdbus_error_free(&err);\n\t\t\tagent_unref(agent);\n\t\t\treturn;\n\t\t}\n\n\t\tdbus_error_free(&err);\n\t\tgoto done;\n\t}\n\n\tif (!dbus_message_get_args(message, &err, DBUS_TYPE_INVALID)) {\n\t\terror(\"Wrong reply signature: %s\", err.message);\n\t\tcb(agent, &err, req->user_data);\n\t\tdbus_error_free(&err);\n\t\tgoto done;\n\t}\n\n\tcb(agent, NULL, req->user_data);\ndone:\n\tdbus_message_unref(message);\n\n\tagent->request = NULL;\n\tagent_request_free(req, TRUE);\n\tagent_unref(agent);\n}"
  },
  {
    "function_name": "agent_cancel",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/agent.c",
    "lines": "317-331",
    "snippet": "int agent_cancel(struct agent *agent)\n{\n\tif (!agent->request)\n\t\treturn -EINVAL;\n\n\tif (agent->request->call) {\n\t\tdbus_pending_call_cancel(agent->request->call);\n\t\tsend_cancel_request(agent->request);\n\t}\n\n\tagent_request_free(agent->request, TRUE);\n\tagent->request = NULL;\n\n\treturn 0;\n}",
    "includes": [
      "#include \"shared/queue.h\"",
      "#include \"agent.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"dbus-common.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/socket.h>",
      "#include <stdbool.h>",
      "#include <stdlib.h>",
      "#include <errno.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "agent_request_free",
          "args": [
            "agent->request",
            "TRUE"
          ],
          "line": 327
        },
        "resolved": true,
        "details": {
          "function_name": "agent_request_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/agent.c",
          "lines": "125-136",
          "snippet": "static void agent_request_free(struct agent_request *req, gboolean destroy)\n{\n\tif (req->msg)\n\t\tdbus_message_unref(req->msg);\n\tif (req->call)\n\t\tdbus_pending_call_unref(req->call);\n\tif (req->agent && req->agent->request)\n\t\treq->agent->request = NULL;\n\tif (destroy && req->destroy)\n\t\treq->destroy(req->user_data);\n\tg_free(req);\n}",
          "includes": [
            "#include \"shared/queue.h\"",
            "#include \"agent.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"dbus-common.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/socket.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"shared/queue.h\"\n#include \"agent.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"dbus-common.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <sys/ioctl.h>\n#include <sys/socket.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void agent_request_free(struct agent_request *req, gboolean destroy)\n{\n\tif (req->msg)\n\t\tdbus_message_unref(req->msg);\n\tif (req->call)\n\t\tdbus_pending_call_unref(req->call);\n\tif (req->agent && req->agent->request)\n\t\treq->agent->request = NULL;\n\tif (destroy && req->destroy)\n\t\treq->destroy(req->user_data);\n\tg_free(req);\n}"
        }
      },
      {
        "call_info": {
          "callee": "send_cancel_request",
          "args": [
            "agent->request"
          ],
          "line": 324
        },
        "resolved": true,
        "details": {
          "function_name": "send_cancel_request",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/agent.c",
          "lines": "106-123",
          "snippet": "static int send_cancel_request(struct agent_request *req)\n{\n\tDBusMessage *message;\n\n\tDBG(\"Sending Cancel request to %s, %s\", req->agent->owner,\n\t\t\t\t\t\t\treq->agent->path);\n\n\tmessage = dbus_message_new_method_call(req->agent->owner, req->agent->path,\n\t\t\t\t\t\tAGENT_INTERFACE, \"Cancel\");\n\tif (message == NULL) {\n\t\terror(\"Couldn't allocate D-Bus message\");\n\t\treturn -ENOMEM;\n\t}\n\n\tg_dbus_send_message(btd_get_dbus_connection(), message);\n\n\treturn 0;\n}",
          "includes": [
            "#include \"shared/queue.h\"",
            "#include \"agent.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"dbus-common.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/socket.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define AGENT_INTERFACE \"org.bluez.Agent1\""
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"shared/queue.h\"\n#include \"agent.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"dbus-common.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <sys/ioctl.h>\n#include <sys/socket.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\n#define AGENT_INTERFACE \"org.bluez.Agent1\"\n\nstatic int send_cancel_request(struct agent_request *req)\n{\n\tDBusMessage *message;\n\n\tDBG(\"Sending Cancel request to %s, %s\", req->agent->owner,\n\t\t\t\t\t\t\treq->agent->path);\n\n\tmessage = dbus_message_new_method_call(req->agent->owner, req->agent->path,\n\t\t\t\t\t\tAGENT_INTERFACE, \"Cancel\");\n\tif (message == NULL) {\n\t\terror(\"Couldn't allocate D-Bus message\");\n\t\treturn -ENOMEM;\n\t}\n\n\tg_dbus_send_message(btd_get_dbus_connection(), message);\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_pending_call_cancel",
          "args": [
            "agent->request->call"
          ],
          "line": 323
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"shared/queue.h\"\n#include \"agent.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"dbus-common.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <sys/ioctl.h>\n#include <sys/socket.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nint agent_cancel(struct agent *agent)\n{\n\tif (!agent->request)\n\t\treturn -EINVAL;\n\n\tif (agent->request->call) {\n\t\tdbus_pending_call_cancel(agent->request->call);\n\t\tsend_cancel_request(agent->request);\n\t}\n\n\tagent_request_free(agent->request, TRUE);\n\tagent->request = NULL;\n\n\treturn 0;\n}"
  },
  {
    "function_name": "agent_request_new",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/agent.c",
    "lines": "298-315",
    "snippet": "static struct agent_request *agent_request_new(struct agent *agent,\n\t\t\t\t\t\tagent_request_type_t type,\n\t\t\t\t\t\tvoid *cb,\n\t\t\t\t\t\tvoid *user_data,\n\t\t\t\t\t\tGDestroyNotify destroy)\n{\n\tstruct agent_request *req;\n\n\treq = g_new0(struct agent_request, 1);\n\n\treq->agent = agent;\n\treq->type = type;\n\treq->cb = cb;\n\treq->user_data = user_data;\n\treq->destroy = destroy;\n\n\treturn req;\n}",
    "includes": [
      "#include \"shared/queue.h\"",
      "#include \"agent.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"dbus-common.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/socket.h>",
      "#include <stdbool.h>",
      "#include <stdlib.h>",
      "#include <errno.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_new0",
          "args": [
            "structagent_request",
            "1"
          ],
          "line": 306
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"shared/queue.h\"\n#include \"agent.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"dbus-common.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <sys/ioctl.h>\n#include <sys/socket.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic struct agent_request *agent_request_new(struct agent *agent,\n\t\t\t\t\t\tagent_request_type_t type,\n\t\t\t\t\t\tvoid *cb,\n\t\t\t\t\t\tvoid *user_data,\n\t\t\t\t\t\tGDestroyNotify destroy)\n{\n\tstruct agent_request *req;\n\n\treq = g_new0(struct agent_request, 1);\n\n\treq->agent = agent;\n\treq->type = type;\n\treq->cb = cb;\n\treq->user_data = user_data;\n\treq->destroy = destroy;\n\n\treturn req;\n}"
  },
  {
    "function_name": "agent_create",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/agent.c",
    "lines": "275-296",
    "snippet": "static struct agent *agent_create( const char *name, const char *path,\n\t\t\t\t\t\t\tuint8_t capability)\n{\n\tstruct agent *agent;\n\n\tagent = g_new0(struct agent, 1);\n\n\tagent->owner = g_strdup(name);\n\tagent->path = g_strdup(path);\n\tagent->capability = capability;\n\n\tagent->watch = g_dbus_add_disconnect_watch(btd_get_dbus_connection(),\n\t\t\t\t\t\t\tname, agent_disconnect,\n\t\t\t\t\t\t\tagent, NULL);\n\n\tif (queue_isempty(default_agents))\n\t\tadd_default_agent(agent);\n\telse\n\t\tqueue_push_tail(default_agents, agent);\n\n\treturn agent_ref(agent);\n}",
    "includes": [
      "#include \"shared/queue.h\"",
      "#include \"agent.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"dbus-common.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/socket.h>",
      "#include <stdbool.h>",
      "#include <stdlib.h>",
      "#include <errno.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "struct queue *default_agents = NULL;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "agent_ref",
          "args": [
            "agent"
          ],
          "line": 295
        },
        "resolved": true,
        "details": {
          "function_name": "agent_ref",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/agent.c",
          "lines": "202-209",
          "snippet": "struct agent *agent_ref(struct agent *agent)\n{\n\tagent->ref++;\n\n\tDBG(\"%p: ref=%d\", agent, agent->ref);\n\n\treturn agent;\n}",
          "includes": [
            "#include \"shared/queue.h\"",
            "#include \"agent.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"dbus-common.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/socket.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"shared/queue.h\"\n#include \"agent.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"dbus-common.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <sys/ioctl.h>\n#include <sys/socket.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstruct agent *agent_ref(struct agent *agent)\n{\n\tagent->ref++;\n\n\tDBG(\"%p: ref=%d\", agent, agent->ref);\n\n\treturn agent;\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_push_tail",
          "args": [
            "default_agents",
            "agent"
          ],
          "line": 293
        },
        "resolved": true,
        "details": {
          "function_name": "queue_push_tail",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "88-108",
          "snippet": "bool queue_push_tail(struct queue *queue, void *data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn false;\n\n\tentry = queue_entry_new(data);\n\n\tif (queue->tail)\n\t\tqueue->tail->next = entry;\n\n\tqueue->tail = entry;\n\n\tif (!queue->head)\n\t\tqueue->head = entry;\n\n\tqueue->entries++;\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nbool queue_push_tail(struct queue *queue, void *data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn false;\n\n\tentry = queue_entry_new(data);\n\n\tif (queue->tail)\n\t\tqueue->tail->next = entry;\n\n\tqueue->tail = entry;\n\n\tif (!queue->head)\n\t\tqueue->head = entry;\n\n\tqueue->entries++;\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "add_default_agent",
          "args": [
            "agent"
          ],
          "line": 291
        },
        "resolved": true,
        "details": {
          "function_name": "add_default_agent",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/agent.c",
          "lines": "151-166",
          "snippet": "static bool add_default_agent(struct agent *agent)\n{\n\tif (queue_peek_head(default_agents) == agent)\n\t\treturn true;\n\n\tqueue_remove(default_agents, agent);\n\n\tif (!queue_push_head(default_agents, agent))\n\t\treturn false;\n\n\tDBG(\"Default agent set to %s %s\", agent->owner, agent->path);\n\n\tadapter_foreach(set_io_cap, agent);\n\n\treturn true;\n}",
          "includes": [
            "#include \"shared/queue.h\"",
            "#include \"agent.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"dbus-common.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/socket.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "struct queue *default_agents = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"shared/queue.h\"\n#include \"agent.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"dbus-common.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <sys/ioctl.h>\n#include <sys/socket.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstruct queue *default_agents = NULL;\n\nstatic bool add_default_agent(struct agent *agent)\n{\n\tif (queue_peek_head(default_agents) == agent)\n\t\treturn true;\n\n\tqueue_remove(default_agents, agent);\n\n\tif (!queue_push_head(default_agents, agent))\n\t\treturn false;\n\n\tDBG(\"Default agent set to %s %s\", agent->owner, agent->path);\n\n\tadapter_foreach(set_io_cap, agent);\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_isempty",
          "args": [
            "default_agents"
          ],
          "line": 290
        },
        "resolved": true,
        "details": {
          "function_name": "queue_isempty",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "380-386",
          "snippet": "bool queue_isempty(struct queue *queue)\n{\n\tif (!queue)\n\t\treturn true;\n\n\treturn queue->entries == 0;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nbool queue_isempty(struct queue *queue)\n{\n\tif (!queue)\n\t\treturn true;\n\n\treturn queue->entries == 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_dbus_add_disconnect_watch",
          "args": [
            "btd_get_dbus_connection()",
            "name",
            "agent_disconnect",
            "agent",
            "NULL"
          ],
          "line": 286
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_get_dbus_connection",
          "args": [],
          "line": 286
        },
        "resolved": true,
        "details": {
          "function_name": "btd_get_dbus_connection",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/dbus-common.c",
          "lines": "61-64",
          "snippet": "DBusConnection *btd_get_dbus_connection(void)\n{\n\treturn connection;\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <stdint.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static DBusConnection *connection = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <stdint.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *connection = NULL;\n\nDBusConnection *btd_get_dbus_connection(void)\n{\n\treturn connection;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_strdup",
          "args": [
            "path"
          ],
          "line": 283
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_strdup",
          "args": [
            "name"
          ],
          "line": 282
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_new0",
          "args": [
            "structagent",
            "1"
          ],
          "line": 280
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"shared/queue.h\"\n#include \"agent.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"dbus-common.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <sys/ioctl.h>\n#include <sys/socket.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstruct queue *default_agents = NULL;\n\nstatic struct agent *agent_create( const char *name, const char *path,\n\t\t\t\t\t\t\tuint8_t capability)\n{\n\tstruct agent *agent;\n\n\tagent = g_new0(struct agent, 1);\n\n\tagent->owner = g_strdup(name);\n\tagent->path = g_strdup(path);\n\tagent->capability = capability;\n\n\tagent->watch = g_dbus_add_disconnect_watch(btd_get_dbus_connection(),\n\t\t\t\t\t\t\tname, agent_disconnect,\n\t\t\t\t\t\t\tagent, NULL);\n\n\tif (queue_isempty(default_agents))\n\t\tadd_default_agent(agent);\n\telse\n\t\tqueue_push_tail(default_agents, agent);\n\n\treturn agent_ref(agent);\n}"
  },
  {
    "function_name": "agent_get",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/agent.c",
    "lines": "259-273",
    "snippet": "struct agent *agent_get(const char *owner)\n{\n\tstruct agent *agent;\n\n\tif (owner) {\n\t\tagent = g_hash_table_lookup(agent_list, owner);\n\t\tif (agent)\n\t\t\treturn agent_ref(agent);\n\t}\n\n\tif (!queue_isempty(default_agents))\n\t\treturn agent_ref(queue_peek_head(default_agents));\n\n\treturn NULL;\n}",
    "includes": [
      "#include \"shared/queue.h\"",
      "#include \"agent.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"dbus-common.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/socket.h>",
      "#include <stdbool.h>",
      "#include <stdlib.h>",
      "#include <errno.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static GHashTable *agent_list;",
      "struct queue *default_agents = NULL;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "agent_ref",
          "args": [
            "queue_peek_head(default_agents)"
          ],
          "line": 270
        },
        "resolved": true,
        "details": {
          "function_name": "agent_ref",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/agent.c",
          "lines": "202-209",
          "snippet": "struct agent *agent_ref(struct agent *agent)\n{\n\tagent->ref++;\n\n\tDBG(\"%p: ref=%d\", agent, agent->ref);\n\n\treturn agent;\n}",
          "includes": [
            "#include \"shared/queue.h\"",
            "#include \"agent.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"dbus-common.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/socket.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"shared/queue.h\"\n#include \"agent.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"dbus-common.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <sys/ioctl.h>\n#include <sys/socket.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstruct agent *agent_ref(struct agent *agent)\n{\n\tagent->ref++;\n\n\tDBG(\"%p: ref=%d\", agent, agent->ref);\n\n\treturn agent;\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_peek_head",
          "args": [
            "default_agents"
          ],
          "line": 270
        },
        "resolved": true,
        "details": {
          "function_name": "queue_peek_head",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "187-193",
          "snippet": "void *queue_peek_head(struct queue *queue)\n{\n\tif (!queue || !queue->head)\n\t\treturn NULL;\n\n\treturn queue->head->data;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nvoid *queue_peek_head(struct queue *queue)\n{\n\tif (!queue || !queue->head)\n\t\treturn NULL;\n\n\treturn queue->head->data;\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_isempty",
          "args": [
            "default_agents"
          ],
          "line": 269
        },
        "resolved": true,
        "details": {
          "function_name": "queue_isempty",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "380-386",
          "snippet": "bool queue_isempty(struct queue *queue)\n{\n\tif (!queue)\n\t\treturn true;\n\n\treturn queue->entries == 0;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nbool queue_isempty(struct queue *queue)\n{\n\tif (!queue)\n\t\treturn true;\n\n\treturn queue->entries == 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_hash_table_lookup",
          "args": [
            "agent_list",
            "owner"
          ],
          "line": 264
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"shared/queue.h\"\n#include \"agent.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"dbus-common.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <sys/ioctl.h>\n#include <sys/socket.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic GHashTable *agent_list;\nstruct queue *default_agents = NULL;\n\nstruct agent *agent_get(const char *owner)\n{\n\tstruct agent *agent;\n\n\tif (owner) {\n\t\tagent = g_hash_table_lookup(agent_list, owner);\n\t\tif (agent)\n\t\t\treturn agent_ref(agent);\n\t}\n\n\tif (!queue_isempty(default_agents))\n\t\treturn agent_ref(queue_peek_head(default_agents));\n\n\treturn NULL;\n}"
  },
  {
    "function_name": "agent_unref",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/agent.c",
    "lines": "211-257",
    "snippet": "void agent_unref(struct agent *agent)\n{\n\tagent->ref--;\n\n\tDBG(\"%p: ref=%d\", agent, agent->ref);\n\n\tif (agent->ref > 0)\n\t\treturn;\n\n\tif (agent->request) {\n\t\tDBusError err;\n\t\tagent_pincode_cb pincode_cb;\n\t\tagent_passkey_cb passkey_cb;\n\t\tagent_cb cb;\n\n\t\tdbus_error_init(&err);\n\t\tdbus_set_error_const(&err, ERROR_INTERFACE \".Failed\",\n\t\t\t\t\t\t\t\t\"Canceled\");\n\n\t\tswitch (agent->request->type) {\n\t\tcase AGENT_REQUEST_PINCODE:\n\t\t\tpincode_cb = agent->request->cb;\n\t\t\tpincode_cb(agent, &err, NULL, agent->request->user_data);\n\t\t\tbreak;\n\t\tcase AGENT_REQUEST_PASSKEY:\n\t\t\tpasskey_cb = agent->request->cb;\n\t\t\tpasskey_cb(agent, &err, 0, agent->request->user_data);\n\t\t\tbreak;\n\t\tcase AGENT_REQUEST_CONFIRMATION:\n\t\tcase AGENT_REQUEST_AUTHORIZATION:\n\t\tcase AGENT_REQUEST_AUTHORIZE_SERVICE:\n\t\tcase AGENT_REQUEST_DISPLAY_PINCODE:\n\t\tdefault:\n\t\t\tcb = agent->request->cb;\n\t\t\tcb(agent, &err, agent->request->user_data);\n\t\t}\n\n\t\tdbus_error_free(&err);\n\n\t\tagent_cancel(agent);\n\t}\n\n\tg_free(agent->owner);\n\tg_free(agent->path);\n\n\tg_free(agent);\n}",
    "includes": [
      "#include \"shared/queue.h\"",
      "#include \"agent.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"dbus-common.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/socket.h>",
      "#include <stdbool.h>",
      "#include <stdlib.h>",
      "#include <errno.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_free",
          "args": [
            "agent"
          ],
          "line": 256
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_free",
          "args": [
            "agent->path"
          ],
          "line": 254
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_free",
          "args": [
            "agent->owner"
          ],
          "line": 253
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "agent_cancel",
          "args": [
            "agent"
          ],
          "line": 250
        },
        "resolved": true,
        "details": {
          "function_name": "agent_cancel",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/agent.c",
          "lines": "317-331",
          "snippet": "int agent_cancel(struct agent *agent)\n{\n\tif (!agent->request)\n\t\treturn -EINVAL;\n\n\tif (agent->request->call) {\n\t\tdbus_pending_call_cancel(agent->request->call);\n\t\tsend_cancel_request(agent->request);\n\t}\n\n\tagent_request_free(agent->request, TRUE);\n\tagent->request = NULL;\n\n\treturn 0;\n}",
          "includes": [
            "#include \"shared/queue.h\"",
            "#include \"agent.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"dbus-common.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/socket.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"shared/queue.h\"\n#include \"agent.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"dbus-common.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <sys/ioctl.h>\n#include <sys/socket.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nint agent_cancel(struct agent *agent)\n{\n\tif (!agent->request)\n\t\treturn -EINVAL;\n\n\tif (agent->request->call) {\n\t\tdbus_pending_call_cancel(agent->request->call);\n\t\tsend_cancel_request(agent->request);\n\t}\n\n\tagent_request_free(agent->request, TRUE);\n\tagent->request = NULL;\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_error_free",
          "args": [
            "&err"
          ],
          "line": 248
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "cb",
          "args": [
            "agent",
            "&err",
            "agent->request->user_data"
          ],
          "line": 245
        },
        "resolved": true,
        "details": {
          "function_name": "channel_watch_cb",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/attrib-server.c",
          "lines": "981-987",
          "snippet": "static gboolean channel_watch_cb(GIOChannel *io, GIOCondition cond,\n\t\t\t\t\t\tgpointer user_data)\n{\n\tchannel_remove(user_data);\n\n\treturn FALSE;\n}",
          "includes": [
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"attrib/att-database.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"backtrace.h\"",
            "#include \"log.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <sys/stat.h>",
            "#include <glib.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdbool.h>",
            "#include <stdint.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"attrib/att-database.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"src/shared/util.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <sys/stat.h>\n#include <glib.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdbool.h>\n#include <stdint.h>\n#include <errno.h>\n#include <config.h>\n\nstatic gboolean channel_watch_cb(GIOChannel *io, GIOCondition cond,\n\t\t\t\t\t\tgpointer user_data)\n{\n\tchannel_remove(user_data);\n\n\treturn FALSE;\n}"
        }
      },
      {
        "call_info": {
          "callee": "passkey_cb",
          "args": [
            "agent",
            "&err",
            "0",
            "agent->request->user_data"
          ],
          "line": 237
        },
        "resolved": true,
        "details": {
          "function_name": "passkey_cb",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "5954-5972",
          "snippet": "static void passkey_cb(struct agent *agent, DBusError *err,\n\t\t\t\t\t\tuint32_t passkey, void *data)\n{\n\tstruct authentication_req *auth = data;\n\tstruct btd_device *device = auth->device;\n\n\t/* No need to reply anything if the authentication already failed */\n\tif (auth->agent == NULL)\n\t\treturn;\n\n\tif (err)\n\t\tpasskey = INVALID_PASSKEY;\n\n\tbtd_adapter_passkey_reply(device->adapter, &device->bdaddr,\n\t\t\t\t\t\tauth->addr_type, passkey);\n\n\tagent_unref(device->authr->agent);\n\tdevice->authr->agent = NULL;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void passkey_cb(struct agent *agent, DBusError *err,\n\t\t\t\t\t\tuint32_t passkey, void *data)\n{\n\tstruct authentication_req *auth = data;\n\tstruct btd_device *device = auth->device;\n\n\t/* No need to reply anything if the authentication already failed */\n\tif (auth->agent == NULL)\n\t\treturn;\n\n\tif (err)\n\t\tpasskey = INVALID_PASSKEY;\n\n\tbtd_adapter_passkey_reply(device->adapter, &device->bdaddr,\n\t\t\t\t\t\tauth->addr_type, passkey);\n\n\tagent_unref(device->authr->agent);\n\tdevice->authr->agent = NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "pincode_cb",
          "args": [
            "agent",
            "&err",
            "NULL",
            "agent->request->user_data"
          ],
          "line": 233
        },
        "resolved": true,
        "details": {
          "function_name": "pincode_cb",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "5920-5935",
          "snippet": "static void pincode_cb(struct agent *agent, DBusError *err, const char *pin,\n\t\t\t\t\t\t\t\tvoid *data)\n{\n\tstruct authentication_req *auth = data;\n\tstruct btd_device *device = auth->device;\n\n\t/* No need to reply anything if the authentication already failed */\n\tif (auth->agent == NULL)\n\t\treturn;\n\n\tbtd_adapter_pincode_reply(device->adapter, &device->bdaddr,\n\t\t\t\t\t\tpin, pin ? strlen(pin) : 0);\n\n\tagent_unref(device->authr->agent);\n\tdevice->authr->agent = NULL;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void pincode_cb(struct agent *agent, DBusError *err, const char *pin,\n\t\t\t\t\t\t\t\tvoid *data)\n{\n\tstruct authentication_req *auth = data;\n\tstruct btd_device *device = auth->device;\n\n\t/* No need to reply anything if the authentication already failed */\n\tif (auth->agent == NULL)\n\t\treturn;\n\n\tbtd_adapter_pincode_reply(device->adapter, &device->bdaddr,\n\t\t\t\t\t\tpin, pin ? strlen(pin) : 0);\n\n\tagent_unref(device->authr->agent);\n\tdevice->authr->agent = NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_set_error_const",
          "args": [
            "&err",
            "ERROR_INTERFACE \".Failed\"",
            "\"Canceled\""
          ],
          "line": 227
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_error_init",
          "args": [
            "&err"
          ],
          "line": 226
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"%p: ref=%d\"",
            "agent",
            "agent->ref"
          ],
          "line": 215
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"shared/queue.h\"\n#include \"agent.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"dbus-common.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <sys/ioctl.h>\n#include <sys/socket.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nvoid agent_unref(struct agent *agent)\n{\n\tagent->ref--;\n\n\tDBG(\"%p: ref=%d\", agent, agent->ref);\n\n\tif (agent->ref > 0)\n\t\treturn;\n\n\tif (agent->request) {\n\t\tDBusError err;\n\t\tagent_pincode_cb pincode_cb;\n\t\tagent_passkey_cb passkey_cb;\n\t\tagent_cb cb;\n\n\t\tdbus_error_init(&err);\n\t\tdbus_set_error_const(&err, ERROR_INTERFACE \".Failed\",\n\t\t\t\t\t\t\t\t\"Canceled\");\n\n\t\tswitch (agent->request->type) {\n\t\tcase AGENT_REQUEST_PINCODE:\n\t\t\tpincode_cb = agent->request->cb;\n\t\t\tpincode_cb(agent, &err, NULL, agent->request->user_data);\n\t\t\tbreak;\n\t\tcase AGENT_REQUEST_PASSKEY:\n\t\t\tpasskey_cb = agent->request->cb;\n\t\t\tpasskey_cb(agent, &err, 0, agent->request->user_data);\n\t\t\tbreak;\n\t\tcase AGENT_REQUEST_CONFIRMATION:\n\t\tcase AGENT_REQUEST_AUTHORIZATION:\n\t\tcase AGENT_REQUEST_AUTHORIZE_SERVICE:\n\t\tcase AGENT_REQUEST_DISPLAY_PINCODE:\n\t\tdefault:\n\t\t\tcb = agent->request->cb;\n\t\t\tcb(agent, &err, agent->request->user_data);\n\t\t}\n\n\t\tdbus_error_free(&err);\n\n\t\tagent_cancel(agent);\n\t}\n\n\tg_free(agent->owner);\n\tg_free(agent->path);\n\n\tg_free(agent);\n}"
  },
  {
    "function_name": "agent_ref",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/agent.c",
    "lines": "202-209",
    "snippet": "struct agent *agent_ref(struct agent *agent)\n{\n\tagent->ref++;\n\n\tDBG(\"%p: ref=%d\", agent, agent->ref);\n\n\treturn agent;\n}",
    "includes": [
      "#include \"shared/queue.h\"",
      "#include \"agent.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"dbus-common.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/socket.h>",
      "#include <stdbool.h>",
      "#include <stdlib.h>",
      "#include <errno.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"%p: ref=%d\"",
            "agent",
            "agent->ref"
          ],
          "line": 206
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"shared/queue.h\"\n#include \"agent.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"dbus-common.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <sys/ioctl.h>\n#include <sys/socket.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstruct agent *agent_ref(struct agent *agent)\n{\n\tagent->ref++;\n\n\tDBG(\"%p: ref=%d\", agent, agent->ref);\n\n\treturn agent;\n}"
  },
  {
    "function_name": "agent_disconnect",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/agent.c",
    "lines": "186-200",
    "snippet": "static void agent_disconnect(DBusConnection *conn, void *user_data)\n{\n\tstruct agent *agent = user_data;\n\n\tDBG(\"Agent %s disconnected\", agent->owner);\n\n\tif (agent->watch > 0) {\n\t\tg_dbus_remove_watch(conn, agent->watch);\n\t\tagent->watch = 0;\n\t}\n\n\tremove_default_agent(agent);\n\n\tg_hash_table_remove(agent_list, agent->owner);\n}",
    "includes": [
      "#include \"shared/queue.h\"",
      "#include \"agent.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"dbus-common.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/socket.h>",
      "#include <stdbool.h>",
      "#include <stdlib.h>",
      "#include <errno.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static GHashTable *agent_list;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_hash_table_remove",
          "args": [
            "agent_list",
            "agent->owner"
          ],
          "line": 199
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "remove_default_agent",
          "args": [
            "agent"
          ],
          "line": 197
        },
        "resolved": true,
        "details": {
          "function_name": "remove_default_agent",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/agent.c",
          "lines": "168-184",
          "snippet": "static void remove_default_agent(struct agent *agent)\n{\n\tif (queue_peek_head(default_agents) != agent) {\n\t\tqueue_remove(default_agents, agent);\n\t\treturn;\n\t}\n\n\tqueue_remove(default_agents, agent);\n\n\tagent = queue_peek_head(default_agents);\n\tif (agent)\n\t\tDBG(\"Default agent set to %s %s\", agent->owner, agent->path);\n\telse\n\t\tDBG(\"Default agent cleared\");\n\n\tadapter_foreach(set_io_cap, agent);\n}",
          "includes": [
            "#include \"shared/queue.h\"",
            "#include \"agent.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"dbus-common.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/socket.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "struct queue *default_agents = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"shared/queue.h\"\n#include \"agent.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"dbus-common.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <sys/ioctl.h>\n#include <sys/socket.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstruct queue *default_agents = NULL;\n\nstatic void remove_default_agent(struct agent *agent)\n{\n\tif (queue_peek_head(default_agents) != agent) {\n\t\tqueue_remove(default_agents, agent);\n\t\treturn;\n\t}\n\n\tqueue_remove(default_agents, agent);\n\n\tagent = queue_peek_head(default_agents);\n\tif (agent)\n\t\tDBG(\"Default agent set to %s %s\", agent->owner, agent->path);\n\telse\n\t\tDBG(\"Default agent cleared\");\n\n\tadapter_foreach(set_io_cap, agent);\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_dbus_remove_watch",
          "args": [
            "conn",
            "agent->watch"
          ],
          "line": 193
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"Agent %s disconnected\"",
            "agent->owner"
          ],
          "line": 190
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"shared/queue.h\"\n#include \"agent.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"dbus-common.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <sys/ioctl.h>\n#include <sys/socket.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic GHashTable *agent_list;\n\nstatic void agent_disconnect(DBusConnection *conn, void *user_data)\n{\n\tstruct agent *agent = user_data;\n\n\tDBG(\"Agent %s disconnected\", agent->owner);\n\n\tif (agent->watch > 0) {\n\t\tg_dbus_remove_watch(conn, agent->watch);\n\t\tagent->watch = 0;\n\t}\n\n\tremove_default_agent(agent);\n\n\tg_hash_table_remove(agent_list, agent->owner);\n}"
  },
  {
    "function_name": "remove_default_agent",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/agent.c",
    "lines": "168-184",
    "snippet": "static void remove_default_agent(struct agent *agent)\n{\n\tif (queue_peek_head(default_agents) != agent) {\n\t\tqueue_remove(default_agents, agent);\n\t\treturn;\n\t}\n\n\tqueue_remove(default_agents, agent);\n\n\tagent = queue_peek_head(default_agents);\n\tif (agent)\n\t\tDBG(\"Default agent set to %s %s\", agent->owner, agent->path);\n\telse\n\t\tDBG(\"Default agent cleared\");\n\n\tadapter_foreach(set_io_cap, agent);\n}",
    "includes": [
      "#include \"shared/queue.h\"",
      "#include \"agent.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"dbus-common.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/socket.h>",
      "#include <stdbool.h>",
      "#include <stdlib.h>",
      "#include <errno.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "struct queue *default_agents = NULL;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "adapter_foreach",
          "args": [
            "set_io_cap",
            "agent"
          ],
          "line": 183
        },
        "resolved": true,
        "details": {
          "function_name": "adapter_foreach",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "8025-8028",
          "snippet": "void adapter_foreach(adapter_cb func, gpointer user_data)\n{\n\tg_slist_foreach(adapters, (GFunc) func, user_data);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static GSList *adapters = NULL;",
            "static gboolean process_auth_queue(gpointer user_data);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic GSList *adapters = NULL;\nstatic gboolean process_auth_queue(gpointer user_data);\n\nvoid adapter_foreach(adapter_cb func, gpointer user_data)\n{\n\tg_slist_foreach(adapters, (GFunc) func, user_data);\n}"
        }
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"Default agent cleared\""
          ],
          "line": 181
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"Default agent set to %s %s\"",
            "agent->owner",
            "agent->path"
          ],
          "line": 179
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "queue_peek_head",
          "args": [
            "default_agents"
          ],
          "line": 177
        },
        "resolved": true,
        "details": {
          "function_name": "queue_peek_head",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "187-193",
          "snippet": "void *queue_peek_head(struct queue *queue)\n{\n\tif (!queue || !queue->head)\n\t\treturn NULL;\n\n\treturn queue->head->data;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nvoid *queue_peek_head(struct queue *queue)\n{\n\tif (!queue || !queue->head)\n\t\treturn NULL;\n\n\treturn queue->head->data;\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_remove",
          "args": [
            "default_agents",
            "agent"
          ],
          "line": 175
        },
        "resolved": true,
        "details": {
          "function_name": "queue_remove_uuid",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
          "lines": "526-541",
          "snippet": "static bool queue_remove_uuid(struct queue *queue, bt_uuid_t *uuid)\n{\n\tbt_uuid_t *removed;\n\n\tif (!queue || !uuid)\n\t\treturn false;\n\n\tremoved = queue_remove_if(queue, uuid_match, uuid);\n\n\tif (removed) {\n\t\tfree(removed);\n\t\treturn true;\n\t}\n\n\treturn false;\n}",
          "includes": [
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/eir.h\"",
            "#include \"src/shared/ad.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nstatic bool queue_remove_uuid(struct queue *queue, bt_uuid_t *uuid)\n{\n\tbt_uuid_t *removed;\n\n\tif (!queue || !uuid)\n\t\treturn false;\n\n\tremoved = queue_remove_if(queue, uuid_match, uuid);\n\n\tif (removed) {\n\t\tfree(removed);\n\t\treturn true;\n\t}\n\n\treturn false;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"shared/queue.h\"\n#include \"agent.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"dbus-common.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <sys/ioctl.h>\n#include <sys/socket.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstruct queue *default_agents = NULL;\n\nstatic void remove_default_agent(struct agent *agent)\n{\n\tif (queue_peek_head(default_agents) != agent) {\n\t\tqueue_remove(default_agents, agent);\n\t\treturn;\n\t}\n\n\tqueue_remove(default_agents, agent);\n\n\tagent = queue_peek_head(default_agents);\n\tif (agent)\n\t\tDBG(\"Default agent set to %s %s\", agent->owner, agent->path);\n\telse\n\t\tDBG(\"Default agent cleared\");\n\n\tadapter_foreach(set_io_cap, agent);\n}"
  },
  {
    "function_name": "add_default_agent",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/agent.c",
    "lines": "151-166",
    "snippet": "static bool add_default_agent(struct agent *agent)\n{\n\tif (queue_peek_head(default_agents) == agent)\n\t\treturn true;\n\n\tqueue_remove(default_agents, agent);\n\n\tif (!queue_push_head(default_agents, agent))\n\t\treturn false;\n\n\tDBG(\"Default agent set to %s %s\", agent->owner, agent->path);\n\n\tadapter_foreach(set_io_cap, agent);\n\n\treturn true;\n}",
    "includes": [
      "#include \"shared/queue.h\"",
      "#include \"agent.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"dbus-common.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/socket.h>",
      "#include <stdbool.h>",
      "#include <stdlib.h>",
      "#include <errno.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "struct queue *default_agents = NULL;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "adapter_foreach",
          "args": [
            "set_io_cap",
            "agent"
          ],
          "line": 163
        },
        "resolved": true,
        "details": {
          "function_name": "adapter_foreach",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "8025-8028",
          "snippet": "void adapter_foreach(adapter_cb func, gpointer user_data)\n{\n\tg_slist_foreach(adapters, (GFunc) func, user_data);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static GSList *adapters = NULL;",
            "static gboolean process_auth_queue(gpointer user_data);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic GSList *adapters = NULL;\nstatic gboolean process_auth_queue(gpointer user_data);\n\nvoid adapter_foreach(adapter_cb func, gpointer user_data)\n{\n\tg_slist_foreach(adapters, (GFunc) func, user_data);\n}"
        }
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"Default agent set to %s %s\"",
            "agent->owner",
            "agent->path"
          ],
          "line": 161
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "queue_push_head",
          "args": [
            "default_agents",
            "agent"
          ],
          "line": 158
        },
        "resolved": true,
        "details": {
          "function_name": "queue_push_head",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "110-129",
          "snippet": "bool queue_push_head(struct queue *queue, void *data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn false;\n\n\tentry = queue_entry_new(data);\n\n\tentry->next = queue->head;\n\n\tqueue->head = entry;\n\n\tif (!queue->tail)\n\t\tqueue->tail = entry;\n\n\tqueue->entries++;\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nbool queue_push_head(struct queue *queue, void *data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn false;\n\n\tentry = queue_entry_new(data);\n\n\tentry->next = queue->head;\n\n\tqueue->head = entry;\n\n\tif (!queue->tail)\n\t\tqueue->tail = entry;\n\n\tqueue->entries++;\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_remove",
          "args": [
            "default_agents",
            "agent"
          ],
          "line": 156
        },
        "resolved": true,
        "details": {
          "function_name": "queue_remove_uuid",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
          "lines": "526-541",
          "snippet": "static bool queue_remove_uuid(struct queue *queue, bt_uuid_t *uuid)\n{\n\tbt_uuid_t *removed;\n\n\tif (!queue || !uuid)\n\t\treturn false;\n\n\tremoved = queue_remove_if(queue, uuid_match, uuid);\n\n\tif (removed) {\n\t\tfree(removed);\n\t\treturn true;\n\t}\n\n\treturn false;\n}",
          "includes": [
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/eir.h\"",
            "#include \"src/shared/ad.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nstatic bool queue_remove_uuid(struct queue *queue, bt_uuid_t *uuid)\n{\n\tbt_uuid_t *removed;\n\n\tif (!queue || !uuid)\n\t\treturn false;\n\n\tremoved = queue_remove_if(queue, uuid_match, uuid);\n\n\tif (removed) {\n\t\tfree(removed);\n\t\treturn true;\n\t}\n\n\treturn false;\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_peek_head",
          "args": [
            "default_agents"
          ],
          "line": 153
        },
        "resolved": true,
        "details": {
          "function_name": "queue_peek_head",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "187-193",
          "snippet": "void *queue_peek_head(struct queue *queue)\n{\n\tif (!queue || !queue->head)\n\t\treturn NULL;\n\n\treturn queue->head->data;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nvoid *queue_peek_head(struct queue *queue)\n{\n\tif (!queue || !queue->head)\n\t\treturn NULL;\n\n\treturn queue->head->data;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"shared/queue.h\"\n#include \"agent.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"dbus-common.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <sys/ioctl.h>\n#include <sys/socket.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstruct queue *default_agents = NULL;\n\nstatic bool add_default_agent(struct agent *agent)\n{\n\tif (queue_peek_head(default_agents) == agent)\n\t\treturn true;\n\n\tqueue_remove(default_agents, agent);\n\n\tif (!queue_push_head(default_agents, agent))\n\t\treturn false;\n\n\tDBG(\"Default agent set to %s %s\", agent->owner, agent->path);\n\n\tadapter_foreach(set_io_cap, agent);\n\n\treturn true;\n}"
  },
  {
    "function_name": "set_io_cap",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/agent.c",
    "lines": "138-149",
    "snippet": "static void set_io_cap(struct btd_adapter *adapter, gpointer user_data)\n{\n\tstruct agent *agent = user_data;\n\tuint8_t io_cap;\n\n\tif (agent)\n\t\tio_cap = agent->capability;\n\telse\n\t\tio_cap = IO_CAPABILITY_INVALID;\n\n\tadapter_set_io_capability(adapter, io_cap);\n}",
    "includes": [
      "#include \"shared/queue.h\"",
      "#include \"agent.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"dbus-common.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/socket.h>",
      "#include <stdbool.h>",
      "#include <stdlib.h>",
      "#include <errno.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "adapter_set_io_capability",
          "args": [
            "adapter",
            "io_cap"
          ],
          "line": 148
        },
        "resolved": true,
        "details": {
          "function_name": "adapter_set_io_capability",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "7843-7869",
          "snippet": "int adapter_set_io_capability(struct btd_adapter *adapter, uint8_t io_cap)\n{\n\tstruct mgmt_cp_set_io_capability cp;\n\n\tif (!main_opts.pairable) {\n\t\tif (io_cap == IO_CAPABILITY_INVALID) {\n\t\t\tif (adapter->current_settings & MGMT_SETTING_BONDABLE)\n\t\t\t\tset_mode(adapter, MGMT_OP_SET_BONDABLE, 0x00);\n\n\t\t\treturn 0;\n\t\t}\n\n\t\tif (!(adapter->current_settings & MGMT_SETTING_BONDABLE))\n\t\t\tset_mode(adapter, MGMT_OP_SET_BONDABLE, 0x01);\n\t} else if (io_cap == IO_CAPABILITY_INVALID)\n\t\tio_cap = IO_CAPABILITY_NOINPUTNOOUTPUT;\n\n\tmemset(&cp, 0, sizeof(cp));\n\tcp.io_capability = io_cap;\n\n\tif (mgmt_send(adapter->mgmt, MGMT_OP_SET_IO_CAPABILITY,\n\t\t\t\tadapter->dev_id, sizeof(cp), &cp,\n\t\t\t\tNULL, NULL, NULL) > 0)\n\t\treturn 0;\n\n\treturn -EIO;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void trigger_pairable_timeout(struct btd_adapter *adapter);",
            "static void adapter_start(struct btd_adapter *adapter);",
            "static void adapter_stop(struct btd_adapter *adapter);",
            "static void trigger_passive_scanning(struct btd_adapter *adapter);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void trigger_pairable_timeout(struct btd_adapter *adapter);\nstatic void adapter_start(struct btd_adapter *adapter);\nstatic void adapter_stop(struct btd_adapter *adapter);\nstatic void trigger_passive_scanning(struct btd_adapter *adapter);\n\nint adapter_set_io_capability(struct btd_adapter *adapter, uint8_t io_cap)\n{\n\tstruct mgmt_cp_set_io_capability cp;\n\n\tif (!main_opts.pairable) {\n\t\tif (io_cap == IO_CAPABILITY_INVALID) {\n\t\t\tif (adapter->current_settings & MGMT_SETTING_BONDABLE)\n\t\t\t\tset_mode(adapter, MGMT_OP_SET_BONDABLE, 0x00);\n\n\t\t\treturn 0;\n\t\t}\n\n\t\tif (!(adapter->current_settings & MGMT_SETTING_BONDABLE))\n\t\t\tset_mode(adapter, MGMT_OP_SET_BONDABLE, 0x01);\n\t} else if (io_cap == IO_CAPABILITY_INVALID)\n\t\tio_cap = IO_CAPABILITY_NOINPUTNOOUTPUT;\n\n\tmemset(&cp, 0, sizeof(cp));\n\tcp.io_capability = io_cap;\n\n\tif (mgmt_send(adapter->mgmt, MGMT_OP_SET_IO_CAPABILITY,\n\t\t\t\tadapter->dev_id, sizeof(cp), &cp,\n\t\t\t\tNULL, NULL, NULL) > 0)\n\t\treturn 0;\n\n\treturn -EIO;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"shared/queue.h\"\n#include \"agent.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"dbus-common.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <sys/ioctl.h>\n#include <sys/socket.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void set_io_cap(struct btd_adapter *adapter, gpointer user_data)\n{\n\tstruct agent *agent = user_data;\n\tuint8_t io_cap;\n\n\tif (agent)\n\t\tio_cap = agent->capability;\n\telse\n\t\tio_cap = IO_CAPABILITY_INVALID;\n\n\tadapter_set_io_capability(adapter, io_cap);\n}"
  },
  {
    "function_name": "agent_request_free",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/agent.c",
    "lines": "125-136",
    "snippet": "static void agent_request_free(struct agent_request *req, gboolean destroy)\n{\n\tif (req->msg)\n\t\tdbus_message_unref(req->msg);\n\tif (req->call)\n\t\tdbus_pending_call_unref(req->call);\n\tif (req->agent && req->agent->request)\n\t\treq->agent->request = NULL;\n\tif (destroy && req->destroy)\n\t\treq->destroy(req->user_data);\n\tg_free(req);\n}",
    "includes": [
      "#include \"shared/queue.h\"",
      "#include \"agent.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"dbus-common.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/socket.h>",
      "#include <stdbool.h>",
      "#include <stdlib.h>",
      "#include <errno.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_free",
          "args": [
            "req"
          ],
          "line": 135
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "req->destroy",
          "args": [
            "req->user_data"
          ],
          "line": 134
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_pending_call_unref",
          "args": [
            "req->call"
          ],
          "line": 130
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_unref",
          "args": [
            "req->msg"
          ],
          "line": 128
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"shared/queue.h\"\n#include \"agent.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"dbus-common.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <sys/ioctl.h>\n#include <sys/socket.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void agent_request_free(struct agent_request *req, gboolean destroy)\n{\n\tif (req->msg)\n\t\tdbus_message_unref(req->msg);\n\tif (req->call)\n\t\tdbus_pending_call_unref(req->call);\n\tif (req->agent && req->agent->request)\n\t\treq->agent->request = NULL;\n\tif (destroy && req->destroy)\n\t\treq->destroy(req->user_data);\n\tg_free(req);\n}"
  },
  {
    "function_name": "send_cancel_request",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/agent.c",
    "lines": "106-123",
    "snippet": "static int send_cancel_request(struct agent_request *req)\n{\n\tDBusMessage *message;\n\n\tDBG(\"Sending Cancel request to %s, %s\", req->agent->owner,\n\t\t\t\t\t\t\treq->agent->path);\n\n\tmessage = dbus_message_new_method_call(req->agent->owner, req->agent->path,\n\t\t\t\t\t\tAGENT_INTERFACE, \"Cancel\");\n\tif (message == NULL) {\n\t\terror(\"Couldn't allocate D-Bus message\");\n\t\treturn -ENOMEM;\n\t}\n\n\tg_dbus_send_message(btd_get_dbus_connection(), message);\n\n\treturn 0;\n}",
    "includes": [
      "#include \"shared/queue.h\"",
      "#include \"agent.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"dbus-common.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/socket.h>",
      "#include <stdbool.h>",
      "#include <stdlib.h>",
      "#include <errno.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define AGENT_INTERFACE \"org.bluez.Agent1\""
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_dbus_send_message",
          "args": [
            "btd_get_dbus_connection()",
            "message"
          ],
          "line": 120
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_get_dbus_connection",
          "args": [],
          "line": 120
        },
        "resolved": true,
        "details": {
          "function_name": "btd_get_dbus_connection",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/dbus-common.c",
          "lines": "61-64",
          "snippet": "DBusConnection *btd_get_dbus_connection(void)\n{\n\treturn connection;\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <stdint.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static DBusConnection *connection = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <stdint.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *connection = NULL;\n\nDBusConnection *btd_get_dbus_connection(void)\n{\n\treturn connection;\n}"
        }
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"Couldn't allocate D-Bus message\""
          ],
          "line": 116
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_not_ready",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "118-122",
          "snippet": "DBusMessage *btd_error_not_ready(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".NotReady\",\n\t\t\t\t\t\"Resource Not Ready\");\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_not_ready(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".NotReady\",\n\t\t\t\t\t\"Resource Not Ready\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_message_new_method_call",
          "args": [
            "req->agent->owner",
            "req->agent->path",
            "AGENT_INTERFACE",
            "\"Cancel\""
          ],
          "line": 113
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"Sending Cancel request to %s, %s\"",
            "req->agent->owner",
            "req->agent->path"
          ],
          "line": 110
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"shared/queue.h\"\n#include \"agent.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"dbus-common.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <sys/ioctl.h>\n#include <sys/socket.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\n#define AGENT_INTERFACE \"org.bluez.Agent1\"\n\nstatic int send_cancel_request(struct agent_request *req)\n{\n\tDBusMessage *message;\n\n\tDBG(\"Sending Cancel request to %s, %s\", req->agent->owner,\n\t\t\t\t\t\t\treq->agent->path);\n\n\tmessage = dbus_message_new_method_call(req->agent->owner, req->agent->path,\n\t\t\t\t\t\tAGENT_INTERFACE, \"Cancel\");\n\tif (message == NULL) {\n\t\terror(\"Couldn't allocate D-Bus message\");\n\t\treturn -ENOMEM;\n\t}\n\n\tg_dbus_send_message(btd_get_dbus_connection(), message);\n\n\treturn 0;\n}"
  },
  {
    "function_name": "agent_release",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/agent.c",
    "lines": "87-104",
    "snippet": "static void agent_release(struct agent *agent)\n{\n\tDBusMessage *message;\n\n\tDBG(\"Releasing agent %s, %s\", agent->owner, agent->path);\n\n\tif (agent->request)\n\t\tagent_cancel(agent);\n\n\tmessage = dbus_message_new_method_call(agent->owner, agent->path,\n\t\t\t\t\t\tAGENT_INTERFACE, \"Release\");\n\tif (message == NULL) {\n\t\terror(\"Couldn't allocate D-Bus message\");\n\t\treturn;\n\t}\n\n\tg_dbus_send_message(btd_get_dbus_connection(), message);\n}",
    "includes": [
      "#include \"shared/queue.h\"",
      "#include \"agent.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"dbus-common.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/socket.h>",
      "#include <stdbool.h>",
      "#include <stdlib.h>",
      "#include <errno.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define AGENT_INTERFACE \"org.bluez.Agent1\""
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_dbus_send_message",
          "args": [
            "btd_get_dbus_connection()",
            "message"
          ],
          "line": 103
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_get_dbus_connection",
          "args": [],
          "line": 103
        },
        "resolved": true,
        "details": {
          "function_name": "btd_get_dbus_connection",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/dbus-common.c",
          "lines": "61-64",
          "snippet": "DBusConnection *btd_get_dbus_connection(void)\n{\n\treturn connection;\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <stdint.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static DBusConnection *connection = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <stdint.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *connection = NULL;\n\nDBusConnection *btd_get_dbus_connection(void)\n{\n\treturn connection;\n}"
        }
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"Couldn't allocate D-Bus message\""
          ],
          "line": 99
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_not_ready",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "118-122",
          "snippet": "DBusMessage *btd_error_not_ready(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".NotReady\",\n\t\t\t\t\t\"Resource Not Ready\");\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_not_ready(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".NotReady\",\n\t\t\t\t\t\"Resource Not Ready\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_message_new_method_call",
          "args": [
            "agent->owner",
            "agent->path",
            "AGENT_INTERFACE",
            "\"Release\""
          ],
          "line": 96
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "agent_cancel",
          "args": [
            "agent"
          ],
          "line": 94
        },
        "resolved": true,
        "details": {
          "function_name": "agent_cancel",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/agent.c",
          "lines": "317-331",
          "snippet": "int agent_cancel(struct agent *agent)\n{\n\tif (!agent->request)\n\t\treturn -EINVAL;\n\n\tif (agent->request->call) {\n\t\tdbus_pending_call_cancel(agent->request->call);\n\t\tsend_cancel_request(agent->request);\n\t}\n\n\tagent_request_free(agent->request, TRUE);\n\tagent->request = NULL;\n\n\treturn 0;\n}",
          "includes": [
            "#include \"shared/queue.h\"",
            "#include \"agent.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"dbus-common.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/socket.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"shared/queue.h\"\n#include \"agent.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"dbus-common.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <sys/ioctl.h>\n#include <sys/socket.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nint agent_cancel(struct agent *agent)\n{\n\tif (!agent->request)\n\t\treturn -EINVAL;\n\n\tif (agent->request->call) {\n\t\tdbus_pending_call_cancel(agent->request->call);\n\t\tsend_cancel_request(agent->request);\n\t}\n\n\tagent_request_free(agent->request, TRUE);\n\tagent->request = NULL;\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"Releasing agent %s, %s\"",
            "agent->owner",
            "agent->path"
          ],
          "line": 91
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"shared/queue.h\"\n#include \"agent.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"dbus-common.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <sys/ioctl.h>\n#include <sys/socket.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\n#define AGENT_INTERFACE \"org.bluez.Agent1\"\n\nstatic void agent_release(struct agent *agent)\n{\n\tDBusMessage *message;\n\n\tDBG(\"Releasing agent %s, %s\", agent->owner, agent->path);\n\n\tif (agent->request)\n\t\tagent_cancel(agent);\n\n\tmessage = dbus_message_new_method_call(agent->owner, agent->path,\n\t\t\t\t\t\tAGENT_INTERFACE, \"Release\");\n\tif (message == NULL) {\n\t\terror(\"Couldn't allocate D-Bus message\");\n\t\treturn;\n\t}\n\n\tg_dbus_send_message(btd_get_dbus_connection(), message);\n}"
  }
]