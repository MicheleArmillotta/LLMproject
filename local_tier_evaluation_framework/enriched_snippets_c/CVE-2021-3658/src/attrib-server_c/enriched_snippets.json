[
  {
    "function_name": "attrib_gap_set",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/attrib-server.c",
    "lines": "1627-1654",
    "snippet": "int attrib_gap_set(struct btd_adapter *adapter, uint16_t uuid,\n\t\t\t\t\tconst uint8_t *value, size_t len)\n{\n\tstruct gatt_server *server;\n\tuint16_t handle;\n\tGSList *l;\n\n\tl = g_slist_find_custom(servers, adapter, adapter_cmp);\n\tif (l == NULL)\n\t\treturn -ENOENT;\n\n\tserver = l->data;\n\n\t/* FIXME: Missing Privacy and Reconnection Address */\n\n\tswitch (uuid) {\n\tcase GATT_CHARAC_DEVICE_NAME:\n\t\thandle = server->name_handle;\n\t\tbreak;\n\tcase GATT_CHARAC_APPEARANCE:\n\t\thandle = server->appearance_handle;\n\t\tbreak;\n\tdefault:\n\t\treturn -ENOSYS;\n\t}\n\n\treturn attrib_db_update(adapter, handle, NULL, value, len, NULL);\n}",
    "includes": [
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"attrib/att-database.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"attrib/att.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"backtrace.h\"",
      "#include \"log.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <sys/stat.h>",
      "#include <glib.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdbool.h>",
      "#include <stdint.h>",
      "#include <errno.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static GSList *servers = NULL;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "attrib_db_update",
          "args": [
            "adapter",
            "handle",
            "NULL",
            "value",
            "len",
            "NULL"
          ],
          "line": 1653
        },
        "resolved": true,
        "details": {
          "function_name": "attrib_db_update",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/attrib-server.c",
          "lines": "1557-1596",
          "snippet": "int attrib_db_update(struct btd_adapter *adapter, uint16_t handle,\n\t\t\t\t\tbt_uuid_t *uuid, const uint8_t *value,\n\t\t\t\t\tsize_t len, struct attribute **attr)\n{\n\tstruct gatt_server *server;\n\tstruct attribute *a;\n\tGSList *l;\n\tGList *dl;\n\tguint h = handle;\n\n\tl = g_slist_find_custom(servers, adapter, adapter_cmp);\n\tif (l == NULL)\n\t\treturn -ENOENT;\n\n\tserver = l->data;\n\n\tDBG(\"handle=0x%04x\", handle);\n\n\tdl = g_list_find_custom(server->database, GUINT_TO_POINTER(h),\n\t\t\t\t\t\t\t\thandle_cmp);\n\tif (dl == NULL)\n\t\treturn -ENOENT;\n\n\ta = dl->data;\n\n\ta->data = g_try_realloc(a->data, len);\n\tif (len && a->data == NULL)\n\t\treturn -ENOMEM;\n\n\ta->len = len;\n\tmemcpy(a->data, value, len);\n\n\tif (uuid != NULL)\n\t\ta->uuid = *uuid;\n\n\tif (attr)\n\t\t*attr = a;\n\n\treturn 0;\n}",
          "includes": [
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"attrib/att-database.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"backtrace.h\"",
            "#include \"log.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <sys/stat.h>",
            "#include <glib.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdbool.h>",
            "#include <stdint.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static GSList *servers = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"attrib/att-database.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"src/shared/util.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <sys/stat.h>\n#include <glib.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdbool.h>\n#include <stdint.h>\n#include <errno.h>\n#include <config.h>\n\nstatic GSList *servers = NULL;\n\nint attrib_db_update(struct btd_adapter *adapter, uint16_t handle,\n\t\t\t\t\tbt_uuid_t *uuid, const uint8_t *value,\n\t\t\t\t\tsize_t len, struct attribute **attr)\n{\n\tstruct gatt_server *server;\n\tstruct attribute *a;\n\tGSList *l;\n\tGList *dl;\n\tguint h = handle;\n\n\tl = g_slist_find_custom(servers, adapter, adapter_cmp);\n\tif (l == NULL)\n\t\treturn -ENOENT;\n\n\tserver = l->data;\n\n\tDBG(\"handle=0x%04x\", handle);\n\n\tdl = g_list_find_custom(server->database, GUINT_TO_POINTER(h),\n\t\t\t\t\t\t\t\thandle_cmp);\n\tif (dl == NULL)\n\t\treturn -ENOENT;\n\n\ta = dl->data;\n\n\ta->data = g_try_realloc(a->data, len);\n\tif (len && a->data == NULL)\n\t\treturn -ENOMEM;\n\n\ta->len = len;\n\tmemcpy(a->data, value, len);\n\n\tif (uuid != NULL)\n\t\ta->uuid = *uuid;\n\n\tif (attr)\n\t\t*attr = a;\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_slist_find_custom",
          "args": [
            "servers",
            "adapter",
            "adapter_cmp"
          ],
          "line": 1634
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"attrib/att-database.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"src/shared/util.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <sys/stat.h>\n#include <glib.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdbool.h>\n#include <stdint.h>\n#include <errno.h>\n#include <config.h>\n\nstatic GSList *servers = NULL;\n\nint attrib_gap_set(struct btd_adapter *adapter, uint16_t uuid,\n\t\t\t\t\tconst uint8_t *value, size_t len)\n{\n\tstruct gatt_server *server;\n\tuint16_t handle;\n\tGSList *l;\n\n\tl = g_slist_find_custom(servers, adapter, adapter_cmp);\n\tif (l == NULL)\n\t\treturn -ENOENT;\n\n\tserver = l->data;\n\n\t/* FIXME: Missing Privacy and Reconnection Address */\n\n\tswitch (uuid) {\n\tcase GATT_CHARAC_DEVICE_NAME:\n\t\thandle = server->name_handle;\n\t\tbreak;\n\tcase GATT_CHARAC_APPEARANCE:\n\t\thandle = server->appearance_handle;\n\t\tbreak;\n\tdefault:\n\t\treturn -ENOSYS;\n\t}\n\n\treturn attrib_db_update(adapter, handle, NULL, value, len, NULL);\n}"
  },
  {
    "function_name": "attrib_db_del",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/attrib-server.c",
    "lines": "1598-1625",
    "snippet": "int attrib_db_del(struct btd_adapter *adapter, uint16_t handle)\n{\n\tstruct gatt_server *server;\n\tstruct attribute *a;\n\tGSList *l;\n\tGList *dl;\n\tguint h = handle;\n\n\tl = g_slist_find_custom(servers, adapter, adapter_cmp);\n\tif (l == NULL)\n\t\treturn -ENOENT;\n\n\tserver = l->data;\n\n\tDBG(\"handle=0x%04x\", handle);\n\n\tdl = g_list_find_custom(server->database, GUINT_TO_POINTER(h),\n\t\t\t\t\t\t\t\thandle_cmp);\n\tif (dl == NULL)\n\t\treturn -ENOENT;\n\n\ta = dl->data;\n\tserver->database = g_list_remove(server->database, a);\n\tg_free(a->data);\n\tg_free(a);\n\n\treturn 0;\n}",
    "includes": [
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"attrib/att-database.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"attrib/att.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"backtrace.h\"",
      "#include \"log.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <sys/stat.h>",
      "#include <glib.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdbool.h>",
      "#include <stdint.h>",
      "#include <errno.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static GSList *servers = NULL;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_free",
          "args": [
            "a"
          ],
          "line": 1622
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_free",
          "args": [
            "a->data"
          ],
          "line": 1621
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_list_remove",
          "args": [
            "server->database",
            "a"
          ],
          "line": 1620
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_list_find_custom",
          "args": [
            "server->database",
            "GUINT_TO_POINTER(h)",
            "handle_cmp"
          ],
          "line": 1614
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "GUINT_TO_POINTER",
          "args": [
            "h"
          ],
          "line": 1614
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"handle=0x%04x\"",
            "handle"
          ],
          "line": 1612
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_slist_find_custom",
          "args": [
            "servers",
            "adapter",
            "adapter_cmp"
          ],
          "line": 1606
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"attrib/att-database.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"src/shared/util.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <sys/stat.h>\n#include <glib.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdbool.h>\n#include <stdint.h>\n#include <errno.h>\n#include <config.h>\n\nstatic GSList *servers = NULL;\n\nint attrib_db_del(struct btd_adapter *adapter, uint16_t handle)\n{\n\tstruct gatt_server *server;\n\tstruct attribute *a;\n\tGSList *l;\n\tGList *dl;\n\tguint h = handle;\n\n\tl = g_slist_find_custom(servers, adapter, adapter_cmp);\n\tif (l == NULL)\n\t\treturn -ENOENT;\n\n\tserver = l->data;\n\n\tDBG(\"handle=0x%04x\", handle);\n\n\tdl = g_list_find_custom(server->database, GUINT_TO_POINTER(h),\n\t\t\t\t\t\t\t\thandle_cmp);\n\tif (dl == NULL)\n\t\treturn -ENOENT;\n\n\ta = dl->data;\n\tserver->database = g_list_remove(server->database, a);\n\tg_free(a->data);\n\tg_free(a);\n\n\treturn 0;\n}"
  },
  {
    "function_name": "attrib_db_update",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/attrib-server.c",
    "lines": "1557-1596",
    "snippet": "int attrib_db_update(struct btd_adapter *adapter, uint16_t handle,\n\t\t\t\t\tbt_uuid_t *uuid, const uint8_t *value,\n\t\t\t\t\tsize_t len, struct attribute **attr)\n{\n\tstruct gatt_server *server;\n\tstruct attribute *a;\n\tGSList *l;\n\tGList *dl;\n\tguint h = handle;\n\n\tl = g_slist_find_custom(servers, adapter, adapter_cmp);\n\tif (l == NULL)\n\t\treturn -ENOENT;\n\n\tserver = l->data;\n\n\tDBG(\"handle=0x%04x\", handle);\n\n\tdl = g_list_find_custom(server->database, GUINT_TO_POINTER(h),\n\t\t\t\t\t\t\t\thandle_cmp);\n\tif (dl == NULL)\n\t\treturn -ENOENT;\n\n\ta = dl->data;\n\n\ta->data = g_try_realloc(a->data, len);\n\tif (len && a->data == NULL)\n\t\treturn -ENOMEM;\n\n\ta->len = len;\n\tmemcpy(a->data, value, len);\n\n\tif (uuid != NULL)\n\t\ta->uuid = *uuid;\n\n\tif (attr)\n\t\t*attr = a;\n\n\treturn 0;\n}",
    "includes": [
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"attrib/att-database.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"attrib/att.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"backtrace.h\"",
      "#include \"log.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <sys/stat.h>",
      "#include <glib.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdbool.h>",
      "#include <stdint.h>",
      "#include <errno.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static GSList *servers = NULL;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "memcpy",
          "args": [
            "a->data",
            "value",
            "len"
          ],
          "line": 1587
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_try_realloc",
          "args": [
            "a->data",
            "len"
          ],
          "line": 1582
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_list_find_custom",
          "args": [
            "server->database",
            "GUINT_TO_POINTER(h)",
            "handle_cmp"
          ],
          "line": 1575
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "GUINT_TO_POINTER",
          "args": [
            "h"
          ],
          "line": 1575
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"handle=0x%04x\"",
            "handle"
          ],
          "line": 1573
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_slist_find_custom",
          "args": [
            "servers",
            "adapter",
            "adapter_cmp"
          ],
          "line": 1567
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"attrib/att-database.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"src/shared/util.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <sys/stat.h>\n#include <glib.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdbool.h>\n#include <stdint.h>\n#include <errno.h>\n#include <config.h>\n\nstatic GSList *servers = NULL;\n\nint attrib_db_update(struct btd_adapter *adapter, uint16_t handle,\n\t\t\t\t\tbt_uuid_t *uuid, const uint8_t *value,\n\t\t\t\t\tsize_t len, struct attribute **attr)\n{\n\tstruct gatt_server *server;\n\tstruct attribute *a;\n\tGSList *l;\n\tGList *dl;\n\tguint h = handle;\n\n\tl = g_slist_find_custom(servers, adapter, adapter_cmp);\n\tif (l == NULL)\n\t\treturn -ENOENT;\n\n\tserver = l->data;\n\n\tDBG(\"handle=0x%04x\", handle);\n\n\tdl = g_list_find_custom(server->database, GUINT_TO_POINTER(h),\n\t\t\t\t\t\t\t\thandle_cmp);\n\tif (dl == NULL)\n\t\treturn -ENOENT;\n\n\ta = dl->data;\n\n\ta->data = g_try_realloc(a->data, len);\n\tif (len && a->data == NULL)\n\t\treturn -ENOMEM;\n\n\ta->len = len;\n\tmemcpy(a->data, value, len);\n\n\tif (uuid != NULL)\n\t\ta->uuid = *uuid;\n\n\tif (attr)\n\t\t*attr = a;\n\n\treturn 0;\n}"
  },
  {
    "function_name": "attrib_db_add",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/attrib-server.c",
    "lines": "1542-1555",
    "snippet": "struct attribute *attrib_db_add(struct btd_adapter *adapter, uint16_t handle,\n\t\t\t\t\tbt_uuid_t *uuid, int read_req,\n\t\t\t\t\tint write_req, const uint8_t *value,\n\t\t\t\t\tsize_t len)\n{\n\tGSList *l;\n\n\tl = g_slist_find_custom(servers, adapter, adapter_cmp);\n\tif (l == NULL)\n\t\treturn NULL;\n\n\treturn attrib_db_add_new(l->data, handle, uuid, read_req, write_req,\n\t\t\t\t\t\t\t\tvalue, len);\n}",
    "includes": [
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"attrib/att-database.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"attrib/att.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"backtrace.h\"",
      "#include \"log.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <sys/stat.h>",
      "#include <glib.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdbool.h>",
      "#include <stdint.h>",
      "#include <errno.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static GSList *servers = NULL;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "attrib_db_add_new",
          "args": [
            "l->data",
            "handle",
            "uuid",
            "read_req",
            "write_req",
            "value",
            "len"
          ],
          "line": 1553
        },
        "resolved": true,
        "details": {
          "function_name": "attrib_db_add_new",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/attrib-server.c",
          "lines": "339-365",
          "snippet": "static struct attribute *attrib_db_add_new(struct gatt_server *server,\n\t\t\t\tuint16_t handle, bt_uuid_t *uuid,\n\t\t\t\tint read_req, int write_req,\n\t\t\t\tconst uint8_t *value, size_t len)\n{\n\tstruct attribute *a;\n\tguint h = handle;\n\n\tDBG(\"handle=0x%04x\", handle);\n\n\tif (g_list_find_custom(server->database, GUINT_TO_POINTER(h),\n\t\t\t\t\t\t\t\thandle_cmp))\n\t\treturn NULL;\n\n\ta = g_new0(struct attribute, 1);\n\ta->len = len;\n\ta->data = g_memdup(value, len);\n\ta->handle = handle;\n\ta->uuid = *uuid;\n\ta->read_req = read_req;\n\ta->write_req = write_req;\n\n\tserver->database = g_list_insert_sorted(server->database, a,\n\t\t\t\t\t\t\t\tattribute_cmp);\n\n\treturn a;\n}",
          "includes": [
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"attrib/att-database.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"backtrace.h\"",
            "#include \"log.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <sys/stat.h>",
            "#include <glib.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdbool.h>",
            "#include <stdint.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"attrib/att-database.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"src/shared/util.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <sys/stat.h>\n#include <glib.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdbool.h>\n#include <stdint.h>\n#include <errno.h>\n#include <config.h>\n\nstatic struct attribute *attrib_db_add_new(struct gatt_server *server,\n\t\t\t\tuint16_t handle, bt_uuid_t *uuid,\n\t\t\t\tint read_req, int write_req,\n\t\t\t\tconst uint8_t *value, size_t len)\n{\n\tstruct attribute *a;\n\tguint h = handle;\n\n\tDBG(\"handle=0x%04x\", handle);\n\n\tif (g_list_find_custom(server->database, GUINT_TO_POINTER(h),\n\t\t\t\t\t\t\t\thandle_cmp))\n\t\treturn NULL;\n\n\ta = g_new0(struct attribute, 1);\n\ta->len = len;\n\ta->data = g_memdup(value, len);\n\ta->handle = handle;\n\ta->uuid = *uuid;\n\ta->read_req = read_req;\n\ta->write_req = write_req;\n\n\tserver->database = g_list_insert_sorted(server->database, a,\n\t\t\t\t\t\t\t\tattribute_cmp);\n\n\treturn a;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_slist_find_custom",
          "args": [
            "servers",
            "adapter",
            "adapter_cmp"
          ],
          "line": 1549
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"attrib/att-database.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"src/shared/util.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <sys/stat.h>\n#include <glib.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdbool.h>\n#include <stdint.h>\n#include <errno.h>\n#include <config.h>\n\nstatic GSList *servers = NULL;\n\nstruct attribute *attrib_db_add(struct btd_adapter *adapter, uint16_t handle,\n\t\t\t\t\tbt_uuid_t *uuid, int read_req,\n\t\t\t\t\tint write_req, const uint8_t *value,\n\t\t\t\t\tsize_t len)\n{\n\tGSList *l;\n\n\tl = g_slist_find_custom(servers, adapter, adapter_cmp);\n\tif (l == NULL)\n\t\treturn NULL;\n\n\treturn attrib_db_add_new(l->data, handle, uuid, read_req, write_req,\n\t\t\t\t\t\t\t\tvalue, len);\n}"
  },
  {
    "function_name": "attrib_db_find_avail",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/attrib-server.c",
    "lines": "1523-1540",
    "snippet": "uint16_t attrib_db_find_avail(struct btd_adapter *adapter, bt_uuid_t *svc_uuid,\n\t\t\t\t\t\t\t\tuint16_t nitems)\n{\n\tbtd_assert(nitems > 0);\n\n\tif (svc_uuid->type == BT_UUID16)\n\t\treturn find_uuid16_avail(adapter, nitems);\n\telse if (svc_uuid->type == BT_UUID128)\n\t\treturn find_uuid128_avail(adapter, nitems);\n\telse {\n\t\tchar uuidstr[MAX_LEN_UUID_STR];\n\n\t\tbt_uuid_to_string(svc_uuid, uuidstr, MAX_LEN_UUID_STR);\n\t\terror(\"Service uuid: %s is neither a 16-bit nor a 128-bit uuid\",\n\t\t\t\t\t\t\t\tuuidstr);\n\t\treturn 0;\n\t}\n}",
    "includes": [
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"attrib/att-database.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"attrib/att.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"backtrace.h\"",
      "#include \"log.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <sys/stat.h>",
      "#include <glib.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdbool.h>",
      "#include <stdint.h>",
      "#include <errno.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"Service uuid: %s is neither a 16-bit nor a 128-bit uuid\"",
            "uuidstr"
          ],
          "line": 1536
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_failed",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "124-128",
          "snippet": "DBusMessage *btd_error_failed(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE\n\t\t\t\t\t\".Failed\", \"%s\", str);\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_failed(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE\n\t\t\t\t\t\".Failed\", \"%s\", str);\n}"
        }
      },
      {
        "call_info": {
          "callee": "bt_uuid_to_string",
          "args": [
            "svc_uuid",
            "uuidstr",
            "MAX_LEN_UUID_STR"
          ],
          "line": 1535
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "find_uuid128_avail",
          "args": [
            "adapter",
            "nitems"
          ],
          "line": 1531
        },
        "resolved": true,
        "details": {
          "function_name": "find_uuid128_avail",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/attrib-server.c",
          "lines": "1477-1521",
          "snippet": "static uint16_t find_uuid128_avail(struct btd_adapter *adapter, uint16_t nitems)\n{\n\tuint16_t handle = 0, end = 0xffff;\n\tstruct gatt_server *server;\n\tGList *dl;\n\tGSList *l;\n\n\tl = g_slist_find_custom(servers, adapter, adapter_cmp);\n\tif (l == NULL)\n\t\treturn 0;\n\n\tserver = l->data;\n\tif (server->database == NULL)\n\t\treturn 0xffff - nitems + 1;\n\n\tfor (dl = g_list_last(server->database); dl; dl = dl->prev) {\n\t\tstruct attribute *a = dl->data;\n\n\t\tif (handle == 0)\n\t\t\thandle = a->handle;\n\n\t\tif (bt_uuid_cmp(&a->uuid, &prim_uuid) != 0 &&\n\t\t\t\tbt_uuid_cmp(&a->uuid, &snd_uuid) != 0)\n\t\t\tcontinue;\n\n\t\tif (end - handle >= nitems)\n\t\t\treturn end - nitems + 1;\n\n\t\tif (a->len == 2) {\n\t\t\t/* 16 bit UUID service definition */\n\t\t\treturn 0;\n\t\t}\n\n\t\tif (a->handle == 0x0001)\n\t\t\treturn 0;\n\n\t\tend = a->handle - 1;\n\t\thandle = 0;\n\t}\n\n\tif (end - 0x0001 >= nitems)\n\t\treturn end - nitems + 1;\n\n\treturn 0;\n}",
          "includes": [
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"attrib/att-database.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"backtrace.h\"",
            "#include \"log.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <sys/stat.h>",
            "#include <glib.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdbool.h>",
            "#include <stdint.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static GSList *servers = NULL;",
            "static bt_uuid_t prim_uuid = {\n\t\t\t.type = BT_UUID16,\n\t\t\t.value.u16 = GATT_PRIM_SVC_UUID\n};",
            "static bt_uuid_t snd_uuid = {\n\t\t\t.type = BT_UUID16,\n\t\t\t.value.u16 = GATT_SND_SVC_UUID\n};"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"attrib/att-database.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"src/shared/util.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <sys/stat.h>\n#include <glib.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdbool.h>\n#include <stdint.h>\n#include <errno.h>\n#include <config.h>\n\nstatic GSList *servers = NULL;\nstatic bt_uuid_t prim_uuid = {\n\t\t\t.type = BT_UUID16,\n\t\t\t.value.u16 = GATT_PRIM_SVC_UUID\n};\nstatic bt_uuid_t snd_uuid = {\n\t\t\t.type = BT_UUID16,\n\t\t\t.value.u16 = GATT_SND_SVC_UUID\n};\n\nstatic uint16_t find_uuid128_avail(struct btd_adapter *adapter, uint16_t nitems)\n{\n\tuint16_t handle = 0, end = 0xffff;\n\tstruct gatt_server *server;\n\tGList *dl;\n\tGSList *l;\n\n\tl = g_slist_find_custom(servers, adapter, adapter_cmp);\n\tif (l == NULL)\n\t\treturn 0;\n\n\tserver = l->data;\n\tif (server->database == NULL)\n\t\treturn 0xffff - nitems + 1;\n\n\tfor (dl = g_list_last(server->database); dl; dl = dl->prev) {\n\t\tstruct attribute *a = dl->data;\n\n\t\tif (handle == 0)\n\t\t\thandle = a->handle;\n\n\t\tif (bt_uuid_cmp(&a->uuid, &prim_uuid) != 0 &&\n\t\t\t\tbt_uuid_cmp(&a->uuid, &snd_uuid) != 0)\n\t\t\tcontinue;\n\n\t\tif (end - handle >= nitems)\n\t\t\treturn end - nitems + 1;\n\n\t\tif (a->len == 2) {\n\t\t\t/* 16 bit UUID service definition */\n\t\t\treturn 0;\n\t\t}\n\n\t\tif (a->handle == 0x0001)\n\t\t\treturn 0;\n\n\t\tend = a->handle - 1;\n\t\thandle = 0;\n\t}\n\n\tif (end - 0x0001 >= nitems)\n\t\treturn end - nitems + 1;\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "find_uuid16_avail",
          "args": [
            "adapter",
            "nitems"
          ],
          "line": 1529
        },
        "resolved": true,
        "details": {
          "function_name": "find_uuid16_avail",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/attrib-server.c",
          "lines": "1435-1475",
          "snippet": "static uint16_t find_uuid16_avail(struct btd_adapter *adapter, uint16_t nitems)\n{\n\tstruct gatt_server *server;\n\tuint16_t handle;\n\tGSList *l;\n\tGList *dl;\n\n\tl = g_slist_find_custom(servers, adapter, adapter_cmp);\n\tif (l == NULL)\n\t\treturn 0;\n\n\tserver = l->data;\n\tif (server->database == NULL)\n\t\treturn 0x0001;\n\n\tfor (dl = server->database, handle = 0x0001; dl; dl = dl->next) {\n\t\tstruct attribute *a = dl->data;\n\n\t\tif ((bt_uuid_cmp(&a->uuid, &prim_uuid) == 0 ||\n\t\t\t\tbt_uuid_cmp(&a->uuid, &snd_uuid) == 0) &&\n\t\t\t\ta->handle - handle >= nitems)\n\t\t\t/* Note: the range above excludes the current handle */\n\t\t\treturn handle;\n\n\t\tif (a->len == 16 && (bt_uuid_cmp(&a->uuid, &prim_uuid) == 0 ||\n\t\t\t\tbt_uuid_cmp(&a->uuid, &snd_uuid) == 0)) {\n\t\t\t/* 128 bit UUID service definition */\n\t\t\treturn 0;\n\t\t}\n\n\t\tif (a->handle == 0xffff)\n\t\t\treturn 0;\n\n\t\thandle = a->handle + 1;\n\t}\n\n\tif (0xffff - handle + 1 >= nitems)\n\t\treturn handle;\n\n\treturn 0;\n}",
          "includes": [
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"attrib/att-database.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"backtrace.h\"",
            "#include \"log.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <sys/stat.h>",
            "#include <glib.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdbool.h>",
            "#include <stdint.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static GSList *servers = NULL;",
            "static bt_uuid_t prim_uuid = {\n\t\t\t.type = BT_UUID16,\n\t\t\t.value.u16 = GATT_PRIM_SVC_UUID\n};",
            "static bt_uuid_t snd_uuid = {\n\t\t\t.type = BT_UUID16,\n\t\t\t.value.u16 = GATT_SND_SVC_UUID\n};"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"attrib/att-database.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"src/shared/util.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <sys/stat.h>\n#include <glib.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdbool.h>\n#include <stdint.h>\n#include <errno.h>\n#include <config.h>\n\nstatic GSList *servers = NULL;\nstatic bt_uuid_t prim_uuid = {\n\t\t\t.type = BT_UUID16,\n\t\t\t.value.u16 = GATT_PRIM_SVC_UUID\n};\nstatic bt_uuid_t snd_uuid = {\n\t\t\t.type = BT_UUID16,\n\t\t\t.value.u16 = GATT_SND_SVC_UUID\n};\n\nstatic uint16_t find_uuid16_avail(struct btd_adapter *adapter, uint16_t nitems)\n{\n\tstruct gatt_server *server;\n\tuint16_t handle;\n\tGSList *l;\n\tGList *dl;\n\n\tl = g_slist_find_custom(servers, adapter, adapter_cmp);\n\tif (l == NULL)\n\t\treturn 0;\n\n\tserver = l->data;\n\tif (server->database == NULL)\n\t\treturn 0x0001;\n\n\tfor (dl = server->database, handle = 0x0001; dl; dl = dl->next) {\n\t\tstruct attribute *a = dl->data;\n\n\t\tif ((bt_uuid_cmp(&a->uuid, &prim_uuid) == 0 ||\n\t\t\t\tbt_uuid_cmp(&a->uuid, &snd_uuid) == 0) &&\n\t\t\t\ta->handle - handle >= nitems)\n\t\t\t/* Note: the range above excludes the current handle */\n\t\t\treturn handle;\n\n\t\tif (a->len == 16 && (bt_uuid_cmp(&a->uuid, &prim_uuid) == 0 ||\n\t\t\t\tbt_uuid_cmp(&a->uuid, &snd_uuid) == 0)) {\n\t\t\t/* 128 bit UUID service definition */\n\t\t\treturn 0;\n\t\t}\n\n\t\tif (a->handle == 0xffff)\n\t\t\treturn 0;\n\n\t\thandle = a->handle + 1;\n\t}\n\n\tif (0xffff - handle + 1 >= nitems)\n\t\treturn handle;\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_assert",
          "args": [
            "nitems > 0"
          ],
          "line": 1526
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"attrib/att-database.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"src/shared/util.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <sys/stat.h>\n#include <glib.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdbool.h>\n#include <stdint.h>\n#include <errno.h>\n#include <config.h>\n\nuint16_t attrib_db_find_avail(struct btd_adapter *adapter, bt_uuid_t *svc_uuid,\n\t\t\t\t\t\t\t\tuint16_t nitems)\n{\n\tbtd_assert(nitems > 0);\n\n\tif (svc_uuid->type == BT_UUID16)\n\t\treturn find_uuid16_avail(adapter, nitems);\n\telse if (svc_uuid->type == BT_UUID128)\n\t\treturn find_uuid128_avail(adapter, nitems);\n\telse {\n\t\tchar uuidstr[MAX_LEN_UUID_STR];\n\n\t\tbt_uuid_to_string(svc_uuid, uuidstr, MAX_LEN_UUID_STR);\n\t\terror(\"Service uuid: %s is neither a 16-bit nor a 128-bit uuid\",\n\t\t\t\t\t\t\t\tuuidstr);\n\t\treturn 0;\n\t}\n}"
  },
  {
    "function_name": "find_uuid128_avail",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/attrib-server.c",
    "lines": "1477-1521",
    "snippet": "static uint16_t find_uuid128_avail(struct btd_adapter *adapter, uint16_t nitems)\n{\n\tuint16_t handle = 0, end = 0xffff;\n\tstruct gatt_server *server;\n\tGList *dl;\n\tGSList *l;\n\n\tl = g_slist_find_custom(servers, adapter, adapter_cmp);\n\tif (l == NULL)\n\t\treturn 0;\n\n\tserver = l->data;\n\tif (server->database == NULL)\n\t\treturn 0xffff - nitems + 1;\n\n\tfor (dl = g_list_last(server->database); dl; dl = dl->prev) {\n\t\tstruct attribute *a = dl->data;\n\n\t\tif (handle == 0)\n\t\t\thandle = a->handle;\n\n\t\tif (bt_uuid_cmp(&a->uuid, &prim_uuid) != 0 &&\n\t\t\t\tbt_uuid_cmp(&a->uuid, &snd_uuid) != 0)\n\t\t\tcontinue;\n\n\t\tif (end - handle >= nitems)\n\t\t\treturn end - nitems + 1;\n\n\t\tif (a->len == 2) {\n\t\t\t/* 16 bit UUID service definition */\n\t\t\treturn 0;\n\t\t}\n\n\t\tif (a->handle == 0x0001)\n\t\t\treturn 0;\n\n\t\tend = a->handle - 1;\n\t\thandle = 0;\n\t}\n\n\tif (end - 0x0001 >= nitems)\n\t\treturn end - nitems + 1;\n\n\treturn 0;\n}",
    "includes": [
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"attrib/att-database.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"attrib/att.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"backtrace.h\"",
      "#include \"log.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <sys/stat.h>",
      "#include <glib.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdbool.h>",
      "#include <stdint.h>",
      "#include <errno.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static GSList *servers = NULL;",
      "static bt_uuid_t prim_uuid = {\n\t\t\t.type = BT_UUID16,\n\t\t\t.value.u16 = GATT_PRIM_SVC_UUID\n};",
      "static bt_uuid_t snd_uuid = {\n\t\t\t.type = BT_UUID16,\n\t\t\t.value.u16 = GATT_SND_SVC_UUID\n};"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "bt_uuid_cmp",
          "args": [
            "&a->uuid",
            "&snd_uuid"
          ],
          "line": 1499
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bt_uuid_cmp",
          "args": [
            "&a->uuid",
            "&prim_uuid"
          ],
          "line": 1498
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_list_last",
          "args": [
            "server->database"
          ],
          "line": 1492
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_slist_find_custom",
          "args": [
            "servers",
            "adapter",
            "adapter_cmp"
          ],
          "line": 1484
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"attrib/att-database.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"src/shared/util.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <sys/stat.h>\n#include <glib.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdbool.h>\n#include <stdint.h>\n#include <errno.h>\n#include <config.h>\n\nstatic GSList *servers = NULL;\nstatic bt_uuid_t prim_uuid = {\n\t\t\t.type = BT_UUID16,\n\t\t\t.value.u16 = GATT_PRIM_SVC_UUID\n};\nstatic bt_uuid_t snd_uuid = {\n\t\t\t.type = BT_UUID16,\n\t\t\t.value.u16 = GATT_SND_SVC_UUID\n};\n\nstatic uint16_t find_uuid128_avail(struct btd_adapter *adapter, uint16_t nitems)\n{\n\tuint16_t handle = 0, end = 0xffff;\n\tstruct gatt_server *server;\n\tGList *dl;\n\tGSList *l;\n\n\tl = g_slist_find_custom(servers, adapter, adapter_cmp);\n\tif (l == NULL)\n\t\treturn 0;\n\n\tserver = l->data;\n\tif (server->database == NULL)\n\t\treturn 0xffff - nitems + 1;\n\n\tfor (dl = g_list_last(server->database); dl; dl = dl->prev) {\n\t\tstruct attribute *a = dl->data;\n\n\t\tif (handle == 0)\n\t\t\thandle = a->handle;\n\n\t\tif (bt_uuid_cmp(&a->uuid, &prim_uuid) != 0 &&\n\t\t\t\tbt_uuid_cmp(&a->uuid, &snd_uuid) != 0)\n\t\t\tcontinue;\n\n\t\tif (end - handle >= nitems)\n\t\t\treturn end - nitems + 1;\n\n\t\tif (a->len == 2) {\n\t\t\t/* 16 bit UUID service definition */\n\t\t\treturn 0;\n\t\t}\n\n\t\tif (a->handle == 0x0001)\n\t\t\treturn 0;\n\n\t\tend = a->handle - 1;\n\t\thandle = 0;\n\t}\n\n\tif (end - 0x0001 >= nitems)\n\t\treturn end - nitems + 1;\n\n\treturn 0;\n}"
  },
  {
    "function_name": "find_uuid16_avail",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/attrib-server.c",
    "lines": "1435-1475",
    "snippet": "static uint16_t find_uuid16_avail(struct btd_adapter *adapter, uint16_t nitems)\n{\n\tstruct gatt_server *server;\n\tuint16_t handle;\n\tGSList *l;\n\tGList *dl;\n\n\tl = g_slist_find_custom(servers, adapter, adapter_cmp);\n\tif (l == NULL)\n\t\treturn 0;\n\n\tserver = l->data;\n\tif (server->database == NULL)\n\t\treturn 0x0001;\n\n\tfor (dl = server->database, handle = 0x0001; dl; dl = dl->next) {\n\t\tstruct attribute *a = dl->data;\n\n\t\tif ((bt_uuid_cmp(&a->uuid, &prim_uuid) == 0 ||\n\t\t\t\tbt_uuid_cmp(&a->uuid, &snd_uuid) == 0) &&\n\t\t\t\ta->handle - handle >= nitems)\n\t\t\t/* Note: the range above excludes the current handle */\n\t\t\treturn handle;\n\n\t\tif (a->len == 16 && (bt_uuid_cmp(&a->uuid, &prim_uuid) == 0 ||\n\t\t\t\tbt_uuid_cmp(&a->uuid, &snd_uuid) == 0)) {\n\t\t\t/* 128 bit UUID service definition */\n\t\t\treturn 0;\n\t\t}\n\n\t\tif (a->handle == 0xffff)\n\t\t\treturn 0;\n\n\t\thandle = a->handle + 1;\n\t}\n\n\tif (0xffff - handle + 1 >= nitems)\n\t\treturn handle;\n\n\treturn 0;\n}",
    "includes": [
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"attrib/att-database.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"attrib/att.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"backtrace.h\"",
      "#include \"log.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <sys/stat.h>",
      "#include <glib.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdbool.h>",
      "#include <stdint.h>",
      "#include <errno.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static GSList *servers = NULL;",
      "static bt_uuid_t prim_uuid = {\n\t\t\t.type = BT_UUID16,\n\t\t\t.value.u16 = GATT_PRIM_SVC_UUID\n};",
      "static bt_uuid_t snd_uuid = {\n\t\t\t.type = BT_UUID16,\n\t\t\t.value.u16 = GATT_SND_SVC_UUID\n};"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "bt_uuid_cmp",
          "args": [
            "&a->uuid",
            "&snd_uuid"
          ],
          "line": 1460
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bt_uuid_cmp",
          "args": [
            "&a->uuid",
            "&prim_uuid"
          ],
          "line": 1459
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bt_uuid_cmp",
          "args": [
            "&a->uuid",
            "&snd_uuid"
          ],
          "line": 1454
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bt_uuid_cmp",
          "args": [
            "&a->uuid",
            "&prim_uuid"
          ],
          "line": 1453
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_slist_find_custom",
          "args": [
            "servers",
            "adapter",
            "adapter_cmp"
          ],
          "line": 1442
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"attrib/att-database.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"src/shared/util.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <sys/stat.h>\n#include <glib.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdbool.h>\n#include <stdint.h>\n#include <errno.h>\n#include <config.h>\n\nstatic GSList *servers = NULL;\nstatic bt_uuid_t prim_uuid = {\n\t\t\t.type = BT_UUID16,\n\t\t\t.value.u16 = GATT_PRIM_SVC_UUID\n};\nstatic bt_uuid_t snd_uuid = {\n\t\t\t.type = BT_UUID16,\n\t\t\t.value.u16 = GATT_SND_SVC_UUID\n};\n\nstatic uint16_t find_uuid16_avail(struct btd_adapter *adapter, uint16_t nitems)\n{\n\tstruct gatt_server *server;\n\tuint16_t handle;\n\tGSList *l;\n\tGList *dl;\n\n\tl = g_slist_find_custom(servers, adapter, adapter_cmp);\n\tif (l == NULL)\n\t\treturn 0;\n\n\tserver = l->data;\n\tif (server->database == NULL)\n\t\treturn 0x0001;\n\n\tfor (dl = server->database, handle = 0x0001; dl; dl = dl->next) {\n\t\tstruct attribute *a = dl->data;\n\n\t\tif ((bt_uuid_cmp(&a->uuid, &prim_uuid) == 0 ||\n\t\t\t\tbt_uuid_cmp(&a->uuid, &snd_uuid) == 0) &&\n\t\t\t\ta->handle - handle >= nitems)\n\t\t\t/* Note: the range above excludes the current handle */\n\t\t\treturn handle;\n\n\t\tif (a->len == 16 && (bt_uuid_cmp(&a->uuid, &prim_uuid) == 0 ||\n\t\t\t\tbt_uuid_cmp(&a->uuid, &snd_uuid) == 0)) {\n\t\t\t/* 128 bit UUID service definition */\n\t\t\treturn 0;\n\t\t}\n\n\t\tif (a->handle == 0xffff)\n\t\t\treturn 0;\n\n\t\thandle = a->handle + 1;\n\t}\n\n\tif (0xffff - handle + 1 >= nitems)\n\t\treturn handle;\n\n\treturn 0;\n}"
  },
  {
    "function_name": "attrib_free_sdp",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/attrib-server.c",
    "lines": "1430-1433",
    "snippet": "void attrib_free_sdp(struct btd_adapter *adapter, uint32_t sdp_handle)\n{\n\tadapter_service_remove(adapter, sdp_handle);\n}",
    "includes": [
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"attrib/att-database.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"attrib/att.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"backtrace.h\"",
      "#include \"log.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <sys/stat.h>",
      "#include <glib.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdbool.h>",
      "#include <stdint.h>",
      "#include <errno.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "adapter_service_remove",
          "args": [
            "adapter",
            "sdp_handle"
          ],
          "line": 1432
        },
        "resolved": true,
        "details": {
          "function_name": "adapter_service_remove",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "1144-1159",
          "snippet": "void adapter_service_remove(struct btd_adapter *adapter, uint32_t handle)\n{\n\tsdp_record_t *rec = sdp_record_find(handle);\n\n\tDBG(\"%s\", adapter->path);\n\n\tif (!rec)\n\t\treturn;\n\n\tadapter->services = sdp_list_remove(adapter->services, rec);\n\n\tif (sdp_list_find(adapter->services, &rec->svclass, uuid_cmp) == NULL)\n\t\tremove_uuid(adapter, &rec->svclass);\n\n\tremove_record_from_server(rec->handle);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void trigger_pairable_timeout(struct btd_adapter *adapter);",
            "static void adapter_start(struct btd_adapter *adapter);",
            "static void adapter_stop(struct btd_adapter *adapter);",
            "static void trigger_passive_scanning(struct btd_adapter *adapter);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void trigger_pairable_timeout(struct btd_adapter *adapter);\nstatic void adapter_start(struct btd_adapter *adapter);\nstatic void adapter_stop(struct btd_adapter *adapter);\nstatic void trigger_passive_scanning(struct btd_adapter *adapter);\n\nvoid adapter_service_remove(struct btd_adapter *adapter, uint32_t handle)\n{\n\tsdp_record_t *rec = sdp_record_find(handle);\n\n\tDBG(\"%s\", adapter->path);\n\n\tif (!rec)\n\t\treturn;\n\n\tadapter->services = sdp_list_remove(adapter->services, rec);\n\n\tif (sdp_list_find(adapter->services, &rec->svclass, uuid_cmp) == NULL)\n\t\tremove_uuid(adapter, &rec->svclass);\n\n\tremove_record_from_server(rec->handle);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"attrib/att-database.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"src/shared/util.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <sys/stat.h>\n#include <glib.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdbool.h>\n#include <stdint.h>\n#include <errno.h>\n#include <config.h>\n\nvoid attrib_free_sdp(struct btd_adapter *adapter, uint32_t sdp_handle)\n{\n\tadapter_service_remove(adapter, sdp_handle);\n}"
  },
  {
    "function_name": "attrib_create_sdp",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/attrib-server.c",
    "lines": "1418-1428",
    "snippet": "uint32_t attrib_create_sdp(struct btd_adapter *adapter, uint16_t handle,\n\t\t\t\t\t\t\tconst char *name)\n{\n\tGSList *l;\n\n\tl = g_slist_find_custom(servers, adapter, adapter_cmp);\n\tif (l == NULL)\n\t\treturn 0;\n\n\treturn attrib_create_sdp_new(l->data, handle, name);\n}",
    "includes": [
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"attrib/att-database.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"attrib/att.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"backtrace.h\"",
      "#include \"log.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <sys/stat.h>",
      "#include <glib.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdbool.h>",
      "#include <stdint.h>",
      "#include <errno.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static GSList *servers = NULL;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "attrib_create_sdp_new",
          "args": [
            "l->data",
            "handle",
            "name"
          ],
          "line": 1427
        },
        "resolved": true,
        "details": {
          "function_name": "attrib_create_sdp_new",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/attrib-server.c",
          "lines": "294-337",
          "snippet": "static uint32_t attrib_create_sdp_new(struct gatt_server *server,\n\t\t\t\t\tuint16_t handle, const char *name)\n{\n\tsdp_record_t *record;\n\tstruct attribute *a;\n\tuint16_t end = 0;\n\tuuid_t svc, gap_uuid;\n\n\ta = find_svc_range(server, handle, &end);\n\n\tif (a == NULL)\n\t\treturn 0;\n\n\tif (a->len == 2)\n\t\tsdp_uuid16_create(&svc, get_le16(a->data));\n\telse if (a->len == 16) {\n\t\tuint8_t be128[16];\n\n\t\t/* Converting from LE to BE */\n\t\tbswap_128(a->data, be128);\n\t\tsdp_uuid128_create(&svc, be128);\n\t} else\n\t\treturn 0;\n\n\trecord = server_record_new(&svc, handle, end);\n\tif (record == NULL)\n\t\treturn 0;\n\n\tif (name != NULL)\n\t\tsdp_set_info_attr(record, name, \"BlueZ\", NULL);\n\n\tsdp_uuid16_create(&gap_uuid, GENERIC_ACCESS_PROFILE_ID);\n\tif (sdp_uuid_cmp(&svc, &gap_uuid) == 0) {\n\t\tsdp_set_url_attr(record, \"http://www.bluez.org/\",\n\t\t\t\t\"http://www.bluez.org/\",\n\t\t\t\t\"http://www.bluez.org/\");\n\t}\n\n\tif (adapter_service_add(server->adapter, record) == 0)\n\t\treturn record->handle;\n\n\tsdp_record_free(record);\n\treturn 0;\n}",
          "includes": [
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"attrib/att-database.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"backtrace.h\"",
            "#include \"log.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <sys/stat.h>",
            "#include <glib.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdbool.h>",
            "#include <stdint.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"attrib/att-database.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"src/shared/util.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <sys/stat.h>\n#include <glib.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdbool.h>\n#include <stdint.h>\n#include <errno.h>\n#include <config.h>\n\nstatic uint32_t attrib_create_sdp_new(struct gatt_server *server,\n\t\t\t\t\tuint16_t handle, const char *name)\n{\n\tsdp_record_t *record;\n\tstruct attribute *a;\n\tuint16_t end = 0;\n\tuuid_t svc, gap_uuid;\n\n\ta = find_svc_range(server, handle, &end);\n\n\tif (a == NULL)\n\t\treturn 0;\n\n\tif (a->len == 2)\n\t\tsdp_uuid16_create(&svc, get_le16(a->data));\n\telse if (a->len == 16) {\n\t\tuint8_t be128[16];\n\n\t\t/* Converting from LE to BE */\n\t\tbswap_128(a->data, be128);\n\t\tsdp_uuid128_create(&svc, be128);\n\t} else\n\t\treturn 0;\n\n\trecord = server_record_new(&svc, handle, end);\n\tif (record == NULL)\n\t\treturn 0;\n\n\tif (name != NULL)\n\t\tsdp_set_info_attr(record, name, \"BlueZ\", NULL);\n\n\tsdp_uuid16_create(&gap_uuid, GENERIC_ACCESS_PROFILE_ID);\n\tif (sdp_uuid_cmp(&svc, &gap_uuid) == 0) {\n\t\tsdp_set_url_attr(record, \"http://www.bluez.org/\",\n\t\t\t\t\"http://www.bluez.org/\",\n\t\t\t\t\"http://www.bluez.org/\");\n\t}\n\n\tif (adapter_service_add(server->adapter, record) == 0)\n\t\treturn record->handle;\n\n\tsdp_record_free(record);\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_slist_find_custom",
          "args": [
            "servers",
            "adapter",
            "adapter_cmp"
          ],
          "line": 1423
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"attrib/att-database.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"src/shared/util.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <sys/stat.h>\n#include <glib.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdbool.h>\n#include <stdint.h>\n#include <errno.h>\n#include <config.h>\n\nstatic GSList *servers = NULL;\n\nuint32_t attrib_create_sdp(struct btd_adapter *adapter, uint16_t handle,\n\t\t\t\t\t\t\tconst char *name)\n{\n\tGSList *l;\n\n\tl = g_slist_find_custom(servers, adapter, adapter_cmp);\n\tif (l == NULL)\n\t\treturn 0;\n\n\treturn attrib_create_sdp_new(l->data, handle, name);\n}"
  },
  {
    "function_name": "btd_adapter_gatt_server_stop",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/attrib-server.c",
    "lines": "1402-1416",
    "snippet": "void btd_adapter_gatt_server_stop(struct btd_adapter *adapter)\n{\n\tstruct gatt_server *server;\n\tGSList *l;\n\n\tl = g_slist_find_custom(servers, adapter, adapter_cmp);\n\tif (l == NULL)\n\t\treturn;\n\n\tDBG(\"Stop GATT server in hci%d\", btd_adapter_get_index(adapter));\n\n\tserver = l->data;\n\tservers = g_slist_remove(servers, server);\n\tgatt_server_free(server);\n}",
    "includes": [
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"attrib/att-database.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"attrib/att.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"backtrace.h\"",
      "#include \"log.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <sys/stat.h>",
      "#include <glib.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdbool.h>",
      "#include <stdint.h>",
      "#include <errno.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static GSList *servers = NULL;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "gatt_server_free",
          "args": [
            "server"
          ],
          "line": 1415
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_server_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/attrib-server.c",
          "lines": "123-150",
          "snippet": "static void gatt_server_free(struct gatt_server *server)\n{\n\tg_list_free_full(server->database, attrib_free);\n\n\tif (server->l2cap_io != NULL) {\n\t\tg_io_channel_shutdown(server->l2cap_io, FALSE, NULL);\n\t\tg_io_channel_unref(server->l2cap_io);\n\t}\n\n\tif (server->le_io != NULL) {\n\t\tg_io_channel_shutdown(server->le_io, FALSE, NULL);\n\t\tg_io_channel_unref(server->le_io);\n\t}\n\n\tg_slist_free_full(server->clients, (GDestroyNotify) channel_free);\n\n\tif (server->gatt_sdp_handle > 0)\n\t\tadapter_service_remove(server->adapter,\n\t\t\t\t\tserver->gatt_sdp_handle);\n\n\tif (server->gap_sdp_handle > 0)\n\t\tadapter_service_remove(server->adapter, server->gap_sdp_handle);\n\n\tif (server->adapter != NULL)\n\t\tbtd_adapter_unref(server->adapter);\n\n\tg_free(server);\n}",
          "includes": [
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"attrib/att-database.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"backtrace.h\"",
            "#include \"log.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <sys/stat.h>",
            "#include <glib.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdbool.h>",
            "#include <stdint.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"attrib/att-database.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"src/shared/util.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <sys/stat.h>\n#include <glib.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdbool.h>\n#include <stdint.h>\n#include <errno.h>\n#include <config.h>\n\nstatic void gatt_server_free(struct gatt_server *server)\n{\n\tg_list_free_full(server->database, attrib_free);\n\n\tif (server->l2cap_io != NULL) {\n\t\tg_io_channel_shutdown(server->l2cap_io, FALSE, NULL);\n\t\tg_io_channel_unref(server->l2cap_io);\n\t}\n\n\tif (server->le_io != NULL) {\n\t\tg_io_channel_shutdown(server->le_io, FALSE, NULL);\n\t\tg_io_channel_unref(server->le_io);\n\t}\n\n\tg_slist_free_full(server->clients, (GDestroyNotify) channel_free);\n\n\tif (server->gatt_sdp_handle > 0)\n\t\tadapter_service_remove(server->adapter,\n\t\t\t\t\tserver->gatt_sdp_handle);\n\n\tif (server->gap_sdp_handle > 0)\n\t\tadapter_service_remove(server->adapter, server->gap_sdp_handle);\n\n\tif (server->adapter != NULL)\n\t\tbtd_adapter_unref(server->adapter);\n\n\tg_free(server);\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_slist_remove",
          "args": [
            "servers",
            "server"
          ],
          "line": 1414
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"Stop GATT server in hci%d\"",
            "btd_adapter_get_index(adapter)"
          ],
          "line": 1411
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_adapter_get_index",
          "args": [
            "adapter"
          ],
          "line": 1411
        },
        "resolved": true,
        "details": {
          "function_name": "btd_adapter_get_index",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "316-322",
          "snippet": "uint16_t btd_adapter_get_index(struct btd_adapter *adapter)\n{\n\tif (!adapter)\n\t\treturn MGMT_INDEX_NONE;\n\n\treturn adapter->dev_id;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void trigger_pairable_timeout(struct btd_adapter *adapter);",
            "static void adapter_start(struct btd_adapter *adapter);",
            "static void adapter_stop(struct btd_adapter *adapter);",
            "static void trigger_passive_scanning(struct btd_adapter *adapter);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void trigger_pairable_timeout(struct btd_adapter *adapter);\nstatic void adapter_start(struct btd_adapter *adapter);\nstatic void adapter_stop(struct btd_adapter *adapter);\nstatic void trigger_passive_scanning(struct btd_adapter *adapter);\n\nuint16_t btd_adapter_get_index(struct btd_adapter *adapter)\n{\n\tif (!adapter)\n\t\treturn MGMT_INDEX_NONE;\n\n\treturn adapter->dev_id;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_slist_find_custom",
          "args": [
            "servers",
            "adapter",
            "adapter_cmp"
          ],
          "line": 1407
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"attrib/att-database.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"src/shared/util.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <sys/stat.h>\n#include <glib.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdbool.h>\n#include <stdint.h>\n#include <errno.h>\n#include <config.h>\n\nstatic GSList *servers = NULL;\n\nvoid btd_adapter_gatt_server_stop(struct btd_adapter *adapter)\n{\n\tstruct gatt_server *server;\n\tGSList *l;\n\n\tl = g_slist_find_custom(servers, adapter, adapter_cmp);\n\tif (l == NULL)\n\t\treturn;\n\n\tDBG(\"Stop GATT server in hci%d\", btd_adapter_get_index(adapter));\n\n\tserver = l->data;\n\tservers = g_slist_remove(servers, server);\n\tgatt_server_free(server);\n}"
  },
  {
    "function_name": "btd_adapter_gatt_server_start",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/attrib-server.c",
    "lines": "1350-1400",
    "snippet": "int btd_adapter_gatt_server_start(struct btd_adapter *adapter)\n{\n\tstruct gatt_server *server;\n\tGError *gerr = NULL;\n\tconst bdaddr_t *addr;\n\n\tDBG(\"Start GATT server in hci%d\", btd_adapter_get_index(adapter));\n\n\tserver = g_new0(struct gatt_server, 1);\n\tserver->adapter = btd_adapter_ref(adapter);\n\n\taddr = btd_adapter_get_address(server->adapter);\n\n\t/* BR/EDR socket */\n\tserver->l2cap_io = bt_io_listen(connect_event, NULL, NULL, NULL, &gerr,\n\t\t\t\t\tBT_IO_OPT_SOURCE_BDADDR, addr,\n\t\t\t\t\tBT_IO_OPT_PSM, ATT_PSM,\n\t\t\t\t\tBT_IO_OPT_SEC_LEVEL, BT_IO_SEC_LOW,\n\t\t\t\t\tBT_IO_OPT_INVALID);\n\n\tif (server->l2cap_io == NULL) {\n\t\terror(\"%s\", gerr->message);\n\t\tg_error_free(gerr);\n\t\tgatt_server_free(server);\n\t\treturn -1;\n\t}\n\n\tif (!register_core_services(server)) {\n\t\tgatt_server_free(server);\n\t\treturn -1;\n\t}\n\n\t/* LE socket */\n\tserver->le_io = bt_io_listen(connect_event, NULL,\n\t\t\t\t\t&server->le_io, NULL, &gerr,\n\t\t\t\t\tBT_IO_OPT_SOURCE_BDADDR, addr,\n\t\t\t\t\tBT_IO_OPT_SOURCE_TYPE,\n\t\t\t\t\tbtd_adapter_get_address_type(adapter),\n\t\t\t\t\tBT_IO_OPT_CID, ATT_CID,\n\t\t\t\t\tBT_IO_OPT_SEC_LEVEL, BT_IO_SEC_LOW,\n\t\t\t\t\tBT_IO_OPT_INVALID);\n\n\tif (server->le_io == NULL) {\n\t\terror(\"%s\", gerr->message);\n\t\tg_error_free(gerr);\n\t\t/* Doesn't have LE support, continue */\n\t}\n\n\tservers = g_slist_prepend(servers, server);\n\treturn 0;\n}",
    "includes": [
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"attrib/att-database.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"attrib/att.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"backtrace.h\"",
      "#include \"log.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <sys/stat.h>",
      "#include <glib.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdbool.h>",
      "#include <stdint.h>",
      "#include <errno.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static GSList *servers = NULL;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_slist_prepend",
          "args": [
            "servers",
            "server"
          ],
          "line": 1398
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_error_free",
          "args": [
            "gerr"
          ],
          "line": 1394
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"%s\"",
            "gerr->message"
          ],
          "line": 1393
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_failed",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "124-128",
          "snippet": "DBusMessage *btd_error_failed(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE\n\t\t\t\t\t\".Failed\", \"%s\", str);\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_failed(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE\n\t\t\t\t\t\".Failed\", \"%s\", str);\n}"
        }
      },
      {
        "call_info": {
          "callee": "bt_io_listen",
          "args": [
            "connect_event",
            "NULL",
            "&server->le_io",
            "NULL",
            "&gerr",
            "BT_IO_OPT_SOURCE_BDADDR",
            "addr",
            "BT_IO_OPT_SOURCE_TYPE",
            "btd_adapter_get_address_type(adapter)",
            "BT_IO_OPT_CID",
            "ATT_CID",
            "BT_IO_OPT_SEC_LEVEL",
            "BT_IO_SEC_LOW",
            "BT_IO_OPT_INVALID"
          ],
          "line": 1383
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_adapter_get_address_type",
          "args": [
            "adapter"
          ],
          "line": 1387
        },
        "resolved": true,
        "details": {
          "function_name": "btd_adapter_get_address_type",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "452-455",
          "snippet": "uint8_t btd_adapter_get_address_type(struct btd_adapter *adapter)\n{\n\treturn adapter->bdaddr_type;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void trigger_pairable_timeout(struct btd_adapter *adapter);",
            "static void adapter_start(struct btd_adapter *adapter);",
            "static void adapter_stop(struct btd_adapter *adapter);",
            "static void trigger_passive_scanning(struct btd_adapter *adapter);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void trigger_pairable_timeout(struct btd_adapter *adapter);\nstatic void adapter_start(struct btd_adapter *adapter);\nstatic void adapter_stop(struct btd_adapter *adapter);\nstatic void trigger_passive_scanning(struct btd_adapter *adapter);\n\nuint8_t btd_adapter_get_address_type(struct btd_adapter *adapter)\n{\n\treturn adapter->bdaddr_type;\n}"
        }
      },
      {
        "call_info": {
          "callee": "gatt_server_free",
          "args": [
            "server"
          ],
          "line": 1378
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_server_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/attrib-server.c",
          "lines": "123-150",
          "snippet": "static void gatt_server_free(struct gatt_server *server)\n{\n\tg_list_free_full(server->database, attrib_free);\n\n\tif (server->l2cap_io != NULL) {\n\t\tg_io_channel_shutdown(server->l2cap_io, FALSE, NULL);\n\t\tg_io_channel_unref(server->l2cap_io);\n\t}\n\n\tif (server->le_io != NULL) {\n\t\tg_io_channel_shutdown(server->le_io, FALSE, NULL);\n\t\tg_io_channel_unref(server->le_io);\n\t}\n\n\tg_slist_free_full(server->clients, (GDestroyNotify) channel_free);\n\n\tif (server->gatt_sdp_handle > 0)\n\t\tadapter_service_remove(server->adapter,\n\t\t\t\t\tserver->gatt_sdp_handle);\n\n\tif (server->gap_sdp_handle > 0)\n\t\tadapter_service_remove(server->adapter, server->gap_sdp_handle);\n\n\tif (server->adapter != NULL)\n\t\tbtd_adapter_unref(server->adapter);\n\n\tg_free(server);\n}",
          "includes": [
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"attrib/att-database.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"backtrace.h\"",
            "#include \"log.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <sys/stat.h>",
            "#include <glib.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdbool.h>",
            "#include <stdint.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"attrib/att-database.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"src/shared/util.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <sys/stat.h>\n#include <glib.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdbool.h>\n#include <stdint.h>\n#include <errno.h>\n#include <config.h>\n\nstatic void gatt_server_free(struct gatt_server *server)\n{\n\tg_list_free_full(server->database, attrib_free);\n\n\tif (server->l2cap_io != NULL) {\n\t\tg_io_channel_shutdown(server->l2cap_io, FALSE, NULL);\n\t\tg_io_channel_unref(server->l2cap_io);\n\t}\n\n\tif (server->le_io != NULL) {\n\t\tg_io_channel_shutdown(server->le_io, FALSE, NULL);\n\t\tg_io_channel_unref(server->le_io);\n\t}\n\n\tg_slist_free_full(server->clients, (GDestroyNotify) channel_free);\n\n\tif (server->gatt_sdp_handle > 0)\n\t\tadapter_service_remove(server->adapter,\n\t\t\t\t\tserver->gatt_sdp_handle);\n\n\tif (server->gap_sdp_handle > 0)\n\t\tadapter_service_remove(server->adapter, server->gap_sdp_handle);\n\n\tif (server->adapter != NULL)\n\t\tbtd_adapter_unref(server->adapter);\n\n\tg_free(server);\n}"
        }
      },
      {
        "call_info": {
          "callee": "register_core_services",
          "args": [
            "server"
          ],
          "line": 1377
        },
        "resolved": true,
        "details": {
          "function_name": "register_core_services",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/attrib-server.c",
          "lines": "1287-1348",
          "snippet": "static gboolean register_core_services(struct gatt_server *server)\n{\n\tuint8_t atval[256];\n\tbt_uuid_t uuid;\n\tuint16_t appearance = 0x0000;\n\n\t/* GAP service: primary service definition */\n\tbt_uuid16_create(&uuid, GATT_PRIM_SVC_UUID);\n\tput_le16(GENERIC_ACCESS_PROFILE_ID, &atval[0]);\n\tattrib_db_add_new(server, 0x0001, &uuid, ATT_NONE, ATT_NOT_PERMITTED,\n\t\t\t\t\t\t\t\tatval, 2);\n\n\t/* GAP service: device name characteristic */\n\tserver->name_handle = 0x0006;\n\tbt_uuid16_create(&uuid, GATT_CHARAC_UUID);\n\tatval[0] = GATT_CHR_PROP_READ;\n\tput_le16(server->name_handle, &atval[1]);\n\tput_le16(GATT_CHARAC_DEVICE_NAME, &atval[3]);\n\tattrib_db_add_new(server, 0x0004, &uuid, ATT_NONE, ATT_NOT_PERMITTED,\n\t\t\t\t\t\t\t\tatval, 5);\n\n\t/* GAP service: device name attribute */\n\tbt_uuid16_create(&uuid, GATT_CHARAC_DEVICE_NAME);\n\tattrib_db_add_new(server, server->name_handle, &uuid, ATT_NONE,\n\t\t\t\t\t\tATT_NOT_PERMITTED, NULL, 0);\n\n\t/* GAP service: device appearance characteristic */\n\tserver->appearance_handle = 0x0008;\n\tbt_uuid16_create(&uuid, GATT_CHARAC_UUID);\n\tatval[0] = GATT_CHR_PROP_READ;\n\tput_le16(server->appearance_handle, &atval[1]);\n\tput_le16(GATT_CHARAC_APPEARANCE, &atval[3]);\n\tattrib_db_add_new(server, 0x0007, &uuid, ATT_NONE, ATT_NOT_PERMITTED,\n\t\t\t\t\t\t\t\tatval, 5);\n\n\t/* GAP service: device appearance attribute */\n\tbt_uuid16_create(&uuid, GATT_CHARAC_APPEARANCE);\n\tput_le16(appearance, &atval[0]);\n\tattrib_db_add_new(server, server->appearance_handle, &uuid, ATT_NONE,\n\t\t\t\t\t\tATT_NOT_PERMITTED, atval, 2);\n\tserver->gap_sdp_handle = attrib_create_sdp_new(server, 0x0001,\n\t\t\t\t\t\t\"Generic Access Profile\");\n\tif (server->gap_sdp_handle == 0) {\n\t\terror(\"Failed to register GAP service record\");\n\t\treturn FALSE;\n\t}\n\n\t/* GATT service: primary service definition */\n\tbt_uuid16_create(&uuid, GATT_PRIM_SVC_UUID);\n\tput_le16(GENERIC_ATTRIB_PROFILE_ID, &atval[0]);\n\tattrib_db_add_new(server, 0x0010, &uuid, ATT_NONE, ATT_NOT_PERMITTED,\n\t\t\t\t\t\t\t\tatval, 2);\n\n\tserver->gatt_sdp_handle = attrib_create_sdp_new(server, 0x0010,\n\t\t\t\t\t\t\"Generic Attribute Profile\");\n\tif (server->gatt_sdp_handle == 0) {\n\t\terror(\"Failed to register GATT service record\");\n\t\treturn FALSE;\n\t}\n\n\treturn TRUE;\n}",
          "includes": [
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"attrib/att-database.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"backtrace.h\"",
            "#include \"log.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <sys/stat.h>",
            "#include <glib.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdbool.h>",
            "#include <stdint.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"attrib/att-database.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"src/shared/util.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <sys/stat.h>\n#include <glib.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdbool.h>\n#include <stdint.h>\n#include <errno.h>\n#include <config.h>\n\nstatic gboolean register_core_services(struct gatt_server *server)\n{\n\tuint8_t atval[256];\n\tbt_uuid_t uuid;\n\tuint16_t appearance = 0x0000;\n\n\t/* GAP service: primary service definition */\n\tbt_uuid16_create(&uuid, GATT_PRIM_SVC_UUID);\n\tput_le16(GENERIC_ACCESS_PROFILE_ID, &atval[0]);\n\tattrib_db_add_new(server, 0x0001, &uuid, ATT_NONE, ATT_NOT_PERMITTED,\n\t\t\t\t\t\t\t\tatval, 2);\n\n\t/* GAP service: device name characteristic */\n\tserver->name_handle = 0x0006;\n\tbt_uuid16_create(&uuid, GATT_CHARAC_UUID);\n\tatval[0] = GATT_CHR_PROP_READ;\n\tput_le16(server->name_handle, &atval[1]);\n\tput_le16(GATT_CHARAC_DEVICE_NAME, &atval[3]);\n\tattrib_db_add_new(server, 0x0004, &uuid, ATT_NONE, ATT_NOT_PERMITTED,\n\t\t\t\t\t\t\t\tatval, 5);\n\n\t/* GAP service: device name attribute */\n\tbt_uuid16_create(&uuid, GATT_CHARAC_DEVICE_NAME);\n\tattrib_db_add_new(server, server->name_handle, &uuid, ATT_NONE,\n\t\t\t\t\t\tATT_NOT_PERMITTED, NULL, 0);\n\n\t/* GAP service: device appearance characteristic */\n\tserver->appearance_handle = 0x0008;\n\tbt_uuid16_create(&uuid, GATT_CHARAC_UUID);\n\tatval[0] = GATT_CHR_PROP_READ;\n\tput_le16(server->appearance_handle, &atval[1]);\n\tput_le16(GATT_CHARAC_APPEARANCE, &atval[3]);\n\tattrib_db_add_new(server, 0x0007, &uuid, ATT_NONE, ATT_NOT_PERMITTED,\n\t\t\t\t\t\t\t\tatval, 5);\n\n\t/* GAP service: device appearance attribute */\n\tbt_uuid16_create(&uuid, GATT_CHARAC_APPEARANCE);\n\tput_le16(appearance, &atval[0]);\n\tattrib_db_add_new(server, server->appearance_handle, &uuid, ATT_NONE,\n\t\t\t\t\t\tATT_NOT_PERMITTED, atval, 2);\n\tserver->gap_sdp_handle = attrib_create_sdp_new(server, 0x0001,\n\t\t\t\t\t\t\"Generic Access Profile\");\n\tif (server->gap_sdp_handle == 0) {\n\t\terror(\"Failed to register GAP service record\");\n\t\treturn FALSE;\n\t}\n\n\t/* GATT service: primary service definition */\n\tbt_uuid16_create(&uuid, GATT_PRIM_SVC_UUID);\n\tput_le16(GENERIC_ATTRIB_PROFILE_ID, &atval[0]);\n\tattrib_db_add_new(server, 0x0010, &uuid, ATT_NONE, ATT_NOT_PERMITTED,\n\t\t\t\t\t\t\t\tatval, 2);\n\n\tserver->gatt_sdp_handle = attrib_create_sdp_new(server, 0x0010,\n\t\t\t\t\t\t\"Generic Attribute Profile\");\n\tif (server->gatt_sdp_handle == 0) {\n\t\terror(\"Failed to register GATT service record\");\n\t\treturn FALSE;\n\t}\n\n\treturn TRUE;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_error_free",
          "args": [
            "gerr"
          ],
          "line": 1372
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bt_io_listen",
          "args": [
            "connect_event",
            "NULL",
            "NULL",
            "NULL",
            "&gerr",
            "BT_IO_OPT_SOURCE_BDADDR",
            "addr",
            "BT_IO_OPT_PSM",
            "ATT_PSM",
            "BT_IO_OPT_SEC_LEVEL",
            "BT_IO_SEC_LOW",
            "BT_IO_OPT_INVALID"
          ],
          "line": 1364
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_adapter_get_address",
          "args": [
            "server->adapter"
          ],
          "line": 1361
        },
        "resolved": true,
        "details": {
          "function_name": "btd_adapter_get_address",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "5881-5884",
          "snippet": "const bdaddr_t *btd_adapter_get_address(struct btd_adapter *adapter)\n{\n\treturn &adapter->bdaddr;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void trigger_pairable_timeout(struct btd_adapter *adapter);",
            "static void adapter_start(struct btd_adapter *adapter);",
            "static void adapter_stop(struct btd_adapter *adapter);",
            "static void trigger_passive_scanning(struct btd_adapter *adapter);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void trigger_pairable_timeout(struct btd_adapter *adapter);\nstatic void adapter_start(struct btd_adapter *adapter);\nstatic void adapter_stop(struct btd_adapter *adapter);\nstatic void trigger_passive_scanning(struct btd_adapter *adapter);\n\nconst bdaddr_t *btd_adapter_get_address(struct btd_adapter *adapter)\n{\n\treturn &adapter->bdaddr;\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_adapter_ref",
          "args": [
            "adapter"
          ],
          "line": 1359
        },
        "resolved": true,
        "details": {
          "function_name": "btd_adapter_ref",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "4898-4903",
          "snippet": "struct btd_adapter *btd_adapter_ref(struct btd_adapter *adapter)\n{\n\t__sync_fetch_and_add(&adapter->ref_count, 1);\n\n\treturn adapter;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void trigger_pairable_timeout(struct btd_adapter *adapter);",
            "static void adapter_start(struct btd_adapter *adapter);",
            "static void adapter_stop(struct btd_adapter *adapter);",
            "static void trigger_passive_scanning(struct btd_adapter *adapter);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void trigger_pairable_timeout(struct btd_adapter *adapter);\nstatic void adapter_start(struct btd_adapter *adapter);\nstatic void adapter_stop(struct btd_adapter *adapter);\nstatic void trigger_passive_scanning(struct btd_adapter *adapter);\n\nstruct btd_adapter *btd_adapter_ref(struct btd_adapter *adapter)\n{\n\t__sync_fetch_and_add(&adapter->ref_count, 1);\n\n\treturn adapter;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_new0",
          "args": [
            "structgatt_server",
            "1"
          ],
          "line": 1358
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"Start GATT server in hci%d\"",
            "btd_adapter_get_index(adapter)"
          ],
          "line": 1356
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_adapter_get_index",
          "args": [
            "adapter"
          ],
          "line": 1356
        },
        "resolved": true,
        "details": {
          "function_name": "btd_adapter_get_index",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "316-322",
          "snippet": "uint16_t btd_adapter_get_index(struct btd_adapter *adapter)\n{\n\tif (!adapter)\n\t\treturn MGMT_INDEX_NONE;\n\n\treturn adapter->dev_id;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void trigger_pairable_timeout(struct btd_adapter *adapter);",
            "static void adapter_start(struct btd_adapter *adapter);",
            "static void adapter_stop(struct btd_adapter *adapter);",
            "static void trigger_passive_scanning(struct btd_adapter *adapter);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void trigger_pairable_timeout(struct btd_adapter *adapter);\nstatic void adapter_start(struct btd_adapter *adapter);\nstatic void adapter_stop(struct btd_adapter *adapter);\nstatic void trigger_passive_scanning(struct btd_adapter *adapter);\n\nuint16_t btd_adapter_get_index(struct btd_adapter *adapter)\n{\n\tif (!adapter)\n\t\treturn MGMT_INDEX_NONE;\n\n\treturn adapter->dev_id;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"attrib/att-database.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"src/shared/util.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <sys/stat.h>\n#include <glib.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdbool.h>\n#include <stdint.h>\n#include <errno.h>\n#include <config.h>\n\nstatic GSList *servers = NULL;\n\nint btd_adapter_gatt_server_start(struct btd_adapter *adapter)\n{\n\tstruct gatt_server *server;\n\tGError *gerr = NULL;\n\tconst bdaddr_t *addr;\n\n\tDBG(\"Start GATT server in hci%d\", btd_adapter_get_index(adapter));\n\n\tserver = g_new0(struct gatt_server, 1);\n\tserver->adapter = btd_adapter_ref(adapter);\n\n\taddr = btd_adapter_get_address(server->adapter);\n\n\t/* BR/EDR socket */\n\tserver->l2cap_io = bt_io_listen(connect_event, NULL, NULL, NULL, &gerr,\n\t\t\t\t\tBT_IO_OPT_SOURCE_BDADDR, addr,\n\t\t\t\t\tBT_IO_OPT_PSM, ATT_PSM,\n\t\t\t\t\tBT_IO_OPT_SEC_LEVEL, BT_IO_SEC_LOW,\n\t\t\t\t\tBT_IO_OPT_INVALID);\n\n\tif (server->l2cap_io == NULL) {\n\t\terror(\"%s\", gerr->message);\n\t\tg_error_free(gerr);\n\t\tgatt_server_free(server);\n\t\treturn -1;\n\t}\n\n\tif (!register_core_services(server)) {\n\t\tgatt_server_free(server);\n\t\treturn -1;\n\t}\n\n\t/* LE socket */\n\tserver->le_io = bt_io_listen(connect_event, NULL,\n\t\t\t\t\t&server->le_io, NULL, &gerr,\n\t\t\t\t\tBT_IO_OPT_SOURCE_BDADDR, addr,\n\t\t\t\t\tBT_IO_OPT_SOURCE_TYPE,\n\t\t\t\t\tbtd_adapter_get_address_type(adapter),\n\t\t\t\t\tBT_IO_OPT_CID, ATT_CID,\n\t\t\t\t\tBT_IO_OPT_SEC_LEVEL, BT_IO_SEC_LOW,\n\t\t\t\t\tBT_IO_OPT_INVALID);\n\n\tif (server->le_io == NULL) {\n\t\terror(\"%s\", gerr->message);\n\t\tg_error_free(gerr);\n\t\t/* Doesn't have LE support, continue */\n\t}\n\n\tservers = g_slist_prepend(servers, server);\n\treturn 0;\n}"
  },
  {
    "function_name": "register_core_services",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/attrib-server.c",
    "lines": "1287-1348",
    "snippet": "static gboolean register_core_services(struct gatt_server *server)\n{\n\tuint8_t atval[256];\n\tbt_uuid_t uuid;\n\tuint16_t appearance = 0x0000;\n\n\t/* GAP service: primary service definition */\n\tbt_uuid16_create(&uuid, GATT_PRIM_SVC_UUID);\n\tput_le16(GENERIC_ACCESS_PROFILE_ID, &atval[0]);\n\tattrib_db_add_new(server, 0x0001, &uuid, ATT_NONE, ATT_NOT_PERMITTED,\n\t\t\t\t\t\t\t\tatval, 2);\n\n\t/* GAP service: device name characteristic */\n\tserver->name_handle = 0x0006;\n\tbt_uuid16_create(&uuid, GATT_CHARAC_UUID);\n\tatval[0] = GATT_CHR_PROP_READ;\n\tput_le16(server->name_handle, &atval[1]);\n\tput_le16(GATT_CHARAC_DEVICE_NAME, &atval[3]);\n\tattrib_db_add_new(server, 0x0004, &uuid, ATT_NONE, ATT_NOT_PERMITTED,\n\t\t\t\t\t\t\t\tatval, 5);\n\n\t/* GAP service: device name attribute */\n\tbt_uuid16_create(&uuid, GATT_CHARAC_DEVICE_NAME);\n\tattrib_db_add_new(server, server->name_handle, &uuid, ATT_NONE,\n\t\t\t\t\t\tATT_NOT_PERMITTED, NULL, 0);\n\n\t/* GAP service: device appearance characteristic */\n\tserver->appearance_handle = 0x0008;\n\tbt_uuid16_create(&uuid, GATT_CHARAC_UUID);\n\tatval[0] = GATT_CHR_PROP_READ;\n\tput_le16(server->appearance_handle, &atval[1]);\n\tput_le16(GATT_CHARAC_APPEARANCE, &atval[3]);\n\tattrib_db_add_new(server, 0x0007, &uuid, ATT_NONE, ATT_NOT_PERMITTED,\n\t\t\t\t\t\t\t\tatval, 5);\n\n\t/* GAP service: device appearance attribute */\n\tbt_uuid16_create(&uuid, GATT_CHARAC_APPEARANCE);\n\tput_le16(appearance, &atval[0]);\n\tattrib_db_add_new(server, server->appearance_handle, &uuid, ATT_NONE,\n\t\t\t\t\t\tATT_NOT_PERMITTED, atval, 2);\n\tserver->gap_sdp_handle = attrib_create_sdp_new(server, 0x0001,\n\t\t\t\t\t\t\"Generic Access Profile\");\n\tif (server->gap_sdp_handle == 0) {\n\t\terror(\"Failed to register GAP service record\");\n\t\treturn FALSE;\n\t}\n\n\t/* GATT service: primary service definition */\n\tbt_uuid16_create(&uuid, GATT_PRIM_SVC_UUID);\n\tput_le16(GENERIC_ATTRIB_PROFILE_ID, &atval[0]);\n\tattrib_db_add_new(server, 0x0010, &uuid, ATT_NONE, ATT_NOT_PERMITTED,\n\t\t\t\t\t\t\t\tatval, 2);\n\n\tserver->gatt_sdp_handle = attrib_create_sdp_new(server, 0x0010,\n\t\t\t\t\t\t\"Generic Attribute Profile\");\n\tif (server->gatt_sdp_handle == 0) {\n\t\terror(\"Failed to register GATT service record\");\n\t\treturn FALSE;\n\t}\n\n\treturn TRUE;\n}",
    "includes": [
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"attrib/att-database.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"attrib/att.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"backtrace.h\"",
      "#include \"log.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <sys/stat.h>",
      "#include <glib.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdbool.h>",
      "#include <stdint.h>",
      "#include <errno.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"Failed to register GATT service record\""
          ],
          "line": 1343
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_not_ready",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "118-122",
          "snippet": "DBusMessage *btd_error_not_ready(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".NotReady\",\n\t\t\t\t\t\"Resource Not Ready\");\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_not_ready(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".NotReady\",\n\t\t\t\t\t\"Resource Not Ready\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "attrib_create_sdp_new",
          "args": [
            "server",
            "0x0010",
            "\"Generic Attribute Profile\""
          ],
          "line": 1340
        },
        "resolved": true,
        "details": {
          "function_name": "attrib_create_sdp_new",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/attrib-server.c",
          "lines": "294-337",
          "snippet": "static uint32_t attrib_create_sdp_new(struct gatt_server *server,\n\t\t\t\t\tuint16_t handle, const char *name)\n{\n\tsdp_record_t *record;\n\tstruct attribute *a;\n\tuint16_t end = 0;\n\tuuid_t svc, gap_uuid;\n\n\ta = find_svc_range(server, handle, &end);\n\n\tif (a == NULL)\n\t\treturn 0;\n\n\tif (a->len == 2)\n\t\tsdp_uuid16_create(&svc, get_le16(a->data));\n\telse if (a->len == 16) {\n\t\tuint8_t be128[16];\n\n\t\t/* Converting from LE to BE */\n\t\tbswap_128(a->data, be128);\n\t\tsdp_uuid128_create(&svc, be128);\n\t} else\n\t\treturn 0;\n\n\trecord = server_record_new(&svc, handle, end);\n\tif (record == NULL)\n\t\treturn 0;\n\n\tif (name != NULL)\n\t\tsdp_set_info_attr(record, name, \"BlueZ\", NULL);\n\n\tsdp_uuid16_create(&gap_uuid, GENERIC_ACCESS_PROFILE_ID);\n\tif (sdp_uuid_cmp(&svc, &gap_uuid) == 0) {\n\t\tsdp_set_url_attr(record, \"http://www.bluez.org/\",\n\t\t\t\t\"http://www.bluez.org/\",\n\t\t\t\t\"http://www.bluez.org/\");\n\t}\n\n\tif (adapter_service_add(server->adapter, record) == 0)\n\t\treturn record->handle;\n\n\tsdp_record_free(record);\n\treturn 0;\n}",
          "includes": [
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"attrib/att-database.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"backtrace.h\"",
            "#include \"log.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <sys/stat.h>",
            "#include <glib.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdbool.h>",
            "#include <stdint.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"attrib/att-database.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"src/shared/util.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <sys/stat.h>\n#include <glib.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdbool.h>\n#include <stdint.h>\n#include <errno.h>\n#include <config.h>\n\nstatic uint32_t attrib_create_sdp_new(struct gatt_server *server,\n\t\t\t\t\tuint16_t handle, const char *name)\n{\n\tsdp_record_t *record;\n\tstruct attribute *a;\n\tuint16_t end = 0;\n\tuuid_t svc, gap_uuid;\n\n\ta = find_svc_range(server, handle, &end);\n\n\tif (a == NULL)\n\t\treturn 0;\n\n\tif (a->len == 2)\n\t\tsdp_uuid16_create(&svc, get_le16(a->data));\n\telse if (a->len == 16) {\n\t\tuint8_t be128[16];\n\n\t\t/* Converting from LE to BE */\n\t\tbswap_128(a->data, be128);\n\t\tsdp_uuid128_create(&svc, be128);\n\t} else\n\t\treturn 0;\n\n\trecord = server_record_new(&svc, handle, end);\n\tif (record == NULL)\n\t\treturn 0;\n\n\tif (name != NULL)\n\t\tsdp_set_info_attr(record, name, \"BlueZ\", NULL);\n\n\tsdp_uuid16_create(&gap_uuid, GENERIC_ACCESS_PROFILE_ID);\n\tif (sdp_uuid_cmp(&svc, &gap_uuid) == 0) {\n\t\tsdp_set_url_attr(record, \"http://www.bluez.org/\",\n\t\t\t\t\"http://www.bluez.org/\",\n\t\t\t\t\"http://www.bluez.org/\");\n\t}\n\n\tif (adapter_service_add(server->adapter, record) == 0)\n\t\treturn record->handle;\n\n\tsdp_record_free(record);\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "attrib_db_add_new",
          "args": [
            "server",
            "0x0010",
            "&uuid",
            "ATT_NONE",
            "ATT_NOT_PERMITTED",
            "atval",
            "2"
          ],
          "line": 1337
        },
        "resolved": true,
        "details": {
          "function_name": "attrib_db_add_new",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/attrib-server.c",
          "lines": "339-365",
          "snippet": "static struct attribute *attrib_db_add_new(struct gatt_server *server,\n\t\t\t\tuint16_t handle, bt_uuid_t *uuid,\n\t\t\t\tint read_req, int write_req,\n\t\t\t\tconst uint8_t *value, size_t len)\n{\n\tstruct attribute *a;\n\tguint h = handle;\n\n\tDBG(\"handle=0x%04x\", handle);\n\n\tif (g_list_find_custom(server->database, GUINT_TO_POINTER(h),\n\t\t\t\t\t\t\t\thandle_cmp))\n\t\treturn NULL;\n\n\ta = g_new0(struct attribute, 1);\n\ta->len = len;\n\ta->data = g_memdup(value, len);\n\ta->handle = handle;\n\ta->uuid = *uuid;\n\ta->read_req = read_req;\n\ta->write_req = write_req;\n\n\tserver->database = g_list_insert_sorted(server->database, a,\n\t\t\t\t\t\t\t\tattribute_cmp);\n\n\treturn a;\n}",
          "includes": [
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"attrib/att-database.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"backtrace.h\"",
            "#include \"log.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <sys/stat.h>",
            "#include <glib.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdbool.h>",
            "#include <stdint.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"attrib/att-database.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"src/shared/util.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <sys/stat.h>\n#include <glib.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdbool.h>\n#include <stdint.h>\n#include <errno.h>\n#include <config.h>\n\nstatic struct attribute *attrib_db_add_new(struct gatt_server *server,\n\t\t\t\tuint16_t handle, bt_uuid_t *uuid,\n\t\t\t\tint read_req, int write_req,\n\t\t\t\tconst uint8_t *value, size_t len)\n{\n\tstruct attribute *a;\n\tguint h = handle;\n\n\tDBG(\"handle=0x%04x\", handle);\n\n\tif (g_list_find_custom(server->database, GUINT_TO_POINTER(h),\n\t\t\t\t\t\t\t\thandle_cmp))\n\t\treturn NULL;\n\n\ta = g_new0(struct attribute, 1);\n\ta->len = len;\n\ta->data = g_memdup(value, len);\n\ta->handle = handle;\n\ta->uuid = *uuid;\n\ta->read_req = read_req;\n\ta->write_req = write_req;\n\n\tserver->database = g_list_insert_sorted(server->database, a,\n\t\t\t\t\t\t\t\tattribute_cmp);\n\n\treturn a;\n}"
        }
      },
      {
        "call_info": {
          "callee": "put_le16",
          "args": [
            "GENERIC_ATTRIB_PROFILE_ID",
            "&atval[0]"
          ],
          "line": 1336
        },
        "resolved": true,
        "details": {
          "function_name": "put_le16",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/util.h",
          "lines": "159-162",
          "snippet": "static inline void put_le16(uint16_t val, void *dst)\n{\n\tput_unaligned(cpu_to_le16(val), (uint16_t *) dst);\n}",
          "includes": [
            "#include <string.h>",
            "#include <byteswap.h>",
            "#include <alloca.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <byteswap.h>\n#include <alloca.h>\n#include <stdlib.h>\n#include <stdint.h>\n\nstatic inline void put_le16(uint16_t val, void *dst)\n{\n\tput_unaligned(cpu_to_le16(val), (uint16_t *) dst);\n}"
        }
      },
      {
        "call_info": {
          "callee": "bt_uuid16_create",
          "args": [
            "&uuid",
            "GATT_PRIM_SVC_UUID"
          ],
          "line": 1335
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bt_uuid16_create",
          "args": [
            "&uuid",
            "GATT_CHARAC_APPEARANCE"
          ],
          "line": 1323
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bt_uuid16_create",
          "args": [
            "&uuid",
            "GATT_CHARAC_UUID"
          ],
          "line": 1315
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bt_uuid16_create",
          "args": [
            "&uuid",
            "GATT_CHARAC_DEVICE_NAME"
          ],
          "line": 1309
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bt_uuid16_create",
          "args": [
            "&uuid",
            "GATT_CHARAC_UUID"
          ],
          "line": 1301
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bt_uuid16_create",
          "args": [
            "&uuid",
            "GATT_PRIM_SVC_UUID"
          ],
          "line": 1294
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"attrib/att-database.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"src/shared/util.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <sys/stat.h>\n#include <glib.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdbool.h>\n#include <stdint.h>\n#include <errno.h>\n#include <config.h>\n\nstatic gboolean register_core_services(struct gatt_server *server)\n{\n\tuint8_t atval[256];\n\tbt_uuid_t uuid;\n\tuint16_t appearance = 0x0000;\n\n\t/* GAP service: primary service definition */\n\tbt_uuid16_create(&uuid, GATT_PRIM_SVC_UUID);\n\tput_le16(GENERIC_ACCESS_PROFILE_ID, &atval[0]);\n\tattrib_db_add_new(server, 0x0001, &uuid, ATT_NONE, ATT_NOT_PERMITTED,\n\t\t\t\t\t\t\t\tatval, 2);\n\n\t/* GAP service: device name characteristic */\n\tserver->name_handle = 0x0006;\n\tbt_uuid16_create(&uuid, GATT_CHARAC_UUID);\n\tatval[0] = GATT_CHR_PROP_READ;\n\tput_le16(server->name_handle, &atval[1]);\n\tput_le16(GATT_CHARAC_DEVICE_NAME, &atval[3]);\n\tattrib_db_add_new(server, 0x0004, &uuid, ATT_NONE, ATT_NOT_PERMITTED,\n\t\t\t\t\t\t\t\tatval, 5);\n\n\t/* GAP service: device name attribute */\n\tbt_uuid16_create(&uuid, GATT_CHARAC_DEVICE_NAME);\n\tattrib_db_add_new(server, server->name_handle, &uuid, ATT_NONE,\n\t\t\t\t\t\tATT_NOT_PERMITTED, NULL, 0);\n\n\t/* GAP service: device appearance characteristic */\n\tserver->appearance_handle = 0x0008;\n\tbt_uuid16_create(&uuid, GATT_CHARAC_UUID);\n\tatval[0] = GATT_CHR_PROP_READ;\n\tput_le16(server->appearance_handle, &atval[1]);\n\tput_le16(GATT_CHARAC_APPEARANCE, &atval[3]);\n\tattrib_db_add_new(server, 0x0007, &uuid, ATT_NONE, ATT_NOT_PERMITTED,\n\t\t\t\t\t\t\t\tatval, 5);\n\n\t/* GAP service: device appearance attribute */\n\tbt_uuid16_create(&uuid, GATT_CHARAC_APPEARANCE);\n\tput_le16(appearance, &atval[0]);\n\tattrib_db_add_new(server, server->appearance_handle, &uuid, ATT_NONE,\n\t\t\t\t\t\tATT_NOT_PERMITTED, atval, 2);\n\tserver->gap_sdp_handle = attrib_create_sdp_new(server, 0x0001,\n\t\t\t\t\t\t\"Generic Access Profile\");\n\tif (server->gap_sdp_handle == 0) {\n\t\terror(\"Failed to register GAP service record\");\n\t\treturn FALSE;\n\t}\n\n\t/* GATT service: primary service definition */\n\tbt_uuid16_create(&uuid, GATT_PRIM_SVC_UUID);\n\tput_le16(GENERIC_ATTRIB_PROFILE_ID, &atval[0]);\n\tattrib_db_add_new(server, 0x0010, &uuid, ATT_NONE, ATT_NOT_PERMITTED,\n\t\t\t\t\t\t\t\tatval, 2);\n\n\tserver->gatt_sdp_handle = attrib_create_sdp_new(server, 0x0010,\n\t\t\t\t\t\t\"Generic Attribute Profile\");\n\tif (server->gatt_sdp_handle == 0) {\n\t\terror(\"Failed to register GATT service record\");\n\t\treturn FALSE;\n\t}\n\n\treturn TRUE;\n}"
  },
  {
    "function_name": "connect_event",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/attrib-server.c",
    "lines": "1251-1285",
    "snippet": "static void connect_event(GIOChannel *io, GError *gerr, void *user_data)\n{\n\tstruct btd_adapter *adapter;\n\tstruct btd_device *device;\n\tuint8_t dst_type;\n\tbdaddr_t src, dst;\n\n\tDBG(\"\");\n\n\tif (gerr) {\n\t\terror(\"%s\", gerr->message);\n\t\treturn;\n\t}\n\n\tbt_io_get(io, &gerr,\n\t\t\tBT_IO_OPT_SOURCE_BDADDR, &src,\n\t\t\tBT_IO_OPT_DEST_BDADDR, &dst,\n\t\t\tBT_IO_OPT_DEST_TYPE, &dst_type,\n\t\t\tBT_IO_OPT_INVALID);\n\tif (gerr) {\n\t\terror(\"bt_io_get: %s\", gerr->message);\n\t\tg_error_free(gerr);\n\t\treturn;\n\t}\n\n\tadapter = adapter_find(&src);\n\tif (!adapter)\n\t\treturn;\n\n\tdevice = btd_adapter_get_device(adapter, &dst, dst_type);\n\tif (!device)\n\t\treturn;\n\n\tdevice_attach_att(device, io);\n}",
    "includes": [
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"attrib/att-database.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"attrib/att.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"backtrace.h\"",
      "#include \"log.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <sys/stat.h>",
      "#include <glib.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdbool.h>",
      "#include <stdint.h>",
      "#include <errno.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "device_attach_att",
          "args": [
            "device",
            "io"
          ],
          "line": 1284
        },
        "resolved": true,
        "details": {
          "function_name": "device_attach_att",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "4952-5033",
          "snippet": "bool device_attach_att(struct btd_device *dev, GIOChannel *io)\n{\n\tGError *gerr = NULL;\n\tGAttrib *attrib;\n\tBtIOSecLevel sec_level;\n\tuint16_t mtu;\n\tuint16_t cid;\n\tstruct btd_gatt_database *database;\n\tconst bdaddr_t *dst;\n\tchar dstaddr[18];\n\n\tbt_io_get(io, &gerr, BT_IO_OPT_SEC_LEVEL, &sec_level,\n\t\t\t\t\t\tBT_IO_OPT_IMTU, &mtu,\n\t\t\t\t\t\tBT_IO_OPT_CID, &cid,\n\t\t\t\t\t\tBT_IO_OPT_INVALID);\n\n\tif (gerr) {\n\t\terror(\"bt_io_get: %s\", gerr->message);\n\t\tg_error_free(gerr);\n\t\treturn false;\n\t}\n\n\tif (sec_level == BT_IO_SEC_LOW && dev->le_state.paired) {\n\t\tDBG(\"Elevating security level since LTK is available\");\n\n\t\tsec_level = BT_IO_SEC_MEDIUM;\n\t\tbt_io_set(io, &gerr, BT_IO_OPT_SEC_LEVEL, sec_level,\n\t\t\t\t\t\t\tBT_IO_OPT_INVALID);\n\t\tif (gerr) {\n\t\t\terror(\"bt_io_set: %s\", gerr->message);\n\t\t\tg_error_free(gerr);\n\t\t\treturn false;\n\t\t}\n\t}\n\n\tdev->att_mtu = MIN(mtu, main_opts.gatt_mtu);\n\tattrib = g_attrib_new(io,\n\t\t\tcid == ATT_CID ? BT_ATT_DEFAULT_LE_MTU : dev->att_mtu,\n\t\t\tfalse);\n\tif (!attrib) {\n\t\terror(\"Unable to create new GAttrib instance\");\n\t\treturn false;\n\t}\n\n\tdev->attrib = attrib;\n\tdev->att = g_attrib_get_att(attrib);\n\n\tbt_att_ref(dev->att);\n\n\tdev->att_disconn_id = bt_att_register_disconnect(dev->att,\n\t\t\t\t\t\tatt_disconnected_cb, dev, NULL);\n\tbt_att_set_close_on_unref(dev->att, true);\n\n\tif (dev->local_csrk)\n\t\tbt_att_set_local_key(dev->att, dev->local_csrk->key,\n\t\t\t\t\t\t\tlocal_counter, dev);\n\n\tif (dev->remote_csrk)\n\t\tbt_att_set_remote_key(dev->att, dev->remote_csrk->key,\n\t\t\t\t\t\t\tremote_counter, dev);\n\n\tdatabase = btd_adapter_get_database(dev->adapter);\n\n\tdst = device_get_address(dev);\n\tba2str(dst, dstaddr);\n\n\tif (gatt_db_isempty(dev->db))\n\t\tload_gatt_db(dev, btd_adapter_get_storage_dir(dev->adapter),\n\t\t\t\t\t\t\t\tdstaddr);\n\n\tgatt_client_init(dev);\n\tgatt_server_init(dev, database);\n\n\t/*\n\t * Remove the device from the connect_list and give the passive\n\t * scanning another chance to be restarted in case there are\n\t * other devices in the connect_list.\n\t */\n\tadapter_connect_list_remove(dev->adapter, dev);\n\n\treturn true;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nbool device_attach_att(struct btd_device *dev, GIOChannel *io)\n{\n\tGError *gerr = NULL;\n\tGAttrib *attrib;\n\tBtIOSecLevel sec_level;\n\tuint16_t mtu;\n\tuint16_t cid;\n\tstruct btd_gatt_database *database;\n\tconst bdaddr_t *dst;\n\tchar dstaddr[18];\n\n\tbt_io_get(io, &gerr, BT_IO_OPT_SEC_LEVEL, &sec_level,\n\t\t\t\t\t\tBT_IO_OPT_IMTU, &mtu,\n\t\t\t\t\t\tBT_IO_OPT_CID, &cid,\n\t\t\t\t\t\tBT_IO_OPT_INVALID);\n\n\tif (gerr) {\n\t\terror(\"bt_io_get: %s\", gerr->message);\n\t\tg_error_free(gerr);\n\t\treturn false;\n\t}\n\n\tif (sec_level == BT_IO_SEC_LOW && dev->le_state.paired) {\n\t\tDBG(\"Elevating security level since LTK is available\");\n\n\t\tsec_level = BT_IO_SEC_MEDIUM;\n\t\tbt_io_set(io, &gerr, BT_IO_OPT_SEC_LEVEL, sec_level,\n\t\t\t\t\t\t\tBT_IO_OPT_INVALID);\n\t\tif (gerr) {\n\t\t\terror(\"bt_io_set: %s\", gerr->message);\n\t\t\tg_error_free(gerr);\n\t\t\treturn false;\n\t\t}\n\t}\n\n\tdev->att_mtu = MIN(mtu, main_opts.gatt_mtu);\n\tattrib = g_attrib_new(io,\n\t\t\tcid == ATT_CID ? BT_ATT_DEFAULT_LE_MTU : dev->att_mtu,\n\t\t\tfalse);\n\tif (!attrib) {\n\t\terror(\"Unable to create new GAttrib instance\");\n\t\treturn false;\n\t}\n\n\tdev->attrib = attrib;\n\tdev->att = g_attrib_get_att(attrib);\n\n\tbt_att_ref(dev->att);\n\n\tdev->att_disconn_id = bt_att_register_disconnect(dev->att,\n\t\t\t\t\t\tatt_disconnected_cb, dev, NULL);\n\tbt_att_set_close_on_unref(dev->att, true);\n\n\tif (dev->local_csrk)\n\t\tbt_att_set_local_key(dev->att, dev->local_csrk->key,\n\t\t\t\t\t\t\tlocal_counter, dev);\n\n\tif (dev->remote_csrk)\n\t\tbt_att_set_remote_key(dev->att, dev->remote_csrk->key,\n\t\t\t\t\t\t\tremote_counter, dev);\n\n\tdatabase = btd_adapter_get_database(dev->adapter);\n\n\tdst = device_get_address(dev);\n\tba2str(dst, dstaddr);\n\n\tif (gatt_db_isempty(dev->db))\n\t\tload_gatt_db(dev, btd_adapter_get_storage_dir(dev->adapter),\n\t\t\t\t\t\t\t\tdstaddr);\n\n\tgatt_client_init(dev);\n\tgatt_server_init(dev, database);\n\n\t/*\n\t * Remove the device from the connect_list and give the passive\n\t * scanning another chance to be restarted in case there are\n\t * other devices in the connect_list.\n\t */\n\tadapter_connect_list_remove(dev->adapter, dev);\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_adapter_get_device",
          "args": [
            "adapter",
            "&dst",
            "dst_type"
          ],
          "line": 1280
        },
        "resolved": true,
        "details": {
          "function_name": "btd_adapter_get_device",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "1235-1249",
          "snippet": "struct btd_device *btd_adapter_get_device(struct btd_adapter *adapter,\n\t\t\t\t\tconst bdaddr_t *addr,\n\t\t\t\t\tuint8_t addr_type)\n{\n\tstruct btd_device *device;\n\n\tif (!adapter)\n\t\treturn NULL;\n\n\tdevice = btd_adapter_find_device(adapter, addr, addr_type);\n\tif (device)\n\t\treturn device;\n\n\treturn adapter_create_device(adapter, addr, addr_type);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void trigger_pairable_timeout(struct btd_adapter *adapter);",
            "static void adapter_start(struct btd_adapter *adapter);",
            "static void adapter_stop(struct btd_adapter *adapter);",
            "static void trigger_passive_scanning(struct btd_adapter *adapter);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void trigger_pairable_timeout(struct btd_adapter *adapter);\nstatic void adapter_start(struct btd_adapter *adapter);\nstatic void adapter_stop(struct btd_adapter *adapter);\nstatic void trigger_passive_scanning(struct btd_adapter *adapter);\n\nstruct btd_device *btd_adapter_get_device(struct btd_adapter *adapter,\n\t\t\t\t\tconst bdaddr_t *addr,\n\t\t\t\t\tuint8_t addr_type)\n{\n\tstruct btd_device *device;\n\n\tif (!adapter)\n\t\treturn NULL;\n\n\tdevice = btd_adapter_find_device(adapter, addr, addr_type);\n\tif (device)\n\t\treturn device;\n\n\treturn adapter_create_device(adapter, addr, addr_type);\n}"
        }
      },
      {
        "call_info": {
          "callee": "adapter_find",
          "args": [
            "&src"
          ],
          "line": 1276
        },
        "resolved": true,
        "details": {
          "function_name": "adapter_find_by_id",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "8013-8023",
          "snippet": "struct btd_adapter *adapter_find_by_id(int id)\n{\n\tGSList *match;\n\n\tmatch = g_slist_find_custom(adapters, GINT_TO_POINTER(id),\n\t\t\t\t\t\t\tadapter_id_cmp);\n\tif (!match)\n\t\treturn NULL;\n\n\treturn match->data;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static GSList *adapters = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic GSList *adapters = NULL;\n\nstruct btd_adapter *adapter_find_by_id(int id)\n{\n\tGSList *match;\n\n\tmatch = g_slist_find_custom(adapters, GINT_TO_POINTER(id),\n\t\t\t\t\t\t\tadapter_id_cmp);\n\tif (!match)\n\t\treturn NULL;\n\n\treturn match->data;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_error_free",
          "args": [
            "gerr"
          ],
          "line": 1272
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"bt_io_get: %s\"",
            "gerr->message"
          ],
          "line": 1271
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_failed",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "124-128",
          "snippet": "DBusMessage *btd_error_failed(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE\n\t\t\t\t\t\".Failed\", \"%s\", str);\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_failed(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE\n\t\t\t\t\t\".Failed\", \"%s\", str);\n}"
        }
      },
      {
        "call_info": {
          "callee": "bt_io_get",
          "args": [
            "io",
            "&gerr",
            "BT_IO_OPT_SOURCE_BDADDR",
            "&src",
            "BT_IO_OPT_DEST_BDADDR",
            "&dst",
            "BT_IO_OPT_DEST_TYPE",
            "&dst_type",
            "BT_IO_OPT_INVALID"
          ],
          "line": 1265
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"\""
          ],
          "line": 1258
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"attrib/att-database.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"src/shared/util.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <sys/stat.h>\n#include <glib.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdbool.h>\n#include <stdint.h>\n#include <errno.h>\n#include <config.h>\n\nstatic void connect_event(GIOChannel *io, GError *gerr, void *user_data)\n{\n\tstruct btd_adapter *adapter;\n\tstruct btd_device *device;\n\tuint8_t dst_type;\n\tbdaddr_t src, dst;\n\n\tDBG(\"\");\n\n\tif (gerr) {\n\t\terror(\"%s\", gerr->message);\n\t\treturn;\n\t}\n\n\tbt_io_get(io, &gerr,\n\t\t\tBT_IO_OPT_SOURCE_BDADDR, &src,\n\t\t\tBT_IO_OPT_DEST_BDADDR, &dst,\n\t\t\tBT_IO_OPT_DEST_TYPE, &dst_type,\n\t\t\tBT_IO_OPT_INVALID);\n\tif (gerr) {\n\t\terror(\"bt_io_get: %s\", gerr->message);\n\t\tg_error_free(gerr);\n\t\treturn;\n\t}\n\n\tadapter = adapter_find(&src);\n\tif (!adapter)\n\t\treturn;\n\n\tdevice = btd_adapter_get_device(adapter, &dst, dst_type);\n\tif (!device)\n\t\treturn;\n\n\tdevice_attach_att(device, io);\n}"
  },
  {
    "function_name": "attrib_channel_detach",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/attrib-server.c",
    "lines": "1237-1249",
    "snippet": "gboolean attrib_channel_detach(GAttrib *attrib, guint id)\n{\n\tstruct gatt_channel *channel;\n\n\tchannel = find_channel(id);\n\tif (channel == NULL)\n\t\treturn FALSE;\n\n\tg_attrib_unregister(channel->attrib, channel->id);\n\tchannel_remove(channel);\n\n\treturn TRUE;\n}",
    "includes": [
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"attrib/att-database.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"attrib/att.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"backtrace.h\"",
      "#include \"log.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <sys/stat.h>",
      "#include <glib.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdbool.h>",
      "#include <stdint.h>",
      "#include <errno.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "channel_remove",
          "args": [
            "channel"
          ],
          "line": 1246
        },
        "resolved": true,
        "details": {
          "function_name": "channel_remove",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/attrib-server.c",
          "lines": "974-979",
          "snippet": "static void channel_remove(struct gatt_channel *channel)\n{\n\tchannel->server->clients = g_slist_remove(channel->server->clients,\n\t\t\t\t\t\t\t\tchannel);\n\tchannel_free(channel);\n}",
          "includes": [
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"attrib/att-database.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"backtrace.h\"",
            "#include \"log.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <sys/stat.h>",
            "#include <glib.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdbool.h>",
            "#include <stdint.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"attrib/att-database.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"src/shared/util.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <sys/stat.h>\n#include <glib.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdbool.h>\n#include <stdint.h>\n#include <errno.h>\n#include <config.h>\n\nstatic void channel_remove(struct gatt_channel *channel)\n{\n\tchannel->server->clients = g_slist_remove(channel->server->clients,\n\t\t\t\t\t\t\t\tchannel);\n\tchannel_free(channel);\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_attrib_unregister",
          "args": [
            "channel->attrib",
            "channel->id"
          ],
          "line": 1245
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "find_channel",
          "args": [
            "id"
          ],
          "line": 1241
        },
        "resolved": true,
        "details": {
          "function_name": "find_channel",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/attrib-server.c",
          "lines": "1218-1235",
          "snippet": "static struct gatt_channel *find_channel(guint id)\n{\n\tGSList *l;\n\n\tfor (l = servers; l; l = g_slist_next(l)) {\n\t\tstruct gatt_server *server = l->data;\n\t\tGSList *c;\n\n\t\tfor (c = server->clients; c; c = g_slist_next(c)) {\n\t\t\tstruct gatt_channel *channel = c->data;\n\n\t\t\tif (channel->id == id)\n\t\t\t\treturn channel;\n\t\t}\n\t}\n\n\treturn NULL;\n}",
          "includes": [
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"attrib/att-database.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"backtrace.h\"",
            "#include \"log.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <sys/stat.h>",
            "#include <glib.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdbool.h>",
            "#include <stdint.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static GSList *servers = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"attrib/att-database.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"src/shared/util.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <sys/stat.h>\n#include <glib.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdbool.h>\n#include <stdint.h>\n#include <errno.h>\n#include <config.h>\n\nstatic GSList *servers = NULL;\n\nstatic struct gatt_channel *find_channel(guint id)\n{\n\tGSList *l;\n\n\tfor (l = servers; l; l = g_slist_next(l)) {\n\t\tstruct gatt_server *server = l->data;\n\t\tGSList *c;\n\n\t\tfor (c = server->clients; c; c = g_slist_next(c)) {\n\t\t\tstruct gatt_channel *channel = c->data;\n\n\t\t\tif (channel->id == id)\n\t\t\t\treturn channel;\n\t\t}\n\t}\n\n\treturn NULL;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"attrib/att-database.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"src/shared/util.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <sys/stat.h>\n#include <glib.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdbool.h>\n#include <stdint.h>\n#include <errno.h>\n#include <config.h>\n\ngboolean attrib_channel_detach(GAttrib *attrib, guint id)\n{\n\tstruct gatt_channel *channel;\n\n\tchannel = find_channel(id);\n\tif (channel == NULL)\n\t\treturn FALSE;\n\n\tg_attrib_unregister(channel->attrib, channel->id);\n\tchannel_remove(channel);\n\n\treturn TRUE;\n}"
  },
  {
    "function_name": "find_channel",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/attrib-server.c",
    "lines": "1218-1235",
    "snippet": "static struct gatt_channel *find_channel(guint id)\n{\n\tGSList *l;\n\n\tfor (l = servers; l; l = g_slist_next(l)) {\n\t\tstruct gatt_server *server = l->data;\n\t\tGSList *c;\n\n\t\tfor (c = server->clients; c; c = g_slist_next(c)) {\n\t\t\tstruct gatt_channel *channel = c->data;\n\n\t\t\tif (channel->id == id)\n\t\t\t\treturn channel;\n\t\t}\n\t}\n\n\treturn NULL;\n}",
    "includes": [
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"attrib/att-database.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"attrib/att.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"backtrace.h\"",
      "#include \"log.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <sys/stat.h>",
      "#include <glib.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdbool.h>",
      "#include <stdint.h>",
      "#include <errno.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static GSList *servers = NULL;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_slist_next",
          "args": [
            "c"
          ],
          "line": 1226
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_slist_next",
          "args": [
            "l"
          ],
          "line": 1222
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"attrib/att-database.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"src/shared/util.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <sys/stat.h>\n#include <glib.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdbool.h>\n#include <stdint.h>\n#include <errno.h>\n#include <config.h>\n\nstatic GSList *servers = NULL;\n\nstatic struct gatt_channel *find_channel(guint id)\n{\n\tGSList *l;\n\n\tfor (l = servers; l; l = g_slist_next(l)) {\n\t\tstruct gatt_server *server = l->data;\n\t\tGSList *c;\n\n\t\tfor (c = server->clients; c; c = g_slist_next(c)) {\n\t\t\tstruct gatt_channel *channel = c->data;\n\n\t\t\tif (channel->id == id)\n\t\t\t\treturn channel;\n\t\t}\n\t}\n\n\treturn NULL;\n}"
  },
  {
    "function_name": "attrib_channel_attach",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/attrib-server.c",
    "lines": "1145-1216",
    "snippet": "guint attrib_channel_attach(GAttrib *attrib)\n{\n\tstruct gatt_server *server;\n\tstruct btd_device *device;\n\tstruct gatt_channel *channel;\n\tbdaddr_t src, dst;\n\tGIOChannel *io;\n\tGError *gerr = NULL;\n\tuint8_t bdaddr_type;\n\tuint16_t cid;\n\tguint mtu = 0;\n\n\tio = g_attrib_get_channel(attrib);\n\n\tbt_io_get(io, &gerr,\n\t\t\tBT_IO_OPT_SOURCE_BDADDR, &src,\n\t\t\tBT_IO_OPT_DEST_BDADDR, &dst,\n\t\t\tBT_IO_OPT_DEST_TYPE, &bdaddr_type,\n\t\t\tBT_IO_OPT_CID, &cid,\n\t\t\tBT_IO_OPT_IMTU, &mtu,\n\t\t\tBT_IO_OPT_INVALID);\n\tif (gerr) {\n\t\terror(\"bt_io_get: %s\", gerr->message);\n\t\tg_error_free(gerr);\n\t\treturn 0;\n\t}\n\n\tserver = find_gatt_server(&src);\n\tif (server == NULL)\n\t\treturn 0;\n\n\tchannel = g_new0(struct gatt_channel, 1);\n\tchannel->server = server;\n\n\tdevice = btd_adapter_find_device(server->adapter, &dst, bdaddr_type);\n\tif (device == NULL) {\n\t\terror(\"Device object not found for attrib server\");\n\t\tg_free(channel);\n\t\treturn 0;\n\t}\n\n\tif (!device_is_bonded(device, bdaddr_type)) {\n\t\tchar *filename;\n\n\t\tfilename = btd_device_get_storage_path(device, \"ccc\");\n\t\tif (filename) {\n\t\t\tunlink(filename);\n\t\t\tg_free(filename);\n\t\t}\n\t}\n\n\tif (cid != ATT_CID) {\n\t\tchannel->le = FALSE;\n\t\tchannel->mtu = mtu;\n\t} else {\n\t\tchannel->le = TRUE;\n\t\tchannel->mtu = ATT_DEFAULT_LE_MTU;\n\t}\n\n\tchannel->attrib = g_attrib_ref(attrib);\n\tchannel->id = g_attrib_register(channel->attrib, GATTRIB_ALL_REQS,\n\t\t\tGATTRIB_ALL_HANDLES, channel_handler, channel, NULL);\n\n\tchannel->cleanup_id = g_io_add_watch(io, G_IO_HUP, channel_watch_cb,\n\t\t\t\t\t\t\t\tchannel);\n\n\tchannel->device = btd_device_ref(device);\n\n\tserver->clients = g_slist_append(server->clients, channel);\n\n\treturn channel->id;\n}",
    "includes": [
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"attrib/att-database.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"attrib/att.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"backtrace.h\"",
      "#include \"log.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <sys/stat.h>",
      "#include <glib.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdbool.h>",
      "#include <stdint.h>",
      "#include <errno.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_slist_append",
          "args": [
            "server->clients",
            "channel"
          ],
          "line": 1213
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_device_ref",
          "args": [
            "device"
          ],
          "line": 1211
        },
        "resolved": true,
        "details": {
          "function_name": "btd_device_ref",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "6357-6362",
          "snippet": "struct btd_device *btd_device_ref(struct btd_device *device)\n{\n\t__sync_fetch_and_add(&device->ref_count, 1);\n\n\treturn device;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstruct btd_device *btd_device_ref(struct btd_device *device)\n{\n\t__sync_fetch_and_add(&device->ref_count, 1);\n\n\treturn device;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_io_add_watch",
          "args": [
            "io",
            "G_IO_HUP",
            "channel_watch_cb",
            "channel"
          ],
          "line": 1208
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_attrib_register",
          "args": [
            "channel->attrib",
            "GATTRIB_ALL_REQS",
            "GATTRIB_ALL_HANDLES",
            "channel_handler",
            "channel",
            "NULL"
          ],
          "line": 1205
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_attrib_ref",
          "args": [
            "attrib"
          ],
          "line": 1204
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_free",
          "args": [
            "filename"
          ],
          "line": 1192
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "unlink",
          "args": [
            "filename"
          ],
          "line": 1191
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_device_get_storage_path",
          "args": [
            "device",
            "\"ccc\""
          ],
          "line": 1189
        },
        "resolved": true,
        "details": {
          "function_name": "btd_device_get_storage_path",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "3867-3888",
          "snippet": "char *btd_device_get_storage_path(struct btd_device *device,\n\t\t\t\tconst char *filename)\n{\n\tchar dstaddr[18];\n\n\tif (device_address_is_private(device)) {\n\t\twarn(\"Refusing storage path for private addressed device %s\",\n\t\t\t\t\t\t\t\tdevice->path);\n\t\treturn NULL;\n\t}\n\n\tba2str(&device->bdaddr, dstaddr);\n\n\tif (!filename)\n\t\treturn g_strdup_printf(STORAGEDIR \"/%s/%s\",\n\t\t\t\tbtd_adapter_get_storage_dir(device->adapter),\n\t\t\t\tdstaddr);\n\n\treturn g_strdup_printf(STORAGEDIR \"/%s/%s/%s\",\n\t\t\t\tbtd_adapter_get_storage_dir(device->adapter),\n\t\t\t\tdstaddr, filename);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nchar *btd_device_get_storage_path(struct btd_device *device,\n\t\t\t\tconst char *filename)\n{\n\tchar dstaddr[18];\n\n\tif (device_address_is_private(device)) {\n\t\twarn(\"Refusing storage path for private addressed device %s\",\n\t\t\t\t\t\t\t\tdevice->path);\n\t\treturn NULL;\n\t}\n\n\tba2str(&device->bdaddr, dstaddr);\n\n\tif (!filename)\n\t\treturn g_strdup_printf(STORAGEDIR \"/%s/%s\",\n\t\t\t\tbtd_adapter_get_storage_dir(device->adapter),\n\t\t\t\tdstaddr);\n\n\treturn g_strdup_printf(STORAGEDIR \"/%s/%s/%s\",\n\t\t\t\tbtd_adapter_get_storage_dir(device->adapter),\n\t\t\t\tdstaddr, filename);\n}"
        }
      },
      {
        "call_info": {
          "callee": "device_is_bonded",
          "args": [
            "device",
            "bdaddr_type"
          ],
          "line": 1186
        },
        "resolved": true,
        "details": {
          "function_name": "device_is_bonded",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "703-708",
          "snippet": "bool device_is_bonded(struct btd_device *device, uint8_t bdaddr_type)\n{\n\tstruct bearer_state *state = get_state(device, bdaddr_type);\n\n\treturn state->bonded;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nbool device_is_bonded(struct btd_device *device, uint8_t bdaddr_type)\n{\n\tstruct bearer_state *state = get_state(device, bdaddr_type);\n\n\treturn state->bonded;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_free",
          "args": [
            "channel"
          ],
          "line": 1182
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"Device object not found for attrib server\""
          ],
          "line": 1181
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_not_ready",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "118-122",
          "snippet": "DBusMessage *btd_error_not_ready(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".NotReady\",\n\t\t\t\t\t\"Resource Not Ready\");\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_not_ready(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".NotReady\",\n\t\t\t\t\t\"Resource Not Ready\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_adapter_find_device",
          "args": [
            "server->adapter",
            "&dst",
            "bdaddr_type"
          ],
          "line": 1179
        },
        "resolved": true,
        "details": {
          "function_name": "btd_adapter_find_device",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "831-863",
          "snippet": "struct btd_device *btd_adapter_find_device(struct btd_adapter *adapter,\n\t\t\t\t\t\t\tconst bdaddr_t *dst,\n\t\t\t\t\t\t\tuint8_t bdaddr_type)\n{\n\tstruct device_addr_type addr;\n\tstruct btd_device *device;\n\tGSList *list;\n\n\tif (!adapter)\n\t\treturn NULL;\n\n\tbacpy(&addr.bdaddr, dst);\n\taddr.bdaddr_type = bdaddr_type;\n\n\tlist = g_slist_find_custom(adapter->devices, &addr,\n\t\t\t\t\t\t\tdevice_addr_type_cmp);\n\tif (!list)\n\t\treturn NULL;\n\n\tdevice = list->data;\n\n\t/*\n\t * If we're looking up based on public address and the address\n\t * was not previously used over this bearer we may need to\n\t * update LE or BR/EDR support information.\n\t */\n\tif (bdaddr_type == BDADDR_BREDR)\n\t\tdevice_set_bredr_support(device);\n\telse\n\t\tdevice_set_le_support(device, bdaddr_type);\n\n\treturn device;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void trigger_pairable_timeout(struct btd_adapter *adapter);",
            "static void adapter_start(struct btd_adapter *adapter);",
            "static void adapter_stop(struct btd_adapter *adapter);",
            "static void trigger_passive_scanning(struct btd_adapter *adapter);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void trigger_pairable_timeout(struct btd_adapter *adapter);\nstatic void adapter_start(struct btd_adapter *adapter);\nstatic void adapter_stop(struct btd_adapter *adapter);\nstatic void trigger_passive_scanning(struct btd_adapter *adapter);\n\nstruct btd_device *btd_adapter_find_device(struct btd_adapter *adapter,\n\t\t\t\t\t\t\tconst bdaddr_t *dst,\n\t\t\t\t\t\t\tuint8_t bdaddr_type)\n{\n\tstruct device_addr_type addr;\n\tstruct btd_device *device;\n\tGSList *list;\n\n\tif (!adapter)\n\t\treturn NULL;\n\n\tbacpy(&addr.bdaddr, dst);\n\taddr.bdaddr_type = bdaddr_type;\n\n\tlist = g_slist_find_custom(adapter->devices, &addr,\n\t\t\t\t\t\t\tdevice_addr_type_cmp);\n\tif (!list)\n\t\treturn NULL;\n\n\tdevice = list->data;\n\n\t/*\n\t * If we're looking up based on public address and the address\n\t * was not previously used over this bearer we may need to\n\t * update LE or BR/EDR support information.\n\t */\n\tif (bdaddr_type == BDADDR_BREDR)\n\t\tdevice_set_bredr_support(device);\n\telse\n\t\tdevice_set_le_support(device, bdaddr_type);\n\n\treturn device;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_new0",
          "args": [
            "structgatt_channel",
            "1"
          ],
          "line": 1176
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "find_gatt_server",
          "args": [
            "&src"
          ],
          "line": 1172
        },
        "resolved": true,
        "details": {
          "function_name": "find_gatt_server",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/attrib-server.c",
          "lines": "171-185",
          "snippet": "static struct gatt_server *find_gatt_server(const bdaddr_t *bdaddr)\n{\n\tGSList *l;\n\n\tl = g_slist_find_custom(servers, bdaddr, adapter_cmp_addr);\n\tif (l == NULL) {\n\t\tchar addr[18];\n\n\t\tba2str(bdaddr, addr);\n\t\terror(\"No GATT server found in %s\", addr);\n\t\treturn NULL;\n\t}\n\n\treturn l->data;\n}",
          "includes": [
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"attrib/att-database.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"backtrace.h\"",
            "#include \"log.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <sys/stat.h>",
            "#include <glib.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdbool.h>",
            "#include <stdint.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static GSList *servers = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"attrib/att-database.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"src/shared/util.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <sys/stat.h>\n#include <glib.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdbool.h>\n#include <stdint.h>\n#include <errno.h>\n#include <config.h>\n\nstatic GSList *servers = NULL;\n\nstatic struct gatt_server *find_gatt_server(const bdaddr_t *bdaddr)\n{\n\tGSList *l;\n\n\tl = g_slist_find_custom(servers, bdaddr, adapter_cmp_addr);\n\tif (l == NULL) {\n\t\tchar addr[18];\n\n\t\tba2str(bdaddr, addr);\n\t\terror(\"No GATT server found in %s\", addr);\n\t\treturn NULL;\n\t}\n\n\treturn l->data;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_error_free",
          "args": [
            "gerr"
          ],
          "line": 1168
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"bt_io_get: %s\"",
            "gerr->message"
          ],
          "line": 1167
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_failed",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "124-128",
          "snippet": "DBusMessage *btd_error_failed(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE\n\t\t\t\t\t\".Failed\", \"%s\", str);\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_failed(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE\n\t\t\t\t\t\".Failed\", \"%s\", str);\n}"
        }
      },
      {
        "call_info": {
          "callee": "bt_io_get",
          "args": [
            "io",
            "&gerr",
            "BT_IO_OPT_SOURCE_BDADDR",
            "&src",
            "BT_IO_OPT_DEST_BDADDR",
            "&dst",
            "BT_IO_OPT_DEST_TYPE",
            "&bdaddr_type",
            "BT_IO_OPT_CID",
            "&cid",
            "BT_IO_OPT_IMTU",
            "&mtu",
            "BT_IO_OPT_INVALID"
          ],
          "line": 1159
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_attrib_get_channel",
          "args": [
            "attrib"
          ],
          "line": 1157
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"attrib/att-database.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"src/shared/util.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <sys/stat.h>\n#include <glib.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdbool.h>\n#include <stdint.h>\n#include <errno.h>\n#include <config.h>\n\nguint attrib_channel_attach(GAttrib *attrib)\n{\n\tstruct gatt_server *server;\n\tstruct btd_device *device;\n\tstruct gatt_channel *channel;\n\tbdaddr_t src, dst;\n\tGIOChannel *io;\n\tGError *gerr = NULL;\n\tuint8_t bdaddr_type;\n\tuint16_t cid;\n\tguint mtu = 0;\n\n\tio = g_attrib_get_channel(attrib);\n\n\tbt_io_get(io, &gerr,\n\t\t\tBT_IO_OPT_SOURCE_BDADDR, &src,\n\t\t\tBT_IO_OPT_DEST_BDADDR, &dst,\n\t\t\tBT_IO_OPT_DEST_TYPE, &bdaddr_type,\n\t\t\tBT_IO_OPT_CID, &cid,\n\t\t\tBT_IO_OPT_IMTU, &mtu,\n\t\t\tBT_IO_OPT_INVALID);\n\tif (gerr) {\n\t\terror(\"bt_io_get: %s\", gerr->message);\n\t\tg_error_free(gerr);\n\t\treturn 0;\n\t}\n\n\tserver = find_gatt_server(&src);\n\tif (server == NULL)\n\t\treturn 0;\n\n\tchannel = g_new0(struct gatt_channel, 1);\n\tchannel->server = server;\n\n\tdevice = btd_adapter_find_device(server->adapter, &dst, bdaddr_type);\n\tif (device == NULL) {\n\t\terror(\"Device object not found for attrib server\");\n\t\tg_free(channel);\n\t\treturn 0;\n\t}\n\n\tif (!device_is_bonded(device, bdaddr_type)) {\n\t\tchar *filename;\n\n\t\tfilename = btd_device_get_storage_path(device, \"ccc\");\n\t\tif (filename) {\n\t\t\tunlink(filename);\n\t\t\tg_free(filename);\n\t\t}\n\t}\n\n\tif (cid != ATT_CID) {\n\t\tchannel->le = FALSE;\n\t\tchannel->mtu = mtu;\n\t} else {\n\t\tchannel->le = TRUE;\n\t\tchannel->mtu = ATT_DEFAULT_LE_MTU;\n\t}\n\n\tchannel->attrib = g_attrib_ref(attrib);\n\tchannel->id = g_attrib_register(channel->attrib, GATTRIB_ALL_REQS,\n\t\t\tGATTRIB_ALL_HANDLES, channel_handler, channel, NULL);\n\n\tchannel->cleanup_id = g_io_add_watch(io, G_IO_HUP, channel_watch_cb,\n\t\t\t\t\t\t\t\tchannel);\n\n\tchannel->device = btd_device_ref(device);\n\n\tserver->clients = g_slist_append(server->clients, channel);\n\n\treturn channel->id;\n}"
  },
  {
    "function_name": "attrib_from_device",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/attrib-server.c",
    "lines": "1123-1143",
    "snippet": "GAttrib *attrib_from_device(struct btd_device *device)\n{\n\tstruct btd_adapter *adapter = device_get_adapter(device);\n\tstruct gatt_server *server;\n\tGSList *l;\n\n\tl = g_slist_find_custom(servers, adapter, adapter_cmp);\n\tif (!l)\n\t\treturn NULL;\n\n\tserver = l->data;\n\n\tfor (l = server->clients; l; l = l->next) {\n\t\tstruct gatt_channel *channel = l->data;\n\n\t\tif (channel->device == device)\n\t\t\treturn g_attrib_ref(channel->attrib);\n\t}\n\n\treturn NULL;\n}",
    "includes": [
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"attrib/att-database.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"attrib/att.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"backtrace.h\"",
      "#include \"log.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <sys/stat.h>",
      "#include <glib.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdbool.h>",
      "#include <stdint.h>",
      "#include <errno.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static GSList *servers = NULL;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_attrib_ref",
          "args": [
            "channel->attrib"
          ],
          "line": 1139
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_slist_find_custom",
          "args": [
            "servers",
            "adapter",
            "adapter_cmp"
          ],
          "line": 1129
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "device_get_adapter",
          "args": [
            "device"
          ],
          "line": 1125
        },
        "resolved": true,
        "details": {
          "function_name": "device_get_adapter",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "5306-5312",
          "snippet": "struct btd_adapter *device_get_adapter(struct btd_device *device)\n{\n\tif (!device)\n\t\treturn NULL;\n\n\treturn device->adapter;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstruct btd_adapter *device_get_adapter(struct btd_device *device)\n{\n\tif (!device)\n\t\treturn NULL;\n\n\treturn device->adapter;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"attrib/att-database.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"src/shared/util.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <sys/stat.h>\n#include <glib.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdbool.h>\n#include <stdint.h>\n#include <errno.h>\n#include <config.h>\n\nstatic GSList *servers = NULL;\n\nGAttrib *attrib_from_device(struct btd_device *device)\n{\n\tstruct btd_adapter *adapter = device_get_adapter(device);\n\tstruct gatt_server *server;\n\tGSList *l;\n\n\tl = g_slist_find_custom(servers, adapter, adapter_cmp);\n\tif (!l)\n\t\treturn NULL;\n\n\tserver = l->data;\n\n\tfor (l = server->clients; l; l = l->next) {\n\t\tstruct gatt_channel *channel = l->data;\n\n\t\tif (channel->device == device)\n\t\t\treturn g_attrib_ref(channel->attrib);\n\t}\n\n\treturn NULL;\n}"
  },
  {
    "function_name": "channel_handler",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/attrib-server.c",
    "lines": "989-1121",
    "snippet": "static void channel_handler(const uint8_t *ipdu, uint16_t len,\n\t\t\t\t\t\t\tgpointer user_data)\n{\n\tstruct gatt_channel *channel = user_data;\n\tuint8_t opdu[channel->mtu];\n\tuint16_t length, start, end, mtu, offset;\n\tbt_uuid_t uuid;\n\tuint8_t status = 0;\n\tsize_t vlen;\n\tuint8_t *value = g_attrib_get_buffer(channel->attrib, &vlen);\n\n\tDBG(\"op 0x%02x\", ipdu[0]);\n\n\tif (len > vlen) {\n\t\terror(\"Too much data on ATT socket\");\n\t\tstatus = ATT_ECODE_INVALID_PDU;\n\t\tgoto done;\n\t}\n\n\tswitch (ipdu[0]) {\n\tcase ATT_OP_READ_BY_GROUP_REQ:\n\t\tlength = dec_read_by_grp_req(ipdu, len, &start, &end, &uuid);\n\t\tif (length == 0) {\n\t\t\tstatus = ATT_ECODE_INVALID_PDU;\n\t\t\tgoto done;\n\t\t}\n\n\t\tlength = read_by_group(channel, start, end, &uuid, opdu,\n\t\t\t\t\t\t\t\tchannel->mtu);\n\t\tbreak;\n\tcase ATT_OP_READ_BY_TYPE_REQ:\n\t\tlength = dec_read_by_type_req(ipdu, len, &start, &end, &uuid);\n\t\tif (length == 0) {\n\t\t\tstatus = ATT_ECODE_INVALID_PDU;\n\t\t\tgoto done;\n\t\t}\n\n\t\tlength = read_by_type(channel, start, end, &uuid, opdu,\n\t\t\t\t\t\t\t\tchannel->mtu);\n\t\tbreak;\n\tcase ATT_OP_READ_REQ:\n\t\tlength = dec_read_req(ipdu, len, &start);\n\t\tif (length == 0) {\n\t\t\tstatus = ATT_ECODE_INVALID_PDU;\n\t\t\tgoto done;\n\t\t}\n\n\t\tlength = read_value(channel, start, opdu, channel->mtu);\n\t\tbreak;\n\tcase ATT_OP_READ_BLOB_REQ:\n\t\tlength = dec_read_blob_req(ipdu, len, &start, &offset);\n\t\tif (length == 0) {\n\t\t\tstatus = ATT_ECODE_INVALID_PDU;\n\t\t\tgoto done;\n\t\t}\n\n\t\tlength = read_blob(channel, start, offset, opdu, channel->mtu);\n\t\tbreak;\n\tcase ATT_OP_MTU_REQ:\n\t\tif (!channel->le) {\n\t\t\tstatus = ATT_ECODE_REQ_NOT_SUPP;\n\t\t\tgoto done;\n\t\t}\n\n\t\tlength = dec_mtu_req(ipdu, len, &mtu);\n\t\tif (length == 0) {\n\t\t\tstatus = ATT_ECODE_INVALID_PDU;\n\t\t\tgoto done;\n\t\t}\n\n\t\tlength = mtu_exchange(channel, mtu, opdu, channel->mtu);\n\t\tbreak;\n\tcase ATT_OP_FIND_INFO_REQ:\n\t\tlength = dec_find_info_req(ipdu, len, &start, &end);\n\t\tif (length == 0) {\n\t\t\tstatus = ATT_ECODE_INVALID_PDU;\n\t\t\tgoto done;\n\t\t}\n\n\t\tlength = find_info(channel, start, end, opdu, channel->mtu);\n\t\tbreak;\n\tcase ATT_OP_WRITE_REQ:\n\t\tlength = dec_write_req(ipdu, len, &start, value, &vlen);\n\t\tif (length == 0) {\n\t\t\tstatus = ATT_ECODE_INVALID_PDU;\n\t\t\tgoto done;\n\t\t}\n\n\t\tlength = write_value(channel, start, value, vlen, opdu,\n\t\t\t\t\t\t\t\tchannel->mtu);\n\t\tbreak;\n\tcase ATT_OP_WRITE_CMD:\n\t\tlength = dec_write_cmd(ipdu, len, &start, value, &vlen);\n\t\tif (length > 0)\n\t\t\twrite_value(channel, start, value, vlen, opdu,\n\t\t\t\t\t\t\t\tchannel->mtu);\n\t\treturn;\n\tcase ATT_OP_FIND_BY_TYPE_REQ:\n\t\tlength = dec_find_by_type_req(ipdu, len, &start, &end,\n\t\t\t\t\t\t\t&uuid, value, &vlen);\n\t\tif (length == 0) {\n\t\t\tstatus = ATT_ECODE_INVALID_PDU;\n\t\t\tgoto done;\n\t\t}\n\n\t\tlength = find_by_type(channel, start, end, &uuid, value, vlen,\n\t\t\t\t\t\t\topdu, channel->mtu);\n\t\tbreak;\n\tcase ATT_OP_HANDLE_CNF:\n\t\treturn;\n\tcase ATT_OP_HANDLE_IND:\n\tcase ATT_OP_HANDLE_NOTIFY:\n\t\t/* The attribute client is already handling these */\n\t\treturn;\n\tcase ATT_OP_READ_MULTI_REQ:\n\tcase ATT_OP_PREP_WRITE_REQ:\n\tcase ATT_OP_EXEC_WRITE_REQ:\n\tdefault:\n\t\tDBG(\"Unsupported request 0x%02x\", ipdu[0]);\n\t\tstatus = ATT_ECODE_REQ_NOT_SUPP;\n\t\tgoto done;\n\t}\n\n\tif (length == 0)\n\t\tstatus = ATT_ECODE_IO;\n\ndone:\n\tif (status)\n\t\tlength = enc_error_resp(ipdu[0], 0x0000, status, opdu,\n\t\t\t\t\t\t\t\tchannel->mtu);\n\n\tg_attrib_send(channel->attrib, 0, opdu, length, NULL, NULL, NULL);\n}",
    "includes": [
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"attrib/att-database.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"attrib/att.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"backtrace.h\"",
      "#include \"log.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <sys/stat.h>",
      "#include <glib.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdbool.h>",
      "#include <stdint.h>",
      "#include <errno.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_attrib_send",
          "args": [
            "channel->attrib",
            "0",
            "opdu",
            "length",
            "NULL",
            "NULL",
            "NULL"
          ],
          "line": 1120
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "enc_error_resp",
          "args": [
            "ipdu[0]",
            "0x0000",
            "status",
            "opdu",
            "channel->mtu"
          ],
          "line": 1117
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"Unsupported request 0x%02x\"",
            "ipdu[0]"
          ],
          "line": 1107
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "find_by_type",
          "args": [
            "channel",
            "start",
            "end",
            "&uuid",
            "value",
            "vlen",
            "opdu",
            "channel->mtu"
          ],
          "line": 1094
        },
        "resolved": true,
        "details": {
          "function_name": "find_by_type",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/attrib-server.c",
          "lines": "703-761",
          "snippet": "static uint16_t find_by_type(struct gatt_channel *channel, uint16_t start,\n\t\t\t\tuint16_t end, bt_uuid_t *uuid,\n\t\t\t\tconst uint8_t *value, size_t vlen,\n\t\t\t\tuint8_t *opdu, size_t mtu)\n{\n\tstruct attribute *a;\n\tstruct att_range *range;\n\tGSList *matches;\n\tGList *dl, *database;\n\tuint16_t len;\n\n\tif (start > end || start == 0x0000)\n\t\treturn enc_error_resp(ATT_OP_FIND_BY_TYPE_REQ, start,\n\t\t\t\t\tATT_ECODE_INVALID_HANDLE, opdu, mtu);\n\n\t/* Searching first requested handle number */\n\tdatabase = channel->server->database;\n\tfor (dl = database, matches = NULL, range = NULL; dl; dl = dl->next) {\n\t\ta = dl->data;\n\n\t\tif (a->handle < start)\n\t\t\tcontinue;\n\n\t\tif (a->handle > end)\n\t\t\tbreak;\n\n\t\t/* Primary service? Attribute value matches? */\n\t\tif ((bt_uuid_cmp(&a->uuid, uuid) == 0) && (a->len == vlen) &&\n\t\t\t\t\t(memcmp(a->data, value, vlen) == 0)) {\n\n\t\t\trange = g_new0(struct att_range, 1);\n\t\t\trange->start = a->handle;\n\t\t\t/* It is allowed to have end group handle the same as\n\t\t\t * start handle, for groups with only one attribute. */\n\t\t\trange->end = a->handle;\n\n\t\t\tmatches = g_slist_append(matches, range);\n\t\t} else if (range) {\n\t\t\t/* Update the last found handle or reset the pointer\n\t\t\t * to track that a new group started: Primary or\n\t\t\t * Secondary service. */\n\t\t\tif (bt_uuid_cmp(&a->uuid, &prim_uuid) == 0 ||\n\t\t\t\t\tbt_uuid_cmp(&a->uuid, &snd_uuid) == 0)\n\t\t\t\trange = NULL;\n\t\t\telse\n\t\t\t\trange->end = a->handle;\n\t\t}\n\t}\n\n\tif (matches == NULL)\n\t\treturn enc_error_resp(ATT_OP_FIND_BY_TYPE_REQ, start,\n\t\t\t\tATT_ECODE_ATTR_NOT_FOUND, opdu, mtu);\n\n\tlen = enc_find_by_type_resp(matches, opdu, mtu);\n\n\tg_slist_free_full(matches, g_free);\n\n\treturn len;\n}",
          "includes": [
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"attrib/att-database.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"backtrace.h\"",
            "#include \"log.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <sys/stat.h>",
            "#include <glib.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdbool.h>",
            "#include <stdint.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static bt_uuid_t prim_uuid = {\n\t\t\t.type = BT_UUID16,\n\t\t\t.value.u16 = GATT_PRIM_SVC_UUID\n};",
            "static bt_uuid_t snd_uuid = {\n\t\t\t.type = BT_UUID16,\n\t\t\t.value.u16 = GATT_SND_SVC_UUID\n};"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"attrib/att-database.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"src/shared/util.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <sys/stat.h>\n#include <glib.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdbool.h>\n#include <stdint.h>\n#include <errno.h>\n#include <config.h>\n\nstatic bt_uuid_t prim_uuid = {\n\t\t\t.type = BT_UUID16,\n\t\t\t.value.u16 = GATT_PRIM_SVC_UUID\n};\nstatic bt_uuid_t snd_uuid = {\n\t\t\t.type = BT_UUID16,\n\t\t\t.value.u16 = GATT_SND_SVC_UUID\n};\n\nstatic uint16_t find_by_type(struct gatt_channel *channel, uint16_t start,\n\t\t\t\tuint16_t end, bt_uuid_t *uuid,\n\t\t\t\tconst uint8_t *value, size_t vlen,\n\t\t\t\tuint8_t *opdu, size_t mtu)\n{\n\tstruct attribute *a;\n\tstruct att_range *range;\n\tGSList *matches;\n\tGList *dl, *database;\n\tuint16_t len;\n\n\tif (start > end || start == 0x0000)\n\t\treturn enc_error_resp(ATT_OP_FIND_BY_TYPE_REQ, start,\n\t\t\t\t\tATT_ECODE_INVALID_HANDLE, opdu, mtu);\n\n\t/* Searching first requested handle number */\n\tdatabase = channel->server->database;\n\tfor (dl = database, matches = NULL, range = NULL; dl; dl = dl->next) {\n\t\ta = dl->data;\n\n\t\tif (a->handle < start)\n\t\t\tcontinue;\n\n\t\tif (a->handle > end)\n\t\t\tbreak;\n\n\t\t/* Primary service? Attribute value matches? */\n\t\tif ((bt_uuid_cmp(&a->uuid, uuid) == 0) && (a->len == vlen) &&\n\t\t\t\t\t(memcmp(a->data, value, vlen) == 0)) {\n\n\t\t\trange = g_new0(struct att_range, 1);\n\t\t\trange->start = a->handle;\n\t\t\t/* It is allowed to have end group handle the same as\n\t\t\t * start handle, for groups with only one attribute. */\n\t\t\trange->end = a->handle;\n\n\t\t\tmatches = g_slist_append(matches, range);\n\t\t} else if (range) {\n\t\t\t/* Update the last found handle or reset the pointer\n\t\t\t * to track that a new group started: Primary or\n\t\t\t * Secondary service. */\n\t\t\tif (bt_uuid_cmp(&a->uuid, &prim_uuid) == 0 ||\n\t\t\t\t\tbt_uuid_cmp(&a->uuid, &snd_uuid) == 0)\n\t\t\t\trange = NULL;\n\t\t\telse\n\t\t\t\trange->end = a->handle;\n\t\t}\n\t}\n\n\tif (matches == NULL)\n\t\treturn enc_error_resp(ATT_OP_FIND_BY_TYPE_REQ, start,\n\t\t\t\tATT_ECODE_ATTR_NOT_FOUND, opdu, mtu);\n\n\tlen = enc_find_by_type_resp(matches, opdu, mtu);\n\n\tg_slist_free_full(matches, g_free);\n\n\treturn len;\n}"
        }
      },
      {
        "call_info": {
          "callee": "dec_find_by_type_req",
          "args": [
            "ipdu",
            "len",
            "&start",
            "&end",
            "&uuid",
            "value",
            "&vlen"
          ],
          "line": 1087
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "write_value",
          "args": [
            "channel",
            "start",
            "value",
            "vlen",
            "opdu",
            "channel->mtu"
          ],
          "line": 1083
        },
        "resolved": true,
        "details": {
          "function_name": "write_value",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/attrib-server.c",
          "lines": "876-945",
          "snippet": "static uint16_t write_value(struct gatt_channel *channel, uint16_t handle,\n\t\t\t\t\tconst uint8_t *value, size_t vlen,\n\t\t\t\t\tuint8_t *pdu, size_t len)\n{\n\tstruct attribute *a;\n\tuint8_t status;\n\tGList *l;\n\tguint h = handle;\n\n\tl = g_list_find_custom(channel->server->database,\n\t\t\t\t\tGUINT_TO_POINTER(h), handle_cmp);\n\tif (!l)\n\t\treturn enc_error_resp(ATT_OP_WRITE_REQ, handle,\n\t\t\t\tATT_ECODE_INVALID_HANDLE, pdu, len);\n\n\ta = l->data;\n\n\tstatus = att_check_reqs(channel, ATT_OP_WRITE_REQ, a->write_req);\n\tif (status)\n\t\treturn enc_error_resp(ATT_OP_WRITE_REQ, handle, status, pdu,\n\t\t\t\t\t\t\t\t\tlen);\n\n\tif (bt_uuid_cmp(&ccc_uuid, &a->uuid) != 0) {\n\n\t\tattrib_db_update(channel->server->adapter, handle, NULL,\n\t\t\t\t\t\t\tvalue, vlen, NULL);\n\n\t\tif (a->write_cb) {\n\t\t\tstatus = a->write_cb(a, channel->device,\n\t\t\t\t\t\t\ta->cb_user_data);\n\t\t\tif (status)\n\t\t\t\treturn enc_error_resp(ATT_OP_WRITE_REQ, handle,\n\t\t\t\t\t\t\tstatus, pdu, len);\n\t\t}\n\t} else {\n\t\tuint16_t cccval = get_le16(value);\n\t\tchar *filename;\n\t\tGKeyFile *key_file;\n\t\tchar group[6], value[5];\n\t\tchar *data;\n\t\tgsize length = 0;\n\n\t\tfilename = btd_device_get_storage_path(channel->device, \"ccc\");\n\t\tif (!filename) {\n\t\t\twarn(\"Unable to get ccc storage path for device\");\n\t\t\treturn enc_error_resp(ATT_OP_WRITE_REQ, handle,\n\t\t\t\t\t\tATT_ECODE_WRITE_NOT_PERM,\n\t\t\t\t\t\tpdu, len);\n\t\t}\n\n\t\tkey_file = g_key_file_new();\n\t\tg_key_file_load_from_file(key_file, filename, 0, NULL);\n\n\t\tsprintf(group, \"%hu\", handle);\n\t\tsprintf(value, \"%hX\", cccval);\n\t\tg_key_file_set_string(key_file, group, \"Value\", value);\n\n\t\tdata = g_key_file_to_data(key_file, &length, NULL);\n\t\tif (length > 0) {\n\t\t\tcreate_file(filename, S_IRUSR | S_IWUSR);\n\t\t\tg_file_set_contents(filename, data, length, NULL);\n\t\t}\n\n\t\tg_free(data);\n\t\tg_free(filename);\n\t\tg_key_file_free(key_file);\n\t}\n\n\treturn enc_write_resp(pdu);\n}",
          "includes": [
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"attrib/att-database.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"backtrace.h\"",
            "#include \"log.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <sys/stat.h>",
            "#include <glib.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdbool.h>",
            "#include <stdint.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static bt_uuid_t ccc_uuid = {\n\t\t\t.type = BT_UUID16,\n\t\t\t.value.u16 = GATT_CLIENT_CHARAC_CFG_UUID\n};"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"attrib/att-database.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"src/shared/util.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <sys/stat.h>\n#include <glib.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdbool.h>\n#include <stdint.h>\n#include <errno.h>\n#include <config.h>\n\nstatic bt_uuid_t ccc_uuid = {\n\t\t\t.type = BT_UUID16,\n\t\t\t.value.u16 = GATT_CLIENT_CHARAC_CFG_UUID\n};\n\nstatic uint16_t write_value(struct gatt_channel *channel, uint16_t handle,\n\t\t\t\t\tconst uint8_t *value, size_t vlen,\n\t\t\t\t\tuint8_t *pdu, size_t len)\n{\n\tstruct attribute *a;\n\tuint8_t status;\n\tGList *l;\n\tguint h = handle;\n\n\tl = g_list_find_custom(channel->server->database,\n\t\t\t\t\tGUINT_TO_POINTER(h), handle_cmp);\n\tif (!l)\n\t\treturn enc_error_resp(ATT_OP_WRITE_REQ, handle,\n\t\t\t\tATT_ECODE_INVALID_HANDLE, pdu, len);\n\n\ta = l->data;\n\n\tstatus = att_check_reqs(channel, ATT_OP_WRITE_REQ, a->write_req);\n\tif (status)\n\t\treturn enc_error_resp(ATT_OP_WRITE_REQ, handle, status, pdu,\n\t\t\t\t\t\t\t\t\tlen);\n\n\tif (bt_uuid_cmp(&ccc_uuid, &a->uuid) != 0) {\n\n\t\tattrib_db_update(channel->server->adapter, handle, NULL,\n\t\t\t\t\t\t\tvalue, vlen, NULL);\n\n\t\tif (a->write_cb) {\n\t\t\tstatus = a->write_cb(a, channel->device,\n\t\t\t\t\t\t\ta->cb_user_data);\n\t\t\tif (status)\n\t\t\t\treturn enc_error_resp(ATT_OP_WRITE_REQ, handle,\n\t\t\t\t\t\t\tstatus, pdu, len);\n\t\t}\n\t} else {\n\t\tuint16_t cccval = get_le16(value);\n\t\tchar *filename;\n\t\tGKeyFile *key_file;\n\t\tchar group[6], value[5];\n\t\tchar *data;\n\t\tgsize length = 0;\n\n\t\tfilename = btd_device_get_storage_path(channel->device, \"ccc\");\n\t\tif (!filename) {\n\t\t\twarn(\"Unable to get ccc storage path for device\");\n\t\t\treturn enc_error_resp(ATT_OP_WRITE_REQ, handle,\n\t\t\t\t\t\tATT_ECODE_WRITE_NOT_PERM,\n\t\t\t\t\t\tpdu, len);\n\t\t}\n\n\t\tkey_file = g_key_file_new();\n\t\tg_key_file_load_from_file(key_file, filename, 0, NULL);\n\n\t\tsprintf(group, \"%hu\", handle);\n\t\tsprintf(value, \"%hX\", cccval);\n\t\tg_key_file_set_string(key_file, group, \"Value\", value);\n\n\t\tdata = g_key_file_to_data(key_file, &length, NULL);\n\t\tif (length > 0) {\n\t\t\tcreate_file(filename, S_IRUSR | S_IWUSR);\n\t\t\tg_file_set_contents(filename, data, length, NULL);\n\t\t}\n\n\t\tg_free(data);\n\t\tg_free(filename);\n\t\tg_key_file_free(key_file);\n\t}\n\n\treturn enc_write_resp(pdu);\n}"
        }
      },
      {
        "call_info": {
          "callee": "dec_write_cmd",
          "args": [
            "ipdu",
            "len",
            "&start",
            "value",
            "&vlen"
          ],
          "line": 1081
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dec_write_req",
          "args": [
            "ipdu",
            "len",
            "&start",
            "value",
            "&vlen"
          ],
          "line": 1071
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "find_info",
          "args": [
            "channel",
            "start",
            "end",
            "opdu",
            "channel->mtu"
          ],
          "line": 1068
        },
        "resolved": true,
        "details": {
          "function_name": "find_info",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/attrib-server.c",
          "lines": "623-701",
          "snippet": "static uint16_t find_info(struct gatt_channel *channel, uint16_t start,\n\t\t\t\tuint16_t end, uint8_t *pdu, size_t len)\n{\n\tstruct attribute *a;\n\tstruct att_data_list *adl;\n\tGSList *l, *info;\n\tGList *dl, *database;\n\tuint8_t format, last_type = BT_UUID_UNSPEC;\n\tuint16_t length, num;\n\tint i;\n\n\tif (start > end || start == 0x0000)\n\t\treturn enc_error_resp(ATT_OP_FIND_INFO_REQ, start,\n\t\t\t\t\tATT_ECODE_INVALID_HANDLE, pdu, len);\n\n\tdatabase = channel->server->database;\n\tfor (dl = database, info = NULL, num = 0; dl; dl = dl->next) {\n\t\ta = dl->data;\n\n\t\tif (a->handle < start)\n\t\t\tcontinue;\n\n\t\tif (a->handle > end)\n\t\t\tbreak;\n\n\t\tif (last_type == BT_UUID_UNSPEC)\n\t\t\tlast_type = a->uuid.type;\n\n\t\tif (a->uuid.type != last_type)\n\t\t\tbreak;\n\n\t\tinfo = g_slist_append(info, a);\n\t\tnum++;\n\n\t\tlast_type = a->uuid.type;\n\t}\n\n\tif (info == NULL)\n\t\treturn enc_error_resp(ATT_OP_FIND_INFO_REQ, start,\n\t\t\t\t\tATT_ECODE_ATTR_NOT_FOUND, pdu, len);\n\n\tif (last_type == BT_UUID16) {\n\t\tlength = 2;\n\t\tformat = 0x01;\n\t} else if (last_type == BT_UUID128) {\n\t\tlength = 16;\n\t\tformat = 0x02;\n\t} else {\n\t\tg_slist_free(info);\n\t\treturn 0;\n\t}\n\n\tadl = att_data_list_alloc(num, length + 2);\n\tif (adl == NULL) {\n\t\tg_slist_free(info);\n\t\treturn enc_error_resp(ATT_OP_FIND_INFO_REQ, start,\n\t\t\t\t\tATT_ECODE_UNLIKELY, pdu, len);\n\t}\n\n\tfor (i = 0, l = info; l; i++, l = l->next) {\n\t\tuint8_t *value;\n\n\t\ta = l->data;\n\n\t\tvalue = (void *) adl->data[i];\n\n\t\tput_le16(a->handle, value);\n\n\t\t/* Attribute Value */\n\t\tbt_uuid_to_le(&a->uuid, &value[2]);\n\t}\n\n\tlength = enc_find_info_resp(format, adl, pdu, len);\n\n\tatt_data_list_free(adl);\n\tg_slist_free(info);\n\n\treturn length;\n}",
          "includes": [
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"attrib/att-database.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"backtrace.h\"",
            "#include \"log.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <sys/stat.h>",
            "#include <glib.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdbool.h>",
            "#include <stdint.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"attrib/att-database.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"src/shared/util.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <sys/stat.h>\n#include <glib.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdbool.h>\n#include <stdint.h>\n#include <errno.h>\n#include <config.h>\n\nstatic uint16_t find_info(struct gatt_channel *channel, uint16_t start,\n\t\t\t\tuint16_t end, uint8_t *pdu, size_t len)\n{\n\tstruct attribute *a;\n\tstruct att_data_list *adl;\n\tGSList *l, *info;\n\tGList *dl, *database;\n\tuint8_t format, last_type = BT_UUID_UNSPEC;\n\tuint16_t length, num;\n\tint i;\n\n\tif (start > end || start == 0x0000)\n\t\treturn enc_error_resp(ATT_OP_FIND_INFO_REQ, start,\n\t\t\t\t\tATT_ECODE_INVALID_HANDLE, pdu, len);\n\n\tdatabase = channel->server->database;\n\tfor (dl = database, info = NULL, num = 0; dl; dl = dl->next) {\n\t\ta = dl->data;\n\n\t\tif (a->handle < start)\n\t\t\tcontinue;\n\n\t\tif (a->handle > end)\n\t\t\tbreak;\n\n\t\tif (last_type == BT_UUID_UNSPEC)\n\t\t\tlast_type = a->uuid.type;\n\n\t\tif (a->uuid.type != last_type)\n\t\t\tbreak;\n\n\t\tinfo = g_slist_append(info, a);\n\t\tnum++;\n\n\t\tlast_type = a->uuid.type;\n\t}\n\n\tif (info == NULL)\n\t\treturn enc_error_resp(ATT_OP_FIND_INFO_REQ, start,\n\t\t\t\t\tATT_ECODE_ATTR_NOT_FOUND, pdu, len);\n\n\tif (last_type == BT_UUID16) {\n\t\tlength = 2;\n\t\tformat = 0x01;\n\t} else if (last_type == BT_UUID128) {\n\t\tlength = 16;\n\t\tformat = 0x02;\n\t} else {\n\t\tg_slist_free(info);\n\t\treturn 0;\n\t}\n\n\tadl = att_data_list_alloc(num, length + 2);\n\tif (adl == NULL) {\n\t\tg_slist_free(info);\n\t\treturn enc_error_resp(ATT_OP_FIND_INFO_REQ, start,\n\t\t\t\t\tATT_ECODE_UNLIKELY, pdu, len);\n\t}\n\n\tfor (i = 0, l = info; l; i++, l = l->next) {\n\t\tuint8_t *value;\n\n\t\ta = l->data;\n\n\t\tvalue = (void *) adl->data[i];\n\n\t\tput_le16(a->handle, value);\n\n\t\t/* Attribute Value */\n\t\tbt_uuid_to_le(&a->uuid, &value[2]);\n\t}\n\n\tlength = enc_find_info_resp(format, adl, pdu, len);\n\n\tatt_data_list_free(adl);\n\tg_slist_free(info);\n\n\treturn length;\n}"
        }
      },
      {
        "call_info": {
          "callee": "dec_find_info_req",
          "args": [
            "ipdu",
            "len",
            "&start",
            "&end"
          ],
          "line": 1062
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "mtu_exchange",
          "args": [
            "channel",
            "mtu",
            "opdu",
            "channel->mtu"
          ],
          "line": 1059
        },
        "resolved": true,
        "details": {
          "function_name": "mtu_exchange",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/attrib-server.c",
          "lines": "947-972",
          "snippet": "static uint16_t mtu_exchange(struct gatt_channel *channel, uint16_t mtu,\n\t\t\t\t\t\tuint8_t *pdu, size_t len)\n{\n\tGError *gerr = NULL;\n\tGIOChannel *io;\n\tuint16_t imtu;\n\n\tif (mtu < ATT_DEFAULT_LE_MTU)\n\t\treturn enc_error_resp(ATT_OP_MTU_REQ, 0,\n\t\t\t\t\tATT_ECODE_REQ_NOT_SUPP, pdu, len);\n\n\tio = g_attrib_get_channel(channel->attrib);\n\n\tbt_io_get(io, &gerr, BT_IO_OPT_IMTU, &imtu, BT_IO_OPT_INVALID);\n\tif (gerr) {\n\t\terror(\"bt_io_get: %s\", gerr->message);\n\t\tg_error_free(gerr);\n\t\treturn enc_error_resp(ATT_OP_MTU_REQ, 0, ATT_ECODE_UNLIKELY,\n\t\t\t\t\t\t\t\tpdu, len);\n\t}\n\n\tchannel->mtu = MIN(mtu, imtu);\n\tg_attrib_set_mtu(channel->attrib, channel->mtu);\n\n\treturn enc_mtu_resp(imtu, pdu, len);\n}",
          "includes": [
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"attrib/att-database.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"backtrace.h\"",
            "#include \"log.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <sys/stat.h>",
            "#include <glib.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdbool.h>",
            "#include <stdint.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"attrib/att-database.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"src/shared/util.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <sys/stat.h>\n#include <glib.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdbool.h>\n#include <stdint.h>\n#include <errno.h>\n#include <config.h>\n\nstatic uint16_t mtu_exchange(struct gatt_channel *channel, uint16_t mtu,\n\t\t\t\t\t\tuint8_t *pdu, size_t len)\n{\n\tGError *gerr = NULL;\n\tGIOChannel *io;\n\tuint16_t imtu;\n\n\tif (mtu < ATT_DEFAULT_LE_MTU)\n\t\treturn enc_error_resp(ATT_OP_MTU_REQ, 0,\n\t\t\t\t\tATT_ECODE_REQ_NOT_SUPP, pdu, len);\n\n\tio = g_attrib_get_channel(channel->attrib);\n\n\tbt_io_get(io, &gerr, BT_IO_OPT_IMTU, &imtu, BT_IO_OPT_INVALID);\n\tif (gerr) {\n\t\terror(\"bt_io_get: %s\", gerr->message);\n\t\tg_error_free(gerr);\n\t\treturn enc_error_resp(ATT_OP_MTU_REQ, 0, ATT_ECODE_UNLIKELY,\n\t\t\t\t\t\t\t\tpdu, len);\n\t}\n\n\tchannel->mtu = MIN(mtu, imtu);\n\tg_attrib_set_mtu(channel->attrib, channel->mtu);\n\n\treturn enc_mtu_resp(imtu, pdu, len);\n}"
        }
      },
      {
        "call_info": {
          "callee": "dec_mtu_req",
          "args": [
            "ipdu",
            "len",
            "&mtu"
          ],
          "line": 1053
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "read_blob",
          "args": [
            "channel",
            "start",
            "offset",
            "opdu",
            "channel->mtu"
          ],
          "line": 1045
        },
        "resolved": true,
        "details": {
          "function_name": "read_blob",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/attrib-server.c",
          "lines": "834-874",
          "snippet": "static uint16_t read_blob(struct gatt_channel *channel, uint16_t handle,\n\t\t\t\tuint16_t offset, uint8_t *pdu, size_t len)\n{\n\tstruct attribute *a;\n\tuint8_t status;\n\tGList *l;\n\tuint16_t cccval;\n\tguint h = handle;\n\n\tl = g_list_find_custom(channel->server->database,\n\t\t\t\t\tGUINT_TO_POINTER(h), handle_cmp);\n\tif (!l)\n\t\treturn enc_error_resp(ATT_OP_READ_BLOB_REQ, handle,\n\t\t\t\t\tATT_ECODE_INVALID_HANDLE, pdu, len);\n\n\ta = l->data;\n\n\tif (a->len < offset)\n\t\treturn enc_error_resp(ATT_OP_READ_BLOB_REQ, handle,\n\t\t\t\t\tATT_ECODE_INVALID_OFFSET, pdu, len);\n\n\tif (bt_uuid_cmp(&ccc_uuid, &a->uuid) == 0 &&\n\t\tread_device_ccc(channel->device, handle, &cccval) == 0) {\n\t\tuint8_t config[2];\n\n\t\tput_le16(cccval, config);\n\t\treturn enc_read_blob_resp(config, sizeof(config), offset,\n\t\t\t\t\t\t\t\tpdu, len);\n\t}\n\n\tstatus = att_check_reqs(channel, ATT_OP_READ_BLOB_REQ, a->read_req);\n\n\tif (status == 0x00 && a->read_cb)\n\t\tstatus = a->read_cb(a, channel->device, a->cb_user_data);\n\n\tif (status)\n\t\treturn enc_error_resp(ATT_OP_READ_BLOB_REQ, handle, status,\n\t\t\t\t\t\t\t\tpdu, len);\n\n\treturn enc_read_blob_resp(a->data, a->len, offset, pdu, len);\n}",
          "includes": [
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"attrib/att-database.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"backtrace.h\"",
            "#include \"log.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <sys/stat.h>",
            "#include <glib.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdbool.h>",
            "#include <stdint.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static bt_uuid_t ccc_uuid = {\n\t\t\t.type = BT_UUID16,\n\t\t\t.value.u16 = GATT_CLIENT_CHARAC_CFG_UUID\n};"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"attrib/att-database.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"src/shared/util.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <sys/stat.h>\n#include <glib.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdbool.h>\n#include <stdint.h>\n#include <errno.h>\n#include <config.h>\n\nstatic bt_uuid_t ccc_uuid = {\n\t\t\t.type = BT_UUID16,\n\t\t\t.value.u16 = GATT_CLIENT_CHARAC_CFG_UUID\n};\n\nstatic uint16_t read_blob(struct gatt_channel *channel, uint16_t handle,\n\t\t\t\tuint16_t offset, uint8_t *pdu, size_t len)\n{\n\tstruct attribute *a;\n\tuint8_t status;\n\tGList *l;\n\tuint16_t cccval;\n\tguint h = handle;\n\n\tl = g_list_find_custom(channel->server->database,\n\t\t\t\t\tGUINT_TO_POINTER(h), handle_cmp);\n\tif (!l)\n\t\treturn enc_error_resp(ATT_OP_READ_BLOB_REQ, handle,\n\t\t\t\t\tATT_ECODE_INVALID_HANDLE, pdu, len);\n\n\ta = l->data;\n\n\tif (a->len < offset)\n\t\treturn enc_error_resp(ATT_OP_READ_BLOB_REQ, handle,\n\t\t\t\t\tATT_ECODE_INVALID_OFFSET, pdu, len);\n\n\tif (bt_uuid_cmp(&ccc_uuid, &a->uuid) == 0 &&\n\t\tread_device_ccc(channel->device, handle, &cccval) == 0) {\n\t\tuint8_t config[2];\n\n\t\tput_le16(cccval, config);\n\t\treturn enc_read_blob_resp(config, sizeof(config), offset,\n\t\t\t\t\t\t\t\tpdu, len);\n\t}\n\n\tstatus = att_check_reqs(channel, ATT_OP_READ_BLOB_REQ, a->read_req);\n\n\tif (status == 0x00 && a->read_cb)\n\t\tstatus = a->read_cb(a, channel->device, a->cb_user_data);\n\n\tif (status)\n\t\treturn enc_error_resp(ATT_OP_READ_BLOB_REQ, handle, status,\n\t\t\t\t\t\t\t\tpdu, len);\n\n\treturn enc_read_blob_resp(a->data, a->len, offset, pdu, len);\n}"
        }
      },
      {
        "call_info": {
          "callee": "dec_read_blob_req",
          "args": [
            "ipdu",
            "len",
            "&start",
            "&offset"
          ],
          "line": 1039
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "read_value",
          "args": [
            "channel",
            "start",
            "opdu",
            "channel->mtu"
          ],
          "line": 1036
        },
        "resolved": true,
        "details": {
          "function_name": "read_value",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/attrib-server.c",
          "lines": "797-832",
          "snippet": "static uint16_t read_value(struct gatt_channel *channel, uint16_t handle,\n\t\t\t\t\t\tuint8_t *pdu, size_t len)\n{\n\tstruct attribute *a;\n\tuint8_t status;\n\tGList *l;\n\tuint16_t cccval;\n\tguint h = handle;\n\n\tl = g_list_find_custom(channel->server->database,\n\t\t\t\t\tGUINT_TO_POINTER(h), handle_cmp);\n\tif (!l)\n\t\treturn enc_error_resp(ATT_OP_READ_REQ, handle,\n\t\t\t\t\tATT_ECODE_INVALID_HANDLE, pdu, len);\n\n\ta = l->data;\n\n\tif (bt_uuid_cmp(&ccc_uuid, &a->uuid) == 0 &&\n\t\tread_device_ccc(channel->device, handle, &cccval) == 0) {\n\t\tuint8_t config[2];\n\n\t\tput_le16(cccval, config);\n\t\treturn enc_read_resp(config, sizeof(config), pdu, len);\n\t}\n\n\tstatus = att_check_reqs(channel, ATT_OP_READ_REQ, a->read_req);\n\n\tif (status == 0x00 && a->read_cb)\n\t\tstatus = a->read_cb(a, channel->device, a->cb_user_data);\n\n\tif (status)\n\t\treturn enc_error_resp(ATT_OP_READ_REQ, handle, status, pdu,\n\t\t\t\t\t\t\t\t\tlen);\n\n\treturn enc_read_resp(a->data, a->len, pdu, len);\n}",
          "includes": [
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"attrib/att-database.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"backtrace.h\"",
            "#include \"log.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <sys/stat.h>",
            "#include <glib.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdbool.h>",
            "#include <stdint.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static bt_uuid_t ccc_uuid = {\n\t\t\t.type = BT_UUID16,\n\t\t\t.value.u16 = GATT_CLIENT_CHARAC_CFG_UUID\n};"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"attrib/att-database.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"src/shared/util.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <sys/stat.h>\n#include <glib.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdbool.h>\n#include <stdint.h>\n#include <errno.h>\n#include <config.h>\n\nstatic bt_uuid_t ccc_uuid = {\n\t\t\t.type = BT_UUID16,\n\t\t\t.value.u16 = GATT_CLIENT_CHARAC_CFG_UUID\n};\n\nstatic uint16_t read_value(struct gatt_channel *channel, uint16_t handle,\n\t\t\t\t\t\tuint8_t *pdu, size_t len)\n{\n\tstruct attribute *a;\n\tuint8_t status;\n\tGList *l;\n\tuint16_t cccval;\n\tguint h = handle;\n\n\tl = g_list_find_custom(channel->server->database,\n\t\t\t\t\tGUINT_TO_POINTER(h), handle_cmp);\n\tif (!l)\n\t\treturn enc_error_resp(ATT_OP_READ_REQ, handle,\n\t\t\t\t\tATT_ECODE_INVALID_HANDLE, pdu, len);\n\n\ta = l->data;\n\n\tif (bt_uuid_cmp(&ccc_uuid, &a->uuid) == 0 &&\n\t\tread_device_ccc(channel->device, handle, &cccval) == 0) {\n\t\tuint8_t config[2];\n\n\t\tput_le16(cccval, config);\n\t\treturn enc_read_resp(config, sizeof(config), pdu, len);\n\t}\n\n\tstatus = att_check_reqs(channel, ATT_OP_READ_REQ, a->read_req);\n\n\tif (status == 0x00 && a->read_cb)\n\t\tstatus = a->read_cb(a, channel->device, a->cb_user_data);\n\n\tif (status)\n\t\treturn enc_error_resp(ATT_OP_READ_REQ, handle, status, pdu,\n\t\t\t\t\t\t\t\t\tlen);\n\n\treturn enc_read_resp(a->data, a->len, pdu, len);\n}"
        }
      },
      {
        "call_info": {
          "callee": "dec_read_req",
          "args": [
            "ipdu",
            "len",
            "&start"
          ],
          "line": 1030
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "read_by_type",
          "args": [
            "channel",
            "start",
            "end",
            "&uuid",
            "opdu",
            "channel->mtu"
          ],
          "line": 1026
        },
        "resolved": true,
        "details": {
          "function_name": "read_by_type",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/attrib-server.c",
          "lines": "534-621",
          "snippet": "static uint16_t read_by_type(struct gatt_channel *channel, uint16_t start,\n\t\t\t\t\t\tuint16_t end, bt_uuid_t *uuid,\n\t\t\t\t\t\tuint8_t *pdu, size_t len)\n{\n\tstruct att_data_list *adl;\n\tGSList *l, *types;\n\tGList *dl, *database;\n\tstruct attribute *a;\n\tuint16_t num, length;\n\tuint8_t status;\n\tint i;\n\n\tif (start > end || start == 0x0000)\n\t\treturn enc_error_resp(ATT_OP_READ_BY_TYPE_REQ, start,\n\t\t\t\t\tATT_ECODE_INVALID_HANDLE, pdu, len);\n\n\tdatabase = channel->server->database;\n\tfor (dl = database, length = 0, types = NULL; dl; dl = dl->next) {\n\n\t\ta = dl->data;\n\n\t\tif (a->handle < start)\n\t\t\tcontinue;\n\n\t\tif (a->handle > end)\n\t\t\tbreak;\n\n\t\tif (bt_uuid_cmp(&a->uuid, uuid)  != 0)\n\t\t\tcontinue;\n\n\t\tstatus = att_check_reqs(channel, ATT_OP_READ_BY_TYPE_REQ,\n\t\t\t\t\t\t\t\ta->read_req);\n\n\t\tif (status == 0x00 && a->read_cb)\n\t\t\tstatus = a->read_cb(a, channel->device,\n\t\t\t\t\t\t\ta->cb_user_data);\n\n\t\tif (status) {\n\t\t\tg_slist_free(types);\n\t\t\treturn enc_error_resp(ATT_OP_READ_BY_TYPE_REQ,\n\t\t\t\t\t\ta->handle, status, pdu, len);\n\t\t}\n\n\t\t/* All elements must have the same length */\n\t\tif (length == 0)\n\t\t\tlength = a->len;\n\t\telse if (a->len != length)\n\t\t\tbreak;\n\n\t\ttypes = g_slist_append(types, a);\n\t}\n\n\tif (types == NULL)\n\t\treturn enc_error_resp(ATT_OP_READ_BY_TYPE_REQ, start,\n\t\t\t\t\tATT_ECODE_ATTR_NOT_FOUND, pdu, len);\n\n\tnum = g_slist_length(types);\n\n\t/* Handle length plus attribute value length */\n\tlength += 2;\n\n\tadl = att_data_list_alloc(num, length);\n\tif (adl == NULL) {\n\t\tg_slist_free(types);\n\t\treturn enc_error_resp(ATT_OP_READ_BY_TYPE_REQ, start,\n\t\t\t\t\tATT_ECODE_UNLIKELY, pdu, len);\n\t}\n\n\tfor (i = 0, l = types; l; i++, l = l->next) {\n\t\tuint8_t *value;\n\n\t\ta = l->data;\n\n\t\tvalue = (void *) adl->data[i];\n\n\t\tput_le16(a->handle, value);\n\n\t\t/* Attribute Value */\n\t\tmemcpy(&value[2], a->data, a->len);\n\t}\n\n\tlength = enc_read_by_type_resp(adl, pdu, len);\n\n\tatt_data_list_free(adl);\n\tg_slist_free(types);\n\n\treturn length;\n}",
          "includes": [
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"attrib/att-database.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"backtrace.h\"",
            "#include \"log.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <sys/stat.h>",
            "#include <glib.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdbool.h>",
            "#include <stdint.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"attrib/att-database.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"src/shared/util.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <sys/stat.h>\n#include <glib.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdbool.h>\n#include <stdint.h>\n#include <errno.h>\n#include <config.h>\n\nstatic uint16_t read_by_type(struct gatt_channel *channel, uint16_t start,\n\t\t\t\t\t\tuint16_t end, bt_uuid_t *uuid,\n\t\t\t\t\t\tuint8_t *pdu, size_t len)\n{\n\tstruct att_data_list *adl;\n\tGSList *l, *types;\n\tGList *dl, *database;\n\tstruct attribute *a;\n\tuint16_t num, length;\n\tuint8_t status;\n\tint i;\n\n\tif (start > end || start == 0x0000)\n\t\treturn enc_error_resp(ATT_OP_READ_BY_TYPE_REQ, start,\n\t\t\t\t\tATT_ECODE_INVALID_HANDLE, pdu, len);\n\n\tdatabase = channel->server->database;\n\tfor (dl = database, length = 0, types = NULL; dl; dl = dl->next) {\n\n\t\ta = dl->data;\n\n\t\tif (a->handle < start)\n\t\t\tcontinue;\n\n\t\tif (a->handle > end)\n\t\t\tbreak;\n\n\t\tif (bt_uuid_cmp(&a->uuid, uuid)  != 0)\n\t\t\tcontinue;\n\n\t\tstatus = att_check_reqs(channel, ATT_OP_READ_BY_TYPE_REQ,\n\t\t\t\t\t\t\t\ta->read_req);\n\n\t\tif (status == 0x00 && a->read_cb)\n\t\t\tstatus = a->read_cb(a, channel->device,\n\t\t\t\t\t\t\ta->cb_user_data);\n\n\t\tif (status) {\n\t\t\tg_slist_free(types);\n\t\t\treturn enc_error_resp(ATT_OP_READ_BY_TYPE_REQ,\n\t\t\t\t\t\ta->handle, status, pdu, len);\n\t\t}\n\n\t\t/* All elements must have the same length */\n\t\tif (length == 0)\n\t\t\tlength = a->len;\n\t\telse if (a->len != length)\n\t\t\tbreak;\n\n\t\ttypes = g_slist_append(types, a);\n\t}\n\n\tif (types == NULL)\n\t\treturn enc_error_resp(ATT_OP_READ_BY_TYPE_REQ, start,\n\t\t\t\t\tATT_ECODE_ATTR_NOT_FOUND, pdu, len);\n\n\tnum = g_slist_length(types);\n\n\t/* Handle length plus attribute value length */\n\tlength += 2;\n\n\tadl = att_data_list_alloc(num, length);\n\tif (adl == NULL) {\n\t\tg_slist_free(types);\n\t\treturn enc_error_resp(ATT_OP_READ_BY_TYPE_REQ, start,\n\t\t\t\t\tATT_ECODE_UNLIKELY, pdu, len);\n\t}\n\n\tfor (i = 0, l = types; l; i++, l = l->next) {\n\t\tuint8_t *value;\n\n\t\ta = l->data;\n\n\t\tvalue = (void *) adl->data[i];\n\n\t\tput_le16(a->handle, value);\n\n\t\t/* Attribute Value */\n\t\tmemcpy(&value[2], a->data, a->len);\n\t}\n\n\tlength = enc_read_by_type_resp(adl, pdu, len);\n\n\tatt_data_list_free(adl);\n\tg_slist_free(types);\n\n\treturn length;\n}"
        }
      },
      {
        "call_info": {
          "callee": "dec_read_by_type_req",
          "args": [
            "ipdu",
            "len",
            "&start",
            "&end",
            "&uuid"
          ],
          "line": 1020
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "read_by_group",
          "args": [
            "channel",
            "start",
            "end",
            "&uuid",
            "opdu",
            "channel->mtu"
          ],
          "line": 1016
        },
        "resolved": true,
        "details": {
          "function_name": "read_by_group",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/attrib-server.c",
          "lines": "413-532",
          "snippet": "static uint16_t read_by_group(struct gatt_channel *channel, uint16_t start,\n\t\t\t\t\t\tuint16_t end, bt_uuid_t *uuid,\n\t\t\t\t\t\tuint8_t *pdu, size_t len)\n{\n\tstruct att_data_list *adl;\n\tstruct attribute *a;\n\tstruct group_elem *cur, *old = NULL;\n\tGSList *l, *groups;\n\tGList *dl, *database;\n\tuint16_t length, last_handle, last_size = 0;\n\tuint8_t status;\n\tint i;\n\n\tif (start > end || start == 0x0000)\n\t\treturn enc_error_resp(ATT_OP_READ_BY_GROUP_REQ, start,\n\t\t\t\t\tATT_ECODE_INVALID_HANDLE, pdu, len);\n\n\t/*\n\t * Only <<Primary Service>> and <<Secondary Service>> grouping\n\t * types may be used in the Read By Group Type Request.\n\t */\n\n\tif (bt_uuid_cmp(uuid, &prim_uuid) != 0 &&\n\t\tbt_uuid_cmp(uuid, &snd_uuid) != 0)\n\t\treturn enc_error_resp(ATT_OP_READ_BY_GROUP_REQ, 0x0000,\n\t\t\t\t\tATT_ECODE_UNSUPP_GRP_TYPE, pdu, len);\n\n\tlast_handle = end;\n\tdatabase = channel->server->database;\n\tfor (dl = database, groups = NULL, cur = NULL; dl; dl = dl->next) {\n\n\t\ta = dl->data;\n\n\t\tif (a->handle < start)\n\t\t\tcontinue;\n\n\t\tif (a->handle >= end)\n\t\t\tbreak;\n\n\t\t/* The old group ends when a new one starts */\n\t\tif (old && (bt_uuid_cmp(&a->uuid, &prim_uuid) == 0 ||\n\t\t\t\tbt_uuid_cmp(&a->uuid, &snd_uuid) == 0)) {\n\t\t\told->end = last_handle;\n\t\t\told = NULL;\n\t\t}\n\n\t\tif (bt_uuid_cmp(&a->uuid, uuid) != 0) {\n\t\t\t/* Still inside a service, update its last handle */\n\t\t\tif (old)\n\t\t\t\tlast_handle = a->handle;\n\t\t\tcontinue;\n\t\t}\n\n\t\tif (last_size && (last_size != a->len))\n\t\t\tbreak;\n\n\t\tstatus = att_check_reqs(channel, ATT_OP_READ_BY_GROUP_REQ,\n\t\t\t\t\t\t\t\ta->read_req);\n\n\t\tif (status == 0x00 && a->read_cb)\n\t\t\tstatus = a->read_cb(a, channel->device,\n\t\t\t\t\t\t\ta->cb_user_data);\n\n\t\tif (status) {\n\t\t\tg_slist_free_full(groups, g_free);\n\t\t\treturn enc_error_resp(ATT_OP_READ_BY_GROUP_REQ,\n\t\t\t\t\t\ta->handle, status, pdu, len);\n\t\t}\n\n\t\tcur = g_new0(struct group_elem, 1);\n\t\tcur->handle = a->handle;\n\t\tcur->data = a->data;\n\t\tcur->len = a->len;\n\n\t\t/* Attribute Grouping Type found */\n\t\tgroups = g_slist_append(groups, cur);\n\n\t\tlast_size = a->len;\n\t\told = cur;\n\t\tlast_handle = cur->handle;\n\t}\n\n\tif (groups == NULL)\n\t\treturn enc_error_resp(ATT_OP_READ_BY_GROUP_REQ, start,\n\t\t\t\t\tATT_ECODE_ATTR_NOT_FOUND, pdu, len);\n\n\tif (dl == NULL)\n\t\tcur->end = a->handle;\n\telse\n\t\tcur->end = last_handle;\n\n\tlength = g_slist_length(groups);\n\n\tadl = att_data_list_alloc(length, last_size + 4);\n\tif (adl == NULL) {\n\t\tg_slist_free_full(groups, g_free);\n\t\treturn enc_error_resp(ATT_OP_READ_BY_GROUP_REQ, start,\n\t\t\t\t\tATT_ECODE_UNLIKELY, pdu, len);\n\t}\n\n\tfor (i = 0, l = groups; l; l = l->next, i++) {\n\t\tuint8_t *value;\n\n\t\tcur = l->data;\n\n\t\tvalue = (void *) adl->data[i];\n\n\t\tput_le16(cur->handle, value);\n\t\tput_le16(cur->end, &value[2]);\n\t\t/* Attribute Value */\n\t\tmemcpy(&value[4], cur->data, cur->len);\n\t}\n\n\tlength = enc_read_by_grp_resp(adl, pdu, len);\n\n\tatt_data_list_free(adl);\n\tg_slist_free_full(groups, g_free);\n\n\treturn length;\n}",
          "includes": [
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"attrib/att-database.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"backtrace.h\"",
            "#include \"log.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <sys/stat.h>",
            "#include <glib.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdbool.h>",
            "#include <stdint.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static bt_uuid_t prim_uuid = {\n\t\t\t.type = BT_UUID16,\n\t\t\t.value.u16 = GATT_PRIM_SVC_UUID\n};",
            "static bt_uuid_t snd_uuid = {\n\t\t\t.type = BT_UUID16,\n\t\t\t.value.u16 = GATT_SND_SVC_UUID\n};"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"attrib/att-database.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"src/shared/util.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <sys/stat.h>\n#include <glib.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdbool.h>\n#include <stdint.h>\n#include <errno.h>\n#include <config.h>\n\nstatic bt_uuid_t prim_uuid = {\n\t\t\t.type = BT_UUID16,\n\t\t\t.value.u16 = GATT_PRIM_SVC_UUID\n};\nstatic bt_uuid_t snd_uuid = {\n\t\t\t.type = BT_UUID16,\n\t\t\t.value.u16 = GATT_SND_SVC_UUID\n};\n\nstatic uint16_t read_by_group(struct gatt_channel *channel, uint16_t start,\n\t\t\t\t\t\tuint16_t end, bt_uuid_t *uuid,\n\t\t\t\t\t\tuint8_t *pdu, size_t len)\n{\n\tstruct att_data_list *adl;\n\tstruct attribute *a;\n\tstruct group_elem *cur, *old = NULL;\n\tGSList *l, *groups;\n\tGList *dl, *database;\n\tuint16_t length, last_handle, last_size = 0;\n\tuint8_t status;\n\tint i;\n\n\tif (start > end || start == 0x0000)\n\t\treturn enc_error_resp(ATT_OP_READ_BY_GROUP_REQ, start,\n\t\t\t\t\tATT_ECODE_INVALID_HANDLE, pdu, len);\n\n\t/*\n\t * Only <<Primary Service>> and <<Secondary Service>> grouping\n\t * types may be used in the Read By Group Type Request.\n\t */\n\n\tif (bt_uuid_cmp(uuid, &prim_uuid) != 0 &&\n\t\tbt_uuid_cmp(uuid, &snd_uuid) != 0)\n\t\treturn enc_error_resp(ATT_OP_READ_BY_GROUP_REQ, 0x0000,\n\t\t\t\t\tATT_ECODE_UNSUPP_GRP_TYPE, pdu, len);\n\n\tlast_handle = end;\n\tdatabase = channel->server->database;\n\tfor (dl = database, groups = NULL, cur = NULL; dl; dl = dl->next) {\n\n\t\ta = dl->data;\n\n\t\tif (a->handle < start)\n\t\t\tcontinue;\n\n\t\tif (a->handle >= end)\n\t\t\tbreak;\n\n\t\t/* The old group ends when a new one starts */\n\t\tif (old && (bt_uuid_cmp(&a->uuid, &prim_uuid) == 0 ||\n\t\t\t\tbt_uuid_cmp(&a->uuid, &snd_uuid) == 0)) {\n\t\t\told->end = last_handle;\n\t\t\told = NULL;\n\t\t}\n\n\t\tif (bt_uuid_cmp(&a->uuid, uuid) != 0) {\n\t\t\t/* Still inside a service, update its last handle */\n\t\t\tif (old)\n\t\t\t\tlast_handle = a->handle;\n\t\t\tcontinue;\n\t\t}\n\n\t\tif (last_size && (last_size != a->len))\n\t\t\tbreak;\n\n\t\tstatus = att_check_reqs(channel, ATT_OP_READ_BY_GROUP_REQ,\n\t\t\t\t\t\t\t\ta->read_req);\n\n\t\tif (status == 0x00 && a->read_cb)\n\t\t\tstatus = a->read_cb(a, channel->device,\n\t\t\t\t\t\t\ta->cb_user_data);\n\n\t\tif (status) {\n\t\t\tg_slist_free_full(groups, g_free);\n\t\t\treturn enc_error_resp(ATT_OP_READ_BY_GROUP_REQ,\n\t\t\t\t\t\ta->handle, status, pdu, len);\n\t\t}\n\n\t\tcur = g_new0(struct group_elem, 1);\n\t\tcur->handle = a->handle;\n\t\tcur->data = a->data;\n\t\tcur->len = a->len;\n\n\t\t/* Attribute Grouping Type found */\n\t\tgroups = g_slist_append(groups, cur);\n\n\t\tlast_size = a->len;\n\t\told = cur;\n\t\tlast_handle = cur->handle;\n\t}\n\n\tif (groups == NULL)\n\t\treturn enc_error_resp(ATT_OP_READ_BY_GROUP_REQ, start,\n\t\t\t\t\tATT_ECODE_ATTR_NOT_FOUND, pdu, len);\n\n\tif (dl == NULL)\n\t\tcur->end = a->handle;\n\telse\n\t\tcur->end = last_handle;\n\n\tlength = g_slist_length(groups);\n\n\tadl = att_data_list_alloc(length, last_size + 4);\n\tif (adl == NULL) {\n\t\tg_slist_free_full(groups, g_free);\n\t\treturn enc_error_resp(ATT_OP_READ_BY_GROUP_REQ, start,\n\t\t\t\t\tATT_ECODE_UNLIKELY, pdu, len);\n\t}\n\n\tfor (i = 0, l = groups; l; l = l->next, i++) {\n\t\tuint8_t *value;\n\n\t\tcur = l->data;\n\n\t\tvalue = (void *) adl->data[i];\n\n\t\tput_le16(cur->handle, value);\n\t\tput_le16(cur->end, &value[2]);\n\t\t/* Attribute Value */\n\t\tmemcpy(&value[4], cur->data, cur->len);\n\t}\n\n\tlength = enc_read_by_grp_resp(adl, pdu, len);\n\n\tatt_data_list_free(adl);\n\tg_slist_free_full(groups, g_free);\n\n\treturn length;\n}"
        }
      },
      {
        "call_info": {
          "callee": "dec_read_by_grp_req",
          "args": [
            "ipdu",
            "len",
            "&start",
            "&end",
            "&uuid"
          ],
          "line": 1010
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"Too much data on ATT socket\""
          ],
          "line": 1003
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_not_ready",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "118-122",
          "snippet": "DBusMessage *btd_error_not_ready(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".NotReady\",\n\t\t\t\t\t\"Resource Not Ready\");\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_not_ready(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".NotReady\",\n\t\t\t\t\t\"Resource Not Ready\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"op 0x%02x\"",
            "ipdu[0]"
          ],
          "line": 1000
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_attrib_get_buffer",
          "args": [
            "channel->attrib",
            "&vlen"
          ],
          "line": 998
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"attrib/att-database.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"src/shared/util.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <sys/stat.h>\n#include <glib.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdbool.h>\n#include <stdint.h>\n#include <errno.h>\n#include <config.h>\n\nstatic void channel_handler(const uint8_t *ipdu, uint16_t len,\n\t\t\t\t\t\t\tgpointer user_data)\n{\n\tstruct gatt_channel *channel = user_data;\n\tuint8_t opdu[channel->mtu];\n\tuint16_t length, start, end, mtu, offset;\n\tbt_uuid_t uuid;\n\tuint8_t status = 0;\n\tsize_t vlen;\n\tuint8_t *value = g_attrib_get_buffer(channel->attrib, &vlen);\n\n\tDBG(\"op 0x%02x\", ipdu[0]);\n\n\tif (len > vlen) {\n\t\terror(\"Too much data on ATT socket\");\n\t\tstatus = ATT_ECODE_INVALID_PDU;\n\t\tgoto done;\n\t}\n\n\tswitch (ipdu[0]) {\n\tcase ATT_OP_READ_BY_GROUP_REQ:\n\t\tlength = dec_read_by_grp_req(ipdu, len, &start, &end, &uuid);\n\t\tif (length == 0) {\n\t\t\tstatus = ATT_ECODE_INVALID_PDU;\n\t\t\tgoto done;\n\t\t}\n\n\t\tlength = read_by_group(channel, start, end, &uuid, opdu,\n\t\t\t\t\t\t\t\tchannel->mtu);\n\t\tbreak;\n\tcase ATT_OP_READ_BY_TYPE_REQ:\n\t\tlength = dec_read_by_type_req(ipdu, len, &start, &end, &uuid);\n\t\tif (length == 0) {\n\t\t\tstatus = ATT_ECODE_INVALID_PDU;\n\t\t\tgoto done;\n\t\t}\n\n\t\tlength = read_by_type(channel, start, end, &uuid, opdu,\n\t\t\t\t\t\t\t\tchannel->mtu);\n\t\tbreak;\n\tcase ATT_OP_READ_REQ:\n\t\tlength = dec_read_req(ipdu, len, &start);\n\t\tif (length == 0) {\n\t\t\tstatus = ATT_ECODE_INVALID_PDU;\n\t\t\tgoto done;\n\t\t}\n\n\t\tlength = read_value(channel, start, opdu, channel->mtu);\n\t\tbreak;\n\tcase ATT_OP_READ_BLOB_REQ:\n\t\tlength = dec_read_blob_req(ipdu, len, &start, &offset);\n\t\tif (length == 0) {\n\t\t\tstatus = ATT_ECODE_INVALID_PDU;\n\t\t\tgoto done;\n\t\t}\n\n\t\tlength = read_blob(channel, start, offset, opdu, channel->mtu);\n\t\tbreak;\n\tcase ATT_OP_MTU_REQ:\n\t\tif (!channel->le) {\n\t\t\tstatus = ATT_ECODE_REQ_NOT_SUPP;\n\t\t\tgoto done;\n\t\t}\n\n\t\tlength = dec_mtu_req(ipdu, len, &mtu);\n\t\tif (length == 0) {\n\t\t\tstatus = ATT_ECODE_INVALID_PDU;\n\t\t\tgoto done;\n\t\t}\n\n\t\tlength = mtu_exchange(channel, mtu, opdu, channel->mtu);\n\t\tbreak;\n\tcase ATT_OP_FIND_INFO_REQ:\n\t\tlength = dec_find_info_req(ipdu, len, &start, &end);\n\t\tif (length == 0) {\n\t\t\tstatus = ATT_ECODE_INVALID_PDU;\n\t\t\tgoto done;\n\t\t}\n\n\t\tlength = find_info(channel, start, end, opdu, channel->mtu);\n\t\tbreak;\n\tcase ATT_OP_WRITE_REQ:\n\t\tlength = dec_write_req(ipdu, len, &start, value, &vlen);\n\t\tif (length == 0) {\n\t\t\tstatus = ATT_ECODE_INVALID_PDU;\n\t\t\tgoto done;\n\t\t}\n\n\t\tlength = write_value(channel, start, value, vlen, opdu,\n\t\t\t\t\t\t\t\tchannel->mtu);\n\t\tbreak;\n\tcase ATT_OP_WRITE_CMD:\n\t\tlength = dec_write_cmd(ipdu, len, &start, value, &vlen);\n\t\tif (length > 0)\n\t\t\twrite_value(channel, start, value, vlen, opdu,\n\t\t\t\t\t\t\t\tchannel->mtu);\n\t\treturn;\n\tcase ATT_OP_FIND_BY_TYPE_REQ:\n\t\tlength = dec_find_by_type_req(ipdu, len, &start, &end,\n\t\t\t\t\t\t\t&uuid, value, &vlen);\n\t\tif (length == 0) {\n\t\t\tstatus = ATT_ECODE_INVALID_PDU;\n\t\t\tgoto done;\n\t\t}\n\n\t\tlength = find_by_type(channel, start, end, &uuid, value, vlen,\n\t\t\t\t\t\t\topdu, channel->mtu);\n\t\tbreak;\n\tcase ATT_OP_HANDLE_CNF:\n\t\treturn;\n\tcase ATT_OP_HANDLE_IND:\n\tcase ATT_OP_HANDLE_NOTIFY:\n\t\t/* The attribute client is already handling these */\n\t\treturn;\n\tcase ATT_OP_READ_MULTI_REQ:\n\tcase ATT_OP_PREP_WRITE_REQ:\n\tcase ATT_OP_EXEC_WRITE_REQ:\n\tdefault:\n\t\tDBG(\"Unsupported request 0x%02x\", ipdu[0]);\n\t\tstatus = ATT_ECODE_REQ_NOT_SUPP;\n\t\tgoto done;\n\t}\n\n\tif (length == 0)\n\t\tstatus = ATT_ECODE_IO;\n\ndone:\n\tif (status)\n\t\tlength = enc_error_resp(ipdu[0], 0x0000, status, opdu,\n\t\t\t\t\t\t\t\tchannel->mtu);\n\n\tg_attrib_send(channel->attrib, 0, opdu, length, NULL, NULL, NULL);\n}"
  },
  {
    "function_name": "channel_watch_cb",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/attrib-server.c",
    "lines": "981-987",
    "snippet": "static gboolean channel_watch_cb(GIOChannel *io, GIOCondition cond,\n\t\t\t\t\t\tgpointer user_data)\n{\n\tchannel_remove(user_data);\n\n\treturn FALSE;\n}",
    "includes": [
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"attrib/att-database.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"attrib/att.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"backtrace.h\"",
      "#include \"log.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <sys/stat.h>",
      "#include <glib.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdbool.h>",
      "#include <stdint.h>",
      "#include <errno.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "channel_remove",
          "args": [
            "user_data"
          ],
          "line": 984
        },
        "resolved": true,
        "details": {
          "function_name": "channel_remove",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/attrib-server.c",
          "lines": "974-979",
          "snippet": "static void channel_remove(struct gatt_channel *channel)\n{\n\tchannel->server->clients = g_slist_remove(channel->server->clients,\n\t\t\t\t\t\t\t\tchannel);\n\tchannel_free(channel);\n}",
          "includes": [
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"attrib/att-database.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"backtrace.h\"",
            "#include \"log.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <sys/stat.h>",
            "#include <glib.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdbool.h>",
            "#include <stdint.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"attrib/att-database.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"src/shared/util.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <sys/stat.h>\n#include <glib.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdbool.h>\n#include <stdint.h>\n#include <errno.h>\n#include <config.h>\n\nstatic void channel_remove(struct gatt_channel *channel)\n{\n\tchannel->server->clients = g_slist_remove(channel->server->clients,\n\t\t\t\t\t\t\t\tchannel);\n\tchannel_free(channel);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"attrib/att-database.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"src/shared/util.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <sys/stat.h>\n#include <glib.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdbool.h>\n#include <stdint.h>\n#include <errno.h>\n#include <config.h>\n\nstatic gboolean channel_watch_cb(GIOChannel *io, GIOCondition cond,\n\t\t\t\t\t\tgpointer user_data)\n{\n\tchannel_remove(user_data);\n\n\treturn FALSE;\n}"
  },
  {
    "function_name": "channel_remove",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/attrib-server.c",
    "lines": "974-979",
    "snippet": "static void channel_remove(struct gatt_channel *channel)\n{\n\tchannel->server->clients = g_slist_remove(channel->server->clients,\n\t\t\t\t\t\t\t\tchannel);\n\tchannel_free(channel);\n}",
    "includes": [
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"attrib/att-database.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"attrib/att.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"backtrace.h\"",
      "#include \"log.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <sys/stat.h>",
      "#include <glib.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdbool.h>",
      "#include <stdint.h>",
      "#include <errno.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "channel_free",
          "args": [
            "channel"
          ],
          "line": 978
        },
        "resolved": true,
        "details": {
          "function_name": "channel_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/attrib-server.c",
          "lines": "110-121",
          "snippet": "static void channel_free(struct gatt_channel *channel)\n{\n\n\tif (channel->cleanup_id)\n\t\tg_source_remove(channel->cleanup_id);\n\n\tif (channel->device)\n\t\tbtd_device_unref(channel->device);\n\n\tg_attrib_unref(channel->attrib);\n\tg_free(channel);\n}",
          "includes": [
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"attrib/att-database.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"backtrace.h\"",
            "#include \"log.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <sys/stat.h>",
            "#include <glib.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdbool.h>",
            "#include <stdint.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"attrib/att-database.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"src/shared/util.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <sys/stat.h>\n#include <glib.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdbool.h>\n#include <stdint.h>\n#include <errno.h>\n#include <config.h>\n\nstatic void channel_free(struct gatt_channel *channel)\n{\n\n\tif (channel->cleanup_id)\n\t\tg_source_remove(channel->cleanup_id);\n\n\tif (channel->device)\n\t\tbtd_device_unref(channel->device);\n\n\tg_attrib_unref(channel->attrib);\n\tg_free(channel);\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_slist_remove",
          "args": [
            "channel->server->clients",
            "channel"
          ],
          "line": 976
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"attrib/att-database.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"src/shared/util.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <sys/stat.h>\n#include <glib.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdbool.h>\n#include <stdint.h>\n#include <errno.h>\n#include <config.h>\n\nstatic void channel_remove(struct gatt_channel *channel)\n{\n\tchannel->server->clients = g_slist_remove(channel->server->clients,\n\t\t\t\t\t\t\t\tchannel);\n\tchannel_free(channel);\n}"
  },
  {
    "function_name": "mtu_exchange",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/attrib-server.c",
    "lines": "947-972",
    "snippet": "static uint16_t mtu_exchange(struct gatt_channel *channel, uint16_t mtu,\n\t\t\t\t\t\tuint8_t *pdu, size_t len)\n{\n\tGError *gerr = NULL;\n\tGIOChannel *io;\n\tuint16_t imtu;\n\n\tif (mtu < ATT_DEFAULT_LE_MTU)\n\t\treturn enc_error_resp(ATT_OP_MTU_REQ, 0,\n\t\t\t\t\tATT_ECODE_REQ_NOT_SUPP, pdu, len);\n\n\tio = g_attrib_get_channel(channel->attrib);\n\n\tbt_io_get(io, &gerr, BT_IO_OPT_IMTU, &imtu, BT_IO_OPT_INVALID);\n\tif (gerr) {\n\t\terror(\"bt_io_get: %s\", gerr->message);\n\t\tg_error_free(gerr);\n\t\treturn enc_error_resp(ATT_OP_MTU_REQ, 0, ATT_ECODE_UNLIKELY,\n\t\t\t\t\t\t\t\tpdu, len);\n\t}\n\n\tchannel->mtu = MIN(mtu, imtu);\n\tg_attrib_set_mtu(channel->attrib, channel->mtu);\n\n\treturn enc_mtu_resp(imtu, pdu, len);\n}",
    "includes": [
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"attrib/att-database.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"attrib/att.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"backtrace.h\"",
      "#include \"log.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <sys/stat.h>",
      "#include <glib.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdbool.h>",
      "#include <stdint.h>",
      "#include <errno.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "enc_mtu_resp",
          "args": [
            "imtu",
            "pdu",
            "len"
          ],
          "line": 971
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_attrib_set_mtu",
          "args": [
            "channel->attrib",
            "channel->mtu"
          ],
          "line": 969
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "MIN",
          "args": [
            "mtu",
            "imtu"
          ],
          "line": 968
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "enc_error_resp",
          "args": [
            "ATT_OP_MTU_REQ",
            "0",
            "ATT_ECODE_UNLIKELY",
            "pdu",
            "len"
          ],
          "line": 964
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_error_free",
          "args": [
            "gerr"
          ],
          "line": 963
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"bt_io_get: %s\"",
            "gerr->message"
          ],
          "line": 962
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_failed",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "124-128",
          "snippet": "DBusMessage *btd_error_failed(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE\n\t\t\t\t\t\".Failed\", \"%s\", str);\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_failed(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE\n\t\t\t\t\t\".Failed\", \"%s\", str);\n}"
        }
      },
      {
        "call_info": {
          "callee": "bt_io_get",
          "args": [
            "io",
            "&gerr",
            "BT_IO_OPT_IMTU",
            "&imtu",
            "BT_IO_OPT_INVALID"
          ],
          "line": 960
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_attrib_get_channel",
          "args": [
            "channel->attrib"
          ],
          "line": 958
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "enc_error_resp",
          "args": [
            "ATT_OP_MTU_REQ",
            "0",
            "ATT_ECODE_REQ_NOT_SUPP",
            "pdu",
            "len"
          ],
          "line": 955
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"attrib/att-database.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"src/shared/util.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <sys/stat.h>\n#include <glib.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdbool.h>\n#include <stdint.h>\n#include <errno.h>\n#include <config.h>\n\nstatic uint16_t mtu_exchange(struct gatt_channel *channel, uint16_t mtu,\n\t\t\t\t\t\tuint8_t *pdu, size_t len)\n{\n\tGError *gerr = NULL;\n\tGIOChannel *io;\n\tuint16_t imtu;\n\n\tif (mtu < ATT_DEFAULT_LE_MTU)\n\t\treturn enc_error_resp(ATT_OP_MTU_REQ, 0,\n\t\t\t\t\tATT_ECODE_REQ_NOT_SUPP, pdu, len);\n\n\tio = g_attrib_get_channel(channel->attrib);\n\n\tbt_io_get(io, &gerr, BT_IO_OPT_IMTU, &imtu, BT_IO_OPT_INVALID);\n\tif (gerr) {\n\t\terror(\"bt_io_get: %s\", gerr->message);\n\t\tg_error_free(gerr);\n\t\treturn enc_error_resp(ATT_OP_MTU_REQ, 0, ATT_ECODE_UNLIKELY,\n\t\t\t\t\t\t\t\tpdu, len);\n\t}\n\n\tchannel->mtu = MIN(mtu, imtu);\n\tg_attrib_set_mtu(channel->attrib, channel->mtu);\n\n\treturn enc_mtu_resp(imtu, pdu, len);\n}"
  },
  {
    "function_name": "write_value",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/attrib-server.c",
    "lines": "876-945",
    "snippet": "static uint16_t write_value(struct gatt_channel *channel, uint16_t handle,\n\t\t\t\t\tconst uint8_t *value, size_t vlen,\n\t\t\t\t\tuint8_t *pdu, size_t len)\n{\n\tstruct attribute *a;\n\tuint8_t status;\n\tGList *l;\n\tguint h = handle;\n\n\tl = g_list_find_custom(channel->server->database,\n\t\t\t\t\tGUINT_TO_POINTER(h), handle_cmp);\n\tif (!l)\n\t\treturn enc_error_resp(ATT_OP_WRITE_REQ, handle,\n\t\t\t\tATT_ECODE_INVALID_HANDLE, pdu, len);\n\n\ta = l->data;\n\n\tstatus = att_check_reqs(channel, ATT_OP_WRITE_REQ, a->write_req);\n\tif (status)\n\t\treturn enc_error_resp(ATT_OP_WRITE_REQ, handle, status, pdu,\n\t\t\t\t\t\t\t\t\tlen);\n\n\tif (bt_uuid_cmp(&ccc_uuid, &a->uuid) != 0) {\n\n\t\tattrib_db_update(channel->server->adapter, handle, NULL,\n\t\t\t\t\t\t\tvalue, vlen, NULL);\n\n\t\tif (a->write_cb) {\n\t\t\tstatus = a->write_cb(a, channel->device,\n\t\t\t\t\t\t\ta->cb_user_data);\n\t\t\tif (status)\n\t\t\t\treturn enc_error_resp(ATT_OP_WRITE_REQ, handle,\n\t\t\t\t\t\t\tstatus, pdu, len);\n\t\t}\n\t} else {\n\t\tuint16_t cccval = get_le16(value);\n\t\tchar *filename;\n\t\tGKeyFile *key_file;\n\t\tchar group[6], value[5];\n\t\tchar *data;\n\t\tgsize length = 0;\n\n\t\tfilename = btd_device_get_storage_path(channel->device, \"ccc\");\n\t\tif (!filename) {\n\t\t\twarn(\"Unable to get ccc storage path for device\");\n\t\t\treturn enc_error_resp(ATT_OP_WRITE_REQ, handle,\n\t\t\t\t\t\tATT_ECODE_WRITE_NOT_PERM,\n\t\t\t\t\t\tpdu, len);\n\t\t}\n\n\t\tkey_file = g_key_file_new();\n\t\tg_key_file_load_from_file(key_file, filename, 0, NULL);\n\n\t\tsprintf(group, \"%hu\", handle);\n\t\tsprintf(value, \"%hX\", cccval);\n\t\tg_key_file_set_string(key_file, group, \"Value\", value);\n\n\t\tdata = g_key_file_to_data(key_file, &length, NULL);\n\t\tif (length > 0) {\n\t\t\tcreate_file(filename, S_IRUSR | S_IWUSR);\n\t\t\tg_file_set_contents(filename, data, length, NULL);\n\t\t}\n\n\t\tg_free(data);\n\t\tg_free(filename);\n\t\tg_key_file_free(key_file);\n\t}\n\n\treturn enc_write_resp(pdu);\n}",
    "includes": [
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"attrib/att-database.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"attrib/att.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"backtrace.h\"",
      "#include \"log.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <sys/stat.h>",
      "#include <glib.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdbool.h>",
      "#include <stdint.h>",
      "#include <errno.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static bt_uuid_t ccc_uuid = {\n\t\t\t.type = BT_UUID16,\n\t\t\t.value.u16 = GATT_CLIENT_CHARAC_CFG_UUID\n};"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "enc_write_resp",
          "args": [
            "pdu"
          ],
          "line": 944
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_key_file_free",
          "args": [
            "key_file"
          ],
          "line": 941
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_free",
          "args": [
            "filename"
          ],
          "line": 940
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_free",
          "args": [
            "data"
          ],
          "line": 939
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_file_set_contents",
          "args": [
            "filename",
            "data",
            "length",
            "NULL"
          ],
          "line": 936
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "create_file",
          "args": [
            "filename",
            "S_IRUSR | S_IWUSR"
          ],
          "line": 935
        },
        "resolved": true,
        "details": {
          "function_name": "create_file",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/textfile.c",
          "lines": "76-89",
          "snippet": "int create_file(const char *filename, const mode_t mode)\n{\n\tint fd;\n\n\tcreate_dirs(filename, S_IRUSR | S_IWUSR | S_IXUSR);\n\n\tfd = open(filename, O_RDWR | O_CREAT, mode);\n\tif (fd < 0)\n\t\treturn fd;\n\n\tclose(fd);\n\n\treturn 0;\n}",
          "includes": [
            "#include \"textfile.h\"",
            "#include <sys/param.h>",
            "#include <sys/mman.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "#include <ctype.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"textfile.h\"\n#include <sys/param.h>\n#include <sys/mman.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <string.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <fcntl.h>\n#include <ctype.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nint create_file(const char *filename, const mode_t mode)\n{\n\tint fd;\n\n\tcreate_dirs(filename, S_IRUSR | S_IWUSR | S_IXUSR);\n\n\tfd = open(filename, O_RDWR | O_CREAT, mode);\n\tif (fd < 0)\n\t\treturn fd;\n\n\tclose(fd);\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_key_file_to_data",
          "args": [
            "key_file",
            "&length",
            "NULL"
          ],
          "line": 933
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_key_file_set_string",
          "args": [
            "key_file",
            "group",
            "\"Value\"",
            "value"
          ],
          "line": 931
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sprintf",
          "args": [
            "value",
            "\"%hX\"",
            "cccval"
          ],
          "line": 930
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sprintf",
          "args": [
            "group",
            "\"%hu\"",
            "handle"
          ],
          "line": 929
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_key_file_load_from_file",
          "args": [
            "key_file",
            "filename",
            "0",
            "NULL"
          ],
          "line": 927
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_key_file_new",
          "args": [],
          "line": 926
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "enc_error_resp",
          "args": [
            "ATT_OP_WRITE_REQ",
            "handle",
            "ATT_ECODE_WRITE_NOT_PERM",
            "pdu",
            "len"
          ],
          "line": 921
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "warn",
          "args": [
            "\"Unable to get ccc storage path for device\""
          ],
          "line": 920
        },
        "resolved": true,
        "details": {
          "function_name": "warn",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/log.c",
          "lines": "151-165",
          "snippet": "void warn(const char *format, ...)\n{\n\tva_list ap;\n\n\tva_start(ap, format);\n\tvsyslog(LOG_WARNING, format, ap);\n\tva_end(ap);\n\n\tif (logging_fd < 0)\n\t\treturn;\n\n\tva_start(ap, format);\n\tlogging_log(HCI_DEV_NONE, LOG_WARNING, format, ap);\n\tva_end(ap);\n}",
          "includes": [
            "#include \"log.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/hci.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <sys/socket.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <stdarg.h>",
            "#include <syslog.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int logging_fd = -1;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n#include \"src/shared/util.h\"\n#include \"lib/hci.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <sys/socket.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdarg.h>\n#include <syslog.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic int logging_fd = -1;\n\nvoid warn(const char *format, ...)\n{\n\tva_list ap;\n\n\tva_start(ap, format);\n\tvsyslog(LOG_WARNING, format, ap);\n\tva_end(ap);\n\n\tif (logging_fd < 0)\n\t\treturn;\n\n\tva_start(ap, format);\n\tlogging_log(HCI_DEV_NONE, LOG_WARNING, format, ap);\n\tva_end(ap);\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_device_get_storage_path",
          "args": [
            "channel->device",
            "\"ccc\""
          ],
          "line": 918
        },
        "resolved": true,
        "details": {
          "function_name": "btd_device_get_storage_path",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "3867-3888",
          "snippet": "char *btd_device_get_storage_path(struct btd_device *device,\n\t\t\t\tconst char *filename)\n{\n\tchar dstaddr[18];\n\n\tif (device_address_is_private(device)) {\n\t\twarn(\"Refusing storage path for private addressed device %s\",\n\t\t\t\t\t\t\t\tdevice->path);\n\t\treturn NULL;\n\t}\n\n\tba2str(&device->bdaddr, dstaddr);\n\n\tif (!filename)\n\t\treturn g_strdup_printf(STORAGEDIR \"/%s/%s\",\n\t\t\t\tbtd_adapter_get_storage_dir(device->adapter),\n\t\t\t\tdstaddr);\n\n\treturn g_strdup_printf(STORAGEDIR \"/%s/%s/%s\",\n\t\t\t\tbtd_adapter_get_storage_dir(device->adapter),\n\t\t\t\tdstaddr, filename);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nchar *btd_device_get_storage_path(struct btd_device *device,\n\t\t\t\tconst char *filename)\n{\n\tchar dstaddr[18];\n\n\tif (device_address_is_private(device)) {\n\t\twarn(\"Refusing storage path for private addressed device %s\",\n\t\t\t\t\t\t\t\tdevice->path);\n\t\treturn NULL;\n\t}\n\n\tba2str(&device->bdaddr, dstaddr);\n\n\tif (!filename)\n\t\treturn g_strdup_printf(STORAGEDIR \"/%s/%s\",\n\t\t\t\tbtd_adapter_get_storage_dir(device->adapter),\n\t\t\t\tdstaddr);\n\n\treturn g_strdup_printf(STORAGEDIR \"/%s/%s/%s\",\n\t\t\t\tbtd_adapter_get_storage_dir(device->adapter),\n\t\t\t\tdstaddr, filename);\n}"
        }
      },
      {
        "call_info": {
          "callee": "get_le16",
          "args": [
            "value"
          ],
          "line": 911
        },
        "resolved": true,
        "details": {
          "function_name": "get_le16",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/util.h",
          "lines": "129-132",
          "snippet": "static inline uint16_t get_le16(const void *ptr)\n{\n\treturn le16_to_cpu(get_unaligned((const uint16_t *) ptr));\n}",
          "includes": [
            "#include <string.h>",
            "#include <byteswap.h>",
            "#include <alloca.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <byteswap.h>\n#include <alloca.h>\n#include <stdlib.h>\n#include <stdint.h>\n\nstatic inline uint16_t get_le16(const void *ptr)\n{\n\treturn le16_to_cpu(get_unaligned((const uint16_t *) ptr));\n}"
        }
      },
      {
        "call_info": {
          "callee": "enc_error_resp",
          "args": [
            "ATT_OP_WRITE_REQ",
            "handle",
            "status",
            "pdu",
            "len"
          ],
          "line": 907
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "a->write_cb",
          "args": [
            "a",
            "channel->device",
            "a->cb_user_data"
          ],
          "line": 904
        },
        "resolved": true,
        "details": {
          "function_name": "write_cb",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
          "lines": "511-514",
          "snippet": "static void write_cb(bool success, uint8_t att_ecode, void *user_data)\n{\n\twrite_result_cb(success, false, att_ecode, user_data);\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"gatt-client.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void write_cb(bool success, uint8_t att_ecode, void *user_data)\n{\n\twrite_result_cb(success, false, att_ecode, user_data);\n}"
        }
      },
      {
        "call_info": {
          "callee": "attrib_db_update",
          "args": [
            "channel->server->adapter",
            "handle",
            "NULL",
            "value",
            "vlen",
            "NULL"
          ],
          "line": 900
        },
        "resolved": true,
        "details": {
          "function_name": "attrib_db_update",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/attrib-server.c",
          "lines": "1557-1596",
          "snippet": "int attrib_db_update(struct btd_adapter *adapter, uint16_t handle,\n\t\t\t\t\tbt_uuid_t *uuid, const uint8_t *value,\n\t\t\t\t\tsize_t len, struct attribute **attr)\n{\n\tstruct gatt_server *server;\n\tstruct attribute *a;\n\tGSList *l;\n\tGList *dl;\n\tguint h = handle;\n\n\tl = g_slist_find_custom(servers, adapter, adapter_cmp);\n\tif (l == NULL)\n\t\treturn -ENOENT;\n\n\tserver = l->data;\n\n\tDBG(\"handle=0x%04x\", handle);\n\n\tdl = g_list_find_custom(server->database, GUINT_TO_POINTER(h),\n\t\t\t\t\t\t\t\thandle_cmp);\n\tif (dl == NULL)\n\t\treturn -ENOENT;\n\n\ta = dl->data;\n\n\ta->data = g_try_realloc(a->data, len);\n\tif (len && a->data == NULL)\n\t\treturn -ENOMEM;\n\n\ta->len = len;\n\tmemcpy(a->data, value, len);\n\n\tif (uuid != NULL)\n\t\ta->uuid = *uuid;\n\n\tif (attr)\n\t\t*attr = a;\n\n\treturn 0;\n}",
          "includes": [
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"attrib/att-database.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"backtrace.h\"",
            "#include \"log.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <sys/stat.h>",
            "#include <glib.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdbool.h>",
            "#include <stdint.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static GSList *servers = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"attrib/att-database.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"src/shared/util.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <sys/stat.h>\n#include <glib.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdbool.h>\n#include <stdint.h>\n#include <errno.h>\n#include <config.h>\n\nstatic GSList *servers = NULL;\n\nint attrib_db_update(struct btd_adapter *adapter, uint16_t handle,\n\t\t\t\t\tbt_uuid_t *uuid, const uint8_t *value,\n\t\t\t\t\tsize_t len, struct attribute **attr)\n{\n\tstruct gatt_server *server;\n\tstruct attribute *a;\n\tGSList *l;\n\tGList *dl;\n\tguint h = handle;\n\n\tl = g_slist_find_custom(servers, adapter, adapter_cmp);\n\tif (l == NULL)\n\t\treturn -ENOENT;\n\n\tserver = l->data;\n\n\tDBG(\"handle=0x%04x\", handle);\n\n\tdl = g_list_find_custom(server->database, GUINT_TO_POINTER(h),\n\t\t\t\t\t\t\t\thandle_cmp);\n\tif (dl == NULL)\n\t\treturn -ENOENT;\n\n\ta = dl->data;\n\n\ta->data = g_try_realloc(a->data, len);\n\tif (len && a->data == NULL)\n\t\treturn -ENOMEM;\n\n\ta->len = len;\n\tmemcpy(a->data, value, len);\n\n\tif (uuid != NULL)\n\t\ta->uuid = *uuid;\n\n\tif (attr)\n\t\t*attr = a;\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "bt_uuid_cmp",
          "args": [
            "&ccc_uuid",
            "&a->uuid"
          ],
          "line": 898
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "enc_error_resp",
          "args": [
            "ATT_OP_WRITE_REQ",
            "handle",
            "status",
            "pdu",
            "len"
          ],
          "line": 895
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "att_check_reqs",
          "args": [
            "channel",
            "ATT_OP_WRITE_REQ",
            "a->write_req"
          ],
          "line": 893
        },
        "resolved": true,
        "details": {
          "function_name": "att_check_reqs",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/attrib-server.c",
          "lines": "379-411",
          "snippet": "static uint8_t att_check_reqs(struct gatt_channel *channel, uint8_t opcode,\n\t\t\t\t\t\t\t\tint reqs)\n{\n\t/* FIXME: currently, it is assumed an encrypted link is enough for\n\t * authentication. This will allow to enable the SMP negotiation once\n\t * it is on upstream kernel. High security level should be mapped\n\t * to authentication and medium to encryption permission. */\n\tif (!channel->encrypted)\n\t\tchannel->encrypted = g_attrib_is_encrypted(channel->attrib);\n\tif (reqs == ATT_AUTHENTICATION && !channel->encrypted)\n\t\treturn ATT_ECODE_AUTHENTICATION;\n\telse if (reqs == ATT_AUTHORIZATION)\n\t\treturn ATT_ECODE_AUTHORIZATION;\n\n\tswitch (opcode) {\n\tcase ATT_OP_READ_BY_GROUP_REQ:\n\tcase ATT_OP_READ_BY_TYPE_REQ:\n\tcase ATT_OP_READ_REQ:\n\tcase ATT_OP_READ_BLOB_REQ:\n\tcase ATT_OP_READ_MULTI_REQ:\n\t\tif (reqs == ATT_NOT_PERMITTED)\n\t\t\treturn ATT_ECODE_READ_NOT_PERM;\n\t\tbreak;\n\tcase ATT_OP_PREP_WRITE_REQ:\n\tcase ATT_OP_WRITE_REQ:\n\tcase ATT_OP_WRITE_CMD:\n\t\tif (reqs == ATT_NOT_PERMITTED)\n\t\t\treturn ATT_ECODE_WRITE_NOT_PERM;\n\t\tbreak;\n\t}\n\n\treturn 0;\n}",
          "includes": [
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"attrib/att-database.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"backtrace.h\"",
            "#include \"log.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <sys/stat.h>",
            "#include <glib.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdbool.h>",
            "#include <stdint.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"attrib/att-database.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"src/shared/util.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <sys/stat.h>\n#include <glib.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdbool.h>\n#include <stdint.h>\n#include <errno.h>\n#include <config.h>\n\nstatic uint8_t att_check_reqs(struct gatt_channel *channel, uint8_t opcode,\n\t\t\t\t\t\t\t\tint reqs)\n{\n\t/* FIXME: currently, it is assumed an encrypted link is enough for\n\t * authentication. This will allow to enable the SMP negotiation once\n\t * it is on upstream kernel. High security level should be mapped\n\t * to authentication and medium to encryption permission. */\n\tif (!channel->encrypted)\n\t\tchannel->encrypted = g_attrib_is_encrypted(channel->attrib);\n\tif (reqs == ATT_AUTHENTICATION && !channel->encrypted)\n\t\treturn ATT_ECODE_AUTHENTICATION;\n\telse if (reqs == ATT_AUTHORIZATION)\n\t\treturn ATT_ECODE_AUTHORIZATION;\n\n\tswitch (opcode) {\n\tcase ATT_OP_READ_BY_GROUP_REQ:\n\tcase ATT_OP_READ_BY_TYPE_REQ:\n\tcase ATT_OP_READ_REQ:\n\tcase ATT_OP_READ_BLOB_REQ:\n\tcase ATT_OP_READ_MULTI_REQ:\n\t\tif (reqs == ATT_NOT_PERMITTED)\n\t\t\treturn ATT_ECODE_READ_NOT_PERM;\n\t\tbreak;\n\tcase ATT_OP_PREP_WRITE_REQ:\n\tcase ATT_OP_WRITE_REQ:\n\tcase ATT_OP_WRITE_CMD:\n\t\tif (reqs == ATT_NOT_PERMITTED)\n\t\t\treturn ATT_ECODE_WRITE_NOT_PERM;\n\t\tbreak;\n\t}\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "enc_error_resp",
          "args": [
            "ATT_OP_WRITE_REQ",
            "handle",
            "ATT_ECODE_INVALID_HANDLE",
            "pdu",
            "len"
          ],
          "line": 888
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_list_find_custom",
          "args": [
            "channel->server->database",
            "GUINT_TO_POINTER(h)",
            "handle_cmp"
          ],
          "line": 885
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "GUINT_TO_POINTER",
          "args": [
            "h"
          ],
          "line": 886
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"attrib/att-database.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"src/shared/util.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <sys/stat.h>\n#include <glib.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdbool.h>\n#include <stdint.h>\n#include <errno.h>\n#include <config.h>\n\nstatic bt_uuid_t ccc_uuid = {\n\t\t\t.type = BT_UUID16,\n\t\t\t.value.u16 = GATT_CLIENT_CHARAC_CFG_UUID\n};\n\nstatic uint16_t write_value(struct gatt_channel *channel, uint16_t handle,\n\t\t\t\t\tconst uint8_t *value, size_t vlen,\n\t\t\t\t\tuint8_t *pdu, size_t len)\n{\n\tstruct attribute *a;\n\tuint8_t status;\n\tGList *l;\n\tguint h = handle;\n\n\tl = g_list_find_custom(channel->server->database,\n\t\t\t\t\tGUINT_TO_POINTER(h), handle_cmp);\n\tif (!l)\n\t\treturn enc_error_resp(ATT_OP_WRITE_REQ, handle,\n\t\t\t\tATT_ECODE_INVALID_HANDLE, pdu, len);\n\n\ta = l->data;\n\n\tstatus = att_check_reqs(channel, ATT_OP_WRITE_REQ, a->write_req);\n\tif (status)\n\t\treturn enc_error_resp(ATT_OP_WRITE_REQ, handle, status, pdu,\n\t\t\t\t\t\t\t\t\tlen);\n\n\tif (bt_uuid_cmp(&ccc_uuid, &a->uuid) != 0) {\n\n\t\tattrib_db_update(channel->server->adapter, handle, NULL,\n\t\t\t\t\t\t\tvalue, vlen, NULL);\n\n\t\tif (a->write_cb) {\n\t\t\tstatus = a->write_cb(a, channel->device,\n\t\t\t\t\t\t\ta->cb_user_data);\n\t\t\tif (status)\n\t\t\t\treturn enc_error_resp(ATT_OP_WRITE_REQ, handle,\n\t\t\t\t\t\t\tstatus, pdu, len);\n\t\t}\n\t} else {\n\t\tuint16_t cccval = get_le16(value);\n\t\tchar *filename;\n\t\tGKeyFile *key_file;\n\t\tchar group[6], value[5];\n\t\tchar *data;\n\t\tgsize length = 0;\n\n\t\tfilename = btd_device_get_storage_path(channel->device, \"ccc\");\n\t\tif (!filename) {\n\t\t\twarn(\"Unable to get ccc storage path for device\");\n\t\t\treturn enc_error_resp(ATT_OP_WRITE_REQ, handle,\n\t\t\t\t\t\tATT_ECODE_WRITE_NOT_PERM,\n\t\t\t\t\t\tpdu, len);\n\t\t}\n\n\t\tkey_file = g_key_file_new();\n\t\tg_key_file_load_from_file(key_file, filename, 0, NULL);\n\n\t\tsprintf(group, \"%hu\", handle);\n\t\tsprintf(value, \"%hX\", cccval);\n\t\tg_key_file_set_string(key_file, group, \"Value\", value);\n\n\t\tdata = g_key_file_to_data(key_file, &length, NULL);\n\t\tif (length > 0) {\n\t\t\tcreate_file(filename, S_IRUSR | S_IWUSR);\n\t\t\tg_file_set_contents(filename, data, length, NULL);\n\t\t}\n\n\t\tg_free(data);\n\t\tg_free(filename);\n\t\tg_key_file_free(key_file);\n\t}\n\n\treturn enc_write_resp(pdu);\n}"
  },
  {
    "function_name": "read_blob",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/attrib-server.c",
    "lines": "834-874",
    "snippet": "static uint16_t read_blob(struct gatt_channel *channel, uint16_t handle,\n\t\t\t\tuint16_t offset, uint8_t *pdu, size_t len)\n{\n\tstruct attribute *a;\n\tuint8_t status;\n\tGList *l;\n\tuint16_t cccval;\n\tguint h = handle;\n\n\tl = g_list_find_custom(channel->server->database,\n\t\t\t\t\tGUINT_TO_POINTER(h), handle_cmp);\n\tif (!l)\n\t\treturn enc_error_resp(ATT_OP_READ_BLOB_REQ, handle,\n\t\t\t\t\tATT_ECODE_INVALID_HANDLE, pdu, len);\n\n\ta = l->data;\n\n\tif (a->len < offset)\n\t\treturn enc_error_resp(ATT_OP_READ_BLOB_REQ, handle,\n\t\t\t\t\tATT_ECODE_INVALID_OFFSET, pdu, len);\n\n\tif (bt_uuid_cmp(&ccc_uuid, &a->uuid) == 0 &&\n\t\tread_device_ccc(channel->device, handle, &cccval) == 0) {\n\t\tuint8_t config[2];\n\n\t\tput_le16(cccval, config);\n\t\treturn enc_read_blob_resp(config, sizeof(config), offset,\n\t\t\t\t\t\t\t\tpdu, len);\n\t}\n\n\tstatus = att_check_reqs(channel, ATT_OP_READ_BLOB_REQ, a->read_req);\n\n\tif (status == 0x00 && a->read_cb)\n\t\tstatus = a->read_cb(a, channel->device, a->cb_user_data);\n\n\tif (status)\n\t\treturn enc_error_resp(ATT_OP_READ_BLOB_REQ, handle, status,\n\t\t\t\t\t\t\t\tpdu, len);\n\n\treturn enc_read_blob_resp(a->data, a->len, offset, pdu, len);\n}",
    "includes": [
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"attrib/att-database.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"attrib/att.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"backtrace.h\"",
      "#include \"log.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <sys/stat.h>",
      "#include <glib.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdbool.h>",
      "#include <stdint.h>",
      "#include <errno.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static bt_uuid_t ccc_uuid = {\n\t\t\t.type = BT_UUID16,\n\t\t\t.value.u16 = GATT_CLIENT_CHARAC_CFG_UUID\n};"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "enc_read_blob_resp",
          "args": [
            "a->data",
            "a->len",
            "offset",
            "pdu",
            "len"
          ],
          "line": 873
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "enc_error_resp",
          "args": [
            "ATT_OP_READ_BLOB_REQ",
            "handle",
            "status",
            "pdu",
            "len"
          ],
          "line": 870
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "a->read_cb",
          "args": [
            "a",
            "channel->device",
            "a->cb_user_data"
          ],
          "line": 867
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "att_check_reqs",
          "args": [
            "channel",
            "ATT_OP_READ_BLOB_REQ",
            "a->read_req"
          ],
          "line": 864
        },
        "resolved": true,
        "details": {
          "function_name": "att_check_reqs",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/attrib-server.c",
          "lines": "379-411",
          "snippet": "static uint8_t att_check_reqs(struct gatt_channel *channel, uint8_t opcode,\n\t\t\t\t\t\t\t\tint reqs)\n{\n\t/* FIXME: currently, it is assumed an encrypted link is enough for\n\t * authentication. This will allow to enable the SMP negotiation once\n\t * it is on upstream kernel. High security level should be mapped\n\t * to authentication and medium to encryption permission. */\n\tif (!channel->encrypted)\n\t\tchannel->encrypted = g_attrib_is_encrypted(channel->attrib);\n\tif (reqs == ATT_AUTHENTICATION && !channel->encrypted)\n\t\treturn ATT_ECODE_AUTHENTICATION;\n\telse if (reqs == ATT_AUTHORIZATION)\n\t\treturn ATT_ECODE_AUTHORIZATION;\n\n\tswitch (opcode) {\n\tcase ATT_OP_READ_BY_GROUP_REQ:\n\tcase ATT_OP_READ_BY_TYPE_REQ:\n\tcase ATT_OP_READ_REQ:\n\tcase ATT_OP_READ_BLOB_REQ:\n\tcase ATT_OP_READ_MULTI_REQ:\n\t\tif (reqs == ATT_NOT_PERMITTED)\n\t\t\treturn ATT_ECODE_READ_NOT_PERM;\n\t\tbreak;\n\tcase ATT_OP_PREP_WRITE_REQ:\n\tcase ATT_OP_WRITE_REQ:\n\tcase ATT_OP_WRITE_CMD:\n\t\tif (reqs == ATT_NOT_PERMITTED)\n\t\t\treturn ATT_ECODE_WRITE_NOT_PERM;\n\t\tbreak;\n\t}\n\n\treturn 0;\n}",
          "includes": [
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"attrib/att-database.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"backtrace.h\"",
            "#include \"log.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <sys/stat.h>",
            "#include <glib.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdbool.h>",
            "#include <stdint.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"attrib/att-database.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"src/shared/util.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <sys/stat.h>\n#include <glib.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdbool.h>\n#include <stdint.h>\n#include <errno.h>\n#include <config.h>\n\nstatic uint8_t att_check_reqs(struct gatt_channel *channel, uint8_t opcode,\n\t\t\t\t\t\t\t\tint reqs)\n{\n\t/* FIXME: currently, it is assumed an encrypted link is enough for\n\t * authentication. This will allow to enable the SMP negotiation once\n\t * it is on upstream kernel. High security level should be mapped\n\t * to authentication and medium to encryption permission. */\n\tif (!channel->encrypted)\n\t\tchannel->encrypted = g_attrib_is_encrypted(channel->attrib);\n\tif (reqs == ATT_AUTHENTICATION && !channel->encrypted)\n\t\treturn ATT_ECODE_AUTHENTICATION;\n\telse if (reqs == ATT_AUTHORIZATION)\n\t\treturn ATT_ECODE_AUTHORIZATION;\n\n\tswitch (opcode) {\n\tcase ATT_OP_READ_BY_GROUP_REQ:\n\tcase ATT_OP_READ_BY_TYPE_REQ:\n\tcase ATT_OP_READ_REQ:\n\tcase ATT_OP_READ_BLOB_REQ:\n\tcase ATT_OP_READ_MULTI_REQ:\n\t\tif (reqs == ATT_NOT_PERMITTED)\n\t\t\treturn ATT_ECODE_READ_NOT_PERM;\n\t\tbreak;\n\tcase ATT_OP_PREP_WRITE_REQ:\n\tcase ATT_OP_WRITE_REQ:\n\tcase ATT_OP_WRITE_CMD:\n\t\tif (reqs == ATT_NOT_PERMITTED)\n\t\t\treturn ATT_ECODE_WRITE_NOT_PERM;\n\t\tbreak;\n\t}\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "enc_read_blob_resp",
          "args": [
            "config",
            "sizeof(config)",
            "offset",
            "pdu",
            "len"
          ],
          "line": 860
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "put_le16",
          "args": [
            "cccval",
            "config"
          ],
          "line": 859
        },
        "resolved": true,
        "details": {
          "function_name": "put_le16",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/util.h",
          "lines": "159-162",
          "snippet": "static inline void put_le16(uint16_t val, void *dst)\n{\n\tput_unaligned(cpu_to_le16(val), (uint16_t *) dst);\n}",
          "includes": [
            "#include <string.h>",
            "#include <byteswap.h>",
            "#include <alloca.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <byteswap.h>\n#include <alloca.h>\n#include <stdlib.h>\n#include <stdint.h>\n\nstatic inline void put_le16(uint16_t val, void *dst)\n{\n\tput_unaligned(cpu_to_le16(val), (uint16_t *) dst);\n}"
        }
      },
      {
        "call_info": {
          "callee": "read_device_ccc",
          "args": [
            "channel->device",
            "handle",
            "&cccval"
          ],
          "line": 856
        },
        "resolved": true,
        "details": {
          "function_name": "read_device_ccc",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/attrib-server.c",
          "lines": "763-795",
          "snippet": "static int read_device_ccc(struct btd_device *device, uint16_t handle,\n\t\t\t\tuint16_t *value)\n{\n\tchar *filename;\n\tGKeyFile *key_file;\n\tchar group[6];\n\tchar *str;\n\tunsigned int config;\n\tint err = 0;\n\n\tfilename = btd_device_get_storage_path(device, \"ccc\");\n\tif (!filename) {\n\t\twarn(\"Unable to get ccc storage path for device\");\n\t\treturn -ENOENT;\n\t}\n\n\tkey_file = g_key_file_new();\n\tg_key_file_load_from_file(key_file, filename, 0, NULL);\n\n\tsprintf(group, \"%hu\", handle);\n\n\tstr = g_key_file_get_string(key_file, group, \"Value\", NULL);\n\tif (!str || sscanf(str, \"%04X\", &config) != 1)\n\t\terr = -ENOENT;\n\telse\n\t\t*value = config;\n\n\tg_free(str);\n\tg_free(filename);\n\tg_key_file_free(key_file);\n\n\treturn err;\n}",
          "includes": [
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"attrib/att-database.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"backtrace.h\"",
            "#include \"log.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <sys/stat.h>",
            "#include <glib.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdbool.h>",
            "#include <stdint.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"attrib/att-database.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"src/shared/util.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <sys/stat.h>\n#include <glib.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdbool.h>\n#include <stdint.h>\n#include <errno.h>\n#include <config.h>\n\nstatic int read_device_ccc(struct btd_device *device, uint16_t handle,\n\t\t\t\tuint16_t *value)\n{\n\tchar *filename;\n\tGKeyFile *key_file;\n\tchar group[6];\n\tchar *str;\n\tunsigned int config;\n\tint err = 0;\n\n\tfilename = btd_device_get_storage_path(device, \"ccc\");\n\tif (!filename) {\n\t\twarn(\"Unable to get ccc storage path for device\");\n\t\treturn -ENOENT;\n\t}\n\n\tkey_file = g_key_file_new();\n\tg_key_file_load_from_file(key_file, filename, 0, NULL);\n\n\tsprintf(group, \"%hu\", handle);\n\n\tstr = g_key_file_get_string(key_file, group, \"Value\", NULL);\n\tif (!str || sscanf(str, \"%04X\", &config) != 1)\n\t\terr = -ENOENT;\n\telse\n\t\t*value = config;\n\n\tg_free(str);\n\tg_free(filename);\n\tg_key_file_free(key_file);\n\n\treturn err;\n}"
        }
      },
      {
        "call_info": {
          "callee": "bt_uuid_cmp",
          "args": [
            "&ccc_uuid",
            "&a->uuid"
          ],
          "line": 855
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "enc_error_resp",
          "args": [
            "ATT_OP_READ_BLOB_REQ",
            "handle",
            "ATT_ECODE_INVALID_OFFSET",
            "pdu",
            "len"
          ],
          "line": 852
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "enc_error_resp",
          "args": [
            "ATT_OP_READ_BLOB_REQ",
            "handle",
            "ATT_ECODE_INVALID_HANDLE",
            "pdu",
            "len"
          ],
          "line": 846
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_list_find_custom",
          "args": [
            "channel->server->database",
            "GUINT_TO_POINTER(h)",
            "handle_cmp"
          ],
          "line": 843
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "GUINT_TO_POINTER",
          "args": [
            "h"
          ],
          "line": 844
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"attrib/att-database.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"src/shared/util.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <sys/stat.h>\n#include <glib.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdbool.h>\n#include <stdint.h>\n#include <errno.h>\n#include <config.h>\n\nstatic bt_uuid_t ccc_uuid = {\n\t\t\t.type = BT_UUID16,\n\t\t\t.value.u16 = GATT_CLIENT_CHARAC_CFG_UUID\n};\n\nstatic uint16_t read_blob(struct gatt_channel *channel, uint16_t handle,\n\t\t\t\tuint16_t offset, uint8_t *pdu, size_t len)\n{\n\tstruct attribute *a;\n\tuint8_t status;\n\tGList *l;\n\tuint16_t cccval;\n\tguint h = handle;\n\n\tl = g_list_find_custom(channel->server->database,\n\t\t\t\t\tGUINT_TO_POINTER(h), handle_cmp);\n\tif (!l)\n\t\treturn enc_error_resp(ATT_OP_READ_BLOB_REQ, handle,\n\t\t\t\t\tATT_ECODE_INVALID_HANDLE, pdu, len);\n\n\ta = l->data;\n\n\tif (a->len < offset)\n\t\treturn enc_error_resp(ATT_OP_READ_BLOB_REQ, handle,\n\t\t\t\t\tATT_ECODE_INVALID_OFFSET, pdu, len);\n\n\tif (bt_uuid_cmp(&ccc_uuid, &a->uuid) == 0 &&\n\t\tread_device_ccc(channel->device, handle, &cccval) == 0) {\n\t\tuint8_t config[2];\n\n\t\tput_le16(cccval, config);\n\t\treturn enc_read_blob_resp(config, sizeof(config), offset,\n\t\t\t\t\t\t\t\tpdu, len);\n\t}\n\n\tstatus = att_check_reqs(channel, ATT_OP_READ_BLOB_REQ, a->read_req);\n\n\tif (status == 0x00 && a->read_cb)\n\t\tstatus = a->read_cb(a, channel->device, a->cb_user_data);\n\n\tif (status)\n\t\treturn enc_error_resp(ATT_OP_READ_BLOB_REQ, handle, status,\n\t\t\t\t\t\t\t\tpdu, len);\n\n\treturn enc_read_blob_resp(a->data, a->len, offset, pdu, len);\n}"
  },
  {
    "function_name": "read_value",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/attrib-server.c",
    "lines": "797-832",
    "snippet": "static uint16_t read_value(struct gatt_channel *channel, uint16_t handle,\n\t\t\t\t\t\tuint8_t *pdu, size_t len)\n{\n\tstruct attribute *a;\n\tuint8_t status;\n\tGList *l;\n\tuint16_t cccval;\n\tguint h = handle;\n\n\tl = g_list_find_custom(channel->server->database,\n\t\t\t\t\tGUINT_TO_POINTER(h), handle_cmp);\n\tif (!l)\n\t\treturn enc_error_resp(ATT_OP_READ_REQ, handle,\n\t\t\t\t\tATT_ECODE_INVALID_HANDLE, pdu, len);\n\n\ta = l->data;\n\n\tif (bt_uuid_cmp(&ccc_uuid, &a->uuid) == 0 &&\n\t\tread_device_ccc(channel->device, handle, &cccval) == 0) {\n\t\tuint8_t config[2];\n\n\t\tput_le16(cccval, config);\n\t\treturn enc_read_resp(config, sizeof(config), pdu, len);\n\t}\n\n\tstatus = att_check_reqs(channel, ATT_OP_READ_REQ, a->read_req);\n\n\tif (status == 0x00 && a->read_cb)\n\t\tstatus = a->read_cb(a, channel->device, a->cb_user_data);\n\n\tif (status)\n\t\treturn enc_error_resp(ATT_OP_READ_REQ, handle, status, pdu,\n\t\t\t\t\t\t\t\t\tlen);\n\n\treturn enc_read_resp(a->data, a->len, pdu, len);\n}",
    "includes": [
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"attrib/att-database.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"attrib/att.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"backtrace.h\"",
      "#include \"log.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <sys/stat.h>",
      "#include <glib.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdbool.h>",
      "#include <stdint.h>",
      "#include <errno.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static bt_uuid_t ccc_uuid = {\n\t\t\t.type = BT_UUID16,\n\t\t\t.value.u16 = GATT_CLIENT_CHARAC_CFG_UUID\n};"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "enc_read_resp",
          "args": [
            "a->data",
            "a->len",
            "pdu",
            "len"
          ],
          "line": 831
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "enc_error_resp",
          "args": [
            "ATT_OP_READ_REQ",
            "handle",
            "status",
            "pdu",
            "len"
          ],
          "line": 828
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "a->read_cb",
          "args": [
            "a",
            "channel->device",
            "a->cb_user_data"
          ],
          "line": 825
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "att_check_reqs",
          "args": [
            "channel",
            "ATT_OP_READ_REQ",
            "a->read_req"
          ],
          "line": 822
        },
        "resolved": true,
        "details": {
          "function_name": "att_check_reqs",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/attrib-server.c",
          "lines": "379-411",
          "snippet": "static uint8_t att_check_reqs(struct gatt_channel *channel, uint8_t opcode,\n\t\t\t\t\t\t\t\tint reqs)\n{\n\t/* FIXME: currently, it is assumed an encrypted link is enough for\n\t * authentication. This will allow to enable the SMP negotiation once\n\t * it is on upstream kernel. High security level should be mapped\n\t * to authentication and medium to encryption permission. */\n\tif (!channel->encrypted)\n\t\tchannel->encrypted = g_attrib_is_encrypted(channel->attrib);\n\tif (reqs == ATT_AUTHENTICATION && !channel->encrypted)\n\t\treturn ATT_ECODE_AUTHENTICATION;\n\telse if (reqs == ATT_AUTHORIZATION)\n\t\treturn ATT_ECODE_AUTHORIZATION;\n\n\tswitch (opcode) {\n\tcase ATT_OP_READ_BY_GROUP_REQ:\n\tcase ATT_OP_READ_BY_TYPE_REQ:\n\tcase ATT_OP_READ_REQ:\n\tcase ATT_OP_READ_BLOB_REQ:\n\tcase ATT_OP_READ_MULTI_REQ:\n\t\tif (reqs == ATT_NOT_PERMITTED)\n\t\t\treturn ATT_ECODE_READ_NOT_PERM;\n\t\tbreak;\n\tcase ATT_OP_PREP_WRITE_REQ:\n\tcase ATT_OP_WRITE_REQ:\n\tcase ATT_OP_WRITE_CMD:\n\t\tif (reqs == ATT_NOT_PERMITTED)\n\t\t\treturn ATT_ECODE_WRITE_NOT_PERM;\n\t\tbreak;\n\t}\n\n\treturn 0;\n}",
          "includes": [
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"attrib/att-database.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"backtrace.h\"",
            "#include \"log.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <sys/stat.h>",
            "#include <glib.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdbool.h>",
            "#include <stdint.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"attrib/att-database.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"src/shared/util.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <sys/stat.h>\n#include <glib.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdbool.h>\n#include <stdint.h>\n#include <errno.h>\n#include <config.h>\n\nstatic uint8_t att_check_reqs(struct gatt_channel *channel, uint8_t opcode,\n\t\t\t\t\t\t\t\tint reqs)\n{\n\t/* FIXME: currently, it is assumed an encrypted link is enough for\n\t * authentication. This will allow to enable the SMP negotiation once\n\t * it is on upstream kernel. High security level should be mapped\n\t * to authentication and medium to encryption permission. */\n\tif (!channel->encrypted)\n\t\tchannel->encrypted = g_attrib_is_encrypted(channel->attrib);\n\tif (reqs == ATT_AUTHENTICATION && !channel->encrypted)\n\t\treturn ATT_ECODE_AUTHENTICATION;\n\telse if (reqs == ATT_AUTHORIZATION)\n\t\treturn ATT_ECODE_AUTHORIZATION;\n\n\tswitch (opcode) {\n\tcase ATT_OP_READ_BY_GROUP_REQ:\n\tcase ATT_OP_READ_BY_TYPE_REQ:\n\tcase ATT_OP_READ_REQ:\n\tcase ATT_OP_READ_BLOB_REQ:\n\tcase ATT_OP_READ_MULTI_REQ:\n\t\tif (reqs == ATT_NOT_PERMITTED)\n\t\t\treturn ATT_ECODE_READ_NOT_PERM;\n\t\tbreak;\n\tcase ATT_OP_PREP_WRITE_REQ:\n\tcase ATT_OP_WRITE_REQ:\n\tcase ATT_OP_WRITE_CMD:\n\t\tif (reqs == ATT_NOT_PERMITTED)\n\t\t\treturn ATT_ECODE_WRITE_NOT_PERM;\n\t\tbreak;\n\t}\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "enc_read_resp",
          "args": [
            "config",
            "sizeof(config)",
            "pdu",
            "len"
          ],
          "line": 819
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "put_le16",
          "args": [
            "cccval",
            "config"
          ],
          "line": 818
        },
        "resolved": true,
        "details": {
          "function_name": "put_le16",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/util.h",
          "lines": "159-162",
          "snippet": "static inline void put_le16(uint16_t val, void *dst)\n{\n\tput_unaligned(cpu_to_le16(val), (uint16_t *) dst);\n}",
          "includes": [
            "#include <string.h>",
            "#include <byteswap.h>",
            "#include <alloca.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <byteswap.h>\n#include <alloca.h>\n#include <stdlib.h>\n#include <stdint.h>\n\nstatic inline void put_le16(uint16_t val, void *dst)\n{\n\tput_unaligned(cpu_to_le16(val), (uint16_t *) dst);\n}"
        }
      },
      {
        "call_info": {
          "callee": "read_device_ccc",
          "args": [
            "channel->device",
            "handle",
            "&cccval"
          ],
          "line": 815
        },
        "resolved": true,
        "details": {
          "function_name": "read_device_ccc",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/attrib-server.c",
          "lines": "763-795",
          "snippet": "static int read_device_ccc(struct btd_device *device, uint16_t handle,\n\t\t\t\tuint16_t *value)\n{\n\tchar *filename;\n\tGKeyFile *key_file;\n\tchar group[6];\n\tchar *str;\n\tunsigned int config;\n\tint err = 0;\n\n\tfilename = btd_device_get_storage_path(device, \"ccc\");\n\tif (!filename) {\n\t\twarn(\"Unable to get ccc storage path for device\");\n\t\treturn -ENOENT;\n\t}\n\n\tkey_file = g_key_file_new();\n\tg_key_file_load_from_file(key_file, filename, 0, NULL);\n\n\tsprintf(group, \"%hu\", handle);\n\n\tstr = g_key_file_get_string(key_file, group, \"Value\", NULL);\n\tif (!str || sscanf(str, \"%04X\", &config) != 1)\n\t\terr = -ENOENT;\n\telse\n\t\t*value = config;\n\n\tg_free(str);\n\tg_free(filename);\n\tg_key_file_free(key_file);\n\n\treturn err;\n}",
          "includes": [
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"attrib/att-database.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"backtrace.h\"",
            "#include \"log.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <sys/stat.h>",
            "#include <glib.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdbool.h>",
            "#include <stdint.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"attrib/att-database.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"src/shared/util.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <sys/stat.h>\n#include <glib.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdbool.h>\n#include <stdint.h>\n#include <errno.h>\n#include <config.h>\n\nstatic int read_device_ccc(struct btd_device *device, uint16_t handle,\n\t\t\t\tuint16_t *value)\n{\n\tchar *filename;\n\tGKeyFile *key_file;\n\tchar group[6];\n\tchar *str;\n\tunsigned int config;\n\tint err = 0;\n\n\tfilename = btd_device_get_storage_path(device, \"ccc\");\n\tif (!filename) {\n\t\twarn(\"Unable to get ccc storage path for device\");\n\t\treturn -ENOENT;\n\t}\n\n\tkey_file = g_key_file_new();\n\tg_key_file_load_from_file(key_file, filename, 0, NULL);\n\n\tsprintf(group, \"%hu\", handle);\n\n\tstr = g_key_file_get_string(key_file, group, \"Value\", NULL);\n\tif (!str || sscanf(str, \"%04X\", &config) != 1)\n\t\terr = -ENOENT;\n\telse\n\t\t*value = config;\n\n\tg_free(str);\n\tg_free(filename);\n\tg_key_file_free(key_file);\n\n\treturn err;\n}"
        }
      },
      {
        "call_info": {
          "callee": "bt_uuid_cmp",
          "args": [
            "&ccc_uuid",
            "&a->uuid"
          ],
          "line": 814
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "enc_error_resp",
          "args": [
            "ATT_OP_READ_REQ",
            "handle",
            "ATT_ECODE_INVALID_HANDLE",
            "pdu",
            "len"
          ],
          "line": 809
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_list_find_custom",
          "args": [
            "channel->server->database",
            "GUINT_TO_POINTER(h)",
            "handle_cmp"
          ],
          "line": 806
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "GUINT_TO_POINTER",
          "args": [
            "h"
          ],
          "line": 807
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"attrib/att-database.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"src/shared/util.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <sys/stat.h>\n#include <glib.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdbool.h>\n#include <stdint.h>\n#include <errno.h>\n#include <config.h>\n\nstatic bt_uuid_t ccc_uuid = {\n\t\t\t.type = BT_UUID16,\n\t\t\t.value.u16 = GATT_CLIENT_CHARAC_CFG_UUID\n};\n\nstatic uint16_t read_value(struct gatt_channel *channel, uint16_t handle,\n\t\t\t\t\t\tuint8_t *pdu, size_t len)\n{\n\tstruct attribute *a;\n\tuint8_t status;\n\tGList *l;\n\tuint16_t cccval;\n\tguint h = handle;\n\n\tl = g_list_find_custom(channel->server->database,\n\t\t\t\t\tGUINT_TO_POINTER(h), handle_cmp);\n\tif (!l)\n\t\treturn enc_error_resp(ATT_OP_READ_REQ, handle,\n\t\t\t\t\tATT_ECODE_INVALID_HANDLE, pdu, len);\n\n\ta = l->data;\n\n\tif (bt_uuid_cmp(&ccc_uuid, &a->uuid) == 0 &&\n\t\tread_device_ccc(channel->device, handle, &cccval) == 0) {\n\t\tuint8_t config[2];\n\n\t\tput_le16(cccval, config);\n\t\treturn enc_read_resp(config, sizeof(config), pdu, len);\n\t}\n\n\tstatus = att_check_reqs(channel, ATT_OP_READ_REQ, a->read_req);\n\n\tif (status == 0x00 && a->read_cb)\n\t\tstatus = a->read_cb(a, channel->device, a->cb_user_data);\n\n\tif (status)\n\t\treturn enc_error_resp(ATT_OP_READ_REQ, handle, status, pdu,\n\t\t\t\t\t\t\t\t\tlen);\n\n\treturn enc_read_resp(a->data, a->len, pdu, len);\n}"
  },
  {
    "function_name": "read_device_ccc",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/attrib-server.c",
    "lines": "763-795",
    "snippet": "static int read_device_ccc(struct btd_device *device, uint16_t handle,\n\t\t\t\tuint16_t *value)\n{\n\tchar *filename;\n\tGKeyFile *key_file;\n\tchar group[6];\n\tchar *str;\n\tunsigned int config;\n\tint err = 0;\n\n\tfilename = btd_device_get_storage_path(device, \"ccc\");\n\tif (!filename) {\n\t\twarn(\"Unable to get ccc storage path for device\");\n\t\treturn -ENOENT;\n\t}\n\n\tkey_file = g_key_file_new();\n\tg_key_file_load_from_file(key_file, filename, 0, NULL);\n\n\tsprintf(group, \"%hu\", handle);\n\n\tstr = g_key_file_get_string(key_file, group, \"Value\", NULL);\n\tif (!str || sscanf(str, \"%04X\", &config) != 1)\n\t\terr = -ENOENT;\n\telse\n\t\t*value = config;\n\n\tg_free(str);\n\tg_free(filename);\n\tg_key_file_free(key_file);\n\n\treturn err;\n}",
    "includes": [
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"attrib/att-database.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"attrib/att.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"backtrace.h\"",
      "#include \"log.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <sys/stat.h>",
      "#include <glib.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdbool.h>",
      "#include <stdint.h>",
      "#include <errno.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_key_file_free",
          "args": [
            "key_file"
          ],
          "line": 792
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_free",
          "args": [
            "filename"
          ],
          "line": 791
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_free",
          "args": [
            "str"
          ],
          "line": 790
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sscanf",
          "args": [
            "str",
            "\"%04X\"",
            "&config"
          ],
          "line": 785
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_key_file_get_string",
          "args": [
            "key_file",
            "group",
            "\"Value\"",
            "NULL"
          ],
          "line": 784
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sprintf",
          "args": [
            "group",
            "\"%hu\"",
            "handle"
          ],
          "line": 782
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_key_file_load_from_file",
          "args": [
            "key_file",
            "filename",
            "0",
            "NULL"
          ],
          "line": 780
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_key_file_new",
          "args": [],
          "line": 779
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "warn",
          "args": [
            "\"Unable to get ccc storage path for device\""
          ],
          "line": 775
        },
        "resolved": true,
        "details": {
          "function_name": "warn",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/log.c",
          "lines": "151-165",
          "snippet": "void warn(const char *format, ...)\n{\n\tva_list ap;\n\n\tva_start(ap, format);\n\tvsyslog(LOG_WARNING, format, ap);\n\tva_end(ap);\n\n\tif (logging_fd < 0)\n\t\treturn;\n\n\tva_start(ap, format);\n\tlogging_log(HCI_DEV_NONE, LOG_WARNING, format, ap);\n\tva_end(ap);\n}",
          "includes": [
            "#include \"log.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/hci.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <sys/socket.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <stdarg.h>",
            "#include <syslog.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int logging_fd = -1;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n#include \"src/shared/util.h\"\n#include \"lib/hci.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <sys/socket.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdarg.h>\n#include <syslog.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic int logging_fd = -1;\n\nvoid warn(const char *format, ...)\n{\n\tva_list ap;\n\n\tva_start(ap, format);\n\tvsyslog(LOG_WARNING, format, ap);\n\tva_end(ap);\n\n\tif (logging_fd < 0)\n\t\treturn;\n\n\tva_start(ap, format);\n\tlogging_log(HCI_DEV_NONE, LOG_WARNING, format, ap);\n\tva_end(ap);\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_device_get_storage_path",
          "args": [
            "device",
            "\"ccc\""
          ],
          "line": 773
        },
        "resolved": true,
        "details": {
          "function_name": "btd_device_get_storage_path",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "3867-3888",
          "snippet": "char *btd_device_get_storage_path(struct btd_device *device,\n\t\t\t\tconst char *filename)\n{\n\tchar dstaddr[18];\n\n\tif (device_address_is_private(device)) {\n\t\twarn(\"Refusing storage path for private addressed device %s\",\n\t\t\t\t\t\t\t\tdevice->path);\n\t\treturn NULL;\n\t}\n\n\tba2str(&device->bdaddr, dstaddr);\n\n\tif (!filename)\n\t\treturn g_strdup_printf(STORAGEDIR \"/%s/%s\",\n\t\t\t\tbtd_adapter_get_storage_dir(device->adapter),\n\t\t\t\tdstaddr);\n\n\treturn g_strdup_printf(STORAGEDIR \"/%s/%s/%s\",\n\t\t\t\tbtd_adapter_get_storage_dir(device->adapter),\n\t\t\t\tdstaddr, filename);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nchar *btd_device_get_storage_path(struct btd_device *device,\n\t\t\t\tconst char *filename)\n{\n\tchar dstaddr[18];\n\n\tif (device_address_is_private(device)) {\n\t\twarn(\"Refusing storage path for private addressed device %s\",\n\t\t\t\t\t\t\t\tdevice->path);\n\t\treturn NULL;\n\t}\n\n\tba2str(&device->bdaddr, dstaddr);\n\n\tif (!filename)\n\t\treturn g_strdup_printf(STORAGEDIR \"/%s/%s\",\n\t\t\t\tbtd_adapter_get_storage_dir(device->adapter),\n\t\t\t\tdstaddr);\n\n\treturn g_strdup_printf(STORAGEDIR \"/%s/%s/%s\",\n\t\t\t\tbtd_adapter_get_storage_dir(device->adapter),\n\t\t\t\tdstaddr, filename);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"attrib/att-database.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"src/shared/util.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <sys/stat.h>\n#include <glib.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdbool.h>\n#include <stdint.h>\n#include <errno.h>\n#include <config.h>\n\nstatic int read_device_ccc(struct btd_device *device, uint16_t handle,\n\t\t\t\tuint16_t *value)\n{\n\tchar *filename;\n\tGKeyFile *key_file;\n\tchar group[6];\n\tchar *str;\n\tunsigned int config;\n\tint err = 0;\n\n\tfilename = btd_device_get_storage_path(device, \"ccc\");\n\tif (!filename) {\n\t\twarn(\"Unable to get ccc storage path for device\");\n\t\treturn -ENOENT;\n\t}\n\n\tkey_file = g_key_file_new();\n\tg_key_file_load_from_file(key_file, filename, 0, NULL);\n\n\tsprintf(group, \"%hu\", handle);\n\n\tstr = g_key_file_get_string(key_file, group, \"Value\", NULL);\n\tif (!str || sscanf(str, \"%04X\", &config) != 1)\n\t\terr = -ENOENT;\n\telse\n\t\t*value = config;\n\n\tg_free(str);\n\tg_free(filename);\n\tg_key_file_free(key_file);\n\n\treturn err;\n}"
  },
  {
    "function_name": "find_by_type",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/attrib-server.c",
    "lines": "703-761",
    "snippet": "static uint16_t find_by_type(struct gatt_channel *channel, uint16_t start,\n\t\t\t\tuint16_t end, bt_uuid_t *uuid,\n\t\t\t\tconst uint8_t *value, size_t vlen,\n\t\t\t\tuint8_t *opdu, size_t mtu)\n{\n\tstruct attribute *a;\n\tstruct att_range *range;\n\tGSList *matches;\n\tGList *dl, *database;\n\tuint16_t len;\n\n\tif (start > end || start == 0x0000)\n\t\treturn enc_error_resp(ATT_OP_FIND_BY_TYPE_REQ, start,\n\t\t\t\t\tATT_ECODE_INVALID_HANDLE, opdu, mtu);\n\n\t/* Searching first requested handle number */\n\tdatabase = channel->server->database;\n\tfor (dl = database, matches = NULL, range = NULL; dl; dl = dl->next) {\n\t\ta = dl->data;\n\n\t\tif (a->handle < start)\n\t\t\tcontinue;\n\n\t\tif (a->handle > end)\n\t\t\tbreak;\n\n\t\t/* Primary service? Attribute value matches? */\n\t\tif ((bt_uuid_cmp(&a->uuid, uuid) == 0) && (a->len == vlen) &&\n\t\t\t\t\t(memcmp(a->data, value, vlen) == 0)) {\n\n\t\t\trange = g_new0(struct att_range, 1);\n\t\t\trange->start = a->handle;\n\t\t\t/* It is allowed to have end group handle the same as\n\t\t\t * start handle, for groups with only one attribute. */\n\t\t\trange->end = a->handle;\n\n\t\t\tmatches = g_slist_append(matches, range);\n\t\t} else if (range) {\n\t\t\t/* Update the last found handle or reset the pointer\n\t\t\t * to track that a new group started: Primary or\n\t\t\t * Secondary service. */\n\t\t\tif (bt_uuid_cmp(&a->uuid, &prim_uuid) == 0 ||\n\t\t\t\t\tbt_uuid_cmp(&a->uuid, &snd_uuid) == 0)\n\t\t\t\trange = NULL;\n\t\t\telse\n\t\t\t\trange->end = a->handle;\n\t\t}\n\t}\n\n\tif (matches == NULL)\n\t\treturn enc_error_resp(ATT_OP_FIND_BY_TYPE_REQ, start,\n\t\t\t\tATT_ECODE_ATTR_NOT_FOUND, opdu, mtu);\n\n\tlen = enc_find_by_type_resp(matches, opdu, mtu);\n\n\tg_slist_free_full(matches, g_free);\n\n\treturn len;\n}",
    "includes": [
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"attrib/att-database.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"attrib/att.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"backtrace.h\"",
      "#include \"log.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <sys/stat.h>",
      "#include <glib.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdbool.h>",
      "#include <stdint.h>",
      "#include <errno.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static bt_uuid_t prim_uuid = {\n\t\t\t.type = BT_UUID16,\n\t\t\t.value.u16 = GATT_PRIM_SVC_UUID\n};",
      "static bt_uuid_t snd_uuid = {\n\t\t\t.type = BT_UUID16,\n\t\t\t.value.u16 = GATT_SND_SVC_UUID\n};"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_slist_free_full",
          "args": [
            "matches",
            "g_free"
          ],
          "line": 758
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "enc_find_by_type_resp",
          "args": [
            "matches",
            "opdu",
            "mtu"
          ],
          "line": 756
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "enc_error_resp",
          "args": [
            "ATT_OP_FIND_BY_TYPE_REQ",
            "start",
            "ATT_ECODE_ATTR_NOT_FOUND",
            "opdu",
            "mtu"
          ],
          "line": 753
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bt_uuid_cmp",
          "args": [
            "&a->uuid",
            "&snd_uuid"
          ],
          "line": 745
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bt_uuid_cmp",
          "args": [
            "&a->uuid",
            "&prim_uuid"
          ],
          "line": 744
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_slist_append",
          "args": [
            "matches",
            "range"
          ],
          "line": 739
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_new0",
          "args": [
            "structatt_range",
            "1"
          ],
          "line": 733
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memcmp",
          "args": [
            "a->data",
            "value",
            "vlen"
          ],
          "line": 731
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bt_uuid_cmp",
          "args": [
            "&a->uuid",
            "uuid"
          ],
          "line": 730
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "enc_error_resp",
          "args": [
            "ATT_OP_FIND_BY_TYPE_REQ",
            "start",
            "ATT_ECODE_INVALID_HANDLE",
            "opdu",
            "mtu"
          ],
          "line": 715
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"attrib/att-database.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"src/shared/util.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <sys/stat.h>\n#include <glib.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdbool.h>\n#include <stdint.h>\n#include <errno.h>\n#include <config.h>\n\nstatic bt_uuid_t prim_uuid = {\n\t\t\t.type = BT_UUID16,\n\t\t\t.value.u16 = GATT_PRIM_SVC_UUID\n};\nstatic bt_uuid_t snd_uuid = {\n\t\t\t.type = BT_UUID16,\n\t\t\t.value.u16 = GATT_SND_SVC_UUID\n};\n\nstatic uint16_t find_by_type(struct gatt_channel *channel, uint16_t start,\n\t\t\t\tuint16_t end, bt_uuid_t *uuid,\n\t\t\t\tconst uint8_t *value, size_t vlen,\n\t\t\t\tuint8_t *opdu, size_t mtu)\n{\n\tstruct attribute *a;\n\tstruct att_range *range;\n\tGSList *matches;\n\tGList *dl, *database;\n\tuint16_t len;\n\n\tif (start > end || start == 0x0000)\n\t\treturn enc_error_resp(ATT_OP_FIND_BY_TYPE_REQ, start,\n\t\t\t\t\tATT_ECODE_INVALID_HANDLE, opdu, mtu);\n\n\t/* Searching first requested handle number */\n\tdatabase = channel->server->database;\n\tfor (dl = database, matches = NULL, range = NULL; dl; dl = dl->next) {\n\t\ta = dl->data;\n\n\t\tif (a->handle < start)\n\t\t\tcontinue;\n\n\t\tif (a->handle > end)\n\t\t\tbreak;\n\n\t\t/* Primary service? Attribute value matches? */\n\t\tif ((bt_uuid_cmp(&a->uuid, uuid) == 0) && (a->len == vlen) &&\n\t\t\t\t\t(memcmp(a->data, value, vlen) == 0)) {\n\n\t\t\trange = g_new0(struct att_range, 1);\n\t\t\trange->start = a->handle;\n\t\t\t/* It is allowed to have end group handle the same as\n\t\t\t * start handle, for groups with only one attribute. */\n\t\t\trange->end = a->handle;\n\n\t\t\tmatches = g_slist_append(matches, range);\n\t\t} else if (range) {\n\t\t\t/* Update the last found handle or reset the pointer\n\t\t\t * to track that a new group started: Primary or\n\t\t\t * Secondary service. */\n\t\t\tif (bt_uuid_cmp(&a->uuid, &prim_uuid) == 0 ||\n\t\t\t\t\tbt_uuid_cmp(&a->uuid, &snd_uuid) == 0)\n\t\t\t\trange = NULL;\n\t\t\telse\n\t\t\t\trange->end = a->handle;\n\t\t}\n\t}\n\n\tif (matches == NULL)\n\t\treturn enc_error_resp(ATT_OP_FIND_BY_TYPE_REQ, start,\n\t\t\t\tATT_ECODE_ATTR_NOT_FOUND, opdu, mtu);\n\n\tlen = enc_find_by_type_resp(matches, opdu, mtu);\n\n\tg_slist_free_full(matches, g_free);\n\n\treturn len;\n}"
  },
  {
    "function_name": "find_info",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/attrib-server.c",
    "lines": "623-701",
    "snippet": "static uint16_t find_info(struct gatt_channel *channel, uint16_t start,\n\t\t\t\tuint16_t end, uint8_t *pdu, size_t len)\n{\n\tstruct attribute *a;\n\tstruct att_data_list *adl;\n\tGSList *l, *info;\n\tGList *dl, *database;\n\tuint8_t format, last_type = BT_UUID_UNSPEC;\n\tuint16_t length, num;\n\tint i;\n\n\tif (start > end || start == 0x0000)\n\t\treturn enc_error_resp(ATT_OP_FIND_INFO_REQ, start,\n\t\t\t\t\tATT_ECODE_INVALID_HANDLE, pdu, len);\n\n\tdatabase = channel->server->database;\n\tfor (dl = database, info = NULL, num = 0; dl; dl = dl->next) {\n\t\ta = dl->data;\n\n\t\tif (a->handle < start)\n\t\t\tcontinue;\n\n\t\tif (a->handle > end)\n\t\t\tbreak;\n\n\t\tif (last_type == BT_UUID_UNSPEC)\n\t\t\tlast_type = a->uuid.type;\n\n\t\tif (a->uuid.type != last_type)\n\t\t\tbreak;\n\n\t\tinfo = g_slist_append(info, a);\n\t\tnum++;\n\n\t\tlast_type = a->uuid.type;\n\t}\n\n\tif (info == NULL)\n\t\treturn enc_error_resp(ATT_OP_FIND_INFO_REQ, start,\n\t\t\t\t\tATT_ECODE_ATTR_NOT_FOUND, pdu, len);\n\n\tif (last_type == BT_UUID16) {\n\t\tlength = 2;\n\t\tformat = 0x01;\n\t} else if (last_type == BT_UUID128) {\n\t\tlength = 16;\n\t\tformat = 0x02;\n\t} else {\n\t\tg_slist_free(info);\n\t\treturn 0;\n\t}\n\n\tadl = att_data_list_alloc(num, length + 2);\n\tif (adl == NULL) {\n\t\tg_slist_free(info);\n\t\treturn enc_error_resp(ATT_OP_FIND_INFO_REQ, start,\n\t\t\t\t\tATT_ECODE_UNLIKELY, pdu, len);\n\t}\n\n\tfor (i = 0, l = info; l; i++, l = l->next) {\n\t\tuint8_t *value;\n\n\t\ta = l->data;\n\n\t\tvalue = (void *) adl->data[i];\n\n\t\tput_le16(a->handle, value);\n\n\t\t/* Attribute Value */\n\t\tbt_uuid_to_le(&a->uuid, &value[2]);\n\t}\n\n\tlength = enc_find_info_resp(format, adl, pdu, len);\n\n\tatt_data_list_free(adl);\n\tg_slist_free(info);\n\n\treturn length;\n}",
    "includes": [
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"attrib/att-database.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"attrib/att.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"backtrace.h\"",
      "#include \"log.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <sys/stat.h>",
      "#include <glib.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdbool.h>",
      "#include <stdint.h>",
      "#include <errno.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_slist_free",
          "args": [
            "info"
          ],
          "line": 698
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "att_data_list_free",
          "args": [
            "adl"
          ],
          "line": 697
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "enc_find_info_resp",
          "args": [
            "format",
            "adl",
            "pdu",
            "len"
          ],
          "line": 695
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bt_uuid_to_le",
          "args": [
            "&a->uuid",
            "&value[2]"
          ],
          "line": 692
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "put_le16",
          "args": [
            "a->handle",
            "value"
          ],
          "line": 689
        },
        "resolved": true,
        "details": {
          "function_name": "put_le16",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/util.h",
          "lines": "159-162",
          "snippet": "static inline void put_le16(uint16_t val, void *dst)\n{\n\tput_unaligned(cpu_to_le16(val), (uint16_t *) dst);\n}",
          "includes": [
            "#include <string.h>",
            "#include <byteswap.h>",
            "#include <alloca.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <byteswap.h>\n#include <alloca.h>\n#include <stdlib.h>\n#include <stdint.h>\n\nstatic inline void put_le16(uint16_t val, void *dst)\n{\n\tput_unaligned(cpu_to_le16(val), (uint16_t *) dst);\n}"
        }
      },
      {
        "call_info": {
          "callee": "enc_error_resp",
          "args": [
            "ATT_OP_FIND_INFO_REQ",
            "start",
            "ATT_ECODE_UNLIKELY",
            "pdu",
            "len"
          ],
          "line": 678
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_slist_free",
          "args": [
            "info"
          ],
          "line": 677
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "att_data_list_alloc",
          "args": [
            "num",
            "length + 2"
          ],
          "line": 675
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_slist_free",
          "args": [
            "info"
          ],
          "line": 671
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "enc_error_resp",
          "args": [
            "ATT_OP_FIND_INFO_REQ",
            "start",
            "ATT_ECODE_ATTR_NOT_FOUND",
            "pdu",
            "len"
          ],
          "line": 661
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_slist_append",
          "args": [
            "info",
            "a"
          ],
          "line": 654
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "enc_error_resp",
          "args": [
            "ATT_OP_FIND_INFO_REQ",
            "start",
            "ATT_ECODE_INVALID_HANDLE",
            "pdu",
            "len"
          ],
          "line": 635
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"attrib/att-database.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"src/shared/util.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <sys/stat.h>\n#include <glib.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdbool.h>\n#include <stdint.h>\n#include <errno.h>\n#include <config.h>\n\nstatic uint16_t find_info(struct gatt_channel *channel, uint16_t start,\n\t\t\t\tuint16_t end, uint8_t *pdu, size_t len)\n{\n\tstruct attribute *a;\n\tstruct att_data_list *adl;\n\tGSList *l, *info;\n\tGList *dl, *database;\n\tuint8_t format, last_type = BT_UUID_UNSPEC;\n\tuint16_t length, num;\n\tint i;\n\n\tif (start > end || start == 0x0000)\n\t\treturn enc_error_resp(ATT_OP_FIND_INFO_REQ, start,\n\t\t\t\t\tATT_ECODE_INVALID_HANDLE, pdu, len);\n\n\tdatabase = channel->server->database;\n\tfor (dl = database, info = NULL, num = 0; dl; dl = dl->next) {\n\t\ta = dl->data;\n\n\t\tif (a->handle < start)\n\t\t\tcontinue;\n\n\t\tif (a->handle > end)\n\t\t\tbreak;\n\n\t\tif (last_type == BT_UUID_UNSPEC)\n\t\t\tlast_type = a->uuid.type;\n\n\t\tif (a->uuid.type != last_type)\n\t\t\tbreak;\n\n\t\tinfo = g_slist_append(info, a);\n\t\tnum++;\n\n\t\tlast_type = a->uuid.type;\n\t}\n\n\tif (info == NULL)\n\t\treturn enc_error_resp(ATT_OP_FIND_INFO_REQ, start,\n\t\t\t\t\tATT_ECODE_ATTR_NOT_FOUND, pdu, len);\n\n\tif (last_type == BT_UUID16) {\n\t\tlength = 2;\n\t\tformat = 0x01;\n\t} else if (last_type == BT_UUID128) {\n\t\tlength = 16;\n\t\tformat = 0x02;\n\t} else {\n\t\tg_slist_free(info);\n\t\treturn 0;\n\t}\n\n\tadl = att_data_list_alloc(num, length + 2);\n\tif (adl == NULL) {\n\t\tg_slist_free(info);\n\t\treturn enc_error_resp(ATT_OP_FIND_INFO_REQ, start,\n\t\t\t\t\tATT_ECODE_UNLIKELY, pdu, len);\n\t}\n\n\tfor (i = 0, l = info; l; i++, l = l->next) {\n\t\tuint8_t *value;\n\n\t\ta = l->data;\n\n\t\tvalue = (void *) adl->data[i];\n\n\t\tput_le16(a->handle, value);\n\n\t\t/* Attribute Value */\n\t\tbt_uuid_to_le(&a->uuid, &value[2]);\n\t}\n\n\tlength = enc_find_info_resp(format, adl, pdu, len);\n\n\tatt_data_list_free(adl);\n\tg_slist_free(info);\n\n\treturn length;\n}"
  },
  {
    "function_name": "read_by_type",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/attrib-server.c",
    "lines": "534-621",
    "snippet": "static uint16_t read_by_type(struct gatt_channel *channel, uint16_t start,\n\t\t\t\t\t\tuint16_t end, bt_uuid_t *uuid,\n\t\t\t\t\t\tuint8_t *pdu, size_t len)\n{\n\tstruct att_data_list *adl;\n\tGSList *l, *types;\n\tGList *dl, *database;\n\tstruct attribute *a;\n\tuint16_t num, length;\n\tuint8_t status;\n\tint i;\n\n\tif (start > end || start == 0x0000)\n\t\treturn enc_error_resp(ATT_OP_READ_BY_TYPE_REQ, start,\n\t\t\t\t\tATT_ECODE_INVALID_HANDLE, pdu, len);\n\n\tdatabase = channel->server->database;\n\tfor (dl = database, length = 0, types = NULL; dl; dl = dl->next) {\n\n\t\ta = dl->data;\n\n\t\tif (a->handle < start)\n\t\t\tcontinue;\n\n\t\tif (a->handle > end)\n\t\t\tbreak;\n\n\t\tif (bt_uuid_cmp(&a->uuid, uuid)  != 0)\n\t\t\tcontinue;\n\n\t\tstatus = att_check_reqs(channel, ATT_OP_READ_BY_TYPE_REQ,\n\t\t\t\t\t\t\t\ta->read_req);\n\n\t\tif (status == 0x00 && a->read_cb)\n\t\t\tstatus = a->read_cb(a, channel->device,\n\t\t\t\t\t\t\ta->cb_user_data);\n\n\t\tif (status) {\n\t\t\tg_slist_free(types);\n\t\t\treturn enc_error_resp(ATT_OP_READ_BY_TYPE_REQ,\n\t\t\t\t\t\ta->handle, status, pdu, len);\n\t\t}\n\n\t\t/* All elements must have the same length */\n\t\tif (length == 0)\n\t\t\tlength = a->len;\n\t\telse if (a->len != length)\n\t\t\tbreak;\n\n\t\ttypes = g_slist_append(types, a);\n\t}\n\n\tif (types == NULL)\n\t\treturn enc_error_resp(ATT_OP_READ_BY_TYPE_REQ, start,\n\t\t\t\t\tATT_ECODE_ATTR_NOT_FOUND, pdu, len);\n\n\tnum = g_slist_length(types);\n\n\t/* Handle length plus attribute value length */\n\tlength += 2;\n\n\tadl = att_data_list_alloc(num, length);\n\tif (adl == NULL) {\n\t\tg_slist_free(types);\n\t\treturn enc_error_resp(ATT_OP_READ_BY_TYPE_REQ, start,\n\t\t\t\t\tATT_ECODE_UNLIKELY, pdu, len);\n\t}\n\n\tfor (i = 0, l = types; l; i++, l = l->next) {\n\t\tuint8_t *value;\n\n\t\ta = l->data;\n\n\t\tvalue = (void *) adl->data[i];\n\n\t\tput_le16(a->handle, value);\n\n\t\t/* Attribute Value */\n\t\tmemcpy(&value[2], a->data, a->len);\n\t}\n\n\tlength = enc_read_by_type_resp(adl, pdu, len);\n\n\tatt_data_list_free(adl);\n\tg_slist_free(types);\n\n\treturn length;\n}",
    "includes": [
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"attrib/att-database.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"attrib/att.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"backtrace.h\"",
      "#include \"log.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <sys/stat.h>",
      "#include <glib.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdbool.h>",
      "#include <stdint.h>",
      "#include <errno.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_slist_free",
          "args": [
            "types"
          ],
          "line": 618
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "att_data_list_free",
          "args": [
            "adl"
          ],
          "line": 617
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "enc_read_by_type_resp",
          "args": [
            "adl",
            "pdu",
            "len"
          ],
          "line": 615
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memcpy",
          "args": [
            "&value[2]",
            "a->data",
            "a->len"
          ],
          "line": 612
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "put_le16",
          "args": [
            "a->handle",
            "value"
          ],
          "line": 609
        },
        "resolved": true,
        "details": {
          "function_name": "put_le16",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/util.h",
          "lines": "159-162",
          "snippet": "static inline void put_le16(uint16_t val, void *dst)\n{\n\tput_unaligned(cpu_to_le16(val), (uint16_t *) dst);\n}",
          "includes": [
            "#include <string.h>",
            "#include <byteswap.h>",
            "#include <alloca.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <byteswap.h>\n#include <alloca.h>\n#include <stdlib.h>\n#include <stdint.h>\n\nstatic inline void put_le16(uint16_t val, void *dst)\n{\n\tput_unaligned(cpu_to_le16(val), (uint16_t *) dst);\n}"
        }
      },
      {
        "call_info": {
          "callee": "enc_error_resp",
          "args": [
            "ATT_OP_READ_BY_TYPE_REQ",
            "start",
            "ATT_ECODE_UNLIKELY",
            "pdu",
            "len"
          ],
          "line": 598
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_slist_free",
          "args": [
            "types"
          ],
          "line": 597
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "att_data_list_alloc",
          "args": [
            "num",
            "length"
          ],
          "line": 595
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_slist_length",
          "args": [
            "types"
          ],
          "line": 590
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "enc_error_resp",
          "args": [
            "ATT_OP_READ_BY_TYPE_REQ",
            "start",
            "ATT_ECODE_ATTR_NOT_FOUND",
            "pdu",
            "len"
          ],
          "line": 587
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_slist_append",
          "args": [
            "types",
            "a"
          ],
          "line": 583
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "enc_error_resp",
          "args": [
            "ATT_OP_READ_BY_TYPE_REQ",
            "a->handle",
            "status",
            "pdu",
            "len"
          ],
          "line": 573
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_slist_free",
          "args": [
            "types"
          ],
          "line": 572
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "a->read_cb",
          "args": [
            "a",
            "channel->device",
            "a->cb_user_data"
          ],
          "line": 568
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "att_check_reqs",
          "args": [
            "channel",
            "ATT_OP_READ_BY_TYPE_REQ",
            "a->read_req"
          ],
          "line": 564
        },
        "resolved": true,
        "details": {
          "function_name": "att_check_reqs",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/attrib-server.c",
          "lines": "379-411",
          "snippet": "static uint8_t att_check_reqs(struct gatt_channel *channel, uint8_t opcode,\n\t\t\t\t\t\t\t\tint reqs)\n{\n\t/* FIXME: currently, it is assumed an encrypted link is enough for\n\t * authentication. This will allow to enable the SMP negotiation once\n\t * it is on upstream kernel. High security level should be mapped\n\t * to authentication and medium to encryption permission. */\n\tif (!channel->encrypted)\n\t\tchannel->encrypted = g_attrib_is_encrypted(channel->attrib);\n\tif (reqs == ATT_AUTHENTICATION && !channel->encrypted)\n\t\treturn ATT_ECODE_AUTHENTICATION;\n\telse if (reqs == ATT_AUTHORIZATION)\n\t\treturn ATT_ECODE_AUTHORIZATION;\n\n\tswitch (opcode) {\n\tcase ATT_OP_READ_BY_GROUP_REQ:\n\tcase ATT_OP_READ_BY_TYPE_REQ:\n\tcase ATT_OP_READ_REQ:\n\tcase ATT_OP_READ_BLOB_REQ:\n\tcase ATT_OP_READ_MULTI_REQ:\n\t\tif (reqs == ATT_NOT_PERMITTED)\n\t\t\treturn ATT_ECODE_READ_NOT_PERM;\n\t\tbreak;\n\tcase ATT_OP_PREP_WRITE_REQ:\n\tcase ATT_OP_WRITE_REQ:\n\tcase ATT_OP_WRITE_CMD:\n\t\tif (reqs == ATT_NOT_PERMITTED)\n\t\t\treturn ATT_ECODE_WRITE_NOT_PERM;\n\t\tbreak;\n\t}\n\n\treturn 0;\n}",
          "includes": [
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"attrib/att-database.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"backtrace.h\"",
            "#include \"log.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <sys/stat.h>",
            "#include <glib.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdbool.h>",
            "#include <stdint.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"attrib/att-database.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"src/shared/util.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <sys/stat.h>\n#include <glib.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdbool.h>\n#include <stdint.h>\n#include <errno.h>\n#include <config.h>\n\nstatic uint8_t att_check_reqs(struct gatt_channel *channel, uint8_t opcode,\n\t\t\t\t\t\t\t\tint reqs)\n{\n\t/* FIXME: currently, it is assumed an encrypted link is enough for\n\t * authentication. This will allow to enable the SMP negotiation once\n\t * it is on upstream kernel. High security level should be mapped\n\t * to authentication and medium to encryption permission. */\n\tif (!channel->encrypted)\n\t\tchannel->encrypted = g_attrib_is_encrypted(channel->attrib);\n\tif (reqs == ATT_AUTHENTICATION && !channel->encrypted)\n\t\treturn ATT_ECODE_AUTHENTICATION;\n\telse if (reqs == ATT_AUTHORIZATION)\n\t\treturn ATT_ECODE_AUTHORIZATION;\n\n\tswitch (opcode) {\n\tcase ATT_OP_READ_BY_GROUP_REQ:\n\tcase ATT_OP_READ_BY_TYPE_REQ:\n\tcase ATT_OP_READ_REQ:\n\tcase ATT_OP_READ_BLOB_REQ:\n\tcase ATT_OP_READ_MULTI_REQ:\n\t\tif (reqs == ATT_NOT_PERMITTED)\n\t\t\treturn ATT_ECODE_READ_NOT_PERM;\n\t\tbreak;\n\tcase ATT_OP_PREP_WRITE_REQ:\n\tcase ATT_OP_WRITE_REQ:\n\tcase ATT_OP_WRITE_CMD:\n\t\tif (reqs == ATT_NOT_PERMITTED)\n\t\t\treturn ATT_ECODE_WRITE_NOT_PERM;\n\t\tbreak;\n\t}\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "bt_uuid_cmp",
          "args": [
            "&a->uuid",
            "uuid"
          ],
          "line": 561
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "enc_error_resp",
          "args": [
            "ATT_OP_READ_BY_TYPE_REQ",
            "start",
            "ATT_ECODE_INVALID_HANDLE",
            "pdu",
            "len"
          ],
          "line": 547
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"attrib/att-database.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"src/shared/util.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <sys/stat.h>\n#include <glib.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdbool.h>\n#include <stdint.h>\n#include <errno.h>\n#include <config.h>\n\nstatic uint16_t read_by_type(struct gatt_channel *channel, uint16_t start,\n\t\t\t\t\t\tuint16_t end, bt_uuid_t *uuid,\n\t\t\t\t\t\tuint8_t *pdu, size_t len)\n{\n\tstruct att_data_list *adl;\n\tGSList *l, *types;\n\tGList *dl, *database;\n\tstruct attribute *a;\n\tuint16_t num, length;\n\tuint8_t status;\n\tint i;\n\n\tif (start > end || start == 0x0000)\n\t\treturn enc_error_resp(ATT_OP_READ_BY_TYPE_REQ, start,\n\t\t\t\t\tATT_ECODE_INVALID_HANDLE, pdu, len);\n\n\tdatabase = channel->server->database;\n\tfor (dl = database, length = 0, types = NULL; dl; dl = dl->next) {\n\n\t\ta = dl->data;\n\n\t\tif (a->handle < start)\n\t\t\tcontinue;\n\n\t\tif (a->handle > end)\n\t\t\tbreak;\n\n\t\tif (bt_uuid_cmp(&a->uuid, uuid)  != 0)\n\t\t\tcontinue;\n\n\t\tstatus = att_check_reqs(channel, ATT_OP_READ_BY_TYPE_REQ,\n\t\t\t\t\t\t\t\ta->read_req);\n\n\t\tif (status == 0x00 && a->read_cb)\n\t\t\tstatus = a->read_cb(a, channel->device,\n\t\t\t\t\t\t\ta->cb_user_data);\n\n\t\tif (status) {\n\t\t\tg_slist_free(types);\n\t\t\treturn enc_error_resp(ATT_OP_READ_BY_TYPE_REQ,\n\t\t\t\t\t\ta->handle, status, pdu, len);\n\t\t}\n\n\t\t/* All elements must have the same length */\n\t\tif (length == 0)\n\t\t\tlength = a->len;\n\t\telse if (a->len != length)\n\t\t\tbreak;\n\n\t\ttypes = g_slist_append(types, a);\n\t}\n\n\tif (types == NULL)\n\t\treturn enc_error_resp(ATT_OP_READ_BY_TYPE_REQ, start,\n\t\t\t\t\tATT_ECODE_ATTR_NOT_FOUND, pdu, len);\n\n\tnum = g_slist_length(types);\n\n\t/* Handle length plus attribute value length */\n\tlength += 2;\n\n\tadl = att_data_list_alloc(num, length);\n\tif (adl == NULL) {\n\t\tg_slist_free(types);\n\t\treturn enc_error_resp(ATT_OP_READ_BY_TYPE_REQ, start,\n\t\t\t\t\tATT_ECODE_UNLIKELY, pdu, len);\n\t}\n\n\tfor (i = 0, l = types; l; i++, l = l->next) {\n\t\tuint8_t *value;\n\n\t\ta = l->data;\n\n\t\tvalue = (void *) adl->data[i];\n\n\t\tput_le16(a->handle, value);\n\n\t\t/* Attribute Value */\n\t\tmemcpy(&value[2], a->data, a->len);\n\t}\n\n\tlength = enc_read_by_type_resp(adl, pdu, len);\n\n\tatt_data_list_free(adl);\n\tg_slist_free(types);\n\n\treturn length;\n}"
  },
  {
    "function_name": "read_by_group",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/attrib-server.c",
    "lines": "413-532",
    "snippet": "static uint16_t read_by_group(struct gatt_channel *channel, uint16_t start,\n\t\t\t\t\t\tuint16_t end, bt_uuid_t *uuid,\n\t\t\t\t\t\tuint8_t *pdu, size_t len)\n{\n\tstruct att_data_list *adl;\n\tstruct attribute *a;\n\tstruct group_elem *cur, *old = NULL;\n\tGSList *l, *groups;\n\tGList *dl, *database;\n\tuint16_t length, last_handle, last_size = 0;\n\tuint8_t status;\n\tint i;\n\n\tif (start > end || start == 0x0000)\n\t\treturn enc_error_resp(ATT_OP_READ_BY_GROUP_REQ, start,\n\t\t\t\t\tATT_ECODE_INVALID_HANDLE, pdu, len);\n\n\t/*\n\t * Only <<Primary Service>> and <<Secondary Service>> grouping\n\t * types may be used in the Read By Group Type Request.\n\t */\n\n\tif (bt_uuid_cmp(uuid, &prim_uuid) != 0 &&\n\t\tbt_uuid_cmp(uuid, &snd_uuid) != 0)\n\t\treturn enc_error_resp(ATT_OP_READ_BY_GROUP_REQ, 0x0000,\n\t\t\t\t\tATT_ECODE_UNSUPP_GRP_TYPE, pdu, len);\n\n\tlast_handle = end;\n\tdatabase = channel->server->database;\n\tfor (dl = database, groups = NULL, cur = NULL; dl; dl = dl->next) {\n\n\t\ta = dl->data;\n\n\t\tif (a->handle < start)\n\t\t\tcontinue;\n\n\t\tif (a->handle >= end)\n\t\t\tbreak;\n\n\t\t/* The old group ends when a new one starts */\n\t\tif (old && (bt_uuid_cmp(&a->uuid, &prim_uuid) == 0 ||\n\t\t\t\tbt_uuid_cmp(&a->uuid, &snd_uuid) == 0)) {\n\t\t\told->end = last_handle;\n\t\t\told = NULL;\n\t\t}\n\n\t\tif (bt_uuid_cmp(&a->uuid, uuid) != 0) {\n\t\t\t/* Still inside a service, update its last handle */\n\t\t\tif (old)\n\t\t\t\tlast_handle = a->handle;\n\t\t\tcontinue;\n\t\t}\n\n\t\tif (last_size && (last_size != a->len))\n\t\t\tbreak;\n\n\t\tstatus = att_check_reqs(channel, ATT_OP_READ_BY_GROUP_REQ,\n\t\t\t\t\t\t\t\ta->read_req);\n\n\t\tif (status == 0x00 && a->read_cb)\n\t\t\tstatus = a->read_cb(a, channel->device,\n\t\t\t\t\t\t\ta->cb_user_data);\n\n\t\tif (status) {\n\t\t\tg_slist_free_full(groups, g_free);\n\t\t\treturn enc_error_resp(ATT_OP_READ_BY_GROUP_REQ,\n\t\t\t\t\t\ta->handle, status, pdu, len);\n\t\t}\n\n\t\tcur = g_new0(struct group_elem, 1);\n\t\tcur->handle = a->handle;\n\t\tcur->data = a->data;\n\t\tcur->len = a->len;\n\n\t\t/* Attribute Grouping Type found */\n\t\tgroups = g_slist_append(groups, cur);\n\n\t\tlast_size = a->len;\n\t\told = cur;\n\t\tlast_handle = cur->handle;\n\t}\n\n\tif (groups == NULL)\n\t\treturn enc_error_resp(ATT_OP_READ_BY_GROUP_REQ, start,\n\t\t\t\t\tATT_ECODE_ATTR_NOT_FOUND, pdu, len);\n\n\tif (dl == NULL)\n\t\tcur->end = a->handle;\n\telse\n\t\tcur->end = last_handle;\n\n\tlength = g_slist_length(groups);\n\n\tadl = att_data_list_alloc(length, last_size + 4);\n\tif (adl == NULL) {\n\t\tg_slist_free_full(groups, g_free);\n\t\treturn enc_error_resp(ATT_OP_READ_BY_GROUP_REQ, start,\n\t\t\t\t\tATT_ECODE_UNLIKELY, pdu, len);\n\t}\n\n\tfor (i = 0, l = groups; l; l = l->next, i++) {\n\t\tuint8_t *value;\n\n\t\tcur = l->data;\n\n\t\tvalue = (void *) adl->data[i];\n\n\t\tput_le16(cur->handle, value);\n\t\tput_le16(cur->end, &value[2]);\n\t\t/* Attribute Value */\n\t\tmemcpy(&value[4], cur->data, cur->len);\n\t}\n\n\tlength = enc_read_by_grp_resp(adl, pdu, len);\n\n\tatt_data_list_free(adl);\n\tg_slist_free_full(groups, g_free);\n\n\treturn length;\n}",
    "includes": [
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"attrib/att-database.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"attrib/att.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"backtrace.h\"",
      "#include \"log.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <sys/stat.h>",
      "#include <glib.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdbool.h>",
      "#include <stdint.h>",
      "#include <errno.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static bt_uuid_t prim_uuid = {\n\t\t\t.type = BT_UUID16,\n\t\t\t.value.u16 = GATT_PRIM_SVC_UUID\n};",
      "static bt_uuid_t snd_uuid = {\n\t\t\t.type = BT_UUID16,\n\t\t\t.value.u16 = GATT_SND_SVC_UUID\n};"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_slist_free_full",
          "args": [
            "groups",
            "g_free"
          ],
          "line": 529
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "att_data_list_free",
          "args": [
            "adl"
          ],
          "line": 528
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "enc_read_by_grp_resp",
          "args": [
            "adl",
            "pdu",
            "len"
          ],
          "line": 526
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memcpy",
          "args": [
            "&value[4]",
            "cur->data",
            "cur->len"
          ],
          "line": 523
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "put_le16",
          "args": [
            "cur->end",
            "&value[2]"
          ],
          "line": 521
        },
        "resolved": true,
        "details": {
          "function_name": "put_le16",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/util.h",
          "lines": "159-162",
          "snippet": "static inline void put_le16(uint16_t val, void *dst)\n{\n\tput_unaligned(cpu_to_le16(val), (uint16_t *) dst);\n}",
          "includes": [
            "#include <string.h>",
            "#include <byteswap.h>",
            "#include <alloca.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <byteswap.h>\n#include <alloca.h>\n#include <stdlib.h>\n#include <stdint.h>\n\nstatic inline void put_le16(uint16_t val, void *dst)\n{\n\tput_unaligned(cpu_to_le16(val), (uint16_t *) dst);\n}"
        }
      },
      {
        "call_info": {
          "callee": "enc_error_resp",
          "args": [
            "ATT_OP_READ_BY_GROUP_REQ",
            "start",
            "ATT_ECODE_UNLIKELY",
            "pdu",
            "len"
          ],
          "line": 509
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_slist_free_full",
          "args": [
            "groups",
            "g_free"
          ],
          "line": 508
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "att_data_list_alloc",
          "args": [
            "length",
            "last_size + 4"
          ],
          "line": 506
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_slist_length",
          "args": [
            "groups"
          ],
          "line": 504
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "enc_error_resp",
          "args": [
            "ATT_OP_READ_BY_GROUP_REQ",
            "start",
            "ATT_ECODE_ATTR_NOT_FOUND",
            "pdu",
            "len"
          ],
          "line": 496
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_slist_append",
          "args": [
            "groups",
            "cur"
          ],
          "line": 488
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_new0",
          "args": [
            "structgroup_elem",
            "1"
          ],
          "line": 482
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "enc_error_resp",
          "args": [
            "ATT_OP_READ_BY_GROUP_REQ",
            "a->handle",
            "status",
            "pdu",
            "len"
          ],
          "line": 478
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_slist_free_full",
          "args": [
            "groups",
            "g_free"
          ],
          "line": 477
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "a->read_cb",
          "args": [
            "a",
            "channel->device",
            "a->cb_user_data"
          ],
          "line": 473
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "att_check_reqs",
          "args": [
            "channel",
            "ATT_OP_READ_BY_GROUP_REQ",
            "a->read_req"
          ],
          "line": 469
        },
        "resolved": true,
        "details": {
          "function_name": "att_check_reqs",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/attrib-server.c",
          "lines": "379-411",
          "snippet": "static uint8_t att_check_reqs(struct gatt_channel *channel, uint8_t opcode,\n\t\t\t\t\t\t\t\tint reqs)\n{\n\t/* FIXME: currently, it is assumed an encrypted link is enough for\n\t * authentication. This will allow to enable the SMP negotiation once\n\t * it is on upstream kernel. High security level should be mapped\n\t * to authentication and medium to encryption permission. */\n\tif (!channel->encrypted)\n\t\tchannel->encrypted = g_attrib_is_encrypted(channel->attrib);\n\tif (reqs == ATT_AUTHENTICATION && !channel->encrypted)\n\t\treturn ATT_ECODE_AUTHENTICATION;\n\telse if (reqs == ATT_AUTHORIZATION)\n\t\treturn ATT_ECODE_AUTHORIZATION;\n\n\tswitch (opcode) {\n\tcase ATT_OP_READ_BY_GROUP_REQ:\n\tcase ATT_OP_READ_BY_TYPE_REQ:\n\tcase ATT_OP_READ_REQ:\n\tcase ATT_OP_READ_BLOB_REQ:\n\tcase ATT_OP_READ_MULTI_REQ:\n\t\tif (reqs == ATT_NOT_PERMITTED)\n\t\t\treturn ATT_ECODE_READ_NOT_PERM;\n\t\tbreak;\n\tcase ATT_OP_PREP_WRITE_REQ:\n\tcase ATT_OP_WRITE_REQ:\n\tcase ATT_OP_WRITE_CMD:\n\t\tif (reqs == ATT_NOT_PERMITTED)\n\t\t\treturn ATT_ECODE_WRITE_NOT_PERM;\n\t\tbreak;\n\t}\n\n\treturn 0;\n}",
          "includes": [
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"attrib/att-database.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"backtrace.h\"",
            "#include \"log.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <sys/stat.h>",
            "#include <glib.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdbool.h>",
            "#include <stdint.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"attrib/att-database.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"src/shared/util.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <sys/stat.h>\n#include <glib.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdbool.h>\n#include <stdint.h>\n#include <errno.h>\n#include <config.h>\n\nstatic uint8_t att_check_reqs(struct gatt_channel *channel, uint8_t opcode,\n\t\t\t\t\t\t\t\tint reqs)\n{\n\t/* FIXME: currently, it is assumed an encrypted link is enough for\n\t * authentication. This will allow to enable the SMP negotiation once\n\t * it is on upstream kernel. High security level should be mapped\n\t * to authentication and medium to encryption permission. */\n\tif (!channel->encrypted)\n\t\tchannel->encrypted = g_attrib_is_encrypted(channel->attrib);\n\tif (reqs == ATT_AUTHENTICATION && !channel->encrypted)\n\t\treturn ATT_ECODE_AUTHENTICATION;\n\telse if (reqs == ATT_AUTHORIZATION)\n\t\treturn ATT_ECODE_AUTHORIZATION;\n\n\tswitch (opcode) {\n\tcase ATT_OP_READ_BY_GROUP_REQ:\n\tcase ATT_OP_READ_BY_TYPE_REQ:\n\tcase ATT_OP_READ_REQ:\n\tcase ATT_OP_READ_BLOB_REQ:\n\tcase ATT_OP_READ_MULTI_REQ:\n\t\tif (reqs == ATT_NOT_PERMITTED)\n\t\t\treturn ATT_ECODE_READ_NOT_PERM;\n\t\tbreak;\n\tcase ATT_OP_PREP_WRITE_REQ:\n\tcase ATT_OP_WRITE_REQ:\n\tcase ATT_OP_WRITE_CMD:\n\t\tif (reqs == ATT_NOT_PERMITTED)\n\t\t\treturn ATT_ECODE_WRITE_NOT_PERM;\n\t\tbreak;\n\t}\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "bt_uuid_cmp",
          "args": [
            "&a->uuid",
            "uuid"
          ],
          "line": 459
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bt_uuid_cmp",
          "args": [
            "&a->uuid",
            "&snd_uuid"
          ],
          "line": 454
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bt_uuid_cmp",
          "args": [
            "&a->uuid",
            "&prim_uuid"
          ],
          "line": 453
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "enc_error_resp",
          "args": [
            "ATT_OP_READ_BY_GROUP_REQ",
            "0x0000",
            "ATT_ECODE_UNSUPP_GRP_TYPE",
            "pdu",
            "len"
          ],
          "line": 437
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bt_uuid_cmp",
          "args": [
            "uuid",
            "&snd_uuid"
          ],
          "line": 436
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bt_uuid_cmp",
          "args": [
            "uuid",
            "&prim_uuid"
          ],
          "line": 435
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "enc_error_resp",
          "args": [
            "ATT_OP_READ_BY_GROUP_REQ",
            "start",
            "ATT_ECODE_INVALID_HANDLE",
            "pdu",
            "len"
          ],
          "line": 427
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"attrib/att-database.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"src/shared/util.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <sys/stat.h>\n#include <glib.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdbool.h>\n#include <stdint.h>\n#include <errno.h>\n#include <config.h>\n\nstatic bt_uuid_t prim_uuid = {\n\t\t\t.type = BT_UUID16,\n\t\t\t.value.u16 = GATT_PRIM_SVC_UUID\n};\nstatic bt_uuid_t snd_uuid = {\n\t\t\t.type = BT_UUID16,\n\t\t\t.value.u16 = GATT_SND_SVC_UUID\n};\n\nstatic uint16_t read_by_group(struct gatt_channel *channel, uint16_t start,\n\t\t\t\t\t\tuint16_t end, bt_uuid_t *uuid,\n\t\t\t\t\t\tuint8_t *pdu, size_t len)\n{\n\tstruct att_data_list *adl;\n\tstruct attribute *a;\n\tstruct group_elem *cur, *old = NULL;\n\tGSList *l, *groups;\n\tGList *dl, *database;\n\tuint16_t length, last_handle, last_size = 0;\n\tuint8_t status;\n\tint i;\n\n\tif (start > end || start == 0x0000)\n\t\treturn enc_error_resp(ATT_OP_READ_BY_GROUP_REQ, start,\n\t\t\t\t\tATT_ECODE_INVALID_HANDLE, pdu, len);\n\n\t/*\n\t * Only <<Primary Service>> and <<Secondary Service>> grouping\n\t * types may be used in the Read By Group Type Request.\n\t */\n\n\tif (bt_uuid_cmp(uuid, &prim_uuid) != 0 &&\n\t\tbt_uuid_cmp(uuid, &snd_uuid) != 0)\n\t\treturn enc_error_resp(ATT_OP_READ_BY_GROUP_REQ, 0x0000,\n\t\t\t\t\tATT_ECODE_UNSUPP_GRP_TYPE, pdu, len);\n\n\tlast_handle = end;\n\tdatabase = channel->server->database;\n\tfor (dl = database, groups = NULL, cur = NULL; dl; dl = dl->next) {\n\n\t\ta = dl->data;\n\n\t\tif (a->handle < start)\n\t\t\tcontinue;\n\n\t\tif (a->handle >= end)\n\t\t\tbreak;\n\n\t\t/* The old group ends when a new one starts */\n\t\tif (old && (bt_uuid_cmp(&a->uuid, &prim_uuid) == 0 ||\n\t\t\t\tbt_uuid_cmp(&a->uuid, &snd_uuid) == 0)) {\n\t\t\told->end = last_handle;\n\t\t\told = NULL;\n\t\t}\n\n\t\tif (bt_uuid_cmp(&a->uuid, uuid) != 0) {\n\t\t\t/* Still inside a service, update its last handle */\n\t\t\tif (old)\n\t\t\t\tlast_handle = a->handle;\n\t\t\tcontinue;\n\t\t}\n\n\t\tif (last_size && (last_size != a->len))\n\t\t\tbreak;\n\n\t\tstatus = att_check_reqs(channel, ATT_OP_READ_BY_GROUP_REQ,\n\t\t\t\t\t\t\t\ta->read_req);\n\n\t\tif (status == 0x00 && a->read_cb)\n\t\t\tstatus = a->read_cb(a, channel->device,\n\t\t\t\t\t\t\ta->cb_user_data);\n\n\t\tif (status) {\n\t\t\tg_slist_free_full(groups, g_free);\n\t\t\treturn enc_error_resp(ATT_OP_READ_BY_GROUP_REQ,\n\t\t\t\t\t\ta->handle, status, pdu, len);\n\t\t}\n\n\t\tcur = g_new0(struct group_elem, 1);\n\t\tcur->handle = a->handle;\n\t\tcur->data = a->data;\n\t\tcur->len = a->len;\n\n\t\t/* Attribute Grouping Type found */\n\t\tgroups = g_slist_append(groups, cur);\n\n\t\tlast_size = a->len;\n\t\told = cur;\n\t\tlast_handle = cur->handle;\n\t}\n\n\tif (groups == NULL)\n\t\treturn enc_error_resp(ATT_OP_READ_BY_GROUP_REQ, start,\n\t\t\t\t\tATT_ECODE_ATTR_NOT_FOUND, pdu, len);\n\n\tif (dl == NULL)\n\t\tcur->end = a->handle;\n\telse\n\t\tcur->end = last_handle;\n\n\tlength = g_slist_length(groups);\n\n\tadl = att_data_list_alloc(length, last_size + 4);\n\tif (adl == NULL) {\n\t\tg_slist_free_full(groups, g_free);\n\t\treturn enc_error_resp(ATT_OP_READ_BY_GROUP_REQ, start,\n\t\t\t\t\tATT_ECODE_UNLIKELY, pdu, len);\n\t}\n\n\tfor (i = 0, l = groups; l; l = l->next, i++) {\n\t\tuint8_t *value;\n\n\t\tcur = l->data;\n\n\t\tvalue = (void *) adl->data[i];\n\n\t\tput_le16(cur->handle, value);\n\t\tput_le16(cur->end, &value[2]);\n\t\t/* Attribute Value */\n\t\tmemcpy(&value[4], cur->data, cur->len);\n\t}\n\n\tlength = enc_read_by_grp_resp(adl, pdu, len);\n\n\tatt_data_list_free(adl);\n\tg_slist_free_full(groups, g_free);\n\n\treturn length;\n}"
  },
  {
    "function_name": "att_check_reqs",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/attrib-server.c",
    "lines": "379-411",
    "snippet": "static uint8_t att_check_reqs(struct gatt_channel *channel, uint8_t opcode,\n\t\t\t\t\t\t\t\tint reqs)\n{\n\t/* FIXME: currently, it is assumed an encrypted link is enough for\n\t * authentication. This will allow to enable the SMP negotiation once\n\t * it is on upstream kernel. High security level should be mapped\n\t * to authentication and medium to encryption permission. */\n\tif (!channel->encrypted)\n\t\tchannel->encrypted = g_attrib_is_encrypted(channel->attrib);\n\tif (reqs == ATT_AUTHENTICATION && !channel->encrypted)\n\t\treturn ATT_ECODE_AUTHENTICATION;\n\telse if (reqs == ATT_AUTHORIZATION)\n\t\treturn ATT_ECODE_AUTHORIZATION;\n\n\tswitch (opcode) {\n\tcase ATT_OP_READ_BY_GROUP_REQ:\n\tcase ATT_OP_READ_BY_TYPE_REQ:\n\tcase ATT_OP_READ_REQ:\n\tcase ATT_OP_READ_BLOB_REQ:\n\tcase ATT_OP_READ_MULTI_REQ:\n\t\tif (reqs == ATT_NOT_PERMITTED)\n\t\t\treturn ATT_ECODE_READ_NOT_PERM;\n\t\tbreak;\n\tcase ATT_OP_PREP_WRITE_REQ:\n\tcase ATT_OP_WRITE_REQ:\n\tcase ATT_OP_WRITE_CMD:\n\t\tif (reqs == ATT_NOT_PERMITTED)\n\t\t\treturn ATT_ECODE_WRITE_NOT_PERM;\n\t\tbreak;\n\t}\n\n\treturn 0;\n}",
    "includes": [
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"attrib/att-database.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"attrib/att.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"backtrace.h\"",
      "#include \"log.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <sys/stat.h>",
      "#include <glib.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdbool.h>",
      "#include <stdint.h>",
      "#include <errno.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_attrib_is_encrypted",
          "args": [
            "channel->attrib"
          ],
          "line": 387
        },
        "resolved": true,
        "details": {
          "function_name": "g_attrib_is_encrypted",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/attrib-server.c",
          "lines": "367-377",
          "snippet": "static bool g_attrib_is_encrypted(GAttrib *attrib)\n{\n\tBtIOSecLevel sec_level;\n\tGIOChannel *io = g_attrib_get_channel(attrib);\n\n\tif (!bt_io_get(io, NULL, BT_IO_OPT_SEC_LEVEL, &sec_level,\n\t\t\t\t\t\t\t     BT_IO_OPT_INVALID))\n\t\treturn FALSE;\n\n\treturn sec_level > BT_IO_SEC_LOW;\n}",
          "includes": [
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"attrib/att-database.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"backtrace.h\"",
            "#include \"log.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <sys/stat.h>",
            "#include <glib.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdbool.h>",
            "#include <stdint.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"attrib/att-database.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"src/shared/util.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <sys/stat.h>\n#include <glib.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdbool.h>\n#include <stdint.h>\n#include <errno.h>\n#include <config.h>\n\nstatic bool g_attrib_is_encrypted(GAttrib *attrib)\n{\n\tBtIOSecLevel sec_level;\n\tGIOChannel *io = g_attrib_get_channel(attrib);\n\n\tif (!bt_io_get(io, NULL, BT_IO_OPT_SEC_LEVEL, &sec_level,\n\t\t\t\t\t\t\t     BT_IO_OPT_INVALID))\n\t\treturn FALSE;\n\n\treturn sec_level > BT_IO_SEC_LOW;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"attrib/att-database.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"src/shared/util.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <sys/stat.h>\n#include <glib.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdbool.h>\n#include <stdint.h>\n#include <errno.h>\n#include <config.h>\n\nstatic uint8_t att_check_reqs(struct gatt_channel *channel, uint8_t opcode,\n\t\t\t\t\t\t\t\tint reqs)\n{\n\t/* FIXME: currently, it is assumed an encrypted link is enough for\n\t * authentication. This will allow to enable the SMP negotiation once\n\t * it is on upstream kernel. High security level should be mapped\n\t * to authentication and medium to encryption permission. */\n\tif (!channel->encrypted)\n\t\tchannel->encrypted = g_attrib_is_encrypted(channel->attrib);\n\tif (reqs == ATT_AUTHENTICATION && !channel->encrypted)\n\t\treturn ATT_ECODE_AUTHENTICATION;\n\telse if (reqs == ATT_AUTHORIZATION)\n\t\treturn ATT_ECODE_AUTHORIZATION;\n\n\tswitch (opcode) {\n\tcase ATT_OP_READ_BY_GROUP_REQ:\n\tcase ATT_OP_READ_BY_TYPE_REQ:\n\tcase ATT_OP_READ_REQ:\n\tcase ATT_OP_READ_BLOB_REQ:\n\tcase ATT_OP_READ_MULTI_REQ:\n\t\tif (reqs == ATT_NOT_PERMITTED)\n\t\t\treturn ATT_ECODE_READ_NOT_PERM;\n\t\tbreak;\n\tcase ATT_OP_PREP_WRITE_REQ:\n\tcase ATT_OP_WRITE_REQ:\n\tcase ATT_OP_WRITE_CMD:\n\t\tif (reqs == ATT_NOT_PERMITTED)\n\t\t\treturn ATT_ECODE_WRITE_NOT_PERM;\n\t\tbreak;\n\t}\n\n\treturn 0;\n}"
  },
  {
    "function_name": "g_attrib_is_encrypted",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/attrib-server.c",
    "lines": "367-377",
    "snippet": "static bool g_attrib_is_encrypted(GAttrib *attrib)\n{\n\tBtIOSecLevel sec_level;\n\tGIOChannel *io = g_attrib_get_channel(attrib);\n\n\tif (!bt_io_get(io, NULL, BT_IO_OPT_SEC_LEVEL, &sec_level,\n\t\t\t\t\t\t\t     BT_IO_OPT_INVALID))\n\t\treturn FALSE;\n\n\treturn sec_level > BT_IO_SEC_LOW;\n}",
    "includes": [
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"attrib/att-database.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"attrib/att.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"backtrace.h\"",
      "#include \"log.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <sys/stat.h>",
      "#include <glib.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdbool.h>",
      "#include <stdint.h>",
      "#include <errno.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "bt_io_get",
          "args": [
            "io",
            "NULL",
            "BT_IO_OPT_SEC_LEVEL",
            "&sec_level",
            "BT_IO_OPT_INVALID"
          ],
          "line": 372
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_attrib_get_channel",
          "args": [
            "attrib"
          ],
          "line": 370
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"attrib/att-database.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"src/shared/util.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <sys/stat.h>\n#include <glib.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdbool.h>\n#include <stdint.h>\n#include <errno.h>\n#include <config.h>\n\nstatic bool g_attrib_is_encrypted(GAttrib *attrib)\n{\n\tBtIOSecLevel sec_level;\n\tGIOChannel *io = g_attrib_get_channel(attrib);\n\n\tif (!bt_io_get(io, NULL, BT_IO_OPT_SEC_LEVEL, &sec_level,\n\t\t\t\t\t\t\t     BT_IO_OPT_INVALID))\n\t\treturn FALSE;\n\n\treturn sec_level > BT_IO_SEC_LOW;\n}"
  },
  {
    "function_name": "attrib_db_add_new",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/attrib-server.c",
    "lines": "339-365",
    "snippet": "static struct attribute *attrib_db_add_new(struct gatt_server *server,\n\t\t\t\tuint16_t handle, bt_uuid_t *uuid,\n\t\t\t\tint read_req, int write_req,\n\t\t\t\tconst uint8_t *value, size_t len)\n{\n\tstruct attribute *a;\n\tguint h = handle;\n\n\tDBG(\"handle=0x%04x\", handle);\n\n\tif (g_list_find_custom(server->database, GUINT_TO_POINTER(h),\n\t\t\t\t\t\t\t\thandle_cmp))\n\t\treturn NULL;\n\n\ta = g_new0(struct attribute, 1);\n\ta->len = len;\n\ta->data = g_memdup(value, len);\n\ta->handle = handle;\n\ta->uuid = *uuid;\n\ta->read_req = read_req;\n\ta->write_req = write_req;\n\n\tserver->database = g_list_insert_sorted(server->database, a,\n\t\t\t\t\t\t\t\tattribute_cmp);\n\n\treturn a;\n}",
    "includes": [
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"attrib/att-database.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"attrib/att.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"backtrace.h\"",
      "#include \"log.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <sys/stat.h>",
      "#include <glib.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdbool.h>",
      "#include <stdint.h>",
      "#include <errno.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_list_insert_sorted",
          "args": [
            "server->database",
            "a",
            "attribute_cmp"
          ],
          "line": 361
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_memdup",
          "args": [
            "value",
            "len"
          ],
          "line": 355
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_new0",
          "args": [
            "structattribute",
            "1"
          ],
          "line": 353
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_list_find_custom",
          "args": [
            "server->database",
            "GUINT_TO_POINTER(h)",
            "handle_cmp"
          ],
          "line": 349
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "GUINT_TO_POINTER",
          "args": [
            "h"
          ],
          "line": 349
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"handle=0x%04x\"",
            "handle"
          ],
          "line": 347
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"attrib/att-database.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"src/shared/util.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <sys/stat.h>\n#include <glib.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdbool.h>\n#include <stdint.h>\n#include <errno.h>\n#include <config.h>\n\nstatic struct attribute *attrib_db_add_new(struct gatt_server *server,\n\t\t\t\tuint16_t handle, bt_uuid_t *uuid,\n\t\t\t\tint read_req, int write_req,\n\t\t\t\tconst uint8_t *value, size_t len)\n{\n\tstruct attribute *a;\n\tguint h = handle;\n\n\tDBG(\"handle=0x%04x\", handle);\n\n\tif (g_list_find_custom(server->database, GUINT_TO_POINTER(h),\n\t\t\t\t\t\t\t\thandle_cmp))\n\t\treturn NULL;\n\n\ta = g_new0(struct attribute, 1);\n\ta->len = len;\n\ta->data = g_memdup(value, len);\n\ta->handle = handle;\n\ta->uuid = *uuid;\n\ta->read_req = read_req;\n\ta->write_req = write_req;\n\n\tserver->database = g_list_insert_sorted(server->database, a,\n\t\t\t\t\t\t\t\tattribute_cmp);\n\n\treturn a;\n}"
  },
  {
    "function_name": "attrib_create_sdp_new",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/attrib-server.c",
    "lines": "294-337",
    "snippet": "static uint32_t attrib_create_sdp_new(struct gatt_server *server,\n\t\t\t\t\tuint16_t handle, const char *name)\n{\n\tsdp_record_t *record;\n\tstruct attribute *a;\n\tuint16_t end = 0;\n\tuuid_t svc, gap_uuid;\n\n\ta = find_svc_range(server, handle, &end);\n\n\tif (a == NULL)\n\t\treturn 0;\n\n\tif (a->len == 2)\n\t\tsdp_uuid16_create(&svc, get_le16(a->data));\n\telse if (a->len == 16) {\n\t\tuint8_t be128[16];\n\n\t\t/* Converting from LE to BE */\n\t\tbswap_128(a->data, be128);\n\t\tsdp_uuid128_create(&svc, be128);\n\t} else\n\t\treturn 0;\n\n\trecord = server_record_new(&svc, handle, end);\n\tif (record == NULL)\n\t\treturn 0;\n\n\tif (name != NULL)\n\t\tsdp_set_info_attr(record, name, \"BlueZ\", NULL);\n\n\tsdp_uuid16_create(&gap_uuid, GENERIC_ACCESS_PROFILE_ID);\n\tif (sdp_uuid_cmp(&svc, &gap_uuid) == 0) {\n\t\tsdp_set_url_attr(record, \"http://www.bluez.org/\",\n\t\t\t\t\"http://www.bluez.org/\",\n\t\t\t\t\"http://www.bluez.org/\");\n\t}\n\n\tif (adapter_service_add(server->adapter, record) == 0)\n\t\treturn record->handle;\n\n\tsdp_record_free(record);\n\treturn 0;\n}",
    "includes": [
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"attrib/att-database.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"attrib/att.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"backtrace.h\"",
      "#include \"log.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <sys/stat.h>",
      "#include <glib.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdbool.h>",
      "#include <stdint.h>",
      "#include <errno.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "sdp_record_free",
          "args": [
            "record"
          ],
          "line": 335
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "adapter_service_add",
          "args": [
            "server->adapter",
            "record"
          ],
          "line": 332
        },
        "resolved": true,
        "details": {
          "function_name": "adapter_service_add",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "1129-1142",
          "snippet": "int adapter_service_add(struct btd_adapter *adapter, sdp_record_t *rec)\n{\n\tint ret;\n\n\tDBG(\"%s\", adapter->path);\n\n\tret = add_record_to_server(&adapter->bdaddr, rec);\n\tif (ret < 0)\n\t\treturn ret;\n\n\tadapter_service_insert(adapter, rec);\n\n\treturn 0;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void trigger_pairable_timeout(struct btd_adapter *adapter);",
            "static void adapter_start(struct btd_adapter *adapter);",
            "static void adapter_stop(struct btd_adapter *adapter);",
            "static void trigger_passive_scanning(struct btd_adapter *adapter);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void trigger_pairable_timeout(struct btd_adapter *adapter);\nstatic void adapter_start(struct btd_adapter *adapter);\nstatic void adapter_stop(struct btd_adapter *adapter);\nstatic void trigger_passive_scanning(struct btd_adapter *adapter);\n\nint adapter_service_add(struct btd_adapter *adapter, sdp_record_t *rec)\n{\n\tint ret;\n\n\tDBG(\"%s\", adapter->path);\n\n\tret = add_record_to_server(&adapter->bdaddr, rec);\n\tif (ret < 0)\n\t\treturn ret;\n\n\tadapter_service_insert(adapter, rec);\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "sdp_set_url_attr",
          "args": [
            "record",
            "\"http://www.bluez.org/\"",
            "\"http://www.bluez.org/\"",
            "\"http://www.bluez.org/\""
          ],
          "line": 327
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_uuid_cmp",
          "args": [
            "&svc",
            "&gap_uuid"
          ],
          "line": 326
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_uuid16_create",
          "args": [
            "&gap_uuid",
            "GENERIC_ACCESS_PROFILE_ID"
          ],
          "line": 325
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_set_info_attr",
          "args": [
            "record",
            "name",
            "\"BlueZ\"",
            "NULL"
          ],
          "line": 323
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "server_record_new",
          "args": [
            "&svc",
            "handle",
            "end"
          ],
          "line": 318
        },
        "resolved": true,
        "details": {
          "function_name": "server_record_new",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/attrib-server.c",
          "lines": "187-240",
          "snippet": "static sdp_record_t *server_record_new(uuid_t *uuid, uint16_t start, uint16_t end)\n{\n\tsdp_list_t *svclass_id, *apseq, *proto[2], *root, *aproto;\n\tuuid_t root_uuid, proto_uuid, l2cap;\n\tsdp_record_t *record;\n\tsdp_data_t *psm, *sh, *eh;\n\tuint16_t lp = ATT_PSM;\n\n\tif (uuid == NULL)\n\t\treturn NULL;\n\n\tif (start > end)\n\t\treturn NULL;\n\n\trecord = sdp_record_alloc();\n\tif (record == NULL)\n\t\treturn NULL;\n\n\tsdp_uuid16_create(&root_uuid, PUBLIC_BROWSE_GROUP);\n\troot = sdp_list_append(NULL, &root_uuid);\n\tsdp_set_browse_groups(record, root);\n\tsdp_list_free(root, NULL);\n\n\tsvclass_id = sdp_list_append(NULL, uuid);\n\tsdp_set_service_classes(record, svclass_id);\n\tsdp_list_free(svclass_id, NULL);\n\n\tsdp_uuid16_create(&l2cap, L2CAP_UUID);\n\tproto[0] = sdp_list_append(NULL, &l2cap);\n\tpsm = sdp_data_alloc(SDP_UINT16, &lp);\n\tproto[0] = sdp_list_append(proto[0], psm);\n\tapseq = sdp_list_append(NULL, proto[0]);\n\n\tsdp_uuid16_create(&proto_uuid, ATT_UUID);\n\tproto[1] = sdp_list_append(NULL, &proto_uuid);\n\tsh = sdp_data_alloc(SDP_UINT16, &start);\n\tproto[1] = sdp_list_append(proto[1], sh);\n\teh = sdp_data_alloc(SDP_UINT16, &end);\n\tproto[1] = sdp_list_append(proto[1], eh);\n\tapseq = sdp_list_append(apseq, proto[1]);\n\n\taproto = sdp_list_append(NULL, apseq);\n\tsdp_set_access_protos(record, aproto);\n\n\tsdp_data_free(psm);\n\tsdp_data_free(sh);\n\tsdp_data_free(eh);\n\tsdp_list_free(proto[0], NULL);\n\tsdp_list_free(proto[1], NULL);\n\tsdp_list_free(apseq, NULL);\n\tsdp_list_free(aproto, NULL);\n\n\treturn record;\n}",
          "includes": [
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"attrib/att-database.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"backtrace.h\"",
            "#include \"log.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <sys/stat.h>",
            "#include <glib.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdbool.h>",
            "#include <stdint.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"attrib/att-database.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"src/shared/util.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <sys/stat.h>\n#include <glib.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdbool.h>\n#include <stdint.h>\n#include <errno.h>\n#include <config.h>\n\nstatic sdp_record_t *server_record_new(uuid_t *uuid, uint16_t start, uint16_t end)\n{\n\tsdp_list_t *svclass_id, *apseq, *proto[2], *root, *aproto;\n\tuuid_t root_uuid, proto_uuid, l2cap;\n\tsdp_record_t *record;\n\tsdp_data_t *psm, *sh, *eh;\n\tuint16_t lp = ATT_PSM;\n\n\tif (uuid == NULL)\n\t\treturn NULL;\n\n\tif (start > end)\n\t\treturn NULL;\n\n\trecord = sdp_record_alloc();\n\tif (record == NULL)\n\t\treturn NULL;\n\n\tsdp_uuid16_create(&root_uuid, PUBLIC_BROWSE_GROUP);\n\troot = sdp_list_append(NULL, &root_uuid);\n\tsdp_set_browse_groups(record, root);\n\tsdp_list_free(root, NULL);\n\n\tsvclass_id = sdp_list_append(NULL, uuid);\n\tsdp_set_service_classes(record, svclass_id);\n\tsdp_list_free(svclass_id, NULL);\n\n\tsdp_uuid16_create(&l2cap, L2CAP_UUID);\n\tproto[0] = sdp_list_append(NULL, &l2cap);\n\tpsm = sdp_data_alloc(SDP_UINT16, &lp);\n\tproto[0] = sdp_list_append(proto[0], psm);\n\tapseq = sdp_list_append(NULL, proto[0]);\n\n\tsdp_uuid16_create(&proto_uuid, ATT_UUID);\n\tproto[1] = sdp_list_append(NULL, &proto_uuid);\n\tsh = sdp_data_alloc(SDP_UINT16, &start);\n\tproto[1] = sdp_list_append(proto[1], sh);\n\teh = sdp_data_alloc(SDP_UINT16, &end);\n\tproto[1] = sdp_list_append(proto[1], eh);\n\tapseq = sdp_list_append(apseq, proto[1]);\n\n\taproto = sdp_list_append(NULL, apseq);\n\tsdp_set_access_protos(record, aproto);\n\n\tsdp_data_free(psm);\n\tsdp_data_free(sh);\n\tsdp_data_free(eh);\n\tsdp_list_free(proto[0], NULL);\n\tsdp_list_free(proto[1], NULL);\n\tsdp_list_free(apseq, NULL);\n\tsdp_list_free(aproto, NULL);\n\n\treturn record;\n}"
        }
      },
      {
        "call_info": {
          "callee": "sdp_uuid128_create",
          "args": [
            "&svc",
            "be128"
          ],
          "line": 314
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bswap_128",
          "args": [
            "a->data",
            "be128"
          ],
          "line": 313
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_uuid16_create",
          "args": [
            "&svc",
            "get_le16(a->data)"
          ],
          "line": 308
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "get_le16",
          "args": [
            "a->data"
          ],
          "line": 308
        },
        "resolved": true,
        "details": {
          "function_name": "get_le16",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/util.h",
          "lines": "129-132",
          "snippet": "static inline uint16_t get_le16(const void *ptr)\n{\n\treturn le16_to_cpu(get_unaligned((const uint16_t *) ptr));\n}",
          "includes": [
            "#include <string.h>",
            "#include <byteswap.h>",
            "#include <alloca.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <byteswap.h>\n#include <alloca.h>\n#include <stdlib.h>\n#include <stdint.h>\n\nstatic inline uint16_t get_le16(const void *ptr)\n{\n\treturn le16_to_cpu(get_unaligned((const uint16_t *) ptr));\n}"
        }
      },
      {
        "call_info": {
          "callee": "find_svc_range",
          "args": [
            "server",
            "handle",
            "&end"
          ],
          "line": 302
        },
        "resolved": true,
        "details": {
          "function_name": "find_svc_range",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/attrib-server.c",
          "lines": "258-292",
          "snippet": "static struct attribute *find_svc_range(struct gatt_server *server,\n\t\t\t\t\tuint16_t start, uint16_t *end)\n{\n\tstruct attribute *attrib;\n\tguint h = start;\n\tGList *l;\n\n\tif (end == NULL)\n\t\treturn NULL;\n\n\tl = g_list_find_custom(server->database, GUINT_TO_POINTER(h),\n\t\t\t\t\t\t\t\thandle_cmp);\n\tif (!l)\n\t\treturn NULL;\n\n\tattrib = l->data;\n\n\tif (bt_uuid_cmp(&attrib->uuid, &prim_uuid) != 0 &&\n\t\t\tbt_uuid_cmp(&attrib->uuid, &snd_uuid) != 0)\n\t\treturn NULL;\n\n\t*end = start;\n\n\tfor (l = l->next; l; l = l->next) {\n\t\tstruct attribute *a = l->data;\n\n\t\tif (bt_uuid_cmp(&a->uuid, &prim_uuid) == 0 ||\n\t\t\t\tbt_uuid_cmp(&a->uuid, &snd_uuid) == 0)\n\t\t\tbreak;\n\n\t\t*end = a->handle;\n\t}\n\n\treturn attrib;\n}",
          "includes": [
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"attrib/att-database.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"backtrace.h\"",
            "#include \"log.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <sys/stat.h>",
            "#include <glib.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdbool.h>",
            "#include <stdint.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static bt_uuid_t prim_uuid = {\n\t\t\t.type = BT_UUID16,\n\t\t\t.value.u16 = GATT_PRIM_SVC_UUID\n};",
            "static bt_uuid_t snd_uuid = {\n\t\t\t.type = BT_UUID16,\n\t\t\t.value.u16 = GATT_SND_SVC_UUID\n};"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"attrib/att-database.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"src/shared/util.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <sys/stat.h>\n#include <glib.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdbool.h>\n#include <stdint.h>\n#include <errno.h>\n#include <config.h>\n\nstatic bt_uuid_t prim_uuid = {\n\t\t\t.type = BT_UUID16,\n\t\t\t.value.u16 = GATT_PRIM_SVC_UUID\n};\nstatic bt_uuid_t snd_uuid = {\n\t\t\t.type = BT_UUID16,\n\t\t\t.value.u16 = GATT_SND_SVC_UUID\n};\n\nstatic struct attribute *find_svc_range(struct gatt_server *server,\n\t\t\t\t\tuint16_t start, uint16_t *end)\n{\n\tstruct attribute *attrib;\n\tguint h = start;\n\tGList *l;\n\n\tif (end == NULL)\n\t\treturn NULL;\n\n\tl = g_list_find_custom(server->database, GUINT_TO_POINTER(h),\n\t\t\t\t\t\t\t\thandle_cmp);\n\tif (!l)\n\t\treturn NULL;\n\n\tattrib = l->data;\n\n\tif (bt_uuid_cmp(&attrib->uuid, &prim_uuid) != 0 &&\n\t\t\tbt_uuid_cmp(&attrib->uuid, &snd_uuid) != 0)\n\t\treturn NULL;\n\n\t*end = start;\n\n\tfor (l = l->next; l; l = l->next) {\n\t\tstruct attribute *a = l->data;\n\n\t\tif (bt_uuid_cmp(&a->uuid, &prim_uuid) == 0 ||\n\t\t\t\tbt_uuid_cmp(&a->uuid, &snd_uuid) == 0)\n\t\t\tbreak;\n\n\t\t*end = a->handle;\n\t}\n\n\treturn attrib;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"attrib/att-database.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"src/shared/util.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <sys/stat.h>\n#include <glib.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdbool.h>\n#include <stdint.h>\n#include <errno.h>\n#include <config.h>\n\nstatic uint32_t attrib_create_sdp_new(struct gatt_server *server,\n\t\t\t\t\tuint16_t handle, const char *name)\n{\n\tsdp_record_t *record;\n\tstruct attribute *a;\n\tuint16_t end = 0;\n\tuuid_t svc, gap_uuid;\n\n\ta = find_svc_range(server, handle, &end);\n\n\tif (a == NULL)\n\t\treturn 0;\n\n\tif (a->len == 2)\n\t\tsdp_uuid16_create(&svc, get_le16(a->data));\n\telse if (a->len == 16) {\n\t\tuint8_t be128[16];\n\n\t\t/* Converting from LE to BE */\n\t\tbswap_128(a->data, be128);\n\t\tsdp_uuid128_create(&svc, be128);\n\t} else\n\t\treturn 0;\n\n\trecord = server_record_new(&svc, handle, end);\n\tif (record == NULL)\n\t\treturn 0;\n\n\tif (name != NULL)\n\t\tsdp_set_info_attr(record, name, \"BlueZ\", NULL);\n\n\tsdp_uuid16_create(&gap_uuid, GENERIC_ACCESS_PROFILE_ID);\n\tif (sdp_uuid_cmp(&svc, &gap_uuid) == 0) {\n\t\tsdp_set_url_attr(record, \"http://www.bluez.org/\",\n\t\t\t\t\"http://www.bluez.org/\",\n\t\t\t\t\"http://www.bluez.org/\");\n\t}\n\n\tif (adapter_service_add(server->adapter, record) == 0)\n\t\treturn record->handle;\n\n\tsdp_record_free(record);\n\treturn 0;\n}"
  },
  {
    "function_name": "find_svc_range",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/attrib-server.c",
    "lines": "258-292",
    "snippet": "static struct attribute *find_svc_range(struct gatt_server *server,\n\t\t\t\t\tuint16_t start, uint16_t *end)\n{\n\tstruct attribute *attrib;\n\tguint h = start;\n\tGList *l;\n\n\tif (end == NULL)\n\t\treturn NULL;\n\n\tl = g_list_find_custom(server->database, GUINT_TO_POINTER(h),\n\t\t\t\t\t\t\t\thandle_cmp);\n\tif (!l)\n\t\treturn NULL;\n\n\tattrib = l->data;\n\n\tif (bt_uuid_cmp(&attrib->uuid, &prim_uuid) != 0 &&\n\t\t\tbt_uuid_cmp(&attrib->uuid, &snd_uuid) != 0)\n\t\treturn NULL;\n\n\t*end = start;\n\n\tfor (l = l->next; l; l = l->next) {\n\t\tstruct attribute *a = l->data;\n\n\t\tif (bt_uuid_cmp(&a->uuid, &prim_uuid) == 0 ||\n\t\t\t\tbt_uuid_cmp(&a->uuid, &snd_uuid) == 0)\n\t\t\tbreak;\n\n\t\t*end = a->handle;\n\t}\n\n\treturn attrib;\n}",
    "includes": [
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"attrib/att-database.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"attrib/att.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"backtrace.h\"",
      "#include \"log.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <sys/stat.h>",
      "#include <glib.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdbool.h>",
      "#include <stdint.h>",
      "#include <errno.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static bt_uuid_t prim_uuid = {\n\t\t\t.type = BT_UUID16,\n\t\t\t.value.u16 = GATT_PRIM_SVC_UUID\n};",
      "static bt_uuid_t snd_uuid = {\n\t\t\t.type = BT_UUID16,\n\t\t\t.value.u16 = GATT_SND_SVC_UUID\n};"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "bt_uuid_cmp",
          "args": [
            "&a->uuid",
            "&snd_uuid"
          ],
          "line": 285
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bt_uuid_cmp",
          "args": [
            "&a->uuid",
            "&prim_uuid"
          ],
          "line": 284
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bt_uuid_cmp",
          "args": [
            "&attrib->uuid",
            "&snd_uuid"
          ],
          "line": 276
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bt_uuid_cmp",
          "args": [
            "&attrib->uuid",
            "&prim_uuid"
          ],
          "line": 275
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_list_find_custom",
          "args": [
            "server->database",
            "GUINT_TO_POINTER(h)",
            "handle_cmp"
          ],
          "line": 268
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "GUINT_TO_POINTER",
          "args": [
            "h"
          ],
          "line": 268
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"attrib/att-database.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"src/shared/util.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <sys/stat.h>\n#include <glib.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdbool.h>\n#include <stdint.h>\n#include <errno.h>\n#include <config.h>\n\nstatic bt_uuid_t prim_uuid = {\n\t\t\t.type = BT_UUID16,\n\t\t\t.value.u16 = GATT_PRIM_SVC_UUID\n};\nstatic bt_uuid_t snd_uuid = {\n\t\t\t.type = BT_UUID16,\n\t\t\t.value.u16 = GATT_SND_SVC_UUID\n};\n\nstatic struct attribute *find_svc_range(struct gatt_server *server,\n\t\t\t\t\tuint16_t start, uint16_t *end)\n{\n\tstruct attribute *attrib;\n\tguint h = start;\n\tGList *l;\n\n\tif (end == NULL)\n\t\treturn NULL;\n\n\tl = g_list_find_custom(server->database, GUINT_TO_POINTER(h),\n\t\t\t\t\t\t\t\thandle_cmp);\n\tif (!l)\n\t\treturn NULL;\n\n\tattrib = l->data;\n\n\tif (bt_uuid_cmp(&attrib->uuid, &prim_uuid) != 0 &&\n\t\t\tbt_uuid_cmp(&attrib->uuid, &snd_uuid) != 0)\n\t\treturn NULL;\n\n\t*end = start;\n\n\tfor (l = l->next; l; l = l->next) {\n\t\tstruct attribute *a = l->data;\n\n\t\tif (bt_uuid_cmp(&a->uuid, &prim_uuid) == 0 ||\n\t\t\t\tbt_uuid_cmp(&a->uuid, &snd_uuid) == 0)\n\t\t\tbreak;\n\n\t\t*end = a->handle;\n\t}\n\n\treturn attrib;\n}"
  },
  {
    "function_name": "attribute_cmp",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/attrib-server.c",
    "lines": "250-256",
    "snippet": "static int attribute_cmp(gconstpointer a1, gconstpointer a2)\n{\n\tconst struct attribute *attrib1 = a1;\n\tconst struct attribute *attrib2 = a2;\n\n\treturn attrib1->handle - attrib2->handle;\n}",
    "includes": [
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"attrib/att-database.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"attrib/att.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"backtrace.h\"",
      "#include \"log.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <sys/stat.h>",
      "#include <glib.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdbool.h>",
      "#include <stdint.h>",
      "#include <errno.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"attrib/att-database.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"src/shared/util.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <sys/stat.h>\n#include <glib.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdbool.h>\n#include <stdint.h>\n#include <errno.h>\n#include <config.h>\n\nstatic int attribute_cmp(gconstpointer a1, gconstpointer a2)\n{\n\tconst struct attribute *attrib1 = a1;\n\tconst struct attribute *attrib2 = a2;\n\n\treturn attrib1->handle - attrib2->handle;\n}"
  },
  {
    "function_name": "handle_cmp",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/attrib-server.c",
    "lines": "242-248",
    "snippet": "static int handle_cmp(gconstpointer a, gconstpointer b)\n{\n\tconst struct attribute *attrib = a;\n\tuint16_t handle = GPOINTER_TO_UINT(b);\n\n\treturn attrib->handle - handle;\n}",
    "includes": [
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"attrib/att-database.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"attrib/att.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"backtrace.h\"",
      "#include \"log.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <sys/stat.h>",
      "#include <glib.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdbool.h>",
      "#include <stdint.h>",
      "#include <errno.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "GPOINTER_TO_UINT",
          "args": [
            "b"
          ],
          "line": 245
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"attrib/att-database.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"src/shared/util.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <sys/stat.h>\n#include <glib.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdbool.h>\n#include <stdint.h>\n#include <errno.h>\n#include <config.h>\n\nstatic int handle_cmp(gconstpointer a, gconstpointer b)\n{\n\tconst struct attribute *attrib = a;\n\tuint16_t handle = GPOINTER_TO_UINT(b);\n\n\treturn attrib->handle - handle;\n}"
  },
  {
    "function_name": "server_record_new",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/attrib-server.c",
    "lines": "187-240",
    "snippet": "static sdp_record_t *server_record_new(uuid_t *uuid, uint16_t start, uint16_t end)\n{\n\tsdp_list_t *svclass_id, *apseq, *proto[2], *root, *aproto;\n\tuuid_t root_uuid, proto_uuid, l2cap;\n\tsdp_record_t *record;\n\tsdp_data_t *psm, *sh, *eh;\n\tuint16_t lp = ATT_PSM;\n\n\tif (uuid == NULL)\n\t\treturn NULL;\n\n\tif (start > end)\n\t\treturn NULL;\n\n\trecord = sdp_record_alloc();\n\tif (record == NULL)\n\t\treturn NULL;\n\n\tsdp_uuid16_create(&root_uuid, PUBLIC_BROWSE_GROUP);\n\troot = sdp_list_append(NULL, &root_uuid);\n\tsdp_set_browse_groups(record, root);\n\tsdp_list_free(root, NULL);\n\n\tsvclass_id = sdp_list_append(NULL, uuid);\n\tsdp_set_service_classes(record, svclass_id);\n\tsdp_list_free(svclass_id, NULL);\n\n\tsdp_uuid16_create(&l2cap, L2CAP_UUID);\n\tproto[0] = sdp_list_append(NULL, &l2cap);\n\tpsm = sdp_data_alloc(SDP_UINT16, &lp);\n\tproto[0] = sdp_list_append(proto[0], psm);\n\tapseq = sdp_list_append(NULL, proto[0]);\n\n\tsdp_uuid16_create(&proto_uuid, ATT_UUID);\n\tproto[1] = sdp_list_append(NULL, &proto_uuid);\n\tsh = sdp_data_alloc(SDP_UINT16, &start);\n\tproto[1] = sdp_list_append(proto[1], sh);\n\teh = sdp_data_alloc(SDP_UINT16, &end);\n\tproto[1] = sdp_list_append(proto[1], eh);\n\tapseq = sdp_list_append(apseq, proto[1]);\n\n\taproto = sdp_list_append(NULL, apseq);\n\tsdp_set_access_protos(record, aproto);\n\n\tsdp_data_free(psm);\n\tsdp_data_free(sh);\n\tsdp_data_free(eh);\n\tsdp_list_free(proto[0], NULL);\n\tsdp_list_free(proto[1], NULL);\n\tsdp_list_free(apseq, NULL);\n\tsdp_list_free(aproto, NULL);\n\n\treturn record;\n}",
    "includes": [
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"attrib/att-database.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"attrib/att.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"backtrace.h\"",
      "#include \"log.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <sys/stat.h>",
      "#include <glib.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdbool.h>",
      "#include <stdint.h>",
      "#include <errno.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "sdp_list_free",
          "args": [
            "aproto",
            "NULL"
          ],
          "line": 237
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_list_free",
          "args": [
            "apseq",
            "NULL"
          ],
          "line": 236
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_list_free",
          "args": [
            "proto[1]",
            "NULL"
          ],
          "line": 235
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_list_free",
          "args": [
            "proto[0]",
            "NULL"
          ],
          "line": 234
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_data_free",
          "args": [
            "eh"
          ],
          "line": 233
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_data_free",
          "args": [
            "sh"
          ],
          "line": 232
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_data_free",
          "args": [
            "psm"
          ],
          "line": 231
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_set_access_protos",
          "args": [
            "record",
            "aproto"
          ],
          "line": 229
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_list_append",
          "args": [
            "NULL",
            "apseq"
          ],
          "line": 228
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_list_append",
          "args": [
            "apseq",
            "proto[1]"
          ],
          "line": 226
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_list_append",
          "args": [
            "proto[1]",
            "eh"
          ],
          "line": 225
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_data_alloc",
          "args": [
            "SDP_UINT16",
            "&end"
          ],
          "line": 224
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_list_append",
          "args": [
            "proto[1]",
            "sh"
          ],
          "line": 223
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_data_alloc",
          "args": [
            "SDP_UINT16",
            "&start"
          ],
          "line": 222
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_list_append",
          "args": [
            "NULL",
            "&proto_uuid"
          ],
          "line": 221
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_uuid16_create",
          "args": [
            "&proto_uuid",
            "ATT_UUID"
          ],
          "line": 220
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_list_append",
          "args": [
            "NULL",
            "proto[0]"
          ],
          "line": 218
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_list_append",
          "args": [
            "proto[0]",
            "psm"
          ],
          "line": 217
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_data_alloc",
          "args": [
            "SDP_UINT16",
            "&lp"
          ],
          "line": 216
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_list_append",
          "args": [
            "NULL",
            "&l2cap"
          ],
          "line": 215
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_uuid16_create",
          "args": [
            "&l2cap",
            "L2CAP_UUID"
          ],
          "line": 214
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_list_free",
          "args": [
            "svclass_id",
            "NULL"
          ],
          "line": 212
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_set_service_classes",
          "args": [
            "record",
            "svclass_id"
          ],
          "line": 211
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_list_append",
          "args": [
            "NULL",
            "uuid"
          ],
          "line": 210
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_list_free",
          "args": [
            "root",
            "NULL"
          ],
          "line": 208
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_set_browse_groups",
          "args": [
            "record",
            "root"
          ],
          "line": 207
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_list_append",
          "args": [
            "NULL",
            "&root_uuid"
          ],
          "line": 206
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_uuid16_create",
          "args": [
            "&root_uuid",
            "PUBLIC_BROWSE_GROUP"
          ],
          "line": 205
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_record_alloc",
          "args": [],
          "line": 201
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"attrib/att-database.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"src/shared/util.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <sys/stat.h>\n#include <glib.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdbool.h>\n#include <stdint.h>\n#include <errno.h>\n#include <config.h>\n\nstatic sdp_record_t *server_record_new(uuid_t *uuid, uint16_t start, uint16_t end)\n{\n\tsdp_list_t *svclass_id, *apseq, *proto[2], *root, *aproto;\n\tuuid_t root_uuid, proto_uuid, l2cap;\n\tsdp_record_t *record;\n\tsdp_data_t *psm, *sh, *eh;\n\tuint16_t lp = ATT_PSM;\n\n\tif (uuid == NULL)\n\t\treturn NULL;\n\n\tif (start > end)\n\t\treturn NULL;\n\n\trecord = sdp_record_alloc();\n\tif (record == NULL)\n\t\treturn NULL;\n\n\tsdp_uuid16_create(&root_uuid, PUBLIC_BROWSE_GROUP);\n\troot = sdp_list_append(NULL, &root_uuid);\n\tsdp_set_browse_groups(record, root);\n\tsdp_list_free(root, NULL);\n\n\tsvclass_id = sdp_list_append(NULL, uuid);\n\tsdp_set_service_classes(record, svclass_id);\n\tsdp_list_free(svclass_id, NULL);\n\n\tsdp_uuid16_create(&l2cap, L2CAP_UUID);\n\tproto[0] = sdp_list_append(NULL, &l2cap);\n\tpsm = sdp_data_alloc(SDP_UINT16, &lp);\n\tproto[0] = sdp_list_append(proto[0], psm);\n\tapseq = sdp_list_append(NULL, proto[0]);\n\n\tsdp_uuid16_create(&proto_uuid, ATT_UUID);\n\tproto[1] = sdp_list_append(NULL, &proto_uuid);\n\tsh = sdp_data_alloc(SDP_UINT16, &start);\n\tproto[1] = sdp_list_append(proto[1], sh);\n\teh = sdp_data_alloc(SDP_UINT16, &end);\n\tproto[1] = sdp_list_append(proto[1], eh);\n\tapseq = sdp_list_append(apseq, proto[1]);\n\n\taproto = sdp_list_append(NULL, apseq);\n\tsdp_set_access_protos(record, aproto);\n\n\tsdp_data_free(psm);\n\tsdp_data_free(sh);\n\tsdp_data_free(eh);\n\tsdp_list_free(proto[0], NULL);\n\tsdp_list_free(proto[1], NULL);\n\tsdp_list_free(apseq, NULL);\n\tsdp_list_free(aproto, NULL);\n\n\treturn record;\n}"
  },
  {
    "function_name": "find_gatt_server",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/attrib-server.c",
    "lines": "171-185",
    "snippet": "static struct gatt_server *find_gatt_server(const bdaddr_t *bdaddr)\n{\n\tGSList *l;\n\n\tl = g_slist_find_custom(servers, bdaddr, adapter_cmp_addr);\n\tif (l == NULL) {\n\t\tchar addr[18];\n\n\t\tba2str(bdaddr, addr);\n\t\terror(\"No GATT server found in %s\", addr);\n\t\treturn NULL;\n\t}\n\n\treturn l->data;\n}",
    "includes": [
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"attrib/att-database.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"attrib/att.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"backtrace.h\"",
      "#include \"log.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <sys/stat.h>",
      "#include <glib.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdbool.h>",
      "#include <stdint.h>",
      "#include <errno.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static GSList *servers = NULL;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"No GATT server found in %s\"",
            "addr"
          ],
          "line": 180
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_failed",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "124-128",
          "snippet": "DBusMessage *btd_error_failed(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE\n\t\t\t\t\t\".Failed\", \"%s\", str);\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_failed(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE\n\t\t\t\t\t\".Failed\", \"%s\", str);\n}"
        }
      },
      {
        "call_info": {
          "callee": "ba2str",
          "args": [
            "bdaddr",
            "addr"
          ],
          "line": 179
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_slist_find_custom",
          "args": [
            "servers",
            "bdaddr",
            "adapter_cmp_addr"
          ],
          "line": 175
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"attrib/att-database.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"src/shared/util.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <sys/stat.h>\n#include <glib.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdbool.h>\n#include <stdint.h>\n#include <errno.h>\n#include <config.h>\n\nstatic GSList *servers = NULL;\n\nstatic struct gatt_server *find_gatt_server(const bdaddr_t *bdaddr)\n{\n\tGSList *l;\n\n\tl = g_slist_find_custom(servers, bdaddr, adapter_cmp_addr);\n\tif (l == NULL) {\n\t\tchar addr[18];\n\n\t\tba2str(bdaddr, addr);\n\t\terror(\"No GATT server found in %s\", addr);\n\t\treturn NULL;\n\t}\n\n\treturn l->data;\n}"
  },
  {
    "function_name": "adapter_cmp",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/attrib-server.c",
    "lines": "160-169",
    "snippet": "static int adapter_cmp(gconstpointer a, gconstpointer b)\n{\n\tconst struct gatt_server *server = a;\n\tconst struct btd_adapter *adapter = b;\n\n\tif (server->adapter == adapter)\n\t\treturn 0;\n\n\treturn -1;\n}",
    "includes": [
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"attrib/att-database.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"attrib/att.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"backtrace.h\"",
      "#include \"log.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <sys/stat.h>",
      "#include <glib.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdbool.h>",
      "#include <stdint.h>",
      "#include <errno.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"attrib/att-database.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"src/shared/util.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <sys/stat.h>\n#include <glib.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdbool.h>\n#include <stdint.h>\n#include <errno.h>\n#include <config.h>\n\nstatic int adapter_cmp(gconstpointer a, gconstpointer b)\n{\n\tconst struct gatt_server *server = a;\n\tconst struct btd_adapter *adapter = b;\n\n\tif (server->adapter == adapter)\n\t\treturn 0;\n\n\treturn -1;\n}"
  },
  {
    "function_name": "adapter_cmp_addr",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/attrib-server.c",
    "lines": "152-158",
    "snippet": "static int adapter_cmp_addr(gconstpointer a, gconstpointer b)\n{\n\tconst struct gatt_server *server = a;\n\tconst bdaddr_t *bdaddr = b;\n\n\treturn bacmp(btd_adapter_get_address(server->adapter), bdaddr);\n}",
    "includes": [
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"attrib/att-database.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"attrib/att.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"backtrace.h\"",
      "#include \"log.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <sys/stat.h>",
      "#include <glib.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdbool.h>",
      "#include <stdint.h>",
      "#include <errno.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "bacmp",
          "args": [
            "btd_adapter_get_address(server->adapter)",
            "bdaddr"
          ],
          "line": 157
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_adapter_get_address",
          "args": [
            "server->adapter"
          ],
          "line": 157
        },
        "resolved": true,
        "details": {
          "function_name": "btd_adapter_get_address",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "5881-5884",
          "snippet": "const bdaddr_t *btd_adapter_get_address(struct btd_adapter *adapter)\n{\n\treturn &adapter->bdaddr;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void trigger_pairable_timeout(struct btd_adapter *adapter);",
            "static void adapter_start(struct btd_adapter *adapter);",
            "static void adapter_stop(struct btd_adapter *adapter);",
            "static void trigger_passive_scanning(struct btd_adapter *adapter);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void trigger_pairable_timeout(struct btd_adapter *adapter);\nstatic void adapter_start(struct btd_adapter *adapter);\nstatic void adapter_stop(struct btd_adapter *adapter);\nstatic void trigger_passive_scanning(struct btd_adapter *adapter);\n\nconst bdaddr_t *btd_adapter_get_address(struct btd_adapter *adapter)\n{\n\treturn &adapter->bdaddr;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"attrib/att-database.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"src/shared/util.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <sys/stat.h>\n#include <glib.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdbool.h>\n#include <stdint.h>\n#include <errno.h>\n#include <config.h>\n\nstatic int adapter_cmp_addr(gconstpointer a, gconstpointer b)\n{\n\tconst struct gatt_server *server = a;\n\tconst bdaddr_t *bdaddr = b;\n\n\treturn bacmp(btd_adapter_get_address(server->adapter), bdaddr);\n}"
  },
  {
    "function_name": "gatt_server_free",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/attrib-server.c",
    "lines": "123-150",
    "snippet": "static void gatt_server_free(struct gatt_server *server)\n{\n\tg_list_free_full(server->database, attrib_free);\n\n\tif (server->l2cap_io != NULL) {\n\t\tg_io_channel_shutdown(server->l2cap_io, FALSE, NULL);\n\t\tg_io_channel_unref(server->l2cap_io);\n\t}\n\n\tif (server->le_io != NULL) {\n\t\tg_io_channel_shutdown(server->le_io, FALSE, NULL);\n\t\tg_io_channel_unref(server->le_io);\n\t}\n\n\tg_slist_free_full(server->clients, (GDestroyNotify) channel_free);\n\n\tif (server->gatt_sdp_handle > 0)\n\t\tadapter_service_remove(server->adapter,\n\t\t\t\t\tserver->gatt_sdp_handle);\n\n\tif (server->gap_sdp_handle > 0)\n\t\tadapter_service_remove(server->adapter, server->gap_sdp_handle);\n\n\tif (server->adapter != NULL)\n\t\tbtd_adapter_unref(server->adapter);\n\n\tg_free(server);\n}",
    "includes": [
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"attrib/att-database.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"attrib/att.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"backtrace.h\"",
      "#include \"log.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <sys/stat.h>",
      "#include <glib.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdbool.h>",
      "#include <stdint.h>",
      "#include <errno.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_free",
          "args": [
            "server"
          ],
          "line": 149
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_adapter_unref",
          "args": [
            "server->adapter"
          ],
          "line": 147
        },
        "resolved": true,
        "details": {
          "function_name": "btd_adapter_unref",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "4905-4921",
          "snippet": "void btd_adapter_unref(struct btd_adapter *adapter)\n{\n\tif (__sync_sub_and_fetch(&adapter->ref_count, 1))\n\t\treturn;\n\n\tif (!adapter->path) {\n\t\tDBG(\"Freeing adapter %u\", adapter->dev_id);\n\n\t\tadapter_free(adapter);\n\t\treturn;\n\t}\n\n\tDBG(\"Freeing adapter %s\", adapter->path);\n\n\tg_dbus_unregister_interface(dbus_conn, adapter->path,\n\t\t\t\t\t\tADAPTER_INTERFACE);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define ADAPTER_INTERFACE\t\"org.bluez.Adapter1\""
          ],
          "globals_used": [
            "static DBusConnection *dbus_conn = NULL;",
            "static void trigger_pairable_timeout(struct btd_adapter *adapter);",
            "static void adapter_start(struct btd_adapter *adapter);",
            "static void adapter_stop(struct btd_adapter *adapter);",
            "static void trigger_passive_scanning(struct btd_adapter *adapter);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\n#define ADAPTER_INTERFACE\t\"org.bluez.Adapter1\"\n\nstatic DBusConnection *dbus_conn = NULL;\nstatic void trigger_pairable_timeout(struct btd_adapter *adapter);\nstatic void adapter_start(struct btd_adapter *adapter);\nstatic void adapter_stop(struct btd_adapter *adapter);\nstatic void trigger_passive_scanning(struct btd_adapter *adapter);\n\nvoid btd_adapter_unref(struct btd_adapter *adapter)\n{\n\tif (__sync_sub_and_fetch(&adapter->ref_count, 1))\n\t\treturn;\n\n\tif (!adapter->path) {\n\t\tDBG(\"Freeing adapter %u\", adapter->dev_id);\n\n\t\tadapter_free(adapter);\n\t\treturn;\n\t}\n\n\tDBG(\"Freeing adapter %s\", adapter->path);\n\n\tg_dbus_unregister_interface(dbus_conn, adapter->path,\n\t\t\t\t\t\tADAPTER_INTERFACE);\n}"
        }
      },
      {
        "call_info": {
          "callee": "adapter_service_remove",
          "args": [
            "server->adapter",
            "server->gap_sdp_handle"
          ],
          "line": 144
        },
        "resolved": true,
        "details": {
          "function_name": "adapter_service_remove",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "1144-1159",
          "snippet": "void adapter_service_remove(struct btd_adapter *adapter, uint32_t handle)\n{\n\tsdp_record_t *rec = sdp_record_find(handle);\n\n\tDBG(\"%s\", adapter->path);\n\n\tif (!rec)\n\t\treturn;\n\n\tadapter->services = sdp_list_remove(adapter->services, rec);\n\n\tif (sdp_list_find(adapter->services, &rec->svclass, uuid_cmp) == NULL)\n\t\tremove_uuid(adapter, &rec->svclass);\n\n\tremove_record_from_server(rec->handle);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void trigger_pairable_timeout(struct btd_adapter *adapter);",
            "static void adapter_start(struct btd_adapter *adapter);",
            "static void adapter_stop(struct btd_adapter *adapter);",
            "static void trigger_passive_scanning(struct btd_adapter *adapter);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void trigger_pairable_timeout(struct btd_adapter *adapter);\nstatic void adapter_start(struct btd_adapter *adapter);\nstatic void adapter_stop(struct btd_adapter *adapter);\nstatic void trigger_passive_scanning(struct btd_adapter *adapter);\n\nvoid adapter_service_remove(struct btd_adapter *adapter, uint32_t handle)\n{\n\tsdp_record_t *rec = sdp_record_find(handle);\n\n\tDBG(\"%s\", adapter->path);\n\n\tif (!rec)\n\t\treturn;\n\n\tadapter->services = sdp_list_remove(adapter->services, rec);\n\n\tif (sdp_list_find(adapter->services, &rec->svclass, uuid_cmp) == NULL)\n\t\tremove_uuid(adapter, &rec->svclass);\n\n\tremove_record_from_server(rec->handle);\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_slist_free_full",
          "args": [
            "server->clients",
            "(GDestroyNotify) channel_free"
          ],
          "line": 137
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_io_channel_unref",
          "args": [
            "server->le_io"
          ],
          "line": 134
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_io_channel_shutdown",
          "args": [
            "server->le_io",
            "FALSE",
            "NULL"
          ],
          "line": 133
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_io_channel_unref",
          "args": [
            "server->l2cap_io"
          ],
          "line": 129
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_io_channel_shutdown",
          "args": [
            "server->l2cap_io",
            "FALSE",
            "NULL"
          ],
          "line": 128
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_list_free_full",
          "args": [
            "server->database",
            "attrib_free"
          ],
          "line": 125
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"attrib/att-database.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"src/shared/util.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <sys/stat.h>\n#include <glib.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdbool.h>\n#include <stdint.h>\n#include <errno.h>\n#include <config.h>\n\nstatic void gatt_server_free(struct gatt_server *server)\n{\n\tg_list_free_full(server->database, attrib_free);\n\n\tif (server->l2cap_io != NULL) {\n\t\tg_io_channel_shutdown(server->l2cap_io, FALSE, NULL);\n\t\tg_io_channel_unref(server->l2cap_io);\n\t}\n\n\tif (server->le_io != NULL) {\n\t\tg_io_channel_shutdown(server->le_io, FALSE, NULL);\n\t\tg_io_channel_unref(server->le_io);\n\t}\n\n\tg_slist_free_full(server->clients, (GDestroyNotify) channel_free);\n\n\tif (server->gatt_sdp_handle > 0)\n\t\tadapter_service_remove(server->adapter,\n\t\t\t\t\tserver->gatt_sdp_handle);\n\n\tif (server->gap_sdp_handle > 0)\n\t\tadapter_service_remove(server->adapter, server->gap_sdp_handle);\n\n\tif (server->adapter != NULL)\n\t\tbtd_adapter_unref(server->adapter);\n\n\tg_free(server);\n}"
  },
  {
    "function_name": "channel_free",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/attrib-server.c",
    "lines": "110-121",
    "snippet": "static void channel_free(struct gatt_channel *channel)\n{\n\n\tif (channel->cleanup_id)\n\t\tg_source_remove(channel->cleanup_id);\n\n\tif (channel->device)\n\t\tbtd_device_unref(channel->device);\n\n\tg_attrib_unref(channel->attrib);\n\tg_free(channel);\n}",
    "includes": [
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"attrib/att-database.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"attrib/att.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"backtrace.h\"",
      "#include \"log.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <sys/stat.h>",
      "#include <glib.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdbool.h>",
      "#include <stdint.h>",
      "#include <errno.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_free",
          "args": [
            "channel"
          ],
          "line": 120
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_attrib_unref",
          "args": [
            "channel->attrib"
          ],
          "line": 119
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_device_unref",
          "args": [
            "channel->device"
          ],
          "line": 117
        },
        "resolved": true,
        "details": {
          "function_name": "btd_device_unref",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "6364-6377",
          "snippet": "void btd_device_unref(struct btd_device *device)\n{\n\tif (__sync_sub_and_fetch(&device->ref_count, 1))\n\t\treturn;\n\n\tif (!device->path) {\n\t\terror(\"freeing device without an object path\");\n\t\treturn;\n\t}\n\n\tDBG(\"Freeing device %s\", device->path);\n\n\tg_dbus_unregister_interface(dbus_conn, device->path, DEVICE_INTERFACE);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static DBusConnection *dbus_conn = NULL;",
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *dbus_conn = NULL;\nstatic void gatt_client_init(struct btd_device *device);\n\nvoid btd_device_unref(struct btd_device *device)\n{\n\tif (__sync_sub_and_fetch(&device->ref_count, 1))\n\t\treturn;\n\n\tif (!device->path) {\n\t\terror(\"freeing device without an object path\");\n\t\treturn;\n\t}\n\n\tDBG(\"Freeing device %s\", device->path);\n\n\tg_dbus_unregister_interface(dbus_conn, device->path, DEVICE_INTERFACE);\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_source_remove",
          "args": [
            "channel->cleanup_id"
          ],
          "line": 114
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"attrib/att-database.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"src/shared/util.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <sys/stat.h>\n#include <glib.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdbool.h>\n#include <stdint.h>\n#include <errno.h>\n#include <config.h>\n\nstatic void channel_free(struct gatt_channel *channel)\n{\n\n\tif (channel->cleanup_id)\n\t\tg_source_remove(channel->cleanup_id);\n\n\tif (channel->device)\n\t\tbtd_device_unref(channel->device);\n\n\tg_attrib_unref(channel->attrib);\n\tg_free(channel);\n}"
  },
  {
    "function_name": "attrib_free",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/attrib-server.c",
    "lines": "102-108",
    "snippet": "static void attrib_free(void *data)\n{\n\tstruct attribute *a = data;\n\n\tg_free(a->data);\n\tg_free(a);\n}",
    "includes": [
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"attrib/att-database.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"attrib/att.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"backtrace.h\"",
      "#include \"log.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <sys/stat.h>",
      "#include <glib.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdbool.h>",
      "#include <stdint.h>",
      "#include <errno.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_free",
          "args": [
            "a"
          ],
          "line": 107
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_free",
          "args": [
            "a->data"
          ],
          "line": 106
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"attrib/att-database.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"src/shared/util.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <sys/stat.h>\n#include <glib.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdbool.h>\n#include <stdint.h>\n#include <errno.h>\n#include <config.h>\n\nstatic void attrib_free(void *data)\n{\n\tstruct attribute *a = data;\n\n\tg_free(a->data);\n\tg_free(a);\n}"
  }
]