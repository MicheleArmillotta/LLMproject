[
  {
    "function_name": "ringbuf_read",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ringbuf.c",
    "lines": "268-309",
    "snippet": "ssize_t ringbuf_read(struct ringbuf *ringbuf, int fd)\n{\n\tsize_t avail, offset, end;\n\tstruct iovec iov[2];\n\tssize_t consumed;\n\n\tif (!ringbuf || fd < 0)\n\t\treturn -1;\n\n\t/* Determine how much can actually be consumed */\n\tavail = ringbuf->size - ringbuf->in + ringbuf->out;\n\tif (!avail)\n\t\treturn -1;\n\n\t/* Determine how much to consume before wrapping */\n\toffset = ringbuf->in & (ringbuf->size - 1);\n\tend = MIN(avail, ringbuf->size - offset);\n\n\tiov[0].iov_base = ringbuf->buffer + offset;\n\tiov[0].iov_len = end;\n\n\t/* Now put the remainder into the second vector */\n\tiov[1].iov_base = ringbuf->buffer;\n\tiov[1].iov_len = avail - end;\n\n\tconsumed = readv(fd, iov, 2);\n\tif (consumed < 0)\n\t\treturn -1;\n\n\tif (ringbuf->in_tracing) {\n\t\tsize_t len = MIN((size_t) consumed, end);\n\t\tringbuf->in_tracing(ringbuf->buffer + offset, len,\n\t\t\t\t\t\t\tringbuf->in_data);\n\t\tif (consumed - len > 0)\n\t\t\tringbuf->in_tracing(ringbuf->buffer, consumed - len,\n\t\t\t\t\t\t\tringbuf->in_data);\n\t}\n\n\tringbuf->in += consumed;\n\n\treturn consumed;\n}",
    "includes": [
      "#include \"src/shared/ringbuf.h\"",
      "#include \"src/shared/util.h\"",
      "#include <sys/param.h>",
      "#include <sys/uio.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "ringbuf->in_tracing",
          "args": [
            "ringbuf->buffer",
            "consumed - len",
            "ringbuf->in_data"
          ],
          "line": 302
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ringbuf->in_tracing",
          "args": [
            "ringbuf->buffer + offset",
            "len",
            "ringbuf->in_data"
          ],
          "line": 299
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "MIN",
          "args": [
            "(size_t) consumed",
            "end"
          ],
          "line": 298
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "readv",
          "args": [
            "fd",
            "iov",
            "2"
          ],
          "line": 293
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "MIN",
          "args": [
            "avail",
            "ringbuf->size - offset"
          ],
          "line": 284
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <sys/param.h>\n#include <sys/uio.h>\n#include <string.h>\n#include <stdio.h>\n#include <config.h>\n\nssize_t ringbuf_read(struct ringbuf *ringbuf, int fd)\n{\n\tsize_t avail, offset, end;\n\tstruct iovec iov[2];\n\tssize_t consumed;\n\n\tif (!ringbuf || fd < 0)\n\t\treturn -1;\n\n\t/* Determine how much can actually be consumed */\n\tavail = ringbuf->size - ringbuf->in + ringbuf->out;\n\tif (!avail)\n\t\treturn -1;\n\n\t/* Determine how much to consume before wrapping */\n\toffset = ringbuf->in & (ringbuf->size - 1);\n\tend = MIN(avail, ringbuf->size - offset);\n\n\tiov[0].iov_base = ringbuf->buffer + offset;\n\tiov[0].iov_len = end;\n\n\t/* Now put the remainder into the second vector */\n\tiov[1].iov_base = ringbuf->buffer;\n\tiov[1].iov_len = avail - end;\n\n\tconsumed = readv(fd, iov, 2);\n\tif (consumed < 0)\n\t\treturn -1;\n\n\tif (ringbuf->in_tracing) {\n\t\tsize_t len = MIN((size_t) consumed, end);\n\t\tringbuf->in_tracing(ringbuf->buffer + offset, len,\n\t\t\t\t\t\t\tringbuf->in_data);\n\t\tif (consumed - len > 0)\n\t\t\tringbuf->in_tracing(ringbuf->buffer, consumed - len,\n\t\t\t\t\t\t\tringbuf->in_data);\n\t}\n\n\tringbuf->in += consumed;\n\n\treturn consumed;\n}"
  },
  {
    "function_name": "ringbuf_vprintf",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ringbuf.c",
    "lines": "220-266",
    "snippet": "int ringbuf_vprintf(struct ringbuf *ringbuf, const char *format, va_list ap)\n{\n\tsize_t avail, offset, end;\n\tchar *str;\n\tint len;\n\n\tif (!ringbuf || !format)\n\t\treturn -1;\n\n\t/* Determine maximum length available for string */\n\tavail = ringbuf->size - ringbuf->in + ringbuf->out;\n\tif (!avail)\n\t\treturn -1;\n\n\tlen = vasprintf(&str, format, ap);\n\tif (len < 0)\n\t\treturn -1;\n\n\tif ((size_t) len > avail) {\n\t\tfree(str);\n\t\treturn -1;\n\t}\n\n\t/* Determine possible length of string before wrapping */\n\toffset = ringbuf->in & (ringbuf->size - 1);\n\tend = MIN((size_t) len, ringbuf->size - offset);\n\tmemcpy(ringbuf->buffer + offset, str, end);\n\n\tif (ringbuf->in_tracing)\n\t\tringbuf->in_tracing(ringbuf->buffer + offset, end,\n\t\t\t\t\t\t\tringbuf->in_data);\n\n\tif (len - end > 0) {\n\t\t/* Put the remainder of string at the beginning */\n\t\tmemcpy(ringbuf->buffer, str + end, len - end);\n\n\t\tif (ringbuf->in_tracing)\n\t\t\tringbuf->in_tracing(ringbuf->buffer, len - end,\n\t\t\t\t\t\t\tringbuf->in_data);\n\t}\n\n\tfree(str);\n\n\tringbuf->in += len;\n\n\treturn len;\n}",
    "includes": [
      "#include \"src/shared/ringbuf.h\"",
      "#include \"src/shared/util.h\"",
      "#include <sys/param.h>",
      "#include <sys/uio.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "str"
          ],
          "line": 261
        },
        "resolved": true,
        "details": {
          "function_name": "ringbuf_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ringbuf.c",
          "lines": "88-95",
          "snippet": "void ringbuf_free(struct ringbuf *ringbuf)\n{\n\tif (!ringbuf)\n\t\treturn;\n\n\tfree(ringbuf->buffer);\n\tfree(ringbuf);\n}",
          "includes": [
            "#include \"src/shared/ringbuf.h\"",
            "#include \"src/shared/util.h\"",
            "#include <sys/param.h>",
            "#include <sys/uio.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <sys/param.h>\n#include <sys/uio.h>\n#include <string.h>\n#include <stdio.h>\n#include <config.h>\n\nvoid ringbuf_free(struct ringbuf *ringbuf)\n{\n\tif (!ringbuf)\n\t\treturn;\n\n\tfree(ringbuf->buffer);\n\tfree(ringbuf);\n}"
        }
      },
      {
        "call_info": {
          "callee": "ringbuf->in_tracing",
          "args": [
            "ringbuf->buffer",
            "len - end",
            "ringbuf->in_data"
          ],
          "line": 257
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memcpy",
          "args": [
            "ringbuf->buffer",
            "str + end",
            "len - end"
          ],
          "line": 254
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ringbuf->in_tracing",
          "args": [
            "ringbuf->buffer + offset",
            "end",
            "ringbuf->in_data"
          ],
          "line": 249
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memcpy",
          "args": [
            "ringbuf->buffer + offset",
            "str",
            "end"
          ],
          "line": 246
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "MIN",
          "args": [
            "(size_t) len",
            "ringbuf->size - offset"
          ],
          "line": 245
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "vasprintf",
          "args": [
            "&str",
            "format",
            "ap"
          ],
          "line": 234
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <sys/param.h>\n#include <sys/uio.h>\n#include <string.h>\n#include <stdio.h>\n#include <config.h>\n\nint ringbuf_vprintf(struct ringbuf *ringbuf, const char *format, va_list ap)\n{\n\tsize_t avail, offset, end;\n\tchar *str;\n\tint len;\n\n\tif (!ringbuf || !format)\n\t\treturn -1;\n\n\t/* Determine maximum length available for string */\n\tavail = ringbuf->size - ringbuf->in + ringbuf->out;\n\tif (!avail)\n\t\treturn -1;\n\n\tlen = vasprintf(&str, format, ap);\n\tif (len < 0)\n\t\treturn -1;\n\n\tif ((size_t) len > avail) {\n\t\tfree(str);\n\t\treturn -1;\n\t}\n\n\t/* Determine possible length of string before wrapping */\n\toffset = ringbuf->in & (ringbuf->size - 1);\n\tend = MIN((size_t) len, ringbuf->size - offset);\n\tmemcpy(ringbuf->buffer + offset, str, end);\n\n\tif (ringbuf->in_tracing)\n\t\tringbuf->in_tracing(ringbuf->buffer + offset, end,\n\t\t\t\t\t\t\tringbuf->in_data);\n\n\tif (len - end > 0) {\n\t\t/* Put the remainder of string at the beginning */\n\t\tmemcpy(ringbuf->buffer, str + end, len - end);\n\n\t\tif (ringbuf->in_tracing)\n\t\t\tringbuf->in_tracing(ringbuf->buffer, len - end,\n\t\t\t\t\t\t\tringbuf->in_data);\n\t}\n\n\tfree(str);\n\n\tringbuf->in += len;\n\n\treturn len;\n}"
  },
  {
    "function_name": "ringbuf_printf",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ringbuf.c",
    "lines": "208-218",
    "snippet": "int ringbuf_printf(struct ringbuf *ringbuf, const char *format, ...)\n{\n\tva_list ap;\n\tint len;\n\n\tva_start(ap, format);\n\tlen = ringbuf_vprintf(ringbuf, format, ap);\n\tva_end(ap);\n\n\treturn len;\n}",
    "includes": [
      "#include \"src/shared/ringbuf.h\"",
      "#include \"src/shared/util.h\"",
      "#include <sys/param.h>",
      "#include <sys/uio.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "va_end",
          "args": [
            "ap"
          ],
          "line": 215
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ringbuf_vprintf",
          "args": [
            "ringbuf",
            "format",
            "ap"
          ],
          "line": 214
        },
        "resolved": true,
        "details": {
          "function_name": "ringbuf_vprintf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ringbuf.c",
          "lines": "220-266",
          "snippet": "int ringbuf_vprintf(struct ringbuf *ringbuf, const char *format, va_list ap)\n{\n\tsize_t avail, offset, end;\n\tchar *str;\n\tint len;\n\n\tif (!ringbuf || !format)\n\t\treturn -1;\n\n\t/* Determine maximum length available for string */\n\tavail = ringbuf->size - ringbuf->in + ringbuf->out;\n\tif (!avail)\n\t\treturn -1;\n\n\tlen = vasprintf(&str, format, ap);\n\tif (len < 0)\n\t\treturn -1;\n\n\tif ((size_t) len > avail) {\n\t\tfree(str);\n\t\treturn -1;\n\t}\n\n\t/* Determine possible length of string before wrapping */\n\toffset = ringbuf->in & (ringbuf->size - 1);\n\tend = MIN((size_t) len, ringbuf->size - offset);\n\tmemcpy(ringbuf->buffer + offset, str, end);\n\n\tif (ringbuf->in_tracing)\n\t\tringbuf->in_tracing(ringbuf->buffer + offset, end,\n\t\t\t\t\t\t\tringbuf->in_data);\n\n\tif (len - end > 0) {\n\t\t/* Put the remainder of string at the beginning */\n\t\tmemcpy(ringbuf->buffer, str + end, len - end);\n\n\t\tif (ringbuf->in_tracing)\n\t\t\tringbuf->in_tracing(ringbuf->buffer, len - end,\n\t\t\t\t\t\t\tringbuf->in_data);\n\t}\n\n\tfree(str);\n\n\tringbuf->in += len;\n\n\treturn len;\n}",
          "includes": [
            "#include \"src/shared/ringbuf.h\"",
            "#include \"src/shared/util.h\"",
            "#include <sys/param.h>",
            "#include <sys/uio.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <sys/param.h>\n#include <sys/uio.h>\n#include <string.h>\n#include <stdio.h>\n#include <config.h>\n\nint ringbuf_vprintf(struct ringbuf *ringbuf, const char *format, va_list ap)\n{\n\tsize_t avail, offset, end;\n\tchar *str;\n\tint len;\n\n\tif (!ringbuf || !format)\n\t\treturn -1;\n\n\t/* Determine maximum length available for string */\n\tavail = ringbuf->size - ringbuf->in + ringbuf->out;\n\tif (!avail)\n\t\treturn -1;\n\n\tlen = vasprintf(&str, format, ap);\n\tif (len < 0)\n\t\treturn -1;\n\n\tif ((size_t) len > avail) {\n\t\tfree(str);\n\t\treturn -1;\n\t}\n\n\t/* Determine possible length of string before wrapping */\n\toffset = ringbuf->in & (ringbuf->size - 1);\n\tend = MIN((size_t) len, ringbuf->size - offset);\n\tmemcpy(ringbuf->buffer + offset, str, end);\n\n\tif (ringbuf->in_tracing)\n\t\tringbuf->in_tracing(ringbuf->buffer + offset, end,\n\t\t\t\t\t\t\tringbuf->in_data);\n\n\tif (len - end > 0) {\n\t\t/* Put the remainder of string at the beginning */\n\t\tmemcpy(ringbuf->buffer, str + end, len - end);\n\n\t\tif (ringbuf->in_tracing)\n\t\t\tringbuf->in_tracing(ringbuf->buffer, len - end,\n\t\t\t\t\t\t\tringbuf->in_data);\n\t}\n\n\tfree(str);\n\n\tringbuf->in += len;\n\n\treturn len;\n}"
        }
      },
      {
        "call_info": {
          "callee": "va_start",
          "args": [
            "ap",
            "format"
          ],
          "line": 213
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <sys/param.h>\n#include <sys/uio.h>\n#include <string.h>\n#include <stdio.h>\n#include <config.h>\n\nint ringbuf_printf(struct ringbuf *ringbuf, const char *format, ...)\n{\n\tva_list ap;\n\tint len;\n\n\tva_start(ap, format);\n\tlen = ringbuf_vprintf(ringbuf, format, ap);\n\tva_end(ap);\n\n\treturn len;\n}"
  },
  {
    "function_name": "ringbuf_avail",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ringbuf.c",
    "lines": "200-206",
    "snippet": "size_t ringbuf_avail(struct ringbuf *ringbuf)\n{\n\tif (!ringbuf)\n\t\treturn 0;\n\n\treturn ringbuf->size - ringbuf->in + ringbuf->out;\n}",
    "includes": [
      "#include \"src/shared/ringbuf.h\"",
      "#include \"src/shared/util.h\"",
      "#include <sys/param.h>",
      "#include <sys/uio.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <sys/param.h>\n#include <sys/uio.h>\n#include <string.h>\n#include <stdio.h>\n#include <config.h>\n\nsize_t ringbuf_avail(struct ringbuf *ringbuf)\n{\n\tif (!ringbuf)\n\t\treturn 0;\n\n\treturn ringbuf->size - ringbuf->in + ringbuf->out;\n}"
  },
  {
    "function_name": "ringbuf_write",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ringbuf.c",
    "lines": "161-198",
    "snippet": "ssize_t ringbuf_write(struct ringbuf *ringbuf, int fd)\n{\n\tsize_t len, offset, end;\n\tstruct iovec iov[2];\n\tssize_t consumed;\n\n\tif (!ringbuf || fd < 0)\n\t\treturn -1;\n\n\t/* Determine how much data is available */\n\tlen = ringbuf->in - ringbuf->out;\n\tif (!len)\n\t\treturn 0;\n\n\t/* Grab data from buffer starting at offset until the end */\n\toffset = ringbuf->out & (ringbuf->size - 1);\n\tend = MIN(len, ringbuf->size - offset);\n\n\tiov[0].iov_base = ringbuf->buffer + offset;\n\tiov[0].iov_len = end;\n\n\t/* Use second vector for remainder from the beginning */\n\tiov[1].iov_base = ringbuf->buffer;\n\tiov[1].iov_len = len - end;\n\n\tconsumed = writev(fd, iov, 2);\n\tif (consumed < 0)\n\t\treturn -1;\n\n\tringbuf->out += consumed;\n\n\tif (ringbuf->out == ringbuf->in) {\n\t\tringbuf->in = RINGBUF_RESET;\n\t\tringbuf->out = RINGBUF_RESET;\n\t}\n\n\treturn consumed;\n}",
    "includes": [
      "#include \"src/shared/ringbuf.h\"",
      "#include \"src/shared/util.h\"",
      "#include <sys/param.h>",
      "#include <sys/uio.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define RINGBUF_RESET 0"
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "writev",
          "args": [
            "fd",
            "iov",
            "2"
          ],
          "line": 186
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "MIN",
          "args": [
            "len",
            "ringbuf->size - offset"
          ],
          "line": 177
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <sys/param.h>\n#include <sys/uio.h>\n#include <string.h>\n#include <stdio.h>\n#include <config.h>\n\n#define RINGBUF_RESET 0\n\nssize_t ringbuf_write(struct ringbuf *ringbuf, int fd)\n{\n\tsize_t len, offset, end;\n\tstruct iovec iov[2];\n\tssize_t consumed;\n\n\tif (!ringbuf || fd < 0)\n\t\treturn -1;\n\n\t/* Determine how much data is available */\n\tlen = ringbuf->in - ringbuf->out;\n\tif (!len)\n\t\treturn 0;\n\n\t/* Grab data from buffer starting at offset until the end */\n\toffset = ringbuf->out & (ringbuf->size - 1);\n\tend = MIN(len, ringbuf->size - offset);\n\n\tiov[0].iov_base = ringbuf->buffer + offset;\n\tiov[0].iov_len = end;\n\n\t/* Use second vector for remainder from the beginning */\n\tiov[1].iov_base = ringbuf->buffer;\n\tiov[1].iov_len = len - end;\n\n\tconsumed = writev(fd, iov, 2);\n\tif (consumed < 0)\n\t\treturn -1;\n\n\tringbuf->out += consumed;\n\n\tif (ringbuf->out == ringbuf->in) {\n\t\tringbuf->in = RINGBUF_RESET;\n\t\tringbuf->out = RINGBUF_RESET;\n\t}\n\n\treturn consumed;\n}"
  },
  {
    "function_name": "ringbuf_peek",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ringbuf.c",
    "lines": "146-159",
    "snippet": "void *ringbuf_peek(struct ringbuf *ringbuf, size_t offset, size_t *len_nowrap)\n{\n\tif (!ringbuf)\n\t\treturn NULL;\n\n\toffset = (ringbuf->out + offset) & (ringbuf->size - 1);\n\n\tif (len_nowrap) {\n\t\tsize_t len = ringbuf->in - ringbuf->out;\n\t\t*len_nowrap = MIN(len, ringbuf->size - offset);\n\t}\n\n\treturn ringbuf->buffer + offset;\n}",
    "includes": [
      "#include \"src/shared/ringbuf.h\"",
      "#include \"src/shared/util.h\"",
      "#include <sys/param.h>",
      "#include <sys/uio.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "MIN",
          "args": [
            "len",
            "ringbuf->size - offset"
          ],
          "line": 155
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <sys/param.h>\n#include <sys/uio.h>\n#include <string.h>\n#include <stdio.h>\n#include <config.h>\n\nvoid *ringbuf_peek(struct ringbuf *ringbuf, size_t offset, size_t *len_nowrap)\n{\n\tif (!ringbuf)\n\t\treturn NULL;\n\n\toffset = (ringbuf->out + offset) & (ringbuf->size - 1);\n\n\tif (len_nowrap) {\n\t\tsize_t len = ringbuf->in - ringbuf->out;\n\t\t*len_nowrap = MIN(len, ringbuf->size - offset);\n\t}\n\n\treturn ringbuf->buffer + offset;\n}"
  },
  {
    "function_name": "ringbuf_drain",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ringbuf.c",
    "lines": "125-144",
    "snippet": "size_t ringbuf_drain(struct ringbuf *ringbuf, size_t count)\n{\n\tsize_t len;\n\n\tif (!ringbuf)\n\t\treturn 0;\n\n\tlen = MIN(count, ringbuf->in - ringbuf->out);\n\tif (!len)\n\t\treturn 0;\n\n\tringbuf->out += len;\n\n\tif (ringbuf->out == ringbuf->in) {\n\t\tringbuf->in = RINGBUF_RESET;\n\t\tringbuf->out = RINGBUF_RESET;\n\t}\n\n\treturn len;\n}",
    "includes": [
      "#include \"src/shared/ringbuf.h\"",
      "#include \"src/shared/util.h\"",
      "#include <sys/param.h>",
      "#include <sys/uio.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define RINGBUF_RESET 0"
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "MIN",
          "args": [
            "count",
            "ringbuf->in - ringbuf->out"
          ],
          "line": 132
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <sys/param.h>\n#include <sys/uio.h>\n#include <string.h>\n#include <stdio.h>\n#include <config.h>\n\n#define RINGBUF_RESET 0\n\nsize_t ringbuf_drain(struct ringbuf *ringbuf, size_t count)\n{\n\tsize_t len;\n\n\tif (!ringbuf)\n\t\treturn 0;\n\n\tlen = MIN(count, ringbuf->in - ringbuf->out);\n\tif (!len)\n\t\treturn 0;\n\n\tringbuf->out += len;\n\n\tif (ringbuf->out == ringbuf->in) {\n\t\tringbuf->in = RINGBUF_RESET;\n\t\tringbuf->out = RINGBUF_RESET;\n\t}\n\n\treturn len;\n}"
  },
  {
    "function_name": "ringbuf_len",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ringbuf.c",
    "lines": "117-123",
    "snippet": "size_t ringbuf_len(struct ringbuf *ringbuf)\n{\n\tif (!ringbuf)\n\t\treturn 0;\n\n\treturn ringbuf->in - ringbuf->out;\n}",
    "includes": [
      "#include \"src/shared/ringbuf.h\"",
      "#include \"src/shared/util.h\"",
      "#include <sys/param.h>",
      "#include <sys/uio.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <sys/param.h>\n#include <sys/uio.h>\n#include <string.h>\n#include <stdio.h>\n#include <config.h>\n\nsize_t ringbuf_len(struct ringbuf *ringbuf)\n{\n\tif (!ringbuf)\n\t\treturn 0;\n\n\treturn ringbuf->in - ringbuf->out;\n}"
  },
  {
    "function_name": "ringbuf_capacity",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ringbuf.c",
    "lines": "109-115",
    "snippet": "size_t ringbuf_capacity(struct ringbuf *ringbuf)\n{\n\tif (!ringbuf)\n\t\treturn 0;\n\n\treturn ringbuf->size;\n}",
    "includes": [
      "#include \"src/shared/ringbuf.h\"",
      "#include \"src/shared/util.h\"",
      "#include <sys/param.h>",
      "#include <sys/uio.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <sys/param.h>\n#include <sys/uio.h>\n#include <string.h>\n#include <stdio.h>\n#include <config.h>\n\nsize_t ringbuf_capacity(struct ringbuf *ringbuf)\n{\n\tif (!ringbuf)\n\t\treturn 0;\n\n\treturn ringbuf->size;\n}"
  },
  {
    "function_name": "ringbuf_set_input_tracing",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ringbuf.c",
    "lines": "97-107",
    "snippet": "bool ringbuf_set_input_tracing(struct ringbuf *ringbuf,\n\t\t\tringbuf_tracing_func_t callback, void *user_data)\n{\n\tif (!ringbuf)\n\t\treturn false;\n\n\tringbuf->in_tracing = callback;\n\tringbuf->in_data = user_data;\n\n\treturn true;\n}",
    "includes": [
      "#include \"src/shared/ringbuf.h\"",
      "#include \"src/shared/util.h\"",
      "#include <sys/param.h>",
      "#include <sys/uio.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <sys/param.h>\n#include <sys/uio.h>\n#include <string.h>\n#include <stdio.h>\n#include <config.h>\n\nbool ringbuf_set_input_tracing(struct ringbuf *ringbuf,\n\t\t\tringbuf_tracing_func_t callback, void *user_data)\n{\n\tif (!ringbuf)\n\t\treturn false;\n\n\tringbuf->in_tracing = callback;\n\tringbuf->in_data = user_data;\n\n\treturn true;\n}"
  },
  {
    "function_name": "ringbuf_free",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ringbuf.c",
    "lines": "88-95",
    "snippet": "void ringbuf_free(struct ringbuf *ringbuf)\n{\n\tif (!ringbuf)\n\t\treturn;\n\n\tfree(ringbuf->buffer);\n\tfree(ringbuf);\n}",
    "includes": [
      "#include \"src/shared/ringbuf.h\"",
      "#include \"src/shared/util.h\"",
      "#include <sys/param.h>",
      "#include <sys/uio.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "ringbuf"
          ],
          "line": 94
        },
        "resolved": true,
        "details": {
          "function_name": "ringbuf_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ringbuf.c",
          "lines": "88-95",
          "snippet": "void ringbuf_free(struct ringbuf *ringbuf)\n{\n\tif (!ringbuf)\n\t\treturn;\n\n\tfree(ringbuf->buffer);\n\tfree(ringbuf);\n}",
          "note": "cyclic_reference_detected"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <sys/param.h>\n#include <sys/uio.h>\n#include <string.h>\n#include <stdio.h>\n#include <config.h>\n\nvoid ringbuf_free(struct ringbuf *ringbuf)\n{\n\tif (!ringbuf)\n\t\treturn;\n\n\tfree(ringbuf->buffer);\n\tfree(ringbuf);\n}"
  },
  {
    "function_name": "ringbuf_new",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ringbuf.c",
    "lines": "63-86",
    "snippet": "struct ringbuf *ringbuf_new(size_t size)\n{\n\tstruct ringbuf *ringbuf;\n\tsize_t real_size;\n\n\tif (size < 2 || size > UINT_MAX)\n\t\treturn NULL;\n\n\t/* Find the next power of two for size */\n\treal_size = align_power2(size);\n\n\tringbuf = new0(struct ringbuf, 1);\n\tringbuf->buffer = malloc(real_size);\n\tif (!ringbuf->buffer) {\n\t\tfree(ringbuf);\n\t\treturn NULL;\n\t}\n\n\tringbuf->size = real_size;\n\tringbuf->in = RINGBUF_RESET;\n\tringbuf->out = RINGBUF_RESET;\n\n\treturn ringbuf;\n}",
    "includes": [
      "#include \"src/shared/ringbuf.h\"",
      "#include \"src/shared/util.h\"",
      "#include <sys/param.h>",
      "#include <sys/uio.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define RINGBUF_RESET 0"
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "ringbuf"
          ],
          "line": 77
        },
        "resolved": true,
        "details": {
          "function_name": "ringbuf_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ringbuf.c",
          "lines": "88-95",
          "snippet": "void ringbuf_free(struct ringbuf *ringbuf)\n{\n\tif (!ringbuf)\n\t\treturn;\n\n\tfree(ringbuf->buffer);\n\tfree(ringbuf);\n}",
          "includes": [
            "#include \"src/shared/ringbuf.h\"",
            "#include \"src/shared/util.h\"",
            "#include <sys/param.h>",
            "#include <sys/uio.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <sys/param.h>\n#include <sys/uio.h>\n#include <string.h>\n#include <stdio.h>\n#include <config.h>\n\nvoid ringbuf_free(struct ringbuf *ringbuf)\n{\n\tif (!ringbuf)\n\t\treturn;\n\n\tfree(ringbuf->buffer);\n\tfree(ringbuf);\n}"
        }
      },
      {
        "call_info": {
          "callee": "malloc",
          "args": [
            "real_size"
          ],
          "line": 75
        },
        "resolved": true,
        "details": {
          "function_name": "btd_malloc",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/util.c",
          "lines": "41-55",
          "snippet": "void *btd_malloc(size_t size)\n{\n\tif (__builtin_expect(!!size, 1)) {\n\t\tvoid *ptr;\n\n\t\tptr = malloc(size);\n\t\tif (ptr)\n\t\t\treturn ptr;\n\n\t\tfprintf(stderr, \"failed to allocate %zu bytes\\n\", size);\n\t\tabort();\n\t}\n\n\treturn NULL;\n}",
          "includes": [
            "#include \"src/shared/util.h\"",
            "#include <string.h>",
            "#include <limits.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <stdbool.h>",
            "#include <stdarg.h>",
            "#include <ctype.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/util.h\"\n#include <string.h>\n#include <limits.h>\n#include <dirent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <config.h>\n\nvoid *btd_malloc(size_t size)\n{\n\tif (__builtin_expect(!!size, 1)) {\n\t\tvoid *ptr;\n\n\t\tptr = malloc(size);\n\t\tif (ptr)\n\t\t\treturn ptr;\n\n\t\tfprintf(stderr, \"failed to allocate %zu bytes\\n\", size);\n\t\tabort();\n\t}\n\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "new0",
          "args": [
            "structringbuf",
            "1"
          ],
          "line": 74
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "align_power2",
          "args": [
            "size"
          ],
          "line": 72
        },
        "resolved": true,
        "details": {
          "function_name": "align_power2",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ringbuf.c",
          "lines": "58-61",
          "snippet": "static inline unsigned int align_power2(unsigned int u)\n{\n\treturn 1 << fls(u - 1);\n}",
          "includes": [
            "#include \"src/shared/ringbuf.h\"",
            "#include \"src/shared/util.h\"",
            "#include <sys/param.h>",
            "#include <sys/uio.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <sys/param.h>\n#include <sys/uio.h>\n#include <string.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic inline unsigned int align_power2(unsigned int u)\n{\n\treturn 1 << fls(u - 1);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <sys/param.h>\n#include <sys/uio.h>\n#include <string.h>\n#include <stdio.h>\n#include <config.h>\n\n#define RINGBUF_RESET 0\n\nstruct ringbuf *ringbuf_new(size_t size)\n{\n\tstruct ringbuf *ringbuf;\n\tsize_t real_size;\n\n\tif (size < 2 || size > UINT_MAX)\n\t\treturn NULL;\n\n\t/* Find the next power of two for size */\n\treal_size = align_power2(size);\n\n\tringbuf = new0(struct ringbuf, 1);\n\tringbuf->buffer = malloc(real_size);\n\tif (!ringbuf->buffer) {\n\t\tfree(ringbuf);\n\t\treturn NULL;\n\t}\n\n\tringbuf->size = real_size;\n\tringbuf->in = RINGBUF_RESET;\n\tringbuf->out = RINGBUF_RESET;\n\n\treturn ringbuf;\n}"
  },
  {
    "function_name": "align_power2",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ringbuf.c",
    "lines": "58-61",
    "snippet": "static inline unsigned int align_power2(unsigned int u)\n{\n\treturn 1 << fls(u - 1);\n}",
    "includes": [
      "#include \"src/shared/ringbuf.h\"",
      "#include \"src/shared/util.h\"",
      "#include <sys/param.h>",
      "#include <sys/uio.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "fls",
          "args": [
            "u - 1"
          ],
          "line": 60
        },
        "resolved": true,
        "details": {
          "function_name": "fls",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ringbuf.c",
          "lines": "52-55",
          "snippet": "static inline unsigned int fls(unsigned int x)\n{\n\treturn x ? sizeof(x) * 8 - __builtin_clz(x) : 0;\n}",
          "includes": [
            "#include \"src/shared/ringbuf.h\"",
            "#include \"src/shared/util.h\"",
            "#include <sys/param.h>",
            "#include <sys/uio.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <sys/param.h>\n#include <sys/uio.h>\n#include <string.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic inline unsigned int fls(unsigned int x)\n{\n\treturn x ? sizeof(x) * 8 - __builtin_clz(x) : 0;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <sys/param.h>\n#include <sys/uio.h>\n#include <string.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic inline unsigned int align_power2(unsigned int u)\n{\n\treturn 1 << fls(u - 1);\n}"
  },
  {
    "function_name": "fls",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ringbuf.c",
    "lines": "52-55",
    "snippet": "static inline unsigned int fls(unsigned int x)\n{\n\treturn x ? sizeof(x) * 8 - __builtin_clz(x) : 0;\n}",
    "includes": [
      "#include \"src/shared/ringbuf.h\"",
      "#include \"src/shared/util.h\"",
      "#include <sys/param.h>",
      "#include <sys/uio.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "__builtin_clz",
          "args": [
            "x"
          ],
          "line": 54
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <sys/param.h>\n#include <sys/uio.h>\n#include <string.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic inline unsigned int fls(unsigned int x)\n{\n\treturn x ? sizeof(x) * 8 - __builtin_clz(x) : 0;\n}"
  }
]