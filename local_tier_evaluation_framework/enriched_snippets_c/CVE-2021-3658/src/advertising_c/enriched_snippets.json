[
  {
    "function_name": "btd_adv_manager_refresh",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/advertising.c",
    "lines": "1369-1375",
    "snippet": "void btd_adv_manager_refresh(struct btd_adv_manager *manager)\n{\n\tif (!manager)\n\t\treturn;\n\n\tqueue_foreach(manager->clients, manager_refresh, NULL);\n}",
    "includes": [
      "#include \"advertising.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/mgmt.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"eir.h\"",
      "#include \"log.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"adapter.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <gdbus/gdbus.h>",
      "#include <dbus/dbus.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <stdint.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "queue_foreach",
          "args": [
            "manager->clients",
            "manager_refresh",
            "NULL"
          ],
          "line": 1374
        },
        "resolved": true,
        "details": {
          "function_name": "queue_foreach",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "203-224",
          "snippet": "void queue_foreach(struct queue *queue, queue_foreach_func_t function,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue || !function)\n\t\treturn;\n\n\tentry = queue->head;\n\tif (!entry)\n\t\treturn;\n\n\tqueue_ref(queue);\n\twhile (entry && queue->head && queue->ref_count > 1) {\n\t\tstruct queue_entry *next;\n\n\t\tnext = entry->next;\n\t\tfunction(entry->data, user_data);\n\t\tentry = next;\n\t}\n\tqueue_unref(queue);\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nvoid queue_foreach(struct queue *queue, queue_foreach_func_t function,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue || !function)\n\t\treturn;\n\n\tentry = queue->head;\n\tif (!entry)\n\t\treturn;\n\n\tqueue_ref(queue);\n\twhile (entry && queue->head && queue->ref_count > 1) {\n\t\tstruct queue_entry *next;\n\n\t\tnext = entry->next;\n\t\tfunction(entry->data, user_data);\n\t\tentry = next;\n\t}\n\tqueue_unref(queue);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"advertising.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/mgmt.h\"\n#include \"src/shared/ad.h\"\n#include \"eir.h\"\n#include \"log.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"adapter.h\"\n#include \"lib/sdp.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <gdbus/gdbus.h>\n#include <dbus/dbus.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <stdint.h>\n\nvoid btd_adv_manager_refresh(struct btd_adv_manager *manager)\n{\n\tif (!manager)\n\t\treturn;\n\n\tqueue_foreach(manager->clients, manager_refresh, NULL);\n}"
  },
  {
    "function_name": "manager_refresh",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/advertising.c",
    "lines": "1364-1367",
    "snippet": "static void manager_refresh(void *data, void *user_data)\n{\n\trefresh_adv(data, user_data);\n}",
    "includes": [
      "#include \"advertising.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/mgmt.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"eir.h\"",
      "#include \"log.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"adapter.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <gdbus/gdbus.h>",
      "#include <dbus/dbus.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <stdint.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "refresh_adv",
          "args": [
            "data",
            "user_data"
          ],
          "line": 1366
        },
        "resolved": true,
        "details": {
          "function_name": "refresh_adv",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/advertising.c",
          "lines": "762-830",
          "snippet": "static int refresh_adv(struct btd_adv_client *client, mgmt_request_func_t func)\n{\n\tstruct mgmt_cp_add_advertising *cp;\n\tuint8_t param_len;\n\tuint8_t *adv_data;\n\tsize_t adv_data_len;\n\tuint8_t *scan_rsp;\n\tsize_t scan_rsp_len = -1;\n\tuint32_t flags = 0;\n\n\tDBG(\"Refreshing advertisement: %s\", client->path);\n\n\tif (client->type == AD_TYPE_PERIPHERAL) {\n\t\tflags = MGMT_ADV_FLAG_CONNECTABLE;\n\n\t\tif (btd_adapter_get_discoverable(client->manager->adapter) &&\n\t\t\t\t!(bt_ad_has_flags(client->data)))\n\t\t\tflags |= MGMT_ADV_FLAG_DISCOV;\n\t}\n\n\tflags |= client->flags;\n\n\tadv_data = generate_adv_data(client, &flags, &adv_data_len);\n\tif (!adv_data || (adv_data_len > calc_max_adv_len(client, flags))) {\n\t\terror(\"Advertising data too long or couldn't be generated.\");\n\t\treturn -EINVAL;\n\t}\n\n\tscan_rsp = generate_scan_rsp(client, &flags, &scan_rsp_len);\n\tif (!scan_rsp && scan_rsp_len) {\n\t\terror(\"Scan data couldn't be generated.\");\n\t\tfree(adv_data);\n\t\treturn -EINVAL;\n\t}\n\n\tparam_len = sizeof(struct mgmt_cp_add_advertising) + adv_data_len +\n\t\t\t\t\t\t\tscan_rsp_len;\n\n\tcp = malloc0(param_len);\n\tif (!cp) {\n\t\terror(\"Couldn't allocate for MGMT!\");\n\t\tfree(adv_data);\n\t\tfree(scan_rsp);\n\t\treturn -ENOMEM;\n\t}\n\n\tcp->flags = htobl(flags);\n\tcp->instance = client->instance;\n\tcp->duration = client->duration;\n\tcp->adv_data_len = adv_data_len;\n\tcp->scan_rsp_len = scan_rsp_len;\n\tmemcpy(cp->data, adv_data, adv_data_len);\n\tmemcpy(cp->data + adv_data_len, scan_rsp, scan_rsp_len);\n\n\tfree(adv_data);\n\tfree(scan_rsp);\n\n\tif (!mgmt_send(client->manager->mgmt, MGMT_OP_ADD_ADVERTISING,\n\t\t\t\tclient->manager->mgmt_index, param_len, cp,\n\t\t\t\tfunc, client, NULL)) {\n\t\terror(\"Failed to add Advertising Data\");\n\t\tfree(cp);\n\t\treturn -EINVAL;\n\t}\n\n\tfree(cp);\n\n\treturn 0;\n}",
          "includes": [
            "#include \"advertising.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"eir.h\"",
            "#include \"log.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"adapter.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <gdbus/gdbus.h>",
            "#include <dbus/dbus.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <stdint.h>"
          ],
          "macros_used": [
            "#define AD_TYPE_PERIPHERAL 1"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"advertising.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/mgmt.h\"\n#include \"src/shared/ad.h\"\n#include \"eir.h\"\n#include \"log.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"adapter.h\"\n#include \"lib/sdp.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <gdbus/gdbus.h>\n#include <dbus/dbus.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <stdint.h>\n\n#define AD_TYPE_PERIPHERAL 1\n\nstatic int refresh_adv(struct btd_adv_client *client, mgmt_request_func_t func)\n{\n\tstruct mgmt_cp_add_advertising *cp;\n\tuint8_t param_len;\n\tuint8_t *adv_data;\n\tsize_t adv_data_len;\n\tuint8_t *scan_rsp;\n\tsize_t scan_rsp_len = -1;\n\tuint32_t flags = 0;\n\n\tDBG(\"Refreshing advertisement: %s\", client->path);\n\n\tif (client->type == AD_TYPE_PERIPHERAL) {\n\t\tflags = MGMT_ADV_FLAG_CONNECTABLE;\n\n\t\tif (btd_adapter_get_discoverable(client->manager->adapter) &&\n\t\t\t\t!(bt_ad_has_flags(client->data)))\n\t\t\tflags |= MGMT_ADV_FLAG_DISCOV;\n\t}\n\n\tflags |= client->flags;\n\n\tadv_data = generate_adv_data(client, &flags, &adv_data_len);\n\tif (!adv_data || (adv_data_len > calc_max_adv_len(client, flags))) {\n\t\terror(\"Advertising data too long or couldn't be generated.\");\n\t\treturn -EINVAL;\n\t}\n\n\tscan_rsp = generate_scan_rsp(client, &flags, &scan_rsp_len);\n\tif (!scan_rsp && scan_rsp_len) {\n\t\terror(\"Scan data couldn't be generated.\");\n\t\tfree(adv_data);\n\t\treturn -EINVAL;\n\t}\n\n\tparam_len = sizeof(struct mgmt_cp_add_advertising) + adv_data_len +\n\t\t\t\t\t\t\tscan_rsp_len;\n\n\tcp = malloc0(param_len);\n\tif (!cp) {\n\t\terror(\"Couldn't allocate for MGMT!\");\n\t\tfree(adv_data);\n\t\tfree(scan_rsp);\n\t\treturn -ENOMEM;\n\t}\n\n\tcp->flags = htobl(flags);\n\tcp->instance = client->instance;\n\tcp->duration = client->duration;\n\tcp->adv_data_len = adv_data_len;\n\tcp->scan_rsp_len = scan_rsp_len;\n\tmemcpy(cp->data, adv_data, adv_data_len);\n\tmemcpy(cp->data + adv_data_len, scan_rsp, scan_rsp_len);\n\n\tfree(adv_data);\n\tfree(scan_rsp);\n\n\tif (!mgmt_send(client->manager->mgmt, MGMT_OP_ADD_ADVERTISING,\n\t\t\t\tclient->manager->mgmt_index, param_len, cp,\n\t\t\t\tfunc, client, NULL)) {\n\t\terror(\"Failed to add Advertising Data\");\n\t\tfree(cp);\n\t\treturn -EINVAL;\n\t}\n\n\tfree(cp);\n\n\treturn 0;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"advertising.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/mgmt.h\"\n#include \"src/shared/ad.h\"\n#include \"eir.h\"\n#include \"log.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"adapter.h\"\n#include \"lib/sdp.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <gdbus/gdbus.h>\n#include <dbus/dbus.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <stdint.h>\n\nstatic void manager_refresh(void *data, void *user_data)\n{\n\trefresh_adv(data, user_data);\n}"
  },
  {
    "function_name": "btd_adv_manager_destroy",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/advertising.c",
    "lines": "1352-1362",
    "snippet": "void btd_adv_manager_destroy(struct btd_adv_manager *manager)\n{\n\tif (!manager)\n\t\treturn;\n\n\tg_dbus_unregister_interface(btd_get_dbus_connection(),\n\t\t\t\t\tadapter_get_path(manager->adapter),\n\t\t\t\t\tLE_ADVERTISING_MGR_IFACE);\n\n\tmanager_destroy(manager);\n}",
    "includes": [
      "#include \"advertising.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/mgmt.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"eir.h\"",
      "#include \"log.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"adapter.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <gdbus/gdbus.h>",
      "#include <dbus/dbus.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <stdint.h>"
    ],
    "macros_used": [
      "#define LE_ADVERTISING_MGR_IFACE \"org.bluez.LEAdvertisingManager1\""
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "manager_destroy",
          "args": [
            "manager"
          ],
          "line": 1361
        },
        "resolved": true,
        "details": {
          "function_name": "btd_adv_manager_destroy",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/advertising.c",
          "lines": "1352-1362",
          "snippet": "void btd_adv_manager_destroy(struct btd_adv_manager *manager)\n{\n\tif (!manager)\n\t\treturn;\n\n\tg_dbus_unregister_interface(btd_get_dbus_connection(),\n\t\t\t\t\tadapter_get_path(manager->adapter),\n\t\t\t\t\tLE_ADVERTISING_MGR_IFACE);\n\n\tmanager_destroy(manager);\n}",
          "note": "cyclic_reference_detected"
        }
      },
      {
        "call_info": {
          "callee": "g_dbus_unregister_interface",
          "args": [
            "btd_get_dbus_connection()",
            "adapter_get_path(manager->adapter)",
            "LE_ADVERTISING_MGR_IFACE"
          ],
          "line": 1357
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "adapter_get_path",
          "args": [
            "manager->adapter"
          ],
          "line": 1358
        },
        "resolved": true,
        "details": {
          "function_name": "adapter_get_path",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "5873-5879",
          "snippet": "const char *adapter_get_path(struct btd_adapter *adapter)\n{\n\tif (!adapter)\n\t\treturn NULL;\n\n\treturn adapter->path;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void trigger_pairable_timeout(struct btd_adapter *adapter);",
            "static void adapter_start(struct btd_adapter *adapter);",
            "static void adapter_stop(struct btd_adapter *adapter);",
            "static void trigger_passive_scanning(struct btd_adapter *adapter);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void trigger_pairable_timeout(struct btd_adapter *adapter);\nstatic void adapter_start(struct btd_adapter *adapter);\nstatic void adapter_stop(struct btd_adapter *adapter);\nstatic void trigger_passive_scanning(struct btd_adapter *adapter);\n\nconst char *adapter_get_path(struct btd_adapter *adapter)\n{\n\tif (!adapter)\n\t\treturn NULL;\n\n\treturn adapter->path;\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_get_dbus_connection",
          "args": [],
          "line": 1357
        },
        "resolved": true,
        "details": {
          "function_name": "btd_get_dbus_connection",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/dbus-common.c",
          "lines": "61-64",
          "snippet": "DBusConnection *btd_get_dbus_connection(void)\n{\n\treturn connection;\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <stdint.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static DBusConnection *connection = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <stdint.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *connection = NULL;\n\nDBusConnection *btd_get_dbus_connection(void)\n{\n\treturn connection;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"advertising.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/mgmt.h\"\n#include \"src/shared/ad.h\"\n#include \"eir.h\"\n#include \"log.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"adapter.h\"\n#include \"lib/sdp.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <gdbus/gdbus.h>\n#include <dbus/dbus.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <stdint.h>\n\n#define LE_ADVERTISING_MGR_IFACE \"org.bluez.LEAdvertisingManager1\"\n\nvoid btd_adv_manager_destroy(struct btd_adv_manager *manager)\n{\n\tif (!manager)\n\t\treturn;\n\n\tg_dbus_unregister_interface(btd_get_dbus_connection(),\n\t\t\t\t\tadapter_get_path(manager->adapter),\n\t\t\t\t\tLE_ADVERTISING_MGR_IFACE);\n\n\tmanager_destroy(manager);\n}"
  },
  {
    "function_name": "btd_adv_manager_new",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/advertising.c",
    "lines": "1334-1350",
    "snippet": "struct btd_adv_manager *btd_adv_manager_new(struct btd_adapter *adapter,\n\t\t\t\t\t\t\tstruct mgmt *mgmt)\n{\n\tstruct btd_adv_manager *manager;\n\n\tif (!adapter || !mgmt)\n\t\treturn NULL;\n\n\tmanager = manager_create(adapter, mgmt);\n\tif (!manager)\n\t\treturn NULL;\n\n\tDBG(\"LE Advertising Manager created for adapter: %s\",\n\t\t\t\t\t\tadapter_get_path(adapter));\n\n\treturn manager;\n}",
    "includes": [
      "#include \"advertising.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/mgmt.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"eir.h\"",
      "#include \"log.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"adapter.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <gdbus/gdbus.h>",
      "#include <dbus/dbus.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <stdint.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"LE Advertising Manager created for adapter: %s\"",
            "adapter_get_path(adapter)"
          ],
          "line": 1346
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "adapter_get_path",
          "args": [
            "adapter"
          ],
          "line": 1347
        },
        "resolved": true,
        "details": {
          "function_name": "adapter_get_path",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "5873-5879",
          "snippet": "const char *adapter_get_path(struct btd_adapter *adapter)\n{\n\tif (!adapter)\n\t\treturn NULL;\n\n\treturn adapter->path;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void trigger_pairable_timeout(struct btd_adapter *adapter);",
            "static void adapter_start(struct btd_adapter *adapter);",
            "static void adapter_stop(struct btd_adapter *adapter);",
            "static void trigger_passive_scanning(struct btd_adapter *adapter);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void trigger_pairable_timeout(struct btd_adapter *adapter);\nstatic void adapter_start(struct btd_adapter *adapter);\nstatic void adapter_stop(struct btd_adapter *adapter);\nstatic void trigger_passive_scanning(struct btd_adapter *adapter);\n\nconst char *adapter_get_path(struct btd_adapter *adapter)\n{\n\tif (!adapter)\n\t\treturn NULL;\n\n\treturn adapter->path;\n}"
        }
      },
      {
        "call_info": {
          "callee": "manager_create",
          "args": [
            "adapter",
            "mgmt"
          ],
          "line": 1342
        },
        "resolved": true,
        "details": {
          "function_name": "manager_create",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/advertising.c",
          "lines": "1292-1332",
          "snippet": "static struct btd_adv_manager *manager_create(struct btd_adapter *adapter,\n\t\t\t\t\t\tstruct mgmt *mgmt)\n{\n\tstruct btd_adv_manager *manager;\n\n\tmanager = new0(struct btd_adv_manager, 1);\n\tmanager->adapter = adapter;\n\n\tmanager->mgmt = mgmt_ref(mgmt);\n\n\tif (!manager->mgmt) {\n\t\terror(\"Failed to access management interface\");\n\t\tfree(manager);\n\t\treturn NULL;\n\t}\n\n\tmanager->mgmt_index = btd_adapter_get_index(adapter);\n\tmanager->clients = queue_new();\n\tmanager->supported_flags = MGMT_ADV_FLAG_LOCAL_NAME;\n\n\tif (!g_dbus_register_interface(btd_get_dbus_connection(),\n\t\t\t\t\tadapter_get_path(manager->adapter),\n\t\t\t\t\tLE_ADVERTISING_MGR_IFACE, methods,\n\t\t\t\t\tNULL, properties, manager, NULL)) {\n\t\terror(\"Failed to register \" LE_ADVERTISING_MGR_IFACE);\n\t\tgoto fail;\n\t}\n\n\tif (!mgmt_send(manager->mgmt, MGMT_OP_READ_ADV_FEATURES,\n\t\t\t\tmanager->mgmt_index, 0, NULL,\n\t\t\t\tread_adv_features_callback, manager, NULL)) {\n\t\terror(\"Failed to read advertising features\");\n\t\tgoto fail;\n\t}\n\n\treturn manager;\n\nfail:\n\tmanager_destroy(manager);\n\treturn NULL;\n}",
          "includes": [
            "#include \"advertising.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"eir.h\"",
            "#include \"log.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"adapter.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <gdbus/gdbus.h>",
            "#include <dbus/dbus.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <stdint.h>"
          ],
          "macros_used": [
            "#define LE_ADVERTISING_MGR_IFACE \"org.bluez.LEAdvertisingManager1\""
          ],
          "globals_used": [
            "static const GDBusPropertyTable properties[] = {\n\t{ \"ActiveInstances\", \"y\", get_active_instances, NULL, NULL },\n\t{ \"SupportedInstances\", \"y\", get_instances, NULL, NULL },\n\t{ \"SupportedIncludes\", \"as\", get_supported_includes, NULL, NULL },\n\t{ }\n};",
            "static const GDBusMethodTable methods[] = {\n\t{ GDBUS_ASYNC_METHOD(\"RegisterAdvertisement\",\n\t\t\t\t\tGDBUS_ARGS({ \"advertisement\", \"o\" },\n\t\t\t\t\t\t\t{ \"options\", \"a{sv}\" }),\n\t\t\t\t\tNULL, register_advertisement) },\n\t{ GDBUS_ASYNC_METHOD(\"UnregisterAdvertisement\",\n\t\t\t\t\t\tGDBUS_ARGS({ \"service\", \"o\" }),\n\t\t\t\t\t\tNULL,\n\t\t\t\t\t\tunregister_advertisement) },\n\t{ }\n};"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"advertising.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/mgmt.h\"\n#include \"src/shared/ad.h\"\n#include \"eir.h\"\n#include \"log.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"adapter.h\"\n#include \"lib/sdp.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <gdbus/gdbus.h>\n#include <dbus/dbus.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <stdint.h>\n\n#define LE_ADVERTISING_MGR_IFACE \"org.bluez.LEAdvertisingManager1\"\n\nstatic const GDBusPropertyTable properties[] = {\n\t{ \"ActiveInstances\", \"y\", get_active_instances, NULL, NULL },\n\t{ \"SupportedInstances\", \"y\", get_instances, NULL, NULL },\n\t{ \"SupportedIncludes\", \"as\", get_supported_includes, NULL, NULL },\n\t{ }\n};\nstatic const GDBusMethodTable methods[] = {\n\t{ GDBUS_ASYNC_METHOD(\"RegisterAdvertisement\",\n\t\t\t\t\tGDBUS_ARGS({ \"advertisement\", \"o\" },\n\t\t\t\t\t\t\t{ \"options\", \"a{sv}\" }),\n\t\t\t\t\tNULL, register_advertisement) },\n\t{ GDBUS_ASYNC_METHOD(\"UnregisterAdvertisement\",\n\t\t\t\t\t\tGDBUS_ARGS({ \"service\", \"o\" }),\n\t\t\t\t\t\tNULL,\n\t\t\t\t\t\tunregister_advertisement) },\n\t{ }\n};\n\nstatic struct btd_adv_manager *manager_create(struct btd_adapter *adapter,\n\t\t\t\t\t\tstruct mgmt *mgmt)\n{\n\tstruct btd_adv_manager *manager;\n\n\tmanager = new0(struct btd_adv_manager, 1);\n\tmanager->adapter = adapter;\n\n\tmanager->mgmt = mgmt_ref(mgmt);\n\n\tif (!manager->mgmt) {\n\t\terror(\"Failed to access management interface\");\n\t\tfree(manager);\n\t\treturn NULL;\n\t}\n\n\tmanager->mgmt_index = btd_adapter_get_index(adapter);\n\tmanager->clients = queue_new();\n\tmanager->supported_flags = MGMT_ADV_FLAG_LOCAL_NAME;\n\n\tif (!g_dbus_register_interface(btd_get_dbus_connection(),\n\t\t\t\t\tadapter_get_path(manager->adapter),\n\t\t\t\t\tLE_ADVERTISING_MGR_IFACE, methods,\n\t\t\t\t\tNULL, properties, manager, NULL)) {\n\t\terror(\"Failed to register \" LE_ADVERTISING_MGR_IFACE);\n\t\tgoto fail;\n\t}\n\n\tif (!mgmt_send(manager->mgmt, MGMT_OP_READ_ADV_FEATURES,\n\t\t\t\tmanager->mgmt_index, 0, NULL,\n\t\t\t\tread_adv_features_callback, manager, NULL)) {\n\t\terror(\"Failed to read advertising features\");\n\t\tgoto fail;\n\t}\n\n\treturn manager;\n\nfail:\n\tmanager_destroy(manager);\n\treturn NULL;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"advertising.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/mgmt.h\"\n#include \"src/shared/ad.h\"\n#include \"eir.h\"\n#include \"log.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"adapter.h\"\n#include \"lib/sdp.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <gdbus/gdbus.h>\n#include <dbus/dbus.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <stdint.h>\n\nstruct btd_adv_manager *btd_adv_manager_new(struct btd_adapter *adapter,\n\t\t\t\t\t\t\tstruct mgmt *mgmt)\n{\n\tstruct btd_adv_manager *manager;\n\n\tif (!adapter || !mgmt)\n\t\treturn NULL;\n\n\tmanager = manager_create(adapter, mgmt);\n\tif (!manager)\n\t\treturn NULL;\n\n\tDBG(\"LE Advertising Manager created for adapter: %s\",\n\t\t\t\t\t\tadapter_get_path(adapter));\n\n\treturn manager;\n}"
  },
  {
    "function_name": "manager_create",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/advertising.c",
    "lines": "1292-1332",
    "snippet": "static struct btd_adv_manager *manager_create(struct btd_adapter *adapter,\n\t\t\t\t\t\tstruct mgmt *mgmt)\n{\n\tstruct btd_adv_manager *manager;\n\n\tmanager = new0(struct btd_adv_manager, 1);\n\tmanager->adapter = adapter;\n\n\tmanager->mgmt = mgmt_ref(mgmt);\n\n\tif (!manager->mgmt) {\n\t\terror(\"Failed to access management interface\");\n\t\tfree(manager);\n\t\treturn NULL;\n\t}\n\n\tmanager->mgmt_index = btd_adapter_get_index(adapter);\n\tmanager->clients = queue_new();\n\tmanager->supported_flags = MGMT_ADV_FLAG_LOCAL_NAME;\n\n\tif (!g_dbus_register_interface(btd_get_dbus_connection(),\n\t\t\t\t\tadapter_get_path(manager->adapter),\n\t\t\t\t\tLE_ADVERTISING_MGR_IFACE, methods,\n\t\t\t\t\tNULL, properties, manager, NULL)) {\n\t\terror(\"Failed to register \" LE_ADVERTISING_MGR_IFACE);\n\t\tgoto fail;\n\t}\n\n\tif (!mgmt_send(manager->mgmt, MGMT_OP_READ_ADV_FEATURES,\n\t\t\t\tmanager->mgmt_index, 0, NULL,\n\t\t\t\tread_adv_features_callback, manager, NULL)) {\n\t\terror(\"Failed to read advertising features\");\n\t\tgoto fail;\n\t}\n\n\treturn manager;\n\nfail:\n\tmanager_destroy(manager);\n\treturn NULL;\n}",
    "includes": [
      "#include \"advertising.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/mgmt.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"eir.h\"",
      "#include \"log.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"adapter.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <gdbus/gdbus.h>",
      "#include <dbus/dbus.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <stdint.h>"
    ],
    "macros_used": [
      "#define LE_ADVERTISING_MGR_IFACE \"org.bluez.LEAdvertisingManager1\""
    ],
    "globals_used": [
      "static const GDBusPropertyTable properties[] = {\n\t{ \"ActiveInstances\", \"y\", get_active_instances, NULL, NULL },\n\t{ \"SupportedInstances\", \"y\", get_instances, NULL, NULL },\n\t{ \"SupportedIncludes\", \"as\", get_supported_includes, NULL, NULL },\n\t{ }\n};",
      "static const GDBusMethodTable methods[] = {\n\t{ GDBUS_ASYNC_METHOD(\"RegisterAdvertisement\",\n\t\t\t\t\tGDBUS_ARGS({ \"advertisement\", \"o\" },\n\t\t\t\t\t\t\t{ \"options\", \"a{sv}\" }),\n\t\t\t\t\tNULL, register_advertisement) },\n\t{ GDBUS_ASYNC_METHOD(\"UnregisterAdvertisement\",\n\t\t\t\t\t\tGDBUS_ARGS({ \"service\", \"o\" }),\n\t\t\t\t\t\tNULL,\n\t\t\t\t\t\tunregister_advertisement) },\n\t{ }\n};"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "manager_destroy",
          "args": [
            "manager"
          ],
          "line": 1330
        },
        "resolved": true,
        "details": {
          "function_name": "btd_adv_manager_destroy",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/advertising.c",
          "lines": "1352-1362",
          "snippet": "void btd_adv_manager_destroy(struct btd_adv_manager *manager)\n{\n\tif (!manager)\n\t\treturn;\n\n\tg_dbus_unregister_interface(btd_get_dbus_connection(),\n\t\t\t\t\tadapter_get_path(manager->adapter),\n\t\t\t\t\tLE_ADVERTISING_MGR_IFACE);\n\n\tmanager_destroy(manager);\n}",
          "includes": [
            "#include \"advertising.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"eir.h\"",
            "#include \"log.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"adapter.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <gdbus/gdbus.h>",
            "#include <dbus/dbus.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <stdint.h>"
          ],
          "macros_used": [
            "#define LE_ADVERTISING_MGR_IFACE \"org.bluez.LEAdvertisingManager1\""
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"advertising.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/mgmt.h\"\n#include \"src/shared/ad.h\"\n#include \"eir.h\"\n#include \"log.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"adapter.h\"\n#include \"lib/sdp.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <gdbus/gdbus.h>\n#include <dbus/dbus.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <stdint.h>\n\n#define LE_ADVERTISING_MGR_IFACE \"org.bluez.LEAdvertisingManager1\"\n\nvoid btd_adv_manager_destroy(struct btd_adv_manager *manager)\n{\n\tif (!manager)\n\t\treturn;\n\n\tg_dbus_unregister_interface(btd_get_dbus_connection(),\n\t\t\t\t\tadapter_get_path(manager->adapter),\n\t\t\t\t\tLE_ADVERTISING_MGR_IFACE);\n\n\tmanager_destroy(manager);\n}"
        }
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"Failed to read advertising features\""
          ],
          "line": 1323
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_not_ready",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "118-122",
          "snippet": "DBusMessage *btd_error_not_ready(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".NotReady\",\n\t\t\t\t\t\"Resource Not Ready\");\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_not_ready(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".NotReady\",\n\t\t\t\t\t\"Resource Not Ready\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "mgmt_send",
          "args": [
            "manager->mgmt",
            "MGMT_OP_READ_ADV_FEATURES",
            "manager->mgmt_index",
            "0",
            "NULL",
            "read_adv_features_callback",
            "manager",
            "NULL"
          ],
          "line": 1320
        },
        "resolved": true,
        "details": {
          "function_name": "mgmt_send_nowait",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/mgmt.c",
          "lines": "605-629",
          "snippet": "unsigned int mgmt_send_nowait(struct mgmt *mgmt, uint16_t opcode, uint16_t index,\n\t\t\t\tuint16_t length, const void *param,\n\t\t\t\tmgmt_request_func_t callback,\n\t\t\t\tvoid *user_data, mgmt_destroy_func_t destroy)\n{\n\tstruct mgmt_request *request;\n\n\tif (!mgmt)\n\t\treturn 0;\n\n\trequest = create_request(opcode, index, length, param,\n\t\t\t\t\tcallback, user_data, destroy);\n\tif (!request)\n\t\treturn 0;\n\n\tif (mgmt->next_request_id < 1)\n\t\tmgmt->next_request_id = 1;\n\n\trequest->id = mgmt->next_request_id++;\n\n\tif (!send_request(mgmt, request))\n\t\treturn 0;\n\n\treturn request->id;\n}",
          "includes": [
            "#include \"src/shared/mgmt.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"lib/hci.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/mgmt.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"lib/hci.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nunsigned int mgmt_send_nowait(struct mgmt *mgmt, uint16_t opcode, uint16_t index,\n\t\t\t\tuint16_t length, const void *param,\n\t\t\t\tmgmt_request_func_t callback,\n\t\t\t\tvoid *user_data, mgmt_destroy_func_t destroy)\n{\n\tstruct mgmt_request *request;\n\n\tif (!mgmt)\n\t\treturn 0;\n\n\trequest = create_request(opcode, index, length, param,\n\t\t\t\t\tcallback, user_data, destroy);\n\tif (!request)\n\t\treturn 0;\n\n\tif (mgmt->next_request_id < 1)\n\t\tmgmt->next_request_id = 1;\n\n\trequest->id = mgmt->next_request_id++;\n\n\tif (!send_request(mgmt, request))\n\t\treturn 0;\n\n\treturn request->id;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_dbus_register_interface",
          "args": [
            "btd_get_dbus_connection()",
            "adapter_get_path(manager->adapter)",
            "LE_ADVERTISING_MGR_IFACE",
            "methods",
            "NULL",
            "properties",
            "manager",
            "NULL"
          ],
          "line": 1312
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "adapter_get_path",
          "args": [
            "manager->adapter"
          ],
          "line": 1313
        },
        "resolved": true,
        "details": {
          "function_name": "adapter_get_path",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "5873-5879",
          "snippet": "const char *adapter_get_path(struct btd_adapter *adapter)\n{\n\tif (!adapter)\n\t\treturn NULL;\n\n\treturn adapter->path;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void trigger_pairable_timeout(struct btd_adapter *adapter);",
            "static void adapter_start(struct btd_adapter *adapter);",
            "static void adapter_stop(struct btd_adapter *adapter);",
            "static void trigger_passive_scanning(struct btd_adapter *adapter);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void trigger_pairable_timeout(struct btd_adapter *adapter);\nstatic void adapter_start(struct btd_adapter *adapter);\nstatic void adapter_stop(struct btd_adapter *adapter);\nstatic void trigger_passive_scanning(struct btd_adapter *adapter);\n\nconst char *adapter_get_path(struct btd_adapter *adapter)\n{\n\tif (!adapter)\n\t\treturn NULL;\n\n\treturn adapter->path;\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_get_dbus_connection",
          "args": [],
          "line": 1312
        },
        "resolved": true,
        "details": {
          "function_name": "btd_get_dbus_connection",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/dbus-common.c",
          "lines": "61-64",
          "snippet": "DBusConnection *btd_get_dbus_connection(void)\n{\n\treturn connection;\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <stdint.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static DBusConnection *connection = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <stdint.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *connection = NULL;\n\nDBusConnection *btd_get_dbus_connection(void)\n{\n\treturn connection;\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_new",
          "args": [],
          "line": 1309
        },
        "resolved": true,
        "details": {
          "function_name": "queue_new",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "56-66",
          "snippet": "struct queue *queue_new(void)\n{\n\tstruct queue *queue;\n\n\tqueue = new0(struct queue, 1);\n\tqueue->head = NULL;\n\tqueue->tail = NULL;\n\tqueue->entries = 0;\n\n\treturn queue_ref(queue);\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nstruct queue *queue_new(void)\n{\n\tstruct queue *queue;\n\n\tqueue = new0(struct queue, 1);\n\tqueue->head = NULL;\n\tqueue->tail = NULL;\n\tqueue->entries = 0;\n\n\treturn queue_ref(queue);\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_adapter_get_index",
          "args": [
            "adapter"
          ],
          "line": 1308
        },
        "resolved": true,
        "details": {
          "function_name": "btd_adapter_get_index",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "316-322",
          "snippet": "uint16_t btd_adapter_get_index(struct btd_adapter *adapter)\n{\n\tif (!adapter)\n\t\treturn MGMT_INDEX_NONE;\n\n\treturn adapter->dev_id;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void trigger_pairable_timeout(struct btd_adapter *adapter);",
            "static void adapter_start(struct btd_adapter *adapter);",
            "static void adapter_stop(struct btd_adapter *adapter);",
            "static void trigger_passive_scanning(struct btd_adapter *adapter);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void trigger_pairable_timeout(struct btd_adapter *adapter);\nstatic void adapter_start(struct btd_adapter *adapter);\nstatic void adapter_stop(struct btd_adapter *adapter);\nstatic void trigger_passive_scanning(struct btd_adapter *adapter);\n\nuint16_t btd_adapter_get_index(struct btd_adapter *adapter)\n{\n\tif (!adapter)\n\t\treturn MGMT_INDEX_NONE;\n\n\treturn adapter->dev_id;\n}"
        }
      },
      {
        "call_info": {
          "callee": "free",
          "args": [
            "manager"
          ],
          "line": 1304
        },
        "resolved": true,
        "details": {
          "function_name": "client_free_idle_cb",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/advertising.c",
          "lines": "134-139",
          "snippet": "static gboolean client_free_idle_cb(void *data)\n{\n\tclient_free(data);\n\n\treturn FALSE;\n}",
          "includes": [
            "#include \"advertising.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"eir.h\"",
            "#include \"log.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"adapter.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <gdbus/gdbus.h>",
            "#include <dbus/dbus.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <stdint.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"advertising.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/mgmt.h\"\n#include \"src/shared/ad.h\"\n#include \"eir.h\"\n#include \"log.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"adapter.h\"\n#include \"lib/sdp.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <gdbus/gdbus.h>\n#include <dbus/dbus.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <stdint.h>\n\nstatic gboolean client_free_idle_cb(void *data)\n{\n\tclient_free(data);\n\n\treturn FALSE;\n}"
        }
      },
      {
        "call_info": {
          "callee": "mgmt_ref",
          "args": [
            "mgmt"
          ],
          "line": 1300
        },
        "resolved": true,
        "details": {
          "function_name": "mgmt_ref",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/mgmt.c",
          "lines": "461-469",
          "snippet": "struct mgmt *mgmt_ref(struct mgmt *mgmt)\n{\n\tif (!mgmt)\n\t\treturn NULL;\n\n\t__sync_fetch_and_add(&mgmt->ref_count, 1);\n\n\treturn mgmt;\n}",
          "includes": [
            "#include \"src/shared/mgmt.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"lib/hci.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/mgmt.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"lib/hci.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstruct mgmt *mgmt_ref(struct mgmt *mgmt)\n{\n\tif (!mgmt)\n\t\treturn NULL;\n\n\t__sync_fetch_and_add(&mgmt->ref_count, 1);\n\n\treturn mgmt;\n}"
        }
      },
      {
        "call_info": {
          "callee": "new0",
          "args": [
            "structbtd_adv_manager",
            "1"
          ],
          "line": 1297
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"advertising.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/mgmt.h\"\n#include \"src/shared/ad.h\"\n#include \"eir.h\"\n#include \"log.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"adapter.h\"\n#include \"lib/sdp.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <gdbus/gdbus.h>\n#include <dbus/dbus.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <stdint.h>\n\n#define LE_ADVERTISING_MGR_IFACE \"org.bluez.LEAdvertisingManager1\"\n\nstatic const GDBusPropertyTable properties[] = {\n\t{ \"ActiveInstances\", \"y\", get_active_instances, NULL, NULL },\n\t{ \"SupportedInstances\", \"y\", get_instances, NULL, NULL },\n\t{ \"SupportedIncludes\", \"as\", get_supported_includes, NULL, NULL },\n\t{ }\n};\nstatic const GDBusMethodTable methods[] = {\n\t{ GDBUS_ASYNC_METHOD(\"RegisterAdvertisement\",\n\t\t\t\t\tGDBUS_ARGS({ \"advertisement\", \"o\" },\n\t\t\t\t\t\t\t{ \"options\", \"a{sv}\" }),\n\t\t\t\t\tNULL, register_advertisement) },\n\t{ GDBUS_ASYNC_METHOD(\"UnregisterAdvertisement\",\n\t\t\t\t\t\tGDBUS_ARGS({ \"service\", \"o\" }),\n\t\t\t\t\t\tNULL,\n\t\t\t\t\t\tunregister_advertisement) },\n\t{ }\n};\n\nstatic struct btd_adv_manager *manager_create(struct btd_adapter *adapter,\n\t\t\t\t\t\tstruct mgmt *mgmt)\n{\n\tstruct btd_adv_manager *manager;\n\n\tmanager = new0(struct btd_adv_manager, 1);\n\tmanager->adapter = adapter;\n\n\tmanager->mgmt = mgmt_ref(mgmt);\n\n\tif (!manager->mgmt) {\n\t\terror(\"Failed to access management interface\");\n\t\tfree(manager);\n\t\treturn NULL;\n\t}\n\n\tmanager->mgmt_index = btd_adapter_get_index(adapter);\n\tmanager->clients = queue_new();\n\tmanager->supported_flags = MGMT_ADV_FLAG_LOCAL_NAME;\n\n\tif (!g_dbus_register_interface(btd_get_dbus_connection(),\n\t\t\t\t\tadapter_get_path(manager->adapter),\n\t\t\t\t\tLE_ADVERTISING_MGR_IFACE, methods,\n\t\t\t\t\tNULL, properties, manager, NULL)) {\n\t\terror(\"Failed to register \" LE_ADVERTISING_MGR_IFACE);\n\t\tgoto fail;\n\t}\n\n\tif (!mgmt_send(manager->mgmt, MGMT_OP_READ_ADV_FEATURES,\n\t\t\t\tmanager->mgmt_index, 0, NULL,\n\t\t\t\tread_adv_features_callback, manager, NULL)) {\n\t\terror(\"Failed to read advertising features\");\n\t\tgoto fail;\n\t}\n\n\treturn manager;\n\nfail:\n\tmanager_destroy(manager);\n\treturn NULL;\n}"
  },
  {
    "function_name": "read_adv_features_callback",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/advertising.c",
    "lines": "1262-1290",
    "snippet": "static void read_adv_features_callback(uint8_t status, uint16_t length,\n\t\t\t\t\tconst void *param, void *user_data)\n{\n\tstruct btd_adv_manager *manager = user_data;\n\tconst struct mgmt_rp_read_adv_features *feat = param;\n\n\tif (status || !param) {\n\t\terror(\"Failed to read advertising features: %s (0x%02x)\",\n\t\t\t\t\t\tmgmt_errstr(status), status);\n\t\treturn;\n\t}\n\n\tif (length < sizeof(*feat)) {\n\t\terror(\"Wrong size of read adv features response\");\n\t\treturn;\n\t}\n\n\tmanager->max_adv_len = feat->max_adv_data_len;\n\tmanager->max_scan_rsp_len = feat->max_scan_rsp_len;\n\tmanager->max_ads = feat->max_instances;\n\tmanager->supported_flags |= feat->supported_flags;\n\n\tif (manager->max_ads == 0)\n\t\treturn;\n\n\t/* Reset existing instances */\n\tif (feat->num_instances)\n\t\tremove_advertising(manager, 0);\n}",
    "includes": [
      "#include \"advertising.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/mgmt.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"eir.h\"",
      "#include \"log.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"adapter.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <gdbus/gdbus.h>",
      "#include <dbus/dbus.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <stdint.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "remove_advertising",
          "args": [
            "manager",
            "0"
          ],
          "line": 1289
        },
        "resolved": true,
        "details": {
          "function_name": "remove_advertising",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/advertising.c",
          "lines": "157-171",
          "snippet": "static void remove_advertising(struct btd_adv_manager *manager,\n\t\t\t\t\t\tuint8_t instance)\n{\n\tstruct mgmt_cp_remove_advertising cp;\n\n\tif (instance)\n\t\tDBG(\"instance %u\", instance);\n\telse\n\t\tDBG(\"all instances\");\n\n\tcp.instance = instance;\n\n\tmgmt_send(manager->mgmt, MGMT_OP_REMOVE_ADVERTISING,\n\t\t\tmanager->mgmt_index, sizeof(cp), &cp, NULL, NULL, NULL);\n}",
          "includes": [
            "#include \"advertising.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"eir.h\"",
            "#include \"log.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"adapter.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <gdbus/gdbus.h>",
            "#include <dbus/dbus.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <stdint.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"advertising.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/mgmt.h\"\n#include \"src/shared/ad.h\"\n#include \"eir.h\"\n#include \"log.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"adapter.h\"\n#include \"lib/sdp.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <gdbus/gdbus.h>\n#include <dbus/dbus.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <stdint.h>\n\nstatic void remove_advertising(struct btd_adv_manager *manager,\n\t\t\t\t\t\tuint8_t instance)\n{\n\tstruct mgmt_cp_remove_advertising cp;\n\n\tif (instance)\n\t\tDBG(\"instance %u\", instance);\n\telse\n\t\tDBG(\"all instances\");\n\n\tcp.instance = instance;\n\n\tmgmt_send(manager->mgmt, MGMT_OP_REMOVE_ADVERTISING,\n\t\t\tmanager->mgmt_index, sizeof(cp), &cp, NULL, NULL, NULL);\n}"
        }
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"Wrong size of read adv features response\""
          ],
          "line": 1275
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_not_ready",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "118-122",
          "snippet": "DBusMessage *btd_error_not_ready(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".NotReady\",\n\t\t\t\t\t\"Resource Not Ready\");\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_not_ready(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".NotReady\",\n\t\t\t\t\t\"Resource Not Ready\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"Failed to read advertising features: %s (0x%02x)\"",
            "mgmt_errstr(status)",
            "status"
          ],
          "line": 1269
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/log.c",
          "lines": "199-213",
          "snippet": "void btd_error(uint16_t index, const char *format, ...)\n{\n\tva_list ap;\n\n\tva_start(ap, format);\n\tvsyslog(LOG_ERR, format, ap);\n\tva_end(ap);\n\n\tif (logging_fd < 0)\n\t\treturn;\n\n\tva_start(ap, format);\n\tlogging_log(index, LOG_ERR, format, ap);\n\tva_end(ap);\n}",
          "includes": [
            "#include \"log.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/hci.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <sys/socket.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <stdarg.h>",
            "#include <syslog.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int logging_fd = -1;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n#include \"src/shared/util.h\"\n#include \"lib/hci.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <sys/socket.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdarg.h>\n#include <syslog.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic int logging_fd = -1;\n\nvoid btd_error(uint16_t index, const char *format, ...)\n{\n\tva_list ap;\n\n\tva_start(ap, format);\n\tvsyslog(LOG_ERR, format, ap);\n\tva_end(ap);\n\n\tif (logging_fd < 0)\n\t\treturn;\n\n\tva_start(ap, format);\n\tlogging_log(index, LOG_ERR, format, ap);\n\tva_end(ap);\n}"
        }
      },
      {
        "call_info": {
          "callee": "mgmt_errstr",
          "args": [
            "status"
          ],
          "line": 1270
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"advertising.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/mgmt.h\"\n#include \"src/shared/ad.h\"\n#include \"eir.h\"\n#include \"log.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"adapter.h\"\n#include \"lib/sdp.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <gdbus/gdbus.h>\n#include <dbus/dbus.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <stdint.h>\n\nstatic void read_adv_features_callback(uint8_t status, uint16_t length,\n\t\t\t\t\tconst void *param, void *user_data)\n{\n\tstruct btd_adv_manager *manager = user_data;\n\tconst struct mgmt_rp_read_adv_features *feat = param;\n\n\tif (status || !param) {\n\t\terror(\"Failed to read advertising features: %s (0x%02x)\",\n\t\t\t\t\t\tmgmt_errstr(status), status);\n\t\treturn;\n\t}\n\n\tif (length < sizeof(*feat)) {\n\t\terror(\"Wrong size of read adv features response\");\n\t\treturn;\n\t}\n\n\tmanager->max_adv_len = feat->max_adv_data_len;\n\tmanager->max_scan_rsp_len = feat->max_scan_rsp_len;\n\tmanager->max_ads = feat->max_instances;\n\tmanager->supported_flags |= feat->supported_flags;\n\n\tif (manager->max_ads == 0)\n\t\treturn;\n\n\t/* Reset existing instances */\n\tif (feat->num_instances)\n\t\tremove_advertising(manager, 0);\n}"
  },
  {
    "function_name": "manager_destroy",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/advertising.c",
    "lines": "1251-1260",
    "snippet": "static void manager_destroy(void *user_data)\n{\n\tstruct btd_adv_manager *manager = user_data;\n\n\tqueue_destroy(manager->clients, client_destroy);\n\n\tmgmt_unref(manager->mgmt);\n\n\tfree(manager);\n}",
    "includes": [
      "#include \"advertising.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/mgmt.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"eir.h\"",
      "#include \"log.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"adapter.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <gdbus/gdbus.h>",
      "#include <dbus/dbus.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <stdint.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "manager"
          ],
          "line": 1259
        },
        "resolved": true,
        "details": {
          "function_name": "client_free_idle_cb",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/advertising.c",
          "lines": "134-139",
          "snippet": "static gboolean client_free_idle_cb(void *data)\n{\n\tclient_free(data);\n\n\treturn FALSE;\n}",
          "includes": [
            "#include \"advertising.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"eir.h\"",
            "#include \"log.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"adapter.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <gdbus/gdbus.h>",
            "#include <dbus/dbus.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <stdint.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"advertising.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/mgmt.h\"\n#include \"src/shared/ad.h\"\n#include \"eir.h\"\n#include \"log.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"adapter.h\"\n#include \"lib/sdp.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <gdbus/gdbus.h>\n#include <dbus/dbus.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <stdint.h>\n\nstatic gboolean client_free_idle_cb(void *data)\n{\n\tclient_free(data);\n\n\treturn FALSE;\n}"
        }
      },
      {
        "call_info": {
          "callee": "mgmt_unref",
          "args": [
            "manager->mgmt"
          ],
          "line": 1257
        },
        "resolved": true,
        "details": {
          "function_name": "mgmt_unref",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/mgmt.c",
          "lines": "471-506",
          "snippet": "void mgmt_unref(struct mgmt *mgmt)\n{\n\tif (!mgmt)\n\t\treturn;\n\n\tif (__sync_sub_and_fetch(&mgmt->ref_count, 1))\n\t\treturn;\n\n\tmgmt_unregister_all(mgmt);\n\tmgmt_cancel_all(mgmt);\n\n\tqueue_destroy(mgmt->reply_queue, NULL);\n\tqueue_destroy(mgmt->request_queue, NULL);\n\n\tio_set_write_handler(mgmt->io, NULL, NULL, NULL);\n\tio_set_read_handler(mgmt->io, NULL, NULL, NULL);\n\n\tio_destroy(mgmt->io);\n\tmgmt->io = NULL;\n\n\tif (mgmt->close_on_unref)\n\t\tclose(mgmt->fd);\n\n\tif (mgmt->debug_destroy)\n\t\tmgmt->debug_destroy(mgmt->debug_data);\n\n\tfree(mgmt->buf);\n\tmgmt->buf = NULL;\n\n\tif (!mgmt->in_notify) {\n\t\tqueue_destroy(mgmt->notify_list, NULL);\n\t\tqueue_destroy(mgmt->pending_list, NULL);\n\t\tfree(mgmt);\n\t\treturn;\n\t}\n}",
          "includes": [
            "#include \"src/shared/mgmt.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"lib/hci.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/mgmt.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"lib/hci.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nvoid mgmt_unref(struct mgmt *mgmt)\n{\n\tif (!mgmt)\n\t\treturn;\n\n\tif (__sync_sub_and_fetch(&mgmt->ref_count, 1))\n\t\treturn;\n\n\tmgmt_unregister_all(mgmt);\n\tmgmt_cancel_all(mgmt);\n\n\tqueue_destroy(mgmt->reply_queue, NULL);\n\tqueue_destroy(mgmt->request_queue, NULL);\n\n\tio_set_write_handler(mgmt->io, NULL, NULL, NULL);\n\tio_set_read_handler(mgmt->io, NULL, NULL, NULL);\n\n\tio_destroy(mgmt->io);\n\tmgmt->io = NULL;\n\n\tif (mgmt->close_on_unref)\n\t\tclose(mgmt->fd);\n\n\tif (mgmt->debug_destroy)\n\t\tmgmt->debug_destroy(mgmt->debug_data);\n\n\tfree(mgmt->buf);\n\tmgmt->buf = NULL;\n\n\tif (!mgmt->in_notify) {\n\t\tqueue_destroy(mgmt->notify_list, NULL);\n\t\tqueue_destroy(mgmt->pending_list, NULL);\n\t\tfree(mgmt);\n\t\treturn;\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_destroy",
          "args": [
            "manager->clients",
            "client_destroy"
          ],
          "line": 1255
        },
        "resolved": true,
        "details": {
          "function_name": "queue_destroy",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "68-76",
          "snippet": "void queue_destroy(struct queue *queue, queue_destroy_func_t destroy)\n{\n\tif (!queue)\n\t\treturn;\n\n\tqueue_remove_all(queue, NULL, NULL, destroy);\n\n\tqueue_unref(queue);\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nvoid queue_destroy(struct queue *queue, queue_destroy_func_t destroy)\n{\n\tif (!queue)\n\t\treturn;\n\n\tqueue_remove_all(queue, NULL, NULL, destroy);\n\n\tqueue_unref(queue);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"advertising.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/mgmt.h\"\n#include \"src/shared/ad.h\"\n#include \"eir.h\"\n#include \"log.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"adapter.h\"\n#include \"lib/sdp.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <gdbus/gdbus.h>\n#include <dbus/dbus.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <stdint.h>\n\nstatic void manager_destroy(void *user_data)\n{\n\tstruct btd_adv_manager *manager = user_data;\n\n\tqueue_destroy(manager->clients, client_destroy);\n\n\tmgmt_unref(manager->mgmt);\n\n\tfree(manager);\n}"
  },
  {
    "function_name": "get_supported_includes",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/advertising.c",
    "lines": "1216-1230",
    "snippet": "static gboolean get_supported_includes(const GDBusPropertyTable *property,\n\t\t\t\t\tDBusMessageIter *iter, void *data)\n{\n\tstruct btd_adv_manager *manager = data;\n\tDBusMessageIter entry;\n\n\tdbus_message_iter_open_container(iter, DBUS_TYPE_ARRAY,\n\t\t\t\t\tDBUS_TYPE_STRING_AS_STRING, &entry);\n\n\tappend_include(manager, &entry);\n\n\tdbus_message_iter_close_container(iter, &entry);\n\n\treturn TRUE;\n}",
    "includes": [
      "#include \"advertising.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/mgmt.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"eir.h\"",
      "#include \"log.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"adapter.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <gdbus/gdbus.h>",
      "#include <dbus/dbus.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <stdint.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "dbus_message_iter_close_container",
          "args": [
            "iter",
            "&entry"
          ],
          "line": 1227
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "append_include",
          "args": [
            "manager",
            "&entry"
          ],
          "line": 1225
        },
        "resolved": true,
        "details": {
          "function_name": "append_include",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/advertising.c",
          "lines": "1204-1214",
          "snippet": "static void append_include(struct btd_adv_manager *manager,\n\t\t\t\t\t\tDBusMessageIter *iter)\n{\n\tstruct adv_include *inc;\n\n\tfor (inc = includes; inc && inc->name; inc++) {\n\t\tif (manager->supported_flags & inc->flag)\n\t\t\tdbus_message_iter_append_basic(iter, DBUS_TYPE_STRING,\n\t\t\t\t\t\t\t\t&inc->name);\n\t}\n}",
          "includes": [
            "#include \"advertising.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"eir.h\"",
            "#include \"log.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"adapter.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <gdbus/gdbus.h>",
            "#include <dbus/dbus.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <stdint.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static struct adv_include {\n\tuint8_t flag;\n\tconst char *name;\n} includes[] = {\n\t{ MGMT_ADV_FLAG_TX_POWER, \"tx-power\" },\n\t{ MGMT_ADV_FLAG_APPEARANCE, \"appearance\" },\n\t{ MGMT_ADV_FLAG_LOCAL_NAME, \"local-name\" },\n\t{ },\n};"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"advertising.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/mgmt.h\"\n#include \"src/shared/ad.h\"\n#include \"eir.h\"\n#include \"log.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"adapter.h\"\n#include \"lib/sdp.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <gdbus/gdbus.h>\n#include <dbus/dbus.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <stdint.h>\n\nstatic struct adv_include {\n\tuint8_t flag;\n\tconst char *name;\n} includes[] = {\n\t{ MGMT_ADV_FLAG_TX_POWER, \"tx-power\" },\n\t{ MGMT_ADV_FLAG_APPEARANCE, \"appearance\" },\n\t{ MGMT_ADV_FLAG_LOCAL_NAME, \"local-name\" },\n\t{ },\n};\n\nstatic void append_include(struct btd_adv_manager *manager,\n\t\t\t\t\t\tDBusMessageIter *iter)\n{\n\tstruct adv_include *inc;\n\n\tfor (inc = includes; inc && inc->name; inc++) {\n\t\tif (manager->supported_flags & inc->flag)\n\t\t\tdbus_message_iter_append_basic(iter, DBUS_TYPE_STRING,\n\t\t\t\t\t\t\t\t&inc->name);\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_open_container",
          "args": [
            "iter",
            "DBUS_TYPE_ARRAY",
            "DBUS_TYPE_STRING_AS_STRING",
            "&entry"
          ],
          "line": 1222
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"advertising.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/mgmt.h\"\n#include \"src/shared/ad.h\"\n#include \"eir.h\"\n#include \"log.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"adapter.h\"\n#include \"lib/sdp.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <gdbus/gdbus.h>\n#include <dbus/dbus.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <stdint.h>\n\nstatic gboolean get_supported_includes(const GDBusPropertyTable *property,\n\t\t\t\t\tDBusMessageIter *iter, void *data)\n{\n\tstruct btd_adv_manager *manager = data;\n\tDBusMessageIter entry;\n\n\tdbus_message_iter_open_container(iter, DBUS_TYPE_ARRAY,\n\t\t\t\t\tDBUS_TYPE_STRING_AS_STRING, &entry);\n\n\tappend_include(manager, &entry);\n\n\tdbus_message_iter_close_container(iter, &entry);\n\n\treturn TRUE;\n}"
  },
  {
    "function_name": "append_include",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/advertising.c",
    "lines": "1204-1214",
    "snippet": "static void append_include(struct btd_adv_manager *manager,\n\t\t\t\t\t\tDBusMessageIter *iter)\n{\n\tstruct adv_include *inc;\n\n\tfor (inc = includes; inc && inc->name; inc++) {\n\t\tif (manager->supported_flags & inc->flag)\n\t\t\tdbus_message_iter_append_basic(iter, DBUS_TYPE_STRING,\n\t\t\t\t\t\t\t\t&inc->name);\n\t}\n}",
    "includes": [
      "#include \"advertising.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/mgmt.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"eir.h\"",
      "#include \"log.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"adapter.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <gdbus/gdbus.h>",
      "#include <dbus/dbus.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <stdint.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static struct adv_include {\n\tuint8_t flag;\n\tconst char *name;\n} includes[] = {\n\t{ MGMT_ADV_FLAG_TX_POWER, \"tx-power\" },\n\t{ MGMT_ADV_FLAG_APPEARANCE, \"appearance\" },\n\t{ MGMT_ADV_FLAG_LOCAL_NAME, \"local-name\" },\n\t{ },\n};"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "dbus_message_iter_append_basic",
          "args": [
            "iter",
            "DBUS_TYPE_STRING",
            "&inc->name"
          ],
          "line": 1211
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"advertising.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/mgmt.h\"\n#include \"src/shared/ad.h\"\n#include \"eir.h\"\n#include \"log.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"adapter.h\"\n#include \"lib/sdp.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <gdbus/gdbus.h>\n#include <dbus/dbus.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <stdint.h>\n\nstatic struct adv_include {\n\tuint8_t flag;\n\tconst char *name;\n} includes[] = {\n\t{ MGMT_ADV_FLAG_TX_POWER, \"tx-power\" },\n\t{ MGMT_ADV_FLAG_APPEARANCE, \"appearance\" },\n\t{ MGMT_ADV_FLAG_LOCAL_NAME, \"local-name\" },\n\t{ },\n};\n\nstatic void append_include(struct btd_adv_manager *manager,\n\t\t\t\t\t\tDBusMessageIter *iter)\n{\n\tstruct adv_include *inc;\n\n\tfor (inc = includes; inc && inc->name; inc++) {\n\t\tif (manager->supported_flags & inc->flag)\n\t\t\tdbus_message_iter_append_basic(iter, DBUS_TYPE_STRING,\n\t\t\t\t\t\t\t\t&inc->name);\n\t}\n}"
  },
  {
    "function_name": "get_active_instances",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/advertising.c",
    "lines": "1191-1202",
    "snippet": "static gboolean get_active_instances(const GDBusPropertyTable *property,\n\t\t\t\t\tDBusMessageIter *iter, void *data)\n{\n\tstruct btd_adv_manager *manager = data;\n\tuint8_t instances;\n\n\tinstances = queue_length(manager->clients);\n\n\tdbus_message_iter_append_basic(iter, DBUS_TYPE_BYTE, &instances);\n\n\treturn TRUE;\n}",
    "includes": [
      "#include \"advertising.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/mgmt.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"eir.h\"",
      "#include \"log.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"adapter.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <gdbus/gdbus.h>",
      "#include <dbus/dbus.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <stdint.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "dbus_message_iter_append_basic",
          "args": [
            "iter",
            "DBUS_TYPE_BYTE",
            "&instances"
          ],
          "line": 1199
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "queue_length",
          "args": [
            "manager->clients"
          ],
          "line": 1197
        },
        "resolved": true,
        "details": {
          "function_name": "queue_length",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "372-378",
          "snippet": "unsigned int queue_length(struct queue *queue)\n{\n\tif (!queue)\n\t\treturn 0;\n\n\treturn queue->entries;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nunsigned int queue_length(struct queue *queue)\n{\n\tif (!queue)\n\t\treturn 0;\n\n\treturn queue->entries;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"advertising.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/mgmt.h\"\n#include \"src/shared/ad.h\"\n#include \"eir.h\"\n#include \"log.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"adapter.h\"\n#include \"lib/sdp.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <gdbus/gdbus.h>\n#include <dbus/dbus.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <stdint.h>\n\nstatic gboolean get_active_instances(const GDBusPropertyTable *property,\n\t\t\t\t\tDBusMessageIter *iter, void *data)\n{\n\tstruct btd_adv_manager *manager = data;\n\tuint8_t instances;\n\n\tinstances = queue_length(manager->clients);\n\n\tdbus_message_iter_append_basic(iter, DBUS_TYPE_BYTE, &instances);\n\n\treturn TRUE;\n}"
  },
  {
    "function_name": "get_instances",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/advertising.c",
    "lines": "1178-1189",
    "snippet": "static gboolean get_instances(const GDBusPropertyTable *property,\n\t\t\t\t\tDBusMessageIter *iter, void *data)\n{\n\tstruct btd_adv_manager *manager = data;\n\tuint8_t instances;\n\n\tinstances = manager->max_ads - queue_length(manager->clients);\n\n\tdbus_message_iter_append_basic(iter, DBUS_TYPE_BYTE, &instances);\n\n\treturn TRUE;\n}",
    "includes": [
      "#include \"advertising.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/mgmt.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"eir.h\"",
      "#include \"log.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"adapter.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <gdbus/gdbus.h>",
      "#include <dbus/dbus.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <stdint.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "dbus_message_iter_append_basic",
          "args": [
            "iter",
            "DBUS_TYPE_BYTE",
            "&instances"
          ],
          "line": 1186
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "queue_length",
          "args": [
            "manager->clients"
          ],
          "line": 1184
        },
        "resolved": true,
        "details": {
          "function_name": "queue_length",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "372-378",
          "snippet": "unsigned int queue_length(struct queue *queue)\n{\n\tif (!queue)\n\t\treturn 0;\n\n\treturn queue->entries;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nunsigned int queue_length(struct queue *queue)\n{\n\tif (!queue)\n\t\treturn 0;\n\n\treturn queue->entries;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"advertising.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/mgmt.h\"\n#include \"src/shared/ad.h\"\n#include \"eir.h\"\n#include \"log.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"adapter.h\"\n#include \"lib/sdp.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <gdbus/gdbus.h>\n#include <dbus/dbus.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <stdint.h>\n\nstatic gboolean get_instances(const GDBusPropertyTable *property,\n\t\t\t\t\tDBusMessageIter *iter, void *data)\n{\n\tstruct btd_adv_manager *manager = data;\n\tuint8_t instances;\n\n\tinstances = manager->max_ads - queue_length(manager->clients);\n\n\tdbus_message_iter_append_basic(iter, DBUS_TYPE_BYTE, &instances);\n\n\treturn TRUE;\n}"
  },
  {
    "function_name": "unregister_advertisement",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/advertising.c",
    "lines": "1148-1176",
    "snippet": "static DBusMessage *unregister_advertisement(DBusConnection *conn,\n\t\t\t\t\t\tDBusMessage *msg,\n\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct btd_adv_manager *manager = user_data;\n\tDBusMessageIter args;\n\tstruct btd_adv_client *client;\n\tstruct dbus_obj_match match;\n\n\tDBG(\"UnregisterAdvertisement\");\n\n\tif (!dbus_message_iter_init(msg, &args))\n\t\treturn btd_error_invalid_args(msg);\n\n\tif (dbus_message_iter_get_arg_type(&args) != DBUS_TYPE_OBJECT_PATH)\n\t\treturn btd_error_invalid_args(msg);\n\n\tdbus_message_iter_get_basic(&args, &match.path);\n\n\tmatch.owner = dbus_message_get_sender(msg);\n\n\tclient = queue_find(manager->clients, match_client, &match);\n\tif (!client)\n\t\treturn btd_error_does_not_exist(msg);\n\n\tclient_remove(client);\n\n\treturn dbus_message_new_method_return(msg);\n}",
    "includes": [
      "#include \"advertising.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/mgmt.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"eir.h\"",
      "#include \"log.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"adapter.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <gdbus/gdbus.h>",
      "#include <dbus/dbus.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <stdint.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "dbus_message_new_method_return",
          "args": [
            "msg"
          ],
          "line": 1175
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "client_remove",
          "args": [
            "client"
          ],
          "line": 1173
        },
        "resolved": true,
        "details": {
          "function_name": "client_remove",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/advertising.c",
          "lines": "173-197",
          "snippet": "static void client_remove(void *data)\n{\n\tstruct btd_adv_client *client = data;\n\tstruct mgmt_cp_remove_advertising cp;\n\n\tg_dbus_client_set_disconnect_watch(client->client, NULL, NULL);\n\n\tcp.instance = client->instance;\n\n\tmgmt_send(client->manager->mgmt, MGMT_OP_REMOVE_ADVERTISING,\n\t\t\tclient->manager->mgmt_index, sizeof(cp), &cp,\n\t\t\tNULL, NULL, NULL);\n\n\tqueue_remove(client->manager->clients, client);\n\n\tg_idle_add(client_free_idle_cb, client);\n\n\tg_dbus_emit_property_changed(btd_get_dbus_connection(),\n\t\t\t\tadapter_get_path(client->manager->adapter),\n\t\t\t\tLE_ADVERTISING_MGR_IFACE, \"SupportedInstances\");\n\n\tg_dbus_emit_property_changed(btd_get_dbus_connection(),\n\t\t\t\tadapter_get_path(client->manager->adapter),\n\t\t\t\tLE_ADVERTISING_MGR_IFACE, \"ActiveInstances\");\n}",
          "includes": [
            "#include \"advertising.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"eir.h\"",
            "#include \"log.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"adapter.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <gdbus/gdbus.h>",
            "#include <dbus/dbus.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <stdint.h>"
          ],
          "macros_used": [
            "#define LE_ADVERTISING_MGR_IFACE \"org.bluez.LEAdvertisingManager1\""
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"advertising.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/mgmt.h\"\n#include \"src/shared/ad.h\"\n#include \"eir.h\"\n#include \"log.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"adapter.h\"\n#include \"lib/sdp.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <gdbus/gdbus.h>\n#include <dbus/dbus.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <stdint.h>\n\n#define LE_ADVERTISING_MGR_IFACE \"org.bluez.LEAdvertisingManager1\"\n\nstatic void client_remove(void *data)\n{\n\tstruct btd_adv_client *client = data;\n\tstruct mgmt_cp_remove_advertising cp;\n\n\tg_dbus_client_set_disconnect_watch(client->client, NULL, NULL);\n\n\tcp.instance = client->instance;\n\n\tmgmt_send(client->manager->mgmt, MGMT_OP_REMOVE_ADVERTISING,\n\t\t\tclient->manager->mgmt_index, sizeof(cp), &cp,\n\t\t\tNULL, NULL, NULL);\n\n\tqueue_remove(client->manager->clients, client);\n\n\tg_idle_add(client_free_idle_cb, client);\n\n\tg_dbus_emit_property_changed(btd_get_dbus_connection(),\n\t\t\t\tadapter_get_path(client->manager->adapter),\n\t\t\t\tLE_ADVERTISING_MGR_IFACE, \"SupportedInstances\");\n\n\tg_dbus_emit_property_changed(btd_get_dbus_connection(),\n\t\t\t\tadapter_get_path(client->manager->adapter),\n\t\t\t\tLE_ADVERTISING_MGR_IFACE, \"ActiveInstances\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_error_does_not_exist",
          "args": [
            "msg"
          ],
          "line": 1171
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_does_not_exist",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "88-92",
          "snippet": "DBusMessage *btd_error_does_not_exist(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".DoesNotExist\",\n\t\t\t\t\t\"Does Not Exist\");\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_does_not_exist(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".DoesNotExist\",\n\t\t\t\t\t\"Does Not Exist\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_find",
          "args": [
            "manager->clients",
            "match_client",
            "&match"
          ],
          "line": 1169
        },
        "resolved": true,
        "details": {
          "function_name": "queue_find",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "231-247",
          "snippet": "void *queue_find(struct queue *queue, queue_match_func_t function,\n\t\t\t\t\t\t\tconst void *match_data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn NULL;\n\n\tif (!function)\n\t\tfunction = direct_match;\n\n\tfor (entry = queue->head; entry; entry = entry->next)\n\t\tif (function(entry->data, match_data))\n\t\t\treturn entry->data;\n\n\treturn NULL;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nvoid *queue_find(struct queue *queue, queue_match_func_t function,\n\t\t\t\t\t\t\tconst void *match_data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn NULL;\n\n\tif (!function)\n\t\tfunction = direct_match;\n\n\tfor (entry = queue->head; entry; entry = entry->next)\n\t\tif (function(entry->data, match_data))\n\t\t\treturn entry->data;\n\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_message_get_sender",
          "args": [
            "msg"
          ],
          "line": 1167
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_get_basic",
          "args": [
            "&args",
            "&match.path"
          ],
          "line": 1165
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_error_invalid_args",
          "args": [
            "msg"
          ],
          "line": 1163
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_invalid_args",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "34-38",
          "snippet": "DBusMessage *btd_error_invalid_args(DBusMessage *msg)\n{\n\treturn btd_error_invalid_args_str(msg,\n\t\t\t\t\t\"Invalid arguments in method call\");\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_invalid_args(DBusMessage *msg)\n{\n\treturn btd_error_invalid_args_str(msg,\n\t\t\t\t\t\"Invalid arguments in method call\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_get_arg_type",
          "args": [
            "&args"
          ],
          "line": 1162
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_init",
          "args": [
            "msg",
            "&args"
          ],
          "line": 1159
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"UnregisterAdvertisement\""
          ],
          "line": 1157
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"advertising.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/mgmt.h\"\n#include \"src/shared/ad.h\"\n#include \"eir.h\"\n#include \"log.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"adapter.h\"\n#include \"lib/sdp.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <gdbus/gdbus.h>\n#include <dbus/dbus.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <stdint.h>\n\nstatic DBusMessage *unregister_advertisement(DBusConnection *conn,\n\t\t\t\t\t\tDBusMessage *msg,\n\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct btd_adv_manager *manager = user_data;\n\tDBusMessageIter args;\n\tstruct btd_adv_client *client;\n\tstruct dbus_obj_match match;\n\n\tDBG(\"UnregisterAdvertisement\");\n\n\tif (!dbus_message_iter_init(msg, &args))\n\t\treturn btd_error_invalid_args(msg);\n\n\tif (dbus_message_iter_get_arg_type(&args) != DBUS_TYPE_OBJECT_PATH)\n\t\treturn btd_error_invalid_args(msg);\n\n\tdbus_message_iter_get_basic(&args, &match.path);\n\n\tmatch.owner = dbus_message_get_sender(msg);\n\n\tclient = queue_find(manager->clients, match_client, &match);\n\tif (!client)\n\t\treturn btd_error_does_not_exist(msg);\n\n\tclient_remove(client);\n\n\treturn dbus_message_new_method_return(msg);\n}"
  },
  {
    "function_name": "register_advertisement",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/advertising.c",
    "lines": "1099-1146",
    "snippet": "static DBusMessage *register_advertisement(DBusConnection *conn,\n\t\t\t\t\t\tDBusMessage *msg,\n\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct btd_adv_manager *manager = user_data;\n\tDBusMessageIter args;\n\tstruct btd_adv_client *client;\n\tstruct dbus_obj_match match;\n\n\tDBG(\"RegisterAdvertisement\");\n\n\tif (!dbus_message_iter_init(msg, &args))\n\t\treturn btd_error_invalid_args(msg);\n\n\tif (dbus_message_iter_get_arg_type(&args) != DBUS_TYPE_OBJECT_PATH)\n\t\treturn btd_error_invalid_args(msg);\n\n\tdbus_message_iter_get_basic(&args, &match.path);\n\n\tmatch.owner = dbus_message_get_sender(msg);\n\n\tif (queue_find(manager->clients, match_client, &match))\n\t\treturn btd_error_already_exists(msg);\n\n\tdbus_message_iter_next(&args);\n\n\tif (dbus_message_iter_get_arg_type(&args) != DBUS_TYPE_ARRAY)\n\t\treturn btd_error_invalid_args(msg);\n\n\tclient = client_create(manager, conn, msg, match.path);\n\tif (!client)\n\t\treturn btd_error_failed(msg,\n\t\t\t\t\t\"Failed to register advertisement\");\n\n\tclient->instance = util_get_uid(&manager->instance_bitmap,\n\t\t\t\t\t\t\tmanager->max_ads);\n\tif (!client->instance) {\n\t\tclient_free(client);\n\t\treturn btd_error_not_permitted(msg,\n\t\t\t\t\t\"Maximum advertisements reached\");\n\t}\n\n\tDBG(\"Registered advertisement at path %s\", match.path);\n\n\tqueue_push_tail(manager->clients, client);\n\n\treturn NULL;\n}",
    "includes": [
      "#include \"advertising.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/mgmt.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"eir.h\"",
      "#include \"log.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"adapter.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <gdbus/gdbus.h>",
      "#include <dbus/dbus.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <stdint.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "queue_push_tail",
          "args": [
            "manager->clients",
            "client"
          ],
          "line": 1143
        },
        "resolved": true,
        "details": {
          "function_name": "queue_push_tail",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "88-108",
          "snippet": "bool queue_push_tail(struct queue *queue, void *data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn false;\n\n\tentry = queue_entry_new(data);\n\n\tif (queue->tail)\n\t\tqueue->tail->next = entry;\n\n\tqueue->tail = entry;\n\n\tif (!queue->head)\n\t\tqueue->head = entry;\n\n\tqueue->entries++;\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nbool queue_push_tail(struct queue *queue, void *data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn false;\n\n\tentry = queue_entry_new(data);\n\n\tif (queue->tail)\n\t\tqueue->tail->next = entry;\n\n\tqueue->tail = entry;\n\n\tif (!queue->head)\n\t\tqueue->head = entry;\n\n\tqueue->entries++;\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"Registered advertisement at path %s\"",
            "match.path"
          ],
          "line": 1141
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_error_not_permitted",
          "args": [
            "msg",
            "\"Maximum advertisements reached\""
          ],
          "line": 1137
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_not_permitted",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "100-104",
          "snippet": "DBusMessage *btd_error_not_permitted(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".NotPermitted\",\n\t\t\t\t\t\"%s\", str);\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_not_permitted(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".NotPermitted\",\n\t\t\t\t\t\"%s\", str);\n}"
        }
      },
      {
        "call_info": {
          "callee": "client_free",
          "args": [
            "client"
          ],
          "line": 1136
        },
        "resolved": true,
        "details": {
          "function_name": "client_free_idle_cb",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/advertising.c",
          "lines": "134-139",
          "snippet": "static gboolean client_free_idle_cb(void *data)\n{\n\tclient_free(data);\n\n\treturn FALSE;\n}",
          "includes": [
            "#include \"advertising.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"eir.h\"",
            "#include \"log.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"adapter.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <gdbus/gdbus.h>",
            "#include <dbus/dbus.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <stdint.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"advertising.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/mgmt.h\"\n#include \"src/shared/ad.h\"\n#include \"eir.h\"\n#include \"log.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"adapter.h\"\n#include \"lib/sdp.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <gdbus/gdbus.h>\n#include <dbus/dbus.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <stdint.h>\n\nstatic gboolean client_free_idle_cb(void *data)\n{\n\tclient_free(data);\n\n\treturn FALSE;\n}"
        }
      },
      {
        "call_info": {
          "callee": "util_get_uid",
          "args": [
            "&manager->instance_bitmap",
            "manager->max_ads"
          ],
          "line": 1133
        },
        "resolved": true,
        "details": {
          "function_name": "util_get_uid",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/util.c",
          "lines": "133-145",
          "snippet": "uint8_t util_get_uid(unsigned int *bitmap, uint8_t max)\n{\n\tuint8_t id;\n\n\tid = ffs(~*bitmap);\n\n\tif (!id || id > max)\n\t\treturn 0;\n\n\t*bitmap |= 1 << (id - 1);\n\n\treturn id;\n}",
          "includes": [
            "#include \"src/shared/util.h\"",
            "#include <string.h>",
            "#include <limits.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <stdbool.h>",
            "#include <stdarg.h>",
            "#include <ctype.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/util.h\"\n#include <string.h>\n#include <limits.h>\n#include <dirent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <config.h>\n\nuint8_t util_get_uid(unsigned int *bitmap, uint8_t max)\n{\n\tuint8_t id;\n\n\tid = ffs(~*bitmap);\n\n\tif (!id || id > max)\n\t\treturn 0;\n\n\t*bitmap |= 1 << (id - 1);\n\n\treturn id;\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_error_failed",
          "args": [
            "msg",
            "\"Failed to register advertisement\""
          ],
          "line": 1130
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_failed",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "124-128",
          "snippet": "DBusMessage *btd_error_failed(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE\n\t\t\t\t\t\".Failed\", \"%s\", str);\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_failed(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE\n\t\t\t\t\t\".Failed\", \"%s\", str);\n}"
        }
      },
      {
        "call_info": {
          "callee": "client_create",
          "args": [
            "manager",
            "conn",
            "msg",
            "match.path"
          ],
          "line": 1128
        },
        "resolved": true,
        "details": {
          "function_name": "client_create",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/advertising.c",
          "lines": "1047-1097",
          "snippet": "static struct btd_adv_client *client_create(struct btd_adv_manager *manager,\n\t\t\t\t\tDBusConnection *conn,\n\t\t\t\t\tDBusMessage *msg, const char *path)\n{\n\tstruct btd_adv_client *client;\n\tconst char *sender = dbus_message_get_sender(msg);\n\n\tif (!path || !g_str_has_prefix(path, \"/\"))\n\t\treturn NULL;\n\n\tclient = new0(struct btd_adv_client, 1);\n\tclient->client = g_dbus_client_new_full(conn, sender, path, path);\n\tif (!client->client)\n\t\tgoto fail;\n\n\tclient->owner = g_strdup(sender);\n\tif (!client->owner)\n\t\tgoto fail;\n\n\tclient->path = g_strdup(path);\n\tif (!client->path)\n\t\tgoto fail;\n\n\tDBG(\"Adding proxy for %s\", path);\n\tclient->proxy = g_dbus_proxy_new(client->client, path,\n\t\t\t\t\t\tLE_ADVERTISEMENT_IFACE);\n\tif (!client->proxy)\n\t\tgoto fail;\n\n\tg_dbus_client_set_proxy_handlers(client->client, client_proxy_added,\n\t\t\t\t\t\t\tNULL, NULL, client);\n\n\tclient->reg = dbus_message_ref(msg);\n\n\tclient->data = bt_ad_new();\n\tif (!client->data)\n\t\tgoto fail;\n\n\tclient->scan = bt_ad_new();\n\tif (!client->scan)\n\t\tgoto fail;\n\n\tclient->manager = manager;\n\tclient->appearance = UINT16_MAX;\n\n\treturn client;\n\nfail:\n\tclient_free(client);\n\treturn NULL;\n}",
          "includes": [
            "#include \"advertising.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"eir.h\"",
            "#include \"log.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"adapter.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <gdbus/gdbus.h>",
            "#include <dbus/dbus.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <stdint.h>"
          ],
          "macros_used": [
            "#define LE_ADVERTISEMENT_IFACE \"org.bluez.LEAdvertisement1\""
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"advertising.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/mgmt.h\"\n#include \"src/shared/ad.h\"\n#include \"eir.h\"\n#include \"log.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"adapter.h\"\n#include \"lib/sdp.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <gdbus/gdbus.h>\n#include <dbus/dbus.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <stdint.h>\n\n#define LE_ADVERTISEMENT_IFACE \"org.bluez.LEAdvertisement1\"\n\nstatic struct btd_adv_client *client_create(struct btd_adv_manager *manager,\n\t\t\t\t\tDBusConnection *conn,\n\t\t\t\t\tDBusMessage *msg, const char *path)\n{\n\tstruct btd_adv_client *client;\n\tconst char *sender = dbus_message_get_sender(msg);\n\n\tif (!path || !g_str_has_prefix(path, \"/\"))\n\t\treturn NULL;\n\n\tclient = new0(struct btd_adv_client, 1);\n\tclient->client = g_dbus_client_new_full(conn, sender, path, path);\n\tif (!client->client)\n\t\tgoto fail;\n\n\tclient->owner = g_strdup(sender);\n\tif (!client->owner)\n\t\tgoto fail;\n\n\tclient->path = g_strdup(path);\n\tif (!client->path)\n\t\tgoto fail;\n\n\tDBG(\"Adding proxy for %s\", path);\n\tclient->proxy = g_dbus_proxy_new(client->client, path,\n\t\t\t\t\t\tLE_ADVERTISEMENT_IFACE);\n\tif (!client->proxy)\n\t\tgoto fail;\n\n\tg_dbus_client_set_proxy_handlers(client->client, client_proxy_added,\n\t\t\t\t\t\t\tNULL, NULL, client);\n\n\tclient->reg = dbus_message_ref(msg);\n\n\tclient->data = bt_ad_new();\n\tif (!client->data)\n\t\tgoto fail;\n\n\tclient->scan = bt_ad_new();\n\tif (!client->scan)\n\t\tgoto fail;\n\n\tclient->manager = manager;\n\tclient->appearance = UINT16_MAX;\n\n\treturn client;\n\nfail:\n\tclient_free(client);\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_error_invalid_args",
          "args": [
            "msg"
          ],
          "line": 1126
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_invalid_args",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "34-38",
          "snippet": "DBusMessage *btd_error_invalid_args(DBusMessage *msg)\n{\n\treturn btd_error_invalid_args_str(msg,\n\t\t\t\t\t\"Invalid arguments in method call\");\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_invalid_args(DBusMessage *msg)\n{\n\treturn btd_error_invalid_args_str(msg,\n\t\t\t\t\t\"Invalid arguments in method call\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_get_arg_type",
          "args": [
            "&args"
          ],
          "line": 1125
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_next",
          "args": [
            "&args"
          ],
          "line": 1123
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_error_already_exists",
          "args": [
            "msg"
          ],
          "line": 1121
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_already_exists",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "52-56",
          "snippet": "DBusMessage *btd_error_already_exists(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".AlreadyExists\",\n\t\t\t\t\t\"Already Exists\");\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_already_exists(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".AlreadyExists\",\n\t\t\t\t\t\"Already Exists\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_find",
          "args": [
            "manager->clients",
            "match_client",
            "&match"
          ],
          "line": 1120
        },
        "resolved": true,
        "details": {
          "function_name": "queue_find",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "231-247",
          "snippet": "void *queue_find(struct queue *queue, queue_match_func_t function,\n\t\t\t\t\t\t\tconst void *match_data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn NULL;\n\n\tif (!function)\n\t\tfunction = direct_match;\n\n\tfor (entry = queue->head; entry; entry = entry->next)\n\t\tif (function(entry->data, match_data))\n\t\t\treturn entry->data;\n\n\treturn NULL;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nvoid *queue_find(struct queue *queue, queue_match_func_t function,\n\t\t\t\t\t\t\tconst void *match_data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn NULL;\n\n\tif (!function)\n\t\tfunction = direct_match;\n\n\tfor (entry = queue->head; entry; entry = entry->next)\n\t\tif (function(entry->data, match_data))\n\t\t\treturn entry->data;\n\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_message_get_sender",
          "args": [
            "msg"
          ],
          "line": 1118
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_get_basic",
          "args": [
            "&args",
            "&match.path"
          ],
          "line": 1116
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_get_arg_type",
          "args": [
            "&args"
          ],
          "line": 1113
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_init",
          "args": [
            "msg",
            "&args"
          ],
          "line": 1110
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"RegisterAdvertisement\""
          ],
          "line": 1108
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"advertising.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/mgmt.h\"\n#include \"src/shared/ad.h\"\n#include \"eir.h\"\n#include \"log.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"adapter.h\"\n#include \"lib/sdp.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <gdbus/gdbus.h>\n#include <dbus/dbus.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <stdint.h>\n\nstatic DBusMessage *register_advertisement(DBusConnection *conn,\n\t\t\t\t\t\tDBusMessage *msg,\n\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct btd_adv_manager *manager = user_data;\n\tDBusMessageIter args;\n\tstruct btd_adv_client *client;\n\tstruct dbus_obj_match match;\n\n\tDBG(\"RegisterAdvertisement\");\n\n\tif (!dbus_message_iter_init(msg, &args))\n\t\treturn btd_error_invalid_args(msg);\n\n\tif (dbus_message_iter_get_arg_type(&args) != DBUS_TYPE_OBJECT_PATH)\n\t\treturn btd_error_invalid_args(msg);\n\n\tdbus_message_iter_get_basic(&args, &match.path);\n\n\tmatch.owner = dbus_message_get_sender(msg);\n\n\tif (queue_find(manager->clients, match_client, &match))\n\t\treturn btd_error_already_exists(msg);\n\n\tdbus_message_iter_next(&args);\n\n\tif (dbus_message_iter_get_arg_type(&args) != DBUS_TYPE_ARRAY)\n\t\treturn btd_error_invalid_args(msg);\n\n\tclient = client_create(manager, conn, msg, match.path);\n\tif (!client)\n\t\treturn btd_error_failed(msg,\n\t\t\t\t\t\"Failed to register advertisement\");\n\n\tclient->instance = util_get_uid(&manager->instance_bitmap,\n\t\t\t\t\t\t\tmanager->max_ads);\n\tif (!client->instance) {\n\t\tclient_free(client);\n\t\treturn btd_error_not_permitted(msg,\n\t\t\t\t\t\"Maximum advertisements reached\");\n\t}\n\n\tDBG(\"Registered advertisement at path %s\", match.path);\n\n\tqueue_push_tail(manager->clients, client);\n\n\treturn NULL;\n}"
  },
  {
    "function_name": "client_create",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/advertising.c",
    "lines": "1047-1097",
    "snippet": "static struct btd_adv_client *client_create(struct btd_adv_manager *manager,\n\t\t\t\t\tDBusConnection *conn,\n\t\t\t\t\tDBusMessage *msg, const char *path)\n{\n\tstruct btd_adv_client *client;\n\tconst char *sender = dbus_message_get_sender(msg);\n\n\tif (!path || !g_str_has_prefix(path, \"/\"))\n\t\treturn NULL;\n\n\tclient = new0(struct btd_adv_client, 1);\n\tclient->client = g_dbus_client_new_full(conn, sender, path, path);\n\tif (!client->client)\n\t\tgoto fail;\n\n\tclient->owner = g_strdup(sender);\n\tif (!client->owner)\n\t\tgoto fail;\n\n\tclient->path = g_strdup(path);\n\tif (!client->path)\n\t\tgoto fail;\n\n\tDBG(\"Adding proxy for %s\", path);\n\tclient->proxy = g_dbus_proxy_new(client->client, path,\n\t\t\t\t\t\tLE_ADVERTISEMENT_IFACE);\n\tif (!client->proxy)\n\t\tgoto fail;\n\n\tg_dbus_client_set_proxy_handlers(client->client, client_proxy_added,\n\t\t\t\t\t\t\tNULL, NULL, client);\n\n\tclient->reg = dbus_message_ref(msg);\n\n\tclient->data = bt_ad_new();\n\tif (!client->data)\n\t\tgoto fail;\n\n\tclient->scan = bt_ad_new();\n\tif (!client->scan)\n\t\tgoto fail;\n\n\tclient->manager = manager;\n\tclient->appearance = UINT16_MAX;\n\n\treturn client;\n\nfail:\n\tclient_free(client);\n\treturn NULL;\n}",
    "includes": [
      "#include \"advertising.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/mgmt.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"eir.h\"",
      "#include \"log.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"adapter.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <gdbus/gdbus.h>",
      "#include <dbus/dbus.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <stdint.h>"
    ],
    "macros_used": [
      "#define LE_ADVERTISEMENT_IFACE \"org.bluez.LEAdvertisement1\""
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "client_free",
          "args": [
            "client"
          ],
          "line": 1095
        },
        "resolved": true,
        "details": {
          "function_name": "client_free_idle_cb",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/advertising.c",
          "lines": "134-139",
          "snippet": "static gboolean client_free_idle_cb(void *data)\n{\n\tclient_free(data);\n\n\treturn FALSE;\n}",
          "includes": [
            "#include \"advertising.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"eir.h\"",
            "#include \"log.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"adapter.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <gdbus/gdbus.h>",
            "#include <dbus/dbus.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <stdint.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"advertising.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/mgmt.h\"\n#include \"src/shared/ad.h\"\n#include \"eir.h\"\n#include \"log.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"adapter.h\"\n#include \"lib/sdp.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <gdbus/gdbus.h>\n#include <dbus/dbus.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <stdint.h>\n\nstatic gboolean client_free_idle_cb(void *data)\n{\n\tclient_free(data);\n\n\treturn FALSE;\n}"
        }
      },
      {
        "call_info": {
          "callee": "bt_ad_new",
          "args": [],
          "line": 1085
        },
        "resolved": true,
        "details": {
          "function_name": "bt_ad_new",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
          "lines": "43-56",
          "snippet": "struct bt_ad *bt_ad_new(void)\n{\n\tstruct bt_ad *ad;\n\n\tad = new0(struct bt_ad, 1);\n\tad->service_uuids = queue_new();\n\tad->manufacturer_data = queue_new();\n\tad->solicit_uuids = queue_new();\n\tad->service_data = queue_new();\n\tad->data = queue_new();\n\tad->appearance = UINT16_MAX;\n\n\treturn bt_ad_ref(ad);\n}",
          "includes": [
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/eir.h\"",
            "#include \"src/shared/ad.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nstruct bt_ad *bt_ad_new(void)\n{\n\tstruct bt_ad *ad;\n\n\tad = new0(struct bt_ad, 1);\n\tad->service_uuids = queue_new();\n\tad->manufacturer_data = queue_new();\n\tad->solicit_uuids = queue_new();\n\tad->service_data = queue_new();\n\tad->data = queue_new();\n\tad->appearance = UINT16_MAX;\n\n\treturn bt_ad_ref(ad);\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_message_ref",
          "args": [
            "msg"
          ],
          "line": 1079
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_dbus_client_set_proxy_handlers",
          "args": [
            "client->client",
            "client_proxy_added",
            "NULL",
            "NULL",
            "client"
          ],
          "line": 1076
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_dbus_proxy_new",
          "args": [
            "client->client",
            "path",
            "LE_ADVERTISEMENT_IFACE"
          ],
          "line": 1071
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"Adding proxy for %s\"",
            "path"
          ],
          "line": 1070
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_strdup",
          "args": [
            "path"
          ],
          "line": 1066
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_strdup",
          "args": [
            "sender"
          ],
          "line": 1062
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_dbus_client_new_full",
          "args": [
            "conn",
            "sender",
            "path",
            "path"
          ],
          "line": 1058
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "new0",
          "args": [
            "structbtd_adv_client",
            "1"
          ],
          "line": 1057
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_str_has_prefix",
          "args": [
            "path",
            "\"/\""
          ],
          "line": 1054
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_get_sender",
          "args": [
            "msg"
          ],
          "line": 1052
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"advertising.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/mgmt.h\"\n#include \"src/shared/ad.h\"\n#include \"eir.h\"\n#include \"log.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"adapter.h\"\n#include \"lib/sdp.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <gdbus/gdbus.h>\n#include <dbus/dbus.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <stdint.h>\n\n#define LE_ADVERTISEMENT_IFACE \"org.bluez.LEAdvertisement1\"\n\nstatic struct btd_adv_client *client_create(struct btd_adv_manager *manager,\n\t\t\t\t\tDBusConnection *conn,\n\t\t\t\t\tDBusMessage *msg, const char *path)\n{\n\tstruct btd_adv_client *client;\n\tconst char *sender = dbus_message_get_sender(msg);\n\n\tif (!path || !g_str_has_prefix(path, \"/\"))\n\t\treturn NULL;\n\n\tclient = new0(struct btd_adv_client, 1);\n\tclient->client = g_dbus_client_new_full(conn, sender, path, path);\n\tif (!client->client)\n\t\tgoto fail;\n\n\tclient->owner = g_strdup(sender);\n\tif (!client->owner)\n\t\tgoto fail;\n\n\tclient->path = g_strdup(path);\n\tif (!client->path)\n\t\tgoto fail;\n\n\tDBG(\"Adding proxy for %s\", path);\n\tclient->proxy = g_dbus_proxy_new(client->client, path,\n\t\t\t\t\t\tLE_ADVERTISEMENT_IFACE);\n\tif (!client->proxy)\n\t\tgoto fail;\n\n\tg_dbus_client_set_proxy_handlers(client->client, client_proxy_added,\n\t\t\t\t\t\t\tNULL, NULL, client);\n\n\tclient->reg = dbus_message_ref(msg);\n\n\tclient->data = bt_ad_new();\n\tif (!client->data)\n\t\tgoto fail;\n\n\tclient->scan = bt_ad_new();\n\tif (!client->scan)\n\t\tgoto fail;\n\n\tclient->manager = manager;\n\tclient->appearance = UINT16_MAX;\n\n\treturn client;\n\nfail:\n\tclient_free(client);\n\treturn NULL;\n}"
  },
  {
    "function_name": "client_proxy_added",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/advertising.c",
    "lines": "1022-1045",
    "snippet": "static void client_proxy_added(GDBusProxy *proxy, void *data)\n{\n\tstruct btd_adv_client *client = data;\n\tDBusMessage *reply;\n\tconst char *interface;\n\n\tinterface = g_dbus_proxy_get_interface(proxy);\n\tif (g_str_equal(interface, LE_ADVERTISEMENT_IFACE) == FALSE)\n\t\treturn;\n\n\treply = parse_advertisement(client);\n\tif (!reply)\n\t\treturn;\n\n\t/* Failed to publish for some reason, remove. */\n\tqueue_remove(client->manager->clients, client);\n\n\tg_idle_add(client_free_idle_cb, client);\n\n\tg_dbus_send_message(btd_get_dbus_connection(), reply);\n\n\tdbus_message_unref(client->reg);\n\tclient->reg = NULL;\n}",
    "includes": [
      "#include \"advertising.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/mgmt.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"eir.h\"",
      "#include \"log.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"adapter.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <gdbus/gdbus.h>",
      "#include <dbus/dbus.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <stdint.h>"
    ],
    "macros_used": [
      "#define LE_ADVERTISEMENT_IFACE \"org.bluez.LEAdvertisement1\""
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "dbus_message_unref",
          "args": [
            "client->reg"
          ],
          "line": 1043
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_dbus_send_message",
          "args": [
            "btd_get_dbus_connection()",
            "reply"
          ],
          "line": 1041
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_get_dbus_connection",
          "args": [],
          "line": 1041
        },
        "resolved": true,
        "details": {
          "function_name": "btd_get_dbus_connection",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/dbus-common.c",
          "lines": "61-64",
          "snippet": "DBusConnection *btd_get_dbus_connection(void)\n{\n\treturn connection;\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <stdint.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static DBusConnection *connection = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <stdint.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *connection = NULL;\n\nDBusConnection *btd_get_dbus_connection(void)\n{\n\treturn connection;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_idle_add",
          "args": [
            "client_free_idle_cb",
            "client"
          ],
          "line": 1039
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "queue_remove",
          "args": [
            "client->manager->clients",
            "client"
          ],
          "line": 1037
        },
        "resolved": true,
        "details": {
          "function_name": "queue_remove_uuid",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
          "lines": "526-541",
          "snippet": "static bool queue_remove_uuid(struct queue *queue, bt_uuid_t *uuid)\n{\n\tbt_uuid_t *removed;\n\n\tif (!queue || !uuid)\n\t\treturn false;\n\n\tremoved = queue_remove_if(queue, uuid_match, uuid);\n\n\tif (removed) {\n\t\tfree(removed);\n\t\treturn true;\n\t}\n\n\treturn false;\n}",
          "includes": [
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/eir.h\"",
            "#include \"src/shared/ad.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nstatic bool queue_remove_uuid(struct queue *queue, bt_uuid_t *uuid)\n{\n\tbt_uuid_t *removed;\n\n\tif (!queue || !uuid)\n\t\treturn false;\n\n\tremoved = queue_remove_if(queue, uuid_match, uuid);\n\n\tif (removed) {\n\t\tfree(removed);\n\t\treturn true;\n\t}\n\n\treturn false;\n}"
        }
      },
      {
        "call_info": {
          "callee": "parse_advertisement",
          "args": [
            "client"
          ],
          "line": 1032
        },
        "resolved": true,
        "details": {
          "function_name": "parse_advertisement",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/advertising.c",
          "lines": "964-1020",
          "snippet": "static DBusMessage *parse_advertisement(struct btd_adv_client *client)\n{\n\tstruct adv_parser *parser;\n\tint err;\n\n\tfor (parser = parsers; parser && parser->name; parser++) {\n\t\tDBusMessageIter iter;\n\n\t\tif (!g_dbus_proxy_get_property(client->proxy, parser->name,\n\t\t\t\t\t\t\t\t&iter))\n\t\t\tcontinue;\n\n\t\tif (!parser->func(&iter, client)) {\n\t\t\terror(\"Error parsing %s property\", parser->name);\n\t\t\tgoto fail;\n\t\t}\n\t}\n\n\tif (bt_ad_has_flags(client->data)) {\n\t\t/* BLUETOOTH SPECIFICATION Version 5.0 | Vol 3, Part C\n\t\t * page 2042:\n\t\t * A device in the broadcast mode shall not set the\n\t\t * LE General Discoverable Mode flag or the\n\t\t * LE Limited Discoverable Mode flag in the Flags AD Type\n\t\t * as defined in [Core Specification Supplement], Part A,\n\t\t * Section 1.3.\n\t\t */\n\t\tif (client->type == AD_TYPE_BROADCAST) {\n\t\t\terror(\"Broadcast cannot set flags\");\n\t\t\tgoto fail;\n\t\t}\n\n\t\t/* Set Limited Discoverable if DiscoverableTimeout is set */\n\t\tif (client->disc_to_id && !set_flags(client, 0x01)) {\n\t\t\terror(\"Failed to set Limited Discoverable Flag\");\n\t\t\tgoto fail;\n\t\t}\n\t} else if (client->disc_to_id) {\n\t\t/* Ignore DiscoverableTimeout if not discoverable */\n\t\tg_source_remove(client->disc_to_id);\n\t\tclient->disc_to_id = 0;\n\t\tclient->discoverable_to = 0;\n\t}\n\n\tif (client->timeout && client->timeout < client->discoverable_to) {\n\t\t/* DiscoverableTimeout must not be bigger than Timeout */\n\t\terror(\"DiscoverableTimeout > Timeout\");\n\t\tgoto fail;\n\t}\n\n\terr = refresh_adv(client, add_adv_callback);\n\tif (!err)\n\t\treturn NULL;\n\nfail:\n\treturn btd_error_failed(client->reg, \"Failed to parse advertisement.\");\n}",
          "includes": [
            "#include \"advertising.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"eir.h\"",
            "#include \"log.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"adapter.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <gdbus/gdbus.h>",
            "#include <dbus/dbus.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <stdint.h>"
          ],
          "macros_used": [
            "#define AD_TYPE_BROADCAST 0"
          ],
          "globals_used": [
            "static struct adv_parser {\n\tconst char *name;\n\tbool (*func)(DBusMessageIter *iter, struct btd_adv_client *client);\n} parsers[] = {\n\t{ \"Type\", parse_type },\n\t{ \"ServiceUUIDs\", parse_service_uuids },\n\t{ \"SolicitUUIDs\", parse_solicit_uuids },\n\t{ \"ManufacturerData\", parse_manufacturer_data },\n\t{ \"ServiceData\", parse_service_data },\n\t{ \"Includes\", parse_includes },\n\t{ \"LocalName\", parse_local_name },\n\t{ \"Appearance\", parse_appearance },\n\t{ \"Duration\", parse_duration },\n\t{ \"Timeout\", parse_timeout },\n\t{ \"Data\", parse_data },\n\t{ \"Discoverable\", parse_discoverable },\n\t{ \"DiscoverableTimeout\", parse_discoverable_timeout },\n\t{ },\n};"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"advertising.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/mgmt.h\"\n#include \"src/shared/ad.h\"\n#include \"eir.h\"\n#include \"log.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"adapter.h\"\n#include \"lib/sdp.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <gdbus/gdbus.h>\n#include <dbus/dbus.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <stdint.h>\n\n#define AD_TYPE_BROADCAST 0\n\nstatic struct adv_parser {\n\tconst char *name;\n\tbool (*func)(DBusMessageIter *iter, struct btd_adv_client *client);\n} parsers[] = {\n\t{ \"Type\", parse_type },\n\t{ \"ServiceUUIDs\", parse_service_uuids },\n\t{ \"SolicitUUIDs\", parse_solicit_uuids },\n\t{ \"ManufacturerData\", parse_manufacturer_data },\n\t{ \"ServiceData\", parse_service_data },\n\t{ \"Includes\", parse_includes },\n\t{ \"LocalName\", parse_local_name },\n\t{ \"Appearance\", parse_appearance },\n\t{ \"Duration\", parse_duration },\n\t{ \"Timeout\", parse_timeout },\n\t{ \"Data\", parse_data },\n\t{ \"Discoverable\", parse_discoverable },\n\t{ \"DiscoverableTimeout\", parse_discoverable_timeout },\n\t{ },\n};\n\nstatic DBusMessage *parse_advertisement(struct btd_adv_client *client)\n{\n\tstruct adv_parser *parser;\n\tint err;\n\n\tfor (parser = parsers; parser && parser->name; parser++) {\n\t\tDBusMessageIter iter;\n\n\t\tif (!g_dbus_proxy_get_property(client->proxy, parser->name,\n\t\t\t\t\t\t\t\t&iter))\n\t\t\tcontinue;\n\n\t\tif (!parser->func(&iter, client)) {\n\t\t\terror(\"Error parsing %s property\", parser->name);\n\t\t\tgoto fail;\n\t\t}\n\t}\n\n\tif (bt_ad_has_flags(client->data)) {\n\t\t/* BLUETOOTH SPECIFICATION Version 5.0 | Vol 3, Part C\n\t\t * page 2042:\n\t\t * A device in the broadcast mode shall not set the\n\t\t * LE General Discoverable Mode flag or the\n\t\t * LE Limited Discoverable Mode flag in the Flags AD Type\n\t\t * as defined in [Core Specification Supplement], Part A,\n\t\t * Section 1.3.\n\t\t */\n\t\tif (client->type == AD_TYPE_BROADCAST) {\n\t\t\terror(\"Broadcast cannot set flags\");\n\t\t\tgoto fail;\n\t\t}\n\n\t\t/* Set Limited Discoverable if DiscoverableTimeout is set */\n\t\tif (client->disc_to_id && !set_flags(client, 0x01)) {\n\t\t\terror(\"Failed to set Limited Discoverable Flag\");\n\t\t\tgoto fail;\n\t\t}\n\t} else if (client->disc_to_id) {\n\t\t/* Ignore DiscoverableTimeout if not discoverable */\n\t\tg_source_remove(client->disc_to_id);\n\t\tclient->disc_to_id = 0;\n\t\tclient->discoverable_to = 0;\n\t}\n\n\tif (client->timeout && client->timeout < client->discoverable_to) {\n\t\t/* DiscoverableTimeout must not be bigger than Timeout */\n\t\terror(\"DiscoverableTimeout > Timeout\");\n\t\tgoto fail;\n\t}\n\n\terr = refresh_adv(client, add_adv_callback);\n\tif (!err)\n\t\treturn NULL;\n\nfail:\n\treturn btd_error_failed(client->reg, \"Failed to parse advertisement.\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_str_equal",
          "args": [
            "interface",
            "LE_ADVERTISEMENT_IFACE"
          ],
          "line": 1029
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_dbus_proxy_get_interface",
          "args": [
            "proxy"
          ],
          "line": 1028
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"advertising.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/mgmt.h\"\n#include \"src/shared/ad.h\"\n#include \"eir.h\"\n#include \"log.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"adapter.h\"\n#include \"lib/sdp.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <gdbus/gdbus.h>\n#include <dbus/dbus.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <stdint.h>\n\n#define LE_ADVERTISEMENT_IFACE \"org.bluez.LEAdvertisement1\"\n\nstatic void client_proxy_added(GDBusProxy *proxy, void *data)\n{\n\tstruct btd_adv_client *client = data;\n\tDBusMessage *reply;\n\tconst char *interface;\n\n\tinterface = g_dbus_proxy_get_interface(proxy);\n\tif (g_str_equal(interface, LE_ADVERTISEMENT_IFACE) == FALSE)\n\t\treturn;\n\n\treply = parse_advertisement(client);\n\tif (!reply)\n\t\treturn;\n\n\t/* Failed to publish for some reason, remove. */\n\tqueue_remove(client->manager->clients, client);\n\n\tg_idle_add(client_free_idle_cb, client);\n\n\tg_dbus_send_message(btd_get_dbus_connection(), reply);\n\n\tdbus_message_unref(client->reg);\n\tclient->reg = NULL;\n}"
  },
  {
    "function_name": "parse_advertisement",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/advertising.c",
    "lines": "964-1020",
    "snippet": "static DBusMessage *parse_advertisement(struct btd_adv_client *client)\n{\n\tstruct adv_parser *parser;\n\tint err;\n\n\tfor (parser = parsers; parser && parser->name; parser++) {\n\t\tDBusMessageIter iter;\n\n\t\tif (!g_dbus_proxy_get_property(client->proxy, parser->name,\n\t\t\t\t\t\t\t\t&iter))\n\t\t\tcontinue;\n\n\t\tif (!parser->func(&iter, client)) {\n\t\t\terror(\"Error parsing %s property\", parser->name);\n\t\t\tgoto fail;\n\t\t}\n\t}\n\n\tif (bt_ad_has_flags(client->data)) {\n\t\t/* BLUETOOTH SPECIFICATION Version 5.0 | Vol 3, Part C\n\t\t * page 2042:\n\t\t * A device in the broadcast mode shall not set the\n\t\t * LE General Discoverable Mode flag or the\n\t\t * LE Limited Discoverable Mode flag in the Flags AD Type\n\t\t * as defined in [Core Specification Supplement], Part A,\n\t\t * Section 1.3.\n\t\t */\n\t\tif (client->type == AD_TYPE_BROADCAST) {\n\t\t\terror(\"Broadcast cannot set flags\");\n\t\t\tgoto fail;\n\t\t}\n\n\t\t/* Set Limited Discoverable if DiscoverableTimeout is set */\n\t\tif (client->disc_to_id && !set_flags(client, 0x01)) {\n\t\t\terror(\"Failed to set Limited Discoverable Flag\");\n\t\t\tgoto fail;\n\t\t}\n\t} else if (client->disc_to_id) {\n\t\t/* Ignore DiscoverableTimeout if not discoverable */\n\t\tg_source_remove(client->disc_to_id);\n\t\tclient->disc_to_id = 0;\n\t\tclient->discoverable_to = 0;\n\t}\n\n\tif (client->timeout && client->timeout < client->discoverable_to) {\n\t\t/* DiscoverableTimeout must not be bigger than Timeout */\n\t\terror(\"DiscoverableTimeout > Timeout\");\n\t\tgoto fail;\n\t}\n\n\terr = refresh_adv(client, add_adv_callback);\n\tif (!err)\n\t\treturn NULL;\n\nfail:\n\treturn btd_error_failed(client->reg, \"Failed to parse advertisement.\");\n}",
    "includes": [
      "#include \"advertising.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/mgmt.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"eir.h\"",
      "#include \"log.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"adapter.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <gdbus/gdbus.h>",
      "#include <dbus/dbus.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <stdint.h>"
    ],
    "macros_used": [
      "#define AD_TYPE_BROADCAST 0"
    ],
    "globals_used": [
      "static struct adv_parser {\n\tconst char *name;\n\tbool (*func)(DBusMessageIter *iter, struct btd_adv_client *client);\n} parsers[] = {\n\t{ \"Type\", parse_type },\n\t{ \"ServiceUUIDs\", parse_service_uuids },\n\t{ \"SolicitUUIDs\", parse_solicit_uuids },\n\t{ \"ManufacturerData\", parse_manufacturer_data },\n\t{ \"ServiceData\", parse_service_data },\n\t{ \"Includes\", parse_includes },\n\t{ \"LocalName\", parse_local_name },\n\t{ \"Appearance\", parse_appearance },\n\t{ \"Duration\", parse_duration },\n\t{ \"Timeout\", parse_timeout },\n\t{ \"Data\", parse_data },\n\t{ \"Discoverable\", parse_discoverable },\n\t{ \"DiscoverableTimeout\", parse_discoverable_timeout },\n\t{ },\n};"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "btd_error_failed",
          "args": [
            "client->reg",
            "\"Failed to parse advertisement.\""
          ],
          "line": 1019
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_failed",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "124-128",
          "snippet": "DBusMessage *btd_error_failed(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE\n\t\t\t\t\t\".Failed\", \"%s\", str);\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_failed(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE\n\t\t\t\t\t\".Failed\", \"%s\", str);\n}"
        }
      },
      {
        "call_info": {
          "callee": "refresh_adv",
          "args": [
            "client",
            "add_adv_callback"
          ],
          "line": 1014
        },
        "resolved": true,
        "details": {
          "function_name": "refresh_adv",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/advertising.c",
          "lines": "762-830",
          "snippet": "static int refresh_adv(struct btd_adv_client *client, mgmt_request_func_t func)\n{\n\tstruct mgmt_cp_add_advertising *cp;\n\tuint8_t param_len;\n\tuint8_t *adv_data;\n\tsize_t adv_data_len;\n\tuint8_t *scan_rsp;\n\tsize_t scan_rsp_len = -1;\n\tuint32_t flags = 0;\n\n\tDBG(\"Refreshing advertisement: %s\", client->path);\n\n\tif (client->type == AD_TYPE_PERIPHERAL) {\n\t\tflags = MGMT_ADV_FLAG_CONNECTABLE;\n\n\t\tif (btd_adapter_get_discoverable(client->manager->adapter) &&\n\t\t\t\t!(bt_ad_has_flags(client->data)))\n\t\t\tflags |= MGMT_ADV_FLAG_DISCOV;\n\t}\n\n\tflags |= client->flags;\n\n\tadv_data = generate_adv_data(client, &flags, &adv_data_len);\n\tif (!adv_data || (adv_data_len > calc_max_adv_len(client, flags))) {\n\t\terror(\"Advertising data too long or couldn't be generated.\");\n\t\treturn -EINVAL;\n\t}\n\n\tscan_rsp = generate_scan_rsp(client, &flags, &scan_rsp_len);\n\tif (!scan_rsp && scan_rsp_len) {\n\t\terror(\"Scan data couldn't be generated.\");\n\t\tfree(adv_data);\n\t\treturn -EINVAL;\n\t}\n\n\tparam_len = sizeof(struct mgmt_cp_add_advertising) + adv_data_len +\n\t\t\t\t\t\t\tscan_rsp_len;\n\n\tcp = malloc0(param_len);\n\tif (!cp) {\n\t\terror(\"Couldn't allocate for MGMT!\");\n\t\tfree(adv_data);\n\t\tfree(scan_rsp);\n\t\treturn -ENOMEM;\n\t}\n\n\tcp->flags = htobl(flags);\n\tcp->instance = client->instance;\n\tcp->duration = client->duration;\n\tcp->adv_data_len = adv_data_len;\n\tcp->scan_rsp_len = scan_rsp_len;\n\tmemcpy(cp->data, adv_data, adv_data_len);\n\tmemcpy(cp->data + adv_data_len, scan_rsp, scan_rsp_len);\n\n\tfree(adv_data);\n\tfree(scan_rsp);\n\n\tif (!mgmt_send(client->manager->mgmt, MGMT_OP_ADD_ADVERTISING,\n\t\t\t\tclient->manager->mgmt_index, param_len, cp,\n\t\t\t\tfunc, client, NULL)) {\n\t\terror(\"Failed to add Advertising Data\");\n\t\tfree(cp);\n\t\treturn -EINVAL;\n\t}\n\n\tfree(cp);\n\n\treturn 0;\n}",
          "includes": [
            "#include \"advertising.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"eir.h\"",
            "#include \"log.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"adapter.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <gdbus/gdbus.h>",
            "#include <dbus/dbus.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <stdint.h>"
          ],
          "macros_used": [
            "#define AD_TYPE_PERIPHERAL 1"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"advertising.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/mgmt.h\"\n#include \"src/shared/ad.h\"\n#include \"eir.h\"\n#include \"log.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"adapter.h\"\n#include \"lib/sdp.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <gdbus/gdbus.h>\n#include <dbus/dbus.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <stdint.h>\n\n#define AD_TYPE_PERIPHERAL 1\n\nstatic int refresh_adv(struct btd_adv_client *client, mgmt_request_func_t func)\n{\n\tstruct mgmt_cp_add_advertising *cp;\n\tuint8_t param_len;\n\tuint8_t *adv_data;\n\tsize_t adv_data_len;\n\tuint8_t *scan_rsp;\n\tsize_t scan_rsp_len = -1;\n\tuint32_t flags = 0;\n\n\tDBG(\"Refreshing advertisement: %s\", client->path);\n\n\tif (client->type == AD_TYPE_PERIPHERAL) {\n\t\tflags = MGMT_ADV_FLAG_CONNECTABLE;\n\n\t\tif (btd_adapter_get_discoverable(client->manager->adapter) &&\n\t\t\t\t!(bt_ad_has_flags(client->data)))\n\t\t\tflags |= MGMT_ADV_FLAG_DISCOV;\n\t}\n\n\tflags |= client->flags;\n\n\tadv_data = generate_adv_data(client, &flags, &adv_data_len);\n\tif (!adv_data || (adv_data_len > calc_max_adv_len(client, flags))) {\n\t\terror(\"Advertising data too long or couldn't be generated.\");\n\t\treturn -EINVAL;\n\t}\n\n\tscan_rsp = generate_scan_rsp(client, &flags, &scan_rsp_len);\n\tif (!scan_rsp && scan_rsp_len) {\n\t\terror(\"Scan data couldn't be generated.\");\n\t\tfree(adv_data);\n\t\treturn -EINVAL;\n\t}\n\n\tparam_len = sizeof(struct mgmt_cp_add_advertising) + adv_data_len +\n\t\t\t\t\t\t\tscan_rsp_len;\n\n\tcp = malloc0(param_len);\n\tif (!cp) {\n\t\terror(\"Couldn't allocate for MGMT!\");\n\t\tfree(adv_data);\n\t\tfree(scan_rsp);\n\t\treturn -ENOMEM;\n\t}\n\n\tcp->flags = htobl(flags);\n\tcp->instance = client->instance;\n\tcp->duration = client->duration;\n\tcp->adv_data_len = adv_data_len;\n\tcp->scan_rsp_len = scan_rsp_len;\n\tmemcpy(cp->data, adv_data, adv_data_len);\n\tmemcpy(cp->data + adv_data_len, scan_rsp, scan_rsp_len);\n\n\tfree(adv_data);\n\tfree(scan_rsp);\n\n\tif (!mgmt_send(client->manager->mgmt, MGMT_OP_ADD_ADVERTISING,\n\t\t\t\tclient->manager->mgmt_index, param_len, cp,\n\t\t\t\tfunc, client, NULL)) {\n\t\terror(\"Failed to add Advertising Data\");\n\t\tfree(cp);\n\t\treturn -EINVAL;\n\t}\n\n\tfree(cp);\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"DiscoverableTimeout > Timeout\""
          ],
          "line": 1010
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_not_ready",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "118-122",
          "snippet": "DBusMessage *btd_error_not_ready(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".NotReady\",\n\t\t\t\t\t\"Resource Not Ready\");\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_not_ready(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".NotReady\",\n\t\t\t\t\t\"Resource Not Ready\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_source_remove",
          "args": [
            "client->disc_to_id"
          ],
          "line": 1003
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "set_flags",
          "args": [
            "client",
            "0x01"
          ],
          "line": 997
        },
        "resolved": true,
        "details": {
          "function_name": "set_flags",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/advertising.c",
          "lines": "649-664",
          "snippet": "static bool set_flags(struct btd_adv_client *client, uint8_t flags)\n{\n\tif (!flags) {\n\t\tbt_ad_clear_flags(client->data);\n\t\treturn true;\n\t}\n\n\t/* Set BR/EDR Not Supported for LE only */\n\tif (!btd_adapter_get_bredr(client->manager->adapter))\n\t\tflags |= 0x04;\n\n\tif (!bt_ad_add_flags(client->data, &flags, 1))\n\t\treturn false;\n\n\treturn true;\n}",
          "includes": [
            "#include \"advertising.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"eir.h\"",
            "#include \"log.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"adapter.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <gdbus/gdbus.h>",
            "#include <dbus/dbus.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <stdint.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"advertising.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/mgmt.h\"\n#include \"src/shared/ad.h\"\n#include \"eir.h\"\n#include \"log.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"adapter.h\"\n#include \"lib/sdp.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <gdbus/gdbus.h>\n#include <dbus/dbus.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <stdint.h>\n\nstatic bool set_flags(struct btd_adv_client *client, uint8_t flags)\n{\n\tif (!flags) {\n\t\tbt_ad_clear_flags(client->data);\n\t\treturn true;\n\t}\n\n\t/* Set BR/EDR Not Supported for LE only */\n\tif (!btd_adapter_get_bredr(client->manager->adapter))\n\t\tflags |= 0x04;\n\n\tif (!bt_ad_add_flags(client->data, &flags, 1))\n\t\treturn false;\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "bt_ad_has_flags",
          "args": [
            "client->data"
          ],
          "line": 982
        },
        "resolved": true,
        "details": {
          "function_name": "bt_ad_has_flags",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
          "lines": "866-878",
          "snippet": "bool bt_ad_has_flags(struct bt_ad *ad)\n{\n\tstruct bt_ad_data *data;\n\n\tif (!ad)\n\t\treturn false;\n\n\tdata = queue_find(ad->data, data_type_match, UINT_TO_PTR(BT_AD_FLAGS));\n\tif (!data)\n\t\treturn false;\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/eir.h\"",
            "#include \"src/shared/ad.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nbool bt_ad_has_flags(struct bt_ad *ad)\n{\n\tstruct bt_ad_data *data;\n\n\tif (!ad)\n\t\treturn false;\n\n\tdata = queue_find(ad->data, data_type_match, UINT_TO_PTR(BT_AD_FLAGS));\n\tif (!data)\n\t\treturn false;\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "parser->func",
          "args": [
            "&iter",
            "client"
          ],
          "line": 976
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_dbus_proxy_get_property",
          "args": [
            "client->proxy",
            "parser->name",
            "&iter"
          ],
          "line": 972
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"advertising.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/mgmt.h\"\n#include \"src/shared/ad.h\"\n#include \"eir.h\"\n#include \"log.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"adapter.h\"\n#include \"lib/sdp.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <gdbus/gdbus.h>\n#include <dbus/dbus.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <stdint.h>\n\n#define AD_TYPE_BROADCAST 0\n\nstatic struct adv_parser {\n\tconst char *name;\n\tbool (*func)(DBusMessageIter *iter, struct btd_adv_client *client);\n} parsers[] = {\n\t{ \"Type\", parse_type },\n\t{ \"ServiceUUIDs\", parse_service_uuids },\n\t{ \"SolicitUUIDs\", parse_solicit_uuids },\n\t{ \"ManufacturerData\", parse_manufacturer_data },\n\t{ \"ServiceData\", parse_service_data },\n\t{ \"Includes\", parse_includes },\n\t{ \"LocalName\", parse_local_name },\n\t{ \"Appearance\", parse_appearance },\n\t{ \"Duration\", parse_duration },\n\t{ \"Timeout\", parse_timeout },\n\t{ \"Data\", parse_data },\n\t{ \"Discoverable\", parse_discoverable },\n\t{ \"DiscoverableTimeout\", parse_discoverable_timeout },\n\t{ },\n};\n\nstatic DBusMessage *parse_advertisement(struct btd_adv_client *client)\n{\n\tstruct adv_parser *parser;\n\tint err;\n\n\tfor (parser = parsers; parser && parser->name; parser++) {\n\t\tDBusMessageIter iter;\n\n\t\tif (!g_dbus_proxy_get_property(client->proxy, parser->name,\n\t\t\t\t\t\t\t\t&iter))\n\t\t\tcontinue;\n\n\t\tif (!parser->func(&iter, client)) {\n\t\t\terror(\"Error parsing %s property\", parser->name);\n\t\t\tgoto fail;\n\t\t}\n\t}\n\n\tif (bt_ad_has_flags(client->data)) {\n\t\t/* BLUETOOTH SPECIFICATION Version 5.0 | Vol 3, Part C\n\t\t * page 2042:\n\t\t * A device in the broadcast mode shall not set the\n\t\t * LE General Discoverable Mode flag or the\n\t\t * LE Limited Discoverable Mode flag in the Flags AD Type\n\t\t * as defined in [Core Specification Supplement], Part A,\n\t\t * Section 1.3.\n\t\t */\n\t\tif (client->type == AD_TYPE_BROADCAST) {\n\t\t\terror(\"Broadcast cannot set flags\");\n\t\t\tgoto fail;\n\t\t}\n\n\t\t/* Set Limited Discoverable if DiscoverableTimeout is set */\n\t\tif (client->disc_to_id && !set_flags(client, 0x01)) {\n\t\t\terror(\"Failed to set Limited Discoverable Flag\");\n\t\t\tgoto fail;\n\t\t}\n\t} else if (client->disc_to_id) {\n\t\t/* Ignore DiscoverableTimeout if not discoverable */\n\t\tg_source_remove(client->disc_to_id);\n\t\tclient->disc_to_id = 0;\n\t\tclient->discoverable_to = 0;\n\t}\n\n\tif (client->timeout && client->timeout < client->discoverable_to) {\n\t\t/* DiscoverableTimeout must not be bigger than Timeout */\n\t\terror(\"DiscoverableTimeout > Timeout\");\n\t\tgoto fail;\n\t}\n\n\terr = refresh_adv(client, add_adv_callback);\n\tif (!err)\n\t\treturn NULL;\n\nfail:\n\treturn btd_error_failed(client->reg, \"Failed to parse advertisement.\");\n}"
  },
  {
    "function_name": "add_adv_callback",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/advertising.c",
    "lines": "929-962",
    "snippet": "static void add_adv_callback(uint8_t status, uint16_t length,\n\t\t\t\t\t  const void *param, void *user_data)\n{\n\tstruct btd_adv_client *client = user_data;\n\tconst struct mgmt_rp_add_advertising *rp = param;\n\n\tif (status)\n\t\tgoto done;\n\n\tif (!param || length < sizeof(*rp)) {\n\t\tstatus = MGMT_STATUS_FAILED;\n\t\tgoto done;\n\t}\n\n\tclient->instance = rp->instance;\n\n\tg_dbus_client_set_disconnect_watch(client->client, client_disconnect_cb,\n\t\t\t\t\t\t\t\t\tclient);\n\tDBG(\"Advertisement registered: %s\", client->path);\n\n\tg_dbus_emit_property_changed(btd_get_dbus_connection(),\n\t\t\t\tadapter_get_path(client->manager->adapter),\n\t\t\t\tLE_ADVERTISING_MGR_IFACE, \"SupportedInstances\");\n\n\tg_dbus_emit_property_changed(btd_get_dbus_connection(),\n\t\t\t\tadapter_get_path(client->manager->adapter),\n\t\t\t\tLE_ADVERTISING_MGR_IFACE, \"ActiveInstances\");\n\n\tg_dbus_proxy_set_property_watch(client->proxy, properties_changed,\n\t\t\t\t\t\t\t\tclient);\n\ndone:\n\tadd_client_complete(client, status);\n}",
    "includes": [
      "#include \"advertising.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/mgmt.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"eir.h\"",
      "#include \"log.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"adapter.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <gdbus/gdbus.h>",
      "#include <dbus/dbus.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <stdint.h>"
    ],
    "macros_used": [
      "#define LE_ADVERTISING_MGR_IFACE \"org.bluez.LEAdvertisingManager1\""
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "add_client_complete",
          "args": [
            "client",
            "status"
          ],
          "line": 961
        },
        "resolved": true,
        "details": {
          "function_name": "add_client_complete",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/advertising.c",
          "lines": "909-927",
          "snippet": "static void add_client_complete(struct btd_adv_client *client, uint8_t status)\n{\n\tDBusMessage *reply;\n\n\tif (status) {\n\t\terror(\"Failed to add advertisement: %s (0x%02x)\",\n\t\t\t\t\t\tmgmt_errstr(status), status);\n\t\treply = btd_error_failed(client->reg,\n\t\t\t\t\t\"Failed to register advertisement\");\n\t\tqueue_remove(client->manager->clients, client);\n\t\tg_idle_add(client_free_idle_cb, client);\n\n\t} else\n\t\treply = dbus_message_new_method_return(client->reg);\n\n\tg_dbus_send_message(btd_get_dbus_connection(), reply);\n\tdbus_message_unref(client->reg);\n\tclient->reg = NULL;\n}",
          "includes": [
            "#include \"advertising.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"eir.h\"",
            "#include \"log.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"adapter.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <gdbus/gdbus.h>",
            "#include <dbus/dbus.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <stdint.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"advertising.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/mgmt.h\"\n#include \"src/shared/ad.h\"\n#include \"eir.h\"\n#include \"log.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"adapter.h\"\n#include \"lib/sdp.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <gdbus/gdbus.h>\n#include <dbus/dbus.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <stdint.h>\n\nstatic void add_client_complete(struct btd_adv_client *client, uint8_t status)\n{\n\tDBusMessage *reply;\n\n\tif (status) {\n\t\terror(\"Failed to add advertisement: %s (0x%02x)\",\n\t\t\t\t\t\tmgmt_errstr(status), status);\n\t\treply = btd_error_failed(client->reg,\n\t\t\t\t\t\"Failed to register advertisement\");\n\t\tqueue_remove(client->manager->clients, client);\n\t\tg_idle_add(client_free_idle_cb, client);\n\n\t} else\n\t\treply = dbus_message_new_method_return(client->reg);\n\n\tg_dbus_send_message(btd_get_dbus_connection(), reply);\n\tdbus_message_unref(client->reg);\n\tclient->reg = NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_dbus_proxy_set_property_watch",
          "args": [
            "client->proxy",
            "properties_changed",
            "client"
          ],
          "line": 957
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_dbus_emit_property_changed",
          "args": [
            "btd_get_dbus_connection()",
            "adapter_get_path(client->manager->adapter)",
            "LE_ADVERTISING_MGR_IFACE",
            "\"ActiveInstances\""
          ],
          "line": 953
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "adapter_get_path",
          "args": [
            "client->manager->adapter"
          ],
          "line": 954
        },
        "resolved": true,
        "details": {
          "function_name": "adapter_get_path",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "5873-5879",
          "snippet": "const char *adapter_get_path(struct btd_adapter *adapter)\n{\n\tif (!adapter)\n\t\treturn NULL;\n\n\treturn adapter->path;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void trigger_pairable_timeout(struct btd_adapter *adapter);",
            "static void adapter_start(struct btd_adapter *adapter);",
            "static void adapter_stop(struct btd_adapter *adapter);",
            "static void trigger_passive_scanning(struct btd_adapter *adapter);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void trigger_pairable_timeout(struct btd_adapter *adapter);\nstatic void adapter_start(struct btd_adapter *adapter);\nstatic void adapter_stop(struct btd_adapter *adapter);\nstatic void trigger_passive_scanning(struct btd_adapter *adapter);\n\nconst char *adapter_get_path(struct btd_adapter *adapter)\n{\n\tif (!adapter)\n\t\treturn NULL;\n\n\treturn adapter->path;\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_get_dbus_connection",
          "args": [],
          "line": 953
        },
        "resolved": true,
        "details": {
          "function_name": "btd_get_dbus_connection",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/dbus-common.c",
          "lines": "61-64",
          "snippet": "DBusConnection *btd_get_dbus_connection(void)\n{\n\treturn connection;\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <stdint.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static DBusConnection *connection = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <stdint.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *connection = NULL;\n\nDBusConnection *btd_get_dbus_connection(void)\n{\n\treturn connection;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_dbus_emit_property_changed",
          "args": [
            "btd_get_dbus_connection()",
            "adapter_get_path(client->manager->adapter)",
            "LE_ADVERTISING_MGR_IFACE",
            "\"SupportedInstances\""
          ],
          "line": 949
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"Advertisement registered: %s\"",
            "client->path"
          ],
          "line": 947
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_dbus_client_set_disconnect_watch",
          "args": [
            "client->client",
            "client_disconnect_cb",
            "client"
          ],
          "line": 945
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"advertising.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/mgmt.h\"\n#include \"src/shared/ad.h\"\n#include \"eir.h\"\n#include \"log.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"adapter.h\"\n#include \"lib/sdp.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <gdbus/gdbus.h>\n#include <dbus/dbus.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <stdint.h>\n\n#define LE_ADVERTISING_MGR_IFACE \"org.bluez.LEAdvertisingManager1\"\n\nstatic void add_adv_callback(uint8_t status, uint16_t length,\n\t\t\t\t\t  const void *param, void *user_data)\n{\n\tstruct btd_adv_client *client = user_data;\n\tconst struct mgmt_rp_add_advertising *rp = param;\n\n\tif (status)\n\t\tgoto done;\n\n\tif (!param || length < sizeof(*rp)) {\n\t\tstatus = MGMT_STATUS_FAILED;\n\t\tgoto done;\n\t}\n\n\tclient->instance = rp->instance;\n\n\tg_dbus_client_set_disconnect_watch(client->client, client_disconnect_cb,\n\t\t\t\t\t\t\t\t\tclient);\n\tDBG(\"Advertisement registered: %s\", client->path);\n\n\tg_dbus_emit_property_changed(btd_get_dbus_connection(),\n\t\t\t\tadapter_get_path(client->manager->adapter),\n\t\t\t\tLE_ADVERTISING_MGR_IFACE, \"SupportedInstances\");\n\n\tg_dbus_emit_property_changed(btd_get_dbus_connection(),\n\t\t\t\tadapter_get_path(client->manager->adapter),\n\t\t\t\tLE_ADVERTISING_MGR_IFACE, \"ActiveInstances\");\n\n\tg_dbus_proxy_set_property_watch(client->proxy, properties_changed,\n\t\t\t\t\t\t\t\tclient);\n\ndone:\n\tadd_client_complete(client, status);\n}"
  },
  {
    "function_name": "add_client_complete",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/advertising.c",
    "lines": "909-927",
    "snippet": "static void add_client_complete(struct btd_adv_client *client, uint8_t status)\n{\n\tDBusMessage *reply;\n\n\tif (status) {\n\t\terror(\"Failed to add advertisement: %s (0x%02x)\",\n\t\t\t\t\t\tmgmt_errstr(status), status);\n\t\treply = btd_error_failed(client->reg,\n\t\t\t\t\t\"Failed to register advertisement\");\n\t\tqueue_remove(client->manager->clients, client);\n\t\tg_idle_add(client_free_idle_cb, client);\n\n\t} else\n\t\treply = dbus_message_new_method_return(client->reg);\n\n\tg_dbus_send_message(btd_get_dbus_connection(), reply);\n\tdbus_message_unref(client->reg);\n\tclient->reg = NULL;\n}",
    "includes": [
      "#include \"advertising.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/mgmt.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"eir.h\"",
      "#include \"log.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"adapter.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <gdbus/gdbus.h>",
      "#include <dbus/dbus.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <stdint.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "dbus_message_unref",
          "args": [
            "client->reg"
          ],
          "line": 925
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_dbus_send_message",
          "args": [
            "btd_get_dbus_connection()",
            "reply"
          ],
          "line": 924
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_get_dbus_connection",
          "args": [],
          "line": 924
        },
        "resolved": true,
        "details": {
          "function_name": "btd_get_dbus_connection",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/dbus-common.c",
          "lines": "61-64",
          "snippet": "DBusConnection *btd_get_dbus_connection(void)\n{\n\treturn connection;\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <stdint.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static DBusConnection *connection = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <stdint.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *connection = NULL;\n\nDBusConnection *btd_get_dbus_connection(void)\n{\n\treturn connection;\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_message_new_method_return",
          "args": [
            "client->reg"
          ],
          "line": 922
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_idle_add",
          "args": [
            "client_free_idle_cb",
            "client"
          ],
          "line": 919
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "queue_remove",
          "args": [
            "client->manager->clients",
            "client"
          ],
          "line": 918
        },
        "resolved": true,
        "details": {
          "function_name": "queue_remove_uuid",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
          "lines": "526-541",
          "snippet": "static bool queue_remove_uuid(struct queue *queue, bt_uuid_t *uuid)\n{\n\tbt_uuid_t *removed;\n\n\tif (!queue || !uuid)\n\t\treturn false;\n\n\tremoved = queue_remove_if(queue, uuid_match, uuid);\n\n\tif (removed) {\n\t\tfree(removed);\n\t\treturn true;\n\t}\n\n\treturn false;\n}",
          "includes": [
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/eir.h\"",
            "#include \"src/shared/ad.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nstatic bool queue_remove_uuid(struct queue *queue, bt_uuid_t *uuid)\n{\n\tbt_uuid_t *removed;\n\n\tif (!queue || !uuid)\n\t\treturn false;\n\n\tremoved = queue_remove_if(queue, uuid_match, uuid);\n\n\tif (removed) {\n\t\tfree(removed);\n\t\treturn true;\n\t}\n\n\treturn false;\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_error_failed",
          "args": [
            "client->reg",
            "\"Failed to register advertisement\""
          ],
          "line": 916
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_failed",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "124-128",
          "snippet": "DBusMessage *btd_error_failed(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE\n\t\t\t\t\t\".Failed\", \"%s\", str);\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_failed(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE\n\t\t\t\t\t\".Failed\", \"%s\", str);\n}"
        }
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"Failed to add advertisement: %s (0x%02x)\"",
            "mgmt_errstr(status)",
            "status"
          ],
          "line": 914
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/log.c",
          "lines": "199-213",
          "snippet": "void btd_error(uint16_t index, const char *format, ...)\n{\n\tva_list ap;\n\n\tva_start(ap, format);\n\tvsyslog(LOG_ERR, format, ap);\n\tva_end(ap);\n\n\tif (logging_fd < 0)\n\t\treturn;\n\n\tva_start(ap, format);\n\tlogging_log(index, LOG_ERR, format, ap);\n\tva_end(ap);\n}",
          "includes": [
            "#include \"log.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/hci.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <sys/socket.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <stdarg.h>",
            "#include <syslog.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int logging_fd = -1;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n#include \"src/shared/util.h\"\n#include \"lib/hci.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <sys/socket.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdarg.h>\n#include <syslog.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic int logging_fd = -1;\n\nvoid btd_error(uint16_t index, const char *format, ...)\n{\n\tva_list ap;\n\n\tva_start(ap, format);\n\tvsyslog(LOG_ERR, format, ap);\n\tva_end(ap);\n\n\tif (logging_fd < 0)\n\t\treturn;\n\n\tva_start(ap, format);\n\tlogging_log(index, LOG_ERR, format, ap);\n\tva_end(ap);\n}"
        }
      },
      {
        "call_info": {
          "callee": "mgmt_errstr",
          "args": [
            "status"
          ],
          "line": 915
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"advertising.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/mgmt.h\"\n#include \"src/shared/ad.h\"\n#include \"eir.h\"\n#include \"log.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"adapter.h\"\n#include \"lib/sdp.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <gdbus/gdbus.h>\n#include <dbus/dbus.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <stdint.h>\n\nstatic void add_client_complete(struct btd_adv_client *client, uint8_t status)\n{\n\tDBusMessage *reply;\n\n\tif (status) {\n\t\terror(\"Failed to add advertisement: %s (0x%02x)\",\n\t\t\t\t\t\tmgmt_errstr(status), status);\n\t\treply = btd_error_failed(client->reg,\n\t\t\t\t\t\"Failed to register advertisement\");\n\t\tqueue_remove(client->manager->clients, client);\n\t\tg_idle_add(client_free_idle_cb, client);\n\n\t} else\n\t\treply = dbus_message_new_method_return(client->reg);\n\n\tg_dbus_send_message(btd_get_dbus_connection(), reply);\n\tdbus_message_unref(client->reg);\n\tclient->reg = NULL;\n}"
  },
  {
    "function_name": "properties_changed",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/advertising.c",
    "lines": "892-907",
    "snippet": "static void properties_changed(GDBusProxy *proxy, const char *name,\n\t\t\t\t\tDBusMessageIter *iter, void *user_data)\n{\n\tstruct btd_adv_client *client = user_data;\n\tstruct adv_parser *parser;\n\n\tfor (parser = parsers; parser && parser->name; parser++) {\n\t\tif (strcmp(parser->name, name))\n\t\t\tcontinue;\n\n\t\tif (parser->func(iter, client)) {\n\t\t\trefresh_adv(client, NULL);\n\t\t\tbreak;\n\t\t}\n\t}\n}",
    "includes": [
      "#include \"advertising.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/mgmt.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"eir.h\"",
      "#include \"log.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"adapter.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <gdbus/gdbus.h>",
      "#include <dbus/dbus.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <stdint.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static struct adv_parser {\n\tconst char *name;\n\tbool (*func)(DBusMessageIter *iter, struct btd_adv_client *client);\n} parsers[] = {\n\t{ \"Type\", parse_type },\n\t{ \"ServiceUUIDs\", parse_service_uuids },\n\t{ \"SolicitUUIDs\", parse_solicit_uuids },\n\t{ \"ManufacturerData\", parse_manufacturer_data },\n\t{ \"ServiceData\", parse_service_data },\n\t{ \"Includes\", parse_includes },\n\t{ \"LocalName\", parse_local_name },\n\t{ \"Appearance\", parse_appearance },\n\t{ \"Duration\", parse_duration },\n\t{ \"Timeout\", parse_timeout },\n\t{ \"Data\", parse_data },\n\t{ \"Discoverable\", parse_discoverable },\n\t{ \"DiscoverableTimeout\", parse_discoverable_timeout },\n\t{ },\n};"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "refresh_adv",
          "args": [
            "client",
            "NULL"
          ],
          "line": 903
        },
        "resolved": true,
        "details": {
          "function_name": "refresh_adv",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/advertising.c",
          "lines": "762-830",
          "snippet": "static int refresh_adv(struct btd_adv_client *client, mgmt_request_func_t func)\n{\n\tstruct mgmt_cp_add_advertising *cp;\n\tuint8_t param_len;\n\tuint8_t *adv_data;\n\tsize_t adv_data_len;\n\tuint8_t *scan_rsp;\n\tsize_t scan_rsp_len = -1;\n\tuint32_t flags = 0;\n\n\tDBG(\"Refreshing advertisement: %s\", client->path);\n\n\tif (client->type == AD_TYPE_PERIPHERAL) {\n\t\tflags = MGMT_ADV_FLAG_CONNECTABLE;\n\n\t\tif (btd_adapter_get_discoverable(client->manager->adapter) &&\n\t\t\t\t!(bt_ad_has_flags(client->data)))\n\t\t\tflags |= MGMT_ADV_FLAG_DISCOV;\n\t}\n\n\tflags |= client->flags;\n\n\tadv_data = generate_adv_data(client, &flags, &adv_data_len);\n\tif (!adv_data || (adv_data_len > calc_max_adv_len(client, flags))) {\n\t\terror(\"Advertising data too long or couldn't be generated.\");\n\t\treturn -EINVAL;\n\t}\n\n\tscan_rsp = generate_scan_rsp(client, &flags, &scan_rsp_len);\n\tif (!scan_rsp && scan_rsp_len) {\n\t\terror(\"Scan data couldn't be generated.\");\n\t\tfree(adv_data);\n\t\treturn -EINVAL;\n\t}\n\n\tparam_len = sizeof(struct mgmt_cp_add_advertising) + adv_data_len +\n\t\t\t\t\t\t\tscan_rsp_len;\n\n\tcp = malloc0(param_len);\n\tif (!cp) {\n\t\terror(\"Couldn't allocate for MGMT!\");\n\t\tfree(adv_data);\n\t\tfree(scan_rsp);\n\t\treturn -ENOMEM;\n\t}\n\n\tcp->flags = htobl(flags);\n\tcp->instance = client->instance;\n\tcp->duration = client->duration;\n\tcp->adv_data_len = adv_data_len;\n\tcp->scan_rsp_len = scan_rsp_len;\n\tmemcpy(cp->data, adv_data, adv_data_len);\n\tmemcpy(cp->data + adv_data_len, scan_rsp, scan_rsp_len);\n\n\tfree(adv_data);\n\tfree(scan_rsp);\n\n\tif (!mgmt_send(client->manager->mgmt, MGMT_OP_ADD_ADVERTISING,\n\t\t\t\tclient->manager->mgmt_index, param_len, cp,\n\t\t\t\tfunc, client, NULL)) {\n\t\terror(\"Failed to add Advertising Data\");\n\t\tfree(cp);\n\t\treturn -EINVAL;\n\t}\n\n\tfree(cp);\n\n\treturn 0;\n}",
          "includes": [
            "#include \"advertising.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"eir.h\"",
            "#include \"log.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"adapter.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <gdbus/gdbus.h>",
            "#include <dbus/dbus.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <stdint.h>"
          ],
          "macros_used": [
            "#define AD_TYPE_PERIPHERAL 1"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"advertising.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/mgmt.h\"\n#include \"src/shared/ad.h\"\n#include \"eir.h\"\n#include \"log.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"adapter.h\"\n#include \"lib/sdp.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <gdbus/gdbus.h>\n#include <dbus/dbus.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <stdint.h>\n\n#define AD_TYPE_PERIPHERAL 1\n\nstatic int refresh_adv(struct btd_adv_client *client, mgmt_request_func_t func)\n{\n\tstruct mgmt_cp_add_advertising *cp;\n\tuint8_t param_len;\n\tuint8_t *adv_data;\n\tsize_t adv_data_len;\n\tuint8_t *scan_rsp;\n\tsize_t scan_rsp_len = -1;\n\tuint32_t flags = 0;\n\n\tDBG(\"Refreshing advertisement: %s\", client->path);\n\n\tif (client->type == AD_TYPE_PERIPHERAL) {\n\t\tflags = MGMT_ADV_FLAG_CONNECTABLE;\n\n\t\tif (btd_adapter_get_discoverable(client->manager->adapter) &&\n\t\t\t\t!(bt_ad_has_flags(client->data)))\n\t\t\tflags |= MGMT_ADV_FLAG_DISCOV;\n\t}\n\n\tflags |= client->flags;\n\n\tadv_data = generate_adv_data(client, &flags, &adv_data_len);\n\tif (!adv_data || (adv_data_len > calc_max_adv_len(client, flags))) {\n\t\terror(\"Advertising data too long or couldn't be generated.\");\n\t\treturn -EINVAL;\n\t}\n\n\tscan_rsp = generate_scan_rsp(client, &flags, &scan_rsp_len);\n\tif (!scan_rsp && scan_rsp_len) {\n\t\terror(\"Scan data couldn't be generated.\");\n\t\tfree(adv_data);\n\t\treturn -EINVAL;\n\t}\n\n\tparam_len = sizeof(struct mgmt_cp_add_advertising) + adv_data_len +\n\t\t\t\t\t\t\tscan_rsp_len;\n\n\tcp = malloc0(param_len);\n\tif (!cp) {\n\t\terror(\"Couldn't allocate for MGMT!\");\n\t\tfree(adv_data);\n\t\tfree(scan_rsp);\n\t\treturn -ENOMEM;\n\t}\n\n\tcp->flags = htobl(flags);\n\tcp->instance = client->instance;\n\tcp->duration = client->duration;\n\tcp->adv_data_len = adv_data_len;\n\tcp->scan_rsp_len = scan_rsp_len;\n\tmemcpy(cp->data, adv_data, adv_data_len);\n\tmemcpy(cp->data + adv_data_len, scan_rsp, scan_rsp_len);\n\n\tfree(adv_data);\n\tfree(scan_rsp);\n\n\tif (!mgmt_send(client->manager->mgmt, MGMT_OP_ADD_ADVERTISING,\n\t\t\t\tclient->manager->mgmt_index, param_len, cp,\n\t\t\t\tfunc, client, NULL)) {\n\t\terror(\"Failed to add Advertising Data\");\n\t\tfree(cp);\n\t\treturn -EINVAL;\n\t}\n\n\tfree(cp);\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "parser->func",
          "args": [
            "iter",
            "client"
          ],
          "line": 902
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "parser->name",
            "name"
          ],
          "line": 899
        },
        "resolved": true,
        "details": {
          "function_name": "g_strcmp",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "1927-1930",
          "snippet": "static gint g_strcmp(gconstpointer a, gconstpointer b)\n{\n\treturn strcmp(a, b);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic gint g_strcmp(gconstpointer a, gconstpointer b)\n{\n\treturn strcmp(a, b);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"advertising.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/mgmt.h\"\n#include \"src/shared/ad.h\"\n#include \"eir.h\"\n#include \"log.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"adapter.h\"\n#include \"lib/sdp.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <gdbus/gdbus.h>\n#include <dbus/dbus.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <stdint.h>\n\nstatic struct adv_parser {\n\tconst char *name;\n\tbool (*func)(DBusMessageIter *iter, struct btd_adv_client *client);\n} parsers[] = {\n\t{ \"Type\", parse_type },\n\t{ \"ServiceUUIDs\", parse_service_uuids },\n\t{ \"SolicitUUIDs\", parse_solicit_uuids },\n\t{ \"ManufacturerData\", parse_manufacturer_data },\n\t{ \"ServiceData\", parse_service_data },\n\t{ \"Includes\", parse_includes },\n\t{ \"LocalName\", parse_local_name },\n\t{ \"Appearance\", parse_appearance },\n\t{ \"Duration\", parse_duration },\n\t{ \"Timeout\", parse_timeout },\n\t{ \"Data\", parse_data },\n\t{ \"Discoverable\", parse_discoverable },\n\t{ \"DiscoverableTimeout\", parse_discoverable_timeout },\n\t{ },\n};\n\nstatic void properties_changed(GDBusProxy *proxy, const char *name,\n\t\t\t\t\tDBusMessageIter *iter, void *user_data)\n{\n\tstruct btd_adv_client *client = user_data;\n\tstruct adv_parser *parser;\n\n\tfor (parser = parsers; parser && parser->name; parser++) {\n\t\tif (strcmp(parser->name, name))\n\t\t\tcontinue;\n\n\t\tif (parser->func(iter, client)) {\n\t\t\trefresh_adv(client, NULL);\n\t\t\tbreak;\n\t\t}\n\t}\n}"
  },
  {
    "function_name": "parse_discoverable_timeout",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/advertising.c",
    "lines": "847-870",
    "snippet": "static bool parse_discoverable_timeout(DBusMessageIter *iter,\n\t\t\t\t\tstruct btd_adv_client *client)\n{\n\tif (!iter) {\n\t\tclient->discoverable_to = 0;\n\t\tg_source_remove(client->disc_to_id);\n\t\tclient->disc_to_id = 0;\n\t\treturn true;\n\t}\n\n\tif (dbus_message_iter_get_arg_type(iter) != DBUS_TYPE_UINT16)\n\t\treturn false;\n\n\tdbus_message_iter_get_basic(iter, &client->discoverable_to);\n\n\tif (client->disc_to_id)\n\t\tg_source_remove(client->disc_to_id);\n\n\tclient->disc_to_id = g_timeout_add_seconds(client->discoverable_to,\n\t\t\t\t\t\tclient_discoverable_timeout,\n\t\t\t\t\t\tclient);\n\n\treturn true;\n}",
    "includes": [
      "#include \"advertising.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/mgmt.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"eir.h\"",
      "#include \"log.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"adapter.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <gdbus/gdbus.h>",
      "#include <dbus/dbus.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <stdint.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_timeout_add_seconds",
          "args": [
            "client->discoverable_to",
            "client_discoverable_timeout",
            "client"
          ],
          "line": 865
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_source_remove",
          "args": [
            "client->disc_to_id"
          ],
          "line": 863
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_get_basic",
          "args": [
            "iter",
            "&client->discoverable_to"
          ],
          "line": 860
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_get_arg_type",
          "args": [
            "iter"
          ],
          "line": 857
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_source_remove",
          "args": [
            "client->disc_to_id"
          ],
          "line": 852
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"advertising.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/mgmt.h\"\n#include \"src/shared/ad.h\"\n#include \"eir.h\"\n#include \"log.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"adapter.h\"\n#include \"lib/sdp.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <gdbus/gdbus.h>\n#include <dbus/dbus.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <stdint.h>\n\nstatic bool parse_discoverable_timeout(DBusMessageIter *iter,\n\t\t\t\t\tstruct btd_adv_client *client)\n{\n\tif (!iter) {\n\t\tclient->discoverable_to = 0;\n\t\tg_source_remove(client->disc_to_id);\n\t\tclient->disc_to_id = 0;\n\t\treturn true;\n\t}\n\n\tif (dbus_message_iter_get_arg_type(iter) != DBUS_TYPE_UINT16)\n\t\treturn false;\n\n\tdbus_message_iter_get_basic(iter, &client->discoverable_to);\n\n\tif (client->disc_to_id)\n\t\tg_source_remove(client->disc_to_id);\n\n\tclient->disc_to_id = g_timeout_add_seconds(client->discoverable_to,\n\t\t\t\t\t\tclient_discoverable_timeout,\n\t\t\t\t\t\tclient);\n\n\treturn true;\n}"
  },
  {
    "function_name": "client_discoverable_timeout",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/advertising.c",
    "lines": "832-845",
    "snippet": "static gboolean client_discoverable_timeout(void *user_data)\n{\n\tstruct btd_adv_client *client = user_data;\n\n\tDBG(\"\");\n\n\tclient->disc_to_id = 0;\n\n\tbt_ad_clear_flags(client->data);\n\n\trefresh_adv(client, NULL);\n\n\treturn FALSE;\n}",
    "includes": [
      "#include \"advertising.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/mgmt.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"eir.h\"",
      "#include \"log.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"adapter.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <gdbus/gdbus.h>",
      "#include <dbus/dbus.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <stdint.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "refresh_adv",
          "args": [
            "client",
            "NULL"
          ],
          "line": 842
        },
        "resolved": true,
        "details": {
          "function_name": "refresh_adv",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/advertising.c",
          "lines": "762-830",
          "snippet": "static int refresh_adv(struct btd_adv_client *client, mgmt_request_func_t func)\n{\n\tstruct mgmt_cp_add_advertising *cp;\n\tuint8_t param_len;\n\tuint8_t *adv_data;\n\tsize_t adv_data_len;\n\tuint8_t *scan_rsp;\n\tsize_t scan_rsp_len = -1;\n\tuint32_t flags = 0;\n\n\tDBG(\"Refreshing advertisement: %s\", client->path);\n\n\tif (client->type == AD_TYPE_PERIPHERAL) {\n\t\tflags = MGMT_ADV_FLAG_CONNECTABLE;\n\n\t\tif (btd_adapter_get_discoverable(client->manager->adapter) &&\n\t\t\t\t!(bt_ad_has_flags(client->data)))\n\t\t\tflags |= MGMT_ADV_FLAG_DISCOV;\n\t}\n\n\tflags |= client->flags;\n\n\tadv_data = generate_adv_data(client, &flags, &adv_data_len);\n\tif (!adv_data || (adv_data_len > calc_max_adv_len(client, flags))) {\n\t\terror(\"Advertising data too long or couldn't be generated.\");\n\t\treturn -EINVAL;\n\t}\n\n\tscan_rsp = generate_scan_rsp(client, &flags, &scan_rsp_len);\n\tif (!scan_rsp && scan_rsp_len) {\n\t\terror(\"Scan data couldn't be generated.\");\n\t\tfree(adv_data);\n\t\treturn -EINVAL;\n\t}\n\n\tparam_len = sizeof(struct mgmt_cp_add_advertising) + adv_data_len +\n\t\t\t\t\t\t\tscan_rsp_len;\n\n\tcp = malloc0(param_len);\n\tif (!cp) {\n\t\terror(\"Couldn't allocate for MGMT!\");\n\t\tfree(adv_data);\n\t\tfree(scan_rsp);\n\t\treturn -ENOMEM;\n\t}\n\n\tcp->flags = htobl(flags);\n\tcp->instance = client->instance;\n\tcp->duration = client->duration;\n\tcp->adv_data_len = adv_data_len;\n\tcp->scan_rsp_len = scan_rsp_len;\n\tmemcpy(cp->data, adv_data, adv_data_len);\n\tmemcpy(cp->data + adv_data_len, scan_rsp, scan_rsp_len);\n\n\tfree(adv_data);\n\tfree(scan_rsp);\n\n\tif (!mgmt_send(client->manager->mgmt, MGMT_OP_ADD_ADVERTISING,\n\t\t\t\tclient->manager->mgmt_index, param_len, cp,\n\t\t\t\tfunc, client, NULL)) {\n\t\terror(\"Failed to add Advertising Data\");\n\t\tfree(cp);\n\t\treturn -EINVAL;\n\t}\n\n\tfree(cp);\n\n\treturn 0;\n}",
          "includes": [
            "#include \"advertising.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"eir.h\"",
            "#include \"log.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"adapter.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <gdbus/gdbus.h>",
            "#include <dbus/dbus.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <stdint.h>"
          ],
          "macros_used": [
            "#define AD_TYPE_PERIPHERAL 1"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"advertising.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/mgmt.h\"\n#include \"src/shared/ad.h\"\n#include \"eir.h\"\n#include \"log.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"adapter.h\"\n#include \"lib/sdp.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <gdbus/gdbus.h>\n#include <dbus/dbus.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <stdint.h>\n\n#define AD_TYPE_PERIPHERAL 1\n\nstatic int refresh_adv(struct btd_adv_client *client, mgmt_request_func_t func)\n{\n\tstruct mgmt_cp_add_advertising *cp;\n\tuint8_t param_len;\n\tuint8_t *adv_data;\n\tsize_t adv_data_len;\n\tuint8_t *scan_rsp;\n\tsize_t scan_rsp_len = -1;\n\tuint32_t flags = 0;\n\n\tDBG(\"Refreshing advertisement: %s\", client->path);\n\n\tif (client->type == AD_TYPE_PERIPHERAL) {\n\t\tflags = MGMT_ADV_FLAG_CONNECTABLE;\n\n\t\tif (btd_adapter_get_discoverable(client->manager->adapter) &&\n\t\t\t\t!(bt_ad_has_flags(client->data)))\n\t\t\tflags |= MGMT_ADV_FLAG_DISCOV;\n\t}\n\n\tflags |= client->flags;\n\n\tadv_data = generate_adv_data(client, &flags, &adv_data_len);\n\tif (!adv_data || (adv_data_len > calc_max_adv_len(client, flags))) {\n\t\terror(\"Advertising data too long or couldn't be generated.\");\n\t\treturn -EINVAL;\n\t}\n\n\tscan_rsp = generate_scan_rsp(client, &flags, &scan_rsp_len);\n\tif (!scan_rsp && scan_rsp_len) {\n\t\terror(\"Scan data couldn't be generated.\");\n\t\tfree(adv_data);\n\t\treturn -EINVAL;\n\t}\n\n\tparam_len = sizeof(struct mgmt_cp_add_advertising) + adv_data_len +\n\t\t\t\t\t\t\tscan_rsp_len;\n\n\tcp = malloc0(param_len);\n\tif (!cp) {\n\t\terror(\"Couldn't allocate for MGMT!\");\n\t\tfree(adv_data);\n\t\tfree(scan_rsp);\n\t\treturn -ENOMEM;\n\t}\n\n\tcp->flags = htobl(flags);\n\tcp->instance = client->instance;\n\tcp->duration = client->duration;\n\tcp->adv_data_len = adv_data_len;\n\tcp->scan_rsp_len = scan_rsp_len;\n\tmemcpy(cp->data, adv_data, adv_data_len);\n\tmemcpy(cp->data + adv_data_len, scan_rsp, scan_rsp_len);\n\n\tfree(adv_data);\n\tfree(scan_rsp);\n\n\tif (!mgmt_send(client->manager->mgmt, MGMT_OP_ADD_ADVERTISING,\n\t\t\t\tclient->manager->mgmt_index, param_len, cp,\n\t\t\t\tfunc, client, NULL)) {\n\t\terror(\"Failed to add Advertising Data\");\n\t\tfree(cp);\n\t\treturn -EINVAL;\n\t}\n\n\tfree(cp);\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "bt_ad_clear_flags",
          "args": [
            "client->data"
          ],
          "line": 840
        },
        "resolved": true,
        "details": {
          "function_name": "bt_ad_clear_flags",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
          "lines": "880-887",
          "snippet": "void bt_ad_clear_flags(struct bt_ad *ad)\n{\n\tif (!ad)\n\t\treturn;\n\n\tqueue_remove_all(ad->data, data_type_match, UINT_TO_PTR(BT_AD_FLAGS),\n\t\t\t\t\t\t\tdata_destroy);\n}",
          "includes": [
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/eir.h\"",
            "#include \"src/shared/ad.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nvoid bt_ad_clear_flags(struct bt_ad *ad)\n{\n\tif (!ad)\n\t\treturn;\n\n\tqueue_remove_all(ad->data, data_type_match, UINT_TO_PTR(BT_AD_FLAGS),\n\t\t\t\t\t\t\tdata_destroy);\n}"
        }
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"\""
          ],
          "line": 836
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"advertising.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/mgmt.h\"\n#include \"src/shared/ad.h\"\n#include \"eir.h\"\n#include \"log.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"adapter.h\"\n#include \"lib/sdp.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <gdbus/gdbus.h>\n#include <dbus/dbus.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <stdint.h>\n\nstatic gboolean client_discoverable_timeout(void *user_data)\n{\n\tstruct btd_adv_client *client = user_data;\n\n\tDBG(\"\");\n\n\tclient->disc_to_id = 0;\n\n\tbt_ad_clear_flags(client->data);\n\n\trefresh_adv(client, NULL);\n\n\treturn FALSE;\n}"
  },
  {
    "function_name": "refresh_adv",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/advertising.c",
    "lines": "762-830",
    "snippet": "static int refresh_adv(struct btd_adv_client *client, mgmt_request_func_t func)\n{\n\tstruct mgmt_cp_add_advertising *cp;\n\tuint8_t param_len;\n\tuint8_t *adv_data;\n\tsize_t adv_data_len;\n\tuint8_t *scan_rsp;\n\tsize_t scan_rsp_len = -1;\n\tuint32_t flags = 0;\n\n\tDBG(\"Refreshing advertisement: %s\", client->path);\n\n\tif (client->type == AD_TYPE_PERIPHERAL) {\n\t\tflags = MGMT_ADV_FLAG_CONNECTABLE;\n\n\t\tif (btd_adapter_get_discoverable(client->manager->adapter) &&\n\t\t\t\t!(bt_ad_has_flags(client->data)))\n\t\t\tflags |= MGMT_ADV_FLAG_DISCOV;\n\t}\n\n\tflags |= client->flags;\n\n\tadv_data = generate_adv_data(client, &flags, &adv_data_len);\n\tif (!adv_data || (adv_data_len > calc_max_adv_len(client, flags))) {\n\t\terror(\"Advertising data too long or couldn't be generated.\");\n\t\treturn -EINVAL;\n\t}\n\n\tscan_rsp = generate_scan_rsp(client, &flags, &scan_rsp_len);\n\tif (!scan_rsp && scan_rsp_len) {\n\t\terror(\"Scan data couldn't be generated.\");\n\t\tfree(adv_data);\n\t\treturn -EINVAL;\n\t}\n\n\tparam_len = sizeof(struct mgmt_cp_add_advertising) + adv_data_len +\n\t\t\t\t\t\t\tscan_rsp_len;\n\n\tcp = malloc0(param_len);\n\tif (!cp) {\n\t\terror(\"Couldn't allocate for MGMT!\");\n\t\tfree(adv_data);\n\t\tfree(scan_rsp);\n\t\treturn -ENOMEM;\n\t}\n\n\tcp->flags = htobl(flags);\n\tcp->instance = client->instance;\n\tcp->duration = client->duration;\n\tcp->adv_data_len = adv_data_len;\n\tcp->scan_rsp_len = scan_rsp_len;\n\tmemcpy(cp->data, adv_data, adv_data_len);\n\tmemcpy(cp->data + adv_data_len, scan_rsp, scan_rsp_len);\n\n\tfree(adv_data);\n\tfree(scan_rsp);\n\n\tif (!mgmt_send(client->manager->mgmt, MGMT_OP_ADD_ADVERTISING,\n\t\t\t\tclient->manager->mgmt_index, param_len, cp,\n\t\t\t\tfunc, client, NULL)) {\n\t\terror(\"Failed to add Advertising Data\");\n\t\tfree(cp);\n\t\treturn -EINVAL;\n\t}\n\n\tfree(cp);\n\n\treturn 0;\n}",
    "includes": [
      "#include \"advertising.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/mgmt.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"eir.h\"",
      "#include \"log.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"adapter.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <gdbus/gdbus.h>",
      "#include <dbus/dbus.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <stdint.h>"
    ],
    "macros_used": [
      "#define AD_TYPE_PERIPHERAL 1"
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "cp"
          ],
          "line": 827
        },
        "resolved": true,
        "details": {
          "function_name": "client_free_idle_cb",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/advertising.c",
          "lines": "134-139",
          "snippet": "static gboolean client_free_idle_cb(void *data)\n{\n\tclient_free(data);\n\n\treturn FALSE;\n}",
          "includes": [
            "#include \"advertising.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"eir.h\"",
            "#include \"log.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"adapter.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <gdbus/gdbus.h>",
            "#include <dbus/dbus.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <stdint.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"advertising.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/mgmt.h\"\n#include \"src/shared/ad.h\"\n#include \"eir.h\"\n#include \"log.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"adapter.h\"\n#include \"lib/sdp.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <gdbus/gdbus.h>\n#include <dbus/dbus.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <stdint.h>\n\nstatic gboolean client_free_idle_cb(void *data)\n{\n\tclient_free(data);\n\n\treturn FALSE;\n}"
        }
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"Failed to add Advertising Data\""
          ],
          "line": 822
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_not_ready",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "118-122",
          "snippet": "DBusMessage *btd_error_not_ready(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".NotReady\",\n\t\t\t\t\t\"Resource Not Ready\");\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_not_ready(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".NotReady\",\n\t\t\t\t\t\"Resource Not Ready\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "mgmt_send",
          "args": [
            "client->manager->mgmt",
            "MGMT_OP_ADD_ADVERTISING",
            "client->manager->mgmt_index",
            "param_len",
            "cp",
            "func",
            "client",
            "NULL"
          ],
          "line": 819
        },
        "resolved": true,
        "details": {
          "function_name": "mgmt_send_nowait",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/mgmt.c",
          "lines": "605-629",
          "snippet": "unsigned int mgmt_send_nowait(struct mgmt *mgmt, uint16_t opcode, uint16_t index,\n\t\t\t\tuint16_t length, const void *param,\n\t\t\t\tmgmt_request_func_t callback,\n\t\t\t\tvoid *user_data, mgmt_destroy_func_t destroy)\n{\n\tstruct mgmt_request *request;\n\n\tif (!mgmt)\n\t\treturn 0;\n\n\trequest = create_request(opcode, index, length, param,\n\t\t\t\t\tcallback, user_data, destroy);\n\tif (!request)\n\t\treturn 0;\n\n\tif (mgmt->next_request_id < 1)\n\t\tmgmt->next_request_id = 1;\n\n\trequest->id = mgmt->next_request_id++;\n\n\tif (!send_request(mgmt, request))\n\t\treturn 0;\n\n\treturn request->id;\n}",
          "includes": [
            "#include \"src/shared/mgmt.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"lib/hci.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/mgmt.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"lib/hci.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nunsigned int mgmt_send_nowait(struct mgmt *mgmt, uint16_t opcode, uint16_t index,\n\t\t\t\tuint16_t length, const void *param,\n\t\t\t\tmgmt_request_func_t callback,\n\t\t\t\tvoid *user_data, mgmt_destroy_func_t destroy)\n{\n\tstruct mgmt_request *request;\n\n\tif (!mgmt)\n\t\treturn 0;\n\n\trequest = create_request(opcode, index, length, param,\n\t\t\t\t\tcallback, user_data, destroy);\n\tif (!request)\n\t\treturn 0;\n\n\tif (mgmt->next_request_id < 1)\n\t\tmgmt->next_request_id = 1;\n\n\trequest->id = mgmt->next_request_id++;\n\n\tif (!send_request(mgmt, request))\n\t\treturn 0;\n\n\treturn request->id;\n}"
        }
      },
      {
        "call_info": {
          "callee": "memcpy",
          "args": [
            "cp->data + adv_data_len",
            "scan_rsp",
            "scan_rsp_len"
          ],
          "line": 814
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memcpy",
          "args": [
            "cp->data",
            "adv_data",
            "adv_data_len"
          ],
          "line": 813
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "htobl",
          "args": [
            "flags"
          ],
          "line": 808
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "malloc0",
          "args": [
            "param_len"
          ],
          "line": 800
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "generate_scan_rsp",
          "args": [
            "client",
            "&flags",
            "&scan_rsp_len"
          ],
          "line": 790
        },
        "resolved": true,
        "details": {
          "function_name": "generate_scan_rsp",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/advertising.c",
          "lines": "740-760",
          "snippet": "static uint8_t *generate_scan_rsp(struct btd_adv_client *client,\n\t\t\t\t\t\tuint32_t *flags, size_t *len)\n{\n\tstruct btd_adv_manager *manager = client->manager;\n\tconst char *name;\n\n\tif (!(*flags & MGMT_ADV_FLAG_LOCAL_NAME) && !client->name) {\n\t\t*len = 0;\n\t\treturn NULL;\n\t}\n\n\t*flags &= ~MGMT_ADV_FLAG_LOCAL_NAME;\n\n\tname = client->name;\n\tif (!name)\n\t\tname = btd_adapter_get_name(manager->adapter);\n\n\tbt_ad_add_name(client->scan, name);\n\n\treturn bt_ad_generate(client->scan, len);\n}",
          "includes": [
            "#include \"advertising.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"eir.h\"",
            "#include \"log.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"adapter.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <gdbus/gdbus.h>",
            "#include <dbus/dbus.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <stdint.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"advertising.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/mgmt.h\"\n#include \"src/shared/ad.h\"\n#include \"eir.h\"\n#include \"log.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"adapter.h\"\n#include \"lib/sdp.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <gdbus/gdbus.h>\n#include <dbus/dbus.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <stdint.h>\n\nstatic uint8_t *generate_scan_rsp(struct btd_adv_client *client,\n\t\t\t\t\t\tuint32_t *flags, size_t *len)\n{\n\tstruct btd_adv_manager *manager = client->manager;\n\tconst char *name;\n\n\tif (!(*flags & MGMT_ADV_FLAG_LOCAL_NAME) && !client->name) {\n\t\t*len = 0;\n\t\treturn NULL;\n\t}\n\n\t*flags &= ~MGMT_ADV_FLAG_LOCAL_NAME;\n\n\tname = client->name;\n\tif (!name)\n\t\tname = btd_adapter_get_name(manager->adapter);\n\n\tbt_ad_add_name(client->scan, name);\n\n\treturn bt_ad_generate(client->scan, len);\n}"
        }
      },
      {
        "call_info": {
          "callee": "calc_max_adv_len",
          "args": [
            "client",
            "flags"
          ],
          "line": 785
        },
        "resolved": true,
        "details": {
          "function_name": "calc_max_adv_len",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/advertising.c",
          "lines": "699-718",
          "snippet": "static size_t calc_max_adv_len(struct btd_adv_client *client, uint32_t flags)\n{\n\tsize_t max = client->manager->max_adv_len;\n\n\t/*\n\t * Flags which reduce the amount of space available for advertising.\n\t * See doc/mgmt-api.txt\n\t */\n\tif (flags & MGMT_ADV_FLAG_TX_POWER)\n\t\tmax -= 3;\n\n\tif (flags & (MGMT_ADV_FLAG_DISCOV | MGMT_ADV_FLAG_LIMITED_DISCOV |\n\t\t\t\t\t\tMGMT_ADV_FLAG_MANAGED_FLAGS))\n\t\tmax -= 3;\n\n\tif (flags & MGMT_ADV_FLAG_APPEARANCE)\n\t\tmax -= 4;\n\n\treturn max;\n}",
          "includes": [
            "#include \"advertising.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"eir.h\"",
            "#include \"log.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"adapter.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <gdbus/gdbus.h>",
            "#include <dbus/dbus.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <stdint.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"advertising.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/mgmt.h\"\n#include \"src/shared/ad.h\"\n#include \"eir.h\"\n#include \"log.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"adapter.h\"\n#include \"lib/sdp.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <gdbus/gdbus.h>\n#include <dbus/dbus.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <stdint.h>\n\nstatic size_t calc_max_adv_len(struct btd_adv_client *client, uint32_t flags)\n{\n\tsize_t max = client->manager->max_adv_len;\n\n\t/*\n\t * Flags which reduce the amount of space available for advertising.\n\t * See doc/mgmt-api.txt\n\t */\n\tif (flags & MGMT_ADV_FLAG_TX_POWER)\n\t\tmax -= 3;\n\n\tif (flags & (MGMT_ADV_FLAG_DISCOV | MGMT_ADV_FLAG_LIMITED_DISCOV |\n\t\t\t\t\t\tMGMT_ADV_FLAG_MANAGED_FLAGS))\n\t\tmax -= 3;\n\n\tif (flags & MGMT_ADV_FLAG_APPEARANCE)\n\t\tmax -= 4;\n\n\treturn max;\n}"
        }
      },
      {
        "call_info": {
          "callee": "generate_adv_data",
          "args": [
            "client",
            "&flags",
            "&adv_data_len"
          ],
          "line": 784
        },
        "resolved": true,
        "details": {
          "function_name": "generate_adv_data",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/advertising.c",
          "lines": "720-738",
          "snippet": "static uint8_t *generate_adv_data(struct btd_adv_client *client,\n\t\t\t\t\t\tuint32_t *flags, size_t *len)\n{\n\tif ((*flags & MGMT_ADV_FLAG_APPEARANCE) ||\n\t\t\t\t\tclient->appearance != UINT16_MAX) {\n\t\tuint16_t appearance;\n\n\t\tappearance = client->appearance;\n\t\tif (appearance == UINT16_MAX)\n\t\t\t/* TODO: Get the appearance from the adaptor once\n\t\t\t * supported.\n\t\t\t */\n\t\t\tappearance = 0x000;\n\n\t\tbt_ad_add_appearance(client->data, appearance);\n\t}\n\n\treturn bt_ad_generate(client->data, len);\n}",
          "includes": [
            "#include \"advertising.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"eir.h\"",
            "#include \"log.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"adapter.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <gdbus/gdbus.h>",
            "#include <dbus/dbus.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <stdint.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"advertising.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/mgmt.h\"\n#include \"src/shared/ad.h\"\n#include \"eir.h\"\n#include \"log.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"adapter.h\"\n#include \"lib/sdp.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <gdbus/gdbus.h>\n#include <dbus/dbus.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <stdint.h>\n\nstatic uint8_t *generate_adv_data(struct btd_adv_client *client,\n\t\t\t\t\t\tuint32_t *flags, size_t *len)\n{\n\tif ((*flags & MGMT_ADV_FLAG_APPEARANCE) ||\n\t\t\t\t\tclient->appearance != UINT16_MAX) {\n\t\tuint16_t appearance;\n\n\t\tappearance = client->appearance;\n\t\tif (appearance == UINT16_MAX)\n\t\t\t/* TODO: Get the appearance from the adaptor once\n\t\t\t * supported.\n\t\t\t */\n\t\t\tappearance = 0x000;\n\n\t\tbt_ad_add_appearance(client->data, appearance);\n\t}\n\n\treturn bt_ad_generate(client->data, len);\n}"
        }
      },
      {
        "call_info": {
          "callee": "bt_ad_has_flags",
          "args": [
            "client->data"
          ],
          "line": 778
        },
        "resolved": true,
        "details": {
          "function_name": "bt_ad_has_flags",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
          "lines": "866-878",
          "snippet": "bool bt_ad_has_flags(struct bt_ad *ad)\n{\n\tstruct bt_ad_data *data;\n\n\tif (!ad)\n\t\treturn false;\n\n\tdata = queue_find(ad->data, data_type_match, UINT_TO_PTR(BT_AD_FLAGS));\n\tif (!data)\n\t\treturn false;\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/eir.h\"",
            "#include \"src/shared/ad.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nbool bt_ad_has_flags(struct bt_ad *ad)\n{\n\tstruct bt_ad_data *data;\n\n\tif (!ad)\n\t\treturn false;\n\n\tdata = queue_find(ad->data, data_type_match, UINT_TO_PTR(BT_AD_FLAGS));\n\tif (!data)\n\t\treturn false;\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_adapter_get_discoverable",
          "args": [
            "client->manager->adapter"
          ],
          "line": 777
        },
        "resolved": true,
        "details": {
          "function_name": "btd_adapter_get_discoverable",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "4430-4436",
          "snippet": "bool btd_adapter_get_discoverable(struct btd_adapter *adapter)\n{\n\tif (adapter->current_settings & MGMT_SETTING_DISCOVERABLE)\n\t\treturn true;\n\n\treturn false;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void trigger_pairable_timeout(struct btd_adapter *adapter);",
            "static void adapter_start(struct btd_adapter *adapter);",
            "static void adapter_stop(struct btd_adapter *adapter);",
            "static void trigger_passive_scanning(struct btd_adapter *adapter);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void trigger_pairable_timeout(struct btd_adapter *adapter);\nstatic void adapter_start(struct btd_adapter *adapter);\nstatic void adapter_stop(struct btd_adapter *adapter);\nstatic void trigger_passive_scanning(struct btd_adapter *adapter);\n\nbool btd_adapter_get_discoverable(struct btd_adapter *adapter)\n{\n\tif (adapter->current_settings & MGMT_SETTING_DISCOVERABLE)\n\t\treturn true;\n\n\treturn false;\n}"
        }
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"Refreshing advertisement: %s\"",
            "client->path"
          ],
          "line": 772
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"advertising.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/mgmt.h\"\n#include \"src/shared/ad.h\"\n#include \"eir.h\"\n#include \"log.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"adapter.h\"\n#include \"lib/sdp.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <gdbus/gdbus.h>\n#include <dbus/dbus.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <stdint.h>\n\n#define AD_TYPE_PERIPHERAL 1\n\nstatic int refresh_adv(struct btd_adv_client *client, mgmt_request_func_t func)\n{\n\tstruct mgmt_cp_add_advertising *cp;\n\tuint8_t param_len;\n\tuint8_t *adv_data;\n\tsize_t adv_data_len;\n\tuint8_t *scan_rsp;\n\tsize_t scan_rsp_len = -1;\n\tuint32_t flags = 0;\n\n\tDBG(\"Refreshing advertisement: %s\", client->path);\n\n\tif (client->type == AD_TYPE_PERIPHERAL) {\n\t\tflags = MGMT_ADV_FLAG_CONNECTABLE;\n\n\t\tif (btd_adapter_get_discoverable(client->manager->adapter) &&\n\t\t\t\t!(bt_ad_has_flags(client->data)))\n\t\t\tflags |= MGMT_ADV_FLAG_DISCOV;\n\t}\n\n\tflags |= client->flags;\n\n\tadv_data = generate_adv_data(client, &flags, &adv_data_len);\n\tif (!adv_data || (adv_data_len > calc_max_adv_len(client, flags))) {\n\t\terror(\"Advertising data too long or couldn't be generated.\");\n\t\treturn -EINVAL;\n\t}\n\n\tscan_rsp = generate_scan_rsp(client, &flags, &scan_rsp_len);\n\tif (!scan_rsp && scan_rsp_len) {\n\t\terror(\"Scan data couldn't be generated.\");\n\t\tfree(adv_data);\n\t\treturn -EINVAL;\n\t}\n\n\tparam_len = sizeof(struct mgmt_cp_add_advertising) + adv_data_len +\n\t\t\t\t\t\t\tscan_rsp_len;\n\n\tcp = malloc0(param_len);\n\tif (!cp) {\n\t\terror(\"Couldn't allocate for MGMT!\");\n\t\tfree(adv_data);\n\t\tfree(scan_rsp);\n\t\treturn -ENOMEM;\n\t}\n\n\tcp->flags = htobl(flags);\n\tcp->instance = client->instance;\n\tcp->duration = client->duration;\n\tcp->adv_data_len = adv_data_len;\n\tcp->scan_rsp_len = scan_rsp_len;\n\tmemcpy(cp->data, adv_data, adv_data_len);\n\tmemcpy(cp->data + adv_data_len, scan_rsp, scan_rsp_len);\n\n\tfree(adv_data);\n\tfree(scan_rsp);\n\n\tif (!mgmt_send(client->manager->mgmt, MGMT_OP_ADD_ADVERTISING,\n\t\t\t\tclient->manager->mgmt_index, param_len, cp,\n\t\t\t\tfunc, client, NULL)) {\n\t\terror(\"Failed to add Advertising Data\");\n\t\tfree(cp);\n\t\treturn -EINVAL;\n\t}\n\n\tfree(cp);\n\n\treturn 0;\n}"
  },
  {
    "function_name": "generate_scan_rsp",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/advertising.c",
    "lines": "740-760",
    "snippet": "static uint8_t *generate_scan_rsp(struct btd_adv_client *client,\n\t\t\t\t\t\tuint32_t *flags, size_t *len)\n{\n\tstruct btd_adv_manager *manager = client->manager;\n\tconst char *name;\n\n\tif (!(*flags & MGMT_ADV_FLAG_LOCAL_NAME) && !client->name) {\n\t\t*len = 0;\n\t\treturn NULL;\n\t}\n\n\t*flags &= ~MGMT_ADV_FLAG_LOCAL_NAME;\n\n\tname = client->name;\n\tif (!name)\n\t\tname = btd_adapter_get_name(manager->adapter);\n\n\tbt_ad_add_name(client->scan, name);\n\n\treturn bt_ad_generate(client->scan, len);\n}",
    "includes": [
      "#include \"advertising.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/mgmt.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"eir.h\"",
      "#include \"log.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"adapter.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <gdbus/gdbus.h>",
      "#include <dbus/dbus.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <stdint.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "bt_ad_generate",
          "args": [
            "client->scan",
            "len"
          ],
          "line": 759
        },
        "resolved": true,
        "details": {
          "function_name": "bt_ad_generate",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
          "lines": "465-497",
          "snippet": "uint8_t *bt_ad_generate(struct bt_ad *ad, size_t *length)\n{\n\tuint8_t *adv_data;\n\tuint8_t pos = 0;\n\n\tif (!ad)\n\t\treturn NULL;\n\n\t*length = calculate_length(ad);\n\n\tif (*length > MAX_ADV_DATA_LEN)\n\t\treturn NULL;\n\n\tadv_data = malloc0(*length);\n\tif (!adv_data)\n\t\treturn NULL;\n\n\tserialize_service_uuids(ad->service_uuids, adv_data, &pos);\n\n\tserialize_solicit_uuids(ad->solicit_uuids, adv_data, &pos);\n\n\tserialize_manuf_data(ad->manufacturer_data, adv_data, &pos);\n\n\tserialize_service_data(ad->service_data, adv_data, &pos);\n\n\tserialize_name(ad->name, adv_data, &pos);\n\n\tserialize_appearance(ad->appearance, adv_data, &pos);\n\n\tserialize_data(ad->data, adv_data, &pos);\n\n\treturn adv_data;\n}",
          "includes": [
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/eir.h\"",
            "#include \"src/shared/ad.h\""
          ],
          "macros_used": [
            "#define MAX_ADV_DATA_LEN 31"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\n#define MAX_ADV_DATA_LEN 31\n\nuint8_t *bt_ad_generate(struct bt_ad *ad, size_t *length)\n{\n\tuint8_t *adv_data;\n\tuint8_t pos = 0;\n\n\tif (!ad)\n\t\treturn NULL;\n\n\t*length = calculate_length(ad);\n\n\tif (*length > MAX_ADV_DATA_LEN)\n\t\treturn NULL;\n\n\tadv_data = malloc0(*length);\n\tif (!adv_data)\n\t\treturn NULL;\n\n\tserialize_service_uuids(ad->service_uuids, adv_data, &pos);\n\n\tserialize_solicit_uuids(ad->solicit_uuids, adv_data, &pos);\n\n\tserialize_manuf_data(ad->manufacturer_data, adv_data, &pos);\n\n\tserialize_service_data(ad->service_data, adv_data, &pos);\n\n\tserialize_name(ad->name, adv_data, &pos);\n\n\tserialize_appearance(ad->appearance, adv_data, &pos);\n\n\tserialize_data(ad->data, adv_data, &pos);\n\n\treturn adv_data;\n}"
        }
      },
      {
        "call_info": {
          "callee": "bt_ad_add_name",
          "args": [
            "client->scan",
            "name"
          ],
          "line": 757
        },
        "resolved": true,
        "details": {
          "function_name": "bt_ad_add_name",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
          "lines": "815-825",
          "snippet": "bool bt_ad_add_name(struct bt_ad *ad, const char *name)\n{\n\tif (!ad)\n\t\treturn false;\n\n\tfree(ad->name);\n\n\tad->name = strdup(name);\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/eir.h\"",
            "#include \"src/shared/ad.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nbool bt_ad_add_name(struct bt_ad *ad, const char *name)\n{\n\tif (!ad)\n\t\treturn false;\n\n\tfree(ad->name);\n\n\tad->name = strdup(name);\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_adapter_get_name",
          "args": [
            "manager->adapter"
          ],
          "line": 755
        },
        "resolved": true,
        "details": {
          "function_name": "btd_adapter_get_name",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "4459-4468",
          "snippet": "const char *btd_adapter_get_name(struct btd_adapter *adapter)\n{\n\tif (adapter->stored_alias)\n\t\treturn adapter->stored_alias;\n\n\tif (adapter->system_name)\n\t\treturn adapter->system_name;\n\n\treturn NULL;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void trigger_pairable_timeout(struct btd_adapter *adapter);",
            "static void adapter_start(struct btd_adapter *adapter);",
            "static void adapter_stop(struct btd_adapter *adapter);",
            "static void trigger_passive_scanning(struct btd_adapter *adapter);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void trigger_pairable_timeout(struct btd_adapter *adapter);\nstatic void adapter_start(struct btd_adapter *adapter);\nstatic void adapter_stop(struct btd_adapter *adapter);\nstatic void trigger_passive_scanning(struct btd_adapter *adapter);\n\nconst char *btd_adapter_get_name(struct btd_adapter *adapter)\n{\n\tif (adapter->stored_alias)\n\t\treturn adapter->stored_alias;\n\n\tif (adapter->system_name)\n\t\treturn adapter->system_name;\n\n\treturn NULL;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"advertising.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/mgmt.h\"\n#include \"src/shared/ad.h\"\n#include \"eir.h\"\n#include \"log.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"adapter.h\"\n#include \"lib/sdp.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <gdbus/gdbus.h>\n#include <dbus/dbus.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <stdint.h>\n\nstatic uint8_t *generate_scan_rsp(struct btd_adv_client *client,\n\t\t\t\t\t\tuint32_t *flags, size_t *len)\n{\n\tstruct btd_adv_manager *manager = client->manager;\n\tconst char *name;\n\n\tif (!(*flags & MGMT_ADV_FLAG_LOCAL_NAME) && !client->name) {\n\t\t*len = 0;\n\t\treturn NULL;\n\t}\n\n\t*flags &= ~MGMT_ADV_FLAG_LOCAL_NAME;\n\n\tname = client->name;\n\tif (!name)\n\t\tname = btd_adapter_get_name(manager->adapter);\n\n\tbt_ad_add_name(client->scan, name);\n\n\treturn bt_ad_generate(client->scan, len);\n}"
  },
  {
    "function_name": "generate_adv_data",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/advertising.c",
    "lines": "720-738",
    "snippet": "static uint8_t *generate_adv_data(struct btd_adv_client *client,\n\t\t\t\t\t\tuint32_t *flags, size_t *len)\n{\n\tif ((*flags & MGMT_ADV_FLAG_APPEARANCE) ||\n\t\t\t\t\tclient->appearance != UINT16_MAX) {\n\t\tuint16_t appearance;\n\n\t\tappearance = client->appearance;\n\t\tif (appearance == UINT16_MAX)\n\t\t\t/* TODO: Get the appearance from the adaptor once\n\t\t\t * supported.\n\t\t\t */\n\t\t\tappearance = 0x000;\n\n\t\tbt_ad_add_appearance(client->data, appearance);\n\t}\n\n\treturn bt_ad_generate(client->data, len);\n}",
    "includes": [
      "#include \"advertising.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/mgmt.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"eir.h\"",
      "#include \"log.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"adapter.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <gdbus/gdbus.h>",
      "#include <dbus/dbus.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <stdint.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "bt_ad_generate",
          "args": [
            "client->data",
            "len"
          ],
          "line": 737
        },
        "resolved": true,
        "details": {
          "function_name": "bt_ad_generate",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
          "lines": "465-497",
          "snippet": "uint8_t *bt_ad_generate(struct bt_ad *ad, size_t *length)\n{\n\tuint8_t *adv_data;\n\tuint8_t pos = 0;\n\n\tif (!ad)\n\t\treturn NULL;\n\n\t*length = calculate_length(ad);\n\n\tif (*length > MAX_ADV_DATA_LEN)\n\t\treturn NULL;\n\n\tadv_data = malloc0(*length);\n\tif (!adv_data)\n\t\treturn NULL;\n\n\tserialize_service_uuids(ad->service_uuids, adv_data, &pos);\n\n\tserialize_solicit_uuids(ad->solicit_uuids, adv_data, &pos);\n\n\tserialize_manuf_data(ad->manufacturer_data, adv_data, &pos);\n\n\tserialize_service_data(ad->service_data, adv_data, &pos);\n\n\tserialize_name(ad->name, adv_data, &pos);\n\n\tserialize_appearance(ad->appearance, adv_data, &pos);\n\n\tserialize_data(ad->data, adv_data, &pos);\n\n\treturn adv_data;\n}",
          "includes": [
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/eir.h\"",
            "#include \"src/shared/ad.h\""
          ],
          "macros_used": [
            "#define MAX_ADV_DATA_LEN 31"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\n#define MAX_ADV_DATA_LEN 31\n\nuint8_t *bt_ad_generate(struct bt_ad *ad, size_t *length)\n{\n\tuint8_t *adv_data;\n\tuint8_t pos = 0;\n\n\tif (!ad)\n\t\treturn NULL;\n\n\t*length = calculate_length(ad);\n\n\tif (*length > MAX_ADV_DATA_LEN)\n\t\treturn NULL;\n\n\tadv_data = malloc0(*length);\n\tif (!adv_data)\n\t\treturn NULL;\n\n\tserialize_service_uuids(ad->service_uuids, adv_data, &pos);\n\n\tserialize_solicit_uuids(ad->solicit_uuids, adv_data, &pos);\n\n\tserialize_manuf_data(ad->manufacturer_data, adv_data, &pos);\n\n\tserialize_service_data(ad->service_data, adv_data, &pos);\n\n\tserialize_name(ad->name, adv_data, &pos);\n\n\tserialize_appearance(ad->appearance, adv_data, &pos);\n\n\tserialize_data(ad->data, adv_data, &pos);\n\n\treturn adv_data;\n}"
        }
      },
      {
        "call_info": {
          "callee": "bt_ad_add_appearance",
          "args": [
            "client->data",
            "appearance"
          ],
          "line": 734
        },
        "resolved": true,
        "details": {
          "function_name": "bt_ad_add_appearance",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
          "lines": "836-844",
          "snippet": "bool bt_ad_add_appearance(struct bt_ad *ad, uint16_t appearance)\n{\n\tif (!ad)\n\t\treturn false;\n\n\tad->appearance = appearance;\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/eir.h\"",
            "#include \"src/shared/ad.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nbool bt_ad_add_appearance(struct bt_ad *ad, uint16_t appearance)\n{\n\tif (!ad)\n\t\treturn false;\n\n\tad->appearance = appearance;\n\n\treturn true;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"advertising.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/mgmt.h\"\n#include \"src/shared/ad.h\"\n#include \"eir.h\"\n#include \"log.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"adapter.h\"\n#include \"lib/sdp.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <gdbus/gdbus.h>\n#include <dbus/dbus.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <stdint.h>\n\nstatic uint8_t *generate_adv_data(struct btd_adv_client *client,\n\t\t\t\t\t\tuint32_t *flags, size_t *len)\n{\n\tif ((*flags & MGMT_ADV_FLAG_APPEARANCE) ||\n\t\t\t\t\tclient->appearance != UINT16_MAX) {\n\t\tuint16_t appearance;\n\n\t\tappearance = client->appearance;\n\t\tif (appearance == UINT16_MAX)\n\t\t\t/* TODO: Get the appearance from the adaptor once\n\t\t\t * supported.\n\t\t\t */\n\t\t\tappearance = 0x000;\n\n\t\tbt_ad_add_appearance(client->data, appearance);\n\t}\n\n\treturn bt_ad_generate(client->data, len);\n}"
  },
  {
    "function_name": "calc_max_adv_len",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/advertising.c",
    "lines": "699-718",
    "snippet": "static size_t calc_max_adv_len(struct btd_adv_client *client, uint32_t flags)\n{\n\tsize_t max = client->manager->max_adv_len;\n\n\t/*\n\t * Flags which reduce the amount of space available for advertising.\n\t * See doc/mgmt-api.txt\n\t */\n\tif (flags & MGMT_ADV_FLAG_TX_POWER)\n\t\tmax -= 3;\n\n\tif (flags & (MGMT_ADV_FLAG_DISCOV | MGMT_ADV_FLAG_LIMITED_DISCOV |\n\t\t\t\t\t\tMGMT_ADV_FLAG_MANAGED_FLAGS))\n\t\tmax -= 3;\n\n\tif (flags & MGMT_ADV_FLAG_APPEARANCE)\n\t\tmax -= 4;\n\n\treturn max;\n}",
    "includes": [
      "#include \"advertising.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/mgmt.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"eir.h\"",
      "#include \"log.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"adapter.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <gdbus/gdbus.h>",
      "#include <dbus/dbus.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <stdint.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"advertising.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/mgmt.h\"\n#include \"src/shared/ad.h\"\n#include \"eir.h\"\n#include \"log.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"adapter.h\"\n#include \"lib/sdp.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <gdbus/gdbus.h>\n#include <dbus/dbus.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <stdint.h>\n\nstatic size_t calc_max_adv_len(struct btd_adv_client *client, uint32_t flags)\n{\n\tsize_t max = client->manager->max_adv_len;\n\n\t/*\n\t * Flags which reduce the amount of space available for advertising.\n\t * See doc/mgmt-api.txt\n\t */\n\tif (flags & MGMT_ADV_FLAG_TX_POWER)\n\t\tmax -= 3;\n\n\tif (flags & (MGMT_ADV_FLAG_DISCOV | MGMT_ADV_FLAG_LIMITED_DISCOV |\n\t\t\t\t\t\tMGMT_ADV_FLAG_MANAGED_FLAGS))\n\t\tmax -= 3;\n\n\tif (flags & MGMT_ADV_FLAG_APPEARANCE)\n\t\tmax -= 4;\n\n\treturn max;\n}"
  },
  {
    "function_name": "parse_discoverable",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/advertising.c",
    "lines": "666-697",
    "snippet": "static bool parse_discoverable(DBusMessageIter *iter,\n\t\t\t\tstruct btd_adv_client *client)\n{\n\tuint8_t flags;\n\tdbus_bool_t discoverable;\n\n\tif (!iter) {\n\t\tbt_ad_clear_flags(client->data);\n\t\treturn true;\n\t}\n\n\tif (dbus_message_iter_get_arg_type(iter) != DBUS_TYPE_BOOLEAN)\n\t\treturn false;\n\n\tdbus_message_iter_get_basic(iter, &discoverable);\n\n\tif (discoverable)\n\t\tflags = 0x02;\n\telse\n\t\tflags = 0x00;\n\n\tif (!set_flags(client , flags))\n\t\tgoto fail;\n\n\tDBG(\"Adding Flags 0x%02x\", flags);\n\n\treturn true;\n\nfail:\n\tbt_ad_clear_flags(client->data);\n\treturn false;\n}",
    "includes": [
      "#include \"advertising.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/mgmt.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"eir.h\"",
      "#include \"log.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"adapter.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <gdbus/gdbus.h>",
      "#include <dbus/dbus.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <stdint.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "bt_ad_clear_flags",
          "args": [
            "client->data"
          ],
          "line": 695
        },
        "resolved": true,
        "details": {
          "function_name": "bt_ad_clear_flags",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
          "lines": "880-887",
          "snippet": "void bt_ad_clear_flags(struct bt_ad *ad)\n{\n\tif (!ad)\n\t\treturn;\n\n\tqueue_remove_all(ad->data, data_type_match, UINT_TO_PTR(BT_AD_FLAGS),\n\t\t\t\t\t\t\tdata_destroy);\n}",
          "includes": [
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/eir.h\"",
            "#include \"src/shared/ad.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nvoid bt_ad_clear_flags(struct bt_ad *ad)\n{\n\tif (!ad)\n\t\treturn;\n\n\tqueue_remove_all(ad->data, data_type_match, UINT_TO_PTR(BT_AD_FLAGS),\n\t\t\t\t\t\t\tdata_destroy);\n}"
        }
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"Adding Flags 0x%02x\"",
            "flags"
          ],
          "line": 690
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "set_flags",
          "args": [
            "client",
            "flags"
          ],
          "line": 687
        },
        "resolved": true,
        "details": {
          "function_name": "set_flags",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/advertising.c",
          "lines": "649-664",
          "snippet": "static bool set_flags(struct btd_adv_client *client, uint8_t flags)\n{\n\tif (!flags) {\n\t\tbt_ad_clear_flags(client->data);\n\t\treturn true;\n\t}\n\n\t/* Set BR/EDR Not Supported for LE only */\n\tif (!btd_adapter_get_bredr(client->manager->adapter))\n\t\tflags |= 0x04;\n\n\tif (!bt_ad_add_flags(client->data, &flags, 1))\n\t\treturn false;\n\n\treturn true;\n}",
          "includes": [
            "#include \"advertising.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"eir.h\"",
            "#include \"log.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"adapter.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <gdbus/gdbus.h>",
            "#include <dbus/dbus.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <stdint.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"advertising.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/mgmt.h\"\n#include \"src/shared/ad.h\"\n#include \"eir.h\"\n#include \"log.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"adapter.h\"\n#include \"lib/sdp.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <gdbus/gdbus.h>\n#include <dbus/dbus.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <stdint.h>\n\nstatic bool set_flags(struct btd_adv_client *client, uint8_t flags)\n{\n\tif (!flags) {\n\t\tbt_ad_clear_flags(client->data);\n\t\treturn true;\n\t}\n\n\t/* Set BR/EDR Not Supported for LE only */\n\tif (!btd_adapter_get_bredr(client->manager->adapter))\n\t\tflags |= 0x04;\n\n\tif (!bt_ad_add_flags(client->data, &flags, 1))\n\t\treturn false;\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_get_basic",
          "args": [
            "iter",
            "&discoverable"
          ],
          "line": 680
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_get_arg_type",
          "args": [
            "iter"
          ],
          "line": 677
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"advertising.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/mgmt.h\"\n#include \"src/shared/ad.h\"\n#include \"eir.h\"\n#include \"log.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"adapter.h\"\n#include \"lib/sdp.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <gdbus/gdbus.h>\n#include <dbus/dbus.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <stdint.h>\n\nstatic bool parse_discoverable(DBusMessageIter *iter,\n\t\t\t\tstruct btd_adv_client *client)\n{\n\tuint8_t flags;\n\tdbus_bool_t discoverable;\n\n\tif (!iter) {\n\t\tbt_ad_clear_flags(client->data);\n\t\treturn true;\n\t}\n\n\tif (dbus_message_iter_get_arg_type(iter) != DBUS_TYPE_BOOLEAN)\n\t\treturn false;\n\n\tdbus_message_iter_get_basic(iter, &discoverable);\n\n\tif (discoverable)\n\t\tflags = 0x02;\n\telse\n\t\tflags = 0x00;\n\n\tif (!set_flags(client , flags))\n\t\tgoto fail;\n\n\tDBG(\"Adding Flags 0x%02x\", flags);\n\n\treturn true;\n\nfail:\n\tbt_ad_clear_flags(client->data);\n\treturn false;\n}"
  },
  {
    "function_name": "set_flags",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/advertising.c",
    "lines": "649-664",
    "snippet": "static bool set_flags(struct btd_adv_client *client, uint8_t flags)\n{\n\tif (!flags) {\n\t\tbt_ad_clear_flags(client->data);\n\t\treturn true;\n\t}\n\n\t/* Set BR/EDR Not Supported for LE only */\n\tif (!btd_adapter_get_bredr(client->manager->adapter))\n\t\tflags |= 0x04;\n\n\tif (!bt_ad_add_flags(client->data, &flags, 1))\n\t\treturn false;\n\n\treturn true;\n}",
    "includes": [
      "#include \"advertising.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/mgmt.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"eir.h\"",
      "#include \"log.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"adapter.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <gdbus/gdbus.h>",
      "#include <dbus/dbus.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <stdint.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "bt_ad_add_flags",
          "args": [
            "client->data",
            "&flags",
            "1"
          ],
          "line": 660
        },
        "resolved": true,
        "details": {
          "function_name": "bt_ad_add_flags",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
          "lines": "854-864",
          "snippet": "bool bt_ad_add_flags(struct bt_ad *ad, uint8_t *flags, size_t len)\n{\n\tif (!ad)\n\t\treturn false;\n\n\t/* TODO: Add table to check other flags */\n\tif (len > 1 || flags[0] & 0xe0)\n\t\treturn false;\n\n\treturn ad_replace_data(ad, BT_AD_FLAGS, flags, len);\n}",
          "includes": [
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/eir.h\"",
            "#include \"src/shared/ad.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nbool bt_ad_add_flags(struct bt_ad *ad, uint8_t *flags, size_t len)\n{\n\tif (!ad)\n\t\treturn false;\n\n\t/* TODO: Add table to check other flags */\n\tif (len > 1 || flags[0] & 0xe0)\n\t\treturn false;\n\n\treturn ad_replace_data(ad, BT_AD_FLAGS, flags, len);\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_adapter_get_bredr",
          "args": [
            "client->manager->adapter"
          ],
          "line": 657
        },
        "resolved": true,
        "details": {
          "function_name": "btd_adapter_get_bredr",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "4438-4444",
          "snippet": "bool btd_adapter_get_bredr(struct btd_adapter *adapter)\n{\n\tif (adapter->current_settings & MGMT_SETTING_BREDR)\n\t\treturn true;\n\n\treturn false;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void trigger_pairable_timeout(struct btd_adapter *adapter);",
            "static void adapter_start(struct btd_adapter *adapter);",
            "static void adapter_stop(struct btd_adapter *adapter);",
            "static void trigger_passive_scanning(struct btd_adapter *adapter);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void trigger_pairable_timeout(struct btd_adapter *adapter);\nstatic void adapter_start(struct btd_adapter *adapter);\nstatic void adapter_stop(struct btd_adapter *adapter);\nstatic void trigger_passive_scanning(struct btd_adapter *adapter);\n\nbool btd_adapter_get_bredr(struct btd_adapter *adapter)\n{\n\tif (adapter->current_settings & MGMT_SETTING_BREDR)\n\t\treturn true;\n\n\treturn false;\n}"
        }
      },
      {
        "call_info": {
          "callee": "bt_ad_clear_flags",
          "args": [
            "client->data"
          ],
          "line": 652
        },
        "resolved": true,
        "details": {
          "function_name": "bt_ad_clear_flags",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
          "lines": "880-887",
          "snippet": "void bt_ad_clear_flags(struct bt_ad *ad)\n{\n\tif (!ad)\n\t\treturn;\n\n\tqueue_remove_all(ad->data, data_type_match, UINT_TO_PTR(BT_AD_FLAGS),\n\t\t\t\t\t\t\tdata_destroy);\n}",
          "includes": [
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/eir.h\"",
            "#include \"src/shared/ad.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nvoid bt_ad_clear_flags(struct bt_ad *ad)\n{\n\tif (!ad)\n\t\treturn;\n\n\tqueue_remove_all(ad->data, data_type_match, UINT_TO_PTR(BT_AD_FLAGS),\n\t\t\t\t\t\t\tdata_destroy);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"advertising.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/mgmt.h\"\n#include \"src/shared/ad.h\"\n#include \"eir.h\"\n#include \"log.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"adapter.h\"\n#include \"lib/sdp.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <gdbus/gdbus.h>\n#include <dbus/dbus.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <stdint.h>\n\nstatic bool set_flags(struct btd_adv_client *client, uint8_t flags)\n{\n\tif (!flags) {\n\t\tbt_ad_clear_flags(client->data);\n\t\treturn true;\n\t}\n\n\t/* Set BR/EDR Not Supported for LE only */\n\tif (!btd_adapter_get_bredr(client->manager->adapter))\n\t\tflags |= 0x04;\n\n\tif (!bt_ad_add_flags(client->data, &flags, 1))\n\t\treturn false;\n\n\treturn true;\n}"
  },
  {
    "function_name": "parse_data",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/advertising.c",
    "lines": "591-647",
    "snippet": "static bool parse_data(DBusMessageIter *iter, struct btd_adv_client *client)\n{\n\tDBusMessageIter entries;\n\n\tif (!iter) {\n\t\tbt_ad_clear_data(client->data);\n\t\treturn true;\n\t}\n\n\tif (dbus_message_iter_get_arg_type(iter) != DBUS_TYPE_ARRAY)\n\t\treturn false;\n\n\tdbus_message_iter_recurse(iter, &entries);\n\n\tbt_ad_clear_data(client->data);\n\n\twhile (dbus_message_iter_get_arg_type(&entries)\n\t\t\t\t\t\t== DBUS_TYPE_DICT_ENTRY) {\n\t\tDBusMessageIter value, entry, array;\n\t\tuint8_t type;\n\t\tuint8_t *data;\n\t\tint len;\n\n\t\tdbus_message_iter_recurse(&entries, &entry);\n\t\tdbus_message_iter_get_basic(&entry, &type);\n\n\t\tdbus_message_iter_next(&entry);\n\n\t\tif (dbus_message_iter_get_arg_type(&entry) != DBUS_TYPE_VARIANT)\n\t\t\tgoto fail;\n\n\t\tdbus_message_iter_recurse(&entry, &value);\n\n\t\tif (dbus_message_iter_get_arg_type(&value) != DBUS_TYPE_ARRAY)\n\t\t\tgoto fail;\n\n\t\tdbus_message_iter_recurse(&value, &array);\n\n\t\tif (dbus_message_iter_get_arg_type(&array) != DBUS_TYPE_BYTE)\n\t\t\tgoto fail;\n\n\t\tdbus_message_iter_get_fixed_array(&array, &data, &len);\n\n\t\tDBG(\"Adding Data for type 0x%02x len %u\", type, len);\n\n\t\tif (!bt_ad_add_data(client->data, type, data, len))\n\t\t\tgoto fail;\n\n\t\tdbus_message_iter_next(&entries);\n\t}\n\n\treturn true;\n\nfail:\n\tbt_ad_clear_data(client->data);\n\treturn false;\n}",
    "includes": [
      "#include \"advertising.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/mgmt.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"eir.h\"",
      "#include \"log.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"adapter.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <gdbus/gdbus.h>",
      "#include <dbus/dbus.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <stdint.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "bt_ad_clear_data",
          "args": [
            "client->data"
          ],
          "line": 645
        },
        "resolved": true,
        "details": {
          "function_name": "bt_ad_clear_data",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
          "lines": "999-1005",
          "snippet": "void bt_ad_clear_data(struct bt_ad *ad)\n{\n\tif (!ad)\n\t\treturn;\n\n\tqueue_remove_all(ad->data, NULL, NULL, data_destroy);\n}",
          "includes": [
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/eir.h\"",
            "#include \"src/shared/ad.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nvoid bt_ad_clear_data(struct bt_ad *ad)\n{\n\tif (!ad)\n\t\treturn;\n\n\tqueue_remove_all(ad->data, NULL, NULL, data_destroy);\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_next",
          "args": [
            "&entries"
          ],
          "line": 639
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bt_ad_add_data",
          "args": [
            "client->data",
            "type",
            "data",
            "len"
          ],
          "line": 636
        },
        "resolved": true,
        "details": {
          "function_name": "bt_ad_add_data",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
          "lines": "932-948",
          "snippet": "bool bt_ad_add_data(struct bt_ad *ad, uint8_t type, void *data, size_t len)\n{\n\tsize_t i;\n\n\tif (!ad)\n\t\treturn false;\n\n\tif (len > (MAX_ADV_DATA_LEN - 2))\n\t\treturn false;\n\n\tfor (i = 0; i < sizeof(type_blacklist); i++) {\n\t\tif (type == type_blacklist[i])\n\t\t\treturn false;\n\t}\n\n\treturn ad_replace_data(ad, type, data, len);\n}",
          "includes": [
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/eir.h\"",
            "#include \"src/shared/ad.h\""
          ],
          "macros_used": [
            "#define MAX_ADV_DATA_LEN 31"
          ],
          "globals_used": [
            "static uint8_t type_blacklist[] = {\n\tBT_AD_FLAGS,\n\tBT_AD_UUID16_SOME,\n\tBT_AD_UUID16_ALL,\n\tBT_AD_UUID32_SOME,\n\tBT_AD_UUID32_ALL,\n\tBT_AD_UUID128_SOME,\n\tBT_AD_UUID128_ALL,\n\tBT_AD_NAME_SHORT,\n\tBT_AD_NAME_COMPLETE,\n\tBT_AD_TX_POWER,\n\tBT_AD_CLASS_OF_DEV,\n\tBT_AD_SSP_HASH,\n\tBT_AD_SSP_RANDOMIZER,\n\tBT_AD_DEVICE_ID,\n\tBT_AD_SMP_TK,\n\tBT_AD_SMP_OOB_FLAGS,\n\tBT_AD_SLAVE_CONN_INTERVAL,\n\tBT_AD_SOLICIT16,\n\tBT_AD_SOLICIT128,\n\tBT_AD_SERVICE_DATA16,\n\tBT_AD_PUBLIC_ADDRESS,\n\tBT_AD_RANDOM_ADDRESS,\n\tBT_AD_GAP_APPEARANCE,\n\tBT_AD_ADVERTISING_INTERVAL,\n\tBT_AD_LE_DEVICE_ADDRESS,\n\tBT_AD_LE_ROLE,\n\tBT_AD_SSP_HASH_P256,\n\tBT_AD_SSP_RANDOMIZER_P256,\n\tBT_AD_SOLICIT32,\n\tBT_AD_SERVICE_DATA32,\n\tBT_AD_SERVICE_DATA128,\n\tBT_AD_LE_SC_CONFIRM_VALUE,\n\tBT_AD_LE_SC_RANDOM_VALUE,\n\tBT_AD_LE_SUPPORTED_FEATURES,\n\tBT_AD_CHANNEL_MAP_UPDATE_IND,\n\tBT_AD_MESH_PROV,\n\tBT_AD_MESH_DATA,\n\tBT_AD_MESH_BEACON,\n\tBT_AD_3D_INFO_DATA,\n\tBT_AD_MANUFACTURER_DATA,\n};"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\n#define MAX_ADV_DATA_LEN 31\n\nstatic uint8_t type_blacklist[] = {\n\tBT_AD_FLAGS,\n\tBT_AD_UUID16_SOME,\n\tBT_AD_UUID16_ALL,\n\tBT_AD_UUID32_SOME,\n\tBT_AD_UUID32_ALL,\n\tBT_AD_UUID128_SOME,\n\tBT_AD_UUID128_ALL,\n\tBT_AD_NAME_SHORT,\n\tBT_AD_NAME_COMPLETE,\n\tBT_AD_TX_POWER,\n\tBT_AD_CLASS_OF_DEV,\n\tBT_AD_SSP_HASH,\n\tBT_AD_SSP_RANDOMIZER,\n\tBT_AD_DEVICE_ID,\n\tBT_AD_SMP_TK,\n\tBT_AD_SMP_OOB_FLAGS,\n\tBT_AD_SLAVE_CONN_INTERVAL,\n\tBT_AD_SOLICIT16,\n\tBT_AD_SOLICIT128,\n\tBT_AD_SERVICE_DATA16,\n\tBT_AD_PUBLIC_ADDRESS,\n\tBT_AD_RANDOM_ADDRESS,\n\tBT_AD_GAP_APPEARANCE,\n\tBT_AD_ADVERTISING_INTERVAL,\n\tBT_AD_LE_DEVICE_ADDRESS,\n\tBT_AD_LE_ROLE,\n\tBT_AD_SSP_HASH_P256,\n\tBT_AD_SSP_RANDOMIZER_P256,\n\tBT_AD_SOLICIT32,\n\tBT_AD_SERVICE_DATA32,\n\tBT_AD_SERVICE_DATA128,\n\tBT_AD_LE_SC_CONFIRM_VALUE,\n\tBT_AD_LE_SC_RANDOM_VALUE,\n\tBT_AD_LE_SUPPORTED_FEATURES,\n\tBT_AD_CHANNEL_MAP_UPDATE_IND,\n\tBT_AD_MESH_PROV,\n\tBT_AD_MESH_DATA,\n\tBT_AD_MESH_BEACON,\n\tBT_AD_3D_INFO_DATA,\n\tBT_AD_MANUFACTURER_DATA,\n};\n\nbool bt_ad_add_data(struct bt_ad *ad, uint8_t type, void *data, size_t len)\n{\n\tsize_t i;\n\n\tif (!ad)\n\t\treturn false;\n\n\tif (len > (MAX_ADV_DATA_LEN - 2))\n\t\treturn false;\n\n\tfor (i = 0; i < sizeof(type_blacklist); i++) {\n\t\tif (type == type_blacklist[i])\n\t\t\treturn false;\n\t}\n\n\treturn ad_replace_data(ad, type, data, len);\n}"
        }
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"Adding Data for type 0x%02x len %u\"",
            "type",
            "len"
          ],
          "line": 634
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_get_fixed_array",
          "args": [
            "&array",
            "&data",
            "&len"
          ],
          "line": 632
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_get_arg_type",
          "args": [
            "&array"
          ],
          "line": 629
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_recurse",
          "args": [
            "&value",
            "&array"
          ],
          "line": 627
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_get_arg_type",
          "args": [
            "&value"
          ],
          "line": 624
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_recurse",
          "args": [
            "&entry",
            "&value"
          ],
          "line": 622
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_get_arg_type",
          "args": [
            "&entry"
          ],
          "line": 619
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_next",
          "args": [
            "&entry"
          ],
          "line": 617
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_get_basic",
          "args": [
            "&entry",
            "&type"
          ],
          "line": 615
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_recurse",
          "args": [
            "&entries",
            "&entry"
          ],
          "line": 614
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_get_arg_type",
          "args": [
            "&entries"
          ],
          "line": 607
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_recurse",
          "args": [
            "iter",
            "&entries"
          ],
          "line": 603
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_get_arg_type",
          "args": [
            "iter"
          ],
          "line": 600
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"advertising.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/mgmt.h\"\n#include \"src/shared/ad.h\"\n#include \"eir.h\"\n#include \"log.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"adapter.h\"\n#include \"lib/sdp.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <gdbus/gdbus.h>\n#include <dbus/dbus.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <stdint.h>\n\nstatic bool parse_data(DBusMessageIter *iter, struct btd_adv_client *client)\n{\n\tDBusMessageIter entries;\n\n\tif (!iter) {\n\t\tbt_ad_clear_data(client->data);\n\t\treturn true;\n\t}\n\n\tif (dbus_message_iter_get_arg_type(iter) != DBUS_TYPE_ARRAY)\n\t\treturn false;\n\n\tdbus_message_iter_recurse(iter, &entries);\n\n\tbt_ad_clear_data(client->data);\n\n\twhile (dbus_message_iter_get_arg_type(&entries)\n\t\t\t\t\t\t== DBUS_TYPE_DICT_ENTRY) {\n\t\tDBusMessageIter value, entry, array;\n\t\tuint8_t type;\n\t\tuint8_t *data;\n\t\tint len;\n\n\t\tdbus_message_iter_recurse(&entries, &entry);\n\t\tdbus_message_iter_get_basic(&entry, &type);\n\n\t\tdbus_message_iter_next(&entry);\n\n\t\tif (dbus_message_iter_get_arg_type(&entry) != DBUS_TYPE_VARIANT)\n\t\t\tgoto fail;\n\n\t\tdbus_message_iter_recurse(&entry, &value);\n\n\t\tif (dbus_message_iter_get_arg_type(&value) != DBUS_TYPE_ARRAY)\n\t\t\tgoto fail;\n\n\t\tdbus_message_iter_recurse(&value, &array);\n\n\t\tif (dbus_message_iter_get_arg_type(&array) != DBUS_TYPE_BYTE)\n\t\t\tgoto fail;\n\n\t\tdbus_message_iter_get_fixed_array(&array, &data, &len);\n\n\t\tDBG(\"Adding Data for type 0x%02x len %u\", type, len);\n\n\t\tif (!bt_ad_add_data(client->data, type, data, len))\n\t\t\tgoto fail;\n\n\t\tdbus_message_iter_next(&entries);\n\t}\n\n\treturn true;\n\nfail:\n\tbt_ad_clear_data(client->data);\n\treturn false;\n}"
  },
  {
    "function_name": "parse_timeout",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/advertising.c",
    "lines": "567-589",
    "snippet": "static bool parse_timeout(DBusMessageIter *iter,\n\t\t\t\t\tstruct btd_adv_client *client)\n{\n\tif (!iter) {\n\t\tclient->timeout = 0;\n\t\tg_source_remove(client->to_id);\n\t\tclient->to_id = 0;\n\t\treturn true;\n\t}\n\n\tif (dbus_message_iter_get_arg_type(iter) != DBUS_TYPE_UINT16)\n\t\treturn false;\n\n\tdbus_message_iter_get_basic(iter, &client->timeout);\n\n\tif (client->to_id)\n\t\tg_source_remove(client->to_id);\n\n\tclient->to_id = g_timeout_add_seconds(client->timeout, client_timeout,\n\t\t\t\t\t\t\t\tclient);\n\n\treturn true;\n}",
    "includes": [
      "#include \"advertising.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/mgmt.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"eir.h\"",
      "#include \"log.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"adapter.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <gdbus/gdbus.h>",
      "#include <dbus/dbus.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <stdint.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_timeout_add_seconds",
          "args": [
            "client->timeout",
            "client_timeout",
            "client"
          ],
          "line": 585
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_source_remove",
          "args": [
            "client->to_id"
          ],
          "line": 583
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_get_basic",
          "args": [
            "iter",
            "&client->timeout"
          ],
          "line": 580
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_get_arg_type",
          "args": [
            "iter"
          ],
          "line": 577
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_source_remove",
          "args": [
            "client->to_id"
          ],
          "line": 572
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"advertising.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/mgmt.h\"\n#include \"src/shared/ad.h\"\n#include \"eir.h\"\n#include \"log.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"adapter.h\"\n#include \"lib/sdp.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <gdbus/gdbus.h>\n#include <dbus/dbus.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <stdint.h>\n\nstatic bool parse_timeout(DBusMessageIter *iter,\n\t\t\t\t\tstruct btd_adv_client *client)\n{\n\tif (!iter) {\n\t\tclient->timeout = 0;\n\t\tg_source_remove(client->to_id);\n\t\tclient->to_id = 0;\n\t\treturn true;\n\t}\n\n\tif (dbus_message_iter_get_arg_type(iter) != DBUS_TYPE_UINT16)\n\t\treturn false;\n\n\tdbus_message_iter_get_basic(iter, &client->timeout);\n\n\tif (client->to_id)\n\t\tg_source_remove(client->to_id);\n\n\tclient->to_id = g_timeout_add_seconds(client->timeout, client_timeout,\n\t\t\t\t\t\t\t\tclient);\n\n\treturn true;\n}"
  },
  {
    "function_name": "client_timeout",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/advertising.c",
    "lines": "553-565",
    "snippet": "static gboolean client_timeout(void *user_data)\n{\n\tstruct btd_adv_client *client = user_data;\n\n\tDBG(\"\");\n\n\tclient->to_id = 0;\n\n\tclient_release(client);\n\tclient_remove(client);\n\n\treturn FALSE;\n}",
    "includes": [
      "#include \"advertising.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/mgmt.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"eir.h\"",
      "#include \"log.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"adapter.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <gdbus/gdbus.h>",
      "#include <dbus/dbus.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <stdint.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "client_remove",
          "args": [
            "client"
          ],
          "line": 562
        },
        "resolved": true,
        "details": {
          "function_name": "client_remove",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/advertising.c",
          "lines": "173-197",
          "snippet": "static void client_remove(void *data)\n{\n\tstruct btd_adv_client *client = data;\n\tstruct mgmt_cp_remove_advertising cp;\n\n\tg_dbus_client_set_disconnect_watch(client->client, NULL, NULL);\n\n\tcp.instance = client->instance;\n\n\tmgmt_send(client->manager->mgmt, MGMT_OP_REMOVE_ADVERTISING,\n\t\t\tclient->manager->mgmt_index, sizeof(cp), &cp,\n\t\t\tNULL, NULL, NULL);\n\n\tqueue_remove(client->manager->clients, client);\n\n\tg_idle_add(client_free_idle_cb, client);\n\n\tg_dbus_emit_property_changed(btd_get_dbus_connection(),\n\t\t\t\tadapter_get_path(client->manager->adapter),\n\t\t\t\tLE_ADVERTISING_MGR_IFACE, \"SupportedInstances\");\n\n\tg_dbus_emit_property_changed(btd_get_dbus_connection(),\n\t\t\t\tadapter_get_path(client->manager->adapter),\n\t\t\t\tLE_ADVERTISING_MGR_IFACE, \"ActiveInstances\");\n}",
          "includes": [
            "#include \"advertising.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"eir.h\"",
            "#include \"log.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"adapter.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <gdbus/gdbus.h>",
            "#include <dbus/dbus.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <stdint.h>"
          ],
          "macros_used": [
            "#define LE_ADVERTISING_MGR_IFACE \"org.bluez.LEAdvertisingManager1\""
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"advertising.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/mgmt.h\"\n#include \"src/shared/ad.h\"\n#include \"eir.h\"\n#include \"log.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"adapter.h\"\n#include \"lib/sdp.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <gdbus/gdbus.h>\n#include <dbus/dbus.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <stdint.h>\n\n#define LE_ADVERTISING_MGR_IFACE \"org.bluez.LEAdvertisingManager1\"\n\nstatic void client_remove(void *data)\n{\n\tstruct btd_adv_client *client = data;\n\tstruct mgmt_cp_remove_advertising cp;\n\n\tg_dbus_client_set_disconnect_watch(client->client, NULL, NULL);\n\n\tcp.instance = client->instance;\n\n\tmgmt_send(client->manager->mgmt, MGMT_OP_REMOVE_ADVERTISING,\n\t\t\tclient->manager->mgmt_index, sizeof(cp), &cp,\n\t\t\tNULL, NULL, NULL);\n\n\tqueue_remove(client->manager->clients, client);\n\n\tg_idle_add(client_free_idle_cb, client);\n\n\tg_dbus_emit_property_changed(btd_get_dbus_connection(),\n\t\t\t\tadapter_get_path(client->manager->adapter),\n\t\t\t\tLE_ADVERTISING_MGR_IFACE, \"SupportedInstances\");\n\n\tg_dbus_emit_property_changed(btd_get_dbus_connection(),\n\t\t\t\tadapter_get_path(client->manager->adapter),\n\t\t\t\tLE_ADVERTISING_MGR_IFACE, \"ActiveInstances\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "client_release",
          "args": [
            "client"
          ],
          "line": 561
        },
        "resolved": true,
        "details": {
          "function_name": "client_release",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/advertising.c",
          "lines": "141-149",
          "snippet": "static void client_release(void *data)\n{\n\tstruct btd_adv_client *client = data;\n\n\tDBG(\"Releasing advertisement %s, %s\", client->owner, client->path);\n\n\tg_dbus_proxy_method_call(client->proxy, \"Release\", NULL, NULL, NULL,\n\t\t\t\t\t\t\t\t\tNULL);\n}",
          "includes": [
            "#include \"advertising.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"eir.h\"",
            "#include \"log.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"adapter.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <gdbus/gdbus.h>",
            "#include <dbus/dbus.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <stdint.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"advertising.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/mgmt.h\"\n#include \"src/shared/ad.h\"\n#include \"eir.h\"\n#include \"log.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"adapter.h\"\n#include \"lib/sdp.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <gdbus/gdbus.h>\n#include <dbus/dbus.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <stdint.h>\n\nstatic void client_release(void *data)\n{\n\tstruct btd_adv_client *client = data;\n\n\tDBG(\"Releasing advertisement %s, %s\", client->owner, client->path);\n\n\tg_dbus_proxy_method_call(client->proxy, \"Release\", NULL, NULL, NULL,\n\t\t\t\t\t\t\t\t\tNULL);\n}"
        }
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"\""
          ],
          "line": 557
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"advertising.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/mgmt.h\"\n#include \"src/shared/ad.h\"\n#include \"eir.h\"\n#include \"log.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"adapter.h\"\n#include \"lib/sdp.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <gdbus/gdbus.h>\n#include <dbus/dbus.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <stdint.h>\n\nstatic gboolean client_timeout(void *user_data)\n{\n\tstruct btd_adv_client *client = user_data;\n\n\tDBG(\"\");\n\n\tclient->to_id = 0;\n\n\tclient_release(client);\n\tclient_remove(client);\n\n\treturn FALSE;\n}"
  },
  {
    "function_name": "parse_duration",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/advertising.c",
    "lines": "537-551",
    "snippet": "static bool parse_duration(DBusMessageIter *iter,\n\t\t\t\t\tstruct btd_adv_client *client)\n{\n\tif (!iter) {\n\t\tclient->duration = 0;\n\t\treturn true;\n\t}\n\n\tif (dbus_message_iter_get_arg_type(iter) != DBUS_TYPE_UINT16)\n\t\treturn false;\n\n\tdbus_message_iter_get_basic(iter, &client->duration);\n\n\treturn true;\n}",
    "includes": [
      "#include \"advertising.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/mgmt.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"eir.h\"",
      "#include \"log.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"adapter.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <gdbus/gdbus.h>",
      "#include <dbus/dbus.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <stdint.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "dbus_message_iter_get_basic",
          "args": [
            "iter",
            "&client->duration"
          ],
          "line": 548
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_get_arg_type",
          "args": [
            "iter"
          ],
          "line": 545
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"advertising.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/mgmt.h\"\n#include \"src/shared/ad.h\"\n#include \"eir.h\"\n#include \"log.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"adapter.h\"\n#include \"lib/sdp.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <gdbus/gdbus.h>\n#include <dbus/dbus.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <stdint.h>\n\nstatic bool parse_duration(DBusMessageIter *iter,\n\t\t\t\t\tstruct btd_adv_client *client)\n{\n\tif (!iter) {\n\t\tclient->duration = 0;\n\t\treturn true;\n\t}\n\n\tif (dbus_message_iter_get_arg_type(iter) != DBUS_TYPE_UINT16)\n\t\treturn false;\n\n\tdbus_message_iter_get_basic(iter, &client->duration);\n\n\treturn true;\n}"
  },
  {
    "function_name": "parse_appearance",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/advertising.c",
    "lines": "516-535",
    "snippet": "static bool parse_appearance(DBusMessageIter *iter,\n\t\t\t\t\tstruct btd_adv_client *client)\n{\n\tif (!iter) {\n\t\tclient->appearance = 0;\n\t\treturn true;\n\t}\n\n\tif (dbus_message_iter_get_arg_type(iter) != DBUS_TYPE_UINT16)\n\t\treturn false;\n\n\tif (client->flags & MGMT_ADV_FLAG_APPEARANCE) {\n\t\terror(\"Appearance already included\");\n\t\treturn false;\n\t}\n\n\tdbus_message_iter_get_basic(iter, &client->appearance);\n\n\treturn true;\n}",
    "includes": [
      "#include \"advertising.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/mgmt.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"eir.h\"",
      "#include \"log.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"adapter.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <gdbus/gdbus.h>",
      "#include <dbus/dbus.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <stdint.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "dbus_message_iter_get_basic",
          "args": [
            "iter",
            "&client->appearance"
          ],
          "line": 532
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"Appearance already included\""
          ],
          "line": 528
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_not_ready",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "118-122",
          "snippet": "DBusMessage *btd_error_not_ready(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".NotReady\",\n\t\t\t\t\t\"Resource Not Ready\");\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_not_ready(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".NotReady\",\n\t\t\t\t\t\"Resource Not Ready\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_get_arg_type",
          "args": [
            "iter"
          ],
          "line": 524
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"advertising.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/mgmt.h\"\n#include \"src/shared/ad.h\"\n#include \"eir.h\"\n#include \"log.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"adapter.h\"\n#include \"lib/sdp.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <gdbus/gdbus.h>\n#include <dbus/dbus.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <stdint.h>\n\nstatic bool parse_appearance(DBusMessageIter *iter,\n\t\t\t\t\tstruct btd_adv_client *client)\n{\n\tif (!iter) {\n\t\tclient->appearance = 0;\n\t\treturn true;\n\t}\n\n\tif (dbus_message_iter_get_arg_type(iter) != DBUS_TYPE_UINT16)\n\t\treturn false;\n\n\tif (client->flags & MGMT_ADV_FLAG_APPEARANCE) {\n\t\terror(\"Appearance already included\");\n\t\treturn false;\n\t}\n\n\tdbus_message_iter_get_basic(iter, &client->appearance);\n\n\treturn true;\n}"
  },
  {
    "function_name": "parse_local_name",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/advertising.c",
    "lines": "489-514",
    "snippet": "static bool parse_local_name(DBusMessageIter *iter,\n\t\t\t\t\tstruct btd_adv_client *client)\n{\n\tconst char *name;\n\n\tif (!iter) {\n\t\tfree(client->name);\n\t\tclient->name = NULL;\n\t\treturn true;\n\t}\n\n\tif (dbus_message_iter_get_arg_type(iter) != DBUS_TYPE_STRING)\n\t\treturn false;\n\n\tif (client->flags & MGMT_ADV_FLAG_LOCAL_NAME) {\n\t\terror(\"Local name already included\");\n\t\treturn false;\n\t}\n\n\tdbus_message_iter_get_basic(iter, &name);\n\n\tfree(client->name);\n\tclient->name = strdup(name);\n\n\treturn true;\n}",
    "includes": [
      "#include \"advertising.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/mgmt.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"eir.h\"",
      "#include \"log.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"adapter.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <gdbus/gdbus.h>",
      "#include <dbus/dbus.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <stdint.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "strdup",
          "args": [
            "name"
          ],
          "line": 511
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "free",
          "args": [
            "client->name"
          ],
          "line": 510
        },
        "resolved": true,
        "details": {
          "function_name": "client_free_idle_cb",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/advertising.c",
          "lines": "134-139",
          "snippet": "static gboolean client_free_idle_cb(void *data)\n{\n\tclient_free(data);\n\n\treturn FALSE;\n}",
          "includes": [
            "#include \"advertising.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"eir.h\"",
            "#include \"log.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"adapter.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <gdbus/gdbus.h>",
            "#include <dbus/dbus.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <stdint.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"advertising.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/mgmt.h\"\n#include \"src/shared/ad.h\"\n#include \"eir.h\"\n#include \"log.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"adapter.h\"\n#include \"lib/sdp.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <gdbus/gdbus.h>\n#include <dbus/dbus.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <stdint.h>\n\nstatic gboolean client_free_idle_cb(void *data)\n{\n\tclient_free(data);\n\n\treturn FALSE;\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_get_basic",
          "args": [
            "iter",
            "&name"
          ],
          "line": 508
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"Local name already included\""
          ],
          "line": 504
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_not_ready",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "118-122",
          "snippet": "DBusMessage *btd_error_not_ready(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".NotReady\",\n\t\t\t\t\t\"Resource Not Ready\");\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_not_ready(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".NotReady\",\n\t\t\t\t\t\"Resource Not Ready\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_get_arg_type",
          "args": [
            "iter"
          ],
          "line": 500
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"advertising.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/mgmt.h\"\n#include \"src/shared/ad.h\"\n#include \"eir.h\"\n#include \"log.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"adapter.h\"\n#include \"lib/sdp.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <gdbus/gdbus.h>\n#include <dbus/dbus.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <stdint.h>\n\nstatic bool parse_local_name(DBusMessageIter *iter,\n\t\t\t\t\tstruct btd_adv_client *client)\n{\n\tconst char *name;\n\n\tif (!iter) {\n\t\tfree(client->name);\n\t\tclient->name = NULL;\n\t\treturn true;\n\t}\n\n\tif (dbus_message_iter_get_arg_type(iter) != DBUS_TYPE_STRING)\n\t\treturn false;\n\n\tif (client->flags & MGMT_ADV_FLAG_LOCAL_NAME) {\n\t\terror(\"Local name already included\");\n\t\treturn false;\n\t}\n\n\tdbus_message_iter_get_basic(iter, &name);\n\n\tfree(client->name);\n\tclient->name = strdup(name);\n\n\treturn true;\n}"
  },
  {
    "function_name": "parse_includes",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/advertising.c",
    "lines": "447-487",
    "snippet": "static bool parse_includes(DBusMessageIter *iter,\n\t\t\t\t\tstruct btd_adv_client *client)\n{\n\tDBusMessageIter entries;\n\n\tif (!iter) {\n\t\tclient->flags = 0;\n\t\treturn true;\n\t}\n\n\tif (dbus_message_iter_get_arg_type(iter) != DBUS_TYPE_ARRAY)\n\t\treturn false;\n\n\tdbus_message_iter_recurse(iter, &entries);\n\n\t/* Reset flags before parsing */\n\tclient->flags = 0;\n\n\twhile (dbus_message_iter_get_arg_type(&entries) == DBUS_TYPE_STRING) {\n\t\tconst char *str;\n\t\tstruct adv_include *inc;\n\n\t\tdbus_message_iter_get_basic(&entries, &str);\n\n\t\tfor (inc = includes; inc && inc->name; inc++) {\n\t\t\tif (strcmp(str, inc->name))\n\t\t\t\tcontinue;\n\n\t\t\tif (!(client->manager->supported_flags & inc->flag))\n\t\t\t\tcontinue;\n\n\t\t\tDBG(\"Including Feature: %s\", str);\n\n\t\t\tclient->flags |= inc->flag;\n\t\t}\n\n\t\tdbus_message_iter_next(&entries);\n\t}\n\n\treturn true;\n}",
    "includes": [
      "#include \"advertising.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/mgmt.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"eir.h\"",
      "#include \"log.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"adapter.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <gdbus/gdbus.h>",
      "#include <dbus/dbus.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <stdint.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static struct adv_include {\n\tuint8_t flag;\n\tconst char *name;\n} includes[] = {\n\t{ MGMT_ADV_FLAG_TX_POWER, \"tx-power\" },\n\t{ MGMT_ADV_FLAG_APPEARANCE, \"appearance\" },\n\t{ MGMT_ADV_FLAG_LOCAL_NAME, \"local-name\" },\n\t{ },\n};"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "dbus_message_iter_next",
          "args": [
            "&entries"
          ],
          "line": 483
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"Including Feature: %s\"",
            "str"
          ],
          "line": 478
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "str",
            "inc->name"
          ],
          "line": 472
        },
        "resolved": true,
        "details": {
          "function_name": "g_strcmp",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "1927-1930",
          "snippet": "static gint g_strcmp(gconstpointer a, gconstpointer b)\n{\n\treturn strcmp(a, b);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic gint g_strcmp(gconstpointer a, gconstpointer b)\n{\n\treturn strcmp(a, b);\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_get_basic",
          "args": [
            "&entries",
            "&str"
          ],
          "line": 469
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_get_arg_type",
          "args": [
            "&entries"
          ],
          "line": 465
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_recurse",
          "args": [
            "iter",
            "&entries"
          ],
          "line": 460
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_get_arg_type",
          "args": [
            "iter"
          ],
          "line": 457
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"advertising.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/mgmt.h\"\n#include \"src/shared/ad.h\"\n#include \"eir.h\"\n#include \"log.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"adapter.h\"\n#include \"lib/sdp.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <gdbus/gdbus.h>\n#include <dbus/dbus.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <stdint.h>\n\nstatic struct adv_include {\n\tuint8_t flag;\n\tconst char *name;\n} includes[] = {\n\t{ MGMT_ADV_FLAG_TX_POWER, \"tx-power\" },\n\t{ MGMT_ADV_FLAG_APPEARANCE, \"appearance\" },\n\t{ MGMT_ADV_FLAG_LOCAL_NAME, \"local-name\" },\n\t{ },\n};\n\nstatic bool parse_includes(DBusMessageIter *iter,\n\t\t\t\t\tstruct btd_adv_client *client)\n{\n\tDBusMessageIter entries;\n\n\tif (!iter) {\n\t\tclient->flags = 0;\n\t\treturn true;\n\t}\n\n\tif (dbus_message_iter_get_arg_type(iter) != DBUS_TYPE_ARRAY)\n\t\treturn false;\n\n\tdbus_message_iter_recurse(iter, &entries);\n\n\t/* Reset flags before parsing */\n\tclient->flags = 0;\n\n\twhile (dbus_message_iter_get_arg_type(&entries) == DBUS_TYPE_STRING) {\n\t\tconst char *str;\n\t\tstruct adv_include *inc;\n\n\t\tdbus_message_iter_get_basic(&entries, &str);\n\n\t\tfor (inc = includes; inc && inc->name; inc++) {\n\t\t\tif (strcmp(str, inc->name))\n\t\t\t\tcontinue;\n\n\t\t\tif (!(client->manager->supported_flags & inc->flag))\n\t\t\t\tcontinue;\n\n\t\t\tDBG(\"Including Feature: %s\", str);\n\n\t\t\tclient->flags |= inc->flag;\n\t\t}\n\n\t\tdbus_message_iter_next(&entries);\n\t}\n\n\treturn true;\n}"
  },
  {
    "function_name": "parse_service_data",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/advertising.c",
    "lines": "373-435",
    "snippet": "static bool parse_service_data(DBusMessageIter *iter,\n\t\t\t\t\tstruct btd_adv_client *client)\n{\n\tDBusMessageIter entries;\n\n\tif (!iter) {\n\t\tbt_ad_clear_service_data(client->data);\n\t\treturn true;\n\t}\n\n\tif (dbus_message_iter_get_arg_type(iter) != DBUS_TYPE_ARRAY)\n\t\treturn false;\n\n\tdbus_message_iter_recurse(iter, &entries);\n\n\tbt_ad_clear_service_data(client->data);\n\n\twhile (dbus_message_iter_get_arg_type(&entries)\n\t\t\t\t\t\t== DBUS_TYPE_DICT_ENTRY) {\n\t\tDBusMessageIter value, entry, array;\n\t\tconst char *uuid_str;\n\t\tbt_uuid_t uuid;\n\t\tuint8_t *service_data;\n\t\tint len;\n\n\t\tdbus_message_iter_recurse(&entries, &entry);\n\t\tdbus_message_iter_get_basic(&entry, &uuid_str);\n\n\t\tif (bt_string_to_uuid(&uuid, uuid_str) < 0)\n\t\t\tgoto fail;\n\n\t\tdbus_message_iter_next(&entry);\n\n\t\tif (dbus_message_iter_get_arg_type(&entry) != DBUS_TYPE_VARIANT)\n\t\t\tgoto fail;\n\n\t\tdbus_message_iter_recurse(&entry, &value);\n\n\t\tif (dbus_message_iter_get_arg_type(&value) != DBUS_TYPE_ARRAY)\n\t\t\tgoto fail;\n\n\t\tdbus_message_iter_recurse(&value, &array);\n\n\t\tif (dbus_message_iter_get_arg_type(&array) != DBUS_TYPE_BYTE)\n\t\t\tgoto fail;\n\n\t\tdbus_message_iter_get_fixed_array(&array, &service_data, &len);\n\n\t\tDBG(\"Adding ServiceData for %s\", uuid_str);\n\n\t\tif (!bt_ad_add_service_data(client->data, &uuid, service_data,\n\t\t\t\t\t\t\t\t\tlen))\n\t\t\tgoto fail;\n\n\t\tdbus_message_iter_next(&entries);\n\t}\n\n\treturn true;\n\nfail:\n\tbt_ad_clear_service_data(client->data);\n\treturn false;\n}",
    "includes": [
      "#include \"advertising.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/mgmt.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"eir.h\"",
      "#include \"log.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"adapter.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <gdbus/gdbus.h>",
      "#include <dbus/dbus.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <stdint.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "bt_ad_clear_service_data",
          "args": [
            "client->data"
          ],
          "line": 433
        },
        "resolved": true,
        "details": {
          "function_name": "bt_ad_clear_service_data",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
          "lines": "807-813",
          "snippet": "void bt_ad_clear_service_data(struct bt_ad *ad)\n{\n\tif (!ad)\n\t\treturn;\n\n\tqueue_remove_all(ad->service_data, NULL, NULL, uuid_destroy);\n}",
          "includes": [
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/eir.h\"",
            "#include \"src/shared/ad.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nvoid bt_ad_clear_service_data(struct bt_ad *ad)\n{\n\tif (!ad)\n\t\treturn;\n\n\tqueue_remove_all(ad->service_data, NULL, NULL, uuid_destroy);\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_next",
          "args": [
            "&entries"
          ],
          "line": 427
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bt_ad_add_service_data",
          "args": [
            "client->data",
            "&uuid",
            "service_data",
            "len"
          ],
          "line": 423
        },
        "resolved": true,
        "details": {
          "function_name": "bt_ad_add_service_data",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
          "lines": "712-753",
          "snippet": "bool bt_ad_add_service_data(struct bt_ad *ad, const bt_uuid_t *uuid, void *data,\n\t\t\t\t\t\t\t\tsize_t len)\n{\n\tstruct bt_ad_service_data *new_data;\n\n\tif (!ad)\n\t\treturn false;\n\n\tif (len > (MAX_ADV_DATA_LEN - 2 - (size_t)bt_uuid_len(uuid)))\n\t\treturn false;\n\n\tnew_data = queue_find(ad->service_data, service_uuid_match, uuid);\n\tif (new_data) {\n\t\tif (new_data->len == len && !memcmp(new_data->data, data, len))\n\t\t\treturn false;\n\t\tnew_data->data = realloc(new_data->data, len);\n\t\tmemcpy(new_data->data, data, len);\n\t\tnew_data->len = len;\n\t\treturn true;\n\t}\n\n\tnew_data = new0(struct bt_ad_service_data, 1);\n\n\tnew_data->uuid = *uuid;\n\n\tnew_data->data = malloc(len);\n\tif (!new_data->data) {\n\t\tfree(new_data);\n\t\treturn false;\n\t}\n\n\tmemcpy(new_data->data, data, len);\n\n\tnew_data->len = len;\n\n\tif (queue_push_tail(ad->service_data, new_data))\n\t\treturn true;\n\n\tuuid_destroy(new_data);\n\n\treturn false;\n}",
          "includes": [
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/eir.h\"",
            "#include \"src/shared/ad.h\""
          ],
          "macros_used": [
            "#define MAX_ADV_DATA_LEN 31"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\n#define MAX_ADV_DATA_LEN 31\n\nbool bt_ad_add_service_data(struct bt_ad *ad, const bt_uuid_t *uuid, void *data,\n\t\t\t\t\t\t\t\tsize_t len)\n{\n\tstruct bt_ad_service_data *new_data;\n\n\tif (!ad)\n\t\treturn false;\n\n\tif (len > (MAX_ADV_DATA_LEN - 2 - (size_t)bt_uuid_len(uuid)))\n\t\treturn false;\n\n\tnew_data = queue_find(ad->service_data, service_uuid_match, uuid);\n\tif (new_data) {\n\t\tif (new_data->len == len && !memcmp(new_data->data, data, len))\n\t\t\treturn false;\n\t\tnew_data->data = realloc(new_data->data, len);\n\t\tmemcpy(new_data->data, data, len);\n\t\tnew_data->len = len;\n\t\treturn true;\n\t}\n\n\tnew_data = new0(struct bt_ad_service_data, 1);\n\n\tnew_data->uuid = *uuid;\n\n\tnew_data->data = malloc(len);\n\tif (!new_data->data) {\n\t\tfree(new_data);\n\t\treturn false;\n\t}\n\n\tmemcpy(new_data->data, data, len);\n\n\tnew_data->len = len;\n\n\tif (queue_push_tail(ad->service_data, new_data))\n\t\treturn true;\n\n\tuuid_destroy(new_data);\n\n\treturn false;\n}"
        }
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"Adding ServiceData for %s\"",
            "uuid_str"
          ],
          "line": 421
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_get_fixed_array",
          "args": [
            "&array",
            "&service_data",
            "&len"
          ],
          "line": 419
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_get_arg_type",
          "args": [
            "&array"
          ],
          "line": 416
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_recurse",
          "args": [
            "&value",
            "&array"
          ],
          "line": 414
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_get_arg_type",
          "args": [
            "&value"
          ],
          "line": 411
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_recurse",
          "args": [
            "&entry",
            "&value"
          ],
          "line": 409
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_get_arg_type",
          "args": [
            "&entry"
          ],
          "line": 406
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_next",
          "args": [
            "&entry"
          ],
          "line": 404
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bt_string_to_uuid",
          "args": [
            "&uuid",
            "uuid_str"
          ],
          "line": 401
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_get_basic",
          "args": [
            "&entry",
            "&uuid_str"
          ],
          "line": 399
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_recurse",
          "args": [
            "&entries",
            "&entry"
          ],
          "line": 398
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_get_arg_type",
          "args": [
            "&entries"
          ],
          "line": 390
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_recurse",
          "args": [
            "iter",
            "&entries"
          ],
          "line": 386
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_get_arg_type",
          "args": [
            "iter"
          ],
          "line": 383
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"advertising.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/mgmt.h\"\n#include \"src/shared/ad.h\"\n#include \"eir.h\"\n#include \"log.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"adapter.h\"\n#include \"lib/sdp.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <gdbus/gdbus.h>\n#include <dbus/dbus.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <stdint.h>\n\nstatic bool parse_service_data(DBusMessageIter *iter,\n\t\t\t\t\tstruct btd_adv_client *client)\n{\n\tDBusMessageIter entries;\n\n\tif (!iter) {\n\t\tbt_ad_clear_service_data(client->data);\n\t\treturn true;\n\t}\n\n\tif (dbus_message_iter_get_arg_type(iter) != DBUS_TYPE_ARRAY)\n\t\treturn false;\n\n\tdbus_message_iter_recurse(iter, &entries);\n\n\tbt_ad_clear_service_data(client->data);\n\n\twhile (dbus_message_iter_get_arg_type(&entries)\n\t\t\t\t\t\t== DBUS_TYPE_DICT_ENTRY) {\n\t\tDBusMessageIter value, entry, array;\n\t\tconst char *uuid_str;\n\t\tbt_uuid_t uuid;\n\t\tuint8_t *service_data;\n\t\tint len;\n\n\t\tdbus_message_iter_recurse(&entries, &entry);\n\t\tdbus_message_iter_get_basic(&entry, &uuid_str);\n\n\t\tif (bt_string_to_uuid(&uuid, uuid_str) < 0)\n\t\t\tgoto fail;\n\n\t\tdbus_message_iter_next(&entry);\n\n\t\tif (dbus_message_iter_get_arg_type(&entry) != DBUS_TYPE_VARIANT)\n\t\t\tgoto fail;\n\n\t\tdbus_message_iter_recurse(&entry, &value);\n\n\t\tif (dbus_message_iter_get_arg_type(&value) != DBUS_TYPE_ARRAY)\n\t\t\tgoto fail;\n\n\t\tdbus_message_iter_recurse(&value, &array);\n\n\t\tif (dbus_message_iter_get_arg_type(&array) != DBUS_TYPE_BYTE)\n\t\t\tgoto fail;\n\n\t\tdbus_message_iter_get_fixed_array(&array, &service_data, &len);\n\n\t\tDBG(\"Adding ServiceData for %s\", uuid_str);\n\n\t\tif (!bt_ad_add_service_data(client->data, &uuid, service_data,\n\t\t\t\t\t\t\t\t\tlen))\n\t\t\tgoto fail;\n\n\t\tdbus_message_iter_next(&entries);\n\t}\n\n\treturn true;\n\nfail:\n\tbt_ad_clear_service_data(client->data);\n\treturn false;\n}"
  },
  {
    "function_name": "parse_manufacturer_data",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/advertising.c",
    "lines": "313-371",
    "snippet": "static bool parse_manufacturer_data(DBusMessageIter *iter,\n\t\t\t\t\tstruct btd_adv_client *client)\n{\n\tDBusMessageIter entries;\n\n\tif (!iter) {\n\t\tbt_ad_clear_manufacturer_data(client->data);\n\t\treturn true;\n\t}\n\n\tif (dbus_message_iter_get_arg_type(iter) != DBUS_TYPE_ARRAY)\n\t\treturn false;\n\n\tdbus_message_iter_recurse(iter, &entries);\n\n\tbt_ad_clear_manufacturer_data(client->data);\n\n\twhile (dbus_message_iter_get_arg_type(&entries)\n\t\t\t\t\t\t== DBUS_TYPE_DICT_ENTRY) {\n\t\tDBusMessageIter value, entry, array;\n\t\tuint16_t manuf_id;\n\t\tuint8_t *manuf_data;\n\t\tint len;\n\n\t\tdbus_message_iter_recurse(&entries, &entry);\n\t\tdbus_message_iter_get_basic(&entry, &manuf_id);\n\n\t\tdbus_message_iter_next(&entry);\n\n\t\tif (dbus_message_iter_get_arg_type(&entry) != DBUS_TYPE_VARIANT)\n\t\t\tgoto fail;\n\n\t\tdbus_message_iter_recurse(&entry, &value);\n\n\t\tif (dbus_message_iter_get_arg_type(&value) != DBUS_TYPE_ARRAY)\n\t\t\tgoto fail;\n\n\t\tdbus_message_iter_recurse(&value, &array);\n\n\t\tif (dbus_message_iter_get_arg_type(&array) != DBUS_TYPE_BYTE)\n\t\t\tgoto fail;\n\n\t\tdbus_message_iter_get_fixed_array(&array, &manuf_data, &len);\n\n\t\tDBG(\"Adding ManufacturerData for %04x\", manuf_id);\n\n\t\tif (!bt_ad_add_manufacturer_data(client->data, manuf_id,\n\t\t\t\t\t\t\tmanuf_data, len))\n\t\t\tgoto fail;\n\n\t\tdbus_message_iter_next(&entries);\n\t}\n\n\treturn true;\n\nfail:\n\tbt_ad_clear_manufacturer_data(client->data);\n\treturn false;\n}",
    "includes": [
      "#include \"advertising.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/mgmt.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"eir.h\"",
      "#include \"log.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"adapter.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <gdbus/gdbus.h>",
      "#include <dbus/dbus.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <stdint.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "bt_ad_clear_manufacturer_data",
          "args": [
            "client->data"
          ],
          "line": 369
        },
        "resolved": true,
        "details": {
          "function_name": "bt_ad_clear_manufacturer_data",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
          "lines": "671-677",
          "snippet": "void bt_ad_clear_manufacturer_data(struct bt_ad *ad)\n{\n\tif (!ad)\n\t\treturn;\n\n\tqueue_remove_all(ad->manufacturer_data, NULL, NULL, manuf_destroy);\n}",
          "includes": [
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/eir.h\"",
            "#include \"src/shared/ad.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nvoid bt_ad_clear_manufacturer_data(struct bt_ad *ad)\n{\n\tif (!ad)\n\t\treturn;\n\n\tqueue_remove_all(ad->manufacturer_data, NULL, NULL, manuf_destroy);\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_next",
          "args": [
            "&entries"
          ],
          "line": 363
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bt_ad_add_manufacturer_data",
          "args": [
            "client->data",
            "manuf_id",
            "manuf_data",
            "len"
          ],
          "line": 359
        },
        "resolved": true,
        "details": {
          "function_name": "bt_ad_add_manufacturer_data",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
          "lines": "575-616",
          "snippet": "bool bt_ad_add_manufacturer_data(struct bt_ad *ad, uint16_t manufacturer_id,\n\t\t\t\t\t\t\tvoid *data, size_t len)\n{\n\tstruct bt_ad_manufacturer_data *new_data;\n\n\tif (!ad)\n\t\treturn false;\n\n\tif (len > (MAX_ADV_DATA_LEN - 2 - sizeof(uint16_t)))\n\t\treturn false;\n\n\tnew_data = queue_find(ad->manufacturer_data, manufacturer_id_data_match,\n\t\t\t\t\t\tUINT_TO_PTR(manufacturer_id));\n\tif (new_data) {\n\t\tif (new_data->len == len && !memcmp(new_data->data, data, len))\n\t\t\treturn false;\n\t\tnew_data->data = realloc(new_data->data, len);\n\t\tmemcpy(new_data->data, data, len);\n\t\tnew_data->len = len;\n\t\treturn true;\n\t}\n\n\tnew_data = new0(struct bt_ad_manufacturer_data, 1);\n\tnew_data->manufacturer_id = manufacturer_id;\n\n\tnew_data->data = malloc(len);\n\tif (!new_data->data) {\n\t\tfree(new_data);\n\t\treturn false;\n\t}\n\n\tmemcpy(new_data->data, data, len);\n\n\tnew_data->len = len;\n\n\tif (queue_push_tail(ad->manufacturer_data, new_data))\n\t\treturn true;\n\n\tmanuf_destroy(new_data);\n\n\treturn false;\n}",
          "includes": [
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/eir.h\"",
            "#include \"src/shared/ad.h\""
          ],
          "macros_used": [
            "#define MAX_ADV_DATA_LEN 31"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\n#define MAX_ADV_DATA_LEN 31\n\nbool bt_ad_add_manufacturer_data(struct bt_ad *ad, uint16_t manufacturer_id,\n\t\t\t\t\t\t\tvoid *data, size_t len)\n{\n\tstruct bt_ad_manufacturer_data *new_data;\n\n\tif (!ad)\n\t\treturn false;\n\n\tif (len > (MAX_ADV_DATA_LEN - 2 - sizeof(uint16_t)))\n\t\treturn false;\n\n\tnew_data = queue_find(ad->manufacturer_data, manufacturer_id_data_match,\n\t\t\t\t\t\tUINT_TO_PTR(manufacturer_id));\n\tif (new_data) {\n\t\tif (new_data->len == len && !memcmp(new_data->data, data, len))\n\t\t\treturn false;\n\t\tnew_data->data = realloc(new_data->data, len);\n\t\tmemcpy(new_data->data, data, len);\n\t\tnew_data->len = len;\n\t\treturn true;\n\t}\n\n\tnew_data = new0(struct bt_ad_manufacturer_data, 1);\n\tnew_data->manufacturer_id = manufacturer_id;\n\n\tnew_data->data = malloc(len);\n\tif (!new_data->data) {\n\t\tfree(new_data);\n\t\treturn false;\n\t}\n\n\tmemcpy(new_data->data, data, len);\n\n\tnew_data->len = len;\n\n\tif (queue_push_tail(ad->manufacturer_data, new_data))\n\t\treturn true;\n\n\tmanuf_destroy(new_data);\n\n\treturn false;\n}"
        }
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"Adding ManufacturerData for %04x\"",
            "manuf_id"
          ],
          "line": 357
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_get_fixed_array",
          "args": [
            "&array",
            "&manuf_data",
            "&len"
          ],
          "line": 355
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_get_arg_type",
          "args": [
            "&array"
          ],
          "line": 352
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_recurse",
          "args": [
            "&value",
            "&array"
          ],
          "line": 350
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_get_arg_type",
          "args": [
            "&value"
          ],
          "line": 347
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_recurse",
          "args": [
            "&entry",
            "&value"
          ],
          "line": 345
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_get_arg_type",
          "args": [
            "&entry"
          ],
          "line": 342
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_next",
          "args": [
            "&entry"
          ],
          "line": 340
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_get_basic",
          "args": [
            "&entry",
            "&manuf_id"
          ],
          "line": 338
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_recurse",
          "args": [
            "&entries",
            "&entry"
          ],
          "line": 337
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_get_arg_type",
          "args": [
            "&entries"
          ],
          "line": 330
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_recurse",
          "args": [
            "iter",
            "&entries"
          ],
          "line": 326
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_get_arg_type",
          "args": [
            "iter"
          ],
          "line": 323
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"advertising.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/mgmt.h\"\n#include \"src/shared/ad.h\"\n#include \"eir.h\"\n#include \"log.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"adapter.h\"\n#include \"lib/sdp.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <gdbus/gdbus.h>\n#include <dbus/dbus.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <stdint.h>\n\nstatic bool parse_manufacturer_data(DBusMessageIter *iter,\n\t\t\t\t\tstruct btd_adv_client *client)\n{\n\tDBusMessageIter entries;\n\n\tif (!iter) {\n\t\tbt_ad_clear_manufacturer_data(client->data);\n\t\treturn true;\n\t}\n\n\tif (dbus_message_iter_get_arg_type(iter) != DBUS_TYPE_ARRAY)\n\t\treturn false;\n\n\tdbus_message_iter_recurse(iter, &entries);\n\n\tbt_ad_clear_manufacturer_data(client->data);\n\n\twhile (dbus_message_iter_get_arg_type(&entries)\n\t\t\t\t\t\t== DBUS_TYPE_DICT_ENTRY) {\n\t\tDBusMessageIter value, entry, array;\n\t\tuint16_t manuf_id;\n\t\tuint8_t *manuf_data;\n\t\tint len;\n\n\t\tdbus_message_iter_recurse(&entries, &entry);\n\t\tdbus_message_iter_get_basic(&entry, &manuf_id);\n\n\t\tdbus_message_iter_next(&entry);\n\n\t\tif (dbus_message_iter_get_arg_type(&entry) != DBUS_TYPE_VARIANT)\n\t\t\tgoto fail;\n\n\t\tdbus_message_iter_recurse(&entry, &value);\n\n\t\tif (dbus_message_iter_get_arg_type(&value) != DBUS_TYPE_ARRAY)\n\t\t\tgoto fail;\n\n\t\tdbus_message_iter_recurse(&value, &array);\n\n\t\tif (dbus_message_iter_get_arg_type(&array) != DBUS_TYPE_BYTE)\n\t\t\tgoto fail;\n\n\t\tdbus_message_iter_get_fixed_array(&array, &manuf_data, &len);\n\n\t\tDBG(\"Adding ManufacturerData for %04x\", manuf_id);\n\n\t\tif (!bt_ad_add_manufacturer_data(client->data, manuf_id,\n\t\t\t\t\t\t\tmanuf_data, len))\n\t\t\tgoto fail;\n\n\t\tdbus_message_iter_next(&entries);\n\t}\n\n\treturn true;\n\nfail:\n\tbt_ad_clear_manufacturer_data(client->data);\n\treturn false;\n}"
  },
  {
    "function_name": "parse_solicit_uuids",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/advertising.c",
    "lines": "272-311",
    "snippet": "static bool parse_solicit_uuids(DBusMessageIter *iter,\n\t\t\t\t\tstruct btd_adv_client *client)\n{\n\tDBusMessageIter ariter;\n\n\tif (!iter) {\n\t\tbt_ad_clear_solicit_uuid(client->data);\n\t\treturn true;\n\t}\n\n\tif (dbus_message_iter_get_arg_type(iter) != DBUS_TYPE_ARRAY)\n\t\treturn false;\n\n\tdbus_message_iter_recurse(iter, &ariter);\n\n\tbt_ad_clear_solicit_uuid(client->data);\n\n\twhile (dbus_message_iter_get_arg_type(&ariter) == DBUS_TYPE_STRING) {\n\t\tconst char *uuid_str;\n\t\tbt_uuid_t uuid;\n\n\t\tdbus_message_iter_get_basic(&ariter, &uuid_str);\n\n\t\tDBG(\"Adding SolicitUUID: %s\", uuid_str);\n\n\t\tif (bt_string_to_uuid(&uuid, uuid_str) < 0)\n\t\t\tgoto fail;\n\n\t\tif (!bt_ad_add_solicit_uuid(client->data, &uuid))\n\t\t\tgoto fail;\n\n\t\tdbus_message_iter_next(&ariter);\n\t}\n\n\treturn true;\n\nfail:\n\tbt_ad_clear_solicit_uuid(client->data);\n\treturn false;\n}",
    "includes": [
      "#include \"advertising.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/mgmt.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"eir.h\"",
      "#include \"log.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"adapter.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <gdbus/gdbus.h>",
      "#include <dbus/dbus.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <stdint.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "bt_ad_clear_solicit_uuid",
          "args": [
            "client->data"
          ],
          "line": 309
        },
        "resolved": true,
        "details": {
          "function_name": "bt_ad_clear_solicit_uuid",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
          "lines": "695-701",
          "snippet": "void bt_ad_clear_solicit_uuid(struct bt_ad *ad)\n{\n\tif (!ad)\n\t\treturn;\n\n\tqueue_remove_all(ad->solicit_uuids, NULL, NULL, free);\n}",
          "includes": [
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/eir.h\"",
            "#include \"src/shared/ad.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nvoid bt_ad_clear_solicit_uuid(struct bt_ad *ad)\n{\n\tif (!ad)\n\t\treturn;\n\n\tqueue_remove_all(ad->solicit_uuids, NULL, NULL, free);\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_next",
          "args": [
            "&ariter"
          ],
          "line": 303
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bt_ad_add_solicit_uuid",
          "args": [
            "client->data",
            "&uuid"
          ],
          "line": 300
        },
        "resolved": true,
        "details": {
          "function_name": "bt_ad_add_solicit_uuid",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
          "lines": "679-685",
          "snippet": "bool bt_ad_add_solicit_uuid(struct bt_ad *ad, const bt_uuid_t *uuid)\n{\n\tif (!ad)\n\t\treturn false;\n\n\treturn queue_add_uuid(ad->solicit_uuids, uuid);\n}",
          "includes": [
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/eir.h\"",
            "#include \"src/shared/ad.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nbool bt_ad_add_solicit_uuid(struct bt_ad *ad, const bt_uuid_t *uuid)\n{\n\tif (!ad)\n\t\treturn false;\n\n\treturn queue_add_uuid(ad->solicit_uuids, uuid);\n}"
        }
      },
      {
        "call_info": {
          "callee": "bt_string_to_uuid",
          "args": [
            "&uuid",
            "uuid_str"
          ],
          "line": 297
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"Adding SolicitUUID: %s\"",
            "uuid_str"
          ],
          "line": 295
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_get_basic",
          "args": [
            "&ariter",
            "&uuid_str"
          ],
          "line": 293
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_get_arg_type",
          "args": [
            "&ariter"
          ],
          "line": 289
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_recurse",
          "args": [
            "iter",
            "&ariter"
          ],
          "line": 285
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_get_arg_type",
          "args": [
            "iter"
          ],
          "line": 282
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"advertising.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/mgmt.h\"\n#include \"src/shared/ad.h\"\n#include \"eir.h\"\n#include \"log.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"adapter.h\"\n#include \"lib/sdp.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <gdbus/gdbus.h>\n#include <dbus/dbus.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <stdint.h>\n\nstatic bool parse_solicit_uuids(DBusMessageIter *iter,\n\t\t\t\t\tstruct btd_adv_client *client)\n{\n\tDBusMessageIter ariter;\n\n\tif (!iter) {\n\t\tbt_ad_clear_solicit_uuid(client->data);\n\t\treturn true;\n\t}\n\n\tif (dbus_message_iter_get_arg_type(iter) != DBUS_TYPE_ARRAY)\n\t\treturn false;\n\n\tdbus_message_iter_recurse(iter, &ariter);\n\n\tbt_ad_clear_solicit_uuid(client->data);\n\n\twhile (dbus_message_iter_get_arg_type(&ariter) == DBUS_TYPE_STRING) {\n\t\tconst char *uuid_str;\n\t\tbt_uuid_t uuid;\n\n\t\tdbus_message_iter_get_basic(&ariter, &uuid_str);\n\n\t\tDBG(\"Adding SolicitUUID: %s\", uuid_str);\n\n\t\tif (bt_string_to_uuid(&uuid, uuid_str) < 0)\n\t\t\tgoto fail;\n\n\t\tif (!bt_ad_add_solicit_uuid(client->data, &uuid))\n\t\t\tgoto fail;\n\n\t\tdbus_message_iter_next(&ariter);\n\t}\n\n\treturn true;\n\nfail:\n\tbt_ad_clear_solicit_uuid(client->data);\n\treturn false;\n}"
  },
  {
    "function_name": "parse_service_uuids",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/advertising.c",
    "lines": "231-270",
    "snippet": "static bool parse_service_uuids(DBusMessageIter *iter,\n\t\t\t\t\tstruct btd_adv_client *client)\n{\n\tDBusMessageIter ariter;\n\n\tif (!iter) {\n\t\tbt_ad_clear_service_uuid(client->data);\n\t\treturn true;\n\t}\n\n\tif (dbus_message_iter_get_arg_type(iter) != DBUS_TYPE_ARRAY)\n\t\treturn false;\n\n\tdbus_message_iter_recurse(iter, &ariter);\n\n\tbt_ad_clear_service_uuid(client->data);\n\n\twhile (dbus_message_iter_get_arg_type(&ariter) == DBUS_TYPE_STRING) {\n\t\tconst char *uuid_str;\n\t\tbt_uuid_t uuid;\n\n\t\tdbus_message_iter_get_basic(&ariter, &uuid_str);\n\n\t\tDBG(\"Adding ServiceUUID: %s\", uuid_str);\n\n\t\tif (bt_string_to_uuid(&uuid, uuid_str) < 0)\n\t\t\tgoto fail;\n\n\t\tif (!bt_ad_add_service_uuid(client->data, &uuid))\n\t\t\tgoto fail;\n\n\t\tdbus_message_iter_next(&ariter);\n\t}\n\n\treturn true;\n\nfail:\n\tbt_ad_clear_service_uuid(client->data);\n\treturn false;\n}",
    "includes": [
      "#include \"advertising.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/mgmt.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"eir.h\"",
      "#include \"log.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"adapter.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <gdbus/gdbus.h>",
      "#include <dbus/dbus.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <stdint.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "bt_ad_clear_service_uuid",
          "args": [
            "client->data"
          ],
          "line": 268
        },
        "resolved": true,
        "details": {
          "function_name": "bt_ad_clear_service_uuid",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
          "lines": "559-565",
          "snippet": "void bt_ad_clear_service_uuid(struct bt_ad *ad)\n{\n\tif (!ad)\n\t\treturn;\n\n\tqueue_remove_all(ad->service_uuids, NULL, NULL, free);\n}",
          "includes": [
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/eir.h\"",
            "#include \"src/shared/ad.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nvoid bt_ad_clear_service_uuid(struct bt_ad *ad)\n{\n\tif (!ad)\n\t\treturn;\n\n\tqueue_remove_all(ad->service_uuids, NULL, NULL, free);\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_next",
          "args": [
            "&ariter"
          ],
          "line": 262
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bt_ad_add_service_uuid",
          "args": [
            "client->data",
            "&uuid"
          ],
          "line": 259
        },
        "resolved": true,
        "details": {
          "function_name": "bt_ad_add_service_uuid",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
          "lines": "543-549",
          "snippet": "bool bt_ad_add_service_uuid(struct bt_ad *ad, const bt_uuid_t *uuid)\n{\n\tif (!ad)\n\t\treturn false;\n\n\treturn queue_add_uuid(ad->service_uuids, uuid);\n}",
          "includes": [
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/eir.h\"",
            "#include \"src/shared/ad.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nbool bt_ad_add_service_uuid(struct bt_ad *ad, const bt_uuid_t *uuid)\n{\n\tif (!ad)\n\t\treturn false;\n\n\treturn queue_add_uuid(ad->service_uuids, uuid);\n}"
        }
      },
      {
        "call_info": {
          "callee": "bt_string_to_uuid",
          "args": [
            "&uuid",
            "uuid_str"
          ],
          "line": 256
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"Adding ServiceUUID: %s\"",
            "uuid_str"
          ],
          "line": 254
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_get_basic",
          "args": [
            "&ariter",
            "&uuid_str"
          ],
          "line": 252
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_get_arg_type",
          "args": [
            "&ariter"
          ],
          "line": 248
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_recurse",
          "args": [
            "iter",
            "&ariter"
          ],
          "line": 244
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_get_arg_type",
          "args": [
            "iter"
          ],
          "line": 241
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"advertising.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/mgmt.h\"\n#include \"src/shared/ad.h\"\n#include \"eir.h\"\n#include \"log.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"adapter.h\"\n#include \"lib/sdp.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <gdbus/gdbus.h>\n#include <dbus/dbus.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <stdint.h>\n\nstatic bool parse_service_uuids(DBusMessageIter *iter,\n\t\t\t\t\tstruct btd_adv_client *client)\n{\n\tDBusMessageIter ariter;\n\n\tif (!iter) {\n\t\tbt_ad_clear_service_uuid(client->data);\n\t\treturn true;\n\t}\n\n\tif (dbus_message_iter_get_arg_type(iter) != DBUS_TYPE_ARRAY)\n\t\treturn false;\n\n\tdbus_message_iter_recurse(iter, &ariter);\n\n\tbt_ad_clear_service_uuid(client->data);\n\n\twhile (dbus_message_iter_get_arg_type(&ariter) == DBUS_TYPE_STRING) {\n\t\tconst char *uuid_str;\n\t\tbt_uuid_t uuid;\n\n\t\tdbus_message_iter_get_basic(&ariter, &uuid_str);\n\n\t\tDBG(\"Adding ServiceUUID: %s\", uuid_str);\n\n\t\tif (bt_string_to_uuid(&uuid, uuid_str) < 0)\n\t\t\tgoto fail;\n\n\t\tif (!bt_ad_add_service_uuid(client->data, &uuid))\n\t\t\tgoto fail;\n\n\t\tdbus_message_iter_next(&ariter);\n\t}\n\n\treturn true;\n\nfail:\n\tbt_ad_clear_service_uuid(client->data);\n\treturn false;\n}"
  },
  {
    "function_name": "parse_type",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/advertising.c",
    "lines": "206-229",
    "snippet": "static bool parse_type(DBusMessageIter *iter, struct btd_adv_client *client)\n{\n\tconst char *msg_type;\n\n\tif (!iter)\n\t\treturn true;\n\n\tif (dbus_message_iter_get_arg_type(iter) != DBUS_TYPE_STRING)\n\t\treturn false;\n\n\tdbus_message_iter_get_basic(iter, &msg_type);\n\n\tif (!g_strcmp0(msg_type, \"broadcast\")) {\n\t\tclient->type = AD_TYPE_BROADCAST;\n\t\treturn true;\n\t}\n\n\tif (!g_strcmp0(msg_type, \"peripheral\")) {\n\t\tclient->type = AD_TYPE_PERIPHERAL;\n\t\treturn true;\n\t}\n\n\treturn false;\n}",
    "includes": [
      "#include \"advertising.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/mgmt.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"eir.h\"",
      "#include \"log.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"adapter.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <gdbus/gdbus.h>",
      "#include <dbus/dbus.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <stdint.h>"
    ],
    "macros_used": [
      "#define AD_TYPE_PERIPHERAL 1",
      "#define AD_TYPE_BROADCAST 0"
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_strcmp0",
          "args": [
            "msg_type",
            "\"peripheral\""
          ],
          "line": 223
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_strcmp0",
          "args": [
            "msg_type",
            "\"broadcast\""
          ],
          "line": 218
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_get_basic",
          "args": [
            "iter",
            "&msg_type"
          ],
          "line": 216
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_get_arg_type",
          "args": [
            "iter"
          ],
          "line": 213
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"advertising.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/mgmt.h\"\n#include \"src/shared/ad.h\"\n#include \"eir.h\"\n#include \"log.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"adapter.h\"\n#include \"lib/sdp.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <gdbus/gdbus.h>\n#include <dbus/dbus.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <stdint.h>\n\n#define AD_TYPE_PERIPHERAL 1\n#define AD_TYPE_BROADCAST 0\n\nstatic bool parse_type(DBusMessageIter *iter, struct btd_adv_client *client)\n{\n\tconst char *msg_type;\n\n\tif (!iter)\n\t\treturn true;\n\n\tif (dbus_message_iter_get_arg_type(iter) != DBUS_TYPE_STRING)\n\t\treturn false;\n\n\tdbus_message_iter_get_basic(iter, &msg_type);\n\n\tif (!g_strcmp0(msg_type, \"broadcast\")) {\n\t\tclient->type = AD_TYPE_BROADCAST;\n\t\treturn true;\n\t}\n\n\tif (!g_strcmp0(msg_type, \"peripheral\")) {\n\t\tclient->type = AD_TYPE_PERIPHERAL;\n\t\treturn true;\n\t}\n\n\treturn false;\n}"
  },
  {
    "function_name": "client_disconnect_cb",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/advertising.c",
    "lines": "199-204",
    "snippet": "static void client_disconnect_cb(DBusConnection *conn, void *user_data)\n{\n\tDBG(\"Client disconnected\");\n\n\tclient_remove(user_data);\n}",
    "includes": [
      "#include \"advertising.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/mgmt.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"eir.h\"",
      "#include \"log.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"adapter.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <gdbus/gdbus.h>",
      "#include <dbus/dbus.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <stdint.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "client_remove",
          "args": [
            "user_data"
          ],
          "line": 203
        },
        "resolved": true,
        "details": {
          "function_name": "client_remove",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/advertising.c",
          "lines": "173-197",
          "snippet": "static void client_remove(void *data)\n{\n\tstruct btd_adv_client *client = data;\n\tstruct mgmt_cp_remove_advertising cp;\n\n\tg_dbus_client_set_disconnect_watch(client->client, NULL, NULL);\n\n\tcp.instance = client->instance;\n\n\tmgmt_send(client->manager->mgmt, MGMT_OP_REMOVE_ADVERTISING,\n\t\t\tclient->manager->mgmt_index, sizeof(cp), &cp,\n\t\t\tNULL, NULL, NULL);\n\n\tqueue_remove(client->manager->clients, client);\n\n\tg_idle_add(client_free_idle_cb, client);\n\n\tg_dbus_emit_property_changed(btd_get_dbus_connection(),\n\t\t\t\tadapter_get_path(client->manager->adapter),\n\t\t\t\tLE_ADVERTISING_MGR_IFACE, \"SupportedInstances\");\n\n\tg_dbus_emit_property_changed(btd_get_dbus_connection(),\n\t\t\t\tadapter_get_path(client->manager->adapter),\n\t\t\t\tLE_ADVERTISING_MGR_IFACE, \"ActiveInstances\");\n}",
          "includes": [
            "#include \"advertising.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"eir.h\"",
            "#include \"log.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"adapter.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <gdbus/gdbus.h>",
            "#include <dbus/dbus.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <stdint.h>"
          ],
          "macros_used": [
            "#define LE_ADVERTISING_MGR_IFACE \"org.bluez.LEAdvertisingManager1\""
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"advertising.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/mgmt.h\"\n#include \"src/shared/ad.h\"\n#include \"eir.h\"\n#include \"log.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"adapter.h\"\n#include \"lib/sdp.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <gdbus/gdbus.h>\n#include <dbus/dbus.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <stdint.h>\n\n#define LE_ADVERTISING_MGR_IFACE \"org.bluez.LEAdvertisingManager1\"\n\nstatic void client_remove(void *data)\n{\n\tstruct btd_adv_client *client = data;\n\tstruct mgmt_cp_remove_advertising cp;\n\n\tg_dbus_client_set_disconnect_watch(client->client, NULL, NULL);\n\n\tcp.instance = client->instance;\n\n\tmgmt_send(client->manager->mgmt, MGMT_OP_REMOVE_ADVERTISING,\n\t\t\tclient->manager->mgmt_index, sizeof(cp), &cp,\n\t\t\tNULL, NULL, NULL);\n\n\tqueue_remove(client->manager->clients, client);\n\n\tg_idle_add(client_free_idle_cb, client);\n\n\tg_dbus_emit_property_changed(btd_get_dbus_connection(),\n\t\t\t\tadapter_get_path(client->manager->adapter),\n\t\t\t\tLE_ADVERTISING_MGR_IFACE, \"SupportedInstances\");\n\n\tg_dbus_emit_property_changed(btd_get_dbus_connection(),\n\t\t\t\tadapter_get_path(client->manager->adapter),\n\t\t\t\tLE_ADVERTISING_MGR_IFACE, \"ActiveInstances\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"Client disconnected\""
          ],
          "line": 201
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"advertising.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/mgmt.h\"\n#include \"src/shared/ad.h\"\n#include \"eir.h\"\n#include \"log.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"adapter.h\"\n#include \"lib/sdp.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <gdbus/gdbus.h>\n#include <dbus/dbus.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <stdint.h>\n\nstatic void client_disconnect_cb(DBusConnection *conn, void *user_data)\n{\n\tDBG(\"Client disconnected\");\n\n\tclient_remove(user_data);\n}"
  },
  {
    "function_name": "client_remove",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/advertising.c",
    "lines": "173-197",
    "snippet": "static void client_remove(void *data)\n{\n\tstruct btd_adv_client *client = data;\n\tstruct mgmt_cp_remove_advertising cp;\n\n\tg_dbus_client_set_disconnect_watch(client->client, NULL, NULL);\n\n\tcp.instance = client->instance;\n\n\tmgmt_send(client->manager->mgmt, MGMT_OP_REMOVE_ADVERTISING,\n\t\t\tclient->manager->mgmt_index, sizeof(cp), &cp,\n\t\t\tNULL, NULL, NULL);\n\n\tqueue_remove(client->manager->clients, client);\n\n\tg_idle_add(client_free_idle_cb, client);\n\n\tg_dbus_emit_property_changed(btd_get_dbus_connection(),\n\t\t\t\tadapter_get_path(client->manager->adapter),\n\t\t\t\tLE_ADVERTISING_MGR_IFACE, \"SupportedInstances\");\n\n\tg_dbus_emit_property_changed(btd_get_dbus_connection(),\n\t\t\t\tadapter_get_path(client->manager->adapter),\n\t\t\t\tLE_ADVERTISING_MGR_IFACE, \"ActiveInstances\");\n}",
    "includes": [
      "#include \"advertising.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/mgmt.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"eir.h\"",
      "#include \"log.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"adapter.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <gdbus/gdbus.h>",
      "#include <dbus/dbus.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <stdint.h>"
    ],
    "macros_used": [
      "#define LE_ADVERTISING_MGR_IFACE \"org.bluez.LEAdvertisingManager1\""
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_dbus_emit_property_changed",
          "args": [
            "btd_get_dbus_connection()",
            "adapter_get_path(client->manager->adapter)",
            "LE_ADVERTISING_MGR_IFACE",
            "\"ActiveInstances\""
          ],
          "line": 194
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "adapter_get_path",
          "args": [
            "client->manager->adapter"
          ],
          "line": 195
        },
        "resolved": true,
        "details": {
          "function_name": "adapter_get_path",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "5873-5879",
          "snippet": "const char *adapter_get_path(struct btd_adapter *adapter)\n{\n\tif (!adapter)\n\t\treturn NULL;\n\n\treturn adapter->path;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void trigger_pairable_timeout(struct btd_adapter *adapter);",
            "static void adapter_start(struct btd_adapter *adapter);",
            "static void adapter_stop(struct btd_adapter *adapter);",
            "static void trigger_passive_scanning(struct btd_adapter *adapter);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void trigger_pairable_timeout(struct btd_adapter *adapter);\nstatic void adapter_start(struct btd_adapter *adapter);\nstatic void adapter_stop(struct btd_adapter *adapter);\nstatic void trigger_passive_scanning(struct btd_adapter *adapter);\n\nconst char *adapter_get_path(struct btd_adapter *adapter)\n{\n\tif (!adapter)\n\t\treturn NULL;\n\n\treturn adapter->path;\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_get_dbus_connection",
          "args": [],
          "line": 194
        },
        "resolved": true,
        "details": {
          "function_name": "btd_get_dbus_connection",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/dbus-common.c",
          "lines": "61-64",
          "snippet": "DBusConnection *btd_get_dbus_connection(void)\n{\n\treturn connection;\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <stdint.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static DBusConnection *connection = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <stdint.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *connection = NULL;\n\nDBusConnection *btd_get_dbus_connection(void)\n{\n\treturn connection;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_dbus_emit_property_changed",
          "args": [
            "btd_get_dbus_connection()",
            "adapter_get_path(client->manager->adapter)",
            "LE_ADVERTISING_MGR_IFACE",
            "\"SupportedInstances\""
          ],
          "line": 190
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_idle_add",
          "args": [
            "client_free_idle_cb",
            "client"
          ],
          "line": 188
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "queue_remove",
          "args": [
            "client->manager->clients",
            "client"
          ],
          "line": 186
        },
        "resolved": true,
        "details": {
          "function_name": "queue_remove_uuid",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
          "lines": "526-541",
          "snippet": "static bool queue_remove_uuid(struct queue *queue, bt_uuid_t *uuid)\n{\n\tbt_uuid_t *removed;\n\n\tif (!queue || !uuid)\n\t\treturn false;\n\n\tremoved = queue_remove_if(queue, uuid_match, uuid);\n\n\tif (removed) {\n\t\tfree(removed);\n\t\treturn true;\n\t}\n\n\treturn false;\n}",
          "includes": [
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/eir.h\"",
            "#include \"src/shared/ad.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nstatic bool queue_remove_uuid(struct queue *queue, bt_uuid_t *uuid)\n{\n\tbt_uuid_t *removed;\n\n\tif (!queue || !uuid)\n\t\treturn false;\n\n\tremoved = queue_remove_if(queue, uuid_match, uuid);\n\n\tif (removed) {\n\t\tfree(removed);\n\t\treturn true;\n\t}\n\n\treturn false;\n}"
        }
      },
      {
        "call_info": {
          "callee": "mgmt_send",
          "args": [
            "client->manager->mgmt",
            "MGMT_OP_REMOVE_ADVERTISING",
            "client->manager->mgmt_index",
            "sizeof(cp)",
            "&cp",
            "NULL",
            "NULL",
            "NULL"
          ],
          "line": 182
        },
        "resolved": true,
        "details": {
          "function_name": "mgmt_send_nowait",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/mgmt.c",
          "lines": "605-629",
          "snippet": "unsigned int mgmt_send_nowait(struct mgmt *mgmt, uint16_t opcode, uint16_t index,\n\t\t\t\tuint16_t length, const void *param,\n\t\t\t\tmgmt_request_func_t callback,\n\t\t\t\tvoid *user_data, mgmt_destroy_func_t destroy)\n{\n\tstruct mgmt_request *request;\n\n\tif (!mgmt)\n\t\treturn 0;\n\n\trequest = create_request(opcode, index, length, param,\n\t\t\t\t\tcallback, user_data, destroy);\n\tif (!request)\n\t\treturn 0;\n\n\tif (mgmt->next_request_id < 1)\n\t\tmgmt->next_request_id = 1;\n\n\trequest->id = mgmt->next_request_id++;\n\n\tif (!send_request(mgmt, request))\n\t\treturn 0;\n\n\treturn request->id;\n}",
          "includes": [
            "#include \"src/shared/mgmt.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"lib/hci.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/mgmt.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"lib/hci.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nunsigned int mgmt_send_nowait(struct mgmt *mgmt, uint16_t opcode, uint16_t index,\n\t\t\t\tuint16_t length, const void *param,\n\t\t\t\tmgmt_request_func_t callback,\n\t\t\t\tvoid *user_data, mgmt_destroy_func_t destroy)\n{\n\tstruct mgmt_request *request;\n\n\tif (!mgmt)\n\t\treturn 0;\n\n\trequest = create_request(opcode, index, length, param,\n\t\t\t\t\tcallback, user_data, destroy);\n\tif (!request)\n\t\treturn 0;\n\n\tif (mgmt->next_request_id < 1)\n\t\tmgmt->next_request_id = 1;\n\n\trequest->id = mgmt->next_request_id++;\n\n\tif (!send_request(mgmt, request))\n\t\treturn 0;\n\n\treturn request->id;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_dbus_client_set_disconnect_watch",
          "args": [
            "client->client",
            "NULL",
            "NULL"
          ],
          "line": 178
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"advertising.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/mgmt.h\"\n#include \"src/shared/ad.h\"\n#include \"eir.h\"\n#include \"log.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"adapter.h\"\n#include \"lib/sdp.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <gdbus/gdbus.h>\n#include <dbus/dbus.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <stdint.h>\n\n#define LE_ADVERTISING_MGR_IFACE \"org.bluez.LEAdvertisingManager1\"\n\nstatic void client_remove(void *data)\n{\n\tstruct btd_adv_client *client = data;\n\tstruct mgmt_cp_remove_advertising cp;\n\n\tg_dbus_client_set_disconnect_watch(client->client, NULL, NULL);\n\n\tcp.instance = client->instance;\n\n\tmgmt_send(client->manager->mgmt, MGMT_OP_REMOVE_ADVERTISING,\n\t\t\tclient->manager->mgmt_index, sizeof(cp), &cp,\n\t\t\tNULL, NULL, NULL);\n\n\tqueue_remove(client->manager->clients, client);\n\n\tg_idle_add(client_free_idle_cb, client);\n\n\tg_dbus_emit_property_changed(btd_get_dbus_connection(),\n\t\t\t\tadapter_get_path(client->manager->adapter),\n\t\t\t\tLE_ADVERTISING_MGR_IFACE, \"SupportedInstances\");\n\n\tg_dbus_emit_property_changed(btd_get_dbus_connection(),\n\t\t\t\tadapter_get_path(client->manager->adapter),\n\t\t\t\tLE_ADVERTISING_MGR_IFACE, \"ActiveInstances\");\n}"
  },
  {
    "function_name": "remove_advertising",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/advertising.c",
    "lines": "157-171",
    "snippet": "static void remove_advertising(struct btd_adv_manager *manager,\n\t\t\t\t\t\tuint8_t instance)\n{\n\tstruct mgmt_cp_remove_advertising cp;\n\n\tif (instance)\n\t\tDBG(\"instance %u\", instance);\n\telse\n\t\tDBG(\"all instances\");\n\n\tcp.instance = instance;\n\n\tmgmt_send(manager->mgmt, MGMT_OP_REMOVE_ADVERTISING,\n\t\t\tmanager->mgmt_index, sizeof(cp), &cp, NULL, NULL, NULL);\n}",
    "includes": [
      "#include \"advertising.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/mgmt.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"eir.h\"",
      "#include \"log.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"adapter.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <gdbus/gdbus.h>",
      "#include <dbus/dbus.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <stdint.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "mgmt_send",
          "args": [
            "manager->mgmt",
            "MGMT_OP_REMOVE_ADVERTISING",
            "manager->mgmt_index",
            "sizeof(cp)",
            "&cp",
            "NULL",
            "NULL",
            "NULL"
          ],
          "line": 169
        },
        "resolved": true,
        "details": {
          "function_name": "mgmt_send_nowait",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/mgmt.c",
          "lines": "605-629",
          "snippet": "unsigned int mgmt_send_nowait(struct mgmt *mgmt, uint16_t opcode, uint16_t index,\n\t\t\t\tuint16_t length, const void *param,\n\t\t\t\tmgmt_request_func_t callback,\n\t\t\t\tvoid *user_data, mgmt_destroy_func_t destroy)\n{\n\tstruct mgmt_request *request;\n\n\tif (!mgmt)\n\t\treturn 0;\n\n\trequest = create_request(opcode, index, length, param,\n\t\t\t\t\tcallback, user_data, destroy);\n\tif (!request)\n\t\treturn 0;\n\n\tif (mgmt->next_request_id < 1)\n\t\tmgmt->next_request_id = 1;\n\n\trequest->id = mgmt->next_request_id++;\n\n\tif (!send_request(mgmt, request))\n\t\treturn 0;\n\n\treturn request->id;\n}",
          "includes": [
            "#include \"src/shared/mgmt.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"lib/hci.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/mgmt.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"lib/hci.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nunsigned int mgmt_send_nowait(struct mgmt *mgmt, uint16_t opcode, uint16_t index,\n\t\t\t\tuint16_t length, const void *param,\n\t\t\t\tmgmt_request_func_t callback,\n\t\t\t\tvoid *user_data, mgmt_destroy_func_t destroy)\n{\n\tstruct mgmt_request *request;\n\n\tif (!mgmt)\n\t\treturn 0;\n\n\trequest = create_request(opcode, index, length, param,\n\t\t\t\t\tcallback, user_data, destroy);\n\tif (!request)\n\t\treturn 0;\n\n\tif (mgmt->next_request_id < 1)\n\t\tmgmt->next_request_id = 1;\n\n\trequest->id = mgmt->next_request_id++;\n\n\tif (!send_request(mgmt, request))\n\t\treturn 0;\n\n\treturn request->id;\n}"
        }
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"all instances\""
          ],
          "line": 165
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"instance %u\"",
            "instance"
          ],
          "line": 163
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"advertising.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/mgmt.h\"\n#include \"src/shared/ad.h\"\n#include \"eir.h\"\n#include \"log.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"adapter.h\"\n#include \"lib/sdp.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <gdbus/gdbus.h>\n#include <dbus/dbus.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <stdint.h>\n\nstatic void remove_advertising(struct btd_adv_manager *manager,\n\t\t\t\t\t\tuint8_t instance)\n{\n\tstruct mgmt_cp_remove_advertising cp;\n\n\tif (instance)\n\t\tDBG(\"instance %u\", instance);\n\telse\n\t\tDBG(\"all instances\");\n\n\tcp.instance = instance;\n\n\tmgmt_send(manager->mgmt, MGMT_OP_REMOVE_ADVERTISING,\n\t\t\tmanager->mgmt_index, sizeof(cp), &cp, NULL, NULL, NULL);\n}"
  },
  {
    "function_name": "client_destroy",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/advertising.c",
    "lines": "151-155",
    "snippet": "static void client_destroy(void *data)\n{\n\tclient_release(data);\n\tclient_free(data);\n}",
    "includes": [
      "#include \"advertising.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/mgmt.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"eir.h\"",
      "#include \"log.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"adapter.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <gdbus/gdbus.h>",
      "#include <dbus/dbus.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <stdint.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "client_free",
          "args": [
            "data"
          ],
          "line": 154
        },
        "resolved": true,
        "details": {
          "function_name": "client_free_idle_cb",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/advertising.c",
          "lines": "134-139",
          "snippet": "static gboolean client_free_idle_cb(void *data)\n{\n\tclient_free(data);\n\n\treturn FALSE;\n}",
          "includes": [
            "#include \"advertising.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"eir.h\"",
            "#include \"log.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"adapter.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <gdbus/gdbus.h>",
            "#include <dbus/dbus.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <stdint.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"advertising.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/mgmt.h\"\n#include \"src/shared/ad.h\"\n#include \"eir.h\"\n#include \"log.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"adapter.h\"\n#include \"lib/sdp.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <gdbus/gdbus.h>\n#include <dbus/dbus.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <stdint.h>\n\nstatic gboolean client_free_idle_cb(void *data)\n{\n\tclient_free(data);\n\n\treturn FALSE;\n}"
        }
      },
      {
        "call_info": {
          "callee": "client_release",
          "args": [
            "data"
          ],
          "line": 153
        },
        "resolved": true,
        "details": {
          "function_name": "client_release",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/advertising.c",
          "lines": "141-149",
          "snippet": "static void client_release(void *data)\n{\n\tstruct btd_adv_client *client = data;\n\n\tDBG(\"Releasing advertisement %s, %s\", client->owner, client->path);\n\n\tg_dbus_proxy_method_call(client->proxy, \"Release\", NULL, NULL, NULL,\n\t\t\t\t\t\t\t\t\tNULL);\n}",
          "includes": [
            "#include \"advertising.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"eir.h\"",
            "#include \"log.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"adapter.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <gdbus/gdbus.h>",
            "#include <dbus/dbus.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <stdint.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"advertising.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/mgmt.h\"\n#include \"src/shared/ad.h\"\n#include \"eir.h\"\n#include \"log.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"adapter.h\"\n#include \"lib/sdp.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <gdbus/gdbus.h>\n#include <dbus/dbus.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <stdint.h>\n\nstatic void client_release(void *data)\n{\n\tstruct btd_adv_client *client = data;\n\n\tDBG(\"Releasing advertisement %s, %s\", client->owner, client->path);\n\n\tg_dbus_proxy_method_call(client->proxy, \"Release\", NULL, NULL, NULL,\n\t\t\t\t\t\t\t\t\tNULL);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"advertising.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/mgmt.h\"\n#include \"src/shared/ad.h\"\n#include \"eir.h\"\n#include \"log.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"adapter.h\"\n#include \"lib/sdp.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <gdbus/gdbus.h>\n#include <dbus/dbus.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <stdint.h>\n\nstatic void client_destroy(void *data)\n{\n\tclient_release(data);\n\tclient_free(data);\n}"
  },
  {
    "function_name": "client_release",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/advertising.c",
    "lines": "141-149",
    "snippet": "static void client_release(void *data)\n{\n\tstruct btd_adv_client *client = data;\n\n\tDBG(\"Releasing advertisement %s, %s\", client->owner, client->path);\n\n\tg_dbus_proxy_method_call(client->proxy, \"Release\", NULL, NULL, NULL,\n\t\t\t\t\t\t\t\t\tNULL);\n}",
    "includes": [
      "#include \"advertising.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/mgmt.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"eir.h\"",
      "#include \"log.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"adapter.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <gdbus/gdbus.h>",
      "#include <dbus/dbus.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <stdint.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_dbus_proxy_method_call",
          "args": [
            "client->proxy",
            "\"Release\"",
            "NULL",
            "NULL",
            "NULL",
            "NULL"
          ],
          "line": 147
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"Releasing advertisement %s, %s\"",
            "client->owner",
            "client->path"
          ],
          "line": 145
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"advertising.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/mgmt.h\"\n#include \"src/shared/ad.h\"\n#include \"eir.h\"\n#include \"log.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"adapter.h\"\n#include \"lib/sdp.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <gdbus/gdbus.h>\n#include <dbus/dbus.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <stdint.h>\n\nstatic void client_release(void *data)\n{\n\tstruct btd_adv_client *client = data;\n\n\tDBG(\"Releasing advertisement %s, %s\", client->owner, client->path);\n\n\tg_dbus_proxy_method_call(client->proxy, \"Release\", NULL, NULL, NULL,\n\t\t\t\t\t\t\t\t\tNULL);\n}"
  },
  {
    "function_name": "client_free_idle_cb",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/advertising.c",
    "lines": "134-139",
    "snippet": "static gboolean client_free_idle_cb(void *data)\n{\n\tclient_free(data);\n\n\treturn FALSE;\n}",
    "includes": [
      "#include \"advertising.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/mgmt.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"eir.h\"",
      "#include \"log.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"adapter.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <gdbus/gdbus.h>",
      "#include <dbus/dbus.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <stdint.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "client_free",
          "args": [
            "data"
          ],
          "line": 136
        },
        "resolved": true,
        "details": {
          "function_name": "client_free_idle_cb",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/advertising.c",
          "lines": "134-139",
          "snippet": "static gboolean client_free_idle_cb(void *data)\n{\n\tclient_free(data);\n\n\treturn FALSE;\n}",
          "note": "cyclic_reference_detected"
        }
      }
    ],
    "contextual_snippet": "#include \"advertising.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/mgmt.h\"\n#include \"src/shared/ad.h\"\n#include \"eir.h\"\n#include \"log.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"adapter.h\"\n#include \"lib/sdp.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <gdbus/gdbus.h>\n#include <dbus/dbus.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <stdint.h>\n\nstatic gboolean client_free_idle_cb(void *data)\n{\n\tclient_free(data);\n\n\treturn FALSE;\n}"
  },
  {
    "function_name": "client_free",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/advertising.c",
    "lines": "100-132",
    "snippet": "static void client_free(void *data)\n{\n\tstruct btd_adv_client *client = data;\n\n\tif (client->to_id > 0)\n\t\tg_source_remove(client->to_id);\n\n\tif (client->disc_to_id > 0)\n\t\tg_source_remove(client->disc_to_id);\n\n\tif (client->client) {\n\t\tg_dbus_client_set_disconnect_watch(client->client, NULL, NULL);\n\t\tg_dbus_client_unref(client->client);\n\t}\n\n\tif (client->instance)\n\t\tutil_clear_uid(&client->manager->instance_bitmap,\n\t\t\t\t\t\tclient->instance);\n\n\tbt_ad_unref(client->data);\n\tbt_ad_unref(client->scan);\n\n\tg_dbus_proxy_unref(client->proxy);\n\n\tif (client->owner)\n\t\tg_free(client->owner);\n\n\tif (client->path)\n\t\tg_free(client->path);\n\n\tfree(client->name);\n\tfree(client);\n}",
    "includes": [
      "#include \"advertising.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/mgmt.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"eir.h\"",
      "#include \"log.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"adapter.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <gdbus/gdbus.h>",
      "#include <dbus/dbus.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <stdint.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "client"
          ],
          "line": 131
        },
        "resolved": true,
        "details": {
          "function_name": "client_free_idle_cb",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/advertising.c",
          "lines": "134-139",
          "snippet": "static gboolean client_free_idle_cb(void *data)\n{\n\tclient_free(data);\n\n\treturn FALSE;\n}",
          "includes": [
            "#include \"advertising.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"eir.h\"",
            "#include \"log.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"adapter.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <gdbus/gdbus.h>",
            "#include <dbus/dbus.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <stdint.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"advertising.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/mgmt.h\"\n#include \"src/shared/ad.h\"\n#include \"eir.h\"\n#include \"log.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"adapter.h\"\n#include \"lib/sdp.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <gdbus/gdbus.h>\n#include <dbus/dbus.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <stdint.h>\n\nstatic gboolean client_free_idle_cb(void *data)\n{\n\tclient_free(data);\n\n\treturn FALSE;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_free",
          "args": [
            "client->path"
          ],
          "line": 128
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_free",
          "args": [
            "client->owner"
          ],
          "line": 125
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_dbus_proxy_unref",
          "args": [
            "client->proxy"
          ],
          "line": 122
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bt_ad_unref",
          "args": [
            "client->scan"
          ],
          "line": 120
        },
        "resolved": true,
        "details": {
          "function_name": "bt_ad_unref",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
          "lines": "107-128",
          "snippet": "void bt_ad_unref(struct bt_ad *ad)\n{\n\tif (!ad)\n\t\treturn;\n\n\tif (__sync_sub_and_fetch(&ad->ref_count, 1))\n\t\treturn;\n\n\tqueue_destroy(ad->service_uuids, free);\n\n\tqueue_destroy(ad->manufacturer_data, manuf_destroy);\n\n\tqueue_destroy(ad->solicit_uuids, free);\n\n\tqueue_destroy(ad->service_data, uuid_destroy);\n\n\tqueue_destroy(ad->data, data_destroy);\n\n\tfree(ad->name);\n\n\tfree(ad);\n}",
          "includes": [
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/eir.h\"",
            "#include \"src/shared/ad.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nvoid bt_ad_unref(struct bt_ad *ad)\n{\n\tif (!ad)\n\t\treturn;\n\n\tif (__sync_sub_and_fetch(&ad->ref_count, 1))\n\t\treturn;\n\n\tqueue_destroy(ad->service_uuids, free);\n\n\tqueue_destroy(ad->manufacturer_data, manuf_destroy);\n\n\tqueue_destroy(ad->solicit_uuids, free);\n\n\tqueue_destroy(ad->service_data, uuid_destroy);\n\n\tqueue_destroy(ad->data, data_destroy);\n\n\tfree(ad->name);\n\n\tfree(ad);\n}"
        }
      },
      {
        "call_info": {
          "callee": "util_clear_uid",
          "args": [
            "&client->manager->instance_bitmap",
            "client->instance"
          ],
          "line": 116
        },
        "resolved": true,
        "details": {
          "function_name": "util_clear_uid",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/util.c",
          "lines": "148-154",
          "snippet": "void util_clear_uid(unsigned int *bitmap, uint8_t id)\n{\n\tif (!id)\n\t\treturn;\n\n\t*bitmap &= ~(1 << (id - 1));\n}",
          "includes": [
            "#include \"src/shared/util.h\"",
            "#include <string.h>",
            "#include <limits.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <stdbool.h>",
            "#include <stdarg.h>",
            "#include <ctype.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/util.h\"\n#include <string.h>\n#include <limits.h>\n#include <dirent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <config.h>\n\nvoid util_clear_uid(unsigned int *bitmap, uint8_t id)\n{\n\tif (!id)\n\t\treturn;\n\n\t*bitmap &= ~(1 << (id - 1));\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_dbus_client_unref",
          "args": [
            "client->client"
          ],
          "line": 112
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_dbus_client_set_disconnect_watch",
          "args": [
            "client->client",
            "NULL",
            "NULL"
          ],
          "line": 111
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_source_remove",
          "args": [
            "client->disc_to_id"
          ],
          "line": 108
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_source_remove",
          "args": [
            "client->to_id"
          ],
          "line": 105
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"advertising.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/mgmt.h\"\n#include \"src/shared/ad.h\"\n#include \"eir.h\"\n#include \"log.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"adapter.h\"\n#include \"lib/sdp.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <gdbus/gdbus.h>\n#include <dbus/dbus.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <stdint.h>\n\nstatic void client_free(void *data)\n{\n\tstruct btd_adv_client *client = data;\n\n\tif (client->to_id > 0)\n\t\tg_source_remove(client->to_id);\n\n\tif (client->disc_to_id > 0)\n\t\tg_source_remove(client->disc_to_id);\n\n\tif (client->client) {\n\t\tg_dbus_client_set_disconnect_watch(client->client, NULL, NULL);\n\t\tg_dbus_client_unref(client->client);\n\t}\n\n\tif (client->instance)\n\t\tutil_clear_uid(&client->manager->instance_bitmap,\n\t\t\t\t\t\tclient->instance);\n\n\tbt_ad_unref(client->data);\n\tbt_ad_unref(client->scan);\n\n\tg_dbus_proxy_unref(client->proxy);\n\n\tif (client->owner)\n\t\tg_free(client->owner);\n\n\tif (client->path)\n\t\tg_free(client->path);\n\n\tfree(client->name);\n\tfree(client);\n}"
  },
  {
    "function_name": "match_client",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/advertising.c",
    "lines": "86-98",
    "snippet": "static bool match_client(const void *a, const void *b)\n{\n\tconst struct btd_adv_client *client = a;\n\tconst struct dbus_obj_match *match = b;\n\n\tif (match->owner && g_strcmp0(client->owner, match->owner))\n\t\treturn false;\n\n\tif (match->path && g_strcmp0(client->path, match->path))\n\t\treturn false;\n\n\treturn true;\n}",
    "includes": [
      "#include \"advertising.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/mgmt.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"eir.h\"",
      "#include \"log.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"adapter.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <gdbus/gdbus.h>",
      "#include <dbus/dbus.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <stdint.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_strcmp0",
          "args": [
            "client->path",
            "match->path"
          ],
          "line": 94
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_strcmp0",
          "args": [
            "client->owner",
            "match->owner"
          ],
          "line": 91
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"advertising.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/mgmt.h\"\n#include \"src/shared/ad.h\"\n#include \"eir.h\"\n#include \"log.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"adapter.h\"\n#include \"lib/sdp.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <gdbus/gdbus.h>\n#include <dbus/dbus.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <stdint.h>\n\nstatic bool match_client(const void *a, const void *b)\n{\n\tconst struct btd_adv_client *client = a;\n\tconst struct dbus_obj_match *match = b;\n\n\tif (match->owner && g_strcmp0(client->owner, match->owner))\n\t\treturn false;\n\n\tif (match->path && g_strcmp0(client->path, match->path))\n\t\treturn false;\n\n\treturn true;\n}"
  }
]