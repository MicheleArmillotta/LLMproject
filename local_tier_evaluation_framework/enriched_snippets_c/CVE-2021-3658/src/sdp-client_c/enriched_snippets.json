[
  {
    "function_name": "bt_clear_cached_session",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/sdp-client.c",
    "lines": "406-413",
    "snippet": "void bt_clear_cached_session(const bdaddr_t *src, const bdaddr_t *dst)\n{\n\tsdp_session_t *session;\n\n\tsession = get_cached_sdp_session(src, dst);\n\tif (session)\n\t\tsdp_close(session);\n}",
    "includes": [
      "#include \"sdp-client.h\"",
      "#include \"log.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <glib.h>",
      "#include <errno.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "sdp_close",
          "args": [
            "session"
          ],
          "line": 412
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "get_cached_sdp_session",
          "args": [
            "src",
            "dst"
          ],
          "line": 410
        },
        "resolved": true,
        "details": {
          "function_name": "get_cached_sdp_session",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/sdp-client.c",
          "lines": "70-94",
          "snippet": "static sdp_session_t *get_cached_sdp_session(const bdaddr_t *src,\n\t\t\t\t\t\t\tconst bdaddr_t *dst)\n{\n\tGSList *l;\n\n\tfor (l = cached_sdp_sessions; l != NULL; l = l->next) {\n\t\tstruct cached_sdp_session *c = l->data;\n\t\tsdp_session_t *session;\n\n\t\tif (bacmp(&c->src, src) || bacmp(&c->dst, dst))\n\t\t\tcontinue;\n\n\t\tg_source_remove(c->timer);\n\t\tg_source_remove(c->io_id);\n\n\t\tsession = c->session;\n\n\t\tcached_sdp_sessions = g_slist_remove(cached_sdp_sessions, c);\n\t\tg_free(c);\n\n\t\treturn session;\n\t}\n\n\treturn NULL;\n}",
          "includes": [
            "#include \"sdp-client.h\"",
            "#include \"log.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static GSList *cached_sdp_sessions = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"sdp-client.h\"\n#include \"log.h\"\n#include \"btio/btio.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <errno.h>\n#include <config.h>\n\nstatic GSList *cached_sdp_sessions = NULL;\n\nstatic sdp_session_t *get_cached_sdp_session(const bdaddr_t *src,\n\t\t\t\t\t\t\tconst bdaddr_t *dst)\n{\n\tGSList *l;\n\n\tfor (l = cached_sdp_sessions; l != NULL; l = l->next) {\n\t\tstruct cached_sdp_session *c = l->data;\n\t\tsdp_session_t *session;\n\n\t\tif (bacmp(&c->src, src) || bacmp(&c->dst, dst))\n\t\t\tcontinue;\n\n\t\tg_source_remove(c->timer);\n\t\tg_source_remove(c->io_id);\n\n\t\tsession = c->session;\n\n\t\tcached_sdp_sessions = g_slist_remove(cached_sdp_sessions, c);\n\t\tg_free(c);\n\n\t\treturn session;\n\t}\n\n\treturn NULL;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"sdp-client.h\"\n#include \"log.h\"\n#include \"btio/btio.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <errno.h>\n#include <config.h>\n\nvoid bt_clear_cached_session(const bdaddr_t *src, const bdaddr_t *dst)\n{\n\tsdp_session_t *session;\n\n\tsession = get_cached_sdp_session(src, dst);\n\tif (session)\n\t\tsdp_close(session);\n}"
  },
  {
    "function_name": "bt_cancel_discovery",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/sdp-client.c",
    "lines": "376-404",
    "snippet": "int bt_cancel_discovery(const bdaddr_t *src, const bdaddr_t *dst)\n{\n\tstruct search_context match, *ctxt;\n\tGSList *l;\n\n\tmemset(&match, 0, sizeof(match));\n\tbacpy(&match.src, src);\n\tbacpy(&match.dst, dst);\n\n\t/* Ongoing SDP Discovery */\n\tl = g_slist_find_custom(context_list, &match, find_by_bdaddr);\n\tif (l == NULL)\n\t\treturn -ENOENT;\n\n\tctxt = l->data;\n\n\tif (!ctxt->session)\n\t\treturn -ENOTCONN;\n\n\tif (ctxt->io_id)\n\t\tg_source_remove(ctxt->io_id);\n\n\tif (ctxt->session)\n\t\tsdp_close(ctxt->session);\n\n\tsearch_context_cleanup(ctxt);\n\n\treturn 0;\n}",
    "includes": [
      "#include \"sdp-client.h\"",
      "#include \"log.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <glib.h>",
      "#include <errno.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static GSList *context_list = NULL;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "search_context_cleanup",
          "args": [
            "ctxt"
          ],
          "line": 401
        },
        "resolved": true,
        "details": {
          "function_name": "search_context_cleanup",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/sdp-client.c",
          "lines": "150-158",
          "snippet": "static void search_context_cleanup(struct search_context *ctxt)\n{\n\tcontext_list = g_slist_remove(context_list, ctxt);\n\n\tif (ctxt->destroy)\n\t\tctxt->destroy(ctxt->user_data);\n\n\tg_free(ctxt);\n}",
          "includes": [
            "#include \"sdp-client.h\"",
            "#include \"log.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static GSList *context_list = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"sdp-client.h\"\n#include \"log.h\"\n#include \"btio/btio.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <errno.h>\n#include <config.h>\n\nstatic GSList *context_list = NULL;\n\nstatic void search_context_cleanup(struct search_context *ctxt)\n{\n\tcontext_list = g_slist_remove(context_list, ctxt);\n\n\tif (ctxt->destroy)\n\t\tctxt->destroy(ctxt->user_data);\n\n\tg_free(ctxt);\n}"
        }
      },
      {
        "call_info": {
          "callee": "sdp_close",
          "args": [
            "ctxt->session"
          ],
          "line": 399
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_source_remove",
          "args": [
            "ctxt->io_id"
          ],
          "line": 396
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_slist_find_custom",
          "args": [
            "context_list",
            "&match",
            "find_by_bdaddr"
          ],
          "line": 386
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bacpy",
          "args": [
            "&match.dst",
            "dst"
          ],
          "line": 383
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bacpy",
          "args": [
            "&match.src",
            "src"
          ],
          "line": 382
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memset",
          "args": [
            "&match",
            "0",
            "sizeof(match)"
          ],
          "line": 381
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"sdp-client.h\"\n#include \"log.h\"\n#include \"btio/btio.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <errno.h>\n#include <config.h>\n\nstatic GSList *context_list = NULL;\n\nint bt_cancel_discovery(const bdaddr_t *src, const bdaddr_t *dst)\n{\n\tstruct search_context match, *ctxt;\n\tGSList *l;\n\n\tmemset(&match, 0, sizeof(match));\n\tbacpy(&match.src, src);\n\tbacpy(&match.dst, dst);\n\n\t/* Ongoing SDP Discovery */\n\tl = g_slist_find_custom(context_list, &match, find_by_bdaddr);\n\tif (l == NULL)\n\t\treturn -ENOENT;\n\n\tctxt = l->data;\n\n\tif (!ctxt->session)\n\t\treturn -ENOTCONN;\n\n\tif (ctxt->io_id)\n\t\tg_source_remove(ctxt->io_id);\n\n\tif (ctxt->session)\n\t\tsdp_close(ctxt->session);\n\n\tsearch_context_cleanup(ctxt);\n\n\treturn 0;\n}"
  },
  {
    "function_name": "find_by_bdaddr",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/sdp-client.c",
    "lines": "364-374",
    "snippet": "static int find_by_bdaddr(gconstpointer data, gconstpointer user_data)\n{\n\tconst struct search_context *ctxt = data, *search = user_data;\n\tint ret;\n\n\tret = bacmp(&ctxt->src, &search->src);\n\tif (ret != 0)\n\t\treturn ret;\n\n\treturn bacmp(&ctxt->dst, &search->dst);\n}",
    "includes": [
      "#include \"sdp-client.h\"",
      "#include \"log.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <glib.h>",
      "#include <errno.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "bacmp",
          "args": [
            "&ctxt->dst",
            "&search->dst"
          ],
          "line": 373
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bacmp",
          "args": [
            "&ctxt->src",
            "&search->src"
          ],
          "line": 369
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"sdp-client.h\"\n#include \"log.h\"\n#include \"btio/btio.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <errno.h>\n#include <config.h>\n\nstatic int find_by_bdaddr(gconstpointer data, gconstpointer user_data)\n{\n\tconst struct search_context *ctxt = data, *search = user_data;\n\tint ret;\n\n\tret = bacmp(&ctxt->src, &search->src);\n\tif (ret != 0)\n\t\treturn ret;\n\n\treturn bacmp(&ctxt->dst, &search->dst);\n}"
  },
  {
    "function_name": "bt_search_service",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/sdp-client.c",
    "lines": "341-362",
    "snippet": "int bt_search_service(const bdaddr_t *src, const bdaddr_t *dst,\n\t\t\tuuid_t *uuid, bt_callback_t cb, void *user_data,\n\t\t\tbt_destroy_t destroy, uint16_t flags)\n{\n\tstruct search_context *ctxt = NULL;\n\tint err;\n\n\tif (!cb)\n\t\treturn -EINVAL;\n\n\terr = create_search_context(&ctxt, src, dst, uuid, flags);\n\tif (err < 0)\n\t\treturn err;\n\n\tctxt->cb\t= cb;\n\tctxt->destroy\t= destroy;\n\tctxt->user_data\t= user_data;\n\n\tcontext_list = g_slist_append(context_list, ctxt);\n\n\treturn 0;\n}",
    "includes": [
      "#include \"sdp-client.h\"",
      "#include \"log.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <glib.h>",
      "#include <errno.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static GSList *context_list = NULL;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_slist_append",
          "args": [
            "context_list",
            "ctxt"
          ],
          "line": 359
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "create_search_context",
          "args": [
            "&ctxt",
            "src",
            "dst",
            "uuid",
            "flags"
          ],
          "line": 351
        },
        "resolved": true,
        "details": {
          "function_name": "create_search_context",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/sdp-client.c",
          "lines": "293-339",
          "snippet": "static int create_search_context(struct search_context **ctxt,\n\t\t\t\t\tconst bdaddr_t *src,\n\t\t\t\t\tconst bdaddr_t *dst,\n\t\t\t\t\tuuid_t *uuid, uint16_t flags)\n{\n\tsdp_session_t *s;\n\tGIOChannel *chan;\n\tuint32_t prio = 1;\n\tint sk;\n\n\tif (!ctxt)\n\t\treturn -EINVAL;\n\n\ts = get_cached_sdp_session(src, dst);\n\tif (!s)\n\t\ts = sdp_connect(src, dst, SDP_NON_BLOCKING | flags);\n\n\tif (!s)\n\t\treturn -errno;\n\n\t*ctxt = g_try_malloc0(sizeof(struct search_context));\n\tif (!*ctxt) {\n\t\tsdp_close(s);\n\t\treturn -ENOMEM;\n\t}\n\n\tbacpy(&(*ctxt)->src, src);\n\tbacpy(&(*ctxt)->dst, dst);\n\t(*ctxt)->session = s;\n\t(*ctxt)->uuid = *uuid;\n\n\tsk = sdp_get_socket(s);\n\t/* Set low priority for the SDP connection not to interfere with\n\t * other potential traffic.\n\t */\n\tif (setsockopt(sk, SOL_SOCKET, SO_PRIORITY, &prio, sizeof(prio)) < 0)\n\t\twarn(\"Setting SDP priority failed: %s (%d)\",\n\t\t\t\t\t\tstrerror(errno), errno);\n\n\tchan = g_io_channel_unix_new(sk);\n\t(*ctxt)->io_id = g_io_add_watch(chan,\n\t\t\t\tG_IO_OUT | G_IO_HUP | G_IO_ERR | G_IO_NVAL,\n\t\t\t\tconnect_watch, *ctxt);\n\tg_io_channel_unref(chan);\n\n\treturn 0;\n}",
          "includes": [
            "#include \"sdp-client.h\"",
            "#include \"log.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sdp-client.h\"\n#include \"log.h\"\n#include \"btio/btio.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <errno.h>\n#include <config.h>\n\nstatic int create_search_context(struct search_context **ctxt,\n\t\t\t\t\tconst bdaddr_t *src,\n\t\t\t\t\tconst bdaddr_t *dst,\n\t\t\t\t\tuuid_t *uuid, uint16_t flags)\n{\n\tsdp_session_t *s;\n\tGIOChannel *chan;\n\tuint32_t prio = 1;\n\tint sk;\n\n\tif (!ctxt)\n\t\treturn -EINVAL;\n\n\ts = get_cached_sdp_session(src, dst);\n\tif (!s)\n\t\ts = sdp_connect(src, dst, SDP_NON_BLOCKING | flags);\n\n\tif (!s)\n\t\treturn -errno;\n\n\t*ctxt = g_try_malloc0(sizeof(struct search_context));\n\tif (!*ctxt) {\n\t\tsdp_close(s);\n\t\treturn -ENOMEM;\n\t}\n\n\tbacpy(&(*ctxt)->src, src);\n\tbacpy(&(*ctxt)->dst, dst);\n\t(*ctxt)->session = s;\n\t(*ctxt)->uuid = *uuid;\n\n\tsk = sdp_get_socket(s);\n\t/* Set low priority for the SDP connection not to interfere with\n\t * other potential traffic.\n\t */\n\tif (setsockopt(sk, SOL_SOCKET, SO_PRIORITY, &prio, sizeof(prio)) < 0)\n\t\twarn(\"Setting SDP priority failed: %s (%d)\",\n\t\t\t\t\t\tstrerror(errno), errno);\n\n\tchan = g_io_channel_unix_new(sk);\n\t(*ctxt)->io_id = g_io_add_watch(chan,\n\t\t\t\tG_IO_OUT | G_IO_HUP | G_IO_ERR | G_IO_NVAL,\n\t\t\t\tconnect_watch, *ctxt);\n\tg_io_channel_unref(chan);\n\n\treturn 0;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"sdp-client.h\"\n#include \"log.h\"\n#include \"btio/btio.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <errno.h>\n#include <config.h>\n\nstatic GSList *context_list = NULL;\n\nint bt_search_service(const bdaddr_t *src, const bdaddr_t *dst,\n\t\t\tuuid_t *uuid, bt_callback_t cb, void *user_data,\n\t\t\tbt_destroy_t destroy, uint16_t flags)\n{\n\tstruct search_context *ctxt = NULL;\n\tint err;\n\n\tif (!cb)\n\t\treturn -EINVAL;\n\n\terr = create_search_context(&ctxt, src, dst, uuid, flags);\n\tif (err < 0)\n\t\treturn err;\n\n\tctxt->cb\t= cb;\n\tctxt->destroy\t= destroy;\n\tctxt->user_data\t= user_data;\n\n\tcontext_list = g_slist_append(context_list, ctxt);\n\n\treturn 0;\n}"
  },
  {
    "function_name": "create_search_context",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/sdp-client.c",
    "lines": "293-339",
    "snippet": "static int create_search_context(struct search_context **ctxt,\n\t\t\t\t\tconst bdaddr_t *src,\n\t\t\t\t\tconst bdaddr_t *dst,\n\t\t\t\t\tuuid_t *uuid, uint16_t flags)\n{\n\tsdp_session_t *s;\n\tGIOChannel *chan;\n\tuint32_t prio = 1;\n\tint sk;\n\n\tif (!ctxt)\n\t\treturn -EINVAL;\n\n\ts = get_cached_sdp_session(src, dst);\n\tif (!s)\n\t\ts = sdp_connect(src, dst, SDP_NON_BLOCKING | flags);\n\n\tif (!s)\n\t\treturn -errno;\n\n\t*ctxt = g_try_malloc0(sizeof(struct search_context));\n\tif (!*ctxt) {\n\t\tsdp_close(s);\n\t\treturn -ENOMEM;\n\t}\n\n\tbacpy(&(*ctxt)->src, src);\n\tbacpy(&(*ctxt)->dst, dst);\n\t(*ctxt)->session = s;\n\t(*ctxt)->uuid = *uuid;\n\n\tsk = sdp_get_socket(s);\n\t/* Set low priority for the SDP connection not to interfere with\n\t * other potential traffic.\n\t */\n\tif (setsockopt(sk, SOL_SOCKET, SO_PRIORITY, &prio, sizeof(prio)) < 0)\n\t\twarn(\"Setting SDP priority failed: %s (%d)\",\n\t\t\t\t\t\tstrerror(errno), errno);\n\n\tchan = g_io_channel_unix_new(sk);\n\t(*ctxt)->io_id = g_io_add_watch(chan,\n\t\t\t\tG_IO_OUT | G_IO_HUP | G_IO_ERR | G_IO_NVAL,\n\t\t\t\tconnect_watch, *ctxt);\n\tg_io_channel_unref(chan);\n\n\treturn 0;\n}",
    "includes": [
      "#include \"sdp-client.h\"",
      "#include \"log.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <glib.h>",
      "#include <errno.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_io_channel_unref",
          "args": [
            "chan"
          ],
          "line": 336
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_io_add_watch",
          "args": [
            "chan",
            "G_IO_OUT | G_IO_HUP | G_IO_ERR | G_IO_NVAL",
            "connect_watch",
            "*ctxt"
          ],
          "line": 333
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_io_channel_unix_new",
          "args": [
            "sk"
          ],
          "line": 332
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "warn",
          "args": [
            "\"Setting SDP priority failed: %s (%d)\"",
            "strerror(errno)",
            "errno"
          ],
          "line": 329
        },
        "resolved": true,
        "details": {
          "function_name": "btd_warn",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/log.c",
          "lines": "215-229",
          "snippet": "void btd_warn(uint16_t index, const char *format, ...)\n{\n\tva_list ap;\n\n\tva_start(ap, format);\n\tvsyslog(LOG_WARNING, format, ap);\n\tva_end(ap);\n\n\tif (logging_fd < 0)\n\t\treturn;\n\n\tva_start(ap, format);\n\tlogging_log(index, LOG_WARNING, format, ap);\n\tva_end(ap);\n}",
          "includes": [
            "#include \"log.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/hci.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <sys/socket.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <stdarg.h>",
            "#include <syslog.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int logging_fd = -1;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n#include \"src/shared/util.h\"\n#include \"lib/hci.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <sys/socket.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdarg.h>\n#include <syslog.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic int logging_fd = -1;\n\nvoid btd_warn(uint16_t index, const char *format, ...)\n{\n\tva_list ap;\n\n\tva_start(ap, format);\n\tvsyslog(LOG_WARNING, format, ap);\n\tva_end(ap);\n\n\tif (logging_fd < 0)\n\t\treturn;\n\n\tva_start(ap, format);\n\tlogging_log(index, LOG_WARNING, format, ap);\n\tva_end(ap);\n}"
        }
      },
      {
        "call_info": {
          "callee": "strerror",
          "args": [
            "errno"
          ],
          "line": 330
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "setsockopt",
          "args": [
            "sk",
            "SOL_SOCKET",
            "SO_PRIORITY",
            "&prio",
            "sizeof(prio)"
          ],
          "line": 328
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_get_socket",
          "args": [
            "s"
          ],
          "line": 324
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bacpy",
          "args": [
            "&(*ctxt)->dst",
            "dst"
          ],
          "line": 320
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bacpy",
          "args": [
            "&(*ctxt)->src",
            "src"
          ],
          "line": 319
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_close",
          "args": [
            "s"
          ],
          "line": 315
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_try_malloc0",
          "args": [
            "sizeof(struct search_context)"
          ],
          "line": 313
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_connect",
          "args": [
            "src",
            "dst",
            "SDP_NON_BLOCKING | flags"
          ],
          "line": 308
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "get_cached_sdp_session",
          "args": [
            "src",
            "dst"
          ],
          "line": 306
        },
        "resolved": true,
        "details": {
          "function_name": "get_cached_sdp_session",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/sdp-client.c",
          "lines": "70-94",
          "snippet": "static sdp_session_t *get_cached_sdp_session(const bdaddr_t *src,\n\t\t\t\t\t\t\tconst bdaddr_t *dst)\n{\n\tGSList *l;\n\n\tfor (l = cached_sdp_sessions; l != NULL; l = l->next) {\n\t\tstruct cached_sdp_session *c = l->data;\n\t\tsdp_session_t *session;\n\n\t\tif (bacmp(&c->src, src) || bacmp(&c->dst, dst))\n\t\t\tcontinue;\n\n\t\tg_source_remove(c->timer);\n\t\tg_source_remove(c->io_id);\n\n\t\tsession = c->session;\n\n\t\tcached_sdp_sessions = g_slist_remove(cached_sdp_sessions, c);\n\t\tg_free(c);\n\n\t\treturn session;\n\t}\n\n\treturn NULL;\n}",
          "includes": [
            "#include \"sdp-client.h\"",
            "#include \"log.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static GSList *cached_sdp_sessions = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"sdp-client.h\"\n#include \"log.h\"\n#include \"btio/btio.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <errno.h>\n#include <config.h>\n\nstatic GSList *cached_sdp_sessions = NULL;\n\nstatic sdp_session_t *get_cached_sdp_session(const bdaddr_t *src,\n\t\t\t\t\t\t\tconst bdaddr_t *dst)\n{\n\tGSList *l;\n\n\tfor (l = cached_sdp_sessions; l != NULL; l = l->next) {\n\t\tstruct cached_sdp_session *c = l->data;\n\t\tsdp_session_t *session;\n\n\t\tif (bacmp(&c->src, src) || bacmp(&c->dst, dst))\n\t\t\tcontinue;\n\n\t\tg_source_remove(c->timer);\n\t\tg_source_remove(c->io_id);\n\n\t\tsession = c->session;\n\n\t\tcached_sdp_sessions = g_slist_remove(cached_sdp_sessions, c);\n\t\tg_free(c);\n\n\t\treturn session;\n\t}\n\n\treturn NULL;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"sdp-client.h\"\n#include \"log.h\"\n#include \"btio/btio.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <errno.h>\n#include <config.h>\n\nstatic int create_search_context(struct search_context **ctxt,\n\t\t\t\t\tconst bdaddr_t *src,\n\t\t\t\t\tconst bdaddr_t *dst,\n\t\t\t\t\tuuid_t *uuid, uint16_t flags)\n{\n\tsdp_session_t *s;\n\tGIOChannel *chan;\n\tuint32_t prio = 1;\n\tint sk;\n\n\tif (!ctxt)\n\t\treturn -EINVAL;\n\n\ts = get_cached_sdp_session(src, dst);\n\tif (!s)\n\t\ts = sdp_connect(src, dst, SDP_NON_BLOCKING | flags);\n\n\tif (!s)\n\t\treturn -errno;\n\n\t*ctxt = g_try_malloc0(sizeof(struct search_context));\n\tif (!*ctxt) {\n\t\tsdp_close(s);\n\t\treturn -ENOMEM;\n\t}\n\n\tbacpy(&(*ctxt)->src, src);\n\tbacpy(&(*ctxt)->dst, dst);\n\t(*ctxt)->session = s;\n\t(*ctxt)->uuid = *uuid;\n\n\tsk = sdp_get_socket(s);\n\t/* Set low priority for the SDP connection not to interfere with\n\t * other potential traffic.\n\t */\n\tif (setsockopt(sk, SOL_SOCKET, SO_PRIORITY, &prio, sizeof(prio)) < 0)\n\t\twarn(\"Setting SDP priority failed: %s (%d)\",\n\t\t\t\t\t\tstrerror(errno), errno);\n\n\tchan = g_io_channel_unix_new(sk);\n\t(*ctxt)->io_id = g_io_add_watch(chan,\n\t\t\t\tG_IO_OUT | G_IO_HUP | G_IO_ERR | G_IO_NVAL,\n\t\t\t\tconnect_watch, *ctxt);\n\tg_io_channel_unref(chan);\n\n\treturn 0;\n}"
  },
  {
    "function_name": "connect_watch",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/sdp-client.c",
    "lines": "236-291",
    "snippet": "static gboolean connect_watch(GIOChannel *chan, GIOCondition cond,\n\t\t\t\t\t\t\tgpointer user_data)\n{\n\tstruct search_context *ctxt = user_data;\n\tsdp_list_t *search, *attrids;\n\tuint32_t range = 0x0000ffff;\n\tsocklen_t len;\n\tint sk, err, sk_err = 0;\n\n\tsk = g_io_channel_unix_get_fd(chan);\n\tctxt->io_id = 0;\n\n\tlen = sizeof(sk_err);\n\tif (getsockopt(sk, SOL_SOCKET, SO_ERROR, &sk_err, &len) < 0)\n\t\terr = -errno;\n\telse\n\t\terr = -sk_err;\n\n\tif (err != 0)\n\t\tgoto failed;\n\n\tif (sdp_set_notify(ctxt->session, search_completed_cb, ctxt) < 0) {\n\t\terr = -EIO;\n\t\tgoto failed;\n\t}\n\n\tsearch = sdp_list_append(NULL, &ctxt->uuid);\n\tattrids = sdp_list_append(NULL, &range);\n\tif (sdp_service_search_attr_async(ctxt->session,\n\t\t\t\tsearch, SDP_ATTR_REQ_RANGE, attrids) < 0) {\n\t\tsdp_list_free(attrids, NULL);\n\t\tsdp_list_free(search, NULL);\n\t\terr = -EIO;\n\t\tgoto failed;\n\t}\n\n\tsdp_list_free(attrids, NULL);\n\tsdp_list_free(search, NULL);\n\n\t/* Set callback responsible for update the internal SDP transaction */\n\tctxt->io_id = g_io_add_watch(chan,\n\t\t\t\tG_IO_IN | G_IO_HUP | G_IO_ERR | G_IO_NVAL,\n\t\t\t\tsearch_process_cb, ctxt);\n\treturn FALSE;\n\nfailed:\n\tsdp_close(ctxt->session);\n\tctxt->session = NULL;\n\n\tif (ctxt->cb)\n\t\tctxt->cb(NULL, err, ctxt->user_data);\n\n\tsearch_context_cleanup(ctxt);\n\n\treturn FALSE;\n}",
    "includes": [
      "#include \"sdp-client.h\"",
      "#include \"log.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <glib.h>",
      "#include <errno.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "search_context_cleanup",
          "args": [
            "ctxt"
          ],
          "line": 288
        },
        "resolved": true,
        "details": {
          "function_name": "search_context_cleanup",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/sdp-client.c",
          "lines": "150-158",
          "snippet": "static void search_context_cleanup(struct search_context *ctxt)\n{\n\tcontext_list = g_slist_remove(context_list, ctxt);\n\n\tif (ctxt->destroy)\n\t\tctxt->destroy(ctxt->user_data);\n\n\tg_free(ctxt);\n}",
          "includes": [
            "#include \"sdp-client.h\"",
            "#include \"log.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static GSList *context_list = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"sdp-client.h\"\n#include \"log.h\"\n#include \"btio/btio.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <errno.h>\n#include <config.h>\n\nstatic GSList *context_list = NULL;\n\nstatic void search_context_cleanup(struct search_context *ctxt)\n{\n\tcontext_list = g_slist_remove(context_list, ctxt);\n\n\tif (ctxt->destroy)\n\t\tctxt->destroy(ctxt->user_data);\n\n\tg_free(ctxt);\n}"
        }
      },
      {
        "call_info": {
          "callee": "ctxt->cb",
          "args": [
            "NULL",
            "err",
            "ctxt->user_data"
          ],
          "line": 286
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_close",
          "args": [
            "ctxt->session"
          ],
          "line": 282
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_io_add_watch",
          "args": [
            "chan",
            "G_IO_IN | G_IO_HUP | G_IO_ERR | G_IO_NVAL",
            "search_process_cb",
            "ctxt"
          ],
          "line": 276
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_list_free",
          "args": [
            "search",
            "NULL"
          ],
          "line": 273
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_list_free",
          "args": [
            "attrids",
            "NULL"
          ],
          "line": 272
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_list_free",
          "args": [
            "search",
            "NULL"
          ],
          "line": 267
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_list_free",
          "args": [
            "attrids",
            "NULL"
          ],
          "line": 266
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_service_search_attr_async",
          "args": [
            "ctxt->session",
            "search",
            "SDP_ATTR_REQ_RANGE",
            "attrids"
          ],
          "line": 264
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_list_append",
          "args": [
            "NULL",
            "&range"
          ],
          "line": 263
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_list_append",
          "args": [
            "NULL",
            "&ctxt->uuid"
          ],
          "line": 262
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_set_notify",
          "args": [
            "ctxt->session",
            "search_completed_cb",
            "ctxt"
          ],
          "line": 257
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "getsockopt",
          "args": [
            "sk",
            "SOL_SOCKET",
            "SO_ERROR",
            "&sk_err",
            "&len"
          ],
          "line": 249
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_io_channel_unix_get_fd",
          "args": [
            "chan"
          ],
          "line": 245
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"sdp-client.h\"\n#include \"log.h\"\n#include \"btio/btio.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <errno.h>\n#include <config.h>\n\nstatic gboolean connect_watch(GIOChannel *chan, GIOCondition cond,\n\t\t\t\t\t\t\tgpointer user_data)\n{\n\tstruct search_context *ctxt = user_data;\n\tsdp_list_t *search, *attrids;\n\tuint32_t range = 0x0000ffff;\n\tsocklen_t len;\n\tint sk, err, sk_err = 0;\n\n\tsk = g_io_channel_unix_get_fd(chan);\n\tctxt->io_id = 0;\n\n\tlen = sizeof(sk_err);\n\tif (getsockopt(sk, SOL_SOCKET, SO_ERROR, &sk_err, &len) < 0)\n\t\terr = -errno;\n\telse\n\t\terr = -sk_err;\n\n\tif (err != 0)\n\t\tgoto failed;\n\n\tif (sdp_set_notify(ctxt->session, search_completed_cb, ctxt) < 0) {\n\t\terr = -EIO;\n\t\tgoto failed;\n\t}\n\n\tsearch = sdp_list_append(NULL, &ctxt->uuid);\n\tattrids = sdp_list_append(NULL, &range);\n\tif (sdp_service_search_attr_async(ctxt->session,\n\t\t\t\tsearch, SDP_ATTR_REQ_RANGE, attrids) < 0) {\n\t\tsdp_list_free(attrids, NULL);\n\t\tsdp_list_free(search, NULL);\n\t\terr = -EIO;\n\t\tgoto failed;\n\t}\n\n\tsdp_list_free(attrids, NULL);\n\tsdp_list_free(search, NULL);\n\n\t/* Set callback responsible for update the internal SDP transaction */\n\tctxt->io_id = g_io_add_watch(chan,\n\t\t\t\tG_IO_IN | G_IO_HUP | G_IO_ERR | G_IO_NVAL,\n\t\t\t\tsearch_process_cb, ctxt);\n\treturn FALSE;\n\nfailed:\n\tsdp_close(ctxt->session);\n\tctxt->session = NULL;\n\n\tif (ctxt->cb)\n\t\tctxt->cb(NULL, err, ctxt->user_data);\n\n\tsearch_context_cleanup(ctxt);\n\n\treturn FALSE;\n}"
  },
  {
    "function_name": "search_process_cb",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/sdp-client.c",
    "lines": "213-234",
    "snippet": "static gboolean search_process_cb(GIOChannel *chan, GIOCondition cond,\n\t\t\t\t\t\t\tgpointer user_data)\n{\n\tstruct search_context *ctxt = user_data;\n\n\tif (cond & (G_IO_ERR | G_IO_HUP | G_IO_NVAL)) {\n\t\tsdp_close(ctxt->session);\n\t\tctxt->session = NULL;\n\n\t\tif (ctxt->cb)\n\t\t\tctxt->cb(NULL, -EIO, ctxt->user_data);\n\n\t\tsearch_context_cleanup(ctxt);\n\t\treturn FALSE;\n\t}\n\n\t/* If sdp_process fails it calls search_completed_cb */\n\tif (sdp_process(ctxt->session) < 0)\n\t\treturn FALSE;\n\n\treturn TRUE;\n}",
    "includes": [
      "#include \"sdp-client.h\"",
      "#include \"log.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <glib.h>",
      "#include <errno.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "sdp_process",
          "args": [
            "ctxt->session"
          ],
          "line": 230
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "search_context_cleanup",
          "args": [
            "ctxt"
          ],
          "line": 225
        },
        "resolved": true,
        "details": {
          "function_name": "search_context_cleanup",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/sdp-client.c",
          "lines": "150-158",
          "snippet": "static void search_context_cleanup(struct search_context *ctxt)\n{\n\tcontext_list = g_slist_remove(context_list, ctxt);\n\n\tif (ctxt->destroy)\n\t\tctxt->destroy(ctxt->user_data);\n\n\tg_free(ctxt);\n}",
          "includes": [
            "#include \"sdp-client.h\"",
            "#include \"log.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static GSList *context_list = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"sdp-client.h\"\n#include \"log.h\"\n#include \"btio/btio.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <errno.h>\n#include <config.h>\n\nstatic GSList *context_list = NULL;\n\nstatic void search_context_cleanup(struct search_context *ctxt)\n{\n\tcontext_list = g_slist_remove(context_list, ctxt);\n\n\tif (ctxt->destroy)\n\t\tctxt->destroy(ctxt->user_data);\n\n\tg_free(ctxt);\n}"
        }
      },
      {
        "call_info": {
          "callee": "ctxt->cb",
          "args": [
            "NULL",
            "-EIO",
            "ctxt->user_data"
          ],
          "line": 223
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_close",
          "args": [
            "ctxt->session"
          ],
          "line": 219
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"sdp-client.h\"\n#include \"log.h\"\n#include \"btio/btio.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <errno.h>\n#include <config.h>\n\nstatic gboolean search_process_cb(GIOChannel *chan, GIOCondition cond,\n\t\t\t\t\t\t\tgpointer user_data)\n{\n\tstruct search_context *ctxt = user_data;\n\n\tif (cond & (G_IO_ERR | G_IO_HUP | G_IO_NVAL)) {\n\t\tsdp_close(ctxt->session);\n\t\tctxt->session = NULL;\n\n\t\tif (ctxt->cb)\n\t\t\tctxt->cb(NULL, -EIO, ctxt->user_data);\n\n\t\tsearch_context_cleanup(ctxt);\n\t\treturn FALSE;\n\t}\n\n\t/* If sdp_process fails it calls search_completed_cb */\n\tif (sdp_process(ctxt->session) < 0)\n\t\treturn FALSE;\n\n\treturn TRUE;\n}"
  },
  {
    "function_name": "search_completed_cb",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/sdp-client.c",
    "lines": "160-211",
    "snippet": "static void search_completed_cb(uint8_t type, uint16_t status,\n\t\t\tuint8_t *rsp, size_t size, void *user_data)\n{\n\tstruct search_context *ctxt = user_data;\n\tsdp_list_t *recs = NULL;\n\tint scanned, seqlen = 0, bytesleft = size;\n\tuint8_t dataType;\n\tint err = 0;\n\n\tif (status || type != SDP_SVC_SEARCH_ATTR_RSP) {\n\t\terr = -EPROTO;\n\t\tgoto done;\n\t}\n\n\tscanned = sdp_extract_seqtype(rsp, bytesleft, &dataType, &seqlen);\n\tif (!scanned || !seqlen)\n\t\tgoto done;\n\n\trsp += scanned;\n\tbytesleft -= scanned;\n\tdo {\n\t\tsdp_record_t *rec;\n\t\tint recsize;\n\n\t\trecsize = 0;\n\t\trec = sdp_extract_pdu(rsp, bytesleft, &recsize);\n\t\tif (!rec)\n\t\t\tbreak;\n\n\t\tif (!recsize) {\n\t\t\tsdp_record_free(rec);\n\t\t\tbreak;\n\t\t}\n\n\t\tscanned += recsize;\n\t\trsp += recsize;\n\t\tbytesleft -= recsize;\n\n\t\trecs = sdp_list_append(recs, rec);\n\t} while (scanned < (ssize_t) size && bytesleft > 0);\n\ndone:\n\tcache_sdp_session(&ctxt->src, &ctxt->dst, ctxt->session);\n\n\tif (ctxt->cb)\n\t\tctxt->cb(recs, err, ctxt->user_data);\n\n\tif (recs)\n\t\tsdp_list_free(recs, (sdp_free_func_t) sdp_record_free);\n\n\tsearch_context_cleanup(ctxt);\n}",
    "includes": [
      "#include \"sdp-client.h\"",
      "#include \"log.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <glib.h>",
      "#include <errno.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "search_context_cleanup",
          "args": [
            "ctxt"
          ],
          "line": 210
        },
        "resolved": true,
        "details": {
          "function_name": "search_context_cleanup",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/sdp-client.c",
          "lines": "150-158",
          "snippet": "static void search_context_cleanup(struct search_context *ctxt)\n{\n\tcontext_list = g_slist_remove(context_list, ctxt);\n\n\tif (ctxt->destroy)\n\t\tctxt->destroy(ctxt->user_data);\n\n\tg_free(ctxt);\n}",
          "includes": [
            "#include \"sdp-client.h\"",
            "#include \"log.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static GSList *context_list = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"sdp-client.h\"\n#include \"log.h\"\n#include \"btio/btio.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <errno.h>\n#include <config.h>\n\nstatic GSList *context_list = NULL;\n\nstatic void search_context_cleanup(struct search_context *ctxt)\n{\n\tcontext_list = g_slist_remove(context_list, ctxt);\n\n\tif (ctxt->destroy)\n\t\tctxt->destroy(ctxt->user_data);\n\n\tg_free(ctxt);\n}"
        }
      },
      {
        "call_info": {
          "callee": "sdp_list_free",
          "args": [
            "recs",
            "(sdp_free_func_t) sdp_record_free"
          ],
          "line": 208
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ctxt->cb",
          "args": [
            "recs",
            "err",
            "ctxt->user_data"
          ],
          "line": 205
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "cache_sdp_session",
          "args": [
            "&ctxt->src",
            "&ctxt->dst",
            "ctxt->session"
          ],
          "line": 202
        },
        "resolved": true,
        "details": {
          "function_name": "cache_sdp_session",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/sdp-client.c",
          "lines": "107-135",
          "snippet": "static void cache_sdp_session(bdaddr_t *src, bdaddr_t *dst,\n\t\t\t\t\t\tsdp_session_t *session)\n{\n\tstruct cached_sdp_session *cached;\n\tint sk;\n\tGIOChannel *chan;\n\n\tcached = g_new0(struct cached_sdp_session, 1);\n\n\tbacpy(&cached->src, src);\n\tbacpy(&cached->dst, dst);\n\n\tcached->session = session;\n\n\tcached_sdp_sessions = g_slist_append(cached_sdp_sessions, cached);\n\n\tcached->timer = g_timeout_add_seconds(CACHE_TIMEOUT,\n\t\t\t\t\t\tcached_session_expired,\n\t\t\t\t\t\tcached);\n\n\t/* Watch the connection state during cache timeout */\n\tsk = sdp_get_socket(session);\n\tchan = g_io_channel_unix_new(sk);\n\n\tcached->io_id = g_io_add_watch(chan, G_IO_HUP | G_IO_ERR | G_IO_NVAL,\n\t\t\t\t\t\tdisconnect_watch, cached);\n\n\tg_io_channel_unref(chan);\n}",
          "includes": [
            "#include \"sdp-client.h\"",
            "#include \"log.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define CACHE_TIMEOUT 2"
          ],
          "globals_used": [
            "static GSList *cached_sdp_sessions = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"sdp-client.h\"\n#include \"log.h\"\n#include \"btio/btio.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <errno.h>\n#include <config.h>\n\n#define CACHE_TIMEOUT 2\n\nstatic GSList *cached_sdp_sessions = NULL;\n\nstatic void cache_sdp_session(bdaddr_t *src, bdaddr_t *dst,\n\t\t\t\t\t\tsdp_session_t *session)\n{\n\tstruct cached_sdp_session *cached;\n\tint sk;\n\tGIOChannel *chan;\n\n\tcached = g_new0(struct cached_sdp_session, 1);\n\n\tbacpy(&cached->src, src);\n\tbacpy(&cached->dst, dst);\n\n\tcached->session = session;\n\n\tcached_sdp_sessions = g_slist_append(cached_sdp_sessions, cached);\n\n\tcached->timer = g_timeout_add_seconds(CACHE_TIMEOUT,\n\t\t\t\t\t\tcached_session_expired,\n\t\t\t\t\t\tcached);\n\n\t/* Watch the connection state during cache timeout */\n\tsk = sdp_get_socket(session);\n\tchan = g_io_channel_unix_new(sk);\n\n\tcached->io_id = g_io_add_watch(chan, G_IO_HUP | G_IO_ERR | G_IO_NVAL,\n\t\t\t\t\t\tdisconnect_watch, cached);\n\n\tg_io_channel_unref(chan);\n}"
        }
      },
      {
        "call_info": {
          "callee": "sdp_list_append",
          "args": [
            "recs",
            "rec"
          ],
          "line": 198
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_record_free",
          "args": [
            "rec"
          ],
          "line": 190
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_extract_pdu",
          "args": [
            "rsp",
            "bytesleft",
            "&recsize"
          ],
          "line": 185
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_extract_seqtype",
          "args": [
            "rsp",
            "bytesleft",
            "&dataType",
            "&seqlen"
          ],
          "line": 174
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"sdp-client.h\"\n#include \"log.h\"\n#include \"btio/btio.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <errno.h>\n#include <config.h>\n\nstatic void search_completed_cb(uint8_t type, uint16_t status,\n\t\t\tuint8_t *rsp, size_t size, void *user_data)\n{\n\tstruct search_context *ctxt = user_data;\n\tsdp_list_t *recs = NULL;\n\tint scanned, seqlen = 0, bytesleft = size;\n\tuint8_t dataType;\n\tint err = 0;\n\n\tif (status || type != SDP_SVC_SEARCH_ATTR_RSP) {\n\t\terr = -EPROTO;\n\t\tgoto done;\n\t}\n\n\tscanned = sdp_extract_seqtype(rsp, bytesleft, &dataType, &seqlen);\n\tif (!scanned || !seqlen)\n\t\tgoto done;\n\n\trsp += scanned;\n\tbytesleft -= scanned;\n\tdo {\n\t\tsdp_record_t *rec;\n\t\tint recsize;\n\n\t\trecsize = 0;\n\t\trec = sdp_extract_pdu(rsp, bytesleft, &recsize);\n\t\tif (!rec)\n\t\t\tbreak;\n\n\t\tif (!recsize) {\n\t\t\tsdp_record_free(rec);\n\t\t\tbreak;\n\t\t}\n\n\t\tscanned += recsize;\n\t\trsp += recsize;\n\t\tbytesleft -= recsize;\n\n\t\trecs = sdp_list_append(recs, rec);\n\t} while (scanned < (ssize_t) size && bytesleft > 0);\n\ndone:\n\tcache_sdp_session(&ctxt->src, &ctxt->dst, ctxt->session);\n\n\tif (ctxt->cb)\n\t\tctxt->cb(recs, err, ctxt->user_data);\n\n\tif (recs)\n\t\tsdp_list_free(recs, (sdp_free_func_t) sdp_record_free);\n\n\tsearch_context_cleanup(ctxt);\n}"
  },
  {
    "function_name": "search_context_cleanup",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/sdp-client.c",
    "lines": "150-158",
    "snippet": "static void search_context_cleanup(struct search_context *ctxt)\n{\n\tcontext_list = g_slist_remove(context_list, ctxt);\n\n\tif (ctxt->destroy)\n\t\tctxt->destroy(ctxt->user_data);\n\n\tg_free(ctxt);\n}",
    "includes": [
      "#include \"sdp-client.h\"",
      "#include \"log.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <glib.h>",
      "#include <errno.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static GSList *context_list = NULL;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_free",
          "args": [
            "ctxt"
          ],
          "line": 157
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ctxt->destroy",
          "args": [
            "ctxt->user_data"
          ],
          "line": 155
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_slist_remove",
          "args": [
            "context_list",
            "ctxt"
          ],
          "line": 152
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"sdp-client.h\"\n#include \"log.h\"\n#include \"btio/btio.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <errno.h>\n#include <config.h>\n\nstatic GSList *context_list = NULL;\n\nstatic void search_context_cleanup(struct search_context *ctxt)\n{\n\tcontext_list = g_slist_remove(context_list, ctxt);\n\n\tif (ctxt->destroy)\n\t\tctxt->destroy(ctxt->user_data);\n\n\tg_free(ctxt);\n}"
  },
  {
    "function_name": "cache_sdp_session",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/sdp-client.c",
    "lines": "107-135",
    "snippet": "static void cache_sdp_session(bdaddr_t *src, bdaddr_t *dst,\n\t\t\t\t\t\tsdp_session_t *session)\n{\n\tstruct cached_sdp_session *cached;\n\tint sk;\n\tGIOChannel *chan;\n\n\tcached = g_new0(struct cached_sdp_session, 1);\n\n\tbacpy(&cached->src, src);\n\tbacpy(&cached->dst, dst);\n\n\tcached->session = session;\n\n\tcached_sdp_sessions = g_slist_append(cached_sdp_sessions, cached);\n\n\tcached->timer = g_timeout_add_seconds(CACHE_TIMEOUT,\n\t\t\t\t\t\tcached_session_expired,\n\t\t\t\t\t\tcached);\n\n\t/* Watch the connection state during cache timeout */\n\tsk = sdp_get_socket(session);\n\tchan = g_io_channel_unix_new(sk);\n\n\tcached->io_id = g_io_add_watch(chan, G_IO_HUP | G_IO_ERR | G_IO_NVAL,\n\t\t\t\t\t\tdisconnect_watch, cached);\n\n\tg_io_channel_unref(chan);\n}",
    "includes": [
      "#include \"sdp-client.h\"",
      "#include \"log.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <glib.h>",
      "#include <errno.h>",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define CACHE_TIMEOUT 2"
    ],
    "globals_used": [
      "static GSList *cached_sdp_sessions = NULL;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_io_channel_unref",
          "args": [
            "chan"
          ],
          "line": 134
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_io_add_watch",
          "args": [
            "chan",
            "G_IO_HUP | G_IO_ERR | G_IO_NVAL",
            "disconnect_watch",
            "cached"
          ],
          "line": 131
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_io_channel_unix_new",
          "args": [
            "sk"
          ],
          "line": 129
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_get_socket",
          "args": [
            "session"
          ],
          "line": 128
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_timeout_add_seconds",
          "args": [
            "CACHE_TIMEOUT",
            "cached_session_expired",
            "cached"
          ],
          "line": 123
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_slist_append",
          "args": [
            "cached_sdp_sessions",
            "cached"
          ],
          "line": 121
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bacpy",
          "args": [
            "&cached->dst",
            "dst"
          ],
          "line": 117
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bacpy",
          "args": [
            "&cached->src",
            "src"
          ],
          "line": 116
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_new0",
          "args": [
            "structcached_sdp_session",
            "1"
          ],
          "line": 114
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"sdp-client.h\"\n#include \"log.h\"\n#include \"btio/btio.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <errno.h>\n#include <config.h>\n\n#define CACHE_TIMEOUT 2\n\nstatic GSList *cached_sdp_sessions = NULL;\n\nstatic void cache_sdp_session(bdaddr_t *src, bdaddr_t *dst,\n\t\t\t\t\t\tsdp_session_t *session)\n{\n\tstruct cached_sdp_session *cached;\n\tint sk;\n\tGIOChannel *chan;\n\n\tcached = g_new0(struct cached_sdp_session, 1);\n\n\tbacpy(&cached->src, src);\n\tbacpy(&cached->dst, dst);\n\n\tcached->session = session;\n\n\tcached_sdp_sessions = g_slist_append(cached_sdp_sessions, cached);\n\n\tcached->timer = g_timeout_add_seconds(CACHE_TIMEOUT,\n\t\t\t\t\t\tcached_session_expired,\n\t\t\t\t\t\tcached);\n\n\t/* Watch the connection state during cache timeout */\n\tsk = sdp_get_socket(session);\n\tchan = g_io_channel_unix_new(sk);\n\n\tcached->io_id = g_io_add_watch(chan, G_IO_HUP | G_IO_ERR | G_IO_NVAL,\n\t\t\t\t\t\tdisconnect_watch, cached);\n\n\tg_io_channel_unref(chan);\n}"
  },
  {
    "function_name": "disconnect_watch",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/sdp-client.c",
    "lines": "96-105",
    "snippet": "static gboolean disconnect_watch(GIOChannel *chan, GIOCondition cond,\n\t\t\t\t\t\t\tgpointer user_data)\n{\n\tstruct cached_sdp_session *cached = user_data;\n\n\tg_source_remove(cached->timer);\n\tcleanup_cached_session(cached);\n\n\treturn FALSE;\n}",
    "includes": [
      "#include \"sdp-client.h\"",
      "#include \"log.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <glib.h>",
      "#include <errno.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "cleanup_cached_session",
          "args": [
            "cached"
          ],
          "line": 102
        },
        "resolved": true,
        "details": {
          "function_name": "cleanup_cached_session",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/sdp-client.c",
          "lines": "53-58",
          "snippet": "static void cleanup_cached_session(struct cached_sdp_session *cached)\n{\n\tcached_sdp_sessions = g_slist_remove(cached_sdp_sessions, cached);\n\tsdp_close(cached->session);\n\tg_free(cached);\n}",
          "includes": [
            "#include \"sdp-client.h\"",
            "#include \"log.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static GSList *cached_sdp_sessions = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"sdp-client.h\"\n#include \"log.h\"\n#include \"btio/btio.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <errno.h>\n#include <config.h>\n\nstatic GSList *cached_sdp_sessions = NULL;\n\nstatic void cleanup_cached_session(struct cached_sdp_session *cached)\n{\n\tcached_sdp_sessions = g_slist_remove(cached_sdp_sessions, cached);\n\tsdp_close(cached->session);\n\tg_free(cached);\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_source_remove",
          "args": [
            "cached->timer"
          ],
          "line": 101
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"sdp-client.h\"\n#include \"log.h\"\n#include \"btio/btio.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <errno.h>\n#include <config.h>\n\nstatic gboolean disconnect_watch(GIOChannel *chan, GIOCondition cond,\n\t\t\t\t\t\t\tgpointer user_data)\n{\n\tstruct cached_sdp_session *cached = user_data;\n\n\tg_source_remove(cached->timer);\n\tcleanup_cached_session(cached);\n\n\treturn FALSE;\n}"
  },
  {
    "function_name": "get_cached_sdp_session",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/sdp-client.c",
    "lines": "70-94",
    "snippet": "static sdp_session_t *get_cached_sdp_session(const bdaddr_t *src,\n\t\t\t\t\t\t\tconst bdaddr_t *dst)\n{\n\tGSList *l;\n\n\tfor (l = cached_sdp_sessions; l != NULL; l = l->next) {\n\t\tstruct cached_sdp_session *c = l->data;\n\t\tsdp_session_t *session;\n\n\t\tif (bacmp(&c->src, src) || bacmp(&c->dst, dst))\n\t\t\tcontinue;\n\n\t\tg_source_remove(c->timer);\n\t\tg_source_remove(c->io_id);\n\n\t\tsession = c->session;\n\n\t\tcached_sdp_sessions = g_slist_remove(cached_sdp_sessions, c);\n\t\tg_free(c);\n\n\t\treturn session;\n\t}\n\n\treturn NULL;\n}",
    "includes": [
      "#include \"sdp-client.h\"",
      "#include \"log.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <glib.h>",
      "#include <errno.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static GSList *cached_sdp_sessions = NULL;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_free",
          "args": [
            "c"
          ],
          "line": 88
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_slist_remove",
          "args": [
            "cached_sdp_sessions",
            "c"
          ],
          "line": 87
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_source_remove",
          "args": [
            "c->io_id"
          ],
          "line": 83
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_source_remove",
          "args": [
            "c->timer"
          ],
          "line": 82
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bacmp",
          "args": [
            "&c->dst",
            "dst"
          ],
          "line": 79
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bacmp",
          "args": [
            "&c->src",
            "src"
          ],
          "line": 79
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"sdp-client.h\"\n#include \"log.h\"\n#include \"btio/btio.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <errno.h>\n#include <config.h>\n\nstatic GSList *cached_sdp_sessions = NULL;\n\nstatic sdp_session_t *get_cached_sdp_session(const bdaddr_t *src,\n\t\t\t\t\t\t\tconst bdaddr_t *dst)\n{\n\tGSList *l;\n\n\tfor (l = cached_sdp_sessions; l != NULL; l = l->next) {\n\t\tstruct cached_sdp_session *c = l->data;\n\t\tsdp_session_t *session;\n\n\t\tif (bacmp(&c->src, src) || bacmp(&c->dst, dst))\n\t\t\tcontinue;\n\n\t\tg_source_remove(c->timer);\n\t\tg_source_remove(c->io_id);\n\n\t\tsession = c->session;\n\n\t\tcached_sdp_sessions = g_slist_remove(cached_sdp_sessions, c);\n\t\tg_free(c);\n\n\t\treturn session;\n\t}\n\n\treturn NULL;\n}"
  },
  {
    "function_name": "cached_session_expired",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/sdp-client.c",
    "lines": "60-68",
    "snippet": "static gboolean cached_session_expired(gpointer user_data)\n{\n\tstruct cached_sdp_session *cached = user_data;\n\n\tg_source_remove(cached->io_id);\n\tcleanup_cached_session(cached);\n\n\treturn FALSE;\n}",
    "includes": [
      "#include \"sdp-client.h\"",
      "#include \"log.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <glib.h>",
      "#include <errno.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "cleanup_cached_session",
          "args": [
            "cached"
          ],
          "line": 65
        },
        "resolved": true,
        "details": {
          "function_name": "cleanup_cached_session",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/sdp-client.c",
          "lines": "53-58",
          "snippet": "static void cleanup_cached_session(struct cached_sdp_session *cached)\n{\n\tcached_sdp_sessions = g_slist_remove(cached_sdp_sessions, cached);\n\tsdp_close(cached->session);\n\tg_free(cached);\n}",
          "includes": [
            "#include \"sdp-client.h\"",
            "#include \"log.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static GSList *cached_sdp_sessions = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"sdp-client.h\"\n#include \"log.h\"\n#include \"btio/btio.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <errno.h>\n#include <config.h>\n\nstatic GSList *cached_sdp_sessions = NULL;\n\nstatic void cleanup_cached_session(struct cached_sdp_session *cached)\n{\n\tcached_sdp_sessions = g_slist_remove(cached_sdp_sessions, cached);\n\tsdp_close(cached->session);\n\tg_free(cached);\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_source_remove",
          "args": [
            "cached->io_id"
          ],
          "line": 64
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"sdp-client.h\"\n#include \"log.h\"\n#include \"btio/btio.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <errno.h>\n#include <config.h>\n\nstatic gboolean cached_session_expired(gpointer user_data)\n{\n\tstruct cached_sdp_session *cached = user_data;\n\n\tg_source_remove(cached->io_id);\n\tcleanup_cached_session(cached);\n\n\treturn FALSE;\n}"
  },
  {
    "function_name": "cleanup_cached_session",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/sdp-client.c",
    "lines": "53-58",
    "snippet": "static void cleanup_cached_session(struct cached_sdp_session *cached)\n{\n\tcached_sdp_sessions = g_slist_remove(cached_sdp_sessions, cached);\n\tsdp_close(cached->session);\n\tg_free(cached);\n}",
    "includes": [
      "#include \"sdp-client.h\"",
      "#include \"log.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <glib.h>",
      "#include <errno.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static GSList *cached_sdp_sessions = NULL;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_free",
          "args": [
            "cached"
          ],
          "line": 57
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_close",
          "args": [
            "cached->session"
          ],
          "line": 56
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_slist_remove",
          "args": [
            "cached_sdp_sessions",
            "cached"
          ],
          "line": 55
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"sdp-client.h\"\n#include \"log.h\"\n#include \"btio/btio.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <errno.h>\n#include <config.h>\n\nstatic GSList *cached_sdp_sessions = NULL;\n\nstatic void cleanup_cached_session(struct cached_sdp_session *cached)\n{\n\tcached_sdp_sessions = g_slist_remove(cached_sdp_sessions, cached);\n\tsdp_close(cached->session);\n\tg_free(cached);\n}"
  }
]