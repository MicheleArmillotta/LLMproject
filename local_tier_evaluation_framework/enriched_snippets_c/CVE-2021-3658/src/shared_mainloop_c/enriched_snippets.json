[
  {
    "function_name": "mainloop_set_signal",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/mainloop.c",
    "lines": "378-402",
    "snippet": "int mainloop_set_signal(sigset_t *mask, mainloop_signal_func callback,\n\t\t\t\tvoid *user_data, mainloop_destroy_func destroy)\n{\n\tstruct signal_data *data;\n\n\tif (!mask || !callback)\n\t\treturn -EINVAL;\n\n\tdata = malloc(sizeof(*data));\n\tif (!data)\n\t\treturn -ENOMEM;\n\n\tmemset(data, 0, sizeof(*data));\n\tdata->callback = callback;\n\tdata->destroy = destroy;\n\tdata->user_data = user_data;\n\n\tdata->fd = -1;\n\tmemcpy(&data->mask, mask, sizeof(sigset_t));\n\n\tfree(signal_data);\n\tsignal_data = data;\n\n\treturn 0;\n}",
    "includes": [
      "#include \"mainloop.h\"",
      "#include <sys/epoll.h>",
      "#include <sys/timerfd.h>",
      "#include <sys/signalfd.h>",
      "#include <signal.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static struct signal_data *signal_data;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "signal_data"
          ],
          "line": 398
        },
        "resolved": true,
        "details": {
          "function_name": "bt_att_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/att.c",
          "lines": "956-985",
          "snippet": "static void bt_att_free(struct bt_att *att)\n{\n\tif (att->pending_req)\n\t\tdestroy_att_send_op(att->pending_req);\n\n\tif (att->pending_ind)\n\t\tdestroy_att_send_op(att->pending_ind);\n\n\tio_destroy(att->io);\n\tbt_crypto_unref(att->crypto);\n\n\tqueue_destroy(att->req_queue, NULL);\n\tqueue_destroy(att->ind_queue, NULL);\n\tqueue_destroy(att->write_queue, NULL);\n\tqueue_destroy(att->notify_list, NULL);\n\tqueue_destroy(att->disconn_list, NULL);\n\n\tif (att->timeout_destroy)\n\t\tatt->timeout_destroy(att->timeout_data);\n\n\tif (att->debug_destroy)\n\t\tatt->debug_destroy(att->debug_data);\n\n\tfree(att->local_sign);\n\tfree(att->remote_sign);\n\n\tfree(att->buf);\n\n\tfree(att);\n}",
          "includes": [
            "#include \"src/shared/crypto.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/l2cap.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/crypto.h\"\n#include \"src/shared/att.h\"\n#include \"lib/uuid.h\"\n#include \"lib/l2cap.h\"\n#include \"lib/bluetooth.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include <errno.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <config.h>\n\nstatic void bt_att_free(struct bt_att *att)\n{\n\tif (att->pending_req)\n\t\tdestroy_att_send_op(att->pending_req);\n\n\tif (att->pending_ind)\n\t\tdestroy_att_send_op(att->pending_ind);\n\n\tio_destroy(att->io);\n\tbt_crypto_unref(att->crypto);\n\n\tqueue_destroy(att->req_queue, NULL);\n\tqueue_destroy(att->ind_queue, NULL);\n\tqueue_destroy(att->write_queue, NULL);\n\tqueue_destroy(att->notify_list, NULL);\n\tqueue_destroy(att->disconn_list, NULL);\n\n\tif (att->timeout_destroy)\n\t\tatt->timeout_destroy(att->timeout_data);\n\n\tif (att->debug_destroy)\n\t\tatt->debug_destroy(att->debug_data);\n\n\tfree(att->local_sign);\n\tfree(att->remote_sign);\n\n\tfree(att->buf);\n\n\tfree(att);\n}"
        }
      },
      {
        "call_info": {
          "callee": "memcpy",
          "args": [
            "&data->mask",
            "mask",
            "sizeof(sigset_t)"
          ],
          "line": 396
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memset",
          "args": [
            "data",
            "0",
            "sizeof(*data)"
          ],
          "line": 390
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "malloc",
          "args": [
            "sizeof(*data)"
          ],
          "line": 386
        },
        "resolved": true,
        "details": {
          "function_name": "btd_malloc",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/util.c",
          "lines": "41-55",
          "snippet": "void *btd_malloc(size_t size)\n{\n\tif (__builtin_expect(!!size, 1)) {\n\t\tvoid *ptr;\n\n\t\tptr = malloc(size);\n\t\tif (ptr)\n\t\t\treturn ptr;\n\n\t\tfprintf(stderr, \"failed to allocate %zu bytes\\n\", size);\n\t\tabort();\n\t}\n\n\treturn NULL;\n}",
          "includes": [
            "#include \"src/shared/util.h\"",
            "#include <string.h>",
            "#include <limits.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <stdbool.h>",
            "#include <stdarg.h>",
            "#include <ctype.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/util.h\"\n#include <string.h>\n#include <limits.h>\n#include <dirent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <config.h>\n\nvoid *btd_malloc(size_t size)\n{\n\tif (__builtin_expect(!!size, 1)) {\n\t\tvoid *ptr;\n\n\t\tptr = malloc(size);\n\t\tif (ptr)\n\t\t\treturn ptr;\n\n\t\tfprintf(stderr, \"failed to allocate %zu bytes\\n\", size);\n\t\tabort();\n\t}\n\n\treturn NULL;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"mainloop.h\"\n#include <sys/epoll.h>\n#include <sys/timerfd.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <string.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic struct signal_data *signal_data;\n\nint mainloop_set_signal(sigset_t *mask, mainloop_signal_func callback,\n\t\t\t\tvoid *user_data, mainloop_destroy_func destroy)\n{\n\tstruct signal_data *data;\n\n\tif (!mask || !callback)\n\t\treturn -EINVAL;\n\n\tdata = malloc(sizeof(*data));\n\tif (!data)\n\t\treturn -ENOMEM;\n\n\tmemset(data, 0, sizeof(*data));\n\tdata->callback = callback;\n\tdata->destroy = destroy;\n\tdata->user_data = user_data;\n\n\tdata->fd = -1;\n\tmemcpy(&data->mask, mask, sizeof(sigset_t));\n\n\tfree(signal_data);\n\tsignal_data = data;\n\n\treturn 0;\n}"
  },
  {
    "function_name": "mainloop_remove_timeout",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/mainloop.c",
    "lines": "373-376",
    "snippet": "int mainloop_remove_timeout(int id)\n{\n\treturn mainloop_remove_fd(id);\n}",
    "includes": [
      "#include \"mainloop.h\"",
      "#include <sys/epoll.h>",
      "#include <sys/timerfd.h>",
      "#include <sys/signalfd.h>",
      "#include <signal.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "mainloop_remove_fd",
          "args": [
            "id"
          ],
          "line": 375
        },
        "resolved": true,
        "details": {
          "function_name": "mainloop_remove_fd",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/mainloop.c",
          "lines": "251-273",
          "snippet": "int mainloop_remove_fd(int fd)\n{\n\tstruct mainloop_data *data;\n\tint err;\n\n\tif (fd < 0 || fd > MAX_MAINLOOP_ENTRIES - 1)\n\t\treturn -EINVAL;\n\n\tdata = mainloop_list[fd];\n\tif (!data)\n\t\treturn -ENXIO;\n\n\tmainloop_list[fd] = NULL;\n\n\terr = epoll_ctl(epoll_fd, EPOLL_CTL_DEL, data->fd, NULL);\n\n\tif (data->destroy)\n\t\tdata->destroy(data->user_data);\n\n\tfree(data);\n\n\treturn err;\n}",
          "includes": [
            "#include \"mainloop.h\"",
            "#include <sys/epoll.h>",
            "#include <sys/timerfd.h>",
            "#include <sys/signalfd.h>",
            "#include <signal.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define MAX_MAINLOOP_ENTRIES 128"
          ],
          "globals_used": [
            "static int epoll_fd;",
            "static struct mainloop_data *mainloop_list[MAX_MAINLOOP_ENTRIES];"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"mainloop.h\"\n#include <sys/epoll.h>\n#include <sys/timerfd.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <string.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\n#define MAX_MAINLOOP_ENTRIES 128\n\nstatic int epoll_fd;\nstatic struct mainloop_data *mainloop_list[MAX_MAINLOOP_ENTRIES];\n\nint mainloop_remove_fd(int fd)\n{\n\tstruct mainloop_data *data;\n\tint err;\n\n\tif (fd < 0 || fd > MAX_MAINLOOP_ENTRIES - 1)\n\t\treturn -EINVAL;\n\n\tdata = mainloop_list[fd];\n\tif (!data)\n\t\treturn -ENXIO;\n\n\tmainloop_list[fd] = NULL;\n\n\terr = epoll_ctl(epoll_fd, EPOLL_CTL_DEL, data->fd, NULL);\n\n\tif (data->destroy)\n\t\tdata->destroy(data->user_data);\n\n\tfree(data);\n\n\treturn err;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"mainloop.h\"\n#include <sys/epoll.h>\n#include <sys/timerfd.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <string.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nint mainloop_remove_timeout(int id)\n{\n\treturn mainloop_remove_fd(id);\n}"
  },
  {
    "function_name": "mainloop_modify_timeout",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/mainloop.c",
    "lines": "360-371",
    "snippet": "int mainloop_modify_timeout(int id, unsigned int msec)\n{\n\tif (msec > 0) {\n\t\tif (timeout_set(id, msec) < 0)\n\t\t\treturn -EIO;\n\t}\n\n\tif (mainloop_modify_fd(id, EPOLLIN | EPOLLONESHOT) < 0)\n\t\treturn -EIO;\n\n\treturn 0;\n}",
    "includes": [
      "#include \"mainloop.h\"",
      "#include <sys/epoll.h>",
      "#include <sys/timerfd.h>",
      "#include <sys/signalfd.h>",
      "#include <signal.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "mainloop_modify_fd",
          "args": [
            "id",
            "EPOLLIN | EPOLLONESHOT"
          ],
          "line": 367
        },
        "resolved": true,
        "details": {
          "function_name": "mainloop_modify_fd",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/mainloop.c",
          "lines": "225-249",
          "snippet": "int mainloop_modify_fd(int fd, uint32_t events)\n{\n\tstruct mainloop_data *data;\n\tstruct epoll_event ev;\n\tint err;\n\n\tif (fd < 0 || fd > MAX_MAINLOOP_ENTRIES - 1)\n\t\treturn -EINVAL;\n\n\tdata = mainloop_list[fd];\n\tif (!data)\n\t\treturn -ENXIO;\n\n\tmemset(&ev, 0, sizeof(ev));\n\tev.events = events;\n\tev.data.ptr = data;\n\n\terr = epoll_ctl(epoll_fd, EPOLL_CTL_MOD, data->fd, &ev);\n\tif (err < 0)\n\t\treturn err;\n\n\tdata->events = events;\n\n\treturn 0;\n}",
          "includes": [
            "#include \"mainloop.h\"",
            "#include <sys/epoll.h>",
            "#include <sys/timerfd.h>",
            "#include <sys/signalfd.h>",
            "#include <signal.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define MAX_MAINLOOP_ENTRIES 128"
          ],
          "globals_used": [
            "static int epoll_fd;",
            "static struct mainloop_data *mainloop_list[MAX_MAINLOOP_ENTRIES];"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"mainloop.h\"\n#include <sys/epoll.h>\n#include <sys/timerfd.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <string.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\n#define MAX_MAINLOOP_ENTRIES 128\n\nstatic int epoll_fd;\nstatic struct mainloop_data *mainloop_list[MAX_MAINLOOP_ENTRIES];\n\nint mainloop_modify_fd(int fd, uint32_t events)\n{\n\tstruct mainloop_data *data;\n\tstruct epoll_event ev;\n\tint err;\n\n\tif (fd < 0 || fd > MAX_MAINLOOP_ENTRIES - 1)\n\t\treturn -EINVAL;\n\n\tdata = mainloop_list[fd];\n\tif (!data)\n\t\treturn -ENXIO;\n\n\tmemset(&ev, 0, sizeof(ev));\n\tev.events = events;\n\tev.data.ptr = data;\n\n\terr = epoll_ctl(epoll_fd, EPOLL_CTL_MOD, data->fd, &ev);\n\tif (err < 0)\n\t\treturn err;\n\n\tdata->events = events;\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "timeout_set",
          "args": [
            "id",
            "msec"
          ],
          "line": 363
        },
        "resolved": true,
        "details": {
          "function_name": "timeout_set",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/mainloop.c",
          "lines": "305-317",
          "snippet": "static inline int timeout_set(int fd, unsigned int msec)\n{\n\tstruct itimerspec itimer;\n\tunsigned int sec = msec / 1000;\n\n\tmemset(&itimer, 0, sizeof(itimer));\n\titimer.it_interval.tv_sec = 0;\n\titimer.it_interval.tv_nsec = 0;\n\titimer.it_value.tv_sec = sec;\n\titimer.it_value.tv_nsec = (msec - (sec * 1000)) * 1000 * 1000;\n\n\treturn timerfd_settime(fd, 0, &itimer, NULL);\n}",
          "includes": [
            "#include \"mainloop.h\"",
            "#include <sys/epoll.h>",
            "#include <sys/timerfd.h>",
            "#include <sys/signalfd.h>",
            "#include <signal.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"mainloop.h\"\n#include <sys/epoll.h>\n#include <sys/timerfd.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <string.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic inline int timeout_set(int fd, unsigned int msec)\n{\n\tstruct itimerspec itimer;\n\tunsigned int sec = msec / 1000;\n\n\tmemset(&itimer, 0, sizeof(itimer));\n\titimer.it_interval.tv_sec = 0;\n\titimer.it_interval.tv_nsec = 0;\n\titimer.it_value.tv_sec = sec;\n\titimer.it_value.tv_nsec = (msec - (sec * 1000)) * 1000 * 1000;\n\n\treturn timerfd_settime(fd, 0, &itimer, NULL);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"mainloop.h\"\n#include <sys/epoll.h>\n#include <sys/timerfd.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <string.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nint mainloop_modify_timeout(int id, unsigned int msec)\n{\n\tif (msec > 0) {\n\t\tif (timeout_set(id, msec) < 0)\n\t\t\treturn -EIO;\n\t}\n\n\tif (mainloop_modify_fd(id, EPOLLIN | EPOLLONESHOT) < 0)\n\t\treturn -EIO;\n\n\treturn 0;\n}"
  },
  {
    "function_name": "mainloop_add_timeout",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/mainloop.c",
    "lines": "319-358",
    "snippet": "int mainloop_add_timeout(unsigned int msec, mainloop_timeout_func callback,\n\t\t\t\tvoid *user_data, mainloop_destroy_func destroy)\n{\n\tstruct timeout_data *data;\n\n\tif (!callback)\n\t\treturn -EINVAL;\n\n\tdata = malloc(sizeof(*data));\n\tif (!data)\n\t\treturn -ENOMEM;\n\n\tmemset(data, 0, sizeof(*data));\n\tdata->callback = callback;\n\tdata->destroy = destroy;\n\tdata->user_data = user_data;\n\n\tdata->fd = timerfd_create(CLOCK_MONOTONIC, TFD_NONBLOCK | TFD_CLOEXEC);\n\tif (data->fd < 0) {\n\t\tfree(data);\n\t\treturn -EIO;\n\t}\n\n\tif (msec > 0) {\n\t\tif (timeout_set(data->fd, msec) < 0) {\n\t\t\tclose(data->fd);\n\t\t\tfree(data);\n\t\t\treturn -EIO;\n\t\t}\n\t}\n\n\tif (mainloop_add_fd(data->fd, EPOLLIN | EPOLLONESHOT,\n\t\t\t\ttimeout_callback, data, timeout_destroy) < 0) {\n\t\tclose(data->fd);\n\t\tfree(data);\n\t\treturn -EIO;\n\t}\n\n\treturn data->fd;\n}",
    "includes": [
      "#include \"mainloop.h\"",
      "#include <sys/epoll.h>",
      "#include <sys/timerfd.h>",
      "#include <sys/signalfd.h>",
      "#include <signal.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "data"
          ],
          "line": 353
        },
        "resolved": true,
        "details": {
          "function_name": "bt_att_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/att.c",
          "lines": "956-985",
          "snippet": "static void bt_att_free(struct bt_att *att)\n{\n\tif (att->pending_req)\n\t\tdestroy_att_send_op(att->pending_req);\n\n\tif (att->pending_ind)\n\t\tdestroy_att_send_op(att->pending_ind);\n\n\tio_destroy(att->io);\n\tbt_crypto_unref(att->crypto);\n\n\tqueue_destroy(att->req_queue, NULL);\n\tqueue_destroy(att->ind_queue, NULL);\n\tqueue_destroy(att->write_queue, NULL);\n\tqueue_destroy(att->notify_list, NULL);\n\tqueue_destroy(att->disconn_list, NULL);\n\n\tif (att->timeout_destroy)\n\t\tatt->timeout_destroy(att->timeout_data);\n\n\tif (att->debug_destroy)\n\t\tatt->debug_destroy(att->debug_data);\n\n\tfree(att->local_sign);\n\tfree(att->remote_sign);\n\n\tfree(att->buf);\n\n\tfree(att);\n}",
          "includes": [
            "#include \"src/shared/crypto.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/l2cap.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/crypto.h\"\n#include \"src/shared/att.h\"\n#include \"lib/uuid.h\"\n#include \"lib/l2cap.h\"\n#include \"lib/bluetooth.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include <errno.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <config.h>\n\nstatic void bt_att_free(struct bt_att *att)\n{\n\tif (att->pending_req)\n\t\tdestroy_att_send_op(att->pending_req);\n\n\tif (att->pending_ind)\n\t\tdestroy_att_send_op(att->pending_ind);\n\n\tio_destroy(att->io);\n\tbt_crypto_unref(att->crypto);\n\n\tqueue_destroy(att->req_queue, NULL);\n\tqueue_destroy(att->ind_queue, NULL);\n\tqueue_destroy(att->write_queue, NULL);\n\tqueue_destroy(att->notify_list, NULL);\n\tqueue_destroy(att->disconn_list, NULL);\n\n\tif (att->timeout_destroy)\n\t\tatt->timeout_destroy(att->timeout_data);\n\n\tif (att->debug_destroy)\n\t\tatt->debug_destroy(att->debug_data);\n\n\tfree(att->local_sign);\n\tfree(att->remote_sign);\n\n\tfree(att->buf);\n\n\tfree(att);\n}"
        }
      },
      {
        "call_info": {
          "callee": "close",
          "args": [
            "data->fd"
          ],
          "line": 352
        },
        "resolved": true,
        "details": {
          "function_name": "hfp_context_close_container",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hfp.c",
          "lines": "334-347",
          "snippet": "bool hfp_context_close_container(struct hfp_context *context)\n{\n\tskip_whitespace(context);\n\n\t/* The list shall be followed by a right parenthesis (\")\" V250 5.7.3.1*/\n\tif (context->data[context->offset] != ')')\n\t\treturn false;\n\n\tcontext->offset++;\n\n\tnext_field(context);\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/hfp.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/ringbuf.h\"",
            "#include \"src/shared/util.h\"",
            "#include <ctype.h>",
            "#include <stdarg.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/hfp.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <ctype.h>\n#include <stdarg.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nbool hfp_context_close_container(struct hfp_context *context)\n{\n\tskip_whitespace(context);\n\n\t/* The list shall be followed by a right parenthesis (\")\" V250 5.7.3.1*/\n\tif (context->data[context->offset] != ')')\n\t\treturn false;\n\n\tcontext->offset++;\n\n\tnext_field(context);\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "mainloop_add_fd",
          "args": [
            "data->fd",
            "EPOLLIN | EPOLLONESHOT",
            "timeout_callback",
            "data",
            "timeout_destroy"
          ],
          "line": 350
        },
        "resolved": true,
        "details": {
          "function_name": "mainloop_add_fd",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/mainloop.c",
          "lines": "189-223",
          "snippet": "int mainloop_add_fd(int fd, uint32_t events, mainloop_event_func callback,\n\t\t\t\tvoid *user_data, mainloop_destroy_func destroy)\n{\n\tstruct mainloop_data *data;\n\tstruct epoll_event ev;\n\tint err;\n\n\tif (fd < 0 || fd > MAX_MAINLOOP_ENTRIES - 1 || !callback)\n\t\treturn -EINVAL;\n\n\tdata = malloc(sizeof(*data));\n\tif (!data)\n\t\treturn -ENOMEM;\n\n\tmemset(data, 0, sizeof(*data));\n\tdata->fd = fd;\n\tdata->events = events;\n\tdata->callback = callback;\n\tdata->destroy = destroy;\n\tdata->user_data = user_data;\n\n\tmemset(&ev, 0, sizeof(ev));\n\tev.events = events;\n\tev.data.ptr = data;\n\n\terr = epoll_ctl(epoll_fd, EPOLL_CTL_ADD, data->fd, &ev);\n\tif (err < 0) {\n\t\tfree(data);\n\t\treturn err;\n\t}\n\n\tmainloop_list[fd] = data;\n\n\treturn 0;\n}",
          "includes": [
            "#include \"mainloop.h\"",
            "#include <sys/epoll.h>",
            "#include <sys/timerfd.h>",
            "#include <sys/signalfd.h>",
            "#include <signal.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define MAX_MAINLOOP_ENTRIES 128"
          ],
          "globals_used": [
            "static int epoll_fd;",
            "static struct mainloop_data *mainloop_list[MAX_MAINLOOP_ENTRIES];"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"mainloop.h\"\n#include <sys/epoll.h>\n#include <sys/timerfd.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <string.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\n#define MAX_MAINLOOP_ENTRIES 128\n\nstatic int epoll_fd;\nstatic struct mainloop_data *mainloop_list[MAX_MAINLOOP_ENTRIES];\n\nint mainloop_add_fd(int fd, uint32_t events, mainloop_event_func callback,\n\t\t\t\tvoid *user_data, mainloop_destroy_func destroy)\n{\n\tstruct mainloop_data *data;\n\tstruct epoll_event ev;\n\tint err;\n\n\tif (fd < 0 || fd > MAX_MAINLOOP_ENTRIES - 1 || !callback)\n\t\treturn -EINVAL;\n\n\tdata = malloc(sizeof(*data));\n\tif (!data)\n\t\treturn -ENOMEM;\n\n\tmemset(data, 0, sizeof(*data));\n\tdata->fd = fd;\n\tdata->events = events;\n\tdata->callback = callback;\n\tdata->destroy = destroy;\n\tdata->user_data = user_data;\n\n\tmemset(&ev, 0, sizeof(ev));\n\tev.events = events;\n\tev.data.ptr = data;\n\n\terr = epoll_ctl(epoll_fd, EPOLL_CTL_ADD, data->fd, &ev);\n\tif (err < 0) {\n\t\tfree(data);\n\t\treturn err;\n\t}\n\n\tmainloop_list[fd] = data;\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "timeout_set",
          "args": [
            "data->fd",
            "msec"
          ],
          "line": 343
        },
        "resolved": true,
        "details": {
          "function_name": "timeout_set",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/mainloop.c",
          "lines": "305-317",
          "snippet": "static inline int timeout_set(int fd, unsigned int msec)\n{\n\tstruct itimerspec itimer;\n\tunsigned int sec = msec / 1000;\n\n\tmemset(&itimer, 0, sizeof(itimer));\n\titimer.it_interval.tv_sec = 0;\n\titimer.it_interval.tv_nsec = 0;\n\titimer.it_value.tv_sec = sec;\n\titimer.it_value.tv_nsec = (msec - (sec * 1000)) * 1000 * 1000;\n\n\treturn timerfd_settime(fd, 0, &itimer, NULL);\n}",
          "includes": [
            "#include \"mainloop.h\"",
            "#include <sys/epoll.h>",
            "#include <sys/timerfd.h>",
            "#include <sys/signalfd.h>",
            "#include <signal.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"mainloop.h\"\n#include <sys/epoll.h>\n#include <sys/timerfd.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <string.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic inline int timeout_set(int fd, unsigned int msec)\n{\n\tstruct itimerspec itimer;\n\tunsigned int sec = msec / 1000;\n\n\tmemset(&itimer, 0, sizeof(itimer));\n\titimer.it_interval.tv_sec = 0;\n\titimer.it_interval.tv_nsec = 0;\n\titimer.it_value.tv_sec = sec;\n\titimer.it_value.tv_nsec = (msec - (sec * 1000)) * 1000 * 1000;\n\n\treturn timerfd_settime(fd, 0, &itimer, NULL);\n}"
        }
      },
      {
        "call_info": {
          "callee": "timerfd_create",
          "args": [
            "CLOCK_MONOTONIC",
            "TFD_NONBLOCK | TFD_CLOEXEC"
          ],
          "line": 336
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memset",
          "args": [
            "data",
            "0",
            "sizeof(*data)"
          ],
          "line": 331
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "malloc",
          "args": [
            "sizeof(*data)"
          ],
          "line": 327
        },
        "resolved": true,
        "details": {
          "function_name": "btd_malloc",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/util.c",
          "lines": "41-55",
          "snippet": "void *btd_malloc(size_t size)\n{\n\tif (__builtin_expect(!!size, 1)) {\n\t\tvoid *ptr;\n\n\t\tptr = malloc(size);\n\t\tif (ptr)\n\t\t\treturn ptr;\n\n\t\tfprintf(stderr, \"failed to allocate %zu bytes\\n\", size);\n\t\tabort();\n\t}\n\n\treturn NULL;\n}",
          "includes": [
            "#include \"src/shared/util.h\"",
            "#include <string.h>",
            "#include <limits.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <stdbool.h>",
            "#include <stdarg.h>",
            "#include <ctype.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/util.h\"\n#include <string.h>\n#include <limits.h>\n#include <dirent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <config.h>\n\nvoid *btd_malloc(size_t size)\n{\n\tif (__builtin_expect(!!size, 1)) {\n\t\tvoid *ptr;\n\n\t\tptr = malloc(size);\n\t\tif (ptr)\n\t\t\treturn ptr;\n\n\t\tfprintf(stderr, \"failed to allocate %zu bytes\\n\", size);\n\t\tabort();\n\t}\n\n\treturn NULL;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"mainloop.h\"\n#include <sys/epoll.h>\n#include <sys/timerfd.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <string.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nint mainloop_add_timeout(unsigned int msec, mainloop_timeout_func callback,\n\t\t\t\tvoid *user_data, mainloop_destroy_func destroy)\n{\n\tstruct timeout_data *data;\n\n\tif (!callback)\n\t\treturn -EINVAL;\n\n\tdata = malloc(sizeof(*data));\n\tif (!data)\n\t\treturn -ENOMEM;\n\n\tmemset(data, 0, sizeof(*data));\n\tdata->callback = callback;\n\tdata->destroy = destroy;\n\tdata->user_data = user_data;\n\n\tdata->fd = timerfd_create(CLOCK_MONOTONIC, TFD_NONBLOCK | TFD_CLOEXEC);\n\tif (data->fd < 0) {\n\t\tfree(data);\n\t\treturn -EIO;\n\t}\n\n\tif (msec > 0) {\n\t\tif (timeout_set(data->fd, msec) < 0) {\n\t\t\tclose(data->fd);\n\t\t\tfree(data);\n\t\t\treturn -EIO;\n\t\t}\n\t}\n\n\tif (mainloop_add_fd(data->fd, EPOLLIN | EPOLLONESHOT,\n\t\t\t\ttimeout_callback, data, timeout_destroy) < 0) {\n\t\tclose(data->fd);\n\t\tfree(data);\n\t\treturn -EIO;\n\t}\n\n\treturn data->fd;\n}"
  },
  {
    "function_name": "timeout_set",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/mainloop.c",
    "lines": "305-317",
    "snippet": "static inline int timeout_set(int fd, unsigned int msec)\n{\n\tstruct itimerspec itimer;\n\tunsigned int sec = msec / 1000;\n\n\tmemset(&itimer, 0, sizeof(itimer));\n\titimer.it_interval.tv_sec = 0;\n\titimer.it_interval.tv_nsec = 0;\n\titimer.it_value.tv_sec = sec;\n\titimer.it_value.tv_nsec = (msec - (sec * 1000)) * 1000 * 1000;\n\n\treturn timerfd_settime(fd, 0, &itimer, NULL);\n}",
    "includes": [
      "#include \"mainloop.h\"",
      "#include <sys/epoll.h>",
      "#include <sys/timerfd.h>",
      "#include <sys/signalfd.h>",
      "#include <signal.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "timerfd_settime",
          "args": [
            "fd",
            "0",
            "&itimer",
            "NULL"
          ],
          "line": 316
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memset",
          "args": [
            "&itimer",
            "0",
            "sizeof(itimer)"
          ],
          "line": 310
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"mainloop.h\"\n#include <sys/epoll.h>\n#include <sys/timerfd.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <string.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic inline int timeout_set(int fd, unsigned int msec)\n{\n\tstruct itimerspec itimer;\n\tunsigned int sec = msec / 1000;\n\n\tmemset(&itimer, 0, sizeof(itimer));\n\titimer.it_interval.tv_sec = 0;\n\titimer.it_interval.tv_nsec = 0;\n\titimer.it_value.tv_sec = sec;\n\titimer.it_value.tv_nsec = (msec - (sec * 1000)) * 1000 * 1000;\n\n\treturn timerfd_settime(fd, 0, &itimer, NULL);\n}"
  },
  {
    "function_name": "timeout_callback",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/mainloop.c",
    "lines": "288-303",
    "snippet": "static void timeout_callback(int fd, uint32_t events, void *user_data)\n{\n\tstruct timeout_data *data = user_data;\n\tuint64_t expired;\n\tssize_t result;\n\n\tif (events & (EPOLLERR | EPOLLHUP))\n\t\treturn;\n\n\tresult = read(data->fd, &expired, sizeof(expired));\n\tif (result != sizeof(expired))\n\t\treturn;\n\n\tif (data->callback)\n\t\tdata->callback(data->fd, data->user_data);\n}",
    "includes": [
      "#include \"mainloop.h\"",
      "#include <sys/epoll.h>",
      "#include <sys/timerfd.h>",
      "#include <sys/signalfd.h>",
      "#include <signal.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "data->callback",
          "args": [
            "data->fd",
            "data->user_data"
          ],
          "line": 302
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "read",
          "args": [
            "data->fd",
            "&expired",
            "sizeof(expired)"
          ],
          "line": 297
        },
        "resolved": true,
        "details": {
          "function_name": "notify_client_ready",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-client.c",
          "lines": "1221-1250",
          "snippet": "static void notify_client_ready(struct bt_gatt_client *client, bool success,\n\t\t\t\t\t\t\tuint8_t att_ecode)\n{\n\tconst struct queue_entry *entry;\n\n\tif (client->ready)\n\t\treturn;\n\n\tbt_gatt_client_ref(client);\n\tclient->ready = success;\n\n\tfor (entry = queue_get_entries(client->ready_cbs); entry;\n\t\t\t\t\t\t\tentry = entry->next) {\n\t\tstruct ready_cb *ready = entry->data;\n\n\t\tready->callback(success, att_ecode, ready->data);\n\t}\n\n\tqueue_remove_all(client->ready_cbs, NULL, NULL, ready_destroy);\n\n\t/* Notify clones */\n\tfor (entry = queue_get_entries(client->clones); entry;\n\t\t\t\t\t\t\tentry = entry->next) {\n\t\tstruct bt_gatt_client *clone = entry->data;\n\n\t\tnotify_client_ready(clone, success, att_ecode);\n\t}\n\n\tbt_gatt_client_unref(client);\n}",
          "includes": [
            "#include <sys/uio.h>",
            "#include <limits.h>",
            "#include <assert.h>",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-helpers.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include \"src/shared/att.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <sys/uio.h>\n#include <limits.h>\n#include <assert.h>\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-helpers.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include \"src/shared/att.h\"\n#include <config.h>\n\nstatic void notify_client_ready(struct bt_gatt_client *client, bool success,\n\t\t\t\t\t\t\tuint8_t att_ecode)\n{\n\tconst struct queue_entry *entry;\n\n\tif (client->ready)\n\t\treturn;\n\n\tbt_gatt_client_ref(client);\n\tclient->ready = success;\n\n\tfor (entry = queue_get_entries(client->ready_cbs); entry;\n\t\t\t\t\t\t\tentry = entry->next) {\n\t\tstruct ready_cb *ready = entry->data;\n\n\t\tready->callback(success, att_ecode, ready->data);\n\t}\n\n\tqueue_remove_all(client->ready_cbs, NULL, NULL, ready_destroy);\n\n\t/* Notify clones */\n\tfor (entry = queue_get_entries(client->clones); entry;\n\t\t\t\t\t\t\tentry = entry->next) {\n\t\tstruct bt_gatt_client *clone = entry->data;\n\n\t\tnotify_client_ready(clone, success, att_ecode);\n\t}\n\n\tbt_gatt_client_unref(client);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"mainloop.h\"\n#include <sys/epoll.h>\n#include <sys/timerfd.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <string.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void timeout_callback(int fd, uint32_t events, void *user_data)\n{\n\tstruct timeout_data *data = user_data;\n\tuint64_t expired;\n\tssize_t result;\n\n\tif (events & (EPOLLERR | EPOLLHUP))\n\t\treturn;\n\n\tresult = read(data->fd, &expired, sizeof(expired));\n\tif (result != sizeof(expired))\n\t\treturn;\n\n\tif (data->callback)\n\t\tdata->callback(data->fd, data->user_data);\n}"
  },
  {
    "function_name": "timeout_destroy",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/mainloop.c",
    "lines": "275-286",
    "snippet": "static void timeout_destroy(void *user_data)\n{\n\tstruct timeout_data *data = user_data;\n\n\tclose(data->fd);\n\tdata->fd = -1;\n\n\tif (data->destroy)\n\t\tdata->destroy(data->user_data);\n\n\tfree(data);\n}",
    "includes": [
      "#include \"mainloop.h\"",
      "#include <sys/epoll.h>",
      "#include <sys/timerfd.h>",
      "#include <sys/signalfd.h>",
      "#include <signal.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "data"
          ],
          "line": 285
        },
        "resolved": true,
        "details": {
          "function_name": "bt_att_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/att.c",
          "lines": "956-985",
          "snippet": "static void bt_att_free(struct bt_att *att)\n{\n\tif (att->pending_req)\n\t\tdestroy_att_send_op(att->pending_req);\n\n\tif (att->pending_ind)\n\t\tdestroy_att_send_op(att->pending_ind);\n\n\tio_destroy(att->io);\n\tbt_crypto_unref(att->crypto);\n\n\tqueue_destroy(att->req_queue, NULL);\n\tqueue_destroy(att->ind_queue, NULL);\n\tqueue_destroy(att->write_queue, NULL);\n\tqueue_destroy(att->notify_list, NULL);\n\tqueue_destroy(att->disconn_list, NULL);\n\n\tif (att->timeout_destroy)\n\t\tatt->timeout_destroy(att->timeout_data);\n\n\tif (att->debug_destroy)\n\t\tatt->debug_destroy(att->debug_data);\n\n\tfree(att->local_sign);\n\tfree(att->remote_sign);\n\n\tfree(att->buf);\n\n\tfree(att);\n}",
          "includes": [
            "#include \"src/shared/crypto.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/l2cap.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/crypto.h\"\n#include \"src/shared/att.h\"\n#include \"lib/uuid.h\"\n#include \"lib/l2cap.h\"\n#include \"lib/bluetooth.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include <errno.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <config.h>\n\nstatic void bt_att_free(struct bt_att *att)\n{\n\tif (att->pending_req)\n\t\tdestroy_att_send_op(att->pending_req);\n\n\tif (att->pending_ind)\n\t\tdestroy_att_send_op(att->pending_ind);\n\n\tio_destroy(att->io);\n\tbt_crypto_unref(att->crypto);\n\n\tqueue_destroy(att->req_queue, NULL);\n\tqueue_destroy(att->ind_queue, NULL);\n\tqueue_destroy(att->write_queue, NULL);\n\tqueue_destroy(att->notify_list, NULL);\n\tqueue_destroy(att->disconn_list, NULL);\n\n\tif (att->timeout_destroy)\n\t\tatt->timeout_destroy(att->timeout_data);\n\n\tif (att->debug_destroy)\n\t\tatt->debug_destroy(att->debug_data);\n\n\tfree(att->local_sign);\n\tfree(att->remote_sign);\n\n\tfree(att->buf);\n\n\tfree(att);\n}"
        }
      },
      {
        "call_info": {
          "callee": "data->destroy",
          "args": [
            "data->user_data"
          ],
          "line": 283
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "close",
          "args": [
            "data->fd"
          ],
          "line": 279
        },
        "resolved": true,
        "details": {
          "function_name": "hfp_context_close_container",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hfp.c",
          "lines": "334-347",
          "snippet": "bool hfp_context_close_container(struct hfp_context *context)\n{\n\tskip_whitespace(context);\n\n\t/* The list shall be followed by a right parenthesis (\")\" V250 5.7.3.1*/\n\tif (context->data[context->offset] != ')')\n\t\treturn false;\n\n\tcontext->offset++;\n\n\tnext_field(context);\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/hfp.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/ringbuf.h\"",
            "#include \"src/shared/util.h\"",
            "#include <ctype.h>",
            "#include <stdarg.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/hfp.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <ctype.h>\n#include <stdarg.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nbool hfp_context_close_container(struct hfp_context *context)\n{\n\tskip_whitespace(context);\n\n\t/* The list shall be followed by a right parenthesis (\")\" V250 5.7.3.1*/\n\tif (context->data[context->offset] != ')')\n\t\treturn false;\n\n\tcontext->offset++;\n\n\tnext_field(context);\n\n\treturn true;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"mainloop.h\"\n#include <sys/epoll.h>\n#include <sys/timerfd.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <string.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void timeout_destroy(void *user_data)\n{\n\tstruct timeout_data *data = user_data;\n\n\tclose(data->fd);\n\tdata->fd = -1;\n\n\tif (data->destroy)\n\t\tdata->destroy(data->user_data);\n\n\tfree(data);\n}"
  },
  {
    "function_name": "mainloop_remove_fd",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/mainloop.c",
    "lines": "251-273",
    "snippet": "int mainloop_remove_fd(int fd)\n{\n\tstruct mainloop_data *data;\n\tint err;\n\n\tif (fd < 0 || fd > MAX_MAINLOOP_ENTRIES - 1)\n\t\treturn -EINVAL;\n\n\tdata = mainloop_list[fd];\n\tif (!data)\n\t\treturn -ENXIO;\n\n\tmainloop_list[fd] = NULL;\n\n\terr = epoll_ctl(epoll_fd, EPOLL_CTL_DEL, data->fd, NULL);\n\n\tif (data->destroy)\n\t\tdata->destroy(data->user_data);\n\n\tfree(data);\n\n\treturn err;\n}",
    "includes": [
      "#include \"mainloop.h\"",
      "#include <sys/epoll.h>",
      "#include <sys/timerfd.h>",
      "#include <sys/signalfd.h>",
      "#include <signal.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define MAX_MAINLOOP_ENTRIES 128"
    ],
    "globals_used": [
      "static int epoll_fd;",
      "static struct mainloop_data *mainloop_list[MAX_MAINLOOP_ENTRIES];"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "data"
          ],
          "line": 270
        },
        "resolved": true,
        "details": {
          "function_name": "bt_att_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/att.c",
          "lines": "956-985",
          "snippet": "static void bt_att_free(struct bt_att *att)\n{\n\tif (att->pending_req)\n\t\tdestroy_att_send_op(att->pending_req);\n\n\tif (att->pending_ind)\n\t\tdestroy_att_send_op(att->pending_ind);\n\n\tio_destroy(att->io);\n\tbt_crypto_unref(att->crypto);\n\n\tqueue_destroy(att->req_queue, NULL);\n\tqueue_destroy(att->ind_queue, NULL);\n\tqueue_destroy(att->write_queue, NULL);\n\tqueue_destroy(att->notify_list, NULL);\n\tqueue_destroy(att->disconn_list, NULL);\n\n\tif (att->timeout_destroy)\n\t\tatt->timeout_destroy(att->timeout_data);\n\n\tif (att->debug_destroy)\n\t\tatt->debug_destroy(att->debug_data);\n\n\tfree(att->local_sign);\n\tfree(att->remote_sign);\n\n\tfree(att->buf);\n\n\tfree(att);\n}",
          "includes": [
            "#include \"src/shared/crypto.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/l2cap.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/crypto.h\"\n#include \"src/shared/att.h\"\n#include \"lib/uuid.h\"\n#include \"lib/l2cap.h\"\n#include \"lib/bluetooth.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include <errno.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <config.h>\n\nstatic void bt_att_free(struct bt_att *att)\n{\n\tif (att->pending_req)\n\t\tdestroy_att_send_op(att->pending_req);\n\n\tif (att->pending_ind)\n\t\tdestroy_att_send_op(att->pending_ind);\n\n\tio_destroy(att->io);\n\tbt_crypto_unref(att->crypto);\n\n\tqueue_destroy(att->req_queue, NULL);\n\tqueue_destroy(att->ind_queue, NULL);\n\tqueue_destroy(att->write_queue, NULL);\n\tqueue_destroy(att->notify_list, NULL);\n\tqueue_destroy(att->disconn_list, NULL);\n\n\tif (att->timeout_destroy)\n\t\tatt->timeout_destroy(att->timeout_data);\n\n\tif (att->debug_destroy)\n\t\tatt->debug_destroy(att->debug_data);\n\n\tfree(att->local_sign);\n\tfree(att->remote_sign);\n\n\tfree(att->buf);\n\n\tfree(att);\n}"
        }
      },
      {
        "call_info": {
          "callee": "data->destroy",
          "args": [
            "data->user_data"
          ],
          "line": 268
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "epoll_ctl",
          "args": [
            "epoll_fd",
            "EPOLL_CTL_DEL",
            "data->fd",
            "NULL"
          ],
          "line": 265
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"mainloop.h\"\n#include <sys/epoll.h>\n#include <sys/timerfd.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <string.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\n#define MAX_MAINLOOP_ENTRIES 128\n\nstatic int epoll_fd;\nstatic struct mainloop_data *mainloop_list[MAX_MAINLOOP_ENTRIES];\n\nint mainloop_remove_fd(int fd)\n{\n\tstruct mainloop_data *data;\n\tint err;\n\n\tif (fd < 0 || fd > MAX_MAINLOOP_ENTRIES - 1)\n\t\treturn -EINVAL;\n\n\tdata = mainloop_list[fd];\n\tif (!data)\n\t\treturn -ENXIO;\n\n\tmainloop_list[fd] = NULL;\n\n\terr = epoll_ctl(epoll_fd, EPOLL_CTL_DEL, data->fd, NULL);\n\n\tif (data->destroy)\n\t\tdata->destroy(data->user_data);\n\n\tfree(data);\n\n\treturn err;\n}"
  },
  {
    "function_name": "mainloop_modify_fd",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/mainloop.c",
    "lines": "225-249",
    "snippet": "int mainloop_modify_fd(int fd, uint32_t events)\n{\n\tstruct mainloop_data *data;\n\tstruct epoll_event ev;\n\tint err;\n\n\tif (fd < 0 || fd > MAX_MAINLOOP_ENTRIES - 1)\n\t\treturn -EINVAL;\n\n\tdata = mainloop_list[fd];\n\tif (!data)\n\t\treturn -ENXIO;\n\n\tmemset(&ev, 0, sizeof(ev));\n\tev.events = events;\n\tev.data.ptr = data;\n\n\terr = epoll_ctl(epoll_fd, EPOLL_CTL_MOD, data->fd, &ev);\n\tif (err < 0)\n\t\treturn err;\n\n\tdata->events = events;\n\n\treturn 0;\n}",
    "includes": [
      "#include \"mainloop.h\"",
      "#include <sys/epoll.h>",
      "#include <sys/timerfd.h>",
      "#include <sys/signalfd.h>",
      "#include <signal.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define MAX_MAINLOOP_ENTRIES 128"
    ],
    "globals_used": [
      "static int epoll_fd;",
      "static struct mainloop_data *mainloop_list[MAX_MAINLOOP_ENTRIES];"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "epoll_ctl",
          "args": [
            "epoll_fd",
            "EPOLL_CTL_MOD",
            "data->fd",
            "&ev"
          ],
          "line": 242
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memset",
          "args": [
            "&ev",
            "0",
            "sizeof(ev)"
          ],
          "line": 238
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"mainloop.h\"\n#include <sys/epoll.h>\n#include <sys/timerfd.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <string.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\n#define MAX_MAINLOOP_ENTRIES 128\n\nstatic int epoll_fd;\nstatic struct mainloop_data *mainloop_list[MAX_MAINLOOP_ENTRIES];\n\nint mainloop_modify_fd(int fd, uint32_t events)\n{\n\tstruct mainloop_data *data;\n\tstruct epoll_event ev;\n\tint err;\n\n\tif (fd < 0 || fd > MAX_MAINLOOP_ENTRIES - 1)\n\t\treturn -EINVAL;\n\n\tdata = mainloop_list[fd];\n\tif (!data)\n\t\treturn -ENXIO;\n\n\tmemset(&ev, 0, sizeof(ev));\n\tev.events = events;\n\tev.data.ptr = data;\n\n\terr = epoll_ctl(epoll_fd, EPOLL_CTL_MOD, data->fd, &ev);\n\tif (err < 0)\n\t\treturn err;\n\n\tdata->events = events;\n\n\treturn 0;\n}"
  },
  {
    "function_name": "mainloop_add_fd",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/mainloop.c",
    "lines": "189-223",
    "snippet": "int mainloop_add_fd(int fd, uint32_t events, mainloop_event_func callback,\n\t\t\t\tvoid *user_data, mainloop_destroy_func destroy)\n{\n\tstruct mainloop_data *data;\n\tstruct epoll_event ev;\n\tint err;\n\n\tif (fd < 0 || fd > MAX_MAINLOOP_ENTRIES - 1 || !callback)\n\t\treturn -EINVAL;\n\n\tdata = malloc(sizeof(*data));\n\tif (!data)\n\t\treturn -ENOMEM;\n\n\tmemset(data, 0, sizeof(*data));\n\tdata->fd = fd;\n\tdata->events = events;\n\tdata->callback = callback;\n\tdata->destroy = destroy;\n\tdata->user_data = user_data;\n\n\tmemset(&ev, 0, sizeof(ev));\n\tev.events = events;\n\tev.data.ptr = data;\n\n\terr = epoll_ctl(epoll_fd, EPOLL_CTL_ADD, data->fd, &ev);\n\tif (err < 0) {\n\t\tfree(data);\n\t\treturn err;\n\t}\n\n\tmainloop_list[fd] = data;\n\n\treturn 0;\n}",
    "includes": [
      "#include \"mainloop.h\"",
      "#include <sys/epoll.h>",
      "#include <sys/timerfd.h>",
      "#include <sys/signalfd.h>",
      "#include <signal.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define MAX_MAINLOOP_ENTRIES 128"
    ],
    "globals_used": [
      "static int epoll_fd;",
      "static struct mainloop_data *mainloop_list[MAX_MAINLOOP_ENTRIES];"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "data"
          ],
          "line": 216
        },
        "resolved": true,
        "details": {
          "function_name": "bt_att_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/att.c",
          "lines": "956-985",
          "snippet": "static void bt_att_free(struct bt_att *att)\n{\n\tif (att->pending_req)\n\t\tdestroy_att_send_op(att->pending_req);\n\n\tif (att->pending_ind)\n\t\tdestroy_att_send_op(att->pending_ind);\n\n\tio_destroy(att->io);\n\tbt_crypto_unref(att->crypto);\n\n\tqueue_destroy(att->req_queue, NULL);\n\tqueue_destroy(att->ind_queue, NULL);\n\tqueue_destroy(att->write_queue, NULL);\n\tqueue_destroy(att->notify_list, NULL);\n\tqueue_destroy(att->disconn_list, NULL);\n\n\tif (att->timeout_destroy)\n\t\tatt->timeout_destroy(att->timeout_data);\n\n\tif (att->debug_destroy)\n\t\tatt->debug_destroy(att->debug_data);\n\n\tfree(att->local_sign);\n\tfree(att->remote_sign);\n\n\tfree(att->buf);\n\n\tfree(att);\n}",
          "includes": [
            "#include \"src/shared/crypto.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/l2cap.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/crypto.h\"\n#include \"src/shared/att.h\"\n#include \"lib/uuid.h\"\n#include \"lib/l2cap.h\"\n#include \"lib/bluetooth.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include <errno.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <config.h>\n\nstatic void bt_att_free(struct bt_att *att)\n{\n\tif (att->pending_req)\n\t\tdestroy_att_send_op(att->pending_req);\n\n\tif (att->pending_ind)\n\t\tdestroy_att_send_op(att->pending_ind);\n\n\tio_destroy(att->io);\n\tbt_crypto_unref(att->crypto);\n\n\tqueue_destroy(att->req_queue, NULL);\n\tqueue_destroy(att->ind_queue, NULL);\n\tqueue_destroy(att->write_queue, NULL);\n\tqueue_destroy(att->notify_list, NULL);\n\tqueue_destroy(att->disconn_list, NULL);\n\n\tif (att->timeout_destroy)\n\t\tatt->timeout_destroy(att->timeout_data);\n\n\tif (att->debug_destroy)\n\t\tatt->debug_destroy(att->debug_data);\n\n\tfree(att->local_sign);\n\tfree(att->remote_sign);\n\n\tfree(att->buf);\n\n\tfree(att);\n}"
        }
      },
      {
        "call_info": {
          "callee": "epoll_ctl",
          "args": [
            "epoll_fd",
            "EPOLL_CTL_ADD",
            "data->fd",
            "&ev"
          ],
          "line": 214
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memset",
          "args": [
            "&ev",
            "0",
            "sizeof(ev)"
          ],
          "line": 210
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memset",
          "args": [
            "data",
            "0",
            "sizeof(*data)"
          ],
          "line": 203
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "malloc",
          "args": [
            "sizeof(*data)"
          ],
          "line": 199
        },
        "resolved": true,
        "details": {
          "function_name": "btd_malloc",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/util.c",
          "lines": "41-55",
          "snippet": "void *btd_malloc(size_t size)\n{\n\tif (__builtin_expect(!!size, 1)) {\n\t\tvoid *ptr;\n\n\t\tptr = malloc(size);\n\t\tif (ptr)\n\t\t\treturn ptr;\n\n\t\tfprintf(stderr, \"failed to allocate %zu bytes\\n\", size);\n\t\tabort();\n\t}\n\n\treturn NULL;\n}",
          "includes": [
            "#include \"src/shared/util.h\"",
            "#include <string.h>",
            "#include <limits.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <stdbool.h>",
            "#include <stdarg.h>",
            "#include <ctype.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/util.h\"\n#include <string.h>\n#include <limits.h>\n#include <dirent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <config.h>\n\nvoid *btd_malloc(size_t size)\n{\n\tif (__builtin_expect(!!size, 1)) {\n\t\tvoid *ptr;\n\n\t\tptr = malloc(size);\n\t\tif (ptr)\n\t\t\treturn ptr;\n\n\t\tfprintf(stderr, \"failed to allocate %zu bytes\\n\", size);\n\t\tabort();\n\t}\n\n\treturn NULL;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"mainloop.h\"\n#include <sys/epoll.h>\n#include <sys/timerfd.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <string.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\n#define MAX_MAINLOOP_ENTRIES 128\n\nstatic int epoll_fd;\nstatic struct mainloop_data *mainloop_list[MAX_MAINLOOP_ENTRIES];\n\nint mainloop_add_fd(int fd, uint32_t events, mainloop_event_func callback,\n\t\t\t\tvoid *user_data, mainloop_destroy_func destroy)\n{\n\tstruct mainloop_data *data;\n\tstruct epoll_event ev;\n\tint err;\n\n\tif (fd < 0 || fd > MAX_MAINLOOP_ENTRIES - 1 || !callback)\n\t\treturn -EINVAL;\n\n\tdata = malloc(sizeof(*data));\n\tif (!data)\n\t\treturn -ENOMEM;\n\n\tmemset(data, 0, sizeof(*data));\n\tdata->fd = fd;\n\tdata->events = events;\n\tdata->callback = callback;\n\tdata->destroy = destroy;\n\tdata->user_data = user_data;\n\n\tmemset(&ev, 0, sizeof(ev));\n\tev.events = events;\n\tev.data.ptr = data;\n\n\terr = epoll_ctl(epoll_fd, EPOLL_CTL_ADD, data->fd, &ev);\n\tif (err < 0) {\n\t\tfree(data);\n\t\treturn err;\n\t}\n\n\tmainloop_list[fd] = data;\n\n\treturn 0;\n}"
  },
  {
    "function_name": "mainloop_run",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/mainloop.c",
    "lines": "124-187",
    "snippet": "int mainloop_run(void)\n{\n\tunsigned int i;\n\n\tif (signal_data) {\n\t\tif (sigprocmask(SIG_BLOCK, &signal_data->mask, NULL) < 0)\n\t\t\treturn EXIT_FAILURE;\n\n\t\tsignal_data->fd = signalfd(-1, &signal_data->mask,\n\t\t\t\t\t\tSFD_NONBLOCK | SFD_CLOEXEC);\n\t\tif (signal_data->fd < 0)\n\t\t\treturn EXIT_FAILURE;\n\n\t\tif (mainloop_add_fd(signal_data->fd, EPOLLIN,\n\t\t\t\tsignal_callback, signal_data, NULL) < 0) {\n\t\t\tclose(signal_data->fd);\n\t\t\treturn EXIT_FAILURE;\n\t\t}\n\t}\n\n\twhile (!epoll_terminate) {\n\t\tstruct epoll_event events[MAX_EPOLL_EVENTS];\n\t\tint n, nfds;\n\n\t\tnfds = epoll_wait(epoll_fd, events, MAX_EPOLL_EVENTS, -1);\n\t\tif (nfds < 0)\n\t\t\tcontinue;\n\n\t\tfor (n = 0; n < nfds; n++) {\n\t\t\tstruct mainloop_data *data = events[n].data.ptr;\n\n\t\t\tdata->callback(data->fd, events[n].events,\n\t\t\t\t\t\t\tdata->user_data);\n\t\t}\n\t}\n\n\tif (signal_data) {\n\t\tmainloop_remove_fd(signal_data->fd);\n\t\tclose(signal_data->fd);\n\n\t\tif (signal_data->destroy)\n\t\t\tsignal_data->destroy(signal_data->user_data);\n\t}\n\n\tfor (i = 0; i < MAX_MAINLOOP_ENTRIES; i++) {\n\t\tstruct mainloop_data *data = mainloop_list[i];\n\n\t\tmainloop_list[i] = NULL;\n\n\t\tif (data) {\n\t\t\tepoll_ctl(epoll_fd, EPOLL_CTL_DEL, data->fd, NULL);\n\n\t\t\tif (data->destroy)\n\t\t\t\tdata->destroy(data->user_data);\n\n\t\t\tfree(data);\n\t\t}\n\t}\n\n\tclose(epoll_fd);\n\tepoll_fd = 0;\n\n\treturn exit_status;\n}",
    "includes": [
      "#include \"mainloop.h\"",
      "#include <sys/epoll.h>",
      "#include <sys/timerfd.h>",
      "#include <sys/signalfd.h>",
      "#include <signal.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define MAX_MAINLOOP_ENTRIES 128",
      "#define MAX_EPOLL_EVENTS 10"
    ],
    "globals_used": [
      "static int epoll_fd;",
      "static int epoll_terminate;",
      "static int exit_status = EXIT_SUCCESS;",
      "static struct mainloop_data *mainloop_list[MAX_MAINLOOP_ENTRIES];",
      "static struct signal_data *signal_data;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "close",
          "args": [
            "epoll_fd"
          ],
          "line": 183
        },
        "resolved": true,
        "details": {
          "function_name": "hfp_context_close_container",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hfp.c",
          "lines": "334-347",
          "snippet": "bool hfp_context_close_container(struct hfp_context *context)\n{\n\tskip_whitespace(context);\n\n\t/* The list shall be followed by a right parenthesis (\")\" V250 5.7.3.1*/\n\tif (context->data[context->offset] != ')')\n\t\treturn false;\n\n\tcontext->offset++;\n\n\tnext_field(context);\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/hfp.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/ringbuf.h\"",
            "#include \"src/shared/util.h\"",
            "#include <ctype.h>",
            "#include <stdarg.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/hfp.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <ctype.h>\n#include <stdarg.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nbool hfp_context_close_container(struct hfp_context *context)\n{\n\tskip_whitespace(context);\n\n\t/* The list shall be followed by a right parenthesis (\")\" V250 5.7.3.1*/\n\tif (context->data[context->offset] != ')')\n\t\treturn false;\n\n\tcontext->offset++;\n\n\tnext_field(context);\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "free",
          "args": [
            "data"
          ],
          "line": 179
        },
        "resolved": true,
        "details": {
          "function_name": "bt_att_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/att.c",
          "lines": "956-985",
          "snippet": "static void bt_att_free(struct bt_att *att)\n{\n\tif (att->pending_req)\n\t\tdestroy_att_send_op(att->pending_req);\n\n\tif (att->pending_ind)\n\t\tdestroy_att_send_op(att->pending_ind);\n\n\tio_destroy(att->io);\n\tbt_crypto_unref(att->crypto);\n\n\tqueue_destroy(att->req_queue, NULL);\n\tqueue_destroy(att->ind_queue, NULL);\n\tqueue_destroy(att->write_queue, NULL);\n\tqueue_destroy(att->notify_list, NULL);\n\tqueue_destroy(att->disconn_list, NULL);\n\n\tif (att->timeout_destroy)\n\t\tatt->timeout_destroy(att->timeout_data);\n\n\tif (att->debug_destroy)\n\t\tatt->debug_destroy(att->debug_data);\n\n\tfree(att->local_sign);\n\tfree(att->remote_sign);\n\n\tfree(att->buf);\n\n\tfree(att);\n}",
          "includes": [
            "#include \"src/shared/crypto.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/l2cap.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/crypto.h\"\n#include \"src/shared/att.h\"\n#include \"lib/uuid.h\"\n#include \"lib/l2cap.h\"\n#include \"lib/bluetooth.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include <errno.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <config.h>\n\nstatic void bt_att_free(struct bt_att *att)\n{\n\tif (att->pending_req)\n\t\tdestroy_att_send_op(att->pending_req);\n\n\tif (att->pending_ind)\n\t\tdestroy_att_send_op(att->pending_ind);\n\n\tio_destroy(att->io);\n\tbt_crypto_unref(att->crypto);\n\n\tqueue_destroy(att->req_queue, NULL);\n\tqueue_destroy(att->ind_queue, NULL);\n\tqueue_destroy(att->write_queue, NULL);\n\tqueue_destroy(att->notify_list, NULL);\n\tqueue_destroy(att->disconn_list, NULL);\n\n\tif (att->timeout_destroy)\n\t\tatt->timeout_destroy(att->timeout_data);\n\n\tif (att->debug_destroy)\n\t\tatt->debug_destroy(att->debug_data);\n\n\tfree(att->local_sign);\n\tfree(att->remote_sign);\n\n\tfree(att->buf);\n\n\tfree(att);\n}"
        }
      },
      {
        "call_info": {
          "callee": "data->destroy",
          "args": [
            "data->user_data"
          ],
          "line": 177
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "epoll_ctl",
          "args": [
            "epoll_fd",
            "EPOLL_CTL_DEL",
            "data->fd",
            "NULL"
          ],
          "line": 174
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "signal_data->destroy",
          "args": [
            "signal_data->user_data"
          ],
          "line": 165
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "mainloop_remove_fd",
          "args": [
            "signal_data->fd"
          ],
          "line": 161
        },
        "resolved": true,
        "details": {
          "function_name": "mainloop_remove_fd",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/mainloop.c",
          "lines": "251-273",
          "snippet": "int mainloop_remove_fd(int fd)\n{\n\tstruct mainloop_data *data;\n\tint err;\n\n\tif (fd < 0 || fd > MAX_MAINLOOP_ENTRIES - 1)\n\t\treturn -EINVAL;\n\n\tdata = mainloop_list[fd];\n\tif (!data)\n\t\treturn -ENXIO;\n\n\tmainloop_list[fd] = NULL;\n\n\terr = epoll_ctl(epoll_fd, EPOLL_CTL_DEL, data->fd, NULL);\n\n\tif (data->destroy)\n\t\tdata->destroy(data->user_data);\n\n\tfree(data);\n\n\treturn err;\n}",
          "includes": [
            "#include \"mainloop.h\"",
            "#include <sys/epoll.h>",
            "#include <sys/timerfd.h>",
            "#include <sys/signalfd.h>",
            "#include <signal.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define MAX_MAINLOOP_ENTRIES 128"
          ],
          "globals_used": [
            "static int epoll_fd;",
            "static struct mainloop_data *mainloop_list[MAX_MAINLOOP_ENTRIES];"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"mainloop.h\"\n#include <sys/epoll.h>\n#include <sys/timerfd.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <string.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\n#define MAX_MAINLOOP_ENTRIES 128\n\nstatic int epoll_fd;\nstatic struct mainloop_data *mainloop_list[MAX_MAINLOOP_ENTRIES];\n\nint mainloop_remove_fd(int fd)\n{\n\tstruct mainloop_data *data;\n\tint err;\n\n\tif (fd < 0 || fd > MAX_MAINLOOP_ENTRIES - 1)\n\t\treturn -EINVAL;\n\n\tdata = mainloop_list[fd];\n\tif (!data)\n\t\treturn -ENXIO;\n\n\tmainloop_list[fd] = NULL;\n\n\terr = epoll_ctl(epoll_fd, EPOLL_CTL_DEL, data->fd, NULL);\n\n\tif (data->destroy)\n\t\tdata->destroy(data->user_data);\n\n\tfree(data);\n\n\treturn err;\n}"
        }
      },
      {
        "call_info": {
          "callee": "data->callback",
          "args": [
            "data->fd",
            "events[n].events",
            "data->user_data"
          ],
          "line": 155
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "epoll_wait",
          "args": [
            "epoll_fd",
            "events",
            "MAX_EPOLL_EVENTS",
            "-1"
          ],
          "line": 148
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "mainloop_add_fd",
          "args": [
            "signal_data->fd",
            "EPOLLIN",
            "signal_callback",
            "signal_data",
            "NULL"
          ],
          "line": 137
        },
        "resolved": true,
        "details": {
          "function_name": "mainloop_add_fd",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/mainloop.c",
          "lines": "189-223",
          "snippet": "int mainloop_add_fd(int fd, uint32_t events, mainloop_event_func callback,\n\t\t\t\tvoid *user_data, mainloop_destroy_func destroy)\n{\n\tstruct mainloop_data *data;\n\tstruct epoll_event ev;\n\tint err;\n\n\tif (fd < 0 || fd > MAX_MAINLOOP_ENTRIES - 1 || !callback)\n\t\treturn -EINVAL;\n\n\tdata = malloc(sizeof(*data));\n\tif (!data)\n\t\treturn -ENOMEM;\n\n\tmemset(data, 0, sizeof(*data));\n\tdata->fd = fd;\n\tdata->events = events;\n\tdata->callback = callback;\n\tdata->destroy = destroy;\n\tdata->user_data = user_data;\n\n\tmemset(&ev, 0, sizeof(ev));\n\tev.events = events;\n\tev.data.ptr = data;\n\n\terr = epoll_ctl(epoll_fd, EPOLL_CTL_ADD, data->fd, &ev);\n\tif (err < 0) {\n\t\tfree(data);\n\t\treturn err;\n\t}\n\n\tmainloop_list[fd] = data;\n\n\treturn 0;\n}",
          "includes": [
            "#include \"mainloop.h\"",
            "#include <sys/epoll.h>",
            "#include <sys/timerfd.h>",
            "#include <sys/signalfd.h>",
            "#include <signal.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define MAX_MAINLOOP_ENTRIES 128"
          ],
          "globals_used": [
            "static int epoll_fd;",
            "static struct mainloop_data *mainloop_list[MAX_MAINLOOP_ENTRIES];"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"mainloop.h\"\n#include <sys/epoll.h>\n#include <sys/timerfd.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <string.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\n#define MAX_MAINLOOP_ENTRIES 128\n\nstatic int epoll_fd;\nstatic struct mainloop_data *mainloop_list[MAX_MAINLOOP_ENTRIES];\n\nint mainloop_add_fd(int fd, uint32_t events, mainloop_event_func callback,\n\t\t\t\tvoid *user_data, mainloop_destroy_func destroy)\n{\n\tstruct mainloop_data *data;\n\tstruct epoll_event ev;\n\tint err;\n\n\tif (fd < 0 || fd > MAX_MAINLOOP_ENTRIES - 1 || !callback)\n\t\treturn -EINVAL;\n\n\tdata = malloc(sizeof(*data));\n\tif (!data)\n\t\treturn -ENOMEM;\n\n\tmemset(data, 0, sizeof(*data));\n\tdata->fd = fd;\n\tdata->events = events;\n\tdata->callback = callback;\n\tdata->destroy = destroy;\n\tdata->user_data = user_data;\n\n\tmemset(&ev, 0, sizeof(ev));\n\tev.events = events;\n\tev.data.ptr = data;\n\n\terr = epoll_ctl(epoll_fd, EPOLL_CTL_ADD, data->fd, &ev);\n\tif (err < 0) {\n\t\tfree(data);\n\t\treturn err;\n\t}\n\n\tmainloop_list[fd] = data;\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "signalfd",
          "args": [
            "-1",
            "&signal_data->mask",
            "SFD_NONBLOCK | SFD_CLOEXEC"
          ],
          "line": 132
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sigprocmask",
          "args": [
            "SIG_BLOCK",
            "&signal_data->mask",
            "NULL"
          ],
          "line": 129
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"mainloop.h\"\n#include <sys/epoll.h>\n#include <sys/timerfd.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <string.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\n#define MAX_MAINLOOP_ENTRIES 128\n#define MAX_EPOLL_EVENTS 10\n\nstatic int epoll_fd;\nstatic int epoll_terminate;\nstatic int exit_status = EXIT_SUCCESS;\nstatic struct mainloop_data *mainloop_list[MAX_MAINLOOP_ENTRIES];\nstatic struct signal_data *signal_data;\n\nint mainloop_run(void)\n{\n\tunsigned int i;\n\n\tif (signal_data) {\n\t\tif (sigprocmask(SIG_BLOCK, &signal_data->mask, NULL) < 0)\n\t\t\treturn EXIT_FAILURE;\n\n\t\tsignal_data->fd = signalfd(-1, &signal_data->mask,\n\t\t\t\t\t\tSFD_NONBLOCK | SFD_CLOEXEC);\n\t\tif (signal_data->fd < 0)\n\t\t\treturn EXIT_FAILURE;\n\n\t\tif (mainloop_add_fd(signal_data->fd, EPOLLIN,\n\t\t\t\tsignal_callback, signal_data, NULL) < 0) {\n\t\t\tclose(signal_data->fd);\n\t\t\treturn EXIT_FAILURE;\n\t\t}\n\t}\n\n\twhile (!epoll_terminate) {\n\t\tstruct epoll_event events[MAX_EPOLL_EVENTS];\n\t\tint n, nfds;\n\n\t\tnfds = epoll_wait(epoll_fd, events, MAX_EPOLL_EVENTS, -1);\n\t\tif (nfds < 0)\n\t\t\tcontinue;\n\n\t\tfor (n = 0; n < nfds; n++) {\n\t\t\tstruct mainloop_data *data = events[n].data.ptr;\n\n\t\t\tdata->callback(data->fd, events[n].events,\n\t\t\t\t\t\t\tdata->user_data);\n\t\t}\n\t}\n\n\tif (signal_data) {\n\t\tmainloop_remove_fd(signal_data->fd);\n\t\tclose(signal_data->fd);\n\n\t\tif (signal_data->destroy)\n\t\t\tsignal_data->destroy(signal_data->user_data);\n\t}\n\n\tfor (i = 0; i < MAX_MAINLOOP_ENTRIES; i++) {\n\t\tstruct mainloop_data *data = mainloop_list[i];\n\n\t\tmainloop_list[i] = NULL;\n\n\t\tif (data) {\n\t\t\tepoll_ctl(epoll_fd, EPOLL_CTL_DEL, data->fd, NULL);\n\n\t\t\tif (data->destroy)\n\t\t\t\tdata->destroy(data->user_data);\n\n\t\t\tfree(data);\n\t\t}\n\t}\n\n\tclose(epoll_fd);\n\tepoll_fd = 0;\n\n\treturn exit_status;\n}"
  },
  {
    "function_name": "signal_callback",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/mainloop.c",
    "lines": "105-122",
    "snippet": "static void signal_callback(int fd, uint32_t events, void *user_data)\n{\n\tstruct signal_data *data = user_data;\n\tstruct signalfd_siginfo si;\n\tssize_t result;\n\n\tif (events & (EPOLLERR | EPOLLHUP)) {\n\t\tmainloop_quit();\n\t\treturn;\n\t}\n\n\tresult = read(fd, &si, sizeof(si));\n\tif (result != sizeof(si))\n\t\treturn;\n\n\tif (data->callback)\n\t\tdata->callback(si.ssi_signo, data->user_data);\n}",
    "includes": [
      "#include \"mainloop.h\"",
      "#include <sys/epoll.h>",
      "#include <sys/timerfd.h>",
      "#include <sys/signalfd.h>",
      "#include <signal.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static struct signal_data *signal_data;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "data->callback",
          "args": [
            "si.ssi_signo",
            "data->user_data"
          ],
          "line": 121
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "read",
          "args": [
            "fd",
            "&si",
            "sizeof(si)"
          ],
          "line": 116
        },
        "resolved": true,
        "details": {
          "function_name": "notify_client_ready",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-client.c",
          "lines": "1221-1250",
          "snippet": "static void notify_client_ready(struct bt_gatt_client *client, bool success,\n\t\t\t\t\t\t\tuint8_t att_ecode)\n{\n\tconst struct queue_entry *entry;\n\n\tif (client->ready)\n\t\treturn;\n\n\tbt_gatt_client_ref(client);\n\tclient->ready = success;\n\n\tfor (entry = queue_get_entries(client->ready_cbs); entry;\n\t\t\t\t\t\t\tentry = entry->next) {\n\t\tstruct ready_cb *ready = entry->data;\n\n\t\tready->callback(success, att_ecode, ready->data);\n\t}\n\n\tqueue_remove_all(client->ready_cbs, NULL, NULL, ready_destroy);\n\n\t/* Notify clones */\n\tfor (entry = queue_get_entries(client->clones); entry;\n\t\t\t\t\t\t\tentry = entry->next) {\n\t\tstruct bt_gatt_client *clone = entry->data;\n\n\t\tnotify_client_ready(clone, success, att_ecode);\n\t}\n\n\tbt_gatt_client_unref(client);\n}",
          "includes": [
            "#include <sys/uio.h>",
            "#include <limits.h>",
            "#include <assert.h>",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-helpers.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include \"src/shared/att.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <sys/uio.h>\n#include <limits.h>\n#include <assert.h>\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-helpers.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include \"src/shared/att.h\"\n#include <config.h>\n\nstatic void notify_client_ready(struct bt_gatt_client *client, bool success,\n\t\t\t\t\t\t\tuint8_t att_ecode)\n{\n\tconst struct queue_entry *entry;\n\n\tif (client->ready)\n\t\treturn;\n\n\tbt_gatt_client_ref(client);\n\tclient->ready = success;\n\n\tfor (entry = queue_get_entries(client->ready_cbs); entry;\n\t\t\t\t\t\t\tentry = entry->next) {\n\t\tstruct ready_cb *ready = entry->data;\n\n\t\tready->callback(success, att_ecode, ready->data);\n\t}\n\n\tqueue_remove_all(client->ready_cbs, NULL, NULL, ready_destroy);\n\n\t/* Notify clones */\n\tfor (entry = queue_get_entries(client->clones); entry;\n\t\t\t\t\t\t\tentry = entry->next) {\n\t\tstruct bt_gatt_client *clone = entry->data;\n\n\t\tnotify_client_ready(clone, success, att_ecode);\n\t}\n\n\tbt_gatt_client_unref(client);\n}"
        }
      },
      {
        "call_info": {
          "callee": "mainloop_quit",
          "args": [],
          "line": 112
        },
        "resolved": true,
        "details": {
          "function_name": "mainloop_quit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/mainloop.c",
          "lines": "88-91",
          "snippet": "void mainloop_quit(void)\n{\n\tepoll_terminate = 1;\n}",
          "includes": [
            "#include \"mainloop.h\"",
            "#include <sys/epoll.h>",
            "#include <sys/timerfd.h>",
            "#include <sys/signalfd.h>",
            "#include <signal.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int epoll_terminate;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"mainloop.h\"\n#include <sys/epoll.h>\n#include <sys/timerfd.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <string.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic int epoll_terminate;\n\nvoid mainloop_quit(void)\n{\n\tepoll_terminate = 1;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"mainloop.h\"\n#include <sys/epoll.h>\n#include <sys/timerfd.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <string.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic struct signal_data *signal_data;\n\nstatic void signal_callback(int fd, uint32_t events, void *user_data)\n{\n\tstruct signal_data *data = user_data;\n\tstruct signalfd_siginfo si;\n\tssize_t result;\n\n\tif (events & (EPOLLERR | EPOLLHUP)) {\n\t\tmainloop_quit();\n\t\treturn;\n\t}\n\n\tresult = read(fd, &si, sizeof(si));\n\tif (result != sizeof(si))\n\t\treturn;\n\n\tif (data->callback)\n\t\tdata->callback(si.ssi_signo, data->user_data);\n}"
  },
  {
    "function_name": "mainloop_exit_failure",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/mainloop.c",
    "lines": "99-103",
    "snippet": "void mainloop_exit_failure(void)\n{\n\texit_status = EXIT_FAILURE;\n\tepoll_terminate = 1;\n}",
    "includes": [
      "#include \"mainloop.h\"",
      "#include <sys/epoll.h>",
      "#include <sys/timerfd.h>",
      "#include <sys/signalfd.h>",
      "#include <signal.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static int epoll_terminate;",
      "static int exit_status = EXIT_SUCCESS;"
    ],
    "called_functions": [],
    "contextual_snippet": "#include \"mainloop.h\"\n#include <sys/epoll.h>\n#include <sys/timerfd.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <string.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic int epoll_terminate;\nstatic int exit_status = EXIT_SUCCESS;\n\nvoid mainloop_exit_failure(void)\n{\n\texit_status = EXIT_FAILURE;\n\tepoll_terminate = 1;\n}"
  },
  {
    "function_name": "mainloop_exit_success",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/mainloop.c",
    "lines": "93-97",
    "snippet": "void mainloop_exit_success(void)\n{\n\texit_status = EXIT_SUCCESS;\n\tepoll_terminate = 1;\n}",
    "includes": [
      "#include \"mainloop.h\"",
      "#include <sys/epoll.h>",
      "#include <sys/timerfd.h>",
      "#include <sys/signalfd.h>",
      "#include <signal.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static int epoll_terminate;",
      "static int exit_status = EXIT_SUCCESS;"
    ],
    "called_functions": [],
    "contextual_snippet": "#include \"mainloop.h\"\n#include <sys/epoll.h>\n#include <sys/timerfd.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <string.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic int epoll_terminate;\nstatic int exit_status = EXIT_SUCCESS;\n\nvoid mainloop_exit_success(void)\n{\n\texit_status = EXIT_SUCCESS;\n\tepoll_terminate = 1;\n}"
  },
  {
    "function_name": "mainloop_quit",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/mainloop.c",
    "lines": "88-91",
    "snippet": "void mainloop_quit(void)\n{\n\tepoll_terminate = 1;\n}",
    "includes": [
      "#include \"mainloop.h\"",
      "#include <sys/epoll.h>",
      "#include <sys/timerfd.h>",
      "#include <sys/signalfd.h>",
      "#include <signal.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static int epoll_terminate;"
    ],
    "called_functions": [],
    "contextual_snippet": "#include \"mainloop.h\"\n#include <sys/epoll.h>\n#include <sys/timerfd.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <string.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic int epoll_terminate;\n\nvoid mainloop_quit(void)\n{\n\tepoll_terminate = 1;\n}"
  },
  {
    "function_name": "mainloop_init",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/mainloop.c",
    "lines": "76-86",
    "snippet": "void mainloop_init(void)\n{\n\tunsigned int i;\n\n\tepoll_fd = epoll_create1(EPOLL_CLOEXEC);\n\n\tfor (i = 0; i < MAX_MAINLOOP_ENTRIES; i++)\n\t\tmainloop_list[i] = NULL;\n\n\tepoll_terminate = 0;\n}",
    "includes": [
      "#include \"mainloop.h\"",
      "#include <sys/epoll.h>",
      "#include <sys/timerfd.h>",
      "#include <sys/signalfd.h>",
      "#include <signal.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define MAX_MAINLOOP_ENTRIES 128"
    ],
    "globals_used": [
      "static int epoll_fd;",
      "static int epoll_terminate;",
      "static struct mainloop_data *mainloop_list[MAX_MAINLOOP_ENTRIES];"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "epoll_create1",
          "args": [
            "EPOLL_CLOEXEC"
          ],
          "line": 80
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"mainloop.h\"\n#include <sys/epoll.h>\n#include <sys/timerfd.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <string.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\n#define MAX_MAINLOOP_ENTRIES 128\n\nstatic int epoll_fd;\nstatic int epoll_terminate;\nstatic struct mainloop_data *mainloop_list[MAX_MAINLOOP_ENTRIES];\n\nvoid mainloop_init(void)\n{\n\tunsigned int i;\n\n\tepoll_fd = epoll_create1(EPOLL_CLOEXEC);\n\n\tfor (i = 0; i < MAX_MAINLOOP_ENTRIES; i++)\n\t\tmainloop_list[i] = NULL;\n\n\tepoll_terminate = 0;\n}"
  }
]