[
  {
    "function_name": "btd_gatt_database_restore_svc_chng_ccc",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
    "lines": "3389-3422",
    "snippet": "void btd_gatt_database_restore_svc_chng_ccc(struct btd_gatt_database *database)\n{\n\tuint8_t value[4];\n\tuint16_t handle, ccc_handle;\n\n\tif (!database)\n\t\treturn;\n\n\thandle = gatt_db_attribute_get_handle(database->svc_chngd);\n\tccc_handle = gatt_db_attribute_get_handle(database->svc_chngd_ccc);\n\n\tif (!handle || !ccc_handle) {\n\t\terror(\"Failed to obtain handles for \\\"Service Changed\\\"\"\n\t\t\t\t\t\t\t\" characteristic\");\n\t\treturn;\n\t}\n\n\t/* restore states for bonded device that registered for Service Changed\n\t * indication\n\t */\n\tbtd_adapter_for_each_device(database->adapter, restore_state, database);\n\n\t/* This needs to be updated (probably to 0x0001) if we ever change\n\t * core services\n\t *\n\t * TODO we could also store this info (along with CCC value) and be able\n\t * to send 0x0001-0xffff only once per device.\n\t */\n\tput_le16(0x000a, value);\n\tput_le16(0xffff, value + 2);\n\n\tsend_notification_to_devices(database, handle, value, sizeof(value),\n\t\t\t\t\tccc_handle, service_changed_conf, NULL);\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"dbus-common.h\"",
      "#include \"gatt-database.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "send_notification_to_devices",
          "args": [
            "database",
            "handle",
            "value",
            "sizeof(value)",
            "ccc_handle",
            "service_changed_conf",
            "NULL"
          ],
          "line": 3420
        },
        "resolved": true,
        "details": {
          "function_name": "send_notification_to_devices",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "1181-1201",
          "snippet": "static void send_notification_to_devices(struct btd_gatt_database *database,\n\t\t\t\t\tuint16_t handle, uint8_t *value,\n\t\t\t\t\tuint16_t len, uint16_t ccc_handle,\n\t\t\t\t\tbt_gatt_server_conf_func_t conf,\n\t\t\t\t\tvoid *user_data)\n{\n\tstruct notify notify;\n\n\tmemset(&notify, 0, sizeof(notify));\n\n\tnotify.database = database;\n\tnotify.handle = handle;\n\tnotify.ccc_handle = ccc_handle;\n\tnotify.value = value;\n\tnotify.len = len;\n\tnotify.conf = conf;\n\tnotify.user_data = user_data;\n\n\tqueue_foreach(database->device_states, send_notification_to_device,\n\t\t\t\t\t\t\t\t&notify);\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic void send_notification_to_devices(struct btd_gatt_database *database,\n\t\t\t\t\tuint16_t handle, uint8_t *value,\n\t\t\t\t\tuint16_t len, uint16_t ccc_handle,\n\t\t\t\t\tbt_gatt_server_conf_func_t conf,\n\t\t\t\t\tvoid *user_data)\n{\n\tstruct notify notify;\n\n\tmemset(&notify, 0, sizeof(notify));\n\n\tnotify.database = database;\n\tnotify.handle = handle;\n\tnotify.ccc_handle = ccc_handle;\n\tnotify.value = value;\n\tnotify.len = len;\n\tnotify.conf = conf;\n\tnotify.user_data = user_data;\n\n\tqueue_foreach(database->device_states, send_notification_to_device,\n\t\t\t\t\t\t\t\t&notify);\n}"
        }
      },
      {
        "call_info": {
          "callee": "put_le16",
          "args": [
            "0xffff",
            "value + 2"
          ],
          "line": 3418
        },
        "resolved": true,
        "details": {
          "function_name": "put_le16",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/util.h",
          "lines": "159-162",
          "snippet": "static inline void put_le16(uint16_t val, void *dst)\n{\n\tput_unaligned(cpu_to_le16(val), (uint16_t *) dst);\n}",
          "includes": [
            "#include <string.h>",
            "#include <byteswap.h>",
            "#include <alloca.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <byteswap.h>\n#include <alloca.h>\n#include <stdlib.h>\n#include <stdint.h>\n\nstatic inline void put_le16(uint16_t val, void *dst)\n{\n\tput_unaligned(cpu_to_le16(val), (uint16_t *) dst);\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_adapter_for_each_device",
          "args": [
            "database->adapter",
            "restore_state",
            "database"
          ],
          "line": 3409
        },
        "resolved": true,
        "details": {
          "function_name": "btd_adapter_for_each_device",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "7979-7984",
          "snippet": "void btd_adapter_for_each_device(struct btd_adapter *adapter,\n\t\t\tvoid (*cb)(struct btd_device *device, void *data),\n\t\t\tvoid *data)\n{\n\tg_slist_foreach(adapter->devices, (GFunc) cb, data);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void trigger_pairable_timeout(struct btd_adapter *adapter);",
            "static void adapter_start(struct btd_adapter *adapter);",
            "static void adapter_stop(struct btd_adapter *adapter);",
            "static void trigger_passive_scanning(struct btd_adapter *adapter);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void trigger_pairable_timeout(struct btd_adapter *adapter);\nstatic void adapter_start(struct btd_adapter *adapter);\nstatic void adapter_stop(struct btd_adapter *adapter);\nstatic void trigger_passive_scanning(struct btd_adapter *adapter);\n\nvoid btd_adapter_for_each_device(struct btd_adapter *adapter,\n\t\t\tvoid (*cb)(struct btd_device *device, void *data),\n\t\t\tvoid *data)\n{\n\tg_slist_foreach(adapter->devices, (GFunc) cb, data);\n}"
        }
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"Failed to obtain handles for \\\"Service Changed\\\"\"\n\t\t\t\t\t\t\t\" characteristic\""
          ],
          "line": 3401
        },
        "resolved": true,
        "details": {
          "function_name": "dbus_error_to_att_ecode",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "1833-1855",
          "snippet": "static uint8_t dbus_error_to_att_ecode(const char *error_name)\n{\n\n\tif (strcmp(error_name, \"org.bluez.Error.Failed\") == 0)\n\t\treturn 0x80;  /* For now return this \"application error\" */\n\n\tif (strcmp(error_name, \"org.bluez.Error.NotSupported\") == 0)\n\t\treturn BT_ATT_ERROR_REQUEST_NOT_SUPPORTED;\n\n\tif (strcmp(error_name, \"org.bluez.Error.NotAuthorized\") == 0)\n\t\treturn BT_ATT_ERROR_AUTHORIZATION;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InvalidValueLength\") == 0)\n\t\treturn BT_ATT_ERROR_INVALID_ATTRIBUTE_VALUE_LEN;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InvalidOffset\") == 0)\n\t\treturn BT_ATT_ERROR_INVALID_OFFSET;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InProgress\") == 0)\n\t\treturn BT_ERROR_ALREADY_IN_PROGRESS;\n\n\treturn 0;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic uint8_t dbus_error_to_att_ecode(const char *error_name)\n{\n\n\tif (strcmp(error_name, \"org.bluez.Error.Failed\") == 0)\n\t\treturn 0x80;  /* For now return this \"application error\" */\n\n\tif (strcmp(error_name, \"org.bluez.Error.NotSupported\") == 0)\n\t\treturn BT_ATT_ERROR_REQUEST_NOT_SUPPORTED;\n\n\tif (strcmp(error_name, \"org.bluez.Error.NotAuthorized\") == 0)\n\t\treturn BT_ATT_ERROR_AUTHORIZATION;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InvalidValueLength\") == 0)\n\t\treturn BT_ATT_ERROR_INVALID_ATTRIBUTE_VALUE_LEN;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InvalidOffset\") == 0)\n\t\treturn BT_ATT_ERROR_INVALID_OFFSET;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InProgress\") == 0)\n\t\treturn BT_ERROR_ALREADY_IN_PROGRESS;\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "gatt_db_attribute_get_handle",
          "args": [
            "database->svc_chngd_ccc"
          ],
          "line": 3398
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_attribute_get_handle",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "1482-1488",
          "snippet": "uint16_t gatt_db_attribute_get_handle(const struct gatt_db_attribute *attrib)\n{\n\tif (!attrib)\n\t\treturn 0;\n\n\treturn attrib->handle;\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nuint16_t gatt_db_attribute_get_handle(const struct gatt_db_attribute *attrib)\n{\n\tif (!attrib)\n\t\treturn 0;\n\n\treturn attrib->handle;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nvoid btd_gatt_database_restore_svc_chng_ccc(struct btd_gatt_database *database)\n{\n\tuint8_t value[4];\n\tuint16_t handle, ccc_handle;\n\n\tif (!database)\n\t\treturn;\n\n\thandle = gatt_db_attribute_get_handle(database->svc_chngd);\n\tccc_handle = gatt_db_attribute_get_handle(database->svc_chngd_ccc);\n\n\tif (!handle || !ccc_handle) {\n\t\terror(\"Failed to obtain handles for \\\"Service Changed\\\"\"\n\t\t\t\t\t\t\t\" characteristic\");\n\t\treturn;\n\t}\n\n\t/* restore states for bonded device that registered for Service Changed\n\t * indication\n\t */\n\tbtd_adapter_for_each_device(database->adapter, restore_state, database);\n\n\t/* This needs to be updated (probably to 0x0001) if we ever change\n\t * core services\n\t *\n\t * TODO we could also store this info (along with CCC value) and be able\n\t * to send 0x0001-0xffff only once per device.\n\t */\n\tput_le16(0x000a, value);\n\tput_le16(0xffff, value + 2);\n\n\tsend_notification_to_devices(database, handle, value, sizeof(value),\n\t\t\t\t\tccc_handle, service_changed_conf, NULL);\n}"
  },
  {
    "function_name": "restore_state",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
    "lines": "3367-3387",
    "snippet": "static void restore_state(struct btd_device *device, void *data)\n{\n\tstruct btd_gatt_database *database = data;\n\tuint16_t ccc_le, ccc_bredr;\n\n\tdevice_load_svc_chng_ccc(device, &ccc_le, &ccc_bredr);\n\n\tif (ccc_le) {\n\t\trestore_ccc(database, device_get_address(device),\n\t\t\t\tdevice_get_le_address_type(device), ccc_le);\n\n\t\tDBG(\"%s LE\", device_get_path(device));\n\t}\n\n\tif (ccc_bredr) {\n\t\trestore_ccc(database, device_get_address(device),\n\t\t\t\t\t\tBDADDR_BREDR, ccc_bredr);\n\n\t\tDBG(\"%s BR/EDR\", device_get_path(device));\n\t}\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"dbus-common.h\"",
      "#include \"gatt-database.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"%s BR/EDR\"",
            "device_get_path(device)"
          ],
          "line": 3385
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "device_get_path",
          "args": [
            "device"
          ],
          "line": 3385
        },
        "resolved": true,
        "details": {
          "function_name": "device_get_path",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "5323-5329",
          "snippet": "const char *device_get_path(const struct btd_device *device)\n{\n\tif (!device)\n\t\treturn NULL;\n\n\treturn device->path;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nconst char *device_get_path(const struct btd_device *device)\n{\n\tif (!device)\n\t\treturn NULL;\n\n\treturn device->path;\n}"
        }
      },
      {
        "call_info": {
          "callee": "restore_ccc",
          "args": [
            "database",
            "device_get_address(device)",
            "BDADDR_BREDR",
            "ccc_bredr"
          ],
          "line": 3382
        },
        "resolved": true,
        "details": {
          "function_name": "restore_ccc",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "3352-3365",
          "snippet": "static void restore_ccc(struct btd_gatt_database *database,\n\t\t\tconst bdaddr_t *addr, uint8_t addr_type, uint16_t value)\n{\n\tstruct device_state *dev_state;\n\tstruct ccc_state *ccc;\n\n\tdev_state = device_state_create(database, addr, addr_type);\n\tqueue_push_tail(database->device_states, dev_state);\n\n\tccc = new0(struct ccc_state, 1);\n\tccc->handle = gatt_db_attribute_get_handle(database->svc_chngd_ccc);\n\tmemcpy(ccc->value, &value, sizeof(ccc->value));\n\tqueue_push_tail(dev_state->ccc_states, ccc);\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic void restore_ccc(struct btd_gatt_database *database,\n\t\t\tconst bdaddr_t *addr, uint8_t addr_type, uint16_t value)\n{\n\tstruct device_state *dev_state;\n\tstruct ccc_state *ccc;\n\n\tdev_state = device_state_create(database, addr, addr_type);\n\tqueue_push_tail(database->device_states, dev_state);\n\n\tccc = new0(struct ccc_state, 1);\n\tccc->handle = gatt_db_attribute_get_handle(database->svc_chngd_ccc);\n\tmemcpy(ccc->value, &value, sizeof(ccc->value));\n\tqueue_push_tail(dev_state->ccc_states, ccc);\n}"
        }
      },
      {
        "call_info": {
          "callee": "device_get_address",
          "args": [
            "device"
          ],
          "line": 3382
        },
        "resolved": true,
        "details": {
          "function_name": "device_get_address",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "5314-5317",
          "snippet": "const bdaddr_t *device_get_address(struct btd_device *device)\n{\n\treturn &device->bdaddr;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nconst bdaddr_t *device_get_address(struct btd_device *device)\n{\n\treturn &device->bdaddr;\n}"
        }
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"%s LE\"",
            "device_get_path(device)"
          ],
          "line": 3378
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "device_get_le_address_type",
          "args": [
            "device"
          ],
          "line": 3376
        },
        "resolved": true,
        "details": {
          "function_name": "device_get_le_address_type",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "5318-5321",
          "snippet": "uint8_t device_get_le_address_type(struct btd_device *device)\n{\n\treturn device->bdaddr_type;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nuint8_t device_get_le_address_type(struct btd_device *device)\n{\n\treturn device->bdaddr_type;\n}"
        }
      },
      {
        "call_info": {
          "callee": "device_load_svc_chng_ccc",
          "args": [
            "device",
            "&ccc_le",
            "&ccc_bredr"
          ],
          "line": 3372
        },
        "resolved": true,
        "details": {
          "function_name": "device_load_svc_chng_ccc",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "5467-5507",
          "snippet": "void device_load_svc_chng_ccc(struct btd_device *device, uint16_t *ccc_le,\n\t\t\t\t\t\t\tuint16_t *ccc_bredr)\n{\n\tchar filename[PATH_MAX];\n\tchar device_addr[18];\n\tGKeyFile *key_file;\n\n\tba2str(&device->bdaddr, device_addr);\n\tsnprintf(filename, PATH_MAX, STORAGEDIR \"/%s/%s/info\",\n\t\t\t\tbtd_adapter_get_storage_dir(device->adapter),\n\t\t\t\tdevice_addr);\n\n\tkey_file = g_key_file_new();\n\tg_key_file_load_from_file(key_file, filename, 0, NULL);\n\n\t/*\n\t * If there is no \"ServiceChanged\" section we may be loading data from\n\t * old version which did not persist Service Changed CCC values. Let's\n\t * check if we are bonded and assume indications were enabled by peer\n\t * in such case - it should have done this anyway.\n\t */\n\tif (!g_key_file_has_group(key_file, \"ServiceChanged\")) {\n\t\tif (ccc_le)\n\t\t\t*ccc_le = device->le_state.bonded ? 0x0002 : 0x0000;\n\t\tif (ccc_bredr)\n\t\t\t*ccc_bredr = device->bredr_state.bonded ?\n\t\t\t\t\t\t\t0x0002 : 0x0000;\n\t\tg_key_file_free(key_file);\n\t\treturn;\n\t}\n\n\tif (ccc_le)\n\t\t*ccc_le = g_key_file_get_integer(key_file, \"ServiceChanged\",\n\t\t\t\t\t\t\t\"CCC_LE\", NULL);\n\n\tif (ccc_bredr)\n\t\t*ccc_bredr = g_key_file_get_integer(key_file, \"ServiceChanged\",\n\t\t\t\t\t\t\t\"CCC_BR/EDR\", NULL);\n\n\tg_key_file_free(key_file);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nvoid device_load_svc_chng_ccc(struct btd_device *device, uint16_t *ccc_le,\n\t\t\t\t\t\t\tuint16_t *ccc_bredr)\n{\n\tchar filename[PATH_MAX];\n\tchar device_addr[18];\n\tGKeyFile *key_file;\n\n\tba2str(&device->bdaddr, device_addr);\n\tsnprintf(filename, PATH_MAX, STORAGEDIR \"/%s/%s/info\",\n\t\t\t\tbtd_adapter_get_storage_dir(device->adapter),\n\t\t\t\tdevice_addr);\n\n\tkey_file = g_key_file_new();\n\tg_key_file_load_from_file(key_file, filename, 0, NULL);\n\n\t/*\n\t * If there is no \"ServiceChanged\" section we may be loading data from\n\t * old version which did not persist Service Changed CCC values. Let's\n\t * check if we are bonded and assume indications were enabled by peer\n\t * in such case - it should have done this anyway.\n\t */\n\tif (!g_key_file_has_group(key_file, \"ServiceChanged\")) {\n\t\tif (ccc_le)\n\t\t\t*ccc_le = device->le_state.bonded ? 0x0002 : 0x0000;\n\t\tif (ccc_bredr)\n\t\t\t*ccc_bredr = device->bredr_state.bonded ?\n\t\t\t\t\t\t\t0x0002 : 0x0000;\n\t\tg_key_file_free(key_file);\n\t\treturn;\n\t}\n\n\tif (ccc_le)\n\t\t*ccc_le = g_key_file_get_integer(key_file, \"ServiceChanged\",\n\t\t\t\t\t\t\t\"CCC_LE\", NULL);\n\n\tif (ccc_bredr)\n\t\t*ccc_bredr = g_key_file_get_integer(key_file, \"ServiceChanged\",\n\t\t\t\t\t\t\t\"CCC_BR/EDR\", NULL);\n\n\tg_key_file_free(key_file);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic void restore_state(struct btd_device *device, void *data)\n{\n\tstruct btd_gatt_database *database = data;\n\tuint16_t ccc_le, ccc_bredr;\n\n\tdevice_load_svc_chng_ccc(device, &ccc_le, &ccc_bredr);\n\n\tif (ccc_le) {\n\t\trestore_ccc(database, device_get_address(device),\n\t\t\t\tdevice_get_le_address_type(device), ccc_le);\n\n\t\tDBG(\"%s LE\", device_get_path(device));\n\t}\n\n\tif (ccc_bredr) {\n\t\trestore_ccc(database, device_get_address(device),\n\t\t\t\t\t\tBDADDR_BREDR, ccc_bredr);\n\n\t\tDBG(\"%s BR/EDR\", device_get_path(device));\n\t}\n}"
  },
  {
    "function_name": "restore_ccc",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
    "lines": "3352-3365",
    "snippet": "static void restore_ccc(struct btd_gatt_database *database,\n\t\t\tconst bdaddr_t *addr, uint8_t addr_type, uint16_t value)\n{\n\tstruct device_state *dev_state;\n\tstruct ccc_state *ccc;\n\n\tdev_state = device_state_create(database, addr, addr_type);\n\tqueue_push_tail(database->device_states, dev_state);\n\n\tccc = new0(struct ccc_state, 1);\n\tccc->handle = gatt_db_attribute_get_handle(database->svc_chngd_ccc);\n\tmemcpy(ccc->value, &value, sizeof(ccc->value));\n\tqueue_push_tail(dev_state->ccc_states, ccc);\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"dbus-common.h\"",
      "#include \"gatt-database.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "queue_push_tail",
          "args": [
            "dev_state->ccc_states",
            "ccc"
          ],
          "line": 3364
        },
        "resolved": true,
        "details": {
          "function_name": "queue_push_tail",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "88-108",
          "snippet": "bool queue_push_tail(struct queue *queue, void *data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn false;\n\n\tentry = queue_entry_new(data);\n\n\tif (queue->tail)\n\t\tqueue->tail->next = entry;\n\n\tqueue->tail = entry;\n\n\tif (!queue->head)\n\t\tqueue->head = entry;\n\n\tqueue->entries++;\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nbool queue_push_tail(struct queue *queue, void *data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn false;\n\n\tentry = queue_entry_new(data);\n\n\tif (queue->tail)\n\t\tqueue->tail->next = entry;\n\n\tqueue->tail = entry;\n\n\tif (!queue->head)\n\t\tqueue->head = entry;\n\n\tqueue->entries++;\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "memcpy",
          "args": [
            "ccc->value",
            "&value",
            "sizeof(ccc->value)"
          ],
          "line": 3363
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "gatt_db_attribute_get_handle",
          "args": [
            "database->svc_chngd_ccc"
          ],
          "line": 3362
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_attribute_get_handle",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "1482-1488",
          "snippet": "uint16_t gatt_db_attribute_get_handle(const struct gatt_db_attribute *attrib)\n{\n\tif (!attrib)\n\t\treturn 0;\n\n\treturn attrib->handle;\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nuint16_t gatt_db_attribute_get_handle(const struct gatt_db_attribute *attrib)\n{\n\tif (!attrib)\n\t\treturn 0;\n\n\treturn attrib->handle;\n}"
        }
      },
      {
        "call_info": {
          "callee": "new0",
          "args": [
            "structccc_state",
            "1"
          ],
          "line": 3361
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "device_state_create",
          "args": [
            "database",
            "addr",
            "addr_type"
          ],
          "line": 3358
        },
        "resolved": true,
        "details": {
          "function_name": "device_state_create",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "273-286",
          "snippet": "static struct device_state *device_state_create(struct btd_gatt_database *db,\n\t\t\t\t\t\t\tconst bdaddr_t *bdaddr,\n\t\t\t\t\t\t\tuint8_t bdaddr_type)\n{\n\tstruct device_state *dev_state;\n\n\tdev_state = new0(struct device_state, 1);\n\tdev_state->db = db;\n\tdev_state->ccc_states = queue_new();\n\tbacpy(&dev_state->bdaddr, bdaddr);\n\tdev_state->bdaddr_type = bdaddr_type;\n\n\treturn dev_state;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic struct device_state *device_state_create(struct btd_gatt_database *db,\n\t\t\t\t\t\t\tconst bdaddr_t *bdaddr,\n\t\t\t\t\t\t\tuint8_t bdaddr_type)\n{\n\tstruct device_state *dev_state;\n\n\tdev_state = new0(struct device_state, 1);\n\tdev_state->db = db;\n\tdev_state->ccc_states = queue_new();\n\tbacpy(&dev_state->bdaddr, bdaddr);\n\tdev_state->bdaddr_type = bdaddr_type;\n\n\treturn dev_state;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic void restore_ccc(struct btd_gatt_database *database,\n\t\t\tconst bdaddr_t *addr, uint8_t addr_type, uint16_t value)\n{\n\tstruct device_state *dev_state;\n\tstruct ccc_state *ccc;\n\n\tdev_state = device_state_create(database, addr, addr_type);\n\tqueue_push_tail(database->device_states, dev_state);\n\n\tccc = new0(struct ccc_state, 1);\n\tccc->handle = gatt_db_attribute_get_handle(database->svc_chngd_ccc);\n\tmemcpy(ccc->value, &value, sizeof(ccc->value));\n\tqueue_push_tail(dev_state->ccc_states, ccc);\n}"
  },
  {
    "function_name": "btd_gatt_database_att_connected",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
    "lines": "3331-3350",
    "snippet": "void btd_gatt_database_att_connected(struct btd_gatt_database *database,\n\t\t\t\t\t\tstruct bt_att *att)\n{\n\tstruct device_state *state;\n\tbdaddr_t bdaddr;\n\tuint8_t bdaddr_type;\n\n\tif (!get_dst_info(att, &bdaddr, &bdaddr_type))\n\t\treturn;\n\n\tstate = find_device_state(database, &bdaddr, bdaddr_type);\n\tif (!state || !state->pending)\n\t\treturn;\n\n\tsend_notification_to_device(state, state->pending);\n\n\tfree(state->pending->value);\n\tfree(state->pending);\n\tstate->pending = NULL;\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"dbus-common.h\"",
      "#include \"gatt-database.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "state->pending"
          ],
          "line": 3348
        },
        "resolved": true,
        "details": {
          "function_name": "app_free_idle_cb",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "1303-1308",
          "snippet": "static gboolean app_free_idle_cb(void *data)\n{\n\tapp_free(data);\n\n\treturn FALSE;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic gboolean app_free_idle_cb(void *data)\n{\n\tapp_free(data);\n\n\treturn FALSE;\n}"
        }
      },
      {
        "call_info": {
          "callee": "send_notification_to_device",
          "args": [
            "state",
            "state->pending"
          ],
          "line": 3345
        },
        "resolved": true,
        "details": {
          "function_name": "send_notification_to_device",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "1124-1179",
          "snippet": "static void send_notification_to_device(void *data, void *user_data)\n{\n\tstruct device_state *device_state = data;\n\tstruct notify *notify = user_data;\n\tstruct ccc_state *ccc;\n\tstruct btd_device *device;\n\tstruct bt_gatt_server *server;\n\n\tccc = find_ccc_state(device_state, notify->ccc_handle);\n\tif (!ccc)\n\t\treturn;\n\n\tif (!ccc->value[0] || (notify->conf && !(ccc->value[0] & 0x02)))\n\t\treturn;\n\n\tdevice = btd_adapter_get_device(notify->database->adapter,\n\t\t\t\t\t\t&device_state->bdaddr,\n\t\t\t\t\t\tdevice_state->bdaddr_type);\n\tif (!device)\n\t\tgoto remove;\n\n\tserver = btd_device_get_gatt_server(device);\n\tif (!server) {\n\t\tif (!device_is_bonded(device, device_state->bdaddr_type))\n\t\t\tgoto remove;\n\t\tstate_set_pending(device_state, notify);\n\t\treturn;\n\t}\n\n\t/*\n\t * TODO: If the device is not connected but bonded, send the\n\t * notification/indication when it becomes connected.\n\t */\n\tif (!notify->conf) {\n\t\tDBG(\"GATT server sending notification\");\n\t\tbt_gatt_server_send_notification(server,\n\t\t\t\t\tnotify->handle, notify->value,\n\t\t\t\t\tnotify->len);\n\t\treturn;\n\t}\n\n\tDBG(\"GATT server sending indication\");\n\tbt_gatt_server_send_indication(server, notify->handle, notify->value,\n\t\t\t\t\t\tnotify->len, notify->conf,\n\t\t\t\t\t\tnotify->user_data, NULL);\n\n\treturn;\n\nremove:\n\t/* Remove device state if device no longer exists or is not paired */\n\tif (queue_remove(notify->database->device_states, device_state)) {\n\t\tqueue_foreach(device_state->ccc_states, clear_ccc_state,\n\t\t\t\t\t\tnotify->database);\n\t\tdevice_state_free(device_state);\n\t}\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic void send_notification_to_device(void *data, void *user_data)\n{\n\tstruct device_state *device_state = data;\n\tstruct notify *notify = user_data;\n\tstruct ccc_state *ccc;\n\tstruct btd_device *device;\n\tstruct bt_gatt_server *server;\n\n\tccc = find_ccc_state(device_state, notify->ccc_handle);\n\tif (!ccc)\n\t\treturn;\n\n\tif (!ccc->value[0] || (notify->conf && !(ccc->value[0] & 0x02)))\n\t\treturn;\n\n\tdevice = btd_adapter_get_device(notify->database->adapter,\n\t\t\t\t\t\t&device_state->bdaddr,\n\t\t\t\t\t\tdevice_state->bdaddr_type);\n\tif (!device)\n\t\tgoto remove;\n\n\tserver = btd_device_get_gatt_server(device);\n\tif (!server) {\n\t\tif (!device_is_bonded(device, device_state->bdaddr_type))\n\t\t\tgoto remove;\n\t\tstate_set_pending(device_state, notify);\n\t\treturn;\n\t}\n\n\t/*\n\t * TODO: If the device is not connected but bonded, send the\n\t * notification/indication when it becomes connected.\n\t */\n\tif (!notify->conf) {\n\t\tDBG(\"GATT server sending notification\");\n\t\tbt_gatt_server_send_notification(server,\n\t\t\t\t\tnotify->handle, notify->value,\n\t\t\t\t\tnotify->len);\n\t\treturn;\n\t}\n\n\tDBG(\"GATT server sending indication\");\n\tbt_gatt_server_send_indication(server, notify->handle, notify->value,\n\t\t\t\t\t\tnotify->len, notify->conf,\n\t\t\t\t\t\tnotify->user_data, NULL);\n\n\treturn;\n\nremove:\n\t/* Remove device state if device no longer exists or is not paired */\n\tif (queue_remove(notify->database->device_states, device_state)) {\n\t\tqueue_foreach(device_state->ccc_states, clear_ccc_state,\n\t\t\t\t\t\tnotify->database);\n\t\tdevice_state_free(device_state);\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "find_device_state",
          "args": [
            "database",
            "&bdaddr",
            "bdaddr_type"
          ],
          "line": 3341
        },
        "resolved": true,
        "details": {
          "function_name": "find_device_state",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "244-256",
          "snippet": "static struct device_state *\nfind_device_state(struct btd_gatt_database *database, bdaddr_t *bdaddr,\n\t\t\t\t\t\t\tuint8_t bdaddr_type)\n{\n\tstruct device_info dev_info;\n\n\tmemset(&dev_info, 0, sizeof(dev_info));\n\n\tbacpy(&dev_info.bdaddr, bdaddr);\n\tdev_info.bdaddr_type = bdaddr_type;\n\n\treturn queue_find(database->device_states, dev_state_match, &dev_info);\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic struct device_state *\nfind_device_state(struct btd_gatt_database *database, bdaddr_t *bdaddr,\n\t\t\t\t\t\t\tuint8_t bdaddr_type)\n{\n\tstruct device_info dev_info;\n\n\tmemset(&dev_info, 0, sizeof(dev_info));\n\n\tbacpy(&dev_info.bdaddr, bdaddr);\n\tdev_info.bdaddr_type = bdaddr_type;\n\n\treturn queue_find(database->device_states, dev_state_match, &dev_info);\n}"
        }
      },
      {
        "call_info": {
          "callee": "get_dst_info",
          "args": [
            "att",
            "&bdaddr",
            "&bdaddr_type"
          ],
          "line": 3338
        },
        "resolved": true,
        "details": {
          "function_name": "get_dst_info",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "356-377",
          "snippet": "static bool get_dst_info(struct bt_att *att, bdaddr_t *dst, uint8_t *dst_type)\n{\n\tGIOChannel *io = NULL;\n\tGError *gerr = NULL;\n\n\tio = g_io_channel_unix_new(bt_att_get_fd(att));\n\tif (!io)\n\t\treturn false;\n\n\tbt_io_get(io, &gerr, BT_IO_OPT_DEST_BDADDR, dst,\n\t\t\t\t\t\tBT_IO_OPT_DEST_TYPE, dst_type,\n\t\t\t\t\t\tBT_IO_OPT_INVALID);\n\tif (gerr) {\n\t\terror(\"gatt: bt_io_get: %s\", gerr->message);\n\t\tg_error_free(gerr);\n\t\tg_io_channel_unref(io);\n\t\treturn false;\n\t}\n\n\tg_io_channel_unref(io);\n\treturn true;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic bool get_dst_info(struct bt_att *att, bdaddr_t *dst, uint8_t *dst_type)\n{\n\tGIOChannel *io = NULL;\n\tGError *gerr = NULL;\n\n\tio = g_io_channel_unix_new(bt_att_get_fd(att));\n\tif (!io)\n\t\treturn false;\n\n\tbt_io_get(io, &gerr, BT_IO_OPT_DEST_BDADDR, dst,\n\t\t\t\t\t\tBT_IO_OPT_DEST_TYPE, dst_type,\n\t\t\t\t\t\tBT_IO_OPT_INVALID);\n\tif (gerr) {\n\t\terror(\"gatt: bt_io_get: %s\", gerr->message);\n\t\tg_error_free(gerr);\n\t\tg_io_channel_unref(io);\n\t\treturn false;\n\t}\n\n\tg_io_channel_unref(io);\n\treturn true;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nvoid btd_gatt_database_att_connected(struct btd_gatt_database *database,\n\t\t\t\t\t\tstruct bt_att *att)\n{\n\tstruct device_state *state;\n\tbdaddr_t bdaddr;\n\tuint8_t bdaddr_type;\n\n\tif (!get_dst_info(att, &bdaddr, &bdaddr_type))\n\t\treturn;\n\n\tstate = find_device_state(database, &bdaddr, bdaddr_type);\n\tif (!state || !state->pending)\n\t\treturn;\n\n\tsend_notification_to_device(state, state->pending);\n\n\tfree(state->pending->value);\n\tfree(state->pending);\n\tstate->pending = NULL;\n}"
  },
  {
    "function_name": "btd_gatt_database_get_db",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
    "lines": "3323-3329",
    "snippet": "struct gatt_db *btd_gatt_database_get_db(struct btd_gatt_database *database)\n{\n\tif (!database)\n\t\treturn NULL;\n\n\treturn database->db;\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"dbus-common.h\"",
      "#include \"gatt-database.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstruct gatt_db *btd_gatt_database_get_db(struct btd_gatt_database *database)\n{\n\tif (!database)\n\t\treturn NULL;\n\n\treturn database->db;\n}"
  },
  {
    "function_name": "btd_gatt_database_destroy",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
    "lines": "3311-3321",
    "snippet": "void btd_gatt_database_destroy(struct btd_gatt_database *database)\n{\n\tif (!database)\n\t\treturn;\n\n\tg_dbus_unregister_interface(btd_get_dbus_connection(),\n\t\t\t\t\tadapter_get_path(database->adapter),\n\t\t\t\t\tGATT_MANAGER_IFACE);\n\n\tgatt_database_free(database);\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"dbus-common.h\"",
      "#include \"gatt-database.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define GATT_MANAGER_IFACE\t\"org.bluez.GattManager1\""
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "gatt_database_free",
          "args": [
            "database"
          ],
          "line": 3320
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_database_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "577-606",
          "snippet": "static void gatt_database_free(void *data)\n{\n\tstruct btd_gatt_database *database = data;\n\n\tif (database->le_io) {\n\t\tg_io_channel_shutdown(database->le_io, FALSE, NULL);\n\t\tg_io_channel_unref(database->le_io);\n\t}\n\n\tif (database->l2cap_io) {\n\t\tg_io_channel_shutdown(database->l2cap_io, FALSE, NULL);\n\t\tg_io_channel_unref(database->l2cap_io);\n\t}\n\n\t/* TODO: Persistently store CCC states before freeing them */\n\tgatt_db_unregister(database->db, database->db_id);\n\n\tqueue_destroy(database->records, gatt_record_free);\n\tqueue_destroy(database->device_states, device_state_free);\n\tqueue_destroy(database->apps, app_free);\n\tqueue_destroy(database->profiles, profile_free);\n\tqueue_destroy(database->ccc_callbacks, ccc_cb_free);\n\tdatabase->device_states = NULL;\n\tdatabase->ccc_callbacks = NULL;\n\n\tgatt_db_unref(database->db);\n\n\tbtd_adapter_unref(database->adapter);\n\tfree(database);\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic void gatt_database_free(void *data)\n{\n\tstruct btd_gatt_database *database = data;\n\n\tif (database->le_io) {\n\t\tg_io_channel_shutdown(database->le_io, FALSE, NULL);\n\t\tg_io_channel_unref(database->le_io);\n\t}\n\n\tif (database->l2cap_io) {\n\t\tg_io_channel_shutdown(database->l2cap_io, FALSE, NULL);\n\t\tg_io_channel_unref(database->l2cap_io);\n\t}\n\n\t/* TODO: Persistently store CCC states before freeing them */\n\tgatt_db_unregister(database->db, database->db_id);\n\n\tqueue_destroy(database->records, gatt_record_free);\n\tqueue_destroy(database->device_states, device_state_free);\n\tqueue_destroy(database->apps, app_free);\n\tqueue_destroy(database->profiles, profile_free);\n\tqueue_destroy(database->ccc_callbacks, ccc_cb_free);\n\tdatabase->device_states = NULL;\n\tdatabase->ccc_callbacks = NULL;\n\n\tgatt_db_unref(database->db);\n\n\tbtd_adapter_unref(database->adapter);\n\tfree(database);\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_dbus_unregister_interface",
          "args": [
            "btd_get_dbus_connection()",
            "adapter_get_path(database->adapter)",
            "GATT_MANAGER_IFACE"
          ],
          "line": 3316
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "adapter_get_path",
          "args": [
            "database->adapter"
          ],
          "line": 3317
        },
        "resolved": true,
        "details": {
          "function_name": "adapter_get_path",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "5873-5879",
          "snippet": "const char *adapter_get_path(struct btd_adapter *adapter)\n{\n\tif (!adapter)\n\t\treturn NULL;\n\n\treturn adapter->path;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void trigger_pairable_timeout(struct btd_adapter *adapter);",
            "static void adapter_start(struct btd_adapter *adapter);",
            "static void adapter_stop(struct btd_adapter *adapter);",
            "static void trigger_passive_scanning(struct btd_adapter *adapter);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void trigger_pairable_timeout(struct btd_adapter *adapter);\nstatic void adapter_start(struct btd_adapter *adapter);\nstatic void adapter_stop(struct btd_adapter *adapter);\nstatic void trigger_passive_scanning(struct btd_adapter *adapter);\n\nconst char *adapter_get_path(struct btd_adapter *adapter)\n{\n\tif (!adapter)\n\t\treturn NULL;\n\n\treturn adapter->path;\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_get_dbus_connection",
          "args": [],
          "line": 3316
        },
        "resolved": true,
        "details": {
          "function_name": "btd_get_dbus_connection",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/dbus-common.c",
          "lines": "61-64",
          "snippet": "DBusConnection *btd_get_dbus_connection(void)\n{\n\treturn connection;\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <stdint.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static DBusConnection *connection = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <stdint.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *connection = NULL;\n\nDBusConnection *btd_get_dbus_connection(void)\n{\n\treturn connection;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\n#define GATT_MANAGER_IFACE\t\"org.bluez.GattManager1\"\n\nvoid btd_gatt_database_destroy(struct btd_gatt_database *database)\n{\n\tif (!database)\n\t\treturn;\n\n\tg_dbus_unregister_interface(btd_get_dbus_connection(),\n\t\t\t\t\tadapter_get_path(database->adapter),\n\t\t\t\t\tGATT_MANAGER_IFACE);\n\n\tgatt_database_free(database);\n}"
  },
  {
    "function_name": "btd_gatt_database_new",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
    "lines": "3241-3309",
    "snippet": "struct btd_gatt_database *btd_gatt_database_new(struct btd_adapter *adapter)\n{\n\tstruct btd_gatt_database *database;\n\tGError *gerr = NULL;\n\tconst bdaddr_t *addr;\n\n\tif (!adapter)\n\t\treturn NULL;\n\n\tdatabase = new0(struct btd_gatt_database, 1);\n\tdatabase->adapter = btd_adapter_ref(adapter);\n\tdatabase->db = gatt_db_new();\n\tdatabase->records = queue_new();\n\tdatabase->device_states = queue_new();\n\tdatabase->apps = queue_new();\n\tdatabase->profiles = queue_new();\n\tdatabase->ccc_callbacks = queue_new();\n\n\taddr = btd_adapter_get_address(adapter);\n\tdatabase->le_io = bt_io_listen(connect_cb, NULL, NULL, NULL, &gerr,\n\t\t\t\t\tBT_IO_OPT_SOURCE_BDADDR, addr,\n\t\t\t\t\tBT_IO_OPT_SOURCE_TYPE,\n\t\t\t\t\tbtd_adapter_get_address_type(adapter),\n\t\t\t\t\tBT_IO_OPT_CID, ATT_CID,\n\t\t\t\t\tBT_IO_OPT_SEC_LEVEL, BT_IO_SEC_LOW,\n\t\t\t\t\tBT_IO_OPT_INVALID);\n\tif (!database->le_io) {\n\t\terror(\"Failed to start listening: %s\", gerr->message);\n\t\tg_error_free(gerr);\n\t\tgoto fail;\n\t}\n\n\t/* BR/EDR socket */\n\tdatabase->l2cap_io = bt_io_listen(connect_cb, NULL, NULL, NULL, &gerr,\n\t\t\t\t\tBT_IO_OPT_SOURCE_BDADDR, addr,\n\t\t\t\t\tBT_IO_OPT_PSM, ATT_PSM,\n\t\t\t\t\tBT_IO_OPT_SEC_LEVEL, BT_IO_SEC_LOW,\n\t\t\t\t\tBT_IO_OPT_MTU, main_opts.gatt_mtu,\n\t\t\t\t\tBT_IO_OPT_INVALID);\n\tif (database->l2cap_io == NULL) {\n\t\terror(\"Failed to start listening: %s\", gerr->message);\n\t\tg_error_free(gerr);\n\t\tgoto fail;\n\t}\n\n\tif (g_dbus_register_interface(btd_get_dbus_connection(),\n\t\t\t\t\t\tadapter_get_path(adapter),\n\t\t\t\t\t\tGATT_MANAGER_IFACE,\n\t\t\t\t\t\tmanager_methods, NULL, NULL,\n\t\t\t\t\t\tdatabase, NULL))\n\t\tDBG(\"GATT Manager registered for adapter: %s\",\n\t\t\t\t\t\tadapter_get_path(adapter));\n\n\tregister_core_services(database);\n\n\tdatabase->db_id = gatt_db_register(database->db, gatt_db_service_added,\n\t\t\t\t\t\t\tgatt_db_service_removed,\n\t\t\t\t\t\t\tdatabase, NULL);\n\tif (!database->db_id)\n\t\tgoto fail;\n\n\n\treturn database;\n\nfail:\n\tgatt_database_free(database);\n\n\treturn NULL;\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"dbus-common.h\"",
      "#include \"gatt-database.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define GATT_MANAGER_IFACE\t\"org.bluez.GattManager1\"",
      "#define ATT_PSM 31",
      "#define ATT_CID 4"
    ],
    "globals_used": [
      "static const GDBusMethodTable manager_methods[] = {\n\t{ GDBUS_ASYNC_METHOD(\"RegisterApplication\",\n\t\t\t\t\tGDBUS_ARGS({ \"application\", \"o\" },\n\t\t\t\t\t\t{ \"options\", \"a{sv}\" }),\n\t\t\t\t\tNULL, manager_register_app) },\n\t{ GDBUS_ASYNC_METHOD(\"UnregisterApplication\",\n\t\t\t\t\tGDBUS_ARGS({ \"application\", \"o\" }),\n\t\t\t\t\tNULL, manager_unregister_app) },\n\t{ }\n};"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "gatt_database_free",
          "args": [
            "database"
          ],
          "line": 3306
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_database_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "577-606",
          "snippet": "static void gatt_database_free(void *data)\n{\n\tstruct btd_gatt_database *database = data;\n\n\tif (database->le_io) {\n\t\tg_io_channel_shutdown(database->le_io, FALSE, NULL);\n\t\tg_io_channel_unref(database->le_io);\n\t}\n\n\tif (database->l2cap_io) {\n\t\tg_io_channel_shutdown(database->l2cap_io, FALSE, NULL);\n\t\tg_io_channel_unref(database->l2cap_io);\n\t}\n\n\t/* TODO: Persistently store CCC states before freeing them */\n\tgatt_db_unregister(database->db, database->db_id);\n\n\tqueue_destroy(database->records, gatt_record_free);\n\tqueue_destroy(database->device_states, device_state_free);\n\tqueue_destroy(database->apps, app_free);\n\tqueue_destroy(database->profiles, profile_free);\n\tqueue_destroy(database->ccc_callbacks, ccc_cb_free);\n\tdatabase->device_states = NULL;\n\tdatabase->ccc_callbacks = NULL;\n\n\tgatt_db_unref(database->db);\n\n\tbtd_adapter_unref(database->adapter);\n\tfree(database);\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic void gatt_database_free(void *data)\n{\n\tstruct btd_gatt_database *database = data;\n\n\tif (database->le_io) {\n\t\tg_io_channel_shutdown(database->le_io, FALSE, NULL);\n\t\tg_io_channel_unref(database->le_io);\n\t}\n\n\tif (database->l2cap_io) {\n\t\tg_io_channel_shutdown(database->l2cap_io, FALSE, NULL);\n\t\tg_io_channel_unref(database->l2cap_io);\n\t}\n\n\t/* TODO: Persistently store CCC states before freeing them */\n\tgatt_db_unregister(database->db, database->db_id);\n\n\tqueue_destroy(database->records, gatt_record_free);\n\tqueue_destroy(database->device_states, device_state_free);\n\tqueue_destroy(database->apps, app_free);\n\tqueue_destroy(database->profiles, profile_free);\n\tqueue_destroy(database->ccc_callbacks, ccc_cb_free);\n\tdatabase->device_states = NULL;\n\tdatabase->ccc_callbacks = NULL;\n\n\tgatt_db_unref(database->db);\n\n\tbtd_adapter_unref(database->adapter);\n\tfree(database);\n}"
        }
      },
      {
        "call_info": {
          "callee": "gatt_db_register",
          "args": [
            "database->db",
            "gatt_db_service_added",
            "gatt_db_service_removed",
            "database",
            "NULL"
          ],
          "line": 3296
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_register",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "592-620",
          "snippet": "unsigned int gatt_db_register(struct gatt_db *db,\n\t\t\t\t\tgatt_db_attribute_cb_t service_added,\n\t\t\t\t\tgatt_db_attribute_cb_t service_removed,\n\t\t\t\t\tvoid *user_data,\n\t\t\t\t\tgatt_db_destroy_func_t destroy)\n{\n\tstruct notify *notify;\n\n\tif (!db || !(service_added || service_removed))\n\t\treturn 0;\n\n\tnotify = new0(struct notify, 1);\n\tnotify->service_added = service_added;\n\tnotify->service_removed = service_removed;\n\tnotify->destroy = destroy;\n\tnotify->user_data = user_data;\n\n\tif (db->next_notify_id < 1)\n\t\tdb->next_notify_id = 1;\n\n\tnotify->id = db->next_notify_id++;\n\n\tif (!queue_push_tail(db->notify_list, notify)) {\n\t\tfree(notify);\n\t\treturn 0;\n\t}\n\n\treturn notify->id;\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nunsigned int gatt_db_register(struct gatt_db *db,\n\t\t\t\t\tgatt_db_attribute_cb_t service_added,\n\t\t\t\t\tgatt_db_attribute_cb_t service_removed,\n\t\t\t\t\tvoid *user_data,\n\t\t\t\t\tgatt_db_destroy_func_t destroy)\n{\n\tstruct notify *notify;\n\n\tif (!db || !(service_added || service_removed))\n\t\treturn 0;\n\n\tnotify = new0(struct notify, 1);\n\tnotify->service_added = service_added;\n\tnotify->service_removed = service_removed;\n\tnotify->destroy = destroy;\n\tnotify->user_data = user_data;\n\n\tif (db->next_notify_id < 1)\n\t\tdb->next_notify_id = 1;\n\n\tnotify->id = db->next_notify_id++;\n\n\tif (!queue_push_tail(db->notify_list, notify)) {\n\t\tfree(notify);\n\t\treturn 0;\n\t}\n\n\treturn notify->id;\n}"
        }
      },
      {
        "call_info": {
          "callee": "register_core_services",
          "args": [
            "database"
          ],
          "line": 3294
        },
        "resolved": true,
        "details": {
          "function_name": "register_core_services",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "1071-1075",
          "snippet": "static void register_core_services(struct btd_gatt_database *database)\n{\n\tpopulate_gap_service(database);\n\tpopulate_gatt_service(database);\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic void register_core_services(struct btd_gatt_database *database)\n{\n\tpopulate_gap_service(database);\n\tpopulate_gatt_service(database);\n}"
        }
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"GATT Manager registered for adapter: %s\"",
            "adapter_get_path(adapter)"
          ],
          "line": 3291
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "adapter_get_path",
          "args": [
            "adapter"
          ],
          "line": 3292
        },
        "resolved": true,
        "details": {
          "function_name": "adapter_get_path",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "5873-5879",
          "snippet": "const char *adapter_get_path(struct btd_adapter *adapter)\n{\n\tif (!adapter)\n\t\treturn NULL;\n\n\treturn adapter->path;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void trigger_pairable_timeout(struct btd_adapter *adapter);",
            "static void adapter_start(struct btd_adapter *adapter);",
            "static void adapter_stop(struct btd_adapter *adapter);",
            "static void trigger_passive_scanning(struct btd_adapter *adapter);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void trigger_pairable_timeout(struct btd_adapter *adapter);\nstatic void adapter_start(struct btd_adapter *adapter);\nstatic void adapter_stop(struct btd_adapter *adapter);\nstatic void trigger_passive_scanning(struct btd_adapter *adapter);\n\nconst char *adapter_get_path(struct btd_adapter *adapter)\n{\n\tif (!adapter)\n\t\treturn NULL;\n\n\treturn adapter->path;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_dbus_register_interface",
          "args": [
            "btd_get_dbus_connection()",
            "adapter_get_path(adapter)",
            "GATT_MANAGER_IFACE",
            "manager_methods",
            "NULL",
            "NULL",
            "database",
            "NULL"
          ],
          "line": 3286
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_get_dbus_connection",
          "args": [],
          "line": 3286
        },
        "resolved": true,
        "details": {
          "function_name": "btd_get_dbus_connection",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/dbus-common.c",
          "lines": "61-64",
          "snippet": "DBusConnection *btd_get_dbus_connection(void)\n{\n\treturn connection;\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <stdint.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static DBusConnection *connection = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <stdint.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *connection = NULL;\n\nDBusConnection *btd_get_dbus_connection(void)\n{\n\treturn connection;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_error_free",
          "args": [
            "gerr"
          ],
          "line": 3282
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"Failed to start listening: %s\"",
            "gerr->message"
          ],
          "line": 3281
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_failed",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "124-128",
          "snippet": "DBusMessage *btd_error_failed(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE\n\t\t\t\t\t\".Failed\", \"%s\", str);\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_failed(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE\n\t\t\t\t\t\".Failed\", \"%s\", str);\n}"
        }
      },
      {
        "call_info": {
          "callee": "bt_io_listen",
          "args": [
            "connect_cb",
            "NULL",
            "NULL",
            "NULL",
            "&gerr",
            "BT_IO_OPT_SOURCE_BDADDR",
            "addr",
            "BT_IO_OPT_PSM",
            "ATT_PSM",
            "BT_IO_OPT_SEC_LEVEL",
            "BT_IO_SEC_LOW",
            "BT_IO_OPT_MTU",
            "main_opts.gatt_mtu",
            "BT_IO_OPT_INVALID"
          ],
          "line": 3274
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_error_free",
          "args": [
            "gerr"
          ],
          "line": 3269
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bt_io_listen",
          "args": [
            "connect_cb",
            "NULL",
            "NULL",
            "NULL",
            "&gerr",
            "BT_IO_OPT_SOURCE_BDADDR",
            "addr",
            "BT_IO_OPT_SOURCE_TYPE",
            "btd_adapter_get_address_type(adapter)",
            "BT_IO_OPT_CID",
            "ATT_CID",
            "BT_IO_OPT_SEC_LEVEL",
            "BT_IO_SEC_LOW",
            "BT_IO_OPT_INVALID"
          ],
          "line": 3260
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_adapter_get_address_type",
          "args": [
            "adapter"
          ],
          "line": 3263
        },
        "resolved": true,
        "details": {
          "function_name": "btd_adapter_get_address_type",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "452-455",
          "snippet": "uint8_t btd_adapter_get_address_type(struct btd_adapter *adapter)\n{\n\treturn adapter->bdaddr_type;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void trigger_pairable_timeout(struct btd_adapter *adapter);",
            "static void adapter_start(struct btd_adapter *adapter);",
            "static void adapter_stop(struct btd_adapter *adapter);",
            "static void trigger_passive_scanning(struct btd_adapter *adapter);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void trigger_pairable_timeout(struct btd_adapter *adapter);\nstatic void adapter_start(struct btd_adapter *adapter);\nstatic void adapter_stop(struct btd_adapter *adapter);\nstatic void trigger_passive_scanning(struct btd_adapter *adapter);\n\nuint8_t btd_adapter_get_address_type(struct btd_adapter *adapter)\n{\n\treturn adapter->bdaddr_type;\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_adapter_get_address",
          "args": [
            "adapter"
          ],
          "line": 3259
        },
        "resolved": true,
        "details": {
          "function_name": "btd_adapter_get_address",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "5881-5884",
          "snippet": "const bdaddr_t *btd_adapter_get_address(struct btd_adapter *adapter)\n{\n\treturn &adapter->bdaddr;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void trigger_pairable_timeout(struct btd_adapter *adapter);",
            "static void adapter_start(struct btd_adapter *adapter);",
            "static void adapter_stop(struct btd_adapter *adapter);",
            "static void trigger_passive_scanning(struct btd_adapter *adapter);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void trigger_pairable_timeout(struct btd_adapter *adapter);\nstatic void adapter_start(struct btd_adapter *adapter);\nstatic void adapter_stop(struct btd_adapter *adapter);\nstatic void trigger_passive_scanning(struct btd_adapter *adapter);\n\nconst bdaddr_t *btd_adapter_get_address(struct btd_adapter *adapter)\n{\n\treturn &adapter->bdaddr;\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_new",
          "args": [],
          "line": 3257
        },
        "resolved": true,
        "details": {
          "function_name": "queue_new",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "56-66",
          "snippet": "struct queue *queue_new(void)\n{\n\tstruct queue *queue;\n\n\tqueue = new0(struct queue, 1);\n\tqueue->head = NULL;\n\tqueue->tail = NULL;\n\tqueue->entries = 0;\n\n\treturn queue_ref(queue);\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nstruct queue *queue_new(void)\n{\n\tstruct queue *queue;\n\n\tqueue = new0(struct queue, 1);\n\tqueue->head = NULL;\n\tqueue->tail = NULL;\n\tqueue->entries = 0;\n\n\treturn queue_ref(queue);\n}"
        }
      },
      {
        "call_info": {
          "callee": "gatt_db_new",
          "args": [],
          "line": 3252
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_new",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "220-230",
          "snippet": "struct gatt_db *gatt_db_new(void)\n{\n\tstruct gatt_db *db;\n\n\tdb = new0(struct gatt_db, 1);\n\tdb->services = queue_new();\n\tdb->notify_list = queue_new();\n\tdb->next_handle = 0x0001;\n\n\treturn gatt_db_ref(db);\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstruct gatt_db *gatt_db_new(void)\n{\n\tstruct gatt_db *db;\n\n\tdb = new0(struct gatt_db, 1);\n\tdb->services = queue_new();\n\tdb->notify_list = queue_new();\n\tdb->next_handle = 0x0001;\n\n\treturn gatt_db_ref(db);\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_adapter_ref",
          "args": [
            "adapter"
          ],
          "line": 3251
        },
        "resolved": true,
        "details": {
          "function_name": "btd_adapter_ref",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "4898-4903",
          "snippet": "struct btd_adapter *btd_adapter_ref(struct btd_adapter *adapter)\n{\n\t__sync_fetch_and_add(&adapter->ref_count, 1);\n\n\treturn adapter;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void trigger_pairable_timeout(struct btd_adapter *adapter);",
            "static void adapter_start(struct btd_adapter *adapter);",
            "static void adapter_stop(struct btd_adapter *adapter);",
            "static void trigger_passive_scanning(struct btd_adapter *adapter);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void trigger_pairable_timeout(struct btd_adapter *adapter);\nstatic void adapter_start(struct btd_adapter *adapter);\nstatic void adapter_stop(struct btd_adapter *adapter);\nstatic void trigger_passive_scanning(struct btd_adapter *adapter);\n\nstruct btd_adapter *btd_adapter_ref(struct btd_adapter *adapter)\n{\n\t__sync_fetch_and_add(&adapter->ref_count, 1);\n\n\treturn adapter;\n}"
        }
      },
      {
        "call_info": {
          "callee": "new0",
          "args": [
            "structbtd_gatt_database",
            "1"
          ],
          "line": 3250
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\n#define GATT_MANAGER_IFACE\t\"org.bluez.GattManager1\"\n#define ATT_PSM 31\n#define ATT_CID 4\n\nstatic const GDBusMethodTable manager_methods[] = {\n\t{ GDBUS_ASYNC_METHOD(\"RegisterApplication\",\n\t\t\t\t\tGDBUS_ARGS({ \"application\", \"o\" },\n\t\t\t\t\t\t{ \"options\", \"a{sv}\" }),\n\t\t\t\t\tNULL, manager_register_app) },\n\t{ GDBUS_ASYNC_METHOD(\"UnregisterApplication\",\n\t\t\t\t\tGDBUS_ARGS({ \"application\", \"o\" }),\n\t\t\t\t\tNULL, manager_unregister_app) },\n\t{ }\n};\n\nstruct btd_gatt_database *btd_gatt_database_new(struct btd_adapter *adapter)\n{\n\tstruct btd_gatt_database *database;\n\tGError *gerr = NULL;\n\tconst bdaddr_t *addr;\n\n\tif (!adapter)\n\t\treturn NULL;\n\n\tdatabase = new0(struct btd_gatt_database, 1);\n\tdatabase->adapter = btd_adapter_ref(adapter);\n\tdatabase->db = gatt_db_new();\n\tdatabase->records = queue_new();\n\tdatabase->device_states = queue_new();\n\tdatabase->apps = queue_new();\n\tdatabase->profiles = queue_new();\n\tdatabase->ccc_callbacks = queue_new();\n\n\taddr = btd_adapter_get_address(adapter);\n\tdatabase->le_io = bt_io_listen(connect_cb, NULL, NULL, NULL, &gerr,\n\t\t\t\t\tBT_IO_OPT_SOURCE_BDADDR, addr,\n\t\t\t\t\tBT_IO_OPT_SOURCE_TYPE,\n\t\t\t\t\tbtd_adapter_get_address_type(adapter),\n\t\t\t\t\tBT_IO_OPT_CID, ATT_CID,\n\t\t\t\t\tBT_IO_OPT_SEC_LEVEL, BT_IO_SEC_LOW,\n\t\t\t\t\tBT_IO_OPT_INVALID);\n\tif (!database->le_io) {\n\t\terror(\"Failed to start listening: %s\", gerr->message);\n\t\tg_error_free(gerr);\n\t\tgoto fail;\n\t}\n\n\t/* BR/EDR socket */\n\tdatabase->l2cap_io = bt_io_listen(connect_cb, NULL, NULL, NULL, &gerr,\n\t\t\t\t\tBT_IO_OPT_SOURCE_BDADDR, addr,\n\t\t\t\t\tBT_IO_OPT_PSM, ATT_PSM,\n\t\t\t\t\tBT_IO_OPT_SEC_LEVEL, BT_IO_SEC_LOW,\n\t\t\t\t\tBT_IO_OPT_MTU, main_opts.gatt_mtu,\n\t\t\t\t\tBT_IO_OPT_INVALID);\n\tif (database->l2cap_io == NULL) {\n\t\terror(\"Failed to start listening: %s\", gerr->message);\n\t\tg_error_free(gerr);\n\t\tgoto fail;\n\t}\n\n\tif (g_dbus_register_interface(btd_get_dbus_connection(),\n\t\t\t\t\t\tadapter_get_path(adapter),\n\t\t\t\t\t\tGATT_MANAGER_IFACE,\n\t\t\t\t\t\tmanager_methods, NULL, NULL,\n\t\t\t\t\t\tdatabase, NULL))\n\t\tDBG(\"GATT Manager registered for adapter: %s\",\n\t\t\t\t\t\tadapter_get_path(adapter));\n\n\tregister_core_services(database);\n\n\tdatabase->db_id = gatt_db_register(database->db, gatt_db_service_added,\n\t\t\t\t\t\t\tgatt_db_service_removed,\n\t\t\t\t\t\t\tdatabase, NULL);\n\tif (!database->db_id)\n\t\tgoto fail;\n\n\n\treturn database;\n\nfail:\n\tgatt_database_free(database);\n\n\treturn NULL;\n}"
  },
  {
    "function_name": "manager_unregister_app",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
    "lines": "3200-3228",
    "snippet": "static DBusMessage *manager_unregister_app(DBusConnection *conn,\n\t\t\t\t\tDBusMessage *msg, void *user_data)\n{\n\tstruct btd_gatt_database *database = user_data;\n\tconst char *sender = dbus_message_get_sender(msg);\n\tconst char *path;\n\tDBusMessageIter args;\n\tstruct gatt_app *app;\n\tstruct svc_match_data match_data;\n\n\tif (!dbus_message_iter_init(msg, &args))\n\t\treturn btd_error_invalid_args(msg);\n\n\tif (dbus_message_iter_get_arg_type(&args) != DBUS_TYPE_OBJECT_PATH)\n\t\treturn btd_error_invalid_args(msg);\n\n\tdbus_message_iter_get_basic(&args, &path);\n\n\tmatch_data.path = path;\n\tmatch_data.sender = sender;\n\n\tapp = queue_remove_if(database->apps, match_app, &match_data);\n\tif (!app)\n\t\treturn btd_error_does_not_exist(msg);\n\n\tapp_free(app);\n\n\treturn dbus_message_new_method_return(msg);\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"dbus-common.h\"",
      "#include \"gatt-database.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "dbus_message_new_method_return",
          "args": [
            "msg"
          ],
          "line": 3227
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "app_free",
          "args": [
            "app"
          ],
          "line": 3225
        },
        "resolved": true,
        "details": {
          "function_name": "app_free_idle_cb",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "1303-1308",
          "snippet": "static gboolean app_free_idle_cb(void *data)\n{\n\tapp_free(data);\n\n\treturn FALSE;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic gboolean app_free_idle_cb(void *data)\n{\n\tapp_free(data);\n\n\treturn FALSE;\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_error_does_not_exist",
          "args": [
            "msg"
          ],
          "line": 3223
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_does_not_exist",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "88-92",
          "snippet": "DBusMessage *btd_error_does_not_exist(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".DoesNotExist\",\n\t\t\t\t\t\"Does Not Exist\");\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_does_not_exist(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".DoesNotExist\",\n\t\t\t\t\t\"Does Not Exist\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_remove_if",
          "args": [
            "database->apps",
            "match_app",
            "&match_data"
          ],
          "line": 3221
        },
        "resolved": true,
        "details": {
          "function_name": "queue_remove_if",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "278-316",
          "snippet": "void *queue_remove_if(struct queue *queue, queue_match_func_t function,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct queue_entry *entry, *prev = NULL;\n\n\tif (!queue)\n\t\treturn NULL;\n\n\tif (!function)\n\t\tfunction = direct_match;\n\n\tentry = queue->head;\n\n\twhile (entry) {\n\t\tif (function(entry->data, user_data)) {\n\t\t\tvoid *data;\n\n\t\t\tif (prev)\n\t\t\t\tprev->next = entry->next;\n\t\t\telse\n\t\t\t\tqueue->head = entry->next;\n\n\t\t\tif (!entry->next)\n\t\t\t\tqueue->tail = prev;\n\n\t\t\tdata = entry->data;\n\n\t\t\tfree(entry);\n\t\t\tqueue->entries--;\n\n\t\t\treturn data;\n\t\t} else {\n\t\t\tprev = entry;\n\t\t\tentry = entry->next;\n\t\t}\n\t}\n\n\treturn NULL;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nvoid *queue_remove_if(struct queue *queue, queue_match_func_t function,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct queue_entry *entry, *prev = NULL;\n\n\tif (!queue)\n\t\treturn NULL;\n\n\tif (!function)\n\t\tfunction = direct_match;\n\n\tentry = queue->head;\n\n\twhile (entry) {\n\t\tif (function(entry->data, user_data)) {\n\t\t\tvoid *data;\n\n\t\t\tif (prev)\n\t\t\t\tprev->next = entry->next;\n\t\t\telse\n\t\t\t\tqueue->head = entry->next;\n\n\t\t\tif (!entry->next)\n\t\t\t\tqueue->tail = prev;\n\n\t\t\tdata = entry->data;\n\n\t\t\tfree(entry);\n\t\t\tqueue->entries--;\n\n\t\t\treturn data;\n\t\t} else {\n\t\t\tprev = entry;\n\t\t\tentry = entry->next;\n\t\t}\n\t}\n\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_get_basic",
          "args": [
            "&args",
            "&path"
          ],
          "line": 3216
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_error_invalid_args",
          "args": [
            "msg"
          ],
          "line": 3214
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_invalid_args",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "34-38",
          "snippet": "DBusMessage *btd_error_invalid_args(DBusMessage *msg)\n{\n\treturn btd_error_invalid_args_str(msg,\n\t\t\t\t\t\"Invalid arguments in method call\");\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_invalid_args(DBusMessage *msg)\n{\n\treturn btd_error_invalid_args_str(msg,\n\t\t\t\t\t\"Invalid arguments in method call\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_get_arg_type",
          "args": [
            "&args"
          ],
          "line": 3213
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_init",
          "args": [
            "msg",
            "&args"
          ],
          "line": 3210
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_get_sender",
          "args": [
            "msg"
          ],
          "line": 3204
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic DBusMessage *manager_unregister_app(DBusConnection *conn,\n\t\t\t\t\tDBusMessage *msg, void *user_data)\n{\n\tstruct btd_gatt_database *database = user_data;\n\tconst char *sender = dbus_message_get_sender(msg);\n\tconst char *path;\n\tDBusMessageIter args;\n\tstruct gatt_app *app;\n\tstruct svc_match_data match_data;\n\n\tif (!dbus_message_iter_init(msg, &args))\n\t\treturn btd_error_invalid_args(msg);\n\n\tif (dbus_message_iter_get_arg_type(&args) != DBUS_TYPE_OBJECT_PATH)\n\t\treturn btd_error_invalid_args(msg);\n\n\tdbus_message_iter_get_basic(&args, &path);\n\n\tmatch_data.path = path;\n\tmatch_data.sender = sender;\n\n\tapp = queue_remove_if(database->apps, match_app, &match_data);\n\tif (!app)\n\t\treturn btd_error_does_not_exist(msg);\n\n\tapp_free(app);\n\n\treturn dbus_message_new_method_return(msg);\n}"
  },
  {
    "function_name": "manager_register_app",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
    "lines": "3160-3198",
    "snippet": "static DBusMessage *manager_register_app(DBusConnection *conn,\n\t\t\t\t\tDBusMessage *msg, void *user_data)\n{\n\tstruct btd_gatt_database *database = user_data;\n\tconst char *sender = dbus_message_get_sender(msg);\n\tDBusMessageIter args;\n\tconst char *path;\n\tstruct gatt_app *app;\n\tstruct svc_match_data match_data;\n\n\tif (!dbus_message_iter_init(msg, &args))\n\t\treturn btd_error_invalid_args(msg);\n\n\tif (dbus_message_iter_get_arg_type(&args) != DBUS_TYPE_OBJECT_PATH)\n\t\treturn btd_error_invalid_args(msg);\n\n\tdbus_message_iter_get_basic(&args, &path);\n\n\tmatch_data.path = path;\n\tmatch_data.sender = sender;\n\n\tif (queue_find(database->apps, match_app, &match_data))\n\t\treturn btd_error_already_exists(msg);\n\n\tdbus_message_iter_next(&args);\n\tif (dbus_message_iter_get_arg_type(&args) != DBUS_TYPE_ARRAY)\n\t\treturn btd_error_invalid_args(msg);\n\n\tapp = create_app(conn, msg, path);\n\tif (!app)\n\t\treturn btd_error_failed(msg, \"Failed to register application\");\n\n\tDBG(\"Registering application: %s:%s\", sender, path);\n\n\tapp->database = database;\n\tqueue_push_tail(database->apps, app);\n\n\treturn NULL;\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"dbus-common.h\"",
      "#include \"gatt-database.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "queue_push_tail",
          "args": [
            "database->apps",
            "app"
          ],
          "line": 3195
        },
        "resolved": true,
        "details": {
          "function_name": "queue_push_tail",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "88-108",
          "snippet": "bool queue_push_tail(struct queue *queue, void *data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn false;\n\n\tentry = queue_entry_new(data);\n\n\tif (queue->tail)\n\t\tqueue->tail->next = entry;\n\n\tqueue->tail = entry;\n\n\tif (!queue->head)\n\t\tqueue->head = entry;\n\n\tqueue->entries++;\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nbool queue_push_tail(struct queue *queue, void *data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn false;\n\n\tentry = queue_entry_new(data);\n\n\tif (queue->tail)\n\t\tqueue->tail->next = entry;\n\n\tqueue->tail = entry;\n\n\tif (!queue->head)\n\t\tqueue->head = entry;\n\n\tqueue->entries++;\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"Registering application: %s:%s\"",
            "sender",
            "path"
          ],
          "line": 3192
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_error_failed",
          "args": [
            "msg",
            "\"Failed to register application\""
          ],
          "line": 3190
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_failed",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "124-128",
          "snippet": "DBusMessage *btd_error_failed(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE\n\t\t\t\t\t\".Failed\", \"%s\", str);\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_failed(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE\n\t\t\t\t\t\".Failed\", \"%s\", str);\n}"
        }
      },
      {
        "call_info": {
          "callee": "create_app",
          "args": [
            "conn",
            "msg",
            "path"
          ],
          "line": 3188
        },
        "resolved": true,
        "details": {
          "function_name": "create_app",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "3119-3158",
          "snippet": "static struct gatt_app *create_app(DBusConnection *conn, DBusMessage *msg,\n\t\t\t\t\t\t\tconst char *path)\n{\n\tstruct gatt_app *app;\n\tconst char *sender = dbus_message_get_sender(msg);\n\n\tif (!path || !g_str_has_prefix(path, \"/\"))\n\t\treturn NULL;\n\n\tapp = new0(struct gatt_app, 1);\n\n\tapp->client = g_dbus_client_new_full(conn, sender, path, path);\n\tif (!app->client)\n\t\tgoto fail;\n\n\tapp->owner = g_strdup(sender);\n\tif (!app->owner)\n\t\tgoto fail;\n\n\tapp->path = g_strdup(path);\n\tif (!app->path)\n\t\tgoto fail;\n\n\tapp->services = queue_new();\n\tapp->profiles = queue_new();\n\tapp->proxies = queue_new();\n\tapp->reg = dbus_message_ref(msg);\n\n\tg_dbus_client_set_disconnect_watch(app->client, client_disconnect_cb,\n\t\t\t\t\t\t\t\t\tapp);\n\tg_dbus_client_set_proxy_handlers(app->client, proxy_added_cb,\n\t\t\t\t\tproxy_removed_cb, NULL, app);\n\tg_dbus_client_set_ready_watch(app->client, client_ready_cb, app);\n\n\treturn app;\n\nfail:\n\tapp_free(app);\n\treturn NULL;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic struct gatt_app *create_app(DBusConnection *conn, DBusMessage *msg,\n\t\t\t\t\t\t\tconst char *path)\n{\n\tstruct gatt_app *app;\n\tconst char *sender = dbus_message_get_sender(msg);\n\n\tif (!path || !g_str_has_prefix(path, \"/\"))\n\t\treturn NULL;\n\n\tapp = new0(struct gatt_app, 1);\n\n\tapp->client = g_dbus_client_new_full(conn, sender, path, path);\n\tif (!app->client)\n\t\tgoto fail;\n\n\tapp->owner = g_strdup(sender);\n\tif (!app->owner)\n\t\tgoto fail;\n\n\tapp->path = g_strdup(path);\n\tif (!app->path)\n\t\tgoto fail;\n\n\tapp->services = queue_new();\n\tapp->profiles = queue_new();\n\tapp->proxies = queue_new();\n\tapp->reg = dbus_message_ref(msg);\n\n\tg_dbus_client_set_disconnect_watch(app->client, client_disconnect_cb,\n\t\t\t\t\t\t\t\t\tapp);\n\tg_dbus_client_set_proxy_handlers(app->client, proxy_added_cb,\n\t\t\t\t\tproxy_removed_cb, NULL, app);\n\tg_dbus_client_set_ready_watch(app->client, client_ready_cb, app);\n\n\treturn app;\n\nfail:\n\tapp_free(app);\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_error_invalid_args",
          "args": [
            "msg"
          ],
          "line": 3186
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_invalid_args",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "34-38",
          "snippet": "DBusMessage *btd_error_invalid_args(DBusMessage *msg)\n{\n\treturn btd_error_invalid_args_str(msg,\n\t\t\t\t\t\"Invalid arguments in method call\");\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_invalid_args(DBusMessage *msg)\n{\n\treturn btd_error_invalid_args_str(msg,\n\t\t\t\t\t\"Invalid arguments in method call\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_get_arg_type",
          "args": [
            "&args"
          ],
          "line": 3185
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_next",
          "args": [
            "&args"
          ],
          "line": 3184
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_error_already_exists",
          "args": [
            "msg"
          ],
          "line": 3182
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_already_exists",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "52-56",
          "snippet": "DBusMessage *btd_error_already_exists(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".AlreadyExists\",\n\t\t\t\t\t\"Already Exists\");\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_already_exists(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".AlreadyExists\",\n\t\t\t\t\t\"Already Exists\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_find",
          "args": [
            "database->apps",
            "match_app",
            "&match_data"
          ],
          "line": 3181
        },
        "resolved": true,
        "details": {
          "function_name": "queue_find",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "231-247",
          "snippet": "void *queue_find(struct queue *queue, queue_match_func_t function,\n\t\t\t\t\t\t\tconst void *match_data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn NULL;\n\n\tif (!function)\n\t\tfunction = direct_match;\n\n\tfor (entry = queue->head; entry; entry = entry->next)\n\t\tif (function(entry->data, match_data))\n\t\t\treturn entry->data;\n\n\treturn NULL;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nvoid *queue_find(struct queue *queue, queue_match_func_t function,\n\t\t\t\t\t\t\tconst void *match_data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn NULL;\n\n\tif (!function)\n\t\tfunction = direct_match;\n\n\tfor (entry = queue->head; entry; entry = entry->next)\n\t\tif (function(entry->data, match_data))\n\t\t\treturn entry->data;\n\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_get_basic",
          "args": [
            "&args",
            "&path"
          ],
          "line": 3176
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_get_arg_type",
          "args": [
            "&args"
          ],
          "line": 3173
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_init",
          "args": [
            "msg",
            "&args"
          ],
          "line": 3170
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_get_sender",
          "args": [
            "msg"
          ],
          "line": 3164
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic DBusMessage *manager_register_app(DBusConnection *conn,\n\t\t\t\t\tDBusMessage *msg, void *user_data)\n{\n\tstruct btd_gatt_database *database = user_data;\n\tconst char *sender = dbus_message_get_sender(msg);\n\tDBusMessageIter args;\n\tconst char *path;\n\tstruct gatt_app *app;\n\tstruct svc_match_data match_data;\n\n\tif (!dbus_message_iter_init(msg, &args))\n\t\treturn btd_error_invalid_args(msg);\n\n\tif (dbus_message_iter_get_arg_type(&args) != DBUS_TYPE_OBJECT_PATH)\n\t\treturn btd_error_invalid_args(msg);\n\n\tdbus_message_iter_get_basic(&args, &path);\n\n\tmatch_data.path = path;\n\tmatch_data.sender = sender;\n\n\tif (queue_find(database->apps, match_app, &match_data))\n\t\treturn btd_error_already_exists(msg);\n\n\tdbus_message_iter_next(&args);\n\tif (dbus_message_iter_get_arg_type(&args) != DBUS_TYPE_ARRAY)\n\t\treturn btd_error_invalid_args(msg);\n\n\tapp = create_app(conn, msg, path);\n\tif (!app)\n\t\treturn btd_error_failed(msg, \"Failed to register application\");\n\n\tDBG(\"Registering application: %s:%s\", sender, path);\n\n\tapp->database = database;\n\tqueue_push_tail(database->apps, app);\n\n\treturn NULL;\n}"
  },
  {
    "function_name": "create_app",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
    "lines": "3119-3158",
    "snippet": "static struct gatt_app *create_app(DBusConnection *conn, DBusMessage *msg,\n\t\t\t\t\t\t\tconst char *path)\n{\n\tstruct gatt_app *app;\n\tconst char *sender = dbus_message_get_sender(msg);\n\n\tif (!path || !g_str_has_prefix(path, \"/\"))\n\t\treturn NULL;\n\n\tapp = new0(struct gatt_app, 1);\n\n\tapp->client = g_dbus_client_new_full(conn, sender, path, path);\n\tif (!app->client)\n\t\tgoto fail;\n\n\tapp->owner = g_strdup(sender);\n\tif (!app->owner)\n\t\tgoto fail;\n\n\tapp->path = g_strdup(path);\n\tif (!app->path)\n\t\tgoto fail;\n\n\tapp->services = queue_new();\n\tapp->profiles = queue_new();\n\tapp->proxies = queue_new();\n\tapp->reg = dbus_message_ref(msg);\n\n\tg_dbus_client_set_disconnect_watch(app->client, client_disconnect_cb,\n\t\t\t\t\t\t\t\t\tapp);\n\tg_dbus_client_set_proxy_handlers(app->client, proxy_added_cb,\n\t\t\t\t\tproxy_removed_cb, NULL, app);\n\tg_dbus_client_set_ready_watch(app->client, client_ready_cb, app);\n\n\treturn app;\n\nfail:\n\tapp_free(app);\n\treturn NULL;\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"dbus-common.h\"",
      "#include \"gatt-database.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "app_free",
          "args": [
            "app"
          ],
          "line": 3156
        },
        "resolved": true,
        "details": {
          "function_name": "app_free_idle_cb",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "1303-1308",
          "snippet": "static gboolean app_free_idle_cb(void *data)\n{\n\tapp_free(data);\n\n\treturn FALSE;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic gboolean app_free_idle_cb(void *data)\n{\n\tapp_free(data);\n\n\treturn FALSE;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_dbus_client_set_ready_watch",
          "args": [
            "app->client",
            "client_ready_cb",
            "app"
          ],
          "line": 3151
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_dbus_client_set_proxy_handlers",
          "args": [
            "app->client",
            "proxy_added_cb",
            "proxy_removed_cb",
            "NULL",
            "app"
          ],
          "line": 3149
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_dbus_client_set_disconnect_watch",
          "args": [
            "app->client",
            "client_disconnect_cb",
            "app"
          ],
          "line": 3147
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_ref",
          "args": [
            "msg"
          ],
          "line": 3145
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "queue_new",
          "args": [],
          "line": 3144
        },
        "resolved": true,
        "details": {
          "function_name": "queue_new",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "56-66",
          "snippet": "struct queue *queue_new(void)\n{\n\tstruct queue *queue;\n\n\tqueue = new0(struct queue, 1);\n\tqueue->head = NULL;\n\tqueue->tail = NULL;\n\tqueue->entries = 0;\n\n\treturn queue_ref(queue);\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nstruct queue *queue_new(void)\n{\n\tstruct queue *queue;\n\n\tqueue = new0(struct queue, 1);\n\tqueue->head = NULL;\n\tqueue->tail = NULL;\n\tqueue->entries = 0;\n\n\treturn queue_ref(queue);\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_strdup",
          "args": [
            "path"
          ],
          "line": 3138
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_strdup",
          "args": [
            "sender"
          ],
          "line": 3134
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_dbus_client_new_full",
          "args": [
            "conn",
            "sender",
            "path",
            "path"
          ],
          "line": 3130
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "new0",
          "args": [
            "structgatt_app",
            "1"
          ],
          "line": 3128
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_str_has_prefix",
          "args": [
            "path",
            "\"/\""
          ],
          "line": 3125
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_get_sender",
          "args": [
            "msg"
          ],
          "line": 3123
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic struct gatt_app *create_app(DBusConnection *conn, DBusMessage *msg,\n\t\t\t\t\t\t\tconst char *path)\n{\n\tstruct gatt_app *app;\n\tconst char *sender = dbus_message_get_sender(msg);\n\n\tif (!path || !g_str_has_prefix(path, \"/\"))\n\t\treturn NULL;\n\n\tapp = new0(struct gatt_app, 1);\n\n\tapp->client = g_dbus_client_new_full(conn, sender, path, path);\n\tif (!app->client)\n\t\tgoto fail;\n\n\tapp->owner = g_strdup(sender);\n\tif (!app->owner)\n\t\tgoto fail;\n\n\tapp->path = g_strdup(path);\n\tif (!app->path)\n\t\tgoto fail;\n\n\tapp->services = queue_new();\n\tapp->profiles = queue_new();\n\tapp->proxies = queue_new();\n\tapp->reg = dbus_message_ref(msg);\n\n\tg_dbus_client_set_disconnect_watch(app->client, client_disconnect_cb,\n\t\t\t\t\t\t\t\t\tapp);\n\tg_dbus_client_set_proxy_handlers(app->client, proxy_added_cb,\n\t\t\t\t\tproxy_removed_cb, NULL, app);\n\tg_dbus_client_set_ready_watch(app->client, client_ready_cb, app);\n\n\treturn app;\n\nfail:\n\tapp_free(app);\n\treturn NULL;\n}"
  },
  {
    "function_name": "client_ready_cb",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
    "lines": "3067-3117",
    "snippet": "static void client_ready_cb(GDBusClient *client, void *user_data)\n{\n\tstruct gatt_app *app = user_data;\n\tDBusMessage *reply;\n\tbool fail = false;\n\n\t/*\n\t * Process received objects\n\t */\n\tif (queue_isempty(app->proxies)) {\n\t\terror(\"No object received\");\n\t\tfail = true;\n\t\treply = btd_error_failed(app->reg,\n\t\t\t\t\t\"No object received\");\n\t\tgoto reply;\n\t}\n\n\tqueue_foreach(app->proxies, register_profile, app);\n\tqueue_foreach(app->proxies, register_service, app);\n\tqueue_foreach(app->proxies, register_characteristic, app);\n\tqueue_foreach(app->proxies, register_descriptor, app);\n\n\tif ((queue_isempty(app->services) && queue_isempty(app->profiles)) ||\n\t\t\t\t\t\t\tapp->failed) {\n\t\terror(\"No valid external GATT objects found\");\n\t\tfail = true;\n\t\treply = btd_error_failed(app->reg,\n\t\t\t\t\t\"No valid service object found\");\n\t\tgoto reply;\n\t}\n\n\tif (!database_add_app(app)) {\n\t\terror(\"Failed to create GATT service entry in local database\");\n\t\tfail = true;\n\t\treply = btd_error_failed(app->reg,\n\t\t\t\t\t\"Failed to create entry in database\");\n\t\tgoto reply;\n\t}\n\n\tDBG(\"GATT application registered: %s:%s\", app->owner, app->path);\n\n\treply = dbus_message_new_method_return(app->reg);\n\nreply:\n\tg_dbus_send_message(btd_get_dbus_connection(), reply);\n\tdbus_message_unref(app->reg);\n\tapp->reg = NULL;\n\n\tif (fail)\n\t\tremove_app(app);\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"dbus-common.h\"",
      "#include \"gatt-database.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "remove_app",
          "args": [
            "app"
          ],
          "line": 3116
        },
        "resolved": true,
        "details": {
          "function_name": "remove_app",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "1321-1345",
          "snippet": "static void remove_app(void *data)\n{\n\tstruct gatt_app *app = data;\n\n\t/*\n\t * Set callback to NULL to avoid potential race condition\n\t * when calling remove_app and GDBusClient unref.\n\t */\n\tg_dbus_client_set_disconnect_watch(app->client, NULL, NULL);\n\n\t/*\n\t * Set proxy handlers to NULL, so that this gets called only once when\n\t * the first proxy that belongs to this service gets removed.\n\t */\n\tg_dbus_client_set_proxy_handlers(app->client, NULL, NULL, NULL, NULL);\n\n\n\tqueue_remove(app->database->apps, app);\n\n\t/*\n\t * Do not run in the same loop, this may be a disconnect\n\t * watch call and GDBusClient should not be destroyed.\n\t */\n\tg_idle_add(app_free_idle_cb, app);\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic void remove_app(void *data)\n{\n\tstruct gatt_app *app = data;\n\n\t/*\n\t * Set callback to NULL to avoid potential race condition\n\t * when calling remove_app and GDBusClient unref.\n\t */\n\tg_dbus_client_set_disconnect_watch(app->client, NULL, NULL);\n\n\t/*\n\t * Set proxy handlers to NULL, so that this gets called only once when\n\t * the first proxy that belongs to this service gets removed.\n\t */\n\tg_dbus_client_set_proxy_handlers(app->client, NULL, NULL, NULL, NULL);\n\n\n\tqueue_remove(app->database->apps, app);\n\n\t/*\n\t * Do not run in the same loop, this may be a disconnect\n\t * watch call and GDBusClient should not be destroyed.\n\t */\n\tg_idle_add(app_free_idle_cb, app);\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_message_unref",
          "args": [
            "app->reg"
          ],
          "line": 3112
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_dbus_send_message",
          "args": [
            "btd_get_dbus_connection()",
            "reply"
          ],
          "line": 3111
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_get_dbus_connection",
          "args": [],
          "line": 3111
        },
        "resolved": true,
        "details": {
          "function_name": "btd_get_dbus_connection",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/dbus-common.c",
          "lines": "61-64",
          "snippet": "DBusConnection *btd_get_dbus_connection(void)\n{\n\treturn connection;\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <stdint.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static DBusConnection *connection = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <stdint.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *connection = NULL;\n\nDBusConnection *btd_get_dbus_connection(void)\n{\n\treturn connection;\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_message_new_method_return",
          "args": [
            "app->reg"
          ],
          "line": 3108
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"GATT application registered: %s:%s\"",
            "app->owner",
            "app->path"
          ],
          "line": 3106
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_error_failed",
          "args": [
            "app->reg",
            "\"Failed to create entry in database\""
          ],
          "line": 3101
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_failed",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "124-128",
          "snippet": "DBusMessage *btd_error_failed(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE\n\t\t\t\t\t\".Failed\", \"%s\", str);\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_failed(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE\n\t\t\t\t\t\".Failed\", \"%s\", str);\n}"
        }
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"Failed to create GATT service entry in local database\""
          ],
          "line": 3099
        },
        "resolved": true,
        "details": {
          "function_name": "dbus_error_to_att_ecode",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "1833-1855",
          "snippet": "static uint8_t dbus_error_to_att_ecode(const char *error_name)\n{\n\n\tif (strcmp(error_name, \"org.bluez.Error.Failed\") == 0)\n\t\treturn 0x80;  /* For now return this \"application error\" */\n\n\tif (strcmp(error_name, \"org.bluez.Error.NotSupported\") == 0)\n\t\treturn BT_ATT_ERROR_REQUEST_NOT_SUPPORTED;\n\n\tif (strcmp(error_name, \"org.bluez.Error.NotAuthorized\") == 0)\n\t\treturn BT_ATT_ERROR_AUTHORIZATION;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InvalidValueLength\") == 0)\n\t\treturn BT_ATT_ERROR_INVALID_ATTRIBUTE_VALUE_LEN;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InvalidOffset\") == 0)\n\t\treturn BT_ATT_ERROR_INVALID_OFFSET;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InProgress\") == 0)\n\t\treturn BT_ERROR_ALREADY_IN_PROGRESS;\n\n\treturn 0;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic uint8_t dbus_error_to_att_ecode(const char *error_name)\n{\n\n\tif (strcmp(error_name, \"org.bluez.Error.Failed\") == 0)\n\t\treturn 0x80;  /* For now return this \"application error\" */\n\n\tif (strcmp(error_name, \"org.bluez.Error.NotSupported\") == 0)\n\t\treturn BT_ATT_ERROR_REQUEST_NOT_SUPPORTED;\n\n\tif (strcmp(error_name, \"org.bluez.Error.NotAuthorized\") == 0)\n\t\treturn BT_ATT_ERROR_AUTHORIZATION;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InvalidValueLength\") == 0)\n\t\treturn BT_ATT_ERROR_INVALID_ATTRIBUTE_VALUE_LEN;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InvalidOffset\") == 0)\n\t\treturn BT_ATT_ERROR_INVALID_OFFSET;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InProgress\") == 0)\n\t\treturn BT_ERROR_ALREADY_IN_PROGRESS;\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "database_add_app",
          "args": [
            "app"
          ],
          "line": 3098
        },
        "resolved": true,
        "details": {
          "function_name": "database_add_app",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "2850-2865",
          "snippet": "static bool database_add_app(struct gatt_app *app)\n{\n\tconst struct queue_entry *entry;\n\n\tentry = queue_get_entries(app->services);\n\twhile (entry) {\n\t\tif (!database_add_service(entry->data)) {\n\t\t\terror(\"Failed to add service\");\n\t\t\treturn false;\n\t\t}\n\n\t\tentry = entry->next;\n\t}\n\n\treturn true;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic bool database_add_app(struct gatt_app *app)\n{\n\tconst struct queue_entry *entry;\n\n\tentry = queue_get_entries(app->services);\n\twhile (entry) {\n\t\tif (!database_add_service(entry->data)) {\n\t\t\terror(\"Failed to add service\");\n\t\t\treturn false;\n\t\t}\n\n\t\tentry = entry->next;\n\t}\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_isempty",
          "args": [
            "app->profiles"
          ],
          "line": 3089
        },
        "resolved": true,
        "details": {
          "function_name": "queue_isempty",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "380-386",
          "snippet": "bool queue_isempty(struct queue *queue)\n{\n\tif (!queue)\n\t\treturn true;\n\n\treturn queue->entries == 0;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nbool queue_isempty(struct queue *queue)\n{\n\tif (!queue)\n\t\treturn true;\n\n\treturn queue->entries == 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_foreach",
          "args": [
            "app->proxies",
            "register_descriptor",
            "app"
          ],
          "line": 3087
        },
        "resolved": true,
        "details": {
          "function_name": "queue_foreach",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "203-224",
          "snippet": "void queue_foreach(struct queue *queue, queue_foreach_func_t function,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue || !function)\n\t\treturn;\n\n\tentry = queue->head;\n\tif (!entry)\n\t\treturn;\n\n\tqueue_ref(queue);\n\twhile (entry && queue->head && queue->ref_count > 1) {\n\t\tstruct queue_entry *next;\n\n\t\tnext = entry->next;\n\t\tfunction(entry->data, user_data);\n\t\tentry = next;\n\t}\n\tqueue_unref(queue);\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nvoid queue_foreach(struct queue *queue, queue_foreach_func_t function,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue || !function)\n\t\treturn;\n\n\tentry = queue->head;\n\tif (!entry)\n\t\treturn;\n\n\tqueue_ref(queue);\n\twhile (entry && queue->head && queue->ref_count > 1) {\n\t\tstruct queue_entry *next;\n\n\t\tnext = entry->next;\n\t\tfunction(entry->data, user_data);\n\t\tentry = next;\n\t}\n\tqueue_unref(queue);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic void client_ready_cb(GDBusClient *client, void *user_data)\n{\n\tstruct gatt_app *app = user_data;\n\tDBusMessage *reply;\n\tbool fail = false;\n\n\t/*\n\t * Process received objects\n\t */\n\tif (queue_isempty(app->proxies)) {\n\t\terror(\"No object received\");\n\t\tfail = true;\n\t\treply = btd_error_failed(app->reg,\n\t\t\t\t\t\"No object received\");\n\t\tgoto reply;\n\t}\n\n\tqueue_foreach(app->proxies, register_profile, app);\n\tqueue_foreach(app->proxies, register_service, app);\n\tqueue_foreach(app->proxies, register_characteristic, app);\n\tqueue_foreach(app->proxies, register_descriptor, app);\n\n\tif ((queue_isempty(app->services) && queue_isempty(app->profiles)) ||\n\t\t\t\t\t\t\tapp->failed) {\n\t\terror(\"No valid external GATT objects found\");\n\t\tfail = true;\n\t\treply = btd_error_failed(app->reg,\n\t\t\t\t\t\"No valid service object found\");\n\t\tgoto reply;\n\t}\n\n\tif (!database_add_app(app)) {\n\t\terror(\"Failed to create GATT service entry in local database\");\n\t\tfail = true;\n\t\treply = btd_error_failed(app->reg,\n\t\t\t\t\t\"Failed to create entry in database\");\n\t\tgoto reply;\n\t}\n\n\tDBG(\"GATT application registered: %s:%s\", app->owner, app->path);\n\n\treply = dbus_message_new_method_return(app->reg);\n\nreply:\n\tg_dbus_send_message(btd_get_dbus_connection(), reply);\n\tdbus_message_unref(app->reg);\n\tapp->reg = NULL;\n\n\tif (fail)\n\t\tremove_app(app);\n}"
  },
  {
    "function_name": "register_descriptor",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
    "lines": "3047-3065",
    "snippet": "static void register_descriptor(void *data, void *user_data)\n{\n\tstruct gatt_app *app = user_data;\n\tGDBusProxy *proxy = data;\n\tconst char *iface = g_dbus_proxy_get_interface(proxy);\n\n\tif (app->failed)\n\t\treturn;\n\n\tif (g_strcmp0(iface, GATT_DESC_IFACE) == 0) {\n\t\tstruct external_desc *desc;\n\n\t\tdesc = desc_create(app, proxy);\n\t\tif (!desc) {\n\t\t\tapp->failed = true;\n\t\t\treturn;\n\t\t}\n\t}\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"dbus-common.h\"",
      "#include \"gatt-database.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define GATT_DESC_IFACE\t\t\"org.bluez.GattDescriptor1\""
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "desc_create",
          "args": [
            "app",
            "proxy"
          ],
          "line": 3059
        },
        "resolved": true,
        "details": {
          "function_name": "desc_create",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "1605-1658",
          "snippet": "static struct external_desc *desc_create(struct gatt_app *app,\n\t\t\t\t\t\t\tGDBusProxy *proxy)\n{\n\tstruct external_service *service;\n\tstruct external_desc *desc;\n\tconst char *chrc_path;\n\n\tif (!parse_path(proxy, \"Characteristic\", &chrc_path)) {\n\t\terror(\"Failed to obtain characteristic path for descriptor\");\n\t\treturn NULL;\n\t}\n\n\tservice = queue_find(app->services, match_service_by_chrc, chrc_path);\n\tif (!service) {\n\t\terror(\"Unable to find service for characteristic: %s\",\n\t\t\t\t\t\t\t\tchrc_path);\n\t\treturn NULL;\n\t}\n\n\tdesc = new0(struct external_desc, 1);\n\tdesc->pending_reads = queue_new();\n\tdesc->pending_writes = queue_new();\n\n\tdesc->chrc_path = g_strdup(chrc_path);\n\tif (!desc->chrc_path)\n\t\tgoto fail;\n\n\tdesc->service = service;\n\tdesc->proxy = g_dbus_proxy_ref(proxy);\n\n\t/* Add 1 for the descriptor attribute */\n\tif (!incr_attr_count(desc->service, 1)) {\n\t\terror(\"Failed to increment attribute count\");\n\t\tgoto fail;\n\t}\n\n\t/*\n\t * Parse descriptors flags here since they are used to\n\t * determine the permission the descriptor should have\n\t */\n\tif (!parse_flags(proxy, NULL, NULL, &desc->perm,\n\t\t\t\t\t&desc->req_prep_authorization)) {\n\t\terror(\"Failed to parse characteristic properties\");\n\t\tgoto fail;\n\t}\n\n\tqueue_push_tail(desc->service->descs, desc);\n\n\treturn desc;\n\nfail:\n\tdesc_free(desc);\n\treturn NULL;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic struct external_desc *desc_create(struct gatt_app *app,\n\t\t\t\t\t\t\tGDBusProxy *proxy)\n{\n\tstruct external_service *service;\n\tstruct external_desc *desc;\n\tconst char *chrc_path;\n\n\tif (!parse_path(proxy, \"Characteristic\", &chrc_path)) {\n\t\terror(\"Failed to obtain characteristic path for descriptor\");\n\t\treturn NULL;\n\t}\n\n\tservice = queue_find(app->services, match_service_by_chrc, chrc_path);\n\tif (!service) {\n\t\terror(\"Unable to find service for characteristic: %s\",\n\t\t\t\t\t\t\t\tchrc_path);\n\t\treturn NULL;\n\t}\n\n\tdesc = new0(struct external_desc, 1);\n\tdesc->pending_reads = queue_new();\n\tdesc->pending_writes = queue_new();\n\n\tdesc->chrc_path = g_strdup(chrc_path);\n\tif (!desc->chrc_path)\n\t\tgoto fail;\n\n\tdesc->service = service;\n\tdesc->proxy = g_dbus_proxy_ref(proxy);\n\n\t/* Add 1 for the descriptor attribute */\n\tif (!incr_attr_count(desc->service, 1)) {\n\t\terror(\"Failed to increment attribute count\");\n\t\tgoto fail;\n\t}\n\n\t/*\n\t * Parse descriptors flags here since they are used to\n\t * determine the permission the descriptor should have\n\t */\n\tif (!parse_flags(proxy, NULL, NULL, &desc->perm,\n\t\t\t\t\t&desc->req_prep_authorization)) {\n\t\terror(\"Failed to parse characteristic properties\");\n\t\tgoto fail;\n\t}\n\n\tqueue_push_tail(desc->service->descs, desc);\n\n\treturn desc;\n\nfail:\n\tdesc_free(desc);\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_strcmp0",
          "args": [
            "iface",
            "GATT_DESC_IFACE"
          ],
          "line": 3056
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_dbus_proxy_get_interface",
          "args": [
            "proxy"
          ],
          "line": 3051
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\n#define GATT_DESC_IFACE\t\t\"org.bluez.GattDescriptor1\"\n\nstatic void register_descriptor(void *data, void *user_data)\n{\n\tstruct gatt_app *app = user_data;\n\tGDBusProxy *proxy = data;\n\tconst char *iface = g_dbus_proxy_get_interface(proxy);\n\n\tif (app->failed)\n\t\treturn;\n\n\tif (g_strcmp0(iface, GATT_DESC_IFACE) == 0) {\n\t\tstruct external_desc *desc;\n\n\t\tdesc = desc_create(app, proxy);\n\t\tif (!desc) {\n\t\t\tapp->failed = true;\n\t\t\treturn;\n\t\t}\n\t}\n}"
  },
  {
    "function_name": "register_characteristic",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
    "lines": "3023-3045",
    "snippet": "static void register_characteristic(void *data, void *user_data)\n{\n\tstruct gatt_app *app = user_data;\n\tGDBusProxy *proxy = data;\n\tconst char *iface = g_dbus_proxy_get_interface(proxy);\n\tconst char *path = g_dbus_proxy_get_path(proxy);\n\n\tif (app->failed)\n\t\treturn;\n\n\tiface = g_dbus_proxy_get_interface(proxy);\n\tpath = g_dbus_proxy_get_path(proxy);\n\n\tif (g_strcmp0(iface, GATT_CHRC_IFACE) == 0) {\n\t\tstruct external_chrc *chrc;\n\n\t\tchrc = chrc_create(app, proxy, path);\n\t\tif (!chrc) {\n\t\t\tapp->failed = true;\n\t\t\treturn;\n\t\t}\n\t}\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"dbus-common.h\"",
      "#include \"gatt-database.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define GATT_CHRC_IFACE\t\t\"org.bluez.GattCharacteristic1\""
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "chrc_create",
          "args": [
            "app",
            "proxy",
            "path"
          ],
          "line": 3039
        },
        "resolved": true,
        "details": {
          "function_name": "chrc_create",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "1517-1587",
          "snippet": "static struct external_chrc *chrc_create(struct gatt_app *app,\n\t\t\t\t\t\t\tGDBusProxy *proxy,\n\t\t\t\t\t\t\tconst char *path)\n{\n\tstruct external_service *service;\n\tstruct external_chrc *chrc;\n\tconst char *service_path;\n\n\tif (!parse_path(proxy, \"Service\", &service_path)) {\n\t\terror(\"Failed to obtain service path for characteristic\");\n\t\treturn NULL;\n\t}\n\n\tservice = queue_find(app->services, match_service_by_path,\n\t\t\t\t\t\t\t\tservice_path);\n\tif (!service) {\n\t\terror(\"Unable to find service for characteristic: %s\", path);\n\t\treturn NULL;\n\t}\n\n\tchrc = new0(struct external_chrc, 1);\n\tchrc->pending_reads = queue_new();\n\tchrc->pending_writes = queue_new();\n\n\tchrc->path = g_strdup(path);\n\tif (!chrc->path)\n\t\tgoto fail;\n\n\tchrc->service = service;\n\tchrc->proxy = g_dbus_proxy_ref(proxy);\n\n\t/*\n\t * Add 2 for the characteristic declaration and the value\n\t * attribute.\n\t */\n\tif (!incr_attr_count(chrc->service, 2)) {\n\t\terror(\"Failed to increment attribute count\");\n\t\tgoto fail;\n\t}\n\n\t/*\n\t * Parse characteristic flags (i.e. properties) here since they\n\t * are used to determine if any special descriptors should be\n\t * created.\n\t */\n\tif (!parse_flags(proxy, &chrc->props, &chrc->ext_props, &chrc->perm,\n\t\t\t\t\t&chrc->req_prep_authorization)) {\n\t\terror(\"Failed to parse characteristic properties\");\n\t\tgoto fail;\n\t}\n\n\tif ((chrc->props & BT_GATT_CHRC_PROP_NOTIFY ||\n\t\t\t\tchrc->props & BT_GATT_CHRC_PROP_INDICATE) &&\n\t\t\t\t!incr_attr_count(chrc->service, 1)) {\n\t\terror(\"Failed to increment attribute count for CCC\");\n\t\tgoto fail;\n\t}\n\n\tif (chrc->ext_props && !incr_attr_count(chrc->service, 1)) {\n\t\terror(\"Failed to increment attribute count for CEP\");\n\t\tgoto fail;\n\t}\n\n\tqueue_push_tail(chrc->service->chrcs, chrc);\n\n\treturn chrc;\n\nfail:\n\tchrc_free(chrc);\n\treturn NULL;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic struct external_chrc *chrc_create(struct gatt_app *app,\n\t\t\t\t\t\t\tGDBusProxy *proxy,\n\t\t\t\t\t\t\tconst char *path)\n{\n\tstruct external_service *service;\n\tstruct external_chrc *chrc;\n\tconst char *service_path;\n\n\tif (!parse_path(proxy, \"Service\", &service_path)) {\n\t\terror(\"Failed to obtain service path for characteristic\");\n\t\treturn NULL;\n\t}\n\n\tservice = queue_find(app->services, match_service_by_path,\n\t\t\t\t\t\t\t\tservice_path);\n\tif (!service) {\n\t\terror(\"Unable to find service for characteristic: %s\", path);\n\t\treturn NULL;\n\t}\n\n\tchrc = new0(struct external_chrc, 1);\n\tchrc->pending_reads = queue_new();\n\tchrc->pending_writes = queue_new();\n\n\tchrc->path = g_strdup(path);\n\tif (!chrc->path)\n\t\tgoto fail;\n\n\tchrc->service = service;\n\tchrc->proxy = g_dbus_proxy_ref(proxy);\n\n\t/*\n\t * Add 2 for the characteristic declaration and the value\n\t * attribute.\n\t */\n\tif (!incr_attr_count(chrc->service, 2)) {\n\t\terror(\"Failed to increment attribute count\");\n\t\tgoto fail;\n\t}\n\n\t/*\n\t * Parse characteristic flags (i.e. properties) here since they\n\t * are used to determine if any special descriptors should be\n\t * created.\n\t */\n\tif (!parse_flags(proxy, &chrc->props, &chrc->ext_props, &chrc->perm,\n\t\t\t\t\t&chrc->req_prep_authorization)) {\n\t\terror(\"Failed to parse characteristic properties\");\n\t\tgoto fail;\n\t}\n\n\tif ((chrc->props & BT_GATT_CHRC_PROP_NOTIFY ||\n\t\t\t\tchrc->props & BT_GATT_CHRC_PROP_INDICATE) &&\n\t\t\t\t!incr_attr_count(chrc->service, 1)) {\n\t\terror(\"Failed to increment attribute count for CCC\");\n\t\tgoto fail;\n\t}\n\n\tif (chrc->ext_props && !incr_attr_count(chrc->service, 1)) {\n\t\terror(\"Failed to increment attribute count for CEP\");\n\t\tgoto fail;\n\t}\n\n\tqueue_push_tail(chrc->service->chrcs, chrc);\n\n\treturn chrc;\n\nfail:\n\tchrc_free(chrc);\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_strcmp0",
          "args": [
            "iface",
            "GATT_CHRC_IFACE"
          ],
          "line": 3036
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_dbus_proxy_get_path",
          "args": [
            "proxy"
          ],
          "line": 3034
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_dbus_proxy_get_interface",
          "args": [
            "proxy"
          ],
          "line": 3033
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_dbus_proxy_get_path",
          "args": [
            "proxy"
          ],
          "line": 3028
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_dbus_proxy_get_interface",
          "args": [
            "proxy"
          ],
          "line": 3027
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\n#define GATT_CHRC_IFACE\t\t\"org.bluez.GattCharacteristic1\"\n\nstatic void register_characteristic(void *data, void *user_data)\n{\n\tstruct gatt_app *app = user_data;\n\tGDBusProxy *proxy = data;\n\tconst char *iface = g_dbus_proxy_get_interface(proxy);\n\tconst char *path = g_dbus_proxy_get_path(proxy);\n\n\tif (app->failed)\n\t\treturn;\n\n\tiface = g_dbus_proxy_get_interface(proxy);\n\tpath = g_dbus_proxy_get_path(proxy);\n\n\tif (g_strcmp0(iface, GATT_CHRC_IFACE) == 0) {\n\t\tstruct external_chrc *chrc;\n\n\t\tchrc = chrc_create(app, proxy, path);\n\t\tif (!chrc) {\n\t\t\tapp->failed = true;\n\t\t\treturn;\n\t\t}\n\t}\n}"
  },
  {
    "function_name": "register_service",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
    "lines": "3002-3021",
    "snippet": "static void register_service(void *data, void *user_data)\n{\n\tstruct gatt_app *app = user_data;\n\tGDBusProxy *proxy = data;\n\tconst char *iface = g_dbus_proxy_get_interface(proxy);\n\tconst char *path = g_dbus_proxy_get_path(proxy);\n\n\tif (app->failed)\n\t\treturn;\n\n\tif (g_strcmp0(iface, GATT_SERVICE_IFACE) == 0) {\n\t\tstruct external_service *service;\n\n\t\tservice = create_service(app, proxy, path);\n\t\tif (!service) {\n\t\t\tapp->failed = true;\n\t\t\treturn;\n\t\t}\n\t}\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"dbus-common.h\"",
      "#include \"gatt-database.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define GATT_SERVICE_IFACE\t\"org.bluez.GattService1\""
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "create_service",
          "args": [
            "app",
            "proxy",
            "path"
          ],
          "line": 3015
        },
        "resolved": true,
        "details": {
          "function_name": "create_service",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "1671-1712",
          "snippet": "static struct external_service *create_service(struct gatt_app *app,\n\t\t\t\t\t\tGDBusProxy *proxy,\n\t\t\t\t\t\tconst char *path)\n{\n\tstruct external_service *service;\n\n\tif (!path || !g_str_has_prefix(path, \"/\"))\n\t\treturn NULL;\n\n\tservice = queue_find(app->services, match_service_by_path, path);\n\tif (service) {\n\t\terror(\"Duplicated service: %s\", path);\n\t\treturn NULL;\n\t}\n\n\tservice = new0(struct external_service, 1);\n\n\tservice->app = app;\n\n\tservice->path = g_strdup(path);\n\tif (!service->path)\n\t\tgoto fail;\n\n\tservice->proxy = g_dbus_proxy_ref(proxy);\n\tservice->chrcs = queue_new();\n\tservice->descs = queue_new();\n\tservice->includes = queue_new();\n\n\t/* Add 1 for the service declaration */\n\tif (!incr_attr_count(service, 1)) {\n\t\terror(\"Failed to increment attribute count\");\n\t\tgoto fail;\n\t}\n\n\tqueue_push_tail(app->services, service);\n\n\treturn service;\n\nfail:\n\tservice_free(service);\n\treturn NULL;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic struct external_service *create_service(struct gatt_app *app,\n\t\t\t\t\t\tGDBusProxy *proxy,\n\t\t\t\t\t\tconst char *path)\n{\n\tstruct external_service *service;\n\n\tif (!path || !g_str_has_prefix(path, \"/\"))\n\t\treturn NULL;\n\n\tservice = queue_find(app->services, match_service_by_path, path);\n\tif (service) {\n\t\terror(\"Duplicated service: %s\", path);\n\t\treturn NULL;\n\t}\n\n\tservice = new0(struct external_service, 1);\n\n\tservice->app = app;\n\n\tservice->path = g_strdup(path);\n\tif (!service->path)\n\t\tgoto fail;\n\n\tservice->proxy = g_dbus_proxy_ref(proxy);\n\tservice->chrcs = queue_new();\n\tservice->descs = queue_new();\n\tservice->includes = queue_new();\n\n\t/* Add 1 for the service declaration */\n\tif (!incr_attr_count(service, 1)) {\n\t\terror(\"Failed to increment attribute count\");\n\t\tgoto fail;\n\t}\n\n\tqueue_push_tail(app->services, service);\n\n\treturn service;\n\nfail:\n\tservice_free(service);\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_strcmp0",
          "args": [
            "iface",
            "GATT_SERVICE_IFACE"
          ],
          "line": 3012
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_dbus_proxy_get_path",
          "args": [
            "proxy"
          ],
          "line": 3007
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_dbus_proxy_get_interface",
          "args": [
            "proxy"
          ],
          "line": 3006
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\n#define GATT_SERVICE_IFACE\t\"org.bluez.GattService1\"\n\nstatic void register_service(void *data, void *user_data)\n{\n\tstruct gatt_app *app = user_data;\n\tGDBusProxy *proxy = data;\n\tconst char *iface = g_dbus_proxy_get_interface(proxy);\n\tconst char *path = g_dbus_proxy_get_path(proxy);\n\n\tif (app->failed)\n\t\treturn;\n\n\tif (g_strcmp0(iface, GATT_SERVICE_IFACE) == 0) {\n\t\tstruct external_service *service;\n\n\t\tservice = create_service(app, proxy, path);\n\t\tif (!service) {\n\t\t\tapp->failed = true;\n\t\t\treturn;\n\t\t}\n\t}\n}"
  },
  {
    "function_name": "register_profile",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
    "lines": "2981-3000",
    "snippet": "static void register_profile(void *data, void *user_data)\n{\n\tstruct gatt_app *app = user_data;\n\tGDBusProxy *proxy = data;\n\tconst char *iface = g_dbus_proxy_get_interface(proxy);\n\tconst char *path = g_dbus_proxy_get_path(proxy);\n\n\tif (app->failed)\n\t\treturn;\n\n\tif (g_strcmp0(iface, GATT_PROFILE_IFACE) == 0) {\n\t\tstruct external_profile *profile;\n\n\t\tprofile = create_profile(app, proxy, path);\n\t\tif (!profile) {\n\t\t\tapp->failed = true;\n\t\t\treturn;\n\t\t}\n\t}\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"dbus-common.h\"",
      "#include \"gatt-database.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define GATT_PROFILE_IFACE\t\"org.bluez.GattProfile1\""
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "create_profile",
          "args": [
            "app",
            "proxy",
            "path"
          ],
          "line": 2994
        },
        "resolved": true,
        "details": {
          "function_name": "create_profile",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "2934-2979",
          "snippet": "static struct external_profile *create_profile(struct gatt_app *app,\n\t\t\t\t\t\tGDBusProxy *proxy,\n\t\t\t\t\t\tconst char *path)\n{\n\tstruct external_profile *profile;\n\tDBusMessageIter iter, array;\n\n\tif (!path || !g_str_has_prefix(path, \"/\"))\n\t\treturn NULL;\n\n\tprofile = new0(struct external_profile, 1);\n\n\tprofile->app = app;\n\tprofile->proxy = g_dbus_proxy_ref(proxy);\n\tprofile->profiles = queue_new();\n\n\tif (!g_dbus_proxy_get_property(proxy, \"UUIDs\", &iter)) {\n\t\tDBG(\"UUIDs property not found\");\n\t\tgoto fail;\n\t}\n\n\tdbus_message_iter_recurse(&iter, &array);\n\n\twhile (dbus_message_iter_get_arg_type(&array) == DBUS_TYPE_STRING) {\n\t\tconst char *uuid;\n\n\t\tdbus_message_iter_get_basic(&array, &uuid);\n\n\t\tif (profile_add(profile, uuid) < 0)\n\t\t\tgoto fail;\n\n\t\tdbus_message_iter_next(&array);\n\t}\n\n\tif (queue_isempty(profile->profiles))\n\t\tgoto fail;\n\n\tqueue_foreach(profile->profiles, add_profile, app->database->adapter);\n\tqueue_push_tail(app->profiles, profile);\n\n\treturn profile;\n\nfail:\n\tprofile_free(profile);\n\treturn NULL;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic struct external_profile *create_profile(struct gatt_app *app,\n\t\t\t\t\t\tGDBusProxy *proxy,\n\t\t\t\t\t\tconst char *path)\n{\n\tstruct external_profile *profile;\n\tDBusMessageIter iter, array;\n\n\tif (!path || !g_str_has_prefix(path, \"/\"))\n\t\treturn NULL;\n\n\tprofile = new0(struct external_profile, 1);\n\n\tprofile->app = app;\n\tprofile->proxy = g_dbus_proxy_ref(proxy);\n\tprofile->profiles = queue_new();\n\n\tif (!g_dbus_proxy_get_property(proxy, \"UUIDs\", &iter)) {\n\t\tDBG(\"UUIDs property not found\");\n\t\tgoto fail;\n\t}\n\n\tdbus_message_iter_recurse(&iter, &array);\n\n\twhile (dbus_message_iter_get_arg_type(&array) == DBUS_TYPE_STRING) {\n\t\tconst char *uuid;\n\n\t\tdbus_message_iter_get_basic(&array, &uuid);\n\n\t\tif (profile_add(profile, uuid) < 0)\n\t\t\tgoto fail;\n\n\t\tdbus_message_iter_next(&array);\n\t}\n\n\tif (queue_isempty(profile->profiles))\n\t\tgoto fail;\n\n\tqueue_foreach(profile->profiles, add_profile, app->database->adapter);\n\tqueue_push_tail(app->profiles, profile);\n\n\treturn profile;\n\nfail:\n\tprofile_free(profile);\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_strcmp0",
          "args": [
            "iface",
            "GATT_PROFILE_IFACE"
          ],
          "line": 2991
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_dbus_proxy_get_path",
          "args": [
            "proxy"
          ],
          "line": 2986
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_dbus_proxy_get_interface",
          "args": [
            "proxy"
          ],
          "line": 2985
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\n#define GATT_PROFILE_IFACE\t\"org.bluez.GattProfile1\"\n\nstatic void register_profile(void *data, void *user_data)\n{\n\tstruct gatt_app *app = user_data;\n\tGDBusProxy *proxy = data;\n\tconst char *iface = g_dbus_proxy_get_interface(proxy);\n\tconst char *path = g_dbus_proxy_get_path(proxy);\n\n\tif (app->failed)\n\t\treturn;\n\n\tif (g_strcmp0(iface, GATT_PROFILE_IFACE) == 0) {\n\t\tstruct external_profile *profile;\n\n\t\tprofile = create_profile(app, proxy, path);\n\t\tif (!profile) {\n\t\t\tapp->failed = true;\n\t\t\treturn;\n\t\t}\n\t}\n}"
  },
  {
    "function_name": "create_profile",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
    "lines": "2934-2979",
    "snippet": "static struct external_profile *create_profile(struct gatt_app *app,\n\t\t\t\t\t\tGDBusProxy *proxy,\n\t\t\t\t\t\tconst char *path)\n{\n\tstruct external_profile *profile;\n\tDBusMessageIter iter, array;\n\n\tif (!path || !g_str_has_prefix(path, \"/\"))\n\t\treturn NULL;\n\n\tprofile = new0(struct external_profile, 1);\n\n\tprofile->app = app;\n\tprofile->proxy = g_dbus_proxy_ref(proxy);\n\tprofile->profiles = queue_new();\n\n\tif (!g_dbus_proxy_get_property(proxy, \"UUIDs\", &iter)) {\n\t\tDBG(\"UUIDs property not found\");\n\t\tgoto fail;\n\t}\n\n\tdbus_message_iter_recurse(&iter, &array);\n\n\twhile (dbus_message_iter_get_arg_type(&array) == DBUS_TYPE_STRING) {\n\t\tconst char *uuid;\n\n\t\tdbus_message_iter_get_basic(&array, &uuid);\n\n\t\tif (profile_add(profile, uuid) < 0)\n\t\t\tgoto fail;\n\n\t\tdbus_message_iter_next(&array);\n\t}\n\n\tif (queue_isempty(profile->profiles))\n\t\tgoto fail;\n\n\tqueue_foreach(profile->profiles, add_profile, app->database->adapter);\n\tqueue_push_tail(app->profiles, profile);\n\n\treturn profile;\n\nfail:\n\tprofile_free(profile);\n\treturn NULL;\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"dbus-common.h\"",
      "#include \"gatt-database.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "profile_free",
          "args": [
            "profile"
          ],
          "line": 2977
        },
        "resolved": true,
        "details": {
          "function_name": "profile_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "531-542",
          "snippet": "static void profile_free(void *data)\n{\n\tstruct external_profile *profile = data;\n\n\tqueue_destroy(profile->profiles, profile_remove);\n\n\tprofile_release(profile);\n\n\tg_dbus_proxy_unref(profile->proxy);\n\n\tfree(profile);\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic void profile_free(void *data)\n{\n\tstruct external_profile *profile = data;\n\n\tqueue_destroy(profile->profiles, profile_remove);\n\n\tprofile_release(profile);\n\n\tg_dbus_proxy_unref(profile->proxy);\n\n\tfree(profile);\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_push_tail",
          "args": [
            "app->profiles",
            "profile"
          ],
          "line": 2972
        },
        "resolved": true,
        "details": {
          "function_name": "queue_push_tail",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "88-108",
          "snippet": "bool queue_push_tail(struct queue *queue, void *data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn false;\n\n\tentry = queue_entry_new(data);\n\n\tif (queue->tail)\n\t\tqueue->tail->next = entry;\n\n\tqueue->tail = entry;\n\n\tif (!queue->head)\n\t\tqueue->head = entry;\n\n\tqueue->entries++;\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nbool queue_push_tail(struct queue *queue, void *data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn false;\n\n\tentry = queue_entry_new(data);\n\n\tif (queue->tail)\n\t\tqueue->tail->next = entry;\n\n\tqueue->tail = entry;\n\n\tif (!queue->head)\n\t\tqueue->head = entry;\n\n\tqueue->entries++;\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_foreach",
          "args": [
            "profile->profiles",
            "add_profile",
            "app->database->adapter"
          ],
          "line": 2971
        },
        "resolved": true,
        "details": {
          "function_name": "queue_foreach",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "203-224",
          "snippet": "void queue_foreach(struct queue *queue, queue_foreach_func_t function,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue || !function)\n\t\treturn;\n\n\tentry = queue->head;\n\tif (!entry)\n\t\treturn;\n\n\tqueue_ref(queue);\n\twhile (entry && queue->head && queue->ref_count > 1) {\n\t\tstruct queue_entry *next;\n\n\t\tnext = entry->next;\n\t\tfunction(entry->data, user_data);\n\t\tentry = next;\n\t}\n\tqueue_unref(queue);\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nvoid queue_foreach(struct queue *queue, queue_foreach_func_t function,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue || !function)\n\t\treturn;\n\n\tentry = queue->head;\n\tif (!entry)\n\t\treturn;\n\n\tqueue_ref(queue);\n\twhile (entry && queue->head && queue->ref_count > 1) {\n\t\tstruct queue_entry *next;\n\n\t\tnext = entry->next;\n\t\tfunction(entry->data, user_data);\n\t\tentry = next;\n\t}\n\tqueue_unref(queue);\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_isempty",
          "args": [
            "profile->profiles"
          ],
          "line": 2968
        },
        "resolved": true,
        "details": {
          "function_name": "queue_isempty",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "380-386",
          "snippet": "bool queue_isempty(struct queue *queue)\n{\n\tif (!queue)\n\t\treturn true;\n\n\treturn queue->entries == 0;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nbool queue_isempty(struct queue *queue)\n{\n\tif (!queue)\n\t\treturn true;\n\n\treturn queue->entries == 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_next",
          "args": [
            "&array"
          ],
          "line": 2965
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "profile_add",
          "args": [
            "profile",
            "uuid"
          ],
          "line": 2962
        },
        "resolved": true,
        "details": {
          "function_name": "profile_add",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "2892-2924",
          "snippet": "static int profile_add(struct external_profile *profile, const char *uuid)\n{\n\tstruct btd_profile *p;\n\n\tp = new0(struct btd_profile, 1);\n\n\t/* Assign directly to avoid having extra fields */\n\tp->name = (const void *) g_strdup_printf(\"%s%s/%s\", profile->app->owner,\n\t\t\t\tg_dbus_proxy_get_path(profile->proxy), uuid);\n\tif (!p->name) {\n\t\tfree(p);\n\t\treturn -ENOMEM;\n\t}\n\n\tp->remote_uuid = (const void *) g_strdup(uuid);\n\tif (!p->remote_uuid) {\n\t\tg_free((void *) p->name);\n\t\tfree(p);\n\t\treturn -ENOMEM;\n\t}\n\n\tp->device_probe = profile_device_probe;\n\tp->device_remove = profile_device_remove;\n\tp->accept = profile_device_accept;\n\tp->auto_connect = true;\n\tp->external = true;\n\n\tqueue_push_tail(profile->profiles, p);\n\n\tDBG(\"Added \\\"%s\\\"\", p->name);\n\n\treturn 0;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic int profile_add(struct external_profile *profile, const char *uuid)\n{\n\tstruct btd_profile *p;\n\n\tp = new0(struct btd_profile, 1);\n\n\t/* Assign directly to avoid having extra fields */\n\tp->name = (const void *) g_strdup_printf(\"%s%s/%s\", profile->app->owner,\n\t\t\t\tg_dbus_proxy_get_path(profile->proxy), uuid);\n\tif (!p->name) {\n\t\tfree(p);\n\t\treturn -ENOMEM;\n\t}\n\n\tp->remote_uuid = (const void *) g_strdup(uuid);\n\tif (!p->remote_uuid) {\n\t\tg_free((void *) p->name);\n\t\tfree(p);\n\t\treturn -ENOMEM;\n\t}\n\n\tp->device_probe = profile_device_probe;\n\tp->device_remove = profile_device_remove;\n\tp->accept = profile_device_accept;\n\tp->auto_connect = true;\n\tp->external = true;\n\n\tqueue_push_tail(profile->profiles, p);\n\n\tDBG(\"Added \\\"%s\\\"\", p->name);\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_get_basic",
          "args": [
            "&array",
            "&uuid"
          ],
          "line": 2960
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_get_arg_type",
          "args": [
            "&array"
          ],
          "line": 2957
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_recurse",
          "args": [
            "&iter",
            "&array"
          ],
          "line": 2955
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"UUIDs property not found\""
          ],
          "line": 2951
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_dbus_proxy_get_property",
          "args": [
            "proxy",
            "\"UUIDs\"",
            "&iter"
          ],
          "line": 2950
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "queue_new",
          "args": [],
          "line": 2948
        },
        "resolved": true,
        "details": {
          "function_name": "queue_new",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "56-66",
          "snippet": "struct queue *queue_new(void)\n{\n\tstruct queue *queue;\n\n\tqueue = new0(struct queue, 1);\n\tqueue->head = NULL;\n\tqueue->tail = NULL;\n\tqueue->entries = 0;\n\n\treturn queue_ref(queue);\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nstruct queue *queue_new(void)\n{\n\tstruct queue *queue;\n\n\tqueue = new0(struct queue, 1);\n\tqueue->head = NULL;\n\tqueue->tail = NULL;\n\tqueue->entries = 0;\n\n\treturn queue_ref(queue);\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_dbus_proxy_ref",
          "args": [
            "proxy"
          ],
          "line": 2947
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "new0",
          "args": [
            "structexternal_profile",
            "1"
          ],
          "line": 2944
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_str_has_prefix",
          "args": [
            "path",
            "\"/\""
          ],
          "line": 2941
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic struct external_profile *create_profile(struct gatt_app *app,\n\t\t\t\t\t\tGDBusProxy *proxy,\n\t\t\t\t\t\tconst char *path)\n{\n\tstruct external_profile *profile;\n\tDBusMessageIter iter, array;\n\n\tif (!path || !g_str_has_prefix(path, \"/\"))\n\t\treturn NULL;\n\n\tprofile = new0(struct external_profile, 1);\n\n\tprofile->app = app;\n\tprofile->proxy = g_dbus_proxy_ref(proxy);\n\tprofile->profiles = queue_new();\n\n\tif (!g_dbus_proxy_get_property(proxy, \"UUIDs\", &iter)) {\n\t\tDBG(\"UUIDs property not found\");\n\t\tgoto fail;\n\t}\n\n\tdbus_message_iter_recurse(&iter, &array);\n\n\twhile (dbus_message_iter_get_arg_type(&array) == DBUS_TYPE_STRING) {\n\t\tconst char *uuid;\n\n\t\tdbus_message_iter_get_basic(&array, &uuid);\n\n\t\tif (profile_add(profile, uuid) < 0)\n\t\t\tgoto fail;\n\n\t\tdbus_message_iter_next(&array);\n\t}\n\n\tif (queue_isempty(profile->profiles))\n\t\tgoto fail;\n\n\tqueue_foreach(profile->profiles, add_profile, app->database->adapter);\n\tqueue_push_tail(app->profiles, profile);\n\n\treturn profile;\n\nfail:\n\tprofile_free(profile);\n\treturn NULL;\n}"
  },
  {
    "function_name": "add_profile",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
    "lines": "2926-2932",
    "snippet": "static void add_profile(void *data, void *user_data)\n{\n\tstruct btd_adapter *adapter = user_data;\n\n\tbtd_profile_register(data);\n\tadapter_add_profile(adapter, data);\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"dbus-common.h\"",
      "#include \"gatt-database.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "adapter_add_profile",
          "args": [
            "adapter",
            "data"
          ],
          "line": 2931
        },
        "resolved": true,
        "details": {
          "function_name": "adapter_add_profile",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "4304-4314",
          "snippet": "void adapter_add_profile(struct btd_adapter *adapter, gpointer p)\n{\n\tstruct btd_profile *profile = p;\n\n\tif (!adapter->initialized)\n\t\treturn;\n\n\tprobe_profile(profile, adapter);\n\n\tg_slist_foreach(adapter->devices, device_probe_profile, profile);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void trigger_pairable_timeout(struct btd_adapter *adapter);",
            "static void adapter_start(struct btd_adapter *adapter);",
            "static void adapter_stop(struct btd_adapter *adapter);",
            "static void trigger_passive_scanning(struct btd_adapter *adapter);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void trigger_pairable_timeout(struct btd_adapter *adapter);\nstatic void adapter_start(struct btd_adapter *adapter);\nstatic void adapter_stop(struct btd_adapter *adapter);\nstatic void trigger_passive_scanning(struct btd_adapter *adapter);\n\nvoid adapter_add_profile(struct btd_adapter *adapter, gpointer p)\n{\n\tstruct btd_profile *profile = p;\n\n\tif (!adapter->initialized)\n\t\treturn;\n\n\tprobe_profile(profile, adapter);\n\n\tg_slist_foreach(adapter->devices, device_probe_profile, profile);\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_profile_register",
          "args": [
            "data"
          ],
          "line": 2930
        },
        "resolved": true,
        "details": {
          "function_name": "btd_profile_register",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/profile.c",
          "lines": "720-724",
          "snippet": "int btd_profile_register(struct btd_profile *profile)\n{\n\tprofiles = g_slist_append(profiles, profile);\n\treturn 0;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdp-xml.h\"",
            "#include \"sdp-client.h\"",
            "#include \"dbus-common.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"sdpd.h\"",
            "#include \"btio/btio.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static GSList *profiles = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdp-xml.h\"\n#include \"sdp-client.h\"\n#include \"dbus-common.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"sdpd.h\"\n#include \"btio/btio.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic GSList *profiles = NULL;\n\nint btd_profile_register(struct btd_profile *profile)\n{\n\tprofiles = g_slist_append(profiles, profile);\n\treturn 0;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic void add_profile(void *data, void *user_data)\n{\n\tstruct btd_adapter *adapter = user_data;\n\n\tbtd_profile_register(data);\n\tadapter_add_profile(adapter, data);\n}"
  },
  {
    "function_name": "profile_add",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
    "lines": "2892-2924",
    "snippet": "static int profile_add(struct external_profile *profile, const char *uuid)\n{\n\tstruct btd_profile *p;\n\n\tp = new0(struct btd_profile, 1);\n\n\t/* Assign directly to avoid having extra fields */\n\tp->name = (const void *) g_strdup_printf(\"%s%s/%s\", profile->app->owner,\n\t\t\t\tg_dbus_proxy_get_path(profile->proxy), uuid);\n\tif (!p->name) {\n\t\tfree(p);\n\t\treturn -ENOMEM;\n\t}\n\n\tp->remote_uuid = (const void *) g_strdup(uuid);\n\tif (!p->remote_uuid) {\n\t\tg_free((void *) p->name);\n\t\tfree(p);\n\t\treturn -ENOMEM;\n\t}\n\n\tp->device_probe = profile_device_probe;\n\tp->device_remove = profile_device_remove;\n\tp->accept = profile_device_accept;\n\tp->auto_connect = true;\n\tp->external = true;\n\n\tqueue_push_tail(profile->profiles, p);\n\n\tDBG(\"Added \\\"%s\\\"\", p->name);\n\n\treturn 0;\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"dbus-common.h\"",
      "#include \"gatt-database.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"Added \\\"%s\\\"\"",
            "p->name"
          ],
          "line": 2921
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "queue_push_tail",
          "args": [
            "profile->profiles",
            "p"
          ],
          "line": 2919
        },
        "resolved": true,
        "details": {
          "function_name": "queue_push_tail",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "88-108",
          "snippet": "bool queue_push_tail(struct queue *queue, void *data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn false;\n\n\tentry = queue_entry_new(data);\n\n\tif (queue->tail)\n\t\tqueue->tail->next = entry;\n\n\tqueue->tail = entry;\n\n\tif (!queue->head)\n\t\tqueue->head = entry;\n\n\tqueue->entries++;\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nbool queue_push_tail(struct queue *queue, void *data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn false;\n\n\tentry = queue_entry_new(data);\n\n\tif (queue->tail)\n\t\tqueue->tail->next = entry;\n\n\tqueue->tail = entry;\n\n\tif (!queue->head)\n\t\tqueue->head = entry;\n\n\tqueue->entries++;\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "free",
          "args": [
            "p"
          ],
          "line": 2909
        },
        "resolved": true,
        "details": {
          "function_name": "app_free_idle_cb",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "1303-1308",
          "snippet": "static gboolean app_free_idle_cb(void *data)\n{\n\tapp_free(data);\n\n\treturn FALSE;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic gboolean app_free_idle_cb(void *data)\n{\n\tapp_free(data);\n\n\treturn FALSE;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_free",
          "args": [
            "(void *) p->name"
          ],
          "line": 2908
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_strdup",
          "args": [
            "uuid"
          ],
          "line": 2906
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_strdup_printf",
          "args": [
            "\"%s%s/%s\"",
            "profile->app->owner",
            "g_dbus_proxy_get_path(profile->proxy)",
            "uuid"
          ],
          "line": 2899
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_dbus_proxy_get_path",
          "args": [
            "profile->proxy"
          ],
          "line": 2900
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "new0",
          "args": [
            "structbtd_profile",
            "1"
          ],
          "line": 2896
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic int profile_add(struct external_profile *profile, const char *uuid)\n{\n\tstruct btd_profile *p;\n\n\tp = new0(struct btd_profile, 1);\n\n\t/* Assign directly to avoid having extra fields */\n\tp->name = (const void *) g_strdup_printf(\"%s%s/%s\", profile->app->owner,\n\t\t\t\tg_dbus_proxy_get_path(profile->proxy), uuid);\n\tif (!p->name) {\n\t\tfree(p);\n\t\treturn -ENOMEM;\n\t}\n\n\tp->remote_uuid = (const void *) g_strdup(uuid);\n\tif (!p->remote_uuid) {\n\t\tg_free((void *) p->name);\n\t\tfree(p);\n\t\treturn -ENOMEM;\n\t}\n\n\tp->device_probe = profile_device_probe;\n\tp->device_remove = profile_device_remove;\n\tp->accept = profile_device_accept;\n\tp->auto_connect = true;\n\tp->external = true;\n\n\tqueue_push_tail(profile->profiles, p);\n\n\tDBG(\"Added \\\"%s\\\"\", p->name);\n\n\treturn 0;\n}"
  },
  {
    "function_name": "profile_device_accept",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
    "lines": "2883-2890",
    "snippet": "static int profile_device_accept(struct btd_service *service)\n{\n\tstruct btd_profile *p = btd_service_get_profile(service);\n\n\tDBG(\"%s accept\", p->name);\n\n\treturn 0;\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"dbus-common.h\"",
      "#include \"gatt-database.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"%s accept\"",
            "p->name"
          ],
          "line": 2887
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_service_get_profile",
          "args": [
            "service"
          ],
          "line": 2885
        },
        "resolved": true,
        "details": {
          "function_name": "btd_service_get_profile",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/service.c",
          "lines": "316-319",
          "snippet": "struct btd_profile *btd_service_get_profile(const struct btd_service *service)\n{\n\treturn service->profile;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"backtrace.h\"",
            "#include \"log.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/stat.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <errno.h>\n#include <sys/ioctl.h>\n#include <sys/stat.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstruct btd_profile *btd_service_get_profile(const struct btd_service *service)\n{\n\treturn service->profile;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic int profile_device_accept(struct btd_service *service)\n{\n\tstruct btd_profile *p = btd_service_get_profile(service);\n\n\tDBG(\"%s accept\", p->name);\n\n\treturn 0;\n}"
  },
  {
    "function_name": "profile_device_remove",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
    "lines": "2876-2881",
    "snippet": "static void profile_device_remove(struct btd_service *service)\n{\n\tstruct btd_profile *p = btd_service_get_profile(service);\n\n\tDBG(\"%s removed\", p->name);\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"dbus-common.h\"",
      "#include \"gatt-database.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"%s removed\"",
            "p->name"
          ],
          "line": 2880
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_service_get_profile",
          "args": [
            "service"
          ],
          "line": 2878
        },
        "resolved": true,
        "details": {
          "function_name": "btd_service_get_profile",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/service.c",
          "lines": "316-319",
          "snippet": "struct btd_profile *btd_service_get_profile(const struct btd_service *service)\n{\n\treturn service->profile;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"backtrace.h\"",
            "#include \"log.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/stat.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <errno.h>\n#include <sys/ioctl.h>\n#include <sys/stat.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstruct btd_profile *btd_service_get_profile(const struct btd_service *service)\n{\n\treturn service->profile;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic void profile_device_remove(struct btd_service *service)\n{\n\tstruct btd_profile *p = btd_service_get_profile(service);\n\n\tDBG(\"%s removed\", p->name);\n}"
  },
  {
    "function_name": "profile_device_probe",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
    "lines": "2867-2874",
    "snippet": "static int profile_device_probe(struct btd_service *service)\n{\n\tstruct btd_profile *p = btd_service_get_profile(service);\n\n\tDBG(\"%s probed\", p->name);\n\n\treturn 0;\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"dbus-common.h\"",
      "#include \"gatt-database.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"%s probed\"",
            "p->name"
          ],
          "line": 2871
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_service_get_profile",
          "args": [
            "service"
          ],
          "line": 2869
        },
        "resolved": true,
        "details": {
          "function_name": "btd_service_get_profile",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/service.c",
          "lines": "316-319",
          "snippet": "struct btd_profile *btd_service_get_profile(const struct btd_service *service)\n{\n\treturn service->profile;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"backtrace.h\"",
            "#include \"log.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/stat.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <errno.h>\n#include <sys/ioctl.h>\n#include <sys/stat.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstruct btd_profile *btd_service_get_profile(const struct btd_service *service)\n{\n\treturn service->profile;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic int profile_device_probe(struct btd_service *service)\n{\n\tstruct btd_profile *p = btd_service_get_profile(service);\n\n\tDBG(\"%s probed\", p->name);\n\n\treturn 0;\n}"
  },
  {
    "function_name": "database_add_app",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
    "lines": "2850-2865",
    "snippet": "static bool database_add_app(struct gatt_app *app)\n{\n\tconst struct queue_entry *entry;\n\n\tentry = queue_get_entries(app->services);\n\twhile (entry) {\n\t\tif (!database_add_service(entry->data)) {\n\t\t\terror(\"Failed to add service\");\n\t\t\treturn false;\n\t\t}\n\n\t\tentry = entry->next;\n\t}\n\n\treturn true;\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"dbus-common.h\"",
      "#include \"gatt-database.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"Failed to add service\""
          ],
          "line": 2857
        },
        "resolved": true,
        "details": {
          "function_name": "dbus_error_to_att_ecode",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "1833-1855",
          "snippet": "static uint8_t dbus_error_to_att_ecode(const char *error_name)\n{\n\n\tif (strcmp(error_name, \"org.bluez.Error.Failed\") == 0)\n\t\treturn 0x80;  /* For now return this \"application error\" */\n\n\tif (strcmp(error_name, \"org.bluez.Error.NotSupported\") == 0)\n\t\treturn BT_ATT_ERROR_REQUEST_NOT_SUPPORTED;\n\n\tif (strcmp(error_name, \"org.bluez.Error.NotAuthorized\") == 0)\n\t\treturn BT_ATT_ERROR_AUTHORIZATION;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InvalidValueLength\") == 0)\n\t\treturn BT_ATT_ERROR_INVALID_ATTRIBUTE_VALUE_LEN;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InvalidOffset\") == 0)\n\t\treturn BT_ATT_ERROR_INVALID_OFFSET;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InProgress\") == 0)\n\t\treturn BT_ERROR_ALREADY_IN_PROGRESS;\n\n\treturn 0;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic uint8_t dbus_error_to_att_ecode(const char *error_name)\n{\n\n\tif (strcmp(error_name, \"org.bluez.Error.Failed\") == 0)\n\t\treturn 0x80;  /* For now return this \"application error\" */\n\n\tif (strcmp(error_name, \"org.bluez.Error.NotSupported\") == 0)\n\t\treturn BT_ATT_ERROR_REQUEST_NOT_SUPPORTED;\n\n\tif (strcmp(error_name, \"org.bluez.Error.NotAuthorized\") == 0)\n\t\treturn BT_ATT_ERROR_AUTHORIZATION;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InvalidValueLength\") == 0)\n\t\treturn BT_ATT_ERROR_INVALID_ATTRIBUTE_VALUE_LEN;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InvalidOffset\") == 0)\n\t\treturn BT_ATT_ERROR_INVALID_OFFSET;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InProgress\") == 0)\n\t\treturn BT_ERROR_ALREADY_IN_PROGRESS;\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "database_add_service",
          "args": [
            "entry->data"
          ],
          "line": 2856
        },
        "resolved": true,
        "details": {
          "function_name": "database_add_service",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "2793-2848",
          "snippet": "static bool database_add_service(struct external_service *service)\n{\n\tbt_uuid_t uuid;\n\tbool primary;\n\tconst struct queue_entry *entry;\n\n\tif (!parse_uuid(service->proxy, &uuid)) {\n\t\terror(\"Failed to read \\\"UUID\\\" property of service\");\n\t\treturn false;\n\t}\n\n\tif (!parse_primary(service->proxy, &primary)) {\n\t\terror(\"Failed to read \\\"Primary\\\" property of service\");\n\t\treturn false;\n\t}\n\n\tif (!parse_includes(service->proxy, service)) {\n\t\terror(\"Failed to read \\\"Includes\\\" property of service\");\n\t\treturn false;\n\t}\n\n\tservice->attrib = gatt_db_add_service(service->app->database->db, &uuid,\n\t\t\t\t\t\tprimary, service->attr_cnt);\n\tif (!service->attrib)\n\t\treturn false;\n\n\tdatabase_add_includes(service);\n\n\tentry = queue_get_entries(service->chrcs);\n\twhile (entry) {\n\t\tstruct external_chrc *chrc = entry->data;\n\n\t\tif (!database_add_chrc(service, chrc)) {\n\t\t\terror(\"Failed to add characteristic\");\n\t\t\tgoto fail;\n\t\t}\n\n\t\tentry = entry->next;\n\t}\n\n\t/* If there are any unhandled descriptors, return an error */\n\tif (queue_find(service->descs, match_desc_unhandled, NULL)) {\n\t\terror(\"Found descriptor with no matching characteristic!\");\n\t\tgoto fail;\n\t}\n\n\tgatt_db_service_set_active(service->attrib, true);\n\n\treturn true;\n\nfail:\n\tgatt_db_remove_service(service->app->database->db, service->attrib);\n\tservice->attrib = NULL;\n\n\treturn false;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic bool database_add_service(struct external_service *service)\n{\n\tbt_uuid_t uuid;\n\tbool primary;\n\tconst struct queue_entry *entry;\n\n\tif (!parse_uuid(service->proxy, &uuid)) {\n\t\terror(\"Failed to read \\\"UUID\\\" property of service\");\n\t\treturn false;\n\t}\n\n\tif (!parse_primary(service->proxy, &primary)) {\n\t\terror(\"Failed to read \\\"Primary\\\" property of service\");\n\t\treturn false;\n\t}\n\n\tif (!parse_includes(service->proxy, service)) {\n\t\terror(\"Failed to read \\\"Includes\\\" property of service\");\n\t\treturn false;\n\t}\n\n\tservice->attrib = gatt_db_add_service(service->app->database->db, &uuid,\n\t\t\t\t\t\tprimary, service->attr_cnt);\n\tif (!service->attrib)\n\t\treturn false;\n\n\tdatabase_add_includes(service);\n\n\tentry = queue_get_entries(service->chrcs);\n\twhile (entry) {\n\t\tstruct external_chrc *chrc = entry->data;\n\n\t\tif (!database_add_chrc(service, chrc)) {\n\t\t\terror(\"Failed to add characteristic\");\n\t\t\tgoto fail;\n\t\t}\n\n\t\tentry = entry->next;\n\t}\n\n\t/* If there are any unhandled descriptors, return an error */\n\tif (queue_find(service->descs, match_desc_unhandled, NULL)) {\n\t\terror(\"Found descriptor with no matching characteristic!\");\n\t\tgoto fail;\n\t}\n\n\tgatt_db_service_set_active(service->attrib, true);\n\n\treturn true;\n\nfail:\n\tgatt_db_remove_service(service->app->database->db, service->attrib);\n\tservice->attrib = NULL;\n\n\treturn false;\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_get_entries",
          "args": [
            "app->services"
          ],
          "line": 2854
        },
        "resolved": true,
        "details": {
          "function_name": "queue_get_entries",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "364-370",
          "snippet": "const struct queue_entry *queue_get_entries(struct queue *queue)\n{\n\tif (!queue)\n\t\treturn NULL;\n\n\treturn queue->head;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nconst struct queue_entry *queue_get_entries(struct queue *queue)\n{\n\tif (!queue)\n\t\treturn NULL;\n\n\treturn queue->head;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic bool database_add_app(struct gatt_app *app)\n{\n\tconst struct queue_entry *entry;\n\n\tentry = queue_get_entries(app->services);\n\twhile (entry) {\n\t\tif (!database_add_service(entry->data)) {\n\t\t\terror(\"Failed to add service\");\n\t\t\treturn false;\n\t\t}\n\n\t\tentry = entry->next;\n\t}\n\n\treturn true;\n}"
  },
  {
    "function_name": "database_add_service",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
    "lines": "2793-2848",
    "snippet": "static bool database_add_service(struct external_service *service)\n{\n\tbt_uuid_t uuid;\n\tbool primary;\n\tconst struct queue_entry *entry;\n\n\tif (!parse_uuid(service->proxy, &uuid)) {\n\t\terror(\"Failed to read \\\"UUID\\\" property of service\");\n\t\treturn false;\n\t}\n\n\tif (!parse_primary(service->proxy, &primary)) {\n\t\terror(\"Failed to read \\\"Primary\\\" property of service\");\n\t\treturn false;\n\t}\n\n\tif (!parse_includes(service->proxy, service)) {\n\t\terror(\"Failed to read \\\"Includes\\\" property of service\");\n\t\treturn false;\n\t}\n\n\tservice->attrib = gatt_db_add_service(service->app->database->db, &uuid,\n\t\t\t\t\t\tprimary, service->attr_cnt);\n\tif (!service->attrib)\n\t\treturn false;\n\n\tdatabase_add_includes(service);\n\n\tentry = queue_get_entries(service->chrcs);\n\twhile (entry) {\n\t\tstruct external_chrc *chrc = entry->data;\n\n\t\tif (!database_add_chrc(service, chrc)) {\n\t\t\terror(\"Failed to add characteristic\");\n\t\t\tgoto fail;\n\t\t}\n\n\t\tentry = entry->next;\n\t}\n\n\t/* If there are any unhandled descriptors, return an error */\n\tif (queue_find(service->descs, match_desc_unhandled, NULL)) {\n\t\terror(\"Found descriptor with no matching characteristic!\");\n\t\tgoto fail;\n\t}\n\n\tgatt_db_service_set_active(service->attrib, true);\n\n\treturn true;\n\nfail:\n\tgatt_db_remove_service(service->app->database->db, service->attrib);\n\tservice->attrib = NULL;\n\n\treturn false;\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"dbus-common.h\"",
      "#include \"gatt-database.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "gatt_db_remove_service",
          "args": [
            "service->app->database->db",
            "service->attrib"
          ],
          "line": 2844
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_remove_service",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "408-423",
          "snippet": "bool gatt_db_remove_service(struct gatt_db *db,\n\t\t\t\t\tstruct gatt_db_attribute *attrib)\n{\n\tstruct gatt_db_service *service;\n\n\tif (!db || !attrib)\n\t\treturn false;\n\n\tservice = attrib->service;\n\n\tqueue_remove(db->services, service);\n\n\tgatt_db_service_destroy(service);\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nbool gatt_db_remove_service(struct gatt_db *db,\n\t\t\t\t\tstruct gatt_db_attribute *attrib)\n{\n\tstruct gatt_db_service *service;\n\n\tif (!db || !attrib)\n\t\treturn false;\n\n\tservice = attrib->service;\n\n\tqueue_remove(db->services, service);\n\n\tgatt_db_service_destroy(service);\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "gatt_db_service_set_active",
          "args": [
            "service->attrib",
            "true"
          ],
          "line": 2839
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_service_set_active",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "975-992",
          "snippet": "bool gatt_db_service_set_active(struct gatt_db_attribute *attrib, bool active)\n{\n\tstruct gatt_db_service *service;\n\n\tif (!attrib)\n\t\treturn false;\n\n\tservice = attrib->service;\n\n\tif (service->active == active)\n\t\treturn true;\n\n\tservice->active = active;\n\n\tnotify_service_changed(service->db, service, active);\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nbool gatt_db_service_set_active(struct gatt_db_attribute *attrib, bool active)\n{\n\tstruct gatt_db_service *service;\n\n\tif (!attrib)\n\t\treturn false;\n\n\tservice = attrib->service;\n\n\tif (service->active == active)\n\t\treturn true;\n\n\tservice->active = active;\n\n\tnotify_service_changed(service->db, service, active);\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"Found descriptor with no matching characteristic!\""
          ],
          "line": 2835
        },
        "resolved": true,
        "details": {
          "function_name": "dbus_error_to_att_ecode",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "1833-1855",
          "snippet": "static uint8_t dbus_error_to_att_ecode(const char *error_name)\n{\n\n\tif (strcmp(error_name, \"org.bluez.Error.Failed\") == 0)\n\t\treturn 0x80;  /* For now return this \"application error\" */\n\n\tif (strcmp(error_name, \"org.bluez.Error.NotSupported\") == 0)\n\t\treturn BT_ATT_ERROR_REQUEST_NOT_SUPPORTED;\n\n\tif (strcmp(error_name, \"org.bluez.Error.NotAuthorized\") == 0)\n\t\treturn BT_ATT_ERROR_AUTHORIZATION;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InvalidValueLength\") == 0)\n\t\treturn BT_ATT_ERROR_INVALID_ATTRIBUTE_VALUE_LEN;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InvalidOffset\") == 0)\n\t\treturn BT_ATT_ERROR_INVALID_OFFSET;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InProgress\") == 0)\n\t\treturn BT_ERROR_ALREADY_IN_PROGRESS;\n\n\treturn 0;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic uint8_t dbus_error_to_att_ecode(const char *error_name)\n{\n\n\tif (strcmp(error_name, \"org.bluez.Error.Failed\") == 0)\n\t\treturn 0x80;  /* For now return this \"application error\" */\n\n\tif (strcmp(error_name, \"org.bluez.Error.NotSupported\") == 0)\n\t\treturn BT_ATT_ERROR_REQUEST_NOT_SUPPORTED;\n\n\tif (strcmp(error_name, \"org.bluez.Error.NotAuthorized\") == 0)\n\t\treturn BT_ATT_ERROR_AUTHORIZATION;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InvalidValueLength\") == 0)\n\t\treturn BT_ATT_ERROR_INVALID_ATTRIBUTE_VALUE_LEN;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InvalidOffset\") == 0)\n\t\treturn BT_ATT_ERROR_INVALID_OFFSET;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InProgress\") == 0)\n\t\treturn BT_ERROR_ALREADY_IN_PROGRESS;\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_find",
          "args": [
            "service->descs",
            "match_desc_unhandled",
            "NULL"
          ],
          "line": 2834
        },
        "resolved": true,
        "details": {
          "function_name": "queue_find",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "231-247",
          "snippet": "void *queue_find(struct queue *queue, queue_match_func_t function,\n\t\t\t\t\t\t\tconst void *match_data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn NULL;\n\n\tif (!function)\n\t\tfunction = direct_match;\n\n\tfor (entry = queue->head; entry; entry = entry->next)\n\t\tif (function(entry->data, match_data))\n\t\t\treturn entry->data;\n\n\treturn NULL;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nvoid *queue_find(struct queue *queue, queue_match_func_t function,\n\t\t\t\t\t\t\tconst void *match_data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn NULL;\n\n\tif (!function)\n\t\tfunction = direct_match;\n\n\tfor (entry = queue->head; entry; entry = entry->next)\n\t\tif (function(entry->data, match_data))\n\t\t\treturn entry->data;\n\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "database_add_chrc",
          "args": [
            "service",
            "chrc"
          ],
          "line": 2825
        },
        "resolved": true,
        "details": {
          "function_name": "database_add_chrc",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "2737-2784",
          "snippet": "static bool database_add_chrc(struct external_service *service,\n\t\t\t\t\t\tstruct external_chrc *chrc)\n{\n\tbt_uuid_t uuid;\n\tconst struct queue_entry *entry;\n\n\tif (!parse_uuid(chrc->proxy, &uuid)) {\n\t\terror(\"Failed to read \\\"UUID\\\" property of characteristic\");\n\t\treturn false;\n\t}\n\n\tif (!check_service_path(chrc->proxy, service)) {\n\t\terror(\"Invalid service path for characteristic\");\n\t\treturn false;\n\t}\n\n\tchrc->attrib = gatt_db_service_add_characteristic(service->attrib,\n\t\t\t\t\t\t&uuid, chrc->perm,\n\t\t\t\t\t\tchrc->props, chrc_read_cb,\n\t\t\t\t\t\tchrc_write_cb, chrc);\n\tif (!chrc->attrib) {\n\t\terror(\"Failed to create characteristic entry in database\");\n\t\treturn false;\n\t}\n\n\tif (!database_add_ccc(service, chrc))\n\t\treturn false;\n\n\tif (!database_add_cep(service, chrc))\n\t\treturn false;\n\n\t/* Handle the descriptors that belong to this characteristic. */\n\tfor (entry = queue_get_entries(service->descs); entry;\n\t\t\t\t\t\t\tentry = entry->next) {\n\t\tstruct external_desc *desc = entry->data;\n\n\t\tif (desc->handled || g_strcmp0(desc->chrc_path, chrc->path))\n\t\t\tcontinue;\n\n\t\tif (!database_add_desc(service, desc)) {\n\t\t\tchrc->attrib = NULL;\n\t\t\terror(\"Failed to create descriptor entry\");\n\t\t\treturn false;\n\t\t}\n\t}\n\n\treturn true;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic bool database_add_chrc(struct external_service *service,\n\t\t\t\t\t\tstruct external_chrc *chrc)\n{\n\tbt_uuid_t uuid;\n\tconst struct queue_entry *entry;\n\n\tif (!parse_uuid(chrc->proxy, &uuid)) {\n\t\terror(\"Failed to read \\\"UUID\\\" property of characteristic\");\n\t\treturn false;\n\t}\n\n\tif (!check_service_path(chrc->proxy, service)) {\n\t\terror(\"Invalid service path for characteristic\");\n\t\treturn false;\n\t}\n\n\tchrc->attrib = gatt_db_service_add_characteristic(service->attrib,\n\t\t\t\t\t\t&uuid, chrc->perm,\n\t\t\t\t\t\tchrc->props, chrc_read_cb,\n\t\t\t\t\t\tchrc_write_cb, chrc);\n\tif (!chrc->attrib) {\n\t\terror(\"Failed to create characteristic entry in database\");\n\t\treturn false;\n\t}\n\n\tif (!database_add_ccc(service, chrc))\n\t\treturn false;\n\n\tif (!database_add_cep(service, chrc))\n\t\treturn false;\n\n\t/* Handle the descriptors that belong to this characteristic. */\n\tfor (entry = queue_get_entries(service->descs); entry;\n\t\t\t\t\t\t\tentry = entry->next) {\n\t\tstruct external_desc *desc = entry->data;\n\n\t\tif (desc->handled || g_strcmp0(desc->chrc_path, chrc->path))\n\t\t\tcontinue;\n\n\t\tif (!database_add_desc(service, desc)) {\n\t\t\tchrc->attrib = NULL;\n\t\t\terror(\"Failed to create descriptor entry\");\n\t\t\treturn false;\n\t\t}\n\t}\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_get_entries",
          "args": [
            "service->chrcs"
          ],
          "line": 2821
        },
        "resolved": true,
        "details": {
          "function_name": "queue_get_entries",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "364-370",
          "snippet": "const struct queue_entry *queue_get_entries(struct queue *queue)\n{\n\tif (!queue)\n\t\treturn NULL;\n\n\treturn queue->head;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nconst struct queue_entry *queue_get_entries(struct queue *queue)\n{\n\tif (!queue)\n\t\treturn NULL;\n\n\treturn queue->head;\n}"
        }
      },
      {
        "call_info": {
          "callee": "database_add_includes",
          "args": [
            "service"
          ],
          "line": 2819
        },
        "resolved": true,
        "details": {
          "function_name": "database_add_includes",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "2732-2735",
          "snippet": "static void database_add_includes(struct external_service *service)\n{\n\tqueue_foreach(service->includes, include_services, service);\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic void database_add_includes(struct external_service *service)\n{\n\tqueue_foreach(service->includes, include_services, service);\n}"
        }
      },
      {
        "call_info": {
          "callee": "gatt_db_add_service",
          "args": [
            "service->app->database->db",
            "&uuid",
            "primary",
            "service->attr_cnt"
          ],
          "line": 2814
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_add_service",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "583-590",
          "snippet": "struct gatt_db_attribute *gatt_db_add_service(struct gatt_db *db,\n\t\t\t\t\t\tconst bt_uuid_t *uuid,\n\t\t\t\t\t\tbool primary,\n\t\t\t\t\t\tuint16_t num_handles)\n{\n\treturn gatt_db_insert_service(db, db->next_handle, uuid, primary,\n\t\t\t\t\t\t\t\tnum_handles);\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstruct gatt_db_attribute *gatt_db_add_service(struct gatt_db *db,\n\t\t\t\t\t\tconst bt_uuid_t *uuid,\n\t\t\t\t\t\tbool primary,\n\t\t\t\t\t\tuint16_t num_handles)\n{\n\treturn gatt_db_insert_service(db, db->next_handle, uuid, primary,\n\t\t\t\t\t\t\t\tnum_handles);\n}"
        }
      },
      {
        "call_info": {
          "callee": "parse_includes",
          "args": [
            "service->proxy",
            "service"
          ],
          "line": 2809
        },
        "resolved": true,
        "details": {
          "function_name": "parse_includes",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "1781-1813",
          "snippet": "static bool parse_includes(GDBusProxy *proxy, struct external_service *service)\n{\n\tDBusMessageIter iter;\n\tDBusMessageIter array;\n\tchar *obj;\n\n\t/* Includes property is optional */\n\tif (!g_dbus_proxy_get_property(proxy, \"Includes\", &iter))\n\t\treturn true;\n\n\tif (dbus_message_iter_get_arg_type(&iter) != DBUS_TYPE_ARRAY)\n\t\treturn false;\n\n\tdbus_message_iter_recurse(&iter, &array);\n\n\tdo {\n\t\tif (dbus_message_iter_get_arg_type(&array) !=\n\t\t\t\t\t\tDBUS_TYPE_OBJECT_PATH)\n\t\t\treturn false;\n\n\t\tdbus_message_iter_get_basic(&array, &obj);\n\n\t\tif (!queue_push_tail(service->includes, obj)) {\n\t\t\terror(\"Failed to add Includes path in queue\\n\");\n\t\t\treturn false;\n\n\t\t}\n\n\t\tincr_attr_count(service, 1);\n\t} while (dbus_message_iter_next(&array));\n\n\treturn true;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic bool parse_includes(GDBusProxy *proxy, struct external_service *service)\n{\n\tDBusMessageIter iter;\n\tDBusMessageIter array;\n\tchar *obj;\n\n\t/* Includes property is optional */\n\tif (!g_dbus_proxy_get_property(proxy, \"Includes\", &iter))\n\t\treturn true;\n\n\tif (dbus_message_iter_get_arg_type(&iter) != DBUS_TYPE_ARRAY)\n\t\treturn false;\n\n\tdbus_message_iter_recurse(&iter, &array);\n\n\tdo {\n\t\tif (dbus_message_iter_get_arg_type(&array) !=\n\t\t\t\t\t\tDBUS_TYPE_OBJECT_PATH)\n\t\t\treturn false;\n\n\t\tdbus_message_iter_get_basic(&array, &obj);\n\n\t\tif (!queue_push_tail(service->includes, obj)) {\n\t\t\terror(\"Failed to add Includes path in queue\\n\");\n\t\t\treturn false;\n\n\t\t}\n\n\t\tincr_attr_count(service, 1);\n\t} while (dbus_message_iter_next(&array));\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "parse_primary",
          "args": [
            "service->proxy",
            "&primary"
          ],
          "line": 2804
        },
        "resolved": true,
        "details": {
          "function_name": "parse_primary",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "1815-1831",
          "snippet": "static bool parse_primary(GDBusProxy *proxy, bool *primary)\n{\n\tDBusMessageIter iter;\n\tdbus_bool_t val;\n\n\tif (!g_dbus_proxy_get_property(proxy, \"Primary\", &iter))\n\t\treturn false;\n\n\tif (dbus_message_iter_get_arg_type(&iter) != DBUS_TYPE_BOOLEAN)\n\t\treturn false;\n\n\tdbus_message_iter_get_basic(&iter, &val);\n\n\t*primary = val;\n\n\treturn true;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic bool parse_primary(GDBusProxy *proxy, bool *primary)\n{\n\tDBusMessageIter iter;\n\tdbus_bool_t val;\n\n\tif (!g_dbus_proxy_get_property(proxy, \"Primary\", &iter))\n\t\treturn false;\n\n\tif (dbus_message_iter_get_arg_type(&iter) != DBUS_TYPE_BOOLEAN)\n\t\treturn false;\n\n\tdbus_message_iter_get_basic(&iter, &val);\n\n\t*primary = val;\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "parse_uuid",
          "args": [
            "service->proxy",
            "&uuid"
          ],
          "line": 2799
        },
        "resolved": true,
        "details": {
          "function_name": "parse_uuid",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "1748-1779",
          "snippet": "static bool parse_uuid(GDBusProxy *proxy, bt_uuid_t *uuid)\n{\n\tDBusMessageIter iter;\n\tbt_uuid_t tmp;\n\tconst char *uuidstr;\n\n\tif (!g_dbus_proxy_get_property(proxy, \"UUID\", &iter))\n\t\treturn false;\n\n\tif (dbus_message_iter_get_arg_type(&iter) != DBUS_TYPE_STRING)\n\t\treturn false;\n\n\tdbus_message_iter_get_basic(&iter, &uuidstr);\n\n\tif (bt_string_to_uuid(uuid, uuidstr) < 0)\n\t\treturn false;\n\n\t/* GAP & GATT services are created and managed by BlueZ */\n\tbt_uuid16_create(&tmp, UUID_GAP);\n\tif (!bt_uuid_cmp(&tmp, uuid)) {\n\t\terror(\"GAP service must be handled by BlueZ\");\n\t\treturn false;\n\t}\n\n\tbt_uuid16_create(&tmp, UUID_GATT);\n\tif (!bt_uuid_cmp(&tmp, uuid)) {\n\t\terror(\"GATT service must be handled by BlueZ\");\n\t\treturn false;\n\t}\n\n\treturn true;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define UUID_GATT\t0x1801",
            "#define UUID_GAP\t0x1800"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\n#define UUID_GATT\t0x1801\n#define UUID_GAP\t0x1800\n\nstatic bool parse_uuid(GDBusProxy *proxy, bt_uuid_t *uuid)\n{\n\tDBusMessageIter iter;\n\tbt_uuid_t tmp;\n\tconst char *uuidstr;\n\n\tif (!g_dbus_proxy_get_property(proxy, \"UUID\", &iter))\n\t\treturn false;\n\n\tif (dbus_message_iter_get_arg_type(&iter) != DBUS_TYPE_STRING)\n\t\treturn false;\n\n\tdbus_message_iter_get_basic(&iter, &uuidstr);\n\n\tif (bt_string_to_uuid(uuid, uuidstr) < 0)\n\t\treturn false;\n\n\t/* GAP & GATT services are created and managed by BlueZ */\n\tbt_uuid16_create(&tmp, UUID_GAP);\n\tif (!bt_uuid_cmp(&tmp, uuid)) {\n\t\terror(\"GAP service must be handled by BlueZ\");\n\t\treturn false;\n\t}\n\n\tbt_uuid16_create(&tmp, UUID_GATT);\n\tif (!bt_uuid_cmp(&tmp, uuid)) {\n\t\terror(\"GATT service must be handled by BlueZ\");\n\t\treturn false;\n\t}\n\n\treturn true;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic bool database_add_service(struct external_service *service)\n{\n\tbt_uuid_t uuid;\n\tbool primary;\n\tconst struct queue_entry *entry;\n\n\tif (!parse_uuid(service->proxy, &uuid)) {\n\t\terror(\"Failed to read \\\"UUID\\\" property of service\");\n\t\treturn false;\n\t}\n\n\tif (!parse_primary(service->proxy, &primary)) {\n\t\terror(\"Failed to read \\\"Primary\\\" property of service\");\n\t\treturn false;\n\t}\n\n\tif (!parse_includes(service->proxy, service)) {\n\t\terror(\"Failed to read \\\"Includes\\\" property of service\");\n\t\treturn false;\n\t}\n\n\tservice->attrib = gatt_db_add_service(service->app->database->db, &uuid,\n\t\t\t\t\t\tprimary, service->attr_cnt);\n\tif (!service->attrib)\n\t\treturn false;\n\n\tdatabase_add_includes(service);\n\n\tentry = queue_get_entries(service->chrcs);\n\twhile (entry) {\n\t\tstruct external_chrc *chrc = entry->data;\n\n\t\tif (!database_add_chrc(service, chrc)) {\n\t\t\terror(\"Failed to add characteristic\");\n\t\t\tgoto fail;\n\t\t}\n\n\t\tentry = entry->next;\n\t}\n\n\t/* If there are any unhandled descriptors, return an error */\n\tif (queue_find(service->descs, match_desc_unhandled, NULL)) {\n\t\terror(\"Found descriptor with no matching characteristic!\");\n\t\tgoto fail;\n\t}\n\n\tgatt_db_service_set_active(service->attrib, true);\n\n\treturn true;\n\nfail:\n\tgatt_db_remove_service(service->app->database->db, service->attrib);\n\tservice->attrib = NULL;\n\n\treturn false;\n}"
  },
  {
    "function_name": "match_desc_unhandled",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
    "lines": "2786-2791",
    "snippet": "static bool match_desc_unhandled(const void *a, const void *b)\n{\n\tconst struct external_desc *desc = a;\n\n\treturn !desc->handled;\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"dbus-common.h\"",
      "#include \"gatt-database.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic bool match_desc_unhandled(const void *a, const void *b)\n{\n\tconst struct external_desc *desc = a;\n\n\treturn !desc->handled;\n}"
  },
  {
    "function_name": "database_add_chrc",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
    "lines": "2737-2784",
    "snippet": "static bool database_add_chrc(struct external_service *service,\n\t\t\t\t\t\tstruct external_chrc *chrc)\n{\n\tbt_uuid_t uuid;\n\tconst struct queue_entry *entry;\n\n\tif (!parse_uuid(chrc->proxy, &uuid)) {\n\t\terror(\"Failed to read \\\"UUID\\\" property of characteristic\");\n\t\treturn false;\n\t}\n\n\tif (!check_service_path(chrc->proxy, service)) {\n\t\terror(\"Invalid service path for characteristic\");\n\t\treturn false;\n\t}\n\n\tchrc->attrib = gatt_db_service_add_characteristic(service->attrib,\n\t\t\t\t\t\t&uuid, chrc->perm,\n\t\t\t\t\t\tchrc->props, chrc_read_cb,\n\t\t\t\t\t\tchrc_write_cb, chrc);\n\tif (!chrc->attrib) {\n\t\terror(\"Failed to create characteristic entry in database\");\n\t\treturn false;\n\t}\n\n\tif (!database_add_ccc(service, chrc))\n\t\treturn false;\n\n\tif (!database_add_cep(service, chrc))\n\t\treturn false;\n\n\t/* Handle the descriptors that belong to this characteristic. */\n\tfor (entry = queue_get_entries(service->descs); entry;\n\t\t\t\t\t\t\tentry = entry->next) {\n\t\tstruct external_desc *desc = entry->data;\n\n\t\tif (desc->handled || g_strcmp0(desc->chrc_path, chrc->path))\n\t\t\tcontinue;\n\n\t\tif (!database_add_desc(service, desc)) {\n\t\t\tchrc->attrib = NULL;\n\t\t\terror(\"Failed to create descriptor entry\");\n\t\t\treturn false;\n\t\t}\n\t}\n\n\treturn true;\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"dbus-common.h\"",
      "#include \"gatt-database.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"Failed to create descriptor entry\""
          ],
          "line": 2778
        },
        "resolved": true,
        "details": {
          "function_name": "dbus_error_to_att_ecode",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "1833-1855",
          "snippet": "static uint8_t dbus_error_to_att_ecode(const char *error_name)\n{\n\n\tif (strcmp(error_name, \"org.bluez.Error.Failed\") == 0)\n\t\treturn 0x80;  /* For now return this \"application error\" */\n\n\tif (strcmp(error_name, \"org.bluez.Error.NotSupported\") == 0)\n\t\treturn BT_ATT_ERROR_REQUEST_NOT_SUPPORTED;\n\n\tif (strcmp(error_name, \"org.bluez.Error.NotAuthorized\") == 0)\n\t\treturn BT_ATT_ERROR_AUTHORIZATION;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InvalidValueLength\") == 0)\n\t\treturn BT_ATT_ERROR_INVALID_ATTRIBUTE_VALUE_LEN;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InvalidOffset\") == 0)\n\t\treturn BT_ATT_ERROR_INVALID_OFFSET;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InProgress\") == 0)\n\t\treturn BT_ERROR_ALREADY_IN_PROGRESS;\n\n\treturn 0;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic uint8_t dbus_error_to_att_ecode(const char *error_name)\n{\n\n\tif (strcmp(error_name, \"org.bluez.Error.Failed\") == 0)\n\t\treturn 0x80;  /* For now return this \"application error\" */\n\n\tif (strcmp(error_name, \"org.bluez.Error.NotSupported\") == 0)\n\t\treturn BT_ATT_ERROR_REQUEST_NOT_SUPPORTED;\n\n\tif (strcmp(error_name, \"org.bluez.Error.NotAuthorized\") == 0)\n\t\treturn BT_ATT_ERROR_AUTHORIZATION;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InvalidValueLength\") == 0)\n\t\treturn BT_ATT_ERROR_INVALID_ATTRIBUTE_VALUE_LEN;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InvalidOffset\") == 0)\n\t\treturn BT_ATT_ERROR_INVALID_OFFSET;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InProgress\") == 0)\n\t\treturn BT_ERROR_ALREADY_IN_PROGRESS;\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "database_add_desc",
          "args": [
            "service",
            "desc"
          ],
          "line": 2776
        },
        "resolved": true,
        "details": {
          "function_name": "database_add_desc",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "2588-2610",
          "snippet": "static bool database_add_desc(struct external_service *service,\n\t\t\t\t\t\tstruct external_desc *desc)\n{\n\tbt_uuid_t uuid;\n\n\tif (!parse_uuid(desc->proxy, &uuid)) {\n\t\terror(\"Failed to read \\\"UUID\\\" property of descriptor\");\n\t\treturn false;\n\t}\n\n\tdesc->attrib = gatt_db_service_add_descriptor(service->attrib, &uuid,\n\t\t\t\t\t\t\tdesc->perm,\n\t\t\t\t\t\t\tdesc_read_cb,\n\t\t\t\t\t\t\tdesc_write_cb, desc);\n\tif (!desc->attrib) {\n\t\terror(\"Failed to create descriptor entry in database\");\n\t\treturn false;\n\t}\n\n\tdesc->handled = true;\n\n\treturn true;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic bool database_add_desc(struct external_service *service,\n\t\t\t\t\t\tstruct external_desc *desc)\n{\n\tbt_uuid_t uuid;\n\n\tif (!parse_uuid(desc->proxy, &uuid)) {\n\t\terror(\"Failed to read \\\"UUID\\\" property of descriptor\");\n\t\treturn false;\n\t}\n\n\tdesc->attrib = gatt_db_service_add_descriptor(service->attrib, &uuid,\n\t\t\t\t\t\t\tdesc->perm,\n\t\t\t\t\t\t\tdesc_read_cb,\n\t\t\t\t\t\t\tdesc_write_cb, desc);\n\tif (!desc->attrib) {\n\t\terror(\"Failed to create descriptor entry in database\");\n\t\treturn false;\n\t}\n\n\tdesc->handled = true;\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_strcmp0",
          "args": [
            "desc->chrc_path",
            "chrc->path"
          ],
          "line": 2773
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "queue_get_entries",
          "args": [
            "service->descs"
          ],
          "line": 2769
        },
        "resolved": true,
        "details": {
          "function_name": "queue_get_entries",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "364-370",
          "snippet": "const struct queue_entry *queue_get_entries(struct queue *queue)\n{\n\tif (!queue)\n\t\treturn NULL;\n\n\treturn queue->head;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nconst struct queue_entry *queue_get_entries(struct queue *queue)\n{\n\tif (!queue)\n\t\treturn NULL;\n\n\treturn queue->head;\n}"
        }
      },
      {
        "call_info": {
          "callee": "database_add_cep",
          "args": [
            "service",
            "chrc"
          ],
          "line": 2765
        },
        "resolved": true,
        "details": {
          "function_name": "database_add_cep",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "2482-2513",
          "snippet": "static bool database_add_cep(struct external_service *service,\n\t\t\t\t\t\tstruct external_chrc *chrc)\n{\n\tstruct gatt_db_attribute *cep;\n\tbt_uuid_t uuid;\n\tuint8_t value[2];\n\n\tif (!chrc->ext_props)\n\t\treturn true;\n\n\tbt_uuid16_create(&uuid, GATT_CHARAC_EXT_PROPER_UUID);\n\tcep = gatt_db_service_add_descriptor(service->attrib, &uuid,\n\t\t\t\t\t\t\tBT_ATT_PERM_READ,\n\t\t\t\t\t\t\tNULL, NULL, NULL);\n\tif (!cep) {\n\t\terror(\"Failed to create CEP entry for characteristic\");\n\t\treturn false;\n\t}\n\n\tmemset(value, 0, sizeof(value));\n\tvalue[0] = chrc->ext_props;\n\n\tif (!gatt_db_attribute_write(cep, 0, value, sizeof(value), 0, NULL,\n\t\t\t\t\t\t\tcep_write_cb, NULL)) {\n\t\tDBG(\"Failed to store CEP value in the database\");\n\t\treturn false;\n\t}\n\n\tDBG(\"Created CEP entry for characteristic\");\n\n\treturn true;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic bool database_add_cep(struct external_service *service,\n\t\t\t\t\t\tstruct external_chrc *chrc)\n{\n\tstruct gatt_db_attribute *cep;\n\tbt_uuid_t uuid;\n\tuint8_t value[2];\n\n\tif (!chrc->ext_props)\n\t\treturn true;\n\n\tbt_uuid16_create(&uuid, GATT_CHARAC_EXT_PROPER_UUID);\n\tcep = gatt_db_service_add_descriptor(service->attrib, &uuid,\n\t\t\t\t\t\t\tBT_ATT_PERM_READ,\n\t\t\t\t\t\t\tNULL, NULL, NULL);\n\tif (!cep) {\n\t\terror(\"Failed to create CEP entry for characteristic\");\n\t\treturn false;\n\t}\n\n\tmemset(value, 0, sizeof(value));\n\tvalue[0] = chrc->ext_props;\n\n\tif (!gatt_db_attribute_write(cep, 0, value, sizeof(value), 0, NULL,\n\t\t\t\t\t\t\tcep_write_cb, NULL)) {\n\t\tDBG(\"Failed to store CEP value in the database\");\n\t\treturn false;\n\t}\n\n\tDBG(\"Created CEP entry for characteristic\");\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "database_add_ccc",
          "args": [
            "service",
            "chrc"
          ],
          "line": 2762
        },
        "resolved": true,
        "details": {
          "function_name": "database_add_ccc",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "2448-2471",
          "snippet": "static bool database_add_ccc(struct external_service *service,\n\t\t\t\t\t\tstruct external_chrc *chrc)\n{\n\tif (!(chrc->props & BT_GATT_CHRC_PROP_NOTIFY) &&\n\t\t\t\t!(chrc->props & BT_GATT_CHRC_PROP_INDICATE))\n\t\treturn true;\n\n\tchrc->ccc = service_add_ccc(service->attrib, service->app->database,\n\t\t\t\t\t\tccc_write_cb, chrc, NULL);\n\tif (!chrc->ccc) {\n\t\terror(\"Failed to create CCC entry for characteristic\");\n\t\treturn false;\n\t}\n\n\tif (g_dbus_proxy_set_property_watch(chrc->proxy, property_changed_cb,\n\t\t\t\t\t\t\tchrc) == FALSE) {\n\t\terror(\"Failed to set up property watch for characteristic\");\n\t\treturn false;\n\t}\n\n\tDBG(\"Created CCC entry for characteristic\");\n\n\treturn true;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic bool database_add_ccc(struct external_service *service,\n\t\t\t\t\t\tstruct external_chrc *chrc)\n{\n\tif (!(chrc->props & BT_GATT_CHRC_PROP_NOTIFY) &&\n\t\t\t\t!(chrc->props & BT_GATT_CHRC_PROP_INDICATE))\n\t\treturn true;\n\n\tchrc->ccc = service_add_ccc(service->attrib, service->app->database,\n\t\t\t\t\t\tccc_write_cb, chrc, NULL);\n\tif (!chrc->ccc) {\n\t\terror(\"Failed to create CCC entry for characteristic\");\n\t\treturn false;\n\t}\n\n\tif (g_dbus_proxy_set_property_watch(chrc->proxy, property_changed_cb,\n\t\t\t\t\t\t\tchrc) == FALSE) {\n\t\terror(\"Failed to set up property watch for characteristic\");\n\t\treturn false;\n\t}\n\n\tDBG(\"Created CCC entry for characteristic\");\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "gatt_db_service_add_characteristic",
          "args": [
            "service->attrib",
            "&uuid",
            "chrc->perm",
            "chrc->props",
            "chrc_read_cb",
            "chrc_write_cb",
            "chrc"
          ],
          "line": 2753
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_service_add_characteristic",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "780-796",
          "snippet": "struct gatt_db_attribute *\ngatt_db_service_add_characteristic(struct gatt_db_attribute *attrib,\n\t\t\t\t\tconst bt_uuid_t *uuid,\n\t\t\t\t\tuint32_t permissions,\n\t\t\t\t\tuint8_t properties,\n\t\t\t\t\tgatt_db_read_t read_func,\n\t\t\t\t\tgatt_db_write_t write_func,\n\t\t\t\t\tvoid *user_data)\n{\n\tif (!attrib)\n\t\treturn NULL;\n\n\treturn service_insert_characteristic(attrib->service, 0, uuid,\n\t\t\t\t\t\tpermissions, properties,\n\t\t\t\t\t\tread_func, write_func,\n\t\t\t\t\t\tuser_data);\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstruct gatt_db_attribute *\ngatt_db_service_add_characteristic(struct gatt_db_attribute *attrib,\n\t\t\t\t\tconst bt_uuid_t *uuid,\n\t\t\t\t\tuint32_t permissions,\n\t\t\t\t\tuint8_t properties,\n\t\t\t\t\tgatt_db_read_t read_func,\n\t\t\t\t\tgatt_db_write_t write_func,\n\t\t\t\t\tvoid *user_data)\n{\n\tif (!attrib)\n\t\treturn NULL;\n\n\treturn service_insert_characteristic(attrib->service, 0, uuid,\n\t\t\t\t\t\tpermissions, properties,\n\t\t\t\t\t\tread_func, write_func,\n\t\t\t\t\t\tuser_data);\n}"
        }
      },
      {
        "call_info": {
          "callee": "check_service_path",
          "args": [
            "chrc->proxy",
            "service"
          ],
          "line": 2748
        },
        "resolved": true,
        "details": {
          "function_name": "check_service_path",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "1660-1669",
          "snippet": "static bool check_service_path(GDBusProxy *proxy,\n\t\t\t\t\tstruct external_service *service)\n{\n\tconst char *service_path;\n\n\tif (!parse_path(proxy, \"Service\", &service_path))\n\t\treturn false;\n\n\treturn g_strcmp0(service_path, service->path) == 0;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic bool check_service_path(GDBusProxy *proxy,\n\t\t\t\t\tstruct external_service *service)\n{\n\tconst char *service_path;\n\n\tif (!parse_path(proxy, \"Service\", &service_path))\n\t\treturn false;\n\n\treturn g_strcmp0(service_path, service->path) == 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "parse_uuid",
          "args": [
            "chrc->proxy",
            "&uuid"
          ],
          "line": 2743
        },
        "resolved": true,
        "details": {
          "function_name": "parse_uuid",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "1748-1779",
          "snippet": "static bool parse_uuid(GDBusProxy *proxy, bt_uuid_t *uuid)\n{\n\tDBusMessageIter iter;\n\tbt_uuid_t tmp;\n\tconst char *uuidstr;\n\n\tif (!g_dbus_proxy_get_property(proxy, \"UUID\", &iter))\n\t\treturn false;\n\n\tif (dbus_message_iter_get_arg_type(&iter) != DBUS_TYPE_STRING)\n\t\treturn false;\n\n\tdbus_message_iter_get_basic(&iter, &uuidstr);\n\n\tif (bt_string_to_uuid(uuid, uuidstr) < 0)\n\t\treturn false;\n\n\t/* GAP & GATT services are created and managed by BlueZ */\n\tbt_uuid16_create(&tmp, UUID_GAP);\n\tif (!bt_uuid_cmp(&tmp, uuid)) {\n\t\terror(\"GAP service must be handled by BlueZ\");\n\t\treturn false;\n\t}\n\n\tbt_uuid16_create(&tmp, UUID_GATT);\n\tif (!bt_uuid_cmp(&tmp, uuid)) {\n\t\terror(\"GATT service must be handled by BlueZ\");\n\t\treturn false;\n\t}\n\n\treturn true;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define UUID_GATT\t0x1801",
            "#define UUID_GAP\t0x1800"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\n#define UUID_GATT\t0x1801\n#define UUID_GAP\t0x1800\n\nstatic bool parse_uuid(GDBusProxy *proxy, bt_uuid_t *uuid)\n{\n\tDBusMessageIter iter;\n\tbt_uuid_t tmp;\n\tconst char *uuidstr;\n\n\tif (!g_dbus_proxy_get_property(proxy, \"UUID\", &iter))\n\t\treturn false;\n\n\tif (dbus_message_iter_get_arg_type(&iter) != DBUS_TYPE_STRING)\n\t\treturn false;\n\n\tdbus_message_iter_get_basic(&iter, &uuidstr);\n\n\tif (bt_string_to_uuid(uuid, uuidstr) < 0)\n\t\treturn false;\n\n\t/* GAP & GATT services are created and managed by BlueZ */\n\tbt_uuid16_create(&tmp, UUID_GAP);\n\tif (!bt_uuid_cmp(&tmp, uuid)) {\n\t\terror(\"GAP service must be handled by BlueZ\");\n\t\treturn false;\n\t}\n\n\tbt_uuid16_create(&tmp, UUID_GATT);\n\tif (!bt_uuid_cmp(&tmp, uuid)) {\n\t\terror(\"GATT service must be handled by BlueZ\");\n\t\treturn false;\n\t}\n\n\treturn true;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic bool database_add_chrc(struct external_service *service,\n\t\t\t\t\t\tstruct external_chrc *chrc)\n{\n\tbt_uuid_t uuid;\n\tconst struct queue_entry *entry;\n\n\tif (!parse_uuid(chrc->proxy, &uuid)) {\n\t\terror(\"Failed to read \\\"UUID\\\" property of characteristic\");\n\t\treturn false;\n\t}\n\n\tif (!check_service_path(chrc->proxy, service)) {\n\t\terror(\"Invalid service path for characteristic\");\n\t\treturn false;\n\t}\n\n\tchrc->attrib = gatt_db_service_add_characteristic(service->attrib,\n\t\t\t\t\t\t&uuid, chrc->perm,\n\t\t\t\t\t\tchrc->props, chrc_read_cb,\n\t\t\t\t\t\tchrc_write_cb, chrc);\n\tif (!chrc->attrib) {\n\t\terror(\"Failed to create characteristic entry in database\");\n\t\treturn false;\n\t}\n\n\tif (!database_add_ccc(service, chrc))\n\t\treturn false;\n\n\tif (!database_add_cep(service, chrc))\n\t\treturn false;\n\n\t/* Handle the descriptors that belong to this characteristic. */\n\tfor (entry = queue_get_entries(service->descs); entry;\n\t\t\t\t\t\t\tentry = entry->next) {\n\t\tstruct external_desc *desc = entry->data;\n\n\t\tif (desc->handled || g_strcmp0(desc->chrc_path, chrc->path))\n\t\t\tcontinue;\n\n\t\tif (!database_add_desc(service, desc)) {\n\t\t\tchrc->attrib = NULL;\n\t\t\terror(\"Failed to create descriptor entry\");\n\t\t\treturn false;\n\t\t}\n\t}\n\n\treturn true;\n}"
  },
  {
    "function_name": "database_add_includes",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
    "lines": "2732-2735",
    "snippet": "static void database_add_includes(struct external_service *service)\n{\n\tqueue_foreach(service->includes, include_services, service);\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"dbus-common.h\"",
      "#include \"gatt-database.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "queue_foreach",
          "args": [
            "service->includes",
            "include_services",
            "service"
          ],
          "line": 2734
        },
        "resolved": true,
        "details": {
          "function_name": "queue_foreach",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "203-224",
          "snippet": "void queue_foreach(struct queue *queue, queue_foreach_func_t function,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue || !function)\n\t\treturn;\n\n\tentry = queue->head;\n\tif (!entry)\n\t\treturn;\n\n\tqueue_ref(queue);\n\twhile (entry && queue->head && queue->ref_count > 1) {\n\t\tstruct queue_entry *next;\n\n\t\tnext = entry->next;\n\t\tfunction(entry->data, user_data);\n\t\tentry = next;\n\t}\n\tqueue_unref(queue);\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nvoid queue_foreach(struct queue *queue, queue_foreach_func_t function,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue || !function)\n\t\treturn;\n\n\tentry = queue->head;\n\tif (!entry)\n\t\treturn;\n\n\tqueue_ref(queue);\n\twhile (entry && queue->head && queue->ref_count > 1) {\n\t\tstruct queue_entry *next;\n\n\t\tnext = entry->next;\n\t\tfunction(entry->data, user_data);\n\t\tentry = next;\n\t}\n\tqueue_unref(queue);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic void database_add_includes(struct external_service *service)\n{\n\tqueue_foreach(service->includes, include_services, service);\n}"
  },
  {
    "function_name": "include_services",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
    "lines": "2706-2730",
    "snippet": "static void include_services(void *data ,void *userdata)\n{\n\tchar *obj = data;\n\tstruct external_service *service = userdata;\n\tstruct gatt_db_attribute *attrib;\n\tstruct external_service *service_inc;\n\n\tDBG(\"path %s\", obj);\n\n\tservice_inc = queue_find(service->app->services, match_service_by_path,\n\t\t\t\t\t\t\t\t\tobj);\n\tif (!service_inc) {\n\t\terror(\"include service not found\\n\");\n\t\treturn;\n\t}\n\n\tattrib = gatt_db_service_add_included(service->attrib,\n\t\t\t\t\t\t\tservice_inc->attrib);\n\tif (!attrib) {\n\t\terror(\"include service attributes failed\\n\");\n\t\treturn;\n\t}\n\n\tservice->attrib = attrib;\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"dbus-common.h\"",
      "#include \"gatt-database.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"include service attributes failed\\n\""
          ],
          "line": 2725
        },
        "resolved": true,
        "details": {
          "function_name": "dbus_error_to_att_ecode",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "1833-1855",
          "snippet": "static uint8_t dbus_error_to_att_ecode(const char *error_name)\n{\n\n\tif (strcmp(error_name, \"org.bluez.Error.Failed\") == 0)\n\t\treturn 0x80;  /* For now return this \"application error\" */\n\n\tif (strcmp(error_name, \"org.bluez.Error.NotSupported\") == 0)\n\t\treturn BT_ATT_ERROR_REQUEST_NOT_SUPPORTED;\n\n\tif (strcmp(error_name, \"org.bluez.Error.NotAuthorized\") == 0)\n\t\treturn BT_ATT_ERROR_AUTHORIZATION;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InvalidValueLength\") == 0)\n\t\treturn BT_ATT_ERROR_INVALID_ATTRIBUTE_VALUE_LEN;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InvalidOffset\") == 0)\n\t\treturn BT_ATT_ERROR_INVALID_OFFSET;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InProgress\") == 0)\n\t\treturn BT_ERROR_ALREADY_IN_PROGRESS;\n\n\treturn 0;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic uint8_t dbus_error_to_att_ecode(const char *error_name)\n{\n\n\tif (strcmp(error_name, \"org.bluez.Error.Failed\") == 0)\n\t\treturn 0x80;  /* For now return this \"application error\" */\n\n\tif (strcmp(error_name, \"org.bluez.Error.NotSupported\") == 0)\n\t\treturn BT_ATT_ERROR_REQUEST_NOT_SUPPORTED;\n\n\tif (strcmp(error_name, \"org.bluez.Error.NotAuthorized\") == 0)\n\t\treturn BT_ATT_ERROR_AUTHORIZATION;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InvalidValueLength\") == 0)\n\t\treturn BT_ATT_ERROR_INVALID_ATTRIBUTE_VALUE_LEN;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InvalidOffset\") == 0)\n\t\treturn BT_ATT_ERROR_INVALID_OFFSET;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InProgress\") == 0)\n\t\treturn BT_ERROR_ALREADY_IN_PROGRESS;\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "gatt_db_service_add_included",
          "args": [
            "service->attrib",
            "service_inc->attrib"
          ],
          "line": 2722
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_service_add_included",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "941-949",
          "snippet": "struct gatt_db_attribute *\ngatt_db_service_add_included(struct gatt_db_attribute *attrib,\n\t\t\t\t\tstruct gatt_db_attribute *include)\n{\n\tif (!attrib || !include)\n\t\treturn NULL;\n\n\treturn service_insert_included(attrib->service, 0, include);\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstruct gatt_db_attribute *\ngatt_db_service_add_included(struct gatt_db_attribute *attrib,\n\t\t\t\t\tstruct gatt_db_attribute *include)\n{\n\tif (!attrib || !include)\n\t\treturn NULL;\n\n\treturn service_insert_included(attrib->service, 0, include);\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_find",
          "args": [
            "service->app->services",
            "match_service_by_path",
            "obj"
          ],
          "line": 2715
        },
        "resolved": true,
        "details": {
          "function_name": "queue_find",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "231-247",
          "snippet": "void *queue_find(struct queue *queue, queue_match_func_t function,\n\t\t\t\t\t\t\tconst void *match_data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn NULL;\n\n\tif (!function)\n\t\tfunction = direct_match;\n\n\tfor (entry = queue->head; entry; entry = entry->next)\n\t\tif (function(entry->data, match_data))\n\t\t\treturn entry->data;\n\n\treturn NULL;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nvoid *queue_find(struct queue *queue, queue_match_func_t function,\n\t\t\t\t\t\t\tconst void *match_data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn NULL;\n\n\tif (!function)\n\t\tfunction = direct_match;\n\n\tfor (entry = queue->head; entry; entry = entry->next)\n\t\tif (function(entry->data, match_data))\n\t\t\treturn entry->data;\n\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"path %s\"",
            "obj"
          ],
          "line": 2713
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic void include_services(void *data ,void *userdata)\n{\n\tchar *obj = data;\n\tstruct external_service *service = userdata;\n\tstruct gatt_db_attribute *attrib;\n\tstruct external_service *service_inc;\n\n\tDBG(\"path %s\", obj);\n\n\tservice_inc = queue_find(service->app->services, match_service_by_path,\n\t\t\t\t\t\t\t\t\tobj);\n\tif (!service_inc) {\n\t\terror(\"include service not found\\n\");\n\t\treturn;\n\t}\n\n\tattrib = gatt_db_service_add_included(service->attrib,\n\t\t\t\t\t\t\tservice_inc->attrib);\n\tif (!attrib) {\n\t\terror(\"include service attributes failed\\n\");\n\t\treturn;\n\t}\n\n\tservice->attrib = attrib;\n}"
  },
  {
    "function_name": "chrc_write_cb",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
    "lines": "2640-2704",
    "snippet": "static void chrc_write_cb(struct gatt_db_attribute *attrib,\n\t\t\t\t\tunsigned int id, uint16_t offset,\n\t\t\t\t\tconst uint8_t *value, size_t len,\n\t\t\t\t\tuint8_t opcode, struct bt_att *att,\n\t\t\t\t\tvoid *user_data)\n{\n\tstruct external_chrc *chrc = user_data;\n\tstruct btd_device *device;\n\tstruct queue *queue;\n\tDBusMessageIter iter;\n\n\tif (chrc->attrib != attrib) {\n\t\terror(\"Write callback called with incorrect attribute\");\n\t\tgoto fail;\n\t}\n\n\tdevice = att_get_device(att);\n\tif (!device) {\n\t\terror(\"Unable to find device object\");\n\t\tgoto fail;\n\t}\n\n\tif (!(chrc->props & BT_GATT_CHRC_PROP_WRITE_WITHOUT_RESP))\n\t\tqueue = chrc->pending_writes;\n\telse\n\t\tqueue = NULL;\n\n\tif (opcode == BT_ATT_OP_PREP_WRITE_REQ) {\n\t\tif (!device_is_trusted(device) && !chrc->prep_authorized &&\n\t\t\t\t\t\tchrc->req_prep_authorization)\n\t\t\tsend_write(device, attrib, chrc->proxy, queue,\n\t\t\t\t\tid, value, len, offset,\n\t\t\t\t\tbt_att_get_link_type(att), true, true);\n\t\telse\n\t\t\tgatt_db_attribute_write_result(attrib, id, 0);\n\n\t\treturn;\n\t}\n\n\tif (opcode == BT_ATT_OP_EXEC_WRITE_REQ)\n\t\tchrc->prep_authorized = false;\n\n\tif (chrc->write_io) {\n\t\tif (pipe_io_send(chrc->write_io, value, len) < 0) {\n\t\t\terror(\"Unable to write: %s\", strerror(errno));\n\t\t\tgoto fail;\n\t\t}\n\n\t\tgatt_db_attribute_write_result(attrib, id, 0);\n\t\treturn;\n\t}\n\n\tif (g_dbus_proxy_get_property(chrc->proxy, \"WriteAcquired\", &iter)) {\n\t\tif (acquire_write(chrc, device, attrib, id, value, len,\n\t\t\t\t\t\tbt_att_get_link_type(att)))\n\t\t\treturn;\n\t}\n\n\tif (send_write(device, attrib, chrc->proxy, queue, id, value, len,\n\t\t\toffset, bt_att_get_link_type(att), false, false))\n\t\treturn;\n\nfail:\n\tgatt_db_attribute_write_result(attrib, id, BT_ATT_ERROR_UNLIKELY);\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"dbus-common.h\"",
      "#include \"gatt-database.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "gatt_db_attribute_write_result",
          "args": [
            "attrib",
            "id",
            "BT_ATT_ERROR_UNLIKELY"
          ],
          "line": 2703
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_attribute_write_result",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "1862-1878",
          "snippet": "bool gatt_db_attribute_write_result(struct gatt_db_attribute *attrib,\n\t\t\t\t\t\tunsigned int id, int err)\n{\n\tstruct pending_write *p;\n\n\tif (!attrib || !id)\n\t\treturn false;\n\n\tp = queue_remove_if(attrib->pending_writes, find_pending,\n\t\t\t\t\t\t\tUINT_TO_PTR(id));\n\tif (!p)\n\t\treturn false;\n\n\tpending_write_result(p, err);\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nbool gatt_db_attribute_write_result(struct gatt_db_attribute *attrib,\n\t\t\t\t\t\tunsigned int id, int err)\n{\n\tstruct pending_write *p;\n\n\tif (!attrib || !id)\n\t\treturn false;\n\n\tp = queue_remove_if(attrib->pending_writes, find_pending,\n\t\t\t\t\t\t\tUINT_TO_PTR(id));\n\tif (!p)\n\t\treturn false;\n\n\tpending_write_result(p, err);\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "send_write",
          "args": [
            "device",
            "attrib",
            "chrc->proxy",
            "queue",
            "id",
            "value",
            "len",
            "offset",
            "bt_att_get_link_type(att)",
            "false",
            "false"
          ],
          "line": 2698
        },
        "resolved": true,
        "details": {
          "function_name": "send_write",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "2111-2135",
          "snippet": "static struct pending_op *send_write(struct btd_device *device,\n\t\t\t\t\tstruct gatt_db_attribute *attrib,\n\t\t\t\t\tGDBusProxy *proxy,\n\t\t\t\t\tstruct queue *owner_queue,\n\t\t\t\t\tunsigned int id,\n\t\t\t\t\tconst uint8_t *value, size_t len,\n\t\t\t\t\tuint16_t offset, uint8_t link_type,\n\t\t\t\t\tbool is_characteristic,\n\t\t\t\t\tbool prep_authorize)\n{\n\tstruct pending_op *op;\n\n\top = pending_write_new(device, owner_queue, attrib, id, value, len,\n\t\t\t\t\toffset, link_type, is_characteristic,\n\t\t\t\t\tprep_authorize);\n\n\tif (g_dbus_proxy_method_call(proxy, \"WriteValue\", write_setup_cb,\n\t\t\t\t\towner_queue ? write_reply_cb : NULL,\n\t\t\t\t\top, pending_op_free) == TRUE)\n\t\treturn op;\n\n\tpending_op_free(op);\n\n\treturn NULL;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic struct pending_op *send_write(struct btd_device *device,\n\t\t\t\t\tstruct gatt_db_attribute *attrib,\n\t\t\t\t\tGDBusProxy *proxy,\n\t\t\t\t\tstruct queue *owner_queue,\n\t\t\t\t\tunsigned int id,\n\t\t\t\t\tconst uint8_t *value, size_t len,\n\t\t\t\t\tuint16_t offset, uint8_t link_type,\n\t\t\t\t\tbool is_characteristic,\n\t\t\t\t\tbool prep_authorize)\n{\n\tstruct pending_op *op;\n\n\top = pending_write_new(device, owner_queue, attrib, id, value, len,\n\t\t\t\t\toffset, link_type, is_characteristic,\n\t\t\t\t\tprep_authorize);\n\n\tif (g_dbus_proxy_method_call(proxy, \"WriteValue\", write_setup_cb,\n\t\t\t\t\towner_queue ? write_reply_cb : NULL,\n\t\t\t\t\top, pending_op_free) == TRUE)\n\t\treturn op;\n\n\tpending_op_free(op);\n\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "bt_att_get_link_type",
          "args": [
            "att"
          ],
          "line": 2699
        },
        "resolved": true,
        "details": {
          "function_name": "bt_att_get_link_type",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/att.c",
          "lines": "1139-1159",
          "snippet": "uint8_t bt_att_get_link_type(struct bt_att *att)\n{\n\tstruct sockaddr_l2 src;\n\tsocklen_t len;\n\n\tif (!att)\n\t\treturn -EINVAL;\n\n\tif (!att->io_on_l2cap)\n\t\treturn BT_ATT_LINK_LOCAL;\n\n\tlen = sizeof(src);\n\tmemset(&src, 0, len);\n\tif (getsockname(att->fd, (void *)&src, &len) < 0)\n\t\treturn -errno;\n\n\tif (src.l2_bdaddr_type == BDADDR_BREDR)\n\t\treturn BT_ATT_LINK_BREDR;\n\n\treturn BT_ATT_LINK_LE;\n}",
          "includes": [
            "#include \"src/shared/crypto.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/l2cap.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/crypto.h\"\n#include \"src/shared/att.h\"\n#include \"lib/uuid.h\"\n#include \"lib/l2cap.h\"\n#include \"lib/bluetooth.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include <errno.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <config.h>\n\nuint8_t bt_att_get_link_type(struct bt_att *att)\n{\n\tstruct sockaddr_l2 src;\n\tsocklen_t len;\n\n\tif (!att)\n\t\treturn -EINVAL;\n\n\tif (!att->io_on_l2cap)\n\t\treturn BT_ATT_LINK_LOCAL;\n\n\tlen = sizeof(src);\n\tmemset(&src, 0, len);\n\tif (getsockname(att->fd, (void *)&src, &len) < 0)\n\t\treturn -errno;\n\n\tif (src.l2_bdaddr_type == BDADDR_BREDR)\n\t\treturn BT_ATT_LINK_BREDR;\n\n\treturn BT_ATT_LINK_LE;\n}"
        }
      },
      {
        "call_info": {
          "callee": "acquire_write",
          "args": [
            "chrc",
            "device",
            "attrib",
            "id",
            "value",
            "len",
            "bt_att_get_link_type(att)"
          ],
          "line": 2693
        },
        "resolved": true,
        "details": {
          "function_name": "acquire_write",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "2258-2279",
          "snippet": "static struct pending_op *acquire_write(struct external_chrc *chrc,\n\t\t\t\t\tstruct btd_device *device,\n\t\t\t\t\tstruct gatt_db_attribute *attrib,\n\t\t\t\t\tunsigned int id,\n\t\t\t\t\tconst uint8_t *value, size_t len,\n\t\t\t\t\tuint8_t link_type)\n{\n\tstruct pending_op *op;\n\n\top = pending_write_new(device, NULL, attrib, id, value, len, 0,\n\t\t\t\t\t\tlink_type, false, false);\n\n\tif (g_dbus_proxy_method_call(chrc->proxy, \"AcquireWrite\",\n\t\t\t\t\tacquire_write_setup,\n\t\t\t\t\tacquire_write_reply,\n\t\t\t\t\top, pending_op_free))\n\t\treturn op;\n\n\tpending_op_free(op);\n\n\treturn NULL;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic struct pending_op *acquire_write(struct external_chrc *chrc,\n\t\t\t\t\tstruct btd_device *device,\n\t\t\t\t\tstruct gatt_db_attribute *attrib,\n\t\t\t\t\tunsigned int id,\n\t\t\t\t\tconst uint8_t *value, size_t len,\n\t\t\t\t\tuint8_t link_type)\n{\n\tstruct pending_op *op;\n\n\top = pending_write_new(device, NULL, attrib, id, value, len, 0,\n\t\t\t\t\t\tlink_type, false, false);\n\n\tif (g_dbus_proxy_method_call(chrc->proxy, \"AcquireWrite\",\n\t\t\t\t\tacquire_write_setup,\n\t\t\t\t\tacquire_write_reply,\n\t\t\t\t\top, pending_op_free))\n\t\treturn op;\n\n\tpending_op_free(op);\n\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_dbus_proxy_get_property",
          "args": [
            "chrc->proxy",
            "\"WriteAcquired\"",
            "&iter"
          ],
          "line": 2692
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"Unable to write: %s\"",
            "strerror(errno)"
          ],
          "line": 2684
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_failed",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "124-128",
          "snippet": "DBusMessage *btd_error_failed(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE\n\t\t\t\t\t\".Failed\", \"%s\", str);\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_failed(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE\n\t\t\t\t\t\".Failed\", \"%s\", str);\n}"
        }
      },
      {
        "call_info": {
          "callee": "strerror",
          "args": [
            "errno"
          ],
          "line": 2684
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pipe_io_send",
          "args": [
            "chrc->write_io",
            "value",
            "len"
          ],
          "line": 2683
        },
        "resolved": true,
        "details": {
          "function_name": "pipe_io_send",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "2189-2197",
          "snippet": "static int pipe_io_send(struct io *io, const void *data, size_t len)\n{\n\tstruct iovec iov;\n\n\tiov.iov_base = (void *) data;\n\tiov.iov_len = len;\n\n\treturn io_send(io, &iov, 1);\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic int pipe_io_send(struct io *io, const void *data, size_t len)\n{\n\tstruct iovec iov;\n\n\tiov.iov_base = (void *) data;\n\tiov.iov_len = len;\n\n\treturn io_send(io, &iov, 1);\n}"
        }
      },
      {
        "call_info": {
          "callee": "device_is_trusted",
          "args": [
            "device"
          ],
          "line": 2668
        },
        "resolved": true,
        "details": {
          "function_name": "device_is_trusted",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "710-713",
          "snippet": "gboolean device_is_trusted(struct btd_device *device)\n{\n\treturn device->trusted;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\ngboolean device_is_trusted(struct btd_device *device)\n{\n\treturn device->trusted;\n}"
        }
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"Unable to find device object\""
          ],
          "line": 2658
        },
        "resolved": true,
        "details": {
          "function_name": "dbus_error_to_att_ecode",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "1833-1855",
          "snippet": "static uint8_t dbus_error_to_att_ecode(const char *error_name)\n{\n\n\tif (strcmp(error_name, \"org.bluez.Error.Failed\") == 0)\n\t\treturn 0x80;  /* For now return this \"application error\" */\n\n\tif (strcmp(error_name, \"org.bluez.Error.NotSupported\") == 0)\n\t\treturn BT_ATT_ERROR_REQUEST_NOT_SUPPORTED;\n\n\tif (strcmp(error_name, \"org.bluez.Error.NotAuthorized\") == 0)\n\t\treturn BT_ATT_ERROR_AUTHORIZATION;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InvalidValueLength\") == 0)\n\t\treturn BT_ATT_ERROR_INVALID_ATTRIBUTE_VALUE_LEN;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InvalidOffset\") == 0)\n\t\treturn BT_ATT_ERROR_INVALID_OFFSET;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InProgress\") == 0)\n\t\treturn BT_ERROR_ALREADY_IN_PROGRESS;\n\n\treturn 0;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic uint8_t dbus_error_to_att_ecode(const char *error_name)\n{\n\n\tif (strcmp(error_name, \"org.bluez.Error.Failed\") == 0)\n\t\treturn 0x80;  /* For now return this \"application error\" */\n\n\tif (strcmp(error_name, \"org.bluez.Error.NotSupported\") == 0)\n\t\treturn BT_ATT_ERROR_REQUEST_NOT_SUPPORTED;\n\n\tif (strcmp(error_name, \"org.bluez.Error.NotAuthorized\") == 0)\n\t\treturn BT_ATT_ERROR_AUTHORIZATION;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InvalidValueLength\") == 0)\n\t\treturn BT_ATT_ERROR_INVALID_ATTRIBUTE_VALUE_LEN;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InvalidOffset\") == 0)\n\t\treturn BT_ATT_ERROR_INVALID_OFFSET;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InProgress\") == 0)\n\t\treturn BT_ERROR_ALREADY_IN_PROGRESS;\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "att_get_device",
          "args": [
            "att"
          ],
          "line": 2656
        },
        "resolved": true,
        "details": {
          "function_name": "att_get_device",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "881-913",
          "snippet": "static struct btd_device *att_get_device(struct bt_att *att)\n{\n\tGIOChannel *io = NULL;\n\tGError *gerr = NULL;\n\tbdaddr_t src, dst;\n\tuint8_t dst_type;\n\tstruct btd_adapter *adapter;\n\n\tio = g_io_channel_unix_new(bt_att_get_fd(att));\n\tif (!io)\n\t\treturn NULL;\n\n\tbt_io_get(io, &gerr, BT_IO_OPT_SOURCE_BDADDR, &src,\n\t\t\t\t\tBT_IO_OPT_DEST_BDADDR, &dst,\n\t\t\t\t\tBT_IO_OPT_DEST_TYPE, &dst_type,\n\t\t\t\t\tBT_IO_OPT_INVALID);\n\tif (gerr) {\n\t\terror(\"bt_io_get: %s\", gerr->message);\n\t\tg_error_free(gerr);\n\t\tg_io_channel_unref(io);\n\t\treturn NULL;\n\t}\n\n\tg_io_channel_unref(io);\n\n\tadapter = adapter_find(&src);\n\tif (!adapter) {\n\t\terror(\"Unable to find adapter object\");\n\t\treturn NULL;\n\t}\n\n\treturn btd_adapter_find_device(adapter, &dst, dst_type);\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic struct btd_device *att_get_device(struct bt_att *att)\n{\n\tGIOChannel *io = NULL;\n\tGError *gerr = NULL;\n\tbdaddr_t src, dst;\n\tuint8_t dst_type;\n\tstruct btd_adapter *adapter;\n\n\tio = g_io_channel_unix_new(bt_att_get_fd(att));\n\tif (!io)\n\t\treturn NULL;\n\n\tbt_io_get(io, &gerr, BT_IO_OPT_SOURCE_BDADDR, &src,\n\t\t\t\t\tBT_IO_OPT_DEST_BDADDR, &dst,\n\t\t\t\t\tBT_IO_OPT_DEST_TYPE, &dst_type,\n\t\t\t\t\tBT_IO_OPT_INVALID);\n\tif (gerr) {\n\t\terror(\"bt_io_get: %s\", gerr->message);\n\t\tg_error_free(gerr);\n\t\tg_io_channel_unref(io);\n\t\treturn NULL;\n\t}\n\n\tg_io_channel_unref(io);\n\n\tadapter = adapter_find(&src);\n\tif (!adapter) {\n\t\terror(\"Unable to find adapter object\");\n\t\treturn NULL;\n\t}\n\n\treturn btd_adapter_find_device(adapter, &dst, dst_type);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic void chrc_write_cb(struct gatt_db_attribute *attrib,\n\t\t\t\t\tunsigned int id, uint16_t offset,\n\t\t\t\t\tconst uint8_t *value, size_t len,\n\t\t\t\t\tuint8_t opcode, struct bt_att *att,\n\t\t\t\t\tvoid *user_data)\n{\n\tstruct external_chrc *chrc = user_data;\n\tstruct btd_device *device;\n\tstruct queue *queue;\n\tDBusMessageIter iter;\n\n\tif (chrc->attrib != attrib) {\n\t\terror(\"Write callback called with incorrect attribute\");\n\t\tgoto fail;\n\t}\n\n\tdevice = att_get_device(att);\n\tif (!device) {\n\t\terror(\"Unable to find device object\");\n\t\tgoto fail;\n\t}\n\n\tif (!(chrc->props & BT_GATT_CHRC_PROP_WRITE_WITHOUT_RESP))\n\t\tqueue = chrc->pending_writes;\n\telse\n\t\tqueue = NULL;\n\n\tif (opcode == BT_ATT_OP_PREP_WRITE_REQ) {\n\t\tif (!device_is_trusted(device) && !chrc->prep_authorized &&\n\t\t\t\t\t\tchrc->req_prep_authorization)\n\t\t\tsend_write(device, attrib, chrc->proxy, queue,\n\t\t\t\t\tid, value, len, offset,\n\t\t\t\t\tbt_att_get_link_type(att), true, true);\n\t\telse\n\t\t\tgatt_db_attribute_write_result(attrib, id, 0);\n\n\t\treturn;\n\t}\n\n\tif (opcode == BT_ATT_OP_EXEC_WRITE_REQ)\n\t\tchrc->prep_authorized = false;\n\n\tif (chrc->write_io) {\n\t\tif (pipe_io_send(chrc->write_io, value, len) < 0) {\n\t\t\terror(\"Unable to write: %s\", strerror(errno));\n\t\t\tgoto fail;\n\t\t}\n\n\t\tgatt_db_attribute_write_result(attrib, id, 0);\n\t\treturn;\n\t}\n\n\tif (g_dbus_proxy_get_property(chrc->proxy, \"WriteAcquired\", &iter)) {\n\t\tif (acquire_write(chrc, device, attrib, id, value, len,\n\t\t\t\t\t\tbt_att_get_link_type(att)))\n\t\t\treturn;\n\t}\n\n\tif (send_write(device, attrib, chrc->proxy, queue, id, value, len,\n\t\t\toffset, bt_att_get_link_type(att), false, false))\n\t\treturn;\n\nfail:\n\tgatt_db_attribute_write_result(attrib, id, BT_ATT_ERROR_UNLIKELY);\n}"
  },
  {
    "function_name": "chrc_read_cb",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
    "lines": "2612-2638",
    "snippet": "static void chrc_read_cb(struct gatt_db_attribute *attrib,\n\t\t\t\t\tunsigned int id, uint16_t offset,\n\t\t\t\t\tuint8_t opcode, struct bt_att *att,\n\t\t\t\t\tvoid *user_data)\n{\n\tstruct external_chrc *chrc = user_data;\n\tstruct btd_device *device;\n\n\tif (chrc->attrib != attrib) {\n\t\terror(\"Read callback called with incorrect attribute\");\n\t\tgoto fail;\n\t}\n\n\tdevice = att_get_device(att);\n\tif (!device) {\n\t\terror(\"Unable to find device object\");\n\t\tgoto fail;\n\t}\n\n\tif (send_read(device, attrib, chrc->proxy, chrc->pending_reads, id,\n\t\t\t\t\toffset, bt_att_get_link_type(att)))\n\t\treturn;\n\nfail:\n\tgatt_db_attribute_read_result(attrib, id, BT_ATT_ERROR_UNLIKELY,\n\t\t\t\t\t\t\t\tNULL, 0);\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"dbus-common.h\"",
      "#include \"gatt-database.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "gatt_db_attribute_read_result",
          "args": [
            "attrib",
            "id",
            "BT_ATT_ERROR_UNLIKELY",
            "NULL",
            "0"
          ],
          "line": 2636
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_attribute_read_result",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "1773-1790",
          "snippet": "bool gatt_db_attribute_read_result(struct gatt_db_attribute *attrib,\n\t\t\t\t\tunsigned int id, int err,\n\t\t\t\t\tconst uint8_t *value, size_t length)\n{\n\tstruct pending_read *p;\n\n\tif (!attrib || !id)\n\t\treturn false;\n\n\tp = queue_remove_if(attrib->pending_reads, find_pending,\n\t\t\t\t\t\t\tUINT_TO_PTR(id));\n\tif (!p)\n\t\treturn false;\n\n\tpending_read_result(p, err, value, length);\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nbool gatt_db_attribute_read_result(struct gatt_db_attribute *attrib,\n\t\t\t\t\tunsigned int id, int err,\n\t\t\t\t\tconst uint8_t *value, size_t length)\n{\n\tstruct pending_read *p;\n\n\tif (!attrib || !id)\n\t\treturn false;\n\n\tp = queue_remove_if(attrib->pending_reads, find_pending,\n\t\t\t\t\t\t\tUINT_TO_PTR(id));\n\tif (!p)\n\t\treturn false;\n\n\tpending_read_result(p, err, value, length);\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "send_read",
          "args": [
            "device",
            "attrib",
            "chrc->proxy",
            "chrc->pending_reads",
            "id",
            "offset",
            "bt_att_get_link_type(att)"
          ],
          "line": 2631
        },
        "resolved": true,
        "details": {
          "function_name": "send_read",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "1985-2005",
          "snippet": "static struct pending_op *send_read(struct btd_device *device,\n\t\t\t\t\tstruct gatt_db_attribute *attrib,\n\t\t\t\t\tGDBusProxy *proxy,\n\t\t\t\t\tstruct queue *owner_queue,\n\t\t\t\t\tunsigned int id,\n\t\t\t\t\tuint16_t offset,\n\t\t\t\t\tuint8_t link_type)\n{\n\tstruct pending_op *op;\n\n\top = pending_read_new(device, owner_queue, attrib, id, offset,\n\t\t\t\t\t\t\tlink_type);\n\n\tif (g_dbus_proxy_method_call(proxy, \"ReadValue\", read_setup_cb,\n\t\t\t\tread_reply_cb, op, pending_op_free) == TRUE)\n\t\treturn op;\n\n\tpending_op_free(op);\n\n\treturn NULL;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic struct pending_op *send_read(struct btd_device *device,\n\t\t\t\t\tstruct gatt_db_attribute *attrib,\n\t\t\t\t\tGDBusProxy *proxy,\n\t\t\t\t\tstruct queue *owner_queue,\n\t\t\t\t\tunsigned int id,\n\t\t\t\t\tuint16_t offset,\n\t\t\t\t\tuint8_t link_type)\n{\n\tstruct pending_op *op;\n\n\top = pending_read_new(device, owner_queue, attrib, id, offset,\n\t\t\t\t\t\t\tlink_type);\n\n\tif (g_dbus_proxy_method_call(proxy, \"ReadValue\", read_setup_cb,\n\t\t\t\tread_reply_cb, op, pending_op_free) == TRUE)\n\t\treturn op;\n\n\tpending_op_free(op);\n\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "bt_att_get_link_type",
          "args": [
            "att"
          ],
          "line": 2632
        },
        "resolved": true,
        "details": {
          "function_name": "bt_att_get_link_type",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/att.c",
          "lines": "1139-1159",
          "snippet": "uint8_t bt_att_get_link_type(struct bt_att *att)\n{\n\tstruct sockaddr_l2 src;\n\tsocklen_t len;\n\n\tif (!att)\n\t\treturn -EINVAL;\n\n\tif (!att->io_on_l2cap)\n\t\treturn BT_ATT_LINK_LOCAL;\n\n\tlen = sizeof(src);\n\tmemset(&src, 0, len);\n\tif (getsockname(att->fd, (void *)&src, &len) < 0)\n\t\treturn -errno;\n\n\tif (src.l2_bdaddr_type == BDADDR_BREDR)\n\t\treturn BT_ATT_LINK_BREDR;\n\n\treturn BT_ATT_LINK_LE;\n}",
          "includes": [
            "#include \"src/shared/crypto.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/l2cap.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/crypto.h\"\n#include \"src/shared/att.h\"\n#include \"lib/uuid.h\"\n#include \"lib/l2cap.h\"\n#include \"lib/bluetooth.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include <errno.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <config.h>\n\nuint8_t bt_att_get_link_type(struct bt_att *att)\n{\n\tstruct sockaddr_l2 src;\n\tsocklen_t len;\n\n\tif (!att)\n\t\treturn -EINVAL;\n\n\tif (!att->io_on_l2cap)\n\t\treturn BT_ATT_LINK_LOCAL;\n\n\tlen = sizeof(src);\n\tmemset(&src, 0, len);\n\tif (getsockname(att->fd, (void *)&src, &len) < 0)\n\t\treturn -errno;\n\n\tif (src.l2_bdaddr_type == BDADDR_BREDR)\n\t\treturn BT_ATT_LINK_BREDR;\n\n\treturn BT_ATT_LINK_LE;\n}"
        }
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"Unable to find device object\""
          ],
          "line": 2627
        },
        "resolved": true,
        "details": {
          "function_name": "dbus_error_to_att_ecode",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "1833-1855",
          "snippet": "static uint8_t dbus_error_to_att_ecode(const char *error_name)\n{\n\n\tif (strcmp(error_name, \"org.bluez.Error.Failed\") == 0)\n\t\treturn 0x80;  /* For now return this \"application error\" */\n\n\tif (strcmp(error_name, \"org.bluez.Error.NotSupported\") == 0)\n\t\treturn BT_ATT_ERROR_REQUEST_NOT_SUPPORTED;\n\n\tif (strcmp(error_name, \"org.bluez.Error.NotAuthorized\") == 0)\n\t\treturn BT_ATT_ERROR_AUTHORIZATION;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InvalidValueLength\") == 0)\n\t\treturn BT_ATT_ERROR_INVALID_ATTRIBUTE_VALUE_LEN;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InvalidOffset\") == 0)\n\t\treturn BT_ATT_ERROR_INVALID_OFFSET;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InProgress\") == 0)\n\t\treturn BT_ERROR_ALREADY_IN_PROGRESS;\n\n\treturn 0;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic uint8_t dbus_error_to_att_ecode(const char *error_name)\n{\n\n\tif (strcmp(error_name, \"org.bluez.Error.Failed\") == 0)\n\t\treturn 0x80;  /* For now return this \"application error\" */\n\n\tif (strcmp(error_name, \"org.bluez.Error.NotSupported\") == 0)\n\t\treturn BT_ATT_ERROR_REQUEST_NOT_SUPPORTED;\n\n\tif (strcmp(error_name, \"org.bluez.Error.NotAuthorized\") == 0)\n\t\treturn BT_ATT_ERROR_AUTHORIZATION;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InvalidValueLength\") == 0)\n\t\treturn BT_ATT_ERROR_INVALID_ATTRIBUTE_VALUE_LEN;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InvalidOffset\") == 0)\n\t\treturn BT_ATT_ERROR_INVALID_OFFSET;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InProgress\") == 0)\n\t\treturn BT_ERROR_ALREADY_IN_PROGRESS;\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "att_get_device",
          "args": [
            "att"
          ],
          "line": 2625
        },
        "resolved": true,
        "details": {
          "function_name": "att_get_device",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "881-913",
          "snippet": "static struct btd_device *att_get_device(struct bt_att *att)\n{\n\tGIOChannel *io = NULL;\n\tGError *gerr = NULL;\n\tbdaddr_t src, dst;\n\tuint8_t dst_type;\n\tstruct btd_adapter *adapter;\n\n\tio = g_io_channel_unix_new(bt_att_get_fd(att));\n\tif (!io)\n\t\treturn NULL;\n\n\tbt_io_get(io, &gerr, BT_IO_OPT_SOURCE_BDADDR, &src,\n\t\t\t\t\tBT_IO_OPT_DEST_BDADDR, &dst,\n\t\t\t\t\tBT_IO_OPT_DEST_TYPE, &dst_type,\n\t\t\t\t\tBT_IO_OPT_INVALID);\n\tif (gerr) {\n\t\terror(\"bt_io_get: %s\", gerr->message);\n\t\tg_error_free(gerr);\n\t\tg_io_channel_unref(io);\n\t\treturn NULL;\n\t}\n\n\tg_io_channel_unref(io);\n\n\tadapter = adapter_find(&src);\n\tif (!adapter) {\n\t\terror(\"Unable to find adapter object\");\n\t\treturn NULL;\n\t}\n\n\treturn btd_adapter_find_device(adapter, &dst, dst_type);\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic struct btd_device *att_get_device(struct bt_att *att)\n{\n\tGIOChannel *io = NULL;\n\tGError *gerr = NULL;\n\tbdaddr_t src, dst;\n\tuint8_t dst_type;\n\tstruct btd_adapter *adapter;\n\n\tio = g_io_channel_unix_new(bt_att_get_fd(att));\n\tif (!io)\n\t\treturn NULL;\n\n\tbt_io_get(io, &gerr, BT_IO_OPT_SOURCE_BDADDR, &src,\n\t\t\t\t\tBT_IO_OPT_DEST_BDADDR, &dst,\n\t\t\t\t\tBT_IO_OPT_DEST_TYPE, &dst_type,\n\t\t\t\t\tBT_IO_OPT_INVALID);\n\tif (gerr) {\n\t\terror(\"bt_io_get: %s\", gerr->message);\n\t\tg_error_free(gerr);\n\t\tg_io_channel_unref(io);\n\t\treturn NULL;\n\t}\n\n\tg_io_channel_unref(io);\n\n\tadapter = adapter_find(&src);\n\tif (!adapter) {\n\t\terror(\"Unable to find adapter object\");\n\t\treturn NULL;\n\t}\n\n\treturn btd_adapter_find_device(adapter, &dst, dst_type);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic void chrc_read_cb(struct gatt_db_attribute *attrib,\n\t\t\t\t\tunsigned int id, uint16_t offset,\n\t\t\t\t\tuint8_t opcode, struct bt_att *att,\n\t\t\t\t\tvoid *user_data)\n{\n\tstruct external_chrc *chrc = user_data;\n\tstruct btd_device *device;\n\n\tif (chrc->attrib != attrib) {\n\t\terror(\"Read callback called with incorrect attribute\");\n\t\tgoto fail;\n\t}\n\n\tdevice = att_get_device(att);\n\tif (!device) {\n\t\terror(\"Unable to find device object\");\n\t\tgoto fail;\n\t}\n\n\tif (send_read(device, attrib, chrc->proxy, chrc->pending_reads, id,\n\t\t\t\t\toffset, bt_att_get_link_type(att)))\n\t\treturn;\n\nfail:\n\tgatt_db_attribute_read_result(attrib, id, BT_ATT_ERROR_UNLIKELY,\n\t\t\t\t\t\t\t\tNULL, 0);\n}"
  },
  {
    "function_name": "database_add_desc",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
    "lines": "2588-2610",
    "snippet": "static bool database_add_desc(struct external_service *service,\n\t\t\t\t\t\tstruct external_desc *desc)\n{\n\tbt_uuid_t uuid;\n\n\tif (!parse_uuid(desc->proxy, &uuid)) {\n\t\terror(\"Failed to read \\\"UUID\\\" property of descriptor\");\n\t\treturn false;\n\t}\n\n\tdesc->attrib = gatt_db_service_add_descriptor(service->attrib, &uuid,\n\t\t\t\t\t\t\tdesc->perm,\n\t\t\t\t\t\t\tdesc_read_cb,\n\t\t\t\t\t\t\tdesc_write_cb, desc);\n\tif (!desc->attrib) {\n\t\terror(\"Failed to create descriptor entry in database\");\n\t\treturn false;\n\t}\n\n\tdesc->handled = true;\n\n\treturn true;\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"dbus-common.h\"",
      "#include \"gatt-database.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"Failed to create descriptor entry in database\""
          ],
          "line": 2603
        },
        "resolved": true,
        "details": {
          "function_name": "dbus_error_to_att_ecode",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "1833-1855",
          "snippet": "static uint8_t dbus_error_to_att_ecode(const char *error_name)\n{\n\n\tif (strcmp(error_name, \"org.bluez.Error.Failed\") == 0)\n\t\treturn 0x80;  /* For now return this \"application error\" */\n\n\tif (strcmp(error_name, \"org.bluez.Error.NotSupported\") == 0)\n\t\treturn BT_ATT_ERROR_REQUEST_NOT_SUPPORTED;\n\n\tif (strcmp(error_name, \"org.bluez.Error.NotAuthorized\") == 0)\n\t\treturn BT_ATT_ERROR_AUTHORIZATION;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InvalidValueLength\") == 0)\n\t\treturn BT_ATT_ERROR_INVALID_ATTRIBUTE_VALUE_LEN;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InvalidOffset\") == 0)\n\t\treturn BT_ATT_ERROR_INVALID_OFFSET;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InProgress\") == 0)\n\t\treturn BT_ERROR_ALREADY_IN_PROGRESS;\n\n\treturn 0;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic uint8_t dbus_error_to_att_ecode(const char *error_name)\n{\n\n\tif (strcmp(error_name, \"org.bluez.Error.Failed\") == 0)\n\t\treturn 0x80;  /* For now return this \"application error\" */\n\n\tif (strcmp(error_name, \"org.bluez.Error.NotSupported\") == 0)\n\t\treturn BT_ATT_ERROR_REQUEST_NOT_SUPPORTED;\n\n\tif (strcmp(error_name, \"org.bluez.Error.NotAuthorized\") == 0)\n\t\treturn BT_ATT_ERROR_AUTHORIZATION;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InvalidValueLength\") == 0)\n\t\treturn BT_ATT_ERROR_INVALID_ATTRIBUTE_VALUE_LEN;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InvalidOffset\") == 0)\n\t\treturn BT_ATT_ERROR_INVALID_OFFSET;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InProgress\") == 0)\n\t\treturn BT_ERROR_ALREADY_IN_PROGRESS;\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "gatt_db_service_add_descriptor",
          "args": [
            "service->attrib",
            "&uuid",
            "desc->perm",
            "desc_read_cb",
            "desc_write_cb",
            "desc"
          ],
          "line": 2598
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_service_add_descriptor",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "867-881",
          "snippet": "struct gatt_db_attribute *\ngatt_db_service_add_descriptor(struct gatt_db_attribute *attrib,\n\t\t\t\t\tconst bt_uuid_t *uuid,\n\t\t\t\t\tuint32_t permissions,\n\t\t\t\t\tgatt_db_read_t read_func,\n\t\t\t\t\tgatt_db_write_t write_func,\n\t\t\t\t\tvoid *user_data)\n{\n\tif (!attrib)\n\t\treturn NULL;\n\n\treturn service_insert_descriptor(attrib->service, 0, uuid,\n\t\t\t\t\tpermissions, read_func, write_func,\n\t\t\t\t\tuser_data);\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstruct gatt_db_attribute *\ngatt_db_service_add_descriptor(struct gatt_db_attribute *attrib,\n\t\t\t\t\tconst bt_uuid_t *uuid,\n\t\t\t\t\tuint32_t permissions,\n\t\t\t\t\tgatt_db_read_t read_func,\n\t\t\t\t\tgatt_db_write_t write_func,\n\t\t\t\t\tvoid *user_data)\n{\n\tif (!attrib)\n\t\treturn NULL;\n\n\treturn service_insert_descriptor(attrib->service, 0, uuid,\n\t\t\t\t\tpermissions, read_func, write_func,\n\t\t\t\t\tuser_data);\n}"
        }
      },
      {
        "call_info": {
          "callee": "parse_uuid",
          "args": [
            "desc->proxy",
            "&uuid"
          ],
          "line": 2593
        },
        "resolved": true,
        "details": {
          "function_name": "parse_uuid",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "1748-1779",
          "snippet": "static bool parse_uuid(GDBusProxy *proxy, bt_uuid_t *uuid)\n{\n\tDBusMessageIter iter;\n\tbt_uuid_t tmp;\n\tconst char *uuidstr;\n\n\tif (!g_dbus_proxy_get_property(proxy, \"UUID\", &iter))\n\t\treturn false;\n\n\tif (dbus_message_iter_get_arg_type(&iter) != DBUS_TYPE_STRING)\n\t\treturn false;\n\n\tdbus_message_iter_get_basic(&iter, &uuidstr);\n\n\tif (bt_string_to_uuid(uuid, uuidstr) < 0)\n\t\treturn false;\n\n\t/* GAP & GATT services are created and managed by BlueZ */\n\tbt_uuid16_create(&tmp, UUID_GAP);\n\tif (!bt_uuid_cmp(&tmp, uuid)) {\n\t\terror(\"GAP service must be handled by BlueZ\");\n\t\treturn false;\n\t}\n\n\tbt_uuid16_create(&tmp, UUID_GATT);\n\tif (!bt_uuid_cmp(&tmp, uuid)) {\n\t\terror(\"GATT service must be handled by BlueZ\");\n\t\treturn false;\n\t}\n\n\treturn true;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define UUID_GATT\t0x1801",
            "#define UUID_GAP\t0x1800"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\n#define UUID_GATT\t0x1801\n#define UUID_GAP\t0x1800\n\nstatic bool parse_uuid(GDBusProxy *proxy, bt_uuid_t *uuid)\n{\n\tDBusMessageIter iter;\n\tbt_uuid_t tmp;\n\tconst char *uuidstr;\n\n\tif (!g_dbus_proxy_get_property(proxy, \"UUID\", &iter))\n\t\treturn false;\n\n\tif (dbus_message_iter_get_arg_type(&iter) != DBUS_TYPE_STRING)\n\t\treturn false;\n\n\tdbus_message_iter_get_basic(&iter, &uuidstr);\n\n\tif (bt_string_to_uuid(uuid, uuidstr) < 0)\n\t\treturn false;\n\n\t/* GAP & GATT services are created and managed by BlueZ */\n\tbt_uuid16_create(&tmp, UUID_GAP);\n\tif (!bt_uuid_cmp(&tmp, uuid)) {\n\t\terror(\"GAP service must be handled by BlueZ\");\n\t\treturn false;\n\t}\n\n\tbt_uuid16_create(&tmp, UUID_GATT);\n\tif (!bt_uuid_cmp(&tmp, uuid)) {\n\t\terror(\"GATT service must be handled by BlueZ\");\n\t\treturn false;\n\t}\n\n\treturn true;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic bool database_add_desc(struct external_service *service,\n\t\t\t\t\t\tstruct external_desc *desc)\n{\n\tbt_uuid_t uuid;\n\n\tif (!parse_uuid(desc->proxy, &uuid)) {\n\t\terror(\"Failed to read \\\"UUID\\\" property of descriptor\");\n\t\treturn false;\n\t}\n\n\tdesc->attrib = gatt_db_service_add_descriptor(service->attrib, &uuid,\n\t\t\t\t\t\t\tdesc->perm,\n\t\t\t\t\t\t\tdesc_read_cb,\n\t\t\t\t\t\t\tdesc_write_cb, desc);\n\tif (!desc->attrib) {\n\t\terror(\"Failed to create descriptor entry in database\");\n\t\treturn false;\n\t}\n\n\tdesc->handled = true;\n\n\treturn true;\n}"
  },
  {
    "function_name": "desc_write_cb",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
    "lines": "2543-2586",
    "snippet": "static void desc_write_cb(struct gatt_db_attribute *attrib,\n\t\t\t\t\tunsigned int id, uint16_t offset,\n\t\t\t\t\tconst uint8_t *value, size_t len,\n\t\t\t\t\tuint8_t opcode, struct bt_att *att,\n\t\t\t\t\tvoid *user_data)\n{\n\tstruct external_desc *desc = user_data;\n\tstruct btd_device *device;\n\n\tif (desc->attrib != attrib) {\n\t\terror(\"Read callback called with incorrect attribute\");\n\t\tgoto fail;\n\t}\n\n\tdevice = att_get_device(att);\n\tif (!device) {\n\t\terror(\"Unable to find device object\");\n\t\tgoto fail;\n\t}\n\n\tif (opcode == BT_ATT_OP_PREP_WRITE_REQ) {\n\t\tif (!device_is_trusted(device) && !desc->prep_authorized &&\n\t\t\t\t\t\tdesc->req_prep_authorization)\n\t\t\tsend_write(device, attrib, desc->proxy,\n\t\t\t\t\tdesc->pending_writes, id, value, len,\n\t\t\t\t\toffset, bt_att_get_link_type(att),\n\t\t\t\t\tfalse, true);\n\t\telse\n\t\t\tgatt_db_attribute_write_result(attrib, id, 0);\n\n\t\treturn;\n\t}\n\n\tif (opcode == BT_ATT_OP_EXEC_WRITE_REQ)\n\t\tdesc->prep_authorized = false;\n\n\tif (send_write(device, attrib, desc->proxy, desc->pending_writes, id,\n\t\t\tvalue, len, offset, bt_att_get_link_type(att), false,\n\t\t\tfalse))\n\t\treturn;\n\nfail:\n\tgatt_db_attribute_write_result(attrib, id, BT_ATT_ERROR_UNLIKELY);\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"dbus-common.h\"",
      "#include \"gatt-database.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "gatt_db_attribute_write_result",
          "args": [
            "attrib",
            "id",
            "BT_ATT_ERROR_UNLIKELY"
          ],
          "line": 2585
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_attribute_write_result",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "1862-1878",
          "snippet": "bool gatt_db_attribute_write_result(struct gatt_db_attribute *attrib,\n\t\t\t\t\t\tunsigned int id, int err)\n{\n\tstruct pending_write *p;\n\n\tif (!attrib || !id)\n\t\treturn false;\n\n\tp = queue_remove_if(attrib->pending_writes, find_pending,\n\t\t\t\t\t\t\tUINT_TO_PTR(id));\n\tif (!p)\n\t\treturn false;\n\n\tpending_write_result(p, err);\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nbool gatt_db_attribute_write_result(struct gatt_db_attribute *attrib,\n\t\t\t\t\t\tunsigned int id, int err)\n{\n\tstruct pending_write *p;\n\n\tif (!attrib || !id)\n\t\treturn false;\n\n\tp = queue_remove_if(attrib->pending_writes, find_pending,\n\t\t\t\t\t\t\tUINT_TO_PTR(id));\n\tif (!p)\n\t\treturn false;\n\n\tpending_write_result(p, err);\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "send_write",
          "args": [
            "device",
            "attrib",
            "desc->proxy",
            "desc->pending_writes",
            "id",
            "value",
            "len",
            "offset",
            "bt_att_get_link_type(att)",
            "false",
            "false"
          ],
          "line": 2579
        },
        "resolved": true,
        "details": {
          "function_name": "send_write",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "2111-2135",
          "snippet": "static struct pending_op *send_write(struct btd_device *device,\n\t\t\t\t\tstruct gatt_db_attribute *attrib,\n\t\t\t\t\tGDBusProxy *proxy,\n\t\t\t\t\tstruct queue *owner_queue,\n\t\t\t\t\tunsigned int id,\n\t\t\t\t\tconst uint8_t *value, size_t len,\n\t\t\t\t\tuint16_t offset, uint8_t link_type,\n\t\t\t\t\tbool is_characteristic,\n\t\t\t\t\tbool prep_authorize)\n{\n\tstruct pending_op *op;\n\n\top = pending_write_new(device, owner_queue, attrib, id, value, len,\n\t\t\t\t\toffset, link_type, is_characteristic,\n\t\t\t\t\tprep_authorize);\n\n\tif (g_dbus_proxy_method_call(proxy, \"WriteValue\", write_setup_cb,\n\t\t\t\t\towner_queue ? write_reply_cb : NULL,\n\t\t\t\t\top, pending_op_free) == TRUE)\n\t\treturn op;\n\n\tpending_op_free(op);\n\n\treturn NULL;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic struct pending_op *send_write(struct btd_device *device,\n\t\t\t\t\tstruct gatt_db_attribute *attrib,\n\t\t\t\t\tGDBusProxy *proxy,\n\t\t\t\t\tstruct queue *owner_queue,\n\t\t\t\t\tunsigned int id,\n\t\t\t\t\tconst uint8_t *value, size_t len,\n\t\t\t\t\tuint16_t offset, uint8_t link_type,\n\t\t\t\t\tbool is_characteristic,\n\t\t\t\t\tbool prep_authorize)\n{\n\tstruct pending_op *op;\n\n\top = pending_write_new(device, owner_queue, attrib, id, value, len,\n\t\t\t\t\toffset, link_type, is_characteristic,\n\t\t\t\t\tprep_authorize);\n\n\tif (g_dbus_proxy_method_call(proxy, \"WriteValue\", write_setup_cb,\n\t\t\t\t\towner_queue ? write_reply_cb : NULL,\n\t\t\t\t\top, pending_op_free) == TRUE)\n\t\treturn op;\n\n\tpending_op_free(op);\n\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "bt_att_get_link_type",
          "args": [
            "att"
          ],
          "line": 2580
        },
        "resolved": true,
        "details": {
          "function_name": "bt_att_get_link_type",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/att.c",
          "lines": "1139-1159",
          "snippet": "uint8_t bt_att_get_link_type(struct bt_att *att)\n{\n\tstruct sockaddr_l2 src;\n\tsocklen_t len;\n\n\tif (!att)\n\t\treturn -EINVAL;\n\n\tif (!att->io_on_l2cap)\n\t\treturn BT_ATT_LINK_LOCAL;\n\n\tlen = sizeof(src);\n\tmemset(&src, 0, len);\n\tif (getsockname(att->fd, (void *)&src, &len) < 0)\n\t\treturn -errno;\n\n\tif (src.l2_bdaddr_type == BDADDR_BREDR)\n\t\treturn BT_ATT_LINK_BREDR;\n\n\treturn BT_ATT_LINK_LE;\n}",
          "includes": [
            "#include \"src/shared/crypto.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/l2cap.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/crypto.h\"\n#include \"src/shared/att.h\"\n#include \"lib/uuid.h\"\n#include \"lib/l2cap.h\"\n#include \"lib/bluetooth.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include <errno.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <config.h>\n\nuint8_t bt_att_get_link_type(struct bt_att *att)\n{\n\tstruct sockaddr_l2 src;\n\tsocklen_t len;\n\n\tif (!att)\n\t\treturn -EINVAL;\n\n\tif (!att->io_on_l2cap)\n\t\treturn BT_ATT_LINK_LOCAL;\n\n\tlen = sizeof(src);\n\tmemset(&src, 0, len);\n\tif (getsockname(att->fd, (void *)&src, &len) < 0)\n\t\treturn -errno;\n\n\tif (src.l2_bdaddr_type == BDADDR_BREDR)\n\t\treturn BT_ATT_LINK_BREDR;\n\n\treturn BT_ATT_LINK_LE;\n}"
        }
      },
      {
        "call_info": {
          "callee": "device_is_trusted",
          "args": [
            "device"
          ],
          "line": 2564
        },
        "resolved": true,
        "details": {
          "function_name": "device_is_trusted",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "710-713",
          "snippet": "gboolean device_is_trusted(struct btd_device *device)\n{\n\treturn device->trusted;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\ngboolean device_is_trusted(struct btd_device *device)\n{\n\treturn device->trusted;\n}"
        }
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"Unable to find device object\""
          ],
          "line": 2559
        },
        "resolved": true,
        "details": {
          "function_name": "dbus_error_to_att_ecode",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "1833-1855",
          "snippet": "static uint8_t dbus_error_to_att_ecode(const char *error_name)\n{\n\n\tif (strcmp(error_name, \"org.bluez.Error.Failed\") == 0)\n\t\treturn 0x80;  /* For now return this \"application error\" */\n\n\tif (strcmp(error_name, \"org.bluez.Error.NotSupported\") == 0)\n\t\treturn BT_ATT_ERROR_REQUEST_NOT_SUPPORTED;\n\n\tif (strcmp(error_name, \"org.bluez.Error.NotAuthorized\") == 0)\n\t\treturn BT_ATT_ERROR_AUTHORIZATION;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InvalidValueLength\") == 0)\n\t\treturn BT_ATT_ERROR_INVALID_ATTRIBUTE_VALUE_LEN;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InvalidOffset\") == 0)\n\t\treturn BT_ATT_ERROR_INVALID_OFFSET;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InProgress\") == 0)\n\t\treturn BT_ERROR_ALREADY_IN_PROGRESS;\n\n\treturn 0;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic uint8_t dbus_error_to_att_ecode(const char *error_name)\n{\n\n\tif (strcmp(error_name, \"org.bluez.Error.Failed\") == 0)\n\t\treturn 0x80;  /* For now return this \"application error\" */\n\n\tif (strcmp(error_name, \"org.bluez.Error.NotSupported\") == 0)\n\t\treturn BT_ATT_ERROR_REQUEST_NOT_SUPPORTED;\n\n\tif (strcmp(error_name, \"org.bluez.Error.NotAuthorized\") == 0)\n\t\treturn BT_ATT_ERROR_AUTHORIZATION;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InvalidValueLength\") == 0)\n\t\treturn BT_ATT_ERROR_INVALID_ATTRIBUTE_VALUE_LEN;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InvalidOffset\") == 0)\n\t\treturn BT_ATT_ERROR_INVALID_OFFSET;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InProgress\") == 0)\n\t\treturn BT_ERROR_ALREADY_IN_PROGRESS;\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "att_get_device",
          "args": [
            "att"
          ],
          "line": 2557
        },
        "resolved": true,
        "details": {
          "function_name": "att_get_device",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "881-913",
          "snippet": "static struct btd_device *att_get_device(struct bt_att *att)\n{\n\tGIOChannel *io = NULL;\n\tGError *gerr = NULL;\n\tbdaddr_t src, dst;\n\tuint8_t dst_type;\n\tstruct btd_adapter *adapter;\n\n\tio = g_io_channel_unix_new(bt_att_get_fd(att));\n\tif (!io)\n\t\treturn NULL;\n\n\tbt_io_get(io, &gerr, BT_IO_OPT_SOURCE_BDADDR, &src,\n\t\t\t\t\tBT_IO_OPT_DEST_BDADDR, &dst,\n\t\t\t\t\tBT_IO_OPT_DEST_TYPE, &dst_type,\n\t\t\t\t\tBT_IO_OPT_INVALID);\n\tif (gerr) {\n\t\terror(\"bt_io_get: %s\", gerr->message);\n\t\tg_error_free(gerr);\n\t\tg_io_channel_unref(io);\n\t\treturn NULL;\n\t}\n\n\tg_io_channel_unref(io);\n\n\tadapter = adapter_find(&src);\n\tif (!adapter) {\n\t\terror(\"Unable to find adapter object\");\n\t\treturn NULL;\n\t}\n\n\treturn btd_adapter_find_device(adapter, &dst, dst_type);\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic struct btd_device *att_get_device(struct bt_att *att)\n{\n\tGIOChannel *io = NULL;\n\tGError *gerr = NULL;\n\tbdaddr_t src, dst;\n\tuint8_t dst_type;\n\tstruct btd_adapter *adapter;\n\n\tio = g_io_channel_unix_new(bt_att_get_fd(att));\n\tif (!io)\n\t\treturn NULL;\n\n\tbt_io_get(io, &gerr, BT_IO_OPT_SOURCE_BDADDR, &src,\n\t\t\t\t\tBT_IO_OPT_DEST_BDADDR, &dst,\n\t\t\t\t\tBT_IO_OPT_DEST_TYPE, &dst_type,\n\t\t\t\t\tBT_IO_OPT_INVALID);\n\tif (gerr) {\n\t\terror(\"bt_io_get: %s\", gerr->message);\n\t\tg_error_free(gerr);\n\t\tg_io_channel_unref(io);\n\t\treturn NULL;\n\t}\n\n\tg_io_channel_unref(io);\n\n\tadapter = adapter_find(&src);\n\tif (!adapter) {\n\t\terror(\"Unable to find adapter object\");\n\t\treturn NULL;\n\t}\n\n\treturn btd_adapter_find_device(adapter, &dst, dst_type);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic void desc_write_cb(struct gatt_db_attribute *attrib,\n\t\t\t\t\tunsigned int id, uint16_t offset,\n\t\t\t\t\tconst uint8_t *value, size_t len,\n\t\t\t\t\tuint8_t opcode, struct bt_att *att,\n\t\t\t\t\tvoid *user_data)\n{\n\tstruct external_desc *desc = user_data;\n\tstruct btd_device *device;\n\n\tif (desc->attrib != attrib) {\n\t\terror(\"Read callback called with incorrect attribute\");\n\t\tgoto fail;\n\t}\n\n\tdevice = att_get_device(att);\n\tif (!device) {\n\t\terror(\"Unable to find device object\");\n\t\tgoto fail;\n\t}\n\n\tif (opcode == BT_ATT_OP_PREP_WRITE_REQ) {\n\t\tif (!device_is_trusted(device) && !desc->prep_authorized &&\n\t\t\t\t\t\tdesc->req_prep_authorization)\n\t\t\tsend_write(device, attrib, desc->proxy,\n\t\t\t\t\tdesc->pending_writes, id, value, len,\n\t\t\t\t\toffset, bt_att_get_link_type(att),\n\t\t\t\t\tfalse, true);\n\t\telse\n\t\t\tgatt_db_attribute_write_result(attrib, id, 0);\n\n\t\treturn;\n\t}\n\n\tif (opcode == BT_ATT_OP_EXEC_WRITE_REQ)\n\t\tdesc->prep_authorized = false;\n\n\tif (send_write(device, attrib, desc->proxy, desc->pending_writes, id,\n\t\t\tvalue, len, offset, bt_att_get_link_type(att), false,\n\t\t\tfalse))\n\t\treturn;\n\nfail:\n\tgatt_db_attribute_write_result(attrib, id, BT_ATT_ERROR_UNLIKELY);\n}"
  },
  {
    "function_name": "desc_read_cb",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
    "lines": "2515-2541",
    "snippet": "static void desc_read_cb(struct gatt_db_attribute *attrib,\n\t\t\t\t\tunsigned int id, uint16_t offset,\n\t\t\t\t\tuint8_t opcode, struct bt_att *att,\n\t\t\t\t\tvoid *user_data)\n{\n\tstruct external_desc *desc = user_data;\n\tstruct btd_device *device;\n\n\tif (desc->attrib != attrib) {\n\t\terror(\"Read callback called with incorrect attribute\");\n\t\tgoto fail;\n\t}\n\n\tdevice = att_get_device(att);\n\tif (!device) {\n\t\terror(\"Unable to find device object\");\n\t\tgoto fail;\n\t}\n\n\tif (send_read(device, attrib, desc->proxy, desc->pending_reads, id,\n\t\t\t\t\toffset, bt_att_get_link_type(att)))\n\t\treturn;\n\nfail:\n\tgatt_db_attribute_read_result(attrib, id, BT_ATT_ERROR_UNLIKELY,\n\t\t\t\t\t\t\t\tNULL, 0);\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"dbus-common.h\"",
      "#include \"gatt-database.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "gatt_db_attribute_read_result",
          "args": [
            "attrib",
            "id",
            "BT_ATT_ERROR_UNLIKELY",
            "NULL",
            "0"
          ],
          "line": 2539
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_attribute_read_result",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "1773-1790",
          "snippet": "bool gatt_db_attribute_read_result(struct gatt_db_attribute *attrib,\n\t\t\t\t\tunsigned int id, int err,\n\t\t\t\t\tconst uint8_t *value, size_t length)\n{\n\tstruct pending_read *p;\n\n\tif (!attrib || !id)\n\t\treturn false;\n\n\tp = queue_remove_if(attrib->pending_reads, find_pending,\n\t\t\t\t\t\t\tUINT_TO_PTR(id));\n\tif (!p)\n\t\treturn false;\n\n\tpending_read_result(p, err, value, length);\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nbool gatt_db_attribute_read_result(struct gatt_db_attribute *attrib,\n\t\t\t\t\tunsigned int id, int err,\n\t\t\t\t\tconst uint8_t *value, size_t length)\n{\n\tstruct pending_read *p;\n\n\tif (!attrib || !id)\n\t\treturn false;\n\n\tp = queue_remove_if(attrib->pending_reads, find_pending,\n\t\t\t\t\t\t\tUINT_TO_PTR(id));\n\tif (!p)\n\t\treturn false;\n\n\tpending_read_result(p, err, value, length);\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "send_read",
          "args": [
            "device",
            "attrib",
            "desc->proxy",
            "desc->pending_reads",
            "id",
            "offset",
            "bt_att_get_link_type(att)"
          ],
          "line": 2534
        },
        "resolved": true,
        "details": {
          "function_name": "send_read",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "1985-2005",
          "snippet": "static struct pending_op *send_read(struct btd_device *device,\n\t\t\t\t\tstruct gatt_db_attribute *attrib,\n\t\t\t\t\tGDBusProxy *proxy,\n\t\t\t\t\tstruct queue *owner_queue,\n\t\t\t\t\tunsigned int id,\n\t\t\t\t\tuint16_t offset,\n\t\t\t\t\tuint8_t link_type)\n{\n\tstruct pending_op *op;\n\n\top = pending_read_new(device, owner_queue, attrib, id, offset,\n\t\t\t\t\t\t\tlink_type);\n\n\tif (g_dbus_proxy_method_call(proxy, \"ReadValue\", read_setup_cb,\n\t\t\t\tread_reply_cb, op, pending_op_free) == TRUE)\n\t\treturn op;\n\n\tpending_op_free(op);\n\n\treturn NULL;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic struct pending_op *send_read(struct btd_device *device,\n\t\t\t\t\tstruct gatt_db_attribute *attrib,\n\t\t\t\t\tGDBusProxy *proxy,\n\t\t\t\t\tstruct queue *owner_queue,\n\t\t\t\t\tunsigned int id,\n\t\t\t\t\tuint16_t offset,\n\t\t\t\t\tuint8_t link_type)\n{\n\tstruct pending_op *op;\n\n\top = pending_read_new(device, owner_queue, attrib, id, offset,\n\t\t\t\t\t\t\tlink_type);\n\n\tif (g_dbus_proxy_method_call(proxy, \"ReadValue\", read_setup_cb,\n\t\t\t\tread_reply_cb, op, pending_op_free) == TRUE)\n\t\treturn op;\n\n\tpending_op_free(op);\n\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "bt_att_get_link_type",
          "args": [
            "att"
          ],
          "line": 2535
        },
        "resolved": true,
        "details": {
          "function_name": "bt_att_get_link_type",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/att.c",
          "lines": "1139-1159",
          "snippet": "uint8_t bt_att_get_link_type(struct bt_att *att)\n{\n\tstruct sockaddr_l2 src;\n\tsocklen_t len;\n\n\tif (!att)\n\t\treturn -EINVAL;\n\n\tif (!att->io_on_l2cap)\n\t\treturn BT_ATT_LINK_LOCAL;\n\n\tlen = sizeof(src);\n\tmemset(&src, 0, len);\n\tif (getsockname(att->fd, (void *)&src, &len) < 0)\n\t\treturn -errno;\n\n\tif (src.l2_bdaddr_type == BDADDR_BREDR)\n\t\treturn BT_ATT_LINK_BREDR;\n\n\treturn BT_ATT_LINK_LE;\n}",
          "includes": [
            "#include \"src/shared/crypto.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/l2cap.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/crypto.h\"\n#include \"src/shared/att.h\"\n#include \"lib/uuid.h\"\n#include \"lib/l2cap.h\"\n#include \"lib/bluetooth.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include <errno.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <config.h>\n\nuint8_t bt_att_get_link_type(struct bt_att *att)\n{\n\tstruct sockaddr_l2 src;\n\tsocklen_t len;\n\n\tif (!att)\n\t\treturn -EINVAL;\n\n\tif (!att->io_on_l2cap)\n\t\treturn BT_ATT_LINK_LOCAL;\n\n\tlen = sizeof(src);\n\tmemset(&src, 0, len);\n\tif (getsockname(att->fd, (void *)&src, &len) < 0)\n\t\treturn -errno;\n\n\tif (src.l2_bdaddr_type == BDADDR_BREDR)\n\t\treturn BT_ATT_LINK_BREDR;\n\n\treturn BT_ATT_LINK_LE;\n}"
        }
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"Unable to find device object\""
          ],
          "line": 2530
        },
        "resolved": true,
        "details": {
          "function_name": "dbus_error_to_att_ecode",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "1833-1855",
          "snippet": "static uint8_t dbus_error_to_att_ecode(const char *error_name)\n{\n\n\tif (strcmp(error_name, \"org.bluez.Error.Failed\") == 0)\n\t\treturn 0x80;  /* For now return this \"application error\" */\n\n\tif (strcmp(error_name, \"org.bluez.Error.NotSupported\") == 0)\n\t\treturn BT_ATT_ERROR_REQUEST_NOT_SUPPORTED;\n\n\tif (strcmp(error_name, \"org.bluez.Error.NotAuthorized\") == 0)\n\t\treturn BT_ATT_ERROR_AUTHORIZATION;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InvalidValueLength\") == 0)\n\t\treturn BT_ATT_ERROR_INVALID_ATTRIBUTE_VALUE_LEN;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InvalidOffset\") == 0)\n\t\treturn BT_ATT_ERROR_INVALID_OFFSET;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InProgress\") == 0)\n\t\treturn BT_ERROR_ALREADY_IN_PROGRESS;\n\n\treturn 0;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic uint8_t dbus_error_to_att_ecode(const char *error_name)\n{\n\n\tif (strcmp(error_name, \"org.bluez.Error.Failed\") == 0)\n\t\treturn 0x80;  /* For now return this \"application error\" */\n\n\tif (strcmp(error_name, \"org.bluez.Error.NotSupported\") == 0)\n\t\treturn BT_ATT_ERROR_REQUEST_NOT_SUPPORTED;\n\n\tif (strcmp(error_name, \"org.bluez.Error.NotAuthorized\") == 0)\n\t\treturn BT_ATT_ERROR_AUTHORIZATION;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InvalidValueLength\") == 0)\n\t\treturn BT_ATT_ERROR_INVALID_ATTRIBUTE_VALUE_LEN;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InvalidOffset\") == 0)\n\t\treturn BT_ATT_ERROR_INVALID_OFFSET;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InProgress\") == 0)\n\t\treturn BT_ERROR_ALREADY_IN_PROGRESS;\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "att_get_device",
          "args": [
            "att"
          ],
          "line": 2528
        },
        "resolved": true,
        "details": {
          "function_name": "att_get_device",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "881-913",
          "snippet": "static struct btd_device *att_get_device(struct bt_att *att)\n{\n\tGIOChannel *io = NULL;\n\tGError *gerr = NULL;\n\tbdaddr_t src, dst;\n\tuint8_t dst_type;\n\tstruct btd_adapter *adapter;\n\n\tio = g_io_channel_unix_new(bt_att_get_fd(att));\n\tif (!io)\n\t\treturn NULL;\n\n\tbt_io_get(io, &gerr, BT_IO_OPT_SOURCE_BDADDR, &src,\n\t\t\t\t\tBT_IO_OPT_DEST_BDADDR, &dst,\n\t\t\t\t\tBT_IO_OPT_DEST_TYPE, &dst_type,\n\t\t\t\t\tBT_IO_OPT_INVALID);\n\tif (gerr) {\n\t\terror(\"bt_io_get: %s\", gerr->message);\n\t\tg_error_free(gerr);\n\t\tg_io_channel_unref(io);\n\t\treturn NULL;\n\t}\n\n\tg_io_channel_unref(io);\n\n\tadapter = adapter_find(&src);\n\tif (!adapter) {\n\t\terror(\"Unable to find adapter object\");\n\t\treturn NULL;\n\t}\n\n\treturn btd_adapter_find_device(adapter, &dst, dst_type);\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic struct btd_device *att_get_device(struct bt_att *att)\n{\n\tGIOChannel *io = NULL;\n\tGError *gerr = NULL;\n\tbdaddr_t src, dst;\n\tuint8_t dst_type;\n\tstruct btd_adapter *adapter;\n\n\tio = g_io_channel_unix_new(bt_att_get_fd(att));\n\tif (!io)\n\t\treturn NULL;\n\n\tbt_io_get(io, &gerr, BT_IO_OPT_SOURCE_BDADDR, &src,\n\t\t\t\t\tBT_IO_OPT_DEST_BDADDR, &dst,\n\t\t\t\t\tBT_IO_OPT_DEST_TYPE, &dst_type,\n\t\t\t\t\tBT_IO_OPT_INVALID);\n\tif (gerr) {\n\t\terror(\"bt_io_get: %s\", gerr->message);\n\t\tg_error_free(gerr);\n\t\tg_io_channel_unref(io);\n\t\treturn NULL;\n\t}\n\n\tg_io_channel_unref(io);\n\n\tadapter = adapter_find(&src);\n\tif (!adapter) {\n\t\terror(\"Unable to find adapter object\");\n\t\treturn NULL;\n\t}\n\n\treturn btd_adapter_find_device(adapter, &dst, dst_type);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic void desc_read_cb(struct gatt_db_attribute *attrib,\n\t\t\t\t\tunsigned int id, uint16_t offset,\n\t\t\t\t\tuint8_t opcode, struct bt_att *att,\n\t\t\t\t\tvoid *user_data)\n{\n\tstruct external_desc *desc = user_data;\n\tstruct btd_device *device;\n\n\tif (desc->attrib != attrib) {\n\t\terror(\"Read callback called with incorrect attribute\");\n\t\tgoto fail;\n\t}\n\n\tdevice = att_get_device(att);\n\tif (!device) {\n\t\terror(\"Unable to find device object\");\n\t\tgoto fail;\n\t}\n\n\tif (send_read(device, attrib, desc->proxy, desc->pending_reads, id,\n\t\t\t\t\toffset, bt_att_get_link_type(att)))\n\t\treturn;\n\nfail:\n\tgatt_db_attribute_read_result(attrib, id, BT_ATT_ERROR_UNLIKELY,\n\t\t\t\t\t\t\t\tNULL, 0);\n}"
  },
  {
    "function_name": "database_add_cep",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
    "lines": "2482-2513",
    "snippet": "static bool database_add_cep(struct external_service *service,\n\t\t\t\t\t\tstruct external_chrc *chrc)\n{\n\tstruct gatt_db_attribute *cep;\n\tbt_uuid_t uuid;\n\tuint8_t value[2];\n\n\tif (!chrc->ext_props)\n\t\treturn true;\n\n\tbt_uuid16_create(&uuid, GATT_CHARAC_EXT_PROPER_UUID);\n\tcep = gatt_db_service_add_descriptor(service->attrib, &uuid,\n\t\t\t\t\t\t\tBT_ATT_PERM_READ,\n\t\t\t\t\t\t\tNULL, NULL, NULL);\n\tif (!cep) {\n\t\terror(\"Failed to create CEP entry for characteristic\");\n\t\treturn false;\n\t}\n\n\tmemset(value, 0, sizeof(value));\n\tvalue[0] = chrc->ext_props;\n\n\tif (!gatt_db_attribute_write(cep, 0, value, sizeof(value), 0, NULL,\n\t\t\t\t\t\t\tcep_write_cb, NULL)) {\n\t\tDBG(\"Failed to store CEP value in the database\");\n\t\treturn false;\n\t}\n\n\tDBG(\"Created CEP entry for characteristic\");\n\n\treturn true;\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"dbus-common.h\"",
      "#include \"gatt-database.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"Created CEP entry for characteristic\""
          ],
          "line": 2510
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"Failed to store CEP value in the database\""
          ],
          "line": 2506
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "gatt_db_attribute_write",
          "args": [
            "cep",
            "0",
            "value",
            "sizeof(value)",
            "0",
            "NULL",
            "cep_write_cb",
            "NULL"
          ],
          "line": 2504
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_attribute_write",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "1805-1860",
          "snippet": "bool gatt_db_attribute_write(struct gatt_db_attribute *attrib, uint16_t offset,\n\t\t\t\t\tconst uint8_t *value, size_t len,\n\t\t\t\t\tuint8_t opcode, struct bt_att *att,\n\t\t\t\t\tgatt_db_attribute_write_t func,\n\t\t\t\t\tvoid *user_data)\n{\n\tif (!attrib || !func)\n\t\treturn false;\n\n\tif (attrib->write_func) {\n\t\tstruct pending_write *p;\n\n\t\tp = new0(struct pending_write, 1);\n\t\tp->attrib = attrib;\n\t\tp->id = ++attrib->write_id;\n\t\tp->timeout_id = timeout_add(ATTRIBUTE_TIMEOUT, write_timeout,\n\t\t\t\t\t\t\t\tp, NULL);\n\t\tp->func = func;\n\t\tp->user_data = user_data;\n\n\t\tqueue_push_tail(attrib->pending_writes, p);\n\n\t\tattrib->write_func(attrib, p->id, offset, value, len, opcode,\n\t\t\t\t\t\t\tatt, attrib->user_data);\n\t\treturn true;\n\t}\n\n\t/* Nothing to write just skip */\n\tif (len == 0)\n\t\tgoto done;\n\n\t/* For values stored in db allocate on demand */\n\tif (!attrib->value || offset >= attrib->value_len ||\n\t\t\t\tlen > (unsigned) (attrib->value_len - offset)) {\n\t\tvoid *buf;\n\n\t\tbuf = realloc(attrib->value, len + offset);\n\t\tif (!buf)\n\t\t\treturn false;\n\n\t\tattrib->value = buf;\n\n\t\t/* Init data in the first allocation */\n\t\tif (!attrib->value_len)\n\t\t\tmemset(attrib->value, 0, offset);\n\n\t\tattrib->value_len = len + offset;\n\t}\n\n\tmemcpy(&attrib->value[offset], value, len);\n\ndone:\n\tfunc(attrib, 0, user_data);\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define ATTRIBUTE_TIMEOUT 5000"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\n#define ATTRIBUTE_TIMEOUT 5000\n\nbool gatt_db_attribute_write(struct gatt_db_attribute *attrib, uint16_t offset,\n\t\t\t\t\tconst uint8_t *value, size_t len,\n\t\t\t\t\tuint8_t opcode, struct bt_att *att,\n\t\t\t\t\tgatt_db_attribute_write_t func,\n\t\t\t\t\tvoid *user_data)\n{\n\tif (!attrib || !func)\n\t\treturn false;\n\n\tif (attrib->write_func) {\n\t\tstruct pending_write *p;\n\n\t\tp = new0(struct pending_write, 1);\n\t\tp->attrib = attrib;\n\t\tp->id = ++attrib->write_id;\n\t\tp->timeout_id = timeout_add(ATTRIBUTE_TIMEOUT, write_timeout,\n\t\t\t\t\t\t\t\tp, NULL);\n\t\tp->func = func;\n\t\tp->user_data = user_data;\n\n\t\tqueue_push_tail(attrib->pending_writes, p);\n\n\t\tattrib->write_func(attrib, p->id, offset, value, len, opcode,\n\t\t\t\t\t\t\tatt, attrib->user_data);\n\t\treturn true;\n\t}\n\n\t/* Nothing to write just skip */\n\tif (len == 0)\n\t\tgoto done;\n\n\t/* For values stored in db allocate on demand */\n\tif (!attrib->value || offset >= attrib->value_len ||\n\t\t\t\tlen > (unsigned) (attrib->value_len - offset)) {\n\t\tvoid *buf;\n\n\t\tbuf = realloc(attrib->value, len + offset);\n\t\tif (!buf)\n\t\t\treturn false;\n\n\t\tattrib->value = buf;\n\n\t\t/* Init data in the first allocation */\n\t\tif (!attrib->value_len)\n\t\t\tmemset(attrib->value, 0, offset);\n\n\t\tattrib->value_len = len + offset;\n\t}\n\n\tmemcpy(&attrib->value[offset], value, len);\n\ndone:\n\tfunc(attrib, 0, user_data);\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "memset",
          "args": [
            "value",
            "0",
            "sizeof(value)"
          ],
          "line": 2501
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"Failed to create CEP entry for characteristic\""
          ],
          "line": 2497
        },
        "resolved": true,
        "details": {
          "function_name": "dbus_error_to_att_ecode",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "1833-1855",
          "snippet": "static uint8_t dbus_error_to_att_ecode(const char *error_name)\n{\n\n\tif (strcmp(error_name, \"org.bluez.Error.Failed\") == 0)\n\t\treturn 0x80;  /* For now return this \"application error\" */\n\n\tif (strcmp(error_name, \"org.bluez.Error.NotSupported\") == 0)\n\t\treturn BT_ATT_ERROR_REQUEST_NOT_SUPPORTED;\n\n\tif (strcmp(error_name, \"org.bluez.Error.NotAuthorized\") == 0)\n\t\treturn BT_ATT_ERROR_AUTHORIZATION;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InvalidValueLength\") == 0)\n\t\treturn BT_ATT_ERROR_INVALID_ATTRIBUTE_VALUE_LEN;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InvalidOffset\") == 0)\n\t\treturn BT_ATT_ERROR_INVALID_OFFSET;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InProgress\") == 0)\n\t\treturn BT_ERROR_ALREADY_IN_PROGRESS;\n\n\treturn 0;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic uint8_t dbus_error_to_att_ecode(const char *error_name)\n{\n\n\tif (strcmp(error_name, \"org.bluez.Error.Failed\") == 0)\n\t\treturn 0x80;  /* For now return this \"application error\" */\n\n\tif (strcmp(error_name, \"org.bluez.Error.NotSupported\") == 0)\n\t\treturn BT_ATT_ERROR_REQUEST_NOT_SUPPORTED;\n\n\tif (strcmp(error_name, \"org.bluez.Error.NotAuthorized\") == 0)\n\t\treturn BT_ATT_ERROR_AUTHORIZATION;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InvalidValueLength\") == 0)\n\t\treturn BT_ATT_ERROR_INVALID_ATTRIBUTE_VALUE_LEN;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InvalidOffset\") == 0)\n\t\treturn BT_ATT_ERROR_INVALID_OFFSET;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InProgress\") == 0)\n\t\treturn BT_ERROR_ALREADY_IN_PROGRESS;\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "gatt_db_service_add_descriptor",
          "args": [
            "service->attrib",
            "&uuid",
            "BT_ATT_PERM_READ",
            "NULL",
            "NULL",
            "NULL"
          ],
          "line": 2493
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_service_add_descriptor",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "867-881",
          "snippet": "struct gatt_db_attribute *\ngatt_db_service_add_descriptor(struct gatt_db_attribute *attrib,\n\t\t\t\t\tconst bt_uuid_t *uuid,\n\t\t\t\t\tuint32_t permissions,\n\t\t\t\t\tgatt_db_read_t read_func,\n\t\t\t\t\tgatt_db_write_t write_func,\n\t\t\t\t\tvoid *user_data)\n{\n\tif (!attrib)\n\t\treturn NULL;\n\n\treturn service_insert_descriptor(attrib->service, 0, uuid,\n\t\t\t\t\tpermissions, read_func, write_func,\n\t\t\t\t\tuser_data);\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstruct gatt_db_attribute *\ngatt_db_service_add_descriptor(struct gatt_db_attribute *attrib,\n\t\t\t\t\tconst bt_uuid_t *uuid,\n\t\t\t\t\tuint32_t permissions,\n\t\t\t\t\tgatt_db_read_t read_func,\n\t\t\t\t\tgatt_db_write_t write_func,\n\t\t\t\t\tvoid *user_data)\n{\n\tif (!attrib)\n\t\treturn NULL;\n\n\treturn service_insert_descriptor(attrib->service, 0, uuid,\n\t\t\t\t\tpermissions, read_func, write_func,\n\t\t\t\t\tuser_data);\n}"
        }
      },
      {
        "call_info": {
          "callee": "bt_uuid16_create",
          "args": [
            "&uuid",
            "GATT_CHARAC_EXT_PROPER_UUID"
          ],
          "line": 2492
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic bool database_add_cep(struct external_service *service,\n\t\t\t\t\t\tstruct external_chrc *chrc)\n{\n\tstruct gatt_db_attribute *cep;\n\tbt_uuid_t uuid;\n\tuint8_t value[2];\n\n\tif (!chrc->ext_props)\n\t\treturn true;\n\n\tbt_uuid16_create(&uuid, GATT_CHARAC_EXT_PROPER_UUID);\n\tcep = gatt_db_service_add_descriptor(service->attrib, &uuid,\n\t\t\t\t\t\t\tBT_ATT_PERM_READ,\n\t\t\t\t\t\t\tNULL, NULL, NULL);\n\tif (!cep) {\n\t\terror(\"Failed to create CEP entry for characteristic\");\n\t\treturn false;\n\t}\n\n\tmemset(value, 0, sizeof(value));\n\tvalue[0] = chrc->ext_props;\n\n\tif (!gatt_db_attribute_write(cep, 0, value, sizeof(value), 0, NULL,\n\t\t\t\t\t\t\tcep_write_cb, NULL)) {\n\t\tDBG(\"Failed to store CEP value in the database\");\n\t\treturn false;\n\t}\n\n\tDBG(\"Created CEP entry for characteristic\");\n\n\treturn true;\n}"
  },
  {
    "function_name": "cep_write_cb",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
    "lines": "2473-2480",
    "snippet": "static void cep_write_cb(struct gatt_db_attribute *attrib, int err,\n\t\t\t\t\t\t\t\tvoid *user_data)\n{\n\tif (err)\n\t\tDBG(\"Failed to store CEP value in the database\");\n\telse\n\t\tDBG(\"Stored CEP value in the database\");\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"dbus-common.h\"",
      "#include \"gatt-database.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"Stored CEP value in the database\""
          ],
          "line": 2479
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"Failed to store CEP value in the database\""
          ],
          "line": 2477
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic void cep_write_cb(struct gatt_db_attribute *attrib, int err,\n\t\t\t\t\t\t\t\tvoid *user_data)\n{\n\tif (err)\n\t\tDBG(\"Failed to store CEP value in the database\");\n\telse\n\t\tDBG(\"Stored CEP value in the database\");\n}"
  },
  {
    "function_name": "database_add_ccc",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
    "lines": "2448-2471",
    "snippet": "static bool database_add_ccc(struct external_service *service,\n\t\t\t\t\t\tstruct external_chrc *chrc)\n{\n\tif (!(chrc->props & BT_GATT_CHRC_PROP_NOTIFY) &&\n\t\t\t\t!(chrc->props & BT_GATT_CHRC_PROP_INDICATE))\n\t\treturn true;\n\n\tchrc->ccc = service_add_ccc(service->attrib, service->app->database,\n\t\t\t\t\t\tccc_write_cb, chrc, NULL);\n\tif (!chrc->ccc) {\n\t\terror(\"Failed to create CCC entry for characteristic\");\n\t\treturn false;\n\t}\n\n\tif (g_dbus_proxy_set_property_watch(chrc->proxy, property_changed_cb,\n\t\t\t\t\t\t\tchrc) == FALSE) {\n\t\terror(\"Failed to set up property watch for characteristic\");\n\t\treturn false;\n\t}\n\n\tDBG(\"Created CCC entry for characteristic\");\n\n\treturn true;\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"dbus-common.h\"",
      "#include \"gatt-database.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"Created CCC entry for characteristic\""
          ],
          "line": 2468
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"Failed to set up property watch for characteristic\""
          ],
          "line": 2464
        },
        "resolved": true,
        "details": {
          "function_name": "dbus_error_to_att_ecode",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "1833-1855",
          "snippet": "static uint8_t dbus_error_to_att_ecode(const char *error_name)\n{\n\n\tif (strcmp(error_name, \"org.bluez.Error.Failed\") == 0)\n\t\treturn 0x80;  /* For now return this \"application error\" */\n\n\tif (strcmp(error_name, \"org.bluez.Error.NotSupported\") == 0)\n\t\treturn BT_ATT_ERROR_REQUEST_NOT_SUPPORTED;\n\n\tif (strcmp(error_name, \"org.bluez.Error.NotAuthorized\") == 0)\n\t\treturn BT_ATT_ERROR_AUTHORIZATION;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InvalidValueLength\") == 0)\n\t\treturn BT_ATT_ERROR_INVALID_ATTRIBUTE_VALUE_LEN;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InvalidOffset\") == 0)\n\t\treturn BT_ATT_ERROR_INVALID_OFFSET;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InProgress\") == 0)\n\t\treturn BT_ERROR_ALREADY_IN_PROGRESS;\n\n\treturn 0;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic uint8_t dbus_error_to_att_ecode(const char *error_name)\n{\n\n\tif (strcmp(error_name, \"org.bluez.Error.Failed\") == 0)\n\t\treturn 0x80;  /* For now return this \"application error\" */\n\n\tif (strcmp(error_name, \"org.bluez.Error.NotSupported\") == 0)\n\t\treturn BT_ATT_ERROR_REQUEST_NOT_SUPPORTED;\n\n\tif (strcmp(error_name, \"org.bluez.Error.NotAuthorized\") == 0)\n\t\treturn BT_ATT_ERROR_AUTHORIZATION;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InvalidValueLength\") == 0)\n\t\treturn BT_ATT_ERROR_INVALID_ATTRIBUTE_VALUE_LEN;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InvalidOffset\") == 0)\n\t\treturn BT_ATT_ERROR_INVALID_OFFSET;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InProgress\") == 0)\n\t\treturn BT_ERROR_ALREADY_IN_PROGRESS;\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_dbus_proxy_set_property_watch",
          "args": [
            "chrc->proxy",
            "property_changed_cb",
            "chrc"
          ],
          "line": 2462
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "service_add_ccc",
          "args": [
            "service->attrib",
            "service->app->database",
            "ccc_write_cb",
            "chrc",
            "NULL"
          ],
          "line": 2455
        },
        "resolved": true,
        "details": {
          "function_name": "service_add_ccc",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "1018-1049",
          "snippet": "static struct gatt_db_attribute *\nservice_add_ccc(struct gatt_db_attribute *service,\n\t\t\t\tstruct btd_gatt_database *database,\n\t\t\t\tbtd_gatt_database_ccc_write_t write_callback,\n\t\t\t\tvoid *user_data,\n\t\t\t\tbtd_gatt_database_destroy_t destroy)\n{\n\tstruct gatt_db_attribute *ccc;\n\tstruct ccc_cb_data *ccc_cb;\n\tbt_uuid_t uuid;\n\n\tccc_cb = new0(struct ccc_cb_data, 1);\n\n\tbt_uuid16_create(&uuid, GATT_CLIENT_CHARAC_CFG_UUID);\n\tccc = gatt_db_service_add_descriptor(service, &uuid,\n\t\t\t\tBT_ATT_PERM_READ | BT_ATT_PERM_WRITE,\n\t\t\t\tgatt_ccc_read_cb, gatt_ccc_write_cb, database);\n\tif (!ccc) {\n\t\terror(\"Failed to create CCC entry in database\");\n\t\tfree(ccc_cb);\n\t\treturn NULL;\n\t}\n\n\tccc_cb->handle = gatt_db_attribute_get_handle(ccc);\n\tccc_cb->callback = write_callback;\n\tccc_cb->destroy = destroy;\n\tccc_cb->user_data = user_data;\n\n\tqueue_push_tail(database->ccc_callbacks, ccc_cb);\n\n\treturn ccc;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic struct gatt_db_attribute *\nservice_add_ccc(struct gatt_db_attribute *service,\n\t\t\t\tstruct btd_gatt_database *database,\n\t\t\t\tbtd_gatt_database_ccc_write_t write_callback,\n\t\t\t\tvoid *user_data,\n\t\t\t\tbtd_gatt_database_destroy_t destroy)\n{\n\tstruct gatt_db_attribute *ccc;\n\tstruct ccc_cb_data *ccc_cb;\n\tbt_uuid_t uuid;\n\n\tccc_cb = new0(struct ccc_cb_data, 1);\n\n\tbt_uuid16_create(&uuid, GATT_CLIENT_CHARAC_CFG_UUID);\n\tccc = gatt_db_service_add_descriptor(service, &uuid,\n\t\t\t\tBT_ATT_PERM_READ | BT_ATT_PERM_WRITE,\n\t\t\t\tgatt_ccc_read_cb, gatt_ccc_write_cb, database);\n\tif (!ccc) {\n\t\terror(\"Failed to create CCC entry in database\");\n\t\tfree(ccc_cb);\n\t\treturn NULL;\n\t}\n\n\tccc_cb->handle = gatt_db_attribute_get_handle(ccc);\n\tccc_cb->callback = write_callback;\n\tccc_cb->destroy = destroy;\n\tccc_cb->user_data = user_data;\n\n\tqueue_push_tail(database->ccc_callbacks, ccc_cb);\n\n\treturn ccc;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic bool database_add_ccc(struct external_service *service,\n\t\t\t\t\t\tstruct external_chrc *chrc)\n{\n\tif (!(chrc->props & BT_GATT_CHRC_PROP_NOTIFY) &&\n\t\t\t\t!(chrc->props & BT_GATT_CHRC_PROP_INDICATE))\n\t\treturn true;\n\n\tchrc->ccc = service_add_ccc(service->attrib, service->app->database,\n\t\t\t\t\t\tccc_write_cb, chrc, NULL);\n\tif (!chrc->ccc) {\n\t\terror(\"Failed to create CCC entry for characteristic\");\n\t\treturn false;\n\t}\n\n\tif (g_dbus_proxy_set_property_watch(chrc->proxy, property_changed_cb,\n\t\t\t\t\t\t\tchrc) == FALSE) {\n\t\terror(\"Failed to set up property watch for characteristic\");\n\t\treturn false;\n\t}\n\n\tDBG(\"Created CCC entry for characteristic\");\n\n\treturn true;\n}"
  },
  {
    "function_name": "property_changed_cb",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
    "lines": "2412-2446",
    "snippet": "static void property_changed_cb(GDBusProxy *proxy, const char *name,\n\t\t\t\t\tDBusMessageIter *iter, void *user_data)\n{\n\tstruct external_chrc *chrc = user_data;\n\tDBusMessageIter array;\n\tuint8_t *value = NULL;\n\tint len = 0;\n\n\tif (strcmp(name, \"Value\"))\n\t\treturn;\n\n\tif (dbus_message_iter_get_arg_type(iter) != DBUS_TYPE_ARRAY) {\n\t\tDBG(\"Malformed \\\"Value\\\" property received\");\n\t\treturn;\n\t}\n\n\tdbus_message_iter_recurse(iter, &array);\n\tdbus_message_iter_get_fixed_array(&array, &value, &len);\n\n\tif (len < 0) {\n\t\tDBG(\"Malformed \\\"Value\\\" property received\");\n\t\treturn;\n\t}\n\n\t/* Truncate the value if it's too large */\n\tlen = MIN(BT_ATT_MAX_VALUE_LEN, len);\n\tvalue = len ? value : NULL;\n\n\tsend_notification_to_devices(chrc->service->app->database,\n\t\t\t\tgatt_db_attribute_get_handle(chrc->attrib),\n\t\t\t\tvalue, len,\n\t\t\t\tgatt_db_attribute_get_handle(chrc->ccc),\n\t\t\t\tchrc->props & BT_GATT_CHRC_PROP_INDICATE ?\n\t\t\t\tconf_cb : NULL, proxy);\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"dbus-common.h\"",
      "#include \"gatt-database.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "send_notification_to_devices",
          "args": [
            "chrc->service->app->database",
            "gatt_db_attribute_get_handle(chrc->attrib)",
            "value",
            "len",
            "gatt_db_attribute_get_handle(chrc->ccc)",
            "chrc->props & BT_GATT_CHRC_PROP_INDICATE ?\n\t\t\t\tconf_cb : NULL",
            "proxy"
          ],
          "line": 2440
        },
        "resolved": true,
        "details": {
          "function_name": "send_notification_to_devices",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "1181-1201",
          "snippet": "static void send_notification_to_devices(struct btd_gatt_database *database,\n\t\t\t\t\tuint16_t handle, uint8_t *value,\n\t\t\t\t\tuint16_t len, uint16_t ccc_handle,\n\t\t\t\t\tbt_gatt_server_conf_func_t conf,\n\t\t\t\t\tvoid *user_data)\n{\n\tstruct notify notify;\n\n\tmemset(&notify, 0, sizeof(notify));\n\n\tnotify.database = database;\n\tnotify.handle = handle;\n\tnotify.ccc_handle = ccc_handle;\n\tnotify.value = value;\n\tnotify.len = len;\n\tnotify.conf = conf;\n\tnotify.user_data = user_data;\n\n\tqueue_foreach(database->device_states, send_notification_to_device,\n\t\t\t\t\t\t\t\t&notify);\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic void send_notification_to_devices(struct btd_gatt_database *database,\n\t\t\t\t\tuint16_t handle, uint8_t *value,\n\t\t\t\t\tuint16_t len, uint16_t ccc_handle,\n\t\t\t\t\tbt_gatt_server_conf_func_t conf,\n\t\t\t\t\tvoid *user_data)\n{\n\tstruct notify notify;\n\n\tmemset(&notify, 0, sizeof(notify));\n\n\tnotify.database = database;\n\tnotify.handle = handle;\n\tnotify.ccc_handle = ccc_handle;\n\tnotify.value = value;\n\tnotify.len = len;\n\tnotify.conf = conf;\n\tnotify.user_data = user_data;\n\n\tqueue_foreach(database->device_states, send_notification_to_device,\n\t\t\t\t\t\t\t\t&notify);\n}"
        }
      },
      {
        "call_info": {
          "callee": "gatt_db_attribute_get_handle",
          "args": [
            "chrc->ccc"
          ],
          "line": 2443
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_attribute_get_handle",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "1482-1488",
          "snippet": "uint16_t gatt_db_attribute_get_handle(const struct gatt_db_attribute *attrib)\n{\n\tif (!attrib)\n\t\treturn 0;\n\n\treturn attrib->handle;\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nuint16_t gatt_db_attribute_get_handle(const struct gatt_db_attribute *attrib)\n{\n\tif (!attrib)\n\t\treturn 0;\n\n\treturn attrib->handle;\n}"
        }
      },
      {
        "call_info": {
          "callee": "MIN",
          "args": [
            "BT_ATT_MAX_VALUE_LEN",
            "len"
          ],
          "line": 2437
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"Malformed \\\"Value\\\" property received\""
          ],
          "line": 2432
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_get_fixed_array",
          "args": [
            "&array",
            "&value",
            "&len"
          ],
          "line": 2429
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_recurse",
          "args": [
            "iter",
            "&array"
          ],
          "line": 2428
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"Malformed \\\"Value\\\" property received\""
          ],
          "line": 2424
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_get_arg_type",
          "args": [
            "iter"
          ],
          "line": 2423
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "name",
            "\"Value\""
          ],
          "line": 2420
        },
        "resolved": true,
        "details": {
          "function_name": "g_strcmp",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "1927-1930",
          "snippet": "static gint g_strcmp(gconstpointer a, gconstpointer b)\n{\n\treturn strcmp(a, b);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic gint g_strcmp(gconstpointer a, gconstpointer b)\n{\n\treturn strcmp(a, b);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic void property_changed_cb(GDBusProxy *proxy, const char *name,\n\t\t\t\t\tDBusMessageIter *iter, void *user_data)\n{\n\tstruct external_chrc *chrc = user_data;\n\tDBusMessageIter array;\n\tuint8_t *value = NULL;\n\tint len = 0;\n\n\tif (strcmp(name, \"Value\"))\n\t\treturn;\n\n\tif (dbus_message_iter_get_arg_type(iter) != DBUS_TYPE_ARRAY) {\n\t\tDBG(\"Malformed \\\"Value\\\" property received\");\n\t\treturn;\n\t}\n\n\tdbus_message_iter_recurse(iter, &array);\n\tdbus_message_iter_get_fixed_array(&array, &value, &len);\n\n\tif (len < 0) {\n\t\tDBG(\"Malformed \\\"Value\\\" property received\");\n\t\treturn;\n\t}\n\n\t/* Truncate the value if it's too large */\n\tlen = MIN(BT_ATT_MAX_VALUE_LEN, len);\n\tvalue = len ? value : NULL;\n\n\tsend_notification_to_devices(chrc->service->app->database,\n\t\t\t\tgatt_db_attribute_get_handle(chrc->attrib),\n\t\t\t\tvalue, len,\n\t\t\t\tgatt_db_attribute_get_handle(chrc->ccc),\n\t\t\t\tchrc->props & BT_GATT_CHRC_PROP_INDICATE ?\n\t\t\t\tconf_cb : NULL, proxy);\n}"
  },
  {
    "function_name": "ccc_write_cb",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
    "lines": "2336-2410",
    "snippet": "static uint8_t ccc_write_cb(struct pending_op *op, void *user_data)\n{\n\tstruct external_chrc *chrc = user_data;\n\tDBusMessageIter iter;\n\tuint16_t value;\n\n\tvalue = op ? PTR_TO_UINT(op->data.iov_base) : 0;\n\n\tDBG(\"External CCC write received with value: 0x%04x\", value);\n\n\t/* Notifications/indications disabled */\n\tif (!value) {\n\t\tif (!chrc->ntfy_cnt)\n\t\t\tgoto done;\n\n\t\tif (__sync_sub_and_fetch(&chrc->ntfy_cnt, 1))\n\t\t\tgoto done;\n\n\t\tif (chrc->notify_io) {\n\t\t\tio_destroy(chrc->notify_io);\n\t\t\tchrc->notify_io = NULL;\n\t\t\tgoto done;\n\t\t}\n\n\t\t/*\n\t\t * Send request to stop notifying. This is best-effort\n\t\t * operation, so simply ignore the return the value.\n\t\t */\n\t\tg_dbus_proxy_method_call(chrc->proxy, \"StopNotify\", NULL,\n\t\t\t\t\t\t\tNULL, NULL, NULL);\n\t\tgoto done;\n\t}\n\n\tif (chrc->ntfy_cnt == UINT_MAX)\n\t\t/* Maximum number of per-device CCC descriptors configured */\n\t\treturn BT_ATT_ERROR_INSUFFICIENT_RESOURCES;\n\n\t/* Don't support undefined CCC values yet */\n\tif (value > 2 ||\n\t\t(value == 1 && !(chrc->props & BT_GATT_CHRC_PROP_NOTIFY)) ||\n\t\t(value == 2 && !(chrc->props & BT_GATT_CHRC_PROP_INDICATE)))\n\t\treturn BT_ERROR_CCC_IMPROPERLY_CONFIGURED;\n\n\tif (chrc->notify_io) {\n\t\t__sync_fetch_and_add(&chrc->ntfy_cnt, 1);\n\t\tgoto done;\n\t}\n\n\t/* Make use of AcquireNotify if supported */\n\tif (g_dbus_proxy_get_property(chrc->proxy, \"NotifyAcquired\", &iter)) {\n\t\top->data.iov_base = (void *) chrc;\n\t\top->data.iov_len = sizeof(chrc);\n\t\tif (g_dbus_proxy_method_call(chrc->proxy, \"AcquireNotify\",\n\t\t\t\t\t\tacquire_notify_setup,\n\t\t\t\t\t\tacquire_notify_reply,\n\t\t\t\t\t\top, pending_op_free))\n\t\t\treturn 0;\n\t}\n\n\t/*\n\t * Always call StartNotify for an incoming enable and ignore the return\n\t * value for now.\n\t */\n\tif (g_dbus_proxy_method_call(chrc->proxy, \"StartNotify\", NULL, NULL,\n\t\t\t\t\t\tNULL, NULL) == FALSE)\n\t\treturn BT_ATT_ERROR_UNLIKELY;\n\n\t__sync_fetch_and_add(&chrc->ntfy_cnt, 1);\n\ndone:\n\tif (op)\n\t\tpending_op_free(op);\n\n\treturn 0;\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"dbus-common.h\"",
      "#include \"gatt-database.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "pending_op_free",
          "args": [
            "op"
          ],
          "line": 2407
        },
        "resolved": true,
        "details": {
          "function_name": "pending_op_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "941-949",
          "snippet": "static void pending_op_free(void *data)\n{\n\tstruct pending_op *op = data;\n\n\tif (op->owner_queue)\n\t\tqueue_remove(op->owner_queue, op);\n\n\tfree(op);\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic void pending_op_free(void *data)\n{\n\tstruct pending_op *op = data;\n\n\tif (op->owner_queue)\n\t\tqueue_remove(op->owner_queue, op);\n\n\tfree(op);\n}"
        }
      },
      {
        "call_info": {
          "callee": "__sync_fetch_and_add",
          "args": [
            "&chrc->ntfy_cnt",
            "1"
          ],
          "line": 2403
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_dbus_proxy_method_call",
          "args": [
            "chrc->proxy",
            "\"StartNotify\"",
            "NULL",
            "NULL",
            "NULL",
            "NULL"
          ],
          "line": 2399
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_dbus_proxy_method_call",
          "args": [
            "chrc->proxy",
            "\"AcquireNotify\"",
            "acquire_notify_setup",
            "acquire_notify_reply",
            "op",
            "pending_op_free"
          ],
          "line": 2388
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_dbus_proxy_get_property",
          "args": [
            "chrc->proxy",
            "\"NotifyAcquired\"",
            "&iter"
          ],
          "line": 2385
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "__sync_fetch_and_add",
          "args": [
            "&chrc->ntfy_cnt",
            "1"
          ],
          "line": 2380
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_dbus_proxy_method_call",
          "args": [
            "chrc->proxy",
            "\"StopNotify\"",
            "NULL",
            "NULL",
            "NULL",
            "NULL"
          ],
          "line": 2364
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "io_destroy",
          "args": [
            "chrc->notify_io"
          ],
          "line": 2355
        },
        "resolved": true,
        "details": {
          "function_name": "notify_io_destroy",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
          "lines": "1457-1463",
          "snippet": "static void notify_io_destroy(void *data)\n{\n\tstruct notify_client *client = data;\n\n\tif (queue_remove(client->chrc->notify_clients, client))\n\t\tnotify_client_unref(client);\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"gatt-client.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void notify_io_destroy(void *data)\n{\n\tstruct notify_client *client = data;\n\n\tif (queue_remove(client->chrc->notify_clients, client))\n\t\tnotify_client_unref(client);\n}"
        }
      },
      {
        "call_info": {
          "callee": "__sync_sub_and_fetch",
          "args": [
            "&chrc->ntfy_cnt",
            "1"
          ],
          "line": 2351
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"External CCC write received with value: 0x%04x\"",
            "value"
          ],
          "line": 2344
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "PTR_TO_UINT",
          "args": [
            "op->data.iov_base"
          ],
          "line": 2342
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic uint8_t ccc_write_cb(struct pending_op *op, void *user_data)\n{\n\tstruct external_chrc *chrc = user_data;\n\tDBusMessageIter iter;\n\tuint16_t value;\n\n\tvalue = op ? PTR_TO_UINT(op->data.iov_base) : 0;\n\n\tDBG(\"External CCC write received with value: 0x%04x\", value);\n\n\t/* Notifications/indications disabled */\n\tif (!value) {\n\t\tif (!chrc->ntfy_cnt)\n\t\t\tgoto done;\n\n\t\tif (__sync_sub_and_fetch(&chrc->ntfy_cnt, 1))\n\t\t\tgoto done;\n\n\t\tif (chrc->notify_io) {\n\t\t\tio_destroy(chrc->notify_io);\n\t\t\tchrc->notify_io = NULL;\n\t\t\tgoto done;\n\t\t}\n\n\t\t/*\n\t\t * Send request to stop notifying. This is best-effort\n\t\t * operation, so simply ignore the return the value.\n\t\t */\n\t\tg_dbus_proxy_method_call(chrc->proxy, \"StopNotify\", NULL,\n\t\t\t\t\t\t\tNULL, NULL, NULL);\n\t\tgoto done;\n\t}\n\n\tif (chrc->ntfy_cnt == UINT_MAX)\n\t\t/* Maximum number of per-device CCC descriptors configured */\n\t\treturn BT_ATT_ERROR_INSUFFICIENT_RESOURCES;\n\n\t/* Don't support undefined CCC values yet */\n\tif (value > 2 ||\n\t\t(value == 1 && !(chrc->props & BT_GATT_CHRC_PROP_NOTIFY)) ||\n\t\t(value == 2 && !(chrc->props & BT_GATT_CHRC_PROP_INDICATE)))\n\t\treturn BT_ERROR_CCC_IMPROPERLY_CONFIGURED;\n\n\tif (chrc->notify_io) {\n\t\t__sync_fetch_and_add(&chrc->ntfy_cnt, 1);\n\t\tgoto done;\n\t}\n\n\t/* Make use of AcquireNotify if supported */\n\tif (g_dbus_proxy_get_property(chrc->proxy, \"NotifyAcquired\", &iter)) {\n\t\top->data.iov_base = (void *) chrc;\n\t\top->data.iov_len = sizeof(chrc);\n\t\tif (g_dbus_proxy_method_call(chrc->proxy, \"AcquireNotify\",\n\t\t\t\t\t\tacquire_notify_setup,\n\t\t\t\t\t\tacquire_notify_reply,\n\t\t\t\t\t\top, pending_op_free))\n\t\t\treturn 0;\n\t}\n\n\t/*\n\t * Always call StartNotify for an incoming enable and ignore the return\n\t * value for now.\n\t */\n\tif (g_dbus_proxy_method_call(chrc->proxy, \"StartNotify\", NULL, NULL,\n\t\t\t\t\t\tNULL, NULL) == FALSE)\n\t\treturn BT_ATT_ERROR_UNLIKELY;\n\n\t__sync_fetch_and_add(&chrc->ntfy_cnt, 1);\n\ndone:\n\tif (op)\n\t\tpending_op_free(op);\n\n\treturn 0;\n}"
  },
  {
    "function_name": "acquire_notify_setup",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
    "lines": "2319-2334",
    "snippet": "static void acquire_notify_setup(DBusMessageIter *iter, void *user_data)\n{\n\tDBusMessageIter dict;\n\tstruct pending_op *op = user_data;\n\n\tdbus_message_iter_open_container(iter, DBUS_TYPE_ARRAY,\n\t\t\t\t\tDBUS_DICT_ENTRY_BEGIN_CHAR_AS_STRING\n\t\t\t\t\tDBUS_TYPE_STRING_AS_STRING\n\t\t\t\t\tDBUS_TYPE_VARIANT_AS_STRING\n\t\t\t\t\tDBUS_DICT_ENTRY_END_CHAR_AS_STRING,\n\t\t\t\t\t&dict);\n\n\tappend_options(&dict, op);\n\n\tdbus_message_iter_close_container(iter, &dict);\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"dbus-common.h\"",
      "#include \"gatt-database.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "dbus_message_iter_close_container",
          "args": [
            "iter",
            "&dict"
          ],
          "line": 2333
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "append_options",
          "args": [
            "&dict",
            "op"
          ],
          "line": 2331
        },
        "resolved": true,
        "details": {
          "function_name": "append_options",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "1932-1966",
          "snippet": "static void append_options(DBusMessageIter *iter, void *user_data)\n{\n\tstruct pending_op *op = user_data;\n\tconst char *path = device_get_path(op->device);\n\tstruct bt_gatt_server *server;\n\tconst char *link;\n\tuint16_t mtu;\n\n\tswitch (op->link_type) {\n\tcase BT_ATT_LINK_BREDR:\n\t\tlink = \"BR/EDR\";\n\t\tbreak;\n\tcase BT_ATT_LINK_LE:\n\t\tlink = \"LE\";\n\t\tbreak;\n\tdefault:\n\t\tlink = NULL;\n\t\tbreak;\n\t}\n\n\tdict_append_entry(iter, \"device\", DBUS_TYPE_OBJECT_PATH, &path);\n\tif (op->offset)\n\t\tdict_append_entry(iter, \"offset\", DBUS_TYPE_UINT16,\n\t\t\t\t\t\t\t&op->offset);\n\tif (link)\n\t\tdict_append_entry(iter, \"link\", DBUS_TYPE_STRING, &link);\n\tif (op->prep_authorize)\n\t\tdict_append_entry(iter, \"prepare-authorize\", DBUS_TYPE_BOOLEAN,\n\t\t\t\t\t\t\t&op->prep_authorize);\n\n\tserver = btd_device_get_gatt_server(op->device);\n\tmtu = bt_gatt_server_get_mtu(server);\n\n\tdict_append_entry(iter, \"mtu\", DBUS_TYPE_UINT16, &mtu);\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic void append_options(DBusMessageIter *iter, void *user_data)\n{\n\tstruct pending_op *op = user_data;\n\tconst char *path = device_get_path(op->device);\n\tstruct bt_gatt_server *server;\n\tconst char *link;\n\tuint16_t mtu;\n\n\tswitch (op->link_type) {\n\tcase BT_ATT_LINK_BREDR:\n\t\tlink = \"BR/EDR\";\n\t\tbreak;\n\tcase BT_ATT_LINK_LE:\n\t\tlink = \"LE\";\n\t\tbreak;\n\tdefault:\n\t\tlink = NULL;\n\t\tbreak;\n\t}\n\n\tdict_append_entry(iter, \"device\", DBUS_TYPE_OBJECT_PATH, &path);\n\tif (op->offset)\n\t\tdict_append_entry(iter, \"offset\", DBUS_TYPE_UINT16,\n\t\t\t\t\t\t\t&op->offset);\n\tif (link)\n\t\tdict_append_entry(iter, \"link\", DBUS_TYPE_STRING, &link);\n\tif (op->prep_authorize)\n\t\tdict_append_entry(iter, \"prepare-authorize\", DBUS_TYPE_BOOLEAN,\n\t\t\t\t\t\t\t&op->prep_authorize);\n\n\tserver = btd_device_get_gatt_server(op->device);\n\tmtu = bt_gatt_server_get_mtu(server);\n\n\tdict_append_entry(iter, \"mtu\", DBUS_TYPE_UINT16, &mtu);\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_open_container",
          "args": [
            "iter",
            "DBUS_TYPE_ARRAY",
            "DBUS_DICT_ENTRY_BEGIN_CHAR_AS_STRINGDBUS_TYPE_STRING_AS_STRING\n\t\t\t\t\tDBUS_TYPE_VARIANT_AS_STRING\n\t\t\t\t\tDBUS_DICT_ENTRY_END_CHAR_AS_STRING",
            "&dict"
          ],
          "line": 2324
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic void acquire_notify_setup(DBusMessageIter *iter, void *user_data)\n{\n\tDBusMessageIter dict;\n\tstruct pending_op *op = user_data;\n\n\tdbus_message_iter_open_container(iter, DBUS_TYPE_ARRAY,\n\t\t\t\t\tDBUS_DICT_ENTRY_BEGIN_CHAR_AS_STRING\n\t\t\t\t\tDBUS_TYPE_STRING_AS_STRING\n\t\t\t\t\tDBUS_TYPE_VARIANT_AS_STRING\n\t\t\t\t\tDBUS_DICT_ENTRY_END_CHAR_AS_STRING,\n\t\t\t\t\t&dict);\n\n\tappend_options(&dict, op);\n\n\tdbus_message_iter_close_container(iter, &dict);\n}"
  },
  {
    "function_name": "acquire_notify_reply",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
    "lines": "2281-2317",
    "snippet": "static void acquire_notify_reply(DBusMessage *message, void *user_data)\n{\n\tstruct pending_op *op = user_data;\n\tstruct external_chrc *chrc = (void *) op->data.iov_base;\n\tDBusError err;\n\tint fd;\n\tuint16_t mtu;\n\n\tdbus_error_init(&err);\n\n\tif (dbus_set_error_from_message(&err, message) == TRUE) {\n\t\terror(\"Failed to acquire notify: %s\\n\", err.name);\n\t\tdbus_error_free(&err);\n\t\tgoto retry;\n\t}\n\n\tif ((dbus_message_get_args(message, NULL, DBUS_TYPE_UNIX_FD, &fd,\n\t\t\t\t\tDBUS_TYPE_UINT16, &mtu,\n\t\t\t\t\tDBUS_TYPE_INVALID) == false)) {\n\t\terror(\"Invalid AcquirNotify response\\n\");\n\t\tgoto retry;\n\t}\n\n\tDBG(\"AcquireNotify success: fd %d MTU %u\\n\", fd, mtu);\n\n\tchrc->notify_io = pipe_io_new(fd, chrc);\n\n\t__sync_fetch_and_add(&chrc->ntfy_cnt, 1);\n\n\treturn;\n\nretry:\n\tg_dbus_proxy_method_call(chrc->proxy, \"StartNotify\", NULL, NULL,\n\t\t\t\t\t\t\tNULL, NULL);\n\n\t__sync_fetch_and_add(&chrc->ntfy_cnt, 1);\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"dbus-common.h\"",
      "#include \"gatt-database.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "__sync_fetch_and_add",
          "args": [
            "&chrc->ntfy_cnt",
            "1"
          ],
          "line": 2316
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_dbus_proxy_method_call",
          "args": [
            "chrc->proxy",
            "\"StartNotify\"",
            "NULL",
            "NULL",
            "NULL",
            "NULL"
          ],
          "line": 2313
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "__sync_fetch_and_add",
          "args": [
            "&chrc->ntfy_cnt",
            "1"
          ],
          "line": 2308
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pipe_io_new",
          "args": [
            "fd",
            "chrc"
          ],
          "line": 2306
        },
        "resolved": true,
        "details": {
          "function_name": "pipe_io_new",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "2174-2187",
          "snippet": "static struct io *pipe_io_new(int fd, void *user_data)\n{\n\tstruct io *io;\n\n\tio = io_new(fd);\n\n\tio_set_close_on_destroy(io, true);\n\n\tio_set_read_handler(io, pipe_io_read, user_data, NULL);\n\n\tio_set_disconnect_handler(io, pipe_hup, user_data, NULL);\n\n\treturn io;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic struct io *pipe_io_new(int fd, void *user_data)\n{\n\tstruct io *io;\n\n\tio = io_new(fd);\n\n\tio_set_close_on_destroy(io, true);\n\n\tio_set_read_handler(io, pipe_io_read, user_data, NULL);\n\n\tio_set_disconnect_handler(io, pipe_hup, user_data, NULL);\n\n\treturn io;\n}"
        }
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"AcquireNotify success: fd %d MTU %u\\n\"",
            "fd",
            "mtu"
          ],
          "line": 2304
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"Invalid AcquirNotify response\\n\""
          ],
          "line": 2300
        },
        "resolved": true,
        "details": {
          "function_name": "dbus_error_to_att_ecode",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "1833-1855",
          "snippet": "static uint8_t dbus_error_to_att_ecode(const char *error_name)\n{\n\n\tif (strcmp(error_name, \"org.bluez.Error.Failed\") == 0)\n\t\treturn 0x80;  /* For now return this \"application error\" */\n\n\tif (strcmp(error_name, \"org.bluez.Error.NotSupported\") == 0)\n\t\treturn BT_ATT_ERROR_REQUEST_NOT_SUPPORTED;\n\n\tif (strcmp(error_name, \"org.bluez.Error.NotAuthorized\") == 0)\n\t\treturn BT_ATT_ERROR_AUTHORIZATION;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InvalidValueLength\") == 0)\n\t\treturn BT_ATT_ERROR_INVALID_ATTRIBUTE_VALUE_LEN;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InvalidOffset\") == 0)\n\t\treturn BT_ATT_ERROR_INVALID_OFFSET;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InProgress\") == 0)\n\t\treturn BT_ERROR_ALREADY_IN_PROGRESS;\n\n\treturn 0;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic uint8_t dbus_error_to_att_ecode(const char *error_name)\n{\n\n\tif (strcmp(error_name, \"org.bluez.Error.Failed\") == 0)\n\t\treturn 0x80;  /* For now return this \"application error\" */\n\n\tif (strcmp(error_name, \"org.bluez.Error.NotSupported\") == 0)\n\t\treturn BT_ATT_ERROR_REQUEST_NOT_SUPPORTED;\n\n\tif (strcmp(error_name, \"org.bluez.Error.NotAuthorized\") == 0)\n\t\treturn BT_ATT_ERROR_AUTHORIZATION;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InvalidValueLength\") == 0)\n\t\treturn BT_ATT_ERROR_INVALID_ATTRIBUTE_VALUE_LEN;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InvalidOffset\") == 0)\n\t\treturn BT_ATT_ERROR_INVALID_OFFSET;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InProgress\") == 0)\n\t\treturn BT_ERROR_ALREADY_IN_PROGRESS;\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_message_get_args",
          "args": [
            "message",
            "NULL",
            "DBUS_TYPE_UNIX_FD",
            "&fd",
            "DBUS_TYPE_UINT16",
            "&mtu",
            "DBUS_TYPE_INVALID"
          ],
          "line": 2297
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_error_free",
          "args": [
            "&err"
          ],
          "line": 2293
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"Failed to acquire notify: %s\\n\"",
            "err.name"
          ],
          "line": 2292
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_failed",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "124-128",
          "snippet": "DBusMessage *btd_error_failed(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE\n\t\t\t\t\t\".Failed\", \"%s\", str);\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_failed(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE\n\t\t\t\t\t\".Failed\", \"%s\", str);\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_set_error_from_message",
          "args": [
            "&err",
            "message"
          ],
          "line": 2291
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_error_init",
          "args": [
            "&err"
          ],
          "line": 2289
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic void acquire_notify_reply(DBusMessage *message, void *user_data)\n{\n\tstruct pending_op *op = user_data;\n\tstruct external_chrc *chrc = (void *) op->data.iov_base;\n\tDBusError err;\n\tint fd;\n\tuint16_t mtu;\n\n\tdbus_error_init(&err);\n\n\tif (dbus_set_error_from_message(&err, message) == TRUE) {\n\t\terror(\"Failed to acquire notify: %s\\n\", err.name);\n\t\tdbus_error_free(&err);\n\t\tgoto retry;\n\t}\n\n\tif ((dbus_message_get_args(message, NULL, DBUS_TYPE_UNIX_FD, &fd,\n\t\t\t\t\tDBUS_TYPE_UINT16, &mtu,\n\t\t\t\t\tDBUS_TYPE_INVALID) == false)) {\n\t\terror(\"Invalid AcquirNotify response\\n\");\n\t\tgoto retry;\n\t}\n\n\tDBG(\"AcquireNotify success: fd %d MTU %u\\n\", fd, mtu);\n\n\tchrc->notify_io = pipe_io_new(fd, chrc);\n\n\t__sync_fetch_and_add(&chrc->ntfy_cnt, 1);\n\n\treturn;\n\nretry:\n\tg_dbus_proxy_method_call(chrc->proxy, \"StartNotify\", NULL, NULL,\n\t\t\t\t\t\t\tNULL, NULL);\n\n\t__sync_fetch_and_add(&chrc->ntfy_cnt, 1);\n}"
  },
  {
    "function_name": "acquire_write",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
    "lines": "2258-2279",
    "snippet": "static struct pending_op *acquire_write(struct external_chrc *chrc,\n\t\t\t\t\tstruct btd_device *device,\n\t\t\t\t\tstruct gatt_db_attribute *attrib,\n\t\t\t\t\tunsigned int id,\n\t\t\t\t\tconst uint8_t *value, size_t len,\n\t\t\t\t\tuint8_t link_type)\n{\n\tstruct pending_op *op;\n\n\top = pending_write_new(device, NULL, attrib, id, value, len, 0,\n\t\t\t\t\t\tlink_type, false, false);\n\n\tif (g_dbus_proxy_method_call(chrc->proxy, \"AcquireWrite\",\n\t\t\t\t\tacquire_write_setup,\n\t\t\t\t\tacquire_write_reply,\n\t\t\t\t\top, pending_op_free))\n\t\treturn op;\n\n\tpending_op_free(op);\n\n\treturn NULL;\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"dbus-common.h\"",
      "#include \"gatt-database.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "pending_op_free",
          "args": [
            "op"
          ],
          "line": 2276
        },
        "resolved": true,
        "details": {
          "function_name": "pending_op_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "941-949",
          "snippet": "static void pending_op_free(void *data)\n{\n\tstruct pending_op *op = data;\n\n\tif (op->owner_queue)\n\t\tqueue_remove(op->owner_queue, op);\n\n\tfree(op);\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic void pending_op_free(void *data)\n{\n\tstruct pending_op *op = data;\n\n\tif (op->owner_queue)\n\t\tqueue_remove(op->owner_queue, op);\n\n\tfree(op);\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_dbus_proxy_method_call",
          "args": [
            "chrc->proxy",
            "\"AcquireWrite\"",
            "acquire_write_setup",
            "acquire_write_reply",
            "op",
            "pending_op_free"
          ],
          "line": 2270
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pending_write_new",
          "args": [
            "device",
            "NULL",
            "attrib",
            "id",
            "value",
            "len",
            "0",
            "link_type",
            "false",
            "false"
          ],
          "line": 2267
        },
        "resolved": true,
        "details": {
          "function_name": "pending_write_new",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "2082-2109",
          "snippet": "static struct pending_op *pending_write_new(struct btd_device *device,\n\t\t\t\t\tstruct queue *owner_queue,\n\t\t\t\t\tstruct gatt_db_attribute *attrib,\n\t\t\t\t\tunsigned int id,\n\t\t\t\t\tconst uint8_t *value, size_t len,\n\t\t\t\t\tuint16_t offset, uint8_t link_type,\n\t\t\t\t\tbool is_characteristic,\n\t\t\t\t\tbool prep_authorize)\n{\n\tstruct pending_op *op;\n\n\top = new0(struct pending_op, 1);\n\n\top->data.iov_base = (uint8_t *) value;\n\top->data.iov_len = len;\n\n\top->device = device;\n\top->owner_queue = owner_queue;\n\top->attrib = attrib;\n\top->id = id;\n\top->offset = offset;\n\top->link_type = link_type;\n\top->is_characteristic = is_characteristic;\n\top->prep_authorize = prep_authorize;\n\tqueue_push_tail(owner_queue, op);\n\n\treturn op;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic struct pending_op *pending_write_new(struct btd_device *device,\n\t\t\t\t\tstruct queue *owner_queue,\n\t\t\t\t\tstruct gatt_db_attribute *attrib,\n\t\t\t\t\tunsigned int id,\n\t\t\t\t\tconst uint8_t *value, size_t len,\n\t\t\t\t\tuint16_t offset, uint8_t link_type,\n\t\t\t\t\tbool is_characteristic,\n\t\t\t\t\tbool prep_authorize)\n{\n\tstruct pending_op *op;\n\n\top = new0(struct pending_op, 1);\n\n\top->data.iov_base = (uint8_t *) value;\n\top->data.iov_len = len;\n\n\top->device = device;\n\top->owner_queue = owner_queue;\n\top->attrib = attrib;\n\top->id = id;\n\top->offset = offset;\n\top->link_type = link_type;\n\top->is_characteristic = is_characteristic;\n\top->prep_authorize = prep_authorize;\n\tqueue_push_tail(owner_queue, op);\n\n\treturn op;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic struct pending_op *acquire_write(struct external_chrc *chrc,\n\t\t\t\t\tstruct btd_device *device,\n\t\t\t\t\tstruct gatt_db_attribute *attrib,\n\t\t\t\t\tunsigned int id,\n\t\t\t\t\tconst uint8_t *value, size_t len,\n\t\t\t\t\tuint8_t link_type)\n{\n\tstruct pending_op *op;\n\n\top = pending_write_new(device, NULL, attrib, id, value, len, 0,\n\t\t\t\t\t\tlink_type, false, false);\n\n\tif (g_dbus_proxy_method_call(chrc->proxy, \"AcquireWrite\",\n\t\t\t\t\tacquire_write_setup,\n\t\t\t\t\tacquire_write_reply,\n\t\t\t\t\top, pending_op_free))\n\t\treturn op;\n\n\tpending_op_free(op);\n\n\treturn NULL;\n}"
  },
  {
    "function_name": "acquire_write_setup",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
    "lines": "2241-2256",
    "snippet": "static void acquire_write_setup(DBusMessageIter *iter, void *user_data)\n{\n\tstruct pending_op *op = user_data;\n\tDBusMessageIter dict;\n\n\tdbus_message_iter_open_container(iter, DBUS_TYPE_ARRAY,\n\t\t\t\t\tDBUS_DICT_ENTRY_BEGIN_CHAR_AS_STRING\n\t\t\t\t\tDBUS_TYPE_STRING_AS_STRING\n\t\t\t\t\tDBUS_TYPE_VARIANT_AS_STRING\n\t\t\t\t\tDBUS_DICT_ENTRY_END_CHAR_AS_STRING,\n\t\t\t\t\t&dict);\n\n\tappend_options(&dict, op);\n\n\tdbus_message_iter_close_container(iter, &dict);\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"dbus-common.h\"",
      "#include \"gatt-database.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "dbus_message_iter_close_container",
          "args": [
            "iter",
            "&dict"
          ],
          "line": 2255
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "append_options",
          "args": [
            "&dict",
            "op"
          ],
          "line": 2253
        },
        "resolved": true,
        "details": {
          "function_name": "append_options",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "1932-1966",
          "snippet": "static void append_options(DBusMessageIter *iter, void *user_data)\n{\n\tstruct pending_op *op = user_data;\n\tconst char *path = device_get_path(op->device);\n\tstruct bt_gatt_server *server;\n\tconst char *link;\n\tuint16_t mtu;\n\n\tswitch (op->link_type) {\n\tcase BT_ATT_LINK_BREDR:\n\t\tlink = \"BR/EDR\";\n\t\tbreak;\n\tcase BT_ATT_LINK_LE:\n\t\tlink = \"LE\";\n\t\tbreak;\n\tdefault:\n\t\tlink = NULL;\n\t\tbreak;\n\t}\n\n\tdict_append_entry(iter, \"device\", DBUS_TYPE_OBJECT_PATH, &path);\n\tif (op->offset)\n\t\tdict_append_entry(iter, \"offset\", DBUS_TYPE_UINT16,\n\t\t\t\t\t\t\t&op->offset);\n\tif (link)\n\t\tdict_append_entry(iter, \"link\", DBUS_TYPE_STRING, &link);\n\tif (op->prep_authorize)\n\t\tdict_append_entry(iter, \"prepare-authorize\", DBUS_TYPE_BOOLEAN,\n\t\t\t\t\t\t\t&op->prep_authorize);\n\n\tserver = btd_device_get_gatt_server(op->device);\n\tmtu = bt_gatt_server_get_mtu(server);\n\n\tdict_append_entry(iter, \"mtu\", DBUS_TYPE_UINT16, &mtu);\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic void append_options(DBusMessageIter *iter, void *user_data)\n{\n\tstruct pending_op *op = user_data;\n\tconst char *path = device_get_path(op->device);\n\tstruct bt_gatt_server *server;\n\tconst char *link;\n\tuint16_t mtu;\n\n\tswitch (op->link_type) {\n\tcase BT_ATT_LINK_BREDR:\n\t\tlink = \"BR/EDR\";\n\t\tbreak;\n\tcase BT_ATT_LINK_LE:\n\t\tlink = \"LE\";\n\t\tbreak;\n\tdefault:\n\t\tlink = NULL;\n\t\tbreak;\n\t}\n\n\tdict_append_entry(iter, \"device\", DBUS_TYPE_OBJECT_PATH, &path);\n\tif (op->offset)\n\t\tdict_append_entry(iter, \"offset\", DBUS_TYPE_UINT16,\n\t\t\t\t\t\t\t&op->offset);\n\tif (link)\n\t\tdict_append_entry(iter, \"link\", DBUS_TYPE_STRING, &link);\n\tif (op->prep_authorize)\n\t\tdict_append_entry(iter, \"prepare-authorize\", DBUS_TYPE_BOOLEAN,\n\t\t\t\t\t\t\t&op->prep_authorize);\n\n\tserver = btd_device_get_gatt_server(op->device);\n\tmtu = bt_gatt_server_get_mtu(server);\n\n\tdict_append_entry(iter, \"mtu\", DBUS_TYPE_UINT16, &mtu);\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_open_container",
          "args": [
            "iter",
            "DBUS_TYPE_ARRAY",
            "DBUS_DICT_ENTRY_BEGIN_CHAR_AS_STRINGDBUS_TYPE_STRING_AS_STRING\n\t\t\t\t\tDBUS_TYPE_VARIANT_AS_STRING\n\t\t\t\t\tDBUS_DICT_ENTRY_END_CHAR_AS_STRING",
            "&dict"
          ],
          "line": 2246
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic void acquire_write_setup(DBusMessageIter *iter, void *user_data)\n{\n\tstruct pending_op *op = user_data;\n\tDBusMessageIter dict;\n\n\tdbus_message_iter_open_container(iter, DBUS_TYPE_ARRAY,\n\t\t\t\t\tDBUS_DICT_ENTRY_BEGIN_CHAR_AS_STRING\n\t\t\t\t\tDBUS_TYPE_STRING_AS_STRING\n\t\t\t\t\tDBUS_TYPE_VARIANT_AS_STRING\n\t\t\t\t\tDBUS_DICT_ENTRY_END_CHAR_AS_STRING,\n\t\t\t\t\t&dict);\n\n\tappend_options(&dict, op);\n\n\tdbus_message_iter_close_container(iter, &dict);\n}"
  },
  {
    "function_name": "acquire_write_reply",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
    "lines": "2199-2239",
    "snippet": "static void acquire_write_reply(DBusMessage *message, void *user_data)\n{\n\tstruct pending_op *op = user_data;\n\tstruct external_chrc *chrc;\n\tDBusError err;\n\tint fd;\n\tuint16_t mtu;\n\n\tchrc = gatt_db_attribute_get_user_data(op->attrib);\n\tdbus_error_init(&err);\n\n\tif (dbus_set_error_from_message(&err, message) == TRUE) {\n\t\terror(\"Failed to acquire write: %s\\n\", err.name);\n\t\tdbus_error_free(&err);\n\t\tgoto retry;\n\t}\n\n\tif ((dbus_message_get_args(message, NULL, DBUS_TYPE_UNIX_FD, &fd,\n\t\t\t\t\tDBUS_TYPE_UINT16, &mtu,\n\t\t\t\t\tDBUS_TYPE_INVALID) == false)) {\n\t\terror(\"Invalid AcquireWrite response\\n\");\n\t\tgoto retry;\n\t}\n\n\tDBG(\"AcquireWrite success: fd %d MTU %u\\n\", fd, mtu);\n\n\tchrc->write_io = pipe_io_new(fd, chrc);\n\n\tif (pipe_io_send(chrc->write_io, op->data.iov_base,\n\t\t\t\top->data.iov_len) < 0)\n\t\tgoto retry;\n\n\tgatt_db_attribute_write_result(op->attrib, op->id, 0);\n\n\treturn;\n\nretry:\n\tsend_write(op->device, op->attrib, chrc->proxy, NULL, op->id,\n\t\t\t\top->data.iov_base, op->data.iov_len, 0,\n\t\t\t\top->link_type, false, false);\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"dbus-common.h\"",
      "#include \"gatt-database.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "send_write",
          "args": [
            "op->device",
            "op->attrib",
            "chrc->proxy",
            "NULL",
            "op->id",
            "op->data.iov_base",
            "op->data.iov_len",
            "0",
            "op->link_type",
            "false",
            "false"
          ],
          "line": 2236
        },
        "resolved": true,
        "details": {
          "function_name": "send_write",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "2111-2135",
          "snippet": "static struct pending_op *send_write(struct btd_device *device,\n\t\t\t\t\tstruct gatt_db_attribute *attrib,\n\t\t\t\t\tGDBusProxy *proxy,\n\t\t\t\t\tstruct queue *owner_queue,\n\t\t\t\t\tunsigned int id,\n\t\t\t\t\tconst uint8_t *value, size_t len,\n\t\t\t\t\tuint16_t offset, uint8_t link_type,\n\t\t\t\t\tbool is_characteristic,\n\t\t\t\t\tbool prep_authorize)\n{\n\tstruct pending_op *op;\n\n\top = pending_write_new(device, owner_queue, attrib, id, value, len,\n\t\t\t\t\toffset, link_type, is_characteristic,\n\t\t\t\t\tprep_authorize);\n\n\tif (g_dbus_proxy_method_call(proxy, \"WriteValue\", write_setup_cb,\n\t\t\t\t\towner_queue ? write_reply_cb : NULL,\n\t\t\t\t\top, pending_op_free) == TRUE)\n\t\treturn op;\n\n\tpending_op_free(op);\n\n\treturn NULL;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic struct pending_op *send_write(struct btd_device *device,\n\t\t\t\t\tstruct gatt_db_attribute *attrib,\n\t\t\t\t\tGDBusProxy *proxy,\n\t\t\t\t\tstruct queue *owner_queue,\n\t\t\t\t\tunsigned int id,\n\t\t\t\t\tconst uint8_t *value, size_t len,\n\t\t\t\t\tuint16_t offset, uint8_t link_type,\n\t\t\t\t\tbool is_characteristic,\n\t\t\t\t\tbool prep_authorize)\n{\n\tstruct pending_op *op;\n\n\top = pending_write_new(device, owner_queue, attrib, id, value, len,\n\t\t\t\t\toffset, link_type, is_characteristic,\n\t\t\t\t\tprep_authorize);\n\n\tif (g_dbus_proxy_method_call(proxy, \"WriteValue\", write_setup_cb,\n\t\t\t\t\towner_queue ? write_reply_cb : NULL,\n\t\t\t\t\top, pending_op_free) == TRUE)\n\t\treturn op;\n\n\tpending_op_free(op);\n\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "gatt_db_attribute_write_result",
          "args": [
            "op->attrib",
            "op->id",
            "0"
          ],
          "line": 2231
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_attribute_write_result",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "1862-1878",
          "snippet": "bool gatt_db_attribute_write_result(struct gatt_db_attribute *attrib,\n\t\t\t\t\t\tunsigned int id, int err)\n{\n\tstruct pending_write *p;\n\n\tif (!attrib || !id)\n\t\treturn false;\n\n\tp = queue_remove_if(attrib->pending_writes, find_pending,\n\t\t\t\t\t\t\tUINT_TO_PTR(id));\n\tif (!p)\n\t\treturn false;\n\n\tpending_write_result(p, err);\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nbool gatt_db_attribute_write_result(struct gatt_db_attribute *attrib,\n\t\t\t\t\t\tunsigned int id, int err)\n{\n\tstruct pending_write *p;\n\n\tif (!attrib || !id)\n\t\treturn false;\n\n\tp = queue_remove_if(attrib->pending_writes, find_pending,\n\t\t\t\t\t\t\tUINT_TO_PTR(id));\n\tif (!p)\n\t\treturn false;\n\n\tpending_write_result(p, err);\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "pipe_io_send",
          "args": [
            "chrc->write_io",
            "op->data.iov_base",
            "op->data.iov_len"
          ],
          "line": 2227
        },
        "resolved": true,
        "details": {
          "function_name": "pipe_io_send",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "2189-2197",
          "snippet": "static int pipe_io_send(struct io *io, const void *data, size_t len)\n{\n\tstruct iovec iov;\n\n\tiov.iov_base = (void *) data;\n\tiov.iov_len = len;\n\n\treturn io_send(io, &iov, 1);\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic int pipe_io_send(struct io *io, const void *data, size_t len)\n{\n\tstruct iovec iov;\n\n\tiov.iov_base = (void *) data;\n\tiov.iov_len = len;\n\n\treturn io_send(io, &iov, 1);\n}"
        }
      },
      {
        "call_info": {
          "callee": "pipe_io_new",
          "args": [
            "fd",
            "chrc"
          ],
          "line": 2225
        },
        "resolved": true,
        "details": {
          "function_name": "pipe_io_new",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "2174-2187",
          "snippet": "static struct io *pipe_io_new(int fd, void *user_data)\n{\n\tstruct io *io;\n\n\tio = io_new(fd);\n\n\tio_set_close_on_destroy(io, true);\n\n\tio_set_read_handler(io, pipe_io_read, user_data, NULL);\n\n\tio_set_disconnect_handler(io, pipe_hup, user_data, NULL);\n\n\treturn io;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic struct io *pipe_io_new(int fd, void *user_data)\n{\n\tstruct io *io;\n\n\tio = io_new(fd);\n\n\tio_set_close_on_destroy(io, true);\n\n\tio_set_read_handler(io, pipe_io_read, user_data, NULL);\n\n\tio_set_disconnect_handler(io, pipe_hup, user_data, NULL);\n\n\treturn io;\n}"
        }
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"AcquireWrite success: fd %d MTU %u\\n\"",
            "fd",
            "mtu"
          ],
          "line": 2223
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"Invalid AcquireWrite response\\n\""
          ],
          "line": 2219
        },
        "resolved": true,
        "details": {
          "function_name": "dbus_error_to_att_ecode",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "1833-1855",
          "snippet": "static uint8_t dbus_error_to_att_ecode(const char *error_name)\n{\n\n\tif (strcmp(error_name, \"org.bluez.Error.Failed\") == 0)\n\t\treturn 0x80;  /* For now return this \"application error\" */\n\n\tif (strcmp(error_name, \"org.bluez.Error.NotSupported\") == 0)\n\t\treturn BT_ATT_ERROR_REQUEST_NOT_SUPPORTED;\n\n\tif (strcmp(error_name, \"org.bluez.Error.NotAuthorized\") == 0)\n\t\treturn BT_ATT_ERROR_AUTHORIZATION;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InvalidValueLength\") == 0)\n\t\treturn BT_ATT_ERROR_INVALID_ATTRIBUTE_VALUE_LEN;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InvalidOffset\") == 0)\n\t\treturn BT_ATT_ERROR_INVALID_OFFSET;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InProgress\") == 0)\n\t\treturn BT_ERROR_ALREADY_IN_PROGRESS;\n\n\treturn 0;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic uint8_t dbus_error_to_att_ecode(const char *error_name)\n{\n\n\tif (strcmp(error_name, \"org.bluez.Error.Failed\") == 0)\n\t\treturn 0x80;  /* For now return this \"application error\" */\n\n\tif (strcmp(error_name, \"org.bluez.Error.NotSupported\") == 0)\n\t\treturn BT_ATT_ERROR_REQUEST_NOT_SUPPORTED;\n\n\tif (strcmp(error_name, \"org.bluez.Error.NotAuthorized\") == 0)\n\t\treturn BT_ATT_ERROR_AUTHORIZATION;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InvalidValueLength\") == 0)\n\t\treturn BT_ATT_ERROR_INVALID_ATTRIBUTE_VALUE_LEN;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InvalidOffset\") == 0)\n\t\treturn BT_ATT_ERROR_INVALID_OFFSET;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InProgress\") == 0)\n\t\treturn BT_ERROR_ALREADY_IN_PROGRESS;\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_message_get_args",
          "args": [
            "message",
            "NULL",
            "DBUS_TYPE_UNIX_FD",
            "&fd",
            "DBUS_TYPE_UINT16",
            "&mtu",
            "DBUS_TYPE_INVALID"
          ],
          "line": 2216
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_error_free",
          "args": [
            "&err"
          ],
          "line": 2212
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"Failed to acquire write: %s\\n\"",
            "err.name"
          ],
          "line": 2211
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_failed",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "124-128",
          "snippet": "DBusMessage *btd_error_failed(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE\n\t\t\t\t\t\".Failed\", \"%s\", str);\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_failed(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE\n\t\t\t\t\t\".Failed\", \"%s\", str);\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_set_error_from_message",
          "args": [
            "&err",
            "message"
          ],
          "line": 2210
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_error_init",
          "args": [
            "&err"
          ],
          "line": 2208
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "gatt_db_attribute_get_user_data",
          "args": [
            "op->attrib"
          ],
          "line": 2207
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_attribute_get_user_data",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "1895-1901",
          "snippet": "void *gatt_db_attribute_get_user_data(struct gatt_db_attribute *attrib)\n{\n\tif (!attrib)\n\t\treturn NULL;\n\n\treturn attrib->user_data;\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nvoid *gatt_db_attribute_get_user_data(struct gatt_db_attribute *attrib)\n{\n\tif (!attrib)\n\t\treturn NULL;\n\n\treturn attrib->user_data;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic void acquire_write_reply(DBusMessage *message, void *user_data)\n{\n\tstruct pending_op *op = user_data;\n\tstruct external_chrc *chrc;\n\tDBusError err;\n\tint fd;\n\tuint16_t mtu;\n\n\tchrc = gatt_db_attribute_get_user_data(op->attrib);\n\tdbus_error_init(&err);\n\n\tif (dbus_set_error_from_message(&err, message) == TRUE) {\n\t\terror(\"Failed to acquire write: %s\\n\", err.name);\n\t\tdbus_error_free(&err);\n\t\tgoto retry;\n\t}\n\n\tif ((dbus_message_get_args(message, NULL, DBUS_TYPE_UNIX_FD, &fd,\n\t\t\t\t\tDBUS_TYPE_UINT16, &mtu,\n\t\t\t\t\tDBUS_TYPE_INVALID) == false)) {\n\t\terror(\"Invalid AcquireWrite response\\n\");\n\t\tgoto retry;\n\t}\n\n\tDBG(\"AcquireWrite success: fd %d MTU %u\\n\", fd, mtu);\n\n\tchrc->write_io = pipe_io_new(fd, chrc);\n\n\tif (pipe_io_send(chrc->write_io, op->data.iov_base,\n\t\t\t\top->data.iov_len) < 0)\n\t\tgoto retry;\n\n\tgatt_db_attribute_write_result(op->attrib, op->id, 0);\n\n\treturn;\n\nretry:\n\tsend_write(op->device, op->attrib, chrc->proxy, NULL, op->id,\n\t\t\t\top->data.iov_base, op->data.iov_len, 0,\n\t\t\t\top->link_type, false, false);\n}"
  },
  {
    "function_name": "pipe_io_send",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
    "lines": "2189-2197",
    "snippet": "static int pipe_io_send(struct io *io, const void *data, size_t len)\n{\n\tstruct iovec iov;\n\n\tiov.iov_base = (void *) data;\n\tiov.iov_len = len;\n\n\treturn io_send(io, &iov, 1);\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"dbus-common.h\"",
      "#include \"gatt-database.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "io_send",
          "args": [
            "io",
            "&iov",
            "1"
          ],
          "line": 2196
        },
        "resolved": true,
        "details": {
          "function_name": "pipe_io_send",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "2189-2197",
          "snippet": "static int pipe_io_send(struct io *io, const void *data, size_t len)\n{\n\tstruct iovec iov;\n\n\tiov.iov_base = (void *) data;\n\tiov.iov_len = len;\n\n\treturn io_send(io, &iov, 1);\n}",
          "note": "cyclic_reference_detected"
        }
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic int pipe_io_send(struct io *io, const void *data, size_t len)\n{\n\tstruct iovec iov;\n\n\tiov.iov_base = (void *) data;\n\tiov.iov_len = len;\n\n\treturn io_send(io, &iov, 1);\n}"
  },
  {
    "function_name": "pipe_io_new",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
    "lines": "2174-2187",
    "snippet": "static struct io *pipe_io_new(int fd, void *user_data)\n{\n\tstruct io *io;\n\n\tio = io_new(fd);\n\n\tio_set_close_on_destroy(io, true);\n\n\tio_set_read_handler(io, pipe_io_read, user_data, NULL);\n\n\tio_set_disconnect_handler(io, pipe_hup, user_data, NULL);\n\n\treturn io;\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"dbus-common.h\"",
      "#include \"gatt-database.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "io_set_disconnect_handler",
          "args": [
            "io",
            "pipe_hup",
            "user_data",
            "NULL"
          ],
          "line": 2184
        },
        "resolved": true,
        "details": {
          "function_name": "io_set_disconnect_handler",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/io-glib.c",
          "lines": "260-264",
          "snippet": "bool io_set_disconnect_handler(struct io *io, io_callback_func_t callback,\n\t\t\t\tvoid *user_data, io_destroy_func_t destroy)\n{\n\treturn io_set_handler(io, G_IO_HUP, callback, user_data, destroy);\n}",
          "includes": [
            "#include \"src/shared/io.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/io.h\"\n#include <glib.h>\n#include <errno.h>\n#include <config.h>\n\nbool io_set_disconnect_handler(struct io *io, io_callback_func_t callback,\n\t\t\t\tvoid *user_data, io_destroy_func_t destroy)\n{\n\treturn io_set_handler(io, G_IO_HUP, callback, user_data, destroy);\n}"
        }
      },
      {
        "call_info": {
          "callee": "io_set_read_handler",
          "args": [
            "io",
            "pipe_io_read",
            "user_data",
            "NULL"
          ],
          "line": 2182
        },
        "resolved": true,
        "details": {
          "function_name": "io_set_read_handler",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/io-glib.c",
          "lines": "248-252",
          "snippet": "bool io_set_read_handler(struct io *io, io_callback_func_t callback,\n\t\t\t\tvoid *user_data, io_destroy_func_t destroy)\n{\n\treturn io_set_handler(io, G_IO_IN, callback, user_data, destroy);\n}",
          "includes": [
            "#include \"src/shared/io.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/io.h\"\n#include <glib.h>\n#include <errno.h>\n#include <config.h>\n\nbool io_set_read_handler(struct io *io, io_callback_func_t callback,\n\t\t\t\tvoid *user_data, io_destroy_func_t destroy)\n{\n\treturn io_set_handler(io, G_IO_IN, callback, user_data, destroy);\n}"
        }
      },
      {
        "call_info": {
          "callee": "io_set_close_on_destroy",
          "args": [
            "io",
            "true"
          ],
          "line": 2180
        },
        "resolved": true,
        "details": {
          "function_name": "io_set_close_on_destroy",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/io-glib.c",
          "lines": "145-156",
          "snippet": "bool io_set_close_on_destroy(struct io *io, bool do_close)\n{\n\tif (!io)\n\t\treturn false;\n\n\tif (do_close)\n\t\tg_io_channel_set_close_on_unref(io->channel, TRUE);\n\telse\n\t\tg_io_channel_set_close_on_unref(io->channel, FALSE);\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/io.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/io.h\"\n#include <glib.h>\n#include <errno.h>\n#include <config.h>\n\nbool io_set_close_on_destroy(struct io *io, bool do_close)\n{\n\tif (!io)\n\t\treturn false;\n\n\tif (do_close)\n\t\tg_io_channel_set_close_on_unref(io->channel, TRUE);\n\telse\n\t\tg_io_channel_set_close_on_unref(io->channel, FALSE);\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "io_new",
          "args": [
            "fd"
          ],
          "line": 2178
        },
        "resolved": true,
        "details": {
          "function_name": "io_new",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/io-glib.c",
          "lines": "71-90",
          "snippet": "struct io *io_new(int fd)\n{\n\tstruct io *io;\n\n\tif (fd < 0)\n\t\treturn NULL;\n\n\tio = g_try_new0(struct io, 1);\n\tif (!io)\n\t\treturn NULL;\n\n\tio->channel = g_io_channel_unix_new(fd);\n\n\tg_io_channel_set_encoding(io->channel, NULL, NULL);\n\tg_io_channel_set_buffered(io->channel, FALSE);\n\n\tg_io_channel_set_close_on_unref(io->channel, FALSE);\n\n\treturn io_ref(io);\n}",
          "includes": [
            "#include \"src/shared/io.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/io.h\"\n#include <glib.h>\n#include <errno.h>\n#include <config.h>\n\nstruct io *io_new(int fd)\n{\n\tstruct io *io;\n\n\tif (fd < 0)\n\t\treturn NULL;\n\n\tio = g_try_new0(struct io, 1);\n\tif (!io)\n\t\treturn NULL;\n\n\tio->channel = g_io_channel_unix_new(fd);\n\n\tg_io_channel_set_encoding(io->channel, NULL, NULL);\n\tg_io_channel_set_buffered(io->channel, FALSE);\n\n\tg_io_channel_set_close_on_unref(io->channel, FALSE);\n\n\treturn io_ref(io);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic struct io *pipe_io_new(int fd, void *user_data)\n{\n\tstruct io *io;\n\n\tio = io_new(fd);\n\n\tio_set_close_on_destroy(io, true);\n\n\tio_set_read_handler(io, pipe_io_read, user_data, NULL);\n\n\tio_set_disconnect_handler(io, pipe_hup, user_data, NULL);\n\n\treturn io;\n}"
  },
  {
    "function_name": "pipe_io_read",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
    "lines": "2153-2172",
    "snippet": "static bool pipe_io_read(struct io *io, void *user_data)\n{\n\tstruct external_chrc *chrc = user_data;\n\tuint8_t buf[512];\n\tint fd = io_get_fd(io);\n\tssize_t bytes_read;\n\n\tbytes_read = read(fd, buf, sizeof(buf));\n\tif (bytes_read < 0)\n\t\treturn false;\n\n\tsend_notification_to_devices(chrc->service->app->database,\n\t\t\t\tgatt_db_attribute_get_handle(chrc->attrib),\n\t\t\t\tbuf, bytes_read,\n\t\t\t\tgatt_db_attribute_get_handle(chrc->ccc),\n\t\t\t\tchrc->props & BT_GATT_CHRC_PROP_INDICATE ?\n\t\t\t\tconf_cb : NULL, chrc->proxy);\n\n\treturn true;\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"dbus-common.h\"",
      "#include \"gatt-database.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "send_notification_to_devices",
          "args": [
            "chrc->service->app->database",
            "gatt_db_attribute_get_handle(chrc->attrib)",
            "buf",
            "bytes_read",
            "gatt_db_attribute_get_handle(chrc->ccc)",
            "chrc->props & BT_GATT_CHRC_PROP_INDICATE ?\n\t\t\t\tconf_cb : NULL",
            "chrc->proxy"
          ],
          "line": 2164
        },
        "resolved": true,
        "details": {
          "function_name": "send_notification_to_devices",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "1181-1201",
          "snippet": "static void send_notification_to_devices(struct btd_gatt_database *database,\n\t\t\t\t\tuint16_t handle, uint8_t *value,\n\t\t\t\t\tuint16_t len, uint16_t ccc_handle,\n\t\t\t\t\tbt_gatt_server_conf_func_t conf,\n\t\t\t\t\tvoid *user_data)\n{\n\tstruct notify notify;\n\n\tmemset(&notify, 0, sizeof(notify));\n\n\tnotify.database = database;\n\tnotify.handle = handle;\n\tnotify.ccc_handle = ccc_handle;\n\tnotify.value = value;\n\tnotify.len = len;\n\tnotify.conf = conf;\n\tnotify.user_data = user_data;\n\n\tqueue_foreach(database->device_states, send_notification_to_device,\n\t\t\t\t\t\t\t\t&notify);\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic void send_notification_to_devices(struct btd_gatt_database *database,\n\t\t\t\t\tuint16_t handle, uint8_t *value,\n\t\t\t\t\tuint16_t len, uint16_t ccc_handle,\n\t\t\t\t\tbt_gatt_server_conf_func_t conf,\n\t\t\t\t\tvoid *user_data)\n{\n\tstruct notify notify;\n\n\tmemset(&notify, 0, sizeof(notify));\n\n\tnotify.database = database;\n\tnotify.handle = handle;\n\tnotify.ccc_handle = ccc_handle;\n\tnotify.value = value;\n\tnotify.len = len;\n\tnotify.conf = conf;\n\tnotify.user_data = user_data;\n\n\tqueue_foreach(database->device_states, send_notification_to_device,\n\t\t\t\t\t\t\t\t&notify);\n}"
        }
      },
      {
        "call_info": {
          "callee": "gatt_db_attribute_get_handle",
          "args": [
            "chrc->ccc"
          ],
          "line": 2167
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_attribute_get_handle",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "1482-1488",
          "snippet": "uint16_t gatt_db_attribute_get_handle(const struct gatt_db_attribute *attrib)\n{\n\tif (!attrib)\n\t\treturn 0;\n\n\treturn attrib->handle;\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nuint16_t gatt_db_attribute_get_handle(const struct gatt_db_attribute *attrib)\n{\n\tif (!attrib)\n\t\treturn 0;\n\n\treturn attrib->handle;\n}"
        }
      },
      {
        "call_info": {
          "callee": "read",
          "args": [
            "fd",
            "buf",
            "sizeof(buf)"
          ],
          "line": 2160
        },
        "resolved": true,
        "details": {
          "function_name": "read_device_ccc",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/attrib-server.c",
          "lines": "763-795",
          "snippet": "static int read_device_ccc(struct btd_device *device, uint16_t handle,\n\t\t\t\tuint16_t *value)\n{\n\tchar *filename;\n\tGKeyFile *key_file;\n\tchar group[6];\n\tchar *str;\n\tunsigned int config;\n\tint err = 0;\n\n\tfilename = btd_device_get_storage_path(device, \"ccc\");\n\tif (!filename) {\n\t\twarn(\"Unable to get ccc storage path for device\");\n\t\treturn -ENOENT;\n\t}\n\n\tkey_file = g_key_file_new();\n\tg_key_file_load_from_file(key_file, filename, 0, NULL);\n\n\tsprintf(group, \"%hu\", handle);\n\n\tstr = g_key_file_get_string(key_file, group, \"Value\", NULL);\n\tif (!str || sscanf(str, \"%04X\", &config) != 1)\n\t\terr = -ENOENT;\n\telse\n\t\t*value = config;\n\n\tg_free(str);\n\tg_free(filename);\n\tg_key_file_free(key_file);\n\n\treturn err;\n}",
          "includes": [
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"attrib/att-database.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"backtrace.h\"",
            "#include \"log.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <sys/stat.h>",
            "#include <glib.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdbool.h>",
            "#include <stdint.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"attrib/att-database.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"src/shared/util.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <sys/stat.h>\n#include <glib.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdbool.h>\n#include <stdint.h>\n#include <errno.h>\n#include <config.h>\n\nstatic int read_device_ccc(struct btd_device *device, uint16_t handle,\n\t\t\t\tuint16_t *value)\n{\n\tchar *filename;\n\tGKeyFile *key_file;\n\tchar group[6];\n\tchar *str;\n\tunsigned int config;\n\tint err = 0;\n\n\tfilename = btd_device_get_storage_path(device, \"ccc\");\n\tif (!filename) {\n\t\twarn(\"Unable to get ccc storage path for device\");\n\t\treturn -ENOENT;\n\t}\n\n\tkey_file = g_key_file_new();\n\tg_key_file_load_from_file(key_file, filename, 0, NULL);\n\n\tsprintf(group, \"%hu\", handle);\n\n\tstr = g_key_file_get_string(key_file, group, \"Value\", NULL);\n\tif (!str || sscanf(str, \"%04X\", &config) != 1)\n\t\terr = -ENOENT;\n\telse\n\t\t*value = config;\n\n\tg_free(str);\n\tg_free(filename);\n\tg_key_file_free(key_file);\n\n\treturn err;\n}"
        }
      },
      {
        "call_info": {
          "callee": "io_get_fd",
          "args": [
            "io"
          ],
          "line": 2157
        },
        "resolved": true,
        "details": {
          "function_name": "io_get_fd",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/io-glib.c",
          "lines": "137-143",
          "snippet": "int io_get_fd(struct io *io)\n{\n\tif (!io)\n\t\treturn -ENOTCONN;\n\n\treturn g_io_channel_unix_get_fd(io->channel);\n}",
          "includes": [
            "#include \"src/shared/io.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/io.h\"\n#include <glib.h>\n#include <errno.h>\n#include <config.h>\n\nint io_get_fd(struct io *io)\n{\n\tif (!io)\n\t\treturn -ENOTCONN;\n\n\treturn g_io_channel_unix_get_fd(io->channel);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic bool pipe_io_read(struct io *io, void *user_data)\n{\n\tstruct external_chrc *chrc = user_data;\n\tuint8_t buf[512];\n\tint fd = io_get_fd(io);\n\tssize_t bytes_read;\n\n\tbytes_read = read(fd, buf, sizeof(buf));\n\tif (bytes_read < 0)\n\t\treturn false;\n\n\tsend_notification_to_devices(chrc->service->app->database,\n\t\t\t\tgatt_db_attribute_get_handle(chrc->attrib),\n\t\t\t\tbuf, bytes_read,\n\t\t\t\tgatt_db_attribute_get_handle(chrc->ccc),\n\t\t\t\tchrc->props & BT_GATT_CHRC_PROP_INDICATE ?\n\t\t\t\tconf_cb : NULL, chrc->proxy);\n\n\treturn true;\n}"
  },
  {
    "function_name": "pipe_hup",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
    "lines": "2137-2151",
    "snippet": "static bool pipe_hup(struct io *io, void *user_data)\n{\n\tstruct external_chrc *chrc = user_data;\n\n\tDBG(\"%p closed\\n\", io);\n\n\tif (io == chrc->write_io)\n\t\tchrc->write_io = NULL;\n\telse\n\t\tchrc->notify_io = NULL;\n\n\tio_destroy(io);\n\n\treturn false;\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"dbus-common.h\"",
      "#include \"gatt-database.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "io_destroy",
          "args": [
            "io"
          ],
          "line": 2148
        },
        "resolved": true,
        "details": {
          "function_name": "notify_io_destroy",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
          "lines": "1457-1463",
          "snippet": "static void notify_io_destroy(void *data)\n{\n\tstruct notify_client *client = data;\n\n\tif (queue_remove(client->chrc->notify_clients, client))\n\t\tnotify_client_unref(client);\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"gatt-client.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void notify_io_destroy(void *data)\n{\n\tstruct notify_client *client = data;\n\n\tif (queue_remove(client->chrc->notify_clients, client))\n\t\tnotify_client_unref(client);\n}"
        }
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"%p closed\\n\"",
            "io"
          ],
          "line": 2141
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic bool pipe_hup(struct io *io, void *user_data)\n{\n\tstruct external_chrc *chrc = user_data;\n\n\tDBG(\"%p closed\\n\", io);\n\n\tif (io == chrc->write_io)\n\t\tchrc->write_io = NULL;\n\telse\n\t\tchrc->notify_io = NULL;\n\n\tio_destroy(io);\n\n\treturn false;\n}"
  },
  {
    "function_name": "send_write",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
    "lines": "2111-2135",
    "snippet": "static struct pending_op *send_write(struct btd_device *device,\n\t\t\t\t\tstruct gatt_db_attribute *attrib,\n\t\t\t\t\tGDBusProxy *proxy,\n\t\t\t\t\tstruct queue *owner_queue,\n\t\t\t\t\tunsigned int id,\n\t\t\t\t\tconst uint8_t *value, size_t len,\n\t\t\t\t\tuint16_t offset, uint8_t link_type,\n\t\t\t\t\tbool is_characteristic,\n\t\t\t\t\tbool prep_authorize)\n{\n\tstruct pending_op *op;\n\n\top = pending_write_new(device, owner_queue, attrib, id, value, len,\n\t\t\t\t\toffset, link_type, is_characteristic,\n\t\t\t\t\tprep_authorize);\n\n\tif (g_dbus_proxy_method_call(proxy, \"WriteValue\", write_setup_cb,\n\t\t\t\t\towner_queue ? write_reply_cb : NULL,\n\t\t\t\t\top, pending_op_free) == TRUE)\n\t\treturn op;\n\n\tpending_op_free(op);\n\n\treturn NULL;\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"dbus-common.h\"",
      "#include \"gatt-database.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "pending_op_free",
          "args": [
            "op"
          ],
          "line": 2132
        },
        "resolved": true,
        "details": {
          "function_name": "pending_op_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "941-949",
          "snippet": "static void pending_op_free(void *data)\n{\n\tstruct pending_op *op = data;\n\n\tif (op->owner_queue)\n\t\tqueue_remove(op->owner_queue, op);\n\n\tfree(op);\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic void pending_op_free(void *data)\n{\n\tstruct pending_op *op = data;\n\n\tif (op->owner_queue)\n\t\tqueue_remove(op->owner_queue, op);\n\n\tfree(op);\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_dbus_proxy_method_call",
          "args": [
            "proxy",
            "\"WriteValue\"",
            "write_setup_cb",
            "owner_queue ? write_reply_cb : NULL",
            "op",
            "pending_op_free"
          ],
          "line": 2127
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pending_write_new",
          "args": [
            "device",
            "owner_queue",
            "attrib",
            "id",
            "value",
            "len",
            "offset",
            "link_type",
            "is_characteristic",
            "prep_authorize"
          ],
          "line": 2123
        },
        "resolved": true,
        "details": {
          "function_name": "pending_write_new",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "2082-2109",
          "snippet": "static struct pending_op *pending_write_new(struct btd_device *device,\n\t\t\t\t\tstruct queue *owner_queue,\n\t\t\t\t\tstruct gatt_db_attribute *attrib,\n\t\t\t\t\tunsigned int id,\n\t\t\t\t\tconst uint8_t *value, size_t len,\n\t\t\t\t\tuint16_t offset, uint8_t link_type,\n\t\t\t\t\tbool is_characteristic,\n\t\t\t\t\tbool prep_authorize)\n{\n\tstruct pending_op *op;\n\n\top = new0(struct pending_op, 1);\n\n\top->data.iov_base = (uint8_t *) value;\n\top->data.iov_len = len;\n\n\top->device = device;\n\top->owner_queue = owner_queue;\n\top->attrib = attrib;\n\top->id = id;\n\top->offset = offset;\n\top->link_type = link_type;\n\top->is_characteristic = is_characteristic;\n\top->prep_authorize = prep_authorize;\n\tqueue_push_tail(owner_queue, op);\n\n\treturn op;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic struct pending_op *pending_write_new(struct btd_device *device,\n\t\t\t\t\tstruct queue *owner_queue,\n\t\t\t\t\tstruct gatt_db_attribute *attrib,\n\t\t\t\t\tunsigned int id,\n\t\t\t\t\tconst uint8_t *value, size_t len,\n\t\t\t\t\tuint16_t offset, uint8_t link_type,\n\t\t\t\t\tbool is_characteristic,\n\t\t\t\t\tbool prep_authorize)\n{\n\tstruct pending_op *op;\n\n\top = new0(struct pending_op, 1);\n\n\top->data.iov_base = (uint8_t *) value;\n\top->data.iov_len = len;\n\n\top->device = device;\n\top->owner_queue = owner_queue;\n\top->attrib = attrib;\n\top->id = id;\n\top->offset = offset;\n\top->link_type = link_type;\n\top->is_characteristic = is_characteristic;\n\top->prep_authorize = prep_authorize;\n\tqueue_push_tail(owner_queue, op);\n\n\treturn op;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic struct pending_op *send_write(struct btd_device *device,\n\t\t\t\t\tstruct gatt_db_attribute *attrib,\n\t\t\t\t\tGDBusProxy *proxy,\n\t\t\t\t\tstruct queue *owner_queue,\n\t\t\t\t\tunsigned int id,\n\t\t\t\t\tconst uint8_t *value, size_t len,\n\t\t\t\t\tuint16_t offset, uint8_t link_type,\n\t\t\t\t\tbool is_characteristic,\n\t\t\t\t\tbool prep_authorize)\n{\n\tstruct pending_op *op;\n\n\top = pending_write_new(device, owner_queue, attrib, id, value, len,\n\t\t\t\t\toffset, link_type, is_characteristic,\n\t\t\t\t\tprep_authorize);\n\n\tif (g_dbus_proxy_method_call(proxy, \"WriteValue\", write_setup_cb,\n\t\t\t\t\towner_queue ? write_reply_cb : NULL,\n\t\t\t\t\top, pending_op_free) == TRUE)\n\t\treturn op;\n\n\tpending_op_free(op);\n\n\treturn NULL;\n}"
  },
  {
    "function_name": "pending_write_new",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
    "lines": "2082-2109",
    "snippet": "static struct pending_op *pending_write_new(struct btd_device *device,\n\t\t\t\t\tstruct queue *owner_queue,\n\t\t\t\t\tstruct gatt_db_attribute *attrib,\n\t\t\t\t\tunsigned int id,\n\t\t\t\t\tconst uint8_t *value, size_t len,\n\t\t\t\t\tuint16_t offset, uint8_t link_type,\n\t\t\t\t\tbool is_characteristic,\n\t\t\t\t\tbool prep_authorize)\n{\n\tstruct pending_op *op;\n\n\top = new0(struct pending_op, 1);\n\n\top->data.iov_base = (uint8_t *) value;\n\top->data.iov_len = len;\n\n\top->device = device;\n\top->owner_queue = owner_queue;\n\top->attrib = attrib;\n\top->id = id;\n\top->offset = offset;\n\top->link_type = link_type;\n\top->is_characteristic = is_characteristic;\n\top->prep_authorize = prep_authorize;\n\tqueue_push_tail(owner_queue, op);\n\n\treturn op;\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"dbus-common.h\"",
      "#include \"gatt-database.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "queue_push_tail",
          "args": [
            "owner_queue",
            "op"
          ],
          "line": 2106
        },
        "resolved": true,
        "details": {
          "function_name": "queue_push_tail",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "88-108",
          "snippet": "bool queue_push_tail(struct queue *queue, void *data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn false;\n\n\tentry = queue_entry_new(data);\n\n\tif (queue->tail)\n\t\tqueue->tail->next = entry;\n\n\tqueue->tail = entry;\n\n\tif (!queue->head)\n\t\tqueue->head = entry;\n\n\tqueue->entries++;\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nbool queue_push_tail(struct queue *queue, void *data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn false;\n\n\tentry = queue_entry_new(data);\n\n\tif (queue->tail)\n\t\tqueue->tail->next = entry;\n\n\tqueue->tail = entry;\n\n\tif (!queue->head)\n\t\tqueue->head = entry;\n\n\tqueue->entries++;\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "new0",
          "args": [
            "structpending_op",
            "1"
          ],
          "line": 2093
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic struct pending_op *pending_write_new(struct btd_device *device,\n\t\t\t\t\tstruct queue *owner_queue,\n\t\t\t\t\tstruct gatt_db_attribute *attrib,\n\t\t\t\t\tunsigned int id,\n\t\t\t\t\tconst uint8_t *value, size_t len,\n\t\t\t\t\tuint16_t offset, uint8_t link_type,\n\t\t\t\t\tbool is_characteristic,\n\t\t\t\t\tbool prep_authorize)\n{\n\tstruct pending_op *op;\n\n\top = new0(struct pending_op, 1);\n\n\top->data.iov_base = (uint8_t *) value;\n\top->data.iov_len = len;\n\n\top->device = device;\n\top->owner_queue = owner_queue;\n\top->attrib = attrib;\n\top->id = id;\n\top->offset = offset;\n\top->link_type = link_type;\n\top->is_characteristic = is_characteristic;\n\top->prep_authorize = prep_authorize;\n\tqueue_push_tail(owner_queue, op);\n\n\treturn op;\n}"
  },
  {
    "function_name": "write_reply_cb",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
    "lines": "2034-2080",
    "snippet": "static void write_reply_cb(DBusMessage *message, void *user_data)\n{\n\tstruct pending_op *op = user_data;\n\tstruct external_chrc *chrc;\n\tstruct external_desc *desc;\n\tDBusError err;\n\tDBusMessageIter iter;\n\tuint8_t ecode = 0;\n\n\tif (!op->owner_queue) {\n\t\tDBG(\"Pending write was canceled when object got removed\");\n\t\treturn;\n\t}\n\n\tdbus_error_init(&err);\n\n\tif (dbus_set_error_from_message(&err, message) == TRUE) {\n\t\tDBG(\"Failed to write value: %s: %s\", err.name, err.message);\n\t\tecode = dbus_error_to_att_ecode(err.name);\n\t\tecode = ecode ? ecode : BT_ATT_ERROR_WRITE_NOT_PERMITTED;\n\t\tdbus_error_free(&err);\n\t\tgoto done;\n\t}\n\n\tif (op->prep_authorize) {\n\t\tif (op->is_characteristic) {\n\t\t\tchrc = gatt_db_attribute_get_user_data(op->attrib);\n\t\t\tchrc->prep_authorized = true;\n\t\t} else {\n\t\t\tdesc = gatt_db_attribute_get_user_data(op->attrib);\n\t\t\tdesc->prep_authorized = true;\n\t\t}\n\t}\n\n\tdbus_message_iter_init(message, &iter);\n\tif (dbus_message_iter_has_next(&iter)) {\n\t\t/*\n\t\t * Return not supported for this, as the external app basically\n\t\t * doesn't properly support the \"WriteValue\" API.\n\t\t */\n\t\tecode = BT_ATT_ERROR_REQUEST_NOT_SUPPORTED;\n\t\terror(\"Invalid return value received for \\\"WriteValue\\\"\");\n\t}\n\ndone:\n\tgatt_db_attribute_write_result(op->attrib, op->id, ecode);\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"dbus-common.h\"",
      "#include \"gatt-database.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "gatt_db_attribute_write_result",
          "args": [
            "op->attrib",
            "op->id",
            "ecode"
          ],
          "line": 2079
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_attribute_write_result",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "1862-1878",
          "snippet": "bool gatt_db_attribute_write_result(struct gatt_db_attribute *attrib,\n\t\t\t\t\t\tunsigned int id, int err)\n{\n\tstruct pending_write *p;\n\n\tif (!attrib || !id)\n\t\treturn false;\n\n\tp = queue_remove_if(attrib->pending_writes, find_pending,\n\t\t\t\t\t\t\tUINT_TO_PTR(id));\n\tif (!p)\n\t\treturn false;\n\n\tpending_write_result(p, err);\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nbool gatt_db_attribute_write_result(struct gatt_db_attribute *attrib,\n\t\t\t\t\t\tunsigned int id, int err)\n{\n\tstruct pending_write *p;\n\n\tif (!attrib || !id)\n\t\treturn false;\n\n\tp = queue_remove_if(attrib->pending_writes, find_pending,\n\t\t\t\t\t\t\tUINT_TO_PTR(id));\n\tif (!p)\n\t\treturn false;\n\n\tpending_write_result(p, err);\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"Invalid return value received for \\\"WriteValue\\\"\""
          ],
          "line": 2075
        },
        "resolved": true,
        "details": {
          "function_name": "dbus_error_to_att_ecode",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "1833-1855",
          "snippet": "static uint8_t dbus_error_to_att_ecode(const char *error_name)\n{\n\n\tif (strcmp(error_name, \"org.bluez.Error.Failed\") == 0)\n\t\treturn 0x80;  /* For now return this \"application error\" */\n\n\tif (strcmp(error_name, \"org.bluez.Error.NotSupported\") == 0)\n\t\treturn BT_ATT_ERROR_REQUEST_NOT_SUPPORTED;\n\n\tif (strcmp(error_name, \"org.bluez.Error.NotAuthorized\") == 0)\n\t\treturn BT_ATT_ERROR_AUTHORIZATION;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InvalidValueLength\") == 0)\n\t\treturn BT_ATT_ERROR_INVALID_ATTRIBUTE_VALUE_LEN;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InvalidOffset\") == 0)\n\t\treturn BT_ATT_ERROR_INVALID_OFFSET;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InProgress\") == 0)\n\t\treturn BT_ERROR_ALREADY_IN_PROGRESS;\n\n\treturn 0;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic uint8_t dbus_error_to_att_ecode(const char *error_name)\n{\n\n\tif (strcmp(error_name, \"org.bluez.Error.Failed\") == 0)\n\t\treturn 0x80;  /* For now return this \"application error\" */\n\n\tif (strcmp(error_name, \"org.bluez.Error.NotSupported\") == 0)\n\t\treturn BT_ATT_ERROR_REQUEST_NOT_SUPPORTED;\n\n\tif (strcmp(error_name, \"org.bluez.Error.NotAuthorized\") == 0)\n\t\treturn BT_ATT_ERROR_AUTHORIZATION;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InvalidValueLength\") == 0)\n\t\treturn BT_ATT_ERROR_INVALID_ATTRIBUTE_VALUE_LEN;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InvalidOffset\") == 0)\n\t\treturn BT_ATT_ERROR_INVALID_OFFSET;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InProgress\") == 0)\n\t\treturn BT_ERROR_ALREADY_IN_PROGRESS;\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_has_next",
          "args": [
            "&iter"
          ],
          "line": 2069
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_init",
          "args": [
            "message",
            "&iter"
          ],
          "line": 2068
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "gatt_db_attribute_get_user_data",
          "args": [
            "op->attrib"
          ],
          "line": 2063
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_attribute_get_user_data",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "1895-1901",
          "snippet": "void *gatt_db_attribute_get_user_data(struct gatt_db_attribute *attrib)\n{\n\tif (!attrib)\n\t\treturn NULL;\n\n\treturn attrib->user_data;\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nvoid *gatt_db_attribute_get_user_data(struct gatt_db_attribute *attrib)\n{\n\tif (!attrib)\n\t\treturn NULL;\n\n\treturn attrib->user_data;\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_error_free",
          "args": [
            "&err"
          ],
          "line": 2054
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"Failed to write value: %s: %s\"",
            "err.name",
            "err.message"
          ],
          "line": 2051
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_set_error_from_message",
          "args": [
            "&err",
            "message"
          ],
          "line": 2050
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_error_init",
          "args": [
            "&err"
          ],
          "line": 2048
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"Pending write was canceled when object got removed\""
          ],
          "line": 2044
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic void write_reply_cb(DBusMessage *message, void *user_data)\n{\n\tstruct pending_op *op = user_data;\n\tstruct external_chrc *chrc;\n\tstruct external_desc *desc;\n\tDBusError err;\n\tDBusMessageIter iter;\n\tuint8_t ecode = 0;\n\n\tif (!op->owner_queue) {\n\t\tDBG(\"Pending write was canceled when object got removed\");\n\t\treturn;\n\t}\n\n\tdbus_error_init(&err);\n\n\tif (dbus_set_error_from_message(&err, message) == TRUE) {\n\t\tDBG(\"Failed to write value: %s: %s\", err.name, err.message);\n\t\tecode = dbus_error_to_att_ecode(err.name);\n\t\tecode = ecode ? ecode : BT_ATT_ERROR_WRITE_NOT_PERMITTED;\n\t\tdbus_error_free(&err);\n\t\tgoto done;\n\t}\n\n\tif (op->prep_authorize) {\n\t\tif (op->is_characteristic) {\n\t\t\tchrc = gatt_db_attribute_get_user_data(op->attrib);\n\t\t\tchrc->prep_authorized = true;\n\t\t} else {\n\t\t\tdesc = gatt_db_attribute_get_user_data(op->attrib);\n\t\t\tdesc->prep_authorized = true;\n\t\t}\n\t}\n\n\tdbus_message_iter_init(message, &iter);\n\tif (dbus_message_iter_has_next(&iter)) {\n\t\t/*\n\t\t * Return not supported for this, as the external app basically\n\t\t * doesn't properly support the \"WriteValue\" API.\n\t\t */\n\t\tecode = BT_ATT_ERROR_REQUEST_NOT_SUPPORTED;\n\t\terror(\"Invalid return value received for \\\"WriteValue\\\"\");\n\t}\n\ndone:\n\tgatt_db_attribute_write_result(op->attrib, op->id, ecode);\n}"
  },
  {
    "function_name": "write_setup_cb",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
    "lines": "2007-2032",
    "snippet": "static void write_setup_cb(DBusMessageIter *iter, void *user_data)\n{\n\tstruct pending_op *op = user_data;\n\tDBusMessageIter array, dict;\n\n\tdbus_message_iter_open_container(iter, DBUS_TYPE_ARRAY, \"y\", &array);\n\tdbus_message_iter_append_fixed_array(&array, DBUS_TYPE_BYTE,\n\t\t\t\t\t&op->data.iov_base, op->data.iov_len);\n\tdbus_message_iter_close_container(iter, &array);\n\n\tdbus_message_iter_open_container(iter, DBUS_TYPE_ARRAY,\n\t\t\t\t\tDBUS_DICT_ENTRY_BEGIN_CHAR_AS_STRING\n\t\t\t\t\tDBUS_TYPE_STRING_AS_STRING\n\t\t\t\t\tDBUS_TYPE_VARIANT_AS_STRING\n\t\t\t\t\tDBUS_DICT_ENTRY_END_CHAR_AS_STRING,\n\t\t\t\t\t&dict);\n\n\tappend_options(&dict, op);\n\n\tdbus_message_iter_close_container(iter, &dict);\n\n\tif (!op->owner_queue) {\n\t\tgatt_db_attribute_write_result(op->attrib, op->id, 0);\n\t\tpending_op_free(op);\n\t}\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"dbus-common.h\"",
      "#include \"gatt-database.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "pending_op_free",
          "args": [
            "op"
          ],
          "line": 2030
        },
        "resolved": true,
        "details": {
          "function_name": "pending_op_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "941-949",
          "snippet": "static void pending_op_free(void *data)\n{\n\tstruct pending_op *op = data;\n\n\tif (op->owner_queue)\n\t\tqueue_remove(op->owner_queue, op);\n\n\tfree(op);\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic void pending_op_free(void *data)\n{\n\tstruct pending_op *op = data;\n\n\tif (op->owner_queue)\n\t\tqueue_remove(op->owner_queue, op);\n\n\tfree(op);\n}"
        }
      },
      {
        "call_info": {
          "callee": "gatt_db_attribute_write_result",
          "args": [
            "op->attrib",
            "op->id",
            "0"
          ],
          "line": 2029
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_attribute_write_result",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "1862-1878",
          "snippet": "bool gatt_db_attribute_write_result(struct gatt_db_attribute *attrib,\n\t\t\t\t\t\tunsigned int id, int err)\n{\n\tstruct pending_write *p;\n\n\tif (!attrib || !id)\n\t\treturn false;\n\n\tp = queue_remove_if(attrib->pending_writes, find_pending,\n\t\t\t\t\t\t\tUINT_TO_PTR(id));\n\tif (!p)\n\t\treturn false;\n\n\tpending_write_result(p, err);\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nbool gatt_db_attribute_write_result(struct gatt_db_attribute *attrib,\n\t\t\t\t\t\tunsigned int id, int err)\n{\n\tstruct pending_write *p;\n\n\tif (!attrib || !id)\n\t\treturn false;\n\n\tp = queue_remove_if(attrib->pending_writes, find_pending,\n\t\t\t\t\t\t\tUINT_TO_PTR(id));\n\tif (!p)\n\t\treturn false;\n\n\tpending_write_result(p, err);\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_close_container",
          "args": [
            "iter",
            "&dict"
          ],
          "line": 2026
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "append_options",
          "args": [
            "&dict",
            "op"
          ],
          "line": 2024
        },
        "resolved": true,
        "details": {
          "function_name": "append_options",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "1932-1966",
          "snippet": "static void append_options(DBusMessageIter *iter, void *user_data)\n{\n\tstruct pending_op *op = user_data;\n\tconst char *path = device_get_path(op->device);\n\tstruct bt_gatt_server *server;\n\tconst char *link;\n\tuint16_t mtu;\n\n\tswitch (op->link_type) {\n\tcase BT_ATT_LINK_BREDR:\n\t\tlink = \"BR/EDR\";\n\t\tbreak;\n\tcase BT_ATT_LINK_LE:\n\t\tlink = \"LE\";\n\t\tbreak;\n\tdefault:\n\t\tlink = NULL;\n\t\tbreak;\n\t}\n\n\tdict_append_entry(iter, \"device\", DBUS_TYPE_OBJECT_PATH, &path);\n\tif (op->offset)\n\t\tdict_append_entry(iter, \"offset\", DBUS_TYPE_UINT16,\n\t\t\t\t\t\t\t&op->offset);\n\tif (link)\n\t\tdict_append_entry(iter, \"link\", DBUS_TYPE_STRING, &link);\n\tif (op->prep_authorize)\n\t\tdict_append_entry(iter, \"prepare-authorize\", DBUS_TYPE_BOOLEAN,\n\t\t\t\t\t\t\t&op->prep_authorize);\n\n\tserver = btd_device_get_gatt_server(op->device);\n\tmtu = bt_gatt_server_get_mtu(server);\n\n\tdict_append_entry(iter, \"mtu\", DBUS_TYPE_UINT16, &mtu);\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic void append_options(DBusMessageIter *iter, void *user_data)\n{\n\tstruct pending_op *op = user_data;\n\tconst char *path = device_get_path(op->device);\n\tstruct bt_gatt_server *server;\n\tconst char *link;\n\tuint16_t mtu;\n\n\tswitch (op->link_type) {\n\tcase BT_ATT_LINK_BREDR:\n\t\tlink = \"BR/EDR\";\n\t\tbreak;\n\tcase BT_ATT_LINK_LE:\n\t\tlink = \"LE\";\n\t\tbreak;\n\tdefault:\n\t\tlink = NULL;\n\t\tbreak;\n\t}\n\n\tdict_append_entry(iter, \"device\", DBUS_TYPE_OBJECT_PATH, &path);\n\tif (op->offset)\n\t\tdict_append_entry(iter, \"offset\", DBUS_TYPE_UINT16,\n\t\t\t\t\t\t\t&op->offset);\n\tif (link)\n\t\tdict_append_entry(iter, \"link\", DBUS_TYPE_STRING, &link);\n\tif (op->prep_authorize)\n\t\tdict_append_entry(iter, \"prepare-authorize\", DBUS_TYPE_BOOLEAN,\n\t\t\t\t\t\t\t&op->prep_authorize);\n\n\tserver = btd_device_get_gatt_server(op->device);\n\tmtu = bt_gatt_server_get_mtu(server);\n\n\tdict_append_entry(iter, \"mtu\", DBUS_TYPE_UINT16, &mtu);\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_open_container",
          "args": [
            "iter",
            "DBUS_TYPE_ARRAY",
            "DBUS_DICT_ENTRY_BEGIN_CHAR_AS_STRINGDBUS_TYPE_STRING_AS_STRING\n\t\t\t\t\tDBUS_TYPE_VARIANT_AS_STRING\n\t\t\t\t\tDBUS_DICT_ENTRY_END_CHAR_AS_STRING",
            "&dict"
          ],
          "line": 2017
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_close_container",
          "args": [
            "iter",
            "&array"
          ],
          "line": 2015
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_append_fixed_array",
          "args": [
            "&array",
            "DBUS_TYPE_BYTE",
            "&op->data.iov_base",
            "op->data.iov_len"
          ],
          "line": 2013
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_open_container",
          "args": [
            "iter",
            "DBUS_TYPE_ARRAY",
            "\"y\"",
            "&array"
          ],
          "line": 2012
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic void write_setup_cb(DBusMessageIter *iter, void *user_data)\n{\n\tstruct pending_op *op = user_data;\n\tDBusMessageIter array, dict;\n\n\tdbus_message_iter_open_container(iter, DBUS_TYPE_ARRAY, \"y\", &array);\n\tdbus_message_iter_append_fixed_array(&array, DBUS_TYPE_BYTE,\n\t\t\t\t\t&op->data.iov_base, op->data.iov_len);\n\tdbus_message_iter_close_container(iter, &array);\n\n\tdbus_message_iter_open_container(iter, DBUS_TYPE_ARRAY,\n\t\t\t\t\tDBUS_DICT_ENTRY_BEGIN_CHAR_AS_STRING\n\t\t\t\t\tDBUS_TYPE_STRING_AS_STRING\n\t\t\t\t\tDBUS_TYPE_VARIANT_AS_STRING\n\t\t\t\t\tDBUS_DICT_ENTRY_END_CHAR_AS_STRING,\n\t\t\t\t\t&dict);\n\n\tappend_options(&dict, op);\n\n\tdbus_message_iter_close_container(iter, &dict);\n\n\tif (!op->owner_queue) {\n\t\tgatt_db_attribute_write_result(op->attrib, op->id, 0);\n\t\tpending_op_free(op);\n\t}\n}"
  },
  {
    "function_name": "send_read",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
    "lines": "1985-2005",
    "snippet": "static struct pending_op *send_read(struct btd_device *device,\n\t\t\t\t\tstruct gatt_db_attribute *attrib,\n\t\t\t\t\tGDBusProxy *proxy,\n\t\t\t\t\tstruct queue *owner_queue,\n\t\t\t\t\tunsigned int id,\n\t\t\t\t\tuint16_t offset,\n\t\t\t\t\tuint8_t link_type)\n{\n\tstruct pending_op *op;\n\n\top = pending_read_new(device, owner_queue, attrib, id, offset,\n\t\t\t\t\t\t\tlink_type);\n\n\tif (g_dbus_proxy_method_call(proxy, \"ReadValue\", read_setup_cb,\n\t\t\t\tread_reply_cb, op, pending_op_free) == TRUE)\n\t\treturn op;\n\n\tpending_op_free(op);\n\n\treturn NULL;\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"dbus-common.h\"",
      "#include \"gatt-database.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "pending_op_free",
          "args": [
            "op"
          ],
          "line": 2002
        },
        "resolved": true,
        "details": {
          "function_name": "pending_op_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "941-949",
          "snippet": "static void pending_op_free(void *data)\n{\n\tstruct pending_op *op = data;\n\n\tif (op->owner_queue)\n\t\tqueue_remove(op->owner_queue, op);\n\n\tfree(op);\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic void pending_op_free(void *data)\n{\n\tstruct pending_op *op = data;\n\n\tif (op->owner_queue)\n\t\tqueue_remove(op->owner_queue, op);\n\n\tfree(op);\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_dbus_proxy_method_call",
          "args": [
            "proxy",
            "\"ReadValue\"",
            "read_setup_cb",
            "read_reply_cb",
            "op",
            "pending_op_free"
          ],
          "line": 1998
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pending_read_new",
          "args": [
            "device",
            "owner_queue",
            "attrib",
            "id",
            "offset",
            "link_type"
          ],
          "line": 1995
        },
        "resolved": true,
        "details": {
          "function_name": "pending_read_new",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "1911-1930",
          "snippet": "static struct pending_op *pending_read_new(struct btd_device *device,\n\t\t\t\t\tstruct queue *owner_queue,\n\t\t\t\t\tstruct gatt_db_attribute *attrib,\n\t\t\t\t\tunsigned int id, uint16_t offset,\n\t\t\t\t\tuint8_t link_type)\n{\n\tstruct pending_op *op;\n\n\top = new0(struct pending_op, 1);\n\n\top->owner_queue = owner_queue;\n\top->device = device;\n\top->attrib = attrib;\n\top->id = id;\n\top->offset = offset;\n\top->link_type = link_type;\n\tqueue_push_tail(owner_queue, op);\n\n\treturn op;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic struct pending_op *pending_read_new(struct btd_device *device,\n\t\t\t\t\tstruct queue *owner_queue,\n\t\t\t\t\tstruct gatt_db_attribute *attrib,\n\t\t\t\t\tunsigned int id, uint16_t offset,\n\t\t\t\t\tuint8_t link_type)\n{\n\tstruct pending_op *op;\n\n\top = new0(struct pending_op, 1);\n\n\top->owner_queue = owner_queue;\n\top->device = device;\n\top->attrib = attrib;\n\top->id = id;\n\top->offset = offset;\n\top->link_type = link_type;\n\tqueue_push_tail(owner_queue, op);\n\n\treturn op;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic struct pending_op *send_read(struct btd_device *device,\n\t\t\t\t\tstruct gatt_db_attribute *attrib,\n\t\t\t\t\tGDBusProxy *proxy,\n\t\t\t\t\tstruct queue *owner_queue,\n\t\t\t\t\tunsigned int id,\n\t\t\t\t\tuint16_t offset,\n\t\t\t\t\tuint8_t link_type)\n{\n\tstruct pending_op *op;\n\n\top = pending_read_new(device, owner_queue, attrib, id, offset,\n\t\t\t\t\t\t\tlink_type);\n\n\tif (g_dbus_proxy_method_call(proxy, \"ReadValue\", read_setup_cb,\n\t\t\t\tread_reply_cb, op, pending_op_free) == TRUE)\n\t\treturn op;\n\n\tpending_op_free(op);\n\n\treturn NULL;\n}"
  },
  {
    "function_name": "read_setup_cb",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
    "lines": "1968-1983",
    "snippet": "static void read_setup_cb(DBusMessageIter *iter, void *user_data)\n{\n\tstruct pending_op *op = user_data;\n\tDBusMessageIter dict;\n\n\tdbus_message_iter_open_container(iter, DBUS_TYPE_ARRAY,\n\t\t\t\t\tDBUS_DICT_ENTRY_BEGIN_CHAR_AS_STRING\n\t\t\t\t\tDBUS_TYPE_STRING_AS_STRING\n\t\t\t\t\tDBUS_TYPE_VARIANT_AS_STRING\n\t\t\t\t\tDBUS_DICT_ENTRY_END_CHAR_AS_STRING,\n\t\t\t\t\t&dict);\n\n\tappend_options(&dict, op);\n\n\tdbus_message_iter_close_container(iter, &dict);\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"dbus-common.h\"",
      "#include \"gatt-database.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "dbus_message_iter_close_container",
          "args": [
            "iter",
            "&dict"
          ],
          "line": 1982
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "append_options",
          "args": [
            "&dict",
            "op"
          ],
          "line": 1980
        },
        "resolved": true,
        "details": {
          "function_name": "append_options",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "1932-1966",
          "snippet": "static void append_options(DBusMessageIter *iter, void *user_data)\n{\n\tstruct pending_op *op = user_data;\n\tconst char *path = device_get_path(op->device);\n\tstruct bt_gatt_server *server;\n\tconst char *link;\n\tuint16_t mtu;\n\n\tswitch (op->link_type) {\n\tcase BT_ATT_LINK_BREDR:\n\t\tlink = \"BR/EDR\";\n\t\tbreak;\n\tcase BT_ATT_LINK_LE:\n\t\tlink = \"LE\";\n\t\tbreak;\n\tdefault:\n\t\tlink = NULL;\n\t\tbreak;\n\t}\n\n\tdict_append_entry(iter, \"device\", DBUS_TYPE_OBJECT_PATH, &path);\n\tif (op->offset)\n\t\tdict_append_entry(iter, \"offset\", DBUS_TYPE_UINT16,\n\t\t\t\t\t\t\t&op->offset);\n\tif (link)\n\t\tdict_append_entry(iter, \"link\", DBUS_TYPE_STRING, &link);\n\tif (op->prep_authorize)\n\t\tdict_append_entry(iter, \"prepare-authorize\", DBUS_TYPE_BOOLEAN,\n\t\t\t\t\t\t\t&op->prep_authorize);\n\n\tserver = btd_device_get_gatt_server(op->device);\n\tmtu = bt_gatt_server_get_mtu(server);\n\n\tdict_append_entry(iter, \"mtu\", DBUS_TYPE_UINT16, &mtu);\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic void append_options(DBusMessageIter *iter, void *user_data)\n{\n\tstruct pending_op *op = user_data;\n\tconst char *path = device_get_path(op->device);\n\tstruct bt_gatt_server *server;\n\tconst char *link;\n\tuint16_t mtu;\n\n\tswitch (op->link_type) {\n\tcase BT_ATT_LINK_BREDR:\n\t\tlink = \"BR/EDR\";\n\t\tbreak;\n\tcase BT_ATT_LINK_LE:\n\t\tlink = \"LE\";\n\t\tbreak;\n\tdefault:\n\t\tlink = NULL;\n\t\tbreak;\n\t}\n\n\tdict_append_entry(iter, \"device\", DBUS_TYPE_OBJECT_PATH, &path);\n\tif (op->offset)\n\t\tdict_append_entry(iter, \"offset\", DBUS_TYPE_UINT16,\n\t\t\t\t\t\t\t&op->offset);\n\tif (link)\n\t\tdict_append_entry(iter, \"link\", DBUS_TYPE_STRING, &link);\n\tif (op->prep_authorize)\n\t\tdict_append_entry(iter, \"prepare-authorize\", DBUS_TYPE_BOOLEAN,\n\t\t\t\t\t\t\t&op->prep_authorize);\n\n\tserver = btd_device_get_gatt_server(op->device);\n\tmtu = bt_gatt_server_get_mtu(server);\n\n\tdict_append_entry(iter, \"mtu\", DBUS_TYPE_UINT16, &mtu);\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_open_container",
          "args": [
            "iter",
            "DBUS_TYPE_ARRAY",
            "DBUS_DICT_ENTRY_BEGIN_CHAR_AS_STRINGDBUS_TYPE_STRING_AS_STRING\n\t\t\t\t\tDBUS_TYPE_VARIANT_AS_STRING\n\t\t\t\t\tDBUS_DICT_ENTRY_END_CHAR_AS_STRING",
            "&dict"
          ],
          "line": 1973
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic void read_setup_cb(DBusMessageIter *iter, void *user_data)\n{\n\tstruct pending_op *op = user_data;\n\tDBusMessageIter dict;\n\n\tdbus_message_iter_open_container(iter, DBUS_TYPE_ARRAY,\n\t\t\t\t\tDBUS_DICT_ENTRY_BEGIN_CHAR_AS_STRING\n\t\t\t\t\tDBUS_TYPE_STRING_AS_STRING\n\t\t\t\t\tDBUS_TYPE_VARIANT_AS_STRING\n\t\t\t\t\tDBUS_DICT_ENTRY_END_CHAR_AS_STRING,\n\t\t\t\t\t&dict);\n\n\tappend_options(&dict, op);\n\n\tdbus_message_iter_close_container(iter, &dict);\n}"
  },
  {
    "function_name": "append_options",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
    "lines": "1932-1966",
    "snippet": "static void append_options(DBusMessageIter *iter, void *user_data)\n{\n\tstruct pending_op *op = user_data;\n\tconst char *path = device_get_path(op->device);\n\tstruct bt_gatt_server *server;\n\tconst char *link;\n\tuint16_t mtu;\n\n\tswitch (op->link_type) {\n\tcase BT_ATT_LINK_BREDR:\n\t\tlink = \"BR/EDR\";\n\t\tbreak;\n\tcase BT_ATT_LINK_LE:\n\t\tlink = \"LE\";\n\t\tbreak;\n\tdefault:\n\t\tlink = NULL;\n\t\tbreak;\n\t}\n\n\tdict_append_entry(iter, \"device\", DBUS_TYPE_OBJECT_PATH, &path);\n\tif (op->offset)\n\t\tdict_append_entry(iter, \"offset\", DBUS_TYPE_UINT16,\n\t\t\t\t\t\t\t&op->offset);\n\tif (link)\n\t\tdict_append_entry(iter, \"link\", DBUS_TYPE_STRING, &link);\n\tif (op->prep_authorize)\n\t\tdict_append_entry(iter, \"prepare-authorize\", DBUS_TYPE_BOOLEAN,\n\t\t\t\t\t\t\t&op->prep_authorize);\n\n\tserver = btd_device_get_gatt_server(op->device);\n\tmtu = bt_gatt_server_get_mtu(server);\n\n\tdict_append_entry(iter, \"mtu\", DBUS_TYPE_UINT16, &mtu);\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"dbus-common.h\"",
      "#include \"gatt-database.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "dict_append_entry",
          "args": [
            "iter",
            "\"mtu\"",
            "DBUS_TYPE_UINT16",
            "&mtu"
          ],
          "line": 1965
        },
        "resolved": true,
        "details": {
          "function_name": "dict_append_entry",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/dbus-common.c",
          "lines": "44-48",
          "snippet": "void dict_append_entry(DBusMessageIter *dict,\n\t\t\tconst char *key, int type, void *val)\n{\n\tg_dbus_dict_append_entry(dict, key, type, val);\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <stdint.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <stdint.h>\n#include <stdio.h>\n#include <config.h>\n\nvoid dict_append_entry(DBusMessageIter *dict,\n\t\t\tconst char *key, int type, void *val)\n{\n\tg_dbus_dict_append_entry(dict, key, type, val);\n}"
        }
      },
      {
        "call_info": {
          "callee": "bt_gatt_server_get_mtu",
          "args": [
            "server"
          ],
          "line": 1963
        },
        "resolved": true,
        "details": {
          "function_name": "bt_gatt_server_get_mtu",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-server.c",
          "lines": "1583-1589",
          "snippet": "uint16_t bt_gatt_server_get_mtu(struct bt_gatt_server *server)\n{\n\tif (!server || !server->att)\n\t\treturn 0;\n\n\treturn bt_att_get_mtu(server->att);\n}",
          "includes": [
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-helpers.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include \"src/shared/att.h\"",
            "#include <errno.h>",
            "#include <sys/uio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/gatt-helpers.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include \"src/shared/att.h\"\n#include <errno.h>\n#include <sys/uio.h>\n#include <config.h>\n\nuint16_t bt_gatt_server_get_mtu(struct bt_gatt_server *server)\n{\n\tif (!server || !server->att)\n\t\treturn 0;\n\n\treturn bt_att_get_mtu(server->att);\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_device_get_gatt_server",
          "args": [
            "op->device"
          ],
          "line": 1962
        },
        "resolved": true,
        "details": {
          "function_name": "btd_device_get_gatt_server",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "6236-6242",
          "snippet": "struct bt_gatt_server *btd_device_get_gatt_server(struct btd_device *device)\n{\n\tif (!device)\n\t\treturn NULL;\n\n\treturn device->server;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstruct bt_gatt_server *btd_device_get_gatt_server(struct btd_device *device)\n{\n\tif (!device)\n\t\treturn NULL;\n\n\treturn device->server;\n}"
        }
      },
      {
        "call_info": {
          "callee": "device_get_path",
          "args": [
            "op->device"
          ],
          "line": 1935
        },
        "resolved": true,
        "details": {
          "function_name": "device_get_path",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "5323-5329",
          "snippet": "const char *device_get_path(const struct btd_device *device)\n{\n\tif (!device)\n\t\treturn NULL;\n\n\treturn device->path;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nconst char *device_get_path(const struct btd_device *device)\n{\n\tif (!device)\n\t\treturn NULL;\n\n\treturn device->path;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic void append_options(DBusMessageIter *iter, void *user_data)\n{\n\tstruct pending_op *op = user_data;\n\tconst char *path = device_get_path(op->device);\n\tstruct bt_gatt_server *server;\n\tconst char *link;\n\tuint16_t mtu;\n\n\tswitch (op->link_type) {\n\tcase BT_ATT_LINK_BREDR:\n\t\tlink = \"BR/EDR\";\n\t\tbreak;\n\tcase BT_ATT_LINK_LE:\n\t\tlink = \"LE\";\n\t\tbreak;\n\tdefault:\n\t\tlink = NULL;\n\t\tbreak;\n\t}\n\n\tdict_append_entry(iter, \"device\", DBUS_TYPE_OBJECT_PATH, &path);\n\tif (op->offset)\n\t\tdict_append_entry(iter, \"offset\", DBUS_TYPE_UINT16,\n\t\t\t\t\t\t\t&op->offset);\n\tif (link)\n\t\tdict_append_entry(iter, \"link\", DBUS_TYPE_STRING, &link);\n\tif (op->prep_authorize)\n\t\tdict_append_entry(iter, \"prepare-authorize\", DBUS_TYPE_BOOLEAN,\n\t\t\t\t\t\t\t&op->prep_authorize);\n\n\tserver = btd_device_get_gatt_server(op->device);\n\tmtu = bt_gatt_server_get_mtu(server);\n\n\tdict_append_entry(iter, \"mtu\", DBUS_TYPE_UINT16, &mtu);\n}"
  },
  {
    "function_name": "pending_read_new",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
    "lines": "1911-1930",
    "snippet": "static struct pending_op *pending_read_new(struct btd_device *device,\n\t\t\t\t\tstruct queue *owner_queue,\n\t\t\t\t\tstruct gatt_db_attribute *attrib,\n\t\t\t\t\tunsigned int id, uint16_t offset,\n\t\t\t\t\tuint8_t link_type)\n{\n\tstruct pending_op *op;\n\n\top = new0(struct pending_op, 1);\n\n\top->owner_queue = owner_queue;\n\top->device = device;\n\top->attrib = attrib;\n\top->id = id;\n\top->offset = offset;\n\top->link_type = link_type;\n\tqueue_push_tail(owner_queue, op);\n\n\treturn op;\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"dbus-common.h\"",
      "#include \"gatt-database.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "queue_push_tail",
          "args": [
            "owner_queue",
            "op"
          ],
          "line": 1927
        },
        "resolved": true,
        "details": {
          "function_name": "queue_push_tail",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "88-108",
          "snippet": "bool queue_push_tail(struct queue *queue, void *data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn false;\n\n\tentry = queue_entry_new(data);\n\n\tif (queue->tail)\n\t\tqueue->tail->next = entry;\n\n\tqueue->tail = entry;\n\n\tif (!queue->head)\n\t\tqueue->head = entry;\n\n\tqueue->entries++;\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nbool queue_push_tail(struct queue *queue, void *data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn false;\n\n\tentry = queue_entry_new(data);\n\n\tif (queue->tail)\n\t\tqueue->tail->next = entry;\n\n\tqueue->tail = entry;\n\n\tif (!queue->head)\n\t\tqueue->head = entry;\n\n\tqueue->entries++;\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "new0",
          "args": [
            "structpending_op",
            "1"
          ],
          "line": 1919
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic struct pending_op *pending_read_new(struct btd_device *device,\n\t\t\t\t\tstruct queue *owner_queue,\n\t\t\t\t\tstruct gatt_db_attribute *attrib,\n\t\t\t\t\tunsigned int id, uint16_t offset,\n\t\t\t\t\tuint8_t link_type)\n{\n\tstruct pending_op *op;\n\n\top = new0(struct pending_op, 1);\n\n\top->owner_queue = owner_queue;\n\top->device = device;\n\top->attrib = attrib;\n\top->id = id;\n\top->offset = offset;\n\top->link_type = link_type;\n\tqueue_push_tail(owner_queue, op);\n\n\treturn op;\n}"
  },
  {
    "function_name": "read_reply_cb",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
    "lines": "1857-1909",
    "snippet": "static void read_reply_cb(DBusMessage *message, void *user_data)\n{\n\tstruct pending_op *op = user_data;\n\tDBusError err;\n\tDBusMessageIter iter, array;\n\tuint8_t ecode = 0;\n\tuint8_t *value = NULL;\n\tint len = 0;\n\n\tif (!op->owner_queue) {\n\t\tDBG(\"Pending read was canceled when object got removed\");\n\t\treturn;\n\t}\n\n\tdbus_error_init(&err);\n\n\tif (dbus_set_error_from_message(&err, message) == TRUE) {\n\t\tDBG(\"Failed to read value: %s: %s\", err.name, err.message);\n\t\tecode = dbus_error_to_att_ecode(err.name);\n\t\tecode = ecode ? ecode : BT_ATT_ERROR_READ_NOT_PERMITTED;\n\t\tdbus_error_free(&err);\n\t\tgoto done;\n\t}\n\n\tdbus_message_iter_init(message, &iter);\n\n\tif (dbus_message_iter_get_arg_type(&iter) != DBUS_TYPE_ARRAY) {\n\t\t/*\n\t\t * Return not supported for this, as the external app basically\n\t\t * doesn't properly support reading from this characteristic.\n\t\t */\n\t\tecode = BT_ATT_ERROR_REQUEST_NOT_SUPPORTED;\n\t\terror(\"Invalid return value received for \\\"ReadValue\\\"\");\n\t\tgoto done;\n\t}\n\n\tdbus_message_iter_recurse(&iter, &array);\n\tdbus_message_iter_get_fixed_array(&array, &value, &len);\n\n\tif (len < 0) {\n\t\tecode = BT_ATT_ERROR_REQUEST_NOT_SUPPORTED;\n\t\tvalue = NULL;\n\t\tlen = 0;\n\t\tgoto done;\n\t}\n\n\t/* Truncate the value if it's too large */\n\tlen = MIN(BT_ATT_MAX_VALUE_LEN, len);\n\tvalue = len ? value : NULL;\n\ndone:\n\tgatt_db_attribute_read_result(op->attrib, op->id, ecode, value, len);\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"dbus-common.h\"",
      "#include \"gatt-database.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "gatt_db_attribute_read_result",
          "args": [
            "op->attrib",
            "op->id",
            "ecode",
            "value",
            "len"
          ],
          "line": 1908
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_attribute_read_result",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "1773-1790",
          "snippet": "bool gatt_db_attribute_read_result(struct gatt_db_attribute *attrib,\n\t\t\t\t\tunsigned int id, int err,\n\t\t\t\t\tconst uint8_t *value, size_t length)\n{\n\tstruct pending_read *p;\n\n\tif (!attrib || !id)\n\t\treturn false;\n\n\tp = queue_remove_if(attrib->pending_reads, find_pending,\n\t\t\t\t\t\t\tUINT_TO_PTR(id));\n\tif (!p)\n\t\treturn false;\n\n\tpending_read_result(p, err, value, length);\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nbool gatt_db_attribute_read_result(struct gatt_db_attribute *attrib,\n\t\t\t\t\tunsigned int id, int err,\n\t\t\t\t\tconst uint8_t *value, size_t length)\n{\n\tstruct pending_read *p;\n\n\tif (!attrib || !id)\n\t\treturn false;\n\n\tp = queue_remove_if(attrib->pending_reads, find_pending,\n\t\t\t\t\t\t\tUINT_TO_PTR(id));\n\tif (!p)\n\t\treturn false;\n\n\tpending_read_result(p, err, value, length);\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "MIN",
          "args": [
            "BT_ATT_MAX_VALUE_LEN",
            "len"
          ],
          "line": 1904
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_get_fixed_array",
          "args": [
            "&array",
            "&value",
            "&len"
          ],
          "line": 1894
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_recurse",
          "args": [
            "&iter",
            "&array"
          ],
          "line": 1893
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"Invalid return value received for \\\"ReadValue\\\"\""
          ],
          "line": 1889
        },
        "resolved": true,
        "details": {
          "function_name": "dbus_error_to_att_ecode",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "1833-1855",
          "snippet": "static uint8_t dbus_error_to_att_ecode(const char *error_name)\n{\n\n\tif (strcmp(error_name, \"org.bluez.Error.Failed\") == 0)\n\t\treturn 0x80;  /* For now return this \"application error\" */\n\n\tif (strcmp(error_name, \"org.bluez.Error.NotSupported\") == 0)\n\t\treturn BT_ATT_ERROR_REQUEST_NOT_SUPPORTED;\n\n\tif (strcmp(error_name, \"org.bluez.Error.NotAuthorized\") == 0)\n\t\treturn BT_ATT_ERROR_AUTHORIZATION;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InvalidValueLength\") == 0)\n\t\treturn BT_ATT_ERROR_INVALID_ATTRIBUTE_VALUE_LEN;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InvalidOffset\") == 0)\n\t\treturn BT_ATT_ERROR_INVALID_OFFSET;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InProgress\") == 0)\n\t\treturn BT_ERROR_ALREADY_IN_PROGRESS;\n\n\treturn 0;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic uint8_t dbus_error_to_att_ecode(const char *error_name)\n{\n\n\tif (strcmp(error_name, \"org.bluez.Error.Failed\") == 0)\n\t\treturn 0x80;  /* For now return this \"application error\" */\n\n\tif (strcmp(error_name, \"org.bluez.Error.NotSupported\") == 0)\n\t\treturn BT_ATT_ERROR_REQUEST_NOT_SUPPORTED;\n\n\tif (strcmp(error_name, \"org.bluez.Error.NotAuthorized\") == 0)\n\t\treturn BT_ATT_ERROR_AUTHORIZATION;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InvalidValueLength\") == 0)\n\t\treturn BT_ATT_ERROR_INVALID_ATTRIBUTE_VALUE_LEN;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InvalidOffset\") == 0)\n\t\treturn BT_ATT_ERROR_INVALID_OFFSET;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InProgress\") == 0)\n\t\treturn BT_ERROR_ALREADY_IN_PROGRESS;\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_get_arg_type",
          "args": [
            "&iter"
          ],
          "line": 1883
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_init",
          "args": [
            "message",
            "&iter"
          ],
          "line": 1881
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_error_free",
          "args": [
            "&err"
          ],
          "line": 1877
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"Failed to read value: %s: %s\"",
            "err.name",
            "err.message"
          ],
          "line": 1874
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_set_error_from_message",
          "args": [
            "&err",
            "message"
          ],
          "line": 1873
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_error_init",
          "args": [
            "&err"
          ],
          "line": 1871
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"Pending read was canceled when object got removed\""
          ],
          "line": 1867
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic void read_reply_cb(DBusMessage *message, void *user_data)\n{\n\tstruct pending_op *op = user_data;\n\tDBusError err;\n\tDBusMessageIter iter, array;\n\tuint8_t ecode = 0;\n\tuint8_t *value = NULL;\n\tint len = 0;\n\n\tif (!op->owner_queue) {\n\t\tDBG(\"Pending read was canceled when object got removed\");\n\t\treturn;\n\t}\n\n\tdbus_error_init(&err);\n\n\tif (dbus_set_error_from_message(&err, message) == TRUE) {\n\t\tDBG(\"Failed to read value: %s: %s\", err.name, err.message);\n\t\tecode = dbus_error_to_att_ecode(err.name);\n\t\tecode = ecode ? ecode : BT_ATT_ERROR_READ_NOT_PERMITTED;\n\t\tdbus_error_free(&err);\n\t\tgoto done;\n\t}\n\n\tdbus_message_iter_init(message, &iter);\n\n\tif (dbus_message_iter_get_arg_type(&iter) != DBUS_TYPE_ARRAY) {\n\t\t/*\n\t\t * Return not supported for this, as the external app basically\n\t\t * doesn't properly support reading from this characteristic.\n\t\t */\n\t\tecode = BT_ATT_ERROR_REQUEST_NOT_SUPPORTED;\n\t\terror(\"Invalid return value received for \\\"ReadValue\\\"\");\n\t\tgoto done;\n\t}\n\n\tdbus_message_iter_recurse(&iter, &array);\n\tdbus_message_iter_get_fixed_array(&array, &value, &len);\n\n\tif (len < 0) {\n\t\tecode = BT_ATT_ERROR_REQUEST_NOT_SUPPORTED;\n\t\tvalue = NULL;\n\t\tlen = 0;\n\t\tgoto done;\n\t}\n\n\t/* Truncate the value if it's too large */\n\tlen = MIN(BT_ATT_MAX_VALUE_LEN, len);\n\tvalue = len ? value : NULL;\n\ndone:\n\tgatt_db_attribute_read_result(op->attrib, op->id, ecode, value, len);\n}"
  },
  {
    "function_name": "dbus_error_to_att_ecode",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
    "lines": "1833-1855",
    "snippet": "static uint8_t dbus_error_to_att_ecode(const char *error_name)\n{\n\n\tif (strcmp(error_name, \"org.bluez.Error.Failed\") == 0)\n\t\treturn 0x80;  /* For now return this \"application error\" */\n\n\tif (strcmp(error_name, \"org.bluez.Error.NotSupported\") == 0)\n\t\treturn BT_ATT_ERROR_REQUEST_NOT_SUPPORTED;\n\n\tif (strcmp(error_name, \"org.bluez.Error.NotAuthorized\") == 0)\n\t\treturn BT_ATT_ERROR_AUTHORIZATION;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InvalidValueLength\") == 0)\n\t\treturn BT_ATT_ERROR_INVALID_ATTRIBUTE_VALUE_LEN;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InvalidOffset\") == 0)\n\t\treturn BT_ATT_ERROR_INVALID_OFFSET;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InProgress\") == 0)\n\t\treturn BT_ERROR_ALREADY_IN_PROGRESS;\n\n\treturn 0;\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"dbus-common.h\"",
      "#include \"gatt-database.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "error_name",
            "\"org.bluez.Error.InProgress\""
          ],
          "line": 1851
        },
        "resolved": true,
        "details": {
          "function_name": "g_strcmp",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "1927-1930",
          "snippet": "static gint g_strcmp(gconstpointer a, gconstpointer b)\n{\n\treturn strcmp(a, b);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic gint g_strcmp(gconstpointer a, gconstpointer b)\n{\n\treturn strcmp(a, b);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic uint8_t dbus_error_to_att_ecode(const char *error_name)\n{\n\n\tif (strcmp(error_name, \"org.bluez.Error.Failed\") == 0)\n\t\treturn 0x80;  /* For now return this \"application error\" */\n\n\tif (strcmp(error_name, \"org.bluez.Error.NotSupported\") == 0)\n\t\treturn BT_ATT_ERROR_REQUEST_NOT_SUPPORTED;\n\n\tif (strcmp(error_name, \"org.bluez.Error.NotAuthorized\") == 0)\n\t\treturn BT_ATT_ERROR_AUTHORIZATION;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InvalidValueLength\") == 0)\n\t\treturn BT_ATT_ERROR_INVALID_ATTRIBUTE_VALUE_LEN;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InvalidOffset\") == 0)\n\t\treturn BT_ATT_ERROR_INVALID_OFFSET;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InProgress\") == 0)\n\t\treturn BT_ERROR_ALREADY_IN_PROGRESS;\n\n\treturn 0;\n}"
  },
  {
    "function_name": "parse_primary",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
    "lines": "1815-1831",
    "snippet": "static bool parse_primary(GDBusProxy *proxy, bool *primary)\n{\n\tDBusMessageIter iter;\n\tdbus_bool_t val;\n\n\tif (!g_dbus_proxy_get_property(proxy, \"Primary\", &iter))\n\t\treturn false;\n\n\tif (dbus_message_iter_get_arg_type(&iter) != DBUS_TYPE_BOOLEAN)\n\t\treturn false;\n\n\tdbus_message_iter_get_basic(&iter, &val);\n\n\t*primary = val;\n\n\treturn true;\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"dbus-common.h\"",
      "#include \"gatt-database.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "dbus_message_iter_get_basic",
          "args": [
            "&iter",
            "&val"
          ],
          "line": 1826
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_get_arg_type",
          "args": [
            "&iter"
          ],
          "line": 1823
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_dbus_proxy_get_property",
          "args": [
            "proxy",
            "\"Primary\"",
            "&iter"
          ],
          "line": 1820
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic bool parse_primary(GDBusProxy *proxy, bool *primary)\n{\n\tDBusMessageIter iter;\n\tdbus_bool_t val;\n\n\tif (!g_dbus_proxy_get_property(proxy, \"Primary\", &iter))\n\t\treturn false;\n\n\tif (dbus_message_iter_get_arg_type(&iter) != DBUS_TYPE_BOOLEAN)\n\t\treturn false;\n\n\tdbus_message_iter_get_basic(&iter, &val);\n\n\t*primary = val;\n\n\treturn true;\n}"
  },
  {
    "function_name": "parse_includes",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
    "lines": "1781-1813",
    "snippet": "static bool parse_includes(GDBusProxy *proxy, struct external_service *service)\n{\n\tDBusMessageIter iter;\n\tDBusMessageIter array;\n\tchar *obj;\n\n\t/* Includes property is optional */\n\tif (!g_dbus_proxy_get_property(proxy, \"Includes\", &iter))\n\t\treturn true;\n\n\tif (dbus_message_iter_get_arg_type(&iter) != DBUS_TYPE_ARRAY)\n\t\treturn false;\n\n\tdbus_message_iter_recurse(&iter, &array);\n\n\tdo {\n\t\tif (dbus_message_iter_get_arg_type(&array) !=\n\t\t\t\t\t\tDBUS_TYPE_OBJECT_PATH)\n\t\t\treturn false;\n\n\t\tdbus_message_iter_get_basic(&array, &obj);\n\n\t\tif (!queue_push_tail(service->includes, obj)) {\n\t\t\terror(\"Failed to add Includes path in queue\\n\");\n\t\t\treturn false;\n\n\t\t}\n\n\t\tincr_attr_count(service, 1);\n\t} while (dbus_message_iter_next(&array));\n\n\treturn true;\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"dbus-common.h\"",
      "#include \"gatt-database.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "dbus_message_iter_next",
          "args": [
            "&array"
          ],
          "line": 1810
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "incr_attr_count",
          "args": [
            "service",
            "1"
          ],
          "line": 1809
        },
        "resolved": true,
        "details": {
          "function_name": "incr_attr_count",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "1370-1378",
          "snippet": "static bool incr_attr_count(struct external_service *service, uint16_t incr)\n{\n\tif (service->attr_cnt > UINT16_MAX - incr)\n\t\treturn false;\n\n\tservice->attr_cnt += incr;\n\n\treturn true;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic bool incr_attr_count(struct external_service *service, uint16_t incr)\n{\n\tif (service->attr_cnt > UINT16_MAX - incr)\n\t\treturn false;\n\n\tservice->attr_cnt += incr;\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"Failed to add Includes path in queue\\n\""
          ],
          "line": 1804
        },
        "resolved": true,
        "details": {
          "function_name": "dbus_error_to_att_ecode",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "1833-1855",
          "snippet": "static uint8_t dbus_error_to_att_ecode(const char *error_name)\n{\n\n\tif (strcmp(error_name, \"org.bluez.Error.Failed\") == 0)\n\t\treturn 0x80;  /* For now return this \"application error\" */\n\n\tif (strcmp(error_name, \"org.bluez.Error.NotSupported\") == 0)\n\t\treturn BT_ATT_ERROR_REQUEST_NOT_SUPPORTED;\n\n\tif (strcmp(error_name, \"org.bluez.Error.NotAuthorized\") == 0)\n\t\treturn BT_ATT_ERROR_AUTHORIZATION;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InvalidValueLength\") == 0)\n\t\treturn BT_ATT_ERROR_INVALID_ATTRIBUTE_VALUE_LEN;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InvalidOffset\") == 0)\n\t\treturn BT_ATT_ERROR_INVALID_OFFSET;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InProgress\") == 0)\n\t\treturn BT_ERROR_ALREADY_IN_PROGRESS;\n\n\treturn 0;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic uint8_t dbus_error_to_att_ecode(const char *error_name)\n{\n\n\tif (strcmp(error_name, \"org.bluez.Error.Failed\") == 0)\n\t\treturn 0x80;  /* For now return this \"application error\" */\n\n\tif (strcmp(error_name, \"org.bluez.Error.NotSupported\") == 0)\n\t\treturn BT_ATT_ERROR_REQUEST_NOT_SUPPORTED;\n\n\tif (strcmp(error_name, \"org.bluez.Error.NotAuthorized\") == 0)\n\t\treturn BT_ATT_ERROR_AUTHORIZATION;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InvalidValueLength\") == 0)\n\t\treturn BT_ATT_ERROR_INVALID_ATTRIBUTE_VALUE_LEN;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InvalidOffset\") == 0)\n\t\treturn BT_ATT_ERROR_INVALID_OFFSET;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InProgress\") == 0)\n\t\treturn BT_ERROR_ALREADY_IN_PROGRESS;\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_push_tail",
          "args": [
            "service->includes",
            "obj"
          ],
          "line": 1803
        },
        "resolved": true,
        "details": {
          "function_name": "queue_push_tail",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "88-108",
          "snippet": "bool queue_push_tail(struct queue *queue, void *data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn false;\n\n\tentry = queue_entry_new(data);\n\n\tif (queue->tail)\n\t\tqueue->tail->next = entry;\n\n\tqueue->tail = entry;\n\n\tif (!queue->head)\n\t\tqueue->head = entry;\n\n\tqueue->entries++;\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nbool queue_push_tail(struct queue *queue, void *data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn false;\n\n\tentry = queue_entry_new(data);\n\n\tif (queue->tail)\n\t\tqueue->tail->next = entry;\n\n\tqueue->tail = entry;\n\n\tif (!queue->head)\n\t\tqueue->head = entry;\n\n\tqueue->entries++;\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_get_basic",
          "args": [
            "&array",
            "&obj"
          ],
          "line": 1801
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_get_arg_type",
          "args": [
            "&array"
          ],
          "line": 1797
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_recurse",
          "args": [
            "&iter",
            "&array"
          ],
          "line": 1794
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_get_arg_type",
          "args": [
            "&iter"
          ],
          "line": 1791
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_dbus_proxy_get_property",
          "args": [
            "proxy",
            "\"Includes\"",
            "&iter"
          ],
          "line": 1788
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic bool parse_includes(GDBusProxy *proxy, struct external_service *service)\n{\n\tDBusMessageIter iter;\n\tDBusMessageIter array;\n\tchar *obj;\n\n\t/* Includes property is optional */\n\tif (!g_dbus_proxy_get_property(proxy, \"Includes\", &iter))\n\t\treturn true;\n\n\tif (dbus_message_iter_get_arg_type(&iter) != DBUS_TYPE_ARRAY)\n\t\treturn false;\n\n\tdbus_message_iter_recurse(&iter, &array);\n\n\tdo {\n\t\tif (dbus_message_iter_get_arg_type(&array) !=\n\t\t\t\t\t\tDBUS_TYPE_OBJECT_PATH)\n\t\t\treturn false;\n\n\t\tdbus_message_iter_get_basic(&array, &obj);\n\n\t\tif (!queue_push_tail(service->includes, obj)) {\n\t\t\terror(\"Failed to add Includes path in queue\\n\");\n\t\t\treturn false;\n\n\t\t}\n\n\t\tincr_attr_count(service, 1);\n\t} while (dbus_message_iter_next(&array));\n\n\treturn true;\n}"
  },
  {
    "function_name": "parse_uuid",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
    "lines": "1748-1779",
    "snippet": "static bool parse_uuid(GDBusProxy *proxy, bt_uuid_t *uuid)\n{\n\tDBusMessageIter iter;\n\tbt_uuid_t tmp;\n\tconst char *uuidstr;\n\n\tif (!g_dbus_proxy_get_property(proxy, \"UUID\", &iter))\n\t\treturn false;\n\n\tif (dbus_message_iter_get_arg_type(&iter) != DBUS_TYPE_STRING)\n\t\treturn false;\n\n\tdbus_message_iter_get_basic(&iter, &uuidstr);\n\n\tif (bt_string_to_uuid(uuid, uuidstr) < 0)\n\t\treturn false;\n\n\t/* GAP & GATT services are created and managed by BlueZ */\n\tbt_uuid16_create(&tmp, UUID_GAP);\n\tif (!bt_uuid_cmp(&tmp, uuid)) {\n\t\terror(\"GAP service must be handled by BlueZ\");\n\t\treturn false;\n\t}\n\n\tbt_uuid16_create(&tmp, UUID_GATT);\n\tif (!bt_uuid_cmp(&tmp, uuid)) {\n\t\terror(\"GATT service must be handled by BlueZ\");\n\t\treturn false;\n\t}\n\n\treturn true;\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"dbus-common.h\"",
      "#include \"gatt-database.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define UUID_GATT\t0x1801",
      "#define UUID_GAP\t0x1800"
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"GATT service must be handled by BlueZ\""
          ],
          "line": 1774
        },
        "resolved": true,
        "details": {
          "function_name": "dbus_error_to_att_ecode",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "1833-1855",
          "snippet": "static uint8_t dbus_error_to_att_ecode(const char *error_name)\n{\n\n\tif (strcmp(error_name, \"org.bluez.Error.Failed\") == 0)\n\t\treturn 0x80;  /* For now return this \"application error\" */\n\n\tif (strcmp(error_name, \"org.bluez.Error.NotSupported\") == 0)\n\t\treturn BT_ATT_ERROR_REQUEST_NOT_SUPPORTED;\n\n\tif (strcmp(error_name, \"org.bluez.Error.NotAuthorized\") == 0)\n\t\treturn BT_ATT_ERROR_AUTHORIZATION;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InvalidValueLength\") == 0)\n\t\treturn BT_ATT_ERROR_INVALID_ATTRIBUTE_VALUE_LEN;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InvalidOffset\") == 0)\n\t\treturn BT_ATT_ERROR_INVALID_OFFSET;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InProgress\") == 0)\n\t\treturn BT_ERROR_ALREADY_IN_PROGRESS;\n\n\treturn 0;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic uint8_t dbus_error_to_att_ecode(const char *error_name)\n{\n\n\tif (strcmp(error_name, \"org.bluez.Error.Failed\") == 0)\n\t\treturn 0x80;  /* For now return this \"application error\" */\n\n\tif (strcmp(error_name, \"org.bluez.Error.NotSupported\") == 0)\n\t\treturn BT_ATT_ERROR_REQUEST_NOT_SUPPORTED;\n\n\tif (strcmp(error_name, \"org.bluez.Error.NotAuthorized\") == 0)\n\t\treturn BT_ATT_ERROR_AUTHORIZATION;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InvalidValueLength\") == 0)\n\t\treturn BT_ATT_ERROR_INVALID_ATTRIBUTE_VALUE_LEN;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InvalidOffset\") == 0)\n\t\treturn BT_ATT_ERROR_INVALID_OFFSET;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InProgress\") == 0)\n\t\treturn BT_ERROR_ALREADY_IN_PROGRESS;\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "bt_uuid_cmp",
          "args": [
            "&tmp",
            "uuid"
          ],
          "line": 1773
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bt_uuid16_create",
          "args": [
            "&tmp",
            "UUID_GATT"
          ],
          "line": 1772
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bt_uuid_cmp",
          "args": [
            "&tmp",
            "uuid"
          ],
          "line": 1767
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bt_uuid16_create",
          "args": [
            "&tmp",
            "UUID_GAP"
          ],
          "line": 1766
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bt_string_to_uuid",
          "args": [
            "uuid",
            "uuidstr"
          ],
          "line": 1762
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_get_basic",
          "args": [
            "&iter",
            "&uuidstr"
          ],
          "line": 1760
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_get_arg_type",
          "args": [
            "&iter"
          ],
          "line": 1757
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_dbus_proxy_get_property",
          "args": [
            "proxy",
            "\"UUID\"",
            "&iter"
          ],
          "line": 1754
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\n#define UUID_GATT\t0x1801\n#define UUID_GAP\t0x1800\n\nstatic bool parse_uuid(GDBusProxy *proxy, bt_uuid_t *uuid)\n{\n\tDBusMessageIter iter;\n\tbt_uuid_t tmp;\n\tconst char *uuidstr;\n\n\tif (!g_dbus_proxy_get_property(proxy, \"UUID\", &iter))\n\t\treturn false;\n\n\tif (dbus_message_iter_get_arg_type(&iter) != DBUS_TYPE_STRING)\n\t\treturn false;\n\n\tdbus_message_iter_get_basic(&iter, &uuidstr);\n\n\tif (bt_string_to_uuid(uuid, uuidstr) < 0)\n\t\treturn false;\n\n\t/* GAP & GATT services are created and managed by BlueZ */\n\tbt_uuid16_create(&tmp, UUID_GAP);\n\tif (!bt_uuid_cmp(&tmp, uuid)) {\n\t\terror(\"GAP service must be handled by BlueZ\");\n\t\treturn false;\n\t}\n\n\tbt_uuid16_create(&tmp, UUID_GATT);\n\tif (!bt_uuid_cmp(&tmp, uuid)) {\n\t\terror(\"GATT service must be handled by BlueZ\");\n\t\treturn false;\n\t}\n\n\treturn true;\n}"
  },
  {
    "function_name": "proxy_removed_cb",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
    "lines": "1730-1746",
    "snippet": "static void proxy_removed_cb(GDBusProxy *proxy, void *user_data)\n{\n\tstruct gatt_app *app = user_data;\n\tstruct external_service *service;\n\tconst char *path;\n\n\tpath = g_dbus_proxy_get_path(proxy);\n\n\tservice = queue_remove_if(app->services, match_service_by_path,\n\t\t\t\t\t\t\t(void *) path);\n\tif (!service)\n\t\treturn;\n\n\tDBG(\"Proxy removed - removing service: %s\", service->path);\n\n\tservice_free(service);\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"dbus-common.h\"",
      "#include \"gatt-database.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "service_free",
          "args": [
            "service"
          ],
          "line": 1745
        },
        "resolved": true,
        "details": {
          "function_name": "service_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "488-506",
          "snippet": "static void service_free(void *data)\n{\n\tstruct external_service *service = data;\n\n\tqueue_destroy(service->chrcs, chrc_free);\n\tqueue_destroy(service->descs, desc_free);\n\tqueue_destroy(service->includes, inc_free);\n\n\tif (service->attrib)\n\t\tgatt_db_remove_service(service->app->database->db,\n\t\t\t\t\t\t\tservice->attrib);\n\n\tif (service->app->client)\n\t\tg_dbus_proxy_unref(service->proxy);\n\n\tg_free(service->path);\n\n\tfree(service);\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic void service_free(void *data)\n{\n\tstruct external_service *service = data;\n\n\tqueue_destroy(service->chrcs, chrc_free);\n\tqueue_destroy(service->descs, desc_free);\n\tqueue_destroy(service->includes, inc_free);\n\n\tif (service->attrib)\n\t\tgatt_db_remove_service(service->app->database->db,\n\t\t\t\t\t\t\tservice->attrib);\n\n\tif (service->app->client)\n\t\tg_dbus_proxy_unref(service->proxy);\n\n\tg_free(service->path);\n\n\tfree(service);\n}"
        }
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"Proxy removed - removing service: %s\"",
            "service->path"
          ],
          "line": 1743
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "queue_remove_if",
          "args": [
            "app->services",
            "match_service_by_path",
            "(void *) path"
          ],
          "line": 1738
        },
        "resolved": true,
        "details": {
          "function_name": "queue_remove_if",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "278-316",
          "snippet": "void *queue_remove_if(struct queue *queue, queue_match_func_t function,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct queue_entry *entry, *prev = NULL;\n\n\tif (!queue)\n\t\treturn NULL;\n\n\tif (!function)\n\t\tfunction = direct_match;\n\n\tentry = queue->head;\n\n\twhile (entry) {\n\t\tif (function(entry->data, user_data)) {\n\t\t\tvoid *data;\n\n\t\t\tif (prev)\n\t\t\t\tprev->next = entry->next;\n\t\t\telse\n\t\t\t\tqueue->head = entry->next;\n\n\t\t\tif (!entry->next)\n\t\t\t\tqueue->tail = prev;\n\n\t\t\tdata = entry->data;\n\n\t\t\tfree(entry);\n\t\t\tqueue->entries--;\n\n\t\t\treturn data;\n\t\t} else {\n\t\t\tprev = entry;\n\t\t\tentry = entry->next;\n\t\t}\n\t}\n\n\treturn NULL;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nvoid *queue_remove_if(struct queue *queue, queue_match_func_t function,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct queue_entry *entry, *prev = NULL;\n\n\tif (!queue)\n\t\treturn NULL;\n\n\tif (!function)\n\t\tfunction = direct_match;\n\n\tentry = queue->head;\n\n\twhile (entry) {\n\t\tif (function(entry->data, user_data)) {\n\t\t\tvoid *data;\n\n\t\t\tif (prev)\n\t\t\t\tprev->next = entry->next;\n\t\t\telse\n\t\t\t\tqueue->head = entry->next;\n\n\t\t\tif (!entry->next)\n\t\t\t\tqueue->tail = prev;\n\n\t\t\tdata = entry->data;\n\n\t\t\tfree(entry);\n\t\t\tqueue->entries--;\n\n\t\t\treturn data;\n\t\t} else {\n\t\t\tprev = entry;\n\t\t\tentry = entry->next;\n\t\t}\n\t}\n\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_dbus_proxy_get_path",
          "args": [
            "proxy"
          ],
          "line": 1736
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic void proxy_removed_cb(GDBusProxy *proxy, void *user_data)\n{\n\tstruct gatt_app *app = user_data;\n\tstruct external_service *service;\n\tconst char *path;\n\n\tpath = g_dbus_proxy_get_path(proxy);\n\n\tservice = queue_remove_if(app->services, match_service_by_path,\n\t\t\t\t\t\t\t(void *) path);\n\tif (!service)\n\t\treturn;\n\n\tDBG(\"Proxy removed - removing service: %s\", service->path);\n\n\tservice_free(service);\n}"
  },
  {
    "function_name": "proxy_added_cb",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
    "lines": "1714-1728",
    "snippet": "static void proxy_added_cb(GDBusProxy *proxy, void *user_data)\n{\n\tstruct gatt_app *app = user_data;\n\tconst char *iface, *path;\n\n\tif (app->failed)\n\t\treturn;\n\n\tqueue_push_tail(app->proxies, proxy);\n\n\tiface = g_dbus_proxy_get_interface(proxy);\n\tpath = g_dbus_proxy_get_path(proxy);\n\n\tDBG(\"Object received: %s, iface: %s\", path, iface);\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"dbus-common.h\"",
      "#include \"gatt-database.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"Object received: %s, iface: %s\"",
            "path",
            "iface"
          ],
          "line": 1727
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_dbus_proxy_get_path",
          "args": [
            "proxy"
          ],
          "line": 1725
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_dbus_proxy_get_interface",
          "args": [
            "proxy"
          ],
          "line": 1724
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "queue_push_tail",
          "args": [
            "app->proxies",
            "proxy"
          ],
          "line": 1722
        },
        "resolved": true,
        "details": {
          "function_name": "queue_push_tail",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "88-108",
          "snippet": "bool queue_push_tail(struct queue *queue, void *data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn false;\n\n\tentry = queue_entry_new(data);\n\n\tif (queue->tail)\n\t\tqueue->tail->next = entry;\n\n\tqueue->tail = entry;\n\n\tif (!queue->head)\n\t\tqueue->head = entry;\n\n\tqueue->entries++;\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nbool queue_push_tail(struct queue *queue, void *data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn false;\n\n\tentry = queue_entry_new(data);\n\n\tif (queue->tail)\n\t\tqueue->tail->next = entry;\n\n\tqueue->tail = entry;\n\n\tif (!queue->head)\n\t\tqueue->head = entry;\n\n\tqueue->entries++;\n\n\treturn true;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic void proxy_added_cb(GDBusProxy *proxy, void *user_data)\n{\n\tstruct gatt_app *app = user_data;\n\tconst char *iface, *path;\n\n\tif (app->failed)\n\t\treturn;\n\n\tqueue_push_tail(app->proxies, proxy);\n\n\tiface = g_dbus_proxy_get_interface(proxy);\n\tpath = g_dbus_proxy_get_path(proxy);\n\n\tDBG(\"Object received: %s, iface: %s\", path, iface);\n}"
  },
  {
    "function_name": "create_service",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
    "lines": "1671-1712",
    "snippet": "static struct external_service *create_service(struct gatt_app *app,\n\t\t\t\t\t\tGDBusProxy *proxy,\n\t\t\t\t\t\tconst char *path)\n{\n\tstruct external_service *service;\n\n\tif (!path || !g_str_has_prefix(path, \"/\"))\n\t\treturn NULL;\n\n\tservice = queue_find(app->services, match_service_by_path, path);\n\tif (service) {\n\t\terror(\"Duplicated service: %s\", path);\n\t\treturn NULL;\n\t}\n\n\tservice = new0(struct external_service, 1);\n\n\tservice->app = app;\n\n\tservice->path = g_strdup(path);\n\tif (!service->path)\n\t\tgoto fail;\n\n\tservice->proxy = g_dbus_proxy_ref(proxy);\n\tservice->chrcs = queue_new();\n\tservice->descs = queue_new();\n\tservice->includes = queue_new();\n\n\t/* Add 1 for the service declaration */\n\tif (!incr_attr_count(service, 1)) {\n\t\terror(\"Failed to increment attribute count\");\n\t\tgoto fail;\n\t}\n\n\tqueue_push_tail(app->services, service);\n\n\treturn service;\n\nfail:\n\tservice_free(service);\n\treturn NULL;\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"dbus-common.h\"",
      "#include \"gatt-database.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "service_free",
          "args": [
            "service"
          ],
          "line": 1710
        },
        "resolved": true,
        "details": {
          "function_name": "service_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "488-506",
          "snippet": "static void service_free(void *data)\n{\n\tstruct external_service *service = data;\n\n\tqueue_destroy(service->chrcs, chrc_free);\n\tqueue_destroy(service->descs, desc_free);\n\tqueue_destroy(service->includes, inc_free);\n\n\tif (service->attrib)\n\t\tgatt_db_remove_service(service->app->database->db,\n\t\t\t\t\t\t\tservice->attrib);\n\n\tif (service->app->client)\n\t\tg_dbus_proxy_unref(service->proxy);\n\n\tg_free(service->path);\n\n\tfree(service);\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic void service_free(void *data)\n{\n\tstruct external_service *service = data;\n\n\tqueue_destroy(service->chrcs, chrc_free);\n\tqueue_destroy(service->descs, desc_free);\n\tqueue_destroy(service->includes, inc_free);\n\n\tif (service->attrib)\n\t\tgatt_db_remove_service(service->app->database->db,\n\t\t\t\t\t\t\tservice->attrib);\n\n\tif (service->app->client)\n\t\tg_dbus_proxy_unref(service->proxy);\n\n\tg_free(service->path);\n\n\tfree(service);\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_push_tail",
          "args": [
            "app->services",
            "service"
          ],
          "line": 1705
        },
        "resolved": true,
        "details": {
          "function_name": "queue_push_tail",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "88-108",
          "snippet": "bool queue_push_tail(struct queue *queue, void *data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn false;\n\n\tentry = queue_entry_new(data);\n\n\tif (queue->tail)\n\t\tqueue->tail->next = entry;\n\n\tqueue->tail = entry;\n\n\tif (!queue->head)\n\t\tqueue->head = entry;\n\n\tqueue->entries++;\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nbool queue_push_tail(struct queue *queue, void *data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn false;\n\n\tentry = queue_entry_new(data);\n\n\tif (queue->tail)\n\t\tqueue->tail->next = entry;\n\n\tqueue->tail = entry;\n\n\tif (!queue->head)\n\t\tqueue->head = entry;\n\n\tqueue->entries++;\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"Failed to increment attribute count\""
          ],
          "line": 1701
        },
        "resolved": true,
        "details": {
          "function_name": "dbus_error_to_att_ecode",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "1833-1855",
          "snippet": "static uint8_t dbus_error_to_att_ecode(const char *error_name)\n{\n\n\tif (strcmp(error_name, \"org.bluez.Error.Failed\") == 0)\n\t\treturn 0x80;  /* For now return this \"application error\" */\n\n\tif (strcmp(error_name, \"org.bluez.Error.NotSupported\") == 0)\n\t\treturn BT_ATT_ERROR_REQUEST_NOT_SUPPORTED;\n\n\tif (strcmp(error_name, \"org.bluez.Error.NotAuthorized\") == 0)\n\t\treturn BT_ATT_ERROR_AUTHORIZATION;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InvalidValueLength\") == 0)\n\t\treturn BT_ATT_ERROR_INVALID_ATTRIBUTE_VALUE_LEN;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InvalidOffset\") == 0)\n\t\treturn BT_ATT_ERROR_INVALID_OFFSET;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InProgress\") == 0)\n\t\treturn BT_ERROR_ALREADY_IN_PROGRESS;\n\n\treturn 0;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic uint8_t dbus_error_to_att_ecode(const char *error_name)\n{\n\n\tif (strcmp(error_name, \"org.bluez.Error.Failed\") == 0)\n\t\treturn 0x80;  /* For now return this \"application error\" */\n\n\tif (strcmp(error_name, \"org.bluez.Error.NotSupported\") == 0)\n\t\treturn BT_ATT_ERROR_REQUEST_NOT_SUPPORTED;\n\n\tif (strcmp(error_name, \"org.bluez.Error.NotAuthorized\") == 0)\n\t\treturn BT_ATT_ERROR_AUTHORIZATION;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InvalidValueLength\") == 0)\n\t\treturn BT_ATT_ERROR_INVALID_ATTRIBUTE_VALUE_LEN;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InvalidOffset\") == 0)\n\t\treturn BT_ATT_ERROR_INVALID_OFFSET;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InProgress\") == 0)\n\t\treturn BT_ERROR_ALREADY_IN_PROGRESS;\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "incr_attr_count",
          "args": [
            "service",
            "1"
          ],
          "line": 1700
        },
        "resolved": true,
        "details": {
          "function_name": "incr_attr_count",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "1370-1378",
          "snippet": "static bool incr_attr_count(struct external_service *service, uint16_t incr)\n{\n\tif (service->attr_cnt > UINT16_MAX - incr)\n\t\treturn false;\n\n\tservice->attr_cnt += incr;\n\n\treturn true;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic bool incr_attr_count(struct external_service *service, uint16_t incr)\n{\n\tif (service->attr_cnt > UINT16_MAX - incr)\n\t\treturn false;\n\n\tservice->attr_cnt += incr;\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_new",
          "args": [],
          "line": 1697
        },
        "resolved": true,
        "details": {
          "function_name": "queue_new",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "56-66",
          "snippet": "struct queue *queue_new(void)\n{\n\tstruct queue *queue;\n\n\tqueue = new0(struct queue, 1);\n\tqueue->head = NULL;\n\tqueue->tail = NULL;\n\tqueue->entries = 0;\n\n\treturn queue_ref(queue);\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nstruct queue *queue_new(void)\n{\n\tstruct queue *queue;\n\n\tqueue = new0(struct queue, 1);\n\tqueue->head = NULL;\n\tqueue->tail = NULL;\n\tqueue->entries = 0;\n\n\treturn queue_ref(queue);\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_dbus_proxy_ref",
          "args": [
            "proxy"
          ],
          "line": 1694
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_strdup",
          "args": [
            "path"
          ],
          "line": 1690
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "new0",
          "args": [
            "structexternal_service",
            "1"
          ],
          "line": 1686
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"Duplicated service: %s\"",
            "path"
          ],
          "line": 1682
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_failed",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "124-128",
          "snippet": "DBusMessage *btd_error_failed(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE\n\t\t\t\t\t\".Failed\", \"%s\", str);\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_failed(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE\n\t\t\t\t\t\".Failed\", \"%s\", str);\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_find",
          "args": [
            "app->services",
            "match_service_by_path",
            "path"
          ],
          "line": 1680
        },
        "resolved": true,
        "details": {
          "function_name": "queue_find",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "231-247",
          "snippet": "void *queue_find(struct queue *queue, queue_match_func_t function,\n\t\t\t\t\t\t\tconst void *match_data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn NULL;\n\n\tif (!function)\n\t\tfunction = direct_match;\n\n\tfor (entry = queue->head; entry; entry = entry->next)\n\t\tif (function(entry->data, match_data))\n\t\t\treturn entry->data;\n\n\treturn NULL;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nvoid *queue_find(struct queue *queue, queue_match_func_t function,\n\t\t\t\t\t\t\tconst void *match_data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn NULL;\n\n\tif (!function)\n\t\tfunction = direct_match;\n\n\tfor (entry = queue->head; entry; entry = entry->next)\n\t\tif (function(entry->data, match_data))\n\t\t\treturn entry->data;\n\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_str_has_prefix",
          "args": [
            "path",
            "\"/\""
          ],
          "line": 1677
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic struct external_service *create_service(struct gatt_app *app,\n\t\t\t\t\t\tGDBusProxy *proxy,\n\t\t\t\t\t\tconst char *path)\n{\n\tstruct external_service *service;\n\n\tif (!path || !g_str_has_prefix(path, \"/\"))\n\t\treturn NULL;\n\n\tservice = queue_find(app->services, match_service_by_path, path);\n\tif (service) {\n\t\terror(\"Duplicated service: %s\", path);\n\t\treturn NULL;\n\t}\n\n\tservice = new0(struct external_service, 1);\n\n\tservice->app = app;\n\n\tservice->path = g_strdup(path);\n\tif (!service->path)\n\t\tgoto fail;\n\n\tservice->proxy = g_dbus_proxy_ref(proxy);\n\tservice->chrcs = queue_new();\n\tservice->descs = queue_new();\n\tservice->includes = queue_new();\n\n\t/* Add 1 for the service declaration */\n\tif (!incr_attr_count(service, 1)) {\n\t\terror(\"Failed to increment attribute count\");\n\t\tgoto fail;\n\t}\n\n\tqueue_push_tail(app->services, service);\n\n\treturn service;\n\nfail:\n\tservice_free(service);\n\treturn NULL;\n}"
  },
  {
    "function_name": "check_service_path",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
    "lines": "1660-1669",
    "snippet": "static bool check_service_path(GDBusProxy *proxy,\n\t\t\t\t\tstruct external_service *service)\n{\n\tconst char *service_path;\n\n\tif (!parse_path(proxy, \"Service\", &service_path))\n\t\treturn false;\n\n\treturn g_strcmp0(service_path, service->path) == 0;\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"dbus-common.h\"",
      "#include \"gatt-database.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_strcmp0",
          "args": [
            "service_path",
            "service->path"
          ],
          "line": 1668
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "parse_path",
          "args": [
            "proxy",
            "\"Service\"",
            "&service_path"
          ],
          "line": 1665
        },
        "resolved": true,
        "details": {
          "function_name": "parse_path",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "1355-1368",
          "snippet": "static bool parse_path(GDBusProxy *proxy, const char *name, const char **path)\n{\n\tDBusMessageIter iter;\n\n\tif (!g_dbus_proxy_get_property(proxy, name, &iter))\n\t\treturn false;\n\n\tif (dbus_message_iter_get_arg_type(&iter) != DBUS_TYPE_OBJECT_PATH)\n\t\treturn false;\n\n\tdbus_message_iter_get_basic(&iter, path);\n\n\treturn true;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic bool parse_path(GDBusProxy *proxy, const char *name, const char **path)\n{\n\tDBusMessageIter iter;\n\n\tif (!g_dbus_proxy_get_property(proxy, name, &iter))\n\t\treturn false;\n\n\tif (dbus_message_iter_get_arg_type(&iter) != DBUS_TYPE_OBJECT_PATH)\n\t\treturn false;\n\n\tdbus_message_iter_get_basic(&iter, path);\n\n\treturn true;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic bool check_service_path(GDBusProxy *proxy,\n\t\t\t\t\tstruct external_service *service)\n{\n\tconst char *service_path;\n\n\tif (!parse_path(proxy, \"Service\", &service_path))\n\t\treturn false;\n\n\treturn g_strcmp0(service_path, service->path) == 0;\n}"
  },
  {
    "function_name": "desc_create",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
    "lines": "1605-1658",
    "snippet": "static struct external_desc *desc_create(struct gatt_app *app,\n\t\t\t\t\t\t\tGDBusProxy *proxy)\n{\n\tstruct external_service *service;\n\tstruct external_desc *desc;\n\tconst char *chrc_path;\n\n\tif (!parse_path(proxy, \"Characteristic\", &chrc_path)) {\n\t\terror(\"Failed to obtain characteristic path for descriptor\");\n\t\treturn NULL;\n\t}\n\n\tservice = queue_find(app->services, match_service_by_chrc, chrc_path);\n\tif (!service) {\n\t\terror(\"Unable to find service for characteristic: %s\",\n\t\t\t\t\t\t\t\tchrc_path);\n\t\treturn NULL;\n\t}\n\n\tdesc = new0(struct external_desc, 1);\n\tdesc->pending_reads = queue_new();\n\tdesc->pending_writes = queue_new();\n\n\tdesc->chrc_path = g_strdup(chrc_path);\n\tif (!desc->chrc_path)\n\t\tgoto fail;\n\n\tdesc->service = service;\n\tdesc->proxy = g_dbus_proxy_ref(proxy);\n\n\t/* Add 1 for the descriptor attribute */\n\tif (!incr_attr_count(desc->service, 1)) {\n\t\terror(\"Failed to increment attribute count\");\n\t\tgoto fail;\n\t}\n\n\t/*\n\t * Parse descriptors flags here since they are used to\n\t * determine the permission the descriptor should have\n\t */\n\tif (!parse_flags(proxy, NULL, NULL, &desc->perm,\n\t\t\t\t\t&desc->req_prep_authorization)) {\n\t\terror(\"Failed to parse characteristic properties\");\n\t\tgoto fail;\n\t}\n\n\tqueue_push_tail(desc->service->descs, desc);\n\n\treturn desc;\n\nfail:\n\tdesc_free(desc);\n\treturn NULL;\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"dbus-common.h\"",
      "#include \"gatt-database.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "desc_free",
          "args": [
            "desc"
          ],
          "line": 1656
        },
        "resolved": true,
        "details": {
          "function_name": "desc_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "468-479",
          "snippet": "static void desc_free(void *data)\n{\n\tstruct external_desc *desc = data;\n\n\tqueue_destroy(desc->pending_reads, cancel_pending_read);\n\tqueue_destroy(desc->pending_writes, cancel_pending_write);\n\n\tg_dbus_proxy_unref(desc->proxy);\n\tg_free(desc->chrc_path);\n\n\tfree(desc);\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic void desc_free(void *data)\n{\n\tstruct external_desc *desc = data;\n\n\tqueue_destroy(desc->pending_reads, cancel_pending_read);\n\tqueue_destroy(desc->pending_writes, cancel_pending_write);\n\n\tg_dbus_proxy_unref(desc->proxy);\n\tg_free(desc->chrc_path);\n\n\tfree(desc);\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_push_tail",
          "args": [
            "desc->service->descs",
            "desc"
          ],
          "line": 1651
        },
        "resolved": true,
        "details": {
          "function_name": "queue_push_tail",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "88-108",
          "snippet": "bool queue_push_tail(struct queue *queue, void *data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn false;\n\n\tentry = queue_entry_new(data);\n\n\tif (queue->tail)\n\t\tqueue->tail->next = entry;\n\n\tqueue->tail = entry;\n\n\tif (!queue->head)\n\t\tqueue->head = entry;\n\n\tqueue->entries++;\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nbool queue_push_tail(struct queue *queue, void *data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn false;\n\n\tentry = queue_entry_new(data);\n\n\tif (queue->tail)\n\t\tqueue->tail->next = entry;\n\n\tqueue->tail = entry;\n\n\tif (!queue->head)\n\t\tqueue->head = entry;\n\n\tqueue->entries++;\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"Failed to parse characteristic properties\""
          ],
          "line": 1647
        },
        "resolved": true,
        "details": {
          "function_name": "dbus_error_to_att_ecode",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "1833-1855",
          "snippet": "static uint8_t dbus_error_to_att_ecode(const char *error_name)\n{\n\n\tif (strcmp(error_name, \"org.bluez.Error.Failed\") == 0)\n\t\treturn 0x80;  /* For now return this \"application error\" */\n\n\tif (strcmp(error_name, \"org.bluez.Error.NotSupported\") == 0)\n\t\treturn BT_ATT_ERROR_REQUEST_NOT_SUPPORTED;\n\n\tif (strcmp(error_name, \"org.bluez.Error.NotAuthorized\") == 0)\n\t\treturn BT_ATT_ERROR_AUTHORIZATION;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InvalidValueLength\") == 0)\n\t\treturn BT_ATT_ERROR_INVALID_ATTRIBUTE_VALUE_LEN;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InvalidOffset\") == 0)\n\t\treturn BT_ATT_ERROR_INVALID_OFFSET;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InProgress\") == 0)\n\t\treturn BT_ERROR_ALREADY_IN_PROGRESS;\n\n\treturn 0;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic uint8_t dbus_error_to_att_ecode(const char *error_name)\n{\n\n\tif (strcmp(error_name, \"org.bluez.Error.Failed\") == 0)\n\t\treturn 0x80;  /* For now return this \"application error\" */\n\n\tif (strcmp(error_name, \"org.bluez.Error.NotSupported\") == 0)\n\t\treturn BT_ATT_ERROR_REQUEST_NOT_SUPPORTED;\n\n\tif (strcmp(error_name, \"org.bluez.Error.NotAuthorized\") == 0)\n\t\treturn BT_ATT_ERROR_AUTHORIZATION;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InvalidValueLength\") == 0)\n\t\treturn BT_ATT_ERROR_INVALID_ATTRIBUTE_VALUE_LEN;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InvalidOffset\") == 0)\n\t\treturn BT_ATT_ERROR_INVALID_OFFSET;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InProgress\") == 0)\n\t\treturn BT_ERROR_ALREADY_IN_PROGRESS;\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "parse_flags",
          "args": [
            "proxy",
            "NULL",
            "NULL",
            "&desc->perm",
            "&desc->req_prep_authorization"
          ],
          "line": 1645
        },
        "resolved": true,
        "details": {
          "function_name": "parse_flags",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "1495-1515",
          "snippet": "static bool parse_flags(GDBusProxy *proxy, uint8_t *props, uint8_t *ext_props,\n\t\t\t\tuint32_t *perm, bool *req_prep_authorization)\n{\n\tDBusMessageIter iter, array;\n\tconst char *iface;\n\n\tif (!g_dbus_proxy_get_property(proxy, \"Flags\", &iter))\n\t\treturn false;\n\n\tif (dbus_message_iter_get_arg_type(&iter) != DBUS_TYPE_ARRAY)\n\t\treturn false;\n\n\tdbus_message_iter_recurse(&iter, &array);\n\n\tiface = g_dbus_proxy_get_interface(proxy);\n\tif (!strcmp(iface, GATT_DESC_IFACE))\n\t\treturn parse_desc_flags(&array, perm, req_prep_authorization);\n\n\treturn parse_chrc_flags(&array, props, ext_props, perm,\n\t\t\t\t\t\t\treq_prep_authorization);\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define GATT_DESC_IFACE\t\t\"org.bluez.GattDescriptor1\""
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\n#define GATT_DESC_IFACE\t\t\"org.bluez.GattDescriptor1\"\n\nstatic bool parse_flags(GDBusProxy *proxy, uint8_t *props, uint8_t *ext_props,\n\t\t\t\tuint32_t *perm, bool *req_prep_authorization)\n{\n\tDBusMessageIter iter, array;\n\tconst char *iface;\n\n\tif (!g_dbus_proxy_get_property(proxy, \"Flags\", &iter))\n\t\treturn false;\n\n\tif (dbus_message_iter_get_arg_type(&iter) != DBUS_TYPE_ARRAY)\n\t\treturn false;\n\n\tdbus_message_iter_recurse(&iter, &array);\n\n\tiface = g_dbus_proxy_get_interface(proxy);\n\tif (!strcmp(iface, GATT_DESC_IFACE))\n\t\treturn parse_desc_flags(&array, perm, req_prep_authorization);\n\n\treturn parse_chrc_flags(&array, props, ext_props, perm,\n\t\t\t\t\t\t\treq_prep_authorization);\n}"
        }
      },
      {
        "call_info": {
          "callee": "incr_attr_count",
          "args": [
            "desc->service",
            "1"
          ],
          "line": 1636
        },
        "resolved": true,
        "details": {
          "function_name": "incr_attr_count",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "1370-1378",
          "snippet": "static bool incr_attr_count(struct external_service *service, uint16_t incr)\n{\n\tif (service->attr_cnt > UINT16_MAX - incr)\n\t\treturn false;\n\n\tservice->attr_cnt += incr;\n\n\treturn true;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic bool incr_attr_count(struct external_service *service, uint16_t incr)\n{\n\tif (service->attr_cnt > UINT16_MAX - incr)\n\t\treturn false;\n\n\tservice->attr_cnt += incr;\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_dbus_proxy_ref",
          "args": [
            "proxy"
          ],
          "line": 1633
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_strdup",
          "args": [
            "chrc_path"
          ],
          "line": 1628
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "queue_new",
          "args": [],
          "line": 1626
        },
        "resolved": true,
        "details": {
          "function_name": "queue_new",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "56-66",
          "snippet": "struct queue *queue_new(void)\n{\n\tstruct queue *queue;\n\n\tqueue = new0(struct queue, 1);\n\tqueue->head = NULL;\n\tqueue->tail = NULL;\n\tqueue->entries = 0;\n\n\treturn queue_ref(queue);\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nstruct queue *queue_new(void)\n{\n\tstruct queue *queue;\n\n\tqueue = new0(struct queue, 1);\n\tqueue->head = NULL;\n\tqueue->tail = NULL;\n\tqueue->entries = 0;\n\n\treturn queue_ref(queue);\n}"
        }
      },
      {
        "call_info": {
          "callee": "new0",
          "args": [
            "structexternal_desc",
            "1"
          ],
          "line": 1624
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"Unable to find service for characteristic: %s\"",
            "chrc_path"
          ],
          "line": 1619
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_failed",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "124-128",
          "snippet": "DBusMessage *btd_error_failed(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE\n\t\t\t\t\t\".Failed\", \"%s\", str);\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_failed(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE\n\t\t\t\t\t\".Failed\", \"%s\", str);\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_find",
          "args": [
            "app->services",
            "match_service_by_chrc",
            "chrc_path"
          ],
          "line": 1617
        },
        "resolved": true,
        "details": {
          "function_name": "queue_find",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "231-247",
          "snippet": "void *queue_find(struct queue *queue, queue_match_func_t function,\n\t\t\t\t\t\t\tconst void *match_data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn NULL;\n\n\tif (!function)\n\t\tfunction = direct_match;\n\n\tfor (entry = queue->head; entry; entry = entry->next)\n\t\tif (function(entry->data, match_data))\n\t\t\treturn entry->data;\n\n\treturn NULL;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nvoid *queue_find(struct queue *queue, queue_match_func_t function,\n\t\t\t\t\t\t\tconst void *match_data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn NULL;\n\n\tif (!function)\n\t\tfunction = direct_match;\n\n\tfor (entry = queue->head; entry; entry = entry->next)\n\t\tif (function(entry->data, match_data))\n\t\t\treturn entry->data;\n\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "parse_path",
          "args": [
            "proxy",
            "\"Characteristic\"",
            "&chrc_path"
          ],
          "line": 1612
        },
        "resolved": true,
        "details": {
          "function_name": "parse_path",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "1355-1368",
          "snippet": "static bool parse_path(GDBusProxy *proxy, const char *name, const char **path)\n{\n\tDBusMessageIter iter;\n\n\tif (!g_dbus_proxy_get_property(proxy, name, &iter))\n\t\treturn false;\n\n\tif (dbus_message_iter_get_arg_type(&iter) != DBUS_TYPE_OBJECT_PATH)\n\t\treturn false;\n\n\tdbus_message_iter_get_basic(&iter, path);\n\n\treturn true;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic bool parse_path(GDBusProxy *proxy, const char *name, const char **path)\n{\n\tDBusMessageIter iter;\n\n\tif (!g_dbus_proxy_get_property(proxy, name, &iter))\n\t\treturn false;\n\n\tif (dbus_message_iter_get_arg_type(&iter) != DBUS_TYPE_OBJECT_PATH)\n\t\treturn false;\n\n\tdbus_message_iter_get_basic(&iter, path);\n\n\treturn true;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic struct external_desc *desc_create(struct gatt_app *app,\n\t\t\t\t\t\t\tGDBusProxy *proxy)\n{\n\tstruct external_service *service;\n\tstruct external_desc *desc;\n\tconst char *chrc_path;\n\n\tif (!parse_path(proxy, \"Characteristic\", &chrc_path)) {\n\t\terror(\"Failed to obtain characteristic path for descriptor\");\n\t\treturn NULL;\n\t}\n\n\tservice = queue_find(app->services, match_service_by_chrc, chrc_path);\n\tif (!service) {\n\t\terror(\"Unable to find service for characteristic: %s\",\n\t\t\t\t\t\t\t\tchrc_path);\n\t\treturn NULL;\n\t}\n\n\tdesc = new0(struct external_desc, 1);\n\tdesc->pending_reads = queue_new();\n\tdesc->pending_writes = queue_new();\n\n\tdesc->chrc_path = g_strdup(chrc_path);\n\tif (!desc->chrc_path)\n\t\tgoto fail;\n\n\tdesc->service = service;\n\tdesc->proxy = g_dbus_proxy_ref(proxy);\n\n\t/* Add 1 for the descriptor attribute */\n\tif (!incr_attr_count(desc->service, 1)) {\n\t\terror(\"Failed to increment attribute count\");\n\t\tgoto fail;\n\t}\n\n\t/*\n\t * Parse descriptors flags here since they are used to\n\t * determine the permission the descriptor should have\n\t */\n\tif (!parse_flags(proxy, NULL, NULL, &desc->perm,\n\t\t\t\t\t&desc->req_prep_authorization)) {\n\t\terror(\"Failed to parse characteristic properties\");\n\t\tgoto fail;\n\t}\n\n\tqueue_push_tail(desc->service->descs, desc);\n\n\treturn desc;\n\nfail:\n\tdesc_free(desc);\n\treturn NULL;\n}"
  },
  {
    "function_name": "match_service_by_chrc",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
    "lines": "1597-1603",
    "snippet": "static bool match_service_by_chrc(const void *a, const void *b)\n{\n\tconst struct external_service *service = a;\n\tconst char *path = b;\n\n\treturn queue_find(service->chrcs, match_chrc, path);\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"dbus-common.h\"",
      "#include \"gatt-database.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "queue_find",
          "args": [
            "service->chrcs",
            "match_chrc",
            "path"
          ],
          "line": 1602
        },
        "resolved": true,
        "details": {
          "function_name": "queue_find",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "231-247",
          "snippet": "void *queue_find(struct queue *queue, queue_match_func_t function,\n\t\t\t\t\t\t\tconst void *match_data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn NULL;\n\n\tif (!function)\n\t\tfunction = direct_match;\n\n\tfor (entry = queue->head; entry; entry = entry->next)\n\t\tif (function(entry->data, match_data))\n\t\t\treturn entry->data;\n\n\treturn NULL;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nvoid *queue_find(struct queue *queue, queue_match_func_t function,\n\t\t\t\t\t\t\tconst void *match_data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn NULL;\n\n\tif (!function)\n\t\tfunction = direct_match;\n\n\tfor (entry = queue->head; entry; entry = entry->next)\n\t\tif (function(entry->data, match_data))\n\t\t\treturn entry->data;\n\n\treturn NULL;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic bool match_service_by_chrc(const void *a, const void *b)\n{\n\tconst struct external_service *service = a;\n\tconst char *path = b;\n\n\treturn queue_find(service->chrcs, match_chrc, path);\n}"
  },
  {
    "function_name": "match_chrc",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
    "lines": "1589-1595",
    "snippet": "static bool match_chrc(const void *a, const void *b)\n{\n\tconst struct external_chrc *chrc = a;\n\tconst char *path = b;\n\n\treturn strcmp(chrc->path, path) == 0;\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"dbus-common.h\"",
      "#include \"gatt-database.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "chrc->path",
            "path"
          ],
          "line": 1594
        },
        "resolved": true,
        "details": {
          "function_name": "g_strcmp",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "1927-1930",
          "snippet": "static gint g_strcmp(gconstpointer a, gconstpointer b)\n{\n\treturn strcmp(a, b);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic gint g_strcmp(gconstpointer a, gconstpointer b)\n{\n\treturn strcmp(a, b);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic bool match_chrc(const void *a, const void *b)\n{\n\tconst struct external_chrc *chrc = a;\n\tconst char *path = b;\n\n\treturn strcmp(chrc->path, path) == 0;\n}"
  },
  {
    "function_name": "chrc_create",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
    "lines": "1517-1587",
    "snippet": "static struct external_chrc *chrc_create(struct gatt_app *app,\n\t\t\t\t\t\t\tGDBusProxy *proxy,\n\t\t\t\t\t\t\tconst char *path)\n{\n\tstruct external_service *service;\n\tstruct external_chrc *chrc;\n\tconst char *service_path;\n\n\tif (!parse_path(proxy, \"Service\", &service_path)) {\n\t\terror(\"Failed to obtain service path for characteristic\");\n\t\treturn NULL;\n\t}\n\n\tservice = queue_find(app->services, match_service_by_path,\n\t\t\t\t\t\t\t\tservice_path);\n\tif (!service) {\n\t\terror(\"Unable to find service for characteristic: %s\", path);\n\t\treturn NULL;\n\t}\n\n\tchrc = new0(struct external_chrc, 1);\n\tchrc->pending_reads = queue_new();\n\tchrc->pending_writes = queue_new();\n\n\tchrc->path = g_strdup(path);\n\tif (!chrc->path)\n\t\tgoto fail;\n\n\tchrc->service = service;\n\tchrc->proxy = g_dbus_proxy_ref(proxy);\n\n\t/*\n\t * Add 2 for the characteristic declaration and the value\n\t * attribute.\n\t */\n\tif (!incr_attr_count(chrc->service, 2)) {\n\t\terror(\"Failed to increment attribute count\");\n\t\tgoto fail;\n\t}\n\n\t/*\n\t * Parse characteristic flags (i.e. properties) here since they\n\t * are used to determine if any special descriptors should be\n\t * created.\n\t */\n\tif (!parse_flags(proxy, &chrc->props, &chrc->ext_props, &chrc->perm,\n\t\t\t\t\t&chrc->req_prep_authorization)) {\n\t\terror(\"Failed to parse characteristic properties\");\n\t\tgoto fail;\n\t}\n\n\tif ((chrc->props & BT_GATT_CHRC_PROP_NOTIFY ||\n\t\t\t\tchrc->props & BT_GATT_CHRC_PROP_INDICATE) &&\n\t\t\t\t!incr_attr_count(chrc->service, 1)) {\n\t\terror(\"Failed to increment attribute count for CCC\");\n\t\tgoto fail;\n\t}\n\n\tif (chrc->ext_props && !incr_attr_count(chrc->service, 1)) {\n\t\terror(\"Failed to increment attribute count for CEP\");\n\t\tgoto fail;\n\t}\n\n\tqueue_push_tail(chrc->service->chrcs, chrc);\n\n\treturn chrc;\n\nfail:\n\tchrc_free(chrc);\n\treturn NULL;\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"dbus-common.h\"",
      "#include \"gatt-database.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "chrc_free",
          "args": [
            "chrc"
          ],
          "line": 1585
        },
        "resolved": true,
        "details": {
          "function_name": "chrc_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "450-466",
          "snippet": "static void chrc_free(void *data)\n{\n\tstruct external_chrc *chrc = data;\n\n\tio_destroy(chrc->write_io);\n\tio_destroy(chrc->notify_io);\n\n\tqueue_destroy(chrc->pending_reads, cancel_pending_read);\n\tqueue_destroy(chrc->pending_writes, cancel_pending_write);\n\n\tg_free(chrc->path);\n\n\tg_dbus_proxy_set_property_watch(chrc->proxy, NULL, NULL);\n\tg_dbus_proxy_unref(chrc->proxy);\n\n\tfree(chrc);\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic void chrc_free(void *data)\n{\n\tstruct external_chrc *chrc = data;\n\n\tio_destroy(chrc->write_io);\n\tio_destroy(chrc->notify_io);\n\n\tqueue_destroy(chrc->pending_reads, cancel_pending_read);\n\tqueue_destroy(chrc->pending_writes, cancel_pending_write);\n\n\tg_free(chrc->path);\n\n\tg_dbus_proxy_set_property_watch(chrc->proxy, NULL, NULL);\n\tg_dbus_proxy_unref(chrc->proxy);\n\n\tfree(chrc);\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_push_tail",
          "args": [
            "chrc->service->chrcs",
            "chrc"
          ],
          "line": 1580
        },
        "resolved": true,
        "details": {
          "function_name": "queue_push_tail",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "88-108",
          "snippet": "bool queue_push_tail(struct queue *queue, void *data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn false;\n\n\tentry = queue_entry_new(data);\n\n\tif (queue->tail)\n\t\tqueue->tail->next = entry;\n\n\tqueue->tail = entry;\n\n\tif (!queue->head)\n\t\tqueue->head = entry;\n\n\tqueue->entries++;\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nbool queue_push_tail(struct queue *queue, void *data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn false;\n\n\tentry = queue_entry_new(data);\n\n\tif (queue->tail)\n\t\tqueue->tail->next = entry;\n\n\tqueue->tail = entry;\n\n\tif (!queue->head)\n\t\tqueue->head = entry;\n\n\tqueue->entries++;\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"Failed to increment attribute count for CEP\""
          ],
          "line": 1576
        },
        "resolved": true,
        "details": {
          "function_name": "dbus_error_to_att_ecode",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "1833-1855",
          "snippet": "static uint8_t dbus_error_to_att_ecode(const char *error_name)\n{\n\n\tif (strcmp(error_name, \"org.bluez.Error.Failed\") == 0)\n\t\treturn 0x80;  /* For now return this \"application error\" */\n\n\tif (strcmp(error_name, \"org.bluez.Error.NotSupported\") == 0)\n\t\treturn BT_ATT_ERROR_REQUEST_NOT_SUPPORTED;\n\n\tif (strcmp(error_name, \"org.bluez.Error.NotAuthorized\") == 0)\n\t\treturn BT_ATT_ERROR_AUTHORIZATION;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InvalidValueLength\") == 0)\n\t\treturn BT_ATT_ERROR_INVALID_ATTRIBUTE_VALUE_LEN;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InvalidOffset\") == 0)\n\t\treturn BT_ATT_ERROR_INVALID_OFFSET;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InProgress\") == 0)\n\t\treturn BT_ERROR_ALREADY_IN_PROGRESS;\n\n\treturn 0;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic uint8_t dbus_error_to_att_ecode(const char *error_name)\n{\n\n\tif (strcmp(error_name, \"org.bluez.Error.Failed\") == 0)\n\t\treturn 0x80;  /* For now return this \"application error\" */\n\n\tif (strcmp(error_name, \"org.bluez.Error.NotSupported\") == 0)\n\t\treturn BT_ATT_ERROR_REQUEST_NOT_SUPPORTED;\n\n\tif (strcmp(error_name, \"org.bluez.Error.NotAuthorized\") == 0)\n\t\treturn BT_ATT_ERROR_AUTHORIZATION;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InvalidValueLength\") == 0)\n\t\treturn BT_ATT_ERROR_INVALID_ATTRIBUTE_VALUE_LEN;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InvalidOffset\") == 0)\n\t\treturn BT_ATT_ERROR_INVALID_OFFSET;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InProgress\") == 0)\n\t\treturn BT_ERROR_ALREADY_IN_PROGRESS;\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "incr_attr_count",
          "args": [
            "chrc->service",
            "1"
          ],
          "line": 1575
        },
        "resolved": true,
        "details": {
          "function_name": "incr_attr_count",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "1370-1378",
          "snippet": "static bool incr_attr_count(struct external_service *service, uint16_t incr)\n{\n\tif (service->attr_cnt > UINT16_MAX - incr)\n\t\treturn false;\n\n\tservice->attr_cnt += incr;\n\n\treturn true;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic bool incr_attr_count(struct external_service *service, uint16_t incr)\n{\n\tif (service->attr_cnt > UINT16_MAX - incr)\n\t\treturn false;\n\n\tservice->attr_cnt += incr;\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "parse_flags",
          "args": [
            "proxy",
            "&chrc->props",
            "&chrc->ext_props",
            "&chrc->perm",
            "&chrc->req_prep_authorization"
          ],
          "line": 1562
        },
        "resolved": true,
        "details": {
          "function_name": "parse_flags",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "1495-1515",
          "snippet": "static bool parse_flags(GDBusProxy *proxy, uint8_t *props, uint8_t *ext_props,\n\t\t\t\tuint32_t *perm, bool *req_prep_authorization)\n{\n\tDBusMessageIter iter, array;\n\tconst char *iface;\n\n\tif (!g_dbus_proxy_get_property(proxy, \"Flags\", &iter))\n\t\treturn false;\n\n\tif (dbus_message_iter_get_arg_type(&iter) != DBUS_TYPE_ARRAY)\n\t\treturn false;\n\n\tdbus_message_iter_recurse(&iter, &array);\n\n\tiface = g_dbus_proxy_get_interface(proxy);\n\tif (!strcmp(iface, GATT_DESC_IFACE))\n\t\treturn parse_desc_flags(&array, perm, req_prep_authorization);\n\n\treturn parse_chrc_flags(&array, props, ext_props, perm,\n\t\t\t\t\t\t\treq_prep_authorization);\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define GATT_DESC_IFACE\t\t\"org.bluez.GattDescriptor1\""
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\n#define GATT_DESC_IFACE\t\t\"org.bluez.GattDescriptor1\"\n\nstatic bool parse_flags(GDBusProxy *proxy, uint8_t *props, uint8_t *ext_props,\n\t\t\t\tuint32_t *perm, bool *req_prep_authorization)\n{\n\tDBusMessageIter iter, array;\n\tconst char *iface;\n\n\tif (!g_dbus_proxy_get_property(proxy, \"Flags\", &iter))\n\t\treturn false;\n\n\tif (dbus_message_iter_get_arg_type(&iter) != DBUS_TYPE_ARRAY)\n\t\treturn false;\n\n\tdbus_message_iter_recurse(&iter, &array);\n\n\tiface = g_dbus_proxy_get_interface(proxy);\n\tif (!strcmp(iface, GATT_DESC_IFACE))\n\t\treturn parse_desc_flags(&array, perm, req_prep_authorization);\n\n\treturn parse_chrc_flags(&array, props, ext_props, perm,\n\t\t\t\t\t\t\treq_prep_authorization);\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_dbus_proxy_ref",
          "args": [
            "proxy"
          ],
          "line": 1546
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_strdup",
          "args": [
            "path"
          ],
          "line": 1541
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "queue_new",
          "args": [],
          "line": 1539
        },
        "resolved": true,
        "details": {
          "function_name": "queue_new",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "56-66",
          "snippet": "struct queue *queue_new(void)\n{\n\tstruct queue *queue;\n\n\tqueue = new0(struct queue, 1);\n\tqueue->head = NULL;\n\tqueue->tail = NULL;\n\tqueue->entries = 0;\n\n\treturn queue_ref(queue);\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nstruct queue *queue_new(void)\n{\n\tstruct queue *queue;\n\n\tqueue = new0(struct queue, 1);\n\tqueue->head = NULL;\n\tqueue->tail = NULL;\n\tqueue->entries = 0;\n\n\treturn queue_ref(queue);\n}"
        }
      },
      {
        "call_info": {
          "callee": "new0",
          "args": [
            "structexternal_chrc",
            "1"
          ],
          "line": 1537
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"Unable to find service for characteristic: %s\"",
            "path"
          ],
          "line": 1533
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_failed",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "124-128",
          "snippet": "DBusMessage *btd_error_failed(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE\n\t\t\t\t\t\".Failed\", \"%s\", str);\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_failed(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE\n\t\t\t\t\t\".Failed\", \"%s\", str);\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_find",
          "args": [
            "app->services",
            "match_service_by_path",
            "service_path"
          ],
          "line": 1530
        },
        "resolved": true,
        "details": {
          "function_name": "queue_find",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "231-247",
          "snippet": "void *queue_find(struct queue *queue, queue_match_func_t function,\n\t\t\t\t\t\t\tconst void *match_data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn NULL;\n\n\tif (!function)\n\t\tfunction = direct_match;\n\n\tfor (entry = queue->head; entry; entry = entry->next)\n\t\tif (function(entry->data, match_data))\n\t\t\treturn entry->data;\n\n\treturn NULL;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nvoid *queue_find(struct queue *queue, queue_match_func_t function,\n\t\t\t\t\t\t\tconst void *match_data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn NULL;\n\n\tif (!function)\n\t\tfunction = direct_match;\n\n\tfor (entry = queue->head; entry; entry = entry->next)\n\t\tif (function(entry->data, match_data))\n\t\t\treturn entry->data;\n\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "parse_path",
          "args": [
            "proxy",
            "\"Service\"",
            "&service_path"
          ],
          "line": 1525
        },
        "resolved": true,
        "details": {
          "function_name": "parse_path",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "1355-1368",
          "snippet": "static bool parse_path(GDBusProxy *proxy, const char *name, const char **path)\n{\n\tDBusMessageIter iter;\n\n\tif (!g_dbus_proxy_get_property(proxy, name, &iter))\n\t\treturn false;\n\n\tif (dbus_message_iter_get_arg_type(&iter) != DBUS_TYPE_OBJECT_PATH)\n\t\treturn false;\n\n\tdbus_message_iter_get_basic(&iter, path);\n\n\treturn true;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic bool parse_path(GDBusProxy *proxy, const char *name, const char **path)\n{\n\tDBusMessageIter iter;\n\n\tif (!g_dbus_proxy_get_property(proxy, name, &iter))\n\t\treturn false;\n\n\tif (dbus_message_iter_get_arg_type(&iter) != DBUS_TYPE_OBJECT_PATH)\n\t\treturn false;\n\n\tdbus_message_iter_get_basic(&iter, path);\n\n\treturn true;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic struct external_chrc *chrc_create(struct gatt_app *app,\n\t\t\t\t\t\t\tGDBusProxy *proxy,\n\t\t\t\t\t\t\tconst char *path)\n{\n\tstruct external_service *service;\n\tstruct external_chrc *chrc;\n\tconst char *service_path;\n\n\tif (!parse_path(proxy, \"Service\", &service_path)) {\n\t\terror(\"Failed to obtain service path for characteristic\");\n\t\treturn NULL;\n\t}\n\n\tservice = queue_find(app->services, match_service_by_path,\n\t\t\t\t\t\t\t\tservice_path);\n\tif (!service) {\n\t\terror(\"Unable to find service for characteristic: %s\", path);\n\t\treturn NULL;\n\t}\n\n\tchrc = new0(struct external_chrc, 1);\n\tchrc->pending_reads = queue_new();\n\tchrc->pending_writes = queue_new();\n\n\tchrc->path = g_strdup(path);\n\tif (!chrc->path)\n\t\tgoto fail;\n\n\tchrc->service = service;\n\tchrc->proxy = g_dbus_proxy_ref(proxy);\n\n\t/*\n\t * Add 2 for the characteristic declaration and the value\n\t * attribute.\n\t */\n\tif (!incr_attr_count(chrc->service, 2)) {\n\t\terror(\"Failed to increment attribute count\");\n\t\tgoto fail;\n\t}\n\n\t/*\n\t * Parse characteristic flags (i.e. properties) here since they\n\t * are used to determine if any special descriptors should be\n\t * created.\n\t */\n\tif (!parse_flags(proxy, &chrc->props, &chrc->ext_props, &chrc->perm,\n\t\t\t\t\t&chrc->req_prep_authorization)) {\n\t\terror(\"Failed to parse characteristic properties\");\n\t\tgoto fail;\n\t}\n\n\tif ((chrc->props & BT_GATT_CHRC_PROP_NOTIFY ||\n\t\t\t\tchrc->props & BT_GATT_CHRC_PROP_INDICATE) &&\n\t\t\t\t!incr_attr_count(chrc->service, 1)) {\n\t\terror(\"Failed to increment attribute count for CCC\");\n\t\tgoto fail;\n\t}\n\n\tif (chrc->ext_props && !incr_attr_count(chrc->service, 1)) {\n\t\terror(\"Failed to increment attribute count for CEP\");\n\t\tgoto fail;\n\t}\n\n\tqueue_push_tail(chrc->service->chrcs, chrc);\n\n\treturn chrc;\n\nfail:\n\tchrc_free(chrc);\n\treturn NULL;\n}"
  },
  {
    "function_name": "parse_flags",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
    "lines": "1495-1515",
    "snippet": "static bool parse_flags(GDBusProxy *proxy, uint8_t *props, uint8_t *ext_props,\n\t\t\t\tuint32_t *perm, bool *req_prep_authorization)\n{\n\tDBusMessageIter iter, array;\n\tconst char *iface;\n\n\tif (!g_dbus_proxy_get_property(proxy, \"Flags\", &iter))\n\t\treturn false;\n\n\tif (dbus_message_iter_get_arg_type(&iter) != DBUS_TYPE_ARRAY)\n\t\treturn false;\n\n\tdbus_message_iter_recurse(&iter, &array);\n\n\tiface = g_dbus_proxy_get_interface(proxy);\n\tif (!strcmp(iface, GATT_DESC_IFACE))\n\t\treturn parse_desc_flags(&array, perm, req_prep_authorization);\n\n\treturn parse_chrc_flags(&array, props, ext_props, perm,\n\t\t\t\t\t\t\treq_prep_authorization);\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"dbus-common.h\"",
      "#include \"gatt-database.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define GATT_DESC_IFACE\t\t\"org.bluez.GattDescriptor1\""
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "parse_chrc_flags",
          "args": [
            "&array",
            "props",
            "ext_props",
            "perm",
            "req_prep_authorization"
          ],
          "line": 1513
        },
        "resolved": true,
        "details": {
          "function_name": "parse_chrc_flags",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "1380-1453",
          "snippet": "static bool parse_chrc_flags(DBusMessageIter *array, uint8_t *props,\n\t\t\t\t\tuint8_t *ext_props, uint32_t *perm,\n\t\t\t\t\tbool *req_prep_authorization)\n{\n\tconst char *flag;\n\n\t*props = *ext_props = 0;\n\n\tdo {\n\t\tif (dbus_message_iter_get_arg_type(array) != DBUS_TYPE_STRING)\n\t\t\treturn false;\n\n\t\tdbus_message_iter_get_basic(array, &flag);\n\n\t\tif (!strcmp(\"broadcast\", flag))\n\t\t\t*props |= BT_GATT_CHRC_PROP_BROADCAST;\n\t\telse if (!strcmp(\"read\", flag)) {\n\t\t\t*props |= BT_GATT_CHRC_PROP_READ;\n\t\t\t*perm |= BT_ATT_PERM_READ;\n\t\t} else if (!strcmp(\"write-without-response\", flag)) {\n\t\t\t*props |= BT_GATT_CHRC_PROP_WRITE_WITHOUT_RESP;\n\t\t\t*perm |= BT_ATT_PERM_WRITE;\n\t\t} else if (!strcmp(\"write\", flag)) {\n\t\t\t*props |= BT_GATT_CHRC_PROP_WRITE;\n\t\t\t*perm |= BT_ATT_PERM_WRITE;\n\t\t} else if (!strcmp(\"notify\", flag)) {\n\t\t\t*props |= BT_GATT_CHRC_PROP_NOTIFY;\n\t\t} else if (!strcmp(\"indicate\", flag)) {\n\t\t\t*props |= BT_GATT_CHRC_PROP_INDICATE;\n\t\t} else if (!strcmp(\"authenticated-signed-writes\", flag)) {\n\t\t\t*props |= BT_GATT_CHRC_PROP_AUTH;\n\t\t\t*perm |= BT_ATT_PERM_WRITE;\n\t\t} else if (!strcmp(\"reliable-write\", flag)) {\n\t\t\t*ext_props |= BT_GATT_CHRC_EXT_PROP_RELIABLE_WRITE;\n\t\t\t*perm |= BT_ATT_PERM_WRITE;\n\t\t} else if (!strcmp(\"writable-auxiliaries\", flag)) {\n\t\t\t*ext_props |= BT_GATT_CHRC_EXT_PROP_WRITABLE_AUX;\n\t\t} else if (!strcmp(\"encrypt-read\", flag)) {\n\t\t\t*props |= BT_GATT_CHRC_PROP_READ;\n\t\t\t*ext_props |= BT_GATT_CHRC_EXT_PROP_ENC_READ;\n\t\t\t*perm |= BT_ATT_PERM_READ | BT_ATT_PERM_READ_ENCRYPT;\n\t\t} else if (!strcmp(\"encrypt-write\", flag)) {\n\t\t\t*props |= BT_GATT_CHRC_PROP_WRITE;\n\t\t\t*ext_props |= BT_GATT_CHRC_EXT_PROP_ENC_WRITE;\n\t\t\t*perm |= BT_ATT_PERM_WRITE | BT_ATT_PERM_WRITE_ENCRYPT;\n\t\t} else if (!strcmp(\"encrypt-authenticated-read\", flag)) {\n\t\t\t*props |= BT_GATT_CHRC_PROP_READ;\n\t\t\t*ext_props |= BT_GATT_CHRC_EXT_PROP_AUTH_READ;\n\t\t\t*perm |= BT_ATT_PERM_READ | BT_ATT_PERM_READ_AUTHEN;\n\t\t} else if (!strcmp(\"encrypt-authenticated-write\", flag)) {\n\t\t\t*props |= BT_GATT_CHRC_PROP_WRITE;\n\t\t\t*ext_props |= BT_GATT_CHRC_EXT_PROP_AUTH_WRITE;\n\t\t\t*perm |= BT_ATT_PERM_WRITE | BT_ATT_PERM_WRITE_AUTHEN;\n\t\t} else if (!strcmp(\"secure-read\", flag)) {\n\t\t\t*props |= BT_GATT_CHRC_PROP_READ;\n\t\t\t*ext_props |= BT_GATT_CHRC_EXT_PROP_AUTH_READ;\n\t\t\t*perm |= BT_ATT_PERM_READ | BT_ATT_PERM_READ_SECURE;\n\t\t} else if (!strcmp(\"secure-write\", flag)) {\n\t\t\t*props |= BT_GATT_CHRC_PROP_WRITE;\n\t\t\t*ext_props |= BT_GATT_CHRC_EXT_PROP_AUTH_WRITE;\n\t\t\t*perm |= BT_ATT_PERM_WRITE | BT_ATT_PERM_WRITE_SECURE;\n\t\t} else if (!strcmp(\"authorize\", flag)) {\n\t\t\t*req_prep_authorization = true;\n\t\t} else {\n\t\t\terror(\"Invalid characteristic flag: %s\", flag);\n\t\t\treturn false;\n\t\t}\n\t} while (dbus_message_iter_next(array));\n\n\tif (*ext_props)\n\t\t*props |= BT_GATT_CHRC_PROP_EXT_PROP;\n\n\treturn true;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic bool parse_chrc_flags(DBusMessageIter *array, uint8_t *props,\n\t\t\t\t\tuint8_t *ext_props, uint32_t *perm,\n\t\t\t\t\tbool *req_prep_authorization)\n{\n\tconst char *flag;\n\n\t*props = *ext_props = 0;\n\n\tdo {\n\t\tif (dbus_message_iter_get_arg_type(array) != DBUS_TYPE_STRING)\n\t\t\treturn false;\n\n\t\tdbus_message_iter_get_basic(array, &flag);\n\n\t\tif (!strcmp(\"broadcast\", flag))\n\t\t\t*props |= BT_GATT_CHRC_PROP_BROADCAST;\n\t\telse if (!strcmp(\"read\", flag)) {\n\t\t\t*props |= BT_GATT_CHRC_PROP_READ;\n\t\t\t*perm |= BT_ATT_PERM_READ;\n\t\t} else if (!strcmp(\"write-without-response\", flag)) {\n\t\t\t*props |= BT_GATT_CHRC_PROP_WRITE_WITHOUT_RESP;\n\t\t\t*perm |= BT_ATT_PERM_WRITE;\n\t\t} else if (!strcmp(\"write\", flag)) {\n\t\t\t*props |= BT_GATT_CHRC_PROP_WRITE;\n\t\t\t*perm |= BT_ATT_PERM_WRITE;\n\t\t} else if (!strcmp(\"notify\", flag)) {\n\t\t\t*props |= BT_GATT_CHRC_PROP_NOTIFY;\n\t\t} else if (!strcmp(\"indicate\", flag)) {\n\t\t\t*props |= BT_GATT_CHRC_PROP_INDICATE;\n\t\t} else if (!strcmp(\"authenticated-signed-writes\", flag)) {\n\t\t\t*props |= BT_GATT_CHRC_PROP_AUTH;\n\t\t\t*perm |= BT_ATT_PERM_WRITE;\n\t\t} else if (!strcmp(\"reliable-write\", flag)) {\n\t\t\t*ext_props |= BT_GATT_CHRC_EXT_PROP_RELIABLE_WRITE;\n\t\t\t*perm |= BT_ATT_PERM_WRITE;\n\t\t} else if (!strcmp(\"writable-auxiliaries\", flag)) {\n\t\t\t*ext_props |= BT_GATT_CHRC_EXT_PROP_WRITABLE_AUX;\n\t\t} else if (!strcmp(\"encrypt-read\", flag)) {\n\t\t\t*props |= BT_GATT_CHRC_PROP_READ;\n\t\t\t*ext_props |= BT_GATT_CHRC_EXT_PROP_ENC_READ;\n\t\t\t*perm |= BT_ATT_PERM_READ | BT_ATT_PERM_READ_ENCRYPT;\n\t\t} else if (!strcmp(\"encrypt-write\", flag)) {\n\t\t\t*props |= BT_GATT_CHRC_PROP_WRITE;\n\t\t\t*ext_props |= BT_GATT_CHRC_EXT_PROP_ENC_WRITE;\n\t\t\t*perm |= BT_ATT_PERM_WRITE | BT_ATT_PERM_WRITE_ENCRYPT;\n\t\t} else if (!strcmp(\"encrypt-authenticated-read\", flag)) {\n\t\t\t*props |= BT_GATT_CHRC_PROP_READ;\n\t\t\t*ext_props |= BT_GATT_CHRC_EXT_PROP_AUTH_READ;\n\t\t\t*perm |= BT_ATT_PERM_READ | BT_ATT_PERM_READ_AUTHEN;\n\t\t} else if (!strcmp(\"encrypt-authenticated-write\", flag)) {\n\t\t\t*props |= BT_GATT_CHRC_PROP_WRITE;\n\t\t\t*ext_props |= BT_GATT_CHRC_EXT_PROP_AUTH_WRITE;\n\t\t\t*perm |= BT_ATT_PERM_WRITE | BT_ATT_PERM_WRITE_AUTHEN;\n\t\t} else if (!strcmp(\"secure-read\", flag)) {\n\t\t\t*props |= BT_GATT_CHRC_PROP_READ;\n\t\t\t*ext_props |= BT_GATT_CHRC_EXT_PROP_AUTH_READ;\n\t\t\t*perm |= BT_ATT_PERM_READ | BT_ATT_PERM_READ_SECURE;\n\t\t} else if (!strcmp(\"secure-write\", flag)) {\n\t\t\t*props |= BT_GATT_CHRC_PROP_WRITE;\n\t\t\t*ext_props |= BT_GATT_CHRC_EXT_PROP_AUTH_WRITE;\n\t\t\t*perm |= BT_ATT_PERM_WRITE | BT_ATT_PERM_WRITE_SECURE;\n\t\t} else if (!strcmp(\"authorize\", flag)) {\n\t\t\t*req_prep_authorization = true;\n\t\t} else {\n\t\t\terror(\"Invalid characteristic flag: %s\", flag);\n\t\t\treturn false;\n\t\t}\n\t} while (dbus_message_iter_next(array));\n\n\tif (*ext_props)\n\t\t*props |= BT_GATT_CHRC_PROP_EXT_PROP;\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "parse_desc_flags",
          "args": [
            "&array",
            "perm",
            "req_prep_authorization"
          ],
          "line": 1511
        },
        "resolved": true,
        "details": {
          "function_name": "parse_desc_flags",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "1455-1493",
          "snippet": "static bool parse_desc_flags(DBusMessageIter *array, uint32_t *perm,\n\t\t\t\t\t\tbool *req_prep_authorization)\n{\n\tconst char *flag;\n\n\t*perm = 0;\n\n\tdo {\n\t\tif (dbus_message_iter_get_arg_type(array) != DBUS_TYPE_STRING)\n\t\t\treturn false;\n\n\t\tdbus_message_iter_get_basic(array, &flag);\n\n\t\tif (!strcmp(\"read\", flag))\n\t\t\t*perm |= BT_ATT_PERM_READ;\n\t\telse if (!strcmp(\"write\", flag))\n\t\t\t*perm |= BT_ATT_PERM_WRITE;\n\t\telse if (!strcmp(\"encrypt-read\", flag))\n\t\t\t*perm |= BT_ATT_PERM_READ | BT_ATT_PERM_READ_ENCRYPT;\n\t\telse if (!strcmp(\"encrypt-write\", flag))\n\t\t\t*perm |= BT_ATT_PERM_WRITE | BT_ATT_PERM_WRITE_ENCRYPT;\n\t\telse if (!strcmp(\"encrypt-authenticated-read\", flag))\n\t\t\t*perm |= BT_ATT_PERM_READ | BT_ATT_PERM_READ_AUTHEN;\n\t\telse if (!strcmp(\"encrypt-authenticated-write\", flag))\n\t\t\t*perm |= BT_ATT_PERM_WRITE | BT_ATT_PERM_WRITE_AUTHEN;\n\t\telse if (!strcmp(\"secure-read\", flag))\n\t\t\t*perm |= BT_ATT_PERM_READ | BT_ATT_PERM_READ_SECURE;\n\t\telse if (!strcmp(\"secure-write\", flag))\n\t\t\t*perm |= BT_ATT_PERM_WRITE | BT_ATT_PERM_WRITE_SECURE;\n\t\telse if (!strcmp(\"authorize\", flag))\n\t\t\t*req_prep_authorization = true;\n\t\telse {\n\t\t\terror(\"Invalid descriptor flag: %s\", flag);\n\t\t\treturn false;\n\t\t}\n\t} while (dbus_message_iter_next(array));\n\n\treturn true;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic bool parse_desc_flags(DBusMessageIter *array, uint32_t *perm,\n\t\t\t\t\t\tbool *req_prep_authorization)\n{\n\tconst char *flag;\n\n\t*perm = 0;\n\n\tdo {\n\t\tif (dbus_message_iter_get_arg_type(array) != DBUS_TYPE_STRING)\n\t\t\treturn false;\n\n\t\tdbus_message_iter_get_basic(array, &flag);\n\n\t\tif (!strcmp(\"read\", flag))\n\t\t\t*perm |= BT_ATT_PERM_READ;\n\t\telse if (!strcmp(\"write\", flag))\n\t\t\t*perm |= BT_ATT_PERM_WRITE;\n\t\telse if (!strcmp(\"encrypt-read\", flag))\n\t\t\t*perm |= BT_ATT_PERM_READ | BT_ATT_PERM_READ_ENCRYPT;\n\t\telse if (!strcmp(\"encrypt-write\", flag))\n\t\t\t*perm |= BT_ATT_PERM_WRITE | BT_ATT_PERM_WRITE_ENCRYPT;\n\t\telse if (!strcmp(\"encrypt-authenticated-read\", flag))\n\t\t\t*perm |= BT_ATT_PERM_READ | BT_ATT_PERM_READ_AUTHEN;\n\t\telse if (!strcmp(\"encrypt-authenticated-write\", flag))\n\t\t\t*perm |= BT_ATT_PERM_WRITE | BT_ATT_PERM_WRITE_AUTHEN;\n\t\telse if (!strcmp(\"secure-read\", flag))\n\t\t\t*perm |= BT_ATT_PERM_READ | BT_ATT_PERM_READ_SECURE;\n\t\telse if (!strcmp(\"secure-write\", flag))\n\t\t\t*perm |= BT_ATT_PERM_WRITE | BT_ATT_PERM_WRITE_SECURE;\n\t\telse if (!strcmp(\"authorize\", flag))\n\t\t\t*req_prep_authorization = true;\n\t\telse {\n\t\t\terror(\"Invalid descriptor flag: %s\", flag);\n\t\t\treturn false;\n\t\t}\n\t} while (dbus_message_iter_next(array));\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "iface",
            "GATT_DESC_IFACE"
          ],
          "line": 1510
        },
        "resolved": true,
        "details": {
          "function_name": "g_strcmp",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "1927-1930",
          "snippet": "static gint g_strcmp(gconstpointer a, gconstpointer b)\n{\n\treturn strcmp(a, b);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic gint g_strcmp(gconstpointer a, gconstpointer b)\n{\n\treturn strcmp(a, b);\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_dbus_proxy_get_interface",
          "args": [
            "proxy"
          ],
          "line": 1509
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_recurse",
          "args": [
            "&iter",
            "&array"
          ],
          "line": 1507
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_get_arg_type",
          "args": [
            "&iter"
          ],
          "line": 1504
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_dbus_proxy_get_property",
          "args": [
            "proxy",
            "\"Flags\"",
            "&iter"
          ],
          "line": 1501
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\n#define GATT_DESC_IFACE\t\t\"org.bluez.GattDescriptor1\"\n\nstatic bool parse_flags(GDBusProxy *proxy, uint8_t *props, uint8_t *ext_props,\n\t\t\t\tuint32_t *perm, bool *req_prep_authorization)\n{\n\tDBusMessageIter iter, array;\n\tconst char *iface;\n\n\tif (!g_dbus_proxy_get_property(proxy, \"Flags\", &iter))\n\t\treturn false;\n\n\tif (dbus_message_iter_get_arg_type(&iter) != DBUS_TYPE_ARRAY)\n\t\treturn false;\n\n\tdbus_message_iter_recurse(&iter, &array);\n\n\tiface = g_dbus_proxy_get_interface(proxy);\n\tif (!strcmp(iface, GATT_DESC_IFACE))\n\t\treturn parse_desc_flags(&array, perm, req_prep_authorization);\n\n\treturn parse_chrc_flags(&array, props, ext_props, perm,\n\t\t\t\t\t\t\treq_prep_authorization);\n}"
  },
  {
    "function_name": "parse_desc_flags",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
    "lines": "1455-1493",
    "snippet": "static bool parse_desc_flags(DBusMessageIter *array, uint32_t *perm,\n\t\t\t\t\t\tbool *req_prep_authorization)\n{\n\tconst char *flag;\n\n\t*perm = 0;\n\n\tdo {\n\t\tif (dbus_message_iter_get_arg_type(array) != DBUS_TYPE_STRING)\n\t\t\treturn false;\n\n\t\tdbus_message_iter_get_basic(array, &flag);\n\n\t\tif (!strcmp(\"read\", flag))\n\t\t\t*perm |= BT_ATT_PERM_READ;\n\t\telse if (!strcmp(\"write\", flag))\n\t\t\t*perm |= BT_ATT_PERM_WRITE;\n\t\telse if (!strcmp(\"encrypt-read\", flag))\n\t\t\t*perm |= BT_ATT_PERM_READ | BT_ATT_PERM_READ_ENCRYPT;\n\t\telse if (!strcmp(\"encrypt-write\", flag))\n\t\t\t*perm |= BT_ATT_PERM_WRITE | BT_ATT_PERM_WRITE_ENCRYPT;\n\t\telse if (!strcmp(\"encrypt-authenticated-read\", flag))\n\t\t\t*perm |= BT_ATT_PERM_READ | BT_ATT_PERM_READ_AUTHEN;\n\t\telse if (!strcmp(\"encrypt-authenticated-write\", flag))\n\t\t\t*perm |= BT_ATT_PERM_WRITE | BT_ATT_PERM_WRITE_AUTHEN;\n\t\telse if (!strcmp(\"secure-read\", flag))\n\t\t\t*perm |= BT_ATT_PERM_READ | BT_ATT_PERM_READ_SECURE;\n\t\telse if (!strcmp(\"secure-write\", flag))\n\t\t\t*perm |= BT_ATT_PERM_WRITE | BT_ATT_PERM_WRITE_SECURE;\n\t\telse if (!strcmp(\"authorize\", flag))\n\t\t\t*req_prep_authorization = true;\n\t\telse {\n\t\t\terror(\"Invalid descriptor flag: %s\", flag);\n\t\t\treturn false;\n\t\t}\n\t} while (dbus_message_iter_next(array));\n\n\treturn true;\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"dbus-common.h\"",
      "#include \"gatt-database.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "dbus_message_iter_next",
          "args": [
            "array"
          ],
          "line": 1490
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"Invalid descriptor flag: %s\"",
            "flag"
          ],
          "line": 1487
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_failed",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "124-128",
          "snippet": "DBusMessage *btd_error_failed(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE\n\t\t\t\t\t\".Failed\", \"%s\", str);\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_failed(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE\n\t\t\t\t\t\".Failed\", \"%s\", str);\n}"
        }
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "\"authorize\"",
            "flag"
          ],
          "line": 1484
        },
        "resolved": true,
        "details": {
          "function_name": "g_strcmp",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "1927-1930",
          "snippet": "static gint g_strcmp(gconstpointer a, gconstpointer b)\n{\n\treturn strcmp(a, b);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic gint g_strcmp(gconstpointer a, gconstpointer b)\n{\n\treturn strcmp(a, b);\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_get_basic",
          "args": [
            "array",
            "&flag"
          ],
          "line": 1466
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_get_arg_type",
          "args": [
            "array"
          ],
          "line": 1463
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic bool parse_desc_flags(DBusMessageIter *array, uint32_t *perm,\n\t\t\t\t\t\tbool *req_prep_authorization)\n{\n\tconst char *flag;\n\n\t*perm = 0;\n\n\tdo {\n\t\tif (dbus_message_iter_get_arg_type(array) != DBUS_TYPE_STRING)\n\t\t\treturn false;\n\n\t\tdbus_message_iter_get_basic(array, &flag);\n\n\t\tif (!strcmp(\"read\", flag))\n\t\t\t*perm |= BT_ATT_PERM_READ;\n\t\telse if (!strcmp(\"write\", flag))\n\t\t\t*perm |= BT_ATT_PERM_WRITE;\n\t\telse if (!strcmp(\"encrypt-read\", flag))\n\t\t\t*perm |= BT_ATT_PERM_READ | BT_ATT_PERM_READ_ENCRYPT;\n\t\telse if (!strcmp(\"encrypt-write\", flag))\n\t\t\t*perm |= BT_ATT_PERM_WRITE | BT_ATT_PERM_WRITE_ENCRYPT;\n\t\telse if (!strcmp(\"encrypt-authenticated-read\", flag))\n\t\t\t*perm |= BT_ATT_PERM_READ | BT_ATT_PERM_READ_AUTHEN;\n\t\telse if (!strcmp(\"encrypt-authenticated-write\", flag))\n\t\t\t*perm |= BT_ATT_PERM_WRITE | BT_ATT_PERM_WRITE_AUTHEN;\n\t\telse if (!strcmp(\"secure-read\", flag))\n\t\t\t*perm |= BT_ATT_PERM_READ | BT_ATT_PERM_READ_SECURE;\n\t\telse if (!strcmp(\"secure-write\", flag))\n\t\t\t*perm |= BT_ATT_PERM_WRITE | BT_ATT_PERM_WRITE_SECURE;\n\t\telse if (!strcmp(\"authorize\", flag))\n\t\t\t*req_prep_authorization = true;\n\t\telse {\n\t\t\terror(\"Invalid descriptor flag: %s\", flag);\n\t\t\treturn false;\n\t\t}\n\t} while (dbus_message_iter_next(array));\n\n\treturn true;\n}"
  },
  {
    "function_name": "parse_chrc_flags",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
    "lines": "1380-1453",
    "snippet": "static bool parse_chrc_flags(DBusMessageIter *array, uint8_t *props,\n\t\t\t\t\tuint8_t *ext_props, uint32_t *perm,\n\t\t\t\t\tbool *req_prep_authorization)\n{\n\tconst char *flag;\n\n\t*props = *ext_props = 0;\n\n\tdo {\n\t\tif (dbus_message_iter_get_arg_type(array) != DBUS_TYPE_STRING)\n\t\t\treturn false;\n\n\t\tdbus_message_iter_get_basic(array, &flag);\n\n\t\tif (!strcmp(\"broadcast\", flag))\n\t\t\t*props |= BT_GATT_CHRC_PROP_BROADCAST;\n\t\telse if (!strcmp(\"read\", flag)) {\n\t\t\t*props |= BT_GATT_CHRC_PROP_READ;\n\t\t\t*perm |= BT_ATT_PERM_READ;\n\t\t} else if (!strcmp(\"write-without-response\", flag)) {\n\t\t\t*props |= BT_GATT_CHRC_PROP_WRITE_WITHOUT_RESP;\n\t\t\t*perm |= BT_ATT_PERM_WRITE;\n\t\t} else if (!strcmp(\"write\", flag)) {\n\t\t\t*props |= BT_GATT_CHRC_PROP_WRITE;\n\t\t\t*perm |= BT_ATT_PERM_WRITE;\n\t\t} else if (!strcmp(\"notify\", flag)) {\n\t\t\t*props |= BT_GATT_CHRC_PROP_NOTIFY;\n\t\t} else if (!strcmp(\"indicate\", flag)) {\n\t\t\t*props |= BT_GATT_CHRC_PROP_INDICATE;\n\t\t} else if (!strcmp(\"authenticated-signed-writes\", flag)) {\n\t\t\t*props |= BT_GATT_CHRC_PROP_AUTH;\n\t\t\t*perm |= BT_ATT_PERM_WRITE;\n\t\t} else if (!strcmp(\"reliable-write\", flag)) {\n\t\t\t*ext_props |= BT_GATT_CHRC_EXT_PROP_RELIABLE_WRITE;\n\t\t\t*perm |= BT_ATT_PERM_WRITE;\n\t\t} else if (!strcmp(\"writable-auxiliaries\", flag)) {\n\t\t\t*ext_props |= BT_GATT_CHRC_EXT_PROP_WRITABLE_AUX;\n\t\t} else if (!strcmp(\"encrypt-read\", flag)) {\n\t\t\t*props |= BT_GATT_CHRC_PROP_READ;\n\t\t\t*ext_props |= BT_GATT_CHRC_EXT_PROP_ENC_READ;\n\t\t\t*perm |= BT_ATT_PERM_READ | BT_ATT_PERM_READ_ENCRYPT;\n\t\t} else if (!strcmp(\"encrypt-write\", flag)) {\n\t\t\t*props |= BT_GATT_CHRC_PROP_WRITE;\n\t\t\t*ext_props |= BT_GATT_CHRC_EXT_PROP_ENC_WRITE;\n\t\t\t*perm |= BT_ATT_PERM_WRITE | BT_ATT_PERM_WRITE_ENCRYPT;\n\t\t} else if (!strcmp(\"encrypt-authenticated-read\", flag)) {\n\t\t\t*props |= BT_GATT_CHRC_PROP_READ;\n\t\t\t*ext_props |= BT_GATT_CHRC_EXT_PROP_AUTH_READ;\n\t\t\t*perm |= BT_ATT_PERM_READ | BT_ATT_PERM_READ_AUTHEN;\n\t\t} else if (!strcmp(\"encrypt-authenticated-write\", flag)) {\n\t\t\t*props |= BT_GATT_CHRC_PROP_WRITE;\n\t\t\t*ext_props |= BT_GATT_CHRC_EXT_PROP_AUTH_WRITE;\n\t\t\t*perm |= BT_ATT_PERM_WRITE | BT_ATT_PERM_WRITE_AUTHEN;\n\t\t} else if (!strcmp(\"secure-read\", flag)) {\n\t\t\t*props |= BT_GATT_CHRC_PROP_READ;\n\t\t\t*ext_props |= BT_GATT_CHRC_EXT_PROP_AUTH_READ;\n\t\t\t*perm |= BT_ATT_PERM_READ | BT_ATT_PERM_READ_SECURE;\n\t\t} else if (!strcmp(\"secure-write\", flag)) {\n\t\t\t*props |= BT_GATT_CHRC_PROP_WRITE;\n\t\t\t*ext_props |= BT_GATT_CHRC_EXT_PROP_AUTH_WRITE;\n\t\t\t*perm |= BT_ATT_PERM_WRITE | BT_ATT_PERM_WRITE_SECURE;\n\t\t} else if (!strcmp(\"authorize\", flag)) {\n\t\t\t*req_prep_authorization = true;\n\t\t} else {\n\t\t\terror(\"Invalid characteristic flag: %s\", flag);\n\t\t\treturn false;\n\t\t}\n\t} while (dbus_message_iter_next(array));\n\n\tif (*ext_props)\n\t\t*props |= BT_GATT_CHRC_PROP_EXT_PROP;\n\n\treturn true;\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"dbus-common.h\"",
      "#include \"gatt-database.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "dbus_message_iter_next",
          "args": [
            "array"
          ],
          "line": 1447
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"Invalid characteristic flag: %s\"",
            "flag"
          ],
          "line": 1444
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_failed",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "124-128",
          "snippet": "DBusMessage *btd_error_failed(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE\n\t\t\t\t\t\".Failed\", \"%s\", str);\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_failed(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE\n\t\t\t\t\t\".Failed\", \"%s\", str);\n}"
        }
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "\"authorize\"",
            "flag"
          ],
          "line": 1441
        },
        "resolved": true,
        "details": {
          "function_name": "g_strcmp",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "1927-1930",
          "snippet": "static gint g_strcmp(gconstpointer a, gconstpointer b)\n{\n\treturn strcmp(a, b);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic gint g_strcmp(gconstpointer a, gconstpointer b)\n{\n\treturn strcmp(a, b);\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_get_basic",
          "args": [
            "array",
            "&flag"
          ],
          "line": 1392
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_get_arg_type",
          "args": [
            "array"
          ],
          "line": 1389
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic bool parse_chrc_flags(DBusMessageIter *array, uint8_t *props,\n\t\t\t\t\tuint8_t *ext_props, uint32_t *perm,\n\t\t\t\t\tbool *req_prep_authorization)\n{\n\tconst char *flag;\n\n\t*props = *ext_props = 0;\n\n\tdo {\n\t\tif (dbus_message_iter_get_arg_type(array) != DBUS_TYPE_STRING)\n\t\t\treturn false;\n\n\t\tdbus_message_iter_get_basic(array, &flag);\n\n\t\tif (!strcmp(\"broadcast\", flag))\n\t\t\t*props |= BT_GATT_CHRC_PROP_BROADCAST;\n\t\telse if (!strcmp(\"read\", flag)) {\n\t\t\t*props |= BT_GATT_CHRC_PROP_READ;\n\t\t\t*perm |= BT_ATT_PERM_READ;\n\t\t} else if (!strcmp(\"write-without-response\", flag)) {\n\t\t\t*props |= BT_GATT_CHRC_PROP_WRITE_WITHOUT_RESP;\n\t\t\t*perm |= BT_ATT_PERM_WRITE;\n\t\t} else if (!strcmp(\"write\", flag)) {\n\t\t\t*props |= BT_GATT_CHRC_PROP_WRITE;\n\t\t\t*perm |= BT_ATT_PERM_WRITE;\n\t\t} else if (!strcmp(\"notify\", flag)) {\n\t\t\t*props |= BT_GATT_CHRC_PROP_NOTIFY;\n\t\t} else if (!strcmp(\"indicate\", flag)) {\n\t\t\t*props |= BT_GATT_CHRC_PROP_INDICATE;\n\t\t} else if (!strcmp(\"authenticated-signed-writes\", flag)) {\n\t\t\t*props |= BT_GATT_CHRC_PROP_AUTH;\n\t\t\t*perm |= BT_ATT_PERM_WRITE;\n\t\t} else if (!strcmp(\"reliable-write\", flag)) {\n\t\t\t*ext_props |= BT_GATT_CHRC_EXT_PROP_RELIABLE_WRITE;\n\t\t\t*perm |= BT_ATT_PERM_WRITE;\n\t\t} else if (!strcmp(\"writable-auxiliaries\", flag)) {\n\t\t\t*ext_props |= BT_GATT_CHRC_EXT_PROP_WRITABLE_AUX;\n\t\t} else if (!strcmp(\"encrypt-read\", flag)) {\n\t\t\t*props |= BT_GATT_CHRC_PROP_READ;\n\t\t\t*ext_props |= BT_GATT_CHRC_EXT_PROP_ENC_READ;\n\t\t\t*perm |= BT_ATT_PERM_READ | BT_ATT_PERM_READ_ENCRYPT;\n\t\t} else if (!strcmp(\"encrypt-write\", flag)) {\n\t\t\t*props |= BT_GATT_CHRC_PROP_WRITE;\n\t\t\t*ext_props |= BT_GATT_CHRC_EXT_PROP_ENC_WRITE;\n\t\t\t*perm |= BT_ATT_PERM_WRITE | BT_ATT_PERM_WRITE_ENCRYPT;\n\t\t} else if (!strcmp(\"encrypt-authenticated-read\", flag)) {\n\t\t\t*props |= BT_GATT_CHRC_PROP_READ;\n\t\t\t*ext_props |= BT_GATT_CHRC_EXT_PROP_AUTH_READ;\n\t\t\t*perm |= BT_ATT_PERM_READ | BT_ATT_PERM_READ_AUTHEN;\n\t\t} else if (!strcmp(\"encrypt-authenticated-write\", flag)) {\n\t\t\t*props |= BT_GATT_CHRC_PROP_WRITE;\n\t\t\t*ext_props |= BT_GATT_CHRC_EXT_PROP_AUTH_WRITE;\n\t\t\t*perm |= BT_ATT_PERM_WRITE | BT_ATT_PERM_WRITE_AUTHEN;\n\t\t} else if (!strcmp(\"secure-read\", flag)) {\n\t\t\t*props |= BT_GATT_CHRC_PROP_READ;\n\t\t\t*ext_props |= BT_GATT_CHRC_EXT_PROP_AUTH_READ;\n\t\t\t*perm |= BT_ATT_PERM_READ | BT_ATT_PERM_READ_SECURE;\n\t\t} else if (!strcmp(\"secure-write\", flag)) {\n\t\t\t*props |= BT_GATT_CHRC_PROP_WRITE;\n\t\t\t*ext_props |= BT_GATT_CHRC_EXT_PROP_AUTH_WRITE;\n\t\t\t*perm |= BT_ATT_PERM_WRITE | BT_ATT_PERM_WRITE_SECURE;\n\t\t} else if (!strcmp(\"authorize\", flag)) {\n\t\t\t*req_prep_authorization = true;\n\t\t} else {\n\t\t\terror(\"Invalid characteristic flag: %s\", flag);\n\t\t\treturn false;\n\t\t}\n\t} while (dbus_message_iter_next(array));\n\n\tif (*ext_props)\n\t\t*props |= BT_GATT_CHRC_PROP_EXT_PROP;\n\n\treturn true;\n}"
  },
  {
    "function_name": "incr_attr_count",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
    "lines": "1370-1378",
    "snippet": "static bool incr_attr_count(struct external_service *service, uint16_t incr)\n{\n\tif (service->attr_cnt > UINT16_MAX - incr)\n\t\treturn false;\n\n\tservice->attr_cnt += incr;\n\n\treturn true;\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"dbus-common.h\"",
      "#include \"gatt-database.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic bool incr_attr_count(struct external_service *service, uint16_t incr)\n{\n\tif (service->attr_cnt > UINT16_MAX - incr)\n\t\treturn false;\n\n\tservice->attr_cnt += incr;\n\n\treturn true;\n}"
  },
  {
    "function_name": "parse_path",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
    "lines": "1355-1368",
    "snippet": "static bool parse_path(GDBusProxy *proxy, const char *name, const char **path)\n{\n\tDBusMessageIter iter;\n\n\tif (!g_dbus_proxy_get_property(proxy, name, &iter))\n\t\treturn false;\n\n\tif (dbus_message_iter_get_arg_type(&iter) != DBUS_TYPE_OBJECT_PATH)\n\t\treturn false;\n\n\tdbus_message_iter_get_basic(&iter, path);\n\n\treturn true;\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"dbus-common.h\"",
      "#include \"gatt-database.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "dbus_message_iter_get_basic",
          "args": [
            "&iter",
            "path"
          ],
          "line": 1365
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_get_arg_type",
          "args": [
            "&iter"
          ],
          "line": 1362
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_dbus_proxy_get_property",
          "args": [
            "proxy",
            "name",
            "&iter"
          ],
          "line": 1359
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic bool parse_path(GDBusProxy *proxy, const char *name, const char **path)\n{\n\tDBusMessageIter iter;\n\n\tif (!g_dbus_proxy_get_property(proxy, name, &iter))\n\t\treturn false;\n\n\tif (dbus_message_iter_get_arg_type(&iter) != DBUS_TYPE_OBJECT_PATH)\n\t\treturn false;\n\n\tdbus_message_iter_get_basic(&iter, path);\n\n\treturn true;\n}"
  },
  {
    "function_name": "match_service_by_path",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
    "lines": "1347-1353",
    "snippet": "static bool match_service_by_path(const void *a, const void *b)\n{\n\tconst struct external_service *service = a;\n\tconst char *path = b;\n\n\treturn strcmp(service->path, path) == 0;\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"dbus-common.h\"",
      "#include \"gatt-database.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "service->path",
            "path"
          ],
          "line": 1352
        },
        "resolved": true,
        "details": {
          "function_name": "g_strcmp",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "1927-1930",
          "snippet": "static gint g_strcmp(gconstpointer a, gconstpointer b)\n{\n\treturn strcmp(a, b);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic gint g_strcmp(gconstpointer a, gconstpointer b)\n{\n\treturn strcmp(a, b);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic bool match_service_by_path(const void *a, const void *b)\n{\n\tconst struct external_service *service = a;\n\tconst char *path = b;\n\n\treturn strcmp(service->path, path) == 0;\n}"
  },
  {
    "function_name": "remove_app",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
    "lines": "1321-1345",
    "snippet": "static void remove_app(void *data)\n{\n\tstruct gatt_app *app = data;\n\n\t/*\n\t * Set callback to NULL to avoid potential race condition\n\t * when calling remove_app and GDBusClient unref.\n\t */\n\tg_dbus_client_set_disconnect_watch(app->client, NULL, NULL);\n\n\t/*\n\t * Set proxy handlers to NULL, so that this gets called only once when\n\t * the first proxy that belongs to this service gets removed.\n\t */\n\tg_dbus_client_set_proxy_handlers(app->client, NULL, NULL, NULL, NULL);\n\n\n\tqueue_remove(app->database->apps, app);\n\n\t/*\n\t * Do not run in the same loop, this may be a disconnect\n\t * watch call and GDBusClient should not be destroyed.\n\t */\n\tg_idle_add(app_free_idle_cb, app);\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"dbus-common.h\"",
      "#include \"gatt-database.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_idle_add",
          "args": [
            "app_free_idle_cb",
            "app"
          ],
          "line": 1344
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "queue_remove",
          "args": [
            "app->database->apps",
            "app"
          ],
          "line": 1338
        },
        "resolved": true,
        "details": {
          "function_name": "queue_remove_uuid",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
          "lines": "526-541",
          "snippet": "static bool queue_remove_uuid(struct queue *queue, bt_uuid_t *uuid)\n{\n\tbt_uuid_t *removed;\n\n\tif (!queue || !uuid)\n\t\treturn false;\n\n\tremoved = queue_remove_if(queue, uuid_match, uuid);\n\n\tif (removed) {\n\t\tfree(removed);\n\t\treturn true;\n\t}\n\n\treturn false;\n}",
          "includes": [
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/eir.h\"",
            "#include \"src/shared/ad.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nstatic bool queue_remove_uuid(struct queue *queue, bt_uuid_t *uuid)\n{\n\tbt_uuid_t *removed;\n\n\tif (!queue || !uuid)\n\t\treturn false;\n\n\tremoved = queue_remove_if(queue, uuid_match, uuid);\n\n\tif (removed) {\n\t\tfree(removed);\n\t\treturn true;\n\t}\n\n\treturn false;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_dbus_client_set_proxy_handlers",
          "args": [
            "app->client",
            "NULL",
            "NULL",
            "NULL",
            "NULL"
          ],
          "line": 1335
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_dbus_client_set_disconnect_watch",
          "args": [
            "app->client",
            "NULL",
            "NULL"
          ],
          "line": 1329
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic void remove_app(void *data)\n{\n\tstruct gatt_app *app = data;\n\n\t/*\n\t * Set callback to NULL to avoid potential race condition\n\t * when calling remove_app and GDBusClient unref.\n\t */\n\tg_dbus_client_set_disconnect_watch(app->client, NULL, NULL);\n\n\t/*\n\t * Set proxy handlers to NULL, so that this gets called only once when\n\t * the first proxy that belongs to this service gets removed.\n\t */\n\tg_dbus_client_set_proxy_handlers(app->client, NULL, NULL, NULL, NULL);\n\n\n\tqueue_remove(app->database->apps, app);\n\n\t/*\n\t * Do not run in the same loop, this may be a disconnect\n\t * watch call and GDBusClient should not be destroyed.\n\t */\n\tg_idle_add(app_free_idle_cb, app);\n}"
  },
  {
    "function_name": "client_disconnect_cb",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
    "lines": "1310-1319",
    "snippet": "static void client_disconnect_cb(DBusConnection *conn, void *user_data)\n{\n\tstruct gatt_app *app = user_data;\n\tstruct btd_gatt_database *database = app->database;\n\n\tDBG(\"Client disconnected\");\n\n\tif (queue_remove(database->apps, app))\n\t\tapp_free(app);\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"dbus-common.h\"",
      "#include \"gatt-database.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "app_free",
          "args": [
            "app"
          ],
          "line": 1318
        },
        "resolved": true,
        "details": {
          "function_name": "app_free_idle_cb",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "1303-1308",
          "snippet": "static gboolean app_free_idle_cb(void *data)\n{\n\tapp_free(data);\n\n\treturn FALSE;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic gboolean app_free_idle_cb(void *data)\n{\n\tapp_free(data);\n\n\treturn FALSE;\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_remove",
          "args": [
            "database->apps",
            "app"
          ],
          "line": 1317
        },
        "resolved": true,
        "details": {
          "function_name": "queue_remove_uuid",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
          "lines": "526-541",
          "snippet": "static bool queue_remove_uuid(struct queue *queue, bt_uuid_t *uuid)\n{\n\tbt_uuid_t *removed;\n\n\tif (!queue || !uuid)\n\t\treturn false;\n\n\tremoved = queue_remove_if(queue, uuid_match, uuid);\n\n\tif (removed) {\n\t\tfree(removed);\n\t\treturn true;\n\t}\n\n\treturn false;\n}",
          "includes": [
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/eir.h\"",
            "#include \"src/shared/ad.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nstatic bool queue_remove_uuid(struct queue *queue, bt_uuid_t *uuid)\n{\n\tbt_uuid_t *removed;\n\n\tif (!queue || !uuid)\n\t\treturn false;\n\n\tremoved = queue_remove_if(queue, uuid_match, uuid);\n\n\tif (removed) {\n\t\tfree(removed);\n\t\treturn true;\n\t}\n\n\treturn false;\n}"
        }
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"Client disconnected\""
          ],
          "line": 1315
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic void client_disconnect_cb(DBusConnection *conn, void *user_data)\n{\n\tstruct gatt_app *app = user_data;\n\tstruct btd_gatt_database *database = app->database;\n\n\tDBG(\"Client disconnected\");\n\n\tif (queue_remove(database->apps, app))\n\t\tapp_free(app);\n}"
  },
  {
    "function_name": "app_free_idle_cb",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
    "lines": "1303-1308",
    "snippet": "static gboolean app_free_idle_cb(void *data)\n{\n\tapp_free(data);\n\n\treturn FALSE;\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"dbus-common.h\"",
      "#include \"gatt-database.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "app_free",
          "args": [
            "data"
          ],
          "line": 1305
        },
        "resolved": true,
        "details": {
          "function_name": "app_free_idle_cb",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "1303-1308",
          "snippet": "static gboolean app_free_idle_cb(void *data)\n{\n\tapp_free(data);\n\n\treturn FALSE;\n}",
          "note": "cyclic_reference_detected"
        }
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic gboolean app_free_idle_cb(void *data)\n{\n\tapp_free(data);\n\n\treturn FALSE;\n}"
  },
  {
    "function_name": "match_app",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
    "lines": "1294-1301",
    "snippet": "static bool match_app(const void *a, const void *b)\n{\n\tconst struct gatt_app *app = a;\n\tconst struct svc_match_data *data = b;\n\n\treturn g_strcmp0(app->path, data->path) == 0 &&\n\t\t\t\tg_strcmp0(app->owner, data->sender) == 0;\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"dbus-common.h\"",
      "#include \"gatt-database.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_strcmp0",
          "args": [
            "app->owner",
            "data->sender"
          ],
          "line": 1300
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_strcmp0",
          "args": [
            "app->path",
            "data->path"
          ],
          "line": 1299
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic bool match_app(const void *a, const void *b)\n{\n\tconst struct gatt_app *app = a;\n\tconst struct svc_match_data *data = b;\n\n\treturn g_strcmp0(app->path, data->path) == 0 &&\n\t\t\t\tg_strcmp0(app->owner, data->sender) == 0;\n}"
  },
  {
    "function_name": "gatt_db_service_removed",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
    "lines": "1270-1287",
    "snippet": "static void gatt_db_service_removed(struct gatt_db_attribute *attrib,\n\t\t\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct btd_gatt_database *database = user_data;\n\tstruct gatt_record *rec;\n\n\tDBG(\"Local GATT service removed\");\n\n\trec = queue_remove_if(database->records, match_gatt_record, attrib);\n\tif (rec)\n\t\tgatt_record_free(rec);\n\n\tsend_service_changed(database, attrib);\n\n\tqueue_foreach(database->device_states, remove_device_ccc, attrib);\n\tqueue_remove_all(database->ccc_callbacks, ccc_cb_match_service, attrib,\n\t\t\t\t\t\t\t\tccc_cb_free);\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"dbus-common.h\"",
      "#include \"gatt-database.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "queue_remove_all",
          "args": [
            "database->ccc_callbacks",
            "ccc_cb_match_service",
            "attrib",
            "ccc_cb_free"
          ],
          "line": 1285
        },
        "resolved": true,
        "details": {
          "function_name": "queue_remove_all",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "318-362",
          "snippet": "unsigned int queue_remove_all(struct queue *queue, queue_match_func_t function,\n\t\t\t\tvoid *user_data, queue_destroy_func_t destroy)\n{\n\tstruct queue_entry *entry;\n\tunsigned int count = 0;\n\n\tif (!queue)\n\t\treturn 0;\n\n\tentry = queue->head;\n\n\tif (function) {\n\t\twhile (entry) {\n\t\t\tvoid *data;\n\t\t\tunsigned int entries = queue->entries;\n\n\t\t\tdata = queue_remove_if(queue, function, user_data);\n\t\t\tif (entries == queue->entries)\n\t\t\t\tbreak;\n\n\t\t\tif (destroy)\n\t\t\t\tdestroy(data);\n\n\t\t\tcount++;\n\t\t}\n\t} else {\n\t\tqueue->head = NULL;\n\t\tqueue->tail = NULL;\n\t\tqueue->entries = 0;\n\n\t\twhile (entry) {\n\t\t\tstruct queue_entry *tmp = entry;\n\n\t\t\tentry = entry->next;\n\n\t\t\tif (destroy)\n\t\t\t\tdestroy(tmp->data);\n\n\t\t\tfree(tmp);\n\t\t\tcount++;\n\t\t}\n\t}\n\n\treturn count;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nunsigned int queue_remove_all(struct queue *queue, queue_match_func_t function,\n\t\t\t\tvoid *user_data, queue_destroy_func_t destroy)\n{\n\tstruct queue_entry *entry;\n\tunsigned int count = 0;\n\n\tif (!queue)\n\t\treturn 0;\n\n\tentry = queue->head;\n\n\tif (function) {\n\t\twhile (entry) {\n\t\t\tvoid *data;\n\t\t\tunsigned int entries = queue->entries;\n\n\t\t\tdata = queue_remove_if(queue, function, user_data);\n\t\t\tif (entries == queue->entries)\n\t\t\t\tbreak;\n\n\t\t\tif (destroy)\n\t\t\t\tdestroy(data);\n\n\t\t\tcount++;\n\t\t}\n\t} else {\n\t\tqueue->head = NULL;\n\t\tqueue->tail = NULL;\n\t\tqueue->entries = 0;\n\n\t\twhile (entry) {\n\t\t\tstruct queue_entry *tmp = entry;\n\n\t\t\tentry = entry->next;\n\n\t\t\tif (destroy)\n\t\t\t\tdestroy(tmp->data);\n\n\t\t\tfree(tmp);\n\t\t\tcount++;\n\t\t}\n\t}\n\n\treturn count;\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_foreach",
          "args": [
            "database->device_states",
            "remove_device_ccc",
            "attrib"
          ],
          "line": 1284
        },
        "resolved": true,
        "details": {
          "function_name": "queue_foreach",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "203-224",
          "snippet": "void queue_foreach(struct queue *queue, queue_foreach_func_t function,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue || !function)\n\t\treturn;\n\n\tentry = queue->head;\n\tif (!entry)\n\t\treturn;\n\n\tqueue_ref(queue);\n\twhile (entry && queue->head && queue->ref_count > 1) {\n\t\tstruct queue_entry *next;\n\n\t\tnext = entry->next;\n\t\tfunction(entry->data, user_data);\n\t\tentry = next;\n\t}\n\tqueue_unref(queue);\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nvoid queue_foreach(struct queue *queue, queue_foreach_func_t function,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue || !function)\n\t\treturn;\n\n\tentry = queue->head;\n\tif (!entry)\n\t\treturn;\n\n\tqueue_ref(queue);\n\twhile (entry && queue->head && queue->ref_count > 1) {\n\t\tstruct queue_entry *next;\n\n\t\tnext = entry->next;\n\t\tfunction(entry->data, user_data);\n\t\tentry = next;\n\t}\n\tqueue_unref(queue);\n}"
        }
      },
      {
        "call_info": {
          "callee": "send_service_changed",
          "args": [
            "database",
            "attrib"
          ],
          "line": 1282
        },
        "resolved": true,
        "details": {
          "function_name": "send_service_changed",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "1203-1229",
          "snippet": "static void send_service_changed(struct btd_gatt_database *database,\n\t\t\t\t\tstruct gatt_db_attribute *attrib)\n{\n\tuint16_t start, end;\n\tuint8_t value[4];\n\tuint16_t handle, ccc_handle;\n\n\tif (!gatt_db_attribute_get_service_handles(attrib, &start, &end)) {\n\t\terror(\"Failed to obtain changed service handles\");\n\t\treturn;\n\t}\n\n\thandle = gatt_db_attribute_get_handle(database->svc_chngd);\n\tccc_handle = gatt_db_attribute_get_handle(database->svc_chngd_ccc);\n\n\tif (!handle || !ccc_handle) {\n\t\terror(\"Failed to obtain handles for \\\"Service Changed\\\"\"\n\t\t\t\t\t\t\t\" characteristic\");\n\t\treturn;\n\t}\n\n\tput_le16(start, value);\n\tput_le16(end, value + 2);\n\n\tsend_notification_to_devices(database, handle, value, sizeof(value),\n\t\t\t\t\tccc_handle, service_changed_conf, NULL);\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic void send_service_changed(struct btd_gatt_database *database,\n\t\t\t\t\tstruct gatt_db_attribute *attrib)\n{\n\tuint16_t start, end;\n\tuint8_t value[4];\n\tuint16_t handle, ccc_handle;\n\n\tif (!gatt_db_attribute_get_service_handles(attrib, &start, &end)) {\n\t\terror(\"Failed to obtain changed service handles\");\n\t\treturn;\n\t}\n\n\thandle = gatt_db_attribute_get_handle(database->svc_chngd);\n\tccc_handle = gatt_db_attribute_get_handle(database->svc_chngd_ccc);\n\n\tif (!handle || !ccc_handle) {\n\t\terror(\"Failed to obtain handles for \\\"Service Changed\\\"\"\n\t\t\t\t\t\t\t\" characteristic\");\n\t\treturn;\n\t}\n\n\tput_le16(start, value);\n\tput_le16(end, value + 2);\n\n\tsend_notification_to_devices(database, handle, value, sizeof(value),\n\t\t\t\t\tccc_handle, service_changed_conf, NULL);\n}"
        }
      },
      {
        "call_info": {
          "callee": "gatt_record_free",
          "args": [
            "rec"
          ],
          "line": 1280
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_record_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "569-575",
          "snippet": "static void gatt_record_free(void *data)\n{\n\tstruct gatt_record *rec = data;\n\n\tadapter_service_remove(rec->database->adapter, rec->handle);\n\tfree(rec);\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic void gatt_record_free(void *data)\n{\n\tstruct gatt_record *rec = data;\n\n\tadapter_service_remove(rec->database->adapter, rec->handle);\n\tfree(rec);\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_remove_if",
          "args": [
            "database->records",
            "match_gatt_record",
            "attrib"
          ],
          "line": 1278
        },
        "resolved": true,
        "details": {
          "function_name": "queue_remove_if",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "278-316",
          "snippet": "void *queue_remove_if(struct queue *queue, queue_match_func_t function,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct queue_entry *entry, *prev = NULL;\n\n\tif (!queue)\n\t\treturn NULL;\n\n\tif (!function)\n\t\tfunction = direct_match;\n\n\tentry = queue->head;\n\n\twhile (entry) {\n\t\tif (function(entry->data, user_data)) {\n\t\t\tvoid *data;\n\n\t\t\tif (prev)\n\t\t\t\tprev->next = entry->next;\n\t\t\telse\n\t\t\t\tqueue->head = entry->next;\n\n\t\t\tif (!entry->next)\n\t\t\t\tqueue->tail = prev;\n\n\t\t\tdata = entry->data;\n\n\t\t\tfree(entry);\n\t\t\tqueue->entries--;\n\n\t\t\treturn data;\n\t\t} else {\n\t\t\tprev = entry;\n\t\t\tentry = entry->next;\n\t\t}\n\t}\n\n\treturn NULL;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nvoid *queue_remove_if(struct queue *queue, queue_match_func_t function,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct queue_entry *entry, *prev = NULL;\n\n\tif (!queue)\n\t\treturn NULL;\n\n\tif (!function)\n\t\tfunction = direct_match;\n\n\tentry = queue->head;\n\n\twhile (entry) {\n\t\tif (function(entry->data, user_data)) {\n\t\t\tvoid *data;\n\n\t\t\tif (prev)\n\t\t\t\tprev->next = entry->next;\n\t\t\telse\n\t\t\t\tqueue->head = entry->next;\n\n\t\t\tif (!entry->next)\n\t\t\t\tqueue->tail = prev;\n\n\t\t\tdata = entry->data;\n\n\t\t\tfree(entry);\n\t\t\tqueue->entries--;\n\n\t\t\treturn data;\n\t\t} else {\n\t\t\tprev = entry;\n\t\t\tentry = entry->next;\n\t\t}\n\t}\n\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"Local GATT service removed\""
          ],
          "line": 1276
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic void gatt_db_service_removed(struct gatt_db_attribute *attrib,\n\t\t\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct btd_gatt_database *database = user_data;\n\tstruct gatt_record *rec;\n\n\tDBG(\"Local GATT service removed\");\n\n\trec = queue_remove_if(database->records, match_gatt_record, attrib);\n\tif (rec)\n\t\tgatt_record_free(rec);\n\n\tsend_service_changed(database, attrib);\n\n\tqueue_foreach(database->device_states, remove_device_ccc, attrib);\n\tqueue_remove_all(database->ccc_callbacks, ccc_cb_match_service, attrib,\n\t\t\t\t\t\t\t\tccc_cb_free);\n}"
  },
  {
    "function_name": "match_gatt_record",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
    "lines": "1262-1268",
    "snippet": "static bool match_gatt_record(const void *data, const void *user_data)\n{\n\tconst struct gatt_record *rec = data;\n\tconst struct gatt_db_attribute *attr = user_data;\n\n\treturn (rec->attr == attr);\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"dbus-common.h\"",
      "#include \"gatt-database.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic bool match_gatt_record(const void *data, const void *user_data)\n{\n\tconst struct gatt_record *rec = data;\n\tconst struct gatt_db_attribute *attr = user_data;\n\n\treturn (rec->attr == attr);\n}"
  },
  {
    "function_name": "remove_device_ccc",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
    "lines": "1255-1260",
    "snippet": "static void remove_device_ccc(void *data, void *user_data)\n{\n\tstruct device_state *state = data;\n\n\tqueue_remove_all(state->ccc_states, ccc_match_service, user_data, free);\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"dbus-common.h\"",
      "#include \"gatt-database.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "queue_remove_all",
          "args": [
            "state->ccc_states",
            "ccc_match_service",
            "user_data",
            "free"
          ],
          "line": 1259
        },
        "resolved": true,
        "details": {
          "function_name": "queue_remove_all",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "318-362",
          "snippet": "unsigned int queue_remove_all(struct queue *queue, queue_match_func_t function,\n\t\t\t\tvoid *user_data, queue_destroy_func_t destroy)\n{\n\tstruct queue_entry *entry;\n\tunsigned int count = 0;\n\n\tif (!queue)\n\t\treturn 0;\n\n\tentry = queue->head;\n\n\tif (function) {\n\t\twhile (entry) {\n\t\t\tvoid *data;\n\t\t\tunsigned int entries = queue->entries;\n\n\t\t\tdata = queue_remove_if(queue, function, user_data);\n\t\t\tif (entries == queue->entries)\n\t\t\t\tbreak;\n\n\t\t\tif (destroy)\n\t\t\t\tdestroy(data);\n\n\t\t\tcount++;\n\t\t}\n\t} else {\n\t\tqueue->head = NULL;\n\t\tqueue->tail = NULL;\n\t\tqueue->entries = 0;\n\n\t\twhile (entry) {\n\t\t\tstruct queue_entry *tmp = entry;\n\n\t\t\tentry = entry->next;\n\n\t\t\tif (destroy)\n\t\t\t\tdestroy(tmp->data);\n\n\t\t\tfree(tmp);\n\t\t\tcount++;\n\t\t}\n\t}\n\n\treturn count;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nunsigned int queue_remove_all(struct queue *queue, queue_match_func_t function,\n\t\t\t\tvoid *user_data, queue_destroy_func_t destroy)\n{\n\tstruct queue_entry *entry;\n\tunsigned int count = 0;\n\n\tif (!queue)\n\t\treturn 0;\n\n\tentry = queue->head;\n\n\tif (function) {\n\t\twhile (entry) {\n\t\t\tvoid *data;\n\t\t\tunsigned int entries = queue->entries;\n\n\t\t\tdata = queue_remove_if(queue, function, user_data);\n\t\t\tif (entries == queue->entries)\n\t\t\t\tbreak;\n\n\t\t\tif (destroy)\n\t\t\t\tdestroy(data);\n\n\t\t\tcount++;\n\t\t}\n\t} else {\n\t\tqueue->head = NULL;\n\t\tqueue->tail = NULL;\n\t\tqueue->entries = 0;\n\n\t\twhile (entry) {\n\t\t\tstruct queue_entry *tmp = entry;\n\n\t\t\tentry = entry->next;\n\n\t\t\tif (destroy)\n\t\t\t\tdestroy(tmp->data);\n\n\t\t\tfree(tmp);\n\t\t\tcount++;\n\t\t}\n\t}\n\n\treturn count;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic void remove_device_ccc(void *data, void *user_data)\n{\n\tstruct device_state *state = data;\n\n\tqueue_remove_all(state->ccc_states, ccc_match_service, user_data, free);\n}"
  },
  {
    "function_name": "ccc_match_service",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
    "lines": "1243-1253",
    "snippet": "static bool ccc_match_service(const void *data, const void *match_data)\n{\n\tconst struct ccc_state *ccc = data;\n\tconst struct gatt_db_attribute *attrib = match_data;\n\tuint16_t start, end;\n\n\tif (!gatt_db_attribute_get_service_handles(attrib, &start, &end))\n\t\treturn false;\n\n\treturn ccc->handle >= start && ccc->handle <= end;\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"dbus-common.h\"",
      "#include \"gatt-database.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "gatt_db_attribute_get_service_handles",
          "args": [
            "attrib",
            "&start",
            "&end"
          ],
          "line": 1249
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_attribute_get_service_handles",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "1521-1536",
          "snippet": "bool gatt_db_attribute_get_service_handles(\n\t\t\t\t\tconst struct gatt_db_attribute *attrib,\n\t\t\t\t\tuint16_t *start_handle,\n\t\t\t\t\tuint16_t *end_handle)\n{\n\tstruct gatt_db_service *service;\n\n\tif (!attrib)\n\t\treturn false;\n\n\tservice = attrib->service;\n\n\tgatt_db_service_get_handles(service, start_handle, end_handle);\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nbool gatt_db_attribute_get_service_handles(\n\t\t\t\t\tconst struct gatt_db_attribute *attrib,\n\t\t\t\t\tuint16_t *start_handle,\n\t\t\t\t\tuint16_t *end_handle)\n{\n\tstruct gatt_db_service *service;\n\n\tif (!attrib)\n\t\treturn false;\n\n\tservice = attrib->service;\n\n\tgatt_db_service_get_handles(service, start_handle, end_handle);\n\n\treturn true;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic bool ccc_match_service(const void *data, const void *match_data)\n{\n\tconst struct ccc_state *ccc = data;\n\tconst struct gatt_db_attribute *attrib = match_data;\n\tuint16_t start, end;\n\n\tif (!gatt_db_attribute_get_service_handles(attrib, &start, &end))\n\t\treturn false;\n\n\treturn ccc->handle >= start && ccc->handle <= end;\n}"
  },
  {
    "function_name": "gatt_db_service_added",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
    "lines": "1231-1241",
    "snippet": "static void gatt_db_service_added(struct gatt_db_attribute *attrib,\n\t\t\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct btd_gatt_database *database = user_data;\n\n\tDBG(\"GATT Service added to local database\");\n\n\tdatabase_add_record(database, attrib);\n\n\tsend_service_changed(database, attrib);\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"dbus-common.h\"",
      "#include \"gatt-database.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "send_service_changed",
          "args": [
            "database",
            "attrib"
          ],
          "line": 1240
        },
        "resolved": true,
        "details": {
          "function_name": "send_service_changed",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "1203-1229",
          "snippet": "static void send_service_changed(struct btd_gatt_database *database,\n\t\t\t\t\tstruct gatt_db_attribute *attrib)\n{\n\tuint16_t start, end;\n\tuint8_t value[4];\n\tuint16_t handle, ccc_handle;\n\n\tif (!gatt_db_attribute_get_service_handles(attrib, &start, &end)) {\n\t\terror(\"Failed to obtain changed service handles\");\n\t\treturn;\n\t}\n\n\thandle = gatt_db_attribute_get_handle(database->svc_chngd);\n\tccc_handle = gatt_db_attribute_get_handle(database->svc_chngd_ccc);\n\n\tif (!handle || !ccc_handle) {\n\t\terror(\"Failed to obtain handles for \\\"Service Changed\\\"\"\n\t\t\t\t\t\t\t\" characteristic\");\n\t\treturn;\n\t}\n\n\tput_le16(start, value);\n\tput_le16(end, value + 2);\n\n\tsend_notification_to_devices(database, handle, value, sizeof(value),\n\t\t\t\t\tccc_handle, service_changed_conf, NULL);\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic void send_service_changed(struct btd_gatt_database *database,\n\t\t\t\t\tstruct gatt_db_attribute *attrib)\n{\n\tuint16_t start, end;\n\tuint8_t value[4];\n\tuint16_t handle, ccc_handle;\n\n\tif (!gatt_db_attribute_get_service_handles(attrib, &start, &end)) {\n\t\terror(\"Failed to obtain changed service handles\");\n\t\treturn;\n\t}\n\n\thandle = gatt_db_attribute_get_handle(database->svc_chngd);\n\tccc_handle = gatt_db_attribute_get_handle(database->svc_chngd_ccc);\n\n\tif (!handle || !ccc_handle) {\n\t\terror(\"Failed to obtain handles for \\\"Service Changed\\\"\"\n\t\t\t\t\t\t\t\" characteristic\");\n\t\treturn;\n\t}\n\n\tput_le16(start, value);\n\tput_le16(end, value + 2);\n\n\tsend_notification_to_devices(database, handle, value, sizeof(value),\n\t\t\t\t\tccc_handle, service_changed_conf, NULL);\n}"
        }
      },
      {
        "call_info": {
          "callee": "database_add_record",
          "args": [
            "database",
            "attrib"
          ],
          "line": 1238
        },
        "resolved": true,
        "details": {
          "function_name": "database_add_record",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "758-815",
          "snippet": "static void database_add_record(struct btd_gatt_database *database,\n\t\t\t\t\tstruct gatt_db_attribute *attr)\n{\n\tstruct gatt_record *rec;\n\tsdp_record_t *record;\n\tuint16_t start, end;\n\tuuid_t svc, gap_uuid;\n\tbt_uuid_t uuid;\n\tconst char *name = NULL;\n\tchar uuidstr[MAX_LEN_UUID_STR];\n\n\tgatt_db_attribute_get_service_uuid(attr, &uuid);\n\n\tswitch (uuid.type) {\n\tcase BT_UUID16:\n\t\tname = bt_uuid16_to_str(uuid.value.u16);\n\t\tsdp_uuid16_create(&svc, uuid.value.u16);\n\t\tbreak;\n\tcase BT_UUID32:\n\t\tname = bt_uuid32_to_str(uuid.value.u32);\n\t\tsdp_uuid32_create(&svc, uuid.value.u32);\n\t\tbreak;\n\tcase BT_UUID128:\n\t\tbt_uuid_to_string(&uuid, uuidstr, sizeof(uuidstr));\n\t\tname = bt_uuidstr_to_str(uuidstr);\n\t\tsdp_uuid128_create(&svc, (void *) &uuid.value.u128);\n\t\tbreak;\n\tcase BT_UUID_UNSPEC:\n\t\treturn;\n\t}\n\n\tgatt_db_attribute_get_service_handles(attr, &start, &end);\n\n\trecord = record_new(&svc, start, end);\n\tif (!record)\n\t\treturn;\n\n\tif (name != NULL)\n\t\tsdp_set_info_attr(record, name, \"BlueZ\", NULL);\n\n\tsdp_uuid16_create(&gap_uuid, UUID_GAP);\n\tif (sdp_uuid_cmp(&svc, &gap_uuid) == 0) {\n\t\tsdp_set_url_attr(record, \"http://www.bluez.org/\",\n\t\t\t\t\"http://www.bluez.org/\",\n\t\t\t\t\"http://www.bluez.org/\");\n\t}\n\n\tif (adapter_service_add(database->adapter, record) < 0) {\n\t\tsdp_record_free(record);\n\t\treturn;\n\t}\n\n\trec = new0(struct gatt_record, 1);\n\trec->database = database;\n\trec->handle = record->handle;\n\trec->attr = attr;\n\tqueue_push_tail(database->records, rec);\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define UUID_GAP\t0x1800"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\n#define UUID_GAP\t0x1800\n\nstatic void database_add_record(struct btd_gatt_database *database,\n\t\t\t\t\tstruct gatt_db_attribute *attr)\n{\n\tstruct gatt_record *rec;\n\tsdp_record_t *record;\n\tuint16_t start, end;\n\tuuid_t svc, gap_uuid;\n\tbt_uuid_t uuid;\n\tconst char *name = NULL;\n\tchar uuidstr[MAX_LEN_UUID_STR];\n\n\tgatt_db_attribute_get_service_uuid(attr, &uuid);\n\n\tswitch (uuid.type) {\n\tcase BT_UUID16:\n\t\tname = bt_uuid16_to_str(uuid.value.u16);\n\t\tsdp_uuid16_create(&svc, uuid.value.u16);\n\t\tbreak;\n\tcase BT_UUID32:\n\t\tname = bt_uuid32_to_str(uuid.value.u32);\n\t\tsdp_uuid32_create(&svc, uuid.value.u32);\n\t\tbreak;\n\tcase BT_UUID128:\n\t\tbt_uuid_to_string(&uuid, uuidstr, sizeof(uuidstr));\n\t\tname = bt_uuidstr_to_str(uuidstr);\n\t\tsdp_uuid128_create(&svc, (void *) &uuid.value.u128);\n\t\tbreak;\n\tcase BT_UUID_UNSPEC:\n\t\treturn;\n\t}\n\n\tgatt_db_attribute_get_service_handles(attr, &start, &end);\n\n\trecord = record_new(&svc, start, end);\n\tif (!record)\n\t\treturn;\n\n\tif (name != NULL)\n\t\tsdp_set_info_attr(record, name, \"BlueZ\", NULL);\n\n\tsdp_uuid16_create(&gap_uuid, UUID_GAP);\n\tif (sdp_uuid_cmp(&svc, &gap_uuid) == 0) {\n\t\tsdp_set_url_attr(record, \"http://www.bluez.org/\",\n\t\t\t\t\"http://www.bluez.org/\",\n\t\t\t\t\"http://www.bluez.org/\");\n\t}\n\n\tif (adapter_service_add(database->adapter, record) < 0) {\n\t\tsdp_record_free(record);\n\t\treturn;\n\t}\n\n\trec = new0(struct gatt_record, 1);\n\trec->database = database;\n\trec->handle = record->handle;\n\trec->attr = attr;\n\tqueue_push_tail(database->records, rec);\n}"
        }
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"GATT Service added to local database\""
          ],
          "line": 1236
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic void gatt_db_service_added(struct gatt_db_attribute *attrib,\n\t\t\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct btd_gatt_database *database = user_data;\n\n\tDBG(\"GATT Service added to local database\");\n\n\tdatabase_add_record(database, attrib);\n\n\tsend_service_changed(database, attrib);\n}"
  },
  {
    "function_name": "send_service_changed",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
    "lines": "1203-1229",
    "snippet": "static void send_service_changed(struct btd_gatt_database *database,\n\t\t\t\t\tstruct gatt_db_attribute *attrib)\n{\n\tuint16_t start, end;\n\tuint8_t value[4];\n\tuint16_t handle, ccc_handle;\n\n\tif (!gatt_db_attribute_get_service_handles(attrib, &start, &end)) {\n\t\terror(\"Failed to obtain changed service handles\");\n\t\treturn;\n\t}\n\n\thandle = gatt_db_attribute_get_handle(database->svc_chngd);\n\tccc_handle = gatt_db_attribute_get_handle(database->svc_chngd_ccc);\n\n\tif (!handle || !ccc_handle) {\n\t\terror(\"Failed to obtain handles for \\\"Service Changed\\\"\"\n\t\t\t\t\t\t\t\" characteristic\");\n\t\treturn;\n\t}\n\n\tput_le16(start, value);\n\tput_le16(end, value + 2);\n\n\tsend_notification_to_devices(database, handle, value, sizeof(value),\n\t\t\t\t\tccc_handle, service_changed_conf, NULL);\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"dbus-common.h\"",
      "#include \"gatt-database.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "send_notification_to_devices",
          "args": [
            "database",
            "handle",
            "value",
            "sizeof(value)",
            "ccc_handle",
            "service_changed_conf",
            "NULL"
          ],
          "line": 1227
        },
        "resolved": true,
        "details": {
          "function_name": "send_notification_to_devices",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "1181-1201",
          "snippet": "static void send_notification_to_devices(struct btd_gatt_database *database,\n\t\t\t\t\tuint16_t handle, uint8_t *value,\n\t\t\t\t\tuint16_t len, uint16_t ccc_handle,\n\t\t\t\t\tbt_gatt_server_conf_func_t conf,\n\t\t\t\t\tvoid *user_data)\n{\n\tstruct notify notify;\n\n\tmemset(&notify, 0, sizeof(notify));\n\n\tnotify.database = database;\n\tnotify.handle = handle;\n\tnotify.ccc_handle = ccc_handle;\n\tnotify.value = value;\n\tnotify.len = len;\n\tnotify.conf = conf;\n\tnotify.user_data = user_data;\n\n\tqueue_foreach(database->device_states, send_notification_to_device,\n\t\t\t\t\t\t\t\t&notify);\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic void send_notification_to_devices(struct btd_gatt_database *database,\n\t\t\t\t\tuint16_t handle, uint8_t *value,\n\t\t\t\t\tuint16_t len, uint16_t ccc_handle,\n\t\t\t\t\tbt_gatt_server_conf_func_t conf,\n\t\t\t\t\tvoid *user_data)\n{\n\tstruct notify notify;\n\n\tmemset(&notify, 0, sizeof(notify));\n\n\tnotify.database = database;\n\tnotify.handle = handle;\n\tnotify.ccc_handle = ccc_handle;\n\tnotify.value = value;\n\tnotify.len = len;\n\tnotify.conf = conf;\n\tnotify.user_data = user_data;\n\n\tqueue_foreach(database->device_states, send_notification_to_device,\n\t\t\t\t\t\t\t\t&notify);\n}"
        }
      },
      {
        "call_info": {
          "callee": "put_le16",
          "args": [
            "end",
            "value + 2"
          ],
          "line": 1225
        },
        "resolved": true,
        "details": {
          "function_name": "put_le16",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/util.h",
          "lines": "159-162",
          "snippet": "static inline void put_le16(uint16_t val, void *dst)\n{\n\tput_unaligned(cpu_to_le16(val), (uint16_t *) dst);\n}",
          "includes": [
            "#include <string.h>",
            "#include <byteswap.h>",
            "#include <alloca.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <byteswap.h>\n#include <alloca.h>\n#include <stdlib.h>\n#include <stdint.h>\n\nstatic inline void put_le16(uint16_t val, void *dst)\n{\n\tput_unaligned(cpu_to_le16(val), (uint16_t *) dst);\n}"
        }
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"Failed to obtain handles for \\\"Service Changed\\\"\"\n\t\t\t\t\t\t\t\" characteristic\""
          ],
          "line": 1219
        },
        "resolved": true,
        "details": {
          "function_name": "dbus_error_to_att_ecode",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "1833-1855",
          "snippet": "static uint8_t dbus_error_to_att_ecode(const char *error_name)\n{\n\n\tif (strcmp(error_name, \"org.bluez.Error.Failed\") == 0)\n\t\treturn 0x80;  /* For now return this \"application error\" */\n\n\tif (strcmp(error_name, \"org.bluez.Error.NotSupported\") == 0)\n\t\treturn BT_ATT_ERROR_REQUEST_NOT_SUPPORTED;\n\n\tif (strcmp(error_name, \"org.bluez.Error.NotAuthorized\") == 0)\n\t\treturn BT_ATT_ERROR_AUTHORIZATION;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InvalidValueLength\") == 0)\n\t\treturn BT_ATT_ERROR_INVALID_ATTRIBUTE_VALUE_LEN;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InvalidOffset\") == 0)\n\t\treturn BT_ATT_ERROR_INVALID_OFFSET;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InProgress\") == 0)\n\t\treturn BT_ERROR_ALREADY_IN_PROGRESS;\n\n\treturn 0;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic uint8_t dbus_error_to_att_ecode(const char *error_name)\n{\n\n\tif (strcmp(error_name, \"org.bluez.Error.Failed\") == 0)\n\t\treturn 0x80;  /* For now return this \"application error\" */\n\n\tif (strcmp(error_name, \"org.bluez.Error.NotSupported\") == 0)\n\t\treturn BT_ATT_ERROR_REQUEST_NOT_SUPPORTED;\n\n\tif (strcmp(error_name, \"org.bluez.Error.NotAuthorized\") == 0)\n\t\treturn BT_ATT_ERROR_AUTHORIZATION;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InvalidValueLength\") == 0)\n\t\treturn BT_ATT_ERROR_INVALID_ATTRIBUTE_VALUE_LEN;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InvalidOffset\") == 0)\n\t\treturn BT_ATT_ERROR_INVALID_OFFSET;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InProgress\") == 0)\n\t\treturn BT_ERROR_ALREADY_IN_PROGRESS;\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "gatt_db_attribute_get_handle",
          "args": [
            "database->svc_chngd_ccc"
          ],
          "line": 1216
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_attribute_get_handle",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "1482-1488",
          "snippet": "uint16_t gatt_db_attribute_get_handle(const struct gatt_db_attribute *attrib)\n{\n\tif (!attrib)\n\t\treturn 0;\n\n\treturn attrib->handle;\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nuint16_t gatt_db_attribute_get_handle(const struct gatt_db_attribute *attrib)\n{\n\tif (!attrib)\n\t\treturn 0;\n\n\treturn attrib->handle;\n}"
        }
      },
      {
        "call_info": {
          "callee": "gatt_db_attribute_get_service_handles",
          "args": [
            "attrib",
            "&start",
            "&end"
          ],
          "line": 1210
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_attribute_get_service_handles",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "1521-1536",
          "snippet": "bool gatt_db_attribute_get_service_handles(\n\t\t\t\t\tconst struct gatt_db_attribute *attrib,\n\t\t\t\t\tuint16_t *start_handle,\n\t\t\t\t\tuint16_t *end_handle)\n{\n\tstruct gatt_db_service *service;\n\n\tif (!attrib)\n\t\treturn false;\n\n\tservice = attrib->service;\n\n\tgatt_db_service_get_handles(service, start_handle, end_handle);\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nbool gatt_db_attribute_get_service_handles(\n\t\t\t\t\tconst struct gatt_db_attribute *attrib,\n\t\t\t\t\tuint16_t *start_handle,\n\t\t\t\t\tuint16_t *end_handle)\n{\n\tstruct gatt_db_service *service;\n\n\tif (!attrib)\n\t\treturn false;\n\n\tservice = attrib->service;\n\n\tgatt_db_service_get_handles(service, start_handle, end_handle);\n\n\treturn true;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic void send_service_changed(struct btd_gatt_database *database,\n\t\t\t\t\tstruct gatt_db_attribute *attrib)\n{\n\tuint16_t start, end;\n\tuint8_t value[4];\n\tuint16_t handle, ccc_handle;\n\n\tif (!gatt_db_attribute_get_service_handles(attrib, &start, &end)) {\n\t\terror(\"Failed to obtain changed service handles\");\n\t\treturn;\n\t}\n\n\thandle = gatt_db_attribute_get_handle(database->svc_chngd);\n\tccc_handle = gatt_db_attribute_get_handle(database->svc_chngd_ccc);\n\n\tif (!handle || !ccc_handle) {\n\t\terror(\"Failed to obtain handles for \\\"Service Changed\\\"\"\n\t\t\t\t\t\t\t\" characteristic\");\n\t\treturn;\n\t}\n\n\tput_le16(start, value);\n\tput_le16(end, value + 2);\n\n\tsend_notification_to_devices(database, handle, value, sizeof(value),\n\t\t\t\t\tccc_handle, service_changed_conf, NULL);\n}"
  },
  {
    "function_name": "send_notification_to_devices",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
    "lines": "1181-1201",
    "snippet": "static void send_notification_to_devices(struct btd_gatt_database *database,\n\t\t\t\t\tuint16_t handle, uint8_t *value,\n\t\t\t\t\tuint16_t len, uint16_t ccc_handle,\n\t\t\t\t\tbt_gatt_server_conf_func_t conf,\n\t\t\t\t\tvoid *user_data)\n{\n\tstruct notify notify;\n\n\tmemset(&notify, 0, sizeof(notify));\n\n\tnotify.database = database;\n\tnotify.handle = handle;\n\tnotify.ccc_handle = ccc_handle;\n\tnotify.value = value;\n\tnotify.len = len;\n\tnotify.conf = conf;\n\tnotify.user_data = user_data;\n\n\tqueue_foreach(database->device_states, send_notification_to_device,\n\t\t\t\t\t\t\t\t&notify);\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"dbus-common.h\"",
      "#include \"gatt-database.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "queue_foreach",
          "args": [
            "database->device_states",
            "send_notification_to_device",
            "&notify"
          ],
          "line": 1199
        },
        "resolved": true,
        "details": {
          "function_name": "queue_foreach",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "203-224",
          "snippet": "void queue_foreach(struct queue *queue, queue_foreach_func_t function,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue || !function)\n\t\treturn;\n\n\tentry = queue->head;\n\tif (!entry)\n\t\treturn;\n\n\tqueue_ref(queue);\n\twhile (entry && queue->head && queue->ref_count > 1) {\n\t\tstruct queue_entry *next;\n\n\t\tnext = entry->next;\n\t\tfunction(entry->data, user_data);\n\t\tentry = next;\n\t}\n\tqueue_unref(queue);\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nvoid queue_foreach(struct queue *queue, queue_foreach_func_t function,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue || !function)\n\t\treturn;\n\n\tentry = queue->head;\n\tif (!entry)\n\t\treturn;\n\n\tqueue_ref(queue);\n\twhile (entry && queue->head && queue->ref_count > 1) {\n\t\tstruct queue_entry *next;\n\n\t\tnext = entry->next;\n\t\tfunction(entry->data, user_data);\n\t\tentry = next;\n\t}\n\tqueue_unref(queue);\n}"
        }
      },
      {
        "call_info": {
          "callee": "memset",
          "args": [
            "&notify",
            "0",
            "sizeof(notify)"
          ],
          "line": 1189
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic void send_notification_to_devices(struct btd_gatt_database *database,\n\t\t\t\t\tuint16_t handle, uint8_t *value,\n\t\t\t\t\tuint16_t len, uint16_t ccc_handle,\n\t\t\t\t\tbt_gatt_server_conf_func_t conf,\n\t\t\t\t\tvoid *user_data)\n{\n\tstruct notify notify;\n\n\tmemset(&notify, 0, sizeof(notify));\n\n\tnotify.database = database;\n\tnotify.handle = handle;\n\tnotify.ccc_handle = ccc_handle;\n\tnotify.value = value;\n\tnotify.len = len;\n\tnotify.conf = conf;\n\tnotify.user_data = user_data;\n\n\tqueue_foreach(database->device_states, send_notification_to_device,\n\t\t\t\t\t\t\t\t&notify);\n}"
  },
  {
    "function_name": "send_notification_to_device",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
    "lines": "1124-1179",
    "snippet": "static void send_notification_to_device(void *data, void *user_data)\n{\n\tstruct device_state *device_state = data;\n\tstruct notify *notify = user_data;\n\tstruct ccc_state *ccc;\n\tstruct btd_device *device;\n\tstruct bt_gatt_server *server;\n\n\tccc = find_ccc_state(device_state, notify->ccc_handle);\n\tif (!ccc)\n\t\treturn;\n\n\tif (!ccc->value[0] || (notify->conf && !(ccc->value[0] & 0x02)))\n\t\treturn;\n\n\tdevice = btd_adapter_get_device(notify->database->adapter,\n\t\t\t\t\t\t&device_state->bdaddr,\n\t\t\t\t\t\tdevice_state->bdaddr_type);\n\tif (!device)\n\t\tgoto remove;\n\n\tserver = btd_device_get_gatt_server(device);\n\tif (!server) {\n\t\tif (!device_is_bonded(device, device_state->bdaddr_type))\n\t\t\tgoto remove;\n\t\tstate_set_pending(device_state, notify);\n\t\treturn;\n\t}\n\n\t/*\n\t * TODO: If the device is not connected but bonded, send the\n\t * notification/indication when it becomes connected.\n\t */\n\tif (!notify->conf) {\n\t\tDBG(\"GATT server sending notification\");\n\t\tbt_gatt_server_send_notification(server,\n\t\t\t\t\tnotify->handle, notify->value,\n\t\t\t\t\tnotify->len);\n\t\treturn;\n\t}\n\n\tDBG(\"GATT server sending indication\");\n\tbt_gatt_server_send_indication(server, notify->handle, notify->value,\n\t\t\t\t\t\tnotify->len, notify->conf,\n\t\t\t\t\t\tnotify->user_data, NULL);\n\n\treturn;\n\nremove:\n\t/* Remove device state if device no longer exists or is not paired */\n\tif (queue_remove(notify->database->device_states, device_state)) {\n\t\tqueue_foreach(device_state->ccc_states, clear_ccc_state,\n\t\t\t\t\t\tnotify->database);\n\t\tdevice_state_free(device_state);\n\t}\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"dbus-common.h\"",
      "#include \"gatt-database.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "device_state_free",
          "args": [
            "device_state"
          ],
          "line": 1177
        },
        "resolved": true,
        "details": {
          "function_name": "device_state_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "288-300",
          "snippet": "static void device_state_free(void *data)\n{\n\tstruct device_state *state = data;\n\n\tqueue_destroy(state->ccc_states, free);\n\n\tif (state->pending) {\n\t\tfree(state->pending->value);\n\t\tfree(state->pending);\n\t}\n\n\tfree(state);\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic void device_state_free(void *data)\n{\n\tstruct device_state *state = data;\n\n\tqueue_destroy(state->ccc_states, free);\n\n\tif (state->pending) {\n\t\tfree(state->pending->value);\n\t\tfree(state->pending);\n\t}\n\n\tfree(state);\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_foreach",
          "args": [
            "device_state->ccc_states",
            "clear_ccc_state",
            "notify->database"
          ],
          "line": 1175
        },
        "resolved": true,
        "details": {
          "function_name": "queue_foreach",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "203-224",
          "snippet": "void queue_foreach(struct queue *queue, queue_foreach_func_t function,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue || !function)\n\t\treturn;\n\n\tentry = queue->head;\n\tif (!entry)\n\t\treturn;\n\n\tqueue_ref(queue);\n\twhile (entry && queue->head && queue->ref_count > 1) {\n\t\tstruct queue_entry *next;\n\n\t\tnext = entry->next;\n\t\tfunction(entry->data, user_data);\n\t\tentry = next;\n\t}\n\tqueue_unref(queue);\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nvoid queue_foreach(struct queue *queue, queue_foreach_func_t function,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue || !function)\n\t\treturn;\n\n\tentry = queue->head;\n\tif (!entry)\n\t\treturn;\n\n\tqueue_ref(queue);\n\twhile (entry && queue->head && queue->ref_count > 1) {\n\t\tstruct queue_entry *next;\n\n\t\tnext = entry->next;\n\t\tfunction(entry->data, user_data);\n\t\tentry = next;\n\t}\n\tqueue_unref(queue);\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_remove",
          "args": [
            "notify->database->device_states",
            "device_state"
          ],
          "line": 1174
        },
        "resolved": true,
        "details": {
          "function_name": "queue_remove_uuid",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
          "lines": "526-541",
          "snippet": "static bool queue_remove_uuid(struct queue *queue, bt_uuid_t *uuid)\n{\n\tbt_uuid_t *removed;\n\n\tif (!queue || !uuid)\n\t\treturn false;\n\n\tremoved = queue_remove_if(queue, uuid_match, uuid);\n\n\tif (removed) {\n\t\tfree(removed);\n\t\treturn true;\n\t}\n\n\treturn false;\n}",
          "includes": [
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/eir.h\"",
            "#include \"src/shared/ad.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nstatic bool queue_remove_uuid(struct queue *queue, bt_uuid_t *uuid)\n{\n\tbt_uuid_t *removed;\n\n\tif (!queue || !uuid)\n\t\treturn false;\n\n\tremoved = queue_remove_if(queue, uuid_match, uuid);\n\n\tif (removed) {\n\t\tfree(removed);\n\t\treturn true;\n\t}\n\n\treturn false;\n}"
        }
      },
      {
        "call_info": {
          "callee": "bt_gatt_server_send_indication",
          "args": [
            "server",
            "notify->handle",
            "notify->value",
            "notify->len",
            "notify->conf",
            "notify->user_data",
            "NULL"
          ],
          "line": 1166
        },
        "resolved": true,
        "details": {
          "function_name": "bt_gatt_server_send_indication",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-server.c",
          "lines": "1681-1719",
          "snippet": "bool bt_gatt_server_send_indication(struct bt_gatt_server *server,\n\t\t\t\t\tuint16_t handle, const uint8_t *value,\n\t\t\t\t\tuint16_t length,\n\t\t\t\t\tbt_gatt_server_conf_func_t callback,\n\t\t\t\t\tvoid *user_data,\n\t\t\t\t\tbt_gatt_server_destroy_func_t destroy)\n{\n\tuint16_t pdu_len;\n\tuint8_t *pdu;\n\tstruct ind_data *data;\n\tbool result;\n\n\tif (!server || (length && !value))\n\t\treturn false;\n\n\tpdu_len = MIN(bt_att_get_mtu(server->att) - 1, length + 2);\n\tpdu = malloc(pdu_len);\n\tif (!pdu)\n\t\treturn false;\n\n\tdata = new0(struct ind_data, 1);\n\n\tdata->callback = callback;\n\tdata->destroy = destroy;\n\tdata->user_data = user_data;\n\n\tput_le16(handle, pdu);\n\tmemcpy(pdu + 2, value, pdu_len - 2);\n\n\tresult = !!bt_att_send(server->att, BT_ATT_OP_HANDLE_VAL_IND, pdu,\n\t\t\t\t\t\t\tpdu_len, conf_cb,\n\t\t\t\t\t\t\tdata, destroy_ind_data);\n\tif (!result)\n\t\tdestroy_ind_data(data);\n\n\tfree(pdu);\n\n\treturn result;\n}",
          "includes": [
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-helpers.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include \"src/shared/att.h\"",
            "#include <errno.h>",
            "#include <sys/uio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/gatt-helpers.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include \"src/shared/att.h\"\n#include <errno.h>\n#include <sys/uio.h>\n#include <config.h>\n\nbool bt_gatt_server_send_indication(struct bt_gatt_server *server,\n\t\t\t\t\tuint16_t handle, const uint8_t *value,\n\t\t\t\t\tuint16_t length,\n\t\t\t\t\tbt_gatt_server_conf_func_t callback,\n\t\t\t\t\tvoid *user_data,\n\t\t\t\t\tbt_gatt_server_destroy_func_t destroy)\n{\n\tuint16_t pdu_len;\n\tuint8_t *pdu;\n\tstruct ind_data *data;\n\tbool result;\n\n\tif (!server || (length && !value))\n\t\treturn false;\n\n\tpdu_len = MIN(bt_att_get_mtu(server->att) - 1, length + 2);\n\tpdu = malloc(pdu_len);\n\tif (!pdu)\n\t\treturn false;\n\n\tdata = new0(struct ind_data, 1);\n\n\tdata->callback = callback;\n\tdata->destroy = destroy;\n\tdata->user_data = user_data;\n\n\tput_le16(handle, pdu);\n\tmemcpy(pdu + 2, value, pdu_len - 2);\n\n\tresult = !!bt_att_send(server->att, BT_ATT_OP_HANDLE_VAL_IND, pdu,\n\t\t\t\t\t\t\tpdu_len, conf_cb,\n\t\t\t\t\t\t\tdata, destroy_ind_data);\n\tif (!result)\n\t\tdestroy_ind_data(data);\n\n\tfree(pdu);\n\n\treturn result;\n}"
        }
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"GATT server sending indication\""
          ],
          "line": 1165
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bt_gatt_server_send_notification",
          "args": [
            "server",
            "notify->handle",
            "notify->value",
            "notify->len"
          ],
          "line": 1159
        },
        "resolved": true,
        "details": {
          "function_name": "bt_gatt_server_send_notification",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-server.c",
          "lines": "1630-1654",
          "snippet": "bool bt_gatt_server_send_notification(struct bt_gatt_server *server,\n\t\t\t\t\tuint16_t handle, const uint8_t *value,\n\t\t\t\t\tuint16_t length)\n{\n\tuint16_t pdu_len;\n\tuint8_t *pdu;\n\tbool result;\n\n\tif (!server || (length && !value))\n\t\treturn false;\n\n\tpdu_len = MIN(bt_att_get_mtu(server->att) - 1, length + 2);\n\tpdu = malloc(pdu_len);\n\tif (!pdu)\n\t\treturn false;\n\n\tput_le16(handle, pdu);\n\tmemcpy(pdu + 2, value, pdu_len - 2);\n\n\tresult = !!bt_att_send(server->att, BT_ATT_OP_HANDLE_VAL_NOT, pdu,\n\t\t\t\t\t\tpdu_len, NULL, NULL, NULL);\n\tfree(pdu);\n\n\treturn result;\n}",
          "includes": [
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-helpers.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include \"src/shared/att.h\"",
            "#include <errno.h>",
            "#include <sys/uio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/gatt-helpers.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include \"src/shared/att.h\"\n#include <errno.h>\n#include <sys/uio.h>\n#include <config.h>\n\nbool bt_gatt_server_send_notification(struct bt_gatt_server *server,\n\t\t\t\t\tuint16_t handle, const uint8_t *value,\n\t\t\t\t\tuint16_t length)\n{\n\tuint16_t pdu_len;\n\tuint8_t *pdu;\n\tbool result;\n\n\tif (!server || (length && !value))\n\t\treturn false;\n\n\tpdu_len = MIN(bt_att_get_mtu(server->att) - 1, length + 2);\n\tpdu = malloc(pdu_len);\n\tif (!pdu)\n\t\treturn false;\n\n\tput_le16(handle, pdu);\n\tmemcpy(pdu + 2, value, pdu_len - 2);\n\n\tresult = !!bt_att_send(server->att, BT_ATT_OP_HANDLE_VAL_NOT, pdu,\n\t\t\t\t\t\tpdu_len, NULL, NULL, NULL);\n\tfree(pdu);\n\n\treturn result;\n}"
        }
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"GATT server sending notification\""
          ],
          "line": 1158
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "state_set_pending",
          "args": [
            "device_state",
            "notify"
          ],
          "line": 1149
        },
        "resolved": true,
        "details": {
          "function_name": "state_set_pending",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "1093-1122",
          "snippet": "static void state_set_pending(struct device_state *state, struct notify *notify)\n{\n\tuint16_t start, end, old_start, old_end;\n\n\t/* Cache this only for Service Changed */\n\tif (notify->conf != service_changed_conf)\n\t\treturn;\n\n\tif (state->pending) {\n\t\told_start = get_le16(state->pending->value);\n\t\told_end = get_le16(state->pending->value + 2);\n\n\t\tstart = get_le16(notify->value);\n\t\tend = get_le16(notify->value + 2);\n\n\t\tif (start < old_start)\n\t\t\tput_le16(start, state->pending->value);\n\n\t\tif (end > old_end)\n\t\t\tput_le16(end, state->pending->value + 2);\n\n\t\treturn;\n\t}\n\n\t/* Copy notify contents to pending */\n\tstate->pending = new0(struct notify, 1);\n\tmemcpy(state->pending, notify, sizeof(*notify));\n\tstate->pending->value = malloc(notify->len);\n\tmemcpy(state->pending->value, notify->value, notify->len);\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic void state_set_pending(struct device_state *state, struct notify *notify)\n{\n\tuint16_t start, end, old_start, old_end;\n\n\t/* Cache this only for Service Changed */\n\tif (notify->conf != service_changed_conf)\n\t\treturn;\n\n\tif (state->pending) {\n\t\told_start = get_le16(state->pending->value);\n\t\told_end = get_le16(state->pending->value + 2);\n\n\t\tstart = get_le16(notify->value);\n\t\tend = get_le16(notify->value + 2);\n\n\t\tif (start < old_start)\n\t\t\tput_le16(start, state->pending->value);\n\n\t\tif (end > old_end)\n\t\t\tput_le16(end, state->pending->value + 2);\n\n\t\treturn;\n\t}\n\n\t/* Copy notify contents to pending */\n\tstate->pending = new0(struct notify, 1);\n\tmemcpy(state->pending, notify, sizeof(*notify));\n\tstate->pending->value = malloc(notify->len);\n\tmemcpy(state->pending->value, notify->value, notify->len);\n}"
        }
      },
      {
        "call_info": {
          "callee": "device_is_bonded",
          "args": [
            "device",
            "device_state->bdaddr_type"
          ],
          "line": 1147
        },
        "resolved": true,
        "details": {
          "function_name": "device_is_bonded",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "703-708",
          "snippet": "bool device_is_bonded(struct btd_device *device, uint8_t bdaddr_type)\n{\n\tstruct bearer_state *state = get_state(device, bdaddr_type);\n\n\treturn state->bonded;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nbool device_is_bonded(struct btd_device *device, uint8_t bdaddr_type)\n{\n\tstruct bearer_state *state = get_state(device, bdaddr_type);\n\n\treturn state->bonded;\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_device_get_gatt_server",
          "args": [
            "device"
          ],
          "line": 1145
        },
        "resolved": true,
        "details": {
          "function_name": "btd_device_get_gatt_server",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "6236-6242",
          "snippet": "struct bt_gatt_server *btd_device_get_gatt_server(struct btd_device *device)\n{\n\tif (!device)\n\t\treturn NULL;\n\n\treturn device->server;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstruct bt_gatt_server *btd_device_get_gatt_server(struct btd_device *device)\n{\n\tif (!device)\n\t\treturn NULL;\n\n\treturn device->server;\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_adapter_get_device",
          "args": [
            "notify->database->adapter",
            "&device_state->bdaddr",
            "device_state->bdaddr_type"
          ],
          "line": 1139
        },
        "resolved": true,
        "details": {
          "function_name": "btd_adapter_get_device",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "1235-1249",
          "snippet": "struct btd_device *btd_adapter_get_device(struct btd_adapter *adapter,\n\t\t\t\t\tconst bdaddr_t *addr,\n\t\t\t\t\tuint8_t addr_type)\n{\n\tstruct btd_device *device;\n\n\tif (!adapter)\n\t\treturn NULL;\n\n\tdevice = btd_adapter_find_device(adapter, addr, addr_type);\n\tif (device)\n\t\treturn device;\n\n\treturn adapter_create_device(adapter, addr, addr_type);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void trigger_pairable_timeout(struct btd_adapter *adapter);",
            "static void adapter_start(struct btd_adapter *adapter);",
            "static void adapter_stop(struct btd_adapter *adapter);",
            "static void trigger_passive_scanning(struct btd_adapter *adapter);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void trigger_pairable_timeout(struct btd_adapter *adapter);\nstatic void adapter_start(struct btd_adapter *adapter);\nstatic void adapter_stop(struct btd_adapter *adapter);\nstatic void trigger_passive_scanning(struct btd_adapter *adapter);\n\nstruct btd_device *btd_adapter_get_device(struct btd_adapter *adapter,\n\t\t\t\t\tconst bdaddr_t *addr,\n\t\t\t\t\tuint8_t addr_type)\n{\n\tstruct btd_device *device;\n\n\tif (!adapter)\n\t\treturn NULL;\n\n\tdevice = btd_adapter_find_device(adapter, addr, addr_type);\n\tif (device)\n\t\treturn device;\n\n\treturn adapter_create_device(adapter, addr, addr_type);\n}"
        }
      },
      {
        "call_info": {
          "callee": "find_ccc_state",
          "args": [
            "device_state",
            "notify->ccc_handle"
          ],
          "line": 1132
        },
        "resolved": true,
        "details": {
          "function_name": "find_ccc_state",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "266-271",
          "snippet": "static struct ccc_state *find_ccc_state(struct device_state *dev_state,\n\t\t\t\t\t\t\t\tuint16_t handle)\n{\n\treturn queue_find(dev_state->ccc_states, ccc_state_match,\n\t\t\t\t\t\t\tUINT_TO_PTR(handle));\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic struct ccc_state *find_ccc_state(struct device_state *dev_state,\n\t\t\t\t\t\t\t\tuint16_t handle)\n{\n\treturn queue_find(dev_state->ccc_states, ccc_state_match,\n\t\t\t\t\t\t\tUINT_TO_PTR(handle));\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic void send_notification_to_device(void *data, void *user_data)\n{\n\tstruct device_state *device_state = data;\n\tstruct notify *notify = user_data;\n\tstruct ccc_state *ccc;\n\tstruct btd_device *device;\n\tstruct bt_gatt_server *server;\n\n\tccc = find_ccc_state(device_state, notify->ccc_handle);\n\tif (!ccc)\n\t\treturn;\n\n\tif (!ccc->value[0] || (notify->conf && !(ccc->value[0] & 0x02)))\n\t\treturn;\n\n\tdevice = btd_adapter_get_device(notify->database->adapter,\n\t\t\t\t\t\t&device_state->bdaddr,\n\t\t\t\t\t\tdevice_state->bdaddr_type);\n\tif (!device)\n\t\tgoto remove;\n\n\tserver = btd_device_get_gatt_server(device);\n\tif (!server) {\n\t\tif (!device_is_bonded(device, device_state->bdaddr_type))\n\t\t\tgoto remove;\n\t\tstate_set_pending(device_state, notify);\n\t\treturn;\n\t}\n\n\t/*\n\t * TODO: If the device is not connected but bonded, send the\n\t * notification/indication when it becomes connected.\n\t */\n\tif (!notify->conf) {\n\t\tDBG(\"GATT server sending notification\");\n\t\tbt_gatt_server_send_notification(server,\n\t\t\t\t\tnotify->handle, notify->value,\n\t\t\t\t\tnotify->len);\n\t\treturn;\n\t}\n\n\tDBG(\"GATT server sending indication\");\n\tbt_gatt_server_send_indication(server, notify->handle, notify->value,\n\t\t\t\t\t\tnotify->len, notify->conf,\n\t\t\t\t\t\tnotify->user_data, NULL);\n\n\treturn;\n\nremove:\n\t/* Remove device state if device no longer exists or is not paired */\n\tif (queue_remove(notify->database->device_states, device_state)) {\n\t\tqueue_foreach(device_state->ccc_states, clear_ccc_state,\n\t\t\t\t\t\tnotify->database);\n\t\tdevice_state_free(device_state);\n\t}\n}"
  },
  {
    "function_name": "state_set_pending",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
    "lines": "1093-1122",
    "snippet": "static void state_set_pending(struct device_state *state, struct notify *notify)\n{\n\tuint16_t start, end, old_start, old_end;\n\n\t/* Cache this only for Service Changed */\n\tif (notify->conf != service_changed_conf)\n\t\treturn;\n\n\tif (state->pending) {\n\t\told_start = get_le16(state->pending->value);\n\t\told_end = get_le16(state->pending->value + 2);\n\n\t\tstart = get_le16(notify->value);\n\t\tend = get_le16(notify->value + 2);\n\n\t\tif (start < old_start)\n\t\t\tput_le16(start, state->pending->value);\n\n\t\tif (end > old_end)\n\t\t\tput_le16(end, state->pending->value + 2);\n\n\t\treturn;\n\t}\n\n\t/* Copy notify contents to pending */\n\tstate->pending = new0(struct notify, 1);\n\tmemcpy(state->pending, notify, sizeof(*notify));\n\tstate->pending->value = malloc(notify->len);\n\tmemcpy(state->pending->value, notify->value, notify->len);\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"dbus-common.h\"",
      "#include \"gatt-database.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "memcpy",
          "args": [
            "state->pending->value",
            "notify->value",
            "notify->len"
          ],
          "line": 1121
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "malloc",
          "args": [
            "notify->len"
          ],
          "line": 1120
        },
        "resolved": true,
        "details": {
          "function_name": "btd_malloc",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/util.c",
          "lines": "41-55",
          "snippet": "void *btd_malloc(size_t size)\n{\n\tif (__builtin_expect(!!size, 1)) {\n\t\tvoid *ptr;\n\n\t\tptr = malloc(size);\n\t\tif (ptr)\n\t\t\treturn ptr;\n\n\t\tfprintf(stderr, \"failed to allocate %zu bytes\\n\", size);\n\t\tabort();\n\t}\n\n\treturn NULL;\n}",
          "includes": [
            "#include \"src/shared/util.h\"",
            "#include <string.h>",
            "#include <limits.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <stdbool.h>",
            "#include <stdarg.h>",
            "#include <ctype.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/util.h\"\n#include <string.h>\n#include <limits.h>\n#include <dirent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <config.h>\n\nvoid *btd_malloc(size_t size)\n{\n\tif (__builtin_expect(!!size, 1)) {\n\t\tvoid *ptr;\n\n\t\tptr = malloc(size);\n\t\tif (ptr)\n\t\t\treturn ptr;\n\n\t\tfprintf(stderr, \"failed to allocate %zu bytes\\n\", size);\n\t\tabort();\n\t}\n\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "memcpy",
          "args": [
            "state->pending",
            "notify",
            "sizeof(*notify)"
          ],
          "line": 1119
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "new0",
          "args": [
            "structnotify",
            "1"
          ],
          "line": 1118
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "put_le16",
          "args": [
            "end",
            "state->pending->value + 2"
          ],
          "line": 1112
        },
        "resolved": true,
        "details": {
          "function_name": "put_le16",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/util.h",
          "lines": "159-162",
          "snippet": "static inline void put_le16(uint16_t val, void *dst)\n{\n\tput_unaligned(cpu_to_le16(val), (uint16_t *) dst);\n}",
          "includes": [
            "#include <string.h>",
            "#include <byteswap.h>",
            "#include <alloca.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <byteswap.h>\n#include <alloca.h>\n#include <stdlib.h>\n#include <stdint.h>\n\nstatic inline void put_le16(uint16_t val, void *dst)\n{\n\tput_unaligned(cpu_to_le16(val), (uint16_t *) dst);\n}"
        }
      },
      {
        "call_info": {
          "callee": "get_le16",
          "args": [
            "notify->value + 2"
          ],
          "line": 1106
        },
        "resolved": true,
        "details": {
          "function_name": "get_le16",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/util.h",
          "lines": "129-132",
          "snippet": "static inline uint16_t get_le16(const void *ptr)\n{\n\treturn le16_to_cpu(get_unaligned((const uint16_t *) ptr));\n}",
          "includes": [
            "#include <string.h>",
            "#include <byteswap.h>",
            "#include <alloca.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <byteswap.h>\n#include <alloca.h>\n#include <stdlib.h>\n#include <stdint.h>\n\nstatic inline uint16_t get_le16(const void *ptr)\n{\n\treturn le16_to_cpu(get_unaligned((const uint16_t *) ptr));\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic void state_set_pending(struct device_state *state, struct notify *notify)\n{\n\tuint16_t start, end, old_start, old_end;\n\n\t/* Cache this only for Service Changed */\n\tif (notify->conf != service_changed_conf)\n\t\treturn;\n\n\tif (state->pending) {\n\t\told_start = get_le16(state->pending->value);\n\t\told_end = get_le16(state->pending->value + 2);\n\n\t\tstart = get_le16(notify->value);\n\t\tend = get_le16(notify->value + 2);\n\n\t\tif (start < old_start)\n\t\t\tput_le16(start, state->pending->value);\n\n\t\tif (end > old_end)\n\t\t\tput_le16(end, state->pending->value + 2);\n\n\t\treturn;\n\t}\n\n\t/* Copy notify contents to pending */\n\tstate->pending = new0(struct notify, 1);\n\tmemcpy(state->pending, notify, sizeof(*notify));\n\tstate->pending->value = malloc(notify->len);\n\tmemcpy(state->pending->value, notify->value, notify->len);\n}"
  },
  {
    "function_name": "service_changed_conf",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
    "lines": "1088-1091",
    "snippet": "static void service_changed_conf(void *user_data)\n{\n\tDBG(\"\");\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"dbus-common.h\"",
      "#include \"gatt-database.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"\""
          ],
          "line": 1090
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic void service_changed_conf(void *user_data)\n{\n\tDBG(\"\");\n}"
  },
  {
    "function_name": "conf_cb",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
    "lines": "1077-1086",
    "snippet": "static void conf_cb(void *user_data)\n{\n\tGDBusProxy *proxy = user_data;\n\tDBG(\"GATT server received confirmation\");\n\n\tif (proxy != NULL)\n\t{\n\t\tg_dbus_proxy_method_call(proxy, \"Confirm\", NULL, NULL, NULL, NULL);\n\t}\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"dbus-common.h\"",
      "#include \"gatt-database.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_dbus_proxy_method_call",
          "args": [
            "proxy",
            "\"Confirm\"",
            "NULL",
            "NULL",
            "NULL",
            "NULL"
          ],
          "line": 1084
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"GATT server received confirmation\""
          ],
          "line": 1080
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic void conf_cb(void *user_data)\n{\n\tGDBusProxy *proxy = user_data;\n\tDBG(\"GATT server received confirmation\");\n\n\tif (proxy != NULL)\n\t{\n\t\tg_dbus_proxy_method_call(proxy, \"Confirm\", NULL, NULL, NULL, NULL);\n\t}\n}"
  },
  {
    "function_name": "register_core_services",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
    "lines": "1071-1075",
    "snippet": "static void register_core_services(struct btd_gatt_database *database)\n{\n\tpopulate_gap_service(database);\n\tpopulate_gatt_service(database);\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"dbus-common.h\"",
      "#include \"gatt-database.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "populate_gatt_service",
          "args": [
            "database"
          ],
          "line": 1074
        },
        "resolved": true,
        "details": {
          "function_name": "populate_gatt_service",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "1051-1069",
          "snippet": "static void populate_gatt_service(struct btd_gatt_database *database)\n{\n\tbt_uuid_t uuid;\n\tstruct gatt_db_attribute *service;\n\n\t/* Add the GATT service */\n\tbt_uuid16_create(&uuid, UUID_GATT);\n\tservice = gatt_db_add_service(database->db, &uuid, true, 4);\n\n\tbt_uuid16_create(&uuid, GATT_CHARAC_SERVICE_CHANGED);\n\tdatabase->svc_chngd = gatt_db_service_add_characteristic(service, &uuid,\n\t\t\t\tBT_ATT_PERM_READ, BT_GATT_CHRC_PROP_INDICATE,\n\t\t\t\tNULL, NULL, database);\n\n\tdatabase->svc_chngd_ccc = service_add_ccc(service, database, NULL, NULL,\n\t\t\t\t\t\t\t\t\tNULL);\n\n\tgatt_db_service_set_active(service, true);\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define UUID_GATT\t0x1801"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\n#define UUID_GATT\t0x1801\n\nstatic void populate_gatt_service(struct btd_gatt_database *database)\n{\n\tbt_uuid_t uuid;\n\tstruct gatt_db_attribute *service;\n\n\t/* Add the GATT service */\n\tbt_uuid16_create(&uuid, UUID_GATT);\n\tservice = gatt_db_add_service(database->db, &uuid, true, 4);\n\n\tbt_uuid16_create(&uuid, GATT_CHARAC_SERVICE_CHANGED);\n\tdatabase->svc_chngd = gatt_db_service_add_characteristic(service, &uuid,\n\t\t\t\tBT_ATT_PERM_READ, BT_GATT_CHRC_PROP_INDICATE,\n\t\t\t\tNULL, NULL, database);\n\n\tdatabase->svc_chngd_ccc = service_add_ccc(service, database, NULL, NULL,\n\t\t\t\t\t\t\t\t\tNULL);\n\n\tgatt_db_service_set_active(service, true);\n}"
        }
      },
      {
        "call_info": {
          "callee": "populate_gap_service",
          "args": [
            "database"
          ],
          "line": 1073
        },
        "resolved": true,
        "details": {
          "function_name": "populate_gap_service",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "817-845",
          "snippet": "static void populate_gap_service(struct btd_gatt_database *database)\n{\n\tbt_uuid_t uuid;\n\tstruct gatt_db_attribute *service;\n\n\t/* Add the GAP service */\n\tbt_uuid16_create(&uuid, UUID_GAP);\n\tservice = gatt_db_add_service(database->db, &uuid, true, 5);\n\n\t/*\n\t * Device Name characteristic.\n\t */\n\tbt_uuid16_create(&uuid, GATT_CHARAC_DEVICE_NAME);\n\tgatt_db_service_add_characteristic(service, &uuid, BT_ATT_PERM_READ,\n\t\t\t\t\t\t\tBT_GATT_CHRC_PROP_READ,\n\t\t\t\t\t\t\tgap_device_name_read_cb,\n\t\t\t\t\t\t\tNULL, database);\n\n\t/*\n\t * Device Appearance characteristic.\n\t */\n\tbt_uuid16_create(&uuid, GATT_CHARAC_APPEARANCE);\n\tgatt_db_service_add_characteristic(service, &uuid, BT_ATT_PERM_READ,\n\t\t\t\t\t\t\tBT_GATT_CHRC_PROP_READ,\n\t\t\t\t\t\t\tgap_appearance_read_cb,\n\t\t\t\t\t\t\tNULL, database);\n\n\tgatt_db_service_set_active(service, true);\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define UUID_GAP\t0x1800"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\n#define UUID_GAP\t0x1800\n\nstatic void populate_gap_service(struct btd_gatt_database *database)\n{\n\tbt_uuid_t uuid;\n\tstruct gatt_db_attribute *service;\n\n\t/* Add the GAP service */\n\tbt_uuid16_create(&uuid, UUID_GAP);\n\tservice = gatt_db_add_service(database->db, &uuid, true, 5);\n\n\t/*\n\t * Device Name characteristic.\n\t */\n\tbt_uuid16_create(&uuid, GATT_CHARAC_DEVICE_NAME);\n\tgatt_db_service_add_characteristic(service, &uuid, BT_ATT_PERM_READ,\n\t\t\t\t\t\t\tBT_GATT_CHRC_PROP_READ,\n\t\t\t\t\t\t\tgap_device_name_read_cb,\n\t\t\t\t\t\t\tNULL, database);\n\n\t/*\n\t * Device Appearance characteristic.\n\t */\n\tbt_uuid16_create(&uuid, GATT_CHARAC_APPEARANCE);\n\tgatt_db_service_add_characteristic(service, &uuid, BT_ATT_PERM_READ,\n\t\t\t\t\t\t\tBT_GATT_CHRC_PROP_READ,\n\t\t\t\t\t\t\tgap_appearance_read_cb,\n\t\t\t\t\t\t\tNULL, database);\n\n\tgatt_db_service_set_active(service, true);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic void register_core_services(struct btd_gatt_database *database)\n{\n\tpopulate_gap_service(database);\n\tpopulate_gatt_service(database);\n}"
  },
  {
    "function_name": "populate_gatt_service",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
    "lines": "1051-1069",
    "snippet": "static void populate_gatt_service(struct btd_gatt_database *database)\n{\n\tbt_uuid_t uuid;\n\tstruct gatt_db_attribute *service;\n\n\t/* Add the GATT service */\n\tbt_uuid16_create(&uuid, UUID_GATT);\n\tservice = gatt_db_add_service(database->db, &uuid, true, 4);\n\n\tbt_uuid16_create(&uuid, GATT_CHARAC_SERVICE_CHANGED);\n\tdatabase->svc_chngd = gatt_db_service_add_characteristic(service, &uuid,\n\t\t\t\tBT_ATT_PERM_READ, BT_GATT_CHRC_PROP_INDICATE,\n\t\t\t\tNULL, NULL, database);\n\n\tdatabase->svc_chngd_ccc = service_add_ccc(service, database, NULL, NULL,\n\t\t\t\t\t\t\t\t\tNULL);\n\n\tgatt_db_service_set_active(service, true);\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"dbus-common.h\"",
      "#include \"gatt-database.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define UUID_GATT\t0x1801"
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "gatt_db_service_set_active",
          "args": [
            "service",
            "true"
          ],
          "line": 1068
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_service_set_active",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "975-992",
          "snippet": "bool gatt_db_service_set_active(struct gatt_db_attribute *attrib, bool active)\n{\n\tstruct gatt_db_service *service;\n\n\tif (!attrib)\n\t\treturn false;\n\n\tservice = attrib->service;\n\n\tif (service->active == active)\n\t\treturn true;\n\n\tservice->active = active;\n\n\tnotify_service_changed(service->db, service, active);\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nbool gatt_db_service_set_active(struct gatt_db_attribute *attrib, bool active)\n{\n\tstruct gatt_db_service *service;\n\n\tif (!attrib)\n\t\treturn false;\n\n\tservice = attrib->service;\n\n\tif (service->active == active)\n\t\treturn true;\n\n\tservice->active = active;\n\n\tnotify_service_changed(service->db, service, active);\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "service_add_ccc",
          "args": [
            "service",
            "database",
            "NULL",
            "NULL",
            "NULL"
          ],
          "line": 1065
        },
        "resolved": true,
        "details": {
          "function_name": "service_add_ccc",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "1018-1049",
          "snippet": "static struct gatt_db_attribute *\nservice_add_ccc(struct gatt_db_attribute *service,\n\t\t\t\tstruct btd_gatt_database *database,\n\t\t\t\tbtd_gatt_database_ccc_write_t write_callback,\n\t\t\t\tvoid *user_data,\n\t\t\t\tbtd_gatt_database_destroy_t destroy)\n{\n\tstruct gatt_db_attribute *ccc;\n\tstruct ccc_cb_data *ccc_cb;\n\tbt_uuid_t uuid;\n\n\tccc_cb = new0(struct ccc_cb_data, 1);\n\n\tbt_uuid16_create(&uuid, GATT_CLIENT_CHARAC_CFG_UUID);\n\tccc = gatt_db_service_add_descriptor(service, &uuid,\n\t\t\t\tBT_ATT_PERM_READ | BT_ATT_PERM_WRITE,\n\t\t\t\tgatt_ccc_read_cb, gatt_ccc_write_cb, database);\n\tif (!ccc) {\n\t\terror(\"Failed to create CCC entry in database\");\n\t\tfree(ccc_cb);\n\t\treturn NULL;\n\t}\n\n\tccc_cb->handle = gatt_db_attribute_get_handle(ccc);\n\tccc_cb->callback = write_callback;\n\tccc_cb->destroy = destroy;\n\tccc_cb->user_data = user_data;\n\n\tqueue_push_tail(database->ccc_callbacks, ccc_cb);\n\n\treturn ccc;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic struct gatt_db_attribute *\nservice_add_ccc(struct gatt_db_attribute *service,\n\t\t\t\tstruct btd_gatt_database *database,\n\t\t\t\tbtd_gatt_database_ccc_write_t write_callback,\n\t\t\t\tvoid *user_data,\n\t\t\t\tbtd_gatt_database_destroy_t destroy)\n{\n\tstruct gatt_db_attribute *ccc;\n\tstruct ccc_cb_data *ccc_cb;\n\tbt_uuid_t uuid;\n\n\tccc_cb = new0(struct ccc_cb_data, 1);\n\n\tbt_uuid16_create(&uuid, GATT_CLIENT_CHARAC_CFG_UUID);\n\tccc = gatt_db_service_add_descriptor(service, &uuid,\n\t\t\t\tBT_ATT_PERM_READ | BT_ATT_PERM_WRITE,\n\t\t\t\tgatt_ccc_read_cb, gatt_ccc_write_cb, database);\n\tif (!ccc) {\n\t\terror(\"Failed to create CCC entry in database\");\n\t\tfree(ccc_cb);\n\t\treturn NULL;\n\t}\n\n\tccc_cb->handle = gatt_db_attribute_get_handle(ccc);\n\tccc_cb->callback = write_callback;\n\tccc_cb->destroy = destroy;\n\tccc_cb->user_data = user_data;\n\n\tqueue_push_tail(database->ccc_callbacks, ccc_cb);\n\n\treturn ccc;\n}"
        }
      },
      {
        "call_info": {
          "callee": "gatt_db_service_add_characteristic",
          "args": [
            "service",
            "&uuid",
            "BT_ATT_PERM_READ",
            "BT_GATT_CHRC_PROP_INDICATE",
            "NULL",
            "NULL",
            "database"
          ],
          "line": 1061
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_service_add_characteristic",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "780-796",
          "snippet": "struct gatt_db_attribute *\ngatt_db_service_add_characteristic(struct gatt_db_attribute *attrib,\n\t\t\t\t\tconst bt_uuid_t *uuid,\n\t\t\t\t\tuint32_t permissions,\n\t\t\t\t\tuint8_t properties,\n\t\t\t\t\tgatt_db_read_t read_func,\n\t\t\t\t\tgatt_db_write_t write_func,\n\t\t\t\t\tvoid *user_data)\n{\n\tif (!attrib)\n\t\treturn NULL;\n\n\treturn service_insert_characteristic(attrib->service, 0, uuid,\n\t\t\t\t\t\tpermissions, properties,\n\t\t\t\t\t\tread_func, write_func,\n\t\t\t\t\t\tuser_data);\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstruct gatt_db_attribute *\ngatt_db_service_add_characteristic(struct gatt_db_attribute *attrib,\n\t\t\t\t\tconst bt_uuid_t *uuid,\n\t\t\t\t\tuint32_t permissions,\n\t\t\t\t\tuint8_t properties,\n\t\t\t\t\tgatt_db_read_t read_func,\n\t\t\t\t\tgatt_db_write_t write_func,\n\t\t\t\t\tvoid *user_data)\n{\n\tif (!attrib)\n\t\treturn NULL;\n\n\treturn service_insert_characteristic(attrib->service, 0, uuid,\n\t\t\t\t\t\tpermissions, properties,\n\t\t\t\t\t\tread_func, write_func,\n\t\t\t\t\t\tuser_data);\n}"
        }
      },
      {
        "call_info": {
          "callee": "bt_uuid16_create",
          "args": [
            "&uuid",
            "GATT_CHARAC_SERVICE_CHANGED"
          ],
          "line": 1060
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "gatt_db_add_service",
          "args": [
            "database->db",
            "&uuid",
            "true",
            "4"
          ],
          "line": 1058
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_add_service",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "583-590",
          "snippet": "struct gatt_db_attribute *gatt_db_add_service(struct gatt_db *db,\n\t\t\t\t\t\tconst bt_uuid_t *uuid,\n\t\t\t\t\t\tbool primary,\n\t\t\t\t\t\tuint16_t num_handles)\n{\n\treturn gatt_db_insert_service(db, db->next_handle, uuid, primary,\n\t\t\t\t\t\t\t\tnum_handles);\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstruct gatt_db_attribute *gatt_db_add_service(struct gatt_db *db,\n\t\t\t\t\t\tconst bt_uuid_t *uuid,\n\t\t\t\t\t\tbool primary,\n\t\t\t\t\t\tuint16_t num_handles)\n{\n\treturn gatt_db_insert_service(db, db->next_handle, uuid, primary,\n\t\t\t\t\t\t\t\tnum_handles);\n}"
        }
      },
      {
        "call_info": {
          "callee": "bt_uuid16_create",
          "args": [
            "&uuid",
            "UUID_GATT"
          ],
          "line": 1057
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\n#define UUID_GATT\t0x1801\n\nstatic void populate_gatt_service(struct btd_gatt_database *database)\n{\n\tbt_uuid_t uuid;\n\tstruct gatt_db_attribute *service;\n\n\t/* Add the GATT service */\n\tbt_uuid16_create(&uuid, UUID_GATT);\n\tservice = gatt_db_add_service(database->db, &uuid, true, 4);\n\n\tbt_uuid16_create(&uuid, GATT_CHARAC_SERVICE_CHANGED);\n\tdatabase->svc_chngd = gatt_db_service_add_characteristic(service, &uuid,\n\t\t\t\tBT_ATT_PERM_READ, BT_GATT_CHRC_PROP_INDICATE,\n\t\t\t\tNULL, NULL, database);\n\n\tdatabase->svc_chngd_ccc = service_add_ccc(service, database, NULL, NULL,\n\t\t\t\t\t\t\t\t\tNULL);\n\n\tgatt_db_service_set_active(service, true);\n}"
  },
  {
    "function_name": "service_add_ccc",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
    "lines": "1018-1049",
    "snippet": "static struct gatt_db_attribute *\nservice_add_ccc(struct gatt_db_attribute *service,\n\t\t\t\tstruct btd_gatt_database *database,\n\t\t\t\tbtd_gatt_database_ccc_write_t write_callback,\n\t\t\t\tvoid *user_data,\n\t\t\t\tbtd_gatt_database_destroy_t destroy)\n{\n\tstruct gatt_db_attribute *ccc;\n\tstruct ccc_cb_data *ccc_cb;\n\tbt_uuid_t uuid;\n\n\tccc_cb = new0(struct ccc_cb_data, 1);\n\n\tbt_uuid16_create(&uuid, GATT_CLIENT_CHARAC_CFG_UUID);\n\tccc = gatt_db_service_add_descriptor(service, &uuid,\n\t\t\t\tBT_ATT_PERM_READ | BT_ATT_PERM_WRITE,\n\t\t\t\tgatt_ccc_read_cb, gatt_ccc_write_cb, database);\n\tif (!ccc) {\n\t\terror(\"Failed to create CCC entry in database\");\n\t\tfree(ccc_cb);\n\t\treturn NULL;\n\t}\n\n\tccc_cb->handle = gatt_db_attribute_get_handle(ccc);\n\tccc_cb->callback = write_callback;\n\tccc_cb->destroy = destroy;\n\tccc_cb->user_data = user_data;\n\n\tqueue_push_tail(database->ccc_callbacks, ccc_cb);\n\n\treturn ccc;\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"dbus-common.h\"",
      "#include \"gatt-database.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "queue_push_tail",
          "args": [
            "database->ccc_callbacks",
            "ccc_cb"
          ],
          "line": 1046
        },
        "resolved": true,
        "details": {
          "function_name": "queue_push_tail",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "88-108",
          "snippet": "bool queue_push_tail(struct queue *queue, void *data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn false;\n\n\tentry = queue_entry_new(data);\n\n\tif (queue->tail)\n\t\tqueue->tail->next = entry;\n\n\tqueue->tail = entry;\n\n\tif (!queue->head)\n\t\tqueue->head = entry;\n\n\tqueue->entries++;\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nbool queue_push_tail(struct queue *queue, void *data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn false;\n\n\tentry = queue_entry_new(data);\n\n\tif (queue->tail)\n\t\tqueue->tail->next = entry;\n\n\tqueue->tail = entry;\n\n\tif (!queue->head)\n\t\tqueue->head = entry;\n\n\tqueue->entries++;\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "gatt_db_attribute_get_handle",
          "args": [
            "ccc"
          ],
          "line": 1041
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_attribute_get_handle",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "1482-1488",
          "snippet": "uint16_t gatt_db_attribute_get_handle(const struct gatt_db_attribute *attrib)\n{\n\tif (!attrib)\n\t\treturn 0;\n\n\treturn attrib->handle;\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nuint16_t gatt_db_attribute_get_handle(const struct gatt_db_attribute *attrib)\n{\n\tif (!attrib)\n\t\treturn 0;\n\n\treturn attrib->handle;\n}"
        }
      },
      {
        "call_info": {
          "callee": "free",
          "args": [
            "ccc_cb"
          ],
          "line": 1037
        },
        "resolved": true,
        "details": {
          "function_name": "app_free_idle_cb",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "1303-1308",
          "snippet": "static gboolean app_free_idle_cb(void *data)\n{\n\tapp_free(data);\n\n\treturn FALSE;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic gboolean app_free_idle_cb(void *data)\n{\n\tapp_free(data);\n\n\treturn FALSE;\n}"
        }
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"Failed to create CCC entry in database\""
          ],
          "line": 1036
        },
        "resolved": true,
        "details": {
          "function_name": "dbus_error_to_att_ecode",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "1833-1855",
          "snippet": "static uint8_t dbus_error_to_att_ecode(const char *error_name)\n{\n\n\tif (strcmp(error_name, \"org.bluez.Error.Failed\") == 0)\n\t\treturn 0x80;  /* For now return this \"application error\" */\n\n\tif (strcmp(error_name, \"org.bluez.Error.NotSupported\") == 0)\n\t\treturn BT_ATT_ERROR_REQUEST_NOT_SUPPORTED;\n\n\tif (strcmp(error_name, \"org.bluez.Error.NotAuthorized\") == 0)\n\t\treturn BT_ATT_ERROR_AUTHORIZATION;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InvalidValueLength\") == 0)\n\t\treturn BT_ATT_ERROR_INVALID_ATTRIBUTE_VALUE_LEN;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InvalidOffset\") == 0)\n\t\treturn BT_ATT_ERROR_INVALID_OFFSET;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InProgress\") == 0)\n\t\treturn BT_ERROR_ALREADY_IN_PROGRESS;\n\n\treturn 0;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic uint8_t dbus_error_to_att_ecode(const char *error_name)\n{\n\n\tif (strcmp(error_name, \"org.bluez.Error.Failed\") == 0)\n\t\treturn 0x80;  /* For now return this \"application error\" */\n\n\tif (strcmp(error_name, \"org.bluez.Error.NotSupported\") == 0)\n\t\treturn BT_ATT_ERROR_REQUEST_NOT_SUPPORTED;\n\n\tif (strcmp(error_name, \"org.bluez.Error.NotAuthorized\") == 0)\n\t\treturn BT_ATT_ERROR_AUTHORIZATION;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InvalidValueLength\") == 0)\n\t\treturn BT_ATT_ERROR_INVALID_ATTRIBUTE_VALUE_LEN;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InvalidOffset\") == 0)\n\t\treturn BT_ATT_ERROR_INVALID_OFFSET;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InProgress\") == 0)\n\t\treturn BT_ERROR_ALREADY_IN_PROGRESS;\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "gatt_db_service_add_descriptor",
          "args": [
            "service",
            "&uuid",
            "BT_ATT_PERM_READ | BT_ATT_PERM_WRITE",
            "gatt_ccc_read_cb",
            "gatt_ccc_write_cb",
            "database"
          ],
          "line": 1032
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_service_add_descriptor",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "867-881",
          "snippet": "struct gatt_db_attribute *\ngatt_db_service_add_descriptor(struct gatt_db_attribute *attrib,\n\t\t\t\t\tconst bt_uuid_t *uuid,\n\t\t\t\t\tuint32_t permissions,\n\t\t\t\t\tgatt_db_read_t read_func,\n\t\t\t\t\tgatt_db_write_t write_func,\n\t\t\t\t\tvoid *user_data)\n{\n\tif (!attrib)\n\t\treturn NULL;\n\n\treturn service_insert_descriptor(attrib->service, 0, uuid,\n\t\t\t\t\tpermissions, read_func, write_func,\n\t\t\t\t\tuser_data);\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstruct gatt_db_attribute *\ngatt_db_service_add_descriptor(struct gatt_db_attribute *attrib,\n\t\t\t\t\tconst bt_uuid_t *uuid,\n\t\t\t\t\tuint32_t permissions,\n\t\t\t\t\tgatt_db_read_t read_func,\n\t\t\t\t\tgatt_db_write_t write_func,\n\t\t\t\t\tvoid *user_data)\n{\n\tif (!attrib)\n\t\treturn NULL;\n\n\treturn service_insert_descriptor(attrib->service, 0, uuid,\n\t\t\t\t\tpermissions, read_func, write_func,\n\t\t\t\t\tuser_data);\n}"
        }
      },
      {
        "call_info": {
          "callee": "bt_uuid16_create",
          "args": [
            "&uuid",
            "GATT_CLIENT_CHARAC_CFG_UUID"
          ],
          "line": 1031
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "new0",
          "args": [
            "structccc_cb_data",
            "1"
          ],
          "line": 1029
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic struct gatt_db_attribute *\nservice_add_ccc(struct gatt_db_attribute *service,\n\t\t\t\tstruct btd_gatt_database *database,\n\t\t\t\tbtd_gatt_database_ccc_write_t write_callback,\n\t\t\t\tvoid *user_data,\n\t\t\t\tbtd_gatt_database_destroy_t destroy)\n{\n\tstruct gatt_db_attribute *ccc;\n\tstruct ccc_cb_data *ccc_cb;\n\tbt_uuid_t uuid;\n\n\tccc_cb = new0(struct ccc_cb_data, 1);\n\n\tbt_uuid16_create(&uuid, GATT_CLIENT_CHARAC_CFG_UUID);\n\tccc = gatt_db_service_add_descriptor(service, &uuid,\n\t\t\t\tBT_ATT_PERM_READ | BT_ATT_PERM_WRITE,\n\t\t\t\tgatt_ccc_read_cb, gatt_ccc_write_cb, database);\n\tif (!ccc) {\n\t\terror(\"Failed to create CCC entry in database\");\n\t\tfree(ccc_cb);\n\t\treturn NULL;\n\t}\n\n\tccc_cb->handle = gatt_db_attribute_get_handle(ccc);\n\tccc_cb->callback = write_callback;\n\tccc_cb->destroy = destroy;\n\tccc_cb->user_data = user_data;\n\n\tqueue_push_tail(database->ccc_callbacks, ccc_cb);\n\n\treturn ccc;\n}"
  },
  {
    "function_name": "gatt_ccc_write_cb",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
    "lines": "951-1016",
    "snippet": "static void gatt_ccc_write_cb(struct gatt_db_attribute *attrib,\n\t\t\t\t\tunsigned int id, uint16_t offset,\n\t\t\t\t\tconst uint8_t *value, size_t len,\n\t\t\t\t\tuint8_t opcode, struct bt_att *att,\n\t\t\t\t\tvoid *user_data)\n{\n\tstruct btd_gatt_database *database = user_data;\n\tstruct ccc_state *ccc;\n\tstruct ccc_cb_data *ccc_cb;\n\tuint16_t handle;\n\tuint8_t ecode = 0;\n\n\thandle = gatt_db_attribute_get_handle(attrib);\n\n\tDBG(\"CCC write called for handle: 0x%04x\", handle);\n\n\tif (!value || len != 2) {\n\t\tecode = BT_ATT_ERROR_INVALID_ATTRIBUTE_VALUE_LEN;\n\t\tgoto done;\n\t}\n\n\tif (offset > 2) {\n\t\tecode = BT_ATT_ERROR_INVALID_OFFSET;\n\t\tgoto done;\n\t}\n\n\tccc = get_ccc_state(database, att, handle);\n\tif (!ccc) {\n\t\tecode = BT_ATT_ERROR_UNLIKELY;\n\t\tgoto done;\n\t}\n\n\tccc_cb = queue_find(database->ccc_callbacks, ccc_cb_match_handle,\n\t\t\tUINT_TO_PTR(gatt_db_attribute_get_handle(attrib)));\n\tif (!ccc_cb) {\n\t\tecode = BT_ATT_ERROR_UNLIKELY;\n\t\tgoto done;\n\t}\n\n\t/* If value is identical, then just succeed */\n\tif (ccc->value[0] == value[0] && ccc->value[1] == value[1])\n\t\tgoto done;\n\n\tif (ccc_cb->callback) {\n\t\tstruct pending_op *op;\n\n\t\top = pending_ccc_new(att, attrib, get_le16(value),\n\t\t\t\t\tbt_att_get_link_type(att));\n\t\tif (!op) {\n\t\t\tecode = BT_ATT_ERROR_UNLIKELY;\n\t\t\tgoto done;\n\t\t}\n\n\t\tecode = ccc_cb->callback(op, ccc_cb->user_data);\n\t\tif (ecode)\n\t\t\tpending_op_free(op);\n\t}\n\n\tif (!ecode) {\n\t\tccc->value[0] = value[0];\n\t\tccc->value[1] = value[1];\n\t}\n\ndone:\n\tgatt_db_attribute_write_result(attrib, id, ecode);\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"dbus-common.h\"",
      "#include \"gatt-database.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "gatt_db_attribute_write_result",
          "args": [
            "attrib",
            "id",
            "ecode"
          ],
          "line": 1015
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_attribute_write_result",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "1862-1878",
          "snippet": "bool gatt_db_attribute_write_result(struct gatt_db_attribute *attrib,\n\t\t\t\t\t\tunsigned int id, int err)\n{\n\tstruct pending_write *p;\n\n\tif (!attrib || !id)\n\t\treturn false;\n\n\tp = queue_remove_if(attrib->pending_writes, find_pending,\n\t\t\t\t\t\t\tUINT_TO_PTR(id));\n\tif (!p)\n\t\treturn false;\n\n\tpending_write_result(p, err);\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nbool gatt_db_attribute_write_result(struct gatt_db_attribute *attrib,\n\t\t\t\t\t\tunsigned int id, int err)\n{\n\tstruct pending_write *p;\n\n\tif (!attrib || !id)\n\t\treturn false;\n\n\tp = queue_remove_if(attrib->pending_writes, find_pending,\n\t\t\t\t\t\t\tUINT_TO_PTR(id));\n\tif (!p)\n\t\treturn false;\n\n\tpending_write_result(p, err);\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "pending_op_free",
          "args": [
            "op"
          ],
          "line": 1006
        },
        "resolved": true,
        "details": {
          "function_name": "pending_op_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "941-949",
          "snippet": "static void pending_op_free(void *data)\n{\n\tstruct pending_op *op = data;\n\n\tif (op->owner_queue)\n\t\tqueue_remove(op->owner_queue, op);\n\n\tfree(op);\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic void pending_op_free(void *data)\n{\n\tstruct pending_op *op = data;\n\n\tif (op->owner_queue)\n\t\tqueue_remove(op->owner_queue, op);\n\n\tfree(op);\n}"
        }
      },
      {
        "call_info": {
          "callee": "ccc_cb->callback",
          "args": [
            "op",
            "ccc_cb->user_data"
          ],
          "line": 1004
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pending_ccc_new",
          "args": [
            "att",
            "attrib",
            "get_le16(value)",
            "bt_att_get_link_type(att)"
          ],
          "line": 997
        },
        "resolved": true,
        "details": {
          "function_name": "pending_ccc_new",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "915-939",
          "snippet": "static struct pending_op *pending_ccc_new(struct bt_att *att,\n\t\t\t\t\tstruct gatt_db_attribute *attrib,\n\t\t\t\t\tuint16_t value,\n\t\t\t\t\tuint8_t link_type)\n{\n\tstruct pending_op *op;\n\tstruct btd_device *device;\n\n\tdevice = att_get_device(att);\n\tif (!device) {\n\t\terror(\"Unable to find device object\");\n\t\treturn NULL;\n\t}\n\n\top = new0(struct pending_op, 1);\n\n\top->data.iov_base = UINT_TO_PTR(value);\n\top->data.iov_len = sizeof(value);\n\n\top->device = device;\n\top->attrib = attrib;\n\top->link_type = link_type;\n\n\treturn op;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic struct pending_op *pending_ccc_new(struct bt_att *att,\n\t\t\t\t\tstruct gatt_db_attribute *attrib,\n\t\t\t\t\tuint16_t value,\n\t\t\t\t\tuint8_t link_type)\n{\n\tstruct pending_op *op;\n\tstruct btd_device *device;\n\n\tdevice = att_get_device(att);\n\tif (!device) {\n\t\terror(\"Unable to find device object\");\n\t\treturn NULL;\n\t}\n\n\top = new0(struct pending_op, 1);\n\n\top->data.iov_base = UINT_TO_PTR(value);\n\top->data.iov_len = sizeof(value);\n\n\top->device = device;\n\top->attrib = attrib;\n\top->link_type = link_type;\n\n\treturn op;\n}"
        }
      },
      {
        "call_info": {
          "callee": "bt_att_get_link_type",
          "args": [
            "att"
          ],
          "line": 998
        },
        "resolved": true,
        "details": {
          "function_name": "bt_att_get_link_type",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/att.c",
          "lines": "1139-1159",
          "snippet": "uint8_t bt_att_get_link_type(struct bt_att *att)\n{\n\tstruct sockaddr_l2 src;\n\tsocklen_t len;\n\n\tif (!att)\n\t\treturn -EINVAL;\n\n\tif (!att->io_on_l2cap)\n\t\treturn BT_ATT_LINK_LOCAL;\n\n\tlen = sizeof(src);\n\tmemset(&src, 0, len);\n\tif (getsockname(att->fd, (void *)&src, &len) < 0)\n\t\treturn -errno;\n\n\tif (src.l2_bdaddr_type == BDADDR_BREDR)\n\t\treturn BT_ATT_LINK_BREDR;\n\n\treturn BT_ATT_LINK_LE;\n}",
          "includes": [
            "#include \"src/shared/crypto.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/l2cap.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/crypto.h\"\n#include \"src/shared/att.h\"\n#include \"lib/uuid.h\"\n#include \"lib/l2cap.h\"\n#include \"lib/bluetooth.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include <errno.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <config.h>\n\nuint8_t bt_att_get_link_type(struct bt_att *att)\n{\n\tstruct sockaddr_l2 src;\n\tsocklen_t len;\n\n\tif (!att)\n\t\treturn -EINVAL;\n\n\tif (!att->io_on_l2cap)\n\t\treturn BT_ATT_LINK_LOCAL;\n\n\tlen = sizeof(src);\n\tmemset(&src, 0, len);\n\tif (getsockname(att->fd, (void *)&src, &len) < 0)\n\t\treturn -errno;\n\n\tif (src.l2_bdaddr_type == BDADDR_BREDR)\n\t\treturn BT_ATT_LINK_BREDR;\n\n\treturn BT_ATT_LINK_LE;\n}"
        }
      },
      {
        "call_info": {
          "callee": "get_le16",
          "args": [
            "value"
          ],
          "line": 997
        },
        "resolved": true,
        "details": {
          "function_name": "get_le16",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/util.h",
          "lines": "129-132",
          "snippet": "static inline uint16_t get_le16(const void *ptr)\n{\n\treturn le16_to_cpu(get_unaligned((const uint16_t *) ptr));\n}",
          "includes": [
            "#include <string.h>",
            "#include <byteswap.h>",
            "#include <alloca.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <byteswap.h>\n#include <alloca.h>\n#include <stdlib.h>\n#include <stdint.h>\n\nstatic inline uint16_t get_le16(const void *ptr)\n{\n\treturn le16_to_cpu(get_unaligned((const uint16_t *) ptr));\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_find",
          "args": [
            "database->ccc_callbacks",
            "ccc_cb_match_handle",
            "UINT_TO_PTR(gatt_db_attribute_get_handle(attrib))"
          ],
          "line": 983
        },
        "resolved": true,
        "details": {
          "function_name": "queue_find",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "231-247",
          "snippet": "void *queue_find(struct queue *queue, queue_match_func_t function,\n\t\t\t\t\t\t\tconst void *match_data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn NULL;\n\n\tif (!function)\n\t\tfunction = direct_match;\n\n\tfor (entry = queue->head; entry; entry = entry->next)\n\t\tif (function(entry->data, match_data))\n\t\t\treturn entry->data;\n\n\treturn NULL;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nvoid *queue_find(struct queue *queue, queue_match_func_t function,\n\t\t\t\t\t\t\tconst void *match_data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn NULL;\n\n\tif (!function)\n\t\tfunction = direct_match;\n\n\tfor (entry = queue->head; entry; entry = entry->next)\n\t\tif (function(entry->data, match_data))\n\t\t\treturn entry->data;\n\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "UINT_TO_PTR",
          "args": [
            "gatt_db_attribute_get_handle(attrib)"
          ],
          "line": 984
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "gatt_db_attribute_get_handle",
          "args": [
            "attrib"
          ],
          "line": 984
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_attribute_get_handle",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "1482-1488",
          "snippet": "uint16_t gatt_db_attribute_get_handle(const struct gatt_db_attribute *attrib)\n{\n\tif (!attrib)\n\t\treturn 0;\n\n\treturn attrib->handle;\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nuint16_t gatt_db_attribute_get_handle(const struct gatt_db_attribute *attrib)\n{\n\tif (!attrib)\n\t\treturn 0;\n\n\treturn attrib->handle;\n}"
        }
      },
      {
        "call_info": {
          "callee": "get_ccc_state",
          "args": [
            "database",
            "att",
            "handle"
          ],
          "line": 977
        },
        "resolved": true,
        "details": {
          "function_name": "get_ccc_state",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "410-429",
          "snippet": "static struct ccc_state *get_ccc_state(struct btd_gatt_database *database,\n\t\t\t\t\tstruct bt_att *att, uint16_t handle)\n{\n\tstruct device_state *dev_state;\n\tstruct ccc_state *ccc;\n\n\tdev_state = get_device_state(database, att);\n\tif (!dev_state)\n\t\treturn NULL;\n\n\tccc = find_ccc_state(dev_state, handle);\n\tif (ccc)\n\t\treturn ccc;\n\n\tccc = new0(struct ccc_state, 1);\n\tccc->handle = handle;\n\tqueue_push_tail(dev_state->ccc_states, ccc);\n\n\treturn ccc;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic struct ccc_state *get_ccc_state(struct btd_gatt_database *database,\n\t\t\t\t\tstruct bt_att *att, uint16_t handle)\n{\n\tstruct device_state *dev_state;\n\tstruct ccc_state *ccc;\n\n\tdev_state = get_device_state(database, att);\n\tif (!dev_state)\n\t\treturn NULL;\n\n\tccc = find_ccc_state(dev_state, handle);\n\tif (ccc)\n\t\treturn ccc;\n\n\tccc = new0(struct ccc_state, 1);\n\tccc->handle = handle;\n\tqueue_push_tail(dev_state->ccc_states, ccc);\n\n\treturn ccc;\n}"
        }
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"CCC write called for handle: 0x%04x\"",
            "handle"
          ],
          "line": 965
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic void gatt_ccc_write_cb(struct gatt_db_attribute *attrib,\n\t\t\t\t\tunsigned int id, uint16_t offset,\n\t\t\t\t\tconst uint8_t *value, size_t len,\n\t\t\t\t\tuint8_t opcode, struct bt_att *att,\n\t\t\t\t\tvoid *user_data)\n{\n\tstruct btd_gatt_database *database = user_data;\n\tstruct ccc_state *ccc;\n\tstruct ccc_cb_data *ccc_cb;\n\tuint16_t handle;\n\tuint8_t ecode = 0;\n\n\thandle = gatt_db_attribute_get_handle(attrib);\n\n\tDBG(\"CCC write called for handle: 0x%04x\", handle);\n\n\tif (!value || len != 2) {\n\t\tecode = BT_ATT_ERROR_INVALID_ATTRIBUTE_VALUE_LEN;\n\t\tgoto done;\n\t}\n\n\tif (offset > 2) {\n\t\tecode = BT_ATT_ERROR_INVALID_OFFSET;\n\t\tgoto done;\n\t}\n\n\tccc = get_ccc_state(database, att, handle);\n\tif (!ccc) {\n\t\tecode = BT_ATT_ERROR_UNLIKELY;\n\t\tgoto done;\n\t}\n\n\tccc_cb = queue_find(database->ccc_callbacks, ccc_cb_match_handle,\n\t\t\tUINT_TO_PTR(gatt_db_attribute_get_handle(attrib)));\n\tif (!ccc_cb) {\n\t\tecode = BT_ATT_ERROR_UNLIKELY;\n\t\tgoto done;\n\t}\n\n\t/* If value is identical, then just succeed */\n\tif (ccc->value[0] == value[0] && ccc->value[1] == value[1])\n\t\tgoto done;\n\n\tif (ccc_cb->callback) {\n\t\tstruct pending_op *op;\n\n\t\top = pending_ccc_new(att, attrib, get_le16(value),\n\t\t\t\t\tbt_att_get_link_type(att));\n\t\tif (!op) {\n\t\t\tecode = BT_ATT_ERROR_UNLIKELY;\n\t\t\tgoto done;\n\t\t}\n\n\t\tecode = ccc_cb->callback(op, ccc_cb->user_data);\n\t\tif (ecode)\n\t\t\tpending_op_free(op);\n\t}\n\n\tif (!ecode) {\n\t\tccc->value[0] = value[0];\n\t\tccc->value[1] = value[1];\n\t}\n\ndone:\n\tgatt_db_attribute_write_result(attrib, id, ecode);\n}"
  },
  {
    "function_name": "pending_op_free",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
    "lines": "941-949",
    "snippet": "static void pending_op_free(void *data)\n{\n\tstruct pending_op *op = data;\n\n\tif (op->owner_queue)\n\t\tqueue_remove(op->owner_queue, op);\n\n\tfree(op);\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"dbus-common.h\"",
      "#include \"gatt-database.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "op"
          ],
          "line": 948
        },
        "resolved": true,
        "details": {
          "function_name": "app_free_idle_cb",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "1303-1308",
          "snippet": "static gboolean app_free_idle_cb(void *data)\n{\n\tapp_free(data);\n\n\treturn FALSE;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic gboolean app_free_idle_cb(void *data)\n{\n\tapp_free(data);\n\n\treturn FALSE;\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_remove",
          "args": [
            "op->owner_queue",
            "op"
          ],
          "line": 946
        },
        "resolved": true,
        "details": {
          "function_name": "queue_remove_uuid",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
          "lines": "526-541",
          "snippet": "static bool queue_remove_uuid(struct queue *queue, bt_uuid_t *uuid)\n{\n\tbt_uuid_t *removed;\n\n\tif (!queue || !uuid)\n\t\treturn false;\n\n\tremoved = queue_remove_if(queue, uuid_match, uuid);\n\n\tif (removed) {\n\t\tfree(removed);\n\t\treturn true;\n\t}\n\n\treturn false;\n}",
          "includes": [
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/eir.h\"",
            "#include \"src/shared/ad.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nstatic bool queue_remove_uuid(struct queue *queue, bt_uuid_t *uuid)\n{\n\tbt_uuid_t *removed;\n\n\tif (!queue || !uuid)\n\t\treturn false;\n\n\tremoved = queue_remove_if(queue, uuid_match, uuid);\n\n\tif (removed) {\n\t\tfree(removed);\n\t\treturn true;\n\t}\n\n\treturn false;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic void pending_op_free(void *data)\n{\n\tstruct pending_op *op = data;\n\n\tif (op->owner_queue)\n\t\tqueue_remove(op->owner_queue, op);\n\n\tfree(op);\n}"
  },
  {
    "function_name": "pending_ccc_new",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
    "lines": "915-939",
    "snippet": "static struct pending_op *pending_ccc_new(struct bt_att *att,\n\t\t\t\t\tstruct gatt_db_attribute *attrib,\n\t\t\t\t\tuint16_t value,\n\t\t\t\t\tuint8_t link_type)\n{\n\tstruct pending_op *op;\n\tstruct btd_device *device;\n\n\tdevice = att_get_device(att);\n\tif (!device) {\n\t\terror(\"Unable to find device object\");\n\t\treturn NULL;\n\t}\n\n\top = new0(struct pending_op, 1);\n\n\top->data.iov_base = UINT_TO_PTR(value);\n\top->data.iov_len = sizeof(value);\n\n\top->device = device;\n\top->attrib = attrib;\n\top->link_type = link_type;\n\n\treturn op;\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"dbus-common.h\"",
      "#include \"gatt-database.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "UINT_TO_PTR",
          "args": [
            "value"
          ],
          "line": 931
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "new0",
          "args": [
            "structpending_op",
            "1"
          ],
          "line": 929
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"Unable to find device object\""
          ],
          "line": 925
        },
        "resolved": true,
        "details": {
          "function_name": "dbus_error_to_att_ecode",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "1833-1855",
          "snippet": "static uint8_t dbus_error_to_att_ecode(const char *error_name)\n{\n\n\tif (strcmp(error_name, \"org.bluez.Error.Failed\") == 0)\n\t\treturn 0x80;  /* For now return this \"application error\" */\n\n\tif (strcmp(error_name, \"org.bluez.Error.NotSupported\") == 0)\n\t\treturn BT_ATT_ERROR_REQUEST_NOT_SUPPORTED;\n\n\tif (strcmp(error_name, \"org.bluez.Error.NotAuthorized\") == 0)\n\t\treturn BT_ATT_ERROR_AUTHORIZATION;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InvalidValueLength\") == 0)\n\t\treturn BT_ATT_ERROR_INVALID_ATTRIBUTE_VALUE_LEN;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InvalidOffset\") == 0)\n\t\treturn BT_ATT_ERROR_INVALID_OFFSET;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InProgress\") == 0)\n\t\treturn BT_ERROR_ALREADY_IN_PROGRESS;\n\n\treturn 0;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic uint8_t dbus_error_to_att_ecode(const char *error_name)\n{\n\n\tif (strcmp(error_name, \"org.bluez.Error.Failed\") == 0)\n\t\treturn 0x80;  /* For now return this \"application error\" */\n\n\tif (strcmp(error_name, \"org.bluez.Error.NotSupported\") == 0)\n\t\treturn BT_ATT_ERROR_REQUEST_NOT_SUPPORTED;\n\n\tif (strcmp(error_name, \"org.bluez.Error.NotAuthorized\") == 0)\n\t\treturn BT_ATT_ERROR_AUTHORIZATION;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InvalidValueLength\") == 0)\n\t\treturn BT_ATT_ERROR_INVALID_ATTRIBUTE_VALUE_LEN;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InvalidOffset\") == 0)\n\t\treturn BT_ATT_ERROR_INVALID_OFFSET;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InProgress\") == 0)\n\t\treturn BT_ERROR_ALREADY_IN_PROGRESS;\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "att_get_device",
          "args": [
            "att"
          ],
          "line": 923
        },
        "resolved": true,
        "details": {
          "function_name": "att_get_device",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "881-913",
          "snippet": "static struct btd_device *att_get_device(struct bt_att *att)\n{\n\tGIOChannel *io = NULL;\n\tGError *gerr = NULL;\n\tbdaddr_t src, dst;\n\tuint8_t dst_type;\n\tstruct btd_adapter *adapter;\n\n\tio = g_io_channel_unix_new(bt_att_get_fd(att));\n\tif (!io)\n\t\treturn NULL;\n\n\tbt_io_get(io, &gerr, BT_IO_OPT_SOURCE_BDADDR, &src,\n\t\t\t\t\tBT_IO_OPT_DEST_BDADDR, &dst,\n\t\t\t\t\tBT_IO_OPT_DEST_TYPE, &dst_type,\n\t\t\t\t\tBT_IO_OPT_INVALID);\n\tif (gerr) {\n\t\terror(\"bt_io_get: %s\", gerr->message);\n\t\tg_error_free(gerr);\n\t\tg_io_channel_unref(io);\n\t\treturn NULL;\n\t}\n\n\tg_io_channel_unref(io);\n\n\tadapter = adapter_find(&src);\n\tif (!adapter) {\n\t\terror(\"Unable to find adapter object\");\n\t\treturn NULL;\n\t}\n\n\treturn btd_adapter_find_device(adapter, &dst, dst_type);\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic struct btd_device *att_get_device(struct bt_att *att)\n{\n\tGIOChannel *io = NULL;\n\tGError *gerr = NULL;\n\tbdaddr_t src, dst;\n\tuint8_t dst_type;\n\tstruct btd_adapter *adapter;\n\n\tio = g_io_channel_unix_new(bt_att_get_fd(att));\n\tif (!io)\n\t\treturn NULL;\n\n\tbt_io_get(io, &gerr, BT_IO_OPT_SOURCE_BDADDR, &src,\n\t\t\t\t\tBT_IO_OPT_DEST_BDADDR, &dst,\n\t\t\t\t\tBT_IO_OPT_DEST_TYPE, &dst_type,\n\t\t\t\t\tBT_IO_OPT_INVALID);\n\tif (gerr) {\n\t\terror(\"bt_io_get: %s\", gerr->message);\n\t\tg_error_free(gerr);\n\t\tg_io_channel_unref(io);\n\t\treturn NULL;\n\t}\n\n\tg_io_channel_unref(io);\n\n\tadapter = adapter_find(&src);\n\tif (!adapter) {\n\t\terror(\"Unable to find adapter object\");\n\t\treturn NULL;\n\t}\n\n\treturn btd_adapter_find_device(adapter, &dst, dst_type);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic struct pending_op *pending_ccc_new(struct bt_att *att,\n\t\t\t\t\tstruct gatt_db_attribute *attrib,\n\t\t\t\t\tuint16_t value,\n\t\t\t\t\tuint8_t link_type)\n{\n\tstruct pending_op *op;\n\tstruct btd_device *device;\n\n\tdevice = att_get_device(att);\n\tif (!device) {\n\t\terror(\"Unable to find device object\");\n\t\treturn NULL;\n\t}\n\n\top = new0(struct pending_op, 1);\n\n\top->data.iov_base = UINT_TO_PTR(value);\n\top->data.iov_len = sizeof(value);\n\n\top->device = device;\n\top->attrib = attrib;\n\top->link_type = link_type;\n\n\treturn op;\n}"
  },
  {
    "function_name": "att_get_device",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
    "lines": "881-913",
    "snippet": "static struct btd_device *att_get_device(struct bt_att *att)\n{\n\tGIOChannel *io = NULL;\n\tGError *gerr = NULL;\n\tbdaddr_t src, dst;\n\tuint8_t dst_type;\n\tstruct btd_adapter *adapter;\n\n\tio = g_io_channel_unix_new(bt_att_get_fd(att));\n\tif (!io)\n\t\treturn NULL;\n\n\tbt_io_get(io, &gerr, BT_IO_OPT_SOURCE_BDADDR, &src,\n\t\t\t\t\tBT_IO_OPT_DEST_BDADDR, &dst,\n\t\t\t\t\tBT_IO_OPT_DEST_TYPE, &dst_type,\n\t\t\t\t\tBT_IO_OPT_INVALID);\n\tif (gerr) {\n\t\terror(\"bt_io_get: %s\", gerr->message);\n\t\tg_error_free(gerr);\n\t\tg_io_channel_unref(io);\n\t\treturn NULL;\n\t}\n\n\tg_io_channel_unref(io);\n\n\tadapter = adapter_find(&src);\n\tif (!adapter) {\n\t\terror(\"Unable to find adapter object\");\n\t\treturn NULL;\n\t}\n\n\treturn btd_adapter_find_device(adapter, &dst, dst_type);\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"dbus-common.h\"",
      "#include \"gatt-database.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "btd_adapter_find_device",
          "args": [
            "adapter",
            "&dst",
            "dst_type"
          ],
          "line": 912
        },
        "resolved": true,
        "details": {
          "function_name": "btd_adapter_find_device",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "831-863",
          "snippet": "struct btd_device *btd_adapter_find_device(struct btd_adapter *adapter,\n\t\t\t\t\t\t\tconst bdaddr_t *dst,\n\t\t\t\t\t\t\tuint8_t bdaddr_type)\n{\n\tstruct device_addr_type addr;\n\tstruct btd_device *device;\n\tGSList *list;\n\n\tif (!adapter)\n\t\treturn NULL;\n\n\tbacpy(&addr.bdaddr, dst);\n\taddr.bdaddr_type = bdaddr_type;\n\n\tlist = g_slist_find_custom(adapter->devices, &addr,\n\t\t\t\t\t\t\tdevice_addr_type_cmp);\n\tif (!list)\n\t\treturn NULL;\n\n\tdevice = list->data;\n\n\t/*\n\t * If we're looking up based on public address and the address\n\t * was not previously used over this bearer we may need to\n\t * update LE or BR/EDR support information.\n\t */\n\tif (bdaddr_type == BDADDR_BREDR)\n\t\tdevice_set_bredr_support(device);\n\telse\n\t\tdevice_set_le_support(device, bdaddr_type);\n\n\treturn device;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void trigger_pairable_timeout(struct btd_adapter *adapter);",
            "static void adapter_start(struct btd_adapter *adapter);",
            "static void adapter_stop(struct btd_adapter *adapter);",
            "static void trigger_passive_scanning(struct btd_adapter *adapter);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void trigger_pairable_timeout(struct btd_adapter *adapter);\nstatic void adapter_start(struct btd_adapter *adapter);\nstatic void adapter_stop(struct btd_adapter *adapter);\nstatic void trigger_passive_scanning(struct btd_adapter *adapter);\n\nstruct btd_device *btd_adapter_find_device(struct btd_adapter *adapter,\n\t\t\t\t\t\t\tconst bdaddr_t *dst,\n\t\t\t\t\t\t\tuint8_t bdaddr_type)\n{\n\tstruct device_addr_type addr;\n\tstruct btd_device *device;\n\tGSList *list;\n\n\tif (!adapter)\n\t\treturn NULL;\n\n\tbacpy(&addr.bdaddr, dst);\n\taddr.bdaddr_type = bdaddr_type;\n\n\tlist = g_slist_find_custom(adapter->devices, &addr,\n\t\t\t\t\t\t\tdevice_addr_type_cmp);\n\tif (!list)\n\t\treturn NULL;\n\n\tdevice = list->data;\n\n\t/*\n\t * If we're looking up based on public address and the address\n\t * was not previously used over this bearer we may need to\n\t * update LE or BR/EDR support information.\n\t */\n\tif (bdaddr_type == BDADDR_BREDR)\n\t\tdevice_set_bredr_support(device);\n\telse\n\t\tdevice_set_le_support(device, bdaddr_type);\n\n\treturn device;\n}"
        }
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"Unable to find adapter object\""
          ],
          "line": 908
        },
        "resolved": true,
        "details": {
          "function_name": "dbus_error_to_att_ecode",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "1833-1855",
          "snippet": "static uint8_t dbus_error_to_att_ecode(const char *error_name)\n{\n\n\tif (strcmp(error_name, \"org.bluez.Error.Failed\") == 0)\n\t\treturn 0x80;  /* For now return this \"application error\" */\n\n\tif (strcmp(error_name, \"org.bluez.Error.NotSupported\") == 0)\n\t\treturn BT_ATT_ERROR_REQUEST_NOT_SUPPORTED;\n\n\tif (strcmp(error_name, \"org.bluez.Error.NotAuthorized\") == 0)\n\t\treturn BT_ATT_ERROR_AUTHORIZATION;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InvalidValueLength\") == 0)\n\t\treturn BT_ATT_ERROR_INVALID_ATTRIBUTE_VALUE_LEN;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InvalidOffset\") == 0)\n\t\treturn BT_ATT_ERROR_INVALID_OFFSET;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InProgress\") == 0)\n\t\treturn BT_ERROR_ALREADY_IN_PROGRESS;\n\n\treturn 0;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic uint8_t dbus_error_to_att_ecode(const char *error_name)\n{\n\n\tif (strcmp(error_name, \"org.bluez.Error.Failed\") == 0)\n\t\treturn 0x80;  /* For now return this \"application error\" */\n\n\tif (strcmp(error_name, \"org.bluez.Error.NotSupported\") == 0)\n\t\treturn BT_ATT_ERROR_REQUEST_NOT_SUPPORTED;\n\n\tif (strcmp(error_name, \"org.bluez.Error.NotAuthorized\") == 0)\n\t\treturn BT_ATT_ERROR_AUTHORIZATION;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InvalidValueLength\") == 0)\n\t\treturn BT_ATT_ERROR_INVALID_ATTRIBUTE_VALUE_LEN;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InvalidOffset\") == 0)\n\t\treturn BT_ATT_ERROR_INVALID_OFFSET;\n\n\tif (strcmp(error_name, \"org.bluez.Error.InProgress\") == 0)\n\t\treturn BT_ERROR_ALREADY_IN_PROGRESS;\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "adapter_find",
          "args": [
            "&src"
          ],
          "line": 906
        },
        "resolved": true,
        "details": {
          "function_name": "adapter_find_by_id",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "8013-8023",
          "snippet": "struct btd_adapter *adapter_find_by_id(int id)\n{\n\tGSList *match;\n\n\tmatch = g_slist_find_custom(adapters, GINT_TO_POINTER(id),\n\t\t\t\t\t\t\tadapter_id_cmp);\n\tif (!match)\n\t\treturn NULL;\n\n\treturn match->data;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static GSList *adapters = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic GSList *adapters = NULL;\n\nstruct btd_adapter *adapter_find_by_id(int id)\n{\n\tGSList *match;\n\n\tmatch = g_slist_find_custom(adapters, GINT_TO_POINTER(id),\n\t\t\t\t\t\t\tadapter_id_cmp);\n\tif (!match)\n\t\treturn NULL;\n\n\treturn match->data;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_io_channel_unref",
          "args": [
            "io"
          ],
          "line": 904
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_io_channel_unref",
          "args": [
            "io"
          ],
          "line": 900
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_error_free",
          "args": [
            "gerr"
          ],
          "line": 899
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"bt_io_get: %s\"",
            "gerr->message"
          ],
          "line": 898
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_failed",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "124-128",
          "snippet": "DBusMessage *btd_error_failed(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE\n\t\t\t\t\t\".Failed\", \"%s\", str);\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_failed(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE\n\t\t\t\t\t\".Failed\", \"%s\", str);\n}"
        }
      },
      {
        "call_info": {
          "callee": "bt_io_get",
          "args": [
            "io",
            "&gerr",
            "BT_IO_OPT_SOURCE_BDADDR",
            "&src",
            "BT_IO_OPT_DEST_BDADDR",
            "&dst",
            "BT_IO_OPT_DEST_TYPE",
            "&dst_type",
            "BT_IO_OPT_INVALID"
          ],
          "line": 893
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_io_channel_unix_new",
          "args": [
            "bt_att_get_fd(att)"
          ],
          "line": 889
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bt_att_get_fd",
          "args": [
            "att"
          ],
          "line": 889
        },
        "resolved": true,
        "details": {
          "function_name": "bt_att_get_fd",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/att.c",
          "lines": "1085-1091",
          "snippet": "int bt_att_get_fd(struct bt_att *att)\n{\n\tif (!att)\n\t\treturn -1;\n\n\treturn att->fd;\n}",
          "includes": [
            "#include \"src/shared/crypto.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/l2cap.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/crypto.h\"\n#include \"src/shared/att.h\"\n#include \"lib/uuid.h\"\n#include \"lib/l2cap.h\"\n#include \"lib/bluetooth.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include <errno.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <config.h>\n\nint bt_att_get_fd(struct bt_att *att)\n{\n\tif (!att)\n\t\treturn -1;\n\n\treturn att->fd;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic struct btd_device *att_get_device(struct bt_att *att)\n{\n\tGIOChannel *io = NULL;\n\tGError *gerr = NULL;\n\tbdaddr_t src, dst;\n\tuint8_t dst_type;\n\tstruct btd_adapter *adapter;\n\n\tio = g_io_channel_unix_new(bt_att_get_fd(att));\n\tif (!io)\n\t\treturn NULL;\n\n\tbt_io_get(io, &gerr, BT_IO_OPT_SOURCE_BDADDR, &src,\n\t\t\t\t\tBT_IO_OPT_DEST_BDADDR, &dst,\n\t\t\t\t\tBT_IO_OPT_DEST_TYPE, &dst_type,\n\t\t\t\t\tBT_IO_OPT_INVALID);\n\tif (gerr) {\n\t\terror(\"bt_io_get: %s\", gerr->message);\n\t\tg_error_free(gerr);\n\t\tg_io_channel_unref(io);\n\t\treturn NULL;\n\t}\n\n\tg_io_channel_unref(io);\n\n\tadapter = adapter_find(&src);\n\tif (!adapter) {\n\t\terror(\"Unable to find adapter object\");\n\t\treturn NULL;\n\t}\n\n\treturn btd_adapter_find_device(adapter, &dst, dst_type);\n}"
  },
  {
    "function_name": "gatt_ccc_read_cb",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
    "lines": "847-879",
    "snippet": "static void gatt_ccc_read_cb(struct gatt_db_attribute *attrib,\n\t\t\t\t\tunsigned int id, uint16_t offset,\n\t\t\t\t\tuint8_t opcode, struct bt_att *att,\n\t\t\t\t\tvoid *user_data)\n{\n\tstruct btd_gatt_database *database = user_data;\n\tstruct ccc_state *ccc;\n\tuint16_t handle;\n\tuint8_t ecode = 0;\n\tconst uint8_t *value = NULL;\n\tsize_t len = 0;\n\n\thandle = gatt_db_attribute_get_handle(attrib);\n\n\tDBG(\"CCC read called for handle: 0x%04x\", handle);\n\n\tif (offset > 2) {\n\t\tecode = BT_ATT_ERROR_INVALID_OFFSET;\n\t\tgoto done;\n\t}\n\n\tccc = get_ccc_state(database, att, handle);\n\tif (!ccc) {\n\t\tecode = BT_ATT_ERROR_UNLIKELY;\n\t\tgoto done;\n\t}\n\n\tlen = 2 - offset;\n\tvalue = len ? &ccc->value[offset] : NULL;\n\ndone:\n\tgatt_db_attribute_read_result(attrib, id, ecode, value, len);\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"dbus-common.h\"",
      "#include \"gatt-database.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "gatt_db_attribute_read_result",
          "args": [
            "attrib",
            "id",
            "ecode",
            "value",
            "len"
          ],
          "line": 878
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_attribute_read_result",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "1773-1790",
          "snippet": "bool gatt_db_attribute_read_result(struct gatt_db_attribute *attrib,\n\t\t\t\t\tunsigned int id, int err,\n\t\t\t\t\tconst uint8_t *value, size_t length)\n{\n\tstruct pending_read *p;\n\n\tif (!attrib || !id)\n\t\treturn false;\n\n\tp = queue_remove_if(attrib->pending_reads, find_pending,\n\t\t\t\t\t\t\tUINT_TO_PTR(id));\n\tif (!p)\n\t\treturn false;\n\n\tpending_read_result(p, err, value, length);\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nbool gatt_db_attribute_read_result(struct gatt_db_attribute *attrib,\n\t\t\t\t\tunsigned int id, int err,\n\t\t\t\t\tconst uint8_t *value, size_t length)\n{\n\tstruct pending_read *p;\n\n\tif (!attrib || !id)\n\t\treturn false;\n\n\tp = queue_remove_if(attrib->pending_reads, find_pending,\n\t\t\t\t\t\t\tUINT_TO_PTR(id));\n\tif (!p)\n\t\treturn false;\n\n\tpending_read_result(p, err, value, length);\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "get_ccc_state",
          "args": [
            "database",
            "att",
            "handle"
          ],
          "line": 868
        },
        "resolved": true,
        "details": {
          "function_name": "get_ccc_state",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "410-429",
          "snippet": "static struct ccc_state *get_ccc_state(struct btd_gatt_database *database,\n\t\t\t\t\tstruct bt_att *att, uint16_t handle)\n{\n\tstruct device_state *dev_state;\n\tstruct ccc_state *ccc;\n\n\tdev_state = get_device_state(database, att);\n\tif (!dev_state)\n\t\treturn NULL;\n\n\tccc = find_ccc_state(dev_state, handle);\n\tif (ccc)\n\t\treturn ccc;\n\n\tccc = new0(struct ccc_state, 1);\n\tccc->handle = handle;\n\tqueue_push_tail(dev_state->ccc_states, ccc);\n\n\treturn ccc;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic struct ccc_state *get_ccc_state(struct btd_gatt_database *database,\n\t\t\t\t\tstruct bt_att *att, uint16_t handle)\n{\n\tstruct device_state *dev_state;\n\tstruct ccc_state *ccc;\n\n\tdev_state = get_device_state(database, att);\n\tif (!dev_state)\n\t\treturn NULL;\n\n\tccc = find_ccc_state(dev_state, handle);\n\tif (ccc)\n\t\treturn ccc;\n\n\tccc = new0(struct ccc_state, 1);\n\tccc->handle = handle;\n\tqueue_push_tail(dev_state->ccc_states, ccc);\n\n\treturn ccc;\n}"
        }
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"CCC read called for handle: 0x%04x\"",
            "handle"
          ],
          "line": 861
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "gatt_db_attribute_get_handle",
          "args": [
            "attrib"
          ],
          "line": 859
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_attribute_get_handle",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "1482-1488",
          "snippet": "uint16_t gatt_db_attribute_get_handle(const struct gatt_db_attribute *attrib)\n{\n\tif (!attrib)\n\t\treturn 0;\n\n\treturn attrib->handle;\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nuint16_t gatt_db_attribute_get_handle(const struct gatt_db_attribute *attrib)\n{\n\tif (!attrib)\n\t\treturn 0;\n\n\treturn attrib->handle;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic void gatt_ccc_read_cb(struct gatt_db_attribute *attrib,\n\t\t\t\t\tunsigned int id, uint16_t offset,\n\t\t\t\t\tuint8_t opcode, struct bt_att *att,\n\t\t\t\t\tvoid *user_data)\n{\n\tstruct btd_gatt_database *database = user_data;\n\tstruct ccc_state *ccc;\n\tuint16_t handle;\n\tuint8_t ecode = 0;\n\tconst uint8_t *value = NULL;\n\tsize_t len = 0;\n\n\thandle = gatt_db_attribute_get_handle(attrib);\n\n\tDBG(\"CCC read called for handle: 0x%04x\", handle);\n\n\tif (offset > 2) {\n\t\tecode = BT_ATT_ERROR_INVALID_OFFSET;\n\t\tgoto done;\n\t}\n\n\tccc = get_ccc_state(database, att, handle);\n\tif (!ccc) {\n\t\tecode = BT_ATT_ERROR_UNLIKELY;\n\t\tgoto done;\n\t}\n\n\tlen = 2 - offset;\n\tvalue = len ? &ccc->value[offset] : NULL;\n\ndone:\n\tgatt_db_attribute_read_result(attrib, id, ecode, value, len);\n}"
  },
  {
    "function_name": "populate_gap_service",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
    "lines": "817-845",
    "snippet": "static void populate_gap_service(struct btd_gatt_database *database)\n{\n\tbt_uuid_t uuid;\n\tstruct gatt_db_attribute *service;\n\n\t/* Add the GAP service */\n\tbt_uuid16_create(&uuid, UUID_GAP);\n\tservice = gatt_db_add_service(database->db, &uuid, true, 5);\n\n\t/*\n\t * Device Name characteristic.\n\t */\n\tbt_uuid16_create(&uuid, GATT_CHARAC_DEVICE_NAME);\n\tgatt_db_service_add_characteristic(service, &uuid, BT_ATT_PERM_READ,\n\t\t\t\t\t\t\tBT_GATT_CHRC_PROP_READ,\n\t\t\t\t\t\t\tgap_device_name_read_cb,\n\t\t\t\t\t\t\tNULL, database);\n\n\t/*\n\t * Device Appearance characteristic.\n\t */\n\tbt_uuid16_create(&uuid, GATT_CHARAC_APPEARANCE);\n\tgatt_db_service_add_characteristic(service, &uuid, BT_ATT_PERM_READ,\n\t\t\t\t\t\t\tBT_GATT_CHRC_PROP_READ,\n\t\t\t\t\t\t\tgap_appearance_read_cb,\n\t\t\t\t\t\t\tNULL, database);\n\n\tgatt_db_service_set_active(service, true);\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"dbus-common.h\"",
      "#include \"gatt-database.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define UUID_GAP\t0x1800"
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "gatt_db_service_set_active",
          "args": [
            "service",
            "true"
          ],
          "line": 844
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_service_set_active",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "975-992",
          "snippet": "bool gatt_db_service_set_active(struct gatt_db_attribute *attrib, bool active)\n{\n\tstruct gatt_db_service *service;\n\n\tif (!attrib)\n\t\treturn false;\n\n\tservice = attrib->service;\n\n\tif (service->active == active)\n\t\treturn true;\n\n\tservice->active = active;\n\n\tnotify_service_changed(service->db, service, active);\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nbool gatt_db_service_set_active(struct gatt_db_attribute *attrib, bool active)\n{\n\tstruct gatt_db_service *service;\n\n\tif (!attrib)\n\t\treturn false;\n\n\tservice = attrib->service;\n\n\tif (service->active == active)\n\t\treturn true;\n\n\tservice->active = active;\n\n\tnotify_service_changed(service->db, service, active);\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "gatt_db_service_add_characteristic",
          "args": [
            "service",
            "&uuid",
            "BT_ATT_PERM_READ",
            "BT_GATT_CHRC_PROP_READ",
            "gap_appearance_read_cb",
            "NULL",
            "database"
          ],
          "line": 839
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_service_add_characteristic",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "780-796",
          "snippet": "struct gatt_db_attribute *\ngatt_db_service_add_characteristic(struct gatt_db_attribute *attrib,\n\t\t\t\t\tconst bt_uuid_t *uuid,\n\t\t\t\t\tuint32_t permissions,\n\t\t\t\t\tuint8_t properties,\n\t\t\t\t\tgatt_db_read_t read_func,\n\t\t\t\t\tgatt_db_write_t write_func,\n\t\t\t\t\tvoid *user_data)\n{\n\tif (!attrib)\n\t\treturn NULL;\n\n\treturn service_insert_characteristic(attrib->service, 0, uuid,\n\t\t\t\t\t\tpermissions, properties,\n\t\t\t\t\t\tread_func, write_func,\n\t\t\t\t\t\tuser_data);\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstruct gatt_db_attribute *\ngatt_db_service_add_characteristic(struct gatt_db_attribute *attrib,\n\t\t\t\t\tconst bt_uuid_t *uuid,\n\t\t\t\t\tuint32_t permissions,\n\t\t\t\t\tuint8_t properties,\n\t\t\t\t\tgatt_db_read_t read_func,\n\t\t\t\t\tgatt_db_write_t write_func,\n\t\t\t\t\tvoid *user_data)\n{\n\tif (!attrib)\n\t\treturn NULL;\n\n\treturn service_insert_characteristic(attrib->service, 0, uuid,\n\t\t\t\t\t\tpermissions, properties,\n\t\t\t\t\t\tread_func, write_func,\n\t\t\t\t\t\tuser_data);\n}"
        }
      },
      {
        "call_info": {
          "callee": "bt_uuid16_create",
          "args": [
            "&uuid",
            "GATT_CHARAC_APPEARANCE"
          ],
          "line": 838
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bt_uuid16_create",
          "args": [
            "&uuid",
            "GATT_CHARAC_DEVICE_NAME"
          ],
          "line": 829
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "gatt_db_add_service",
          "args": [
            "database->db",
            "&uuid",
            "true",
            "5"
          ],
          "line": 824
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_add_service",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "583-590",
          "snippet": "struct gatt_db_attribute *gatt_db_add_service(struct gatt_db *db,\n\t\t\t\t\t\tconst bt_uuid_t *uuid,\n\t\t\t\t\t\tbool primary,\n\t\t\t\t\t\tuint16_t num_handles)\n{\n\treturn gatt_db_insert_service(db, db->next_handle, uuid, primary,\n\t\t\t\t\t\t\t\tnum_handles);\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstruct gatt_db_attribute *gatt_db_add_service(struct gatt_db *db,\n\t\t\t\t\t\tconst bt_uuid_t *uuid,\n\t\t\t\t\t\tbool primary,\n\t\t\t\t\t\tuint16_t num_handles)\n{\n\treturn gatt_db_insert_service(db, db->next_handle, uuid, primary,\n\t\t\t\t\t\t\t\tnum_handles);\n}"
        }
      },
      {
        "call_info": {
          "callee": "bt_uuid16_create",
          "args": [
            "&uuid",
            "UUID_GAP"
          ],
          "line": 823
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\n#define UUID_GAP\t0x1800\n\nstatic void populate_gap_service(struct btd_gatt_database *database)\n{\n\tbt_uuid_t uuid;\n\tstruct gatt_db_attribute *service;\n\n\t/* Add the GAP service */\n\tbt_uuid16_create(&uuid, UUID_GAP);\n\tservice = gatt_db_add_service(database->db, &uuid, true, 5);\n\n\t/*\n\t * Device Name characteristic.\n\t */\n\tbt_uuid16_create(&uuid, GATT_CHARAC_DEVICE_NAME);\n\tgatt_db_service_add_characteristic(service, &uuid, BT_ATT_PERM_READ,\n\t\t\t\t\t\t\tBT_GATT_CHRC_PROP_READ,\n\t\t\t\t\t\t\tgap_device_name_read_cb,\n\t\t\t\t\t\t\tNULL, database);\n\n\t/*\n\t * Device Appearance characteristic.\n\t */\n\tbt_uuid16_create(&uuid, GATT_CHARAC_APPEARANCE);\n\tgatt_db_service_add_characteristic(service, &uuid, BT_ATT_PERM_READ,\n\t\t\t\t\t\t\tBT_GATT_CHRC_PROP_READ,\n\t\t\t\t\t\t\tgap_appearance_read_cb,\n\t\t\t\t\t\t\tNULL, database);\n\n\tgatt_db_service_set_active(service, true);\n}"
  },
  {
    "function_name": "database_add_record",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
    "lines": "758-815",
    "snippet": "static void database_add_record(struct btd_gatt_database *database,\n\t\t\t\t\tstruct gatt_db_attribute *attr)\n{\n\tstruct gatt_record *rec;\n\tsdp_record_t *record;\n\tuint16_t start, end;\n\tuuid_t svc, gap_uuid;\n\tbt_uuid_t uuid;\n\tconst char *name = NULL;\n\tchar uuidstr[MAX_LEN_UUID_STR];\n\n\tgatt_db_attribute_get_service_uuid(attr, &uuid);\n\n\tswitch (uuid.type) {\n\tcase BT_UUID16:\n\t\tname = bt_uuid16_to_str(uuid.value.u16);\n\t\tsdp_uuid16_create(&svc, uuid.value.u16);\n\t\tbreak;\n\tcase BT_UUID32:\n\t\tname = bt_uuid32_to_str(uuid.value.u32);\n\t\tsdp_uuid32_create(&svc, uuid.value.u32);\n\t\tbreak;\n\tcase BT_UUID128:\n\t\tbt_uuid_to_string(&uuid, uuidstr, sizeof(uuidstr));\n\t\tname = bt_uuidstr_to_str(uuidstr);\n\t\tsdp_uuid128_create(&svc, (void *) &uuid.value.u128);\n\t\tbreak;\n\tcase BT_UUID_UNSPEC:\n\t\treturn;\n\t}\n\n\tgatt_db_attribute_get_service_handles(attr, &start, &end);\n\n\trecord = record_new(&svc, start, end);\n\tif (!record)\n\t\treturn;\n\n\tif (name != NULL)\n\t\tsdp_set_info_attr(record, name, \"BlueZ\", NULL);\n\n\tsdp_uuid16_create(&gap_uuid, UUID_GAP);\n\tif (sdp_uuid_cmp(&svc, &gap_uuid) == 0) {\n\t\tsdp_set_url_attr(record, \"http://www.bluez.org/\",\n\t\t\t\t\"http://www.bluez.org/\",\n\t\t\t\t\"http://www.bluez.org/\");\n\t}\n\n\tif (adapter_service_add(database->adapter, record) < 0) {\n\t\tsdp_record_free(record);\n\t\treturn;\n\t}\n\n\trec = new0(struct gatt_record, 1);\n\trec->database = database;\n\trec->handle = record->handle;\n\trec->attr = attr;\n\tqueue_push_tail(database->records, rec);\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"dbus-common.h\"",
      "#include \"gatt-database.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define UUID_GAP\t0x1800"
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "queue_push_tail",
          "args": [
            "database->records",
            "rec"
          ],
          "line": 814
        },
        "resolved": true,
        "details": {
          "function_name": "queue_push_tail",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "88-108",
          "snippet": "bool queue_push_tail(struct queue *queue, void *data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn false;\n\n\tentry = queue_entry_new(data);\n\n\tif (queue->tail)\n\t\tqueue->tail->next = entry;\n\n\tqueue->tail = entry;\n\n\tif (!queue->head)\n\t\tqueue->head = entry;\n\n\tqueue->entries++;\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nbool queue_push_tail(struct queue *queue, void *data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn false;\n\n\tentry = queue_entry_new(data);\n\n\tif (queue->tail)\n\t\tqueue->tail->next = entry;\n\n\tqueue->tail = entry;\n\n\tif (!queue->head)\n\t\tqueue->head = entry;\n\n\tqueue->entries++;\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "new0",
          "args": [
            "structgatt_record",
            "1"
          ],
          "line": 810
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_record_free",
          "args": [
            "record"
          ],
          "line": 806
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "adapter_service_add",
          "args": [
            "database->adapter",
            "record"
          ],
          "line": 805
        },
        "resolved": true,
        "details": {
          "function_name": "adapter_service_add",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "1129-1142",
          "snippet": "int adapter_service_add(struct btd_adapter *adapter, sdp_record_t *rec)\n{\n\tint ret;\n\n\tDBG(\"%s\", adapter->path);\n\n\tret = add_record_to_server(&adapter->bdaddr, rec);\n\tif (ret < 0)\n\t\treturn ret;\n\n\tadapter_service_insert(adapter, rec);\n\n\treturn 0;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void trigger_pairable_timeout(struct btd_adapter *adapter);",
            "static void adapter_start(struct btd_adapter *adapter);",
            "static void adapter_stop(struct btd_adapter *adapter);",
            "static void trigger_passive_scanning(struct btd_adapter *adapter);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void trigger_pairable_timeout(struct btd_adapter *adapter);\nstatic void adapter_start(struct btd_adapter *adapter);\nstatic void adapter_stop(struct btd_adapter *adapter);\nstatic void trigger_passive_scanning(struct btd_adapter *adapter);\n\nint adapter_service_add(struct btd_adapter *adapter, sdp_record_t *rec)\n{\n\tint ret;\n\n\tDBG(\"%s\", adapter->path);\n\n\tret = add_record_to_server(&adapter->bdaddr, rec);\n\tif (ret < 0)\n\t\treturn ret;\n\n\tadapter_service_insert(adapter, rec);\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "sdp_set_url_attr",
          "args": [
            "record",
            "\"http://www.bluez.org/\"",
            "\"http://www.bluez.org/\"",
            "\"http://www.bluez.org/\""
          ],
          "line": 800
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_uuid_cmp",
          "args": [
            "&svc",
            "&gap_uuid"
          ],
          "line": 799
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_uuid16_create",
          "args": [
            "&gap_uuid",
            "UUID_GAP"
          ],
          "line": 798
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_set_info_attr",
          "args": [
            "record",
            "name",
            "\"BlueZ\"",
            "NULL"
          ],
          "line": 796
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "record_new",
          "args": [
            "&svc",
            "start",
            "end"
          ],
          "line": 791
        },
        "resolved": true,
        "details": {
          "function_name": "record_new",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "703-756",
          "snippet": "static sdp_record_t *record_new(uuid_t *uuid, uint16_t start, uint16_t end)\n{\n\tsdp_list_t *svclass_id, *apseq, *proto[2], *root, *aproto;\n\tuuid_t root_uuid, proto_uuid, l2cap;\n\tsdp_record_t *record;\n\tsdp_data_t *psm, *sh, *eh;\n\tuint16_t lp = ATT_PSM;\n\n\tif (uuid == NULL)\n\t\treturn NULL;\n\n\tif (start > end)\n\t\treturn NULL;\n\n\trecord = sdp_record_alloc();\n\tif (record == NULL)\n\t\treturn NULL;\n\n\tsdp_uuid16_create(&root_uuid, PUBLIC_BROWSE_GROUP);\n\troot = sdp_list_append(NULL, &root_uuid);\n\tsdp_set_browse_groups(record, root);\n\tsdp_list_free(root, NULL);\n\n\tsvclass_id = sdp_list_append(NULL, uuid);\n\tsdp_set_service_classes(record, svclass_id);\n\tsdp_list_free(svclass_id, NULL);\n\n\tsdp_uuid16_create(&l2cap, L2CAP_UUID);\n\tproto[0] = sdp_list_append(NULL, &l2cap);\n\tpsm = sdp_data_alloc(SDP_UINT16, &lp);\n\tproto[0] = sdp_list_append(proto[0], psm);\n\tapseq = sdp_list_append(NULL, proto[0]);\n\n\tsdp_uuid16_create(&proto_uuid, ATT_UUID);\n\tproto[1] = sdp_list_append(NULL, &proto_uuid);\n\tsh = sdp_data_alloc(SDP_UINT16, &start);\n\tproto[1] = sdp_list_append(proto[1], sh);\n\teh = sdp_data_alloc(SDP_UINT16, &end);\n\tproto[1] = sdp_list_append(proto[1], eh);\n\tapseq = sdp_list_append(apseq, proto[1]);\n\n\taproto = sdp_list_append(NULL, apseq);\n\tsdp_set_access_protos(record, aproto);\n\n\tsdp_data_free(psm);\n\tsdp_data_free(sh);\n\tsdp_data_free(eh);\n\tsdp_list_free(proto[0], NULL);\n\tsdp_list_free(proto[1], NULL);\n\tsdp_list_free(apseq, NULL);\n\tsdp_list_free(aproto, NULL);\n\n\treturn record;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define ATT_PSM 31"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\n#define ATT_PSM 31\n\nstatic sdp_record_t *record_new(uuid_t *uuid, uint16_t start, uint16_t end)\n{\n\tsdp_list_t *svclass_id, *apseq, *proto[2], *root, *aproto;\n\tuuid_t root_uuid, proto_uuid, l2cap;\n\tsdp_record_t *record;\n\tsdp_data_t *psm, *sh, *eh;\n\tuint16_t lp = ATT_PSM;\n\n\tif (uuid == NULL)\n\t\treturn NULL;\n\n\tif (start > end)\n\t\treturn NULL;\n\n\trecord = sdp_record_alloc();\n\tif (record == NULL)\n\t\treturn NULL;\n\n\tsdp_uuid16_create(&root_uuid, PUBLIC_BROWSE_GROUP);\n\troot = sdp_list_append(NULL, &root_uuid);\n\tsdp_set_browse_groups(record, root);\n\tsdp_list_free(root, NULL);\n\n\tsvclass_id = sdp_list_append(NULL, uuid);\n\tsdp_set_service_classes(record, svclass_id);\n\tsdp_list_free(svclass_id, NULL);\n\n\tsdp_uuid16_create(&l2cap, L2CAP_UUID);\n\tproto[0] = sdp_list_append(NULL, &l2cap);\n\tpsm = sdp_data_alloc(SDP_UINT16, &lp);\n\tproto[0] = sdp_list_append(proto[0], psm);\n\tapseq = sdp_list_append(NULL, proto[0]);\n\n\tsdp_uuid16_create(&proto_uuid, ATT_UUID);\n\tproto[1] = sdp_list_append(NULL, &proto_uuid);\n\tsh = sdp_data_alloc(SDP_UINT16, &start);\n\tproto[1] = sdp_list_append(proto[1], sh);\n\teh = sdp_data_alloc(SDP_UINT16, &end);\n\tproto[1] = sdp_list_append(proto[1], eh);\n\tapseq = sdp_list_append(apseq, proto[1]);\n\n\taproto = sdp_list_append(NULL, apseq);\n\tsdp_set_access_protos(record, aproto);\n\n\tsdp_data_free(psm);\n\tsdp_data_free(sh);\n\tsdp_data_free(eh);\n\tsdp_list_free(proto[0], NULL);\n\tsdp_list_free(proto[1], NULL);\n\tsdp_list_free(apseq, NULL);\n\tsdp_list_free(aproto, NULL);\n\n\treturn record;\n}"
        }
      },
      {
        "call_info": {
          "callee": "gatt_db_attribute_get_service_handles",
          "args": [
            "attr",
            "&start",
            "&end"
          ],
          "line": 789
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_attribute_get_service_handles",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "1521-1536",
          "snippet": "bool gatt_db_attribute_get_service_handles(\n\t\t\t\t\tconst struct gatt_db_attribute *attrib,\n\t\t\t\t\tuint16_t *start_handle,\n\t\t\t\t\tuint16_t *end_handle)\n{\n\tstruct gatt_db_service *service;\n\n\tif (!attrib)\n\t\treturn false;\n\n\tservice = attrib->service;\n\n\tgatt_db_service_get_handles(service, start_handle, end_handle);\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nbool gatt_db_attribute_get_service_handles(\n\t\t\t\t\tconst struct gatt_db_attribute *attrib,\n\t\t\t\t\tuint16_t *start_handle,\n\t\t\t\t\tuint16_t *end_handle)\n{\n\tstruct gatt_db_service *service;\n\n\tif (!attrib)\n\t\treturn false;\n\n\tservice = attrib->service;\n\n\tgatt_db_service_get_handles(service, start_handle, end_handle);\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "sdp_uuid128_create",
          "args": [
            "&svc",
            "(void *) &uuid.value.u128"
          ],
          "line": 783
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bt_uuidstr_to_str",
          "args": [
            "uuidstr"
          ],
          "line": 782
        },
        "resolved": true,
        "details": {
          "function_name": "bt_uuidstr_to_str",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/util.c",
          "lines": "857-896",
          "snippet": "const char *bt_uuidstr_to_str(const char *uuid)\n{\n\tuint32_t val;\n\tsize_t len;\n\tint i;\n\n\tif (!uuid)\n\t\treturn NULL;\n\n\tlen = strlen(uuid);\n\n\tif (len < 36) {\n\t\tchar *endptr = NULL;\n\n\t\tval = strtol(uuid, &endptr, 0);\n\t\tif (!endptr || *endptr != '\\0')\n\t\t\treturn NULL;\n\n\t\tif (val > UINT16_MAX)\n\t\t\treturn bt_uuid32_to_str(val);\n\n\t\treturn bt_uuid16_to_str(val);\n\t}\n\n\tif (len != 36)\n\t\treturn NULL;\n\n\tfor (i = 0; uuid128_table[i].str; i++) {\n\t\tif (strcasecmp(uuid128_table[i].uuid, uuid) == 0)\n\t\t\treturn uuid128_table[i].str;\n\t}\n\n\tif (strncasecmp(uuid + 8, \"-0000-1000-8000-00805f9b34fb\", 28))\n\t\treturn \"Vendor specific\";\n\n\tif (sscanf(uuid, \"%08x-0000-1000-8000-00805f9b34fb\", &val) != 1)\n\t\treturn NULL;\n\n\treturn bt_uuid32_to_str(val);\n}",
          "includes": [
            "#include \"src/shared/util.h\"",
            "#include <string.h>",
            "#include <limits.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <stdbool.h>",
            "#include <stdarg.h>",
            "#include <ctype.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static const struct {\n\tconst char *uuid;\n\tconst char *str;\n} uuid128_table[] = {\n\t{ \"a3c87500-8ed3-4bdf-8a39-a01bebede295\",\n\t\t\"Eddystone Configuration Service\"\t\t\t},\n\t{ \"a3c87501-8ed3-4bdf-8a39-a01bebede295\", \"Capabilities\"\t},\n\t{ \"a3c87502-8ed3-4bdf-8a39-a01bebede295\", \"Active Slot\"\t\t},\n\t{ \"a3c87503-8ed3-4bdf-8a39-a01bebede295\",\n\t\t\"Advertising Interval\"\t\t\t\t\t},\n\t{ \"a3c87504-8ed3-4bdf-8a39-a01bebede295\", \"Radio Tx Power\"\t},\n\t{ \"a3c87505-8ed3-4bdf-8a39-a01bebede295\",\n\t\t\"(Advanced) Advertised Tx Power\"\t\t\t},\n\t{ \"a3c87506-8ed3-4bdf-8a39-a01bebede295\", \"Lock State\"\t\t},\n\t{ \"a3c87507-8ed3-4bdf-8a39-a01bebede295\", \"Unlock\"\t\t},\n\t{ \"a3c87508-8ed3-4bdf-8a39-a01bebede295\", \"Public ECDH Key\"\t},\n\t{ \"a3c87509-8ed3-4bdf-8a39-a01bebede295\", \"EID Identity Key\"\t},\n\t{ \"a3c8750a-8ed3-4bdf-8a39-a01bebede295\", \"ADV Slot Data\"\t},\n\t{ \"a3c8750b-8ed3-4bdf-8a39-a01bebede295\",\n\t\t\"(Advanced) Factory reset\"\t\t\t\t},\n\t{ \"a3c8750c-8ed3-4bdf-8a39-a01bebede295\",\n\t\t\"(Advanced) Remain Connectable\"\t\t\t\t},\n\t/* BBC micro:bit Bluetooth Profiles */\n\t{ \"e95d0753-251d-470a-a062-fa1922dfa9a8\",\n\t\t\"MicroBit Accelerometer Service\"\t\t\t},\n\t{ \"e95dca4b-251d-470a-a062-fa1922dfa9a8\",\n\t\t\"MicroBit Accelerometer Data\"\t\t\t\t},\n\t{ \"e95dfb24-251d-470a-a062-fa1922dfa9a8\",\n\t\t\"MicroBit Accelerometer Period\"\t\t\t\t},\n\t{ \"e95df2d8-251d-470a-a062-fa1922dfa9a8\",\n\t\t\"MicroBit Magnetometer Service\"\t\t\t\t},\n\t{ \"e95dfb11-251d-470a-a062-fa1922dfa9a8\",\n\t\t\"MicroBit Magnetometer Data\"\t\t\t\t},\n\t{ \"e95d386c-251d-470a-a062-fa1922dfa9a8\",\n\t\t\"MicroBit Magnetometer Period\"\t\t\t\t},\n\t{ \"e95d9715-251d-470a-a062-fa1922dfa9a8\",\n\t\t\"MicroBit Magnetometer Bearing\"\t\t\t\t},\n\t{ \"e95d9882-251d-470a-a062-fa1922dfa9a8\",\n\t\t\"MicroBit Button Service\"\t\t\t\t},\n\t{ \"e95dda90-251d-470a-a062-fa1922dfa9a8\",\n\t\t\"MicroBit Button A State\"\t\t\t\t},\n\t{ \"e95dda91-251d-470a-a062-fa1922dfa9a8\",\n\t\t\"MicroBit Button B State\"\t\t\t\t},\n\t{ \"e95d127b-251d-470a-a062-fa1922dfa9a8\",\n\t\t\"MicroBit IO PIN Service\"\t\t\t\t},\n\t{ \"e95d8d00-251d-470a-a062-fa1922dfa9a8\", \"MicroBit PIN Data\"\t},\n\t{ \"e95d5899-251d-470a-a062-fa1922dfa9a8\",\n\t\t\"MicroBit PIN AD Configuration\"\t\t\t\t},\n\t{ \"e95dd822-251d-470a-a062-fa1922dfa9a8\", \"MicroBit PWM Control\" },\n\t{ \"e95dd91d-251d-470a-a062-fa1922dfa9a8\", \"MicroBit LED Service\" },\n\t{ \"e95d7b77-251d-470a-a062-fa1922dfa9a8\", \"MicroBit LED Matrix state\" },\n\t{ \"e95d93ee-251d-470a-a062-fa1922dfa9a8\", \"MicroBit LED Text\"\t},\n\t{ \"e95d0d2d-251d-470a-a062-fa1922dfa9a8\", \"MicroBit Scrolling Delay\" },\n\t{ \"e95d93af-251d-470a-a062-fa1922dfa9a8\", \"MicroBit Event Service\" },\n\t{ \"e95db84c-251d-470a-a062-fa1922dfa9a8\", \"MicroBit Requirements\" },\n\t{ \"e95d9775-251d-470a-a062-fa1922dfa9a8\", \"MicroBit Event Data\" },\n\t{ \"e95d23c4-251d-470a-a062-fa1922dfa9a8\",\n\t\t\"MicroBit Client Requirements\"\t\t\t\t},\n\t{ \"e95d5404-251d-470a-a062-fa1922dfa9a8\", \"MicroBit Client Events\" },\n\t{ \"e95d93b0-251d-470a-a062-fa1922dfa9a8\",\n\t\t\"MicroBit DFU Control Service\"\t\t\t\t},\n\t{ \"e95d93b1-251d-470a-a062-fa1922dfa9a8\", \"MicroBit DFU Control\" },\n\t{ \"e95d6100-251d-470a-a062-fa1922dfa9a8\",\n\t\t\"MicroBit Temperature Service\"\t\t\t\t},\n\t{ \"e95d1b25-251d-470a-a062-fa1922dfa9a8\",\n\t\t\"MicroBit Temperature Period\"\t\t\t\t},\n\t/* Nordic UART Port Emulation */\n\t{ \"6e400001-b5a3-f393-e0a9-e50e24dcca9e\", \"Nordic UART Service\" },\n\t{ \"6e400002-b5a3-f393-e0a9-e50e24dcca9e\", \"Nordic UART TX\"\t},\n\t{ \"6e400003-b5a3-f393-e0a9-e50e24dcca9e\", \"Nordic UART RX\"\t},\n\t{ }\n};"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/util.h\"\n#include <string.h>\n#include <limits.h>\n#include <dirent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic const struct {\n\tconst char *uuid;\n\tconst char *str;\n} uuid128_table[] = {\n\t{ \"a3c87500-8ed3-4bdf-8a39-a01bebede295\",\n\t\t\"Eddystone Configuration Service\"\t\t\t},\n\t{ \"a3c87501-8ed3-4bdf-8a39-a01bebede295\", \"Capabilities\"\t},\n\t{ \"a3c87502-8ed3-4bdf-8a39-a01bebede295\", \"Active Slot\"\t\t},\n\t{ \"a3c87503-8ed3-4bdf-8a39-a01bebede295\",\n\t\t\"Advertising Interval\"\t\t\t\t\t},\n\t{ \"a3c87504-8ed3-4bdf-8a39-a01bebede295\", \"Radio Tx Power\"\t},\n\t{ \"a3c87505-8ed3-4bdf-8a39-a01bebede295\",\n\t\t\"(Advanced) Advertised Tx Power\"\t\t\t},\n\t{ \"a3c87506-8ed3-4bdf-8a39-a01bebede295\", \"Lock State\"\t\t},\n\t{ \"a3c87507-8ed3-4bdf-8a39-a01bebede295\", \"Unlock\"\t\t},\n\t{ \"a3c87508-8ed3-4bdf-8a39-a01bebede295\", \"Public ECDH Key\"\t},\n\t{ \"a3c87509-8ed3-4bdf-8a39-a01bebede295\", \"EID Identity Key\"\t},\n\t{ \"a3c8750a-8ed3-4bdf-8a39-a01bebede295\", \"ADV Slot Data\"\t},\n\t{ \"a3c8750b-8ed3-4bdf-8a39-a01bebede295\",\n\t\t\"(Advanced) Factory reset\"\t\t\t\t},\n\t{ \"a3c8750c-8ed3-4bdf-8a39-a01bebede295\",\n\t\t\"(Advanced) Remain Connectable\"\t\t\t\t},\n\t/* BBC micro:bit Bluetooth Profiles */\n\t{ \"e95d0753-251d-470a-a062-fa1922dfa9a8\",\n\t\t\"MicroBit Accelerometer Service\"\t\t\t},\n\t{ \"e95dca4b-251d-470a-a062-fa1922dfa9a8\",\n\t\t\"MicroBit Accelerometer Data\"\t\t\t\t},\n\t{ \"e95dfb24-251d-470a-a062-fa1922dfa9a8\",\n\t\t\"MicroBit Accelerometer Period\"\t\t\t\t},\n\t{ \"e95df2d8-251d-470a-a062-fa1922dfa9a8\",\n\t\t\"MicroBit Magnetometer Service\"\t\t\t\t},\n\t{ \"e95dfb11-251d-470a-a062-fa1922dfa9a8\",\n\t\t\"MicroBit Magnetometer Data\"\t\t\t\t},\n\t{ \"e95d386c-251d-470a-a062-fa1922dfa9a8\",\n\t\t\"MicroBit Magnetometer Period\"\t\t\t\t},\n\t{ \"e95d9715-251d-470a-a062-fa1922dfa9a8\",\n\t\t\"MicroBit Magnetometer Bearing\"\t\t\t\t},\n\t{ \"e95d9882-251d-470a-a062-fa1922dfa9a8\",\n\t\t\"MicroBit Button Service\"\t\t\t\t},\n\t{ \"e95dda90-251d-470a-a062-fa1922dfa9a8\",\n\t\t\"MicroBit Button A State\"\t\t\t\t},\n\t{ \"e95dda91-251d-470a-a062-fa1922dfa9a8\",\n\t\t\"MicroBit Button B State\"\t\t\t\t},\n\t{ \"e95d127b-251d-470a-a062-fa1922dfa9a8\",\n\t\t\"MicroBit IO PIN Service\"\t\t\t\t},\n\t{ \"e95d8d00-251d-470a-a062-fa1922dfa9a8\", \"MicroBit PIN Data\"\t},\n\t{ \"e95d5899-251d-470a-a062-fa1922dfa9a8\",\n\t\t\"MicroBit PIN AD Configuration\"\t\t\t\t},\n\t{ \"e95dd822-251d-470a-a062-fa1922dfa9a8\", \"MicroBit PWM Control\" },\n\t{ \"e95dd91d-251d-470a-a062-fa1922dfa9a8\", \"MicroBit LED Service\" },\n\t{ \"e95d7b77-251d-470a-a062-fa1922dfa9a8\", \"MicroBit LED Matrix state\" },\n\t{ \"e95d93ee-251d-470a-a062-fa1922dfa9a8\", \"MicroBit LED Text\"\t},\n\t{ \"e95d0d2d-251d-470a-a062-fa1922dfa9a8\", \"MicroBit Scrolling Delay\" },\n\t{ \"e95d93af-251d-470a-a062-fa1922dfa9a8\", \"MicroBit Event Service\" },\n\t{ \"e95db84c-251d-470a-a062-fa1922dfa9a8\", \"MicroBit Requirements\" },\n\t{ \"e95d9775-251d-470a-a062-fa1922dfa9a8\", \"MicroBit Event Data\" },\n\t{ \"e95d23c4-251d-470a-a062-fa1922dfa9a8\",\n\t\t\"MicroBit Client Requirements\"\t\t\t\t},\n\t{ \"e95d5404-251d-470a-a062-fa1922dfa9a8\", \"MicroBit Client Events\" },\n\t{ \"e95d93b0-251d-470a-a062-fa1922dfa9a8\",\n\t\t\"MicroBit DFU Control Service\"\t\t\t\t},\n\t{ \"e95d93b1-251d-470a-a062-fa1922dfa9a8\", \"MicroBit DFU Control\" },\n\t{ \"e95d6100-251d-470a-a062-fa1922dfa9a8\",\n\t\t\"MicroBit Temperature Service\"\t\t\t\t},\n\t{ \"e95d1b25-251d-470a-a062-fa1922dfa9a8\",\n\t\t\"MicroBit Temperature Period\"\t\t\t\t},\n\t/* Nordic UART Port Emulation */\n\t{ \"6e400001-b5a3-f393-e0a9-e50e24dcca9e\", \"Nordic UART Service\" },\n\t{ \"6e400002-b5a3-f393-e0a9-e50e24dcca9e\", \"Nordic UART TX\"\t},\n\t{ \"6e400003-b5a3-f393-e0a9-e50e24dcca9e\", \"Nordic UART RX\"\t},\n\t{ }\n};\n\nconst char *bt_uuidstr_to_str(const char *uuid)\n{\n\tuint32_t val;\n\tsize_t len;\n\tint i;\n\n\tif (!uuid)\n\t\treturn NULL;\n\n\tlen = strlen(uuid);\n\n\tif (len < 36) {\n\t\tchar *endptr = NULL;\n\n\t\tval = strtol(uuid, &endptr, 0);\n\t\tif (!endptr || *endptr != '\\0')\n\t\t\treturn NULL;\n\n\t\tif (val > UINT16_MAX)\n\t\t\treturn bt_uuid32_to_str(val);\n\n\t\treturn bt_uuid16_to_str(val);\n\t}\n\n\tif (len != 36)\n\t\treturn NULL;\n\n\tfor (i = 0; uuid128_table[i].str; i++) {\n\t\tif (strcasecmp(uuid128_table[i].uuid, uuid) == 0)\n\t\t\treturn uuid128_table[i].str;\n\t}\n\n\tif (strncasecmp(uuid + 8, \"-0000-1000-8000-00805f9b34fb\", 28))\n\t\treturn \"Vendor specific\";\n\n\tif (sscanf(uuid, \"%08x-0000-1000-8000-00805f9b34fb\", &val) != 1)\n\t\treturn NULL;\n\n\treturn bt_uuid32_to_str(val);\n}"
        }
      },
      {
        "call_info": {
          "callee": "bt_uuid_to_string",
          "args": [
            "&uuid",
            "uuidstr",
            "sizeof(uuidstr)"
          ],
          "line": 781
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_uuid32_create",
          "args": [
            "&svc",
            "uuid.value.u32"
          ],
          "line": 778
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bt_uuid32_to_str",
          "args": [
            "uuid.value.u32"
          ],
          "line": 777
        },
        "resolved": true,
        "details": {
          "function_name": "bt_uuid32_to_str",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/util.c",
          "lines": "849-855",
          "snippet": "const char *bt_uuid32_to_str(uint32_t uuid)\n{\n\tif ((uuid & 0xffff0000) == 0x0000)\n\t\treturn bt_uuid16_to_str(uuid & 0x0000ffff);\n\n\treturn \"Unknown\";\n}",
          "includes": [
            "#include \"src/shared/util.h\"",
            "#include <string.h>",
            "#include <limits.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <stdbool.h>",
            "#include <stdarg.h>",
            "#include <ctype.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/util.h\"\n#include <string.h>\n#include <limits.h>\n#include <dirent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <config.h>\n\nconst char *bt_uuid32_to_str(uint32_t uuid)\n{\n\tif ((uuid & 0xffff0000) == 0x0000)\n\t\treturn bt_uuid16_to_str(uuid & 0x0000ffff);\n\n\treturn \"Unknown\";\n}"
        }
      },
      {
        "call_info": {
          "callee": "sdp_uuid16_create",
          "args": [
            "&svc",
            "uuid.value.u16"
          ],
          "line": 774
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bt_uuid16_to_str",
          "args": [
            "uuid.value.u16"
          ],
          "line": 773
        },
        "resolved": true,
        "details": {
          "function_name": "bt_uuid16_to_str",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/util.c",
          "lines": "837-847",
          "snippet": "const char *bt_uuid16_to_str(uint16_t uuid)\n{\n\tint i;\n\n\tfor (i = 0; uuid16_table[i].str; i++) {\n\t\tif (uuid16_table[i].uuid == uuid)\n\t\t\treturn uuid16_table[i].str;\n\t}\n\n\treturn \"Unknown\";\n}",
          "includes": [
            "#include \"src/shared/util.h\"",
            "#include <string.h>",
            "#include <limits.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <stdbool.h>",
            "#include <stdarg.h>",
            "#include <ctype.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static const struct {\n\tuint16_t uuid;\n\tconst char *str;\n} uuid16_table[] = {\n\t{ 0x0001, \"SDP\"\t\t\t\t\t\t},\n\t{ 0x0003, \"RFCOMM\"\t\t\t\t\t},\n\t{ 0x0005, \"TCS-BIN\"\t\t\t\t\t},\n\t{ 0x0007, \"ATT\"\t\t\t\t\t\t},\n\t{ 0x0008, \"OBEX\"\t\t\t\t\t},\n\t{ 0x000f, \"BNEP\"\t\t\t\t\t},\n\t{ 0x0010, \"UPNP\"\t\t\t\t\t},\n\t{ 0x0011, \"HIDP\"\t\t\t\t\t},\n\t{ 0x0012, \"Hardcopy Control Channel\"\t\t\t},\n\t{ 0x0014, \"Hardcopy Data Channel\"\t\t\t},\n\t{ 0x0016, \"Hardcopy Notification\"\t\t\t},\n\t{ 0x0017, \"AVCTP\"\t\t\t\t\t},\n\t{ 0x0019, \"AVDTP\"\t\t\t\t\t},\n\t{ 0x001b, \"CMTP\"\t\t\t\t\t},\n\t{ 0x001e, \"MCAP Control Channel\"\t\t\t},\n\t{ 0x001f, \"MCAP Data Channel\"\t\t\t\t},\n\t{ 0x0100, \"L2CAP\"\t\t\t\t\t},\n\t/* 0x0101 to 0x0fff undefined */\n\t{ 0x1000, \"Service Discovery Server Service Class\"\t},\n\t{ 0x1001, \"Browse Group Descriptor Service Class\"\t},\n\t{ 0x1002, \"Public Browse Root\"\t\t\t\t},\n\t/* 0x1003 to 0x1100 undefined */\n\t{ 0x1101, \"Serial Port\"\t\t\t\t\t},\n\t{ 0x1102, \"LAN Access Using PPP\"\t\t\t},\n\t{ 0x1103, \"Dialup Networking\"\t\t\t\t},\n\t{ 0x1104, \"IrMC Sync\"\t\t\t\t\t},\n\t{ 0x1105, \"OBEX Object Push\"\t\t\t\t},\n\t{ 0x1106, \"OBEX File Transfer\"\t\t\t\t},\n\t{ 0x1107, \"IrMC Sync Command\"\t\t\t\t},\n\t{ 0x1108, \"Headset\"\t\t\t\t\t},\n\t{ 0x1109, \"Cordless Telephony\"\t\t\t\t},\n\t{ 0x110a, \"Audio Source\"\t\t\t\t},\n\t{ 0x110b, \"Audio Sink\"\t\t\t\t\t},\n\t{ 0x110c, \"A/V Remote Control Target\"\t\t\t},\n\t{ 0x110d, \"Advanced Audio Distribution\"\t\t\t},\n\t{ 0x110e, \"A/V Remote Control\"\t\t\t\t},\n\t{ 0x110f, \"A/V Remote Control Controller\"\t\t},\n\t{ 0x1110, \"Intercom\"\t\t\t\t\t},\n\t{ 0x1111, \"Fax\"\t\t\t\t\t\t},\n\t{ 0x1112, \"Headset AG\"\t\t\t\t\t},\n\t{ 0x1113, \"WAP\"\t\t\t\t\t\t},\n\t{ 0x1114, \"WAP Client\"\t\t\t\t\t},\n\t{ 0x1115, \"PANU\"\t\t\t\t\t},\n\t{ 0x1116, \"NAP\"\t\t\t\t\t\t},\n\t{ 0x1117, \"GN\"\t\t\t\t\t\t},\n\t{ 0x1118, \"Direct Printing\"\t\t\t\t},\n\t{ 0x1119, \"Reference Printing\"\t\t\t\t},\n\t{ 0x111a, \"Basic Imaging Profile\"\t\t\t},\n\t{ 0x111b, \"Imaging Responder\"\t\t\t\t},\n\t{ 0x111c, \"Imaging Automatic Archive\"\t\t\t},\n\t{ 0x111d, \"Imaging Referenced Objects\"\t\t\t},\n\t{ 0x111e, \"Handsfree\"\t\t\t\t\t},\n\t{ 0x111f, \"Handsfree Audio Gateway\"\t\t\t},\n\t{ 0x1120, \"Direct Printing Refrence Objects Service\"\t},\n\t{ 0x1121, \"Reflected UI\"\t\t\t\t},\n\t{ 0x1122, \"Basic Printing\"\t\t\t\t},\n\t{ 0x1123, \"Printing Status\"\t\t\t\t},\n\t{ 0x1124, \"Human Interface Device Service\"\t\t},\n\t{ 0x1125, \"Hardcopy Cable Replacement\"\t\t\t},\n\t{ 0x1126, \"HCR Print\"\t\t\t\t\t},\n\t{ 0x1127, \"HCR Scan\"\t\t\t\t\t},\n\t{ 0x1128, \"Common ISDN Access\"\t\t\t\t},\n\t/* 0x1129 and 0x112a undefined */\n\t{ 0x112d, \"SIM Access\"\t\t\t\t\t},\n\t{ 0x112e, \"Phonebook Access Client\"\t\t\t},\n\t{ 0x112f, \"Phonebook Access Server\"\t\t\t},\n\t{ 0x1130, \"Phonebook Access\"\t\t\t\t},\n\t{ 0x1131, \"Headset HS\"\t\t\t\t\t},\n\t{ 0x1132, \"Message Access Server\"\t\t\t},\n\t{ 0x1133, \"Message Notification Server\"\t\t\t},\n\t{ 0x1134, \"Message Access Profile\"\t\t\t},\n\t{ 0x1135, \"GNSS\"\t\t\t\t\t},\n\t{ 0x1136, \"GNSS Server\"\t\t\t\t\t},\n\t{ 0x1137, \"3D Display\"\t\t\t\t\t},\n\t{ 0x1138, \"3D Glasses\"\t\t\t\t\t},\n\t{ 0x1139, \"3D Synchronization\"\t\t\t\t},\n\t{ 0x113a, \"MPS Profile\"\t\t\t\t\t},\n\t{ 0x113b, \"MPS Service\"\t\t\t\t\t},\n\t/* 0x113c to 0x11ff undefined */\n\t{ 0x1200, \"PnP Information\"\t\t\t\t},\n\t{ 0x1201, \"Generic Networking\"\t\t\t\t},\n\t{ 0x1202, \"Generic File Transfer\"\t\t\t},\n\t{ 0x1203, \"Generic Audio\"\t\t\t\t},\n\t{ 0x1204, \"Generic Telephony\"\t\t\t\t},\n\t{ 0x1205, \"UPNP Service\"\t\t\t\t},\n\t{ 0x1206, \"UPNP IP Service\"\t\t\t\t},\n\t{ 0x1300, \"UPNP IP PAN\"\t\t\t\t\t},\n\t{ 0x1301, \"UPNP IP LAP\"\t\t\t\t\t},\n\t{ 0x1302, \"UPNP IP L2CAP\"\t\t\t\t},\n\t{ 0x1303, \"Video Source\"\t\t\t\t},\n\t{ 0x1304, \"Video Sink\"\t\t\t\t\t},\n\t{ 0x1305, \"Video Distribution\"\t\t\t\t},\n\t/* 0x1306 to 0x13ff undefined */\n\t{ 0x1400, \"HDP\"\t\t\t\t\t\t},\n\t{ 0x1401, \"HDP Source\"\t\t\t\t\t},\n\t{ 0x1402, \"HDP Sink\"\t\t\t\t\t},\n\t/* 0x1403 to 0x17ff undefined */\n\t{ 0x1800, \"Generic Access Profile\"\t\t\t},\n\t{ 0x1801, \"Generic Attribute Profile\"\t\t\t},\n\t{ 0x1802, \"Immediate Alert\"\t\t\t\t},\n\t{ 0x1803, \"Link Loss\"\t\t\t\t\t},\n\t{ 0x1804, \"Tx Power\"\t\t\t\t\t},\n\t{ 0x1805, \"Current Time Service\"\t\t\t},\n\t{ 0x1806, \"Reference Time Update Service\"\t\t},\n\t{ 0x1807, \"Next DST Change Service\"\t\t\t},\n\t{ 0x1808, \"Glucose\"\t\t\t\t\t},\n\t{ 0x1809, \"Health Thermometer\"\t\t\t\t},\n\t{ 0x180a, \"Device Information\"\t\t\t\t},\n\t/* 0x180b and 0x180c undefined */\n\t{ 0x180d, \"Heart Rate\"\t\t\t\t\t},\n\t{ 0x180e, \"Phone Alert Status Service\"\t\t\t},\n\t{ 0x180f, \"Battery Service\"\t\t\t\t},\n\t{ 0x1810, \"Blood Pressure\"\t\t\t\t},\n\t{ 0x1811, \"Alert Notification Service\"\t\t\t},\n\t{ 0x1812, \"Human Interface Device\"\t\t\t},\n\t{ 0x1813, \"Scan Parameters\"\t\t\t\t},\n\t{ 0x1814, \"Running Speed and Cadence\"\t\t\t},\n\t{ 0x1815, \"Automation IO\"\t\t\t\t},\n\t{ 0x1816, \"Cycling Speed and Cadence\"\t\t\t},\n\t/* 0x1817 undefined */\n\t{ 0x1818, \"Cycling Power\"\t\t\t\t},\n\t{ 0x1819, \"Location and Navigation\"\t\t\t},\n\t{ 0x181a, \"Environmental Sensing\"\t\t\t},\n\t{ 0x181b, \"Body Composition\"\t\t\t\t},\n\t{ 0x181c, \"User Data\"\t\t\t\t\t},\n\t{ 0x181d, \"Weight Scale\"\t\t\t\t},\n\t{ 0x181e, \"Bond Management\"\t\t\t\t},\n\t{ 0x181f, \"Continuous Glucose Monitoring\"\t\t},\n\t{ 0x1820, \"Internet Protocol Support\"\t\t\t},\n\t{ 0x1821, \"Indoor Positioning\"\t\t\t\t},\n\t{ 0x1822, \"Pulse Oximeter\"\t\t\t\t},\n\t{ 0x1823, \"HTTP Proxy\"\t\t\t\t\t},\n\t{ 0x1824, \"Transport Discovery\"\t\t\t\t},\n\t{ 0x1825, \"Object Transfer\"\t\t\t\t},\n\t{ 0x1826, \"Fitness Machine\"\t\t\t\t},\n\t{ 0x1827, \"Mesh Provisioning\"\t\t\t\t},\n\t{ 0x1828, \"Mesh Proxy\"\t\t\t\t\t},\n\t/* 0x1829 to 0x27ff undefined */\n\t{ 0x2800, \"Primary Service\"\t\t\t\t},\n\t{ 0x2801, \"Secondary Service\"\t\t\t\t},\n\t{ 0x2802, \"Include\"\t\t\t\t\t},\n\t{ 0x2803, \"Characteristic\"\t\t\t\t},\n\t/* 0x2804 to 0x28ff undefined */\n\t{ 0x2900, \"Characteristic Extended Properties\"\t\t},\n\t{ 0x2901, \"Characteristic User Description\"\t\t},\n\t{ 0x2902, \"Client Characteristic Configuration\"\t\t},\n\t{ 0x2903, \"Server Characteristic Configuration\"\t\t},\n\t{ 0x2904, \"Characteristic Format\"\t\t\t},\n\t{ 0x2905, \"Characteristic Aggregate Formate\"\t\t},\n\t{ 0x2906, \"Valid Range\"\t\t\t\t\t},\n\t{ 0x2907, \"External Report Reference\"\t\t\t},\n\t{ 0x2908, \"Report Reference\"\t\t\t\t},\n\t{ 0x2909, \"Number of Digitals\"\t\t\t\t},\n\t{ 0x290a, \"Value Trigger Setting\"\t\t\t},\n\t{ 0x290b, \"Environmental Sensing Configuration\"\t\t},\n\t{ 0x290c, \"Environmental Sensing Measurement\"\t\t},\n\t{ 0x290d, \"Environmental Sensing Trigger Setting\"\t},\n\t{ 0x290e, \"Time Trigger Setting\"\t\t\t},\n\t/* 0x290f to 0x29ff undefined */\n\t{ 0x2a00, \"Device Name\"\t\t\t\t\t},\n\t{ 0x2a01, \"Appearance\"\t\t\t\t\t},\n\t{ 0x2a02, \"Peripheral Privacy Flag\"\t\t\t},\n\t{ 0x2a03, \"Reconnection Address\"\t\t\t},\n\t{ 0x2a04, \"Peripheral Preferred Connection Parameters\"\t},\n\t{ 0x2a05, \"Service Changed\"\t\t\t\t},\n\t{ 0x2a06, \"Alert Level\"\t\t\t\t\t},\n\t{ 0x2a07, \"Tx Power Level\"\t\t\t\t},\n\t{ 0x2a08, \"Date Time\"\t\t\t\t\t},\n\t{ 0x2a09, \"Day of Week\"\t\t\t\t\t},\n\t{ 0x2a0a, \"Day Date Time\"\t\t\t\t},\n\t/* 0x2a0b undefined */\n\t{ 0x2a0c, \"Exact Time 256\"\t\t\t\t},\n\t{ 0x2a0d, \"DST Offset\"\t\t\t\t\t},\n\t{ 0x2a0e, \"Time Zone\"\t\t\t\t\t},\n\t{ 0x2a0f, \"Local Time Information\"\t\t\t},\n\t/* 0x2a10 undefined */\n\t{ 0x2a11, \"Time with DST\"\t\t\t\t},\n\t{ 0x2a12, \"Time Accuracy\"\t\t\t\t},\n\t{ 0x2a13, \"Time Source\"\t\t\t\t\t},\n\t{ 0x2a14, \"Reference Time Information\"\t\t\t},\n\t/* 0x2a15 undefined */\n\t{ 0x2a16, \"Time Update Control Point\"\t\t\t},\n\t{ 0x2a17, \"Time Update State\"\t\t\t\t},\n\t{ 0x2a18, \"Glucose Measurement\"\t\t\t\t},\n\t{ 0x2a19, \"Battery Level\"\t\t\t\t},\n\t/* 0x2a1a and 0x2a1b undefined */\n\t{ 0x2a1c, \"Temperature Measurement\"\t\t\t},\n\t{ 0x2a1d, \"Temperature Type\"\t\t\t\t},\n\t{ 0x2a1e, \"Intermediate Temperature\"\t\t\t},\n\t/* 0x2a1f and 0x2a20 undefined */\n\t{ 0x2a21, \"Measurement Interval\"\t\t\t},\n\t{ 0x2a22, \"Boot Keyboard Input Report\"\t\t\t},\n\t{ 0x2a23, \"System ID\"\t\t\t\t\t},\n\t{ 0x2a24, \"Model Number String\"\t\t\t\t},\n\t{ 0x2a25, \"Serial Number String\"\t\t\t},\n\t{ 0x2a26, \"Firmware Revision String\"\t\t\t},\n\t{ 0x2a27, \"Hardware Revision String\"\t\t\t},\n\t{ 0x2a28, \"Software Revision String\"\t\t\t},\n\t{ 0x2a29, \"Manufacturer Name String\"\t\t\t},\n\t{ 0x2a2a, \"IEEE 11073-20601 Regulatory Cert. Data List\"\t},\n\t{ 0x2a2b, \"Current Time\"\t\t\t\t},\n\t{ 0x2a2c, \"Magnetic Declination\"\t\t\t},\n\t/* 0x2a2d to 0x2a30 undefined */\n\t{ 0x2a31, \"Scan Refresh\"\t\t\t\t},\n\t{ 0x2a32, \"Boot Keyboard Output Report\"\t\t\t},\n\t{ 0x2a33, \"Boot Mouse Input Report\"\t\t\t},\n\t{ 0x2a34, \"Glucose Measurement Context\"\t\t\t},\n\t{ 0x2a35, \"Blood Pressure Measurement\"\t\t\t},\n\t{ 0x2a36, \"Intermediate Cuff Pressure\"\t\t\t},\n\t{ 0x2a37, \"Heart Rate Measurement\"\t\t\t},\n\t{ 0x2a38, \"Body Sensor Location\"\t\t\t},\n\t{ 0x2a39, \"Heart Rate Control Point\"\t\t\t},\n\t/* 0x2a3a to 0x2a3e undefined */\n\t{ 0x2a3f, \"Alert Status\"\t\t\t\t},\n\t{ 0x2a40, \"Ringer Control Point\"\t\t\t},\n\t{ 0x2a41, \"Ringer Setting\"\t\t\t\t},\n\t{ 0x2a42, \"Alert Category ID Bit Mask\"\t\t\t},\n\t{ 0x2a43, \"Alert Category ID\"\t\t\t\t},\n\t{ 0x2a44, \"Alert Notification Control Point\"\t\t},\n\t{ 0x2a45, \"Unread Alert Status\"\t\t\t\t},\n\t{ 0x2a46, \"New Alert\"\t\t\t\t\t},\n\t{ 0x2a47, \"Supported New Alert Category\"\t\t},\n\t{ 0x2a48, \"Supported Unread Alert Category\"\t\t},\n\t{ 0x2a49, \"Blood Pressure Feature\"\t\t\t},\n\t{ 0x2a4a, \"HID Information\"\t\t\t\t},\n\t{ 0x2a4b, \"Report Map\"\t\t\t\t\t},\n\t{ 0x2a4c, \"HID Control Point\"\t\t\t\t},\n\t{ 0x2a4d, \"Report\"\t\t\t\t\t},\n\t{ 0x2a4e, \"Protocol Mode\"\t\t\t\t},\n\t{ 0x2a4f, \"Scan Interval Window\"\t\t\t},\n\t{ 0x2a50, \"PnP ID\"\t\t\t\t\t},\n\t{ 0x2a51, \"Glucose Feature\"\t\t\t\t},\n\t{ 0x2a52, \"Record Access Control Point\"\t\t\t},\n\t{ 0x2a53, \"RSC Measurement\"\t\t\t\t},\n\t{ 0x2a54, \"RSC Feature\"\t\t\t\t\t},\n\t{ 0x2a55, \"SC Control Point\"\t\t\t\t},\n\t{ 0x2a56, \"Digital\"\t\t\t\t\t},\n\t/* 0x2a57 undefined */\n\t{ 0x2a58, \"Analog\"\t\t\t\t\t},\n\t/* 0x2a59 undefined */\n\t{ 0x2a5a, \"Aggregate\"\t\t\t\t\t},\n\t{ 0x2a5b, \"CSC Measurement\"\t\t\t\t},\n\t{ 0x2a5c, \"CSC Feature\"\t\t\t\t\t},\n\t{ 0x2a5d, \"Sensor Location\"\t\t\t\t},\n\t/* 0x2a5e to 0x2a62 undefined */\n\t{ 0x2a63, \"Cycling Power Measurement\"\t\t\t},\n\t{ 0x2a64, \"Cycling Power Vector\"\t\t\t},\n\t{ 0x2a65, \"Cycling Power Feature\"\t\t\t},\n\t{ 0x2a66, \"Cycling Power Control Point\"\t\t\t},\n\t{ 0x2a67, \"Location and Speed\"\t\t\t\t},\n\t{ 0x2a68, \"Navigation\"\t\t\t\t\t},\n\t{ 0x2a69, \"Position Quality\"\t\t\t\t},\n\t{ 0x2a6a, \"LN Feature\"\t\t\t\t\t},\n\t{ 0x2a6b, \"LN Control Point\"\t\t\t\t},\n\t{ 0x2a6c, \"Elevation\"\t\t\t\t\t},\n\t{ 0x2a6d, \"Pressure\"\t\t\t\t\t},\n\t{ 0x2a6e, \"Temperature\"\t\t\t\t\t},\n\t{ 0x2a6f, \"Humidity\"\t\t\t\t\t},\n\t{ 0x2a70, \"True Wind Speed\"\t\t\t\t},\n\t{ 0x2a71, \"True Wind Direction\"\t\t\t\t},\n\t{ 0x2a72, \"Apparent Wind Speed\"\t\t\t\t},\n\t{ 0x2a73, \"Apparent Wind Direction\"\t\t\t},\n\t{ 0x2a74, \"Gust Factor\"\t\t\t\t\t},\n\t{ 0x2a75, \"Pollen Concentration\"\t\t\t},\n\t{ 0x2a76, \"UV Index\"\t\t\t\t\t},\n\t{ 0x2a77, \"Irradiance\"\t\t\t\t\t},\n\t{ 0x2a78, \"Rainfall\"\t\t\t\t\t},\n\t{ 0x2a79, \"Wind Chill\"\t\t\t\t\t},\n\t{ 0x2a7a, \"Heat Index\"\t\t\t\t\t},\n\t{ 0x2a7b, \"Dew Point\"\t\t\t\t\t},\n\t{ 0x2a7c, \"Trend\"\t\t\t\t\t},\n\t{ 0x2a7d, \"Descriptor Value Changed\"\t\t\t},\n\t{ 0x2a7e, \"Aerobic Heart Rate Lower Limit\"\t\t},\n\t{ 0x2a7f, \"Aerobic Threshold\"\t\t\t\t},\n\t{ 0x2a80, \"Age\"\t\t\t\t\t\t},\n\t{ 0x2a81, \"Anaerobic Heart Rate Lower Limit\"\t\t},\n\t{ 0x2a82, \"Anaerobic Heart Rate Upper Limit\"\t\t},\n\t{ 0x2a83, \"Anaerobic Threshold\"\t\t\t\t},\n\t{ 0x2a84, \"Aerobic Heart Rate Upper Limit\"\t\t},\n\t{ 0x2a85, \"Date of Birth\"\t\t\t\t},\n\t{ 0x2a86, \"Date of Threshold Assessment\"\t\t},\n\t{ 0x2a87, \"Email Address\"\t\t\t\t},\n\t{ 0x2a88, \"Fat Burn Heart Rate Lower Limit\"\t\t},\n\t{ 0x2a89, \"Fat Burn Heart Rate Upper Limit\"\t\t},\n\t{ 0x2a8a, \"First Name\"\t\t\t\t\t},\n\t{ 0x2a8b, \"Five Zone Heart Rate Limits\"\t\t\t},\n\t{ 0x2a8c, \"Gender\"\t\t\t\t\t},\n\t{ 0x2a8d, \"Heart Rate Max\"\t\t\t\t},\n\t{ 0x2a8e, \"Height\"\t\t\t\t\t},\n\t{ 0x2a8f, \"Hip Circumference\"\t\t\t\t},\n\t{ 0x2a90, \"Last Name\"\t\t\t\t\t},\n\t{ 0x2a91, \"Maximum Recommended Heart Rate\"\t\t},\n\t{ 0x2a92, \"Resting Heart Rate\"\t\t\t\t},\n\t{ 0x2a93, \"Sport Type for Aerobic/Anaerobic Thresholds\"\t},\n\t{ 0x2a94, \"Three Zone Heart Rate Limits\"\t\t},\n\t{ 0x2a95, \"Two Zone Heart Rate Limit\"\t\t\t},\n\t{ 0x2a96, \"VO2 Max\"\t\t\t\t\t},\n\t{ 0x2a97, \"Waist Circumference\"\t\t\t\t},\n\t{ 0x2a98, \"Weight\"\t\t\t\t\t},\n\t{ 0x2a99, \"Database Change Increment\"\t\t\t},\n\t{ 0x2a9a, \"User Index\"\t\t\t\t\t},\n\t{ 0x2a9b, \"Body Composition Feature\"\t\t\t},\n\t{ 0x2a9c, \"Body Composition Measurement\"\t\t},\n\t{ 0x2a9d, \"Weight Measurement\"\t\t\t\t},\n\t{ 0x2a9e, \"Weight Scale Feature\"\t\t\t},\n\t{ 0x2a9f, \"User Control Point\"\t\t\t\t},\n\t{ 0x2aa0, \"Magnetic Flux Density - 2D\"\t\t\t},\n\t{ 0x2aa1, \"Magnetic Flux Density - 3D\"\t\t\t},\n\t{ 0x2aa2, \"Language\"\t\t\t\t\t},\n\t{ 0x2aa3, \"Barometric Pressure Trend\"\t\t\t},\n\t{ 0x2aa4, \"Bond Management Control Point\"\t\t},\n\t{ 0x2aa5, \"Bond Management Feature\"\t\t\t},\n\t{ 0x2aa6, \"Central Address Resolution\"\t\t\t},\n\t{ 0x2aa7, \"CGM Measurement\"\t\t\t\t},\n\t{ 0x2aa8, \"CGM Feature\"\t\t\t\t\t},\n\t{ 0x2aa9, \"CGM Status\"\t\t\t\t\t},\n\t{ 0x2aaa, \"CGM Session Start Time\"\t\t\t},\n\t{ 0x2aab, \"CGM Session Run Time\"\t\t\t},\n\t{ 0x2aac, \"CGM Specific Ops Control Point\"\t\t},\n\t{ 0x2aad, \"Indoor Positioning Configuration\"\t\t},\n\t{ 0x2aae, \"Latitude\"\t\t\t\t\t},\n\t{ 0x2aaf, \"Longitude\"\t\t\t\t\t},\n\t{ 0x2ab0, \"Local North Coordinate\"\t\t\t},\n\t{ 0x2ab1, \"Local East Coordinate\"\t\t\t},\n\t{ 0x2ab2, \"Floor Number\"\t\t\t\t},\n\t{ 0x2ab3, \"Altitude\"\t\t\t\t\t},\n\t{ 0x2ab4, \"Uncertainty\"\t\t\t\t\t},\n\t{ 0x2ab5, \"Location Name\"\t\t\t\t},\n\t{ 0x2ab6, \"URI\"\t\t\t\t\t\t},\n\t{ 0x2ab7, \"HTTP Headers\"\t\t\t\t},\n\t{ 0x2ab8, \"HTTP Status Code\"\t\t\t\t},\n\t{ 0x2ab9, \"HTTP Entity Body\"\t\t\t\t},\n\t{ 0x2aba, \"HTTP Control Point\"\t\t\t\t},\n\t{ 0x2abb, \"HTTPS Security\"\t\t\t\t},\n\t{ 0x2abc, \"TDS Control Point\"\t\t\t\t},\n\t{ 0x2abd, \"OTS Feature\"\t\t\t\t\t},\n\t{ 0x2abe, \"Object Name\"\t\t\t\t\t},\n\t{ 0x2abf, \"Object Type\"\t\t\t\t\t},\n\t{ 0x2ac0, \"Object Size\"\t\t\t\t\t},\n\t{ 0x2ac1, \"Object First-Created\"\t\t\t},\n\t{ 0x2ac2, \"Object Last-Modified\"\t\t\t},\n\t{ 0x2ac3, \"Object ID\"\t\t\t\t\t},\n\t{ 0x2ac4, \"Object Properties\"\t\t\t\t},\n\t{ 0x2ac5, \"Object Action Control Point\"\t\t\t},\n\t{ 0x2ac6, \"Object List Control Point\"\t\t\t},\n\t{ 0x2ac7, \"Object List Filter\"\t\t\t\t},\n\t{ 0x2ac8, \"Object Changed\"\t\t\t\t},\n\t{ 0x2ac9, \"Resolvable Private Address Only\"\t\t},\n\t/* 0x2aca and 0x2acb undefined */\n\t{ 0x2acc, \"Fitness Machine Feature\"\t\t\t},\n\t{ 0x2acd, \"Treadmill Data\"\t\t\t\t},\n\t{ 0x2ace, \"Cross Trainer Data\"\t\t\t\t},\n\t{ 0x2acf, \"Step Climber Data\"\t\t\t\t},\n\t{ 0x2ad0, \"Stair Climber Data\"\t\t\t\t},\n\t{ 0x2ad1, \"Rower Data\"\t\t\t\t\t},\n\t{ 0x2ad2, \"Indoor Bike Data\"\t\t\t\t},\n\t{ 0x2ad3, \"Training Status\"\t\t\t\t},\n\t{ 0x2ad4, \"Supported Speed Range\"\t\t\t},\n\t{ 0x2ad5, \"Supported Inclination Range\"\t\t\t},\n\t{ 0x2ad6, \"Supported Resistance Level Range\"\t\t},\n\t{ 0x2ad7, \"Supported Heart Rate Range\"\t\t\t},\n\t{ 0x2ad8, \"Supported Power Range\"\t\t\t},\n\t{ 0x2ad9, \"Fitness Machine Control Point\"\t\t},\n\t{ 0x2ada, \"Fitness Machine Status\"\t\t\t},\n\t{ 0x2adb, \"Mesh Provisioning Data In\"\t\t\t},\n\t{ 0x2adc, \"Mesh Provisioning Data Out\"\t\t\t},\n\t{ 0x2add, \"Mesh Proxy Data In\"\t\t\t\t},\n\t{ 0x2ade, \"Mesh Proxy Data Out\"\t\t\t\t},\n\t/* vendor defined */\n\t{ 0xfeff, \"GN Netcom\"\t\t\t\t\t},\n\t{ 0xfefe, \"GN ReSound A/S\"\t\t\t\t},\n\t{ 0xfefd, \"Gimbal, Inc.\"\t\t\t\t},\n\t{ 0xfefc, \"Gimbal, Inc.\"\t\t\t\t},\n\t{ 0xfefb, \"Stollmann E+V GmbH\"\t\t\t\t},\n\t{ 0xfefa, \"PayPal, Inc.\"\t\t\t\t},\n\t{ 0xfef9, \"PayPal, Inc.\"\t\t\t\t},\n\t{ 0xfef8, \"Aplix Corporation\"\t\t\t\t},\n\t{ 0xfef7, \"Aplix Corporation\"\t\t\t\t},\n\t{ 0xfef6, \"Wicentric, Inc.\"\t\t\t\t},\n\t{ 0xfef5, \"Dialog Semiconductor GmbH\"\t\t\t},\n\t{ 0xfef4, \"Google\"\t\t\t\t\t},\n\t{ 0xfef3, \"Google\"\t\t\t\t\t},\n\t{ 0xfef2, \"CSR\"\t\t\t\t\t\t},\n\t{ 0xfef1, \"CSR\"\t\t\t\t\t\t},\n\t{ 0xfef0, \"Intel\"\t\t\t\t\t},\n\t{ 0xfeef, \"Polar Electro Oy\"\t\t\t\t},\n\t{ 0xfeee, \"Polar Electro Oy\"\t\t\t\t},\n\t{ 0xfeed, \"Tile, Inc.\"\t\t\t\t\t},\n\t{ 0xfeec, \"Tile, Inc.\"\t\t\t\t\t},\n\t{ 0xfeeb, \"Swirl Networks, Inc.\"\t\t\t},\n\t{ 0xfeea, \"Swirl Networks, Inc.\"\t\t\t},\n\t{ 0xfee9, \"Quintic Corp.\"\t\t\t\t},\n\t{ 0xfee8, \"Quintic Corp.\"\t\t\t\t},\n\t{ 0xfee7, \"Tencent Holdings Limited\"\t\t\t},\n\t{ 0xfee6, \"Seed Labs, Inc.\"\t\t\t\t},\n\t{ 0xfee5, \"Nordic Semiconductor ASA\"\t\t\t},\n\t{ 0xfee4, \"Nordic Semiconductor ASA\"\t\t\t},\n\t{ 0xfee3, \"Anki, Inc.\"\t\t\t\t\t},\n\t{ 0xfee2, \"Anki, Inc.\"\t\t\t\t\t},\n\t{ 0xfee1, \"Anhui Huami Information Technology Co.\"\t},\n\t{ 0xfee0, \"Anhui Huami Information Technology Co.\"\t},\n\t{ 0xfedf, \"Design SHIFT\"\t\t\t\t},\n\t{ 0xfede, \"Coin, Inc.\"\t\t\t\t\t},\n\t{ 0xfedd, \"Jawbone\"\t\t\t\t\t},\n\t{ 0xfedc, \"Jawbone\"\t\t\t\t\t},\n\t{ 0xfedb, \"Perka, Inc.\"\t\t\t\t\t},\n\t{ 0xfeda, \"ISSC Technologies Corporation\"\t\t},\n\t{ 0xfed9, \"Pebble Technology Corporation\"\t\t},\n\t{ 0xfed8, \"Google\"\t\t\t\t\t},\n\t{ 0xfed7, \"Broadcom Corporation\"\t\t\t},\n\t{ 0xfed6, \"Broadcom Corporation\"\t\t\t},\n\t{ 0xfed5, \"Plantronics Inc.\"\t\t\t\t},\n\t{ 0xfed4, \"Apple, Inc.\"\t\t\t\t\t},\n\t{ 0xfed3, \"Apple, Inc.\"\t\t\t\t\t},\n\t{ 0xfed2, \"Apple, Inc.\"\t\t\t\t\t},\n\t{ 0xfed1, \"Apple, Inc.\"\t\t\t\t\t},\n\t{ 0xfed0, \"Apple, Inc.\"\t\t\t\t\t},\n\t{ 0xfecf, \"Apple, Inc.\"\t\t\t\t\t},\n\t{ 0xfece, \"Apple, Inc.\"\t\t\t\t\t},\n\t{ 0xfecd, \"Apple, Inc.\"\t\t\t\t\t},\n\t{ 0xfecc, \"Apple, Inc.\"\t\t\t\t\t},\n\t{ 0xfecb, \"Apple, Inc.\"\t\t\t\t\t},\n\t{ 0xfeca, \"Apple, Inc.\"\t\t\t\t\t},\n\t{ 0xfec9, \"Apple, Inc.\"\t\t\t\t\t},\n\t{ 0xfec8, \"Apple, Inc.\"\t\t\t\t\t},\n\t{ 0xfec7, \"Apple, Inc.\"\t\t\t\t\t},\n\t{ 0xfec6, \"Kocomojo, LLC\"\t\t\t\t},\n\t{ 0xfec5, \"Realtek Semiconductor Corp.\"\t\t\t},\n\t{ 0xfec4, \"PLUS Location Systems\"\t\t\t},\n\t{ 0xfec3, \"360fly, Inc.\"\t\t\t\t},\n\t{ 0xfec2, \"Blue Spark Technologies, Inc.\"\t\t},\n\t{ 0xfec1, \"KDDI Corporation\"\t\t\t\t},\n\t{ 0xfec0, \"KDDI Corporation\"\t\t\t\t},\n\t{ 0xfebf, \"Nod, Inc.\"\t\t\t\t\t},\n\t{ 0xfebe, \"Bose Corporation\"\t\t\t\t},\n\t{ 0xfebd, \"Clover Network, Inc.\"\t\t\t},\n\t{ 0xfebc, \"Dexcom, Inc.\"\t\t\t\t},\n\t{ 0xfebb, \"adafruit industries\"\t\t\t\t},\n\t{ 0xfeba, \"Tencent Holdings Limited\"\t\t\t},\n\t{ 0xfeb9, \"LG Electronics\"\t\t\t\t},\n\t{ 0xfeb8, \"Facebook, Inc.\"\t\t\t\t},\n\t{ 0xfeb7, \"Facebook, Inc.\"\t\t\t\t},\n\t{ 0xfeb6, \"Vencer Co, Ltd\"\t\t\t\t},\n\t{ 0xfeb5, \"WiSilica Inc.\"\t\t\t\t},\n\t{ 0xfeb4, \"WiSilica Inc.\"\t\t\t\t},\n\t{ 0xfeb3, \"Taobao\"\t\t\t\t\t},\n\t{ 0xfeb2, \"Microsoft Corporation\"\t\t\t},\n\t{ 0xfeb1, \"Electronics Tomorrow Limited\"\t\t},\n\t{ 0xfeb0, \"Nest Labs Inc.\"\t\t\t\t},\n\t{ 0xfeaf, \"Nest Labs Inc.\"\t\t\t\t},\n\t{ 0xfeae, \"Nokia Corporation\"\t\t\t\t},\n\t{ 0xfead, \"Nokia Corporation\"\t\t\t\t},\n\t{ 0xfeac, \"Nokia Corporation\"\t\t\t\t},\n\t{ 0xfeab, \"Nokia Corporation\"\t\t\t\t},\n\t{ 0xfeaa, \"Google\"\t\t\t\t\t},\n\t{ 0xfea9, \"Savant Systems LLC\"\t\t\t\t},\n\t{ 0xfea8, \"Savant Systems LLC\"\t\t\t\t},\n\t{ 0xfea7, \"UTC Fire and Security\"\t\t\t},\n\t{ 0xfea6, \"GoPro, Inc.\"\t\t\t\t\t},\n\t{ 0xfea5, \"GoPro, Inc.\"\t\t\t\t\t},\n\t{ 0xfea4, \"Paxton Access Ltd\"\t\t\t\t},\n\t{ 0xfea3, \"ITT Industries\"\t\t\t\t},\n\t{ 0xfea2, \"Intrepid Control Systems, Inc.\"\t\t},\n\t{ 0xfea1, \"Intrepid Control Systems, Inc.\"\t\t},\n\t{ 0xfea0, \"Google\"\t\t\t\t\t},\n\t{ 0xfe9f, \"Google\"\t\t\t\t\t},\n\t{ 0xfe9e, \"Dialog Semiconductor B.V.\"\t\t\t},\n\t{ 0xfe9d, \"Mobiquity Networks Inc\"\t\t\t},\n\t{ 0xfe9c, \"GSI Laboratories, Inc.\"\t\t\t},\n\t{ 0xfe9b, \"Samsara Networks, Inc\"\t\t\t},\n\t{ 0xfe9a, \"Estimote\"\t\t\t\t\t},\n\t{ 0xfe99, \"Currant, Inc.\"\t\t\t\t},\n\t{ 0xfe98, \"Currant, Inc.\"\t\t\t\t},\n\t{ 0xfe97, \"Tesla Motor Inc.\"\t\t\t\t},\n\t{ 0xfe96, \"Tesla Motor Inc.\"\t\t\t\t},\n\t{ 0xfe95, \"Xiaomi Inc.\"\t\t\t\t\t},\n\t{ 0xfe94, \"OttoQ Inc.\"\t\t\t\t\t},\n\t{ 0xfe93, \"OttoQ Inc.\"\t\t\t\t\t},\n\t{ 0xfe92, \"Jarden Safety & Security\"\t\t\t},\n\t{ 0xfe91, \"Shanghai Imilab Technology Co.,Ltd\"\t\t},\n\t{ 0xfe90, \"JUMA\"\t\t\t\t\t},\n\t{ 0xfe8f, \"CSR\"\t\t\t\t\t\t},\n\t{ 0xfe8e, \"ARM Ltd\"\t\t\t\t\t},\n\t{ 0xfe8d, \"Interaxon Inc.\"\t\t\t\t},\n\t{ 0xfe8c, \"TRON Forum\"\t\t\t\t\t},\n\t{ 0xfe8b, \"Apple, Inc.\"\t\t\t\t\t},\n\t{ 0xfe8a, \"Apple, Inc.\"\t\t\t\t\t},\n\t{ 0xfe89, \"B&O Play A/S\"\t\t\t\t},\n\t{ 0xfe88, \"SALTO SYSTEMS S.L.\"\t\t\t\t},\n\t{ 0xfe87, \"Qingdao Yeelink Information Technology Co., Ltd. (  )\"\t},\n\t{ 0xfe86, \"HUAWEI Technologies Co., Ltd. (  )\"\t\t\t\t\t},\n\t{ 0xfe85, \"RF Digital Corp\"\t\t\t\t},\n\t{ 0xfe84, \"RF Digital Corp\"\t\t\t\t},\n\t{ 0xfe83, \"Blue Bite\"\t\t\t\t\t},\n\t{ 0xfe82, \"Medtronic Inc.\"\t\t\t\t},\n\t{ 0xfe81, \"Medtronic Inc.\"\t\t\t\t},\n\t{ 0xfe80, \"Doppler Lab\"\t\t\t\t\t},\n\t{ 0xfe7f, \"Doppler Lab\"\t\t\t\t\t},\n\t{ 0xfe7e, \"Awear Solutions Ltd\"\t\t\t\t},\n\t{ 0xfe7d, \"Aterica Health Inc.\"\t\t\t\t},\n\t{ 0xfe7c, \"Stollmann E+V GmbH\"\t\t\t\t},\n\t{ 0xfe7b, \"Orion Labs, Inc.\"\t\t\t\t},\n\t{ 0xfe7a, \"Bragi GmbH\"\t\t\t\t\t},\n\t{ 0xfe79, \"Zebra Technologies\"\t\t\t\t},\n\t{ 0xfe78, \"Hewlett-Packard Company\"\t\t\t},\n\t{ 0xfe77, \"Hewlett-Packard Company\"\t\t\t},\n\t{ 0xfe76, \"TangoMe\"\t\t\t\t\t},\n\t{ 0xfe75, \"TangoMe\"\t\t\t\t\t},\n\t{ 0xfe74, \"unwire\"\t\t\t\t\t},\n\t{ 0xfe73, \"St. Jude Medical, Inc.\"\t\t\t},\n\t{ 0xfe72, \"St. Jude Medical, Inc.\"\t\t\t},\n\t{ 0xfe71, \"Plume Design Inc\"\t\t\t\t},\n\t{ 0xfe70, \"Beijing Jingdong Century Trading Co., Ltd.\"\t},\n\t{ 0xfe6f, \"LINE Corporation\"\t\t\t\t},\n\t{ 0xfe6e, \"The University of Tokyo\"\t\t\t},\n\t{ 0xfe6d, \"The University of Tokyo\"\t\t\t},\n\t{ 0xfe6c, \"TASER International, Inc.\"\t\t\t},\n\t{ 0xfe6b, \"TASER International, Inc.\"\t\t\t},\n\t{ 0xfe6a, \"Kontakt Micro-Location Sp. z o.o.\"\t\t},\n\t{ 0xfe69, \"Qualcomm Life Inc\"\t\t\t\t},\n\t{ 0xfe68, \"Qualcomm Life Inc\"\t\t\t\t},\n\t{ 0xfe67, \"Lab Sensor Solutions\"\t\t\t},\n\t{ 0xfe66, \"Intel Corporation\"\t\t\t\t},\n\t{ 0xfe65, \"CHIPOLO d.o.o.\"\t\t\t\t},\n\t{ 0xfe64, \"Siemens AG\"\t\t\t\t\t},\n\t{ 0xfe63, \"Connected Yard, Inc.\"\t\t\t},\n\t{ 0xfe62, \"Indagem Tech LLC\"\t\t\t\t},\n\t{ 0xfe61, \"Logitech International SA\"\t\t\t},\n\t{ 0xfe60, \"Lierda Science & Technology Group Co., Ltd.\"\t},\n\t{ 0xfe5F, \"Eyefi, Inc.\"\t\t\t\t\t},\n\t{ 0xfe5E, \"Plastc Corporation\"\t\t\t\t},\n\t{ 0xfe5D, \"Grundfos A/S\"\t\t\t\t},\n\t{ 0xfe5C, \"million hunters GmbH\"\t\t\t},\n\t{ 0xfe5B, \"GT-tronics HK Ltd\"\t\t\t\t},\n\t{ 0xfe5A, \"Chronologics Corporation\"\t\t\t},\n\t{ 0xfe59, \"Nordic Semiconductor ASA\"\t\t\t},\n\t{ 0xfe58, \"Nordic Semiconductor ASA\"\t\t\t},\n\t{ 0xfe57, \"Dotted Labs\"\t\t\t\t\t},\n\t{ 0xfe56, \"Google Inc.\"\t\t\t\t\t},\n\t{ 0xfe55, \"Google Inc.\"\t\t\t\t\t},\n\t{ 0xfe54, \"Motiv, Inc.\"\t\t\t\t\t},\n\t{ 0xfe53, \"3M\"\t\t\t\t\t\t},\n\t{ 0xfe52, \"SetPoint Medical\"\t\t\t\t},\n\t{ 0xfe51, \"SRAM\"\t\t\t\t\t},\n\t{ 0xfe50, \"Google Inc.\"\t\t\t\t\t},\n\t{ 0xfe4F, \"Molekule, Inc.\"\t\t\t\t},\n\t{ 0xfe4E, \"NTT docomo\"\t\t\t\t\t},\n\t{ 0xfe4D, \"Casambi Technologies Oy\"\t\t\t},\n\t{ 0xfe4C, \"Volkswagen AG\"\t\t\t\t},\n\t{ 0xfe4B, \"Koninklijke Philips N.V.\"\t\t\t},\n\t{ 0xfe4A, \"OMRON HEALTHCARE Co., Ltd.\"\t\t\t},\n\t{ 0xfe49, \"SenionLab AB\"\t\t\t\t},\n\t{ 0xfe48, \"General Motors\"\t\t\t\t},\n\t{ 0xfe47, \"General Motors\"\t\t\t\t},\n\t{ 0xfe46, \"B&O Play A/S\"\t\t\t\t},\n\t{ 0xfe45, \"Snapchat Inc\"\t\t\t\t},\n\t{ 0xfe44, \"SK Telecom\"\t\t\t\t\t},\n\t{ 0xfe43, \"Andreas Stihl AG & Co. KG\"\t\t\t},\n\t{ 0xfe42, \"Nets A/S\"\t\t\t\t\t},\n\t{ 0xfe41, \"Inugo Systems Limited\"\t\t\t},\n\t{ 0xfe40, \"Inugo Systems Limited\"\t\t\t},\n\t{ 0xfe3F, \"Friday Labs Limited\"\t\t\t\t},\n\t{ 0xfe3E, \"BD Medical\"\t\t\t\t\t},\n\t{ 0xfe3D, \"BD Medical\"\t\t\t\t\t},\n\t{ 0xfe3C, \"Alibaba\"\t\t\t\t\t},\n\t{ 0xfe3B, \"Dolby Laboratories\"\t\t\t\t},\n\t{ 0xfe3A, \"TTS Tooltechnic Systems AG & Co. KG\"\t\t},\n\t{ 0xfe39, \"TTS Tooltechnic Systems AG & Co. KG\"\t\t},\n\t{ 0xfe38, \"Spaceek LTD\"\t\t\t\t\t},\n\t{ 0xfe37, \"Spaceek LTD\"\t\t\t\t\t},\n\t{ 0xfe36, \"HUAWEI Technologies Co., Ltd\"\t\t},\n\t{ 0xfe35, \"HUAWEI Technologies Co., Ltd\"\t\t},\n\t{ 0xfe34, \"SmallLoop LLC\"\t\t\t\t},\n\t{ 0xfe33, \"CHIPOLO d.o.o.\"\t\t\t\t},\n\t{ 0xfe32, \"Pro-Mark, Inc.\"\t\t\t\t},\n\t{ 0xfe31, \"Volkswagen AG\"\t\t\t\t},\n\t{ 0xfe30, \"Volkswagen AG\"\t\t\t\t},\n\t{ 0xfe2F, \"CRESCO Wireless, Inc\"\t\t\t},\n\t{ 0xfe2E, \"ERi,Inc.\"\t\t\t\t\t},\n\t{ 0xfe2D, \"SMART INNOVATION Co.,Ltd\"\t\t\t},\n\t{ 0xfe2C, \"Google Inc.\"\t\t\t\t\t},\n\t{ 0xfe2B, \"ITT Industries\"\t\t\t\t},\n\t{ 0xfe2A, \"DaisyWorks, Inc.\"\t\t\t\t},\n\t{ 0xfe29, \"Gibson Innovations\"\t\t\t\t},\n\t{ 0xfe28, \"Ayla Network\"\t\t\t\t},\n\t{ 0xfe27, \"Google Inc.\"\t\t\t\t\t},\n\t{ 0xfe26, \"Google Inc.\"\t\t\t\t\t},\n\t{ 0xfe25, \"Apple, Inc.\"\t\t\t\t\t},\n\t{ 0xfe24, \"August Home Inc\"\t\t\t\t},\n\t{ 0xfe23, \"Zoll Medical Corporation\"\t\t\t},\n\t{ 0xfe22, \"Zoll Medical Corporation\"\t\t\t},\n\t{ 0xfe21, \"Bose Corporation\"\t\t\t\t},\n\t{ 0xfe20, \"Emerson\"\t\t\t\t\t},\n\t{ 0xfe1F, \"Garmin International, Inc.\"\t\t\t},\n\t{ 0xfe1E, \"Smart Innovations Co., Ltd\"\t\t\t},\n\t{ 0xfe1D, \"Illuminati Instrument Corporation\"\t\t},\n\t{ 0xfe1C, \"NetMedia, Inc.\"\t\t\t\t},\n\t/* SDO defined */\n\t{ 0xfffc, \"AirFuel Alliance\"\t\t\t\t},\n\t{ 0xfffe, \"Alliance for Wireless Power (A4WP)\"\t\t},\n\t{ 0xfffd, \"Fast IDentity Online Alliance (FIDO)\"\t},\n\t{ }\n};"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/util.h\"\n#include <string.h>\n#include <limits.h>\n#include <dirent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic const struct {\n\tuint16_t uuid;\n\tconst char *str;\n} uuid16_table[] = {\n\t{ 0x0001, \"SDP\"\t\t\t\t\t\t},\n\t{ 0x0003, \"RFCOMM\"\t\t\t\t\t},\n\t{ 0x0005, \"TCS-BIN\"\t\t\t\t\t},\n\t{ 0x0007, \"ATT\"\t\t\t\t\t\t},\n\t{ 0x0008, \"OBEX\"\t\t\t\t\t},\n\t{ 0x000f, \"BNEP\"\t\t\t\t\t},\n\t{ 0x0010, \"UPNP\"\t\t\t\t\t},\n\t{ 0x0011, \"HIDP\"\t\t\t\t\t},\n\t{ 0x0012, \"Hardcopy Control Channel\"\t\t\t},\n\t{ 0x0014, \"Hardcopy Data Channel\"\t\t\t},\n\t{ 0x0016, \"Hardcopy Notification\"\t\t\t},\n\t{ 0x0017, \"AVCTP\"\t\t\t\t\t},\n\t{ 0x0019, \"AVDTP\"\t\t\t\t\t},\n\t{ 0x001b, \"CMTP\"\t\t\t\t\t},\n\t{ 0x001e, \"MCAP Control Channel\"\t\t\t},\n\t{ 0x001f, \"MCAP Data Channel\"\t\t\t\t},\n\t{ 0x0100, \"L2CAP\"\t\t\t\t\t},\n\t/* 0x0101 to 0x0fff undefined */\n\t{ 0x1000, \"Service Discovery Server Service Class\"\t},\n\t{ 0x1001, \"Browse Group Descriptor Service Class\"\t},\n\t{ 0x1002, \"Public Browse Root\"\t\t\t\t},\n\t/* 0x1003 to 0x1100 undefined */\n\t{ 0x1101, \"Serial Port\"\t\t\t\t\t},\n\t{ 0x1102, \"LAN Access Using PPP\"\t\t\t},\n\t{ 0x1103, \"Dialup Networking\"\t\t\t\t},\n\t{ 0x1104, \"IrMC Sync\"\t\t\t\t\t},\n\t{ 0x1105, \"OBEX Object Push\"\t\t\t\t},\n\t{ 0x1106, \"OBEX File Transfer\"\t\t\t\t},\n\t{ 0x1107, \"IrMC Sync Command\"\t\t\t\t},\n\t{ 0x1108, \"Headset\"\t\t\t\t\t},\n\t{ 0x1109, \"Cordless Telephony\"\t\t\t\t},\n\t{ 0x110a, \"Audio Source\"\t\t\t\t},\n\t{ 0x110b, \"Audio Sink\"\t\t\t\t\t},\n\t{ 0x110c, \"A/V Remote Control Target\"\t\t\t},\n\t{ 0x110d, \"Advanced Audio Distribution\"\t\t\t},\n\t{ 0x110e, \"A/V Remote Control\"\t\t\t\t},\n\t{ 0x110f, \"A/V Remote Control Controller\"\t\t},\n\t{ 0x1110, \"Intercom\"\t\t\t\t\t},\n\t{ 0x1111, \"Fax\"\t\t\t\t\t\t},\n\t{ 0x1112, \"Headset AG\"\t\t\t\t\t},\n\t{ 0x1113, \"WAP\"\t\t\t\t\t\t},\n\t{ 0x1114, \"WAP Client\"\t\t\t\t\t},\n\t{ 0x1115, \"PANU\"\t\t\t\t\t},\n\t{ 0x1116, \"NAP\"\t\t\t\t\t\t},\n\t{ 0x1117, \"GN\"\t\t\t\t\t\t},\n\t{ 0x1118, \"Direct Printing\"\t\t\t\t},\n\t{ 0x1119, \"Reference Printing\"\t\t\t\t},\n\t{ 0x111a, \"Basic Imaging Profile\"\t\t\t},\n\t{ 0x111b, \"Imaging Responder\"\t\t\t\t},\n\t{ 0x111c, \"Imaging Automatic Archive\"\t\t\t},\n\t{ 0x111d, \"Imaging Referenced Objects\"\t\t\t},\n\t{ 0x111e, \"Handsfree\"\t\t\t\t\t},\n\t{ 0x111f, \"Handsfree Audio Gateway\"\t\t\t},\n\t{ 0x1120, \"Direct Printing Refrence Objects Service\"\t},\n\t{ 0x1121, \"Reflected UI\"\t\t\t\t},\n\t{ 0x1122, \"Basic Printing\"\t\t\t\t},\n\t{ 0x1123, \"Printing Status\"\t\t\t\t},\n\t{ 0x1124, \"Human Interface Device Service\"\t\t},\n\t{ 0x1125, \"Hardcopy Cable Replacement\"\t\t\t},\n\t{ 0x1126, \"HCR Print\"\t\t\t\t\t},\n\t{ 0x1127, \"HCR Scan\"\t\t\t\t\t},\n\t{ 0x1128, \"Common ISDN Access\"\t\t\t\t},\n\t/* 0x1129 and 0x112a undefined */\n\t{ 0x112d, \"SIM Access\"\t\t\t\t\t},\n\t{ 0x112e, \"Phonebook Access Client\"\t\t\t},\n\t{ 0x112f, \"Phonebook Access Server\"\t\t\t},\n\t{ 0x1130, \"Phonebook Access\"\t\t\t\t},\n\t{ 0x1131, \"Headset HS\"\t\t\t\t\t},\n\t{ 0x1132, \"Message Access Server\"\t\t\t},\n\t{ 0x1133, \"Message Notification Server\"\t\t\t},\n\t{ 0x1134, \"Message Access Profile\"\t\t\t},\n\t{ 0x1135, \"GNSS\"\t\t\t\t\t},\n\t{ 0x1136, \"GNSS Server\"\t\t\t\t\t},\n\t{ 0x1137, \"3D Display\"\t\t\t\t\t},\n\t{ 0x1138, \"3D Glasses\"\t\t\t\t\t},\n\t{ 0x1139, \"3D Synchronization\"\t\t\t\t},\n\t{ 0x113a, \"MPS Profile\"\t\t\t\t\t},\n\t{ 0x113b, \"MPS Service\"\t\t\t\t\t},\n\t/* 0x113c to 0x11ff undefined */\n\t{ 0x1200, \"PnP Information\"\t\t\t\t},\n\t{ 0x1201, \"Generic Networking\"\t\t\t\t},\n\t{ 0x1202, \"Generic File Transfer\"\t\t\t},\n\t{ 0x1203, \"Generic Audio\"\t\t\t\t},\n\t{ 0x1204, \"Generic Telephony\"\t\t\t\t},\n\t{ 0x1205, \"UPNP Service\"\t\t\t\t},\n\t{ 0x1206, \"UPNP IP Service\"\t\t\t\t},\n\t{ 0x1300, \"UPNP IP PAN\"\t\t\t\t\t},\n\t{ 0x1301, \"UPNP IP LAP\"\t\t\t\t\t},\n\t{ 0x1302, \"UPNP IP L2CAP\"\t\t\t\t},\n\t{ 0x1303, \"Video Source\"\t\t\t\t},\n\t{ 0x1304, \"Video Sink\"\t\t\t\t\t},\n\t{ 0x1305, \"Video Distribution\"\t\t\t\t},\n\t/* 0x1306 to 0x13ff undefined */\n\t{ 0x1400, \"HDP\"\t\t\t\t\t\t},\n\t{ 0x1401, \"HDP Source\"\t\t\t\t\t},\n\t{ 0x1402, \"HDP Sink\"\t\t\t\t\t},\n\t/* 0x1403 to 0x17ff undefined */\n\t{ 0x1800, \"Generic Access Profile\"\t\t\t},\n\t{ 0x1801, \"Generic Attribute Profile\"\t\t\t},\n\t{ 0x1802, \"Immediate Alert\"\t\t\t\t},\n\t{ 0x1803, \"Link Loss\"\t\t\t\t\t},\n\t{ 0x1804, \"Tx Power\"\t\t\t\t\t},\n\t{ 0x1805, \"Current Time Service\"\t\t\t},\n\t{ 0x1806, \"Reference Time Update Service\"\t\t},\n\t{ 0x1807, \"Next DST Change Service\"\t\t\t},\n\t{ 0x1808, \"Glucose\"\t\t\t\t\t},\n\t{ 0x1809, \"Health Thermometer\"\t\t\t\t},\n\t{ 0x180a, \"Device Information\"\t\t\t\t},\n\t/* 0x180b and 0x180c undefined */\n\t{ 0x180d, \"Heart Rate\"\t\t\t\t\t},\n\t{ 0x180e, \"Phone Alert Status Service\"\t\t\t},\n\t{ 0x180f, \"Battery Service\"\t\t\t\t},\n\t{ 0x1810, \"Blood Pressure\"\t\t\t\t},\n\t{ 0x1811, \"Alert Notification Service\"\t\t\t},\n\t{ 0x1812, \"Human Interface Device\"\t\t\t},\n\t{ 0x1813, \"Scan Parameters\"\t\t\t\t},\n\t{ 0x1814, \"Running Speed and Cadence\"\t\t\t},\n\t{ 0x1815, \"Automation IO\"\t\t\t\t},\n\t{ 0x1816, \"Cycling Speed and Cadence\"\t\t\t},\n\t/* 0x1817 undefined */\n\t{ 0x1818, \"Cycling Power\"\t\t\t\t},\n\t{ 0x1819, \"Location and Navigation\"\t\t\t},\n\t{ 0x181a, \"Environmental Sensing\"\t\t\t},\n\t{ 0x181b, \"Body Composition\"\t\t\t\t},\n\t{ 0x181c, \"User Data\"\t\t\t\t\t},\n\t{ 0x181d, \"Weight Scale\"\t\t\t\t},\n\t{ 0x181e, \"Bond Management\"\t\t\t\t},\n\t{ 0x181f, \"Continuous Glucose Monitoring\"\t\t},\n\t{ 0x1820, \"Internet Protocol Support\"\t\t\t},\n\t{ 0x1821, \"Indoor Positioning\"\t\t\t\t},\n\t{ 0x1822, \"Pulse Oximeter\"\t\t\t\t},\n\t{ 0x1823, \"HTTP Proxy\"\t\t\t\t\t},\n\t{ 0x1824, \"Transport Discovery\"\t\t\t\t},\n\t{ 0x1825, \"Object Transfer\"\t\t\t\t},\n\t{ 0x1826, \"Fitness Machine\"\t\t\t\t},\n\t{ 0x1827, \"Mesh Provisioning\"\t\t\t\t},\n\t{ 0x1828, \"Mesh Proxy\"\t\t\t\t\t},\n\t/* 0x1829 to 0x27ff undefined */\n\t{ 0x2800, \"Primary Service\"\t\t\t\t},\n\t{ 0x2801, \"Secondary Service\"\t\t\t\t},\n\t{ 0x2802, \"Include\"\t\t\t\t\t},\n\t{ 0x2803, \"Characteristic\"\t\t\t\t},\n\t/* 0x2804 to 0x28ff undefined */\n\t{ 0x2900, \"Characteristic Extended Properties\"\t\t},\n\t{ 0x2901, \"Characteristic User Description\"\t\t},\n\t{ 0x2902, \"Client Characteristic Configuration\"\t\t},\n\t{ 0x2903, \"Server Characteristic Configuration\"\t\t},\n\t{ 0x2904, \"Characteristic Format\"\t\t\t},\n\t{ 0x2905, \"Characteristic Aggregate Formate\"\t\t},\n\t{ 0x2906, \"Valid Range\"\t\t\t\t\t},\n\t{ 0x2907, \"External Report Reference\"\t\t\t},\n\t{ 0x2908, \"Report Reference\"\t\t\t\t},\n\t{ 0x2909, \"Number of Digitals\"\t\t\t\t},\n\t{ 0x290a, \"Value Trigger Setting\"\t\t\t},\n\t{ 0x290b, \"Environmental Sensing Configuration\"\t\t},\n\t{ 0x290c, \"Environmental Sensing Measurement\"\t\t},\n\t{ 0x290d, \"Environmental Sensing Trigger Setting\"\t},\n\t{ 0x290e, \"Time Trigger Setting\"\t\t\t},\n\t/* 0x290f to 0x29ff undefined */\n\t{ 0x2a00, \"Device Name\"\t\t\t\t\t},\n\t{ 0x2a01, \"Appearance\"\t\t\t\t\t},\n\t{ 0x2a02, \"Peripheral Privacy Flag\"\t\t\t},\n\t{ 0x2a03, \"Reconnection Address\"\t\t\t},\n\t{ 0x2a04, \"Peripheral Preferred Connection Parameters\"\t},\n\t{ 0x2a05, \"Service Changed\"\t\t\t\t},\n\t{ 0x2a06, \"Alert Level\"\t\t\t\t\t},\n\t{ 0x2a07, \"Tx Power Level\"\t\t\t\t},\n\t{ 0x2a08, \"Date Time\"\t\t\t\t\t},\n\t{ 0x2a09, \"Day of Week\"\t\t\t\t\t},\n\t{ 0x2a0a, \"Day Date Time\"\t\t\t\t},\n\t/* 0x2a0b undefined */\n\t{ 0x2a0c, \"Exact Time 256\"\t\t\t\t},\n\t{ 0x2a0d, \"DST Offset\"\t\t\t\t\t},\n\t{ 0x2a0e, \"Time Zone\"\t\t\t\t\t},\n\t{ 0x2a0f, \"Local Time Information\"\t\t\t},\n\t/* 0x2a10 undefined */\n\t{ 0x2a11, \"Time with DST\"\t\t\t\t},\n\t{ 0x2a12, \"Time Accuracy\"\t\t\t\t},\n\t{ 0x2a13, \"Time Source\"\t\t\t\t\t},\n\t{ 0x2a14, \"Reference Time Information\"\t\t\t},\n\t/* 0x2a15 undefined */\n\t{ 0x2a16, \"Time Update Control Point\"\t\t\t},\n\t{ 0x2a17, \"Time Update State\"\t\t\t\t},\n\t{ 0x2a18, \"Glucose Measurement\"\t\t\t\t},\n\t{ 0x2a19, \"Battery Level\"\t\t\t\t},\n\t/* 0x2a1a and 0x2a1b undefined */\n\t{ 0x2a1c, \"Temperature Measurement\"\t\t\t},\n\t{ 0x2a1d, \"Temperature Type\"\t\t\t\t},\n\t{ 0x2a1e, \"Intermediate Temperature\"\t\t\t},\n\t/* 0x2a1f and 0x2a20 undefined */\n\t{ 0x2a21, \"Measurement Interval\"\t\t\t},\n\t{ 0x2a22, \"Boot Keyboard Input Report\"\t\t\t},\n\t{ 0x2a23, \"System ID\"\t\t\t\t\t},\n\t{ 0x2a24, \"Model Number String\"\t\t\t\t},\n\t{ 0x2a25, \"Serial Number String\"\t\t\t},\n\t{ 0x2a26, \"Firmware Revision String\"\t\t\t},\n\t{ 0x2a27, \"Hardware Revision String\"\t\t\t},\n\t{ 0x2a28, \"Software Revision String\"\t\t\t},\n\t{ 0x2a29, \"Manufacturer Name String\"\t\t\t},\n\t{ 0x2a2a, \"IEEE 11073-20601 Regulatory Cert. Data List\"\t},\n\t{ 0x2a2b, \"Current Time\"\t\t\t\t},\n\t{ 0x2a2c, \"Magnetic Declination\"\t\t\t},\n\t/* 0x2a2d to 0x2a30 undefined */\n\t{ 0x2a31, \"Scan Refresh\"\t\t\t\t},\n\t{ 0x2a32, \"Boot Keyboard Output Report\"\t\t\t},\n\t{ 0x2a33, \"Boot Mouse Input Report\"\t\t\t},\n\t{ 0x2a34, \"Glucose Measurement Context\"\t\t\t},\n\t{ 0x2a35, \"Blood Pressure Measurement\"\t\t\t},\n\t{ 0x2a36, \"Intermediate Cuff Pressure\"\t\t\t},\n\t{ 0x2a37, \"Heart Rate Measurement\"\t\t\t},\n\t{ 0x2a38, \"Body Sensor Location\"\t\t\t},\n\t{ 0x2a39, \"Heart Rate Control Point\"\t\t\t},\n\t/* 0x2a3a to 0x2a3e undefined */\n\t{ 0x2a3f, \"Alert Status\"\t\t\t\t},\n\t{ 0x2a40, \"Ringer Control Point\"\t\t\t},\n\t{ 0x2a41, \"Ringer Setting\"\t\t\t\t},\n\t{ 0x2a42, \"Alert Category ID Bit Mask\"\t\t\t},\n\t{ 0x2a43, \"Alert Category ID\"\t\t\t\t},\n\t{ 0x2a44, \"Alert Notification Control Point\"\t\t},\n\t{ 0x2a45, \"Unread Alert Status\"\t\t\t\t},\n\t{ 0x2a46, \"New Alert\"\t\t\t\t\t},\n\t{ 0x2a47, \"Supported New Alert Category\"\t\t},\n\t{ 0x2a48, \"Supported Unread Alert Category\"\t\t},\n\t{ 0x2a49, \"Blood Pressure Feature\"\t\t\t},\n\t{ 0x2a4a, \"HID Information\"\t\t\t\t},\n\t{ 0x2a4b, \"Report Map\"\t\t\t\t\t},\n\t{ 0x2a4c, \"HID Control Point\"\t\t\t\t},\n\t{ 0x2a4d, \"Report\"\t\t\t\t\t},\n\t{ 0x2a4e, \"Protocol Mode\"\t\t\t\t},\n\t{ 0x2a4f, \"Scan Interval Window\"\t\t\t},\n\t{ 0x2a50, \"PnP ID\"\t\t\t\t\t},\n\t{ 0x2a51, \"Glucose Feature\"\t\t\t\t},\n\t{ 0x2a52, \"Record Access Control Point\"\t\t\t},\n\t{ 0x2a53, \"RSC Measurement\"\t\t\t\t},\n\t{ 0x2a54, \"RSC Feature\"\t\t\t\t\t},\n\t{ 0x2a55, \"SC Control Point\"\t\t\t\t},\n\t{ 0x2a56, \"Digital\"\t\t\t\t\t},\n\t/* 0x2a57 undefined */\n\t{ 0x2a58, \"Analog\"\t\t\t\t\t},\n\t/* 0x2a59 undefined */\n\t{ 0x2a5a, \"Aggregate\"\t\t\t\t\t},\n\t{ 0x2a5b, \"CSC Measurement\"\t\t\t\t},\n\t{ 0x2a5c, \"CSC Feature\"\t\t\t\t\t},\n\t{ 0x2a5d, \"Sensor Location\"\t\t\t\t},\n\t/* 0x2a5e to 0x2a62 undefined */\n\t{ 0x2a63, \"Cycling Power Measurement\"\t\t\t},\n\t{ 0x2a64, \"Cycling Power Vector\"\t\t\t},\n\t{ 0x2a65, \"Cycling Power Feature\"\t\t\t},\n\t{ 0x2a66, \"Cycling Power Control Point\"\t\t\t},\n\t{ 0x2a67, \"Location and Speed\"\t\t\t\t},\n\t{ 0x2a68, \"Navigation\"\t\t\t\t\t},\n\t{ 0x2a69, \"Position Quality\"\t\t\t\t},\n\t{ 0x2a6a, \"LN Feature\"\t\t\t\t\t},\n\t{ 0x2a6b, \"LN Control Point\"\t\t\t\t},\n\t{ 0x2a6c, \"Elevation\"\t\t\t\t\t},\n\t{ 0x2a6d, \"Pressure\"\t\t\t\t\t},\n\t{ 0x2a6e, \"Temperature\"\t\t\t\t\t},\n\t{ 0x2a6f, \"Humidity\"\t\t\t\t\t},\n\t{ 0x2a70, \"True Wind Speed\"\t\t\t\t},\n\t{ 0x2a71, \"True Wind Direction\"\t\t\t\t},\n\t{ 0x2a72, \"Apparent Wind Speed\"\t\t\t\t},\n\t{ 0x2a73, \"Apparent Wind Direction\"\t\t\t},\n\t{ 0x2a74, \"Gust Factor\"\t\t\t\t\t},\n\t{ 0x2a75, \"Pollen Concentration\"\t\t\t},\n\t{ 0x2a76, \"UV Index\"\t\t\t\t\t},\n\t{ 0x2a77, \"Irradiance\"\t\t\t\t\t},\n\t{ 0x2a78, \"Rainfall\"\t\t\t\t\t},\n\t{ 0x2a79, \"Wind Chill\"\t\t\t\t\t},\n\t{ 0x2a7a, \"Heat Index\"\t\t\t\t\t},\n\t{ 0x2a7b, \"Dew Point\"\t\t\t\t\t},\n\t{ 0x2a7c, \"Trend\"\t\t\t\t\t},\n\t{ 0x2a7d, \"Descriptor Value Changed\"\t\t\t},\n\t{ 0x2a7e, \"Aerobic Heart Rate Lower Limit\"\t\t},\n\t{ 0x2a7f, \"Aerobic Threshold\"\t\t\t\t},\n\t{ 0x2a80, \"Age\"\t\t\t\t\t\t},\n\t{ 0x2a81, \"Anaerobic Heart Rate Lower Limit\"\t\t},\n\t{ 0x2a82, \"Anaerobic Heart Rate Upper Limit\"\t\t},\n\t{ 0x2a83, \"Anaerobic Threshold\"\t\t\t\t},\n\t{ 0x2a84, \"Aerobic Heart Rate Upper Limit\"\t\t},\n\t{ 0x2a85, \"Date of Birth\"\t\t\t\t},\n\t{ 0x2a86, \"Date of Threshold Assessment\"\t\t},\n\t{ 0x2a87, \"Email Address\"\t\t\t\t},\n\t{ 0x2a88, \"Fat Burn Heart Rate Lower Limit\"\t\t},\n\t{ 0x2a89, \"Fat Burn Heart Rate Upper Limit\"\t\t},\n\t{ 0x2a8a, \"First Name\"\t\t\t\t\t},\n\t{ 0x2a8b, \"Five Zone Heart Rate Limits\"\t\t\t},\n\t{ 0x2a8c, \"Gender\"\t\t\t\t\t},\n\t{ 0x2a8d, \"Heart Rate Max\"\t\t\t\t},\n\t{ 0x2a8e, \"Height\"\t\t\t\t\t},\n\t{ 0x2a8f, \"Hip Circumference\"\t\t\t\t},\n\t{ 0x2a90, \"Last Name\"\t\t\t\t\t},\n\t{ 0x2a91, \"Maximum Recommended Heart Rate\"\t\t},\n\t{ 0x2a92, \"Resting Heart Rate\"\t\t\t\t},\n\t{ 0x2a93, \"Sport Type for Aerobic/Anaerobic Thresholds\"\t},\n\t{ 0x2a94, \"Three Zone Heart Rate Limits\"\t\t},\n\t{ 0x2a95, \"Two Zone Heart Rate Limit\"\t\t\t},\n\t{ 0x2a96, \"VO2 Max\"\t\t\t\t\t},\n\t{ 0x2a97, \"Waist Circumference\"\t\t\t\t},\n\t{ 0x2a98, \"Weight\"\t\t\t\t\t},\n\t{ 0x2a99, \"Database Change Increment\"\t\t\t},\n\t{ 0x2a9a, \"User Index\"\t\t\t\t\t},\n\t{ 0x2a9b, \"Body Composition Feature\"\t\t\t},\n\t{ 0x2a9c, \"Body Composition Measurement\"\t\t},\n\t{ 0x2a9d, \"Weight Measurement\"\t\t\t\t},\n\t{ 0x2a9e, \"Weight Scale Feature\"\t\t\t},\n\t{ 0x2a9f, \"User Control Point\"\t\t\t\t},\n\t{ 0x2aa0, \"Magnetic Flux Density - 2D\"\t\t\t},\n\t{ 0x2aa1, \"Magnetic Flux Density - 3D\"\t\t\t},\n\t{ 0x2aa2, \"Language\"\t\t\t\t\t},\n\t{ 0x2aa3, \"Barometric Pressure Trend\"\t\t\t},\n\t{ 0x2aa4, \"Bond Management Control Point\"\t\t},\n\t{ 0x2aa5, \"Bond Management Feature\"\t\t\t},\n\t{ 0x2aa6, \"Central Address Resolution\"\t\t\t},\n\t{ 0x2aa7, \"CGM Measurement\"\t\t\t\t},\n\t{ 0x2aa8, \"CGM Feature\"\t\t\t\t\t},\n\t{ 0x2aa9, \"CGM Status\"\t\t\t\t\t},\n\t{ 0x2aaa, \"CGM Session Start Time\"\t\t\t},\n\t{ 0x2aab, \"CGM Session Run Time\"\t\t\t},\n\t{ 0x2aac, \"CGM Specific Ops Control Point\"\t\t},\n\t{ 0x2aad, \"Indoor Positioning Configuration\"\t\t},\n\t{ 0x2aae, \"Latitude\"\t\t\t\t\t},\n\t{ 0x2aaf, \"Longitude\"\t\t\t\t\t},\n\t{ 0x2ab0, \"Local North Coordinate\"\t\t\t},\n\t{ 0x2ab1, \"Local East Coordinate\"\t\t\t},\n\t{ 0x2ab2, \"Floor Number\"\t\t\t\t},\n\t{ 0x2ab3, \"Altitude\"\t\t\t\t\t},\n\t{ 0x2ab4, \"Uncertainty\"\t\t\t\t\t},\n\t{ 0x2ab5, \"Location Name\"\t\t\t\t},\n\t{ 0x2ab6, \"URI\"\t\t\t\t\t\t},\n\t{ 0x2ab7, \"HTTP Headers\"\t\t\t\t},\n\t{ 0x2ab8, \"HTTP Status Code\"\t\t\t\t},\n\t{ 0x2ab9, \"HTTP Entity Body\"\t\t\t\t},\n\t{ 0x2aba, \"HTTP Control Point\"\t\t\t\t},\n\t{ 0x2abb, \"HTTPS Security\"\t\t\t\t},\n\t{ 0x2abc, \"TDS Control Point\"\t\t\t\t},\n\t{ 0x2abd, \"OTS Feature\"\t\t\t\t\t},\n\t{ 0x2abe, \"Object Name\"\t\t\t\t\t},\n\t{ 0x2abf, \"Object Type\"\t\t\t\t\t},\n\t{ 0x2ac0, \"Object Size\"\t\t\t\t\t},\n\t{ 0x2ac1, \"Object First-Created\"\t\t\t},\n\t{ 0x2ac2, \"Object Last-Modified\"\t\t\t},\n\t{ 0x2ac3, \"Object ID\"\t\t\t\t\t},\n\t{ 0x2ac4, \"Object Properties\"\t\t\t\t},\n\t{ 0x2ac5, \"Object Action Control Point\"\t\t\t},\n\t{ 0x2ac6, \"Object List Control Point\"\t\t\t},\n\t{ 0x2ac7, \"Object List Filter\"\t\t\t\t},\n\t{ 0x2ac8, \"Object Changed\"\t\t\t\t},\n\t{ 0x2ac9, \"Resolvable Private Address Only\"\t\t},\n\t/* 0x2aca and 0x2acb undefined */\n\t{ 0x2acc, \"Fitness Machine Feature\"\t\t\t},\n\t{ 0x2acd, \"Treadmill Data\"\t\t\t\t},\n\t{ 0x2ace, \"Cross Trainer Data\"\t\t\t\t},\n\t{ 0x2acf, \"Step Climber Data\"\t\t\t\t},\n\t{ 0x2ad0, \"Stair Climber Data\"\t\t\t\t},\n\t{ 0x2ad1, \"Rower Data\"\t\t\t\t\t},\n\t{ 0x2ad2, \"Indoor Bike Data\"\t\t\t\t},\n\t{ 0x2ad3, \"Training Status\"\t\t\t\t},\n\t{ 0x2ad4, \"Supported Speed Range\"\t\t\t},\n\t{ 0x2ad5, \"Supported Inclination Range\"\t\t\t},\n\t{ 0x2ad6, \"Supported Resistance Level Range\"\t\t},\n\t{ 0x2ad7, \"Supported Heart Rate Range\"\t\t\t},\n\t{ 0x2ad8, \"Supported Power Range\"\t\t\t},\n\t{ 0x2ad9, \"Fitness Machine Control Point\"\t\t},\n\t{ 0x2ada, \"Fitness Machine Status\"\t\t\t},\n\t{ 0x2adb, \"Mesh Provisioning Data In\"\t\t\t},\n\t{ 0x2adc, \"Mesh Provisioning Data Out\"\t\t\t},\n\t{ 0x2add, \"Mesh Proxy Data In\"\t\t\t\t},\n\t{ 0x2ade, \"Mesh Proxy Data Out\"\t\t\t\t},\n\t/* vendor defined */\n\t{ 0xfeff, \"GN Netcom\"\t\t\t\t\t},\n\t{ 0xfefe, \"GN ReSound A/S\"\t\t\t\t},\n\t{ 0xfefd, \"Gimbal, Inc.\"\t\t\t\t},\n\t{ 0xfefc, \"Gimbal, Inc.\"\t\t\t\t},\n\t{ 0xfefb, \"Stollmann E+V GmbH\"\t\t\t\t},\n\t{ 0xfefa, \"PayPal, Inc.\"\t\t\t\t},\n\t{ 0xfef9, \"PayPal, Inc.\"\t\t\t\t},\n\t{ 0xfef8, \"Aplix Corporation\"\t\t\t\t},\n\t{ 0xfef7, \"Aplix Corporation\"\t\t\t\t},\n\t{ 0xfef6, \"Wicentric, Inc.\"\t\t\t\t},\n\t{ 0xfef5, \"Dialog Semiconductor GmbH\"\t\t\t},\n\t{ 0xfef4, \"Google\"\t\t\t\t\t},\n\t{ 0xfef3, \"Google\"\t\t\t\t\t},\n\t{ 0xfef2, \"CSR\"\t\t\t\t\t\t},\n\t{ 0xfef1, \"CSR\"\t\t\t\t\t\t},\n\t{ 0xfef0, \"Intel\"\t\t\t\t\t},\n\t{ 0xfeef, \"Polar Electro Oy\"\t\t\t\t},\n\t{ 0xfeee, \"Polar Electro Oy\"\t\t\t\t},\n\t{ 0xfeed, \"Tile, Inc.\"\t\t\t\t\t},\n\t{ 0xfeec, \"Tile, Inc.\"\t\t\t\t\t},\n\t{ 0xfeeb, \"Swirl Networks, Inc.\"\t\t\t},\n\t{ 0xfeea, \"Swirl Networks, Inc.\"\t\t\t},\n\t{ 0xfee9, \"Quintic Corp.\"\t\t\t\t},\n\t{ 0xfee8, \"Quintic Corp.\"\t\t\t\t},\n\t{ 0xfee7, \"Tencent Holdings Limited\"\t\t\t},\n\t{ 0xfee6, \"Seed Labs, Inc.\"\t\t\t\t},\n\t{ 0xfee5, \"Nordic Semiconductor ASA\"\t\t\t},\n\t{ 0xfee4, \"Nordic Semiconductor ASA\"\t\t\t},\n\t{ 0xfee3, \"Anki, Inc.\"\t\t\t\t\t},\n\t{ 0xfee2, \"Anki, Inc.\"\t\t\t\t\t},\n\t{ 0xfee1, \"Anhui Huami Information Technology Co.\"\t},\n\t{ 0xfee0, \"Anhui Huami Information Technology Co.\"\t},\n\t{ 0xfedf, \"Design SHIFT\"\t\t\t\t},\n\t{ 0xfede, \"Coin, Inc.\"\t\t\t\t\t},\n\t{ 0xfedd, \"Jawbone\"\t\t\t\t\t},\n\t{ 0xfedc, \"Jawbone\"\t\t\t\t\t},\n\t{ 0xfedb, \"Perka, Inc.\"\t\t\t\t\t},\n\t{ 0xfeda, \"ISSC Technologies Corporation\"\t\t},\n\t{ 0xfed9, \"Pebble Technology Corporation\"\t\t},\n\t{ 0xfed8, \"Google\"\t\t\t\t\t},\n\t{ 0xfed7, \"Broadcom Corporation\"\t\t\t},\n\t{ 0xfed6, \"Broadcom Corporation\"\t\t\t},\n\t{ 0xfed5, \"Plantronics Inc.\"\t\t\t\t},\n\t{ 0xfed4, \"Apple, Inc.\"\t\t\t\t\t},\n\t{ 0xfed3, \"Apple, Inc.\"\t\t\t\t\t},\n\t{ 0xfed2, \"Apple, Inc.\"\t\t\t\t\t},\n\t{ 0xfed1, \"Apple, Inc.\"\t\t\t\t\t},\n\t{ 0xfed0, \"Apple, Inc.\"\t\t\t\t\t},\n\t{ 0xfecf, \"Apple, Inc.\"\t\t\t\t\t},\n\t{ 0xfece, \"Apple, Inc.\"\t\t\t\t\t},\n\t{ 0xfecd, \"Apple, Inc.\"\t\t\t\t\t},\n\t{ 0xfecc, \"Apple, Inc.\"\t\t\t\t\t},\n\t{ 0xfecb, \"Apple, Inc.\"\t\t\t\t\t},\n\t{ 0xfeca, \"Apple, Inc.\"\t\t\t\t\t},\n\t{ 0xfec9, \"Apple, Inc.\"\t\t\t\t\t},\n\t{ 0xfec8, \"Apple, Inc.\"\t\t\t\t\t},\n\t{ 0xfec7, \"Apple, Inc.\"\t\t\t\t\t},\n\t{ 0xfec6, \"Kocomojo, LLC\"\t\t\t\t},\n\t{ 0xfec5, \"Realtek Semiconductor Corp.\"\t\t\t},\n\t{ 0xfec4, \"PLUS Location Systems\"\t\t\t},\n\t{ 0xfec3, \"360fly, Inc.\"\t\t\t\t},\n\t{ 0xfec2, \"Blue Spark Technologies, Inc.\"\t\t},\n\t{ 0xfec1, \"KDDI Corporation\"\t\t\t\t},\n\t{ 0xfec0, \"KDDI Corporation\"\t\t\t\t},\n\t{ 0xfebf, \"Nod, Inc.\"\t\t\t\t\t},\n\t{ 0xfebe, \"Bose Corporation\"\t\t\t\t},\n\t{ 0xfebd, \"Clover Network, Inc.\"\t\t\t},\n\t{ 0xfebc, \"Dexcom, Inc.\"\t\t\t\t},\n\t{ 0xfebb, \"adafruit industries\"\t\t\t\t},\n\t{ 0xfeba, \"Tencent Holdings Limited\"\t\t\t},\n\t{ 0xfeb9, \"LG Electronics\"\t\t\t\t},\n\t{ 0xfeb8, \"Facebook, Inc.\"\t\t\t\t},\n\t{ 0xfeb7, \"Facebook, Inc.\"\t\t\t\t},\n\t{ 0xfeb6, \"Vencer Co, Ltd\"\t\t\t\t},\n\t{ 0xfeb5, \"WiSilica Inc.\"\t\t\t\t},\n\t{ 0xfeb4, \"WiSilica Inc.\"\t\t\t\t},\n\t{ 0xfeb3, \"Taobao\"\t\t\t\t\t},\n\t{ 0xfeb2, \"Microsoft Corporation\"\t\t\t},\n\t{ 0xfeb1, \"Electronics Tomorrow Limited\"\t\t},\n\t{ 0xfeb0, \"Nest Labs Inc.\"\t\t\t\t},\n\t{ 0xfeaf, \"Nest Labs Inc.\"\t\t\t\t},\n\t{ 0xfeae, \"Nokia Corporation\"\t\t\t\t},\n\t{ 0xfead, \"Nokia Corporation\"\t\t\t\t},\n\t{ 0xfeac, \"Nokia Corporation\"\t\t\t\t},\n\t{ 0xfeab, \"Nokia Corporation\"\t\t\t\t},\n\t{ 0xfeaa, \"Google\"\t\t\t\t\t},\n\t{ 0xfea9, \"Savant Systems LLC\"\t\t\t\t},\n\t{ 0xfea8, \"Savant Systems LLC\"\t\t\t\t},\n\t{ 0xfea7, \"UTC Fire and Security\"\t\t\t},\n\t{ 0xfea6, \"GoPro, Inc.\"\t\t\t\t\t},\n\t{ 0xfea5, \"GoPro, Inc.\"\t\t\t\t\t},\n\t{ 0xfea4, \"Paxton Access Ltd\"\t\t\t\t},\n\t{ 0xfea3, \"ITT Industries\"\t\t\t\t},\n\t{ 0xfea2, \"Intrepid Control Systems, Inc.\"\t\t},\n\t{ 0xfea1, \"Intrepid Control Systems, Inc.\"\t\t},\n\t{ 0xfea0, \"Google\"\t\t\t\t\t},\n\t{ 0xfe9f, \"Google\"\t\t\t\t\t},\n\t{ 0xfe9e, \"Dialog Semiconductor B.V.\"\t\t\t},\n\t{ 0xfe9d, \"Mobiquity Networks Inc\"\t\t\t},\n\t{ 0xfe9c, \"GSI Laboratories, Inc.\"\t\t\t},\n\t{ 0xfe9b, \"Samsara Networks, Inc\"\t\t\t},\n\t{ 0xfe9a, \"Estimote\"\t\t\t\t\t},\n\t{ 0xfe99, \"Currant, Inc.\"\t\t\t\t},\n\t{ 0xfe98, \"Currant, Inc.\"\t\t\t\t},\n\t{ 0xfe97, \"Tesla Motor Inc.\"\t\t\t\t},\n\t{ 0xfe96, \"Tesla Motor Inc.\"\t\t\t\t},\n\t{ 0xfe95, \"Xiaomi Inc.\"\t\t\t\t\t},\n\t{ 0xfe94, \"OttoQ Inc.\"\t\t\t\t\t},\n\t{ 0xfe93, \"OttoQ Inc.\"\t\t\t\t\t},\n\t{ 0xfe92, \"Jarden Safety & Security\"\t\t\t},\n\t{ 0xfe91, \"Shanghai Imilab Technology Co.,Ltd\"\t\t},\n\t{ 0xfe90, \"JUMA\"\t\t\t\t\t},\n\t{ 0xfe8f, \"CSR\"\t\t\t\t\t\t},\n\t{ 0xfe8e, \"ARM Ltd\"\t\t\t\t\t},\n\t{ 0xfe8d, \"Interaxon Inc.\"\t\t\t\t},\n\t{ 0xfe8c, \"TRON Forum\"\t\t\t\t\t},\n\t{ 0xfe8b, \"Apple, Inc.\"\t\t\t\t\t},\n\t{ 0xfe8a, \"Apple, Inc.\"\t\t\t\t\t},\n\t{ 0xfe89, \"B&O Play A/S\"\t\t\t\t},\n\t{ 0xfe88, \"SALTO SYSTEMS S.L.\"\t\t\t\t},\n\t{ 0xfe87, \"Qingdao Yeelink Information Technology Co., Ltd. (  )\"\t},\n\t{ 0xfe86, \"HUAWEI Technologies Co., Ltd. (  )\"\t\t\t\t\t},\n\t{ 0xfe85, \"RF Digital Corp\"\t\t\t\t},\n\t{ 0xfe84, \"RF Digital Corp\"\t\t\t\t},\n\t{ 0xfe83, \"Blue Bite\"\t\t\t\t\t},\n\t{ 0xfe82, \"Medtronic Inc.\"\t\t\t\t},\n\t{ 0xfe81, \"Medtronic Inc.\"\t\t\t\t},\n\t{ 0xfe80, \"Doppler Lab\"\t\t\t\t\t},\n\t{ 0xfe7f, \"Doppler Lab\"\t\t\t\t\t},\n\t{ 0xfe7e, \"Awear Solutions Ltd\"\t\t\t\t},\n\t{ 0xfe7d, \"Aterica Health Inc.\"\t\t\t\t},\n\t{ 0xfe7c, \"Stollmann E+V GmbH\"\t\t\t\t},\n\t{ 0xfe7b, \"Orion Labs, Inc.\"\t\t\t\t},\n\t{ 0xfe7a, \"Bragi GmbH\"\t\t\t\t\t},\n\t{ 0xfe79, \"Zebra Technologies\"\t\t\t\t},\n\t{ 0xfe78, \"Hewlett-Packard Company\"\t\t\t},\n\t{ 0xfe77, \"Hewlett-Packard Company\"\t\t\t},\n\t{ 0xfe76, \"TangoMe\"\t\t\t\t\t},\n\t{ 0xfe75, \"TangoMe\"\t\t\t\t\t},\n\t{ 0xfe74, \"unwire\"\t\t\t\t\t},\n\t{ 0xfe73, \"St. Jude Medical, Inc.\"\t\t\t},\n\t{ 0xfe72, \"St. Jude Medical, Inc.\"\t\t\t},\n\t{ 0xfe71, \"Plume Design Inc\"\t\t\t\t},\n\t{ 0xfe70, \"Beijing Jingdong Century Trading Co., Ltd.\"\t},\n\t{ 0xfe6f, \"LINE Corporation\"\t\t\t\t},\n\t{ 0xfe6e, \"The University of Tokyo\"\t\t\t},\n\t{ 0xfe6d, \"The University of Tokyo\"\t\t\t},\n\t{ 0xfe6c, \"TASER International, Inc.\"\t\t\t},\n\t{ 0xfe6b, \"TASER International, Inc.\"\t\t\t},\n\t{ 0xfe6a, \"Kontakt Micro-Location Sp. z o.o.\"\t\t},\n\t{ 0xfe69, \"Qualcomm Life Inc\"\t\t\t\t},\n\t{ 0xfe68, \"Qualcomm Life Inc\"\t\t\t\t},\n\t{ 0xfe67, \"Lab Sensor Solutions\"\t\t\t},\n\t{ 0xfe66, \"Intel Corporation\"\t\t\t\t},\n\t{ 0xfe65, \"CHIPOLO d.o.o.\"\t\t\t\t},\n\t{ 0xfe64, \"Siemens AG\"\t\t\t\t\t},\n\t{ 0xfe63, \"Connected Yard, Inc.\"\t\t\t},\n\t{ 0xfe62, \"Indagem Tech LLC\"\t\t\t\t},\n\t{ 0xfe61, \"Logitech International SA\"\t\t\t},\n\t{ 0xfe60, \"Lierda Science & Technology Group Co., Ltd.\"\t},\n\t{ 0xfe5F, \"Eyefi, Inc.\"\t\t\t\t\t},\n\t{ 0xfe5E, \"Plastc Corporation\"\t\t\t\t},\n\t{ 0xfe5D, \"Grundfos A/S\"\t\t\t\t},\n\t{ 0xfe5C, \"million hunters GmbH\"\t\t\t},\n\t{ 0xfe5B, \"GT-tronics HK Ltd\"\t\t\t\t},\n\t{ 0xfe5A, \"Chronologics Corporation\"\t\t\t},\n\t{ 0xfe59, \"Nordic Semiconductor ASA\"\t\t\t},\n\t{ 0xfe58, \"Nordic Semiconductor ASA\"\t\t\t},\n\t{ 0xfe57, \"Dotted Labs\"\t\t\t\t\t},\n\t{ 0xfe56, \"Google Inc.\"\t\t\t\t\t},\n\t{ 0xfe55, \"Google Inc.\"\t\t\t\t\t},\n\t{ 0xfe54, \"Motiv, Inc.\"\t\t\t\t\t},\n\t{ 0xfe53, \"3M\"\t\t\t\t\t\t},\n\t{ 0xfe52, \"SetPoint Medical\"\t\t\t\t},\n\t{ 0xfe51, \"SRAM\"\t\t\t\t\t},\n\t{ 0xfe50, \"Google Inc.\"\t\t\t\t\t},\n\t{ 0xfe4F, \"Molekule, Inc.\"\t\t\t\t},\n\t{ 0xfe4E, \"NTT docomo\"\t\t\t\t\t},\n\t{ 0xfe4D, \"Casambi Technologies Oy\"\t\t\t},\n\t{ 0xfe4C, \"Volkswagen AG\"\t\t\t\t},\n\t{ 0xfe4B, \"Koninklijke Philips N.V.\"\t\t\t},\n\t{ 0xfe4A, \"OMRON HEALTHCARE Co., Ltd.\"\t\t\t},\n\t{ 0xfe49, \"SenionLab AB\"\t\t\t\t},\n\t{ 0xfe48, \"General Motors\"\t\t\t\t},\n\t{ 0xfe47, \"General Motors\"\t\t\t\t},\n\t{ 0xfe46, \"B&O Play A/S\"\t\t\t\t},\n\t{ 0xfe45, \"Snapchat Inc\"\t\t\t\t},\n\t{ 0xfe44, \"SK Telecom\"\t\t\t\t\t},\n\t{ 0xfe43, \"Andreas Stihl AG & Co. KG\"\t\t\t},\n\t{ 0xfe42, \"Nets A/S\"\t\t\t\t\t},\n\t{ 0xfe41, \"Inugo Systems Limited\"\t\t\t},\n\t{ 0xfe40, \"Inugo Systems Limited\"\t\t\t},\n\t{ 0xfe3F, \"Friday Labs Limited\"\t\t\t\t},\n\t{ 0xfe3E, \"BD Medical\"\t\t\t\t\t},\n\t{ 0xfe3D, \"BD Medical\"\t\t\t\t\t},\n\t{ 0xfe3C, \"Alibaba\"\t\t\t\t\t},\n\t{ 0xfe3B, \"Dolby Laboratories\"\t\t\t\t},\n\t{ 0xfe3A, \"TTS Tooltechnic Systems AG & Co. KG\"\t\t},\n\t{ 0xfe39, \"TTS Tooltechnic Systems AG & Co. KG\"\t\t},\n\t{ 0xfe38, \"Spaceek LTD\"\t\t\t\t\t},\n\t{ 0xfe37, \"Spaceek LTD\"\t\t\t\t\t},\n\t{ 0xfe36, \"HUAWEI Technologies Co., Ltd\"\t\t},\n\t{ 0xfe35, \"HUAWEI Technologies Co., Ltd\"\t\t},\n\t{ 0xfe34, \"SmallLoop LLC\"\t\t\t\t},\n\t{ 0xfe33, \"CHIPOLO d.o.o.\"\t\t\t\t},\n\t{ 0xfe32, \"Pro-Mark, Inc.\"\t\t\t\t},\n\t{ 0xfe31, \"Volkswagen AG\"\t\t\t\t},\n\t{ 0xfe30, \"Volkswagen AG\"\t\t\t\t},\n\t{ 0xfe2F, \"CRESCO Wireless, Inc\"\t\t\t},\n\t{ 0xfe2E, \"ERi,Inc.\"\t\t\t\t\t},\n\t{ 0xfe2D, \"SMART INNOVATION Co.,Ltd\"\t\t\t},\n\t{ 0xfe2C, \"Google Inc.\"\t\t\t\t\t},\n\t{ 0xfe2B, \"ITT Industries\"\t\t\t\t},\n\t{ 0xfe2A, \"DaisyWorks, Inc.\"\t\t\t\t},\n\t{ 0xfe29, \"Gibson Innovations\"\t\t\t\t},\n\t{ 0xfe28, \"Ayla Network\"\t\t\t\t},\n\t{ 0xfe27, \"Google Inc.\"\t\t\t\t\t},\n\t{ 0xfe26, \"Google Inc.\"\t\t\t\t\t},\n\t{ 0xfe25, \"Apple, Inc.\"\t\t\t\t\t},\n\t{ 0xfe24, \"August Home Inc\"\t\t\t\t},\n\t{ 0xfe23, \"Zoll Medical Corporation\"\t\t\t},\n\t{ 0xfe22, \"Zoll Medical Corporation\"\t\t\t},\n\t{ 0xfe21, \"Bose Corporation\"\t\t\t\t},\n\t{ 0xfe20, \"Emerson\"\t\t\t\t\t},\n\t{ 0xfe1F, \"Garmin International, Inc.\"\t\t\t},\n\t{ 0xfe1E, \"Smart Innovations Co., Ltd\"\t\t\t},\n\t{ 0xfe1D, \"Illuminati Instrument Corporation\"\t\t},\n\t{ 0xfe1C, \"NetMedia, Inc.\"\t\t\t\t},\n\t/* SDO defined */\n\t{ 0xfffc, \"AirFuel Alliance\"\t\t\t\t},\n\t{ 0xfffe, \"Alliance for Wireless Power (A4WP)\"\t\t},\n\t{ 0xfffd, \"Fast IDentity Online Alliance (FIDO)\"\t},\n\t{ }\n};\n\nconst char *bt_uuid16_to_str(uint16_t uuid)\n{\n\tint i;\n\n\tfor (i = 0; uuid16_table[i].str; i++) {\n\t\tif (uuid16_table[i].uuid == uuid)\n\t\t\treturn uuid16_table[i].str;\n\t}\n\n\treturn \"Unknown\";\n}"
        }
      },
      {
        "call_info": {
          "callee": "gatt_db_attribute_get_service_uuid",
          "args": [
            "attr",
            "&uuid"
          ],
          "line": 769
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_attribute_get_service_uuid",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "1490-1519",
          "snippet": "bool gatt_db_attribute_get_service_uuid(const struct gatt_db_attribute *attrib,\n\t\t\t\t\t\t\tbt_uuid_t *uuid)\n{\n\tstruct gatt_db_service *service;\n\n\tif (!attrib || !uuid)\n\t\treturn false;\n\n\tservice = attrib->service;\n\n\tif (service->attributes[0]->value_len == sizeof(uint16_t)) {\n\t\tuint16_t value;\n\n\t\tvalue = get_le16(service->attributes[0]->value);\n\t\tbt_uuid16_create(uuid, value);\n\n\t\treturn true;\n\t}\n\n\tif (service->attributes[0]->value_len == sizeof(uint128_t)) {\n\t\tuint128_t value;\n\n\t\tbswap_128(service->attributes[0]->value, &value);\n\t\tbt_uuid128_create(uuid, value);\n\n\t\treturn true;\n\t}\n\n\treturn false;\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nbool gatt_db_attribute_get_service_uuid(const struct gatt_db_attribute *attrib,\n\t\t\t\t\t\t\tbt_uuid_t *uuid)\n{\n\tstruct gatt_db_service *service;\n\n\tif (!attrib || !uuid)\n\t\treturn false;\n\n\tservice = attrib->service;\n\n\tif (service->attributes[0]->value_len == sizeof(uint16_t)) {\n\t\tuint16_t value;\n\n\t\tvalue = get_le16(service->attributes[0]->value);\n\t\tbt_uuid16_create(uuid, value);\n\n\t\treturn true;\n\t}\n\n\tif (service->attributes[0]->value_len == sizeof(uint128_t)) {\n\t\tuint128_t value;\n\n\t\tbswap_128(service->attributes[0]->value, &value);\n\t\tbt_uuid128_create(uuid, value);\n\n\t\treturn true;\n\t}\n\n\treturn false;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\n#define UUID_GAP\t0x1800\n\nstatic void database_add_record(struct btd_gatt_database *database,\n\t\t\t\t\tstruct gatt_db_attribute *attr)\n{\n\tstruct gatt_record *rec;\n\tsdp_record_t *record;\n\tuint16_t start, end;\n\tuuid_t svc, gap_uuid;\n\tbt_uuid_t uuid;\n\tconst char *name = NULL;\n\tchar uuidstr[MAX_LEN_UUID_STR];\n\n\tgatt_db_attribute_get_service_uuid(attr, &uuid);\n\n\tswitch (uuid.type) {\n\tcase BT_UUID16:\n\t\tname = bt_uuid16_to_str(uuid.value.u16);\n\t\tsdp_uuid16_create(&svc, uuid.value.u16);\n\t\tbreak;\n\tcase BT_UUID32:\n\t\tname = bt_uuid32_to_str(uuid.value.u32);\n\t\tsdp_uuid32_create(&svc, uuid.value.u32);\n\t\tbreak;\n\tcase BT_UUID128:\n\t\tbt_uuid_to_string(&uuid, uuidstr, sizeof(uuidstr));\n\t\tname = bt_uuidstr_to_str(uuidstr);\n\t\tsdp_uuid128_create(&svc, (void *) &uuid.value.u128);\n\t\tbreak;\n\tcase BT_UUID_UNSPEC:\n\t\treturn;\n\t}\n\n\tgatt_db_attribute_get_service_handles(attr, &start, &end);\n\n\trecord = record_new(&svc, start, end);\n\tif (!record)\n\t\treturn;\n\n\tif (name != NULL)\n\t\tsdp_set_info_attr(record, name, \"BlueZ\", NULL);\n\n\tsdp_uuid16_create(&gap_uuid, UUID_GAP);\n\tif (sdp_uuid_cmp(&svc, &gap_uuid) == 0) {\n\t\tsdp_set_url_attr(record, \"http://www.bluez.org/\",\n\t\t\t\t\"http://www.bluez.org/\",\n\t\t\t\t\"http://www.bluez.org/\");\n\t}\n\n\tif (adapter_service_add(database->adapter, record) < 0) {\n\t\tsdp_record_free(record);\n\t\treturn;\n\t}\n\n\trec = new0(struct gatt_record, 1);\n\trec->database = database;\n\trec->handle = record->handle;\n\trec->attr = attr;\n\tqueue_push_tail(database->records, rec);\n}"
  },
  {
    "function_name": "record_new",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
    "lines": "703-756",
    "snippet": "static sdp_record_t *record_new(uuid_t *uuid, uint16_t start, uint16_t end)\n{\n\tsdp_list_t *svclass_id, *apseq, *proto[2], *root, *aproto;\n\tuuid_t root_uuid, proto_uuid, l2cap;\n\tsdp_record_t *record;\n\tsdp_data_t *psm, *sh, *eh;\n\tuint16_t lp = ATT_PSM;\n\n\tif (uuid == NULL)\n\t\treturn NULL;\n\n\tif (start > end)\n\t\treturn NULL;\n\n\trecord = sdp_record_alloc();\n\tif (record == NULL)\n\t\treturn NULL;\n\n\tsdp_uuid16_create(&root_uuid, PUBLIC_BROWSE_GROUP);\n\troot = sdp_list_append(NULL, &root_uuid);\n\tsdp_set_browse_groups(record, root);\n\tsdp_list_free(root, NULL);\n\n\tsvclass_id = sdp_list_append(NULL, uuid);\n\tsdp_set_service_classes(record, svclass_id);\n\tsdp_list_free(svclass_id, NULL);\n\n\tsdp_uuid16_create(&l2cap, L2CAP_UUID);\n\tproto[0] = sdp_list_append(NULL, &l2cap);\n\tpsm = sdp_data_alloc(SDP_UINT16, &lp);\n\tproto[0] = sdp_list_append(proto[0], psm);\n\tapseq = sdp_list_append(NULL, proto[0]);\n\n\tsdp_uuid16_create(&proto_uuid, ATT_UUID);\n\tproto[1] = sdp_list_append(NULL, &proto_uuid);\n\tsh = sdp_data_alloc(SDP_UINT16, &start);\n\tproto[1] = sdp_list_append(proto[1], sh);\n\teh = sdp_data_alloc(SDP_UINT16, &end);\n\tproto[1] = sdp_list_append(proto[1], eh);\n\tapseq = sdp_list_append(apseq, proto[1]);\n\n\taproto = sdp_list_append(NULL, apseq);\n\tsdp_set_access_protos(record, aproto);\n\n\tsdp_data_free(psm);\n\tsdp_data_free(sh);\n\tsdp_data_free(eh);\n\tsdp_list_free(proto[0], NULL);\n\tsdp_list_free(proto[1], NULL);\n\tsdp_list_free(apseq, NULL);\n\tsdp_list_free(aproto, NULL);\n\n\treturn record;\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"dbus-common.h\"",
      "#include \"gatt-database.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define ATT_PSM 31"
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "sdp_list_free",
          "args": [
            "aproto",
            "NULL"
          ],
          "line": 753
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_list_free",
          "args": [
            "apseq",
            "NULL"
          ],
          "line": 752
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_list_free",
          "args": [
            "proto[1]",
            "NULL"
          ],
          "line": 751
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_list_free",
          "args": [
            "proto[0]",
            "NULL"
          ],
          "line": 750
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_data_free",
          "args": [
            "eh"
          ],
          "line": 749
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_data_free",
          "args": [
            "sh"
          ],
          "line": 748
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_data_free",
          "args": [
            "psm"
          ],
          "line": 747
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_set_access_protos",
          "args": [
            "record",
            "aproto"
          ],
          "line": 745
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_list_append",
          "args": [
            "NULL",
            "apseq"
          ],
          "line": 744
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_list_append",
          "args": [
            "apseq",
            "proto[1]"
          ],
          "line": 742
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_list_append",
          "args": [
            "proto[1]",
            "eh"
          ],
          "line": 741
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_data_alloc",
          "args": [
            "SDP_UINT16",
            "&end"
          ],
          "line": 740
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_list_append",
          "args": [
            "proto[1]",
            "sh"
          ],
          "line": 739
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_data_alloc",
          "args": [
            "SDP_UINT16",
            "&start"
          ],
          "line": 738
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_list_append",
          "args": [
            "NULL",
            "&proto_uuid"
          ],
          "line": 737
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_uuid16_create",
          "args": [
            "&proto_uuid",
            "ATT_UUID"
          ],
          "line": 736
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_list_append",
          "args": [
            "NULL",
            "proto[0]"
          ],
          "line": 734
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_list_append",
          "args": [
            "proto[0]",
            "psm"
          ],
          "line": 733
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_data_alloc",
          "args": [
            "SDP_UINT16",
            "&lp"
          ],
          "line": 732
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_list_append",
          "args": [
            "NULL",
            "&l2cap"
          ],
          "line": 731
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_uuid16_create",
          "args": [
            "&l2cap",
            "L2CAP_UUID"
          ],
          "line": 730
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_list_free",
          "args": [
            "svclass_id",
            "NULL"
          ],
          "line": 728
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_set_service_classes",
          "args": [
            "record",
            "svclass_id"
          ],
          "line": 727
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_list_append",
          "args": [
            "NULL",
            "uuid"
          ],
          "line": 726
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_list_free",
          "args": [
            "root",
            "NULL"
          ],
          "line": 724
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_set_browse_groups",
          "args": [
            "record",
            "root"
          ],
          "line": 723
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_list_append",
          "args": [
            "NULL",
            "&root_uuid"
          ],
          "line": 722
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_uuid16_create",
          "args": [
            "&root_uuid",
            "PUBLIC_BROWSE_GROUP"
          ],
          "line": 721
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_record_alloc",
          "args": [],
          "line": 717
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\n#define ATT_PSM 31\n\nstatic sdp_record_t *record_new(uuid_t *uuid, uint16_t start, uint16_t end)\n{\n\tsdp_list_t *svclass_id, *apseq, *proto[2], *root, *aproto;\n\tuuid_t root_uuid, proto_uuid, l2cap;\n\tsdp_record_t *record;\n\tsdp_data_t *psm, *sh, *eh;\n\tuint16_t lp = ATT_PSM;\n\n\tif (uuid == NULL)\n\t\treturn NULL;\n\n\tif (start > end)\n\t\treturn NULL;\n\n\trecord = sdp_record_alloc();\n\tif (record == NULL)\n\t\treturn NULL;\n\n\tsdp_uuid16_create(&root_uuid, PUBLIC_BROWSE_GROUP);\n\troot = sdp_list_append(NULL, &root_uuid);\n\tsdp_set_browse_groups(record, root);\n\tsdp_list_free(root, NULL);\n\n\tsvclass_id = sdp_list_append(NULL, uuid);\n\tsdp_set_service_classes(record, svclass_id);\n\tsdp_list_free(svclass_id, NULL);\n\n\tsdp_uuid16_create(&l2cap, L2CAP_UUID);\n\tproto[0] = sdp_list_append(NULL, &l2cap);\n\tpsm = sdp_data_alloc(SDP_UINT16, &lp);\n\tproto[0] = sdp_list_append(proto[0], psm);\n\tapseq = sdp_list_append(NULL, proto[0]);\n\n\tsdp_uuid16_create(&proto_uuid, ATT_UUID);\n\tproto[1] = sdp_list_append(NULL, &proto_uuid);\n\tsh = sdp_data_alloc(SDP_UINT16, &start);\n\tproto[1] = sdp_list_append(proto[1], sh);\n\teh = sdp_data_alloc(SDP_UINT16, &end);\n\tproto[1] = sdp_list_append(proto[1], eh);\n\tapseq = sdp_list_append(apseq, proto[1]);\n\n\taproto = sdp_list_append(NULL, apseq);\n\tsdp_set_access_protos(record, aproto);\n\n\tsdp_data_free(psm);\n\tsdp_data_free(sh);\n\tsdp_data_free(eh);\n\tsdp_list_free(proto[0], NULL);\n\tsdp_list_free(proto[1], NULL);\n\tsdp_list_free(apseq, NULL);\n\tsdp_list_free(aproto, NULL);\n\n\treturn record;\n}"
  },
  {
    "function_name": "gap_appearance_read_cb",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
    "lines": "672-701",
    "snippet": "static void gap_appearance_read_cb(struct gatt_db_attribute *attrib,\n\t\t\t\t\tunsigned int id, uint16_t offset,\n\t\t\t\t\tuint8_t opcode, struct bt_att *att,\n\t\t\t\t\tvoid *user_data)\n{\n\tstruct btd_gatt_database *database = user_data;\n\tuint8_t error = 0;\n\tsize_t len = 2;\n\tconst uint8_t *value = NULL;\n\tuint8_t appearance[2];\n\tuint32_t dev_class;\n\n\tDBG(\"GAP Appearance read request\\n\");\n\n\tdev_class = btd_adapter_get_class(database->adapter);\n\n\tif (offset > 2) {\n\t\terror = BT_ATT_ERROR_INVALID_OFFSET;\n\t\tgoto done;\n\t}\n\n\tappearance[0] = dev_class & 0x00ff;\n\tappearance[1] = (dev_class >> 8) & 0x001f;\n\n\tlen -= offset;\n\tvalue = len ? &appearance[offset] : NULL;\n\ndone:\n\tgatt_db_attribute_read_result(attrib, id, error, value, len);\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"dbus-common.h\"",
      "#include \"gatt-database.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "gatt_db_attribute_read_result",
          "args": [
            "attrib",
            "id",
            "error",
            "value",
            "len"
          ],
          "line": 700
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_attribute_read_result",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "1773-1790",
          "snippet": "bool gatt_db_attribute_read_result(struct gatt_db_attribute *attrib,\n\t\t\t\t\tunsigned int id, int err,\n\t\t\t\t\tconst uint8_t *value, size_t length)\n{\n\tstruct pending_read *p;\n\n\tif (!attrib || !id)\n\t\treturn false;\n\n\tp = queue_remove_if(attrib->pending_reads, find_pending,\n\t\t\t\t\t\t\tUINT_TO_PTR(id));\n\tif (!p)\n\t\treturn false;\n\n\tpending_read_result(p, err, value, length);\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nbool gatt_db_attribute_read_result(struct gatt_db_attribute *attrib,\n\t\t\t\t\tunsigned int id, int err,\n\t\t\t\t\tconst uint8_t *value, size_t length)\n{\n\tstruct pending_read *p;\n\n\tif (!attrib || !id)\n\t\treturn false;\n\n\tp = queue_remove_if(attrib->pending_reads, find_pending,\n\t\t\t\t\t\t\tUINT_TO_PTR(id));\n\tif (!p)\n\t\treturn false;\n\n\tpending_read_result(p, err, value, length);\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_adapter_get_class",
          "args": [
            "database->adapter"
          ],
          "line": 686
        },
        "resolved": true,
        "details": {
          "function_name": "btd_adapter_get_class",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "4454-4457",
          "snippet": "uint32_t btd_adapter_get_class(struct btd_adapter *adapter)\n{\n\treturn adapter->dev_class;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void trigger_pairable_timeout(struct btd_adapter *adapter);",
            "static void adapter_start(struct btd_adapter *adapter);",
            "static void adapter_stop(struct btd_adapter *adapter);",
            "static void trigger_passive_scanning(struct btd_adapter *adapter);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void trigger_pairable_timeout(struct btd_adapter *adapter);\nstatic void adapter_start(struct btd_adapter *adapter);\nstatic void adapter_stop(struct btd_adapter *adapter);\nstatic void trigger_passive_scanning(struct btd_adapter *adapter);\n\nuint32_t btd_adapter_get_class(struct btd_adapter *adapter)\n{\n\treturn adapter->dev_class;\n}"
        }
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"GAP Appearance read request\\n\""
          ],
          "line": 684
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic void gap_appearance_read_cb(struct gatt_db_attribute *attrib,\n\t\t\t\t\tunsigned int id, uint16_t offset,\n\t\t\t\t\tuint8_t opcode, struct bt_att *att,\n\t\t\t\t\tvoid *user_data)\n{\n\tstruct btd_gatt_database *database = user_data;\n\tuint8_t error = 0;\n\tsize_t len = 2;\n\tconst uint8_t *value = NULL;\n\tuint8_t appearance[2];\n\tuint32_t dev_class;\n\n\tDBG(\"GAP Appearance read request\\n\");\n\n\tdev_class = btd_adapter_get_class(database->adapter);\n\n\tif (offset > 2) {\n\t\terror = BT_ATT_ERROR_INVALID_OFFSET;\n\t\tgoto done;\n\t}\n\n\tappearance[0] = dev_class & 0x00ff;\n\tappearance[1] = (dev_class >> 8) & 0x001f;\n\n\tlen -= offset;\n\tvalue = len ? &appearance[offset] : NULL;\n\ndone:\n\tgatt_db_attribute_read_result(attrib, id, error, value, len);\n}"
  },
  {
    "function_name": "gap_device_name_read_cb",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
    "lines": "644-670",
    "snippet": "static void gap_device_name_read_cb(struct gatt_db_attribute *attrib,\n\t\t\t\t\tunsigned int id, uint16_t offset,\n\t\t\t\t\tuint8_t opcode, struct bt_att *att,\n\t\t\t\t\tvoid *user_data)\n{\n\tstruct btd_gatt_database *database = user_data;\n\tuint8_t error = 0;\n\tsize_t len = 0;\n\tconst uint8_t *value = NULL;\n\tconst char *device_name;\n\n\tDBG(\"GAP Device Name read request\\n\");\n\n\tdevice_name = btd_adapter_get_name(database->adapter);\n\tlen = strlen(device_name);\n\n\tif (offset > len) {\n\t\terror = BT_ATT_ERROR_INVALID_OFFSET;\n\t\tgoto done;\n\t}\n\n\tlen -= offset;\n\tvalue = len ? (const uint8_t *) &device_name[offset] : NULL;\n\ndone:\n\tgatt_db_attribute_read_result(attrib, id, error, value, len);\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"dbus-common.h\"",
      "#include \"gatt-database.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "gatt_db_attribute_read_result",
          "args": [
            "attrib",
            "id",
            "error",
            "value",
            "len"
          ],
          "line": 669
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_attribute_read_result",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "1773-1790",
          "snippet": "bool gatt_db_attribute_read_result(struct gatt_db_attribute *attrib,\n\t\t\t\t\tunsigned int id, int err,\n\t\t\t\t\tconst uint8_t *value, size_t length)\n{\n\tstruct pending_read *p;\n\n\tif (!attrib || !id)\n\t\treturn false;\n\n\tp = queue_remove_if(attrib->pending_reads, find_pending,\n\t\t\t\t\t\t\tUINT_TO_PTR(id));\n\tif (!p)\n\t\treturn false;\n\n\tpending_read_result(p, err, value, length);\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nbool gatt_db_attribute_read_result(struct gatt_db_attribute *attrib,\n\t\t\t\t\tunsigned int id, int err,\n\t\t\t\t\tconst uint8_t *value, size_t length)\n{\n\tstruct pending_read *p;\n\n\tif (!attrib || !id)\n\t\treturn false;\n\n\tp = queue_remove_if(attrib->pending_reads, find_pending,\n\t\t\t\t\t\t\tUINT_TO_PTR(id));\n\tif (!p)\n\t\treturn false;\n\n\tpending_read_result(p, err, value, length);\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "device_name"
          ],
          "line": 658
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_adapter_get_name",
          "args": [
            "database->adapter"
          ],
          "line": 657
        },
        "resolved": true,
        "details": {
          "function_name": "btd_adapter_get_name",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "4459-4468",
          "snippet": "const char *btd_adapter_get_name(struct btd_adapter *adapter)\n{\n\tif (adapter->stored_alias)\n\t\treturn adapter->stored_alias;\n\n\tif (adapter->system_name)\n\t\treturn adapter->system_name;\n\n\treturn NULL;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void trigger_pairable_timeout(struct btd_adapter *adapter);",
            "static void adapter_start(struct btd_adapter *adapter);",
            "static void adapter_stop(struct btd_adapter *adapter);",
            "static void trigger_passive_scanning(struct btd_adapter *adapter);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void trigger_pairable_timeout(struct btd_adapter *adapter);\nstatic void adapter_start(struct btd_adapter *adapter);\nstatic void adapter_stop(struct btd_adapter *adapter);\nstatic void trigger_passive_scanning(struct btd_adapter *adapter);\n\nconst char *btd_adapter_get_name(struct btd_adapter *adapter)\n{\n\tif (adapter->stored_alias)\n\t\treturn adapter->stored_alias;\n\n\tif (adapter->system_name)\n\t\treturn adapter->system_name;\n\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"GAP Device Name read request\\n\""
          ],
          "line": 655
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic void gap_device_name_read_cb(struct gatt_db_attribute *attrib,\n\t\t\t\t\tunsigned int id, uint16_t offset,\n\t\t\t\t\tuint8_t opcode, struct bt_att *att,\n\t\t\t\t\tvoid *user_data)\n{\n\tstruct btd_gatt_database *database = user_data;\n\tuint8_t error = 0;\n\tsize_t len = 0;\n\tconst uint8_t *value = NULL;\n\tconst char *device_name;\n\n\tDBG(\"GAP Device Name read request\\n\");\n\n\tdevice_name = btd_adapter_get_name(database->adapter);\n\tlen = strlen(device_name);\n\n\tif (offset > len) {\n\t\terror = BT_ATT_ERROR_INVALID_OFFSET;\n\t\tgoto done;\n\t}\n\n\tlen -= offset;\n\tvalue = len ? (const uint8_t *) &device_name[offset] : NULL;\n\ndone:\n\tgatt_db_attribute_read_result(attrib, id, error, value, len);\n}"
  },
  {
    "function_name": "connect_cb",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
    "lines": "608-642",
    "snippet": "static void connect_cb(GIOChannel *io, GError *gerr, gpointer user_data)\n{\n\tstruct btd_adapter *adapter;\n\tstruct btd_device *device;\n\tuint8_t dst_type;\n\tbdaddr_t src, dst;\n\n\tif (gerr) {\n\t\terror(\"%s\", gerr->message);\n\t\treturn;\n\t}\n\n\tbt_io_get(io, &gerr, BT_IO_OPT_SOURCE_BDADDR, &src,\n\t\t\t\t\t\tBT_IO_OPT_DEST_BDADDR, &dst,\n\t\t\t\t\t\tBT_IO_OPT_DEST_TYPE, &dst_type,\n\t\t\t\t\t\tBT_IO_OPT_INVALID);\n\tif (gerr) {\n\t\terror(\"bt_io_get: %s\", gerr->message);\n\t\tg_error_free(gerr);\n\t\treturn;\n\t}\n\n\tDBG(\"New incoming %s ATT connection\", dst_type == BDADDR_BREDR ?\n\t\t\t\t\t\t\t\"BR/EDR\" : \"LE\");\n\n\tadapter = adapter_find(&src);\n\tif (!adapter)\n\t\treturn;\n\n\tdevice = btd_adapter_get_device(adapter, &dst, dst_type);\n\tif (!device)\n\t\treturn;\n\n\tdevice_attach_att(device, io);\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"dbus-common.h\"",
      "#include \"gatt-database.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "device_attach_att",
          "args": [
            "device",
            "io"
          ],
          "line": 641
        },
        "resolved": true,
        "details": {
          "function_name": "device_attach_att",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "4952-5033",
          "snippet": "bool device_attach_att(struct btd_device *dev, GIOChannel *io)\n{\n\tGError *gerr = NULL;\n\tGAttrib *attrib;\n\tBtIOSecLevel sec_level;\n\tuint16_t mtu;\n\tuint16_t cid;\n\tstruct btd_gatt_database *database;\n\tconst bdaddr_t *dst;\n\tchar dstaddr[18];\n\n\tbt_io_get(io, &gerr, BT_IO_OPT_SEC_LEVEL, &sec_level,\n\t\t\t\t\t\tBT_IO_OPT_IMTU, &mtu,\n\t\t\t\t\t\tBT_IO_OPT_CID, &cid,\n\t\t\t\t\t\tBT_IO_OPT_INVALID);\n\n\tif (gerr) {\n\t\terror(\"bt_io_get: %s\", gerr->message);\n\t\tg_error_free(gerr);\n\t\treturn false;\n\t}\n\n\tif (sec_level == BT_IO_SEC_LOW && dev->le_state.paired) {\n\t\tDBG(\"Elevating security level since LTK is available\");\n\n\t\tsec_level = BT_IO_SEC_MEDIUM;\n\t\tbt_io_set(io, &gerr, BT_IO_OPT_SEC_LEVEL, sec_level,\n\t\t\t\t\t\t\tBT_IO_OPT_INVALID);\n\t\tif (gerr) {\n\t\t\terror(\"bt_io_set: %s\", gerr->message);\n\t\t\tg_error_free(gerr);\n\t\t\treturn false;\n\t\t}\n\t}\n\n\tdev->att_mtu = MIN(mtu, main_opts.gatt_mtu);\n\tattrib = g_attrib_new(io,\n\t\t\tcid == ATT_CID ? BT_ATT_DEFAULT_LE_MTU : dev->att_mtu,\n\t\t\tfalse);\n\tif (!attrib) {\n\t\terror(\"Unable to create new GAttrib instance\");\n\t\treturn false;\n\t}\n\n\tdev->attrib = attrib;\n\tdev->att = g_attrib_get_att(attrib);\n\n\tbt_att_ref(dev->att);\n\n\tdev->att_disconn_id = bt_att_register_disconnect(dev->att,\n\t\t\t\t\t\tatt_disconnected_cb, dev, NULL);\n\tbt_att_set_close_on_unref(dev->att, true);\n\n\tif (dev->local_csrk)\n\t\tbt_att_set_local_key(dev->att, dev->local_csrk->key,\n\t\t\t\t\t\t\tlocal_counter, dev);\n\n\tif (dev->remote_csrk)\n\t\tbt_att_set_remote_key(dev->att, dev->remote_csrk->key,\n\t\t\t\t\t\t\tremote_counter, dev);\n\n\tdatabase = btd_adapter_get_database(dev->adapter);\n\n\tdst = device_get_address(dev);\n\tba2str(dst, dstaddr);\n\n\tif (gatt_db_isempty(dev->db))\n\t\tload_gatt_db(dev, btd_adapter_get_storage_dir(dev->adapter),\n\t\t\t\t\t\t\t\tdstaddr);\n\n\tgatt_client_init(dev);\n\tgatt_server_init(dev, database);\n\n\t/*\n\t * Remove the device from the connect_list and give the passive\n\t * scanning another chance to be restarted in case there are\n\t * other devices in the connect_list.\n\t */\n\tadapter_connect_list_remove(dev->adapter, dev);\n\n\treturn true;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nbool device_attach_att(struct btd_device *dev, GIOChannel *io)\n{\n\tGError *gerr = NULL;\n\tGAttrib *attrib;\n\tBtIOSecLevel sec_level;\n\tuint16_t mtu;\n\tuint16_t cid;\n\tstruct btd_gatt_database *database;\n\tconst bdaddr_t *dst;\n\tchar dstaddr[18];\n\n\tbt_io_get(io, &gerr, BT_IO_OPT_SEC_LEVEL, &sec_level,\n\t\t\t\t\t\tBT_IO_OPT_IMTU, &mtu,\n\t\t\t\t\t\tBT_IO_OPT_CID, &cid,\n\t\t\t\t\t\tBT_IO_OPT_INVALID);\n\n\tif (gerr) {\n\t\terror(\"bt_io_get: %s\", gerr->message);\n\t\tg_error_free(gerr);\n\t\treturn false;\n\t}\n\n\tif (sec_level == BT_IO_SEC_LOW && dev->le_state.paired) {\n\t\tDBG(\"Elevating security level since LTK is available\");\n\n\t\tsec_level = BT_IO_SEC_MEDIUM;\n\t\tbt_io_set(io, &gerr, BT_IO_OPT_SEC_LEVEL, sec_level,\n\t\t\t\t\t\t\tBT_IO_OPT_INVALID);\n\t\tif (gerr) {\n\t\t\terror(\"bt_io_set: %s\", gerr->message);\n\t\t\tg_error_free(gerr);\n\t\t\treturn false;\n\t\t}\n\t}\n\n\tdev->att_mtu = MIN(mtu, main_opts.gatt_mtu);\n\tattrib = g_attrib_new(io,\n\t\t\tcid == ATT_CID ? BT_ATT_DEFAULT_LE_MTU : dev->att_mtu,\n\t\t\tfalse);\n\tif (!attrib) {\n\t\terror(\"Unable to create new GAttrib instance\");\n\t\treturn false;\n\t}\n\n\tdev->attrib = attrib;\n\tdev->att = g_attrib_get_att(attrib);\n\n\tbt_att_ref(dev->att);\n\n\tdev->att_disconn_id = bt_att_register_disconnect(dev->att,\n\t\t\t\t\t\tatt_disconnected_cb, dev, NULL);\n\tbt_att_set_close_on_unref(dev->att, true);\n\n\tif (dev->local_csrk)\n\t\tbt_att_set_local_key(dev->att, dev->local_csrk->key,\n\t\t\t\t\t\t\tlocal_counter, dev);\n\n\tif (dev->remote_csrk)\n\t\tbt_att_set_remote_key(dev->att, dev->remote_csrk->key,\n\t\t\t\t\t\t\tremote_counter, dev);\n\n\tdatabase = btd_adapter_get_database(dev->adapter);\n\n\tdst = device_get_address(dev);\n\tba2str(dst, dstaddr);\n\n\tif (gatt_db_isempty(dev->db))\n\t\tload_gatt_db(dev, btd_adapter_get_storage_dir(dev->adapter),\n\t\t\t\t\t\t\t\tdstaddr);\n\n\tgatt_client_init(dev);\n\tgatt_server_init(dev, database);\n\n\t/*\n\t * Remove the device from the connect_list and give the passive\n\t * scanning another chance to be restarted in case there are\n\t * other devices in the connect_list.\n\t */\n\tadapter_connect_list_remove(dev->adapter, dev);\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_adapter_get_device",
          "args": [
            "adapter",
            "&dst",
            "dst_type"
          ],
          "line": 637
        },
        "resolved": true,
        "details": {
          "function_name": "btd_adapter_get_device",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "1235-1249",
          "snippet": "struct btd_device *btd_adapter_get_device(struct btd_adapter *adapter,\n\t\t\t\t\tconst bdaddr_t *addr,\n\t\t\t\t\tuint8_t addr_type)\n{\n\tstruct btd_device *device;\n\n\tif (!adapter)\n\t\treturn NULL;\n\n\tdevice = btd_adapter_find_device(adapter, addr, addr_type);\n\tif (device)\n\t\treturn device;\n\n\treturn adapter_create_device(adapter, addr, addr_type);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void trigger_pairable_timeout(struct btd_adapter *adapter);",
            "static void adapter_start(struct btd_adapter *adapter);",
            "static void adapter_stop(struct btd_adapter *adapter);",
            "static void trigger_passive_scanning(struct btd_adapter *adapter);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void trigger_pairable_timeout(struct btd_adapter *adapter);\nstatic void adapter_start(struct btd_adapter *adapter);\nstatic void adapter_stop(struct btd_adapter *adapter);\nstatic void trigger_passive_scanning(struct btd_adapter *adapter);\n\nstruct btd_device *btd_adapter_get_device(struct btd_adapter *adapter,\n\t\t\t\t\tconst bdaddr_t *addr,\n\t\t\t\t\tuint8_t addr_type)\n{\n\tstruct btd_device *device;\n\n\tif (!adapter)\n\t\treturn NULL;\n\n\tdevice = btd_adapter_find_device(adapter, addr, addr_type);\n\tif (device)\n\t\treturn device;\n\n\treturn adapter_create_device(adapter, addr, addr_type);\n}"
        }
      },
      {
        "call_info": {
          "callee": "adapter_find",
          "args": [
            "&src"
          ],
          "line": 633
        },
        "resolved": true,
        "details": {
          "function_name": "adapter_find_by_id",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "8013-8023",
          "snippet": "struct btd_adapter *adapter_find_by_id(int id)\n{\n\tGSList *match;\n\n\tmatch = g_slist_find_custom(adapters, GINT_TO_POINTER(id),\n\t\t\t\t\t\t\tadapter_id_cmp);\n\tif (!match)\n\t\treturn NULL;\n\n\treturn match->data;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static GSList *adapters = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic GSList *adapters = NULL;\n\nstruct btd_adapter *adapter_find_by_id(int id)\n{\n\tGSList *match;\n\n\tmatch = g_slist_find_custom(adapters, GINT_TO_POINTER(id),\n\t\t\t\t\t\t\tadapter_id_cmp);\n\tif (!match)\n\t\treturn NULL;\n\n\treturn match->data;\n}"
        }
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"New incoming %s ATT connection\"",
            "dst_type == BDADDR_BREDR ?\n\t\t\t\t\t\t\t\"BR/EDR\" : \"LE\""
          ],
          "line": 630
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_error_free",
          "args": [
            "gerr"
          ],
          "line": 626
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"bt_io_get: %s\"",
            "gerr->message"
          ],
          "line": 625
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_failed",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "124-128",
          "snippet": "DBusMessage *btd_error_failed(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE\n\t\t\t\t\t\".Failed\", \"%s\", str);\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_failed(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE\n\t\t\t\t\t\".Failed\", \"%s\", str);\n}"
        }
      },
      {
        "call_info": {
          "callee": "bt_io_get",
          "args": [
            "io",
            "&gerr",
            "BT_IO_OPT_SOURCE_BDADDR",
            "&src",
            "BT_IO_OPT_DEST_BDADDR",
            "&dst",
            "BT_IO_OPT_DEST_TYPE",
            "&dst_type",
            "BT_IO_OPT_INVALID"
          ],
          "line": 620
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic void connect_cb(GIOChannel *io, GError *gerr, gpointer user_data)\n{\n\tstruct btd_adapter *adapter;\n\tstruct btd_device *device;\n\tuint8_t dst_type;\n\tbdaddr_t src, dst;\n\n\tif (gerr) {\n\t\terror(\"%s\", gerr->message);\n\t\treturn;\n\t}\n\n\tbt_io_get(io, &gerr, BT_IO_OPT_SOURCE_BDADDR, &src,\n\t\t\t\t\t\tBT_IO_OPT_DEST_BDADDR, &dst,\n\t\t\t\t\t\tBT_IO_OPT_DEST_TYPE, &dst_type,\n\t\t\t\t\t\tBT_IO_OPT_INVALID);\n\tif (gerr) {\n\t\terror(\"bt_io_get: %s\", gerr->message);\n\t\tg_error_free(gerr);\n\t\treturn;\n\t}\n\n\tDBG(\"New incoming %s ATT connection\", dst_type == BDADDR_BREDR ?\n\t\t\t\t\t\t\t\"BR/EDR\" : \"LE\");\n\n\tadapter = adapter_find(&src);\n\tif (!adapter)\n\t\treturn;\n\n\tdevice = btd_adapter_get_device(adapter, &dst, dst_type);\n\tif (!device)\n\t\treturn;\n\n\tdevice_attach_att(device, io);\n}"
  },
  {
    "function_name": "gatt_database_free",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
    "lines": "577-606",
    "snippet": "static void gatt_database_free(void *data)\n{\n\tstruct btd_gatt_database *database = data;\n\n\tif (database->le_io) {\n\t\tg_io_channel_shutdown(database->le_io, FALSE, NULL);\n\t\tg_io_channel_unref(database->le_io);\n\t}\n\n\tif (database->l2cap_io) {\n\t\tg_io_channel_shutdown(database->l2cap_io, FALSE, NULL);\n\t\tg_io_channel_unref(database->l2cap_io);\n\t}\n\n\t/* TODO: Persistently store CCC states before freeing them */\n\tgatt_db_unregister(database->db, database->db_id);\n\n\tqueue_destroy(database->records, gatt_record_free);\n\tqueue_destroy(database->device_states, device_state_free);\n\tqueue_destroy(database->apps, app_free);\n\tqueue_destroy(database->profiles, profile_free);\n\tqueue_destroy(database->ccc_callbacks, ccc_cb_free);\n\tdatabase->device_states = NULL;\n\tdatabase->ccc_callbacks = NULL;\n\n\tgatt_db_unref(database->db);\n\n\tbtd_adapter_unref(database->adapter);\n\tfree(database);\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"dbus-common.h\"",
      "#include \"gatt-database.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "database"
          ],
          "line": 605
        },
        "resolved": true,
        "details": {
          "function_name": "app_free_idle_cb",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "1303-1308",
          "snippet": "static gboolean app_free_idle_cb(void *data)\n{\n\tapp_free(data);\n\n\treturn FALSE;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic gboolean app_free_idle_cb(void *data)\n{\n\tapp_free(data);\n\n\treturn FALSE;\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_adapter_unref",
          "args": [
            "database->adapter"
          ],
          "line": 604
        },
        "resolved": true,
        "details": {
          "function_name": "btd_adapter_unref",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "4905-4921",
          "snippet": "void btd_adapter_unref(struct btd_adapter *adapter)\n{\n\tif (__sync_sub_and_fetch(&adapter->ref_count, 1))\n\t\treturn;\n\n\tif (!adapter->path) {\n\t\tDBG(\"Freeing adapter %u\", adapter->dev_id);\n\n\t\tadapter_free(adapter);\n\t\treturn;\n\t}\n\n\tDBG(\"Freeing adapter %s\", adapter->path);\n\n\tg_dbus_unregister_interface(dbus_conn, adapter->path,\n\t\t\t\t\t\tADAPTER_INTERFACE);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define ADAPTER_INTERFACE\t\"org.bluez.Adapter1\""
          ],
          "globals_used": [
            "static DBusConnection *dbus_conn = NULL;",
            "static void trigger_pairable_timeout(struct btd_adapter *adapter);",
            "static void adapter_start(struct btd_adapter *adapter);",
            "static void adapter_stop(struct btd_adapter *adapter);",
            "static void trigger_passive_scanning(struct btd_adapter *adapter);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\n#define ADAPTER_INTERFACE\t\"org.bluez.Adapter1\"\n\nstatic DBusConnection *dbus_conn = NULL;\nstatic void trigger_pairable_timeout(struct btd_adapter *adapter);\nstatic void adapter_start(struct btd_adapter *adapter);\nstatic void adapter_stop(struct btd_adapter *adapter);\nstatic void trigger_passive_scanning(struct btd_adapter *adapter);\n\nvoid btd_adapter_unref(struct btd_adapter *adapter)\n{\n\tif (__sync_sub_and_fetch(&adapter->ref_count, 1))\n\t\treturn;\n\n\tif (!adapter->path) {\n\t\tDBG(\"Freeing adapter %u\", adapter->dev_id);\n\n\t\tadapter_free(adapter);\n\t\treturn;\n\t}\n\n\tDBG(\"Freeing adapter %s\", adapter->path);\n\n\tg_dbus_unregister_interface(dbus_conn, adapter->path,\n\t\t\t\t\t\tADAPTER_INTERFACE);\n}"
        }
      },
      {
        "call_info": {
          "callee": "gatt_db_unref",
          "args": [
            "database->db"
          ],
          "line": 602
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_unref",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "316-325",
          "snippet": "void gatt_db_unref(struct gatt_db *db)\n{\n\tif (!db)\n\t\treturn;\n\n\tif (__sync_sub_and_fetch(&db->ref_count, 1))\n\t\treturn;\n\n\tgatt_db_destroy(db);\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nvoid gatt_db_unref(struct gatt_db *db)\n{\n\tif (!db)\n\t\treturn;\n\n\tif (__sync_sub_and_fetch(&db->ref_count, 1))\n\t\treturn;\n\n\tgatt_db_destroy(db);\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_destroy",
          "args": [
            "database->ccc_callbacks",
            "ccc_cb_free"
          ],
          "line": 598
        },
        "resolved": true,
        "details": {
          "function_name": "queue_destroy",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "68-76",
          "snippet": "void queue_destroy(struct queue *queue, queue_destroy_func_t destroy)\n{\n\tif (!queue)\n\t\treturn;\n\n\tqueue_remove_all(queue, NULL, NULL, destroy);\n\n\tqueue_unref(queue);\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nvoid queue_destroy(struct queue *queue, queue_destroy_func_t destroy)\n{\n\tif (!queue)\n\t\treturn;\n\n\tqueue_remove_all(queue, NULL, NULL, destroy);\n\n\tqueue_unref(queue);\n}"
        }
      },
      {
        "call_info": {
          "callee": "gatt_db_unregister",
          "args": [
            "database->db",
            "database->db_id"
          ],
          "line": 592
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_unregister",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "622-637",
          "snippet": "bool gatt_db_unregister(struct gatt_db *db, unsigned int id)\n{\n\tstruct notify *notify;\n\n\tif (!db || !id)\n\t\treturn false;\n\n\tnotify = queue_find(db->notify_list, match_notify_id, UINT_TO_PTR(id));\n\tif (!notify)\n\t\treturn false;\n\n\tqueue_remove(db->notify_list, notify);\n\tnotify_destroy(notify);\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nbool gatt_db_unregister(struct gatt_db *db, unsigned int id)\n{\n\tstruct notify *notify;\n\n\tif (!db || !id)\n\t\treturn false;\n\n\tnotify = queue_find(db->notify_list, match_notify_id, UINT_TO_PTR(id));\n\tif (!notify)\n\t\treturn false;\n\n\tqueue_remove(db->notify_list, notify);\n\tnotify_destroy(notify);\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_io_channel_unref",
          "args": [
            "database->l2cap_io"
          ],
          "line": 588
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_io_channel_shutdown",
          "args": [
            "database->l2cap_io",
            "FALSE",
            "NULL"
          ],
          "line": 587
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_io_channel_unref",
          "args": [
            "database->le_io"
          ],
          "line": 583
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_io_channel_shutdown",
          "args": [
            "database->le_io",
            "FALSE",
            "NULL"
          ],
          "line": 582
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic void gatt_database_free(void *data)\n{\n\tstruct btd_gatt_database *database = data;\n\n\tif (database->le_io) {\n\t\tg_io_channel_shutdown(database->le_io, FALSE, NULL);\n\t\tg_io_channel_unref(database->le_io);\n\t}\n\n\tif (database->l2cap_io) {\n\t\tg_io_channel_shutdown(database->l2cap_io, FALSE, NULL);\n\t\tg_io_channel_unref(database->l2cap_io);\n\t}\n\n\t/* TODO: Persistently store CCC states before freeing them */\n\tgatt_db_unregister(database->db, database->db_id);\n\n\tqueue_destroy(database->records, gatt_record_free);\n\tqueue_destroy(database->device_states, device_state_free);\n\tqueue_destroy(database->apps, app_free);\n\tqueue_destroy(database->profiles, profile_free);\n\tqueue_destroy(database->ccc_callbacks, ccc_cb_free);\n\tdatabase->device_states = NULL;\n\tdatabase->ccc_callbacks = NULL;\n\n\tgatt_db_unref(database->db);\n\n\tbtd_adapter_unref(database->adapter);\n\tfree(database);\n}"
  },
  {
    "function_name": "gatt_record_free",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
    "lines": "569-575",
    "snippet": "static void gatt_record_free(void *data)\n{\n\tstruct gatt_record *rec = data;\n\n\tadapter_service_remove(rec->database->adapter, rec->handle);\n\tfree(rec);\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"dbus-common.h\"",
      "#include \"gatt-database.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "rec"
          ],
          "line": 574
        },
        "resolved": true,
        "details": {
          "function_name": "app_free_idle_cb",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "1303-1308",
          "snippet": "static gboolean app_free_idle_cb(void *data)\n{\n\tapp_free(data);\n\n\treturn FALSE;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic gboolean app_free_idle_cb(void *data)\n{\n\tapp_free(data);\n\n\treturn FALSE;\n}"
        }
      },
      {
        "call_info": {
          "callee": "adapter_service_remove",
          "args": [
            "rec->database->adapter",
            "rec->handle"
          ],
          "line": 573
        },
        "resolved": true,
        "details": {
          "function_name": "adapter_service_remove",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "1144-1159",
          "snippet": "void adapter_service_remove(struct btd_adapter *adapter, uint32_t handle)\n{\n\tsdp_record_t *rec = sdp_record_find(handle);\n\n\tDBG(\"%s\", adapter->path);\n\n\tif (!rec)\n\t\treturn;\n\n\tadapter->services = sdp_list_remove(adapter->services, rec);\n\n\tif (sdp_list_find(adapter->services, &rec->svclass, uuid_cmp) == NULL)\n\t\tremove_uuid(adapter, &rec->svclass);\n\n\tremove_record_from_server(rec->handle);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void trigger_pairable_timeout(struct btd_adapter *adapter);",
            "static void adapter_start(struct btd_adapter *adapter);",
            "static void adapter_stop(struct btd_adapter *adapter);",
            "static void trigger_passive_scanning(struct btd_adapter *adapter);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void trigger_pairable_timeout(struct btd_adapter *adapter);\nstatic void adapter_start(struct btd_adapter *adapter);\nstatic void adapter_stop(struct btd_adapter *adapter);\nstatic void trigger_passive_scanning(struct btd_adapter *adapter);\n\nvoid adapter_service_remove(struct btd_adapter *adapter, uint32_t handle)\n{\n\tsdp_record_t *rec = sdp_record_find(handle);\n\n\tDBG(\"%s\", adapter->path);\n\n\tif (!rec)\n\t\treturn;\n\n\tadapter->services = sdp_list_remove(adapter->services, rec);\n\n\tif (sdp_list_find(adapter->services, &rec->svclass, uuid_cmp) == NULL)\n\t\tremove_uuid(adapter, &rec->svclass);\n\n\tremove_record_from_server(rec->handle);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic void gatt_record_free(void *data)\n{\n\tstruct gatt_record *rec = data;\n\n\tadapter_service_remove(rec->database->adapter, rec->handle);\n\tfree(rec);\n}"
  },
  {
    "function_name": "app_free",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
    "lines": "544-567",
    "snippet": "static void app_free(void *data)\n{\n\tstruct gatt_app *app = data;\n\n\tqueue_destroy(app->profiles, profile_free);\n\tqueue_destroy(app->services, service_free);\n\tqueue_destroy(app->proxies, NULL);\n\n\tif (app->client) {\n\t\tg_dbus_client_set_disconnect_watch(app->client, NULL, NULL);\n\t\tg_dbus_client_set_proxy_handlers(app->client, NULL, NULL,\n\t\t\t\t\t\t\t\tNULL, NULL);\n\t\tg_dbus_client_set_ready_watch(app->client, NULL, NULL);\n\t\tg_dbus_client_unref(app->client);\n\t}\n\n\tif (app->reg)\n\t\tdbus_message_unref(app->reg);\n\n\tg_free(app->owner);\n\tg_free(app->path);\n\n\tfree(app);\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"dbus-common.h\"",
      "#include \"gatt-database.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "app"
          ],
          "line": 566
        },
        "resolved": true,
        "details": {
          "function_name": "app_free_idle_cb",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "1303-1308",
          "snippet": "static gboolean app_free_idle_cb(void *data)\n{\n\tapp_free(data);\n\n\treturn FALSE;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic gboolean app_free_idle_cb(void *data)\n{\n\tapp_free(data);\n\n\treturn FALSE;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_free",
          "args": [
            "app->path"
          ],
          "line": 564
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_free",
          "args": [
            "app->owner"
          ],
          "line": 563
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_unref",
          "args": [
            "app->reg"
          ],
          "line": 561
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_dbus_client_unref",
          "args": [
            "app->client"
          ],
          "line": 557
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_dbus_client_set_ready_watch",
          "args": [
            "app->client",
            "NULL",
            "NULL"
          ],
          "line": 556
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_dbus_client_set_proxy_handlers",
          "args": [
            "app->client",
            "NULL",
            "NULL",
            "NULL",
            "NULL"
          ],
          "line": 554
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_dbus_client_set_disconnect_watch",
          "args": [
            "app->client",
            "NULL",
            "NULL"
          ],
          "line": 553
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "queue_destroy",
          "args": [
            "app->proxies",
            "NULL"
          ],
          "line": 550
        },
        "resolved": true,
        "details": {
          "function_name": "queue_destroy",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "68-76",
          "snippet": "void queue_destroy(struct queue *queue, queue_destroy_func_t destroy)\n{\n\tif (!queue)\n\t\treturn;\n\n\tqueue_remove_all(queue, NULL, NULL, destroy);\n\n\tqueue_unref(queue);\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nvoid queue_destroy(struct queue *queue, queue_destroy_func_t destroy)\n{\n\tif (!queue)\n\t\treturn;\n\n\tqueue_remove_all(queue, NULL, NULL, destroy);\n\n\tqueue_unref(queue);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic void app_free(void *data)\n{\n\tstruct gatt_app *app = data;\n\n\tqueue_destroy(app->profiles, profile_free);\n\tqueue_destroy(app->services, service_free);\n\tqueue_destroy(app->proxies, NULL);\n\n\tif (app->client) {\n\t\tg_dbus_client_set_disconnect_watch(app->client, NULL, NULL);\n\t\tg_dbus_client_set_proxy_handlers(app->client, NULL, NULL,\n\t\t\t\t\t\t\t\tNULL, NULL);\n\t\tg_dbus_client_set_ready_watch(app->client, NULL, NULL);\n\t\tg_dbus_client_unref(app->client);\n\t}\n\n\tif (app->reg)\n\t\tdbus_message_unref(app->reg);\n\n\tg_free(app->owner);\n\tg_free(app->path);\n\n\tfree(app);\n}"
  },
  {
    "function_name": "profile_free",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
    "lines": "531-542",
    "snippet": "static void profile_free(void *data)\n{\n\tstruct external_profile *profile = data;\n\n\tqueue_destroy(profile->profiles, profile_remove);\n\n\tprofile_release(profile);\n\n\tg_dbus_proxy_unref(profile->proxy);\n\n\tfree(profile);\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"dbus-common.h\"",
      "#include \"gatt-database.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "profile"
          ],
          "line": 541
        },
        "resolved": true,
        "details": {
          "function_name": "app_free_idle_cb",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "1303-1308",
          "snippet": "static gboolean app_free_idle_cb(void *data)\n{\n\tapp_free(data);\n\n\treturn FALSE;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic gboolean app_free_idle_cb(void *data)\n{\n\tapp_free(data);\n\n\treturn FALSE;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_dbus_proxy_unref",
          "args": [
            "profile->proxy"
          ],
          "line": 539
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "profile_release",
          "args": [
            "profile"
          ],
          "line": 537
        },
        "resolved": true,
        "details": {
          "function_name": "profile_release",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "523-529",
          "snippet": "static void profile_release(struct external_profile *profile)\n{\n\tDBG(\"Releasing \\\"%s\\\"\", profile->app->owner);\n\n\tg_dbus_proxy_method_call(profile->proxy, \"Release\", NULL, NULL, NULL,\n\t\t\t\t\t\t\t\t\tNULL);\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic void profile_release(struct external_profile *profile)\n{\n\tDBG(\"Releasing \\\"%s\\\"\", profile->app->owner);\n\n\tg_dbus_proxy_method_call(profile->proxy, \"Release\", NULL, NULL, NULL,\n\t\t\t\t\t\t\t\t\tNULL);\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_destroy",
          "args": [
            "profile->profiles",
            "profile_remove"
          ],
          "line": 535
        },
        "resolved": true,
        "details": {
          "function_name": "queue_destroy",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "68-76",
          "snippet": "void queue_destroy(struct queue *queue, queue_destroy_func_t destroy)\n{\n\tif (!queue)\n\t\treturn;\n\n\tqueue_remove_all(queue, NULL, NULL, destroy);\n\n\tqueue_unref(queue);\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nvoid queue_destroy(struct queue *queue, queue_destroy_func_t destroy)\n{\n\tif (!queue)\n\t\treturn;\n\n\tqueue_remove_all(queue, NULL, NULL, destroy);\n\n\tqueue_unref(queue);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic void profile_free(void *data)\n{\n\tstruct external_profile *profile = data;\n\n\tqueue_destroy(profile->profiles, profile_remove);\n\n\tprofile_release(profile);\n\n\tg_dbus_proxy_unref(profile->proxy);\n\n\tfree(profile);\n}"
  },
  {
    "function_name": "profile_release",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
    "lines": "523-529",
    "snippet": "static void profile_release(struct external_profile *profile)\n{\n\tDBG(\"Releasing \\\"%s\\\"\", profile->app->owner);\n\n\tg_dbus_proxy_method_call(profile->proxy, \"Release\", NULL, NULL, NULL,\n\t\t\t\t\t\t\t\t\tNULL);\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"dbus-common.h\"",
      "#include \"gatt-database.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_dbus_proxy_method_call",
          "args": [
            "profile->proxy",
            "\"Release\"",
            "NULL",
            "NULL",
            "NULL",
            "NULL"
          ],
          "line": 527
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"Releasing \\\"%s\\\"\"",
            "profile->app->owner"
          ],
          "line": 525
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic void profile_release(struct external_profile *profile)\n{\n\tDBG(\"Releasing \\\"%s\\\"\", profile->app->owner);\n\n\tg_dbus_proxy_method_call(profile->proxy, \"Release\", NULL, NULL, NULL,\n\t\t\t\t\t\t\t\t\tNULL);\n}"
  },
  {
    "function_name": "profile_remove",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
    "lines": "508-521",
    "snippet": "static void profile_remove(void *data)\n{\n\tstruct btd_profile *p = data;\n\n\tDBG(\"Removed \\\"%s\\\"\", p->name);\n\n\tadapter_foreach(adapter_remove_profile, p);\n\tbtd_profile_unregister(p);\n\n\tg_free((void *) p->name);\n\tg_free((void *) p->remote_uuid);\n\n\tfree(p);\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"dbus-common.h\"",
      "#include \"gatt-database.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "p"
          ],
          "line": 520
        },
        "resolved": true,
        "details": {
          "function_name": "app_free_idle_cb",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "1303-1308",
          "snippet": "static gboolean app_free_idle_cb(void *data)\n{\n\tapp_free(data);\n\n\treturn FALSE;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic gboolean app_free_idle_cb(void *data)\n{\n\tapp_free(data);\n\n\treturn FALSE;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_free",
          "args": [
            "(void *) p->remote_uuid"
          ],
          "line": 518
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_free",
          "args": [
            "(void *) p->name"
          ],
          "line": 517
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_profile_unregister",
          "args": [
            "p"
          ],
          "line": 515
        },
        "resolved": true,
        "details": {
          "function_name": "btd_profile_unregister",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/profile.c",
          "lines": "726-729",
          "snippet": "void btd_profile_unregister(struct btd_profile *profile)\n{\n\tprofiles = g_slist_remove(profiles, profile);\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdp-xml.h\"",
            "#include \"sdp-client.h\"",
            "#include \"dbus-common.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"sdpd.h\"",
            "#include \"btio/btio.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static GSList *profiles = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdp-xml.h\"\n#include \"sdp-client.h\"\n#include \"dbus-common.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"sdpd.h\"\n#include \"btio/btio.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic GSList *profiles = NULL;\n\nvoid btd_profile_unregister(struct btd_profile *profile)\n{\n\tprofiles = g_slist_remove(profiles, profile);\n}"
        }
      },
      {
        "call_info": {
          "callee": "adapter_foreach",
          "args": [
            "adapter_remove_profile",
            "p"
          ],
          "line": 514
        },
        "resolved": true,
        "details": {
          "function_name": "adapter_foreach",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "8025-8028",
          "snippet": "void adapter_foreach(adapter_cb func, gpointer user_data)\n{\n\tg_slist_foreach(adapters, (GFunc) func, user_data);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static GSList *adapters = NULL;",
            "static gboolean process_auth_queue(gpointer user_data);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic GSList *adapters = NULL;\nstatic gboolean process_auth_queue(gpointer user_data);\n\nvoid adapter_foreach(adapter_cb func, gpointer user_data)\n{\n\tg_slist_foreach(adapters, (GFunc) func, user_data);\n}"
        }
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"Removed \\\"%s\\\"\"",
            "p->name"
          ],
          "line": 512
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic void profile_remove(void *data)\n{\n\tstruct btd_profile *p = data;\n\n\tDBG(\"Removed \\\"%s\\\"\", p->name);\n\n\tadapter_foreach(adapter_remove_profile, p);\n\tbtd_profile_unregister(p);\n\n\tg_free((void *) p->name);\n\tg_free((void *) p->remote_uuid);\n\n\tfree(p);\n}"
  },
  {
    "function_name": "service_free",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
    "lines": "488-506",
    "snippet": "static void service_free(void *data)\n{\n\tstruct external_service *service = data;\n\n\tqueue_destroy(service->chrcs, chrc_free);\n\tqueue_destroy(service->descs, desc_free);\n\tqueue_destroy(service->includes, inc_free);\n\n\tif (service->attrib)\n\t\tgatt_db_remove_service(service->app->database->db,\n\t\t\t\t\t\t\tservice->attrib);\n\n\tif (service->app->client)\n\t\tg_dbus_proxy_unref(service->proxy);\n\n\tg_free(service->path);\n\n\tfree(service);\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"dbus-common.h\"",
      "#include \"gatt-database.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "service"
          ],
          "line": 505
        },
        "resolved": true,
        "details": {
          "function_name": "app_free_idle_cb",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "1303-1308",
          "snippet": "static gboolean app_free_idle_cb(void *data)\n{\n\tapp_free(data);\n\n\treturn FALSE;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic gboolean app_free_idle_cb(void *data)\n{\n\tapp_free(data);\n\n\treturn FALSE;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_free",
          "args": [
            "service->path"
          ],
          "line": 503
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_dbus_proxy_unref",
          "args": [
            "service->proxy"
          ],
          "line": 501
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "gatt_db_remove_service",
          "args": [
            "service->app->database->db",
            "service->attrib"
          ],
          "line": 497
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_remove_service",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "408-423",
          "snippet": "bool gatt_db_remove_service(struct gatt_db *db,\n\t\t\t\t\tstruct gatt_db_attribute *attrib)\n{\n\tstruct gatt_db_service *service;\n\n\tif (!db || !attrib)\n\t\treturn false;\n\n\tservice = attrib->service;\n\n\tqueue_remove(db->services, service);\n\n\tgatt_db_service_destroy(service);\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nbool gatt_db_remove_service(struct gatt_db *db,\n\t\t\t\t\tstruct gatt_db_attribute *attrib)\n{\n\tstruct gatt_db_service *service;\n\n\tif (!db || !attrib)\n\t\treturn false;\n\n\tservice = attrib->service;\n\n\tqueue_remove(db->services, service);\n\n\tgatt_db_service_destroy(service);\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_destroy",
          "args": [
            "service->includes",
            "inc_free"
          ],
          "line": 494
        },
        "resolved": true,
        "details": {
          "function_name": "queue_destroy",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "68-76",
          "snippet": "void queue_destroy(struct queue *queue, queue_destroy_func_t destroy)\n{\n\tif (!queue)\n\t\treturn;\n\n\tqueue_remove_all(queue, NULL, NULL, destroy);\n\n\tqueue_unref(queue);\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nvoid queue_destroy(struct queue *queue, queue_destroy_func_t destroy)\n{\n\tif (!queue)\n\t\treturn;\n\n\tqueue_remove_all(queue, NULL, NULL, destroy);\n\n\tqueue_unref(queue);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic void service_free(void *data)\n{\n\tstruct external_service *service = data;\n\n\tqueue_destroy(service->chrcs, chrc_free);\n\tqueue_destroy(service->descs, desc_free);\n\tqueue_destroy(service->includes, inc_free);\n\n\tif (service->attrib)\n\t\tgatt_db_remove_service(service->app->database->db,\n\t\t\t\t\t\t\tservice->attrib);\n\n\tif (service->app->client)\n\t\tg_dbus_proxy_unref(service->proxy);\n\n\tg_free(service->path);\n\n\tfree(service);\n}"
  },
  {
    "function_name": "inc_free",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
    "lines": "481-486",
    "snippet": "static void inc_free(void *data)\n{\n\tstruct external_desc *inc = data;\n\n\tfree(inc);\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"dbus-common.h\"",
      "#include \"gatt-database.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "inc"
          ],
          "line": 485
        },
        "resolved": true,
        "details": {
          "function_name": "app_free_idle_cb",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "1303-1308",
          "snippet": "static gboolean app_free_idle_cb(void *data)\n{\n\tapp_free(data);\n\n\treturn FALSE;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic gboolean app_free_idle_cb(void *data)\n{\n\tapp_free(data);\n\n\treturn FALSE;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic void inc_free(void *data)\n{\n\tstruct external_desc *inc = data;\n\n\tfree(inc);\n}"
  },
  {
    "function_name": "desc_free",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
    "lines": "468-479",
    "snippet": "static void desc_free(void *data)\n{\n\tstruct external_desc *desc = data;\n\n\tqueue_destroy(desc->pending_reads, cancel_pending_read);\n\tqueue_destroy(desc->pending_writes, cancel_pending_write);\n\n\tg_dbus_proxy_unref(desc->proxy);\n\tg_free(desc->chrc_path);\n\n\tfree(desc);\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"dbus-common.h\"",
      "#include \"gatt-database.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "desc"
          ],
          "line": 478
        },
        "resolved": true,
        "details": {
          "function_name": "app_free_idle_cb",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "1303-1308",
          "snippet": "static gboolean app_free_idle_cb(void *data)\n{\n\tapp_free(data);\n\n\treturn FALSE;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic gboolean app_free_idle_cb(void *data)\n{\n\tapp_free(data);\n\n\treturn FALSE;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_free",
          "args": [
            "desc->chrc_path"
          ],
          "line": 476
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_dbus_proxy_unref",
          "args": [
            "desc->proxy"
          ],
          "line": 475
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "queue_destroy",
          "args": [
            "desc->pending_writes",
            "cancel_pending_write"
          ],
          "line": 473
        },
        "resolved": true,
        "details": {
          "function_name": "queue_destroy",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "68-76",
          "snippet": "void queue_destroy(struct queue *queue, queue_destroy_func_t destroy)\n{\n\tif (!queue)\n\t\treturn;\n\n\tqueue_remove_all(queue, NULL, NULL, destroy);\n\n\tqueue_unref(queue);\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nvoid queue_destroy(struct queue *queue, queue_destroy_func_t destroy)\n{\n\tif (!queue)\n\t\treturn;\n\n\tqueue_remove_all(queue, NULL, NULL, destroy);\n\n\tqueue_unref(queue);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic void desc_free(void *data)\n{\n\tstruct external_desc *desc = data;\n\n\tqueue_destroy(desc->pending_reads, cancel_pending_read);\n\tqueue_destroy(desc->pending_writes, cancel_pending_write);\n\n\tg_dbus_proxy_unref(desc->proxy);\n\tg_free(desc->chrc_path);\n\n\tfree(desc);\n}"
  },
  {
    "function_name": "chrc_free",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
    "lines": "450-466",
    "snippet": "static void chrc_free(void *data)\n{\n\tstruct external_chrc *chrc = data;\n\n\tio_destroy(chrc->write_io);\n\tio_destroy(chrc->notify_io);\n\n\tqueue_destroy(chrc->pending_reads, cancel_pending_read);\n\tqueue_destroy(chrc->pending_writes, cancel_pending_write);\n\n\tg_free(chrc->path);\n\n\tg_dbus_proxy_set_property_watch(chrc->proxy, NULL, NULL);\n\tg_dbus_proxy_unref(chrc->proxy);\n\n\tfree(chrc);\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"dbus-common.h\"",
      "#include \"gatt-database.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "chrc"
          ],
          "line": 465
        },
        "resolved": true,
        "details": {
          "function_name": "app_free_idle_cb",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "1303-1308",
          "snippet": "static gboolean app_free_idle_cb(void *data)\n{\n\tapp_free(data);\n\n\treturn FALSE;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic gboolean app_free_idle_cb(void *data)\n{\n\tapp_free(data);\n\n\treturn FALSE;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_dbus_proxy_unref",
          "args": [
            "chrc->proxy"
          ],
          "line": 463
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_dbus_proxy_set_property_watch",
          "args": [
            "chrc->proxy",
            "NULL",
            "NULL"
          ],
          "line": 462
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_free",
          "args": [
            "chrc->path"
          ],
          "line": 460
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "queue_destroy",
          "args": [
            "chrc->pending_writes",
            "cancel_pending_write"
          ],
          "line": 458
        },
        "resolved": true,
        "details": {
          "function_name": "queue_destroy",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "68-76",
          "snippet": "void queue_destroy(struct queue *queue, queue_destroy_func_t destroy)\n{\n\tif (!queue)\n\t\treturn;\n\n\tqueue_remove_all(queue, NULL, NULL, destroy);\n\n\tqueue_unref(queue);\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nvoid queue_destroy(struct queue *queue, queue_destroy_func_t destroy)\n{\n\tif (!queue)\n\t\treturn;\n\n\tqueue_remove_all(queue, NULL, NULL, destroy);\n\n\tqueue_unref(queue);\n}"
        }
      },
      {
        "call_info": {
          "callee": "io_destroy",
          "args": [
            "chrc->notify_io"
          ],
          "line": 455
        },
        "resolved": true,
        "details": {
          "function_name": "notify_io_destroy",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
          "lines": "1457-1463",
          "snippet": "static void notify_io_destroy(void *data)\n{\n\tstruct notify_client *client = data;\n\n\tif (queue_remove(client->chrc->notify_clients, client))\n\t\tnotify_client_unref(client);\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"gatt-client.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void notify_io_destroy(void *data)\n{\n\tstruct notify_client *client = data;\n\n\tif (queue_remove(client->chrc->notify_clients, client))\n\t\tnotify_client_unref(client);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic void chrc_free(void *data)\n{\n\tstruct external_chrc *chrc = data;\n\n\tio_destroy(chrc->write_io);\n\tio_destroy(chrc->notify_io);\n\n\tqueue_destroy(chrc->pending_reads, cancel_pending_read);\n\tqueue_destroy(chrc->pending_writes, cancel_pending_write);\n\n\tg_free(chrc->path);\n\n\tg_dbus_proxy_set_property_watch(chrc->proxy, NULL, NULL);\n\tg_dbus_proxy_unref(chrc->proxy);\n\n\tfree(chrc);\n}"
  },
  {
    "function_name": "cancel_pending_write",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
    "lines": "441-448",
    "snippet": "static void cancel_pending_write(void *data)\n{\n\tstruct pending_op *op = data;\n\n\tgatt_db_attribute_write_result(op->attrib, op->id,\n\t\t\t\t\tBT_ATT_ERROR_REQUEST_NOT_SUPPORTED);\n\top->owner_queue = NULL;\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"dbus-common.h\"",
      "#include \"gatt-database.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "gatt_db_attribute_write_result",
          "args": [
            "op->attrib",
            "op->id",
            "BT_ATT_ERROR_REQUEST_NOT_SUPPORTED"
          ],
          "line": 445
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_attribute_write_result",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "1862-1878",
          "snippet": "bool gatt_db_attribute_write_result(struct gatt_db_attribute *attrib,\n\t\t\t\t\t\tunsigned int id, int err)\n{\n\tstruct pending_write *p;\n\n\tif (!attrib || !id)\n\t\treturn false;\n\n\tp = queue_remove_if(attrib->pending_writes, find_pending,\n\t\t\t\t\t\t\tUINT_TO_PTR(id));\n\tif (!p)\n\t\treturn false;\n\n\tpending_write_result(p, err);\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nbool gatt_db_attribute_write_result(struct gatt_db_attribute *attrib,\n\t\t\t\t\t\tunsigned int id, int err)\n{\n\tstruct pending_write *p;\n\n\tif (!attrib || !id)\n\t\treturn false;\n\n\tp = queue_remove_if(attrib->pending_writes, find_pending,\n\t\t\t\t\t\t\tUINT_TO_PTR(id));\n\tif (!p)\n\t\treturn false;\n\n\tpending_write_result(p, err);\n\n\treturn true;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic void cancel_pending_write(void *data)\n{\n\tstruct pending_op *op = data;\n\n\tgatt_db_attribute_write_result(op->attrib, op->id,\n\t\t\t\t\tBT_ATT_ERROR_REQUEST_NOT_SUPPORTED);\n\top->owner_queue = NULL;\n}"
  },
  {
    "function_name": "cancel_pending_read",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
    "lines": "431-439",
    "snippet": "static void cancel_pending_read(void *data)\n{\n\tstruct pending_op *op = data;\n\n\tgatt_db_attribute_read_result(op->attrib, op->id,\n\t\t\t\t\tBT_ATT_ERROR_REQUEST_NOT_SUPPORTED,\n\t\t\t\t\tNULL, 0);\n\top->owner_queue = NULL;\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"dbus-common.h\"",
      "#include \"gatt-database.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "gatt_db_attribute_read_result",
          "args": [
            "op->attrib",
            "op->id",
            "BT_ATT_ERROR_REQUEST_NOT_SUPPORTED",
            "NULL",
            "0"
          ],
          "line": 435
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_attribute_read_result",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "1773-1790",
          "snippet": "bool gatt_db_attribute_read_result(struct gatt_db_attribute *attrib,\n\t\t\t\t\tunsigned int id, int err,\n\t\t\t\t\tconst uint8_t *value, size_t length)\n{\n\tstruct pending_read *p;\n\n\tif (!attrib || !id)\n\t\treturn false;\n\n\tp = queue_remove_if(attrib->pending_reads, find_pending,\n\t\t\t\t\t\t\tUINT_TO_PTR(id));\n\tif (!p)\n\t\treturn false;\n\n\tpending_read_result(p, err, value, length);\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nbool gatt_db_attribute_read_result(struct gatt_db_attribute *attrib,\n\t\t\t\t\tunsigned int id, int err,\n\t\t\t\t\tconst uint8_t *value, size_t length)\n{\n\tstruct pending_read *p;\n\n\tif (!attrib || !id)\n\t\treturn false;\n\n\tp = queue_remove_if(attrib->pending_reads, find_pending,\n\t\t\t\t\t\t\tUINT_TO_PTR(id));\n\tif (!p)\n\t\treturn false;\n\n\tpending_read_result(p, err, value, length);\n\n\treturn true;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic void cancel_pending_read(void *data)\n{\n\tstruct pending_op *op = data;\n\n\tgatt_db_attribute_read_result(op->attrib, op->id,\n\t\t\t\t\tBT_ATT_ERROR_REQUEST_NOT_SUPPORTED,\n\t\t\t\t\tNULL, 0);\n\top->owner_queue = NULL;\n}"
  },
  {
    "function_name": "get_ccc_state",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
    "lines": "410-429",
    "snippet": "static struct ccc_state *get_ccc_state(struct btd_gatt_database *database,\n\t\t\t\t\tstruct bt_att *att, uint16_t handle)\n{\n\tstruct device_state *dev_state;\n\tstruct ccc_state *ccc;\n\n\tdev_state = get_device_state(database, att);\n\tif (!dev_state)\n\t\treturn NULL;\n\n\tccc = find_ccc_state(dev_state, handle);\n\tif (ccc)\n\t\treturn ccc;\n\n\tccc = new0(struct ccc_state, 1);\n\tccc->handle = handle;\n\tqueue_push_tail(dev_state->ccc_states, ccc);\n\n\treturn ccc;\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"dbus-common.h\"",
      "#include \"gatt-database.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "queue_push_tail",
          "args": [
            "dev_state->ccc_states",
            "ccc"
          ],
          "line": 426
        },
        "resolved": true,
        "details": {
          "function_name": "queue_push_tail",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "88-108",
          "snippet": "bool queue_push_tail(struct queue *queue, void *data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn false;\n\n\tentry = queue_entry_new(data);\n\n\tif (queue->tail)\n\t\tqueue->tail->next = entry;\n\n\tqueue->tail = entry;\n\n\tif (!queue->head)\n\t\tqueue->head = entry;\n\n\tqueue->entries++;\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nbool queue_push_tail(struct queue *queue, void *data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn false;\n\n\tentry = queue_entry_new(data);\n\n\tif (queue->tail)\n\t\tqueue->tail->next = entry;\n\n\tqueue->tail = entry;\n\n\tif (!queue->head)\n\t\tqueue->head = entry;\n\n\tqueue->entries++;\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "new0",
          "args": [
            "structccc_state",
            "1"
          ],
          "line": 424
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "find_ccc_state",
          "args": [
            "dev_state",
            "handle"
          ],
          "line": 420
        },
        "resolved": true,
        "details": {
          "function_name": "find_ccc_state",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "266-271",
          "snippet": "static struct ccc_state *find_ccc_state(struct device_state *dev_state,\n\t\t\t\t\t\t\t\tuint16_t handle)\n{\n\treturn queue_find(dev_state->ccc_states, ccc_state_match,\n\t\t\t\t\t\t\tUINT_TO_PTR(handle));\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic struct ccc_state *find_ccc_state(struct device_state *dev_state,\n\t\t\t\t\t\t\t\tuint16_t handle)\n{\n\treturn queue_find(dev_state->ccc_states, ccc_state_match,\n\t\t\t\t\t\t\tUINT_TO_PTR(handle));\n}"
        }
      },
      {
        "call_info": {
          "callee": "get_device_state",
          "args": [
            "database",
            "att"
          ],
          "line": 416
        },
        "resolved": true,
        "details": {
          "function_name": "get_device_state",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "379-408",
          "snippet": "static struct device_state *get_device_state(struct btd_gatt_database *database,\n\t\t\t\t\t\tstruct bt_att *att)\n{\n\tstruct device_state *dev_state;\n\tbdaddr_t bdaddr;\n\tuint8_t bdaddr_type;\n\n\tif (!get_dst_info(att, &bdaddr, &bdaddr_type))\n\t\treturn NULL;\n\n\t/*\n\t * Find and return a device state. If a matching state doesn't exist,\n\t * then create a new one.\n\t */\n\tdev_state = find_device_state(database, &bdaddr, bdaddr_type);\n\tif (dev_state)\n\t\tgoto done;\n\n\tdev_state = device_state_create(database, &bdaddr, bdaddr_type);\n\n\tqueue_push_tail(database->device_states, dev_state);\n\ndone:\n\tif (!dev_state->disc_id)\n\t\tdev_state->disc_id = bt_att_register_disconnect(att,\n\t\t\t\t\t\t\tatt_disconnected,\n\t\t\t\t\t\t\tdev_state, NULL);\n\n\treturn dev_state;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic struct device_state *get_device_state(struct btd_gatt_database *database,\n\t\t\t\t\t\tstruct bt_att *att)\n{\n\tstruct device_state *dev_state;\n\tbdaddr_t bdaddr;\n\tuint8_t bdaddr_type;\n\n\tif (!get_dst_info(att, &bdaddr, &bdaddr_type))\n\t\treturn NULL;\n\n\t/*\n\t * Find and return a device state. If a matching state doesn't exist,\n\t * then create a new one.\n\t */\n\tdev_state = find_device_state(database, &bdaddr, bdaddr_type);\n\tif (dev_state)\n\t\tgoto done;\n\n\tdev_state = device_state_create(database, &bdaddr, bdaddr_type);\n\n\tqueue_push_tail(database->device_states, dev_state);\n\ndone:\n\tif (!dev_state->disc_id)\n\t\tdev_state->disc_id = bt_att_register_disconnect(att,\n\t\t\t\t\t\t\tatt_disconnected,\n\t\t\t\t\t\t\tdev_state, NULL);\n\n\treturn dev_state;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic struct ccc_state *get_ccc_state(struct btd_gatt_database *database,\n\t\t\t\t\tstruct bt_att *att, uint16_t handle)\n{\n\tstruct device_state *dev_state;\n\tstruct ccc_state *ccc;\n\n\tdev_state = get_device_state(database, att);\n\tif (!dev_state)\n\t\treturn NULL;\n\n\tccc = find_ccc_state(dev_state, handle);\n\tif (ccc)\n\t\treturn ccc;\n\n\tccc = new0(struct ccc_state, 1);\n\tccc->handle = handle;\n\tqueue_push_tail(dev_state->ccc_states, ccc);\n\n\treturn ccc;\n}"
  },
  {
    "function_name": "get_device_state",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
    "lines": "379-408",
    "snippet": "static struct device_state *get_device_state(struct btd_gatt_database *database,\n\t\t\t\t\t\tstruct bt_att *att)\n{\n\tstruct device_state *dev_state;\n\tbdaddr_t bdaddr;\n\tuint8_t bdaddr_type;\n\n\tif (!get_dst_info(att, &bdaddr, &bdaddr_type))\n\t\treturn NULL;\n\n\t/*\n\t * Find and return a device state. If a matching state doesn't exist,\n\t * then create a new one.\n\t */\n\tdev_state = find_device_state(database, &bdaddr, bdaddr_type);\n\tif (dev_state)\n\t\tgoto done;\n\n\tdev_state = device_state_create(database, &bdaddr, bdaddr_type);\n\n\tqueue_push_tail(database->device_states, dev_state);\n\ndone:\n\tif (!dev_state->disc_id)\n\t\tdev_state->disc_id = bt_att_register_disconnect(att,\n\t\t\t\t\t\t\tatt_disconnected,\n\t\t\t\t\t\t\tdev_state, NULL);\n\n\treturn dev_state;\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"dbus-common.h\"",
      "#include \"gatt-database.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "bt_att_register_disconnect",
          "args": [
            "att",
            "att_disconnected",
            "dev_state",
            "NULL"
          ],
          "line": 403
        },
        "resolved": true,
        "details": {
          "function_name": "bt_att_register_disconnect",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/att.c",
          "lines": "1178-1204",
          "snippet": "unsigned int bt_att_register_disconnect(struct bt_att *att,\n\t\t\t\t\tbt_att_disconnect_func_t callback,\n\t\t\t\t\tvoid *user_data,\n\t\t\t\t\tbt_att_destroy_func_t destroy)\n{\n\tstruct att_disconn *disconn;\n\n\tif (!att || !att->io)\n\t\treturn 0;\n\n\tdisconn = new0(struct att_disconn, 1);\n\tdisconn->callback = callback;\n\tdisconn->destroy = destroy;\n\tdisconn->user_data = user_data;\n\n\tif (att->next_reg_id < 1)\n\t\tatt->next_reg_id = 1;\n\n\tdisconn->id = att->next_reg_id++;\n\n\tif (!queue_push_tail(att->disconn_list, disconn)) {\n\t\tfree(disconn);\n\t\treturn 0;\n\t}\n\n\treturn disconn->id;\n}",
          "includes": [
            "#include \"src/shared/crypto.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/l2cap.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/crypto.h\"\n#include \"src/shared/att.h\"\n#include \"lib/uuid.h\"\n#include \"lib/l2cap.h\"\n#include \"lib/bluetooth.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include <errno.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <config.h>\n\nunsigned int bt_att_register_disconnect(struct bt_att *att,\n\t\t\t\t\tbt_att_disconnect_func_t callback,\n\t\t\t\t\tvoid *user_data,\n\t\t\t\t\tbt_att_destroy_func_t destroy)\n{\n\tstruct att_disconn *disconn;\n\n\tif (!att || !att->io)\n\t\treturn 0;\n\n\tdisconn = new0(struct att_disconn, 1);\n\tdisconn->callback = callback;\n\tdisconn->destroy = destroy;\n\tdisconn->user_data = user_data;\n\n\tif (att->next_reg_id < 1)\n\t\tatt->next_reg_id = 1;\n\n\tdisconn->id = att->next_reg_id++;\n\n\tif (!queue_push_tail(att->disconn_list, disconn)) {\n\t\tfree(disconn);\n\t\treturn 0;\n\t}\n\n\treturn disconn->id;\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_push_tail",
          "args": [
            "database->device_states",
            "dev_state"
          ],
          "line": 399
        },
        "resolved": true,
        "details": {
          "function_name": "queue_push_tail",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "88-108",
          "snippet": "bool queue_push_tail(struct queue *queue, void *data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn false;\n\n\tentry = queue_entry_new(data);\n\n\tif (queue->tail)\n\t\tqueue->tail->next = entry;\n\n\tqueue->tail = entry;\n\n\tif (!queue->head)\n\t\tqueue->head = entry;\n\n\tqueue->entries++;\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nbool queue_push_tail(struct queue *queue, void *data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn false;\n\n\tentry = queue_entry_new(data);\n\n\tif (queue->tail)\n\t\tqueue->tail->next = entry;\n\n\tqueue->tail = entry;\n\n\tif (!queue->head)\n\t\tqueue->head = entry;\n\n\tqueue->entries++;\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "device_state_create",
          "args": [
            "database",
            "&bdaddr",
            "bdaddr_type"
          ],
          "line": 397
        },
        "resolved": true,
        "details": {
          "function_name": "device_state_create",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "273-286",
          "snippet": "static struct device_state *device_state_create(struct btd_gatt_database *db,\n\t\t\t\t\t\t\tconst bdaddr_t *bdaddr,\n\t\t\t\t\t\t\tuint8_t bdaddr_type)\n{\n\tstruct device_state *dev_state;\n\n\tdev_state = new0(struct device_state, 1);\n\tdev_state->db = db;\n\tdev_state->ccc_states = queue_new();\n\tbacpy(&dev_state->bdaddr, bdaddr);\n\tdev_state->bdaddr_type = bdaddr_type;\n\n\treturn dev_state;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic struct device_state *device_state_create(struct btd_gatt_database *db,\n\t\t\t\t\t\t\tconst bdaddr_t *bdaddr,\n\t\t\t\t\t\t\tuint8_t bdaddr_type)\n{\n\tstruct device_state *dev_state;\n\n\tdev_state = new0(struct device_state, 1);\n\tdev_state->db = db;\n\tdev_state->ccc_states = queue_new();\n\tbacpy(&dev_state->bdaddr, bdaddr);\n\tdev_state->bdaddr_type = bdaddr_type;\n\n\treturn dev_state;\n}"
        }
      },
      {
        "call_info": {
          "callee": "find_device_state",
          "args": [
            "database",
            "&bdaddr",
            "bdaddr_type"
          ],
          "line": 393
        },
        "resolved": true,
        "details": {
          "function_name": "find_device_state",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "244-256",
          "snippet": "static struct device_state *\nfind_device_state(struct btd_gatt_database *database, bdaddr_t *bdaddr,\n\t\t\t\t\t\t\tuint8_t bdaddr_type)\n{\n\tstruct device_info dev_info;\n\n\tmemset(&dev_info, 0, sizeof(dev_info));\n\n\tbacpy(&dev_info.bdaddr, bdaddr);\n\tdev_info.bdaddr_type = bdaddr_type;\n\n\treturn queue_find(database->device_states, dev_state_match, &dev_info);\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic struct device_state *\nfind_device_state(struct btd_gatt_database *database, bdaddr_t *bdaddr,\n\t\t\t\t\t\t\tuint8_t bdaddr_type)\n{\n\tstruct device_info dev_info;\n\n\tmemset(&dev_info, 0, sizeof(dev_info));\n\n\tbacpy(&dev_info.bdaddr, bdaddr);\n\tdev_info.bdaddr_type = bdaddr_type;\n\n\treturn queue_find(database->device_states, dev_state_match, &dev_info);\n}"
        }
      },
      {
        "call_info": {
          "callee": "get_dst_info",
          "args": [
            "att",
            "&bdaddr",
            "&bdaddr_type"
          ],
          "line": 386
        },
        "resolved": true,
        "details": {
          "function_name": "get_dst_info",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "356-377",
          "snippet": "static bool get_dst_info(struct bt_att *att, bdaddr_t *dst, uint8_t *dst_type)\n{\n\tGIOChannel *io = NULL;\n\tGError *gerr = NULL;\n\n\tio = g_io_channel_unix_new(bt_att_get_fd(att));\n\tif (!io)\n\t\treturn false;\n\n\tbt_io_get(io, &gerr, BT_IO_OPT_DEST_BDADDR, dst,\n\t\t\t\t\t\tBT_IO_OPT_DEST_TYPE, dst_type,\n\t\t\t\t\t\tBT_IO_OPT_INVALID);\n\tif (gerr) {\n\t\terror(\"gatt: bt_io_get: %s\", gerr->message);\n\t\tg_error_free(gerr);\n\t\tg_io_channel_unref(io);\n\t\treturn false;\n\t}\n\n\tg_io_channel_unref(io);\n\treturn true;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic bool get_dst_info(struct bt_att *att, bdaddr_t *dst, uint8_t *dst_type)\n{\n\tGIOChannel *io = NULL;\n\tGError *gerr = NULL;\n\n\tio = g_io_channel_unix_new(bt_att_get_fd(att));\n\tif (!io)\n\t\treturn false;\n\n\tbt_io_get(io, &gerr, BT_IO_OPT_DEST_BDADDR, dst,\n\t\t\t\t\t\tBT_IO_OPT_DEST_TYPE, dst_type,\n\t\t\t\t\t\tBT_IO_OPT_INVALID);\n\tif (gerr) {\n\t\terror(\"gatt: bt_io_get: %s\", gerr->message);\n\t\tg_error_free(gerr);\n\t\tg_io_channel_unref(io);\n\t\treturn false;\n\t}\n\n\tg_io_channel_unref(io);\n\treturn true;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic struct device_state *get_device_state(struct btd_gatt_database *database,\n\t\t\t\t\t\tstruct bt_att *att)\n{\n\tstruct device_state *dev_state;\n\tbdaddr_t bdaddr;\n\tuint8_t bdaddr_type;\n\n\tif (!get_dst_info(att, &bdaddr, &bdaddr_type))\n\t\treturn NULL;\n\n\t/*\n\t * Find and return a device state. If a matching state doesn't exist,\n\t * then create a new one.\n\t */\n\tdev_state = find_device_state(database, &bdaddr, bdaddr_type);\n\tif (dev_state)\n\t\tgoto done;\n\n\tdev_state = device_state_create(database, &bdaddr, bdaddr_type);\n\n\tqueue_push_tail(database->device_states, dev_state);\n\ndone:\n\tif (!dev_state->disc_id)\n\t\tdev_state->disc_id = bt_att_register_disconnect(att,\n\t\t\t\t\t\t\tatt_disconnected,\n\t\t\t\t\t\t\tdev_state, NULL);\n\n\treturn dev_state;\n}"
  },
  {
    "function_name": "get_dst_info",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
    "lines": "356-377",
    "snippet": "static bool get_dst_info(struct bt_att *att, bdaddr_t *dst, uint8_t *dst_type)\n{\n\tGIOChannel *io = NULL;\n\tGError *gerr = NULL;\n\n\tio = g_io_channel_unix_new(bt_att_get_fd(att));\n\tif (!io)\n\t\treturn false;\n\n\tbt_io_get(io, &gerr, BT_IO_OPT_DEST_BDADDR, dst,\n\t\t\t\t\t\tBT_IO_OPT_DEST_TYPE, dst_type,\n\t\t\t\t\t\tBT_IO_OPT_INVALID);\n\tif (gerr) {\n\t\terror(\"gatt: bt_io_get: %s\", gerr->message);\n\t\tg_error_free(gerr);\n\t\tg_io_channel_unref(io);\n\t\treturn false;\n\t}\n\n\tg_io_channel_unref(io);\n\treturn true;\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"dbus-common.h\"",
      "#include \"gatt-database.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_io_channel_unref",
          "args": [
            "io"
          ],
          "line": 375
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_io_channel_unref",
          "args": [
            "io"
          ],
          "line": 371
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_error_free",
          "args": [
            "gerr"
          ],
          "line": 370
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"gatt: bt_io_get: %s\"",
            "gerr->message"
          ],
          "line": 369
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_failed",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "124-128",
          "snippet": "DBusMessage *btd_error_failed(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE\n\t\t\t\t\t\".Failed\", \"%s\", str);\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_failed(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE\n\t\t\t\t\t\".Failed\", \"%s\", str);\n}"
        }
      },
      {
        "call_info": {
          "callee": "bt_io_get",
          "args": [
            "io",
            "&gerr",
            "BT_IO_OPT_DEST_BDADDR",
            "dst",
            "BT_IO_OPT_DEST_TYPE",
            "dst_type",
            "BT_IO_OPT_INVALID"
          ],
          "line": 365
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_io_channel_unix_new",
          "args": [
            "bt_att_get_fd(att)"
          ],
          "line": 361
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bt_att_get_fd",
          "args": [
            "att"
          ],
          "line": 361
        },
        "resolved": true,
        "details": {
          "function_name": "bt_att_get_fd",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/att.c",
          "lines": "1085-1091",
          "snippet": "int bt_att_get_fd(struct bt_att *att)\n{\n\tif (!att)\n\t\treturn -1;\n\n\treturn att->fd;\n}",
          "includes": [
            "#include \"src/shared/crypto.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/l2cap.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/crypto.h\"\n#include \"src/shared/att.h\"\n#include \"lib/uuid.h\"\n#include \"lib/l2cap.h\"\n#include \"lib/bluetooth.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include <errno.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <config.h>\n\nint bt_att_get_fd(struct bt_att *att)\n{\n\tif (!att)\n\t\treturn -1;\n\n\treturn att->fd;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic bool get_dst_info(struct bt_att *att, bdaddr_t *dst, uint8_t *dst_type)\n{\n\tGIOChannel *io = NULL;\n\tGError *gerr = NULL;\n\n\tio = g_io_channel_unix_new(bt_att_get_fd(att));\n\tif (!io)\n\t\treturn false;\n\n\tbt_io_get(io, &gerr, BT_IO_OPT_DEST_BDADDR, dst,\n\t\t\t\t\t\tBT_IO_OPT_DEST_TYPE, dst_type,\n\t\t\t\t\t\tBT_IO_OPT_INVALID);\n\tif (gerr) {\n\t\terror(\"gatt: bt_io_get: %s\", gerr->message);\n\t\tg_error_free(gerr);\n\t\tg_io_channel_unref(io);\n\t\treturn false;\n\t}\n\n\tg_io_channel_unref(io);\n\treturn true;\n}"
  },
  {
    "function_name": "att_disconnected",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
    "lines": "320-354",
    "snippet": "static void att_disconnected(int err, void *user_data)\n{\n\tstruct device_state *state = user_data;\n\tstruct btd_device *device;\n\n\tDBG(\"\");\n\n\tstate->disc_id = 0;\n\n\tdevice = btd_adapter_get_device(state->db->adapter, &state->bdaddr,\n\t\t\t\t\tstate->bdaddr_type);\n\tif (!device)\n\t\tgoto remove;\n\n\tif (device_is_bonded(device, state->bdaddr_type)) {\n\t\tstruct ccc_state *ccc;\n\t\tuint16_t handle;\n\n\t\thandle = gatt_db_attribute_get_handle(state->db->svc_chngd_ccc);\n\n\t\tccc = find_ccc_state(state, handle);\n\t\tif (ccc)\n\t\t\tdevice_store_svc_chng_ccc(device, state->bdaddr_type,\n\t\t\t\t\t\t\t\tccc->value[0]);\n\n\t\treturn;\n\t}\n\nremove:\n\t/* Remove device state if device no longer exists or is not paired */\n\tif (queue_remove(state->db->device_states, state)) {\n\t\tqueue_foreach(state->ccc_states, clear_ccc_state, state->db);\n\t\tdevice_state_free(state);\n\t}\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"dbus-common.h\"",
      "#include \"gatt-database.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "device_state_free",
          "args": [
            "state"
          ],
          "line": 352
        },
        "resolved": true,
        "details": {
          "function_name": "device_state_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "288-300",
          "snippet": "static void device_state_free(void *data)\n{\n\tstruct device_state *state = data;\n\n\tqueue_destroy(state->ccc_states, free);\n\n\tif (state->pending) {\n\t\tfree(state->pending->value);\n\t\tfree(state->pending);\n\t}\n\n\tfree(state);\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic void device_state_free(void *data)\n{\n\tstruct device_state *state = data;\n\n\tqueue_destroy(state->ccc_states, free);\n\n\tif (state->pending) {\n\t\tfree(state->pending->value);\n\t\tfree(state->pending);\n\t}\n\n\tfree(state);\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_foreach",
          "args": [
            "state->ccc_states",
            "clear_ccc_state",
            "state->db"
          ],
          "line": 351
        },
        "resolved": true,
        "details": {
          "function_name": "queue_foreach",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "203-224",
          "snippet": "void queue_foreach(struct queue *queue, queue_foreach_func_t function,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue || !function)\n\t\treturn;\n\n\tentry = queue->head;\n\tif (!entry)\n\t\treturn;\n\n\tqueue_ref(queue);\n\twhile (entry && queue->head && queue->ref_count > 1) {\n\t\tstruct queue_entry *next;\n\n\t\tnext = entry->next;\n\t\tfunction(entry->data, user_data);\n\t\tentry = next;\n\t}\n\tqueue_unref(queue);\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nvoid queue_foreach(struct queue *queue, queue_foreach_func_t function,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue || !function)\n\t\treturn;\n\n\tentry = queue->head;\n\tif (!entry)\n\t\treturn;\n\n\tqueue_ref(queue);\n\twhile (entry && queue->head && queue->ref_count > 1) {\n\t\tstruct queue_entry *next;\n\n\t\tnext = entry->next;\n\t\tfunction(entry->data, user_data);\n\t\tentry = next;\n\t}\n\tqueue_unref(queue);\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_remove",
          "args": [
            "state->db->device_states",
            "state"
          ],
          "line": 350
        },
        "resolved": true,
        "details": {
          "function_name": "queue_remove_uuid",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
          "lines": "526-541",
          "snippet": "static bool queue_remove_uuid(struct queue *queue, bt_uuid_t *uuid)\n{\n\tbt_uuid_t *removed;\n\n\tif (!queue || !uuid)\n\t\treturn false;\n\n\tremoved = queue_remove_if(queue, uuid_match, uuid);\n\n\tif (removed) {\n\t\tfree(removed);\n\t\treturn true;\n\t}\n\n\treturn false;\n}",
          "includes": [
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/eir.h\"",
            "#include \"src/shared/ad.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nstatic bool queue_remove_uuid(struct queue *queue, bt_uuid_t *uuid)\n{\n\tbt_uuid_t *removed;\n\n\tif (!queue || !uuid)\n\t\treturn false;\n\n\tremoved = queue_remove_if(queue, uuid_match, uuid);\n\n\tif (removed) {\n\t\tfree(removed);\n\t\treturn true;\n\t}\n\n\treturn false;\n}"
        }
      },
      {
        "call_info": {
          "callee": "device_store_svc_chng_ccc",
          "args": [
            "device",
            "state->bdaddr_type",
            "ccc->value[0]"
          ],
          "line": 342
        },
        "resolved": true,
        "details": {
          "function_name": "device_store_svc_chng_ccc",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "5419-5466",
          "snippet": "void device_store_svc_chng_ccc(struct btd_device *device, uint8_t bdaddr_type,\n\t\t\t\t\t\t\t\tuint16_t value)\n{\n\tchar filename[PATH_MAX];\n\tchar device_addr[18];\n\tGKeyFile *key_file;\n\tuint16_t old_value;\n\tgsize length = 0;\n\tchar *str;\n\n\tba2str(&device->bdaddr, device_addr);\n\tsnprintf(filename, PATH_MAX, STORAGEDIR \"/%s/%s/info\",\n\t\t\t\tbtd_adapter_get_storage_dir(device->adapter),\n\t\t\t\tdevice_addr);\n\n\tkey_file = g_key_file_new();\n\tg_key_file_load_from_file(key_file, filename, 0, NULL);\n\n\t/* for bonded devices this is done on every connection so limit writes\n\t * to storage if no change needed\n\t */\n\tif (bdaddr_type == BDADDR_BREDR) {\n\t\told_value = g_key_file_get_integer(key_file, \"ServiceChanged\",\n\t\t\t\t\t\t\t\"CCC_BR/EDR\", NULL);\n\t\tif (old_value == value)\n\t\t\tgoto done;\n\n\t\tg_key_file_set_integer(key_file, \"ServiceChanged\", \"CCC_BR/EDR\",\n\t\t\t\t\t\t\t\t\tvalue);\n\t} else {\n\t\told_value = g_key_file_get_integer(key_file, \"ServiceChanged\",\n\t\t\t\t\t\t\t\"CCC_LE\", NULL);\n\t\tif (old_value == value)\n\t\t\tgoto done;\n\n\t\tg_key_file_set_integer(key_file, \"ServiceChanged\", \"CCC_LE\",\n\t\t\t\t\t\t\t\t\tvalue);\n\t}\n\n\tcreate_file(filename, S_IRUSR | S_IWUSR);\n\n\tstr = g_key_file_to_data(key_file, &length, NULL);\n\tg_file_set_contents(filename, str, length, NULL);\n\tg_free(str);\n\ndone:\n\tg_key_file_free(key_file);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nvoid device_store_svc_chng_ccc(struct btd_device *device, uint8_t bdaddr_type,\n\t\t\t\t\t\t\t\tuint16_t value)\n{\n\tchar filename[PATH_MAX];\n\tchar device_addr[18];\n\tGKeyFile *key_file;\n\tuint16_t old_value;\n\tgsize length = 0;\n\tchar *str;\n\n\tba2str(&device->bdaddr, device_addr);\n\tsnprintf(filename, PATH_MAX, STORAGEDIR \"/%s/%s/info\",\n\t\t\t\tbtd_adapter_get_storage_dir(device->adapter),\n\t\t\t\tdevice_addr);\n\n\tkey_file = g_key_file_new();\n\tg_key_file_load_from_file(key_file, filename, 0, NULL);\n\n\t/* for bonded devices this is done on every connection so limit writes\n\t * to storage if no change needed\n\t */\n\tif (bdaddr_type == BDADDR_BREDR) {\n\t\told_value = g_key_file_get_integer(key_file, \"ServiceChanged\",\n\t\t\t\t\t\t\t\"CCC_BR/EDR\", NULL);\n\t\tif (old_value == value)\n\t\t\tgoto done;\n\n\t\tg_key_file_set_integer(key_file, \"ServiceChanged\", \"CCC_BR/EDR\",\n\t\t\t\t\t\t\t\t\tvalue);\n\t} else {\n\t\told_value = g_key_file_get_integer(key_file, \"ServiceChanged\",\n\t\t\t\t\t\t\t\"CCC_LE\", NULL);\n\t\tif (old_value == value)\n\t\t\tgoto done;\n\n\t\tg_key_file_set_integer(key_file, \"ServiceChanged\", \"CCC_LE\",\n\t\t\t\t\t\t\t\t\tvalue);\n\t}\n\n\tcreate_file(filename, S_IRUSR | S_IWUSR);\n\n\tstr = g_key_file_to_data(key_file, &length, NULL);\n\tg_file_set_contents(filename, str, length, NULL);\n\tg_free(str);\n\ndone:\n\tg_key_file_free(key_file);\n}"
        }
      },
      {
        "call_info": {
          "callee": "find_ccc_state",
          "args": [
            "state",
            "handle"
          ],
          "line": 340
        },
        "resolved": true,
        "details": {
          "function_name": "find_ccc_state",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "266-271",
          "snippet": "static struct ccc_state *find_ccc_state(struct device_state *dev_state,\n\t\t\t\t\t\t\t\tuint16_t handle)\n{\n\treturn queue_find(dev_state->ccc_states, ccc_state_match,\n\t\t\t\t\t\t\tUINT_TO_PTR(handle));\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic struct ccc_state *find_ccc_state(struct device_state *dev_state,\n\t\t\t\t\t\t\t\tuint16_t handle)\n{\n\treturn queue_find(dev_state->ccc_states, ccc_state_match,\n\t\t\t\t\t\t\tUINT_TO_PTR(handle));\n}"
        }
      },
      {
        "call_info": {
          "callee": "gatt_db_attribute_get_handle",
          "args": [
            "state->db->svc_chngd_ccc"
          ],
          "line": 338
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_attribute_get_handle",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "1482-1488",
          "snippet": "uint16_t gatt_db_attribute_get_handle(const struct gatt_db_attribute *attrib)\n{\n\tif (!attrib)\n\t\treturn 0;\n\n\treturn attrib->handle;\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nuint16_t gatt_db_attribute_get_handle(const struct gatt_db_attribute *attrib)\n{\n\tif (!attrib)\n\t\treturn 0;\n\n\treturn attrib->handle;\n}"
        }
      },
      {
        "call_info": {
          "callee": "device_is_bonded",
          "args": [
            "device",
            "state->bdaddr_type"
          ],
          "line": 334
        },
        "resolved": true,
        "details": {
          "function_name": "device_is_bonded",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "703-708",
          "snippet": "bool device_is_bonded(struct btd_device *device, uint8_t bdaddr_type)\n{\n\tstruct bearer_state *state = get_state(device, bdaddr_type);\n\n\treturn state->bonded;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nbool device_is_bonded(struct btd_device *device, uint8_t bdaddr_type)\n{\n\tstruct bearer_state *state = get_state(device, bdaddr_type);\n\n\treturn state->bonded;\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_adapter_get_device",
          "args": [
            "state->db->adapter",
            "&state->bdaddr",
            "state->bdaddr_type"
          ],
          "line": 329
        },
        "resolved": true,
        "details": {
          "function_name": "btd_adapter_get_device",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "1235-1249",
          "snippet": "struct btd_device *btd_adapter_get_device(struct btd_adapter *adapter,\n\t\t\t\t\tconst bdaddr_t *addr,\n\t\t\t\t\tuint8_t addr_type)\n{\n\tstruct btd_device *device;\n\n\tif (!adapter)\n\t\treturn NULL;\n\n\tdevice = btd_adapter_find_device(adapter, addr, addr_type);\n\tif (device)\n\t\treturn device;\n\n\treturn adapter_create_device(adapter, addr, addr_type);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void trigger_pairable_timeout(struct btd_adapter *adapter);",
            "static void adapter_start(struct btd_adapter *adapter);",
            "static void adapter_stop(struct btd_adapter *adapter);",
            "static void trigger_passive_scanning(struct btd_adapter *adapter);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void trigger_pairable_timeout(struct btd_adapter *adapter);\nstatic void adapter_start(struct btd_adapter *adapter);\nstatic void adapter_stop(struct btd_adapter *adapter);\nstatic void trigger_passive_scanning(struct btd_adapter *adapter);\n\nstruct btd_device *btd_adapter_get_device(struct btd_adapter *adapter,\n\t\t\t\t\tconst bdaddr_t *addr,\n\t\t\t\t\tuint8_t addr_type)\n{\n\tstruct btd_device *device;\n\n\tif (!adapter)\n\t\treturn NULL;\n\n\tdevice = btd_adapter_find_device(adapter, addr, addr_type);\n\tif (device)\n\t\treturn device;\n\n\treturn adapter_create_device(adapter, addr, addr_type);\n}"
        }
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"\""
          ],
          "line": 325
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic void att_disconnected(int err, void *user_data)\n{\n\tstruct device_state *state = user_data;\n\tstruct btd_device *device;\n\n\tDBG(\"\");\n\n\tstate->disc_id = 0;\n\n\tdevice = btd_adapter_get_device(state->db->adapter, &state->bdaddr,\n\t\t\t\t\tstate->bdaddr_type);\n\tif (!device)\n\t\tgoto remove;\n\n\tif (device_is_bonded(device, state->bdaddr_type)) {\n\t\tstruct ccc_state *ccc;\n\t\tuint16_t handle;\n\n\t\thandle = gatt_db_attribute_get_handle(state->db->svc_chngd_ccc);\n\n\t\tccc = find_ccc_state(state, handle);\n\t\tif (ccc)\n\t\t\tdevice_store_svc_chng_ccc(device, state->bdaddr_type,\n\t\t\t\t\t\t\t\tccc->value[0]);\n\n\t\treturn;\n\t}\n\nremove:\n\t/* Remove device state if device no longer exists or is not paired */\n\tif (queue_remove(state->db->device_states, state)) {\n\t\tqueue_foreach(state->ccc_states, clear_ccc_state, state->db);\n\t\tdevice_state_free(state);\n\t}\n}"
  },
  {
    "function_name": "clear_ccc_state",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
    "lines": "302-318",
    "snippet": "static void clear_ccc_state(void *data, void *user_data)\n{\n\tstruct ccc_state *ccc = data;\n\tstruct btd_gatt_database *db = user_data;\n\tstruct ccc_cb_data *ccc_cb;\n\n\tif (!ccc->value[0])\n\t\treturn;\n\n\tccc_cb = queue_find(db->ccc_callbacks, ccc_cb_match_handle,\n\t\t\t\t\t\tUINT_TO_PTR(ccc->handle));\n\tif (!ccc_cb)\n\t\treturn;\n\n\tif (ccc_cb->callback)\n\t\tccc_cb->callback(NULL, ccc_cb->user_data);\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"dbus-common.h\"",
      "#include \"gatt-database.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "ccc_cb->callback",
          "args": [
            "NULL",
            "ccc_cb->user_data"
          ],
          "line": 317
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "queue_find",
          "args": [
            "db->ccc_callbacks",
            "ccc_cb_match_handle",
            "UINT_TO_PTR(ccc->handle)"
          ],
          "line": 311
        },
        "resolved": true,
        "details": {
          "function_name": "queue_find",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "231-247",
          "snippet": "void *queue_find(struct queue *queue, queue_match_func_t function,\n\t\t\t\t\t\t\tconst void *match_data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn NULL;\n\n\tif (!function)\n\t\tfunction = direct_match;\n\n\tfor (entry = queue->head; entry; entry = entry->next)\n\t\tif (function(entry->data, match_data))\n\t\t\treturn entry->data;\n\n\treturn NULL;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nvoid *queue_find(struct queue *queue, queue_match_func_t function,\n\t\t\t\t\t\t\tconst void *match_data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn NULL;\n\n\tif (!function)\n\t\tfunction = direct_match;\n\n\tfor (entry = queue->head; entry; entry = entry->next)\n\t\tif (function(entry->data, match_data))\n\t\t\treturn entry->data;\n\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "UINT_TO_PTR",
          "args": [
            "ccc->handle"
          ],
          "line": 312
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic void clear_ccc_state(void *data, void *user_data)\n{\n\tstruct ccc_state *ccc = data;\n\tstruct btd_gatt_database *db = user_data;\n\tstruct ccc_cb_data *ccc_cb;\n\n\tif (!ccc->value[0])\n\t\treturn;\n\n\tccc_cb = queue_find(db->ccc_callbacks, ccc_cb_match_handle,\n\t\t\t\t\t\tUINT_TO_PTR(ccc->handle));\n\tif (!ccc_cb)\n\t\treturn;\n\n\tif (ccc_cb->callback)\n\t\tccc_cb->callback(NULL, ccc_cb->user_data);\n}"
  },
  {
    "function_name": "device_state_free",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
    "lines": "288-300",
    "snippet": "static void device_state_free(void *data)\n{\n\tstruct device_state *state = data;\n\n\tqueue_destroy(state->ccc_states, free);\n\n\tif (state->pending) {\n\t\tfree(state->pending->value);\n\t\tfree(state->pending);\n\t}\n\n\tfree(state);\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"dbus-common.h\"",
      "#include \"gatt-database.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "state"
          ],
          "line": 299
        },
        "resolved": true,
        "details": {
          "function_name": "app_free_idle_cb",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "1303-1308",
          "snippet": "static gboolean app_free_idle_cb(void *data)\n{\n\tapp_free(data);\n\n\treturn FALSE;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic gboolean app_free_idle_cb(void *data)\n{\n\tapp_free(data);\n\n\treturn FALSE;\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_destroy",
          "args": [
            "state->ccc_states",
            "free"
          ],
          "line": 292
        },
        "resolved": true,
        "details": {
          "function_name": "queue_destroy",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "68-76",
          "snippet": "void queue_destroy(struct queue *queue, queue_destroy_func_t destroy)\n{\n\tif (!queue)\n\t\treturn;\n\n\tqueue_remove_all(queue, NULL, NULL, destroy);\n\n\tqueue_unref(queue);\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nvoid queue_destroy(struct queue *queue, queue_destroy_func_t destroy)\n{\n\tif (!queue)\n\t\treturn;\n\n\tqueue_remove_all(queue, NULL, NULL, destroy);\n\n\tqueue_unref(queue);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic void device_state_free(void *data)\n{\n\tstruct device_state *state = data;\n\n\tqueue_destroy(state->ccc_states, free);\n\n\tif (state->pending) {\n\t\tfree(state->pending->value);\n\t\tfree(state->pending);\n\t}\n\n\tfree(state);\n}"
  },
  {
    "function_name": "device_state_create",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
    "lines": "273-286",
    "snippet": "static struct device_state *device_state_create(struct btd_gatt_database *db,\n\t\t\t\t\t\t\tconst bdaddr_t *bdaddr,\n\t\t\t\t\t\t\tuint8_t bdaddr_type)\n{\n\tstruct device_state *dev_state;\n\n\tdev_state = new0(struct device_state, 1);\n\tdev_state->db = db;\n\tdev_state->ccc_states = queue_new();\n\tbacpy(&dev_state->bdaddr, bdaddr);\n\tdev_state->bdaddr_type = bdaddr_type;\n\n\treturn dev_state;\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"dbus-common.h\"",
      "#include \"gatt-database.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "bacpy",
          "args": [
            "&dev_state->bdaddr",
            "bdaddr"
          ],
          "line": 282
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "queue_new",
          "args": [],
          "line": 281
        },
        "resolved": true,
        "details": {
          "function_name": "queue_new",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "56-66",
          "snippet": "struct queue *queue_new(void)\n{\n\tstruct queue *queue;\n\n\tqueue = new0(struct queue, 1);\n\tqueue->head = NULL;\n\tqueue->tail = NULL;\n\tqueue->entries = 0;\n\n\treturn queue_ref(queue);\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nstruct queue *queue_new(void)\n{\n\tstruct queue *queue;\n\n\tqueue = new0(struct queue, 1);\n\tqueue->head = NULL;\n\tqueue->tail = NULL;\n\tqueue->entries = 0;\n\n\treturn queue_ref(queue);\n}"
        }
      },
      {
        "call_info": {
          "callee": "new0",
          "args": [
            "structdevice_state",
            "1"
          ],
          "line": 279
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic struct device_state *device_state_create(struct btd_gatt_database *db,\n\t\t\t\t\t\t\tconst bdaddr_t *bdaddr,\n\t\t\t\t\t\t\tuint8_t bdaddr_type)\n{\n\tstruct device_state *dev_state;\n\n\tdev_state = new0(struct device_state, 1);\n\tdev_state->db = db;\n\tdev_state->ccc_states = queue_new();\n\tbacpy(&dev_state->bdaddr, bdaddr);\n\tdev_state->bdaddr_type = bdaddr_type;\n\n\treturn dev_state;\n}"
  },
  {
    "function_name": "find_ccc_state",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
    "lines": "266-271",
    "snippet": "static struct ccc_state *find_ccc_state(struct device_state *dev_state,\n\t\t\t\t\t\t\t\tuint16_t handle)\n{\n\treturn queue_find(dev_state->ccc_states, ccc_state_match,\n\t\t\t\t\t\t\tUINT_TO_PTR(handle));\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"dbus-common.h\"",
      "#include \"gatt-database.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "queue_find",
          "args": [
            "dev_state->ccc_states",
            "ccc_state_match",
            "UINT_TO_PTR(handle)"
          ],
          "line": 269
        },
        "resolved": true,
        "details": {
          "function_name": "queue_find",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "231-247",
          "snippet": "void *queue_find(struct queue *queue, queue_match_func_t function,\n\t\t\t\t\t\t\tconst void *match_data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn NULL;\n\n\tif (!function)\n\t\tfunction = direct_match;\n\n\tfor (entry = queue->head; entry; entry = entry->next)\n\t\tif (function(entry->data, match_data))\n\t\t\treturn entry->data;\n\n\treturn NULL;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nvoid *queue_find(struct queue *queue, queue_match_func_t function,\n\t\t\t\t\t\t\tconst void *match_data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn NULL;\n\n\tif (!function)\n\t\tfunction = direct_match;\n\n\tfor (entry = queue->head; entry; entry = entry->next)\n\t\tif (function(entry->data, match_data))\n\t\t\treturn entry->data;\n\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "UINT_TO_PTR",
          "args": [
            "handle"
          ],
          "line": 270
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic struct ccc_state *find_ccc_state(struct device_state *dev_state,\n\t\t\t\t\t\t\t\tuint16_t handle)\n{\n\treturn queue_find(dev_state->ccc_states, ccc_state_match,\n\t\t\t\t\t\t\tUINT_TO_PTR(handle));\n}"
  },
  {
    "function_name": "ccc_state_match",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
    "lines": "258-264",
    "snippet": "static bool ccc_state_match(const void *a, const void *b)\n{\n\tconst struct ccc_state *ccc = a;\n\tuint16_t handle = PTR_TO_UINT(b);\n\n\treturn ccc->handle == handle;\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"dbus-common.h\"",
      "#include \"gatt-database.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "PTR_TO_UINT",
          "args": [
            "b"
          ],
          "line": 261
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic bool ccc_state_match(const void *a, const void *b)\n{\n\tconst struct ccc_state *ccc = a;\n\tuint16_t handle = PTR_TO_UINT(b);\n\n\treturn ccc->handle == handle;\n}"
  },
  {
    "function_name": "find_device_state",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
    "lines": "244-256",
    "snippet": "static struct device_state *\nfind_device_state(struct btd_gatt_database *database, bdaddr_t *bdaddr,\n\t\t\t\t\t\t\tuint8_t bdaddr_type)\n{\n\tstruct device_info dev_info;\n\n\tmemset(&dev_info, 0, sizeof(dev_info));\n\n\tbacpy(&dev_info.bdaddr, bdaddr);\n\tdev_info.bdaddr_type = bdaddr_type;\n\n\treturn queue_find(database->device_states, dev_state_match, &dev_info);\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"dbus-common.h\"",
      "#include \"gatt-database.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "queue_find",
          "args": [
            "database->device_states",
            "dev_state_match",
            "&dev_info"
          ],
          "line": 255
        },
        "resolved": true,
        "details": {
          "function_name": "queue_find",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "231-247",
          "snippet": "void *queue_find(struct queue *queue, queue_match_func_t function,\n\t\t\t\t\t\t\tconst void *match_data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn NULL;\n\n\tif (!function)\n\t\tfunction = direct_match;\n\n\tfor (entry = queue->head; entry; entry = entry->next)\n\t\tif (function(entry->data, match_data))\n\t\t\treturn entry->data;\n\n\treturn NULL;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nvoid *queue_find(struct queue *queue, queue_match_func_t function,\n\t\t\t\t\t\t\tconst void *match_data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn NULL;\n\n\tif (!function)\n\t\tfunction = direct_match;\n\n\tfor (entry = queue->head; entry; entry = entry->next)\n\t\tif (function(entry->data, match_data))\n\t\t\treturn entry->data;\n\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "bacpy",
          "args": [
            "&dev_info.bdaddr",
            "bdaddr"
          ],
          "line": 252
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memset",
          "args": [
            "&dev_info",
            "0",
            "sizeof(dev_info)"
          ],
          "line": 250
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic struct device_state *\nfind_device_state(struct btd_gatt_database *database, bdaddr_t *bdaddr,\n\t\t\t\t\t\t\tuint8_t bdaddr_type)\n{\n\tstruct device_info dev_info;\n\n\tmemset(&dev_info, 0, sizeof(dev_info));\n\n\tbacpy(&dev_info.bdaddr, bdaddr);\n\tdev_info.bdaddr_type = bdaddr_type;\n\n\treturn queue_find(database->device_states, dev_state_match, &dev_info);\n}"
  },
  {
    "function_name": "dev_state_match",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
    "lines": "235-242",
    "snippet": "static bool dev_state_match(const void *a, const void *b)\n{\n\tconst struct device_state *dev_state = a;\n\tconst struct device_info *dev_info = b;\n\n\treturn bacmp(&dev_state->bdaddr, &dev_info->bdaddr) == 0 &&\n\t\t\t\tdev_state->bdaddr_type == dev_info->bdaddr_type;\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"dbus-common.h\"",
      "#include \"gatt-database.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "bacmp",
          "args": [
            "&dev_state->bdaddr",
            "&dev_info->bdaddr"
          ],
          "line": 240
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic bool dev_state_match(const void *a, const void *b)\n{\n\tconst struct device_state *dev_state = a;\n\tconst struct device_info *dev_info = b;\n\n\treturn bacmp(&dev_state->bdaddr, &dev_info->bdaddr) == 0 &&\n\t\t\t\tdev_state->bdaddr_type == dev_info->bdaddr_type;\n}"
  },
  {
    "function_name": "ccc_cb_match_handle",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
    "lines": "227-233",
    "snippet": "static bool ccc_cb_match_handle(const void *data, const void *match_data)\n{\n\tconst struct ccc_cb_data *ccc_cb = data;\n\tuint16_t handle = PTR_TO_UINT(match_data);\n\n\treturn ccc_cb->handle == handle;\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"dbus-common.h\"",
      "#include \"gatt-database.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "PTR_TO_UINT",
          "args": [
            "match_data"
          ],
          "line": 230
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic bool ccc_cb_match_handle(const void *data, const void *match_data)\n{\n\tconst struct ccc_cb_data *ccc_cb = data;\n\tuint16_t handle = PTR_TO_UINT(match_data);\n\n\treturn ccc_cb->handle == handle;\n}"
  },
  {
    "function_name": "ccc_cb_match_service",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
    "lines": "215-225",
    "snippet": "static bool ccc_cb_match_service(const void *data, const void *match_data)\n{\n\tconst struct ccc_cb_data *ccc_cb = data;\n\tconst struct gatt_db_attribute *attrib = match_data;\n\tuint16_t start, end;\n\n\tif (!gatt_db_attribute_get_service_handles(attrib, &start, &end))\n\t\treturn false;\n\n\treturn ccc_cb->handle >= start && ccc_cb->handle <= end;\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"dbus-common.h\"",
      "#include \"gatt-database.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "gatt_db_attribute_get_service_handles",
          "args": [
            "attrib",
            "&start",
            "&end"
          ],
          "line": 221
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_attribute_get_service_handles",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "1521-1536",
          "snippet": "bool gatt_db_attribute_get_service_handles(\n\t\t\t\t\tconst struct gatt_db_attribute *attrib,\n\t\t\t\t\tuint16_t *start_handle,\n\t\t\t\t\tuint16_t *end_handle)\n{\n\tstruct gatt_db_service *service;\n\n\tif (!attrib)\n\t\treturn false;\n\n\tservice = attrib->service;\n\n\tgatt_db_service_get_handles(service, start_handle, end_handle);\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nbool gatt_db_attribute_get_service_handles(\n\t\t\t\t\tconst struct gatt_db_attribute *attrib,\n\t\t\t\t\tuint16_t *start_handle,\n\t\t\t\t\tuint16_t *end_handle)\n{\n\tstruct gatt_db_service *service;\n\n\tif (!attrib)\n\t\treturn false;\n\n\tservice = attrib->service;\n\n\tgatt_db_service_get_handles(service, start_handle, end_handle);\n\n\treturn true;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic bool ccc_cb_match_service(const void *data, const void *match_data)\n{\n\tconst struct ccc_cb_data *ccc_cb = data;\n\tconst struct gatt_db_attribute *attrib = match_data;\n\tuint16_t start, end;\n\n\tif (!gatt_db_attribute_get_service_handles(attrib, &start, &end))\n\t\treturn false;\n\n\treturn ccc_cb->handle >= start && ccc_cb->handle <= end;\n}"
  },
  {
    "function_name": "ccc_cb_free",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
    "lines": "205-213",
    "snippet": "static void ccc_cb_free(void *data)\n{\n\tstruct ccc_cb_data *ccc_cb = data;\n\n\tif (ccc_cb->destroy)\n\t\tccc_cb->destroy(ccc_cb->user_data);\n\n\tfree(ccc_cb);\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"dbus-common.h\"",
      "#include \"gatt-database.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "ccc_cb"
          ],
          "line": 212
        },
        "resolved": true,
        "details": {
          "function_name": "app_free_idle_cb",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "1303-1308",
          "snippet": "static gboolean app_free_idle_cb(void *data)\n{\n\tapp_free(data);\n\n\treturn FALSE;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic gboolean app_free_idle_cb(void *data)\n{\n\tapp_free(data);\n\n\treturn FALSE;\n}"
        }
      },
      {
        "call_info": {
          "callee": "ccc_cb->destroy",
          "args": [
            "ccc_cb->user_data"
          ],
          "line": 210
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic void ccc_cb_free(void *data)\n{\n\tstruct ccc_cb_data *ccc_cb = data;\n\n\tif (ccc_cb->destroy)\n\t\tccc_cb->destroy(ccc_cb->user_data);\n\n\tfree(ccc_cb);\n}"
  }
]