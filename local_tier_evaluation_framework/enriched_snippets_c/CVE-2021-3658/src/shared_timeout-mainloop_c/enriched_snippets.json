[
  {
    "function_name": "timeout_remove",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/timeout-mainloop.c",
    "lines": "76-82",
    "snippet": "void timeout_remove(unsigned int id)\n{\n\tif (!id)\n\t\treturn;\n\n\tmainloop_remove_timeout((int) id);\n}",
    "includes": [
      "#include \"timeout.h\"",
      "#include \"util.h\"",
      "#include \"mainloop.h\"",
      "#include <stdlib.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "mainloop_remove_timeout",
          "args": [
            "(int) id"
          ],
          "line": 81
        },
        "resolved": true,
        "details": {
          "function_name": "mainloop_remove_timeout",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/mainloop.c",
          "lines": "373-376",
          "snippet": "int mainloop_remove_timeout(int id)\n{\n\treturn mainloop_remove_fd(id);\n}",
          "includes": [
            "#include \"mainloop.h\"",
            "#include <sys/epoll.h>",
            "#include <sys/timerfd.h>",
            "#include <sys/signalfd.h>",
            "#include <signal.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"mainloop.h\"\n#include <sys/epoll.h>\n#include <sys/timerfd.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <string.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nint mainloop_remove_timeout(int id)\n{\n\treturn mainloop_remove_fd(id);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"timeout.h\"\n#include \"util.h\"\n#include \"mainloop.h\"\n#include <stdlib.h>\n\nvoid timeout_remove(unsigned int id)\n{\n\tif (!id)\n\t\treturn;\n\n\tmainloop_remove_timeout((int) id);\n}"
  },
  {
    "function_name": "timeout_add",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/timeout-mainloop.c",
    "lines": "55-74",
    "snippet": "unsigned int timeout_add(unsigned int timeout, timeout_func_t func,\n\t\t\tvoid *user_data, timeout_destroy_func_t destroy)\n{\n\tstruct timeout_data *data;\n\n\tdata = new0(struct timeout_data, 1);\n\tdata->func = func;\n\tdata->user_data = user_data;\n\tdata->timeout = timeout;\n\tdata->destroy = destroy;\n\n\tdata->id = mainloop_add_timeout(timeout, timeout_callback, data,\n\t\t\t\t\t\t\ttimeout_destroy);\n\tif (data->id < 0) {\n\t\tfree(data);\n\t\treturn 0;\n\t}\n\n\treturn (unsigned int) data->id;\n}",
    "includes": [
      "#include \"timeout.h\"",
      "#include \"util.h\"",
      "#include \"mainloop.h\"",
      "#include <stdlib.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "data"
          ],
          "line": 69
        },
        "resolved": true,
        "details": {
          "function_name": "bt_att_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/att.c",
          "lines": "956-985",
          "snippet": "static void bt_att_free(struct bt_att *att)\n{\n\tif (att->pending_req)\n\t\tdestroy_att_send_op(att->pending_req);\n\n\tif (att->pending_ind)\n\t\tdestroy_att_send_op(att->pending_ind);\n\n\tio_destroy(att->io);\n\tbt_crypto_unref(att->crypto);\n\n\tqueue_destroy(att->req_queue, NULL);\n\tqueue_destroy(att->ind_queue, NULL);\n\tqueue_destroy(att->write_queue, NULL);\n\tqueue_destroy(att->notify_list, NULL);\n\tqueue_destroy(att->disconn_list, NULL);\n\n\tif (att->timeout_destroy)\n\t\tatt->timeout_destroy(att->timeout_data);\n\n\tif (att->debug_destroy)\n\t\tatt->debug_destroy(att->debug_data);\n\n\tfree(att->local_sign);\n\tfree(att->remote_sign);\n\n\tfree(att->buf);\n\n\tfree(att);\n}",
          "includes": [
            "#include \"src/shared/crypto.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/l2cap.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/crypto.h\"\n#include \"src/shared/att.h\"\n#include \"lib/uuid.h\"\n#include \"lib/l2cap.h\"\n#include \"lib/bluetooth.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include <errno.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <config.h>\n\nstatic void bt_att_free(struct bt_att *att)\n{\n\tif (att->pending_req)\n\t\tdestroy_att_send_op(att->pending_req);\n\n\tif (att->pending_ind)\n\t\tdestroy_att_send_op(att->pending_ind);\n\n\tio_destroy(att->io);\n\tbt_crypto_unref(att->crypto);\n\n\tqueue_destroy(att->req_queue, NULL);\n\tqueue_destroy(att->ind_queue, NULL);\n\tqueue_destroy(att->write_queue, NULL);\n\tqueue_destroy(att->notify_list, NULL);\n\tqueue_destroy(att->disconn_list, NULL);\n\n\tif (att->timeout_destroy)\n\t\tatt->timeout_destroy(att->timeout_data);\n\n\tif (att->debug_destroy)\n\t\tatt->debug_destroy(att->debug_data);\n\n\tfree(att->local_sign);\n\tfree(att->remote_sign);\n\n\tfree(att->buf);\n\n\tfree(att);\n}"
        }
      },
      {
        "call_info": {
          "callee": "mainloop_add_timeout",
          "args": [
            "timeout",
            "timeout_callback",
            "data",
            "timeout_destroy"
          ],
          "line": 66
        },
        "resolved": true,
        "details": {
          "function_name": "mainloop_add_timeout",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/mainloop.c",
          "lines": "319-358",
          "snippet": "int mainloop_add_timeout(unsigned int msec, mainloop_timeout_func callback,\n\t\t\t\tvoid *user_data, mainloop_destroy_func destroy)\n{\n\tstruct timeout_data *data;\n\n\tif (!callback)\n\t\treturn -EINVAL;\n\n\tdata = malloc(sizeof(*data));\n\tif (!data)\n\t\treturn -ENOMEM;\n\n\tmemset(data, 0, sizeof(*data));\n\tdata->callback = callback;\n\tdata->destroy = destroy;\n\tdata->user_data = user_data;\n\n\tdata->fd = timerfd_create(CLOCK_MONOTONIC, TFD_NONBLOCK | TFD_CLOEXEC);\n\tif (data->fd < 0) {\n\t\tfree(data);\n\t\treturn -EIO;\n\t}\n\n\tif (msec > 0) {\n\t\tif (timeout_set(data->fd, msec) < 0) {\n\t\t\tclose(data->fd);\n\t\t\tfree(data);\n\t\t\treturn -EIO;\n\t\t}\n\t}\n\n\tif (mainloop_add_fd(data->fd, EPOLLIN | EPOLLONESHOT,\n\t\t\t\ttimeout_callback, data, timeout_destroy) < 0) {\n\t\tclose(data->fd);\n\t\tfree(data);\n\t\treturn -EIO;\n\t}\n\n\treturn data->fd;\n}",
          "includes": [
            "#include \"mainloop.h\"",
            "#include <sys/epoll.h>",
            "#include <sys/timerfd.h>",
            "#include <sys/signalfd.h>",
            "#include <signal.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"mainloop.h\"\n#include <sys/epoll.h>\n#include <sys/timerfd.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <string.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nint mainloop_add_timeout(unsigned int msec, mainloop_timeout_func callback,\n\t\t\t\tvoid *user_data, mainloop_destroy_func destroy)\n{\n\tstruct timeout_data *data;\n\n\tif (!callback)\n\t\treturn -EINVAL;\n\n\tdata = malloc(sizeof(*data));\n\tif (!data)\n\t\treturn -ENOMEM;\n\n\tmemset(data, 0, sizeof(*data));\n\tdata->callback = callback;\n\tdata->destroy = destroy;\n\tdata->user_data = user_data;\n\n\tdata->fd = timerfd_create(CLOCK_MONOTONIC, TFD_NONBLOCK | TFD_CLOEXEC);\n\tif (data->fd < 0) {\n\t\tfree(data);\n\t\treturn -EIO;\n\t}\n\n\tif (msec > 0) {\n\t\tif (timeout_set(data->fd, msec) < 0) {\n\t\t\tclose(data->fd);\n\t\t\tfree(data);\n\t\t\treturn -EIO;\n\t\t}\n\t}\n\n\tif (mainloop_add_fd(data->fd, EPOLLIN | EPOLLONESHOT,\n\t\t\t\ttimeout_callback, data, timeout_destroy) < 0) {\n\t\tclose(data->fd);\n\t\tfree(data);\n\t\treturn -EIO;\n\t}\n\n\treturn data->fd;\n}"
        }
      },
      {
        "call_info": {
          "callee": "new0",
          "args": [
            "structtimeout_data",
            "1"
          ],
          "line": 60
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"timeout.h\"\n#include \"util.h\"\n#include \"mainloop.h\"\n#include <stdlib.h>\n\nunsigned int timeout_add(unsigned int timeout, timeout_func_t func,\n\t\t\tvoid *user_data, timeout_destroy_func_t destroy)\n{\n\tstruct timeout_data *data;\n\n\tdata = new0(struct timeout_data, 1);\n\tdata->func = func;\n\tdata->user_data = user_data;\n\tdata->timeout = timeout;\n\tdata->destroy = destroy;\n\n\tdata->id = mainloop_add_timeout(timeout, timeout_callback, data,\n\t\t\t\t\t\t\ttimeout_destroy);\n\tif (data->id < 0) {\n\t\tfree(data);\n\t\treturn 0;\n\t}\n\n\treturn (unsigned int) data->id;\n}"
  },
  {
    "function_name": "timeout_destroy",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/timeout-mainloop.c",
    "lines": "45-53",
    "snippet": "static void timeout_destroy(void *user_data)\n{\n\tstruct timeout_data *data = user_data;\n\n\tif (data->destroy)\n\t\tdata->destroy(data->user_data);\n\n\tfree(data);\n}",
    "includes": [
      "#include \"timeout.h\"",
      "#include \"util.h\"",
      "#include \"mainloop.h\"",
      "#include <stdlib.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "data"
          ],
          "line": 52
        },
        "resolved": true,
        "details": {
          "function_name": "bt_att_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/att.c",
          "lines": "956-985",
          "snippet": "static void bt_att_free(struct bt_att *att)\n{\n\tif (att->pending_req)\n\t\tdestroy_att_send_op(att->pending_req);\n\n\tif (att->pending_ind)\n\t\tdestroy_att_send_op(att->pending_ind);\n\n\tio_destroy(att->io);\n\tbt_crypto_unref(att->crypto);\n\n\tqueue_destroy(att->req_queue, NULL);\n\tqueue_destroy(att->ind_queue, NULL);\n\tqueue_destroy(att->write_queue, NULL);\n\tqueue_destroy(att->notify_list, NULL);\n\tqueue_destroy(att->disconn_list, NULL);\n\n\tif (att->timeout_destroy)\n\t\tatt->timeout_destroy(att->timeout_data);\n\n\tif (att->debug_destroy)\n\t\tatt->debug_destroy(att->debug_data);\n\n\tfree(att->local_sign);\n\tfree(att->remote_sign);\n\n\tfree(att->buf);\n\n\tfree(att);\n}",
          "includes": [
            "#include \"src/shared/crypto.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/l2cap.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/crypto.h\"\n#include \"src/shared/att.h\"\n#include \"lib/uuid.h\"\n#include \"lib/l2cap.h\"\n#include \"lib/bluetooth.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include <errno.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <config.h>\n\nstatic void bt_att_free(struct bt_att *att)\n{\n\tif (att->pending_req)\n\t\tdestroy_att_send_op(att->pending_req);\n\n\tif (att->pending_ind)\n\t\tdestroy_att_send_op(att->pending_ind);\n\n\tio_destroy(att->io);\n\tbt_crypto_unref(att->crypto);\n\n\tqueue_destroy(att->req_queue, NULL);\n\tqueue_destroy(att->ind_queue, NULL);\n\tqueue_destroy(att->write_queue, NULL);\n\tqueue_destroy(att->notify_list, NULL);\n\tqueue_destroy(att->disconn_list, NULL);\n\n\tif (att->timeout_destroy)\n\t\tatt->timeout_destroy(att->timeout_data);\n\n\tif (att->debug_destroy)\n\t\tatt->debug_destroy(att->debug_data);\n\n\tfree(att->local_sign);\n\tfree(att->remote_sign);\n\n\tfree(att->buf);\n\n\tfree(att);\n}"
        }
      },
      {
        "call_info": {
          "callee": "data->destroy",
          "args": [
            "data->user_data"
          ],
          "line": 50
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"timeout.h\"\n#include \"util.h\"\n#include \"mainloop.h\"\n#include <stdlib.h>\n\nstatic void timeout_destroy(void *user_data)\n{\n\tstruct timeout_data *data = user_data;\n\n\tif (data->destroy)\n\t\tdata->destroy(data->user_data);\n\n\tfree(data);\n}"
  },
  {
    "function_name": "timeout_callback",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/timeout-mainloop.c",
    "lines": "34-43",
    "snippet": "static void timeout_callback(int id, void *user_data)\n{\n\tstruct timeout_data *data = user_data;\n\n\tif (data->func(data->user_data) &&\n\t\t\t!mainloop_modify_timeout(data->id, data->timeout))\n\t\treturn;\n\n\tmainloop_remove_timeout(data->id);\n}",
    "includes": [
      "#include \"timeout.h\"",
      "#include \"util.h\"",
      "#include \"mainloop.h\"",
      "#include <stdlib.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "mainloop_remove_timeout",
          "args": [
            "data->id"
          ],
          "line": 42
        },
        "resolved": true,
        "details": {
          "function_name": "mainloop_remove_timeout",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/mainloop.c",
          "lines": "373-376",
          "snippet": "int mainloop_remove_timeout(int id)\n{\n\treturn mainloop_remove_fd(id);\n}",
          "includes": [
            "#include \"mainloop.h\"",
            "#include <sys/epoll.h>",
            "#include <sys/timerfd.h>",
            "#include <sys/signalfd.h>",
            "#include <signal.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"mainloop.h\"\n#include <sys/epoll.h>\n#include <sys/timerfd.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <string.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nint mainloop_remove_timeout(int id)\n{\n\treturn mainloop_remove_fd(id);\n}"
        }
      },
      {
        "call_info": {
          "callee": "mainloop_modify_timeout",
          "args": [
            "data->id",
            "data->timeout"
          ],
          "line": 39
        },
        "resolved": true,
        "details": {
          "function_name": "mainloop_modify_timeout",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/mainloop.c",
          "lines": "360-371",
          "snippet": "int mainloop_modify_timeout(int id, unsigned int msec)\n{\n\tif (msec > 0) {\n\t\tif (timeout_set(id, msec) < 0)\n\t\t\treturn -EIO;\n\t}\n\n\tif (mainloop_modify_fd(id, EPOLLIN | EPOLLONESHOT) < 0)\n\t\treturn -EIO;\n\n\treturn 0;\n}",
          "includes": [
            "#include \"mainloop.h\"",
            "#include <sys/epoll.h>",
            "#include <sys/timerfd.h>",
            "#include <sys/signalfd.h>",
            "#include <signal.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"mainloop.h\"\n#include <sys/epoll.h>\n#include <sys/timerfd.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <string.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nint mainloop_modify_timeout(int id, unsigned int msec)\n{\n\tif (msec > 0) {\n\t\tif (timeout_set(id, msec) < 0)\n\t\t\treturn -EIO;\n\t}\n\n\tif (mainloop_modify_fd(id, EPOLLIN | EPOLLONESHOT) < 0)\n\t\treturn -EIO;\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "data->func",
          "args": [
            "data->user_data"
          ],
          "line": 38
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"timeout.h\"\n#include \"util.h\"\n#include \"mainloop.h\"\n#include <stdlib.h>\n\nstatic void timeout_callback(int id, void *user_data)\n{\n\tstruct timeout_data *data = user_data;\n\n\tif (data->func(data->user_data) &&\n\t\t\t!mainloop_modify_timeout(data->id, data->timeout))\n\t\treturn;\n\n\tmainloop_remove_timeout(data->id);\n}"
  }
]