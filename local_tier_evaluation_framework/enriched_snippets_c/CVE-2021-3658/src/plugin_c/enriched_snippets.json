[
  {
    "function_name": "plugin_cleanup",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/plugin.c",
    "lines": "220-239",
    "snippet": "void plugin_cleanup(void)\n{\n\tGSList *list;\n\n\tDBG(\"Cleanup plugins\");\n\n\tfor (list = plugins; list; list = list->next) {\n\t\tstruct bluetooth_plugin *plugin = list->data;\n\n\t\tif (plugin->active == TRUE && plugin->desc->exit)\n\t\t\tplugin->desc->exit();\n\n\t\tif (plugin->handle != NULL)\n\t\t\tdlclose(plugin->handle);\n\n\t\tg_free(plugin);\n\t}\n\n\tg_slist_free(plugins);\n}",
    "includes": [
      "#include \"src/builtin.h\"",
      "#include \"src/hcid.h\"",
      "#include \"src/log.h\"",
      "#include \"src/plugin.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <glib.h>",
      "#include <sys/stat.h>",
      "#include <string.h>",
      "#include <dlfcn.h>",
      "#include <errno.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static GSList *plugins = NULL;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_slist_free",
          "args": [
            "plugins"
          ],
          "line": 238
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_free",
          "args": [
            "plugin"
          ],
          "line": 235
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dlclose",
          "args": [
            "plugin->handle"
          ],
          "line": 233
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plugin->desc->exit",
          "args": [],
          "line": 230
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"Cleanup plugins\""
          ],
          "line": 224
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/builtin.h\"\n#include \"src/hcid.h\"\n#include \"src/log.h\"\n#include \"src/plugin.h\"\n#include \"btio/btio.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <sys/stat.h>\n#include <string.h>\n#include <dlfcn.h>\n#include <errno.h>\n#include <config.h>\n\nstatic GSList *plugins = NULL;\n\nvoid plugin_cleanup(void)\n{\n\tGSList *list;\n\n\tDBG(\"Cleanup plugins\");\n\n\tfor (list = plugins; list; list = list->next) {\n\t\tstruct bluetooth_plugin *plugin = list->data;\n\n\t\tif (plugin->active == TRUE && plugin->desc->exit)\n\t\t\tplugin->desc->exit();\n\n\t\tif (plugin->handle != NULL)\n\t\t\tdlclose(plugin->handle);\n\n\t\tg_free(plugin);\n\t}\n\n\tg_slist_free(plugins);\n}"
  },
  {
    "function_name": "plugin_init",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/plugin.c",
    "lines": "115-218",
    "snippet": "gboolean plugin_init(const char *enable, const char *disable)\n{\n\tGSList *list;\n\tGDir *dir;\n\tconst char *file;\n\tchar **cli_disabled, **cli_enabled;\n\tunsigned int i;\n\n\t/* Make a call to BtIO API so its symbols got resolved before the\n\t * plugins are loaded. */\n\tbt_io_error_quark();\n\n\tif (enable)\n\t\tcli_enabled = g_strsplit_set(enable, \", \", -1);\n\telse\n\t\tcli_enabled = NULL;\n\n\tif (disable)\n\t\tcli_disabled = g_strsplit_set(disable, \", \", -1);\n\telse\n\t\tcli_disabled = NULL;\n\n\tDBG(\"Loading builtin plugins\");\n\n\tfor (i = 0; __bluetooth_builtin[i]; i++) {\n\t\tif (!enable_plugin(__bluetooth_builtin[i]->name, cli_enabled,\n\t\t\t\t\t\t\t\tcli_disabled))\n\t\t\tcontinue;\n\n\t\tadd_plugin(NULL,  __bluetooth_builtin[i]);\n\t}\n\n\tif (strlen(PLUGINDIR) == 0)\n\t\tgoto start;\n\n\tDBG(\"Loading plugins %s\", PLUGINDIR);\n\n\tdir = g_dir_open(PLUGINDIR, 0, NULL);\n\tif (!dir)\n\t\tgoto start;\n\n\twhile ((file = g_dir_read_name(dir)) != NULL) {\n\t\tstruct bluetooth_plugin_desc *desc;\n\t\tvoid *handle;\n\t\tchar *filename;\n\n\t\tif (g_str_has_prefix(file, \"lib\") == TRUE ||\n\t\t\t\tg_str_has_suffix(file, \".so\") == FALSE)\n\t\t\tcontinue;\n\n\t\tfilename = g_build_filename(PLUGINDIR, file, NULL);\n\n\t\thandle = dlopen(filename, RTLD_NOW);\n\t\tif (handle == NULL) {\n\t\t\terror(\"Can't load plugin %s: %s\", filename,\n\t\t\t\t\t\t\t\tdlerror());\n\t\t\tg_free(filename);\n\t\t\tcontinue;\n\t\t}\n\n\t\tg_free(filename);\n\n\t\tdesc = dlsym(handle, \"bluetooth_plugin_desc\");\n\t\tif (desc == NULL) {\n\t\t\terror(\"Can't load plugin description: %s\", dlerror());\n\t\t\tdlclose(handle);\n\t\t\tcontinue;\n\t\t}\n\n\t\tif (!enable_plugin(desc->name, cli_enabled, cli_disabled)) {\n\t\t\tdlclose(handle);\n\t\t\tcontinue;\n\t\t}\n\n\t\tif (add_plugin(handle, desc) == FALSE)\n\t\t\tdlclose(handle);\n\t}\n\n\tg_dir_close(dir);\n\nstart:\n\tfor (list = plugins; list; list = list->next) {\n\t\tstruct bluetooth_plugin *plugin = list->data;\n\t\tint err;\n\n\t\terr = plugin->desc->init();\n\t\tif (err < 0) {\n\t\t\tif (err == -ENOSYS)\n\t\t\t\twarn(\"System does not support %s plugin\",\n\t\t\t\t\t\t\tplugin->desc->name);\n\t\t\telse\n\t\t\t\terror(\"Failed to init %s plugin\",\n\t\t\t\t\t\t\tplugin->desc->name);\n\t\t\tcontinue;\n\t\t}\n\n\t\tplugin->active = TRUE;\n\t}\n\n\tg_strfreev(cli_enabled);\n\tg_strfreev(cli_disabled);\n\n\treturn TRUE;\n}",
    "includes": [
      "#include \"src/builtin.h\"",
      "#include \"src/hcid.h\"",
      "#include \"src/log.h\"",
      "#include \"src/plugin.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <glib.h>",
      "#include <sys/stat.h>",
      "#include <string.h>",
      "#include <dlfcn.h>",
      "#include <errno.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static GSList *plugins = NULL;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_strfreev",
          "args": [
            "cli_disabled"
          ],
          "line": 215
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_strfreev",
          "args": [
            "cli_enabled"
          ],
          "line": 214
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"Failed to init %s plugin\"",
            "plugin->desc->name"
          ],
          "line": 206
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_failed",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "124-128",
          "snippet": "DBusMessage *btd_error_failed(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE\n\t\t\t\t\t\".Failed\", \"%s\", str);\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_failed(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE\n\t\t\t\t\t\".Failed\", \"%s\", str);\n}"
        }
      },
      {
        "call_info": {
          "callee": "warn",
          "args": [
            "\"System does not support %s plugin\"",
            "plugin->desc->name"
          ],
          "line": 203
        },
        "resolved": true,
        "details": {
          "function_name": "btd_warn",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/log.c",
          "lines": "215-229",
          "snippet": "void btd_warn(uint16_t index, const char *format, ...)\n{\n\tva_list ap;\n\n\tva_start(ap, format);\n\tvsyslog(LOG_WARNING, format, ap);\n\tva_end(ap);\n\n\tif (logging_fd < 0)\n\t\treturn;\n\n\tva_start(ap, format);\n\tlogging_log(index, LOG_WARNING, format, ap);\n\tva_end(ap);\n}",
          "includes": [
            "#include \"log.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/hci.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <sys/socket.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <stdarg.h>",
            "#include <syslog.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int logging_fd = -1;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n#include \"src/shared/util.h\"\n#include \"lib/hci.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <sys/socket.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdarg.h>\n#include <syslog.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic int logging_fd = -1;\n\nvoid btd_warn(uint16_t index, const char *format, ...)\n{\n\tva_list ap;\n\n\tva_start(ap, format);\n\tvsyslog(LOG_WARNING, format, ap);\n\tva_end(ap);\n\n\tif (logging_fd < 0)\n\t\treturn;\n\n\tva_start(ap, format);\n\tlogging_log(index, LOG_WARNING, format, ap);\n\tva_end(ap);\n}"
        }
      },
      {
        "call_info": {
          "callee": "plugin->desc->init",
          "args": [],
          "line": 200
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_dir_close",
          "args": [
            "dir"
          ],
          "line": 193
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dlclose",
          "args": [
            "handle"
          ],
          "line": 190
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "add_plugin",
          "args": [
            "handle",
            "desc"
          ],
          "line": 189
        },
        "resolved": true,
        "details": {
          "function_name": "add_plugin",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/plugin.c",
          "lines": "58-85",
          "snippet": "static gboolean add_plugin(void *handle, struct bluetooth_plugin_desc *desc)\n{\n\tstruct bluetooth_plugin *plugin;\n\n\tif (desc->init == NULL)\n\t\treturn FALSE;\n\n\tif (g_str_equal(desc->version, VERSION) == FALSE) {\n\t\terror(\"Version mismatch for %s\", desc->name);\n\t\treturn FALSE;\n\t}\n\n\tDBG(\"Loading %s plugin\", desc->name);\n\n\tplugin = g_try_new0(struct bluetooth_plugin, 1);\n\tif (plugin == NULL)\n\t\treturn FALSE;\n\n\tplugin->handle = handle;\n\tplugin->active = FALSE;\n\tplugin->desc = desc;\n\n\t__btd_enable_debug(desc->debug_start, desc->debug_stop);\n\n\tplugins = g_slist_insert_sorted(plugins, plugin, compare_priority);\n\n\treturn TRUE;\n}",
          "includes": [
            "#include \"src/builtin.h\"",
            "#include \"src/hcid.h\"",
            "#include \"src/log.h\"",
            "#include \"src/plugin.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <sys/stat.h>",
            "#include <string.h>",
            "#include <dlfcn.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static GSList *plugins = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/builtin.h\"\n#include \"src/hcid.h\"\n#include \"src/log.h\"\n#include \"src/plugin.h\"\n#include \"btio/btio.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <sys/stat.h>\n#include <string.h>\n#include <dlfcn.h>\n#include <errno.h>\n#include <config.h>\n\nstatic GSList *plugins = NULL;\n\nstatic gboolean add_plugin(void *handle, struct bluetooth_plugin_desc *desc)\n{\n\tstruct bluetooth_plugin *plugin;\n\n\tif (desc->init == NULL)\n\t\treturn FALSE;\n\n\tif (g_str_equal(desc->version, VERSION) == FALSE) {\n\t\terror(\"Version mismatch for %s\", desc->name);\n\t\treturn FALSE;\n\t}\n\n\tDBG(\"Loading %s plugin\", desc->name);\n\n\tplugin = g_try_new0(struct bluetooth_plugin, 1);\n\tif (plugin == NULL)\n\t\treturn FALSE;\n\n\tplugin->handle = handle;\n\tplugin->active = FALSE;\n\tplugin->desc = desc;\n\n\t__btd_enable_debug(desc->debug_start, desc->debug_stop);\n\n\tplugins = g_slist_insert_sorted(plugins, plugin, compare_priority);\n\n\treturn TRUE;\n}"
        }
      },
      {
        "call_info": {
          "callee": "dlclose",
          "args": [
            "handle"
          ],
          "line": 185
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "enable_plugin",
          "args": [
            "desc->name",
            "cli_enabled",
            "cli_disabled"
          ],
          "line": 184
        },
        "resolved": true,
        "details": {
          "function_name": "enable_plugin",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/plugin.c",
          "lines": "87-111",
          "snippet": "static gboolean enable_plugin(const char *name, char **cli_enable,\n\t\t\t\t\t\t\tchar **cli_disable)\n{\n\tif (cli_disable) {\n\t\tfor (; *cli_disable; cli_disable++)\n\t\t\tif (g_pattern_match_simple(*cli_disable, name))\n\t\t\t\tbreak;\n\t\tif (*cli_disable) {\n\t\t\tinfo(\"Excluding (cli) %s\", name);\n\t\t\treturn FALSE;\n\t\t}\n\t}\n\n\tif (cli_enable) {\n\t\tfor (; *cli_enable; cli_enable++)\n\t\t\tif (g_pattern_match_simple(*cli_enable, name))\n\t\t\t\tbreak;\n\t\tif (!*cli_enable) {\n\t\t\tinfo(\"Ignoring (cli) %s\", name);\n\t\t\treturn FALSE;\n\t\t}\n\t}\n\n\treturn TRUE;\n}",
          "includes": [
            "#include \"src/builtin.h\"",
            "#include \"src/hcid.h\"",
            "#include \"src/log.h\"",
            "#include \"src/plugin.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <sys/stat.h>",
            "#include <string.h>",
            "#include <dlfcn.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/builtin.h\"\n#include \"src/hcid.h\"\n#include \"src/log.h\"\n#include \"src/plugin.h\"\n#include \"btio/btio.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <sys/stat.h>\n#include <string.h>\n#include <dlfcn.h>\n#include <errno.h>\n#include <config.h>\n\nstatic gboolean enable_plugin(const char *name, char **cli_enable,\n\t\t\t\t\t\t\tchar **cli_disable)\n{\n\tif (cli_disable) {\n\t\tfor (; *cli_disable; cli_disable++)\n\t\t\tif (g_pattern_match_simple(*cli_disable, name))\n\t\t\t\tbreak;\n\t\tif (*cli_disable) {\n\t\t\tinfo(\"Excluding (cli) %s\", name);\n\t\t\treturn FALSE;\n\t\t}\n\t}\n\n\tif (cli_enable) {\n\t\tfor (; *cli_enable; cli_enable++)\n\t\t\tif (g_pattern_match_simple(*cli_enable, name))\n\t\t\t\tbreak;\n\t\tif (!*cli_enable) {\n\t\t\tinfo(\"Ignoring (cli) %s\", name);\n\t\t\treturn FALSE;\n\t\t}\n\t}\n\n\treturn TRUE;\n}"
        }
      },
      {
        "call_info": {
          "callee": "dlclose",
          "args": [
            "handle"
          ],
          "line": 180
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dlerror",
          "args": [],
          "line": 179
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dlsym",
          "args": [
            "handle",
            "\"bluetooth_plugin_desc\""
          ],
          "line": 177
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_free",
          "args": [
            "filename"
          ],
          "line": 175
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_free",
          "args": [
            "filename"
          ],
          "line": 171
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"Can't load plugin %s: %s\"",
            "filename",
            "dlerror()"
          ],
          "line": 169
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/log.c",
          "lines": "199-213",
          "snippet": "void btd_error(uint16_t index, const char *format, ...)\n{\n\tva_list ap;\n\n\tva_start(ap, format);\n\tvsyslog(LOG_ERR, format, ap);\n\tva_end(ap);\n\n\tif (logging_fd < 0)\n\t\treturn;\n\n\tva_start(ap, format);\n\tlogging_log(index, LOG_ERR, format, ap);\n\tva_end(ap);\n}",
          "includes": [
            "#include \"log.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/hci.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <sys/socket.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <stdarg.h>",
            "#include <syslog.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int logging_fd = -1;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n#include \"src/shared/util.h\"\n#include \"lib/hci.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <sys/socket.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdarg.h>\n#include <syslog.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic int logging_fd = -1;\n\nvoid btd_error(uint16_t index, const char *format, ...)\n{\n\tva_list ap;\n\n\tva_start(ap, format);\n\tvsyslog(LOG_ERR, format, ap);\n\tva_end(ap);\n\n\tif (logging_fd < 0)\n\t\treturn;\n\n\tva_start(ap, format);\n\tlogging_log(index, LOG_ERR, format, ap);\n\tva_end(ap);\n}"
        }
      },
      {
        "call_info": {
          "callee": "dlerror",
          "args": [],
          "line": 170
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dlopen",
          "args": [
            "filename",
            "RTLD_NOW"
          ],
          "line": 167
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_build_filename",
          "args": [
            "PLUGINDIR",
            "file",
            "NULL"
          ],
          "line": 165
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_str_has_suffix",
          "args": [
            "file",
            "\".so\""
          ],
          "line": 162
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_str_has_prefix",
          "args": [
            "file",
            "\"lib\""
          ],
          "line": 161
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_dir_read_name",
          "args": [
            "dir"
          ],
          "line": 156
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_dir_open",
          "args": [
            "PLUGINDIR",
            "0",
            "NULL"
          ],
          "line": 152
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"Loading plugins %s\"",
            "PLUGINDIR"
          ],
          "line": 150
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "PLUGINDIR"
          ],
          "line": 147
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"Loading builtin plugins\""
          ],
          "line": 137
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_strsplit_set",
          "args": [
            "disable",
            "\", \"",
            "-1"
          ],
          "line": 133
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_strsplit_set",
          "args": [
            "enable",
            "\", \"",
            "-1"
          ],
          "line": 128
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bt_io_error_quark",
          "args": [],
          "line": 125
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/builtin.h\"\n#include \"src/hcid.h\"\n#include \"src/log.h\"\n#include \"src/plugin.h\"\n#include \"btio/btio.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <sys/stat.h>\n#include <string.h>\n#include <dlfcn.h>\n#include <errno.h>\n#include <config.h>\n\nstatic GSList *plugins = NULL;\n\ngboolean plugin_init(const char *enable, const char *disable)\n{\n\tGSList *list;\n\tGDir *dir;\n\tconst char *file;\n\tchar **cli_disabled, **cli_enabled;\n\tunsigned int i;\n\n\t/* Make a call to BtIO API so its symbols got resolved before the\n\t * plugins are loaded. */\n\tbt_io_error_quark();\n\n\tif (enable)\n\t\tcli_enabled = g_strsplit_set(enable, \", \", -1);\n\telse\n\t\tcli_enabled = NULL;\n\n\tif (disable)\n\t\tcli_disabled = g_strsplit_set(disable, \", \", -1);\n\telse\n\t\tcli_disabled = NULL;\n\n\tDBG(\"Loading builtin plugins\");\n\n\tfor (i = 0; __bluetooth_builtin[i]; i++) {\n\t\tif (!enable_plugin(__bluetooth_builtin[i]->name, cli_enabled,\n\t\t\t\t\t\t\t\tcli_disabled))\n\t\t\tcontinue;\n\n\t\tadd_plugin(NULL,  __bluetooth_builtin[i]);\n\t}\n\n\tif (strlen(PLUGINDIR) == 0)\n\t\tgoto start;\n\n\tDBG(\"Loading plugins %s\", PLUGINDIR);\n\n\tdir = g_dir_open(PLUGINDIR, 0, NULL);\n\tif (!dir)\n\t\tgoto start;\n\n\twhile ((file = g_dir_read_name(dir)) != NULL) {\n\t\tstruct bluetooth_plugin_desc *desc;\n\t\tvoid *handle;\n\t\tchar *filename;\n\n\t\tif (g_str_has_prefix(file, \"lib\") == TRUE ||\n\t\t\t\tg_str_has_suffix(file, \".so\") == FALSE)\n\t\t\tcontinue;\n\n\t\tfilename = g_build_filename(PLUGINDIR, file, NULL);\n\n\t\thandle = dlopen(filename, RTLD_NOW);\n\t\tif (handle == NULL) {\n\t\t\terror(\"Can't load plugin %s: %s\", filename,\n\t\t\t\t\t\t\t\tdlerror());\n\t\t\tg_free(filename);\n\t\t\tcontinue;\n\t\t}\n\n\t\tg_free(filename);\n\n\t\tdesc = dlsym(handle, \"bluetooth_plugin_desc\");\n\t\tif (desc == NULL) {\n\t\t\terror(\"Can't load plugin description: %s\", dlerror());\n\t\t\tdlclose(handle);\n\t\t\tcontinue;\n\t\t}\n\n\t\tif (!enable_plugin(desc->name, cli_enabled, cli_disabled)) {\n\t\t\tdlclose(handle);\n\t\t\tcontinue;\n\t\t}\n\n\t\tif (add_plugin(handle, desc) == FALSE)\n\t\t\tdlclose(handle);\n\t}\n\n\tg_dir_close(dir);\n\nstart:\n\tfor (list = plugins; list; list = list->next) {\n\t\tstruct bluetooth_plugin *plugin = list->data;\n\t\tint err;\n\n\t\terr = plugin->desc->init();\n\t\tif (err < 0) {\n\t\t\tif (err == -ENOSYS)\n\t\t\t\twarn(\"System does not support %s plugin\",\n\t\t\t\t\t\t\tplugin->desc->name);\n\t\t\telse\n\t\t\t\terror(\"Failed to init %s plugin\",\n\t\t\t\t\t\t\tplugin->desc->name);\n\t\t\tcontinue;\n\t\t}\n\n\t\tplugin->active = TRUE;\n\t}\n\n\tg_strfreev(cli_enabled);\n\tg_strfreev(cli_disabled);\n\n\treturn TRUE;\n}"
  },
  {
    "function_name": "enable_plugin",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/plugin.c",
    "lines": "87-111",
    "snippet": "static gboolean enable_plugin(const char *name, char **cli_enable,\n\t\t\t\t\t\t\tchar **cli_disable)\n{\n\tif (cli_disable) {\n\t\tfor (; *cli_disable; cli_disable++)\n\t\t\tif (g_pattern_match_simple(*cli_disable, name))\n\t\t\t\tbreak;\n\t\tif (*cli_disable) {\n\t\t\tinfo(\"Excluding (cli) %s\", name);\n\t\t\treturn FALSE;\n\t\t}\n\t}\n\n\tif (cli_enable) {\n\t\tfor (; *cli_enable; cli_enable++)\n\t\t\tif (g_pattern_match_simple(*cli_enable, name))\n\t\t\t\tbreak;\n\t\tif (!*cli_enable) {\n\t\t\tinfo(\"Ignoring (cli) %s\", name);\n\t\t\treturn FALSE;\n\t\t}\n\t}\n\n\treturn TRUE;\n}",
    "includes": [
      "#include \"src/builtin.h\"",
      "#include \"src/hcid.h\"",
      "#include \"src/log.h\"",
      "#include \"src/plugin.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <glib.h>",
      "#include <sys/stat.h>",
      "#include <string.h>",
      "#include <dlfcn.h>",
      "#include <errno.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "info",
          "args": [
            "\"Ignoring (cli) %s\"",
            "name"
          ],
          "line": 105
        },
        "resolved": true,
        "details": {
          "function_name": "convert_info",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "2946-2983",
          "snippet": "static void convert_info(struct btd_device *device, GKeyFile *key_file)\n{\n\tchar filename[PATH_MAX];\n\tchar adapter_addr[18];\n\tchar device_addr[18];\n\tchar **uuids;\n\tchar *str;\n\tgsize length = 0;\n\n\t/* Load device profile list from legacy properties */\n\tuuids = g_key_file_get_string_list(key_file, \"General\", \"SDPServices\",\n\t\t\t\t\t\t\t\tNULL, NULL);\n\tif (uuids)\n\t\tload_services(device, uuids);\n\n\tuuids = g_key_file_get_string_list(key_file, \"General\", \"GATTServices\",\n\t\t\t\t\t\t\t\tNULL, NULL);\n\tif (uuids)\n\t\tload_services(device, uuids);\n\n\tif (!device->uuids)\n\t\treturn;\n\n\t/* Remove old entries so they are not loaded again */\n\tg_key_file_remove_key(key_file, \"General\", \"SDPServices\", NULL);\n\tg_key_file_remove_key(key_file, \"General\", \"GATTServices\", NULL);\n\n\tba2str(btd_adapter_get_address(device->adapter), adapter_addr);\n\tba2str(&device->bdaddr, device_addr);\n\tsnprintf(filename, PATH_MAX, STORAGEDIR \"/%s/%s/info\", adapter_addr,\n\t\t\tdevice_addr);\n\n\tstr = g_key_file_to_data(key_file, &length, NULL);\n\tg_file_set_contents(filename, str, length, NULL);\n\tg_free(str);\n\n\tstore_device_info(device);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void convert_info(struct btd_device *device, GKeyFile *key_file)\n{\n\tchar filename[PATH_MAX];\n\tchar adapter_addr[18];\n\tchar device_addr[18];\n\tchar **uuids;\n\tchar *str;\n\tgsize length = 0;\n\n\t/* Load device profile list from legacy properties */\n\tuuids = g_key_file_get_string_list(key_file, \"General\", \"SDPServices\",\n\t\t\t\t\t\t\t\tNULL, NULL);\n\tif (uuids)\n\t\tload_services(device, uuids);\n\n\tuuids = g_key_file_get_string_list(key_file, \"General\", \"GATTServices\",\n\t\t\t\t\t\t\t\tNULL, NULL);\n\tif (uuids)\n\t\tload_services(device, uuids);\n\n\tif (!device->uuids)\n\t\treturn;\n\n\t/* Remove old entries so they are not loaded again */\n\tg_key_file_remove_key(key_file, \"General\", \"SDPServices\", NULL);\n\tg_key_file_remove_key(key_file, \"General\", \"GATTServices\", NULL);\n\n\tba2str(btd_adapter_get_address(device->adapter), adapter_addr);\n\tba2str(&device->bdaddr, device_addr);\n\tsnprintf(filename, PATH_MAX, STORAGEDIR \"/%s/%s/info\", adapter_addr,\n\t\t\tdevice_addr);\n\n\tstr = g_key_file_to_data(key_file, &length, NULL);\n\tg_file_set_contents(filename, str, length, NULL);\n\tg_free(str);\n\n\tstore_device_info(device);\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_pattern_match_simple",
          "args": [
            "*cli_enable",
            "name"
          ],
          "line": 102
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_pattern_match_simple",
          "args": [
            "*cli_disable",
            "name"
          ],
          "line": 92
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/builtin.h\"\n#include \"src/hcid.h\"\n#include \"src/log.h\"\n#include \"src/plugin.h\"\n#include \"btio/btio.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <sys/stat.h>\n#include <string.h>\n#include <dlfcn.h>\n#include <errno.h>\n#include <config.h>\n\nstatic gboolean enable_plugin(const char *name, char **cli_enable,\n\t\t\t\t\t\t\tchar **cli_disable)\n{\n\tif (cli_disable) {\n\t\tfor (; *cli_disable; cli_disable++)\n\t\t\tif (g_pattern_match_simple(*cli_disable, name))\n\t\t\t\tbreak;\n\t\tif (*cli_disable) {\n\t\t\tinfo(\"Excluding (cli) %s\", name);\n\t\t\treturn FALSE;\n\t\t}\n\t}\n\n\tif (cli_enable) {\n\t\tfor (; *cli_enable; cli_enable++)\n\t\t\tif (g_pattern_match_simple(*cli_enable, name))\n\t\t\t\tbreak;\n\t\tif (!*cli_enable) {\n\t\t\tinfo(\"Ignoring (cli) %s\", name);\n\t\t\treturn FALSE;\n\t\t}\n\t}\n\n\treturn TRUE;\n}"
  },
  {
    "function_name": "add_plugin",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/plugin.c",
    "lines": "58-85",
    "snippet": "static gboolean add_plugin(void *handle, struct bluetooth_plugin_desc *desc)\n{\n\tstruct bluetooth_plugin *plugin;\n\n\tif (desc->init == NULL)\n\t\treturn FALSE;\n\n\tif (g_str_equal(desc->version, VERSION) == FALSE) {\n\t\terror(\"Version mismatch for %s\", desc->name);\n\t\treturn FALSE;\n\t}\n\n\tDBG(\"Loading %s plugin\", desc->name);\n\n\tplugin = g_try_new0(struct bluetooth_plugin, 1);\n\tif (plugin == NULL)\n\t\treturn FALSE;\n\n\tplugin->handle = handle;\n\tplugin->active = FALSE;\n\tplugin->desc = desc;\n\n\t__btd_enable_debug(desc->debug_start, desc->debug_stop);\n\n\tplugins = g_slist_insert_sorted(plugins, plugin, compare_priority);\n\n\treturn TRUE;\n}",
    "includes": [
      "#include \"src/builtin.h\"",
      "#include \"src/hcid.h\"",
      "#include \"src/log.h\"",
      "#include \"src/plugin.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <glib.h>",
      "#include <sys/stat.h>",
      "#include <string.h>",
      "#include <dlfcn.h>",
      "#include <errno.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static GSList *plugins = NULL;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_slist_insert_sorted",
          "args": [
            "plugins",
            "plugin",
            "compare_priority"
          ],
          "line": 82
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "__btd_enable_debug",
          "args": [
            "desc->debug_start",
            "desc->debug_stop"
          ],
          "line": 80
        },
        "resolved": true,
        "details": {
          "function_name": "__btd_enable_debug",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/log.c",
          "lines": "283-295",
          "snippet": "void __btd_enable_debug(struct btd_debug_desc *start,\n\t\t\t\t\tstruct btd_debug_desc *stop)\n{\n\tstruct btd_debug_desc *desc;\n\n\tif (start == NULL || stop == NULL)\n\t\treturn;\n\n\tfor (desc = start; desc < stop; desc++) {\n\t\tif (is_enabled(desc))\n\t\t\tdesc->flags |= BTD_DEBUG_FLAG_PRINT;\n\t}\n}",
          "includes": [
            "#include \"log.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/hci.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <sys/socket.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <stdarg.h>",
            "#include <syslog.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n#include \"src/shared/util.h\"\n#include \"lib/hci.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <sys/socket.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdarg.h>\n#include <syslog.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nvoid __btd_enable_debug(struct btd_debug_desc *start,\n\t\t\t\t\tstruct btd_debug_desc *stop)\n{\n\tstruct btd_debug_desc *desc;\n\n\tif (start == NULL || stop == NULL)\n\t\treturn;\n\n\tfor (desc = start; desc < stop; desc++) {\n\t\tif (is_enabled(desc))\n\t\t\tdesc->flags |= BTD_DEBUG_FLAG_PRINT;\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_try_new0",
          "args": [
            "structbluetooth_plugin",
            "1"
          ],
          "line": 72
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"Loading %s plugin\"",
            "desc->name"
          ],
          "line": 70
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"Version mismatch for %s\"",
            "desc->name"
          ],
          "line": 66
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_failed",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "124-128",
          "snippet": "DBusMessage *btd_error_failed(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE\n\t\t\t\t\t\".Failed\", \"%s\", str);\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_failed(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE\n\t\t\t\t\t\".Failed\", \"%s\", str);\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_str_equal",
          "args": [
            "desc->version",
            "VERSION"
          ],
          "line": 65
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/builtin.h\"\n#include \"src/hcid.h\"\n#include \"src/log.h\"\n#include \"src/plugin.h\"\n#include \"btio/btio.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <sys/stat.h>\n#include <string.h>\n#include <dlfcn.h>\n#include <errno.h>\n#include <config.h>\n\nstatic GSList *plugins = NULL;\n\nstatic gboolean add_plugin(void *handle, struct bluetooth_plugin_desc *desc)\n{\n\tstruct bluetooth_plugin *plugin;\n\n\tif (desc->init == NULL)\n\t\treturn FALSE;\n\n\tif (g_str_equal(desc->version, VERSION) == FALSE) {\n\t\terror(\"Version mismatch for %s\", desc->name);\n\t\treturn FALSE;\n\t}\n\n\tDBG(\"Loading %s plugin\", desc->name);\n\n\tplugin = g_try_new0(struct bluetooth_plugin, 1);\n\tif (plugin == NULL)\n\t\treturn FALSE;\n\n\tplugin->handle = handle;\n\tplugin->active = FALSE;\n\tplugin->desc = desc;\n\n\t__btd_enable_debug(desc->debug_start, desc->debug_stop);\n\n\tplugins = g_slist_insert_sorted(plugins, plugin, compare_priority);\n\n\treturn TRUE;\n}"
  },
  {
    "function_name": "compare_priority",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/plugin.c",
    "lines": "50-56",
    "snippet": "static int compare_priority(gconstpointer a, gconstpointer b)\n{\n\tconst struct bluetooth_plugin *plugin1 = a;\n\tconst struct bluetooth_plugin *plugin2 = b;\n\n\treturn plugin2->desc->priority - plugin1->desc->priority;\n}",
    "includes": [
      "#include \"src/builtin.h\"",
      "#include \"src/hcid.h\"",
      "#include \"src/log.h\"",
      "#include \"src/plugin.h\"",
      "#include \"btio/btio.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <glib.h>",
      "#include <sys/stat.h>",
      "#include <string.h>",
      "#include <dlfcn.h>",
      "#include <errno.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"src/builtin.h\"\n#include \"src/hcid.h\"\n#include \"src/log.h\"\n#include \"src/plugin.h\"\n#include \"btio/btio.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <sys/stat.h>\n#include <string.h>\n#include <dlfcn.h>\n#include <errno.h>\n#include <config.h>\n\nstatic int compare_priority(gconstpointer a, gconstpointer b)\n{\n\tconst struct bluetooth_plugin *plugin1 = a;\n\tconst struct bluetooth_plugin *plugin2 = b;\n\n\treturn plugin2->desc->priority - plugin1->desc->priority;\n}"
  }
]