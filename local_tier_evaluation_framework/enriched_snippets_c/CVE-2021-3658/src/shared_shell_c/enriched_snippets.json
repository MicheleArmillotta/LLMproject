[
  {
    "function_name": "bt_shell_get_env",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/shell.c",
    "lines": "1236-1248",
    "snippet": "void *bt_shell_get_env(const char *name)\n{\n\tconst struct bt_shell_env *env;\n\n\tif (!data.envs)\n\t\treturn NULL;\n\n\tenv = queue_find(data.envs, match_env, name);\n\tif (!env)\n\t\treturn NULL;\n\n\treturn env->value;\n}",
    "includes": [
      "#include \"src/shared/shell.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/mainloop.h\"",
      "#include <readline/history.h>",
      "#include <readline/readline.h>",
      "#include <getopt.h>",
      "#include <wordexp.h>",
      "#include <sys/signalfd.h>",
      "#include <signal.h>",
      "#include <stdbool.h>",
      "#include <stdarg.h>",
      "#include <stdlib.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "queue_find",
          "args": [
            "data.envs",
            "match_env",
            "name"
          ],
          "line": 1243
        },
        "resolved": true,
        "details": {
          "function_name": "queue_find",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "231-247",
          "snippet": "void *queue_find(struct queue *queue, queue_match_func_t function,\n\t\t\t\t\t\t\tconst void *match_data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn NULL;\n\n\tif (!function)\n\t\tfunction = direct_match;\n\n\tfor (entry = queue->head; entry; entry = entry->next)\n\t\tif (function(entry->data, match_data))\n\t\t\treturn entry->data;\n\n\treturn NULL;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nvoid *queue_find(struct queue *queue, queue_match_func_t function,\n\t\t\t\t\t\t\tconst void *match_data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn NULL;\n\n\tif (!function)\n\t\tfunction = direct_match;\n\n\tfor (entry = queue->head; entry; entry = entry->next)\n\t\tif (function(entry->data, match_data))\n\t\t\treturn entry->data;\n\n\treturn NULL;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/shell.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/mainloop.h\"\n#include <readline/history.h>\n#include <readline/readline.h>\n#include <getopt.h>\n#include <wordexp.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nvoid *bt_shell_get_env(const char *name)\n{\n\tconst struct bt_shell_env *env;\n\n\tif (!data.envs)\n\t\treturn NULL;\n\n\tenv = queue_find(data.envs, match_env, name);\n\tif (!env)\n\t\treturn NULL;\n\n\treturn env->value;\n}"
  },
  {
    "function_name": "bt_shell_set_env",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/shell.c",
    "lines": "1209-1234",
    "snippet": "void bt_shell_set_env(const char *name, void *value)\n{\n\tstruct bt_shell_env *env;\n\n\tif (!data.envs) {\n\t\tif (!value)\n\t\t\treturn;\n\t\tdata.envs = queue_new();\n\t\tgoto done;\n\t}\n\n\tenv = queue_remove_if(data.envs, match_env, (void *) name);\n\tif (env)\n\t\tenv_destroy(env);\n\n\t/* Don't create an env if value is not set */\n\tif (!value)\n\t\treturn;\n\ndone:\n\tenv = new0(struct bt_shell_env, 1);\n\tenv->name = strdup(name);\n\tenv->value = value;\n\n\tqueue_push_tail(data.envs, env);\n}",
    "includes": [
      "#include \"src/shared/shell.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/mainloop.h\"",
      "#include <readline/history.h>",
      "#include <readline/readline.h>",
      "#include <getopt.h>",
      "#include <wordexp.h>",
      "#include <sys/signalfd.h>",
      "#include <signal.h>",
      "#include <stdbool.h>",
      "#include <stdarg.h>",
      "#include <stdlib.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "queue_push_tail",
          "args": [
            "data.envs",
            "env"
          ],
          "line": 1233
        },
        "resolved": true,
        "details": {
          "function_name": "queue_push_tail",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "88-108",
          "snippet": "bool queue_push_tail(struct queue *queue, void *data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn false;\n\n\tentry = queue_entry_new(data);\n\n\tif (queue->tail)\n\t\tqueue->tail->next = entry;\n\n\tqueue->tail = entry;\n\n\tif (!queue->head)\n\t\tqueue->head = entry;\n\n\tqueue->entries++;\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nbool queue_push_tail(struct queue *queue, void *data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn false;\n\n\tentry = queue_entry_new(data);\n\n\tif (queue->tail)\n\t\tqueue->tail->next = entry;\n\n\tqueue->tail = entry;\n\n\tif (!queue->head)\n\t\tqueue->head = entry;\n\n\tqueue->entries++;\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "strdup",
          "args": [
            "name"
          ],
          "line": 1230
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "new0",
          "args": [
            "structbt_shell_env",
            "1"
          ],
          "line": 1229
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "env_destroy",
          "args": [
            "env"
          ],
          "line": 1222
        },
        "resolved": true,
        "details": {
          "function_name": "env_destroy",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/shell.c",
          "lines": "1055-1061",
          "snippet": "static void env_destroy(void *data)\n{\n\tstruct bt_shell_env *env = data;\n\n\tfree(env->name);\n\tfree(env);\n}",
          "includes": [
            "#include \"src/shared/shell.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/mainloop.h\"",
            "#include <readline/history.h>",
            "#include <readline/readline.h>",
            "#include <getopt.h>",
            "#include <wordexp.h>",
            "#include <sys/signalfd.h>",
            "#include <signal.h>",
            "#include <stdbool.h>",
            "#include <stdarg.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/shell.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/mainloop.h\"\n#include <readline/history.h>\n#include <readline/readline.h>\n#include <getopt.h>\n#include <wordexp.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void env_destroy(void *data)\n{\n\tstruct bt_shell_env *env = data;\n\n\tfree(env->name);\n\tfree(env);\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_remove_if",
          "args": [
            "data.envs",
            "match_env",
            "(void *) name"
          ],
          "line": 1220
        },
        "resolved": true,
        "details": {
          "function_name": "queue_remove_if",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "278-316",
          "snippet": "void *queue_remove_if(struct queue *queue, queue_match_func_t function,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct queue_entry *entry, *prev = NULL;\n\n\tif (!queue)\n\t\treturn NULL;\n\n\tif (!function)\n\t\tfunction = direct_match;\n\n\tentry = queue->head;\n\n\twhile (entry) {\n\t\tif (function(entry->data, user_data)) {\n\t\t\tvoid *data;\n\n\t\t\tif (prev)\n\t\t\t\tprev->next = entry->next;\n\t\t\telse\n\t\t\t\tqueue->head = entry->next;\n\n\t\t\tif (!entry->next)\n\t\t\t\tqueue->tail = prev;\n\n\t\t\tdata = entry->data;\n\n\t\t\tfree(entry);\n\t\t\tqueue->entries--;\n\n\t\t\treturn data;\n\t\t} else {\n\t\t\tprev = entry;\n\t\t\tentry = entry->next;\n\t\t}\n\t}\n\n\treturn NULL;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nvoid *queue_remove_if(struct queue *queue, queue_match_func_t function,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct queue_entry *entry, *prev = NULL;\n\n\tif (!queue)\n\t\treturn NULL;\n\n\tif (!function)\n\t\tfunction = direct_match;\n\n\tentry = queue->head;\n\n\twhile (entry) {\n\t\tif (function(entry->data, user_data)) {\n\t\t\tvoid *data;\n\n\t\t\tif (prev)\n\t\t\t\tprev->next = entry->next;\n\t\t\telse\n\t\t\t\tqueue->head = entry->next;\n\n\t\t\tif (!entry->next)\n\t\t\t\tqueue->tail = prev;\n\n\t\t\tdata = entry->data;\n\n\t\t\tfree(entry);\n\t\t\tqueue->entries--;\n\n\t\t\treturn data;\n\t\t} else {\n\t\t\tprev = entry;\n\t\t\tentry = entry->next;\n\t\t}\n\t}\n\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_new",
          "args": [],
          "line": 1216
        },
        "resolved": true,
        "details": {
          "function_name": "queue_new",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "56-66",
          "snippet": "struct queue *queue_new(void)\n{\n\tstruct queue *queue;\n\n\tqueue = new0(struct queue, 1);\n\tqueue->head = NULL;\n\tqueue->tail = NULL;\n\tqueue->entries = 0;\n\n\treturn queue_ref(queue);\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nstruct queue *queue_new(void)\n{\n\tstruct queue *queue;\n\n\tqueue = new0(struct queue, 1);\n\tqueue->head = NULL;\n\tqueue->tail = NULL;\n\tqueue->entries = 0;\n\n\treturn queue_ref(queue);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/shell.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/mainloop.h\"\n#include <readline/history.h>\n#include <readline/readline.h>\n#include <getopt.h>\n#include <wordexp.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nvoid bt_shell_set_env(const char *name, void *value)\n{\n\tstruct bt_shell_env *env;\n\n\tif (!data.envs) {\n\t\tif (!value)\n\t\t\treturn;\n\t\tdata.envs = queue_new();\n\t\tgoto done;\n\t}\n\n\tenv = queue_remove_if(data.envs, match_env, (void *) name);\n\tif (env)\n\t\tenv_destroy(env);\n\n\t/* Don't create an env if value is not set */\n\tif (!value)\n\t\treturn;\n\ndone:\n\tenv = new0(struct bt_shell_env, 1);\n\tenv->name = strdup(name);\n\tenv->value = value;\n\n\tqueue_push_tail(data.envs, env);\n}"
  },
  {
    "function_name": "match_env",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/shell.c",
    "lines": "1201-1207",
    "snippet": "static bool match_env(const void *data, const void *user_data)\n{\n\tconst struct bt_shell_env *env = data;\n\tconst char *name = user_data;\n\n\treturn !strcmp(env->name, name);\n}",
    "includes": [
      "#include \"src/shared/shell.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/mainloop.h\"",
      "#include <readline/history.h>",
      "#include <readline/readline.h>",
      "#include <getopt.h>",
      "#include <wordexp.h>",
      "#include <sys/signalfd.h>",
      "#include <signal.h>",
      "#include <stdbool.h>",
      "#include <stdarg.h>",
      "#include <stdlib.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "env->name",
            "name"
          ],
          "line": 1206
        },
        "resolved": true,
        "details": {
          "function_name": "g_strcmp",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "1927-1930",
          "snippet": "static gint g_strcmp(gconstpointer a, gconstpointer b)\n{\n\treturn strcmp(a, b);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic gint g_strcmp(gconstpointer a, gconstpointer b)\n{\n\treturn strcmp(a, b);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/shell.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/mainloop.h\"\n#include <readline/history.h>\n#include <readline/readline.h>\n#include <getopt.h>\n#include <wordexp.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic bool match_env(const void *data, const void *user_data)\n{\n\tconst struct bt_shell_env *env = data;\n\tconst char *name = user_data;\n\n\treturn !strcmp(env->name, name);\n}"
  },
  {
    "function_name": "bt_shell_detach",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/shell.c",
    "lines": "1190-1199",
    "snippet": "bool bt_shell_detach(void)\n{\n\tif (!data.input)\n\t\treturn false;\n\n\tio_destroy(data.input);\n\tdata.input = NULL;\n\n\treturn true;\n}",
    "includes": [
      "#include \"src/shared/shell.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/mainloop.h\"",
      "#include <readline/history.h>",
      "#include <readline/readline.h>",
      "#include <getopt.h>",
      "#include <wordexp.h>",
      "#include <sys/signalfd.h>",
      "#include <signal.h>",
      "#include <stdbool.h>",
      "#include <stdarg.h>",
      "#include <stdlib.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "io_destroy",
          "args": [
            "data.input"
          ],
          "line": 1195
        },
        "resolved": true,
        "details": {
          "function_name": "io_destroy",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/io-glib.c",
          "lines": "111-135",
          "snippet": "void io_destroy(struct io *io)\n{\n\tif (!io)\n\t\treturn;\n\n\tif (io->read_watch) {\n\t\tg_source_remove(io->read_watch->id);\n\t\tio->read_watch = NULL;\n\t}\n\n\tif (io->write_watch) {\n\t\tg_source_remove(io->write_watch->id);\n\t\tio->write_watch = NULL;\n\t}\n\n\tif (io->disconnect_watch) {\n\t\tg_source_remove(io->disconnect_watch->id);\n\t\tio->disconnect_watch = NULL;\n\t}\n\n\tg_io_channel_unref(io->channel);\n\tio->channel = NULL;\n\n\tio_unref(io);\n}",
          "includes": [
            "#include \"src/shared/io.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/io.h\"\n#include <glib.h>\n#include <errno.h>\n#include <config.h>\n\nvoid io_destroy(struct io *io)\n{\n\tif (!io)\n\t\treturn;\n\n\tif (io->read_watch) {\n\t\tg_source_remove(io->read_watch->id);\n\t\tio->read_watch = NULL;\n\t}\n\n\tif (io->write_watch) {\n\t\tg_source_remove(io->write_watch->id);\n\t\tio->write_watch = NULL;\n\t}\n\n\tif (io->disconnect_watch) {\n\t\tg_source_remove(io->disconnect_watch->id);\n\t\tio->disconnect_watch = NULL;\n\t}\n\n\tg_io_channel_unref(io->channel);\n\tio->channel = NULL;\n\n\tio_unref(io);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/shell.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/mainloop.h\"\n#include <readline/history.h>\n#include <readline/readline.h>\n#include <getopt.h>\n#include <wordexp.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nbool bt_shell_detach(void)\n{\n\tif (!data.input)\n\t\treturn false;\n\n\tio_destroy(data.input);\n\tdata.input = NULL;\n\n\treturn true;\n}"
  },
  {
    "function_name": "bt_shell_attach",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/shell.c",
    "lines": "1159-1188",
    "snippet": "bool bt_shell_attach(int fd)\n{\n\tstruct io *io;\n\n\t/* TODO: Allow more than one input? */\n\tif (data.input)\n\t\treturn false;\n\n\tio = io_new(fd);\n\n\tif (!data.mode)\n\t\tio_set_read_handler(io, input_read, NULL, NULL);\n\n\tio_set_disconnect_handler(io, io_hup, NULL, NULL);\n\n\tdata.input = io;\n\n\tif (data.mode) {\n\t\tif (shell_exec(data.argc, data.argv) < 0) {\n\t\t\tbt_shell_noninteractive_quit(EXIT_FAILURE);\n\t\t\treturn true;\n\t\t}\n\n\t\tif (data.timeout)\n\t\t\ttimeout_add(data.timeout * 1000, shell_quit, NULL,\n\t\t\t\t\t\t\t\tNULL);\n\t}\n\n\treturn true;\n}",
    "includes": [
      "#include \"src/shared/shell.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/mainloop.h\"",
      "#include <readline/history.h>",
      "#include <readline/readline.h>",
      "#include <getopt.h>",
      "#include <wordexp.h>",
      "#include <sys/signalfd.h>",
      "#include <signal.h>",
      "#include <stdbool.h>",
      "#include <stdarg.h>",
      "#include <stdlib.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "timeout_add",
          "args": [
            "data.timeout * 1000",
            "shell_quit",
            "NULL",
            "NULL"
          ],
          "line": 1183
        },
        "resolved": true,
        "details": {
          "function_name": "timeout_add",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/timeout-mainloop.c",
          "lines": "55-74",
          "snippet": "unsigned int timeout_add(unsigned int timeout, timeout_func_t func,\n\t\t\tvoid *user_data, timeout_destroy_func_t destroy)\n{\n\tstruct timeout_data *data;\n\n\tdata = new0(struct timeout_data, 1);\n\tdata->func = func;\n\tdata->user_data = user_data;\n\tdata->timeout = timeout;\n\tdata->destroy = destroy;\n\n\tdata->id = mainloop_add_timeout(timeout, timeout_callback, data,\n\t\t\t\t\t\t\ttimeout_destroy);\n\tif (data->id < 0) {\n\t\tfree(data);\n\t\treturn 0;\n\t}\n\n\treturn (unsigned int) data->id;\n}",
          "includes": [
            "#include \"timeout.h\"",
            "#include \"util.h\"",
            "#include \"mainloop.h\"",
            "#include <stdlib.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"timeout.h\"\n#include \"util.h\"\n#include \"mainloop.h\"\n#include <stdlib.h>\n\nunsigned int timeout_add(unsigned int timeout, timeout_func_t func,\n\t\t\tvoid *user_data, timeout_destroy_func_t destroy)\n{\n\tstruct timeout_data *data;\n\n\tdata = new0(struct timeout_data, 1);\n\tdata->func = func;\n\tdata->user_data = user_data;\n\tdata->timeout = timeout;\n\tdata->destroy = destroy;\n\n\tdata->id = mainloop_add_timeout(timeout, timeout_callback, data,\n\t\t\t\t\t\t\ttimeout_destroy);\n\tif (data->id < 0) {\n\t\tfree(data);\n\t\treturn 0;\n\t}\n\n\treturn (unsigned int) data->id;\n}"
        }
      },
      {
        "call_info": {
          "callee": "bt_shell_noninteractive_quit",
          "args": [
            "EXIT_FAILURE"
          ],
          "line": 1178
        },
        "resolved": true,
        "details": {
          "function_name": "bt_shell_noninteractive_quit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/shell.c",
          "lines": "1103-1109",
          "snippet": "void bt_shell_noninteractive_quit(int status)\n{\n\tif (!data.mode || data.timeout)\n\t\treturn;\n\n\tbt_shell_quit(status);\n}",
          "includes": [
            "#include \"src/shared/shell.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/mainloop.h\"",
            "#include <readline/history.h>",
            "#include <readline/readline.h>",
            "#include <getopt.h>",
            "#include <wordexp.h>",
            "#include <sys/signalfd.h>",
            "#include <signal.h>",
            "#include <stdbool.h>",
            "#include <stdarg.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/shell.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/mainloop.h\"\n#include <readline/history.h>\n#include <readline/readline.h>\n#include <getopt.h>\n#include <wordexp.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nvoid bt_shell_noninteractive_quit(int status)\n{\n\tif (!data.mode || data.timeout)\n\t\treturn;\n\n\tbt_shell_quit(status);\n}"
        }
      },
      {
        "call_info": {
          "callee": "shell_exec",
          "args": [
            "data.argc",
            "data.argv"
          ],
          "line": 1177
        },
        "resolved": true,
        "details": {
          "function_name": "shell_exec",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/shell.c",
          "lines": "434-456",
          "snippet": "static int shell_exec(int argc, char *argv[])\n{\n\tint err;\n\n\tif (!data.menu || !argv[0])\n\t\treturn -EINVAL;\n\n\terr  = menu_exec(default_menu, argc, argv);\n\tif (err == -ENOENT) {\n\t\terr  = menu_exec(data.menu->entries, argc, argv);\n\t\tif (err == -ENOENT) {\n\t\t\terr = submenu_exec(argc, argv);\n\t\t\tif (err == -ENOENT) {\n\t\t\t\tprint_text(COLOR_HIGHLIGHT,\n\t\t\t\t\t\"Invalid command in menu %s: %s\",\n\t\t\t\t\tdata.menu->name , argv[0]);\n\t\t\t\tshell_print_help();\n\t\t\t}\n\t\t}\n\t}\n\n\treturn err;\n}",
          "includes": [
            "#include \"src/shared/shell.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/mainloop.h\"",
            "#include <readline/history.h>",
            "#include <readline/readline.h>",
            "#include <getopt.h>",
            "#include <wordexp.h>",
            "#include <sys/signalfd.h>",
            "#include <signal.h>",
            "#include <stdbool.h>",
            "#include <stdarg.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static const struct bt_shell_menu_entry default_menu[] = {\n\t{ \"back\",         NULL,       cmd_back, \"Return to main menu\", NULL,\n\t\t\t\t\t\t\tNULL, cmd_back_exists },\n\t{ \"menu\",         \"<name>\",   cmd_menu, \"Select submenu\",\n\t\t\t\t\t\t\tmenu_generator, NULL,\n\t\t\t\t\t\t\tcmd_menu_exists},\n\t{ \"version\",      NULL,       cmd_version, \"Display version\" },\n\t{ \"quit\",         NULL,       cmd_quit, \"Quit program\" },\n\t{ \"exit\",         NULL,       cmd_quit, \"Quit program\" },\n\t{ \"help\",         NULL,       cmd_help,\n\t\t\t\t\t\"Display help about this program\" },\n\t{ \"export\",       NULL,       cmd_export,\n\t\t\t\t\t\t\"Print evironment variables\" },\n\t{ }\n};"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/shell.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/mainloop.h\"\n#include <readline/history.h>\n#include <readline/readline.h>\n#include <getopt.h>\n#include <wordexp.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic const struct bt_shell_menu_entry default_menu[] = {\n\t{ \"back\",         NULL,       cmd_back, \"Return to main menu\", NULL,\n\t\t\t\t\t\t\tNULL, cmd_back_exists },\n\t{ \"menu\",         \"<name>\",   cmd_menu, \"Select submenu\",\n\t\t\t\t\t\t\tmenu_generator, NULL,\n\t\t\t\t\t\t\tcmd_menu_exists},\n\t{ \"version\",      NULL,       cmd_version, \"Display version\" },\n\t{ \"quit\",         NULL,       cmd_quit, \"Quit program\" },\n\t{ \"exit\",         NULL,       cmd_quit, \"Quit program\" },\n\t{ \"help\",         NULL,       cmd_help,\n\t\t\t\t\t\"Display help about this program\" },\n\t{ \"export\",       NULL,       cmd_export,\n\t\t\t\t\t\t\"Print evironment variables\" },\n\t{ }\n};\n\nstatic int shell_exec(int argc, char *argv[])\n{\n\tint err;\n\n\tif (!data.menu || !argv[0])\n\t\treturn -EINVAL;\n\n\terr  = menu_exec(default_menu, argc, argv);\n\tif (err == -ENOENT) {\n\t\terr  = menu_exec(data.menu->entries, argc, argv);\n\t\tif (err == -ENOENT) {\n\t\t\terr = submenu_exec(argc, argv);\n\t\t\tif (err == -ENOENT) {\n\t\t\t\tprint_text(COLOR_HIGHLIGHT,\n\t\t\t\t\t\"Invalid command in menu %s: %s\",\n\t\t\t\t\tdata.menu->name , argv[0]);\n\t\t\t\tshell_print_help();\n\t\t\t}\n\t\t}\n\t}\n\n\treturn err;\n}"
        }
      },
      {
        "call_info": {
          "callee": "io_set_disconnect_handler",
          "args": [
            "io",
            "io_hup",
            "NULL",
            "NULL"
          ],
          "line": 1172
        },
        "resolved": true,
        "details": {
          "function_name": "io_set_disconnect_handler",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/io-glib.c",
          "lines": "260-264",
          "snippet": "bool io_set_disconnect_handler(struct io *io, io_callback_func_t callback,\n\t\t\t\tvoid *user_data, io_destroy_func_t destroy)\n{\n\treturn io_set_handler(io, G_IO_HUP, callback, user_data, destroy);\n}",
          "includes": [
            "#include \"src/shared/io.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/io.h\"\n#include <glib.h>\n#include <errno.h>\n#include <config.h>\n\nbool io_set_disconnect_handler(struct io *io, io_callback_func_t callback,\n\t\t\t\tvoid *user_data, io_destroy_func_t destroy)\n{\n\treturn io_set_handler(io, G_IO_HUP, callback, user_data, destroy);\n}"
        }
      },
      {
        "call_info": {
          "callee": "io_set_read_handler",
          "args": [
            "io",
            "input_read",
            "NULL",
            "NULL"
          ],
          "line": 1170
        },
        "resolved": true,
        "details": {
          "function_name": "io_set_read_handler",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/io-glib.c",
          "lines": "248-252",
          "snippet": "bool io_set_read_handler(struct io *io, io_callback_func_t callback,\n\t\t\t\tvoid *user_data, io_destroy_func_t destroy)\n{\n\treturn io_set_handler(io, G_IO_IN, callback, user_data, destroy);\n}",
          "includes": [
            "#include \"src/shared/io.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/io.h\"\n#include <glib.h>\n#include <errno.h>\n#include <config.h>\n\nbool io_set_read_handler(struct io *io, io_callback_func_t callback,\n\t\t\t\tvoid *user_data, io_destroy_func_t destroy)\n{\n\treturn io_set_handler(io, G_IO_IN, callback, user_data, destroy);\n}"
        }
      },
      {
        "call_info": {
          "callee": "io_new",
          "args": [
            "fd"
          ],
          "line": 1167
        },
        "resolved": true,
        "details": {
          "function_name": "io_new",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/io-glib.c",
          "lines": "71-90",
          "snippet": "struct io *io_new(int fd)\n{\n\tstruct io *io;\n\n\tif (fd < 0)\n\t\treturn NULL;\n\n\tio = g_try_new0(struct io, 1);\n\tif (!io)\n\t\treturn NULL;\n\n\tio->channel = g_io_channel_unix_new(fd);\n\n\tg_io_channel_set_encoding(io->channel, NULL, NULL);\n\tg_io_channel_set_buffered(io->channel, FALSE);\n\n\tg_io_channel_set_close_on_unref(io->channel, FALSE);\n\n\treturn io_ref(io);\n}",
          "includes": [
            "#include \"src/shared/io.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/io.h\"\n#include <glib.h>\n#include <errno.h>\n#include <config.h>\n\nstruct io *io_new(int fd)\n{\n\tstruct io *io;\n\n\tif (fd < 0)\n\t\treturn NULL;\n\n\tio = g_try_new0(struct io, 1);\n\tif (!io)\n\t\treturn NULL;\n\n\tio->channel = g_io_channel_unix_new(fd);\n\n\tg_io_channel_set_encoding(io->channel, NULL, NULL);\n\tg_io_channel_set_buffered(io->channel, FALSE);\n\n\tg_io_channel_set_close_on_unref(io->channel, FALSE);\n\n\treturn io_ref(io);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/shell.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/mainloop.h\"\n#include <readline/history.h>\n#include <readline/readline.h>\n#include <getopt.h>\n#include <wordexp.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nbool bt_shell_attach(int fd)\n{\n\tstruct io *io;\n\n\t/* TODO: Allow more than one input? */\n\tif (data.input)\n\t\treturn false;\n\n\tio = io_new(fd);\n\n\tif (!data.mode)\n\t\tio_set_read_handler(io, input_read, NULL, NULL);\n\n\tio_set_disconnect_handler(io, io_hup, NULL, NULL);\n\n\tdata.input = io;\n\n\tif (data.mode) {\n\t\tif (shell_exec(data.argc, data.argv) < 0) {\n\t\t\tbt_shell_noninteractive_quit(EXIT_FAILURE);\n\t\t\treturn true;\n\t\t}\n\n\t\tif (data.timeout)\n\t\t\ttimeout_add(data.timeout * 1000, shell_quit, NULL,\n\t\t\t\t\t\t\t\tNULL);\n\t}\n\n\treturn true;\n}"
  },
  {
    "function_name": "shell_quit",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/shell.c",
    "lines": "1152-1157",
    "snippet": "static bool shell_quit(void *data)\n{\n\tmainloop_quit();\n\n\treturn false;\n}",
    "includes": [
      "#include \"src/shared/shell.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/mainloop.h\"",
      "#include <readline/history.h>",
      "#include <readline/readline.h>",
      "#include <getopt.h>",
      "#include <wordexp.h>",
      "#include <sys/signalfd.h>",
      "#include <signal.h>",
      "#include <stdbool.h>",
      "#include <stdarg.h>",
      "#include <stdlib.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "mainloop_quit",
          "args": [],
          "line": 1154
        },
        "resolved": true,
        "details": {
          "function_name": "mainloop_quit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/mainloop.c",
          "lines": "88-91",
          "snippet": "void mainloop_quit(void)\n{\n\tepoll_terminate = 1;\n}",
          "includes": [
            "#include \"mainloop.h\"",
            "#include <sys/epoll.h>",
            "#include <sys/timerfd.h>",
            "#include <sys/signalfd.h>",
            "#include <signal.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int epoll_terminate;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"mainloop.h\"\n#include <sys/epoll.h>\n#include <sys/timerfd.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <string.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic int epoll_terminate;\n\nvoid mainloop_quit(void)\n{\n\tepoll_terminate = 1;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/shell.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/mainloop.h\"\n#include <readline/history.h>\n#include <readline/readline.h>\n#include <getopt.h>\n#include <wordexp.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic bool shell_quit(void *data)\n{\n\tmainloop_quit();\n\n\treturn false;\n}"
  },
  {
    "function_name": "input_read",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/shell.c",
    "lines": "1146-1150",
    "snippet": "static bool input_read(struct io *io, void *user_data)\n{\n\trl_callback_read_char();\n\treturn true;\n}",
    "includes": [
      "#include \"src/shared/shell.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/mainloop.h\"",
      "#include <readline/history.h>",
      "#include <readline/readline.h>",
      "#include <getopt.h>",
      "#include <wordexp.h>",
      "#include <sys/signalfd.h>",
      "#include <signal.h>",
      "#include <stdbool.h>",
      "#include <stdarg.h>",
      "#include <stdlib.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "rl_callback_read_char",
          "args": [],
          "line": 1148
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/shell.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/mainloop.h\"\n#include <readline/history.h>\n#include <readline/readline.h>\n#include <getopt.h>\n#include <wordexp.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic bool input_read(struct io *io, void *user_data)\n{\n\trl_callback_read_char();\n\treturn true;\n}"
  },
  {
    "function_name": "bt_shell_set_prompt",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/shell.c",
    "lines": "1137-1144",
    "snippet": "void bt_shell_set_prompt(const char *string)\n{\n\tif (!data.init || data.mode)\n\t\treturn;\n\n\trl_set_prompt(string);\n\tbt_shell_printf(\"\\r\");\n}",
    "includes": [
      "#include \"src/shared/shell.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/mainloop.h\"",
      "#include <readline/history.h>",
      "#include <readline/readline.h>",
      "#include <getopt.h>",
      "#include <wordexp.h>",
      "#include <sys/signalfd.h>",
      "#include <signal.h>",
      "#include <stdbool.h>",
      "#include <stdarg.h>",
      "#include <stdlib.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "bt_shell_printf",
          "args": [
            "\"\\r\""
          ],
          "line": 1143
        },
        "resolved": true,
        "details": {
          "function_name": "bt_shell_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/shell.c",
          "lines": "458-498",
          "snippet": "void bt_shell_printf(const char *fmt, ...)\n{\n\tva_list args;\n\tbool save_input;\n\tchar *saved_line;\n\tint saved_point;\n\n\tif (!data.input)\n\t\treturn;\n\n\tif (data.mode) {\n\t\tva_start(args, fmt);\n\t\tvprintf(fmt, args);\n\t\tva_end(args);\n\t\treturn;\n\t}\n\n\tsave_input = !RL_ISSTATE(RL_STATE_DONE);\n\n\tif (save_input) {\n\t\tsaved_point = rl_point;\n\t\tsaved_line = rl_copy_text(0, rl_end);\n\t\tif (!data.saved_prompt)\n\t\t\trl_save_prompt();\n\t\trl_replace_line(\"\", 0);\n\t\trl_redisplay();\n\t}\n\n\tva_start(args, fmt);\n\tvprintf(fmt, args);\n\tva_end(args);\n\n\tif (save_input) {\n\t\tif (!data.saved_prompt)\n\t\t\trl_restore_prompt();\n\t\trl_replace_line(saved_line, 0);\n\t\trl_point = saved_point;\n\t\trl_forced_update_display();\n\t\tfree(saved_line);\n\t}\n}",
          "includes": [
            "#include \"src/shared/shell.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/mainloop.h\"",
            "#include <readline/history.h>",
            "#include <readline/readline.h>",
            "#include <getopt.h>",
            "#include <wordexp.h>",
            "#include <sys/signalfd.h>",
            "#include <signal.h>",
            "#include <stdbool.h>",
            "#include <stdarg.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static wordexp_t args;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/shell.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/mainloop.h\"\n#include <readline/history.h>\n#include <readline/readline.h>\n#include <getopt.h>\n#include <wordexp.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic wordexp_t args;\n\nvoid bt_shell_printf(const char *fmt, ...)\n{\n\tva_list args;\n\tbool save_input;\n\tchar *saved_line;\n\tint saved_point;\n\n\tif (!data.input)\n\t\treturn;\n\n\tif (data.mode) {\n\t\tva_start(args, fmt);\n\t\tvprintf(fmt, args);\n\t\tva_end(args);\n\t\treturn;\n\t}\n\n\tsave_input = !RL_ISSTATE(RL_STATE_DONE);\n\n\tif (save_input) {\n\t\tsaved_point = rl_point;\n\t\tsaved_line = rl_copy_text(0, rl_end);\n\t\tif (!data.saved_prompt)\n\t\t\trl_save_prompt();\n\t\trl_replace_line(\"\", 0);\n\t\trl_redisplay();\n\t}\n\n\tva_start(args, fmt);\n\tvprintf(fmt, args);\n\tva_end(args);\n\n\tif (save_input) {\n\t\tif (!data.saved_prompt)\n\t\t\trl_restore_prompt();\n\t\trl_replace_line(saved_line, 0);\n\t\trl_point = saved_point;\n\t\trl_forced_update_display();\n\t\tfree(saved_line);\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "rl_set_prompt",
          "args": [
            "string"
          ],
          "line": 1142
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/shell.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/mainloop.h\"\n#include <readline/history.h>\n#include <readline/readline.h>\n#include <getopt.h>\n#include <wordexp.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nvoid bt_shell_set_prompt(const char *string)\n{\n\tif (!data.init || data.mode)\n\t\treturn;\n\n\trl_set_prompt(string);\n\tbt_shell_printf(\"\\r\");\n}"
  },
  {
    "function_name": "bt_shell_add_submenu",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/shell.c",
    "lines": "1124-1135",
    "snippet": "bool bt_shell_add_submenu(const struct bt_shell_menu *menu)\n{\n\tif (!menu)\n\t\treturn false;\n\n\tif (!data.submenus)\n\t\tdata.submenus = queue_new();\n\n\tqueue_push_tail(data.submenus, (void *) menu);\n\n\treturn true;\n}",
    "includes": [
      "#include \"src/shared/shell.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/mainloop.h\"",
      "#include <readline/history.h>",
      "#include <readline/readline.h>",
      "#include <getopt.h>",
      "#include <wordexp.h>",
      "#include <sys/signalfd.h>",
      "#include <signal.h>",
      "#include <stdbool.h>",
      "#include <stdarg.h>",
      "#include <stdlib.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "queue_push_tail",
          "args": [
            "data.submenus",
            "(void *) menu"
          ],
          "line": 1132
        },
        "resolved": true,
        "details": {
          "function_name": "queue_push_tail",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "88-108",
          "snippet": "bool queue_push_tail(struct queue *queue, void *data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn false;\n\n\tentry = queue_entry_new(data);\n\n\tif (queue->tail)\n\t\tqueue->tail->next = entry;\n\n\tqueue->tail = entry;\n\n\tif (!queue->head)\n\t\tqueue->head = entry;\n\n\tqueue->entries++;\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nbool queue_push_tail(struct queue *queue, void *data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn false;\n\n\tentry = queue_entry_new(data);\n\n\tif (queue->tail)\n\t\tqueue->tail->next = entry;\n\n\tqueue->tail = entry;\n\n\tif (!queue->head)\n\t\tqueue->head = entry;\n\n\tqueue->entries++;\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_new",
          "args": [],
          "line": 1130
        },
        "resolved": true,
        "details": {
          "function_name": "queue_new",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "56-66",
          "snippet": "struct queue *queue_new(void)\n{\n\tstruct queue *queue;\n\n\tqueue = new0(struct queue, 1);\n\tqueue->head = NULL;\n\tqueue->tail = NULL;\n\tqueue->entries = 0;\n\n\treturn queue_ref(queue);\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nstruct queue *queue_new(void)\n{\n\tstruct queue *queue;\n\n\tqueue = new0(struct queue, 1);\n\tqueue->head = NULL;\n\tqueue->tail = NULL;\n\tqueue->entries = 0;\n\n\treturn queue_ref(queue);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/shell.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/mainloop.h\"\n#include <readline/history.h>\n#include <readline/readline.h>\n#include <getopt.h>\n#include <wordexp.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nbool bt_shell_add_submenu(const struct bt_shell_menu *menu)\n{\n\tif (!menu)\n\t\treturn false;\n\n\tif (!data.submenus)\n\t\tdata.submenus = queue_new();\n\n\tqueue_push_tail(data.submenus, (void *) menu);\n\n\treturn true;\n}"
  },
  {
    "function_name": "bt_shell_set_menu",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/shell.c",
    "lines": "1111-1122",
    "snippet": "bool bt_shell_set_menu(const struct bt_shell_menu *menu)\n{\n\tif (!menu)\n\t\treturn false;\n\n\tdata.menu = menu;\n\n\tif (!data.main)\n\t\tdata.main = menu;\n\n\treturn true;\n}",
    "includes": [
      "#include \"src/shared/shell.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/mainloop.h\"",
      "#include <readline/history.h>",
      "#include <readline/readline.h>",
      "#include <getopt.h>",
      "#include <wordexp.h>",
      "#include <sys/signalfd.h>",
      "#include <signal.h>",
      "#include <stdbool.h>",
      "#include <stdarg.h>",
      "#include <stdlib.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"src/shared/shell.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/mainloop.h\"\n#include <readline/history.h>\n#include <readline/readline.h>\n#include <getopt.h>\n#include <wordexp.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nbool bt_shell_set_menu(const struct bt_shell_menu *menu)\n{\n\tif (!menu)\n\t\treturn false;\n\n\tdata.menu = menu;\n\n\tif (!data.main)\n\t\tdata.main = menu;\n\n\treturn true;\n}"
  },
  {
    "function_name": "bt_shell_noninteractive_quit",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/shell.c",
    "lines": "1103-1109",
    "snippet": "void bt_shell_noninteractive_quit(int status)\n{\n\tif (!data.mode || data.timeout)\n\t\treturn;\n\n\tbt_shell_quit(status);\n}",
    "includes": [
      "#include \"src/shared/shell.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/mainloop.h\"",
      "#include <readline/history.h>",
      "#include <readline/readline.h>",
      "#include <getopt.h>",
      "#include <wordexp.h>",
      "#include <sys/signalfd.h>",
      "#include <signal.h>",
      "#include <stdbool.h>",
      "#include <stdarg.h>",
      "#include <stdlib.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "bt_shell_quit",
          "args": [
            "status"
          ],
          "line": 1108
        },
        "resolved": true,
        "details": {
          "function_name": "bt_shell_quit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/shell.c",
          "lines": "1095-1101",
          "snippet": "void bt_shell_quit(int status)\n{\n\tif (status == EXIT_SUCCESS)\n\t\tmainloop_exit_success();\n\telse\n\t\tmainloop_exit_failure();\n}",
          "includes": [
            "#include \"src/shared/shell.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/mainloop.h\"",
            "#include <readline/history.h>",
            "#include <readline/readline.h>",
            "#include <getopt.h>",
            "#include <wordexp.h>",
            "#include <sys/signalfd.h>",
            "#include <signal.h>",
            "#include <stdbool.h>",
            "#include <stdarg.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/shell.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/mainloop.h\"\n#include <readline/history.h>\n#include <readline/readline.h>\n#include <getopt.h>\n#include <wordexp.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nvoid bt_shell_quit(int status)\n{\n\tif (status == EXIT_SUCCESS)\n\t\tmainloop_exit_success();\n\telse\n\t\tmainloop_exit_failure();\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/shell.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/mainloop.h\"\n#include <readline/history.h>\n#include <readline/readline.h>\n#include <getopt.h>\n#include <wordexp.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nvoid bt_shell_noninteractive_quit(int status)\n{\n\tif (!data.mode || data.timeout)\n\t\treturn;\n\n\tbt_shell_quit(status);\n}"
  },
  {
    "function_name": "bt_shell_quit",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/shell.c",
    "lines": "1095-1101",
    "snippet": "void bt_shell_quit(int status)\n{\n\tif (status == EXIT_SUCCESS)\n\t\tmainloop_exit_success();\n\telse\n\t\tmainloop_exit_failure();\n}",
    "includes": [
      "#include \"src/shared/shell.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/mainloop.h\"",
      "#include <readline/history.h>",
      "#include <readline/readline.h>",
      "#include <getopt.h>",
      "#include <wordexp.h>",
      "#include <sys/signalfd.h>",
      "#include <signal.h>",
      "#include <stdbool.h>",
      "#include <stdarg.h>",
      "#include <stdlib.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "mainloop_exit_failure",
          "args": [],
          "line": 1100
        },
        "resolved": true,
        "details": {
          "function_name": "mainloop_exit_failure",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/mainloop.c",
          "lines": "99-103",
          "snippet": "void mainloop_exit_failure(void)\n{\n\texit_status = EXIT_FAILURE;\n\tepoll_terminate = 1;\n}",
          "includes": [
            "#include \"mainloop.h\"",
            "#include <sys/epoll.h>",
            "#include <sys/timerfd.h>",
            "#include <sys/signalfd.h>",
            "#include <signal.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int epoll_terminate;",
            "static int exit_status = EXIT_SUCCESS;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"mainloop.h\"\n#include <sys/epoll.h>\n#include <sys/timerfd.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <string.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic int epoll_terminate;\nstatic int exit_status = EXIT_SUCCESS;\n\nvoid mainloop_exit_failure(void)\n{\n\texit_status = EXIT_FAILURE;\n\tepoll_terminate = 1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "mainloop_exit_success",
          "args": [],
          "line": 1098
        },
        "resolved": true,
        "details": {
          "function_name": "mainloop_exit_success",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/mainloop.c",
          "lines": "93-97",
          "snippet": "void mainloop_exit_success(void)\n{\n\texit_status = EXIT_SUCCESS;\n\tepoll_terminate = 1;\n}",
          "includes": [
            "#include \"mainloop.h\"",
            "#include <sys/epoll.h>",
            "#include <sys/timerfd.h>",
            "#include <sys/signalfd.h>",
            "#include <signal.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int epoll_terminate;",
            "static int exit_status = EXIT_SUCCESS;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"mainloop.h\"\n#include <sys/epoll.h>\n#include <sys/timerfd.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <string.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic int epoll_terminate;\nstatic int exit_status = EXIT_SUCCESS;\n\nvoid mainloop_exit_success(void)\n{\n\texit_status = EXIT_SUCCESS;\n\tepoll_terminate = 1;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/shell.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/mainloop.h\"\n#include <readline/history.h>\n#include <readline/readline.h>\n#include <getopt.h>\n#include <wordexp.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nvoid bt_shell_quit(int status)\n{\n\tif (status == EXIT_SUCCESS)\n\t\tmainloop_exit_success();\n\telse\n\t\tmainloop_exit_failure();\n}"
  },
  {
    "function_name": "bt_shell_cleanup",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/shell.c",
    "lines": "1079-1093",
    "snippet": "void bt_shell_cleanup(void)\n{\n\tbt_shell_release_prompt(\"\");\n\tbt_shell_detach();\n\n\tif (data.envs) {\n\t\tqueue_destroy(data.envs, env_destroy);\n\t\tdata.envs = NULL;\n\t}\n\n\trl_cleanup();\n\n\tdata.init = false;\n\tfree(data.name);\n}",
    "includes": [
      "#include \"src/shared/shell.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/mainloop.h\"",
      "#include <readline/history.h>",
      "#include <readline/readline.h>",
      "#include <getopt.h>",
      "#include <wordexp.h>",
      "#include <sys/signalfd.h>",
      "#include <signal.h>",
      "#include <stdbool.h>",
      "#include <stdarg.h>",
      "#include <stdlib.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "data.name"
          ],
          "line": 1092
        },
        "resolved": true,
        "details": {
          "function_name": "bt_att_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/att.c",
          "lines": "956-985",
          "snippet": "static void bt_att_free(struct bt_att *att)\n{\n\tif (att->pending_req)\n\t\tdestroy_att_send_op(att->pending_req);\n\n\tif (att->pending_ind)\n\t\tdestroy_att_send_op(att->pending_ind);\n\n\tio_destroy(att->io);\n\tbt_crypto_unref(att->crypto);\n\n\tqueue_destroy(att->req_queue, NULL);\n\tqueue_destroy(att->ind_queue, NULL);\n\tqueue_destroy(att->write_queue, NULL);\n\tqueue_destroy(att->notify_list, NULL);\n\tqueue_destroy(att->disconn_list, NULL);\n\n\tif (att->timeout_destroy)\n\t\tatt->timeout_destroy(att->timeout_data);\n\n\tif (att->debug_destroy)\n\t\tatt->debug_destroy(att->debug_data);\n\n\tfree(att->local_sign);\n\tfree(att->remote_sign);\n\n\tfree(att->buf);\n\n\tfree(att);\n}",
          "includes": [
            "#include \"src/shared/crypto.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/l2cap.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/crypto.h\"\n#include \"src/shared/att.h\"\n#include \"lib/uuid.h\"\n#include \"lib/l2cap.h\"\n#include \"lib/bluetooth.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include <errno.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <config.h>\n\nstatic void bt_att_free(struct bt_att *att)\n{\n\tif (att->pending_req)\n\t\tdestroy_att_send_op(att->pending_req);\n\n\tif (att->pending_ind)\n\t\tdestroy_att_send_op(att->pending_ind);\n\n\tio_destroy(att->io);\n\tbt_crypto_unref(att->crypto);\n\n\tqueue_destroy(att->req_queue, NULL);\n\tqueue_destroy(att->ind_queue, NULL);\n\tqueue_destroy(att->write_queue, NULL);\n\tqueue_destroy(att->notify_list, NULL);\n\tqueue_destroy(att->disconn_list, NULL);\n\n\tif (att->timeout_destroy)\n\t\tatt->timeout_destroy(att->timeout_data);\n\n\tif (att->debug_destroy)\n\t\tatt->debug_destroy(att->debug_data);\n\n\tfree(att->local_sign);\n\tfree(att->remote_sign);\n\n\tfree(att->buf);\n\n\tfree(att);\n}"
        }
      },
      {
        "call_info": {
          "callee": "rl_cleanup",
          "args": [],
          "line": 1089
        },
        "resolved": true,
        "details": {
          "function_name": "rl_cleanup",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/shell.c",
          "lines": "1043-1053",
          "snippet": "static void rl_cleanup(void)\n{\n\tif (data.mode)\n\t\treturn;\n\n\tif (data.history[0] != '\\0')\n\t\twrite_history(data.history);\n\n\trl_message(\"\");\n\trl_callback_handler_remove();\n}",
          "includes": [
            "#include \"src/shared/shell.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/mainloop.h\"",
            "#include <readline/history.h>",
            "#include <readline/readline.h>",
            "#include <getopt.h>",
            "#include <wordexp.h>",
            "#include <sys/signalfd.h>",
            "#include <signal.h>",
            "#include <stdbool.h>",
            "#include <stdarg.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static struct {\n\tbool init;\n\tchar *name;\n\tchar history[256];\n\tint argc;\n\tchar **argv;\n\tbool mode;\n\tint timeout;\n\tstruct io *input;\n\n\tbool saved_prompt;\n\tbt_shell_prompt_input_func saved_func;\n\tvoid *saved_user_data;\n\n\tconst struct bt_shell_menu *menu;\n\tconst struct bt_shell_menu *main;\n\tstruct queue *submenus;\n\tconst struct bt_shell_menu_entry *exec;\n\n\tstruct queue *envs;\n} data;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/shell.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/mainloop.h\"\n#include <readline/history.h>\n#include <readline/readline.h>\n#include <getopt.h>\n#include <wordexp.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic struct {\n\tbool init;\n\tchar *name;\n\tchar history[256];\n\tint argc;\n\tchar **argv;\n\tbool mode;\n\tint timeout;\n\tstruct io *input;\n\n\tbool saved_prompt;\n\tbt_shell_prompt_input_func saved_func;\n\tvoid *saved_user_data;\n\n\tconst struct bt_shell_menu *menu;\n\tconst struct bt_shell_menu *main;\n\tstruct queue *submenus;\n\tconst struct bt_shell_menu_entry *exec;\n\n\tstruct queue *envs;\n} data;\n\nstatic void rl_cleanup(void)\n{\n\tif (data.mode)\n\t\treturn;\n\n\tif (data.history[0] != '\\0')\n\t\twrite_history(data.history);\n\n\trl_message(\"\");\n\trl_callback_handler_remove();\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_destroy",
          "args": [
            "data.envs",
            "env_destroy"
          ],
          "line": 1085
        },
        "resolved": true,
        "details": {
          "function_name": "queue_destroy",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "68-76",
          "snippet": "void queue_destroy(struct queue *queue, queue_destroy_func_t destroy)\n{\n\tif (!queue)\n\t\treturn;\n\n\tqueue_remove_all(queue, NULL, NULL, destroy);\n\n\tqueue_unref(queue);\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nvoid queue_destroy(struct queue *queue, queue_destroy_func_t destroy)\n{\n\tif (!queue)\n\t\treturn;\n\n\tqueue_remove_all(queue, NULL, NULL, destroy);\n\n\tqueue_unref(queue);\n}"
        }
      },
      {
        "call_info": {
          "callee": "bt_shell_detach",
          "args": [],
          "line": 1082
        },
        "resolved": true,
        "details": {
          "function_name": "bt_shell_detach",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/shell.c",
          "lines": "1190-1199",
          "snippet": "bool bt_shell_detach(void)\n{\n\tif (!data.input)\n\t\treturn false;\n\n\tio_destroy(data.input);\n\tdata.input = NULL;\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/shell.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/mainloop.h\"",
            "#include <readline/history.h>",
            "#include <readline/readline.h>",
            "#include <getopt.h>",
            "#include <wordexp.h>",
            "#include <sys/signalfd.h>",
            "#include <signal.h>",
            "#include <stdbool.h>",
            "#include <stdarg.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/shell.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/mainloop.h\"\n#include <readline/history.h>\n#include <readline/readline.h>\n#include <getopt.h>\n#include <wordexp.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nbool bt_shell_detach(void)\n{\n\tif (!data.input)\n\t\treturn false;\n\n\tio_destroy(data.input);\n\tdata.input = NULL;\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "bt_shell_release_prompt",
          "args": [
            "\"\""
          ],
          "line": 1081
        },
        "resolved": true,
        "details": {
          "function_name": "bt_shell_release_prompt",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/shell.c",
          "lines": "538-559",
          "snippet": "int bt_shell_release_prompt(const char *input)\n{\n\tbt_shell_prompt_input_func func;\n\tvoid *user_data;\n\n\tif (!data.saved_prompt)\n\t\treturn -1;\n\n\tdata.saved_prompt = false;\n\n\trl_restore_prompt();\n\n\tfunc = data.saved_func;\n\tuser_data = data.saved_user_data;\n\n\tdata.saved_func = NULL;\n\tdata.saved_user_data = NULL;\n\n\tfunc(input, user_data);\n\n\treturn 0;\n}",
          "includes": [
            "#include \"src/shared/shell.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/mainloop.h\"",
            "#include <readline/history.h>",
            "#include <readline/readline.h>",
            "#include <getopt.h>",
            "#include <wordexp.h>",
            "#include <sys/signalfd.h>",
            "#include <signal.h>",
            "#include <stdbool.h>",
            "#include <stdarg.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/shell.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/mainloop.h\"\n#include <readline/history.h>\n#include <readline/readline.h>\n#include <getopt.h>\n#include <wordexp.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nint bt_shell_release_prompt(const char *input)\n{\n\tbt_shell_prompt_input_func func;\n\tvoid *user_data;\n\n\tif (!data.saved_prompt)\n\t\treturn -1;\n\n\tdata.saved_prompt = false;\n\n\trl_restore_prompt();\n\n\tfunc = data.saved_func;\n\tuser_data = data.saved_user_data;\n\n\tdata.saved_func = NULL;\n\tdata.saved_user_data = NULL;\n\n\tfunc(input, user_data);\n\n\treturn 0;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/shell.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/mainloop.h\"\n#include <readline/history.h>\n#include <readline/readline.h>\n#include <getopt.h>\n#include <wordexp.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nvoid bt_shell_cleanup(void)\n{\n\tbt_shell_release_prompt(\"\");\n\tbt_shell_detach();\n\n\tif (data.envs) {\n\t\tqueue_destroy(data.envs, env_destroy);\n\t\tdata.envs = NULL;\n\t}\n\n\trl_cleanup();\n\n\tdata.init = false;\n\tfree(data.name);\n}"
  },
  {
    "function_name": "bt_shell_run",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/shell.c",
    "lines": "1063-1077",
    "snippet": "int bt_shell_run(void)\n{\n\tstruct io *signal;\n\tint status;\n\n\tsignal = setup_signalfd();\n\n\tstatus = mainloop_run();\n\n\tio_destroy(signal);\n\n\tbt_shell_cleanup();\n\n\treturn status;\n}",
    "includes": [
      "#include \"src/shared/shell.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/mainloop.h\"",
      "#include <readline/history.h>",
      "#include <readline/readline.h>",
      "#include <getopt.h>",
      "#include <wordexp.h>",
      "#include <sys/signalfd.h>",
      "#include <signal.h>",
      "#include <stdbool.h>",
      "#include <stdarg.h>",
      "#include <stdlib.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "bt_shell_cleanup",
          "args": [],
          "line": 1074
        },
        "resolved": true,
        "details": {
          "function_name": "bt_shell_cleanup",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/shell.c",
          "lines": "1079-1093",
          "snippet": "void bt_shell_cleanup(void)\n{\n\tbt_shell_release_prompt(\"\");\n\tbt_shell_detach();\n\n\tif (data.envs) {\n\t\tqueue_destroy(data.envs, env_destroy);\n\t\tdata.envs = NULL;\n\t}\n\n\trl_cleanup();\n\n\tdata.init = false;\n\tfree(data.name);\n}",
          "includes": [
            "#include \"src/shared/shell.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/mainloop.h\"",
            "#include <readline/history.h>",
            "#include <readline/readline.h>",
            "#include <getopt.h>",
            "#include <wordexp.h>",
            "#include <sys/signalfd.h>",
            "#include <signal.h>",
            "#include <stdbool.h>",
            "#include <stdarg.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/shell.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/mainloop.h\"\n#include <readline/history.h>\n#include <readline/readline.h>\n#include <getopt.h>\n#include <wordexp.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nvoid bt_shell_cleanup(void)\n{\n\tbt_shell_release_prompt(\"\");\n\tbt_shell_detach();\n\n\tif (data.envs) {\n\t\tqueue_destroy(data.envs, env_destroy);\n\t\tdata.envs = NULL;\n\t}\n\n\trl_cleanup();\n\n\tdata.init = false;\n\tfree(data.name);\n}"
        }
      },
      {
        "call_info": {
          "callee": "io_destroy",
          "args": [
            "signal"
          ],
          "line": 1072
        },
        "resolved": true,
        "details": {
          "function_name": "io_destroy",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/io-glib.c",
          "lines": "111-135",
          "snippet": "void io_destroy(struct io *io)\n{\n\tif (!io)\n\t\treturn;\n\n\tif (io->read_watch) {\n\t\tg_source_remove(io->read_watch->id);\n\t\tio->read_watch = NULL;\n\t}\n\n\tif (io->write_watch) {\n\t\tg_source_remove(io->write_watch->id);\n\t\tio->write_watch = NULL;\n\t}\n\n\tif (io->disconnect_watch) {\n\t\tg_source_remove(io->disconnect_watch->id);\n\t\tio->disconnect_watch = NULL;\n\t}\n\n\tg_io_channel_unref(io->channel);\n\tio->channel = NULL;\n\n\tio_unref(io);\n}",
          "includes": [
            "#include \"src/shared/io.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/io.h\"\n#include <glib.h>\n#include <errno.h>\n#include <config.h>\n\nvoid io_destroy(struct io *io)\n{\n\tif (!io)\n\t\treturn;\n\n\tif (io->read_watch) {\n\t\tg_source_remove(io->read_watch->id);\n\t\tio->read_watch = NULL;\n\t}\n\n\tif (io->write_watch) {\n\t\tg_source_remove(io->write_watch->id);\n\t\tio->write_watch = NULL;\n\t}\n\n\tif (io->disconnect_watch) {\n\t\tg_source_remove(io->disconnect_watch->id);\n\t\tio->disconnect_watch = NULL;\n\t}\n\n\tg_io_channel_unref(io->channel);\n\tio->channel = NULL;\n\n\tio_unref(io);\n}"
        }
      },
      {
        "call_info": {
          "callee": "mainloop_run",
          "args": [],
          "line": 1070
        },
        "resolved": true,
        "details": {
          "function_name": "mainloop_run",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/mainloop.c",
          "lines": "124-187",
          "snippet": "int mainloop_run(void)\n{\n\tunsigned int i;\n\n\tif (signal_data) {\n\t\tif (sigprocmask(SIG_BLOCK, &signal_data->mask, NULL) < 0)\n\t\t\treturn EXIT_FAILURE;\n\n\t\tsignal_data->fd = signalfd(-1, &signal_data->mask,\n\t\t\t\t\t\tSFD_NONBLOCK | SFD_CLOEXEC);\n\t\tif (signal_data->fd < 0)\n\t\t\treturn EXIT_FAILURE;\n\n\t\tif (mainloop_add_fd(signal_data->fd, EPOLLIN,\n\t\t\t\tsignal_callback, signal_data, NULL) < 0) {\n\t\t\tclose(signal_data->fd);\n\t\t\treturn EXIT_FAILURE;\n\t\t}\n\t}\n\n\twhile (!epoll_terminate) {\n\t\tstruct epoll_event events[MAX_EPOLL_EVENTS];\n\t\tint n, nfds;\n\n\t\tnfds = epoll_wait(epoll_fd, events, MAX_EPOLL_EVENTS, -1);\n\t\tif (nfds < 0)\n\t\t\tcontinue;\n\n\t\tfor (n = 0; n < nfds; n++) {\n\t\t\tstruct mainloop_data *data = events[n].data.ptr;\n\n\t\t\tdata->callback(data->fd, events[n].events,\n\t\t\t\t\t\t\tdata->user_data);\n\t\t}\n\t}\n\n\tif (signal_data) {\n\t\tmainloop_remove_fd(signal_data->fd);\n\t\tclose(signal_data->fd);\n\n\t\tif (signal_data->destroy)\n\t\t\tsignal_data->destroy(signal_data->user_data);\n\t}\n\n\tfor (i = 0; i < MAX_MAINLOOP_ENTRIES; i++) {\n\t\tstruct mainloop_data *data = mainloop_list[i];\n\n\t\tmainloop_list[i] = NULL;\n\n\t\tif (data) {\n\t\t\tepoll_ctl(epoll_fd, EPOLL_CTL_DEL, data->fd, NULL);\n\n\t\t\tif (data->destroy)\n\t\t\t\tdata->destroy(data->user_data);\n\n\t\t\tfree(data);\n\t\t}\n\t}\n\n\tclose(epoll_fd);\n\tepoll_fd = 0;\n\n\treturn exit_status;\n}",
          "includes": [
            "#include \"mainloop.h\"",
            "#include <sys/epoll.h>",
            "#include <sys/timerfd.h>",
            "#include <sys/signalfd.h>",
            "#include <signal.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define MAX_MAINLOOP_ENTRIES 128",
            "#define MAX_EPOLL_EVENTS 10"
          ],
          "globals_used": [
            "static int epoll_fd;",
            "static int epoll_terminate;",
            "static int exit_status = EXIT_SUCCESS;",
            "static struct mainloop_data *mainloop_list[MAX_MAINLOOP_ENTRIES];",
            "static struct signal_data *signal_data;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"mainloop.h\"\n#include <sys/epoll.h>\n#include <sys/timerfd.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <string.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\n#define MAX_MAINLOOP_ENTRIES 128\n#define MAX_EPOLL_EVENTS 10\n\nstatic int epoll_fd;\nstatic int epoll_terminate;\nstatic int exit_status = EXIT_SUCCESS;\nstatic struct mainloop_data *mainloop_list[MAX_MAINLOOP_ENTRIES];\nstatic struct signal_data *signal_data;\n\nint mainloop_run(void)\n{\n\tunsigned int i;\n\n\tif (signal_data) {\n\t\tif (sigprocmask(SIG_BLOCK, &signal_data->mask, NULL) < 0)\n\t\t\treturn EXIT_FAILURE;\n\n\t\tsignal_data->fd = signalfd(-1, &signal_data->mask,\n\t\t\t\t\t\tSFD_NONBLOCK | SFD_CLOEXEC);\n\t\tif (signal_data->fd < 0)\n\t\t\treturn EXIT_FAILURE;\n\n\t\tif (mainloop_add_fd(signal_data->fd, EPOLLIN,\n\t\t\t\tsignal_callback, signal_data, NULL) < 0) {\n\t\t\tclose(signal_data->fd);\n\t\t\treturn EXIT_FAILURE;\n\t\t}\n\t}\n\n\twhile (!epoll_terminate) {\n\t\tstruct epoll_event events[MAX_EPOLL_EVENTS];\n\t\tint n, nfds;\n\n\t\tnfds = epoll_wait(epoll_fd, events, MAX_EPOLL_EVENTS, -1);\n\t\tif (nfds < 0)\n\t\t\tcontinue;\n\n\t\tfor (n = 0; n < nfds; n++) {\n\t\t\tstruct mainloop_data *data = events[n].data.ptr;\n\n\t\t\tdata->callback(data->fd, events[n].events,\n\t\t\t\t\t\t\tdata->user_data);\n\t\t}\n\t}\n\n\tif (signal_data) {\n\t\tmainloop_remove_fd(signal_data->fd);\n\t\tclose(signal_data->fd);\n\n\t\tif (signal_data->destroy)\n\t\t\tsignal_data->destroy(signal_data->user_data);\n\t}\n\n\tfor (i = 0; i < MAX_MAINLOOP_ENTRIES; i++) {\n\t\tstruct mainloop_data *data = mainloop_list[i];\n\n\t\tmainloop_list[i] = NULL;\n\n\t\tif (data) {\n\t\t\tepoll_ctl(epoll_fd, EPOLL_CTL_DEL, data->fd, NULL);\n\n\t\t\tif (data->destroy)\n\t\t\t\tdata->destroy(data->user_data);\n\n\t\t\tfree(data);\n\t\t}\n\t}\n\n\tclose(epoll_fd);\n\tepoll_fd = 0;\n\n\treturn exit_status;\n}"
        }
      },
      {
        "call_info": {
          "callee": "setup_signalfd",
          "args": [],
          "line": 1068
        },
        "resolved": true,
        "details": {
          "function_name": "setup_signalfd",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/shell.c",
          "lines": "864-892",
          "snippet": "static struct io *setup_signalfd(void)\n{\n\tstruct io *io;\n\tsigset_t mask;\n\tint fd;\n\n\tsigemptyset(&mask);\n\tsigaddset(&mask, SIGINT);\n\tsigaddset(&mask, SIGTERM);\n\n\tif (sigprocmask(SIG_BLOCK, &mask, NULL) < 0) {\n\t\tperror(\"Failed to set signal mask\");\n\t\treturn 0;\n\t}\n\n\tfd = signalfd(-1, &mask, 0);\n\tif (fd < 0) {\n\t\tperror(\"Failed to create signal descriptor\");\n\t\treturn 0;\n\t}\n\n\tio = io_new(fd);\n\n\tio_set_close_on_destroy(io, true);\n\tio_set_read_handler(io, signal_read, NULL, NULL);\n\tio_set_disconnect_handler(io, io_hup, NULL, NULL);\n\n\treturn io;\n}",
          "includes": [
            "#include \"src/shared/shell.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/mainloop.h\"",
            "#include <readline/history.h>",
            "#include <readline/readline.h>",
            "#include <getopt.h>",
            "#include <wordexp.h>",
            "#include <sys/signalfd.h>",
            "#include <signal.h>",
            "#include <stdbool.h>",
            "#include <stdarg.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/shell.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/mainloop.h\"\n#include <readline/history.h>\n#include <readline/readline.h>\n#include <getopt.h>\n#include <wordexp.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic struct io *setup_signalfd(void)\n{\n\tstruct io *io;\n\tsigset_t mask;\n\tint fd;\n\n\tsigemptyset(&mask);\n\tsigaddset(&mask, SIGINT);\n\tsigaddset(&mask, SIGTERM);\n\n\tif (sigprocmask(SIG_BLOCK, &mask, NULL) < 0) {\n\t\tperror(\"Failed to set signal mask\");\n\t\treturn 0;\n\t}\n\n\tfd = signalfd(-1, &mask, 0);\n\tif (fd < 0) {\n\t\tperror(\"Failed to create signal descriptor\");\n\t\treturn 0;\n\t}\n\n\tio = io_new(fd);\n\n\tio_set_close_on_destroy(io, true);\n\tio_set_read_handler(io, signal_read, NULL, NULL);\n\tio_set_disconnect_handler(io, io_hup, NULL, NULL);\n\n\treturn io;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/shell.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/mainloop.h\"\n#include <readline/history.h>\n#include <readline/readline.h>\n#include <getopt.h>\n#include <wordexp.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nint bt_shell_run(void)\n{\n\tstruct io *signal;\n\tint status;\n\n\tsignal = setup_signalfd();\n\n\tstatus = mainloop_run();\n\n\tio_destroy(signal);\n\n\tbt_shell_cleanup();\n\n\treturn status;\n}"
  },
  {
    "function_name": "env_destroy",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/shell.c",
    "lines": "1055-1061",
    "snippet": "static void env_destroy(void *data)\n{\n\tstruct bt_shell_env *env = data;\n\n\tfree(env->name);\n\tfree(env);\n}",
    "includes": [
      "#include \"src/shared/shell.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/mainloop.h\"",
      "#include <readline/history.h>",
      "#include <readline/readline.h>",
      "#include <getopt.h>",
      "#include <wordexp.h>",
      "#include <sys/signalfd.h>",
      "#include <signal.h>",
      "#include <stdbool.h>",
      "#include <stdarg.h>",
      "#include <stdlib.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "env"
          ],
          "line": 1060
        },
        "resolved": true,
        "details": {
          "function_name": "bt_att_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/att.c",
          "lines": "956-985",
          "snippet": "static void bt_att_free(struct bt_att *att)\n{\n\tif (att->pending_req)\n\t\tdestroy_att_send_op(att->pending_req);\n\n\tif (att->pending_ind)\n\t\tdestroy_att_send_op(att->pending_ind);\n\n\tio_destroy(att->io);\n\tbt_crypto_unref(att->crypto);\n\n\tqueue_destroy(att->req_queue, NULL);\n\tqueue_destroy(att->ind_queue, NULL);\n\tqueue_destroy(att->write_queue, NULL);\n\tqueue_destroy(att->notify_list, NULL);\n\tqueue_destroy(att->disconn_list, NULL);\n\n\tif (att->timeout_destroy)\n\t\tatt->timeout_destroy(att->timeout_data);\n\n\tif (att->debug_destroy)\n\t\tatt->debug_destroy(att->debug_data);\n\n\tfree(att->local_sign);\n\tfree(att->remote_sign);\n\n\tfree(att->buf);\n\n\tfree(att);\n}",
          "includes": [
            "#include \"src/shared/crypto.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/l2cap.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/crypto.h\"\n#include \"src/shared/att.h\"\n#include \"lib/uuid.h\"\n#include \"lib/l2cap.h\"\n#include \"lib/bluetooth.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include <errno.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <config.h>\n\nstatic void bt_att_free(struct bt_att *att)\n{\n\tif (att->pending_req)\n\t\tdestroy_att_send_op(att->pending_req);\n\n\tif (att->pending_ind)\n\t\tdestroy_att_send_op(att->pending_ind);\n\n\tio_destroy(att->io);\n\tbt_crypto_unref(att->crypto);\n\n\tqueue_destroy(att->req_queue, NULL);\n\tqueue_destroy(att->ind_queue, NULL);\n\tqueue_destroy(att->write_queue, NULL);\n\tqueue_destroy(att->notify_list, NULL);\n\tqueue_destroy(att->disconn_list, NULL);\n\n\tif (att->timeout_destroy)\n\t\tatt->timeout_destroy(att->timeout_data);\n\n\tif (att->debug_destroy)\n\t\tatt->debug_destroy(att->debug_data);\n\n\tfree(att->local_sign);\n\tfree(att->remote_sign);\n\n\tfree(att->buf);\n\n\tfree(att);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/shell.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/mainloop.h\"\n#include <readline/history.h>\n#include <readline/readline.h>\n#include <getopt.h>\n#include <wordexp.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void env_destroy(void *data)\n{\n\tstruct bt_shell_env *env = data;\n\n\tfree(env->name);\n\tfree(env);\n}"
  },
  {
    "function_name": "rl_cleanup",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/shell.c",
    "lines": "1043-1053",
    "snippet": "static void rl_cleanup(void)\n{\n\tif (data.mode)\n\t\treturn;\n\n\tif (data.history[0] != '\\0')\n\t\twrite_history(data.history);\n\n\trl_message(\"\");\n\trl_callback_handler_remove();\n}",
    "includes": [
      "#include \"src/shared/shell.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/mainloop.h\"",
      "#include <readline/history.h>",
      "#include <readline/readline.h>",
      "#include <getopt.h>",
      "#include <wordexp.h>",
      "#include <sys/signalfd.h>",
      "#include <signal.h>",
      "#include <stdbool.h>",
      "#include <stdarg.h>",
      "#include <stdlib.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static struct {\n\tbool init;\n\tchar *name;\n\tchar history[256];\n\tint argc;\n\tchar **argv;\n\tbool mode;\n\tint timeout;\n\tstruct io *input;\n\n\tbool saved_prompt;\n\tbt_shell_prompt_input_func saved_func;\n\tvoid *saved_user_data;\n\n\tconst struct bt_shell_menu *menu;\n\tconst struct bt_shell_menu *main;\n\tstruct queue *submenus;\n\tconst struct bt_shell_menu_entry *exec;\n\n\tstruct queue *envs;\n} data;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "rl_callback_handler_remove",
          "args": [],
          "line": 1052
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rl_message",
          "args": [
            "\"\""
          ],
          "line": 1051
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "write_history",
          "args": [
            "data.history"
          ],
          "line": 1049
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/shell.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/mainloop.h\"\n#include <readline/history.h>\n#include <readline/readline.h>\n#include <getopt.h>\n#include <wordexp.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic struct {\n\tbool init;\n\tchar *name;\n\tchar history[256];\n\tint argc;\n\tchar **argv;\n\tbool mode;\n\tint timeout;\n\tstruct io *input;\n\n\tbool saved_prompt;\n\tbt_shell_prompt_input_func saved_func;\n\tvoid *saved_user_data;\n\n\tconst struct bt_shell_menu *menu;\n\tconst struct bt_shell_menu *main;\n\tstruct queue *submenus;\n\tconst struct bt_shell_menu_entry *exec;\n\n\tstruct queue *envs;\n} data;\n\nstatic void rl_cleanup(void)\n{\n\tif (data.mode)\n\t\treturn;\n\n\tif (data.history[0] != '\\0')\n\t\twrite_history(data.history);\n\n\trl_message(\"\");\n\trl_callback_handler_remove();\n}"
  },
  {
    "function_name": "bt_shell_init",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/shell.c",
    "lines": "974-1041",
    "snippet": "void bt_shell_init(int argc, char **argv, const struct bt_shell_opt *opt)\n{\n\tint c, index = -1;\n\tstruct option options[256];\n\tchar optstr[256];\n\tsize_t offset;\n\n\toffset = sizeof(main_options) / sizeof(struct option);\n\n\tmemcpy(options, main_options, sizeof(struct option) * offset);\n\n\tif (opt) {\n\t\tmemcpy(options + offset, opt->options,\n\t\t\t\tsizeof(struct option) * opt->optno);\n\t\tsnprintf(optstr, sizeof(optstr), \"+hvt:%s\", opt->optstr);\n\t} else\n\t\tsnprintf(optstr, sizeof(optstr), \"+hvt:\");\n\n\twhile ((c = getopt_long(argc, argv, optstr, options, &index)) != -1) {\n\t\tswitch (c) {\n\t\tcase 'v':\n\t\t\tprintf(\"%s: %s\\n\", argv[0], VERSION);\n\t\t\texit(EXIT_SUCCESS);\n\t\t\treturn;\n\t\tcase 'h':\n\t\t\tusage(argc, argv, opt);\n\t\t\texit(EXIT_SUCCESS);\n\t\t\treturn;\n\t\tcase 't':\n\t\t\tdata.timeout = atoi(optarg);\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tif (index < 0) {\n\t\t\t\tfor (index = 0; options[index].val; index++) {\n\t\t\t\t\tif (c == options[index].val)\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (c != opt->options[index - offset].val) {\n\t\t\t\tusage(argc, argv, opt);\n\t\t\t\texit(EXIT_SUCCESS);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t*opt->optarg[index - offset] = optarg;\n\t\t}\n\n\t\tindex = -1;\n\t}\n\n\tdata.name = strdup(argv[0]);\n\tbt_shell_set_env(\"SHELL\", data.name);\n\n\tdata.argc = argc - optind;\n\tdata.argv = argv + optind;\n\toptind = 0;\n\tdata.mode = (data.argc > 0);\n\n\tif (data.mode)\n\t\tbt_shell_set_env(\"NON_INTERACTIVE\", &data.mode);\n\n\tmainloop_init();\n\n\trl_init();\n\n\tdata.init = true;\n}",
    "includes": [
      "#include \"src/shared/shell.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/mainloop.h\"",
      "#include <readline/history.h>",
      "#include <readline/readline.h>",
      "#include <getopt.h>",
      "#include <wordexp.h>",
      "#include <sys/signalfd.h>",
      "#include <signal.h>",
      "#include <stdbool.h>",
      "#include <stdarg.h>",
      "#include <stdlib.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static const struct option main_options[] = {\n\t{ \"version\",\tno_argument, 0, 'v' },\n\t{ \"help\",\tno_argument, 0, 'h' },\n\t{ \"timeout\",\trequired_argument, 0, 't' },\n};"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "rl_init",
          "args": [],
          "line": 1038
        },
        "resolved": true,
        "details": {
          "function_name": "rl_init",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/shell.c",
          "lines": "936-948",
          "snippet": "static void rl_init(void)\n{\n\tif (data.mode)\n\t\treturn;\n\n\tsetlinebuf(stdout);\n\trl_attempted_completion_function = shell_completion;\n\n\trl_erase_empty_line = 1;\n\trl_callback_handler_install(NULL, rl_handler);\n\n\trl_init_history();\n}",
          "includes": [
            "#include \"src/shared/shell.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/mainloop.h\"",
            "#include <readline/history.h>",
            "#include <readline/readline.h>",
            "#include <getopt.h>",
            "#include <wordexp.h>",
            "#include <sys/signalfd.h>",
            "#include <signal.h>",
            "#include <stdbool.h>",
            "#include <stdarg.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/shell.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/mainloop.h\"\n#include <readline/history.h>\n#include <readline/readline.h>\n#include <getopt.h>\n#include <wordexp.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void rl_init(void)\n{\n\tif (data.mode)\n\t\treturn;\n\n\tsetlinebuf(stdout);\n\trl_attempted_completion_function = shell_completion;\n\n\trl_erase_empty_line = 1;\n\trl_callback_handler_install(NULL, rl_handler);\n\n\trl_init_history();\n}"
        }
      },
      {
        "call_info": {
          "callee": "mainloop_init",
          "args": [],
          "line": 1036
        },
        "resolved": true,
        "details": {
          "function_name": "mainloop_init",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/mainloop.c",
          "lines": "76-86",
          "snippet": "void mainloop_init(void)\n{\n\tunsigned int i;\n\n\tepoll_fd = epoll_create1(EPOLL_CLOEXEC);\n\n\tfor (i = 0; i < MAX_MAINLOOP_ENTRIES; i++)\n\t\tmainloop_list[i] = NULL;\n\n\tepoll_terminate = 0;\n}",
          "includes": [
            "#include \"mainloop.h\"",
            "#include <sys/epoll.h>",
            "#include <sys/timerfd.h>",
            "#include <sys/signalfd.h>",
            "#include <signal.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define MAX_MAINLOOP_ENTRIES 128"
          ],
          "globals_used": [
            "static int epoll_fd;",
            "static int epoll_terminate;",
            "static struct mainloop_data *mainloop_list[MAX_MAINLOOP_ENTRIES];"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"mainloop.h\"\n#include <sys/epoll.h>\n#include <sys/timerfd.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <string.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\n#define MAX_MAINLOOP_ENTRIES 128\n\nstatic int epoll_fd;\nstatic int epoll_terminate;\nstatic struct mainloop_data *mainloop_list[MAX_MAINLOOP_ENTRIES];\n\nvoid mainloop_init(void)\n{\n\tunsigned int i;\n\n\tepoll_fd = epoll_create1(EPOLL_CLOEXEC);\n\n\tfor (i = 0; i < MAX_MAINLOOP_ENTRIES; i++)\n\t\tmainloop_list[i] = NULL;\n\n\tepoll_terminate = 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "bt_shell_set_env",
          "args": [
            "\"NON_INTERACTIVE\"",
            "&data.mode"
          ],
          "line": 1034
        },
        "resolved": true,
        "details": {
          "function_name": "bt_shell_set_env",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/shell.c",
          "lines": "1209-1234",
          "snippet": "void bt_shell_set_env(const char *name, void *value)\n{\n\tstruct bt_shell_env *env;\n\n\tif (!data.envs) {\n\t\tif (!value)\n\t\t\treturn;\n\t\tdata.envs = queue_new();\n\t\tgoto done;\n\t}\n\n\tenv = queue_remove_if(data.envs, match_env, (void *) name);\n\tif (env)\n\t\tenv_destroy(env);\n\n\t/* Don't create an env if value is not set */\n\tif (!value)\n\t\treturn;\n\ndone:\n\tenv = new0(struct bt_shell_env, 1);\n\tenv->name = strdup(name);\n\tenv->value = value;\n\n\tqueue_push_tail(data.envs, env);\n}",
          "includes": [
            "#include \"src/shared/shell.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/mainloop.h\"",
            "#include <readline/history.h>",
            "#include <readline/readline.h>",
            "#include <getopt.h>",
            "#include <wordexp.h>",
            "#include <sys/signalfd.h>",
            "#include <signal.h>",
            "#include <stdbool.h>",
            "#include <stdarg.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/shell.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/mainloop.h\"\n#include <readline/history.h>\n#include <readline/readline.h>\n#include <getopt.h>\n#include <wordexp.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nvoid bt_shell_set_env(const char *name, void *value)\n{\n\tstruct bt_shell_env *env;\n\n\tif (!data.envs) {\n\t\tif (!value)\n\t\t\treturn;\n\t\tdata.envs = queue_new();\n\t\tgoto done;\n\t}\n\n\tenv = queue_remove_if(data.envs, match_env, (void *) name);\n\tif (env)\n\t\tenv_destroy(env);\n\n\t/* Don't create an env if value is not set */\n\tif (!value)\n\t\treturn;\n\ndone:\n\tenv = new0(struct bt_shell_env, 1);\n\tenv->name = strdup(name);\n\tenv->value = value;\n\n\tqueue_push_tail(data.envs, env);\n}"
        }
      },
      {
        "call_info": {
          "callee": "strdup",
          "args": [
            "argv[0]"
          ],
          "line": 1025
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "exit",
          "args": [
            "EXIT_SUCCESS"
          ],
          "line": 1015
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "usage",
          "args": [
            "argc",
            "argv",
            "opt"
          ],
          "line": 1014
        },
        "resolved": true,
        "details": {
          "function_name": "usage",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/shell.c",
          "lines": "956-972",
          "snippet": "static void usage(int argc, char **argv, const struct bt_shell_opt *opt)\n{\n\tunsigned int i;\n\n\tprintf(\"%s ver %s\\n\", argv[0], VERSION);\n\tprintf(\"Usage:\\n\"\n\t\t\"\\t%s [options]\\n\", argv[0]);\n\n\tprintf(\"Options:\\n\");\n\n\tfor (i = 0; opt && opt->options[i].name; i++)\n\t\tprintf(\"\\t--%s \\t%s\\n\", opt->options[i].name, opt->help[i]);\n\n\tprintf(\"\\t--timeout \\tTimeout in seconds for non-interactive mode\\n\"\n\t\t\"\\t--version \\tDisplay version\\n\"\n\t\t\"\\t--help \\t\\tDisplay help\\n\");\n}",
          "includes": [
            "#include \"src/shared/shell.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/mainloop.h\"",
            "#include <readline/history.h>",
            "#include <readline/readline.h>",
            "#include <getopt.h>",
            "#include <wordexp.h>",
            "#include <sys/signalfd.h>",
            "#include <signal.h>",
            "#include <stdbool.h>",
            "#include <stdarg.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/shell.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/mainloop.h\"\n#include <readline/history.h>\n#include <readline/readline.h>\n#include <getopt.h>\n#include <wordexp.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void usage(int argc, char **argv, const struct bt_shell_opt *opt)\n{\n\tunsigned int i;\n\n\tprintf(\"%s ver %s\\n\", argv[0], VERSION);\n\tprintf(\"Usage:\\n\"\n\t\t\"\\t%s [options]\\n\", argv[0]);\n\n\tprintf(\"Options:\\n\");\n\n\tfor (i = 0; opt && opt->options[i].name; i++)\n\t\tprintf(\"\\t--%s \\t%s\\n\", opt->options[i].name, opt->help[i]);\n\n\tprintf(\"\\t--timeout \\tTimeout in seconds for non-interactive mode\\n\"\n\t\t\"\\t--version \\tDisplay version\\n\"\n\t\t\"\\t--help \\t\\tDisplay help\\n\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "atoi",
          "args": [
            "optarg"
          ],
          "line": 1003
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "exit",
          "args": [
            "EXIT_SUCCESS"
          ],
          "line": 1000
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "exit",
          "args": [
            "EXIT_SUCCESS"
          ],
          "line": 996
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"%s: %s\\n\"",
            "argv[0]",
            "VERSION"
          ],
          "line": 995
        },
        "resolved": true,
        "details": {
          "function_name": "bt_shell_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/shell.c",
          "lines": "458-498",
          "snippet": "void bt_shell_printf(const char *fmt, ...)\n{\n\tva_list args;\n\tbool save_input;\n\tchar *saved_line;\n\tint saved_point;\n\n\tif (!data.input)\n\t\treturn;\n\n\tif (data.mode) {\n\t\tva_start(args, fmt);\n\t\tvprintf(fmt, args);\n\t\tva_end(args);\n\t\treturn;\n\t}\n\n\tsave_input = !RL_ISSTATE(RL_STATE_DONE);\n\n\tif (save_input) {\n\t\tsaved_point = rl_point;\n\t\tsaved_line = rl_copy_text(0, rl_end);\n\t\tif (!data.saved_prompt)\n\t\t\trl_save_prompt();\n\t\trl_replace_line(\"\", 0);\n\t\trl_redisplay();\n\t}\n\n\tva_start(args, fmt);\n\tvprintf(fmt, args);\n\tva_end(args);\n\n\tif (save_input) {\n\t\tif (!data.saved_prompt)\n\t\t\trl_restore_prompt();\n\t\trl_replace_line(saved_line, 0);\n\t\trl_point = saved_point;\n\t\trl_forced_update_display();\n\t\tfree(saved_line);\n\t}\n}",
          "includes": [
            "#include \"src/shared/shell.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/mainloop.h\"",
            "#include <readline/history.h>",
            "#include <readline/readline.h>",
            "#include <getopt.h>",
            "#include <wordexp.h>",
            "#include <sys/signalfd.h>",
            "#include <signal.h>",
            "#include <stdbool.h>",
            "#include <stdarg.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static wordexp_t args;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/shell.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/mainloop.h\"\n#include <readline/history.h>\n#include <readline/readline.h>\n#include <getopt.h>\n#include <wordexp.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic wordexp_t args;\n\nvoid bt_shell_printf(const char *fmt, ...)\n{\n\tva_list args;\n\tbool save_input;\n\tchar *saved_line;\n\tint saved_point;\n\n\tif (!data.input)\n\t\treturn;\n\n\tif (data.mode) {\n\t\tva_start(args, fmt);\n\t\tvprintf(fmt, args);\n\t\tva_end(args);\n\t\treturn;\n\t}\n\n\tsave_input = !RL_ISSTATE(RL_STATE_DONE);\n\n\tif (save_input) {\n\t\tsaved_point = rl_point;\n\t\tsaved_line = rl_copy_text(0, rl_end);\n\t\tif (!data.saved_prompt)\n\t\t\trl_save_prompt();\n\t\trl_replace_line(\"\", 0);\n\t\trl_redisplay();\n\t}\n\n\tva_start(args, fmt);\n\tvprintf(fmt, args);\n\tva_end(args);\n\n\tif (save_input) {\n\t\tif (!data.saved_prompt)\n\t\t\trl_restore_prompt();\n\t\trl_replace_line(saved_line, 0);\n\t\trl_point = saved_point;\n\t\trl_forced_update_display();\n\t\tfree(saved_line);\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "getopt_long",
          "args": [
            "argc",
            "argv",
            "optstr",
            "options",
            "&index"
          ],
          "line": 992
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "snprintf",
          "args": [
            "optstr",
            "sizeof(optstr)",
            "\"+hvt:\""
          ],
          "line": 990
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "snprintf",
          "args": [
            "optstr",
            "sizeof(optstr)",
            "\"+hvt:%s\"",
            "opt->optstr"
          ],
          "line": 988
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memcpy",
          "args": [
            "options + offset",
            "opt->options",
            "sizeof(struct option) * opt->optno"
          ],
          "line": 986
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memcpy",
          "args": [
            "options",
            "main_options",
            "sizeof(struct option) * offset"
          ],
          "line": 983
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/shell.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/mainloop.h\"\n#include <readline/history.h>\n#include <readline/readline.h>\n#include <getopt.h>\n#include <wordexp.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic const struct option main_options[] = {\n\t{ \"version\",\tno_argument, 0, 'v' },\n\t{ \"help\",\tno_argument, 0, 'h' },\n\t{ \"timeout\",\trequired_argument, 0, 't' },\n};\n\nvoid bt_shell_init(int argc, char **argv, const struct bt_shell_opt *opt)\n{\n\tint c, index = -1;\n\tstruct option options[256];\n\tchar optstr[256];\n\tsize_t offset;\n\n\toffset = sizeof(main_options) / sizeof(struct option);\n\n\tmemcpy(options, main_options, sizeof(struct option) * offset);\n\n\tif (opt) {\n\t\tmemcpy(options + offset, opt->options,\n\t\t\t\tsizeof(struct option) * opt->optno);\n\t\tsnprintf(optstr, sizeof(optstr), \"+hvt:%s\", opt->optstr);\n\t} else\n\t\tsnprintf(optstr, sizeof(optstr), \"+hvt:\");\n\n\twhile ((c = getopt_long(argc, argv, optstr, options, &index)) != -1) {\n\t\tswitch (c) {\n\t\tcase 'v':\n\t\t\tprintf(\"%s: %s\\n\", argv[0], VERSION);\n\t\t\texit(EXIT_SUCCESS);\n\t\t\treturn;\n\t\tcase 'h':\n\t\t\tusage(argc, argv, opt);\n\t\t\texit(EXIT_SUCCESS);\n\t\t\treturn;\n\t\tcase 't':\n\t\t\tdata.timeout = atoi(optarg);\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tif (index < 0) {\n\t\t\t\tfor (index = 0; options[index].val; index++) {\n\t\t\t\t\tif (c == options[index].val)\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (c != opt->options[index - offset].val) {\n\t\t\t\tusage(argc, argv, opt);\n\t\t\t\texit(EXIT_SUCCESS);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t*opt->optarg[index - offset] = optarg;\n\t\t}\n\n\t\tindex = -1;\n\t}\n\n\tdata.name = strdup(argv[0]);\n\tbt_shell_set_env(\"SHELL\", data.name);\n\n\tdata.argc = argc - optind;\n\tdata.argv = argv + optind;\n\toptind = 0;\n\tdata.mode = (data.argc > 0);\n\n\tif (data.mode)\n\t\tbt_shell_set_env(\"NON_INTERACTIVE\", &data.mode);\n\n\tmainloop_init();\n\n\trl_init();\n\n\tdata.init = true;\n}"
  },
  {
    "function_name": "usage",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/shell.c",
    "lines": "956-972",
    "snippet": "static void usage(int argc, char **argv, const struct bt_shell_opt *opt)\n{\n\tunsigned int i;\n\n\tprintf(\"%s ver %s\\n\", argv[0], VERSION);\n\tprintf(\"Usage:\\n\"\n\t\t\"\\t%s [options]\\n\", argv[0]);\n\n\tprintf(\"Options:\\n\");\n\n\tfor (i = 0; opt && opt->options[i].name; i++)\n\t\tprintf(\"\\t--%s \\t%s\\n\", opt->options[i].name, opt->help[i]);\n\n\tprintf(\"\\t--timeout \\tTimeout in seconds for non-interactive mode\\n\"\n\t\t\"\\t--version \\tDisplay version\\n\"\n\t\t\"\\t--help \\t\\tDisplay help\\n\");\n}",
    "includes": [
      "#include \"src/shared/shell.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/mainloop.h\"",
      "#include <readline/history.h>",
      "#include <readline/readline.h>",
      "#include <getopt.h>",
      "#include <wordexp.h>",
      "#include <sys/signalfd.h>",
      "#include <signal.h>",
      "#include <stdbool.h>",
      "#include <stdarg.h>",
      "#include <stdlib.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"\\t--timeout \\tTimeout in seconds for non-interactive mode\\n\"\n\t\t\"\\t--version \\tDisplay version\\n\"\n\t\t\"\\t--help \\t\\tDisplay help\\n\""
          ],
          "line": 969
        },
        "resolved": true,
        "details": {
          "function_name": "bt_shell_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/shell.c",
          "lines": "458-498",
          "snippet": "void bt_shell_printf(const char *fmt, ...)\n{\n\tva_list args;\n\tbool save_input;\n\tchar *saved_line;\n\tint saved_point;\n\n\tif (!data.input)\n\t\treturn;\n\n\tif (data.mode) {\n\t\tva_start(args, fmt);\n\t\tvprintf(fmt, args);\n\t\tva_end(args);\n\t\treturn;\n\t}\n\n\tsave_input = !RL_ISSTATE(RL_STATE_DONE);\n\n\tif (save_input) {\n\t\tsaved_point = rl_point;\n\t\tsaved_line = rl_copy_text(0, rl_end);\n\t\tif (!data.saved_prompt)\n\t\t\trl_save_prompt();\n\t\trl_replace_line(\"\", 0);\n\t\trl_redisplay();\n\t}\n\n\tva_start(args, fmt);\n\tvprintf(fmt, args);\n\tva_end(args);\n\n\tif (save_input) {\n\t\tif (!data.saved_prompt)\n\t\t\trl_restore_prompt();\n\t\trl_replace_line(saved_line, 0);\n\t\trl_point = saved_point;\n\t\trl_forced_update_display();\n\t\tfree(saved_line);\n\t}\n}",
          "includes": [
            "#include \"src/shared/shell.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/mainloop.h\"",
            "#include <readline/history.h>",
            "#include <readline/readline.h>",
            "#include <getopt.h>",
            "#include <wordexp.h>",
            "#include <sys/signalfd.h>",
            "#include <signal.h>",
            "#include <stdbool.h>",
            "#include <stdarg.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static wordexp_t args;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/shell.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/mainloop.h\"\n#include <readline/history.h>\n#include <readline/readline.h>\n#include <getopt.h>\n#include <wordexp.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic wordexp_t args;\n\nvoid bt_shell_printf(const char *fmt, ...)\n{\n\tva_list args;\n\tbool save_input;\n\tchar *saved_line;\n\tint saved_point;\n\n\tif (!data.input)\n\t\treturn;\n\n\tif (data.mode) {\n\t\tva_start(args, fmt);\n\t\tvprintf(fmt, args);\n\t\tva_end(args);\n\t\treturn;\n\t}\n\n\tsave_input = !RL_ISSTATE(RL_STATE_DONE);\n\n\tif (save_input) {\n\t\tsaved_point = rl_point;\n\t\tsaved_line = rl_copy_text(0, rl_end);\n\t\tif (!data.saved_prompt)\n\t\t\trl_save_prompt();\n\t\trl_replace_line(\"\", 0);\n\t\trl_redisplay();\n\t}\n\n\tva_start(args, fmt);\n\tvprintf(fmt, args);\n\tva_end(args);\n\n\tif (save_input) {\n\t\tif (!data.saved_prompt)\n\t\t\trl_restore_prompt();\n\t\trl_replace_line(saved_line, 0);\n\t\trl_point = saved_point;\n\t\trl_forced_update_display();\n\t\tfree(saved_line);\n\t}\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/shell.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/mainloop.h\"\n#include <readline/history.h>\n#include <readline/readline.h>\n#include <getopt.h>\n#include <wordexp.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void usage(int argc, char **argv, const struct bt_shell_opt *opt)\n{\n\tunsigned int i;\n\n\tprintf(\"%s ver %s\\n\", argv[0], VERSION);\n\tprintf(\"Usage:\\n\"\n\t\t\"\\t%s [options]\\n\", argv[0]);\n\n\tprintf(\"Options:\\n\");\n\n\tfor (i = 0; opt && opt->options[i].name; i++)\n\t\tprintf(\"\\t--%s \\t%s\\n\", opt->options[i].name, opt->help[i]);\n\n\tprintf(\"\\t--timeout \\tTimeout in seconds for non-interactive mode\\n\"\n\t\t\"\\t--version \\tDisplay version\\n\"\n\t\t\"\\t--help \\t\\tDisplay help\\n\");\n}"
  },
  {
    "function_name": "rl_init",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/shell.c",
    "lines": "936-948",
    "snippet": "static void rl_init(void)\n{\n\tif (data.mode)\n\t\treturn;\n\n\tsetlinebuf(stdout);\n\trl_attempted_completion_function = shell_completion;\n\n\trl_erase_empty_line = 1;\n\trl_callback_handler_install(NULL, rl_handler);\n\n\trl_init_history();\n}",
    "includes": [
      "#include \"src/shared/shell.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/mainloop.h\"",
      "#include <readline/history.h>",
      "#include <readline/readline.h>",
      "#include <getopt.h>",
      "#include <wordexp.h>",
      "#include <sys/signalfd.h>",
      "#include <signal.h>",
      "#include <stdbool.h>",
      "#include <stdarg.h>",
      "#include <stdlib.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "rl_init_history",
          "args": [],
          "line": 947
        },
        "resolved": true,
        "details": {
          "function_name": "rl_init_history",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/shell.c",
          "lines": "894-934",
          "snippet": "static void rl_init_history(void)\n{\n\tconst char *name;\n\tchar *dir;\n\n\tmemset(data.history, 0, sizeof(data.history));\n\n\tname = strrchr(data.name, '/');\n\tif (!name)\n\t\tname = data.name;\n\telse\n\t\tname++;\n\n\tdir = getenv(\"XDG_CACHE_HOME\");\n\tif (dir) {\n\t\tsnprintf(data.history, sizeof(data.history), \"%s/.%s_history\",\n\t\t\t\t\t\t\tdir, name);\n\t\tgoto done;\n\t}\n\n\tdir = getenv(\"HOME\");\n\tif (dir) {\n\t\tsnprintf(data.history, sizeof(data.history),\n\t\t\t\t\"%s/.cache/.%s_history\", dir, name);\n\t\tgoto done;\n\t}\n\n\tdir = getenv(\"PWD\");\n\tif (dir) {\n\t\tsnprintf(data.history, sizeof(data.history), \"%s/.%s_history\",\n\t\t\t\t\t\t\tdir, name);\n\t\tgoto done;\n\t}\n\n\treturn;\n\ndone:\n\tread_history(data.history);\n\tusing_history();\n\tbt_shell_set_env(\"HISTORY\", data.history);\n}",
          "includes": [
            "#include \"src/shared/shell.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/mainloop.h\"",
            "#include <readline/history.h>",
            "#include <readline/readline.h>",
            "#include <getopt.h>",
            "#include <wordexp.h>",
            "#include <sys/signalfd.h>",
            "#include <signal.h>",
            "#include <stdbool.h>",
            "#include <stdarg.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static struct {\n\tbool init;\n\tchar *name;\n\tchar history[256];\n\tint argc;\n\tchar **argv;\n\tbool mode;\n\tint timeout;\n\tstruct io *input;\n\n\tbool saved_prompt;\n\tbt_shell_prompt_input_func saved_func;\n\tvoid *saved_user_data;\n\n\tconst struct bt_shell_menu *menu;\n\tconst struct bt_shell_menu *main;\n\tstruct queue *submenus;\n\tconst struct bt_shell_menu_entry *exec;\n\n\tstruct queue *envs;\n} data;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/shell.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/mainloop.h\"\n#include <readline/history.h>\n#include <readline/readline.h>\n#include <getopt.h>\n#include <wordexp.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic struct {\n\tbool init;\n\tchar *name;\n\tchar history[256];\n\tint argc;\n\tchar **argv;\n\tbool mode;\n\tint timeout;\n\tstruct io *input;\n\n\tbool saved_prompt;\n\tbt_shell_prompt_input_func saved_func;\n\tvoid *saved_user_data;\n\n\tconst struct bt_shell_menu *menu;\n\tconst struct bt_shell_menu *main;\n\tstruct queue *submenus;\n\tconst struct bt_shell_menu_entry *exec;\n\n\tstruct queue *envs;\n} data;\n\nstatic void rl_init_history(void)\n{\n\tconst char *name;\n\tchar *dir;\n\n\tmemset(data.history, 0, sizeof(data.history));\n\n\tname = strrchr(data.name, '/');\n\tif (!name)\n\t\tname = data.name;\n\telse\n\t\tname++;\n\n\tdir = getenv(\"XDG_CACHE_HOME\");\n\tif (dir) {\n\t\tsnprintf(data.history, sizeof(data.history), \"%s/.%s_history\",\n\t\t\t\t\t\t\tdir, name);\n\t\tgoto done;\n\t}\n\n\tdir = getenv(\"HOME\");\n\tif (dir) {\n\t\tsnprintf(data.history, sizeof(data.history),\n\t\t\t\t\"%s/.cache/.%s_history\", dir, name);\n\t\tgoto done;\n\t}\n\n\tdir = getenv(\"PWD\");\n\tif (dir) {\n\t\tsnprintf(data.history, sizeof(data.history), \"%s/.%s_history\",\n\t\t\t\t\t\t\tdir, name);\n\t\tgoto done;\n\t}\n\n\treturn;\n\ndone:\n\tread_history(data.history);\n\tusing_history();\n\tbt_shell_set_env(\"HISTORY\", data.history);\n}"
        }
      },
      {
        "call_info": {
          "callee": "rl_callback_handler_install",
          "args": [
            "NULL",
            "rl_handler"
          ],
          "line": 945
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "setlinebuf",
          "args": [
            "stdout"
          ],
          "line": 941
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/shell.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/mainloop.h\"\n#include <readline/history.h>\n#include <readline/readline.h>\n#include <getopt.h>\n#include <wordexp.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void rl_init(void)\n{\n\tif (data.mode)\n\t\treturn;\n\n\tsetlinebuf(stdout);\n\trl_attempted_completion_function = shell_completion;\n\n\trl_erase_empty_line = 1;\n\trl_callback_handler_install(NULL, rl_handler);\n\n\trl_init_history();\n}"
  },
  {
    "function_name": "rl_init_history",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/shell.c",
    "lines": "894-934",
    "snippet": "static void rl_init_history(void)\n{\n\tconst char *name;\n\tchar *dir;\n\n\tmemset(data.history, 0, sizeof(data.history));\n\n\tname = strrchr(data.name, '/');\n\tif (!name)\n\t\tname = data.name;\n\telse\n\t\tname++;\n\n\tdir = getenv(\"XDG_CACHE_HOME\");\n\tif (dir) {\n\t\tsnprintf(data.history, sizeof(data.history), \"%s/.%s_history\",\n\t\t\t\t\t\t\tdir, name);\n\t\tgoto done;\n\t}\n\n\tdir = getenv(\"HOME\");\n\tif (dir) {\n\t\tsnprintf(data.history, sizeof(data.history),\n\t\t\t\t\"%s/.cache/.%s_history\", dir, name);\n\t\tgoto done;\n\t}\n\n\tdir = getenv(\"PWD\");\n\tif (dir) {\n\t\tsnprintf(data.history, sizeof(data.history), \"%s/.%s_history\",\n\t\t\t\t\t\t\tdir, name);\n\t\tgoto done;\n\t}\n\n\treturn;\n\ndone:\n\tread_history(data.history);\n\tusing_history();\n\tbt_shell_set_env(\"HISTORY\", data.history);\n}",
    "includes": [
      "#include \"src/shared/shell.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/mainloop.h\"",
      "#include <readline/history.h>",
      "#include <readline/readline.h>",
      "#include <getopt.h>",
      "#include <wordexp.h>",
      "#include <sys/signalfd.h>",
      "#include <signal.h>",
      "#include <stdbool.h>",
      "#include <stdarg.h>",
      "#include <stdlib.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static struct {\n\tbool init;\n\tchar *name;\n\tchar history[256];\n\tint argc;\n\tchar **argv;\n\tbool mode;\n\tint timeout;\n\tstruct io *input;\n\n\tbool saved_prompt;\n\tbt_shell_prompt_input_func saved_func;\n\tvoid *saved_user_data;\n\n\tconst struct bt_shell_menu *menu;\n\tconst struct bt_shell_menu *main;\n\tstruct queue *submenus;\n\tconst struct bt_shell_menu_entry *exec;\n\n\tstruct queue *envs;\n} data;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "bt_shell_set_env",
          "args": [
            "\"HISTORY\"",
            "data.history"
          ],
          "line": 933
        },
        "resolved": true,
        "details": {
          "function_name": "bt_shell_set_env",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/shell.c",
          "lines": "1209-1234",
          "snippet": "void bt_shell_set_env(const char *name, void *value)\n{\n\tstruct bt_shell_env *env;\n\n\tif (!data.envs) {\n\t\tif (!value)\n\t\t\treturn;\n\t\tdata.envs = queue_new();\n\t\tgoto done;\n\t}\n\n\tenv = queue_remove_if(data.envs, match_env, (void *) name);\n\tif (env)\n\t\tenv_destroy(env);\n\n\t/* Don't create an env if value is not set */\n\tif (!value)\n\t\treturn;\n\ndone:\n\tenv = new0(struct bt_shell_env, 1);\n\tenv->name = strdup(name);\n\tenv->value = value;\n\n\tqueue_push_tail(data.envs, env);\n}",
          "includes": [
            "#include \"src/shared/shell.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/mainloop.h\"",
            "#include <readline/history.h>",
            "#include <readline/readline.h>",
            "#include <getopt.h>",
            "#include <wordexp.h>",
            "#include <sys/signalfd.h>",
            "#include <signal.h>",
            "#include <stdbool.h>",
            "#include <stdarg.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/shell.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/mainloop.h\"\n#include <readline/history.h>\n#include <readline/readline.h>\n#include <getopt.h>\n#include <wordexp.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nvoid bt_shell_set_env(const char *name, void *value)\n{\n\tstruct bt_shell_env *env;\n\n\tif (!data.envs) {\n\t\tif (!value)\n\t\t\treturn;\n\t\tdata.envs = queue_new();\n\t\tgoto done;\n\t}\n\n\tenv = queue_remove_if(data.envs, match_env, (void *) name);\n\tif (env)\n\t\tenv_destroy(env);\n\n\t/* Don't create an env if value is not set */\n\tif (!value)\n\t\treturn;\n\ndone:\n\tenv = new0(struct bt_shell_env, 1);\n\tenv->name = strdup(name);\n\tenv->value = value;\n\n\tqueue_push_tail(data.envs, env);\n}"
        }
      },
      {
        "call_info": {
          "callee": "using_history",
          "args": [],
          "line": 932
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "read_history",
          "args": [
            "data.history"
          ],
          "line": 931
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "snprintf",
          "args": [
            "data.history",
            "sizeof(data.history)",
            "\"%s/.%s_history\"",
            "dir",
            "name"
          ],
          "line": 923
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "getenv",
          "args": [
            "\"PWD\""
          ],
          "line": 921
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "snprintf",
          "args": [
            "data.history",
            "sizeof(data.history)",
            "\"%s/.cache/.%s_history\"",
            "dir",
            "name"
          ],
          "line": 916
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "getenv",
          "args": [
            "\"HOME\""
          ],
          "line": 914
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "snprintf",
          "args": [
            "data.history",
            "sizeof(data.history)",
            "\"%s/.%s_history\"",
            "dir",
            "name"
          ],
          "line": 909
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "getenv",
          "args": [
            "\"XDG_CACHE_HOME\""
          ],
          "line": 907
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strrchr",
          "args": [
            "data.name",
            "'/'"
          ],
          "line": 901
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memset",
          "args": [
            "data.history",
            "0",
            "sizeof(data.history)"
          ],
          "line": 899
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/shell.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/mainloop.h\"\n#include <readline/history.h>\n#include <readline/readline.h>\n#include <getopt.h>\n#include <wordexp.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic struct {\n\tbool init;\n\tchar *name;\n\tchar history[256];\n\tint argc;\n\tchar **argv;\n\tbool mode;\n\tint timeout;\n\tstruct io *input;\n\n\tbool saved_prompt;\n\tbt_shell_prompt_input_func saved_func;\n\tvoid *saved_user_data;\n\n\tconst struct bt_shell_menu *menu;\n\tconst struct bt_shell_menu *main;\n\tstruct queue *submenus;\n\tconst struct bt_shell_menu_entry *exec;\n\n\tstruct queue *envs;\n} data;\n\nstatic void rl_init_history(void)\n{\n\tconst char *name;\n\tchar *dir;\n\n\tmemset(data.history, 0, sizeof(data.history));\n\n\tname = strrchr(data.name, '/');\n\tif (!name)\n\t\tname = data.name;\n\telse\n\t\tname++;\n\n\tdir = getenv(\"XDG_CACHE_HOME\");\n\tif (dir) {\n\t\tsnprintf(data.history, sizeof(data.history), \"%s/.%s_history\",\n\t\t\t\t\t\t\tdir, name);\n\t\tgoto done;\n\t}\n\n\tdir = getenv(\"HOME\");\n\tif (dir) {\n\t\tsnprintf(data.history, sizeof(data.history),\n\t\t\t\t\"%s/.cache/.%s_history\", dir, name);\n\t\tgoto done;\n\t}\n\n\tdir = getenv(\"PWD\");\n\tif (dir) {\n\t\tsnprintf(data.history, sizeof(data.history), \"%s/.%s_history\",\n\t\t\t\t\t\t\tdir, name);\n\t\tgoto done;\n\t}\n\n\treturn;\n\ndone:\n\tread_history(data.history);\n\tusing_history();\n\tbt_shell_set_env(\"HISTORY\", data.history);\n}"
  },
  {
    "function_name": "setup_signalfd",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/shell.c",
    "lines": "864-892",
    "snippet": "static struct io *setup_signalfd(void)\n{\n\tstruct io *io;\n\tsigset_t mask;\n\tint fd;\n\n\tsigemptyset(&mask);\n\tsigaddset(&mask, SIGINT);\n\tsigaddset(&mask, SIGTERM);\n\n\tif (sigprocmask(SIG_BLOCK, &mask, NULL) < 0) {\n\t\tperror(\"Failed to set signal mask\");\n\t\treturn 0;\n\t}\n\n\tfd = signalfd(-1, &mask, 0);\n\tif (fd < 0) {\n\t\tperror(\"Failed to create signal descriptor\");\n\t\treturn 0;\n\t}\n\n\tio = io_new(fd);\n\n\tio_set_close_on_destroy(io, true);\n\tio_set_read_handler(io, signal_read, NULL, NULL);\n\tio_set_disconnect_handler(io, io_hup, NULL, NULL);\n\n\treturn io;\n}",
    "includes": [
      "#include \"src/shared/shell.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/mainloop.h\"",
      "#include <readline/history.h>",
      "#include <readline/readline.h>",
      "#include <getopt.h>",
      "#include <wordexp.h>",
      "#include <sys/signalfd.h>",
      "#include <signal.h>",
      "#include <stdbool.h>",
      "#include <stdarg.h>",
      "#include <stdlib.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "io_set_disconnect_handler",
          "args": [
            "io",
            "io_hup",
            "NULL",
            "NULL"
          ],
          "line": 889
        },
        "resolved": true,
        "details": {
          "function_name": "io_set_disconnect_handler",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/io-glib.c",
          "lines": "260-264",
          "snippet": "bool io_set_disconnect_handler(struct io *io, io_callback_func_t callback,\n\t\t\t\tvoid *user_data, io_destroy_func_t destroy)\n{\n\treturn io_set_handler(io, G_IO_HUP, callback, user_data, destroy);\n}",
          "includes": [
            "#include \"src/shared/io.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/io.h\"\n#include <glib.h>\n#include <errno.h>\n#include <config.h>\n\nbool io_set_disconnect_handler(struct io *io, io_callback_func_t callback,\n\t\t\t\tvoid *user_data, io_destroy_func_t destroy)\n{\n\treturn io_set_handler(io, G_IO_HUP, callback, user_data, destroy);\n}"
        }
      },
      {
        "call_info": {
          "callee": "io_set_read_handler",
          "args": [
            "io",
            "signal_read",
            "NULL",
            "NULL"
          ],
          "line": 888
        },
        "resolved": true,
        "details": {
          "function_name": "io_set_read_handler",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/io-glib.c",
          "lines": "248-252",
          "snippet": "bool io_set_read_handler(struct io *io, io_callback_func_t callback,\n\t\t\t\tvoid *user_data, io_destroy_func_t destroy)\n{\n\treturn io_set_handler(io, G_IO_IN, callback, user_data, destroy);\n}",
          "includes": [
            "#include \"src/shared/io.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/io.h\"\n#include <glib.h>\n#include <errno.h>\n#include <config.h>\n\nbool io_set_read_handler(struct io *io, io_callback_func_t callback,\n\t\t\t\tvoid *user_data, io_destroy_func_t destroy)\n{\n\treturn io_set_handler(io, G_IO_IN, callback, user_data, destroy);\n}"
        }
      },
      {
        "call_info": {
          "callee": "io_set_close_on_destroy",
          "args": [
            "io",
            "true"
          ],
          "line": 887
        },
        "resolved": true,
        "details": {
          "function_name": "io_set_close_on_destroy",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/io-glib.c",
          "lines": "145-156",
          "snippet": "bool io_set_close_on_destroy(struct io *io, bool do_close)\n{\n\tif (!io)\n\t\treturn false;\n\n\tif (do_close)\n\t\tg_io_channel_set_close_on_unref(io->channel, TRUE);\n\telse\n\t\tg_io_channel_set_close_on_unref(io->channel, FALSE);\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/io.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/io.h\"\n#include <glib.h>\n#include <errno.h>\n#include <config.h>\n\nbool io_set_close_on_destroy(struct io *io, bool do_close)\n{\n\tif (!io)\n\t\treturn false;\n\n\tif (do_close)\n\t\tg_io_channel_set_close_on_unref(io->channel, TRUE);\n\telse\n\t\tg_io_channel_set_close_on_unref(io->channel, FALSE);\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "io_new",
          "args": [
            "fd"
          ],
          "line": 885
        },
        "resolved": true,
        "details": {
          "function_name": "io_new",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/io-glib.c",
          "lines": "71-90",
          "snippet": "struct io *io_new(int fd)\n{\n\tstruct io *io;\n\n\tif (fd < 0)\n\t\treturn NULL;\n\n\tio = g_try_new0(struct io, 1);\n\tif (!io)\n\t\treturn NULL;\n\n\tio->channel = g_io_channel_unix_new(fd);\n\n\tg_io_channel_set_encoding(io->channel, NULL, NULL);\n\tg_io_channel_set_buffered(io->channel, FALSE);\n\n\tg_io_channel_set_close_on_unref(io->channel, FALSE);\n\n\treturn io_ref(io);\n}",
          "includes": [
            "#include \"src/shared/io.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/io.h\"\n#include <glib.h>\n#include <errno.h>\n#include <config.h>\n\nstruct io *io_new(int fd)\n{\n\tstruct io *io;\n\n\tif (fd < 0)\n\t\treturn NULL;\n\n\tio = g_try_new0(struct io, 1);\n\tif (!io)\n\t\treturn NULL;\n\n\tio->channel = g_io_channel_unix_new(fd);\n\n\tg_io_channel_set_encoding(io->channel, NULL, NULL);\n\tg_io_channel_set_buffered(io->channel, FALSE);\n\n\tg_io_channel_set_close_on_unref(io->channel, FALSE);\n\n\treturn io_ref(io);\n}"
        }
      },
      {
        "call_info": {
          "callee": "perror",
          "args": [
            "\"Failed to create signal descriptor\""
          ],
          "line": 881
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "signalfd",
          "args": [
            "-1",
            "&mask",
            "0"
          ],
          "line": 879
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "perror",
          "args": [
            "\"Failed to set signal mask\""
          ],
          "line": 875
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sigprocmask",
          "args": [
            "SIG_BLOCK",
            "&mask",
            "NULL"
          ],
          "line": 874
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sigaddset",
          "args": [
            "&mask",
            "SIGTERM"
          ],
          "line": 872
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sigaddset",
          "args": [
            "&mask",
            "SIGINT"
          ],
          "line": 871
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sigemptyset",
          "args": [
            "&mask"
          ],
          "line": 870
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/shell.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/mainloop.h\"\n#include <readline/history.h>\n#include <readline/readline.h>\n#include <getopt.h>\n#include <wordexp.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic struct io *setup_signalfd(void)\n{\n\tstruct io *io;\n\tsigset_t mask;\n\tint fd;\n\n\tsigemptyset(&mask);\n\tsigaddset(&mask, SIGINT);\n\tsigaddset(&mask, SIGTERM);\n\n\tif (sigprocmask(SIG_BLOCK, &mask, NULL) < 0) {\n\t\tperror(\"Failed to set signal mask\");\n\t\treturn 0;\n\t}\n\n\tfd = signalfd(-1, &mask, 0);\n\tif (fd < 0) {\n\t\tperror(\"Failed to create signal descriptor\");\n\t\treturn 0;\n\t}\n\n\tio = io_new(fd);\n\n\tio_set_close_on_destroy(io, true);\n\tio_set_read_handler(io, signal_read, NULL, NULL);\n\tio_set_disconnect_handler(io, io_hup, NULL, NULL);\n\n\treturn io;\n}"
  },
  {
    "function_name": "signal_read",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/shell.c",
    "lines": "817-862",
    "snippet": "static bool signal_read(struct io *io, void *user_data)\n{\n\tstatic bool terminated = false;\n\tstruct signalfd_siginfo si;\n\tssize_t result;\n\tint fd;\n\n\tfd = io_get_fd(io);\n\n\tresult = read(fd, &si, sizeof(si));\n\tif (result != sizeof(si))\n\t\treturn false;\n\n\tswitch (si.ssi_signo) {\n\tcase SIGINT:\n\t\tif (data.input && !data.mode) {\n\t\t\trl_replace_line(\"\", 0);\n\t\t\trl_crlf();\n\t\t\trl_on_new_line();\n\t\t\trl_redisplay();\n\t\t\treturn true;\n\t\t}\n\n\t\t/*\n\t\t * If input was not yet setup up that means signal was received\n\t\t * while daemon was not yet running. Since user is not able\n\t\t * to terminate client by CTRL-D or typing exit treat this as\n\t\t * exit and fall through.\n\t\t */\n\n\t\t/* fall through */\n\tcase SIGTERM:\n\t\tif (!terminated) {\n\t\t\tif (!data.mode) {\n\t\t\t\trl_replace_line(\"\", 0);\n\t\t\t\trl_crlf();\n\t\t\t}\n\t\t\tmainloop_quit();\n\t\t}\n\n\t\tterminated = true;\n\t\tbreak;\n\t}\n\n\treturn false;\n}",
    "includes": [
      "#include \"src/shared/shell.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/mainloop.h\"",
      "#include <readline/history.h>",
      "#include <readline/readline.h>",
      "#include <getopt.h>",
      "#include <wordexp.h>",
      "#include <sys/signalfd.h>",
      "#include <signal.h>",
      "#include <stdbool.h>",
      "#include <stdarg.h>",
      "#include <stdlib.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "mainloop_quit",
          "args": [],
          "line": 854
        },
        "resolved": true,
        "details": {
          "function_name": "mainloop_quit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/mainloop.c",
          "lines": "88-91",
          "snippet": "void mainloop_quit(void)\n{\n\tepoll_terminate = 1;\n}",
          "includes": [
            "#include \"mainloop.h\"",
            "#include <sys/epoll.h>",
            "#include <sys/timerfd.h>",
            "#include <sys/signalfd.h>",
            "#include <signal.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int epoll_terminate;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"mainloop.h\"\n#include <sys/epoll.h>\n#include <sys/timerfd.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <string.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic int epoll_terminate;\n\nvoid mainloop_quit(void)\n{\n\tepoll_terminate = 1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "rl_crlf",
          "args": [],
          "line": 852
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rl_replace_line",
          "args": [
            "\"\"",
            "0"
          ],
          "line": 851
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rl_redisplay",
          "args": [],
          "line": 836
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rl_on_new_line",
          "args": [],
          "line": 835
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rl_crlf",
          "args": [],
          "line": 834
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rl_replace_line",
          "args": [
            "\"\"",
            "0"
          ],
          "line": 833
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "read",
          "args": [
            "fd",
            "&si",
            "sizeof(si)"
          ],
          "line": 826
        },
        "resolved": true,
        "details": {
          "function_name": "notify_client_ready",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-client.c",
          "lines": "1221-1250",
          "snippet": "static void notify_client_ready(struct bt_gatt_client *client, bool success,\n\t\t\t\t\t\t\tuint8_t att_ecode)\n{\n\tconst struct queue_entry *entry;\n\n\tif (client->ready)\n\t\treturn;\n\n\tbt_gatt_client_ref(client);\n\tclient->ready = success;\n\n\tfor (entry = queue_get_entries(client->ready_cbs); entry;\n\t\t\t\t\t\t\tentry = entry->next) {\n\t\tstruct ready_cb *ready = entry->data;\n\n\t\tready->callback(success, att_ecode, ready->data);\n\t}\n\n\tqueue_remove_all(client->ready_cbs, NULL, NULL, ready_destroy);\n\n\t/* Notify clones */\n\tfor (entry = queue_get_entries(client->clones); entry;\n\t\t\t\t\t\t\tentry = entry->next) {\n\t\tstruct bt_gatt_client *clone = entry->data;\n\n\t\tnotify_client_ready(clone, success, att_ecode);\n\t}\n\n\tbt_gatt_client_unref(client);\n}",
          "includes": [
            "#include <sys/uio.h>",
            "#include <limits.h>",
            "#include <assert.h>",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-helpers.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include \"src/shared/att.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <sys/uio.h>\n#include <limits.h>\n#include <assert.h>\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-helpers.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include \"src/shared/att.h\"\n#include <config.h>\n\nstatic void notify_client_ready(struct bt_gatt_client *client, bool success,\n\t\t\t\t\t\t\tuint8_t att_ecode)\n{\n\tconst struct queue_entry *entry;\n\n\tif (client->ready)\n\t\treturn;\n\n\tbt_gatt_client_ref(client);\n\tclient->ready = success;\n\n\tfor (entry = queue_get_entries(client->ready_cbs); entry;\n\t\t\t\t\t\t\tentry = entry->next) {\n\t\tstruct ready_cb *ready = entry->data;\n\n\t\tready->callback(success, att_ecode, ready->data);\n\t}\n\n\tqueue_remove_all(client->ready_cbs, NULL, NULL, ready_destroy);\n\n\t/* Notify clones */\n\tfor (entry = queue_get_entries(client->clones); entry;\n\t\t\t\t\t\t\tentry = entry->next) {\n\t\tstruct bt_gatt_client *clone = entry->data;\n\n\t\tnotify_client_ready(clone, success, att_ecode);\n\t}\n\n\tbt_gatt_client_unref(client);\n}"
        }
      },
      {
        "call_info": {
          "callee": "io_get_fd",
          "args": [
            "io"
          ],
          "line": 824
        },
        "resolved": true,
        "details": {
          "function_name": "io_get_fd",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/io-glib.c",
          "lines": "137-143",
          "snippet": "int io_get_fd(struct io *io)\n{\n\tif (!io)\n\t\treturn -ENOTCONN;\n\n\treturn g_io_channel_unix_get_fd(io->channel);\n}",
          "includes": [
            "#include \"src/shared/io.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/io.h\"\n#include <glib.h>\n#include <errno.h>\n#include <config.h>\n\nint io_get_fd(struct io *io)\n{\n\tif (!io)\n\t\treturn -ENOTCONN;\n\n\treturn g_io_channel_unix_get_fd(io->channel);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/shell.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/mainloop.h\"\n#include <readline/history.h>\n#include <readline/readline.h>\n#include <getopt.h>\n#include <wordexp.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic bool signal_read(struct io *io, void *user_data)\n{\n\tstatic bool terminated = false;\n\tstruct signalfd_siginfo si;\n\tssize_t result;\n\tint fd;\n\n\tfd = io_get_fd(io);\n\n\tresult = read(fd, &si, sizeof(si));\n\tif (result != sizeof(si))\n\t\treturn false;\n\n\tswitch (si.ssi_signo) {\n\tcase SIGINT:\n\t\tif (data.input && !data.mode) {\n\t\t\trl_replace_line(\"\", 0);\n\t\t\trl_crlf();\n\t\t\trl_on_new_line();\n\t\t\trl_redisplay();\n\t\t\treturn true;\n\t\t}\n\n\t\t/*\n\t\t * If input was not yet setup up that means signal was received\n\t\t * while daemon was not yet running. Since user is not able\n\t\t * to terminate client by CTRL-D or typing exit treat this as\n\t\t * exit and fall through.\n\t\t */\n\n\t\t/* fall through */\n\tcase SIGTERM:\n\t\tif (!terminated) {\n\t\t\tif (!data.mode) {\n\t\t\t\trl_replace_line(\"\", 0);\n\t\t\t\trl_crlf();\n\t\t\t}\n\t\t\tmainloop_quit();\n\t\t}\n\n\t\tterminated = true;\n\t\tbreak;\n\t}\n\n\treturn false;\n}"
  },
  {
    "function_name": "io_hup",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/shell.c",
    "lines": "810-815",
    "snippet": "static bool io_hup(struct io *io, void *user_data)\n{\n\tmainloop_quit();\n\n\treturn false;\n}",
    "includes": [
      "#include \"src/shared/shell.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/mainloop.h\"",
      "#include <readline/history.h>",
      "#include <readline/readline.h>",
      "#include <getopt.h>",
      "#include <wordexp.h>",
      "#include <sys/signalfd.h>",
      "#include <signal.h>",
      "#include <stdbool.h>",
      "#include <stdarg.h>",
      "#include <stdlib.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "mainloop_quit",
          "args": [],
          "line": 812
        },
        "resolved": true,
        "details": {
          "function_name": "mainloop_quit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/mainloop.c",
          "lines": "88-91",
          "snippet": "void mainloop_quit(void)\n{\n\tepoll_terminate = 1;\n}",
          "includes": [
            "#include \"mainloop.h\"",
            "#include <sys/epoll.h>",
            "#include <sys/timerfd.h>",
            "#include <sys/signalfd.h>",
            "#include <signal.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int epoll_terminate;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"mainloop.h\"\n#include <sys/epoll.h>\n#include <sys/timerfd.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <string.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic int epoll_terminate;\n\nvoid mainloop_quit(void)\n{\n\tepoll_terminate = 1;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/shell.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/mainloop.h\"\n#include <readline/history.h>\n#include <readline/readline.h>\n#include <getopt.h>\n#include <wordexp.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic bool io_hup(struct io *io, void *user_data)\n{\n\tmainloop_quit();\n\n\treturn false;\n}"
  },
  {
    "function_name": "shell_completion",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/shell.c",
    "lines": "778-808",
    "snippet": "static char **shell_completion(const char *text, int start, int end)\n{\n\tchar **matches = NULL;\n\n\tif (!data.menu)\n\t\treturn NULL;\n\n\tif (start > 0) {\n\t\twordexp_t w;\n\n\t\tif (wordexp(rl_line_buffer, &w, WRDE_NOCMD))\n\t\t\treturn NULL;\n\n\t\tmatches = menu_completion(default_menu, text, w.we_wordc,\n\t\t\t\t\t\t\tw.we_wordv[0]);\n\t\tif (!matches)\n\t\t\tmatches = menu_completion(data.menu->entries, text,\n\t\t\t\t\t\t\tw.we_wordc,\n\t\t\t\t\t\t\tw.we_wordv[0]);\n\n\t\twordfree(&w);\n\t} else {\n\t\trl_completion_display_matches_hook = NULL;\n\t\tmatches = rl_completion_matches(text, cmd_generator);\n\t}\n\n\tif (!matches)\n\t\trl_attempted_completion_over = 1;\n\n\treturn matches;\n}",
    "includes": [
      "#include \"src/shared/shell.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/mainloop.h\"",
      "#include <readline/history.h>",
      "#include <readline/readline.h>",
      "#include <getopt.h>",
      "#include <wordexp.h>",
      "#include <sys/signalfd.h>",
      "#include <signal.h>",
      "#include <stdbool.h>",
      "#include <stdarg.h>",
      "#include <stdlib.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static const struct bt_shell_menu_entry default_menu[] = {\n\t{ \"back\",         NULL,       cmd_back, \"Return to main menu\", NULL,\n\t\t\t\t\t\t\tNULL, cmd_back_exists },\n\t{ \"menu\",         \"<name>\",   cmd_menu, \"Select submenu\",\n\t\t\t\t\t\t\tmenu_generator, NULL,\n\t\t\t\t\t\t\tcmd_menu_exists},\n\t{ \"version\",      NULL,       cmd_version, \"Display version\" },\n\t{ \"quit\",         NULL,       cmd_quit, \"Quit program\" },\n\t{ \"exit\",         NULL,       cmd_quit, \"Quit program\" },\n\t{ \"help\",         NULL,       cmd_help,\n\t\t\t\t\t\"Display help about this program\" },\n\t{ \"export\",       NULL,       cmd_export,\n\t\t\t\t\t\t\"Print evironment variables\" },\n\t{ }\n};"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "rl_completion_matches",
          "args": [
            "text",
            "cmd_generator"
          ],
          "line": 801
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "wordfree",
          "args": [
            "&w"
          ],
          "line": 798
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "menu_completion",
          "args": [
            "data.menu->entries",
            "text",
            "w.we_wordc",
            "w.we_wordv[0]"
          ],
          "line": 794
        },
        "resolved": true,
        "details": {
          "function_name": "menu_completion",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/shell.c",
          "lines": "756-776",
          "snippet": "static char **menu_completion(const struct bt_shell_menu_entry *entry,\n\t\t\t\tconst char *text, int argc, char *input_cmd)\n{\n\tchar **matches = NULL;\n\n\tfor (; entry->cmd; entry++) {\n\t\tif (strcmp(entry->cmd, input_cmd))\n\t\t\tcontinue;\n\n\t\tif (!entry->gen) {\n\t\t\tmatches = args_completion(entry, argc, text);\n\t\t\tbreak;\n\t\t}\n\n\t\trl_completion_display_matches_hook = entry->disp;\n\t\tmatches = rl_completion_matches(text, entry->gen);\n\t\tbreak;\n\t}\n\n\treturn matches;\n}",
          "includes": [
            "#include \"src/shared/shell.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/mainloop.h\"",
            "#include <readline/history.h>",
            "#include <readline/readline.h>",
            "#include <getopt.h>",
            "#include <wordexp.h>",
            "#include <sys/signalfd.h>",
            "#include <signal.h>",
            "#include <stdbool.h>",
            "#include <stdarg.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/shell.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/mainloop.h\"\n#include <readline/history.h>\n#include <readline/readline.h>\n#include <getopt.h>\n#include <wordexp.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic char **menu_completion(const struct bt_shell_menu_entry *entry,\n\t\t\t\tconst char *text, int argc, char *input_cmd)\n{\n\tchar **matches = NULL;\n\n\tfor (; entry->cmd; entry++) {\n\t\tif (strcmp(entry->cmd, input_cmd))\n\t\t\tcontinue;\n\n\t\tif (!entry->gen) {\n\t\t\tmatches = args_completion(entry, argc, text);\n\t\t\tbreak;\n\t\t}\n\n\t\trl_completion_display_matches_hook = entry->disp;\n\t\tmatches = rl_completion_matches(text, entry->gen);\n\t\tbreak;\n\t}\n\n\treturn matches;\n}"
        }
      },
      {
        "call_info": {
          "callee": "wordexp",
          "args": [
            "rl_line_buffer",
            "&w",
            "WRDE_NOCMD"
          ],
          "line": 788
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/shell.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/mainloop.h\"\n#include <readline/history.h>\n#include <readline/readline.h>\n#include <getopt.h>\n#include <wordexp.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic const struct bt_shell_menu_entry default_menu[] = {\n\t{ \"back\",         NULL,       cmd_back, \"Return to main menu\", NULL,\n\t\t\t\t\t\t\tNULL, cmd_back_exists },\n\t{ \"menu\",         \"<name>\",   cmd_menu, \"Select submenu\",\n\t\t\t\t\t\t\tmenu_generator, NULL,\n\t\t\t\t\t\t\tcmd_menu_exists},\n\t{ \"version\",      NULL,       cmd_version, \"Display version\" },\n\t{ \"quit\",         NULL,       cmd_quit, \"Quit program\" },\n\t{ \"exit\",         NULL,       cmd_quit, \"Quit program\" },\n\t{ \"help\",         NULL,       cmd_help,\n\t\t\t\t\t\"Display help about this program\" },\n\t{ \"export\",       NULL,       cmd_export,\n\t\t\t\t\t\t\"Print evironment variables\" },\n\t{ }\n};\n\nstatic char **shell_completion(const char *text, int start, int end)\n{\n\tchar **matches = NULL;\n\n\tif (!data.menu)\n\t\treturn NULL;\n\n\tif (start > 0) {\n\t\twordexp_t w;\n\n\t\tif (wordexp(rl_line_buffer, &w, WRDE_NOCMD))\n\t\t\treturn NULL;\n\n\t\tmatches = menu_completion(default_menu, text, w.we_wordc,\n\t\t\t\t\t\t\tw.we_wordv[0]);\n\t\tif (!matches)\n\t\t\tmatches = menu_completion(data.menu->entries, text,\n\t\t\t\t\t\t\tw.we_wordc,\n\t\t\t\t\t\t\tw.we_wordv[0]);\n\n\t\twordfree(&w);\n\t} else {\n\t\trl_completion_display_matches_hook = NULL;\n\t\tmatches = rl_completion_matches(text, cmd_generator);\n\t}\n\n\tif (!matches)\n\t\trl_attempted_completion_over = 1;\n\n\treturn matches;\n}"
  },
  {
    "function_name": "menu_completion",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/shell.c",
    "lines": "756-776",
    "snippet": "static char **menu_completion(const struct bt_shell_menu_entry *entry,\n\t\t\t\tconst char *text, int argc, char *input_cmd)\n{\n\tchar **matches = NULL;\n\n\tfor (; entry->cmd; entry++) {\n\t\tif (strcmp(entry->cmd, input_cmd))\n\t\t\tcontinue;\n\n\t\tif (!entry->gen) {\n\t\t\tmatches = args_completion(entry, argc, text);\n\t\t\tbreak;\n\t\t}\n\n\t\trl_completion_display_matches_hook = entry->disp;\n\t\tmatches = rl_completion_matches(text, entry->gen);\n\t\tbreak;\n\t}\n\n\treturn matches;\n}",
    "includes": [
      "#include \"src/shared/shell.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/mainloop.h\"",
      "#include <readline/history.h>",
      "#include <readline/readline.h>",
      "#include <getopt.h>",
      "#include <wordexp.h>",
      "#include <sys/signalfd.h>",
      "#include <signal.h>",
      "#include <stdbool.h>",
      "#include <stdarg.h>",
      "#include <stdlib.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "rl_completion_matches",
          "args": [
            "text",
            "entry->gen"
          ],
          "line": 771
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "args_completion",
          "args": [
            "entry",
            "argc",
            "text"
          ],
          "line": 766
        },
        "resolved": true,
        "details": {
          "function_name": "args_completion",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/shell.c",
          "lines": "703-754",
          "snippet": "static char **args_completion(const struct bt_shell_menu_entry *entry, int argc,\n\t\t\t\t\t\t\tconst char *text)\n{\n\tchar **matches = NULL;\n\tchar *str;\n\tint index;\n\n\tindex = text[0] == '\\0' ? argc - 1 : argc - 2;\n\tif (index < 0)\n\t\treturn NULL;\n\n\tif (!entry->arg)\n\t\tgoto end;\n\n\tstr = strdup(entry->arg);\n\n\tif (parse_args(str, &args, \"<>[]\", WRDE_NOCMD))\n\t\tgoto done;\n\n\t/* Check if argument is valid */\n\tif ((unsigned) index > args.we_wordc - 1)\n\t\tgoto done;\n\n\t/* Check if there are multiple values */\n\tif (!strrchr(entry->arg, '/'))\n\t\tgoto done;\n\n\tfree(str);\n\n\t/* Split values separated by / */\n\tstr = strdelimit(args.we_wordv[index], \"/\", ' ');\n\n\targs.we_offs = 0;\n\twordfree(&args);\n\n\tif (wordexp(str, &args, WRDE_NOCMD))\n\t\tgoto done;\n\n\trl_completion_display_matches_hook = NULL;\n\tmatches = rl_completion_matches(text, arg_generator);\n\ndone:\n\tfree(str);\nend:\n\tif (!matches && text[0] == '\\0')\n\t\tbt_shell_printf(\"Usage: %s %s\\n\", entry->cmd,\n\t\t\t\t\tentry->arg ? entry->arg : \"\");\n\n\targs.we_offs = 0;\n\twordfree(&args);\n\treturn matches;\n}",
          "includes": [
            "#include \"src/shared/shell.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/mainloop.h\"",
            "#include <readline/history.h>",
            "#include <readline/readline.h>",
            "#include <getopt.h>",
            "#include <wordexp.h>",
            "#include <sys/signalfd.h>",
            "#include <signal.h>",
            "#include <stdbool.h>",
            "#include <stdarg.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static wordexp_t args;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/shell.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/mainloop.h\"\n#include <readline/history.h>\n#include <readline/readline.h>\n#include <getopt.h>\n#include <wordexp.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic wordexp_t args;\n\nstatic char **args_completion(const struct bt_shell_menu_entry *entry, int argc,\n\t\t\t\t\t\t\tconst char *text)\n{\n\tchar **matches = NULL;\n\tchar *str;\n\tint index;\n\n\tindex = text[0] == '\\0' ? argc - 1 : argc - 2;\n\tif (index < 0)\n\t\treturn NULL;\n\n\tif (!entry->arg)\n\t\tgoto end;\n\n\tstr = strdup(entry->arg);\n\n\tif (parse_args(str, &args, \"<>[]\", WRDE_NOCMD))\n\t\tgoto done;\n\n\t/* Check if argument is valid */\n\tif ((unsigned) index > args.we_wordc - 1)\n\t\tgoto done;\n\n\t/* Check if there are multiple values */\n\tif (!strrchr(entry->arg, '/'))\n\t\tgoto done;\n\n\tfree(str);\n\n\t/* Split values separated by / */\n\tstr = strdelimit(args.we_wordv[index], \"/\", ' ');\n\n\targs.we_offs = 0;\n\twordfree(&args);\n\n\tif (wordexp(str, &args, WRDE_NOCMD))\n\t\tgoto done;\n\n\trl_completion_display_matches_hook = NULL;\n\tmatches = rl_completion_matches(text, arg_generator);\n\ndone:\n\tfree(str);\nend:\n\tif (!matches && text[0] == '\\0')\n\t\tbt_shell_printf(\"Usage: %s %s\\n\", entry->cmd,\n\t\t\t\t\tentry->arg ? entry->arg : \"\");\n\n\targs.we_offs = 0;\n\twordfree(&args);\n\treturn matches;\n}"
        }
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "entry->cmd",
            "input_cmd"
          ],
          "line": 762
        },
        "resolved": true,
        "details": {
          "function_name": "g_strcmp",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "1927-1930",
          "snippet": "static gint g_strcmp(gconstpointer a, gconstpointer b)\n{\n\treturn strcmp(a, b);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic gint g_strcmp(gconstpointer a, gconstpointer b)\n{\n\treturn strcmp(a, b);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/shell.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/mainloop.h\"\n#include <readline/history.h>\n#include <readline/readline.h>\n#include <getopt.h>\n#include <wordexp.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic char **menu_completion(const struct bt_shell_menu_entry *entry,\n\t\t\t\tconst char *text, int argc, char *input_cmd)\n{\n\tchar **matches = NULL;\n\n\tfor (; entry->cmd; entry++) {\n\t\tif (strcmp(entry->cmd, input_cmd))\n\t\t\tcontinue;\n\n\t\tif (!entry->gen) {\n\t\t\tmatches = args_completion(entry, argc, text);\n\t\t\tbreak;\n\t\t}\n\n\t\trl_completion_display_matches_hook = entry->disp;\n\t\tmatches = rl_completion_matches(text, entry->gen);\n\t\tbreak;\n\t}\n\n\treturn matches;\n}"
  },
  {
    "function_name": "args_completion",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/shell.c",
    "lines": "703-754",
    "snippet": "static char **args_completion(const struct bt_shell_menu_entry *entry, int argc,\n\t\t\t\t\t\t\tconst char *text)\n{\n\tchar **matches = NULL;\n\tchar *str;\n\tint index;\n\n\tindex = text[0] == '\\0' ? argc - 1 : argc - 2;\n\tif (index < 0)\n\t\treturn NULL;\n\n\tif (!entry->arg)\n\t\tgoto end;\n\n\tstr = strdup(entry->arg);\n\n\tif (parse_args(str, &args, \"<>[]\", WRDE_NOCMD))\n\t\tgoto done;\n\n\t/* Check if argument is valid */\n\tif ((unsigned) index > args.we_wordc - 1)\n\t\tgoto done;\n\n\t/* Check if there are multiple values */\n\tif (!strrchr(entry->arg, '/'))\n\t\tgoto done;\n\n\tfree(str);\n\n\t/* Split values separated by / */\n\tstr = strdelimit(args.we_wordv[index], \"/\", ' ');\n\n\targs.we_offs = 0;\n\twordfree(&args);\n\n\tif (wordexp(str, &args, WRDE_NOCMD))\n\t\tgoto done;\n\n\trl_completion_display_matches_hook = NULL;\n\tmatches = rl_completion_matches(text, arg_generator);\n\ndone:\n\tfree(str);\nend:\n\tif (!matches && text[0] == '\\0')\n\t\tbt_shell_printf(\"Usage: %s %s\\n\", entry->cmd,\n\t\t\t\t\tentry->arg ? entry->arg : \"\");\n\n\targs.we_offs = 0;\n\twordfree(&args);\n\treturn matches;\n}",
    "includes": [
      "#include \"src/shared/shell.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/mainloop.h\"",
      "#include <readline/history.h>",
      "#include <readline/readline.h>",
      "#include <getopt.h>",
      "#include <wordexp.h>",
      "#include <sys/signalfd.h>",
      "#include <signal.h>",
      "#include <stdbool.h>",
      "#include <stdarg.h>",
      "#include <stdlib.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static wordexp_t args;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "wordfree",
          "args": [
            "&args"
          ],
          "line": 752
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bt_shell_printf",
          "args": [
            "\"Usage: %s %s\\n\"",
            "entry->cmd",
            "entry->arg ? entry->arg : \"\""
          ],
          "line": 748
        },
        "resolved": true,
        "details": {
          "function_name": "bt_shell_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/shell.c",
          "lines": "458-498",
          "snippet": "void bt_shell_printf(const char *fmt, ...)\n{\n\tva_list args;\n\tbool save_input;\n\tchar *saved_line;\n\tint saved_point;\n\n\tif (!data.input)\n\t\treturn;\n\n\tif (data.mode) {\n\t\tva_start(args, fmt);\n\t\tvprintf(fmt, args);\n\t\tva_end(args);\n\t\treturn;\n\t}\n\n\tsave_input = !RL_ISSTATE(RL_STATE_DONE);\n\n\tif (save_input) {\n\t\tsaved_point = rl_point;\n\t\tsaved_line = rl_copy_text(0, rl_end);\n\t\tif (!data.saved_prompt)\n\t\t\trl_save_prompt();\n\t\trl_replace_line(\"\", 0);\n\t\trl_redisplay();\n\t}\n\n\tva_start(args, fmt);\n\tvprintf(fmt, args);\n\tva_end(args);\n\n\tif (save_input) {\n\t\tif (!data.saved_prompt)\n\t\t\trl_restore_prompt();\n\t\trl_replace_line(saved_line, 0);\n\t\trl_point = saved_point;\n\t\trl_forced_update_display();\n\t\tfree(saved_line);\n\t}\n}",
          "includes": [
            "#include \"src/shared/shell.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/mainloop.h\"",
            "#include <readline/history.h>",
            "#include <readline/readline.h>",
            "#include <getopt.h>",
            "#include <wordexp.h>",
            "#include <sys/signalfd.h>",
            "#include <signal.h>",
            "#include <stdbool.h>",
            "#include <stdarg.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static wordexp_t args;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/shell.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/mainloop.h\"\n#include <readline/history.h>\n#include <readline/readline.h>\n#include <getopt.h>\n#include <wordexp.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic wordexp_t args;\n\nvoid bt_shell_printf(const char *fmt, ...)\n{\n\tva_list args;\n\tbool save_input;\n\tchar *saved_line;\n\tint saved_point;\n\n\tif (!data.input)\n\t\treturn;\n\n\tif (data.mode) {\n\t\tva_start(args, fmt);\n\t\tvprintf(fmt, args);\n\t\tva_end(args);\n\t\treturn;\n\t}\n\n\tsave_input = !RL_ISSTATE(RL_STATE_DONE);\n\n\tif (save_input) {\n\t\tsaved_point = rl_point;\n\t\tsaved_line = rl_copy_text(0, rl_end);\n\t\tif (!data.saved_prompt)\n\t\t\trl_save_prompt();\n\t\trl_replace_line(\"\", 0);\n\t\trl_redisplay();\n\t}\n\n\tva_start(args, fmt);\n\tvprintf(fmt, args);\n\tva_end(args);\n\n\tif (save_input) {\n\t\tif (!data.saved_prompt)\n\t\t\trl_restore_prompt();\n\t\trl_replace_line(saved_line, 0);\n\t\trl_point = saved_point;\n\t\trl_forced_update_display();\n\t\tfree(saved_line);\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "free",
          "args": [
            "str"
          ],
          "line": 745
        },
        "resolved": true,
        "details": {
          "function_name": "bt_att_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/att.c",
          "lines": "956-985",
          "snippet": "static void bt_att_free(struct bt_att *att)\n{\n\tif (att->pending_req)\n\t\tdestroy_att_send_op(att->pending_req);\n\n\tif (att->pending_ind)\n\t\tdestroy_att_send_op(att->pending_ind);\n\n\tio_destroy(att->io);\n\tbt_crypto_unref(att->crypto);\n\n\tqueue_destroy(att->req_queue, NULL);\n\tqueue_destroy(att->ind_queue, NULL);\n\tqueue_destroy(att->write_queue, NULL);\n\tqueue_destroy(att->notify_list, NULL);\n\tqueue_destroy(att->disconn_list, NULL);\n\n\tif (att->timeout_destroy)\n\t\tatt->timeout_destroy(att->timeout_data);\n\n\tif (att->debug_destroy)\n\t\tatt->debug_destroy(att->debug_data);\n\n\tfree(att->local_sign);\n\tfree(att->remote_sign);\n\n\tfree(att->buf);\n\n\tfree(att);\n}",
          "includes": [
            "#include \"src/shared/crypto.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/l2cap.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/crypto.h\"\n#include \"src/shared/att.h\"\n#include \"lib/uuid.h\"\n#include \"lib/l2cap.h\"\n#include \"lib/bluetooth.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include <errno.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <config.h>\n\nstatic void bt_att_free(struct bt_att *att)\n{\n\tif (att->pending_req)\n\t\tdestroy_att_send_op(att->pending_req);\n\n\tif (att->pending_ind)\n\t\tdestroy_att_send_op(att->pending_ind);\n\n\tio_destroy(att->io);\n\tbt_crypto_unref(att->crypto);\n\n\tqueue_destroy(att->req_queue, NULL);\n\tqueue_destroy(att->ind_queue, NULL);\n\tqueue_destroy(att->write_queue, NULL);\n\tqueue_destroy(att->notify_list, NULL);\n\tqueue_destroy(att->disconn_list, NULL);\n\n\tif (att->timeout_destroy)\n\t\tatt->timeout_destroy(att->timeout_data);\n\n\tif (att->debug_destroy)\n\t\tatt->debug_destroy(att->debug_data);\n\n\tfree(att->local_sign);\n\tfree(att->remote_sign);\n\n\tfree(att->buf);\n\n\tfree(att);\n}"
        }
      },
      {
        "call_info": {
          "callee": "rl_completion_matches",
          "args": [
            "text",
            "arg_generator"
          ],
          "line": 742
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "wordexp",
          "args": [
            "str",
            "&args",
            "WRDE_NOCMD"
          ],
          "line": 738
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "wordfree",
          "args": [
            "&args"
          ],
          "line": 736
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strdelimit",
          "args": [
            "args.we_wordv[index]",
            "\"/\"",
            "' '"
          ],
          "line": 733
        },
        "resolved": true,
        "details": {
          "function_name": "strdelimit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/util.c",
          "lines": "984-1005",
          "snippet": "char *strdelimit(char *str, char *del, char c)\n{\n\tchar *dup;\n\n\tif (!str)\n\t\treturn NULL;\n\n\tdup = strdup(str);\n\tif (dup[0] == '\\0')\n\t\treturn dup;\n\n\twhile (del[0] != '\\0') {\n\t\tchar *rep = dup;\n\n\t\twhile ((rep = strchr(rep, del[0])))\n\t\t\trep[0] = c;\n\n\t\tdel++;\n\t}\n\n\treturn dup;\n}",
          "includes": [
            "#include \"src/shared/util.h\"",
            "#include <string.h>",
            "#include <limits.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <stdbool.h>",
            "#include <stdarg.h>",
            "#include <ctype.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/util.h\"\n#include <string.h>\n#include <limits.h>\n#include <dirent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <config.h>\n\nchar *strdelimit(char *str, char *del, char c)\n{\n\tchar *dup;\n\n\tif (!str)\n\t\treturn NULL;\n\n\tdup = strdup(str);\n\tif (dup[0] == '\\0')\n\t\treturn dup;\n\n\twhile (del[0] != '\\0') {\n\t\tchar *rep = dup;\n\n\t\twhile ((rep = strchr(rep, del[0])))\n\t\t\trep[0] = c;\n\n\t\tdel++;\n\t}\n\n\treturn dup;\n}"
        }
      },
      {
        "call_info": {
          "callee": "strrchr",
          "args": [
            "entry->arg",
            "'/'"
          ],
          "line": 727
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "parse_args",
          "args": [
            "str",
            "&args",
            "\"<>[]\"",
            "WRDE_NOCMD"
          ],
          "line": 719
        },
        "resolved": true,
        "details": {
          "function_name": "parse_args",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/shell.c",
          "lines": "271-289",
          "snippet": "static int parse_args(char *arg, wordexp_t *w, char *del, int flags)\n{\n\tchar *str;\n\n\tstr = strdelimit(arg, del, '\"');\n\n\tif (wordexp(str, w, flags)) {\n\t\tfree(str);\n\t\treturn -EINVAL;\n\t}\n\n\t/* If argument ends with ... set we_offs bypass strict checks */\n\tif (w->we_wordc && !strsuffix(w->we_wordv[w->we_wordc -1], \"...\"))\n\t\tw->we_offs = 1;\n\n\tfree(str);\n\n\treturn 0;\n}",
          "includes": [
            "#include \"src/shared/shell.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/mainloop.h\"",
            "#include <readline/history.h>",
            "#include <readline/readline.h>",
            "#include <getopt.h>",
            "#include <wordexp.h>",
            "#include <sys/signalfd.h>",
            "#include <signal.h>",
            "#include <stdbool.h>",
            "#include <stdarg.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/shell.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/mainloop.h\"\n#include <readline/history.h>\n#include <readline/readline.h>\n#include <getopt.h>\n#include <wordexp.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic int parse_args(char *arg, wordexp_t *w, char *del, int flags)\n{\n\tchar *str;\n\n\tstr = strdelimit(arg, del, '\"');\n\n\tif (wordexp(str, w, flags)) {\n\t\tfree(str);\n\t\treturn -EINVAL;\n\t}\n\n\t/* If argument ends with ... set we_offs bypass strict checks */\n\tif (w->we_wordc && !strsuffix(w->we_wordv[w->we_wordc -1], \"...\"))\n\t\tw->we_offs = 1;\n\n\tfree(str);\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "strdup",
          "args": [
            "entry->arg"
          ],
          "line": 717
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/shell.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/mainloop.h\"\n#include <readline/history.h>\n#include <readline/readline.h>\n#include <getopt.h>\n#include <wordexp.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic wordexp_t args;\n\nstatic char **args_completion(const struct bt_shell_menu_entry *entry, int argc,\n\t\t\t\t\t\t\tconst char *text)\n{\n\tchar **matches = NULL;\n\tchar *str;\n\tint index;\n\n\tindex = text[0] == '\\0' ? argc - 1 : argc - 2;\n\tif (index < 0)\n\t\treturn NULL;\n\n\tif (!entry->arg)\n\t\tgoto end;\n\n\tstr = strdup(entry->arg);\n\n\tif (parse_args(str, &args, \"<>[]\", WRDE_NOCMD))\n\t\tgoto done;\n\n\t/* Check if argument is valid */\n\tif ((unsigned) index > args.we_wordc - 1)\n\t\tgoto done;\n\n\t/* Check if there are multiple values */\n\tif (!strrchr(entry->arg, '/'))\n\t\tgoto done;\n\n\tfree(str);\n\n\t/* Split values separated by / */\n\tstr = strdelimit(args.we_wordv[index], \"/\", ' ');\n\n\targs.we_offs = 0;\n\twordfree(&args);\n\n\tif (wordexp(str, &args, WRDE_NOCMD))\n\t\tgoto done;\n\n\trl_completion_display_matches_hook = NULL;\n\tmatches = rl_completion_matches(text, arg_generator);\n\ndone:\n\tfree(str);\nend:\n\tif (!matches && text[0] == '\\0')\n\t\tbt_shell_printf(\"Usage: %s %s\\n\", entry->cmd,\n\t\t\t\t\tentry->arg ? entry->arg : \"\");\n\n\targs.we_offs = 0;\n\twordfree(&args);\n\treturn matches;\n}"
  },
  {
    "function_name": "arg_generator",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/shell.c",
    "lines": "682-701",
    "snippet": "static char *arg_generator(const char *text, int state)\n{\n\tstatic unsigned int index, len;\n\tconst char *arg;\n\n\tif (!state) {\n\t\tindex = 0;\n\t\tlen = strlen(text);\n\t}\n\n\twhile (index < args.we_wordc) {\n\t\targ = args.we_wordv[index];\n\t\tindex++;\n\n\t\tif (!strncmp(arg, text, len))\n\t\t\treturn strdup(arg);\n\t}\n\n\treturn NULL;\n}",
    "includes": [
      "#include \"src/shared/shell.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/mainloop.h\"",
      "#include <readline/history.h>",
      "#include <readline/readline.h>",
      "#include <getopt.h>",
      "#include <wordexp.h>",
      "#include <sys/signalfd.h>",
      "#include <signal.h>",
      "#include <stdbool.h>",
      "#include <stdarg.h>",
      "#include <stdlib.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static wordexp_t args;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "strdup",
          "args": [
            "arg"
          ],
          "line": 697
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strncmp",
          "args": [
            "arg",
            "text",
            "len"
          ],
          "line": 696
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "text"
          ],
          "line": 689
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/shell.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/mainloop.h\"\n#include <readline/history.h>\n#include <readline/readline.h>\n#include <getopt.h>\n#include <wordexp.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic wordexp_t args;\n\nstatic char *arg_generator(const char *text, int state)\n{\n\tstatic unsigned int index, len;\n\tconst char *arg;\n\n\tif (!state) {\n\t\tindex = 0;\n\t\tlen = strlen(text);\n\t}\n\n\twhile (index < args.we_wordc) {\n\t\targ = args.we_wordv[index];\n\t\tindex++;\n\n\t\tif (!strncmp(arg, text, len))\n\t\t\treturn strdup(arg);\n\t}\n\n\treturn NULL;\n}"
  },
  {
    "function_name": "cmd_generator",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/shell.c",
    "lines": "620-678",
    "snippet": "static char *cmd_generator(const char *text, int state)\n{\n\tstatic int index;\n\tstatic bool default_menu_enabled, submenu_enabled;\n\tstatic const struct bt_shell_menu *menu;\n\tchar *cmd;\n\n\tif (!state) {\n\t\tindex = 0;\n\t\tmenu = NULL;\n\t\tdefault_menu_enabled = true;\n\t\tsubmenu_enabled = false;\n\t}\n\n\tif (default_menu_enabled) {\n\t\tcmd = find_cmd(text, default_menu, &index);\n\t\tif (cmd) {\n\t\t\treturn cmd;\n\t\t} else {\n\t\t\tindex = 0;\n\t\t\tmenu = data.menu;\n\t\t\tdefault_menu_enabled = false;\n\t\t}\n\t}\n\n\tif (!submenu_enabled) {\n\t\tcmd = find_cmd(text, menu->entries, &index);\n\t\tif (cmd || menu != data.main)\n\t\t\treturn cmd;\n\n\t\tcmd = strrchr(text, '.');\n\t\tif (!cmd)\n\t\t\treturn NULL;\n\n\t\tmenu = find_menu(text, cmd - text);\n\t\tif (!menu)\n\t\t\treturn NULL;\n\n\t\tindex = 0;\n\t\tsubmenu_enabled = true;\n\t}\n\n\tcmd = find_cmd(text + strlen(menu->name) + 1, menu->entries, &index);\n\tif (cmd) {\n\t\tint err;\n\t\tchar *tmp;\n\n\t\terr = asprintf(&tmp, \"%s.%s\", menu->name, cmd);\n\n\t\tfree(cmd);\n\n\t\tif (err < 0)\n\t\t\treturn NULL;\n\n\t\tcmd = tmp;\n\t}\n\n\treturn cmd;\n}",
    "includes": [
      "#include \"src/shared/shell.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/mainloop.h\"",
      "#include <readline/history.h>",
      "#include <readline/readline.h>",
      "#include <getopt.h>",
      "#include <wordexp.h>",
      "#include <sys/signalfd.h>",
      "#include <signal.h>",
      "#include <stdbool.h>",
      "#include <stdarg.h>",
      "#include <stdlib.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static const struct bt_shell_menu_entry default_menu[] = {\n\t{ \"back\",         NULL,       cmd_back, \"Return to main menu\", NULL,\n\t\t\t\t\t\t\tNULL, cmd_back_exists },\n\t{ \"menu\",         \"<name>\",   cmd_menu, \"Select submenu\",\n\t\t\t\t\t\t\tmenu_generator, NULL,\n\t\t\t\t\t\t\tcmd_menu_exists},\n\t{ \"version\",      NULL,       cmd_version, \"Display version\" },\n\t{ \"quit\",         NULL,       cmd_quit, \"Quit program\" },\n\t{ \"exit\",         NULL,       cmd_quit, \"Quit program\" },\n\t{ \"help\",         NULL,       cmd_help,\n\t\t\t\t\t\"Display help about this program\" },\n\t{ \"export\",       NULL,       cmd_export,\n\t\t\t\t\t\t\"Print evironment variables\" },\n\t{ }\n};"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "cmd"
          ],
          "line": 669
        },
        "resolved": true,
        "details": {
          "function_name": "bt_att_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/att.c",
          "lines": "956-985",
          "snippet": "static void bt_att_free(struct bt_att *att)\n{\n\tif (att->pending_req)\n\t\tdestroy_att_send_op(att->pending_req);\n\n\tif (att->pending_ind)\n\t\tdestroy_att_send_op(att->pending_ind);\n\n\tio_destroy(att->io);\n\tbt_crypto_unref(att->crypto);\n\n\tqueue_destroy(att->req_queue, NULL);\n\tqueue_destroy(att->ind_queue, NULL);\n\tqueue_destroy(att->write_queue, NULL);\n\tqueue_destroy(att->notify_list, NULL);\n\tqueue_destroy(att->disconn_list, NULL);\n\n\tif (att->timeout_destroy)\n\t\tatt->timeout_destroy(att->timeout_data);\n\n\tif (att->debug_destroy)\n\t\tatt->debug_destroy(att->debug_data);\n\n\tfree(att->local_sign);\n\tfree(att->remote_sign);\n\n\tfree(att->buf);\n\n\tfree(att);\n}",
          "includes": [
            "#include \"src/shared/crypto.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/l2cap.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/crypto.h\"\n#include \"src/shared/att.h\"\n#include \"lib/uuid.h\"\n#include \"lib/l2cap.h\"\n#include \"lib/bluetooth.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include <errno.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <config.h>\n\nstatic void bt_att_free(struct bt_att *att)\n{\n\tif (att->pending_req)\n\t\tdestroy_att_send_op(att->pending_req);\n\n\tif (att->pending_ind)\n\t\tdestroy_att_send_op(att->pending_ind);\n\n\tio_destroy(att->io);\n\tbt_crypto_unref(att->crypto);\n\n\tqueue_destroy(att->req_queue, NULL);\n\tqueue_destroy(att->ind_queue, NULL);\n\tqueue_destroy(att->write_queue, NULL);\n\tqueue_destroy(att->notify_list, NULL);\n\tqueue_destroy(att->disconn_list, NULL);\n\n\tif (att->timeout_destroy)\n\t\tatt->timeout_destroy(att->timeout_data);\n\n\tif (att->debug_destroy)\n\t\tatt->debug_destroy(att->debug_data);\n\n\tfree(att->local_sign);\n\tfree(att->remote_sign);\n\n\tfree(att->buf);\n\n\tfree(att);\n}"
        }
      },
      {
        "call_info": {
          "callee": "asprintf",
          "args": [
            "&tmp",
            "\"%s.%s\"",
            "menu->name",
            "cmd"
          ],
          "line": 667
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "find_cmd",
          "args": [
            "text + strlen(menu->name) + 1",
            "menu->entries",
            "&index"
          ],
          "line": 662
        },
        "resolved": true,
        "details": {
          "function_name": "find_cmd",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/shell.c",
          "lines": "596-618",
          "snippet": "static char *find_cmd(const char *text,\n\t\t\tconst struct bt_shell_menu_entry *entry, int *index)\n{\n\tconst struct bt_shell_menu_entry *tmp;\n\tint len;\n\n\tlen = strlen(text);\n\n\twhile ((tmp = &entry[*index])) {\n\t\t(*index)++;\n\n\t\tif (!tmp->cmd)\n\t\t\tbreak;\n\n\t\tif (tmp->exists && !tmp->exists(data.menu))\n\t\t\tcontinue;\n\n\t\tif (!strncmp(tmp->cmd, text, len))\n\t\t\treturn strdup(tmp->cmd);\n\t}\n\n\treturn NULL;\n}",
          "includes": [
            "#include \"src/shared/shell.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/mainloop.h\"",
            "#include <readline/history.h>",
            "#include <readline/readline.h>",
            "#include <getopt.h>",
            "#include <wordexp.h>",
            "#include <sys/signalfd.h>",
            "#include <signal.h>",
            "#include <stdbool.h>",
            "#include <stdarg.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/shell.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/mainloop.h\"\n#include <readline/history.h>\n#include <readline/readline.h>\n#include <getopt.h>\n#include <wordexp.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic char *find_cmd(const char *text,\n\t\t\tconst struct bt_shell_menu_entry *entry, int *index)\n{\n\tconst struct bt_shell_menu_entry *tmp;\n\tint len;\n\n\tlen = strlen(text);\n\n\twhile ((tmp = &entry[*index])) {\n\t\t(*index)++;\n\n\t\tif (!tmp->cmd)\n\t\t\tbreak;\n\n\t\tif (tmp->exists && !tmp->exists(data.menu))\n\t\t\tcontinue;\n\n\t\tif (!strncmp(tmp->cmd, text, len))\n\t\t\treturn strdup(tmp->cmd);\n\t}\n\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "menu->name"
          ],
          "line": 662
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "find_menu",
          "args": [
            "text",
            "cmd - text"
          ],
          "line": 654
        },
        "resolved": true,
        "details": {
          "function_name": "find_menu",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/shell.c",
          "lines": "107-120",
          "snippet": "static const struct bt_shell_menu *find_menu(const char *name, size_t len)\n{\n\tconst struct queue_entry *entry;\n\n\tfor (entry = queue_get_entries(data.submenus); entry;\n\t\t\t\t\t\tentry = entry->next) {\n\t\tstruct bt_shell_menu *menu = entry->data;\n\n\t\tif (!strncmp(menu->name, name, len))\n\t\t\treturn menu;\n\t}\n\n\treturn NULL;\n}",
          "includes": [
            "#include \"src/shared/shell.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/mainloop.h\"",
            "#include <readline/history.h>",
            "#include <readline/readline.h>",
            "#include <getopt.h>",
            "#include <wordexp.h>",
            "#include <sys/signalfd.h>",
            "#include <signal.h>",
            "#include <stdbool.h>",
            "#include <stdarg.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/shell.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/mainloop.h\"\n#include <readline/history.h>\n#include <readline/readline.h>\n#include <getopt.h>\n#include <wordexp.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic const struct bt_shell_menu *find_menu(const char *name, size_t len)\n{\n\tconst struct queue_entry *entry;\n\n\tfor (entry = queue_get_entries(data.submenus); entry;\n\t\t\t\t\t\tentry = entry->next) {\n\t\tstruct bt_shell_menu *menu = entry->data;\n\n\t\tif (!strncmp(menu->name, name, len))\n\t\t\treturn menu;\n\t}\n\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "strrchr",
          "args": [
            "text",
            "'.'"
          ],
          "line": 650
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/shell.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/mainloop.h\"\n#include <readline/history.h>\n#include <readline/readline.h>\n#include <getopt.h>\n#include <wordexp.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic const struct bt_shell_menu_entry default_menu[] = {\n\t{ \"back\",         NULL,       cmd_back, \"Return to main menu\", NULL,\n\t\t\t\t\t\t\tNULL, cmd_back_exists },\n\t{ \"menu\",         \"<name>\",   cmd_menu, \"Select submenu\",\n\t\t\t\t\t\t\tmenu_generator, NULL,\n\t\t\t\t\t\t\tcmd_menu_exists},\n\t{ \"version\",      NULL,       cmd_version, \"Display version\" },\n\t{ \"quit\",         NULL,       cmd_quit, \"Quit program\" },\n\t{ \"exit\",         NULL,       cmd_quit, \"Quit program\" },\n\t{ \"help\",         NULL,       cmd_help,\n\t\t\t\t\t\"Display help about this program\" },\n\t{ \"export\",       NULL,       cmd_export,\n\t\t\t\t\t\t\"Print evironment variables\" },\n\t{ }\n};\n\nstatic char *cmd_generator(const char *text, int state)\n{\n\tstatic int index;\n\tstatic bool default_menu_enabled, submenu_enabled;\n\tstatic const struct bt_shell_menu *menu;\n\tchar *cmd;\n\n\tif (!state) {\n\t\tindex = 0;\n\t\tmenu = NULL;\n\t\tdefault_menu_enabled = true;\n\t\tsubmenu_enabled = false;\n\t}\n\n\tif (default_menu_enabled) {\n\t\tcmd = find_cmd(text, default_menu, &index);\n\t\tif (cmd) {\n\t\t\treturn cmd;\n\t\t} else {\n\t\t\tindex = 0;\n\t\t\tmenu = data.menu;\n\t\t\tdefault_menu_enabled = false;\n\t\t}\n\t}\n\n\tif (!submenu_enabled) {\n\t\tcmd = find_cmd(text, menu->entries, &index);\n\t\tif (cmd || menu != data.main)\n\t\t\treturn cmd;\n\n\t\tcmd = strrchr(text, '.');\n\t\tif (!cmd)\n\t\t\treturn NULL;\n\n\t\tmenu = find_menu(text, cmd - text);\n\t\tif (!menu)\n\t\t\treturn NULL;\n\n\t\tindex = 0;\n\t\tsubmenu_enabled = true;\n\t}\n\n\tcmd = find_cmd(text + strlen(menu->name) + 1, menu->entries, &index);\n\tif (cmd) {\n\t\tint err;\n\t\tchar *tmp;\n\n\t\terr = asprintf(&tmp, \"%s.%s\", menu->name, cmd);\n\n\t\tfree(cmd);\n\n\t\tif (err < 0)\n\t\t\treturn NULL;\n\n\t\tcmd = tmp;\n\t}\n\n\treturn cmd;\n}"
  },
  {
    "function_name": "find_cmd",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/shell.c",
    "lines": "596-618",
    "snippet": "static char *find_cmd(const char *text,\n\t\t\tconst struct bt_shell_menu_entry *entry, int *index)\n{\n\tconst struct bt_shell_menu_entry *tmp;\n\tint len;\n\n\tlen = strlen(text);\n\n\twhile ((tmp = &entry[*index])) {\n\t\t(*index)++;\n\n\t\tif (!tmp->cmd)\n\t\t\tbreak;\n\n\t\tif (tmp->exists && !tmp->exists(data.menu))\n\t\t\tcontinue;\n\n\t\tif (!strncmp(tmp->cmd, text, len))\n\t\t\treturn strdup(tmp->cmd);\n\t}\n\n\treturn NULL;\n}",
    "includes": [
      "#include \"src/shared/shell.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/mainloop.h\"",
      "#include <readline/history.h>",
      "#include <readline/readline.h>",
      "#include <getopt.h>",
      "#include <wordexp.h>",
      "#include <sys/signalfd.h>",
      "#include <signal.h>",
      "#include <stdbool.h>",
      "#include <stdarg.h>",
      "#include <stdlib.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "strdup",
          "args": [
            "tmp->cmd"
          ],
          "line": 614
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strncmp",
          "args": [
            "tmp->cmd",
            "text",
            "len"
          ],
          "line": 613
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "tmp->exists",
          "args": [
            "data.menu"
          ],
          "line": 610
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "text"
          ],
          "line": 602
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/shell.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/mainloop.h\"\n#include <readline/history.h>\n#include <readline/readline.h>\n#include <getopt.h>\n#include <wordexp.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic char *find_cmd(const char *text,\n\t\t\tconst struct bt_shell_menu_entry *entry, int *index)\n{\n\tconst struct bt_shell_menu_entry *tmp;\n\tint len;\n\n\tlen = strlen(text);\n\n\twhile ((tmp = &entry[*index])) {\n\t\t(*index)++;\n\n\t\tif (!tmp->cmd)\n\t\t\tbreak;\n\n\t\tif (tmp->exists && !tmp->exists(data.menu))\n\t\t\tcontinue;\n\n\t\tif (!strncmp(tmp->cmd, text, len))\n\t\t\treturn strdup(tmp->cmd);\n\t}\n\n\treturn NULL;\n}"
  },
  {
    "function_name": "rl_handler",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/shell.c",
    "lines": "561-594",
    "snippet": "static void rl_handler(char *input)\n{\n\twordexp_t w;\n\n\tif (!input) {\n\t\trl_insert_text(\"quit\");\n\t\trl_redisplay();\n\t\trl_crlf();\n\t\tmainloop_quit();\n\t\treturn;\n\t}\n\n\tif (!strlen(input))\n\t\tgoto done;\n\n\tif (!bt_shell_release_prompt(input))\n\t\tgoto done;\n\n\tif (history_search(input, -1))\n\t\tadd_history(input);\n\n\tif (wordexp(input, &w, WRDE_NOCMD))\n\t\tgoto done;\n\n\tif (w.we_wordc == 0) {\n\t\twordfree(&w);\n\t\tgoto done;\n\t}\n\n\tshell_exec(w.we_wordc, w.we_wordv);\n\twordfree(&w);\ndone:\n\tfree(input);\n}",
    "includes": [
      "#include \"src/shared/shell.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/mainloop.h\"",
      "#include <readline/history.h>",
      "#include <readline/readline.h>",
      "#include <getopt.h>",
      "#include <wordexp.h>",
      "#include <sys/signalfd.h>",
      "#include <signal.h>",
      "#include <stdbool.h>",
      "#include <stdarg.h>",
      "#include <stdlib.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "input"
          ],
          "line": 593
        },
        "resolved": true,
        "details": {
          "function_name": "bt_att_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/att.c",
          "lines": "956-985",
          "snippet": "static void bt_att_free(struct bt_att *att)\n{\n\tif (att->pending_req)\n\t\tdestroy_att_send_op(att->pending_req);\n\n\tif (att->pending_ind)\n\t\tdestroy_att_send_op(att->pending_ind);\n\n\tio_destroy(att->io);\n\tbt_crypto_unref(att->crypto);\n\n\tqueue_destroy(att->req_queue, NULL);\n\tqueue_destroy(att->ind_queue, NULL);\n\tqueue_destroy(att->write_queue, NULL);\n\tqueue_destroy(att->notify_list, NULL);\n\tqueue_destroy(att->disconn_list, NULL);\n\n\tif (att->timeout_destroy)\n\t\tatt->timeout_destroy(att->timeout_data);\n\n\tif (att->debug_destroy)\n\t\tatt->debug_destroy(att->debug_data);\n\n\tfree(att->local_sign);\n\tfree(att->remote_sign);\n\n\tfree(att->buf);\n\n\tfree(att);\n}",
          "includes": [
            "#include \"src/shared/crypto.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/l2cap.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/crypto.h\"\n#include \"src/shared/att.h\"\n#include \"lib/uuid.h\"\n#include \"lib/l2cap.h\"\n#include \"lib/bluetooth.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include <errno.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <config.h>\n\nstatic void bt_att_free(struct bt_att *att)\n{\n\tif (att->pending_req)\n\t\tdestroy_att_send_op(att->pending_req);\n\n\tif (att->pending_ind)\n\t\tdestroy_att_send_op(att->pending_ind);\n\n\tio_destroy(att->io);\n\tbt_crypto_unref(att->crypto);\n\n\tqueue_destroy(att->req_queue, NULL);\n\tqueue_destroy(att->ind_queue, NULL);\n\tqueue_destroy(att->write_queue, NULL);\n\tqueue_destroy(att->notify_list, NULL);\n\tqueue_destroy(att->disconn_list, NULL);\n\n\tif (att->timeout_destroy)\n\t\tatt->timeout_destroy(att->timeout_data);\n\n\tif (att->debug_destroy)\n\t\tatt->debug_destroy(att->debug_data);\n\n\tfree(att->local_sign);\n\tfree(att->remote_sign);\n\n\tfree(att->buf);\n\n\tfree(att);\n}"
        }
      },
      {
        "call_info": {
          "callee": "wordfree",
          "args": [
            "&w"
          ],
          "line": 591
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "shell_exec",
          "args": [
            "w.we_wordc",
            "w.we_wordv"
          ],
          "line": 590
        },
        "resolved": true,
        "details": {
          "function_name": "shell_exec",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/shell.c",
          "lines": "434-456",
          "snippet": "static int shell_exec(int argc, char *argv[])\n{\n\tint err;\n\n\tif (!data.menu || !argv[0])\n\t\treturn -EINVAL;\n\n\terr  = menu_exec(default_menu, argc, argv);\n\tif (err == -ENOENT) {\n\t\terr  = menu_exec(data.menu->entries, argc, argv);\n\t\tif (err == -ENOENT) {\n\t\t\terr = submenu_exec(argc, argv);\n\t\t\tif (err == -ENOENT) {\n\t\t\t\tprint_text(COLOR_HIGHLIGHT,\n\t\t\t\t\t\"Invalid command in menu %s: %s\",\n\t\t\t\t\tdata.menu->name , argv[0]);\n\t\t\t\tshell_print_help();\n\t\t\t}\n\t\t}\n\t}\n\n\treturn err;\n}",
          "includes": [
            "#include \"src/shared/shell.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/mainloop.h\"",
            "#include <readline/history.h>",
            "#include <readline/readline.h>",
            "#include <getopt.h>",
            "#include <wordexp.h>",
            "#include <sys/signalfd.h>",
            "#include <signal.h>",
            "#include <stdbool.h>",
            "#include <stdarg.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static const struct bt_shell_menu_entry default_menu[] = {\n\t{ \"back\",         NULL,       cmd_back, \"Return to main menu\", NULL,\n\t\t\t\t\t\t\tNULL, cmd_back_exists },\n\t{ \"menu\",         \"<name>\",   cmd_menu, \"Select submenu\",\n\t\t\t\t\t\t\tmenu_generator, NULL,\n\t\t\t\t\t\t\tcmd_menu_exists},\n\t{ \"version\",      NULL,       cmd_version, \"Display version\" },\n\t{ \"quit\",         NULL,       cmd_quit, \"Quit program\" },\n\t{ \"exit\",         NULL,       cmd_quit, \"Quit program\" },\n\t{ \"help\",         NULL,       cmd_help,\n\t\t\t\t\t\"Display help about this program\" },\n\t{ \"export\",       NULL,       cmd_export,\n\t\t\t\t\t\t\"Print evironment variables\" },\n\t{ }\n};"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/shell.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/mainloop.h\"\n#include <readline/history.h>\n#include <readline/readline.h>\n#include <getopt.h>\n#include <wordexp.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic const struct bt_shell_menu_entry default_menu[] = {\n\t{ \"back\",         NULL,       cmd_back, \"Return to main menu\", NULL,\n\t\t\t\t\t\t\tNULL, cmd_back_exists },\n\t{ \"menu\",         \"<name>\",   cmd_menu, \"Select submenu\",\n\t\t\t\t\t\t\tmenu_generator, NULL,\n\t\t\t\t\t\t\tcmd_menu_exists},\n\t{ \"version\",      NULL,       cmd_version, \"Display version\" },\n\t{ \"quit\",         NULL,       cmd_quit, \"Quit program\" },\n\t{ \"exit\",         NULL,       cmd_quit, \"Quit program\" },\n\t{ \"help\",         NULL,       cmd_help,\n\t\t\t\t\t\"Display help about this program\" },\n\t{ \"export\",       NULL,       cmd_export,\n\t\t\t\t\t\t\"Print evironment variables\" },\n\t{ }\n};\n\nstatic int shell_exec(int argc, char *argv[])\n{\n\tint err;\n\n\tif (!data.menu || !argv[0])\n\t\treturn -EINVAL;\n\n\terr  = menu_exec(default_menu, argc, argv);\n\tif (err == -ENOENT) {\n\t\terr  = menu_exec(data.menu->entries, argc, argv);\n\t\tif (err == -ENOENT) {\n\t\t\terr = submenu_exec(argc, argv);\n\t\t\tif (err == -ENOENT) {\n\t\t\t\tprint_text(COLOR_HIGHLIGHT,\n\t\t\t\t\t\"Invalid command in menu %s: %s\",\n\t\t\t\t\tdata.menu->name , argv[0]);\n\t\t\t\tshell_print_help();\n\t\t\t}\n\t\t}\n\t}\n\n\treturn err;\n}"
        }
      },
      {
        "call_info": {
          "callee": "wordfree",
          "args": [
            "&w"
          ],
          "line": 586
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "wordexp",
          "args": [
            "input",
            "&w",
            "WRDE_NOCMD"
          ],
          "line": 582
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "add_history",
          "args": [
            "input"
          ],
          "line": 580
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "history_search",
          "args": [
            "input",
            "-1"
          ],
          "line": 579
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bt_shell_release_prompt",
          "args": [
            "input"
          ],
          "line": 576
        },
        "resolved": true,
        "details": {
          "function_name": "bt_shell_release_prompt",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/shell.c",
          "lines": "538-559",
          "snippet": "int bt_shell_release_prompt(const char *input)\n{\n\tbt_shell_prompt_input_func func;\n\tvoid *user_data;\n\n\tif (!data.saved_prompt)\n\t\treturn -1;\n\n\tdata.saved_prompt = false;\n\n\trl_restore_prompt();\n\n\tfunc = data.saved_func;\n\tuser_data = data.saved_user_data;\n\n\tdata.saved_func = NULL;\n\tdata.saved_user_data = NULL;\n\n\tfunc(input, user_data);\n\n\treturn 0;\n}",
          "includes": [
            "#include \"src/shared/shell.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/mainloop.h\"",
            "#include <readline/history.h>",
            "#include <readline/readline.h>",
            "#include <getopt.h>",
            "#include <wordexp.h>",
            "#include <sys/signalfd.h>",
            "#include <signal.h>",
            "#include <stdbool.h>",
            "#include <stdarg.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/shell.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/mainloop.h\"\n#include <readline/history.h>\n#include <readline/readline.h>\n#include <getopt.h>\n#include <wordexp.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nint bt_shell_release_prompt(const char *input)\n{\n\tbt_shell_prompt_input_func func;\n\tvoid *user_data;\n\n\tif (!data.saved_prompt)\n\t\treturn -1;\n\n\tdata.saved_prompt = false;\n\n\trl_restore_prompt();\n\n\tfunc = data.saved_func;\n\tuser_data = data.saved_user_data;\n\n\tdata.saved_func = NULL;\n\tdata.saved_user_data = NULL;\n\n\tfunc(input, user_data);\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "input"
          ],
          "line": 573
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "mainloop_quit",
          "args": [],
          "line": 569
        },
        "resolved": true,
        "details": {
          "function_name": "mainloop_quit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/mainloop.c",
          "lines": "88-91",
          "snippet": "void mainloop_quit(void)\n{\n\tepoll_terminate = 1;\n}",
          "includes": [
            "#include \"mainloop.h\"",
            "#include <sys/epoll.h>",
            "#include <sys/timerfd.h>",
            "#include <sys/signalfd.h>",
            "#include <signal.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int epoll_terminate;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"mainloop.h\"\n#include <sys/epoll.h>\n#include <sys/timerfd.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <string.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic int epoll_terminate;\n\nvoid mainloop_quit(void)\n{\n\tepoll_terminate = 1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "rl_crlf",
          "args": [],
          "line": 568
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rl_redisplay",
          "args": [],
          "line": 567
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rl_insert_text",
          "args": [
            "\"quit\""
          ],
          "line": 566
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/shell.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/mainloop.h\"\n#include <readline/history.h>\n#include <readline/readline.h>\n#include <getopt.h>\n#include <wordexp.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void rl_handler(char *input)\n{\n\twordexp_t w;\n\n\tif (!input) {\n\t\trl_insert_text(\"quit\");\n\t\trl_redisplay();\n\t\trl_crlf();\n\t\tmainloop_quit();\n\t\treturn;\n\t}\n\n\tif (!strlen(input))\n\t\tgoto done;\n\n\tif (!bt_shell_release_prompt(input))\n\t\tgoto done;\n\n\tif (history_search(input, -1))\n\t\tadd_history(input);\n\n\tif (wordexp(input, &w, WRDE_NOCMD))\n\t\tgoto done;\n\n\tif (w.we_wordc == 0) {\n\t\twordfree(&w);\n\t\tgoto done;\n\t}\n\n\tshell_exec(w.we_wordc, w.we_wordv);\n\twordfree(&w);\ndone:\n\tfree(input);\n}"
  },
  {
    "function_name": "bt_shell_release_prompt",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/shell.c",
    "lines": "538-559",
    "snippet": "int bt_shell_release_prompt(const char *input)\n{\n\tbt_shell_prompt_input_func func;\n\tvoid *user_data;\n\n\tif (!data.saved_prompt)\n\t\treturn -1;\n\n\tdata.saved_prompt = false;\n\n\trl_restore_prompt();\n\n\tfunc = data.saved_func;\n\tuser_data = data.saved_user_data;\n\n\tdata.saved_func = NULL;\n\tdata.saved_user_data = NULL;\n\n\tfunc(input, user_data);\n\n\treturn 0;\n}",
    "includes": [
      "#include \"src/shared/shell.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/mainloop.h\"",
      "#include <readline/history.h>",
      "#include <readline/readline.h>",
      "#include <getopt.h>",
      "#include <wordexp.h>",
      "#include <sys/signalfd.h>",
      "#include <signal.h>",
      "#include <stdbool.h>",
      "#include <stdarg.h>",
      "#include <stdlib.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "func",
          "args": [
            "input",
            "user_data"
          ],
          "line": 556
        },
        "resolved": true,
        "details": {
          "function_name": "convert_raw_attr_to_xml_func",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/sdp-xml.c",
          "lines": "977-991",
          "snippet": "static void convert_raw_attr_to_xml_func(void *val, void *data)\n{\n\tstruct conversion_data *cd = data;\n\tsdp_data_t *value = val;\n\tchar buf[STRBUFSIZE];\n\n\tbuf[STRBUFSIZE - 1] = '\\0';\n\tsnprintf(buf, STRBUFSIZE - 1, \"\\t<attribute id=\\\"0x%04x\\\">\\n\",\n\t\t value->attrId);\n\tcd->appender(cd->data, buf);\n\n\tconvert_raw_data_to_xml(value, 2, cd->data, cd->appender);\n\n\tcd->appender(cd->data, \"\\t</attribute>\\n\");\n}",
          "includes": [
            "#include \"sdp-xml.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include <glib.h>",
            "#include <stdlib.h>",
            "#include <limits.h>",
            "#include <string.h>",
            "#include <ctype.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define STRBUFSIZE 1024"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sdp-xml.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include <glib.h>\n#include <stdlib.h>\n#include <limits.h>\n#include <string.h>\n#include <ctype.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\n#define STRBUFSIZE 1024\n\nstatic void convert_raw_attr_to_xml_func(void *val, void *data)\n{\n\tstruct conversion_data *cd = data;\n\tsdp_data_t *value = val;\n\tchar buf[STRBUFSIZE];\n\n\tbuf[STRBUFSIZE - 1] = '\\0';\n\tsnprintf(buf, STRBUFSIZE - 1, \"\\t<attribute id=\\\"0x%04x\\\">\\n\",\n\t\t value->attrId);\n\tcd->appender(cd->data, buf);\n\n\tconvert_raw_data_to_xml(value, 2, cd->data, cd->appender);\n\n\tcd->appender(cd->data, \"\\t</attribute>\\n\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "rl_restore_prompt",
          "args": [],
          "line": 548
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/shell.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/mainloop.h\"\n#include <readline/history.h>\n#include <readline/readline.h>\n#include <getopt.h>\n#include <wordexp.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nint bt_shell_release_prompt(const char *input)\n{\n\tbt_shell_prompt_input_func func;\n\tvoid *user_data;\n\n\tif (!data.saved_prompt)\n\t\treturn -1;\n\n\tdata.saved_prompt = false;\n\n\trl_restore_prompt();\n\n\tfunc = data.saved_func;\n\tuser_data = data.saved_user_data;\n\n\tdata.saved_func = NULL;\n\tdata.saved_user_data = NULL;\n\n\tfunc(input, user_data);\n\n\treturn 0;\n}"
  },
  {
    "function_name": "bt_shell_prompt_input",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/shell.c",
    "lines": "519-536",
    "snippet": "void bt_shell_prompt_input(const char *label, const char *msg,\n\t\t\tbt_shell_prompt_input_func func, void *user_data)\n{\n\tif (!data.init || data.mode)\n\t\treturn;\n\n\t/* Normal use should not prompt for user input to the value a second\n\t * time before it releases the prompt, but we take a safe action. */\n\tif (data.saved_prompt)\n\t\treturn;\n\n\tdata.saved_prompt = true;\n\tdata.saved_func = func;\n\tdata.saved_user_data = user_data;\n\n\trl_save_prompt();\n\tbt_shell_printf(COLOR_RED \"[%s]\" COLOR_OFF \" %s \", label, msg);\n}",
    "includes": [
      "#include \"src/shared/shell.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/mainloop.h\"",
      "#include <readline/history.h>",
      "#include <readline/readline.h>",
      "#include <getopt.h>",
      "#include <wordexp.h>",
      "#include <sys/signalfd.h>",
      "#include <signal.h>",
      "#include <stdbool.h>",
      "#include <stdarg.h>",
      "#include <stdlib.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "bt_shell_printf",
          "args": [
            "COLOR_RED \"[%s]\" COLOR_OFF \" %s \"",
            "label",
            "msg"
          ],
          "line": 535
        },
        "resolved": true,
        "details": {
          "function_name": "bt_shell_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/shell.c",
          "lines": "458-498",
          "snippet": "void bt_shell_printf(const char *fmt, ...)\n{\n\tva_list args;\n\tbool save_input;\n\tchar *saved_line;\n\tint saved_point;\n\n\tif (!data.input)\n\t\treturn;\n\n\tif (data.mode) {\n\t\tva_start(args, fmt);\n\t\tvprintf(fmt, args);\n\t\tva_end(args);\n\t\treturn;\n\t}\n\n\tsave_input = !RL_ISSTATE(RL_STATE_DONE);\n\n\tif (save_input) {\n\t\tsaved_point = rl_point;\n\t\tsaved_line = rl_copy_text(0, rl_end);\n\t\tif (!data.saved_prompt)\n\t\t\trl_save_prompt();\n\t\trl_replace_line(\"\", 0);\n\t\trl_redisplay();\n\t}\n\n\tva_start(args, fmt);\n\tvprintf(fmt, args);\n\tva_end(args);\n\n\tif (save_input) {\n\t\tif (!data.saved_prompt)\n\t\t\trl_restore_prompt();\n\t\trl_replace_line(saved_line, 0);\n\t\trl_point = saved_point;\n\t\trl_forced_update_display();\n\t\tfree(saved_line);\n\t}\n}",
          "includes": [
            "#include \"src/shared/shell.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/mainloop.h\"",
            "#include <readline/history.h>",
            "#include <readline/readline.h>",
            "#include <getopt.h>",
            "#include <wordexp.h>",
            "#include <sys/signalfd.h>",
            "#include <signal.h>",
            "#include <stdbool.h>",
            "#include <stdarg.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static wordexp_t args;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/shell.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/mainloop.h\"\n#include <readline/history.h>\n#include <readline/readline.h>\n#include <getopt.h>\n#include <wordexp.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic wordexp_t args;\n\nvoid bt_shell_printf(const char *fmt, ...)\n{\n\tva_list args;\n\tbool save_input;\n\tchar *saved_line;\n\tint saved_point;\n\n\tif (!data.input)\n\t\treturn;\n\n\tif (data.mode) {\n\t\tva_start(args, fmt);\n\t\tvprintf(fmt, args);\n\t\tva_end(args);\n\t\treturn;\n\t}\n\n\tsave_input = !RL_ISSTATE(RL_STATE_DONE);\n\n\tif (save_input) {\n\t\tsaved_point = rl_point;\n\t\tsaved_line = rl_copy_text(0, rl_end);\n\t\tif (!data.saved_prompt)\n\t\t\trl_save_prompt();\n\t\trl_replace_line(\"\", 0);\n\t\trl_redisplay();\n\t}\n\n\tva_start(args, fmt);\n\tvprintf(fmt, args);\n\tva_end(args);\n\n\tif (save_input) {\n\t\tif (!data.saved_prompt)\n\t\t\trl_restore_prompt();\n\t\trl_replace_line(saved_line, 0);\n\t\trl_point = saved_point;\n\t\trl_forced_update_display();\n\t\tfree(saved_line);\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "rl_save_prompt",
          "args": [],
          "line": 534
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/shell.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/mainloop.h\"\n#include <readline/history.h>\n#include <readline/readline.h>\n#include <getopt.h>\n#include <wordexp.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nvoid bt_shell_prompt_input(const char *label, const char *msg,\n\t\t\tbt_shell_prompt_input_func func, void *user_data)\n{\n\tif (!data.init || data.mode)\n\t\treturn;\n\n\t/* Normal use should not prompt for user input to the value a second\n\t * time before it releases the prompt, but we take a safe action. */\n\tif (data.saved_prompt)\n\t\treturn;\n\n\tdata.saved_prompt = true;\n\tdata.saved_func = func;\n\tdata.saved_user_data = user_data;\n\n\trl_save_prompt();\n\tbt_shell_printf(COLOR_RED \"[%s]\" COLOR_OFF \" %s \", label, msg);\n}"
  },
  {
    "function_name": "bt_shell_usage",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/shell.c",
    "lines": "510-517",
    "snippet": "void bt_shell_usage()\n{\n\tif (!data.exec)\n\t\treturn;\n\n\tbt_shell_printf(\"Usage: %s %s\\n\", data.exec->cmd,\n\t\t\t\t\tdata.exec->arg ? data.exec->arg : \"\");\n}",
    "includes": [
      "#include \"src/shared/shell.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/mainloop.h\"",
      "#include <readline/history.h>",
      "#include <readline/readline.h>",
      "#include <getopt.h>",
      "#include <wordexp.h>",
      "#include <sys/signalfd.h>",
      "#include <signal.h>",
      "#include <stdbool.h>",
      "#include <stdarg.h>",
      "#include <stdlib.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "bt_shell_printf",
          "args": [
            "\"Usage: %s %s\\n\"",
            "data.exec->cmd",
            "data.exec->arg ? data.exec->arg : \"\""
          ],
          "line": 515
        },
        "resolved": true,
        "details": {
          "function_name": "bt_shell_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/shell.c",
          "lines": "458-498",
          "snippet": "void bt_shell_printf(const char *fmt, ...)\n{\n\tva_list args;\n\tbool save_input;\n\tchar *saved_line;\n\tint saved_point;\n\n\tif (!data.input)\n\t\treturn;\n\n\tif (data.mode) {\n\t\tva_start(args, fmt);\n\t\tvprintf(fmt, args);\n\t\tva_end(args);\n\t\treturn;\n\t}\n\n\tsave_input = !RL_ISSTATE(RL_STATE_DONE);\n\n\tif (save_input) {\n\t\tsaved_point = rl_point;\n\t\tsaved_line = rl_copy_text(0, rl_end);\n\t\tif (!data.saved_prompt)\n\t\t\trl_save_prompt();\n\t\trl_replace_line(\"\", 0);\n\t\trl_redisplay();\n\t}\n\n\tva_start(args, fmt);\n\tvprintf(fmt, args);\n\tva_end(args);\n\n\tif (save_input) {\n\t\tif (!data.saved_prompt)\n\t\t\trl_restore_prompt();\n\t\trl_replace_line(saved_line, 0);\n\t\trl_point = saved_point;\n\t\trl_forced_update_display();\n\t\tfree(saved_line);\n\t}\n}",
          "includes": [
            "#include \"src/shared/shell.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/mainloop.h\"",
            "#include <readline/history.h>",
            "#include <readline/readline.h>",
            "#include <getopt.h>",
            "#include <wordexp.h>",
            "#include <sys/signalfd.h>",
            "#include <signal.h>",
            "#include <stdbool.h>",
            "#include <stdarg.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static wordexp_t args;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/shell.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/mainloop.h\"\n#include <readline/history.h>\n#include <readline/readline.h>\n#include <getopt.h>\n#include <wordexp.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic wordexp_t args;\n\nvoid bt_shell_printf(const char *fmt, ...)\n{\n\tva_list args;\n\tbool save_input;\n\tchar *saved_line;\n\tint saved_point;\n\n\tif (!data.input)\n\t\treturn;\n\n\tif (data.mode) {\n\t\tva_start(args, fmt);\n\t\tvprintf(fmt, args);\n\t\tva_end(args);\n\t\treturn;\n\t}\n\n\tsave_input = !RL_ISSTATE(RL_STATE_DONE);\n\n\tif (save_input) {\n\t\tsaved_point = rl_point;\n\t\tsaved_line = rl_copy_text(0, rl_end);\n\t\tif (!data.saved_prompt)\n\t\t\trl_save_prompt();\n\t\trl_replace_line(\"\", 0);\n\t\trl_redisplay();\n\t}\n\n\tva_start(args, fmt);\n\tvprintf(fmt, args);\n\tva_end(args);\n\n\tif (save_input) {\n\t\tif (!data.saved_prompt)\n\t\t\trl_restore_prompt();\n\t\trl_replace_line(saved_line, 0);\n\t\trl_point = saved_point;\n\t\trl_forced_update_display();\n\t\tfree(saved_line);\n\t}\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/shell.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/mainloop.h\"\n#include <readline/history.h>\n#include <readline/readline.h>\n#include <getopt.h>\n#include <wordexp.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nvoid bt_shell_usage()\n{\n\tif (!data.exec)\n\t\treturn;\n\n\tbt_shell_printf(\"Usage: %s %s\\n\", data.exec->cmd,\n\t\t\t\t\tdata.exec->arg ? data.exec->arg : \"\");\n}"
  },
  {
    "function_name": "bt_shell_hexdump",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/shell.c",
    "lines": "505-508",
    "snippet": "void bt_shell_hexdump(const unsigned char *buf, size_t len)\n{\n\tutil_hexdump(' ', buf, len, print_string, NULL);\n}",
    "includes": [
      "#include \"src/shared/shell.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/mainloop.h\"",
      "#include <readline/history.h>",
      "#include <readline/readline.h>",
      "#include <getopt.h>",
      "#include <wordexp.h>",
      "#include <sys/signalfd.h>",
      "#include <signal.h>",
      "#include <stdbool.h>",
      "#include <stdarg.h>",
      "#include <stdlib.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "util_hexdump",
          "args": [
            "' '",
            "buf",
            "len",
            "print_string",
            "NULL"
          ],
          "line": 507
        },
        "resolved": true,
        "details": {
          "function_name": "util_hexdump",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/util.c",
          "lines": "73-113",
          "snippet": "void util_hexdump(const char dir, const unsigned char *buf, size_t len,\n\t\t\t\tutil_debug_func_t function, void *user_data)\n{\n\tstatic const char hexdigits[] = \"0123456789abcdef\";\n\tchar str[68];\n\tsize_t i;\n\n\tif (!function || !len)\n\t\treturn;\n\n\tstr[0] = dir;\n\n\tfor (i = 0; i < len; i++) {\n\t\tstr[((i % 16) * 3) + 1] = ' ';\n\t\tstr[((i % 16) * 3) + 2] = hexdigits[buf[i] >> 4];\n\t\tstr[((i % 16) * 3) + 3] = hexdigits[buf[i] & 0xf];\n\t\tstr[(i % 16) + 51] = isprint(buf[i]) ? buf[i] : '.';\n\n\t\tif ((i + 1) % 16 == 0) {\n\t\t\tstr[49] = ' ';\n\t\t\tstr[50] = ' ';\n\t\t\tstr[67] = '\\0';\n\t\t\tfunction(str, user_data);\n\t\t\tstr[0] = ' ';\n\t\t}\n\t}\n\n\tif (i % 16 > 0) {\n\t\tsize_t j;\n\t\tfor (j = (i % 16); j < 16; j++) {\n\t\t\tstr[(j * 3) + 1] = ' ';\n\t\t\tstr[(j * 3) + 2] = ' ';\n\t\t\tstr[(j * 3) + 3] = ' ';\n\t\t\tstr[j + 51] = ' ';\n\t\t}\n\t\tstr[49] = ' ';\n\t\tstr[50] = ' ';\n\t\tstr[67] = '\\0';\n\t\tfunction(str, user_data);\n\t}\n}",
          "includes": [
            "#include \"src/shared/util.h\"",
            "#include <string.h>",
            "#include <limits.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <stdbool.h>",
            "#include <stdarg.h>",
            "#include <ctype.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/util.h\"\n#include <string.h>\n#include <limits.h>\n#include <dirent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <config.h>\n\nvoid util_hexdump(const char dir, const unsigned char *buf, size_t len,\n\t\t\t\tutil_debug_func_t function, void *user_data)\n{\n\tstatic const char hexdigits[] = \"0123456789abcdef\";\n\tchar str[68];\n\tsize_t i;\n\n\tif (!function || !len)\n\t\treturn;\n\n\tstr[0] = dir;\n\n\tfor (i = 0; i < len; i++) {\n\t\tstr[((i % 16) * 3) + 1] = ' ';\n\t\tstr[((i % 16) * 3) + 2] = hexdigits[buf[i] >> 4];\n\t\tstr[((i % 16) * 3) + 3] = hexdigits[buf[i] & 0xf];\n\t\tstr[(i % 16) + 51] = isprint(buf[i]) ? buf[i] : '.';\n\n\t\tif ((i + 1) % 16 == 0) {\n\t\t\tstr[49] = ' ';\n\t\t\tstr[50] = ' ';\n\t\t\tstr[67] = '\\0';\n\t\t\tfunction(str, user_data);\n\t\t\tstr[0] = ' ';\n\t\t}\n\t}\n\n\tif (i % 16 > 0) {\n\t\tsize_t j;\n\t\tfor (j = (i % 16); j < 16; j++) {\n\t\t\tstr[(j * 3) + 1] = ' ';\n\t\t\tstr[(j * 3) + 2] = ' ';\n\t\t\tstr[(j * 3) + 3] = ' ';\n\t\t\tstr[j + 51] = ' ';\n\t\t}\n\t\tstr[49] = ' ';\n\t\tstr[50] = ' ';\n\t\tstr[67] = '\\0';\n\t\tfunction(str, user_data);\n\t}\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/shell.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/mainloop.h\"\n#include <readline/history.h>\n#include <readline/readline.h>\n#include <getopt.h>\n#include <wordexp.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nvoid bt_shell_hexdump(const unsigned char *buf, size_t len)\n{\n\tutil_hexdump(' ', buf, len, print_string, NULL);\n}"
  },
  {
    "function_name": "print_string",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/shell.c",
    "lines": "500-503",
    "snippet": "static void print_string(const char *str, void *user_data)\n{\n\tbt_shell_printf(\"%s\\n\", str);\n}",
    "includes": [
      "#include \"src/shared/shell.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/mainloop.h\"",
      "#include <readline/history.h>",
      "#include <readline/readline.h>",
      "#include <getopt.h>",
      "#include <wordexp.h>",
      "#include <sys/signalfd.h>",
      "#include <signal.h>",
      "#include <stdbool.h>",
      "#include <stdarg.h>",
      "#include <stdlib.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "bt_shell_printf",
          "args": [
            "\"%s\\n\"",
            "str"
          ],
          "line": 502
        },
        "resolved": true,
        "details": {
          "function_name": "bt_shell_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/shell.c",
          "lines": "458-498",
          "snippet": "void bt_shell_printf(const char *fmt, ...)\n{\n\tva_list args;\n\tbool save_input;\n\tchar *saved_line;\n\tint saved_point;\n\n\tif (!data.input)\n\t\treturn;\n\n\tif (data.mode) {\n\t\tva_start(args, fmt);\n\t\tvprintf(fmt, args);\n\t\tva_end(args);\n\t\treturn;\n\t}\n\n\tsave_input = !RL_ISSTATE(RL_STATE_DONE);\n\n\tif (save_input) {\n\t\tsaved_point = rl_point;\n\t\tsaved_line = rl_copy_text(0, rl_end);\n\t\tif (!data.saved_prompt)\n\t\t\trl_save_prompt();\n\t\trl_replace_line(\"\", 0);\n\t\trl_redisplay();\n\t}\n\n\tva_start(args, fmt);\n\tvprintf(fmt, args);\n\tva_end(args);\n\n\tif (save_input) {\n\t\tif (!data.saved_prompt)\n\t\t\trl_restore_prompt();\n\t\trl_replace_line(saved_line, 0);\n\t\trl_point = saved_point;\n\t\trl_forced_update_display();\n\t\tfree(saved_line);\n\t}\n}",
          "includes": [
            "#include \"src/shared/shell.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/mainloop.h\"",
            "#include <readline/history.h>",
            "#include <readline/readline.h>",
            "#include <getopt.h>",
            "#include <wordexp.h>",
            "#include <sys/signalfd.h>",
            "#include <signal.h>",
            "#include <stdbool.h>",
            "#include <stdarg.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static wordexp_t args;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/shell.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/mainloop.h\"\n#include <readline/history.h>\n#include <readline/readline.h>\n#include <getopt.h>\n#include <wordexp.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic wordexp_t args;\n\nvoid bt_shell_printf(const char *fmt, ...)\n{\n\tva_list args;\n\tbool save_input;\n\tchar *saved_line;\n\tint saved_point;\n\n\tif (!data.input)\n\t\treturn;\n\n\tif (data.mode) {\n\t\tva_start(args, fmt);\n\t\tvprintf(fmt, args);\n\t\tva_end(args);\n\t\treturn;\n\t}\n\n\tsave_input = !RL_ISSTATE(RL_STATE_DONE);\n\n\tif (save_input) {\n\t\tsaved_point = rl_point;\n\t\tsaved_line = rl_copy_text(0, rl_end);\n\t\tif (!data.saved_prompt)\n\t\t\trl_save_prompt();\n\t\trl_replace_line(\"\", 0);\n\t\trl_redisplay();\n\t}\n\n\tva_start(args, fmt);\n\tvprintf(fmt, args);\n\tva_end(args);\n\n\tif (save_input) {\n\t\tif (!data.saved_prompt)\n\t\t\trl_restore_prompt();\n\t\trl_replace_line(saved_line, 0);\n\t\trl_point = saved_point;\n\t\trl_forced_update_display();\n\t\tfree(saved_line);\n\t}\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/shell.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/mainloop.h\"\n#include <readline/history.h>\n#include <readline/readline.h>\n#include <getopt.h>\n#include <wordexp.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void print_string(const char *str, void *user_data)\n{\n\tbt_shell_printf(\"%s\\n\", str);\n}"
  },
  {
    "function_name": "bt_shell_printf",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/shell.c",
    "lines": "458-498",
    "snippet": "void bt_shell_printf(const char *fmt, ...)\n{\n\tva_list args;\n\tbool save_input;\n\tchar *saved_line;\n\tint saved_point;\n\n\tif (!data.input)\n\t\treturn;\n\n\tif (data.mode) {\n\t\tva_start(args, fmt);\n\t\tvprintf(fmt, args);\n\t\tva_end(args);\n\t\treturn;\n\t}\n\n\tsave_input = !RL_ISSTATE(RL_STATE_DONE);\n\n\tif (save_input) {\n\t\tsaved_point = rl_point;\n\t\tsaved_line = rl_copy_text(0, rl_end);\n\t\tif (!data.saved_prompt)\n\t\t\trl_save_prompt();\n\t\trl_replace_line(\"\", 0);\n\t\trl_redisplay();\n\t}\n\n\tva_start(args, fmt);\n\tvprintf(fmt, args);\n\tva_end(args);\n\n\tif (save_input) {\n\t\tif (!data.saved_prompt)\n\t\t\trl_restore_prompt();\n\t\trl_replace_line(saved_line, 0);\n\t\trl_point = saved_point;\n\t\trl_forced_update_display();\n\t\tfree(saved_line);\n\t}\n}",
    "includes": [
      "#include \"src/shared/shell.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/mainloop.h\"",
      "#include <readline/history.h>",
      "#include <readline/readline.h>",
      "#include <getopt.h>",
      "#include <wordexp.h>",
      "#include <sys/signalfd.h>",
      "#include <signal.h>",
      "#include <stdbool.h>",
      "#include <stdarg.h>",
      "#include <stdlib.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static wordexp_t args;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "saved_line"
          ],
          "line": 496
        },
        "resolved": true,
        "details": {
          "function_name": "bt_att_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/att.c",
          "lines": "956-985",
          "snippet": "static void bt_att_free(struct bt_att *att)\n{\n\tif (att->pending_req)\n\t\tdestroy_att_send_op(att->pending_req);\n\n\tif (att->pending_ind)\n\t\tdestroy_att_send_op(att->pending_ind);\n\n\tio_destroy(att->io);\n\tbt_crypto_unref(att->crypto);\n\n\tqueue_destroy(att->req_queue, NULL);\n\tqueue_destroy(att->ind_queue, NULL);\n\tqueue_destroy(att->write_queue, NULL);\n\tqueue_destroy(att->notify_list, NULL);\n\tqueue_destroy(att->disconn_list, NULL);\n\n\tif (att->timeout_destroy)\n\t\tatt->timeout_destroy(att->timeout_data);\n\n\tif (att->debug_destroy)\n\t\tatt->debug_destroy(att->debug_data);\n\n\tfree(att->local_sign);\n\tfree(att->remote_sign);\n\n\tfree(att->buf);\n\n\tfree(att);\n}",
          "includes": [
            "#include \"src/shared/crypto.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/l2cap.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/crypto.h\"\n#include \"src/shared/att.h\"\n#include \"lib/uuid.h\"\n#include \"lib/l2cap.h\"\n#include \"lib/bluetooth.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include <errno.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <config.h>\n\nstatic void bt_att_free(struct bt_att *att)\n{\n\tif (att->pending_req)\n\t\tdestroy_att_send_op(att->pending_req);\n\n\tif (att->pending_ind)\n\t\tdestroy_att_send_op(att->pending_ind);\n\n\tio_destroy(att->io);\n\tbt_crypto_unref(att->crypto);\n\n\tqueue_destroy(att->req_queue, NULL);\n\tqueue_destroy(att->ind_queue, NULL);\n\tqueue_destroy(att->write_queue, NULL);\n\tqueue_destroy(att->notify_list, NULL);\n\tqueue_destroy(att->disconn_list, NULL);\n\n\tif (att->timeout_destroy)\n\t\tatt->timeout_destroy(att->timeout_data);\n\n\tif (att->debug_destroy)\n\t\tatt->debug_destroy(att->debug_data);\n\n\tfree(att->local_sign);\n\tfree(att->remote_sign);\n\n\tfree(att->buf);\n\n\tfree(att);\n}"
        }
      },
      {
        "call_info": {
          "callee": "rl_forced_update_display",
          "args": [],
          "line": 495
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rl_replace_line",
          "args": [
            "saved_line",
            "0"
          ],
          "line": 493
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rl_restore_prompt",
          "args": [],
          "line": 492
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "va_end",
          "args": [
            "args"
          ],
          "line": 488
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "vprintf",
          "args": [
            "fmt",
            "args"
          ],
          "line": 487
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "va_start",
          "args": [
            "args",
            "fmt"
          ],
          "line": 486
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rl_redisplay",
          "args": [],
          "line": 483
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rl_replace_line",
          "args": [
            "\"\"",
            "0"
          ],
          "line": 482
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rl_save_prompt",
          "args": [],
          "line": 481
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rl_copy_text",
          "args": [
            "0",
            "rl_end"
          ],
          "line": 479
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "RL_ISSTATE",
          "args": [
            "RL_STATE_DONE"
          ],
          "line": 475
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "va_end",
          "args": [
            "args"
          ],
          "line": 471
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "vprintf",
          "args": [
            "fmt",
            "args"
          ],
          "line": 470
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "va_start",
          "args": [
            "args",
            "fmt"
          ],
          "line": 469
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/shell.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/mainloop.h\"\n#include <readline/history.h>\n#include <readline/readline.h>\n#include <getopt.h>\n#include <wordexp.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic wordexp_t args;\n\nvoid bt_shell_printf(const char *fmt, ...)\n{\n\tva_list args;\n\tbool save_input;\n\tchar *saved_line;\n\tint saved_point;\n\n\tif (!data.input)\n\t\treturn;\n\n\tif (data.mode) {\n\t\tva_start(args, fmt);\n\t\tvprintf(fmt, args);\n\t\tva_end(args);\n\t\treturn;\n\t}\n\n\tsave_input = !RL_ISSTATE(RL_STATE_DONE);\n\n\tif (save_input) {\n\t\tsaved_point = rl_point;\n\t\tsaved_line = rl_copy_text(0, rl_end);\n\t\tif (!data.saved_prompt)\n\t\t\trl_save_prompt();\n\t\trl_replace_line(\"\", 0);\n\t\trl_redisplay();\n\t}\n\n\tva_start(args, fmt);\n\tvprintf(fmt, args);\n\tva_end(args);\n\n\tif (save_input) {\n\t\tif (!data.saved_prompt)\n\t\t\trl_restore_prompt();\n\t\trl_replace_line(saved_line, 0);\n\t\trl_point = saved_point;\n\t\trl_forced_update_display();\n\t\tfree(saved_line);\n\t}\n}"
  },
  {
    "function_name": "shell_exec",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/shell.c",
    "lines": "434-456",
    "snippet": "static int shell_exec(int argc, char *argv[])\n{\n\tint err;\n\n\tif (!data.menu || !argv[0])\n\t\treturn -EINVAL;\n\n\terr  = menu_exec(default_menu, argc, argv);\n\tif (err == -ENOENT) {\n\t\terr  = menu_exec(data.menu->entries, argc, argv);\n\t\tif (err == -ENOENT) {\n\t\t\terr = submenu_exec(argc, argv);\n\t\t\tif (err == -ENOENT) {\n\t\t\t\tprint_text(COLOR_HIGHLIGHT,\n\t\t\t\t\t\"Invalid command in menu %s: %s\",\n\t\t\t\t\tdata.menu->name , argv[0]);\n\t\t\t\tshell_print_help();\n\t\t\t}\n\t\t}\n\t}\n\n\treturn err;\n}",
    "includes": [
      "#include \"src/shared/shell.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/mainloop.h\"",
      "#include <readline/history.h>",
      "#include <readline/readline.h>",
      "#include <getopt.h>",
      "#include <wordexp.h>",
      "#include <sys/signalfd.h>",
      "#include <signal.h>",
      "#include <stdbool.h>",
      "#include <stdarg.h>",
      "#include <stdlib.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static const struct bt_shell_menu_entry default_menu[] = {\n\t{ \"back\",         NULL,       cmd_back, \"Return to main menu\", NULL,\n\t\t\t\t\t\t\tNULL, cmd_back_exists },\n\t{ \"menu\",         \"<name>\",   cmd_menu, \"Select submenu\",\n\t\t\t\t\t\t\tmenu_generator, NULL,\n\t\t\t\t\t\t\tcmd_menu_exists},\n\t{ \"version\",      NULL,       cmd_version, \"Display version\" },\n\t{ \"quit\",         NULL,       cmd_quit, \"Quit program\" },\n\t{ \"exit\",         NULL,       cmd_quit, \"Quit program\" },\n\t{ \"help\",         NULL,       cmd_help,\n\t\t\t\t\t\"Display help about this program\" },\n\t{ \"export\",       NULL,       cmd_export,\n\t\t\t\t\t\t\"Print evironment variables\" },\n\t{ }\n};"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "shell_print_help",
          "args": [],
          "line": 450
        },
        "resolved": true,
        "details": {
          "function_name": "shell_print_help",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/shell.c",
          "lines": "228-235",
          "snippet": "static void shell_print_help(void)\n{\n\tprint_text(COLOR_HIGHLIGHT,\n\t\t\"\\n\"\n\t\t\"Use \\\"help\\\" for a list of available commands in a menu.\\n\"\n\t\t\"Use \\\"menu <submenu>\\\" if you want to enter any submenu.\\n\"\n\t\t\"Use \\\"back\\\" if you want to return to menu main.\");\n}",
          "includes": [
            "#include \"src/shared/shell.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/mainloop.h\"",
            "#include <readline/history.h>",
            "#include <readline/readline.h>",
            "#include <getopt.h>",
            "#include <wordexp.h>",
            "#include <sys/signalfd.h>",
            "#include <signal.h>",
            "#include <stdbool.h>",
            "#include <stdarg.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/shell.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/mainloop.h\"\n#include <readline/history.h>\n#include <readline/readline.h>\n#include <getopt.h>\n#include <wordexp.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void shell_print_help(void)\n{\n\tprint_text(COLOR_HIGHLIGHT,\n\t\t\"\\n\"\n\t\t\"Use \\\"help\\\" for a list of available commands in a menu.\\n\"\n\t\t\"Use \\\"menu <submenu>\\\" if you want to enter any submenu.\\n\"\n\t\t\"Use \\\"back\\\" if you want to return to menu main.\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "print_text",
          "args": [
            "COLOR_HIGHLIGHT",
            "\"Invalid command in menu %s: %s\"",
            "data.menu->name",
            "argv[0]"
          ],
          "line": 447
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "submenu_exec",
          "args": [
            "argc",
            "argv"
          ],
          "line": 445
        },
        "resolved": true,
        "details": {
          "function_name": "submenu_exec",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/shell.c",
          "lines": "406-432",
          "snippet": "static int submenu_exec(int argc, char *argv[])\n{\n\tchar *name;\n\tint len, tlen;\n\tconst struct bt_shell_menu *submenu;\n\n\tif (data.menu != data.main)\n\t\treturn -ENOENT;\n\n\tname = strchr(argv[0], '.');\n\tif (!name)\n\t\treturn -ENOENT;\n\n\ttlen = strlen(argv[0]);\n\tlen = name - argv[0];\n\tname[0] = '\\0';\n\n\tsubmenu = find_menu(argv[0], strlen(argv[0]));\n\tif (!submenu)\n\t\treturn -ENOENT;\n\n\t/* Replace submenu.command with command */\n\tmemmove(argv[0], argv[0] + len + 1, tlen - len - 1);\n\tmemset(argv[0] + tlen - len - 1, 0, len + 1);\n\n\treturn menu_exec(submenu->entries, argc, argv);\n}",
          "includes": [
            "#include \"src/shared/shell.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/mainloop.h\"",
            "#include <readline/history.h>",
            "#include <readline/readline.h>",
            "#include <getopt.h>",
            "#include <wordexp.h>",
            "#include <sys/signalfd.h>",
            "#include <signal.h>",
            "#include <stdbool.h>",
            "#include <stdarg.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/shell.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/mainloop.h\"\n#include <readline/history.h>\n#include <readline/readline.h>\n#include <getopt.h>\n#include <wordexp.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic int submenu_exec(int argc, char *argv[])\n{\n\tchar *name;\n\tint len, tlen;\n\tconst struct bt_shell_menu *submenu;\n\n\tif (data.menu != data.main)\n\t\treturn -ENOENT;\n\n\tname = strchr(argv[0], '.');\n\tif (!name)\n\t\treturn -ENOENT;\n\n\ttlen = strlen(argv[0]);\n\tlen = name - argv[0];\n\tname[0] = '\\0';\n\n\tsubmenu = find_menu(argv[0], strlen(argv[0]));\n\tif (!submenu)\n\t\treturn -ENOENT;\n\n\t/* Replace submenu.command with command */\n\tmemmove(argv[0], argv[0] + len + 1, tlen - len - 1);\n\tmemset(argv[0] + tlen - len - 1, 0, len + 1);\n\n\treturn menu_exec(submenu->entries, argc, argv);\n}"
        }
      },
      {
        "call_info": {
          "callee": "menu_exec",
          "args": [
            "data.menu->entries",
            "argc",
            "argv"
          ],
          "line": 443
        },
        "resolved": true,
        "details": {
          "function_name": "menu_exec",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/shell.c",
          "lines": "385-404",
          "snippet": "static int menu_exec(const struct bt_shell_menu_entry *entry,\n\t\t\t\t\tint argc, char *argv[])\n{\n\tfor (; entry->cmd; entry++) {\n\t\tif (strcmp(argv[0], entry->cmd))\n\t\t\tcontinue;\n\n\t\t/* Skip menu command if not on main menu */\n\t\tif (data.menu != data.main && !strcmp(entry->cmd, \"menu\"))\n\t\t\tcontinue;\n\n\t\t/* Skip back command if on main menu */\n\t\tif (data.menu == data.main && !strcmp(entry->cmd, \"back\"))\n\t\t\tcontinue;\n\n\t\treturn cmd_exec(entry, argc, argv);\n\t}\n\n\treturn -ENOENT;\n}",
          "includes": [
            "#include \"src/shared/shell.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/mainloop.h\"",
            "#include <readline/history.h>",
            "#include <readline/readline.h>",
            "#include <getopt.h>",
            "#include <wordexp.h>",
            "#include <sys/signalfd.h>",
            "#include <signal.h>",
            "#include <stdbool.h>",
            "#include <stdarg.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/shell.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/mainloop.h\"\n#include <readline/history.h>\n#include <readline/readline.h>\n#include <getopt.h>\n#include <wordexp.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic int menu_exec(const struct bt_shell_menu_entry *entry,\n\t\t\t\t\tint argc, char *argv[])\n{\n\tfor (; entry->cmd; entry++) {\n\t\tif (strcmp(argv[0], entry->cmd))\n\t\t\tcontinue;\n\n\t\t/* Skip menu command if not on main menu */\n\t\tif (data.menu != data.main && !strcmp(entry->cmd, \"menu\"))\n\t\t\tcontinue;\n\n\t\t/* Skip back command if on main menu */\n\t\tif (data.menu == data.main && !strcmp(entry->cmd, \"back\"))\n\t\t\tcontinue;\n\n\t\treturn cmd_exec(entry, argc, argv);\n\t}\n\n\treturn -ENOENT;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/shell.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/mainloop.h\"\n#include <readline/history.h>\n#include <readline/readline.h>\n#include <getopt.h>\n#include <wordexp.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic const struct bt_shell_menu_entry default_menu[] = {\n\t{ \"back\",         NULL,       cmd_back, \"Return to main menu\", NULL,\n\t\t\t\t\t\t\tNULL, cmd_back_exists },\n\t{ \"menu\",         \"<name>\",   cmd_menu, \"Select submenu\",\n\t\t\t\t\t\t\tmenu_generator, NULL,\n\t\t\t\t\t\t\tcmd_menu_exists},\n\t{ \"version\",      NULL,       cmd_version, \"Display version\" },\n\t{ \"quit\",         NULL,       cmd_quit, \"Quit program\" },\n\t{ \"exit\",         NULL,       cmd_quit, \"Quit program\" },\n\t{ \"help\",         NULL,       cmd_help,\n\t\t\t\t\t\"Display help about this program\" },\n\t{ \"export\",       NULL,       cmd_export,\n\t\t\t\t\t\t\"Print evironment variables\" },\n\t{ }\n};\n\nstatic int shell_exec(int argc, char *argv[])\n{\n\tint err;\n\n\tif (!data.menu || !argv[0])\n\t\treturn -EINVAL;\n\n\terr  = menu_exec(default_menu, argc, argv);\n\tif (err == -ENOENT) {\n\t\terr  = menu_exec(data.menu->entries, argc, argv);\n\t\tif (err == -ENOENT) {\n\t\t\terr = submenu_exec(argc, argv);\n\t\t\tif (err == -ENOENT) {\n\t\t\t\tprint_text(COLOR_HIGHLIGHT,\n\t\t\t\t\t\"Invalid command in menu %s: %s\",\n\t\t\t\t\tdata.menu->name , argv[0]);\n\t\t\t\tshell_print_help();\n\t\t\t}\n\t\t}\n\t}\n\n\treturn err;\n}"
  },
  {
    "function_name": "submenu_exec",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/shell.c",
    "lines": "406-432",
    "snippet": "static int submenu_exec(int argc, char *argv[])\n{\n\tchar *name;\n\tint len, tlen;\n\tconst struct bt_shell_menu *submenu;\n\n\tif (data.menu != data.main)\n\t\treturn -ENOENT;\n\n\tname = strchr(argv[0], '.');\n\tif (!name)\n\t\treturn -ENOENT;\n\n\ttlen = strlen(argv[0]);\n\tlen = name - argv[0];\n\tname[0] = '\\0';\n\n\tsubmenu = find_menu(argv[0], strlen(argv[0]));\n\tif (!submenu)\n\t\treturn -ENOENT;\n\n\t/* Replace submenu.command with command */\n\tmemmove(argv[0], argv[0] + len + 1, tlen - len - 1);\n\tmemset(argv[0] + tlen - len - 1, 0, len + 1);\n\n\treturn menu_exec(submenu->entries, argc, argv);\n}",
    "includes": [
      "#include \"src/shared/shell.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/mainloop.h\"",
      "#include <readline/history.h>",
      "#include <readline/readline.h>",
      "#include <getopt.h>",
      "#include <wordexp.h>",
      "#include <sys/signalfd.h>",
      "#include <signal.h>",
      "#include <stdbool.h>",
      "#include <stdarg.h>",
      "#include <stdlib.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "menu_exec",
          "args": [
            "submenu->entries",
            "argc",
            "argv"
          ],
          "line": 431
        },
        "resolved": true,
        "details": {
          "function_name": "menu_exec",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/shell.c",
          "lines": "385-404",
          "snippet": "static int menu_exec(const struct bt_shell_menu_entry *entry,\n\t\t\t\t\tint argc, char *argv[])\n{\n\tfor (; entry->cmd; entry++) {\n\t\tif (strcmp(argv[0], entry->cmd))\n\t\t\tcontinue;\n\n\t\t/* Skip menu command if not on main menu */\n\t\tif (data.menu != data.main && !strcmp(entry->cmd, \"menu\"))\n\t\t\tcontinue;\n\n\t\t/* Skip back command if on main menu */\n\t\tif (data.menu == data.main && !strcmp(entry->cmd, \"back\"))\n\t\t\tcontinue;\n\n\t\treturn cmd_exec(entry, argc, argv);\n\t}\n\n\treturn -ENOENT;\n}",
          "includes": [
            "#include \"src/shared/shell.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/mainloop.h\"",
            "#include <readline/history.h>",
            "#include <readline/readline.h>",
            "#include <getopt.h>",
            "#include <wordexp.h>",
            "#include <sys/signalfd.h>",
            "#include <signal.h>",
            "#include <stdbool.h>",
            "#include <stdarg.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/shell.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/mainloop.h\"\n#include <readline/history.h>\n#include <readline/readline.h>\n#include <getopt.h>\n#include <wordexp.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic int menu_exec(const struct bt_shell_menu_entry *entry,\n\t\t\t\t\tint argc, char *argv[])\n{\n\tfor (; entry->cmd; entry++) {\n\t\tif (strcmp(argv[0], entry->cmd))\n\t\t\tcontinue;\n\n\t\t/* Skip menu command if not on main menu */\n\t\tif (data.menu != data.main && !strcmp(entry->cmd, \"menu\"))\n\t\t\tcontinue;\n\n\t\t/* Skip back command if on main menu */\n\t\tif (data.menu == data.main && !strcmp(entry->cmd, \"back\"))\n\t\t\tcontinue;\n\n\t\treturn cmd_exec(entry, argc, argv);\n\t}\n\n\treturn -ENOENT;\n}"
        }
      },
      {
        "call_info": {
          "callee": "memset",
          "args": [
            "argv[0] + tlen - len - 1",
            "0",
            "len + 1"
          ],
          "line": 429
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memmove",
          "args": [
            "argv[0]",
            "argv[0] + len + 1",
            "tlen - len - 1"
          ],
          "line": 428
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "find_menu",
          "args": [
            "argv[0]",
            "strlen(argv[0])"
          ],
          "line": 423
        },
        "resolved": true,
        "details": {
          "function_name": "find_menu",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/shell.c",
          "lines": "107-120",
          "snippet": "static const struct bt_shell_menu *find_menu(const char *name, size_t len)\n{\n\tconst struct queue_entry *entry;\n\n\tfor (entry = queue_get_entries(data.submenus); entry;\n\t\t\t\t\t\tentry = entry->next) {\n\t\tstruct bt_shell_menu *menu = entry->data;\n\n\t\tif (!strncmp(menu->name, name, len))\n\t\t\treturn menu;\n\t}\n\n\treturn NULL;\n}",
          "includes": [
            "#include \"src/shared/shell.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/mainloop.h\"",
            "#include <readline/history.h>",
            "#include <readline/readline.h>",
            "#include <getopt.h>",
            "#include <wordexp.h>",
            "#include <sys/signalfd.h>",
            "#include <signal.h>",
            "#include <stdbool.h>",
            "#include <stdarg.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/shell.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/mainloop.h\"\n#include <readline/history.h>\n#include <readline/readline.h>\n#include <getopt.h>\n#include <wordexp.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic const struct bt_shell_menu *find_menu(const char *name, size_t len)\n{\n\tconst struct queue_entry *entry;\n\n\tfor (entry = queue_get_entries(data.submenus); entry;\n\t\t\t\t\t\tentry = entry->next) {\n\t\tstruct bt_shell_menu *menu = entry->data;\n\n\t\tif (!strncmp(menu->name, name, len))\n\t\t\treturn menu;\n\t}\n\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "argv[0]"
          ],
          "line": 423
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "argv[0]"
          ],
          "line": 419
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strchr",
          "args": [
            "argv[0]",
            "'.'"
          ],
          "line": 415
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/shell.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/mainloop.h\"\n#include <readline/history.h>\n#include <readline/readline.h>\n#include <getopt.h>\n#include <wordexp.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic int submenu_exec(int argc, char *argv[])\n{\n\tchar *name;\n\tint len, tlen;\n\tconst struct bt_shell_menu *submenu;\n\n\tif (data.menu != data.main)\n\t\treturn -ENOENT;\n\n\tname = strchr(argv[0], '.');\n\tif (!name)\n\t\treturn -ENOENT;\n\n\ttlen = strlen(argv[0]);\n\tlen = name - argv[0];\n\tname[0] = '\\0';\n\n\tsubmenu = find_menu(argv[0], strlen(argv[0]));\n\tif (!submenu)\n\t\treturn -ENOENT;\n\n\t/* Replace submenu.command with command */\n\tmemmove(argv[0], argv[0] + len + 1, tlen - len - 1);\n\tmemset(argv[0] + tlen - len - 1, 0, len + 1);\n\n\treturn menu_exec(submenu->entries, argc, argv);\n}"
  },
  {
    "function_name": "menu_exec",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/shell.c",
    "lines": "385-404",
    "snippet": "static int menu_exec(const struct bt_shell_menu_entry *entry,\n\t\t\t\t\tint argc, char *argv[])\n{\n\tfor (; entry->cmd; entry++) {\n\t\tif (strcmp(argv[0], entry->cmd))\n\t\t\tcontinue;\n\n\t\t/* Skip menu command if not on main menu */\n\t\tif (data.menu != data.main && !strcmp(entry->cmd, \"menu\"))\n\t\t\tcontinue;\n\n\t\t/* Skip back command if on main menu */\n\t\tif (data.menu == data.main && !strcmp(entry->cmd, \"back\"))\n\t\t\tcontinue;\n\n\t\treturn cmd_exec(entry, argc, argv);\n\t}\n\n\treturn -ENOENT;\n}",
    "includes": [
      "#include \"src/shared/shell.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/mainloop.h\"",
      "#include <readline/history.h>",
      "#include <readline/readline.h>",
      "#include <getopt.h>",
      "#include <wordexp.h>",
      "#include <sys/signalfd.h>",
      "#include <signal.h>",
      "#include <stdbool.h>",
      "#include <stdarg.h>",
      "#include <stdlib.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "cmd_exec",
          "args": [
            "entry",
            "argc",
            "argv"
          ],
          "line": 400
        },
        "resolved": true,
        "details": {
          "function_name": "cmd_exec",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/shell.c",
          "lines": "291-383",
          "snippet": "static int cmd_exec(const struct bt_shell_menu_entry *entry,\n\t\t\t\t\tint argc, char *argv[])\n{\n\twordexp_t w;\n\tsize_t len;\n\tchar *man, *opt;\n\tint flags = WRDE_NOCMD;\n\tbool optargs = false;\n\n\tif (!entry->arg || entry->arg[0] == '\\0') {\n\t\tif (argc > 1) {\n\t\t\tprint_text(COLOR_HIGHLIGHT, \"Too many arguments\");\n\t\t\treturn -EINVAL;\n\t\t}\n\t\tgoto exec;\n\t}\n\n\t/* Find last mandatory arguments */\n\tman = strrchr(entry->arg, '>');\n\tif (!man) {\n\t\topt = strdup(entry->arg);\n\t\tgoto optional;\n\t}\n\n\tlen = man - entry->arg;\n\tif (entry->arg[0] == '<')\n\t\tman = strndup(entry->arg, len + 1);\n\telse {\n\t\t/* Find where mandatory arguments start */\n\t\topt = strrchr(entry->arg, '<');\n\t\t/* Skip if mandatory arguments are not in the right format */\n\t\tif (!opt || opt > man) {\n\t\t\topt = strdup(entry->arg);\n\t\t\tgoto optional;\n\t\t}\n\t\tman = strndup(opt, man - opt + 1);\n\t\toptargs = true;\n\t}\n\n\tif (parse_args(man, &w, \"<>\", flags) < 0) {\n\t\tprint_text(COLOR_HIGHLIGHT,\n\t\t\t\"Unable to parse mandatory command arguments: %s\", man );\n\t\tfree(man);\n\t\treturn -EINVAL;\n\t}\n\n\tfree(man);\n\n\t/* Check if there are enough arguments */\n\tif ((unsigned) argc - 1 < w.we_wordc) {\n\t\tprint_text(COLOR_HIGHLIGHT, \"Missing %s argument\",\n\t\t\t\t\t\tw.we_wordv[argc - 1]);\n\t\tgoto fail;\n\t}\n\n\tflags |= WRDE_APPEND;\n\topt = strdup(entry->arg + len + 1);\n\noptional:\n\tif (parse_args(opt, &w, \"[]\", flags) < 0) {\n\t\tprint_text(COLOR_HIGHLIGHT,\n\t\t\t\"Unable to parse optional command arguments: %s\", opt);\n\t\tfree(opt);\n\t\treturn -EINVAL;\n\t}\n\n\tfree(opt);\n\n\t/* Check if there are too many arguments */\n\tif (!optargs && ((unsigned int) argc - 1 > w.we_wordc && !w.we_offs)) {\n\t\tprint_text(COLOR_HIGHLIGHT, \"Too many arguments: %d > %zu\",\n\t\t\t\t\targc - 1, w.we_wordc);\n\t\tgoto fail;\n\t}\n\n\tw.we_offs = 0;\n\twordfree(&w);\n\nexec:\n\tdata.exec = entry;\n\n\tif (entry->func)\n\t\tentry->func(argc, argv);\n\n\tdata.exec = NULL;\n\n\treturn 0;\n\nfail:\n\tw.we_offs = 0;\n\twordfree(&w);\n\treturn -EINVAL;\n}",
          "includes": [
            "#include \"src/shared/shell.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/mainloop.h\"",
            "#include <readline/history.h>",
            "#include <readline/readline.h>",
            "#include <getopt.h>",
            "#include <wordexp.h>",
            "#include <sys/signalfd.h>",
            "#include <signal.h>",
            "#include <stdbool.h>",
            "#include <stdarg.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/shell.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/mainloop.h\"\n#include <readline/history.h>\n#include <readline/readline.h>\n#include <getopt.h>\n#include <wordexp.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic int cmd_exec(const struct bt_shell_menu_entry *entry,\n\t\t\t\t\tint argc, char *argv[])\n{\n\twordexp_t w;\n\tsize_t len;\n\tchar *man, *opt;\n\tint flags = WRDE_NOCMD;\n\tbool optargs = false;\n\n\tif (!entry->arg || entry->arg[0] == '\\0') {\n\t\tif (argc > 1) {\n\t\t\tprint_text(COLOR_HIGHLIGHT, \"Too many arguments\");\n\t\t\treturn -EINVAL;\n\t\t}\n\t\tgoto exec;\n\t}\n\n\t/* Find last mandatory arguments */\n\tman = strrchr(entry->arg, '>');\n\tif (!man) {\n\t\topt = strdup(entry->arg);\n\t\tgoto optional;\n\t}\n\n\tlen = man - entry->arg;\n\tif (entry->arg[0] == '<')\n\t\tman = strndup(entry->arg, len + 1);\n\telse {\n\t\t/* Find where mandatory arguments start */\n\t\topt = strrchr(entry->arg, '<');\n\t\t/* Skip if mandatory arguments are not in the right format */\n\t\tif (!opt || opt > man) {\n\t\t\topt = strdup(entry->arg);\n\t\t\tgoto optional;\n\t\t}\n\t\tman = strndup(opt, man - opt + 1);\n\t\toptargs = true;\n\t}\n\n\tif (parse_args(man, &w, \"<>\", flags) < 0) {\n\t\tprint_text(COLOR_HIGHLIGHT,\n\t\t\t\"Unable to parse mandatory command arguments: %s\", man );\n\t\tfree(man);\n\t\treturn -EINVAL;\n\t}\n\n\tfree(man);\n\n\t/* Check if there are enough arguments */\n\tif ((unsigned) argc - 1 < w.we_wordc) {\n\t\tprint_text(COLOR_HIGHLIGHT, \"Missing %s argument\",\n\t\t\t\t\t\tw.we_wordv[argc - 1]);\n\t\tgoto fail;\n\t}\n\n\tflags |= WRDE_APPEND;\n\topt = strdup(entry->arg + len + 1);\n\noptional:\n\tif (parse_args(opt, &w, \"[]\", flags) < 0) {\n\t\tprint_text(COLOR_HIGHLIGHT,\n\t\t\t\"Unable to parse optional command arguments: %s\", opt);\n\t\tfree(opt);\n\t\treturn -EINVAL;\n\t}\n\n\tfree(opt);\n\n\t/* Check if there are too many arguments */\n\tif (!optargs && ((unsigned int) argc - 1 > w.we_wordc && !w.we_offs)) {\n\t\tprint_text(COLOR_HIGHLIGHT, \"Too many arguments: %d > %zu\",\n\t\t\t\t\targc - 1, w.we_wordc);\n\t\tgoto fail;\n\t}\n\n\tw.we_offs = 0;\n\twordfree(&w);\n\nexec:\n\tdata.exec = entry;\n\n\tif (entry->func)\n\t\tentry->func(argc, argv);\n\n\tdata.exec = NULL;\n\n\treturn 0;\n\nfail:\n\tw.we_offs = 0;\n\twordfree(&w);\n\treturn -EINVAL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "entry->cmd",
            "\"back\""
          ],
          "line": 397
        },
        "resolved": true,
        "details": {
          "function_name": "g_strcmp",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "1927-1930",
          "snippet": "static gint g_strcmp(gconstpointer a, gconstpointer b)\n{\n\treturn strcmp(a, b);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic gint g_strcmp(gconstpointer a, gconstpointer b)\n{\n\treturn strcmp(a, b);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/shell.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/mainloop.h\"\n#include <readline/history.h>\n#include <readline/readline.h>\n#include <getopt.h>\n#include <wordexp.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic int menu_exec(const struct bt_shell_menu_entry *entry,\n\t\t\t\t\tint argc, char *argv[])\n{\n\tfor (; entry->cmd; entry++) {\n\t\tif (strcmp(argv[0], entry->cmd))\n\t\t\tcontinue;\n\n\t\t/* Skip menu command if not on main menu */\n\t\tif (data.menu != data.main && !strcmp(entry->cmd, \"menu\"))\n\t\t\tcontinue;\n\n\t\t/* Skip back command if on main menu */\n\t\tif (data.menu == data.main && !strcmp(entry->cmd, \"back\"))\n\t\t\tcontinue;\n\n\t\treturn cmd_exec(entry, argc, argv);\n\t}\n\n\treturn -ENOENT;\n}"
  },
  {
    "function_name": "cmd_exec",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/shell.c",
    "lines": "291-383",
    "snippet": "static int cmd_exec(const struct bt_shell_menu_entry *entry,\n\t\t\t\t\tint argc, char *argv[])\n{\n\twordexp_t w;\n\tsize_t len;\n\tchar *man, *opt;\n\tint flags = WRDE_NOCMD;\n\tbool optargs = false;\n\n\tif (!entry->arg || entry->arg[0] == '\\0') {\n\t\tif (argc > 1) {\n\t\t\tprint_text(COLOR_HIGHLIGHT, \"Too many arguments\");\n\t\t\treturn -EINVAL;\n\t\t}\n\t\tgoto exec;\n\t}\n\n\t/* Find last mandatory arguments */\n\tman = strrchr(entry->arg, '>');\n\tif (!man) {\n\t\topt = strdup(entry->arg);\n\t\tgoto optional;\n\t}\n\n\tlen = man - entry->arg;\n\tif (entry->arg[0] == '<')\n\t\tman = strndup(entry->arg, len + 1);\n\telse {\n\t\t/* Find where mandatory arguments start */\n\t\topt = strrchr(entry->arg, '<');\n\t\t/* Skip if mandatory arguments are not in the right format */\n\t\tif (!opt || opt > man) {\n\t\t\topt = strdup(entry->arg);\n\t\t\tgoto optional;\n\t\t}\n\t\tman = strndup(opt, man - opt + 1);\n\t\toptargs = true;\n\t}\n\n\tif (parse_args(man, &w, \"<>\", flags) < 0) {\n\t\tprint_text(COLOR_HIGHLIGHT,\n\t\t\t\"Unable to parse mandatory command arguments: %s\", man );\n\t\tfree(man);\n\t\treturn -EINVAL;\n\t}\n\n\tfree(man);\n\n\t/* Check if there are enough arguments */\n\tif ((unsigned) argc - 1 < w.we_wordc) {\n\t\tprint_text(COLOR_HIGHLIGHT, \"Missing %s argument\",\n\t\t\t\t\t\tw.we_wordv[argc - 1]);\n\t\tgoto fail;\n\t}\n\n\tflags |= WRDE_APPEND;\n\topt = strdup(entry->arg + len + 1);\n\noptional:\n\tif (parse_args(opt, &w, \"[]\", flags) < 0) {\n\t\tprint_text(COLOR_HIGHLIGHT,\n\t\t\t\"Unable to parse optional command arguments: %s\", opt);\n\t\tfree(opt);\n\t\treturn -EINVAL;\n\t}\n\n\tfree(opt);\n\n\t/* Check if there are too many arguments */\n\tif (!optargs && ((unsigned int) argc - 1 > w.we_wordc && !w.we_offs)) {\n\t\tprint_text(COLOR_HIGHLIGHT, \"Too many arguments: %d > %zu\",\n\t\t\t\t\targc - 1, w.we_wordc);\n\t\tgoto fail;\n\t}\n\n\tw.we_offs = 0;\n\twordfree(&w);\n\nexec:\n\tdata.exec = entry;\n\n\tif (entry->func)\n\t\tentry->func(argc, argv);\n\n\tdata.exec = NULL;\n\n\treturn 0;\n\nfail:\n\tw.we_offs = 0;\n\twordfree(&w);\n\treturn -EINVAL;\n}",
    "includes": [
      "#include \"src/shared/shell.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/mainloop.h\"",
      "#include <readline/history.h>",
      "#include <readline/readline.h>",
      "#include <getopt.h>",
      "#include <wordexp.h>",
      "#include <sys/signalfd.h>",
      "#include <signal.h>",
      "#include <stdbool.h>",
      "#include <stdarg.h>",
      "#include <stdlib.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "wordfree",
          "args": [
            "&w"
          ],
          "line": 381
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "entry->func",
          "args": [
            "argc",
            "argv"
          ],
          "line": 373
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "wordfree",
          "args": [
            "&w"
          ],
          "line": 367
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "print_text",
          "args": [
            "COLOR_HIGHLIGHT",
            "\"Too many arguments: %d > %zu\"",
            "argc - 1",
            "w.we_wordc"
          ],
          "line": 361
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "free",
          "args": [
            "opt"
          ],
          "line": 357
        },
        "resolved": true,
        "details": {
          "function_name": "bt_att_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/att.c",
          "lines": "956-985",
          "snippet": "static void bt_att_free(struct bt_att *att)\n{\n\tif (att->pending_req)\n\t\tdestroy_att_send_op(att->pending_req);\n\n\tif (att->pending_ind)\n\t\tdestroy_att_send_op(att->pending_ind);\n\n\tio_destroy(att->io);\n\tbt_crypto_unref(att->crypto);\n\n\tqueue_destroy(att->req_queue, NULL);\n\tqueue_destroy(att->ind_queue, NULL);\n\tqueue_destroy(att->write_queue, NULL);\n\tqueue_destroy(att->notify_list, NULL);\n\tqueue_destroy(att->disconn_list, NULL);\n\n\tif (att->timeout_destroy)\n\t\tatt->timeout_destroy(att->timeout_data);\n\n\tif (att->debug_destroy)\n\t\tatt->debug_destroy(att->debug_data);\n\n\tfree(att->local_sign);\n\tfree(att->remote_sign);\n\n\tfree(att->buf);\n\n\tfree(att);\n}",
          "includes": [
            "#include \"src/shared/crypto.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/l2cap.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/crypto.h\"\n#include \"src/shared/att.h\"\n#include \"lib/uuid.h\"\n#include \"lib/l2cap.h\"\n#include \"lib/bluetooth.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include <errno.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <config.h>\n\nstatic void bt_att_free(struct bt_att *att)\n{\n\tif (att->pending_req)\n\t\tdestroy_att_send_op(att->pending_req);\n\n\tif (att->pending_ind)\n\t\tdestroy_att_send_op(att->pending_ind);\n\n\tio_destroy(att->io);\n\tbt_crypto_unref(att->crypto);\n\n\tqueue_destroy(att->req_queue, NULL);\n\tqueue_destroy(att->ind_queue, NULL);\n\tqueue_destroy(att->write_queue, NULL);\n\tqueue_destroy(att->notify_list, NULL);\n\tqueue_destroy(att->disconn_list, NULL);\n\n\tif (att->timeout_destroy)\n\t\tatt->timeout_destroy(att->timeout_data);\n\n\tif (att->debug_destroy)\n\t\tatt->debug_destroy(att->debug_data);\n\n\tfree(att->local_sign);\n\tfree(att->remote_sign);\n\n\tfree(att->buf);\n\n\tfree(att);\n}"
        }
      },
      {
        "call_info": {
          "callee": "print_text",
          "args": [
            "COLOR_HIGHLIGHT",
            "\"Unable to parse optional command arguments: %s\"",
            "opt"
          ],
          "line": 351
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "parse_args",
          "args": [
            "opt",
            "&w",
            "\"[]\"",
            "flags"
          ],
          "line": 350
        },
        "resolved": true,
        "details": {
          "function_name": "parse_args",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/shell.c",
          "lines": "271-289",
          "snippet": "static int parse_args(char *arg, wordexp_t *w, char *del, int flags)\n{\n\tchar *str;\n\n\tstr = strdelimit(arg, del, '\"');\n\n\tif (wordexp(str, w, flags)) {\n\t\tfree(str);\n\t\treturn -EINVAL;\n\t}\n\n\t/* If argument ends with ... set we_offs bypass strict checks */\n\tif (w->we_wordc && !strsuffix(w->we_wordv[w->we_wordc -1], \"...\"))\n\t\tw->we_offs = 1;\n\n\tfree(str);\n\n\treturn 0;\n}",
          "includes": [
            "#include \"src/shared/shell.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/mainloop.h\"",
            "#include <readline/history.h>",
            "#include <readline/readline.h>",
            "#include <getopt.h>",
            "#include <wordexp.h>",
            "#include <sys/signalfd.h>",
            "#include <signal.h>",
            "#include <stdbool.h>",
            "#include <stdarg.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/shell.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/mainloop.h\"\n#include <readline/history.h>\n#include <readline/readline.h>\n#include <getopt.h>\n#include <wordexp.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic int parse_args(char *arg, wordexp_t *w, char *del, int flags)\n{\n\tchar *str;\n\n\tstr = strdelimit(arg, del, '\"');\n\n\tif (wordexp(str, w, flags)) {\n\t\tfree(str);\n\t\treturn -EINVAL;\n\t}\n\n\t/* If argument ends with ... set we_offs bypass strict checks */\n\tif (w->we_wordc && !strsuffix(w->we_wordv[w->we_wordc -1], \"...\"))\n\t\tw->we_offs = 1;\n\n\tfree(str);\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "strdup",
          "args": [
            "entry->arg + len + 1"
          ],
          "line": 347
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "print_text",
          "args": [
            "COLOR_HIGHLIGHT",
            "\"Missing %s argument\"",
            "w.we_wordv[argc - 1]"
          ],
          "line": 341
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "print_text",
          "args": [
            "COLOR_HIGHLIGHT",
            "\"Unable to parse mandatory command arguments: %s\"",
            "man"
          ],
          "line": 331
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strndup",
          "args": [
            "opt",
            "man - opt + 1"
          ],
          "line": 326
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strdup",
          "args": [
            "entry->arg"
          ],
          "line": 323
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strrchr",
          "args": [
            "entry->arg",
            "'<'"
          ],
          "line": 320
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strndup",
          "args": [
            "entry->arg",
            "len + 1"
          ],
          "line": 317
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strdup",
          "args": [
            "entry->arg"
          ],
          "line": 311
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strrchr",
          "args": [
            "entry->arg",
            "'>'"
          ],
          "line": 309
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "print_text",
          "args": [
            "COLOR_HIGHLIGHT",
            "\"Too many arguments\""
          ],
          "line": 302
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/shell.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/mainloop.h\"\n#include <readline/history.h>\n#include <readline/readline.h>\n#include <getopt.h>\n#include <wordexp.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic int cmd_exec(const struct bt_shell_menu_entry *entry,\n\t\t\t\t\tint argc, char *argv[])\n{\n\twordexp_t w;\n\tsize_t len;\n\tchar *man, *opt;\n\tint flags = WRDE_NOCMD;\n\tbool optargs = false;\n\n\tif (!entry->arg || entry->arg[0] == '\\0') {\n\t\tif (argc > 1) {\n\t\t\tprint_text(COLOR_HIGHLIGHT, \"Too many arguments\");\n\t\t\treturn -EINVAL;\n\t\t}\n\t\tgoto exec;\n\t}\n\n\t/* Find last mandatory arguments */\n\tman = strrchr(entry->arg, '>');\n\tif (!man) {\n\t\topt = strdup(entry->arg);\n\t\tgoto optional;\n\t}\n\n\tlen = man - entry->arg;\n\tif (entry->arg[0] == '<')\n\t\tman = strndup(entry->arg, len + 1);\n\telse {\n\t\t/* Find where mandatory arguments start */\n\t\topt = strrchr(entry->arg, '<');\n\t\t/* Skip if mandatory arguments are not in the right format */\n\t\tif (!opt || opt > man) {\n\t\t\topt = strdup(entry->arg);\n\t\t\tgoto optional;\n\t\t}\n\t\tman = strndup(opt, man - opt + 1);\n\t\toptargs = true;\n\t}\n\n\tif (parse_args(man, &w, \"<>\", flags) < 0) {\n\t\tprint_text(COLOR_HIGHLIGHT,\n\t\t\t\"Unable to parse mandatory command arguments: %s\", man );\n\t\tfree(man);\n\t\treturn -EINVAL;\n\t}\n\n\tfree(man);\n\n\t/* Check if there are enough arguments */\n\tif ((unsigned) argc - 1 < w.we_wordc) {\n\t\tprint_text(COLOR_HIGHLIGHT, \"Missing %s argument\",\n\t\t\t\t\t\tw.we_wordv[argc - 1]);\n\t\tgoto fail;\n\t}\n\n\tflags |= WRDE_APPEND;\n\topt = strdup(entry->arg + len + 1);\n\noptional:\n\tif (parse_args(opt, &w, \"[]\", flags) < 0) {\n\t\tprint_text(COLOR_HIGHLIGHT,\n\t\t\t\"Unable to parse optional command arguments: %s\", opt);\n\t\tfree(opt);\n\t\treturn -EINVAL;\n\t}\n\n\tfree(opt);\n\n\t/* Check if there are too many arguments */\n\tif (!optargs && ((unsigned int) argc - 1 > w.we_wordc && !w.we_offs)) {\n\t\tprint_text(COLOR_HIGHLIGHT, \"Too many arguments: %d > %zu\",\n\t\t\t\t\targc - 1, w.we_wordc);\n\t\tgoto fail;\n\t}\n\n\tw.we_offs = 0;\n\twordfree(&w);\n\nexec:\n\tdata.exec = entry;\n\n\tif (entry->func)\n\t\tentry->func(argc, argv);\n\n\tdata.exec = NULL;\n\n\treturn 0;\n\nfail:\n\tw.we_offs = 0;\n\twordfree(&w);\n\treturn -EINVAL;\n}"
  },
  {
    "function_name": "parse_args",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/shell.c",
    "lines": "271-289",
    "snippet": "static int parse_args(char *arg, wordexp_t *w, char *del, int flags)\n{\n\tchar *str;\n\n\tstr = strdelimit(arg, del, '\"');\n\n\tif (wordexp(str, w, flags)) {\n\t\tfree(str);\n\t\treturn -EINVAL;\n\t}\n\n\t/* If argument ends with ... set we_offs bypass strict checks */\n\tif (w->we_wordc && !strsuffix(w->we_wordv[w->we_wordc -1], \"...\"))\n\t\tw->we_offs = 1;\n\n\tfree(str);\n\n\treturn 0;\n}",
    "includes": [
      "#include \"src/shared/shell.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/mainloop.h\"",
      "#include <readline/history.h>",
      "#include <readline/readline.h>",
      "#include <getopt.h>",
      "#include <wordexp.h>",
      "#include <sys/signalfd.h>",
      "#include <signal.h>",
      "#include <stdbool.h>",
      "#include <stdarg.h>",
      "#include <stdlib.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "str"
          ],
          "line": 286
        },
        "resolved": true,
        "details": {
          "function_name": "bt_att_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/att.c",
          "lines": "956-985",
          "snippet": "static void bt_att_free(struct bt_att *att)\n{\n\tif (att->pending_req)\n\t\tdestroy_att_send_op(att->pending_req);\n\n\tif (att->pending_ind)\n\t\tdestroy_att_send_op(att->pending_ind);\n\n\tio_destroy(att->io);\n\tbt_crypto_unref(att->crypto);\n\n\tqueue_destroy(att->req_queue, NULL);\n\tqueue_destroy(att->ind_queue, NULL);\n\tqueue_destroy(att->write_queue, NULL);\n\tqueue_destroy(att->notify_list, NULL);\n\tqueue_destroy(att->disconn_list, NULL);\n\n\tif (att->timeout_destroy)\n\t\tatt->timeout_destroy(att->timeout_data);\n\n\tif (att->debug_destroy)\n\t\tatt->debug_destroy(att->debug_data);\n\n\tfree(att->local_sign);\n\tfree(att->remote_sign);\n\n\tfree(att->buf);\n\n\tfree(att);\n}",
          "includes": [
            "#include \"src/shared/crypto.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/l2cap.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/crypto.h\"\n#include \"src/shared/att.h\"\n#include \"lib/uuid.h\"\n#include \"lib/l2cap.h\"\n#include \"lib/bluetooth.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include <errno.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <config.h>\n\nstatic void bt_att_free(struct bt_att *att)\n{\n\tif (att->pending_req)\n\t\tdestroy_att_send_op(att->pending_req);\n\n\tif (att->pending_ind)\n\t\tdestroy_att_send_op(att->pending_ind);\n\n\tio_destroy(att->io);\n\tbt_crypto_unref(att->crypto);\n\n\tqueue_destroy(att->req_queue, NULL);\n\tqueue_destroy(att->ind_queue, NULL);\n\tqueue_destroy(att->write_queue, NULL);\n\tqueue_destroy(att->notify_list, NULL);\n\tqueue_destroy(att->disconn_list, NULL);\n\n\tif (att->timeout_destroy)\n\t\tatt->timeout_destroy(att->timeout_data);\n\n\tif (att->debug_destroy)\n\t\tatt->debug_destroy(att->debug_data);\n\n\tfree(att->local_sign);\n\tfree(att->remote_sign);\n\n\tfree(att->buf);\n\n\tfree(att);\n}"
        }
      },
      {
        "call_info": {
          "callee": "strsuffix",
          "args": [
            "w->we_wordv[w->we_wordc -1]",
            "\"...\""
          ],
          "line": 283
        },
        "resolved": true,
        "details": {
          "function_name": "strsuffix",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/util.c",
          "lines": "1007-1027",
          "snippet": "int strsuffix(const char *str, const char *suffix)\n{\n\tint len;\n\tint suffix_len;\n\n\tif (!str || !suffix)\n\t\treturn -1;\n\n\tif (str[0] == '\\0' && suffix[0] != '\\0')\n\t\treturn -1;\n\n\tif (suffix[0] == '\\0' && str[0] != '\\0')\n\t\treturn -1;\n\n\tlen = strlen(str);\n\tsuffix_len = strlen(suffix);\n\tif (len < suffix_len)\n\t\treturn -1;\n\n\treturn strncmp(str + len - suffix_len, suffix, suffix_len);\n}",
          "includes": [
            "#include \"src/shared/util.h\"",
            "#include <string.h>",
            "#include <limits.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <stdbool.h>",
            "#include <stdarg.h>",
            "#include <ctype.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/util.h\"\n#include <string.h>\n#include <limits.h>\n#include <dirent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <config.h>\n\nint strsuffix(const char *str, const char *suffix)\n{\n\tint len;\n\tint suffix_len;\n\n\tif (!str || !suffix)\n\t\treturn -1;\n\n\tif (str[0] == '\\0' && suffix[0] != '\\0')\n\t\treturn -1;\n\n\tif (suffix[0] == '\\0' && str[0] != '\\0')\n\t\treturn -1;\n\n\tlen = strlen(str);\n\tsuffix_len = strlen(suffix);\n\tif (len < suffix_len)\n\t\treturn -1;\n\n\treturn strncmp(str + len - suffix_len, suffix, suffix_len);\n}"
        }
      },
      {
        "call_info": {
          "callee": "wordexp",
          "args": [
            "str",
            "w",
            "flags"
          ],
          "line": 277
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strdelimit",
          "args": [
            "arg",
            "del",
            "'\"'"
          ],
          "line": 275
        },
        "resolved": true,
        "details": {
          "function_name": "strdelimit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/util.c",
          "lines": "984-1005",
          "snippet": "char *strdelimit(char *str, char *del, char c)\n{\n\tchar *dup;\n\n\tif (!str)\n\t\treturn NULL;\n\n\tdup = strdup(str);\n\tif (dup[0] == '\\0')\n\t\treturn dup;\n\n\twhile (del[0] != '\\0') {\n\t\tchar *rep = dup;\n\n\t\twhile ((rep = strchr(rep, del[0])))\n\t\t\trep[0] = c;\n\n\t\tdel++;\n\t}\n\n\treturn dup;\n}",
          "includes": [
            "#include \"src/shared/util.h\"",
            "#include <string.h>",
            "#include <limits.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <stdbool.h>",
            "#include <stdarg.h>",
            "#include <ctype.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/util.h\"\n#include <string.h>\n#include <limits.h>\n#include <dirent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <config.h>\n\nchar *strdelimit(char *str, char *del, char c)\n{\n\tchar *dup;\n\n\tif (!str)\n\t\treturn NULL;\n\n\tdup = strdup(str);\n\tif (dup[0] == '\\0')\n\t\treturn dup;\n\n\twhile (del[0] != '\\0') {\n\t\tchar *rep = dup;\n\n\t\twhile ((rep = strchr(rep, del[0])))\n\t\t\trep[0] = c;\n\n\t\tdel++;\n\t}\n\n\treturn dup;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/shell.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/mainloop.h\"\n#include <readline/history.h>\n#include <readline/readline.h>\n#include <getopt.h>\n#include <wordexp.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic int parse_args(char *arg, wordexp_t *w, char *del, int flags)\n{\n\tchar *str;\n\n\tstr = strdelimit(arg, del, '\"');\n\n\tif (wordexp(str, w, flags)) {\n\t\tfree(str);\n\t\treturn -EINVAL;\n\t}\n\n\t/* If argument ends with ... set we_offs bypass strict checks */\n\tif (w->we_wordc && !strsuffix(w->we_wordv[w->we_wordc -1], \"...\"))\n\t\tw->we_offs = 1;\n\n\tfree(str);\n\n\treturn 0;\n}"
  },
  {
    "function_name": "shell_print_menu",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/shell.c",
    "lines": "237-269",
    "snippet": "static void shell_print_menu(void)\n{\n\tconst struct bt_shell_menu_entry *entry;\n\tconst struct queue_entry *submenu;\n\n\tif (!data.menu)\n\t\treturn;\n\n\tprint_text(COLOR_HIGHLIGHT, \"Menu %s:\", data.menu->name);\n\tprint_text(COLOR_HIGHLIGHT, \"Available commands:\");\n\tprint_text(COLOR_HIGHLIGHT, \"-------------------\");\n\n\tif (data.menu == data.main) {\n\t\tfor (submenu = queue_get_entries(data.submenus); submenu;\n\t\t\t\t\t\tsubmenu = submenu->next) {\n\t\t\tstruct bt_shell_menu *menu = submenu->data;\n\n\t\t\tprint_submenu(menu->name, menu->desc ? menu->desc :\n\t\t\t\t\t\t\t\t\"Submenu\");\n\t\t}\n\t}\n\n\tfor (entry = data.menu->entries; entry->cmd; entry++) {\n\t\tprint_menu(entry->cmd, entry->arg ? : \"\", entry->desc ? : \"\");\n\t}\n\n\tfor (entry = default_menu; entry->cmd; entry++) {\n\t\tif (entry->exists && !entry->exists(data.menu))\n\t\t\tcontinue;\n\n\t\tprint_menu(entry->cmd, entry->arg ? : \"\", entry->desc ? : \"\");\n\t}\n}",
    "includes": [
      "#include \"src/shared/shell.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/mainloop.h\"",
      "#include <readline/history.h>",
      "#include <readline/readline.h>",
      "#include <getopt.h>",
      "#include <wordexp.h>",
      "#include <sys/signalfd.h>",
      "#include <signal.h>",
      "#include <stdbool.h>",
      "#include <stdarg.h>",
      "#include <stdlib.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void shell_print_menu(void);",
      "static const struct bt_shell_menu_entry default_menu[] = {\n\t{ \"back\",         NULL,       cmd_back, \"Return to main menu\", NULL,\n\t\t\t\t\t\t\tNULL, cmd_back_exists },\n\t{ \"menu\",         \"<name>\",   cmd_menu, \"Select submenu\",\n\t\t\t\t\t\t\tmenu_generator, NULL,\n\t\t\t\t\t\t\tcmd_menu_exists},\n\t{ \"version\",      NULL,       cmd_version, \"Display version\" },\n\t{ \"quit\",         NULL,       cmd_quit, \"Quit program\" },\n\t{ \"exit\",         NULL,       cmd_quit, \"Quit program\" },\n\t{ \"help\",         NULL,       cmd_help,\n\t\t\t\t\t\"Display help about this program\" },\n\t{ \"export\",       NULL,       cmd_export,\n\t\t\t\t\t\t\"Print evironment variables\" },\n\t{ }\n};"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "print_menu",
          "args": [
            "entry->cmd",
            "entry->arg ? : \"\"",
            "entry->desc ? : \"\""
          ],
          "line": 267
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "entry->exists",
          "args": [
            "data.menu"
          ],
          "line": 264
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "print_menu",
          "args": [
            "entry->cmd",
            "entry->arg ? : \"\"",
            "entry->desc ? : \"\""
          ],
          "line": 260
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "print_submenu",
          "args": [
            "menu->name",
            "menu->desc ? menu->desc :\n\t\t\t\t\t\t\t\t\"Submenu\""
          ],
          "line": 254
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "queue_get_entries",
          "args": [
            "data.submenus"
          ],
          "line": 250
        },
        "resolved": true,
        "details": {
          "function_name": "queue_get_entries",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "364-370",
          "snippet": "const struct queue_entry *queue_get_entries(struct queue *queue)\n{\n\tif (!queue)\n\t\treturn NULL;\n\n\treturn queue->head;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nconst struct queue_entry *queue_get_entries(struct queue *queue)\n{\n\tif (!queue)\n\t\treturn NULL;\n\n\treturn queue->head;\n}"
        }
      },
      {
        "call_info": {
          "callee": "print_text",
          "args": [
            "COLOR_HIGHLIGHT",
            "\"-------------------\""
          ],
          "line": 247
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "print_text",
          "args": [
            "COLOR_HIGHLIGHT",
            "\"Available commands:\""
          ],
          "line": 246
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "print_text",
          "args": [
            "COLOR_HIGHLIGHT",
            "\"Menu %s:\"",
            "data.menu->name"
          ],
          "line": 245
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/shell.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/mainloop.h\"\n#include <readline/history.h>\n#include <readline/readline.h>\n#include <getopt.h>\n#include <wordexp.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void shell_print_menu(void);\nstatic const struct bt_shell_menu_entry default_menu[] = {\n\t{ \"back\",         NULL,       cmd_back, \"Return to main menu\", NULL,\n\t\t\t\t\t\t\tNULL, cmd_back_exists },\n\t{ \"menu\",         \"<name>\",   cmd_menu, \"Select submenu\",\n\t\t\t\t\t\t\tmenu_generator, NULL,\n\t\t\t\t\t\t\tcmd_menu_exists},\n\t{ \"version\",      NULL,       cmd_version, \"Display version\" },\n\t{ \"quit\",         NULL,       cmd_quit, \"Quit program\" },\n\t{ \"exit\",         NULL,       cmd_quit, \"Quit program\" },\n\t{ \"help\",         NULL,       cmd_help,\n\t\t\t\t\t\"Display help about this program\" },\n\t{ \"export\",       NULL,       cmd_export,\n\t\t\t\t\t\t\"Print evironment variables\" },\n\t{ }\n};\n\nstatic void shell_print_menu(void)\n{\n\tconst struct bt_shell_menu_entry *entry;\n\tconst struct queue_entry *submenu;\n\n\tif (!data.menu)\n\t\treturn;\n\n\tprint_text(COLOR_HIGHLIGHT, \"Menu %s:\", data.menu->name);\n\tprint_text(COLOR_HIGHLIGHT, \"Available commands:\");\n\tprint_text(COLOR_HIGHLIGHT, \"-------------------\");\n\n\tif (data.menu == data.main) {\n\t\tfor (submenu = queue_get_entries(data.submenus); submenu;\n\t\t\t\t\t\tsubmenu = submenu->next) {\n\t\t\tstruct bt_shell_menu *menu = submenu->data;\n\n\t\t\tprint_submenu(menu->name, menu->desc ? menu->desc :\n\t\t\t\t\t\t\t\t\"Submenu\");\n\t\t}\n\t}\n\n\tfor (entry = data.menu->entries; entry->cmd; entry++) {\n\t\tprint_menu(entry->cmd, entry->arg ? : \"\", entry->desc ? : \"\");\n\t}\n\n\tfor (entry = default_menu; entry->cmd; entry++) {\n\t\tif (entry->exists && !entry->exists(data.menu))\n\t\t\tcontinue;\n\n\t\tprint_menu(entry->cmd, entry->arg ? : \"\", entry->desc ? : \"\");\n\t}\n}"
  },
  {
    "function_name": "shell_print_help",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/shell.c",
    "lines": "228-235",
    "snippet": "static void shell_print_help(void)\n{\n\tprint_text(COLOR_HIGHLIGHT,\n\t\t\"\\n\"\n\t\t\"Use \\\"help\\\" for a list of available commands in a menu.\\n\"\n\t\t\"Use \\\"menu <submenu>\\\" if you want to enter any submenu.\\n\"\n\t\t\"Use \\\"back\\\" if you want to return to menu main.\");\n}",
    "includes": [
      "#include \"src/shared/shell.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/mainloop.h\"",
      "#include <readline/history.h>",
      "#include <readline/readline.h>",
      "#include <getopt.h>",
      "#include <wordexp.h>",
      "#include <sys/signalfd.h>",
      "#include <signal.h>",
      "#include <stdbool.h>",
      "#include <stdarg.h>",
      "#include <stdlib.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "print_text",
          "args": [
            "COLOR_HIGHLIGHT",
            "\"\\n\"\n\t\t\"Use \\\"help\\\" for a list of available commands in a menu.\\n\"\n\t\t\"Use \\\"menu <submenu>\\\" if you want to enter any submenu.\\n\"\n\t\t\"Use \\\"back\\\" if you want to return to menu main.\""
          ],
          "line": 230
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/shell.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/mainloop.h\"\n#include <readline/history.h>\n#include <readline/readline.h>\n#include <getopt.h>\n#include <wordexp.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void shell_print_help(void)\n{\n\tprint_text(COLOR_HIGHLIGHT,\n\t\t\"\\n\"\n\t\t\"Use \\\"help\\\" for a list of available commands in a menu.\\n\"\n\t\t\"Use \\\"menu <submenu>\\\" if you want to enter any submenu.\\n\"\n\t\t\"Use \\\"back\\\" if you want to return to menu main.\");\n}"
  },
  {
    "function_name": "cmd_export",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/shell.c",
    "lines": "201-210",
    "snippet": "static void cmd_export(int argc, char *argv[])\n{\n\tconst struct queue_entry *entry;\n\n\tfor (entry = queue_get_entries(data.envs); entry; entry = entry->next) {\n\t\tstruct bt_shell_env *env = entry->data;\n\n\t\tprint_text(COLOR_HIGHLIGHT, \"%s=%p\", env->name, env->value);\n\t}\n}",
    "includes": [
      "#include \"src/shared/shell.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/mainloop.h\"",
      "#include <readline/history.h>",
      "#include <readline/readline.h>",
      "#include <getopt.h>",
      "#include <wordexp.h>",
      "#include <sys/signalfd.h>",
      "#include <signal.h>",
      "#include <stdbool.h>",
      "#include <stdarg.h>",
      "#include <stdlib.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "print_text",
          "args": [
            "COLOR_HIGHLIGHT",
            "\"%s=%p\"",
            "env->name",
            "env->value"
          ],
          "line": 208
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "queue_get_entries",
          "args": [
            "data.envs"
          ],
          "line": 205
        },
        "resolved": true,
        "details": {
          "function_name": "queue_get_entries",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "364-370",
          "snippet": "const struct queue_entry *queue_get_entries(struct queue *queue)\n{\n\tif (!queue)\n\t\treturn NULL;\n\n\treturn queue->head;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nconst struct queue_entry *queue_get_entries(struct queue *queue)\n{\n\tif (!queue)\n\t\treturn NULL;\n\n\treturn queue->head;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/shell.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/mainloop.h\"\n#include <readline/history.h>\n#include <readline/readline.h>\n#include <getopt.h>\n#include <wordexp.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void cmd_export(int argc, char *argv[])\n{\n\tconst struct queue_entry *entry;\n\n\tfor (entry = queue_get_entries(data.envs); entry; entry = entry->next) {\n\t\tstruct bt_shell_env *env = entry->data;\n\n\t\tprint_text(COLOR_HIGHLIGHT, \"%s=%p\", env->name, env->value);\n\t}\n}"
  },
  {
    "function_name": "cmd_back_exists",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/shell.c",
    "lines": "192-199",
    "snippet": "static bool cmd_back_exists(const struct bt_shell_menu *menu)\n{\n\t/* Skip back command if on main menu */\n\tif (menu == data.main)\n\t\treturn false;\n\n\treturn true;\n}",
    "includes": [
      "#include \"src/shared/shell.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/mainloop.h\"",
      "#include <readline/history.h>",
      "#include <readline/readline.h>",
      "#include <getopt.h>",
      "#include <wordexp.h>",
      "#include <sys/signalfd.h>",
      "#include <signal.h>",
      "#include <stdbool.h>",
      "#include <stdarg.h>",
      "#include <stdlib.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"src/shared/shell.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/mainloop.h\"\n#include <readline/history.h>\n#include <readline/readline.h>\n#include <getopt.h>\n#include <wordexp.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic bool cmd_back_exists(const struct bt_shell_menu *menu)\n{\n\t/* Skip back command if on main menu */\n\tif (menu == data.main)\n\t\treturn false;\n\n\treturn true;\n}"
  },
  {
    "function_name": "cmd_back",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/shell.c",
    "lines": "180-190",
    "snippet": "static void cmd_back(int argc, char *argv[])\n{\n\tif (data.menu == data.main) {\n\t\tbt_shell_printf(\"Already on main menu\\n\");\n\t\treturn;\n\t}\n\n\tbt_shell_set_menu(data.main);\n\n\tshell_print_menu();\n}",
    "includes": [
      "#include \"src/shared/shell.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/mainloop.h\"",
      "#include <readline/history.h>",
      "#include <readline/readline.h>",
      "#include <getopt.h>",
      "#include <wordexp.h>",
      "#include <sys/signalfd.h>",
      "#include <signal.h>",
      "#include <stdbool.h>",
      "#include <stdarg.h>",
      "#include <stdlib.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void shell_print_menu(void);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "shell_print_menu",
          "args": [],
          "line": 189
        },
        "resolved": true,
        "details": {
          "function_name": "shell_print_menu",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/shell.c",
          "lines": "237-269",
          "snippet": "static void shell_print_menu(void)\n{\n\tconst struct bt_shell_menu_entry *entry;\n\tconst struct queue_entry *submenu;\n\n\tif (!data.menu)\n\t\treturn;\n\n\tprint_text(COLOR_HIGHLIGHT, \"Menu %s:\", data.menu->name);\n\tprint_text(COLOR_HIGHLIGHT, \"Available commands:\");\n\tprint_text(COLOR_HIGHLIGHT, \"-------------------\");\n\n\tif (data.menu == data.main) {\n\t\tfor (submenu = queue_get_entries(data.submenus); submenu;\n\t\t\t\t\t\tsubmenu = submenu->next) {\n\t\t\tstruct bt_shell_menu *menu = submenu->data;\n\n\t\t\tprint_submenu(menu->name, menu->desc ? menu->desc :\n\t\t\t\t\t\t\t\t\"Submenu\");\n\t\t}\n\t}\n\n\tfor (entry = data.menu->entries; entry->cmd; entry++) {\n\t\tprint_menu(entry->cmd, entry->arg ? : \"\", entry->desc ? : \"\");\n\t}\n\n\tfor (entry = default_menu; entry->cmd; entry++) {\n\t\tif (entry->exists && !entry->exists(data.menu))\n\t\t\tcontinue;\n\n\t\tprint_menu(entry->cmd, entry->arg ? : \"\", entry->desc ? : \"\");\n\t}\n}",
          "includes": [
            "#include \"src/shared/shell.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/mainloop.h\"",
            "#include <readline/history.h>",
            "#include <readline/readline.h>",
            "#include <getopt.h>",
            "#include <wordexp.h>",
            "#include <sys/signalfd.h>",
            "#include <signal.h>",
            "#include <stdbool.h>",
            "#include <stdarg.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void shell_print_menu(void);",
            "static const struct bt_shell_menu_entry default_menu[] = {\n\t{ \"back\",         NULL,       cmd_back, \"Return to main menu\", NULL,\n\t\t\t\t\t\t\tNULL, cmd_back_exists },\n\t{ \"menu\",         \"<name>\",   cmd_menu, \"Select submenu\",\n\t\t\t\t\t\t\tmenu_generator, NULL,\n\t\t\t\t\t\t\tcmd_menu_exists},\n\t{ \"version\",      NULL,       cmd_version, \"Display version\" },\n\t{ \"quit\",         NULL,       cmd_quit, \"Quit program\" },\n\t{ \"exit\",         NULL,       cmd_quit, \"Quit program\" },\n\t{ \"help\",         NULL,       cmd_help,\n\t\t\t\t\t\"Display help about this program\" },\n\t{ \"export\",       NULL,       cmd_export,\n\t\t\t\t\t\t\"Print evironment variables\" },\n\t{ }\n};"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/shell.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/mainloop.h\"\n#include <readline/history.h>\n#include <readline/readline.h>\n#include <getopt.h>\n#include <wordexp.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void shell_print_menu(void);\nstatic const struct bt_shell_menu_entry default_menu[] = {\n\t{ \"back\",         NULL,       cmd_back, \"Return to main menu\", NULL,\n\t\t\t\t\t\t\tNULL, cmd_back_exists },\n\t{ \"menu\",         \"<name>\",   cmd_menu, \"Select submenu\",\n\t\t\t\t\t\t\tmenu_generator, NULL,\n\t\t\t\t\t\t\tcmd_menu_exists},\n\t{ \"version\",      NULL,       cmd_version, \"Display version\" },\n\t{ \"quit\",         NULL,       cmd_quit, \"Quit program\" },\n\t{ \"exit\",         NULL,       cmd_quit, \"Quit program\" },\n\t{ \"help\",         NULL,       cmd_help,\n\t\t\t\t\t\"Display help about this program\" },\n\t{ \"export\",       NULL,       cmd_export,\n\t\t\t\t\t\t\"Print evironment variables\" },\n\t{ }\n};\n\nstatic void shell_print_menu(void)\n{\n\tconst struct bt_shell_menu_entry *entry;\n\tconst struct queue_entry *submenu;\n\n\tif (!data.menu)\n\t\treturn;\n\n\tprint_text(COLOR_HIGHLIGHT, \"Menu %s:\", data.menu->name);\n\tprint_text(COLOR_HIGHLIGHT, \"Available commands:\");\n\tprint_text(COLOR_HIGHLIGHT, \"-------------------\");\n\n\tif (data.menu == data.main) {\n\t\tfor (submenu = queue_get_entries(data.submenus); submenu;\n\t\t\t\t\t\tsubmenu = submenu->next) {\n\t\t\tstruct bt_shell_menu *menu = submenu->data;\n\n\t\t\tprint_submenu(menu->name, menu->desc ? menu->desc :\n\t\t\t\t\t\t\t\t\"Submenu\");\n\t\t}\n\t}\n\n\tfor (entry = data.menu->entries; entry->cmd; entry++) {\n\t\tprint_menu(entry->cmd, entry->arg ? : \"\", entry->desc ? : \"\");\n\t}\n\n\tfor (entry = default_menu; entry->cmd; entry++) {\n\t\tif (entry->exists && !entry->exists(data.menu))\n\t\t\tcontinue;\n\n\t\tprint_menu(entry->cmd, entry->arg ? : \"\", entry->desc ? : \"\");\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "bt_shell_set_menu",
          "args": [
            "data.main"
          ],
          "line": 187
        },
        "resolved": true,
        "details": {
          "function_name": "bt_shell_set_menu",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/shell.c",
          "lines": "1111-1122",
          "snippet": "bool bt_shell_set_menu(const struct bt_shell_menu *menu)\n{\n\tif (!menu)\n\t\treturn false;\n\n\tdata.menu = menu;\n\n\tif (!data.main)\n\t\tdata.main = menu;\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/shell.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/mainloop.h\"",
            "#include <readline/history.h>",
            "#include <readline/readline.h>",
            "#include <getopt.h>",
            "#include <wordexp.h>",
            "#include <sys/signalfd.h>",
            "#include <signal.h>",
            "#include <stdbool.h>",
            "#include <stdarg.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/shell.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/mainloop.h\"\n#include <readline/history.h>\n#include <readline/readline.h>\n#include <getopt.h>\n#include <wordexp.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nbool bt_shell_set_menu(const struct bt_shell_menu *menu)\n{\n\tif (!menu)\n\t\treturn false;\n\n\tdata.menu = menu;\n\n\tif (!data.main)\n\t\tdata.main = menu;\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "bt_shell_printf",
          "args": [
            "\"Already on main menu\\n\""
          ],
          "line": 183
        },
        "resolved": true,
        "details": {
          "function_name": "bt_shell_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/shell.c",
          "lines": "458-498",
          "snippet": "void bt_shell_printf(const char *fmt, ...)\n{\n\tva_list args;\n\tbool save_input;\n\tchar *saved_line;\n\tint saved_point;\n\n\tif (!data.input)\n\t\treturn;\n\n\tif (data.mode) {\n\t\tva_start(args, fmt);\n\t\tvprintf(fmt, args);\n\t\tva_end(args);\n\t\treturn;\n\t}\n\n\tsave_input = !RL_ISSTATE(RL_STATE_DONE);\n\n\tif (save_input) {\n\t\tsaved_point = rl_point;\n\t\tsaved_line = rl_copy_text(0, rl_end);\n\t\tif (!data.saved_prompt)\n\t\t\trl_save_prompt();\n\t\trl_replace_line(\"\", 0);\n\t\trl_redisplay();\n\t}\n\n\tva_start(args, fmt);\n\tvprintf(fmt, args);\n\tva_end(args);\n\n\tif (save_input) {\n\t\tif (!data.saved_prompt)\n\t\t\trl_restore_prompt();\n\t\trl_replace_line(saved_line, 0);\n\t\trl_point = saved_point;\n\t\trl_forced_update_display();\n\t\tfree(saved_line);\n\t}\n}",
          "includes": [
            "#include \"src/shared/shell.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/mainloop.h\"",
            "#include <readline/history.h>",
            "#include <readline/readline.h>",
            "#include <getopt.h>",
            "#include <wordexp.h>",
            "#include <sys/signalfd.h>",
            "#include <signal.h>",
            "#include <stdbool.h>",
            "#include <stdarg.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static wordexp_t args;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/shell.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/mainloop.h\"\n#include <readline/history.h>\n#include <readline/readline.h>\n#include <getopt.h>\n#include <wordexp.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic wordexp_t args;\n\nvoid bt_shell_printf(const char *fmt, ...)\n{\n\tva_list args;\n\tbool save_input;\n\tchar *saved_line;\n\tint saved_point;\n\n\tif (!data.input)\n\t\treturn;\n\n\tif (data.mode) {\n\t\tva_start(args, fmt);\n\t\tvprintf(fmt, args);\n\t\tva_end(args);\n\t\treturn;\n\t}\n\n\tsave_input = !RL_ISSTATE(RL_STATE_DONE);\n\n\tif (save_input) {\n\t\tsaved_point = rl_point;\n\t\tsaved_line = rl_copy_text(0, rl_end);\n\t\tif (!data.saved_prompt)\n\t\t\trl_save_prompt();\n\t\trl_replace_line(\"\", 0);\n\t\trl_redisplay();\n\t}\n\n\tva_start(args, fmt);\n\tvprintf(fmt, args);\n\tva_end(args);\n\n\tif (save_input) {\n\t\tif (!data.saved_prompt)\n\t\t\trl_restore_prompt();\n\t\trl_replace_line(saved_line, 0);\n\t\trl_point = saved_point;\n\t\trl_forced_update_display();\n\t\tfree(saved_line);\n\t}\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/shell.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/mainloop.h\"\n#include <readline/history.h>\n#include <readline/readline.h>\n#include <getopt.h>\n#include <wordexp.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void shell_print_menu(void);\n\nstatic void cmd_back(int argc, char *argv[])\n{\n\tif (data.menu == data.main) {\n\t\tbt_shell_printf(\"Already on main menu\\n\");\n\t\treturn;\n\t}\n\n\tbt_shell_set_menu(data.main);\n\n\tshell_print_menu();\n}"
  },
  {
    "function_name": "cmd_menu_exists",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/shell.c",
    "lines": "169-178",
    "snippet": "static bool cmd_menu_exists(const struct bt_shell_menu *menu)\n{\n\t/* Skip menu command if not on main menu or if there are no\n\t * submenus.\n\t */\n\tif (menu != data.main || queue_isempty(data.submenus))\n\t\treturn false;\n\n\treturn true;\n}",
    "includes": [
      "#include \"src/shared/shell.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/mainloop.h\"",
      "#include <readline/history.h>",
      "#include <readline/readline.h>",
      "#include <getopt.h>",
      "#include <wordexp.h>",
      "#include <sys/signalfd.h>",
      "#include <signal.h>",
      "#include <stdbool.h>",
      "#include <stdarg.h>",
      "#include <stdlib.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "queue_isempty",
          "args": [
            "data.submenus"
          ],
          "line": 174
        },
        "resolved": true,
        "details": {
          "function_name": "queue_isempty",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "380-386",
          "snippet": "bool queue_isempty(struct queue *queue)\n{\n\tif (!queue)\n\t\treturn true;\n\n\treturn queue->entries == 0;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nbool queue_isempty(struct queue *queue)\n{\n\tif (!queue)\n\t\treturn true;\n\n\treturn queue->entries == 0;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/shell.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/mainloop.h\"\n#include <readline/history.h>\n#include <readline/readline.h>\n#include <getopt.h>\n#include <wordexp.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic bool cmd_menu_exists(const struct bt_shell_menu *menu)\n{\n\t/* Skip menu command if not on main menu or if there are no\n\t * submenus.\n\t */\n\tif (menu != data.main || queue_isempty(data.submenus))\n\t\treturn false;\n\n\treturn true;\n}"
  },
  {
    "function_name": "cmd_menu",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/shell.c",
    "lines": "147-167",
    "snippet": "static void cmd_menu(int argc, char *argv[])\n{\n\tconst struct bt_shell_menu *menu;\n\n\tif (argc < 2 || !strlen(argv[1])) {\n\t\tbt_shell_printf(\"Missing name argument\\n\");\n\t\treturn bt_shell_noninteractive_quit(EXIT_FAILURE);\n\t}\n\n\tmenu = find_menu(argv[1], strlen(argv[1]));\n\tif (!menu) {\n\t\tbt_shell_printf(\"Unable find menu with name: %s\\n\", argv[1]);\n\t\treturn bt_shell_noninteractive_quit(EXIT_FAILURE);\n\t}\n\n\tbt_shell_set_menu(menu);\n\n\tshell_print_menu();\n\n\treturn bt_shell_noninteractive_quit(EXIT_SUCCESS);\n}",
    "includes": [
      "#include \"src/shared/shell.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/mainloop.h\"",
      "#include <readline/history.h>",
      "#include <readline/readline.h>",
      "#include <getopt.h>",
      "#include <wordexp.h>",
      "#include <sys/signalfd.h>",
      "#include <signal.h>",
      "#include <stdbool.h>",
      "#include <stdarg.h>",
      "#include <stdlib.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void shell_print_menu(void);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "bt_shell_noninteractive_quit",
          "args": [
            "EXIT_SUCCESS"
          ],
          "line": 166
        },
        "resolved": true,
        "details": {
          "function_name": "bt_shell_noninteractive_quit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/shell.c",
          "lines": "1103-1109",
          "snippet": "void bt_shell_noninteractive_quit(int status)\n{\n\tif (!data.mode || data.timeout)\n\t\treturn;\n\n\tbt_shell_quit(status);\n}",
          "includes": [
            "#include \"src/shared/shell.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/mainloop.h\"",
            "#include <readline/history.h>",
            "#include <readline/readline.h>",
            "#include <getopt.h>",
            "#include <wordexp.h>",
            "#include <sys/signalfd.h>",
            "#include <signal.h>",
            "#include <stdbool.h>",
            "#include <stdarg.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/shell.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/mainloop.h\"\n#include <readline/history.h>\n#include <readline/readline.h>\n#include <getopt.h>\n#include <wordexp.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nvoid bt_shell_noninteractive_quit(int status)\n{\n\tif (!data.mode || data.timeout)\n\t\treturn;\n\n\tbt_shell_quit(status);\n}"
        }
      },
      {
        "call_info": {
          "callee": "shell_print_menu",
          "args": [],
          "line": 164
        },
        "resolved": true,
        "details": {
          "function_name": "shell_print_menu",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/shell.c",
          "lines": "237-269",
          "snippet": "static void shell_print_menu(void)\n{\n\tconst struct bt_shell_menu_entry *entry;\n\tconst struct queue_entry *submenu;\n\n\tif (!data.menu)\n\t\treturn;\n\n\tprint_text(COLOR_HIGHLIGHT, \"Menu %s:\", data.menu->name);\n\tprint_text(COLOR_HIGHLIGHT, \"Available commands:\");\n\tprint_text(COLOR_HIGHLIGHT, \"-------------------\");\n\n\tif (data.menu == data.main) {\n\t\tfor (submenu = queue_get_entries(data.submenus); submenu;\n\t\t\t\t\t\tsubmenu = submenu->next) {\n\t\t\tstruct bt_shell_menu *menu = submenu->data;\n\n\t\t\tprint_submenu(menu->name, menu->desc ? menu->desc :\n\t\t\t\t\t\t\t\t\"Submenu\");\n\t\t}\n\t}\n\n\tfor (entry = data.menu->entries; entry->cmd; entry++) {\n\t\tprint_menu(entry->cmd, entry->arg ? : \"\", entry->desc ? : \"\");\n\t}\n\n\tfor (entry = default_menu; entry->cmd; entry++) {\n\t\tif (entry->exists && !entry->exists(data.menu))\n\t\t\tcontinue;\n\n\t\tprint_menu(entry->cmd, entry->arg ? : \"\", entry->desc ? : \"\");\n\t}\n}",
          "includes": [
            "#include \"src/shared/shell.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/mainloop.h\"",
            "#include <readline/history.h>",
            "#include <readline/readline.h>",
            "#include <getopt.h>",
            "#include <wordexp.h>",
            "#include <sys/signalfd.h>",
            "#include <signal.h>",
            "#include <stdbool.h>",
            "#include <stdarg.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void shell_print_menu(void);",
            "static const struct bt_shell_menu_entry default_menu[] = {\n\t{ \"back\",         NULL,       cmd_back, \"Return to main menu\", NULL,\n\t\t\t\t\t\t\tNULL, cmd_back_exists },\n\t{ \"menu\",         \"<name>\",   cmd_menu, \"Select submenu\",\n\t\t\t\t\t\t\tmenu_generator, NULL,\n\t\t\t\t\t\t\tcmd_menu_exists},\n\t{ \"version\",      NULL,       cmd_version, \"Display version\" },\n\t{ \"quit\",         NULL,       cmd_quit, \"Quit program\" },\n\t{ \"exit\",         NULL,       cmd_quit, \"Quit program\" },\n\t{ \"help\",         NULL,       cmd_help,\n\t\t\t\t\t\"Display help about this program\" },\n\t{ \"export\",       NULL,       cmd_export,\n\t\t\t\t\t\t\"Print evironment variables\" },\n\t{ }\n};"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/shell.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/mainloop.h\"\n#include <readline/history.h>\n#include <readline/readline.h>\n#include <getopt.h>\n#include <wordexp.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void shell_print_menu(void);\nstatic const struct bt_shell_menu_entry default_menu[] = {\n\t{ \"back\",         NULL,       cmd_back, \"Return to main menu\", NULL,\n\t\t\t\t\t\t\tNULL, cmd_back_exists },\n\t{ \"menu\",         \"<name>\",   cmd_menu, \"Select submenu\",\n\t\t\t\t\t\t\tmenu_generator, NULL,\n\t\t\t\t\t\t\tcmd_menu_exists},\n\t{ \"version\",      NULL,       cmd_version, \"Display version\" },\n\t{ \"quit\",         NULL,       cmd_quit, \"Quit program\" },\n\t{ \"exit\",         NULL,       cmd_quit, \"Quit program\" },\n\t{ \"help\",         NULL,       cmd_help,\n\t\t\t\t\t\"Display help about this program\" },\n\t{ \"export\",       NULL,       cmd_export,\n\t\t\t\t\t\t\"Print evironment variables\" },\n\t{ }\n};\n\nstatic void shell_print_menu(void)\n{\n\tconst struct bt_shell_menu_entry *entry;\n\tconst struct queue_entry *submenu;\n\n\tif (!data.menu)\n\t\treturn;\n\n\tprint_text(COLOR_HIGHLIGHT, \"Menu %s:\", data.menu->name);\n\tprint_text(COLOR_HIGHLIGHT, \"Available commands:\");\n\tprint_text(COLOR_HIGHLIGHT, \"-------------------\");\n\n\tif (data.menu == data.main) {\n\t\tfor (submenu = queue_get_entries(data.submenus); submenu;\n\t\t\t\t\t\tsubmenu = submenu->next) {\n\t\t\tstruct bt_shell_menu *menu = submenu->data;\n\n\t\t\tprint_submenu(menu->name, menu->desc ? menu->desc :\n\t\t\t\t\t\t\t\t\"Submenu\");\n\t\t}\n\t}\n\n\tfor (entry = data.menu->entries; entry->cmd; entry++) {\n\t\tprint_menu(entry->cmd, entry->arg ? : \"\", entry->desc ? : \"\");\n\t}\n\n\tfor (entry = default_menu; entry->cmd; entry++) {\n\t\tif (entry->exists && !entry->exists(data.menu))\n\t\t\tcontinue;\n\n\t\tprint_menu(entry->cmd, entry->arg ? : \"\", entry->desc ? : \"\");\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "bt_shell_set_menu",
          "args": [
            "menu"
          ],
          "line": 162
        },
        "resolved": true,
        "details": {
          "function_name": "bt_shell_set_menu",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/shell.c",
          "lines": "1111-1122",
          "snippet": "bool bt_shell_set_menu(const struct bt_shell_menu *menu)\n{\n\tif (!menu)\n\t\treturn false;\n\n\tdata.menu = menu;\n\n\tif (!data.main)\n\t\tdata.main = menu;\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/shell.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/mainloop.h\"",
            "#include <readline/history.h>",
            "#include <readline/readline.h>",
            "#include <getopt.h>",
            "#include <wordexp.h>",
            "#include <sys/signalfd.h>",
            "#include <signal.h>",
            "#include <stdbool.h>",
            "#include <stdarg.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/shell.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/mainloop.h\"\n#include <readline/history.h>\n#include <readline/readline.h>\n#include <getopt.h>\n#include <wordexp.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nbool bt_shell_set_menu(const struct bt_shell_menu *menu)\n{\n\tif (!menu)\n\t\treturn false;\n\n\tdata.menu = menu;\n\n\tif (!data.main)\n\t\tdata.main = menu;\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "bt_shell_printf",
          "args": [
            "\"Unable find menu with name: %s\\n\"",
            "argv[1]"
          ],
          "line": 158
        },
        "resolved": true,
        "details": {
          "function_name": "bt_shell_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/shell.c",
          "lines": "458-498",
          "snippet": "void bt_shell_printf(const char *fmt, ...)\n{\n\tva_list args;\n\tbool save_input;\n\tchar *saved_line;\n\tint saved_point;\n\n\tif (!data.input)\n\t\treturn;\n\n\tif (data.mode) {\n\t\tva_start(args, fmt);\n\t\tvprintf(fmt, args);\n\t\tva_end(args);\n\t\treturn;\n\t}\n\n\tsave_input = !RL_ISSTATE(RL_STATE_DONE);\n\n\tif (save_input) {\n\t\tsaved_point = rl_point;\n\t\tsaved_line = rl_copy_text(0, rl_end);\n\t\tif (!data.saved_prompt)\n\t\t\trl_save_prompt();\n\t\trl_replace_line(\"\", 0);\n\t\trl_redisplay();\n\t}\n\n\tva_start(args, fmt);\n\tvprintf(fmt, args);\n\tva_end(args);\n\n\tif (save_input) {\n\t\tif (!data.saved_prompt)\n\t\t\trl_restore_prompt();\n\t\trl_replace_line(saved_line, 0);\n\t\trl_point = saved_point;\n\t\trl_forced_update_display();\n\t\tfree(saved_line);\n\t}\n}",
          "includes": [
            "#include \"src/shared/shell.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/mainloop.h\"",
            "#include <readline/history.h>",
            "#include <readline/readline.h>",
            "#include <getopt.h>",
            "#include <wordexp.h>",
            "#include <sys/signalfd.h>",
            "#include <signal.h>",
            "#include <stdbool.h>",
            "#include <stdarg.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static wordexp_t args;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/shell.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/mainloop.h\"\n#include <readline/history.h>\n#include <readline/readline.h>\n#include <getopt.h>\n#include <wordexp.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic wordexp_t args;\n\nvoid bt_shell_printf(const char *fmt, ...)\n{\n\tva_list args;\n\tbool save_input;\n\tchar *saved_line;\n\tint saved_point;\n\n\tif (!data.input)\n\t\treturn;\n\n\tif (data.mode) {\n\t\tva_start(args, fmt);\n\t\tvprintf(fmt, args);\n\t\tva_end(args);\n\t\treturn;\n\t}\n\n\tsave_input = !RL_ISSTATE(RL_STATE_DONE);\n\n\tif (save_input) {\n\t\tsaved_point = rl_point;\n\t\tsaved_line = rl_copy_text(0, rl_end);\n\t\tif (!data.saved_prompt)\n\t\t\trl_save_prompt();\n\t\trl_replace_line(\"\", 0);\n\t\trl_redisplay();\n\t}\n\n\tva_start(args, fmt);\n\tvprintf(fmt, args);\n\tva_end(args);\n\n\tif (save_input) {\n\t\tif (!data.saved_prompt)\n\t\t\trl_restore_prompt();\n\t\trl_replace_line(saved_line, 0);\n\t\trl_point = saved_point;\n\t\trl_forced_update_display();\n\t\tfree(saved_line);\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "find_menu",
          "args": [
            "argv[1]",
            "strlen(argv[1])"
          ],
          "line": 156
        },
        "resolved": true,
        "details": {
          "function_name": "find_menu",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/shell.c",
          "lines": "107-120",
          "snippet": "static const struct bt_shell_menu *find_menu(const char *name, size_t len)\n{\n\tconst struct queue_entry *entry;\n\n\tfor (entry = queue_get_entries(data.submenus); entry;\n\t\t\t\t\t\tentry = entry->next) {\n\t\tstruct bt_shell_menu *menu = entry->data;\n\n\t\tif (!strncmp(menu->name, name, len))\n\t\t\treturn menu;\n\t}\n\n\treturn NULL;\n}",
          "includes": [
            "#include \"src/shared/shell.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/mainloop.h\"",
            "#include <readline/history.h>",
            "#include <readline/readline.h>",
            "#include <getopt.h>",
            "#include <wordexp.h>",
            "#include <sys/signalfd.h>",
            "#include <signal.h>",
            "#include <stdbool.h>",
            "#include <stdarg.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/shell.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/mainloop.h\"\n#include <readline/history.h>\n#include <readline/readline.h>\n#include <getopt.h>\n#include <wordexp.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic const struct bt_shell_menu *find_menu(const char *name, size_t len)\n{\n\tconst struct queue_entry *entry;\n\n\tfor (entry = queue_get_entries(data.submenus); entry;\n\t\t\t\t\t\tentry = entry->next) {\n\t\tstruct bt_shell_menu *menu = entry->data;\n\n\t\tif (!strncmp(menu->name, name, len))\n\t\t\treturn menu;\n\t}\n\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "argv[1]"
          ],
          "line": 156
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "argv[1]"
          ],
          "line": 151
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/shell.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/mainloop.h\"\n#include <readline/history.h>\n#include <readline/readline.h>\n#include <getopt.h>\n#include <wordexp.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void shell_print_menu(void);\n\nstatic void cmd_menu(int argc, char *argv[])\n{\n\tconst struct bt_shell_menu *menu;\n\n\tif (argc < 2 || !strlen(argv[1])) {\n\t\tbt_shell_printf(\"Missing name argument\\n\");\n\t\treturn bt_shell_noninteractive_quit(EXIT_FAILURE);\n\t}\n\n\tmenu = find_menu(argv[1], strlen(argv[1]));\n\tif (!menu) {\n\t\tbt_shell_printf(\"Unable find menu with name: %s\\n\", argv[1]);\n\t\treturn bt_shell_noninteractive_quit(EXIT_FAILURE);\n\t}\n\n\tbt_shell_set_menu(menu);\n\n\tshell_print_menu();\n\n\treturn bt_shell_noninteractive_quit(EXIT_SUCCESS);\n}"
  },
  {
    "function_name": "menu_generator",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/shell.c",
    "lines": "122-145",
    "snippet": "static char *menu_generator(const char *text, int state)\n{\n\tstatic unsigned int index, len;\n\tstatic struct queue_entry *entry;\n\n\tif (!state) {\n\t\tindex = 0;\n\t\tlen = strlen(text);\n\t\tentry = (void *) queue_get_entries(data.submenus);\n\t}\n\n\tfor (; entry; entry = entry->next) {\n\t\tstruct bt_shell_menu *menu = entry->data;\n\n\t\tindex++;\n\n\t\tif (!strncmp(menu->name, text, len)) {\n\t\t\tentry = entry->next;\n\t\t\treturn strdup(menu->name);\n\t\t}\n\t}\n\n\treturn NULL;\n}",
    "includes": [
      "#include \"src/shared/shell.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/mainloop.h\"",
      "#include <readline/history.h>",
      "#include <readline/readline.h>",
      "#include <getopt.h>",
      "#include <wordexp.h>",
      "#include <sys/signalfd.h>",
      "#include <signal.h>",
      "#include <stdbool.h>",
      "#include <stdarg.h>",
      "#include <stdlib.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "strdup",
          "args": [
            "menu->name"
          ],
          "line": 140
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strncmp",
          "args": [
            "menu->name",
            "text",
            "len"
          ],
          "line": 138
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "queue_get_entries",
          "args": [
            "data.submenus"
          ],
          "line": 130
        },
        "resolved": true,
        "details": {
          "function_name": "queue_get_entries",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "364-370",
          "snippet": "const struct queue_entry *queue_get_entries(struct queue *queue)\n{\n\tif (!queue)\n\t\treturn NULL;\n\n\treturn queue->head;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nconst struct queue_entry *queue_get_entries(struct queue *queue)\n{\n\tif (!queue)\n\t\treturn NULL;\n\n\treturn queue->head;\n}"
        }
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "text"
          ],
          "line": 129
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/shell.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/mainloop.h\"\n#include <readline/history.h>\n#include <readline/readline.h>\n#include <getopt.h>\n#include <wordexp.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic char *menu_generator(const char *text, int state)\n{\n\tstatic unsigned int index, len;\n\tstatic struct queue_entry *entry;\n\n\tif (!state) {\n\t\tindex = 0;\n\t\tlen = strlen(text);\n\t\tentry = (void *) queue_get_entries(data.submenus);\n\t}\n\n\tfor (; entry; entry = entry->next) {\n\t\tstruct bt_shell_menu *menu = entry->data;\n\n\t\tindex++;\n\n\t\tif (!strncmp(menu->name, text, len)) {\n\t\t\tentry = entry->next;\n\t\t\treturn strdup(menu->name);\n\t\t}\n\t}\n\n\treturn NULL;\n}"
  },
  {
    "function_name": "find_menu",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/shell.c",
    "lines": "107-120",
    "snippet": "static const struct bt_shell_menu *find_menu(const char *name, size_t len)\n{\n\tconst struct queue_entry *entry;\n\n\tfor (entry = queue_get_entries(data.submenus); entry;\n\t\t\t\t\t\tentry = entry->next) {\n\t\tstruct bt_shell_menu *menu = entry->data;\n\n\t\tif (!strncmp(menu->name, name, len))\n\t\t\treturn menu;\n\t}\n\n\treturn NULL;\n}",
    "includes": [
      "#include \"src/shared/shell.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/mainloop.h\"",
      "#include <readline/history.h>",
      "#include <readline/readline.h>",
      "#include <getopt.h>",
      "#include <wordexp.h>",
      "#include <sys/signalfd.h>",
      "#include <signal.h>",
      "#include <stdbool.h>",
      "#include <stdarg.h>",
      "#include <stdlib.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "strncmp",
          "args": [
            "menu->name",
            "name",
            "len"
          ],
          "line": 115
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "queue_get_entries",
          "args": [
            "data.submenus"
          ],
          "line": 111
        },
        "resolved": true,
        "details": {
          "function_name": "queue_get_entries",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "364-370",
          "snippet": "const struct queue_entry *queue_get_entries(struct queue *queue)\n{\n\tif (!queue)\n\t\treturn NULL;\n\n\treturn queue->head;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nconst struct queue_entry *queue_get_entries(struct queue *queue)\n{\n\tif (!queue)\n\t\treturn NULL;\n\n\treturn queue->head;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/shell.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/mainloop.h\"\n#include <readline/history.h>\n#include <readline/readline.h>\n#include <getopt.h>\n#include <wordexp.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic const struct bt_shell_menu *find_menu(const char *name, size_t len)\n{\n\tconst struct queue_entry *entry;\n\n\tfor (entry = queue_get_entries(data.submenus); entry;\n\t\t\t\t\t\tentry = entry->next) {\n\t\tstruct bt_shell_menu *menu = entry->data;\n\n\t\tif (!strncmp(menu->name, name, len))\n\t\t\treturn menu;\n\t}\n\n\treturn NULL;\n}"
  },
  {
    "function_name": "cmd_help",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/shell.c",
    "lines": "100-105",
    "snippet": "static void cmd_help(int argc, char *argv[])\n{\n\tshell_print_menu();\n\n\treturn bt_shell_noninteractive_quit(EXIT_SUCCESS);\n}",
    "includes": [
      "#include \"src/shared/shell.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/mainloop.h\"",
      "#include <readline/history.h>",
      "#include <readline/readline.h>",
      "#include <getopt.h>",
      "#include <wordexp.h>",
      "#include <sys/signalfd.h>",
      "#include <signal.h>",
      "#include <stdbool.h>",
      "#include <stdarg.h>",
      "#include <stdlib.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void shell_print_menu(void);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "bt_shell_noninteractive_quit",
          "args": [
            "EXIT_SUCCESS"
          ],
          "line": 104
        },
        "resolved": true,
        "details": {
          "function_name": "bt_shell_noninteractive_quit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/shell.c",
          "lines": "1103-1109",
          "snippet": "void bt_shell_noninteractive_quit(int status)\n{\n\tif (!data.mode || data.timeout)\n\t\treturn;\n\n\tbt_shell_quit(status);\n}",
          "includes": [
            "#include \"src/shared/shell.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/mainloop.h\"",
            "#include <readline/history.h>",
            "#include <readline/readline.h>",
            "#include <getopt.h>",
            "#include <wordexp.h>",
            "#include <sys/signalfd.h>",
            "#include <signal.h>",
            "#include <stdbool.h>",
            "#include <stdarg.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/shell.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/mainloop.h\"\n#include <readline/history.h>\n#include <readline/readline.h>\n#include <getopt.h>\n#include <wordexp.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nvoid bt_shell_noninteractive_quit(int status)\n{\n\tif (!data.mode || data.timeout)\n\t\treturn;\n\n\tbt_shell_quit(status);\n}"
        }
      },
      {
        "call_info": {
          "callee": "shell_print_menu",
          "args": [],
          "line": 102
        },
        "resolved": true,
        "details": {
          "function_name": "shell_print_menu",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/shell.c",
          "lines": "237-269",
          "snippet": "static void shell_print_menu(void)\n{\n\tconst struct bt_shell_menu_entry *entry;\n\tconst struct queue_entry *submenu;\n\n\tif (!data.menu)\n\t\treturn;\n\n\tprint_text(COLOR_HIGHLIGHT, \"Menu %s:\", data.menu->name);\n\tprint_text(COLOR_HIGHLIGHT, \"Available commands:\");\n\tprint_text(COLOR_HIGHLIGHT, \"-------------------\");\n\n\tif (data.menu == data.main) {\n\t\tfor (submenu = queue_get_entries(data.submenus); submenu;\n\t\t\t\t\t\tsubmenu = submenu->next) {\n\t\t\tstruct bt_shell_menu *menu = submenu->data;\n\n\t\t\tprint_submenu(menu->name, menu->desc ? menu->desc :\n\t\t\t\t\t\t\t\t\"Submenu\");\n\t\t}\n\t}\n\n\tfor (entry = data.menu->entries; entry->cmd; entry++) {\n\t\tprint_menu(entry->cmd, entry->arg ? : \"\", entry->desc ? : \"\");\n\t}\n\n\tfor (entry = default_menu; entry->cmd; entry++) {\n\t\tif (entry->exists && !entry->exists(data.menu))\n\t\t\tcontinue;\n\n\t\tprint_menu(entry->cmd, entry->arg ? : \"\", entry->desc ? : \"\");\n\t}\n}",
          "includes": [
            "#include \"src/shared/shell.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/mainloop.h\"",
            "#include <readline/history.h>",
            "#include <readline/readline.h>",
            "#include <getopt.h>",
            "#include <wordexp.h>",
            "#include <sys/signalfd.h>",
            "#include <signal.h>",
            "#include <stdbool.h>",
            "#include <stdarg.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void shell_print_menu(void);",
            "static const struct bt_shell_menu_entry default_menu[] = {\n\t{ \"back\",         NULL,       cmd_back, \"Return to main menu\", NULL,\n\t\t\t\t\t\t\tNULL, cmd_back_exists },\n\t{ \"menu\",         \"<name>\",   cmd_menu, \"Select submenu\",\n\t\t\t\t\t\t\tmenu_generator, NULL,\n\t\t\t\t\t\t\tcmd_menu_exists},\n\t{ \"version\",      NULL,       cmd_version, \"Display version\" },\n\t{ \"quit\",         NULL,       cmd_quit, \"Quit program\" },\n\t{ \"exit\",         NULL,       cmd_quit, \"Quit program\" },\n\t{ \"help\",         NULL,       cmd_help,\n\t\t\t\t\t\"Display help about this program\" },\n\t{ \"export\",       NULL,       cmd_export,\n\t\t\t\t\t\t\"Print evironment variables\" },\n\t{ }\n};"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/shell.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/mainloop.h\"\n#include <readline/history.h>\n#include <readline/readline.h>\n#include <getopt.h>\n#include <wordexp.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void shell_print_menu(void);\nstatic const struct bt_shell_menu_entry default_menu[] = {\n\t{ \"back\",         NULL,       cmd_back, \"Return to main menu\", NULL,\n\t\t\t\t\t\t\tNULL, cmd_back_exists },\n\t{ \"menu\",         \"<name>\",   cmd_menu, \"Select submenu\",\n\t\t\t\t\t\t\tmenu_generator, NULL,\n\t\t\t\t\t\t\tcmd_menu_exists},\n\t{ \"version\",      NULL,       cmd_version, \"Display version\" },\n\t{ \"quit\",         NULL,       cmd_quit, \"Quit program\" },\n\t{ \"exit\",         NULL,       cmd_quit, \"Quit program\" },\n\t{ \"help\",         NULL,       cmd_help,\n\t\t\t\t\t\"Display help about this program\" },\n\t{ \"export\",       NULL,       cmd_export,\n\t\t\t\t\t\t\"Print evironment variables\" },\n\t{ }\n};\n\nstatic void shell_print_menu(void)\n{\n\tconst struct bt_shell_menu_entry *entry;\n\tconst struct queue_entry *submenu;\n\n\tif (!data.menu)\n\t\treturn;\n\n\tprint_text(COLOR_HIGHLIGHT, \"Menu %s:\", data.menu->name);\n\tprint_text(COLOR_HIGHLIGHT, \"Available commands:\");\n\tprint_text(COLOR_HIGHLIGHT, \"-------------------\");\n\n\tif (data.menu == data.main) {\n\t\tfor (submenu = queue_get_entries(data.submenus); submenu;\n\t\t\t\t\t\tsubmenu = submenu->next) {\n\t\t\tstruct bt_shell_menu *menu = submenu->data;\n\n\t\t\tprint_submenu(menu->name, menu->desc ? menu->desc :\n\t\t\t\t\t\t\t\t\"Submenu\");\n\t\t}\n\t}\n\n\tfor (entry = data.menu->entries; entry->cmd; entry++) {\n\t\tprint_menu(entry->cmd, entry->arg ? : \"\", entry->desc ? : \"\");\n\t}\n\n\tfor (entry = default_menu; entry->cmd; entry++) {\n\t\tif (entry->exists && !entry->exists(data.menu))\n\t\t\tcontinue;\n\n\t\tprint_menu(entry->cmd, entry->arg ? : \"\", entry->desc ? : \"\");\n\t}\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/shell.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/mainloop.h\"\n#include <readline/history.h>\n#include <readline/readline.h>\n#include <getopt.h>\n#include <wordexp.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void shell_print_menu(void);\n\nstatic void cmd_help(int argc, char *argv[])\n{\n\tshell_print_menu();\n\n\treturn bt_shell_noninteractive_quit(EXIT_SUCCESS);\n}"
  },
  {
    "function_name": "cmd_quit",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/shell.c",
    "lines": "95-98",
    "snippet": "static void cmd_quit(int argc, char *argv[])\n{\n\tmainloop_quit();\n}",
    "includes": [
      "#include \"src/shared/shell.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/mainloop.h\"",
      "#include <readline/history.h>",
      "#include <readline/readline.h>",
      "#include <getopt.h>",
      "#include <wordexp.h>",
      "#include <sys/signalfd.h>",
      "#include <signal.h>",
      "#include <stdbool.h>",
      "#include <stdarg.h>",
      "#include <stdlib.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "mainloop_quit",
          "args": [],
          "line": 97
        },
        "resolved": true,
        "details": {
          "function_name": "mainloop_quit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/mainloop.c",
          "lines": "88-91",
          "snippet": "void mainloop_quit(void)\n{\n\tepoll_terminate = 1;\n}",
          "includes": [
            "#include \"mainloop.h\"",
            "#include <sys/epoll.h>",
            "#include <sys/timerfd.h>",
            "#include <sys/signalfd.h>",
            "#include <signal.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int epoll_terminate;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"mainloop.h\"\n#include <sys/epoll.h>\n#include <sys/timerfd.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <string.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic int epoll_terminate;\n\nvoid mainloop_quit(void)\n{\n\tepoll_terminate = 1;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/shell.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/mainloop.h\"\n#include <readline/history.h>\n#include <readline/readline.h>\n#include <getopt.h>\n#include <wordexp.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void cmd_quit(int argc, char *argv[])\n{\n\tmainloop_quit();\n}"
  },
  {
    "function_name": "cmd_version",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/shell.c",
    "lines": "88-93",
    "snippet": "static void cmd_version(int argc, char *argv[])\n{\n\tbt_shell_printf(\"Version %s\\n\", VERSION);\n\n\treturn bt_shell_noninteractive_quit(EXIT_SUCCESS);\n}",
    "includes": [
      "#include \"src/shared/shell.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/mainloop.h\"",
      "#include <readline/history.h>",
      "#include <readline/readline.h>",
      "#include <getopt.h>",
      "#include <wordexp.h>",
      "#include <sys/signalfd.h>",
      "#include <signal.h>",
      "#include <stdbool.h>",
      "#include <stdarg.h>",
      "#include <stdlib.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "bt_shell_noninteractive_quit",
          "args": [
            "EXIT_SUCCESS"
          ],
          "line": 92
        },
        "resolved": true,
        "details": {
          "function_name": "bt_shell_noninteractive_quit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/shell.c",
          "lines": "1103-1109",
          "snippet": "void bt_shell_noninteractive_quit(int status)\n{\n\tif (!data.mode || data.timeout)\n\t\treturn;\n\n\tbt_shell_quit(status);\n}",
          "includes": [
            "#include \"src/shared/shell.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/mainloop.h\"",
            "#include <readline/history.h>",
            "#include <readline/readline.h>",
            "#include <getopt.h>",
            "#include <wordexp.h>",
            "#include <sys/signalfd.h>",
            "#include <signal.h>",
            "#include <stdbool.h>",
            "#include <stdarg.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/shell.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/mainloop.h\"\n#include <readline/history.h>\n#include <readline/readline.h>\n#include <getopt.h>\n#include <wordexp.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nvoid bt_shell_noninteractive_quit(int status)\n{\n\tif (!data.mode || data.timeout)\n\t\treturn;\n\n\tbt_shell_quit(status);\n}"
        }
      },
      {
        "call_info": {
          "callee": "bt_shell_printf",
          "args": [
            "\"Version %s\\n\"",
            "VERSION"
          ],
          "line": 90
        },
        "resolved": true,
        "details": {
          "function_name": "bt_shell_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/shell.c",
          "lines": "458-498",
          "snippet": "void bt_shell_printf(const char *fmt, ...)\n{\n\tva_list args;\n\tbool save_input;\n\tchar *saved_line;\n\tint saved_point;\n\n\tif (!data.input)\n\t\treturn;\n\n\tif (data.mode) {\n\t\tva_start(args, fmt);\n\t\tvprintf(fmt, args);\n\t\tva_end(args);\n\t\treturn;\n\t}\n\n\tsave_input = !RL_ISSTATE(RL_STATE_DONE);\n\n\tif (save_input) {\n\t\tsaved_point = rl_point;\n\t\tsaved_line = rl_copy_text(0, rl_end);\n\t\tif (!data.saved_prompt)\n\t\t\trl_save_prompt();\n\t\trl_replace_line(\"\", 0);\n\t\trl_redisplay();\n\t}\n\n\tva_start(args, fmt);\n\tvprintf(fmt, args);\n\tva_end(args);\n\n\tif (save_input) {\n\t\tif (!data.saved_prompt)\n\t\t\trl_restore_prompt();\n\t\trl_replace_line(saved_line, 0);\n\t\trl_point = saved_point;\n\t\trl_forced_update_display();\n\t\tfree(saved_line);\n\t}\n}",
          "includes": [
            "#include \"src/shared/shell.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/mainloop.h\"",
            "#include <readline/history.h>",
            "#include <readline/readline.h>",
            "#include <getopt.h>",
            "#include <wordexp.h>",
            "#include <sys/signalfd.h>",
            "#include <signal.h>",
            "#include <stdbool.h>",
            "#include <stdarg.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static wordexp_t args;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/shell.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/mainloop.h\"\n#include <readline/history.h>\n#include <readline/readline.h>\n#include <getopt.h>\n#include <wordexp.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic wordexp_t args;\n\nvoid bt_shell_printf(const char *fmt, ...)\n{\n\tva_list args;\n\tbool save_input;\n\tchar *saved_line;\n\tint saved_point;\n\n\tif (!data.input)\n\t\treturn;\n\n\tif (data.mode) {\n\t\tva_start(args, fmt);\n\t\tvprintf(fmt, args);\n\t\tva_end(args);\n\t\treturn;\n\t}\n\n\tsave_input = !RL_ISSTATE(RL_STATE_DONE);\n\n\tif (save_input) {\n\t\tsaved_point = rl_point;\n\t\tsaved_line = rl_copy_text(0, rl_end);\n\t\tif (!data.saved_prompt)\n\t\t\trl_save_prompt();\n\t\trl_replace_line(\"\", 0);\n\t\trl_redisplay();\n\t}\n\n\tva_start(args, fmt);\n\tvprintf(fmt, args);\n\tva_end(args);\n\n\tif (save_input) {\n\t\tif (!data.saved_prompt)\n\t\t\trl_restore_prompt();\n\t\trl_replace_line(saved_line, 0);\n\t\trl_point = saved_point;\n\t\trl_forced_update_display();\n\t\tfree(saved_line);\n\t}\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/shell.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/mainloop.h\"\n#include <readline/history.h>\n#include <readline/readline.h>\n#include <getopt.h>\n#include <wordexp.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void cmd_version(int argc, char *argv[])\n{\n\tbt_shell_printf(\"Version %s\\n\", VERSION);\n\n\treturn bt_shell_noninteractive_quit(EXIT_SUCCESS);\n}"
  }
]