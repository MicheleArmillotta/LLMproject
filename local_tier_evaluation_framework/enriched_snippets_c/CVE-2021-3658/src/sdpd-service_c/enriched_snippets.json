[
  {
    "function_name": "service_remove_req",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/sdpd-service.c",
    "lines": "927-953",
    "snippet": "int service_remove_req(sdp_req_t *req, sdp_buf_t *rsp)\n{\n\tuint8_t *p = req->buf + sizeof(sdp_pdu_hdr_t);\n\tuint32_t handle = get_be32(p);\n\tsdp_record_t *rec;\n\tint status = 0;\n\n\t/* extract service record handle */\n\n\trec = sdp_record_find(handle);\n\tif (rec) {\n\t\tsdp_svcdb_collect(rec);\n\t\tstatus = sdp_record_remove(handle);\n\t\tsdp_record_free(rec);\n\t\tif (status == 0)\n\t\t\tupdate_db_timestamp();\n\t} else {\n\t\tstatus = SDP_INVALID_RECORD_HANDLE;\n\t\tSDPDBG(\"Could not find record : 0x%x\", handle);\n\t}\n\n\tp = rsp->data;\n\tput_be16(status, p);\n\trsp->data_size = sizeof(uint16_t);\n\n\treturn status;\n}",
    "includes": [
      "#include \"log.h\"",
      "#include \"sdpd.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <glib.h>",
      "#include <stdbool.h>",
      "#include <sys/time.h>",
      "#include <assert.h>",
      "#include <stdlib.h>",
      "#include <errno.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "put_be16",
          "args": [
            "status",
            "p"
          ],
          "line": 949
        },
        "resolved": true,
        "details": {
          "function_name": "put_be16",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/util.h",
          "lines": "164-167",
          "snippet": "static inline void put_be16(uint16_t val, const void *ptr)\n{\n\tput_unaligned(cpu_to_be16(val), (uint16_t *) ptr);\n}",
          "includes": [
            "#include <string.h>",
            "#include <byteswap.h>",
            "#include <alloca.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <byteswap.h>\n#include <alloca.h>\n#include <stdlib.h>\n#include <stdint.h>\n\nstatic inline void put_be16(uint16_t val, const void *ptr)\n{\n\tput_unaligned(cpu_to_be16(val), (uint16_t *) ptr);\n}"
        }
      },
      {
        "call_info": {
          "callee": "SDPDBG",
          "args": [
            "\"Could not find record : 0x%x\"",
            "handle"
          ],
          "line": 945
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "update_db_timestamp",
          "args": [],
          "line": 942
        },
        "resolved": true,
        "details": {
          "function_name": "update_db_timestamp",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/sdpd-service.c",
          "lines": "311-321",
          "snippet": "static void update_db_timestamp(void)\n{\n\tif (fixed_dbts) {\n\t\tsdp_data_t *d = sdp_data_alloc(SDP_UINT32, &fixed_dbts);\n\t\tsdp_attr_replace(server, SDP_ATTR_SVCDB_STATE, d);\n\t} else {\n\t\tuint32_t dbts = sdp_get_time();\n\t\tsdp_data_t *d = sdp_data_alloc(SDP_UINT32, &dbts);\n\t\tsdp_attr_replace(server, SDP_ATTR_SVCDB_STATE, d);\n\t}\n}",
          "includes": [
            "#include \"log.h\"",
            "#include \"sdpd.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <stdbool.h>",
            "#include <sys/time.h>",
            "#include <assert.h>",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static sdp_record_t *server = NULL;",
            "static uint32_t fixed_dbts = 0;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n#include \"sdpd.h\"\n#include \"src/shared/util.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <stdbool.h>\n#include <sys/time.h>\n#include <assert.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <config.h>\n\nstatic sdp_record_t *server = NULL;\nstatic uint32_t fixed_dbts = 0;\n\nstatic void update_db_timestamp(void)\n{\n\tif (fixed_dbts) {\n\t\tsdp_data_t *d = sdp_data_alloc(SDP_UINT32, &fixed_dbts);\n\t\tsdp_attr_replace(server, SDP_ATTR_SVCDB_STATE, d);\n\t} else {\n\t\tuint32_t dbts = sdp_get_time();\n\t\tsdp_data_t *d = sdp_data_alloc(SDP_UINT32, &dbts);\n\t\tsdp_attr_replace(server, SDP_ATTR_SVCDB_STATE, d);\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "sdp_record_free",
          "args": [
            "rec"
          ],
          "line": 940
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_record_remove",
          "args": [
            "handle"
          ],
          "line": 939
        },
        "resolved": true,
        "details": {
          "function_name": "sdp_record_remove",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/sdpd-database.c",
          "lines": "242-267",
          "snippet": "int sdp_record_remove(uint32_t handle)\n{\n\tsdp_list_t *p = record_locate(handle);\n\tsdp_record_t *r;\n\tsdp_access_t *a;\n\n\tif (!p) {\n\t\terror(\"Remove : Couldn't find record for : 0x%x\", handle);\n\t\treturn -1;\n\t}\n\n\tr = p->data;\n\tif (r)\n\t\tservice_db = sdp_list_remove(service_db, r);\n\n\tp = access_locate(handle);\n\tif (p == NULL || p->data == NULL)\n\t\treturn 0;\n\n\ta = p->data;\n\n\taccess_db = sdp_list_remove(access_db, a);\n\taccess_free(a);\n\n\treturn 0;\n}",
          "includes": [
            "#include \"log.h\"",
            "#include \"sdpd.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static sdp_list_t *service_db;",
            "static sdp_list_t *access_db;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n#include \"sdpd.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <stdbool.h>\n#include <stdlib.h>\n#include <config.h>\n\nstatic sdp_list_t *service_db;\nstatic sdp_list_t *access_db;\n\nint sdp_record_remove(uint32_t handle)\n{\n\tsdp_list_t *p = record_locate(handle);\n\tsdp_record_t *r;\n\tsdp_access_t *a;\n\n\tif (!p) {\n\t\terror(\"Remove : Couldn't find record for : 0x%x\", handle);\n\t\treturn -1;\n\t}\n\n\tr = p->data;\n\tif (r)\n\t\tservice_db = sdp_list_remove(service_db, r);\n\n\tp = access_locate(handle);\n\tif (p == NULL || p->data == NULL)\n\t\treturn 0;\n\n\ta = p->data;\n\n\taccess_db = sdp_list_remove(access_db, a);\n\taccess_free(a);\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "sdp_svcdb_collect",
          "args": [
            "rec"
          ],
          "line": 938
        },
        "resolved": true,
        "details": {
          "function_name": "sdp_svcdb_collect",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/sdpd-database.c",
          "lines": "133-149",
          "snippet": "void sdp_svcdb_collect(sdp_record_t *rec)\n{\n\tsdp_list_t *p, *q;\n\n\tfor (p = socket_index, q = 0; p; q = p, p = p->next) {\n\t\tsdp_indexed_t *item = p->data;\n\t\tif (rec == item->record) {\n\t\t\tfree(item);\n\t\t\tif (q)\n\t\t\t\tq->next = p->next;\n\t\t\telse\n\t\t\t\tsocket_index = p->next;\n\t\t\tfree(p);\n\t\t\treturn;\n\t\t}\n\t}\n}",
          "includes": [
            "#include \"log.h\"",
            "#include \"sdpd.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static sdp_list_t *socket_index;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n#include \"sdpd.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <stdbool.h>\n#include <stdlib.h>\n#include <config.h>\n\nstatic sdp_list_t *socket_index;\n\nvoid sdp_svcdb_collect(sdp_record_t *rec)\n{\n\tsdp_list_t *p, *q;\n\n\tfor (p = socket_index, q = 0; p; q = p, p = p->next) {\n\t\tsdp_indexed_t *item = p->data;\n\t\tif (rec == item->record) {\n\t\t\tfree(item);\n\t\t\tif (q)\n\t\t\t\tq->next = p->next;\n\t\t\telse\n\t\t\t\tsocket_index = p->next;\n\t\t\tfree(p);\n\t\t\treturn;\n\t\t}\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "sdp_record_find",
          "args": [
            "handle"
          ],
          "line": 936
        },
        "resolved": true,
        "details": {
          "function_name": "sdp_record_find",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/sdpd-database.c",
          "lines": "227-237",
          "snippet": "sdp_record_t *sdp_record_find(uint32_t handle)\n{\n\tsdp_list_t *p = record_locate(handle);\n\n\tif (!p) {\n\t\tSDPDBG(\"Couldn't find record for : 0x%x\", handle);\n\t\treturn 0;\n\t}\n\n\treturn p->data;\n}",
          "includes": [
            "#include \"log.h\"",
            "#include \"sdpd.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n#include \"sdpd.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <stdbool.h>\n#include <stdlib.h>\n#include <config.h>\n\nsdp_record_t *sdp_record_find(uint32_t handle)\n{\n\tsdp_list_t *p = record_locate(handle);\n\n\tif (!p) {\n\t\tSDPDBG(\"Couldn't find record for : 0x%x\", handle);\n\t\treturn 0;\n\t}\n\n\treturn p->data;\n}"
        }
      },
      {
        "call_info": {
          "callee": "get_be32",
          "args": [
            "p"
          ],
          "line": 930
        },
        "resolved": true,
        "details": {
          "function_name": "get_be32",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/util.h",
          "lines": "144-147",
          "snippet": "static inline uint32_t get_be32(const void *ptr)\n{\n\treturn be32_to_cpu(get_unaligned((const uint32_t *) ptr));\n}",
          "includes": [
            "#include <string.h>",
            "#include <byteswap.h>",
            "#include <alloca.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <byteswap.h>\n#include <alloca.h>\n#include <stdlib.h>\n#include <stdint.h>\n\nstatic inline uint32_t get_be32(const void *ptr)\n{\n\treturn be32_to_cpu(get_unaligned((const uint32_t *) ptr));\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"log.h\"\n#include \"sdpd.h\"\n#include \"src/shared/util.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <stdbool.h>\n#include <sys/time.h>\n#include <assert.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <config.h>\n\nint service_remove_req(sdp_req_t *req, sdp_buf_t *rsp)\n{\n\tuint8_t *p = req->buf + sizeof(sdp_pdu_hdr_t);\n\tuint32_t handle = get_be32(p);\n\tsdp_record_t *rec;\n\tint status = 0;\n\n\t/* extract service record handle */\n\n\trec = sdp_record_find(handle);\n\tif (rec) {\n\t\tsdp_svcdb_collect(rec);\n\t\tstatus = sdp_record_remove(handle);\n\t\tsdp_record_free(rec);\n\t\tif (status == 0)\n\t\t\tupdate_db_timestamp();\n\t} else {\n\t\tstatus = SDP_INVALID_RECORD_HANDLE;\n\t\tSDPDBG(\"Could not find record : 0x%x\", handle);\n\t}\n\n\tp = rsp->data;\n\tput_be16(status, p);\n\trsp->data_size = sizeof(uint16_t);\n\n\treturn status;\n}"
  },
  {
    "function_name": "service_update_req",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/sdpd-service.c",
    "lines": "885-922",
    "snippet": "int service_update_req(sdp_req_t *req, sdp_buf_t *rsp)\n{\n\tsdp_record_t *orec, *nrec;\n\tint status = 0, scanned = 0;\n\tuint8_t *p = req->buf + sizeof(sdp_pdu_hdr_t);\n\tint bufsize = req->len - sizeof(sdp_pdu_hdr_t);\n\tuint32_t handle = get_be32(p);\n\n\tSDPDBG(\"Svc Rec Handle: 0x%x\", handle);\n\n\tp += sizeof(uint32_t);\n\tbufsize -= sizeof(uint32_t);\n\n\torec = sdp_record_find(handle);\n\n\tSDPDBG(\"SvcRecOld: %p\", orec);\n\n\tif (!orec) {\n\t\tstatus = SDP_INVALID_RECORD_HANDLE;\n\t\tgoto done;\n\t}\n\n\tnrec = extract_pdu_server(BDADDR_ANY, p, bufsize, handle, &scanned);\n\tif (!nrec) {\n\t\tstatus = SDP_INVALID_SYNTAX;\n\t\tgoto done;\n\t}\n\n\tassert(nrec == orec);\n\n\tupdate_db_timestamp();\n\ndone:\n\tp = rsp->data;\n\tput_be16(status, p);\n\trsp->data_size = sizeof(uint16_t);\n\treturn status;\n}",
    "includes": [
      "#include \"log.h\"",
      "#include \"sdpd.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <glib.h>",
      "#include <stdbool.h>",
      "#include <sys/time.h>",
      "#include <assert.h>",
      "#include <stdlib.h>",
      "#include <errno.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "put_be16",
          "args": [
            "status",
            "p"
          ],
          "line": 919
        },
        "resolved": true,
        "details": {
          "function_name": "put_be16",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/util.h",
          "lines": "164-167",
          "snippet": "static inline void put_be16(uint16_t val, const void *ptr)\n{\n\tput_unaligned(cpu_to_be16(val), (uint16_t *) ptr);\n}",
          "includes": [
            "#include <string.h>",
            "#include <byteswap.h>",
            "#include <alloca.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <byteswap.h>\n#include <alloca.h>\n#include <stdlib.h>\n#include <stdint.h>\n\nstatic inline void put_be16(uint16_t val, const void *ptr)\n{\n\tput_unaligned(cpu_to_be16(val), (uint16_t *) ptr);\n}"
        }
      },
      {
        "call_info": {
          "callee": "update_db_timestamp",
          "args": [],
          "line": 915
        },
        "resolved": true,
        "details": {
          "function_name": "update_db_timestamp",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/sdpd-service.c",
          "lines": "311-321",
          "snippet": "static void update_db_timestamp(void)\n{\n\tif (fixed_dbts) {\n\t\tsdp_data_t *d = sdp_data_alloc(SDP_UINT32, &fixed_dbts);\n\t\tsdp_attr_replace(server, SDP_ATTR_SVCDB_STATE, d);\n\t} else {\n\t\tuint32_t dbts = sdp_get_time();\n\t\tsdp_data_t *d = sdp_data_alloc(SDP_UINT32, &dbts);\n\t\tsdp_attr_replace(server, SDP_ATTR_SVCDB_STATE, d);\n\t}\n}",
          "includes": [
            "#include \"log.h\"",
            "#include \"sdpd.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <stdbool.h>",
            "#include <sys/time.h>",
            "#include <assert.h>",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static sdp_record_t *server = NULL;",
            "static uint32_t fixed_dbts = 0;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n#include \"sdpd.h\"\n#include \"src/shared/util.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <stdbool.h>\n#include <sys/time.h>\n#include <assert.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <config.h>\n\nstatic sdp_record_t *server = NULL;\nstatic uint32_t fixed_dbts = 0;\n\nstatic void update_db_timestamp(void)\n{\n\tif (fixed_dbts) {\n\t\tsdp_data_t *d = sdp_data_alloc(SDP_UINT32, &fixed_dbts);\n\t\tsdp_attr_replace(server, SDP_ATTR_SVCDB_STATE, d);\n\t} else {\n\t\tuint32_t dbts = sdp_get_time();\n\t\tsdp_data_t *d = sdp_data_alloc(SDP_UINT32, &dbts);\n\t\tsdp_attr_replace(server, SDP_ATTR_SVCDB_STATE, d);\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "assert",
          "args": [
            "nrec == orec"
          ],
          "line": 913
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "extract_pdu_server",
          "args": [
            "BDADDR_ANY",
            "p",
            "bufsize",
            "handle",
            "&scanned"
          ],
          "line": 907
        },
        "resolved": true,
        "details": {
          "function_name": "extract_pdu_server",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/sdpd-service.c",
          "lines": "713-811",
          "snippet": "static sdp_record_t *extract_pdu_server(bdaddr_t *device, uint8_t *p,\n\t\t\t\t\tunsigned int bufsize,\n\t\t\t\t\tuint32_t handleExpected, int *scanned)\n{\n\tint extractStatus = -1, localExtractedLength = 0;\n\tuint8_t dtd;\n\tint seqlen = 0;\n\tsdp_record_t *rec = NULL;\n\tuint16_t attrId, lookAheadAttrId;\n\tsdp_data_t *pAttr = NULL;\n\tuint32_t handle = 0xffffffff;\n\n\t*scanned = sdp_extract_seqtype(p, bufsize, &dtd, &seqlen);\n\tp += *scanned;\n\tbufsize -= *scanned;\n\n\tif (bufsize < sizeof(uint8_t) + sizeof(uint8_t)) {\n\t\tSDPDBG(\"Unexpected end of packet\");\n\t\treturn NULL;\n\t}\n\n\tlookAheadAttrId = get_be16(p + sizeof(uint8_t));\n\n\tSDPDBG(\"Look ahead attr id : %d\", lookAheadAttrId);\n\n\tif (lookAheadAttrId == SDP_ATTR_RECORD_HANDLE) {\n\t\tif (bufsize < (sizeof(uint8_t) * 2) +\n\t\t\t\t\tsizeof(uint16_t) + sizeof(uint32_t)) {\n\t\t\tSDPDBG(\"Unexpected end of packet\");\n\t\t\treturn NULL;\n\t\t}\n\t\thandle = get_be32(p + sizeof(uint8_t) + sizeof(uint16_t) +\n\t\t\t\t\t\t\tsizeof(uint8_t));\n\t\tSDPDBG(\"SvcRecHandle : 0x%x\", handle);\n\t\trec = sdp_record_find(handle);\n\t} else if (handleExpected != 0xffffffff)\n\t\trec = sdp_record_find(handleExpected);\n\n\tif (!rec) {\n\t\trec = sdp_record_alloc();\n\t\trec->attrlist = NULL;\n\t\tif (lookAheadAttrId == SDP_ATTR_RECORD_HANDLE) {\n\t\t\trec->handle = handle;\n\t\t\tsdp_record_add(device, rec);\n\t\t} else if (handleExpected != 0xffffffff) {\n\t\t\trec->handle = handleExpected;\n\t\t\tsdp_record_add(device, rec);\n\t\t}\n\t} else {\n\t\tsdp_list_free(rec->attrlist, (sdp_free_func_t) sdp_data_free);\n\t\trec->attrlist = NULL;\n\t}\n\n\twhile (localExtractedLength < seqlen) {\n\t\tint attrSize = sizeof(uint8_t);\n\t\tint attrValueLength = 0;\n\n\t\tif (bufsize < attrSize + sizeof(uint16_t)) {\n\t\t\tSDPDBG(\"Unexpected end of packet: Terminating extraction of attributes\");\n\t\t\tbreak;\n\t\t}\n\n\t\tSDPDBG(\"Extract PDU, sequenceLength: %d localExtractedLength: %d\",\n\t\t\t\t\t\t\tseqlen, localExtractedLength);\n\t\tdtd = *(uint8_t *) p;\n\n\t\tattrId = get_be16(p + attrSize);\n\t\tattrSize += sizeof(uint16_t);\n\n\t\tSDPDBG(\"DTD of attrId : %d Attr id : 0x%x\", dtd, attrId);\n\n\t\tpAttr = sdp_extract_attr(p + attrSize, bufsize - attrSize,\n\t\t\t\t\t\t\t&attrValueLength, rec);\n\n\t\tSDPDBG(\"Attr id : 0x%x attrValueLength : %d\", attrId, attrValueLength);\n\n\t\tattrSize += attrValueLength;\n\t\tif (pAttr == NULL) {\n\t\t\tSDPDBG(\"Terminating extraction of attributes\");\n\t\t\tbreak;\n\t\t}\n\t\tlocalExtractedLength += attrSize;\n\t\tp += attrSize;\n\t\tbufsize -= attrSize;\n\t\tsdp_attr_replace(rec, attrId, pAttr);\n\t\textractStatus = 0;\n\t\tSDPDBG(\"Extract PDU, seqLength: %d localExtractedLength: %d\",\n\t\t\t\t\tseqlen, localExtractedLength);\n\t}\n\n\tif (extractStatus == 0) {\n\t\tSDPDBG(\"Successful extracting of Svc Rec attributes\");\n#ifdef SDP_DEBUG\n\t\tsdp_print_service_attr(rec->attrlist);\n#endif\n\t\t*scanned += seqlen;\n\t}\n\treturn rec;\n}",
          "includes": [
            "#include \"log.h\"",
            "#include \"sdpd.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <stdbool.h>",
            "#include <sys/time.h>",
            "#include <assert.h>",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n#include \"sdpd.h\"\n#include \"src/shared/util.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <stdbool.h>\n#include <sys/time.h>\n#include <assert.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <config.h>\n\nstatic sdp_record_t *extract_pdu_server(bdaddr_t *device, uint8_t *p,\n\t\t\t\t\tunsigned int bufsize,\n\t\t\t\t\tuint32_t handleExpected, int *scanned)\n{\n\tint extractStatus = -1, localExtractedLength = 0;\n\tuint8_t dtd;\n\tint seqlen = 0;\n\tsdp_record_t *rec = NULL;\n\tuint16_t attrId, lookAheadAttrId;\n\tsdp_data_t *pAttr = NULL;\n\tuint32_t handle = 0xffffffff;\n\n\t*scanned = sdp_extract_seqtype(p, bufsize, &dtd, &seqlen);\n\tp += *scanned;\n\tbufsize -= *scanned;\n\n\tif (bufsize < sizeof(uint8_t) + sizeof(uint8_t)) {\n\t\tSDPDBG(\"Unexpected end of packet\");\n\t\treturn NULL;\n\t}\n\n\tlookAheadAttrId = get_be16(p + sizeof(uint8_t));\n\n\tSDPDBG(\"Look ahead attr id : %d\", lookAheadAttrId);\n\n\tif (lookAheadAttrId == SDP_ATTR_RECORD_HANDLE) {\n\t\tif (bufsize < (sizeof(uint8_t) * 2) +\n\t\t\t\t\tsizeof(uint16_t) + sizeof(uint32_t)) {\n\t\t\tSDPDBG(\"Unexpected end of packet\");\n\t\t\treturn NULL;\n\t\t}\n\t\thandle = get_be32(p + sizeof(uint8_t) + sizeof(uint16_t) +\n\t\t\t\t\t\t\tsizeof(uint8_t));\n\t\tSDPDBG(\"SvcRecHandle : 0x%x\", handle);\n\t\trec = sdp_record_find(handle);\n\t} else if (handleExpected != 0xffffffff)\n\t\trec = sdp_record_find(handleExpected);\n\n\tif (!rec) {\n\t\trec = sdp_record_alloc();\n\t\trec->attrlist = NULL;\n\t\tif (lookAheadAttrId == SDP_ATTR_RECORD_HANDLE) {\n\t\t\trec->handle = handle;\n\t\t\tsdp_record_add(device, rec);\n\t\t} else if (handleExpected != 0xffffffff) {\n\t\t\trec->handle = handleExpected;\n\t\t\tsdp_record_add(device, rec);\n\t\t}\n\t} else {\n\t\tsdp_list_free(rec->attrlist, (sdp_free_func_t) sdp_data_free);\n\t\trec->attrlist = NULL;\n\t}\n\n\twhile (localExtractedLength < seqlen) {\n\t\tint attrSize = sizeof(uint8_t);\n\t\tint attrValueLength = 0;\n\n\t\tif (bufsize < attrSize + sizeof(uint16_t)) {\n\t\t\tSDPDBG(\"Unexpected end of packet: Terminating extraction of attributes\");\n\t\t\tbreak;\n\t\t}\n\n\t\tSDPDBG(\"Extract PDU, sequenceLength: %d localExtractedLength: %d\",\n\t\t\t\t\t\t\tseqlen, localExtractedLength);\n\t\tdtd = *(uint8_t *) p;\n\n\t\tattrId = get_be16(p + attrSize);\n\t\tattrSize += sizeof(uint16_t);\n\n\t\tSDPDBG(\"DTD of attrId : %d Attr id : 0x%x\", dtd, attrId);\n\n\t\tpAttr = sdp_extract_attr(p + attrSize, bufsize - attrSize,\n\t\t\t\t\t\t\t&attrValueLength, rec);\n\n\t\tSDPDBG(\"Attr id : 0x%x attrValueLength : %d\", attrId, attrValueLength);\n\n\t\tattrSize += attrValueLength;\n\t\tif (pAttr == NULL) {\n\t\t\tSDPDBG(\"Terminating extraction of attributes\");\n\t\t\tbreak;\n\t\t}\n\t\tlocalExtractedLength += attrSize;\n\t\tp += attrSize;\n\t\tbufsize -= attrSize;\n\t\tsdp_attr_replace(rec, attrId, pAttr);\n\t\textractStatus = 0;\n\t\tSDPDBG(\"Extract PDU, seqLength: %d localExtractedLength: %d\",\n\t\t\t\t\tseqlen, localExtractedLength);\n\t}\n\n\tif (extractStatus == 0) {\n\t\tSDPDBG(\"Successful extracting of Svc Rec attributes\");\n#ifdef SDP_DEBUG\n\t\tsdp_print_service_attr(rec->attrlist);\n#endif\n\t\t*scanned += seqlen;\n\t}\n\treturn rec;\n}"
        }
      },
      {
        "call_info": {
          "callee": "SDPDBG",
          "args": [
            "\"SvcRecOld: %p\"",
            "orec"
          ],
          "line": 900
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_record_find",
          "args": [
            "handle"
          ],
          "line": 898
        },
        "resolved": true,
        "details": {
          "function_name": "sdp_record_find",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/sdpd-database.c",
          "lines": "227-237",
          "snippet": "sdp_record_t *sdp_record_find(uint32_t handle)\n{\n\tsdp_list_t *p = record_locate(handle);\n\n\tif (!p) {\n\t\tSDPDBG(\"Couldn't find record for : 0x%x\", handle);\n\t\treturn 0;\n\t}\n\n\treturn p->data;\n}",
          "includes": [
            "#include \"log.h\"",
            "#include \"sdpd.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n#include \"sdpd.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <stdbool.h>\n#include <stdlib.h>\n#include <config.h>\n\nsdp_record_t *sdp_record_find(uint32_t handle)\n{\n\tsdp_list_t *p = record_locate(handle);\n\n\tif (!p) {\n\t\tSDPDBG(\"Couldn't find record for : 0x%x\", handle);\n\t\treturn 0;\n\t}\n\n\treturn p->data;\n}"
        }
      },
      {
        "call_info": {
          "callee": "SDPDBG",
          "args": [
            "\"Svc Rec Handle: 0x%x\"",
            "handle"
          ],
          "line": 893
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "get_be32",
          "args": [
            "p"
          ],
          "line": 891
        },
        "resolved": true,
        "details": {
          "function_name": "get_be32",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/util.h",
          "lines": "144-147",
          "snippet": "static inline uint32_t get_be32(const void *ptr)\n{\n\treturn be32_to_cpu(get_unaligned((const uint32_t *) ptr));\n}",
          "includes": [
            "#include <string.h>",
            "#include <byteswap.h>",
            "#include <alloca.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <byteswap.h>\n#include <alloca.h>\n#include <stdlib.h>\n#include <stdint.h>\n\nstatic inline uint32_t get_be32(const void *ptr)\n{\n\treturn be32_to_cpu(get_unaligned((const uint32_t *) ptr));\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"log.h\"\n#include \"sdpd.h\"\n#include \"src/shared/util.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <stdbool.h>\n#include <sys/time.h>\n#include <assert.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <config.h>\n\nint service_update_req(sdp_req_t *req, sdp_buf_t *rsp)\n{\n\tsdp_record_t *orec, *nrec;\n\tint status = 0, scanned = 0;\n\tuint8_t *p = req->buf + sizeof(sdp_pdu_hdr_t);\n\tint bufsize = req->len - sizeof(sdp_pdu_hdr_t);\n\tuint32_t handle = get_be32(p);\n\n\tSDPDBG(\"Svc Rec Handle: 0x%x\", handle);\n\n\tp += sizeof(uint32_t);\n\tbufsize -= sizeof(uint32_t);\n\n\torec = sdp_record_find(handle);\n\n\tSDPDBG(\"SvcRecOld: %p\", orec);\n\n\tif (!orec) {\n\t\tstatus = SDP_INVALID_RECORD_HANDLE;\n\t\tgoto done;\n\t}\n\n\tnrec = extract_pdu_server(BDADDR_ANY, p, bufsize, handle, &scanned);\n\tif (!nrec) {\n\t\tstatus = SDP_INVALID_SYNTAX;\n\t\tgoto done;\n\t}\n\n\tassert(nrec == orec);\n\n\tupdate_db_timestamp();\n\ndone:\n\tp = rsp->data;\n\tput_be16(status, p);\n\trsp->data_size = sizeof(uint16_t);\n\treturn status;\n}"
  },
  {
    "function_name": "service_register_req",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/sdpd-service.c",
    "lines": "816-880",
    "snippet": "int service_register_req(sdp_req_t *req, sdp_buf_t *rsp)\n{\n\tint scanned = 0;\n\tsdp_data_t *handle;\n\tuint8_t *p = req->buf + sizeof(sdp_pdu_hdr_t);\n\tint bufsize = req->len - sizeof(sdp_pdu_hdr_t);\n\tsdp_record_t *rec;\n\n\treq->flags = *p++;\n\tif (req->flags & SDP_DEVICE_RECORD) {\n\t\tbacpy(&req->device, (bdaddr_t *) p);\n\t\tp += sizeof(bdaddr_t);\n\t\tbufsize -= sizeof(bdaddr_t);\n\t}\n\n\t/* save image of PDU: we need it when clients request this attribute */\n\trec = extract_pdu_server(&req->device, p, bufsize, 0xffffffff, &scanned);\n\tif (!rec)\n\t\tgoto invalid;\n\n\tif (rec->handle == 0xffffffff) {\n\t\trec->handle = sdp_next_handle();\n\t\tif (rec->handle < 0x10000) {\n\t\t\tsdp_record_free(rec);\n\t\t\tgoto invalid;\n\t\t}\n\t} else {\n\t\tif (sdp_record_find(rec->handle)) {\n\t\t\t/* extract_pdu_server will add the record handle\n\t\t\t * if it is missing. So instead of failing, skip\n\t\t\t * the record adding to avoid duplication. */\n\t\t\tgoto success;\n\t\t}\n\t}\n\n\tsdp_record_add(&req->device, rec);\n\tif (!(req->flags & SDP_RECORD_PERSIST))\n\t\tsdp_svcdb_set_collectable(rec, req->sock);\n\n\thandle = sdp_data_alloc(SDP_UINT32, &rec->handle);\n\tsdp_attr_replace(rec, SDP_ATTR_RECORD_HANDLE, handle);\n\nsuccess:\n\t/* if the browse group descriptor is NULL,\n\t * ensure that the record belongs to the ROOT group */\n\tif (sdp_data_get(rec, SDP_ATTR_BROWSE_GRP_LIST) == NULL) {\n\t\tuuid_t uuid;\n\t\tsdp_uuid16_create(&uuid, PUBLIC_BROWSE_GROUP);\n\t\tsdp_pattern_add_uuid(rec, &uuid);\n\t}\n\n\tupdate_db_timestamp();\n\n\t/* Build a rsp buffer */\n\tput_be32(rec->handle, rsp->data);\n\trsp->data_size = sizeof(uint32_t);\n\n\treturn 0;\n\ninvalid:\n\tput_be16(SDP_INVALID_SYNTAX, rsp->data);\n\trsp->data_size = sizeof(uint16_t);\n\n\treturn -1;\n}",
    "includes": [
      "#include \"log.h\"",
      "#include \"sdpd.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <glib.h>",
      "#include <stdbool.h>",
      "#include <sys/time.h>",
      "#include <assert.h>",
      "#include <stdlib.h>",
      "#include <errno.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "put_be16",
          "args": [
            "SDP_INVALID_SYNTAX",
            "rsp->data"
          ],
          "line": 876
        },
        "resolved": true,
        "details": {
          "function_name": "put_be16",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/util.h",
          "lines": "164-167",
          "snippet": "static inline void put_be16(uint16_t val, const void *ptr)\n{\n\tput_unaligned(cpu_to_be16(val), (uint16_t *) ptr);\n}",
          "includes": [
            "#include <string.h>",
            "#include <byteswap.h>",
            "#include <alloca.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <byteswap.h>\n#include <alloca.h>\n#include <stdlib.h>\n#include <stdint.h>\n\nstatic inline void put_be16(uint16_t val, const void *ptr)\n{\n\tput_unaligned(cpu_to_be16(val), (uint16_t *) ptr);\n}"
        }
      },
      {
        "call_info": {
          "callee": "put_be32",
          "args": [
            "rec->handle",
            "rsp->data"
          ],
          "line": 870
        },
        "resolved": true,
        "details": {
          "function_name": "put_be32",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/util.h",
          "lines": "174-177",
          "snippet": "static inline void put_be32(uint32_t val, void *dst)\n{\n\tput_unaligned(cpu_to_be32(val), (uint32_t *) dst);\n}",
          "includes": [
            "#include <string.h>",
            "#include <byteswap.h>",
            "#include <alloca.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <byteswap.h>\n#include <alloca.h>\n#include <stdlib.h>\n#include <stdint.h>\n\nstatic inline void put_be32(uint32_t val, void *dst)\n{\n\tput_unaligned(cpu_to_be32(val), (uint32_t *) dst);\n}"
        }
      },
      {
        "call_info": {
          "callee": "update_db_timestamp",
          "args": [],
          "line": 867
        },
        "resolved": true,
        "details": {
          "function_name": "update_db_timestamp",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/sdpd-service.c",
          "lines": "311-321",
          "snippet": "static void update_db_timestamp(void)\n{\n\tif (fixed_dbts) {\n\t\tsdp_data_t *d = sdp_data_alloc(SDP_UINT32, &fixed_dbts);\n\t\tsdp_attr_replace(server, SDP_ATTR_SVCDB_STATE, d);\n\t} else {\n\t\tuint32_t dbts = sdp_get_time();\n\t\tsdp_data_t *d = sdp_data_alloc(SDP_UINT32, &dbts);\n\t\tsdp_attr_replace(server, SDP_ATTR_SVCDB_STATE, d);\n\t}\n}",
          "includes": [
            "#include \"log.h\"",
            "#include \"sdpd.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <stdbool.h>",
            "#include <sys/time.h>",
            "#include <assert.h>",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static sdp_record_t *server = NULL;",
            "static uint32_t fixed_dbts = 0;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n#include \"sdpd.h\"\n#include \"src/shared/util.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <stdbool.h>\n#include <sys/time.h>\n#include <assert.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <config.h>\n\nstatic sdp_record_t *server = NULL;\nstatic uint32_t fixed_dbts = 0;\n\nstatic void update_db_timestamp(void)\n{\n\tif (fixed_dbts) {\n\t\tsdp_data_t *d = sdp_data_alloc(SDP_UINT32, &fixed_dbts);\n\t\tsdp_attr_replace(server, SDP_ATTR_SVCDB_STATE, d);\n\t} else {\n\t\tuint32_t dbts = sdp_get_time();\n\t\tsdp_data_t *d = sdp_data_alloc(SDP_UINT32, &dbts);\n\t\tsdp_attr_replace(server, SDP_ATTR_SVCDB_STATE, d);\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "sdp_pattern_add_uuid",
          "args": [
            "rec",
            "&uuid"
          ],
          "line": 864
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_uuid16_create",
          "args": [
            "&uuid",
            "PUBLIC_BROWSE_GROUP"
          ],
          "line": 863
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_data_get",
          "args": [
            "rec",
            "SDP_ATTR_BROWSE_GRP_LIST"
          ],
          "line": 861
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_attr_replace",
          "args": [
            "rec",
            "SDP_ATTR_RECORD_HANDLE",
            "handle"
          ],
          "line": 856
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_data_alloc",
          "args": [
            "SDP_UINT32",
            "&rec->handle"
          ],
          "line": 855
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_svcdb_set_collectable",
          "args": [
            "rec",
            "req->sock"
          ],
          "line": 853
        },
        "resolved": true,
        "details": {
          "function_name": "sdp_svcdb_set_collectable",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/sdpd-database.c",
          "lines": "158-170",
          "snippet": "void sdp_svcdb_set_collectable(sdp_record_t *record, int sock)\n{\n\tsdp_indexed_t *item = malloc(sizeof(sdp_indexed_t));\n\n\tif (!item) {\n\t\tSDPDBG(\"No memory\");\n\t\treturn;\n\t}\n\n\titem->sock = sock;\n\titem->record = record;\n\tsocket_index = sdp_list_insert_sorted(socket_index, item, compare_indices);\n}",
          "includes": [
            "#include \"log.h\"",
            "#include \"sdpd.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static sdp_list_t *socket_index;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n#include \"sdpd.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <stdbool.h>\n#include <stdlib.h>\n#include <config.h>\n\nstatic sdp_list_t *socket_index;\n\nvoid sdp_svcdb_set_collectable(sdp_record_t *record, int sock)\n{\n\tsdp_indexed_t *item = malloc(sizeof(sdp_indexed_t));\n\n\tif (!item) {\n\t\tSDPDBG(\"No memory\");\n\t\treturn;\n\t}\n\n\titem->sock = sock;\n\titem->record = record;\n\tsocket_index = sdp_list_insert_sorted(socket_index, item, compare_indices);\n}"
        }
      },
      {
        "call_info": {
          "callee": "sdp_record_add",
          "args": [
            "&req->device",
            "rec"
          ],
          "line": 851
        },
        "resolved": true,
        "details": {
          "function_name": "sdp_record_add",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/sdpd-database.c",
          "lines": "175-192",
          "snippet": "void sdp_record_add(const bdaddr_t *device, sdp_record_t *rec)\n{\n\tsdp_access_t *dev;\n\n\tSDPDBG(\"Adding rec : 0x%lx\", (long) rec);\n\tSDPDBG(\"with handle : 0x%x\", rec->handle);\n\n\tservice_db = sdp_list_insert_sorted(service_db, rec, record_sort);\n\n\tdev = malloc(sizeof(*dev));\n\tif (!dev)\n\t\treturn;\n\n\tbacpy(&dev->device, device);\n\tdev->handle = rec->handle;\n\n\taccess_db = sdp_list_insert_sorted(access_db, dev, access_sort);\n}",
          "includes": [
            "#include \"log.h\"",
            "#include \"sdpd.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static sdp_list_t *service_db;",
            "static sdp_list_t *access_db;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n#include \"sdpd.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <stdbool.h>\n#include <stdlib.h>\n#include <config.h>\n\nstatic sdp_list_t *service_db;\nstatic sdp_list_t *access_db;\n\nvoid sdp_record_add(const bdaddr_t *device, sdp_record_t *rec)\n{\n\tsdp_access_t *dev;\n\n\tSDPDBG(\"Adding rec : 0x%lx\", (long) rec);\n\tSDPDBG(\"with handle : 0x%x\", rec->handle);\n\n\tservice_db = sdp_list_insert_sorted(service_db, rec, record_sort);\n\n\tdev = malloc(sizeof(*dev));\n\tif (!dev)\n\t\treturn;\n\n\tbacpy(&dev->device, device);\n\tdev->handle = rec->handle;\n\n\taccess_db = sdp_list_insert_sorted(access_db, dev, access_sort);\n}"
        }
      },
      {
        "call_info": {
          "callee": "sdp_record_find",
          "args": [
            "rec->handle"
          ],
          "line": 843
        },
        "resolved": true,
        "details": {
          "function_name": "sdp_record_find",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/sdpd-database.c",
          "lines": "227-237",
          "snippet": "sdp_record_t *sdp_record_find(uint32_t handle)\n{\n\tsdp_list_t *p = record_locate(handle);\n\n\tif (!p) {\n\t\tSDPDBG(\"Couldn't find record for : 0x%x\", handle);\n\t\treturn 0;\n\t}\n\n\treturn p->data;\n}",
          "includes": [
            "#include \"log.h\"",
            "#include \"sdpd.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n#include \"sdpd.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <stdbool.h>\n#include <stdlib.h>\n#include <config.h>\n\nsdp_record_t *sdp_record_find(uint32_t handle)\n{\n\tsdp_list_t *p = record_locate(handle);\n\n\tif (!p) {\n\t\tSDPDBG(\"Couldn't find record for : 0x%x\", handle);\n\t\treturn 0;\n\t}\n\n\treturn p->data;\n}"
        }
      },
      {
        "call_info": {
          "callee": "sdp_record_free",
          "args": [
            "rec"
          ],
          "line": 839
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_next_handle",
          "args": [],
          "line": 837
        },
        "resolved": true,
        "details": {
          "function_name": "sdp_next_handle",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/sdpd-database.c",
          "lines": "297-305",
          "snippet": "uint32_t sdp_next_handle(void)\n{\n\tuint32_t handle = 0x10000;\n\n\twhile (sdp_record_find(handle))\n\t\thandle++;\n\n\treturn handle;\n}",
          "includes": [
            "#include \"log.h\"",
            "#include \"sdpd.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n#include \"sdpd.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <stdbool.h>\n#include <stdlib.h>\n#include <config.h>\n\nuint32_t sdp_next_handle(void)\n{\n\tuint32_t handle = 0x10000;\n\n\twhile (sdp_record_find(handle))\n\t\thandle++;\n\n\treturn handle;\n}"
        }
      },
      {
        "call_info": {
          "callee": "extract_pdu_server",
          "args": [
            "&req->device",
            "p",
            "bufsize",
            "0xffffffff",
            "&scanned"
          ],
          "line": 832
        },
        "resolved": true,
        "details": {
          "function_name": "extract_pdu_server",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/sdpd-service.c",
          "lines": "713-811",
          "snippet": "static sdp_record_t *extract_pdu_server(bdaddr_t *device, uint8_t *p,\n\t\t\t\t\tunsigned int bufsize,\n\t\t\t\t\tuint32_t handleExpected, int *scanned)\n{\n\tint extractStatus = -1, localExtractedLength = 0;\n\tuint8_t dtd;\n\tint seqlen = 0;\n\tsdp_record_t *rec = NULL;\n\tuint16_t attrId, lookAheadAttrId;\n\tsdp_data_t *pAttr = NULL;\n\tuint32_t handle = 0xffffffff;\n\n\t*scanned = sdp_extract_seqtype(p, bufsize, &dtd, &seqlen);\n\tp += *scanned;\n\tbufsize -= *scanned;\n\n\tif (bufsize < sizeof(uint8_t) + sizeof(uint8_t)) {\n\t\tSDPDBG(\"Unexpected end of packet\");\n\t\treturn NULL;\n\t}\n\n\tlookAheadAttrId = get_be16(p + sizeof(uint8_t));\n\n\tSDPDBG(\"Look ahead attr id : %d\", lookAheadAttrId);\n\n\tif (lookAheadAttrId == SDP_ATTR_RECORD_HANDLE) {\n\t\tif (bufsize < (sizeof(uint8_t) * 2) +\n\t\t\t\t\tsizeof(uint16_t) + sizeof(uint32_t)) {\n\t\t\tSDPDBG(\"Unexpected end of packet\");\n\t\t\treturn NULL;\n\t\t}\n\t\thandle = get_be32(p + sizeof(uint8_t) + sizeof(uint16_t) +\n\t\t\t\t\t\t\tsizeof(uint8_t));\n\t\tSDPDBG(\"SvcRecHandle : 0x%x\", handle);\n\t\trec = sdp_record_find(handle);\n\t} else if (handleExpected != 0xffffffff)\n\t\trec = sdp_record_find(handleExpected);\n\n\tif (!rec) {\n\t\trec = sdp_record_alloc();\n\t\trec->attrlist = NULL;\n\t\tif (lookAheadAttrId == SDP_ATTR_RECORD_HANDLE) {\n\t\t\trec->handle = handle;\n\t\t\tsdp_record_add(device, rec);\n\t\t} else if (handleExpected != 0xffffffff) {\n\t\t\trec->handle = handleExpected;\n\t\t\tsdp_record_add(device, rec);\n\t\t}\n\t} else {\n\t\tsdp_list_free(rec->attrlist, (sdp_free_func_t) sdp_data_free);\n\t\trec->attrlist = NULL;\n\t}\n\n\twhile (localExtractedLength < seqlen) {\n\t\tint attrSize = sizeof(uint8_t);\n\t\tint attrValueLength = 0;\n\n\t\tif (bufsize < attrSize + sizeof(uint16_t)) {\n\t\t\tSDPDBG(\"Unexpected end of packet: Terminating extraction of attributes\");\n\t\t\tbreak;\n\t\t}\n\n\t\tSDPDBG(\"Extract PDU, sequenceLength: %d localExtractedLength: %d\",\n\t\t\t\t\t\t\tseqlen, localExtractedLength);\n\t\tdtd = *(uint8_t *) p;\n\n\t\tattrId = get_be16(p + attrSize);\n\t\tattrSize += sizeof(uint16_t);\n\n\t\tSDPDBG(\"DTD of attrId : %d Attr id : 0x%x\", dtd, attrId);\n\n\t\tpAttr = sdp_extract_attr(p + attrSize, bufsize - attrSize,\n\t\t\t\t\t\t\t&attrValueLength, rec);\n\n\t\tSDPDBG(\"Attr id : 0x%x attrValueLength : %d\", attrId, attrValueLength);\n\n\t\tattrSize += attrValueLength;\n\t\tif (pAttr == NULL) {\n\t\t\tSDPDBG(\"Terminating extraction of attributes\");\n\t\t\tbreak;\n\t\t}\n\t\tlocalExtractedLength += attrSize;\n\t\tp += attrSize;\n\t\tbufsize -= attrSize;\n\t\tsdp_attr_replace(rec, attrId, pAttr);\n\t\textractStatus = 0;\n\t\tSDPDBG(\"Extract PDU, seqLength: %d localExtractedLength: %d\",\n\t\t\t\t\tseqlen, localExtractedLength);\n\t}\n\n\tif (extractStatus == 0) {\n\t\tSDPDBG(\"Successful extracting of Svc Rec attributes\");\n#ifdef SDP_DEBUG\n\t\tsdp_print_service_attr(rec->attrlist);\n#endif\n\t\t*scanned += seqlen;\n\t}\n\treturn rec;\n}",
          "includes": [
            "#include \"log.h\"",
            "#include \"sdpd.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <stdbool.h>",
            "#include <sys/time.h>",
            "#include <assert.h>",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n#include \"sdpd.h\"\n#include \"src/shared/util.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <stdbool.h>\n#include <sys/time.h>\n#include <assert.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <config.h>\n\nstatic sdp_record_t *extract_pdu_server(bdaddr_t *device, uint8_t *p,\n\t\t\t\t\tunsigned int bufsize,\n\t\t\t\t\tuint32_t handleExpected, int *scanned)\n{\n\tint extractStatus = -1, localExtractedLength = 0;\n\tuint8_t dtd;\n\tint seqlen = 0;\n\tsdp_record_t *rec = NULL;\n\tuint16_t attrId, lookAheadAttrId;\n\tsdp_data_t *pAttr = NULL;\n\tuint32_t handle = 0xffffffff;\n\n\t*scanned = sdp_extract_seqtype(p, bufsize, &dtd, &seqlen);\n\tp += *scanned;\n\tbufsize -= *scanned;\n\n\tif (bufsize < sizeof(uint8_t) + sizeof(uint8_t)) {\n\t\tSDPDBG(\"Unexpected end of packet\");\n\t\treturn NULL;\n\t}\n\n\tlookAheadAttrId = get_be16(p + sizeof(uint8_t));\n\n\tSDPDBG(\"Look ahead attr id : %d\", lookAheadAttrId);\n\n\tif (lookAheadAttrId == SDP_ATTR_RECORD_HANDLE) {\n\t\tif (bufsize < (sizeof(uint8_t) * 2) +\n\t\t\t\t\tsizeof(uint16_t) + sizeof(uint32_t)) {\n\t\t\tSDPDBG(\"Unexpected end of packet\");\n\t\t\treturn NULL;\n\t\t}\n\t\thandle = get_be32(p + sizeof(uint8_t) + sizeof(uint16_t) +\n\t\t\t\t\t\t\tsizeof(uint8_t));\n\t\tSDPDBG(\"SvcRecHandle : 0x%x\", handle);\n\t\trec = sdp_record_find(handle);\n\t} else if (handleExpected != 0xffffffff)\n\t\trec = sdp_record_find(handleExpected);\n\n\tif (!rec) {\n\t\trec = sdp_record_alloc();\n\t\trec->attrlist = NULL;\n\t\tif (lookAheadAttrId == SDP_ATTR_RECORD_HANDLE) {\n\t\t\trec->handle = handle;\n\t\t\tsdp_record_add(device, rec);\n\t\t} else if (handleExpected != 0xffffffff) {\n\t\t\trec->handle = handleExpected;\n\t\t\tsdp_record_add(device, rec);\n\t\t}\n\t} else {\n\t\tsdp_list_free(rec->attrlist, (sdp_free_func_t) sdp_data_free);\n\t\trec->attrlist = NULL;\n\t}\n\n\twhile (localExtractedLength < seqlen) {\n\t\tint attrSize = sizeof(uint8_t);\n\t\tint attrValueLength = 0;\n\n\t\tif (bufsize < attrSize + sizeof(uint16_t)) {\n\t\t\tSDPDBG(\"Unexpected end of packet: Terminating extraction of attributes\");\n\t\t\tbreak;\n\t\t}\n\n\t\tSDPDBG(\"Extract PDU, sequenceLength: %d localExtractedLength: %d\",\n\t\t\t\t\t\t\tseqlen, localExtractedLength);\n\t\tdtd = *(uint8_t *) p;\n\n\t\tattrId = get_be16(p + attrSize);\n\t\tattrSize += sizeof(uint16_t);\n\n\t\tSDPDBG(\"DTD of attrId : %d Attr id : 0x%x\", dtd, attrId);\n\n\t\tpAttr = sdp_extract_attr(p + attrSize, bufsize - attrSize,\n\t\t\t\t\t\t\t&attrValueLength, rec);\n\n\t\tSDPDBG(\"Attr id : 0x%x attrValueLength : %d\", attrId, attrValueLength);\n\n\t\tattrSize += attrValueLength;\n\t\tif (pAttr == NULL) {\n\t\t\tSDPDBG(\"Terminating extraction of attributes\");\n\t\t\tbreak;\n\t\t}\n\t\tlocalExtractedLength += attrSize;\n\t\tp += attrSize;\n\t\tbufsize -= attrSize;\n\t\tsdp_attr_replace(rec, attrId, pAttr);\n\t\textractStatus = 0;\n\t\tSDPDBG(\"Extract PDU, seqLength: %d localExtractedLength: %d\",\n\t\t\t\t\tseqlen, localExtractedLength);\n\t}\n\n\tif (extractStatus == 0) {\n\t\tSDPDBG(\"Successful extracting of Svc Rec attributes\");\n#ifdef SDP_DEBUG\n\t\tsdp_print_service_attr(rec->attrlist);\n#endif\n\t\t*scanned += seqlen;\n\t}\n\treturn rec;\n}"
        }
      },
      {
        "call_info": {
          "callee": "bacpy",
          "args": [
            "&req->device",
            "(bdaddr_t *) p"
          ],
          "line": 826
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"log.h\"\n#include \"sdpd.h\"\n#include \"src/shared/util.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <stdbool.h>\n#include <sys/time.h>\n#include <assert.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <config.h>\n\nint service_register_req(sdp_req_t *req, sdp_buf_t *rsp)\n{\n\tint scanned = 0;\n\tsdp_data_t *handle;\n\tuint8_t *p = req->buf + sizeof(sdp_pdu_hdr_t);\n\tint bufsize = req->len - sizeof(sdp_pdu_hdr_t);\n\tsdp_record_t *rec;\n\n\treq->flags = *p++;\n\tif (req->flags & SDP_DEVICE_RECORD) {\n\t\tbacpy(&req->device, (bdaddr_t *) p);\n\t\tp += sizeof(bdaddr_t);\n\t\tbufsize -= sizeof(bdaddr_t);\n\t}\n\n\t/* save image of PDU: we need it when clients request this attribute */\n\trec = extract_pdu_server(&req->device, p, bufsize, 0xffffffff, &scanned);\n\tif (!rec)\n\t\tgoto invalid;\n\n\tif (rec->handle == 0xffffffff) {\n\t\trec->handle = sdp_next_handle();\n\t\tif (rec->handle < 0x10000) {\n\t\t\tsdp_record_free(rec);\n\t\t\tgoto invalid;\n\t\t}\n\t} else {\n\t\tif (sdp_record_find(rec->handle)) {\n\t\t\t/* extract_pdu_server will add the record handle\n\t\t\t * if it is missing. So instead of failing, skip\n\t\t\t * the record adding to avoid duplication. */\n\t\t\tgoto success;\n\t\t}\n\t}\n\n\tsdp_record_add(&req->device, rec);\n\tif (!(req->flags & SDP_RECORD_PERSIST))\n\t\tsdp_svcdb_set_collectable(rec, req->sock);\n\n\thandle = sdp_data_alloc(SDP_UINT32, &rec->handle);\n\tsdp_attr_replace(rec, SDP_ATTR_RECORD_HANDLE, handle);\n\nsuccess:\n\t/* if the browse group descriptor is NULL,\n\t * ensure that the record belongs to the ROOT group */\n\tif (sdp_data_get(rec, SDP_ATTR_BROWSE_GRP_LIST) == NULL) {\n\t\tuuid_t uuid;\n\t\tsdp_uuid16_create(&uuid, PUBLIC_BROWSE_GROUP);\n\t\tsdp_pattern_add_uuid(rec, &uuid);\n\t}\n\n\tupdate_db_timestamp();\n\n\t/* Build a rsp buffer */\n\tput_be32(rec->handle, rsp->data);\n\trsp->data_size = sizeof(uint32_t);\n\n\treturn 0;\n\ninvalid:\n\tput_be16(SDP_INVALID_SYNTAX, rsp->data);\n\trsp->data_size = sizeof(uint16_t);\n\n\treturn -1;\n}"
  },
  {
    "function_name": "extract_pdu_server",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/sdpd-service.c",
    "lines": "713-811",
    "snippet": "static sdp_record_t *extract_pdu_server(bdaddr_t *device, uint8_t *p,\n\t\t\t\t\tunsigned int bufsize,\n\t\t\t\t\tuint32_t handleExpected, int *scanned)\n{\n\tint extractStatus = -1, localExtractedLength = 0;\n\tuint8_t dtd;\n\tint seqlen = 0;\n\tsdp_record_t *rec = NULL;\n\tuint16_t attrId, lookAheadAttrId;\n\tsdp_data_t *pAttr = NULL;\n\tuint32_t handle = 0xffffffff;\n\n\t*scanned = sdp_extract_seqtype(p, bufsize, &dtd, &seqlen);\n\tp += *scanned;\n\tbufsize -= *scanned;\n\n\tif (bufsize < sizeof(uint8_t) + sizeof(uint8_t)) {\n\t\tSDPDBG(\"Unexpected end of packet\");\n\t\treturn NULL;\n\t}\n\n\tlookAheadAttrId = get_be16(p + sizeof(uint8_t));\n\n\tSDPDBG(\"Look ahead attr id : %d\", lookAheadAttrId);\n\n\tif (lookAheadAttrId == SDP_ATTR_RECORD_HANDLE) {\n\t\tif (bufsize < (sizeof(uint8_t) * 2) +\n\t\t\t\t\tsizeof(uint16_t) + sizeof(uint32_t)) {\n\t\t\tSDPDBG(\"Unexpected end of packet\");\n\t\t\treturn NULL;\n\t\t}\n\t\thandle = get_be32(p + sizeof(uint8_t) + sizeof(uint16_t) +\n\t\t\t\t\t\t\tsizeof(uint8_t));\n\t\tSDPDBG(\"SvcRecHandle : 0x%x\", handle);\n\t\trec = sdp_record_find(handle);\n\t} else if (handleExpected != 0xffffffff)\n\t\trec = sdp_record_find(handleExpected);\n\n\tif (!rec) {\n\t\trec = sdp_record_alloc();\n\t\trec->attrlist = NULL;\n\t\tif (lookAheadAttrId == SDP_ATTR_RECORD_HANDLE) {\n\t\t\trec->handle = handle;\n\t\t\tsdp_record_add(device, rec);\n\t\t} else if (handleExpected != 0xffffffff) {\n\t\t\trec->handle = handleExpected;\n\t\t\tsdp_record_add(device, rec);\n\t\t}\n\t} else {\n\t\tsdp_list_free(rec->attrlist, (sdp_free_func_t) sdp_data_free);\n\t\trec->attrlist = NULL;\n\t}\n\n\twhile (localExtractedLength < seqlen) {\n\t\tint attrSize = sizeof(uint8_t);\n\t\tint attrValueLength = 0;\n\n\t\tif (bufsize < attrSize + sizeof(uint16_t)) {\n\t\t\tSDPDBG(\"Unexpected end of packet: Terminating extraction of attributes\");\n\t\t\tbreak;\n\t\t}\n\n\t\tSDPDBG(\"Extract PDU, sequenceLength: %d localExtractedLength: %d\",\n\t\t\t\t\t\t\tseqlen, localExtractedLength);\n\t\tdtd = *(uint8_t *) p;\n\n\t\tattrId = get_be16(p + attrSize);\n\t\tattrSize += sizeof(uint16_t);\n\n\t\tSDPDBG(\"DTD of attrId : %d Attr id : 0x%x\", dtd, attrId);\n\n\t\tpAttr = sdp_extract_attr(p + attrSize, bufsize - attrSize,\n\t\t\t\t\t\t\t&attrValueLength, rec);\n\n\t\tSDPDBG(\"Attr id : 0x%x attrValueLength : %d\", attrId, attrValueLength);\n\n\t\tattrSize += attrValueLength;\n\t\tif (pAttr == NULL) {\n\t\t\tSDPDBG(\"Terminating extraction of attributes\");\n\t\t\tbreak;\n\t\t}\n\t\tlocalExtractedLength += attrSize;\n\t\tp += attrSize;\n\t\tbufsize -= attrSize;\n\t\tsdp_attr_replace(rec, attrId, pAttr);\n\t\textractStatus = 0;\n\t\tSDPDBG(\"Extract PDU, seqLength: %d localExtractedLength: %d\",\n\t\t\t\t\tseqlen, localExtractedLength);\n\t}\n\n\tif (extractStatus == 0) {\n\t\tSDPDBG(\"Successful extracting of Svc Rec attributes\");\n#ifdef SDP_DEBUG\n\t\tsdp_print_service_attr(rec->attrlist);\n#endif\n\t\t*scanned += seqlen;\n\t}\n\treturn rec;\n}",
    "includes": [
      "#include \"log.h\"",
      "#include \"sdpd.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <glib.h>",
      "#include <stdbool.h>",
      "#include <sys/time.h>",
      "#include <assert.h>",
      "#include <stdlib.h>",
      "#include <errno.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "sdp_print_service_attr",
          "args": [
            "rec->attrlist"
          ],
          "line": 806
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "SDPDBG",
          "args": [
            "\"Successful extracting of Svc Rec attributes\""
          ],
          "line": 804
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "SDPDBG",
          "args": [
            "\"Extract PDU, seqLength: %d localExtractedLength: %d\"",
            "seqlen",
            "localExtractedLength"
          ],
          "line": 799
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_attr_replace",
          "args": [
            "rec",
            "attrId",
            "pAttr"
          ],
          "line": 797
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "SDPDBG",
          "args": [
            "\"Terminating extraction of attributes\""
          ],
          "line": 791
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "SDPDBG",
          "args": [
            "\"Attr id : 0x%x attrValueLength : %d\"",
            "attrId",
            "attrValueLength"
          ],
          "line": 787
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_extract_attr",
          "args": [
            "p + attrSize",
            "bufsize - attrSize",
            "&attrValueLength",
            "rec"
          ],
          "line": 784
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "SDPDBG",
          "args": [
            "\"DTD of attrId : %d Attr id : 0x%x\"",
            "dtd",
            "attrId"
          ],
          "line": 782
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "get_be16",
          "args": [
            "p + attrSize"
          ],
          "line": 779
        },
        "resolved": true,
        "details": {
          "function_name": "get_be16",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/util.h",
          "lines": "134-137",
          "snippet": "static inline uint16_t get_be16(const void *ptr)\n{\n\treturn be16_to_cpu(get_unaligned((const uint16_t *) ptr));\n}",
          "includes": [
            "#include <string.h>",
            "#include <byteswap.h>",
            "#include <alloca.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <byteswap.h>\n#include <alloca.h>\n#include <stdlib.h>\n#include <stdint.h>\n\nstatic inline uint16_t get_be16(const void *ptr)\n{\n\treturn be16_to_cpu(get_unaligned((const uint16_t *) ptr));\n}"
        }
      },
      {
        "call_info": {
          "callee": "SDPDBG",
          "args": [
            "\"Extract PDU, sequenceLength: %d localExtractedLength: %d\"",
            "seqlen",
            "localExtractedLength"
          ],
          "line": 775
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "SDPDBG",
          "args": [
            "\"Unexpected end of packet: Terminating extraction of attributes\""
          ],
          "line": 771
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_list_free",
          "args": [
            "rec->attrlist",
            "(sdp_free_func_t) sdp_data_free"
          ],
          "line": 762
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_record_add",
          "args": [
            "device",
            "rec"
          ],
          "line": 759
        },
        "resolved": true,
        "details": {
          "function_name": "sdp_record_add",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/sdpd-database.c",
          "lines": "175-192",
          "snippet": "void sdp_record_add(const bdaddr_t *device, sdp_record_t *rec)\n{\n\tsdp_access_t *dev;\n\n\tSDPDBG(\"Adding rec : 0x%lx\", (long) rec);\n\tSDPDBG(\"with handle : 0x%x\", rec->handle);\n\n\tservice_db = sdp_list_insert_sorted(service_db, rec, record_sort);\n\n\tdev = malloc(sizeof(*dev));\n\tif (!dev)\n\t\treturn;\n\n\tbacpy(&dev->device, device);\n\tdev->handle = rec->handle;\n\n\taccess_db = sdp_list_insert_sorted(access_db, dev, access_sort);\n}",
          "includes": [
            "#include \"log.h\"",
            "#include \"sdpd.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static sdp_list_t *service_db;",
            "static sdp_list_t *access_db;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n#include \"sdpd.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <stdbool.h>\n#include <stdlib.h>\n#include <config.h>\n\nstatic sdp_list_t *service_db;\nstatic sdp_list_t *access_db;\n\nvoid sdp_record_add(const bdaddr_t *device, sdp_record_t *rec)\n{\n\tsdp_access_t *dev;\n\n\tSDPDBG(\"Adding rec : 0x%lx\", (long) rec);\n\tSDPDBG(\"with handle : 0x%x\", rec->handle);\n\n\tservice_db = sdp_list_insert_sorted(service_db, rec, record_sort);\n\n\tdev = malloc(sizeof(*dev));\n\tif (!dev)\n\t\treturn;\n\n\tbacpy(&dev->device, device);\n\tdev->handle = rec->handle;\n\n\taccess_db = sdp_list_insert_sorted(access_db, dev, access_sort);\n}"
        }
      },
      {
        "call_info": {
          "callee": "sdp_record_alloc",
          "args": [],
          "line": 752
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_record_find",
          "args": [
            "handleExpected"
          ],
          "line": 749
        },
        "resolved": true,
        "details": {
          "function_name": "sdp_record_find",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/sdpd-database.c",
          "lines": "227-237",
          "snippet": "sdp_record_t *sdp_record_find(uint32_t handle)\n{\n\tsdp_list_t *p = record_locate(handle);\n\n\tif (!p) {\n\t\tSDPDBG(\"Couldn't find record for : 0x%x\", handle);\n\t\treturn 0;\n\t}\n\n\treturn p->data;\n}",
          "includes": [
            "#include \"log.h\"",
            "#include \"sdpd.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n#include \"sdpd.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <stdbool.h>\n#include <stdlib.h>\n#include <config.h>\n\nsdp_record_t *sdp_record_find(uint32_t handle)\n{\n\tsdp_list_t *p = record_locate(handle);\n\n\tif (!p) {\n\t\tSDPDBG(\"Couldn't find record for : 0x%x\", handle);\n\t\treturn 0;\n\t}\n\n\treturn p->data;\n}"
        }
      },
      {
        "call_info": {
          "callee": "SDPDBG",
          "args": [
            "\"SvcRecHandle : 0x%x\"",
            "handle"
          ],
          "line": 746
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "get_be32",
          "args": [
            "p + sizeof(uint8_t) + sizeof(uint16_t) +\n\t\t\t\t\t\t\tsizeof(uint8_t)"
          ],
          "line": 744
        },
        "resolved": true,
        "details": {
          "function_name": "get_be32",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/util.h",
          "lines": "144-147",
          "snippet": "static inline uint32_t get_be32(const void *ptr)\n{\n\treturn be32_to_cpu(get_unaligned((const uint32_t *) ptr));\n}",
          "includes": [
            "#include <string.h>",
            "#include <byteswap.h>",
            "#include <alloca.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <byteswap.h>\n#include <alloca.h>\n#include <stdlib.h>\n#include <stdint.h>\n\nstatic inline uint32_t get_be32(const void *ptr)\n{\n\treturn be32_to_cpu(get_unaligned((const uint32_t *) ptr));\n}"
        }
      },
      {
        "call_info": {
          "callee": "SDPDBG",
          "args": [
            "\"Unexpected end of packet\""
          ],
          "line": 741
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "SDPDBG",
          "args": [
            "\"Look ahead attr id : %d\"",
            "lookAheadAttrId"
          ],
          "line": 736
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "SDPDBG",
          "args": [
            "\"Unexpected end of packet\""
          ],
          "line": 730
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_extract_seqtype",
          "args": [
            "p",
            "bufsize",
            "&dtd",
            "&seqlen"
          ],
          "line": 725
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"log.h\"\n#include \"sdpd.h\"\n#include \"src/shared/util.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <stdbool.h>\n#include <sys/time.h>\n#include <assert.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <config.h>\n\nstatic sdp_record_t *extract_pdu_server(bdaddr_t *device, uint8_t *p,\n\t\t\t\t\tunsigned int bufsize,\n\t\t\t\t\tuint32_t handleExpected, int *scanned)\n{\n\tint extractStatus = -1, localExtractedLength = 0;\n\tuint8_t dtd;\n\tint seqlen = 0;\n\tsdp_record_t *rec = NULL;\n\tuint16_t attrId, lookAheadAttrId;\n\tsdp_data_t *pAttr = NULL;\n\tuint32_t handle = 0xffffffff;\n\n\t*scanned = sdp_extract_seqtype(p, bufsize, &dtd, &seqlen);\n\tp += *scanned;\n\tbufsize -= *scanned;\n\n\tif (bufsize < sizeof(uint8_t) + sizeof(uint8_t)) {\n\t\tSDPDBG(\"Unexpected end of packet\");\n\t\treturn NULL;\n\t}\n\n\tlookAheadAttrId = get_be16(p + sizeof(uint8_t));\n\n\tSDPDBG(\"Look ahead attr id : %d\", lookAheadAttrId);\n\n\tif (lookAheadAttrId == SDP_ATTR_RECORD_HANDLE) {\n\t\tif (bufsize < (sizeof(uint8_t) * 2) +\n\t\t\t\t\tsizeof(uint16_t) + sizeof(uint32_t)) {\n\t\t\tSDPDBG(\"Unexpected end of packet\");\n\t\t\treturn NULL;\n\t\t}\n\t\thandle = get_be32(p + sizeof(uint8_t) + sizeof(uint16_t) +\n\t\t\t\t\t\t\tsizeof(uint8_t));\n\t\tSDPDBG(\"SvcRecHandle : 0x%x\", handle);\n\t\trec = sdp_record_find(handle);\n\t} else if (handleExpected != 0xffffffff)\n\t\trec = sdp_record_find(handleExpected);\n\n\tif (!rec) {\n\t\trec = sdp_record_alloc();\n\t\trec->attrlist = NULL;\n\t\tif (lookAheadAttrId == SDP_ATTR_RECORD_HANDLE) {\n\t\t\trec->handle = handle;\n\t\t\tsdp_record_add(device, rec);\n\t\t} else if (handleExpected != 0xffffffff) {\n\t\t\trec->handle = handleExpected;\n\t\t\tsdp_record_add(device, rec);\n\t\t}\n\t} else {\n\t\tsdp_list_free(rec->attrlist, (sdp_free_func_t) sdp_data_free);\n\t\trec->attrlist = NULL;\n\t}\n\n\twhile (localExtractedLength < seqlen) {\n\t\tint attrSize = sizeof(uint8_t);\n\t\tint attrValueLength = 0;\n\n\t\tif (bufsize < attrSize + sizeof(uint16_t)) {\n\t\t\tSDPDBG(\"Unexpected end of packet: Terminating extraction of attributes\");\n\t\t\tbreak;\n\t\t}\n\n\t\tSDPDBG(\"Extract PDU, sequenceLength: %d localExtractedLength: %d\",\n\t\t\t\t\t\t\tseqlen, localExtractedLength);\n\t\tdtd = *(uint8_t *) p;\n\n\t\tattrId = get_be16(p + attrSize);\n\t\tattrSize += sizeof(uint16_t);\n\n\t\tSDPDBG(\"DTD of attrId : %d Attr id : 0x%x\", dtd, attrId);\n\n\t\tpAttr = sdp_extract_attr(p + attrSize, bufsize - attrSize,\n\t\t\t\t\t\t\t&attrValueLength, rec);\n\n\t\tSDPDBG(\"Attr id : 0x%x attrValueLength : %d\", attrId, attrValueLength);\n\n\t\tattrSize += attrValueLength;\n\t\tif (pAttr == NULL) {\n\t\t\tSDPDBG(\"Terminating extraction of attributes\");\n\t\t\tbreak;\n\t\t}\n\t\tlocalExtractedLength += attrSize;\n\t\tp += attrSize;\n\t\tbufsize -= attrSize;\n\t\tsdp_attr_replace(rec, attrId, pAttr);\n\t\textractStatus = 0;\n\t\tSDPDBG(\"Extract PDU, seqLength: %d localExtractedLength: %d\",\n\t\t\t\t\tseqlen, localExtractedLength);\n\t}\n\n\tif (extractStatus == 0) {\n\t\tSDPDBG(\"Successful extracting of Svc Rec attributes\");\n#ifdef SDP_DEBUG\n\t\tsdp_print_service_attr(rec->attrlist);\n#endif\n\t\t*scanned += seqlen;\n\t}\n\treturn rec;\n}"
  },
  {
    "function_name": "remove_record_from_server",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/sdpd-service.c",
    "lines": "688-710",
    "snippet": "int remove_record_from_server(uint32_t handle)\n{\n\tsdp_record_t *rec;\n\n\t/* Refuse to remove the server's own record */\n\tif (handle == SDP_SERVER_RECORD_HANDLE)\n\t\treturn -EINVAL;\n\n\tDBG(\"Removing record with handle 0x%05x\", handle);\n\n\trec = sdp_record_find(handle);\n\tif (!rec)\n\t\treturn -ENOENT;\n\n\tif (sdp_record_remove(handle) == 0) {\n\t\tupdate_mps();\n\t\tupdate_db_timestamp();\n\t}\n\n\tsdp_record_free(rec);\n\n\treturn 0;\n}",
    "includes": [
      "#include \"log.h\"",
      "#include \"sdpd.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <glib.h>",
      "#include <stdbool.h>",
      "#include <sys/time.h>",
      "#include <assert.h>",
      "#include <stdlib.h>",
      "#include <errno.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static sdp_record_t *server = NULL;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "sdp_record_free",
          "args": [
            "rec"
          ],
          "line": 707
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "update_db_timestamp",
          "args": [],
          "line": 704
        },
        "resolved": true,
        "details": {
          "function_name": "update_db_timestamp",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/sdpd-service.c",
          "lines": "311-321",
          "snippet": "static void update_db_timestamp(void)\n{\n\tif (fixed_dbts) {\n\t\tsdp_data_t *d = sdp_data_alloc(SDP_UINT32, &fixed_dbts);\n\t\tsdp_attr_replace(server, SDP_ATTR_SVCDB_STATE, d);\n\t} else {\n\t\tuint32_t dbts = sdp_get_time();\n\t\tsdp_data_t *d = sdp_data_alloc(SDP_UINT32, &dbts);\n\t\tsdp_attr_replace(server, SDP_ATTR_SVCDB_STATE, d);\n\t}\n}",
          "includes": [
            "#include \"log.h\"",
            "#include \"sdpd.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <stdbool.h>",
            "#include <sys/time.h>",
            "#include <assert.h>",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static sdp_record_t *server = NULL;",
            "static uint32_t fixed_dbts = 0;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n#include \"sdpd.h\"\n#include \"src/shared/util.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <stdbool.h>\n#include <sys/time.h>\n#include <assert.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <config.h>\n\nstatic sdp_record_t *server = NULL;\nstatic uint32_t fixed_dbts = 0;\n\nstatic void update_db_timestamp(void)\n{\n\tif (fixed_dbts) {\n\t\tsdp_data_t *d = sdp_data_alloc(SDP_UINT32, &fixed_dbts);\n\t\tsdp_attr_replace(server, SDP_ATTR_SVCDB_STATE, d);\n\t} else {\n\t\tuint32_t dbts = sdp_get_time();\n\t\tsdp_data_t *d = sdp_data_alloc(SDP_UINT32, &dbts);\n\t\tsdp_attr_replace(server, SDP_ATTR_SVCDB_STATE, d);\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "update_mps",
          "args": [],
          "line": 703
        },
        "resolved": true,
        "details": {
          "function_name": "update_mps",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/sdpd-service.c",
          "lines": "621-643",
          "snippet": "static void update_mps(void)\n{\n\tsdp_record_t *rec;\n\tsdp_data_t *data;\n\tuint64_t mpsd_feat, mpmd_feat;\n\n\tif (!mps_handle)\n\t\treturn;\n\n\trec = sdp_record_find(mps_handle);\n\tif (!rec)\n\t\treturn;\n\n\tmpsd_feat = mps_mpsd_features();\n\tdata = sdp_data_alloc(SDP_UINT64, &mpsd_feat);\n\tsdp_attr_replace(rec, SDP_ATTR_MPSD_SCENARIOS, data);\n\n\tif (mps_mpmd) {\n\t\tmpmd_feat = mps_mpmd_features();\n\t\tdata = sdp_data_alloc(SDP_UINT64, &mpmd_feat);\n\t\tsdp_attr_replace(rec, SDP_ATTR_MPMD_SCENARIOS, data);\n\t}\n}",
          "includes": [
            "#include \"log.h\"",
            "#include \"sdpd.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <stdbool.h>",
            "#include <sys/time.h>",
            "#include <assert.h>",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static uint32_t mps_handle = 0;",
            "static bool mps_mpmd = false;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n#include \"sdpd.h\"\n#include \"src/shared/util.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <stdbool.h>\n#include <sys/time.h>\n#include <assert.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <config.h>\n\nstatic uint32_t mps_handle = 0;\nstatic bool mps_mpmd = false;\n\nstatic void update_mps(void)\n{\n\tsdp_record_t *rec;\n\tsdp_data_t *data;\n\tuint64_t mpsd_feat, mpmd_feat;\n\n\tif (!mps_handle)\n\t\treturn;\n\n\trec = sdp_record_find(mps_handle);\n\tif (!rec)\n\t\treturn;\n\n\tmpsd_feat = mps_mpsd_features();\n\tdata = sdp_data_alloc(SDP_UINT64, &mpsd_feat);\n\tsdp_attr_replace(rec, SDP_ATTR_MPSD_SCENARIOS, data);\n\n\tif (mps_mpmd) {\n\t\tmpmd_feat = mps_mpmd_features();\n\t\tdata = sdp_data_alloc(SDP_UINT64, &mpmd_feat);\n\t\tsdp_attr_replace(rec, SDP_ATTR_MPMD_SCENARIOS, data);\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "sdp_record_remove",
          "args": [
            "handle"
          ],
          "line": 702
        },
        "resolved": true,
        "details": {
          "function_name": "sdp_record_remove",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/sdpd-database.c",
          "lines": "242-267",
          "snippet": "int sdp_record_remove(uint32_t handle)\n{\n\tsdp_list_t *p = record_locate(handle);\n\tsdp_record_t *r;\n\tsdp_access_t *a;\n\n\tif (!p) {\n\t\terror(\"Remove : Couldn't find record for : 0x%x\", handle);\n\t\treturn -1;\n\t}\n\n\tr = p->data;\n\tif (r)\n\t\tservice_db = sdp_list_remove(service_db, r);\n\n\tp = access_locate(handle);\n\tif (p == NULL || p->data == NULL)\n\t\treturn 0;\n\n\ta = p->data;\n\n\taccess_db = sdp_list_remove(access_db, a);\n\taccess_free(a);\n\n\treturn 0;\n}",
          "includes": [
            "#include \"log.h\"",
            "#include \"sdpd.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static sdp_list_t *service_db;",
            "static sdp_list_t *access_db;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n#include \"sdpd.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <stdbool.h>\n#include <stdlib.h>\n#include <config.h>\n\nstatic sdp_list_t *service_db;\nstatic sdp_list_t *access_db;\n\nint sdp_record_remove(uint32_t handle)\n{\n\tsdp_list_t *p = record_locate(handle);\n\tsdp_record_t *r;\n\tsdp_access_t *a;\n\n\tif (!p) {\n\t\terror(\"Remove : Couldn't find record for : 0x%x\", handle);\n\t\treturn -1;\n\t}\n\n\tr = p->data;\n\tif (r)\n\t\tservice_db = sdp_list_remove(service_db, r);\n\n\tp = access_locate(handle);\n\tif (p == NULL || p->data == NULL)\n\t\treturn 0;\n\n\ta = p->data;\n\n\taccess_db = sdp_list_remove(access_db, a);\n\taccess_free(a);\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "sdp_record_find",
          "args": [
            "handle"
          ],
          "line": 698
        },
        "resolved": true,
        "details": {
          "function_name": "sdp_record_find",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/sdpd-database.c",
          "lines": "227-237",
          "snippet": "sdp_record_t *sdp_record_find(uint32_t handle)\n{\n\tsdp_list_t *p = record_locate(handle);\n\n\tif (!p) {\n\t\tSDPDBG(\"Couldn't find record for : 0x%x\", handle);\n\t\treturn 0;\n\t}\n\n\treturn p->data;\n}",
          "includes": [
            "#include \"log.h\"",
            "#include \"sdpd.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n#include \"sdpd.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <stdbool.h>\n#include <stdlib.h>\n#include <config.h>\n\nsdp_record_t *sdp_record_find(uint32_t handle)\n{\n\tsdp_list_t *p = record_locate(handle);\n\n\tif (!p) {\n\t\tSDPDBG(\"Couldn't find record for : 0x%x\", handle);\n\t\treturn 0;\n\t}\n\n\treturn p->data;\n}"
        }
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"Removing record with handle 0x%05x\"",
            "handle"
          ],
          "line": 696
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"log.h\"\n#include \"sdpd.h\"\n#include \"src/shared/util.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <stdbool.h>\n#include <sys/time.h>\n#include <assert.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <config.h>\n\nstatic sdp_record_t *server = NULL;\n\nint remove_record_from_server(uint32_t handle)\n{\n\tsdp_record_t *rec;\n\n\t/* Refuse to remove the server's own record */\n\tif (handle == SDP_SERVER_RECORD_HANDLE)\n\t\treturn -EINVAL;\n\n\tDBG(\"Removing record with handle 0x%05x\", handle);\n\n\trec = sdp_record_find(handle);\n\tif (!rec)\n\t\treturn -ENOENT;\n\n\tif (sdp_record_remove(handle) == 0) {\n\t\tupdate_mps();\n\t\tupdate_db_timestamp();\n\t}\n\n\tsdp_record_free(rec);\n\n\treturn 0;\n}"
  },
  {
    "function_name": "add_record_to_server",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/sdpd-service.c",
    "lines": "645-686",
    "snippet": "int add_record_to_server(const bdaddr_t *src, sdp_record_t *rec)\n{\n\tsdp_data_t *data;\n\tsdp_list_t *pattern;\n\n\tif (rec->handle == 0xffffffff) {\n\t\trec->handle = sdp_next_handle();\n\t\tif (rec->handle < 0x10000)\n\t\t\treturn -ENOSPC;\n\t} else {\n\t\tif (sdp_record_find(rec->handle))\n\t\t\treturn -EEXIST;\n\t}\n\n\tDBG(\"Adding record with handle 0x%05x\", rec->handle);\n\n\tsdp_record_add(src, rec);\n\n\tdata = sdp_data_alloc(SDP_UINT32, &rec->handle);\n\tsdp_attr_replace(rec, SDP_ATTR_RECORD_HANDLE, data);\n\n\tif (sdp_data_get(rec, SDP_ATTR_BROWSE_GRP_LIST) == NULL) {\n\t\tuuid_t uuid;\n\t\tsdp_uuid16_create(&uuid, PUBLIC_BROWSE_GROUP);\n\t\tsdp_pattern_add_uuid(rec, &uuid);\n\t}\n\n\tfor (pattern = rec->pattern; pattern; pattern = pattern->next) {\n\t\tchar uuid[32];\n\n\t\tif (pattern->data == NULL)\n\t\t\tcontinue;\n\n\t\tsdp_uuid2strn((uuid_t *) pattern->data, uuid, sizeof(uuid));\n\t\tDBG(\"Record pattern UUID %s\", uuid);\n\t}\n\n\tupdate_mps();\n\tupdate_db_timestamp();\n\n\treturn 0;\n}",
    "includes": [
      "#include \"log.h\"",
      "#include \"sdpd.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <glib.h>",
      "#include <stdbool.h>",
      "#include <sys/time.h>",
      "#include <assert.h>",
      "#include <stdlib.h>",
      "#include <errno.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "update_db_timestamp",
          "args": [],
          "line": 683
        },
        "resolved": true,
        "details": {
          "function_name": "update_db_timestamp",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/sdpd-service.c",
          "lines": "311-321",
          "snippet": "static void update_db_timestamp(void)\n{\n\tif (fixed_dbts) {\n\t\tsdp_data_t *d = sdp_data_alloc(SDP_UINT32, &fixed_dbts);\n\t\tsdp_attr_replace(server, SDP_ATTR_SVCDB_STATE, d);\n\t} else {\n\t\tuint32_t dbts = sdp_get_time();\n\t\tsdp_data_t *d = sdp_data_alloc(SDP_UINT32, &dbts);\n\t\tsdp_attr_replace(server, SDP_ATTR_SVCDB_STATE, d);\n\t}\n}",
          "includes": [
            "#include \"log.h\"",
            "#include \"sdpd.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <stdbool.h>",
            "#include <sys/time.h>",
            "#include <assert.h>",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static sdp_record_t *server = NULL;",
            "static uint32_t fixed_dbts = 0;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n#include \"sdpd.h\"\n#include \"src/shared/util.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <stdbool.h>\n#include <sys/time.h>\n#include <assert.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <config.h>\n\nstatic sdp_record_t *server = NULL;\nstatic uint32_t fixed_dbts = 0;\n\nstatic void update_db_timestamp(void)\n{\n\tif (fixed_dbts) {\n\t\tsdp_data_t *d = sdp_data_alloc(SDP_UINT32, &fixed_dbts);\n\t\tsdp_attr_replace(server, SDP_ATTR_SVCDB_STATE, d);\n\t} else {\n\t\tuint32_t dbts = sdp_get_time();\n\t\tsdp_data_t *d = sdp_data_alloc(SDP_UINT32, &dbts);\n\t\tsdp_attr_replace(server, SDP_ATTR_SVCDB_STATE, d);\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "update_mps",
          "args": [],
          "line": 682
        },
        "resolved": true,
        "details": {
          "function_name": "update_mps",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/sdpd-service.c",
          "lines": "621-643",
          "snippet": "static void update_mps(void)\n{\n\tsdp_record_t *rec;\n\tsdp_data_t *data;\n\tuint64_t mpsd_feat, mpmd_feat;\n\n\tif (!mps_handle)\n\t\treturn;\n\n\trec = sdp_record_find(mps_handle);\n\tif (!rec)\n\t\treturn;\n\n\tmpsd_feat = mps_mpsd_features();\n\tdata = sdp_data_alloc(SDP_UINT64, &mpsd_feat);\n\tsdp_attr_replace(rec, SDP_ATTR_MPSD_SCENARIOS, data);\n\n\tif (mps_mpmd) {\n\t\tmpmd_feat = mps_mpmd_features();\n\t\tdata = sdp_data_alloc(SDP_UINT64, &mpmd_feat);\n\t\tsdp_attr_replace(rec, SDP_ATTR_MPMD_SCENARIOS, data);\n\t}\n}",
          "includes": [
            "#include \"log.h\"",
            "#include \"sdpd.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <stdbool.h>",
            "#include <sys/time.h>",
            "#include <assert.h>",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static uint32_t mps_handle = 0;",
            "static bool mps_mpmd = false;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n#include \"sdpd.h\"\n#include \"src/shared/util.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <stdbool.h>\n#include <sys/time.h>\n#include <assert.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <config.h>\n\nstatic uint32_t mps_handle = 0;\nstatic bool mps_mpmd = false;\n\nstatic void update_mps(void)\n{\n\tsdp_record_t *rec;\n\tsdp_data_t *data;\n\tuint64_t mpsd_feat, mpmd_feat;\n\n\tif (!mps_handle)\n\t\treturn;\n\n\trec = sdp_record_find(mps_handle);\n\tif (!rec)\n\t\treturn;\n\n\tmpsd_feat = mps_mpsd_features();\n\tdata = sdp_data_alloc(SDP_UINT64, &mpsd_feat);\n\tsdp_attr_replace(rec, SDP_ATTR_MPSD_SCENARIOS, data);\n\n\tif (mps_mpmd) {\n\t\tmpmd_feat = mps_mpmd_features();\n\t\tdata = sdp_data_alloc(SDP_UINT64, &mpmd_feat);\n\t\tsdp_attr_replace(rec, SDP_ATTR_MPMD_SCENARIOS, data);\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"Record pattern UUID %s\"",
            "uuid"
          ],
          "line": 679
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_uuid2strn",
          "args": [
            "(uuid_t *) pattern->data",
            "uuid",
            "sizeof(uuid)"
          ],
          "line": 678
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_pattern_add_uuid",
          "args": [
            "rec",
            "&uuid"
          ],
          "line": 669
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_uuid16_create",
          "args": [
            "&uuid",
            "PUBLIC_BROWSE_GROUP"
          ],
          "line": 668
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_data_get",
          "args": [
            "rec",
            "SDP_ATTR_BROWSE_GRP_LIST"
          ],
          "line": 666
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_attr_replace",
          "args": [
            "rec",
            "SDP_ATTR_RECORD_HANDLE",
            "data"
          ],
          "line": 664
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_data_alloc",
          "args": [
            "SDP_UINT32",
            "&rec->handle"
          ],
          "line": 663
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_record_add",
          "args": [
            "src",
            "rec"
          ],
          "line": 661
        },
        "resolved": true,
        "details": {
          "function_name": "sdp_record_add",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/sdpd-database.c",
          "lines": "175-192",
          "snippet": "void sdp_record_add(const bdaddr_t *device, sdp_record_t *rec)\n{\n\tsdp_access_t *dev;\n\n\tSDPDBG(\"Adding rec : 0x%lx\", (long) rec);\n\tSDPDBG(\"with handle : 0x%x\", rec->handle);\n\n\tservice_db = sdp_list_insert_sorted(service_db, rec, record_sort);\n\n\tdev = malloc(sizeof(*dev));\n\tif (!dev)\n\t\treturn;\n\n\tbacpy(&dev->device, device);\n\tdev->handle = rec->handle;\n\n\taccess_db = sdp_list_insert_sorted(access_db, dev, access_sort);\n}",
          "includes": [
            "#include \"log.h\"",
            "#include \"sdpd.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static sdp_list_t *service_db;",
            "static sdp_list_t *access_db;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n#include \"sdpd.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <stdbool.h>\n#include <stdlib.h>\n#include <config.h>\n\nstatic sdp_list_t *service_db;\nstatic sdp_list_t *access_db;\n\nvoid sdp_record_add(const bdaddr_t *device, sdp_record_t *rec)\n{\n\tsdp_access_t *dev;\n\n\tSDPDBG(\"Adding rec : 0x%lx\", (long) rec);\n\tSDPDBG(\"with handle : 0x%x\", rec->handle);\n\n\tservice_db = sdp_list_insert_sorted(service_db, rec, record_sort);\n\n\tdev = malloc(sizeof(*dev));\n\tif (!dev)\n\t\treturn;\n\n\tbacpy(&dev->device, device);\n\tdev->handle = rec->handle;\n\n\taccess_db = sdp_list_insert_sorted(access_db, dev, access_sort);\n}"
        }
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"Adding record with handle 0x%05x\"",
            "rec->handle"
          ],
          "line": 659
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_record_find",
          "args": [
            "rec->handle"
          ],
          "line": 655
        },
        "resolved": true,
        "details": {
          "function_name": "sdp_record_find",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/sdpd-database.c",
          "lines": "227-237",
          "snippet": "sdp_record_t *sdp_record_find(uint32_t handle)\n{\n\tsdp_list_t *p = record_locate(handle);\n\n\tif (!p) {\n\t\tSDPDBG(\"Couldn't find record for : 0x%x\", handle);\n\t\treturn 0;\n\t}\n\n\treturn p->data;\n}",
          "includes": [
            "#include \"log.h\"",
            "#include \"sdpd.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n#include \"sdpd.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <stdbool.h>\n#include <stdlib.h>\n#include <config.h>\n\nsdp_record_t *sdp_record_find(uint32_t handle)\n{\n\tsdp_list_t *p = record_locate(handle);\n\n\tif (!p) {\n\t\tSDPDBG(\"Couldn't find record for : 0x%x\", handle);\n\t\treturn 0;\n\t}\n\n\treturn p->data;\n}"
        }
      },
      {
        "call_info": {
          "callee": "sdp_next_handle",
          "args": [],
          "line": 651
        },
        "resolved": true,
        "details": {
          "function_name": "sdp_next_handle",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/sdpd-database.c",
          "lines": "297-305",
          "snippet": "uint32_t sdp_next_handle(void)\n{\n\tuint32_t handle = 0x10000;\n\n\twhile (sdp_record_find(handle))\n\t\thandle++;\n\n\treturn handle;\n}",
          "includes": [
            "#include \"log.h\"",
            "#include \"sdpd.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n#include \"sdpd.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <stdbool.h>\n#include <stdlib.h>\n#include <config.h>\n\nuint32_t sdp_next_handle(void)\n{\n\tuint32_t handle = 0x10000;\n\n\twhile (sdp_record_find(handle))\n\t\thandle++;\n\n\treturn handle;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"log.h\"\n#include \"sdpd.h\"\n#include \"src/shared/util.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <stdbool.h>\n#include <sys/time.h>\n#include <assert.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <config.h>\n\nint add_record_to_server(const bdaddr_t *src, sdp_record_t *rec)\n{\n\tsdp_data_t *data;\n\tsdp_list_t *pattern;\n\n\tif (rec->handle == 0xffffffff) {\n\t\trec->handle = sdp_next_handle();\n\t\tif (rec->handle < 0x10000)\n\t\t\treturn -ENOSPC;\n\t} else {\n\t\tif (sdp_record_find(rec->handle))\n\t\t\treturn -EEXIST;\n\t}\n\n\tDBG(\"Adding record with handle 0x%05x\", rec->handle);\n\n\tsdp_record_add(src, rec);\n\n\tdata = sdp_data_alloc(SDP_UINT32, &rec->handle);\n\tsdp_attr_replace(rec, SDP_ATTR_RECORD_HANDLE, data);\n\n\tif (sdp_data_get(rec, SDP_ATTR_BROWSE_GRP_LIST) == NULL) {\n\t\tuuid_t uuid;\n\t\tsdp_uuid16_create(&uuid, PUBLIC_BROWSE_GROUP);\n\t\tsdp_pattern_add_uuid(rec, &uuid);\n\t}\n\n\tfor (pattern = rec->pattern; pattern; pattern = pattern->next) {\n\t\tchar uuid[32];\n\n\t\tif (pattern->data == NULL)\n\t\t\tcontinue;\n\n\t\tsdp_uuid2strn((uuid_t *) pattern->data, uuid, sizeof(uuid));\n\t\tDBG(\"Record pattern UUID %s\", uuid);\n\t}\n\n\tupdate_mps();\n\tupdate_db_timestamp();\n\n\treturn 0;\n}"
  },
  {
    "function_name": "update_mps",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/sdpd-service.c",
    "lines": "621-643",
    "snippet": "static void update_mps(void)\n{\n\tsdp_record_t *rec;\n\tsdp_data_t *data;\n\tuint64_t mpsd_feat, mpmd_feat;\n\n\tif (!mps_handle)\n\t\treturn;\n\n\trec = sdp_record_find(mps_handle);\n\tif (!rec)\n\t\treturn;\n\n\tmpsd_feat = mps_mpsd_features();\n\tdata = sdp_data_alloc(SDP_UINT64, &mpsd_feat);\n\tsdp_attr_replace(rec, SDP_ATTR_MPSD_SCENARIOS, data);\n\n\tif (mps_mpmd) {\n\t\tmpmd_feat = mps_mpmd_features();\n\t\tdata = sdp_data_alloc(SDP_UINT64, &mpmd_feat);\n\t\tsdp_attr_replace(rec, SDP_ATTR_MPMD_SCENARIOS, data);\n\t}\n}",
    "includes": [
      "#include \"log.h\"",
      "#include \"sdpd.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <glib.h>",
      "#include <stdbool.h>",
      "#include <sys/time.h>",
      "#include <assert.h>",
      "#include <stdlib.h>",
      "#include <errno.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static uint32_t mps_handle = 0;",
      "static bool mps_mpmd = false;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "sdp_attr_replace",
          "args": [
            "rec",
            "SDP_ATTR_MPMD_SCENARIOS",
            "data"
          ],
          "line": 641
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_data_alloc",
          "args": [
            "SDP_UINT64",
            "&mpmd_feat"
          ],
          "line": 640
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "mps_mpmd_features",
          "args": [],
          "line": 639
        },
        "resolved": true,
        "details": {
          "function_name": "mps_mpmd_features",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/sdpd-service.c",
          "lines": "525-555",
          "snippet": "static uint64_t mps_mpmd_features(void)\n{\n\tuint64_t feat = MPS_MPMD_ALL;\n\n\tif (!class_supported(HANDSFREE_AGW_SVCLASS_ID))\n\t\tfeat &= ~MPS_MPMD_HFP_AG;\n\n\tif (!class_supported(HANDSFREE_SVCLASS_ID))\n\t\tfeat &= ~MPS_MPMD_HFP_HF;\n\n\tif (!class_supported(AUDIO_SOURCE_SVCLASS_ID))\n\t\tfeat &= ~MPS_MPMD_A2DP_SRC;\n\n\tif (!class_supported(AUDIO_SINK_SVCLASS_ID))\n\t\tfeat &= ~MPS_MPMD_A2DP_SNK;\n\telse\n\t\tfeat &= ~MPS_MPMD_AVRCP_CT_ONLY;\n\n\tif (!class_supported(AV_REMOTE_CONTROLLER_SVCLASS_ID)) {\n\t\tfeat &= ~MPS_MPMD_AVRCP_CT;\n\t\tfeat &= ~MPS_MPMD_AVRCP_CT_ONLY;\n\t}\n\n\tif (!class_supported(AV_REMOTE_TARGET_SVCLASS_ID))\n\t\tfeat &= ~MPS_MPMD_AVRCP_TG;\n\n\t/* TODO */\n\tfeat &= ~MPS_MPMD_DUN_DT;\n\n\treturn feat;\n}",
          "includes": [
            "#include \"log.h\"",
            "#include \"sdpd.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <stdbool.h>",
            "#include <sys/time.h>",
            "#include <assert.h>",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define MPS_MPMD_ALL (MPS_MPMD_HFP_AG | MPS_MPMD_HFP_HF | MPS_MPMD_A2DP_SRC | \\\n\t\t\tMPS_MPMD_A2DP_SNK | MPS_MPMD_AVRCP_CT | \\\n\t\t\tMPS_MPMD_AVRCP_CT_ONLY | MPS_MPMD_AVRCP_TG | \\\n\t\t\tMPS_MPMD_DUN_DT)",
            "#define MPS_MPMD_DUN_DT ( \\\n\t\tMPMD_A2DP_SNK_AVRCP_CT_DUN_DT_AUDIO_DURING_DATA_COMM | \\\n\t\tMPMD_A2DP_SNK_AVRCP_CT_DUN_DT_START_DATA_DURING_AUDIO)",
            "#define MPS_MPMD_AVRCP_TG MPS_MPMD_A2DP_SRC",
            "#define MPS_MPMD_AVRCP_CT_ONLY ( \\\n\t\tMPMD_AVRCP_CT_NO_A2DP_SNK_START_AUDIO_AFTER_PLAY | \\\n\t\tMPMD_AVRCP_CT_NO_A2DP_SNK_SUSPEND_AUDIO_AFTER_PAUSE)",
            "#define MPS_MPMD_AVRCP_CT MPS_MPMD_A2DP_SNK",
            "#define MPS_MPMD_A2DP_SNK ( \\\n\t\tMPMD_HFP_HF_A2DP_SNK_AVRCP_CT_ANSWER_CALL_DURING_AUDIO | \\\n\t\tMPMD_HFP_HF_A2DP_SNK_AVRCP_CT_OUTGOING_CALL_DURING_AUDIO | \\\n\t\tMPMD_HFP_HF_A2DP_SNK_AVRCP_CT_REJECT_CALL_DURING_AUDIO | \\\n\t\tMPMD_HFP_HF_A2DP_SNK_AVRCP_CT_TERMINATION_DURING_AVP | \\\n\t\tMPMD_HFP_HF_A2DP_SNK_AVRCP_CT_PLAY_DURING_CALL | \\\n\t\tMPMD_A2DP_SNK_AVRCP_CT_DUN_DT_AUDIO_DURING_DATA_COMM | \\\n\t\tMPMD_A2DP_SNK_AVRCP_CT_DUN_DT_START_DATA_DURING_AUDIO)",
            "#define MPS_MPMD_A2DP_SRC (MPMD_A2DP_SRC_AVRCP_TG_ANSWER_CALL_DURING_AUDIO | \\\n\t\t\tMPMD_A2DP_SRC_AVRCP_TG_OUTGOING_CALL_DURING_AUDIO | \\\n\t\t\tMPMD_A2DP_SRC_AVRCP_TG_REJECT_CALL_DURING_AUDIO | \\\n\t\t\tMPMD_A2DP_SRC_AVRCP_TG_TERMINATION_DURING_AVP | \\\n\t\t\tMPMD_A2DP_SRC_AVRCP_TG_PRESS_PLAY_DURING_CALL | \\\n\t\t\tMPMD_A2DP_SRC_AVRCP_TG_START_AUDIO_AFTER_PLAY | \\\n\t\t\tMPMD_A2DP_SRC_AVRCP_TG_SUSPEND_AUDIO_AFTER_PAUSE | \\\n\t\t\tMPMD_A2DP_SRC_AVRCP_TG_START_AUDIO_DURING_DATA_COMM | \\\n\t\t\tMPMD_A2DP_SRC_AVRCP_TG_START_DATA_DURING_AUDIO)",
            "#define MPS_MPMD_HFP_HF ( \\\n\t\tMPMD_HFP_HF_A2DP_SNK_AVRCP_CT_ANSWER_CALL_DURING_AUDIO | \\\n\t\tMPMD_HFP_HF_A2DP_SNK_AVRCP_CT_OUTGOING_CALL_DURING_AUDIO | \\\n\t\tMPMD_HFP_HF_A2DP_SNK_AVRCP_CT_REJECT_CALL_DURING_AUDIO | \\\n\t\tMPMD_HFP_HF_A2DP_SNK_AVRCP_CT_TERMINATION_DURING_AVP | \\\n\t\tMPMD_HFP_HF_A2DP_SNK_AVRCP_CT_PLAY_DURING_CALL)",
            "#define MPS_MPMD_HFP_AG MPMD_HFP_AG_CALL_TERMINATION_DURING_AVP"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n#include \"sdpd.h\"\n#include \"src/shared/util.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <stdbool.h>\n#include <sys/time.h>\n#include <assert.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <config.h>\n\n#define MPS_MPMD_ALL (MPS_MPMD_HFP_AG | MPS_MPMD_HFP_HF | MPS_MPMD_A2DP_SRC | \\\n\t\t\tMPS_MPMD_A2DP_SNK | MPS_MPMD_AVRCP_CT | \\\n\t\t\tMPS_MPMD_AVRCP_CT_ONLY | MPS_MPMD_AVRCP_TG | \\\n\t\t\tMPS_MPMD_DUN_DT)\n#define MPS_MPMD_DUN_DT ( \\\n\t\tMPMD_A2DP_SNK_AVRCP_CT_DUN_DT_AUDIO_DURING_DATA_COMM | \\\n\t\tMPMD_A2DP_SNK_AVRCP_CT_DUN_DT_START_DATA_DURING_AUDIO)\n#define MPS_MPMD_AVRCP_TG MPS_MPMD_A2DP_SRC\n#define MPS_MPMD_AVRCP_CT_ONLY ( \\\n\t\tMPMD_AVRCP_CT_NO_A2DP_SNK_START_AUDIO_AFTER_PLAY | \\\n\t\tMPMD_AVRCP_CT_NO_A2DP_SNK_SUSPEND_AUDIO_AFTER_PAUSE)\n#define MPS_MPMD_AVRCP_CT MPS_MPMD_A2DP_SNK\n#define MPS_MPMD_A2DP_SNK ( \\\n\t\tMPMD_HFP_HF_A2DP_SNK_AVRCP_CT_ANSWER_CALL_DURING_AUDIO | \\\n\t\tMPMD_HFP_HF_A2DP_SNK_AVRCP_CT_OUTGOING_CALL_DURING_AUDIO | \\\n\t\tMPMD_HFP_HF_A2DP_SNK_AVRCP_CT_REJECT_CALL_DURING_AUDIO | \\\n\t\tMPMD_HFP_HF_A2DP_SNK_AVRCP_CT_TERMINATION_DURING_AVP | \\\n\t\tMPMD_HFP_HF_A2DP_SNK_AVRCP_CT_PLAY_DURING_CALL | \\\n\t\tMPMD_A2DP_SNK_AVRCP_CT_DUN_DT_AUDIO_DURING_DATA_COMM | \\\n\t\tMPMD_A2DP_SNK_AVRCP_CT_DUN_DT_START_DATA_DURING_AUDIO)\n#define MPS_MPMD_A2DP_SRC (MPMD_A2DP_SRC_AVRCP_TG_ANSWER_CALL_DURING_AUDIO | \\\n\t\t\tMPMD_A2DP_SRC_AVRCP_TG_OUTGOING_CALL_DURING_AUDIO | \\\n\t\t\tMPMD_A2DP_SRC_AVRCP_TG_REJECT_CALL_DURING_AUDIO | \\\n\t\t\tMPMD_A2DP_SRC_AVRCP_TG_TERMINATION_DURING_AVP | \\\n\t\t\tMPMD_A2DP_SRC_AVRCP_TG_PRESS_PLAY_DURING_CALL | \\\n\t\t\tMPMD_A2DP_SRC_AVRCP_TG_START_AUDIO_AFTER_PLAY | \\\n\t\t\tMPMD_A2DP_SRC_AVRCP_TG_SUSPEND_AUDIO_AFTER_PAUSE | \\\n\t\t\tMPMD_A2DP_SRC_AVRCP_TG_START_AUDIO_DURING_DATA_COMM | \\\n\t\t\tMPMD_A2DP_SRC_AVRCP_TG_START_DATA_DURING_AUDIO)\n#define MPS_MPMD_HFP_HF ( \\\n\t\tMPMD_HFP_HF_A2DP_SNK_AVRCP_CT_ANSWER_CALL_DURING_AUDIO | \\\n\t\tMPMD_HFP_HF_A2DP_SNK_AVRCP_CT_OUTGOING_CALL_DURING_AUDIO | \\\n\t\tMPMD_HFP_HF_A2DP_SNK_AVRCP_CT_REJECT_CALL_DURING_AUDIO | \\\n\t\tMPMD_HFP_HF_A2DP_SNK_AVRCP_CT_TERMINATION_DURING_AVP | \\\n\t\tMPMD_HFP_HF_A2DP_SNK_AVRCP_CT_PLAY_DURING_CALL)\n#define MPS_MPMD_HFP_AG MPMD_HFP_AG_CALL_TERMINATION_DURING_AVP\n\nstatic uint64_t mps_mpmd_features(void)\n{\n\tuint64_t feat = MPS_MPMD_ALL;\n\n\tif (!class_supported(HANDSFREE_AGW_SVCLASS_ID))\n\t\tfeat &= ~MPS_MPMD_HFP_AG;\n\n\tif (!class_supported(HANDSFREE_SVCLASS_ID))\n\t\tfeat &= ~MPS_MPMD_HFP_HF;\n\n\tif (!class_supported(AUDIO_SOURCE_SVCLASS_ID))\n\t\tfeat &= ~MPS_MPMD_A2DP_SRC;\n\n\tif (!class_supported(AUDIO_SINK_SVCLASS_ID))\n\t\tfeat &= ~MPS_MPMD_A2DP_SNK;\n\telse\n\t\tfeat &= ~MPS_MPMD_AVRCP_CT_ONLY;\n\n\tif (!class_supported(AV_REMOTE_CONTROLLER_SVCLASS_ID)) {\n\t\tfeat &= ~MPS_MPMD_AVRCP_CT;\n\t\tfeat &= ~MPS_MPMD_AVRCP_CT_ONLY;\n\t}\n\n\tif (!class_supported(AV_REMOTE_TARGET_SVCLASS_ID))\n\t\tfeat &= ~MPS_MPMD_AVRCP_TG;\n\n\t/* TODO */\n\tfeat &= ~MPS_MPMD_DUN_DT;\n\n\treturn feat;\n}"
        }
      },
      {
        "call_info": {
          "callee": "sdp_attr_replace",
          "args": [
            "rec",
            "SDP_ATTR_MPSD_SCENARIOS",
            "data"
          ],
          "line": 636
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_data_alloc",
          "args": [
            "SDP_UINT64",
            "&mpsd_feat"
          ],
          "line": 635
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "mps_mpsd_features",
          "args": [],
          "line": 634
        },
        "resolved": true,
        "details": {
          "function_name": "mps_mpsd_features",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/sdpd-service.c",
          "lines": "482-523",
          "snippet": "static uint64_t mps_mpsd_features(void)\n{\n\tuint64_t feat = MPS_MPSD_ALL;\n\n\tif (!class_supported(HANDSFREE_AGW_SVCLASS_ID))\n\t\tfeat &= ~MPS_MPSD_HFP_AG;\n\n\tif (!class_supported(HANDSFREE_SVCLASS_ID))\n\t\tfeat &= ~MPS_MPSD_HFP_HF;\n\n\tif (!class_supported(AUDIO_SOURCE_SVCLASS_ID))\n\t\tfeat &= ~MPS_MPSD_A2DP_SRC;\n\n\tif (!class_supported(AUDIO_SINK_SVCLASS_ID))\n\t\tfeat &= ~MPS_MPSD_A2DP_SNK;\n\n\tif (!class_supported(AV_REMOTE_CONTROLLER_SVCLASS_ID))\n\t\tfeat &= ~MPS_MPSD_AVRCP_CT;\n\n\tif (!class_supported(AV_REMOTE_TARGET_SVCLASS_ID))\n\t\tfeat &= ~MPS_MPSD_AVRCP_TG;\n\n\tif (!class_supported(DIALUP_NET_SVCLASS_ID))\n\t\tfeat &= ~MPS_MPSD_DUN_GW;\n\n\t/* TODO */\n\tfeat &= ~MPS_MPSD_DUN_DT;\n\n\tif (!class_supported(NAP_SVCLASS_ID))\n\t\tfeat &= ~MPS_MPSD_PAN_NAP;\n\n\tif (!class_supported(PANU_SVCLASS_ID))\n\t\tfeat &= ~MPS_MPSD_PAN_PANU;\n\n\tif (!class_supported(PBAP_PSE_SVCLASS_ID))\n\t\tfeat &= ~MPS_MPSD_PBAP_SRC;\n\n\tif (!class_supported(PBAP_PCE_SVCLASS_ID))\n\t\tfeat &= ~MPS_MPSD_PBAP_CLI;\n\n\treturn feat;\n}",
          "includes": [
            "#include \"log.h\"",
            "#include \"sdpd.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <stdbool.h>",
            "#include <sys/time.h>",
            "#include <assert.h>",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define MPS_MPSD_ALL (MPS_MPSD_HFP_AG | MPS_MPSD_HFP_HF | \\\n\t\t\tMPS_MPSD_A2DP_SRC | MPS_MPSD_A2DP_SNK | \\\n\t\t\tMPS_MPSD_AVRCP_CT | MPS_MPSD_AVRCP_TG | \\\n\t\t\tMPS_MPSD_DUN_GW | MPS_MPSD_DUN_DT | \\\n\t\t\tMPS_MPSD_PAN_NAP | MPS_MPSD_PAN_PANU | \\\n\t\t\tMPS_MPSD_PBAP_SRC | MPS_MPSD_PBAP_CLI)",
            "#define MPS_MPSD_PBAP_CLI MPSD_A2DP_SNK_PBAP_CLI_PB_DL_DURING_AUDIO_STREAM",
            "#define MPS_MPSD_PBAP_SRC MPSD_A2DP_SRC_PBAP_SRV_PB_DL_DURING_AUDIO_STREAM",
            "#define MPS_MPSD_PAN_PANU (MPSD_HFP_HF_PAN_PANU_DATA_COMM_DURING_VOICE_CALL | \\\n\t\t\tMPSD_HFP_HF_PAN_PANU_OUTGOING_CALL_DURING_DATA_COMM | \\\n\t\t\tMPSD_HFP_HF_PAN_PANU_INCOMING_CALL_DURING_DATA_COMM | \\\n\t\t\tMPSD_A2DP_SNK_PAN_PANU_START_AUDIO_DURING_DATA_COMM | \\\n\t\t\tMPSD_A2DP_SNK_PAN_PANU_DATA_COMM_DURING_AUDIO_STREAM)",
            "#define MPS_MPSD_PAN_NAP (MPSD_HFP_AG_PAN_NAP_DATA_COMM_DURING_VOICE_CALL | \\\n\t\t\tMPSD_HFP_AG_PAN_NAP_OUTGOING_CALL_DURING_DATA_COMM | \\\n\t\t\tMPSD_HFP_AG_PAN_NAP_INCOMING_CALL_DURING_DATA_COMM | \\\n\t\t\tMPSD_A2DP_SRC_PAN_NAP_START_AUDIO_DURING_DATA_COMM | \\\n\t\t\tMPSD_A2DP_SRC_PAN_NAP_DATA_COMM_DURING_AUDIO_STREAM)",
            "#define MPS_MPSD_DUN_DT (MPSD_HFP_HF_DUN_DT_DATA_COMM_DURING_VOICE_CALL | \\\n\t\t\tMPSD_HFP_HF_DUN_DT_OUTGOING_CALL_DURING_DATA_COMM | \\\n\t\t\tMPSD_HFP_HF_DUN_DT_INCOMING_CALL_DURING_DATA_COMM | \\\n\t\t\tMPSD_A2DP_SNK_DUN_DT_START_AUDIO_DURING_DATA_COMM | \\\n\t\t\tMPSD_A2DP_SNK_DUN_DT_DATA_COMM_DURING_AUDIO_STREAM | \\\n\t\t\tMPSD_HFP_HF_DUN_DT_TERMINATE_CALL_DURING_DATA_COMM)",
            "#define MPS_MPSD_DUN_GW (MPSD_HFP_AG_DUN_GW_DATA_COMM_DURING_VOICE_CALL | \\\n\t\t\tMPSD_HFP_AG_DUN_GW_OUTGOING_CALL_DURING_DATA_COMM | \\\n\t\t\tMPSD_HFP_AG_DUN_GW_INCOMING_CALL_DURING_DATA_COMM | \\\n\t\t\tMPSD_A2DP_SRC_DUN_GW_START_AUDIO_DURING_DATA_COMM | \\\n\t\t\tMPSD_A2DP_SRC_DUN_GW_DATA_COMM_DURING_AUDIO_STREAM | \\\n\t\t\tMPSD_HFP_AG_DUN_GW_TERMINATE_CALL_DURING_DATA_COMM)",
            "#define MPS_MPSD_AVRCP_TG MPS_MPSD_A2DP_SRC",
            "#define MPS_MPSD_AVRCP_CT MPS_MPSD_A2DP_SNK",
            "#define MPS_MPSD_A2DP_SNK (MPSD_HFP_HF_A2DP_SNK_ANSWER_CALL_DURING_AUDIO | \\\n\t\t\tMPSD_HFP_HF_A2DP_SNK_OUTGOING_CALL_DURING_AUDIO | \\\n\t\t\tMPSD_HFP_HF_A2DP_SNK_SRC_REJECT_CALL_DURING_AUDIO | \\\n\t\t\tMPSD_HFP_HF_A2DP_SNK_TERMINATE_CALL_DURING_AVP | \\\n\t\t\tMPSD_HFP_HF_A2DP_SNK_PRESS_PLAY_DURING_ACTIVE_CALL | \\\n\t\t\tMPSD_HFP_HF_A2DP_SNK_START_AUDIO_STREAM_AFTER_PLAY | \\\n\t\t\tMPSD_HFP_HF_A2DP_SNK_SUSPEND_AUDIO_STREAM_ON_PAUSE | \\\n\t\t\tMPSD_A2DP_SNK_DUN_DT_START_AUDIO_DURING_DATA_COMM | \\\n\t\t\tMPSD_A2DP_SNK_DUN_DT_DATA_COMM_DURING_AUDIO_STREAM | \\\n\t\t\tMPSD_A2DP_SNK_PAN_PANU_START_AUDIO_DURING_DATA_COMM | \\\n\t\t\tMPSD_A2DP_SNK_PAN_PANU_DATA_COMM_DURING_AUDIO_STREAM | \\\n\t\t\tMPSD_A2DP_SNK_PBAP_CLI_PB_DL_DURING_AUDIO_STREAM)",
            "#define MPS_MPSD_A2DP_SRC (MPSD_HFP_AG_A2DP_SRC_ANSWER_CALL_DURING_AUDIO | \\\n\t\t\tMPSD_HFP_AG_A2DP_SRC_OUTGOING_CALL_DURING_AUDIO | \\\n\t\t\tMPSD_HFP_AG_A2DP_SRC_REJECT_CALL_DURING_AUDIO | \\\n\t\t\tMPSD_HFP_AG_A2DP_SRC_TERMINATE_CALL_DURING_AVP | \\\n\t\t\tMPSD_HFP_AG_A2DP_SRC_PRESS_PLAY_DURING_ACTIVE_CALL | \\\n\t\t\tMPSD_HFP_AG_A2DP_SRC_START_AUDIO_STREAM_AFTER_PLAY | \\\n\t\t\tMPSD_HFP_AG_A2DP_SRC_SUSPEND_AUDIO_STREAM_ON_PAUSE | \\\n\t\t\tMPSD_A2DP_SRC_DUN_GW_START_AUDIO_DURING_DATA_COMM | \\\n\t\t\tMPSD_A2DP_SRC_DUN_GW_DATA_COMM_DURING_AUDIO_STREAM | \\\n\t\t\tMPSD_A2DP_SRC_PAN_NAP_START_AUDIO_DURING_DATA_COMM | \\\n\t\t\tMPSD_A2DP_SRC_PAN_NAP_DATA_COMM_DURING_AUDIO_STREAM | \\\n\t\t\tMPSD_A2DP_SRC_PBAP_SRV_PB_DL_DURING_AUDIO_STREAM)",
            "#define MPS_MPSD_HFP_HF (MPSD_HFP_HF_A2DP_SNK_ANSWER_CALL_DURING_AUDIO | \\\n\t\t\tMPSD_HFP_HF_A2DP_SNK_OUTGOING_CALL_DURING_AUDIO | \\\n\t\t\tMPSD_HFP_HF_A2DP_SNK_SRC_REJECT_CALL_DURING_AUDIO | \\\n\t\t\tMPSD_HFP_HF_A2DP_SNK_TERMINATE_CALL_DURING_AVP | \\\n\t\t\tMPSD_HFP_HF_A2DP_SNK_PRESS_PLAY_DURING_ACTIVE_CALL | \\\n\t\t\tMPSD_HFP_HF_A2DP_SNK_START_AUDIO_STREAM_AFTER_PLAY | \\\n\t\t\tMPSD_HFP_HF_A2DP_SNK_SUSPEND_AUDIO_STREAM_ON_PAUSE | \\\n\t\t\tMPSD_HFP_HF_DUN_DT_DATA_COMM_DURING_VOICE_CALL | \\\n\t\t\tMPSD_HFP_HF_DUN_DT_OUTGOING_CALL_DURING_DATA_COMM | \\\n\t\t\tMPSD_HFP_HF_DUN_DT_INCOMING_CALL_DURING_DATA_COMM | \\\n\t\t\tMPSD_HFP_HF_DUN_DT_TERMINATE_CALL_DURING_DATA_COMM | \\\n\t\t\tMPSD_HFP_HF_PAN_PANU_DATA_COMM_DURING_VOICE_CALL | \\\n\t\t\tMPSD_HFP_HF_PAN_PANU_OUTGOING_CALL_DURING_DATA_COMM | \\\n\t\t\tMPSD_HFP_HF_PAN_PANU_INCOMING_CALL_DURING_DATA_COMM)",
            "#define MPS_MPSD_HFP_AG (MPSD_HFP_AG_A2DP_SRC_ANSWER_CALL_DURING_AUDIO | \\\n\t\t\tMPSD_HFP_AG_A2DP_SRC_OUTGOING_CALL_DURING_AUDIO | \\\n\t\t\tMPSD_HFP_AG_A2DP_SRC_REJECT_CALL_DURING_AUDIO | \\\n\t\t\tMPSD_HFP_AG_A2DP_SRC_TERMINATE_CALL_DURING_AVP | \\\n\t\t\tMPSD_HFP_AG_A2DP_SRC_PRESS_PLAY_DURING_ACTIVE_CALL | \\\n\t\t\tMPSD_HFP_AG_A2DP_SRC_START_AUDIO_STREAM_AFTER_PLAY | \\\n\t\t\tMPSD_HFP_AG_DUN_GW_DATA_COMM_DURING_VOICE_CALL | \\\n\t\t\tMPSD_HFP_AG_A2DP_SRC_SUSPEND_AUDIO_STREAM_ON_PAUSE | \\\n\t\t\tMPSD_HFP_AG_DUN_GW_OUTGOING_CALL_DURING_DATA_COMM | \\\n\t\t\tMPSD_HFP_AG_DUN_GW_INCOMING_CALL_DURING_DATA_COMM | \\\n\t\t\tMPSD_HFP_AG_DUN_GW_TERMINATE_CALL_DURING_DATA_COMM | \\\n\t\t\tMPSD_HFP_AG_PAN_NAP_DATA_COMM_DURING_VOICE_CALL | \\\n\t\t\tMPSD_HFP_AG_PAN_NAP_OUTGOING_CALL_DURING_DATA_COMM | \\\n\t\t\tMPSD_HFP_AG_PAN_NAP_INCOMING_CALL_DURING_DATA_COMM)"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n#include \"sdpd.h\"\n#include \"src/shared/util.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <stdbool.h>\n#include <sys/time.h>\n#include <assert.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <config.h>\n\n#define MPS_MPSD_ALL (MPS_MPSD_HFP_AG | MPS_MPSD_HFP_HF | \\\n\t\t\tMPS_MPSD_A2DP_SRC | MPS_MPSD_A2DP_SNK | \\\n\t\t\tMPS_MPSD_AVRCP_CT | MPS_MPSD_AVRCP_TG | \\\n\t\t\tMPS_MPSD_DUN_GW | MPS_MPSD_DUN_DT | \\\n\t\t\tMPS_MPSD_PAN_NAP | MPS_MPSD_PAN_PANU | \\\n\t\t\tMPS_MPSD_PBAP_SRC | MPS_MPSD_PBAP_CLI)\n#define MPS_MPSD_PBAP_CLI MPSD_A2DP_SNK_PBAP_CLI_PB_DL_DURING_AUDIO_STREAM\n#define MPS_MPSD_PBAP_SRC MPSD_A2DP_SRC_PBAP_SRV_PB_DL_DURING_AUDIO_STREAM\n#define MPS_MPSD_PAN_PANU (MPSD_HFP_HF_PAN_PANU_DATA_COMM_DURING_VOICE_CALL | \\\n\t\t\tMPSD_HFP_HF_PAN_PANU_OUTGOING_CALL_DURING_DATA_COMM | \\\n\t\t\tMPSD_HFP_HF_PAN_PANU_INCOMING_CALL_DURING_DATA_COMM | \\\n\t\t\tMPSD_A2DP_SNK_PAN_PANU_START_AUDIO_DURING_DATA_COMM | \\\n\t\t\tMPSD_A2DP_SNK_PAN_PANU_DATA_COMM_DURING_AUDIO_STREAM)\n#define MPS_MPSD_PAN_NAP (MPSD_HFP_AG_PAN_NAP_DATA_COMM_DURING_VOICE_CALL | \\\n\t\t\tMPSD_HFP_AG_PAN_NAP_OUTGOING_CALL_DURING_DATA_COMM | \\\n\t\t\tMPSD_HFP_AG_PAN_NAP_INCOMING_CALL_DURING_DATA_COMM | \\\n\t\t\tMPSD_A2DP_SRC_PAN_NAP_START_AUDIO_DURING_DATA_COMM | \\\n\t\t\tMPSD_A2DP_SRC_PAN_NAP_DATA_COMM_DURING_AUDIO_STREAM)\n#define MPS_MPSD_DUN_DT (MPSD_HFP_HF_DUN_DT_DATA_COMM_DURING_VOICE_CALL | \\\n\t\t\tMPSD_HFP_HF_DUN_DT_OUTGOING_CALL_DURING_DATA_COMM | \\\n\t\t\tMPSD_HFP_HF_DUN_DT_INCOMING_CALL_DURING_DATA_COMM | \\\n\t\t\tMPSD_A2DP_SNK_DUN_DT_START_AUDIO_DURING_DATA_COMM | \\\n\t\t\tMPSD_A2DP_SNK_DUN_DT_DATA_COMM_DURING_AUDIO_STREAM | \\\n\t\t\tMPSD_HFP_HF_DUN_DT_TERMINATE_CALL_DURING_DATA_COMM)\n#define MPS_MPSD_DUN_GW (MPSD_HFP_AG_DUN_GW_DATA_COMM_DURING_VOICE_CALL | \\\n\t\t\tMPSD_HFP_AG_DUN_GW_OUTGOING_CALL_DURING_DATA_COMM | \\\n\t\t\tMPSD_HFP_AG_DUN_GW_INCOMING_CALL_DURING_DATA_COMM | \\\n\t\t\tMPSD_A2DP_SRC_DUN_GW_START_AUDIO_DURING_DATA_COMM | \\\n\t\t\tMPSD_A2DP_SRC_DUN_GW_DATA_COMM_DURING_AUDIO_STREAM | \\\n\t\t\tMPSD_HFP_AG_DUN_GW_TERMINATE_CALL_DURING_DATA_COMM)\n#define MPS_MPSD_AVRCP_TG MPS_MPSD_A2DP_SRC\n#define MPS_MPSD_AVRCP_CT MPS_MPSD_A2DP_SNK\n#define MPS_MPSD_A2DP_SNK (MPSD_HFP_HF_A2DP_SNK_ANSWER_CALL_DURING_AUDIO | \\\n\t\t\tMPSD_HFP_HF_A2DP_SNK_OUTGOING_CALL_DURING_AUDIO | \\\n\t\t\tMPSD_HFP_HF_A2DP_SNK_SRC_REJECT_CALL_DURING_AUDIO | \\\n\t\t\tMPSD_HFP_HF_A2DP_SNK_TERMINATE_CALL_DURING_AVP | \\\n\t\t\tMPSD_HFP_HF_A2DP_SNK_PRESS_PLAY_DURING_ACTIVE_CALL | \\\n\t\t\tMPSD_HFP_HF_A2DP_SNK_START_AUDIO_STREAM_AFTER_PLAY | \\\n\t\t\tMPSD_HFP_HF_A2DP_SNK_SUSPEND_AUDIO_STREAM_ON_PAUSE | \\\n\t\t\tMPSD_A2DP_SNK_DUN_DT_START_AUDIO_DURING_DATA_COMM | \\\n\t\t\tMPSD_A2DP_SNK_DUN_DT_DATA_COMM_DURING_AUDIO_STREAM | \\\n\t\t\tMPSD_A2DP_SNK_PAN_PANU_START_AUDIO_DURING_DATA_COMM | \\\n\t\t\tMPSD_A2DP_SNK_PAN_PANU_DATA_COMM_DURING_AUDIO_STREAM | \\\n\t\t\tMPSD_A2DP_SNK_PBAP_CLI_PB_DL_DURING_AUDIO_STREAM)\n#define MPS_MPSD_A2DP_SRC (MPSD_HFP_AG_A2DP_SRC_ANSWER_CALL_DURING_AUDIO | \\\n\t\t\tMPSD_HFP_AG_A2DP_SRC_OUTGOING_CALL_DURING_AUDIO | \\\n\t\t\tMPSD_HFP_AG_A2DP_SRC_REJECT_CALL_DURING_AUDIO | \\\n\t\t\tMPSD_HFP_AG_A2DP_SRC_TERMINATE_CALL_DURING_AVP | \\\n\t\t\tMPSD_HFP_AG_A2DP_SRC_PRESS_PLAY_DURING_ACTIVE_CALL | \\\n\t\t\tMPSD_HFP_AG_A2DP_SRC_START_AUDIO_STREAM_AFTER_PLAY | \\\n\t\t\tMPSD_HFP_AG_A2DP_SRC_SUSPEND_AUDIO_STREAM_ON_PAUSE | \\\n\t\t\tMPSD_A2DP_SRC_DUN_GW_START_AUDIO_DURING_DATA_COMM | \\\n\t\t\tMPSD_A2DP_SRC_DUN_GW_DATA_COMM_DURING_AUDIO_STREAM | \\\n\t\t\tMPSD_A2DP_SRC_PAN_NAP_START_AUDIO_DURING_DATA_COMM | \\\n\t\t\tMPSD_A2DP_SRC_PAN_NAP_DATA_COMM_DURING_AUDIO_STREAM | \\\n\t\t\tMPSD_A2DP_SRC_PBAP_SRV_PB_DL_DURING_AUDIO_STREAM)\n#define MPS_MPSD_HFP_HF (MPSD_HFP_HF_A2DP_SNK_ANSWER_CALL_DURING_AUDIO | \\\n\t\t\tMPSD_HFP_HF_A2DP_SNK_OUTGOING_CALL_DURING_AUDIO | \\\n\t\t\tMPSD_HFP_HF_A2DP_SNK_SRC_REJECT_CALL_DURING_AUDIO | \\\n\t\t\tMPSD_HFP_HF_A2DP_SNK_TERMINATE_CALL_DURING_AVP | \\\n\t\t\tMPSD_HFP_HF_A2DP_SNK_PRESS_PLAY_DURING_ACTIVE_CALL | \\\n\t\t\tMPSD_HFP_HF_A2DP_SNK_START_AUDIO_STREAM_AFTER_PLAY | \\\n\t\t\tMPSD_HFP_HF_A2DP_SNK_SUSPEND_AUDIO_STREAM_ON_PAUSE | \\\n\t\t\tMPSD_HFP_HF_DUN_DT_DATA_COMM_DURING_VOICE_CALL | \\\n\t\t\tMPSD_HFP_HF_DUN_DT_OUTGOING_CALL_DURING_DATA_COMM | \\\n\t\t\tMPSD_HFP_HF_DUN_DT_INCOMING_CALL_DURING_DATA_COMM | \\\n\t\t\tMPSD_HFP_HF_DUN_DT_TERMINATE_CALL_DURING_DATA_COMM | \\\n\t\t\tMPSD_HFP_HF_PAN_PANU_DATA_COMM_DURING_VOICE_CALL | \\\n\t\t\tMPSD_HFP_HF_PAN_PANU_OUTGOING_CALL_DURING_DATA_COMM | \\\n\t\t\tMPSD_HFP_HF_PAN_PANU_INCOMING_CALL_DURING_DATA_COMM)\n#define MPS_MPSD_HFP_AG (MPSD_HFP_AG_A2DP_SRC_ANSWER_CALL_DURING_AUDIO | \\\n\t\t\tMPSD_HFP_AG_A2DP_SRC_OUTGOING_CALL_DURING_AUDIO | \\\n\t\t\tMPSD_HFP_AG_A2DP_SRC_REJECT_CALL_DURING_AUDIO | \\\n\t\t\tMPSD_HFP_AG_A2DP_SRC_TERMINATE_CALL_DURING_AVP | \\\n\t\t\tMPSD_HFP_AG_A2DP_SRC_PRESS_PLAY_DURING_ACTIVE_CALL | \\\n\t\t\tMPSD_HFP_AG_A2DP_SRC_START_AUDIO_STREAM_AFTER_PLAY | \\\n\t\t\tMPSD_HFP_AG_DUN_GW_DATA_COMM_DURING_VOICE_CALL | \\\n\t\t\tMPSD_HFP_AG_A2DP_SRC_SUSPEND_AUDIO_STREAM_ON_PAUSE | \\\n\t\t\tMPSD_HFP_AG_DUN_GW_OUTGOING_CALL_DURING_DATA_COMM | \\\n\t\t\tMPSD_HFP_AG_DUN_GW_INCOMING_CALL_DURING_DATA_COMM | \\\n\t\t\tMPSD_HFP_AG_DUN_GW_TERMINATE_CALL_DURING_DATA_COMM | \\\n\t\t\tMPSD_HFP_AG_PAN_NAP_DATA_COMM_DURING_VOICE_CALL | \\\n\t\t\tMPSD_HFP_AG_PAN_NAP_OUTGOING_CALL_DURING_DATA_COMM | \\\n\t\t\tMPSD_HFP_AG_PAN_NAP_INCOMING_CALL_DURING_DATA_COMM)\n\nstatic uint64_t mps_mpsd_features(void)\n{\n\tuint64_t feat = MPS_MPSD_ALL;\n\n\tif (!class_supported(HANDSFREE_AGW_SVCLASS_ID))\n\t\tfeat &= ~MPS_MPSD_HFP_AG;\n\n\tif (!class_supported(HANDSFREE_SVCLASS_ID))\n\t\tfeat &= ~MPS_MPSD_HFP_HF;\n\n\tif (!class_supported(AUDIO_SOURCE_SVCLASS_ID))\n\t\tfeat &= ~MPS_MPSD_A2DP_SRC;\n\n\tif (!class_supported(AUDIO_SINK_SVCLASS_ID))\n\t\tfeat &= ~MPS_MPSD_A2DP_SNK;\n\n\tif (!class_supported(AV_REMOTE_CONTROLLER_SVCLASS_ID))\n\t\tfeat &= ~MPS_MPSD_AVRCP_CT;\n\n\tif (!class_supported(AV_REMOTE_TARGET_SVCLASS_ID))\n\t\tfeat &= ~MPS_MPSD_AVRCP_TG;\n\n\tif (!class_supported(DIALUP_NET_SVCLASS_ID))\n\t\tfeat &= ~MPS_MPSD_DUN_GW;\n\n\t/* TODO */\n\tfeat &= ~MPS_MPSD_DUN_DT;\n\n\tif (!class_supported(NAP_SVCLASS_ID))\n\t\tfeat &= ~MPS_MPSD_PAN_NAP;\n\n\tif (!class_supported(PANU_SVCLASS_ID))\n\t\tfeat &= ~MPS_MPSD_PAN_PANU;\n\n\tif (!class_supported(PBAP_PSE_SVCLASS_ID))\n\t\tfeat &= ~MPS_MPSD_PBAP_SRC;\n\n\tif (!class_supported(PBAP_PCE_SVCLASS_ID))\n\t\tfeat &= ~MPS_MPSD_PBAP_CLI;\n\n\treturn feat;\n}"
        }
      },
      {
        "call_info": {
          "callee": "sdp_record_find",
          "args": [
            "mps_handle"
          ],
          "line": 630
        },
        "resolved": true,
        "details": {
          "function_name": "sdp_record_find",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/sdpd-database.c",
          "lines": "227-237",
          "snippet": "sdp_record_t *sdp_record_find(uint32_t handle)\n{\n\tsdp_list_t *p = record_locate(handle);\n\n\tif (!p) {\n\t\tSDPDBG(\"Couldn't find record for : 0x%x\", handle);\n\t\treturn 0;\n\t}\n\n\treturn p->data;\n}",
          "includes": [
            "#include \"log.h\"",
            "#include \"sdpd.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n#include \"sdpd.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <stdbool.h>\n#include <stdlib.h>\n#include <config.h>\n\nsdp_record_t *sdp_record_find(uint32_t handle)\n{\n\tsdp_list_t *p = record_locate(handle);\n\n\tif (!p) {\n\t\tSDPDBG(\"Couldn't find record for : 0x%x\", handle);\n\t\treturn 0;\n\t}\n\n\treturn p->data;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"log.h\"\n#include \"sdpd.h\"\n#include \"src/shared/util.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <stdbool.h>\n#include <sys/time.h>\n#include <assert.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <config.h>\n\nstatic uint32_t mps_handle = 0;\nstatic bool mps_mpmd = false;\n\nstatic void update_mps(void)\n{\n\tsdp_record_t *rec;\n\tsdp_data_t *data;\n\tuint64_t mpsd_feat, mpmd_feat;\n\n\tif (!mps_handle)\n\t\treturn;\n\n\trec = sdp_record_find(mps_handle);\n\tif (!rec)\n\t\treturn;\n\n\tmpsd_feat = mps_mpsd_features();\n\tdata = sdp_data_alloc(SDP_UINT64, &mpsd_feat);\n\tsdp_attr_replace(rec, SDP_ATTR_MPSD_SCENARIOS, data);\n\n\tif (mps_mpmd) {\n\t\tmpmd_feat = mps_mpmd_features();\n\t\tdata = sdp_data_alloc(SDP_UINT64, &mpmd_feat);\n\t\tsdp_attr_replace(rec, SDP_ATTR_MPMD_SCENARIOS, data);\n\t}\n}"
  },
  {
    "function_name": "register_mps",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/sdpd-service.c",
    "lines": "604-619",
    "snippet": "void register_mps(bool mpmd)\n{\n\tsdp_record_t *record;\n\n\trecord = mps_record(mpmd);\n\tif (!record)\n\t\treturn;\n\n\tif (add_record_to_server(BDADDR_ANY, record) < 0) {\n\t\tsdp_record_free(record);\n\t\treturn;\n\t}\n\n\tmps_handle = record->handle;\n\tmps_mpmd = mpmd;\n}",
    "includes": [
      "#include \"log.h\"",
      "#include \"sdpd.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <glib.h>",
      "#include <stdbool.h>",
      "#include <sys/time.h>",
      "#include <assert.h>",
      "#include <stdlib.h>",
      "#include <errno.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static uint32_t mps_handle = 0;",
      "static bool mps_mpmd = false;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "sdp_record_free",
          "args": [
            "record"
          ],
          "line": 613
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "add_record_to_server",
          "args": [
            "BDADDR_ANY",
            "record"
          ],
          "line": 612
        },
        "resolved": true,
        "details": {
          "function_name": "add_record_to_server",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/sdpd-service.c",
          "lines": "645-686",
          "snippet": "int add_record_to_server(const bdaddr_t *src, sdp_record_t *rec)\n{\n\tsdp_data_t *data;\n\tsdp_list_t *pattern;\n\n\tif (rec->handle == 0xffffffff) {\n\t\trec->handle = sdp_next_handle();\n\t\tif (rec->handle < 0x10000)\n\t\t\treturn -ENOSPC;\n\t} else {\n\t\tif (sdp_record_find(rec->handle))\n\t\t\treturn -EEXIST;\n\t}\n\n\tDBG(\"Adding record with handle 0x%05x\", rec->handle);\n\n\tsdp_record_add(src, rec);\n\n\tdata = sdp_data_alloc(SDP_UINT32, &rec->handle);\n\tsdp_attr_replace(rec, SDP_ATTR_RECORD_HANDLE, data);\n\n\tif (sdp_data_get(rec, SDP_ATTR_BROWSE_GRP_LIST) == NULL) {\n\t\tuuid_t uuid;\n\t\tsdp_uuid16_create(&uuid, PUBLIC_BROWSE_GROUP);\n\t\tsdp_pattern_add_uuid(rec, &uuid);\n\t}\n\n\tfor (pattern = rec->pattern; pattern; pattern = pattern->next) {\n\t\tchar uuid[32];\n\n\t\tif (pattern->data == NULL)\n\t\t\tcontinue;\n\n\t\tsdp_uuid2strn((uuid_t *) pattern->data, uuid, sizeof(uuid));\n\t\tDBG(\"Record pattern UUID %s\", uuid);\n\t}\n\n\tupdate_mps();\n\tupdate_db_timestamp();\n\n\treturn 0;\n}",
          "includes": [
            "#include \"log.h\"",
            "#include \"sdpd.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <stdbool.h>",
            "#include <sys/time.h>",
            "#include <assert.h>",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n#include \"sdpd.h\"\n#include \"src/shared/util.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <stdbool.h>\n#include <sys/time.h>\n#include <assert.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <config.h>\n\nint add_record_to_server(const bdaddr_t *src, sdp_record_t *rec)\n{\n\tsdp_data_t *data;\n\tsdp_list_t *pattern;\n\n\tif (rec->handle == 0xffffffff) {\n\t\trec->handle = sdp_next_handle();\n\t\tif (rec->handle < 0x10000)\n\t\t\treturn -ENOSPC;\n\t} else {\n\t\tif (sdp_record_find(rec->handle))\n\t\t\treturn -EEXIST;\n\t}\n\n\tDBG(\"Adding record with handle 0x%05x\", rec->handle);\n\n\tsdp_record_add(src, rec);\n\n\tdata = sdp_data_alloc(SDP_UINT32, &rec->handle);\n\tsdp_attr_replace(rec, SDP_ATTR_RECORD_HANDLE, data);\n\n\tif (sdp_data_get(rec, SDP_ATTR_BROWSE_GRP_LIST) == NULL) {\n\t\tuuid_t uuid;\n\t\tsdp_uuid16_create(&uuid, PUBLIC_BROWSE_GROUP);\n\t\tsdp_pattern_add_uuid(rec, &uuid);\n\t}\n\n\tfor (pattern = rec->pattern; pattern; pattern = pattern->next) {\n\t\tchar uuid[32];\n\n\t\tif (pattern->data == NULL)\n\t\t\tcontinue;\n\n\t\tsdp_uuid2strn((uuid_t *) pattern->data, uuid, sizeof(uuid));\n\t\tDBG(\"Record pattern UUID %s\", uuid);\n\t}\n\n\tupdate_mps();\n\tupdate_db_timestamp();\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "mps_record",
          "args": [
            "mpmd"
          ],
          "line": 608
        },
        "resolved": true,
        "details": {
          "function_name": "mps_record",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/sdpd-service.c",
          "lines": "557-602",
          "snippet": "static sdp_record_t *mps_record(int mpmd)\n{\n\tsdp_data_t *mpsd_features, *mpmd_features, *dependencies;\n\tsdp_list_t *svclass_id, *pfseq, *root;\n\tuuid_t root_uuid, svclass_uuid;\n\tsdp_profile_desc_t profile;\n\tsdp_record_t *record;\n\tuint64_t mpsd_feat = MPS_MPSD_DEFAULT_FEATURES;\n\tuint64_t mpmd_feat = MPS_MPMD_DEFAULT_FEATURES;\n\tuint16_t deps = MPS_DEFAULT_DEPS;\n\n\trecord = sdp_record_alloc();\n\tif (!record)\n\t\treturn NULL;\n\n\tsdp_uuid16_create(&root_uuid, PUBLIC_BROWSE_GROUP);\n\troot = sdp_list_append(NULL, &root_uuid);\n\tsdp_set_browse_groups(record, root);\n\tsdp_list_free(root, NULL);\n\n\tsdp_uuid16_create(&svclass_uuid, MPS_SVCLASS_ID);\n\tsvclass_id = sdp_list_append(NULL, &svclass_uuid);\n\tsdp_set_service_classes(record, svclass_id);\n\tsdp_list_free(svclass_id, NULL);\n\n\tsdp_uuid16_create(&profile.uuid, MPS_PROFILE_ID);\n\tprofile.version = 0x0100;\n\tpfseq = sdp_list_append(NULL, &profile);\n\tsdp_set_profile_descs(record, pfseq);\n\tsdp_list_free(pfseq, NULL);\n\n\tmpsd_features = sdp_data_alloc(SDP_UINT64, &mpsd_feat);\n\tsdp_attr_add(record, SDP_ATTR_MPSD_SCENARIOS, mpsd_features);\n\n\tif (mpmd) {\n\t\tmpmd_features = sdp_data_alloc(SDP_UINT64, &mpmd_feat);\n\t\tsdp_attr_add(record, SDP_ATTR_MPMD_SCENARIOS, mpmd_features);\n\t}\n\n\tdependencies = sdp_data_alloc(SDP_UINT16, &deps);\n\tsdp_attr_add(record, SDP_ATTR_MPS_DEPENDENCIES, dependencies);\n\n\tsdp_set_info_attr(record, \"Multi Profile\", 0, 0);\n\n\treturn record;\n}",
          "includes": [
            "#include \"log.h\"",
            "#include \"sdpd.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <stdbool.h>",
            "#include <sys/time.h>",
            "#include <assert.h>",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define MPS_DEFAULT_DEPS (MPS_DEPS_SNIFF_MODE_DURRING_STREAMING | \\\n\t\t\tMPS_DEPS_GAVDP_REQUIREMENTS | \\\n\t\t\tMPS_DEPS_DIS_CONNECTION_ORDER_BEHAVIOR)",
            "#define MPS_MPMD_DEFAULT_FEATURES 0",
            "#define MPS_MPSD_DEFAULT_FEATURES 0"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n#include \"sdpd.h\"\n#include \"src/shared/util.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <stdbool.h>\n#include <sys/time.h>\n#include <assert.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <config.h>\n\n#define MPS_DEFAULT_DEPS (MPS_DEPS_SNIFF_MODE_DURRING_STREAMING | \\\n\t\t\tMPS_DEPS_GAVDP_REQUIREMENTS | \\\n\t\t\tMPS_DEPS_DIS_CONNECTION_ORDER_BEHAVIOR)\n#define MPS_MPMD_DEFAULT_FEATURES 0\n#define MPS_MPSD_DEFAULT_FEATURES 0\n\nstatic sdp_record_t *mps_record(int mpmd)\n{\n\tsdp_data_t *mpsd_features, *mpmd_features, *dependencies;\n\tsdp_list_t *svclass_id, *pfseq, *root;\n\tuuid_t root_uuid, svclass_uuid;\n\tsdp_profile_desc_t profile;\n\tsdp_record_t *record;\n\tuint64_t mpsd_feat = MPS_MPSD_DEFAULT_FEATURES;\n\tuint64_t mpmd_feat = MPS_MPMD_DEFAULT_FEATURES;\n\tuint16_t deps = MPS_DEFAULT_DEPS;\n\n\trecord = sdp_record_alloc();\n\tif (!record)\n\t\treturn NULL;\n\n\tsdp_uuid16_create(&root_uuid, PUBLIC_BROWSE_GROUP);\n\troot = sdp_list_append(NULL, &root_uuid);\n\tsdp_set_browse_groups(record, root);\n\tsdp_list_free(root, NULL);\n\n\tsdp_uuid16_create(&svclass_uuid, MPS_SVCLASS_ID);\n\tsvclass_id = sdp_list_append(NULL, &svclass_uuid);\n\tsdp_set_service_classes(record, svclass_id);\n\tsdp_list_free(svclass_id, NULL);\n\n\tsdp_uuid16_create(&profile.uuid, MPS_PROFILE_ID);\n\tprofile.version = 0x0100;\n\tpfseq = sdp_list_append(NULL, &profile);\n\tsdp_set_profile_descs(record, pfseq);\n\tsdp_list_free(pfseq, NULL);\n\n\tmpsd_features = sdp_data_alloc(SDP_UINT64, &mpsd_feat);\n\tsdp_attr_add(record, SDP_ATTR_MPSD_SCENARIOS, mpsd_features);\n\n\tif (mpmd) {\n\t\tmpmd_features = sdp_data_alloc(SDP_UINT64, &mpmd_feat);\n\t\tsdp_attr_add(record, SDP_ATTR_MPMD_SCENARIOS, mpmd_features);\n\t}\n\n\tdependencies = sdp_data_alloc(SDP_UINT16, &deps);\n\tsdp_attr_add(record, SDP_ATTR_MPS_DEPENDENCIES, dependencies);\n\n\tsdp_set_info_attr(record, \"Multi Profile\", 0, 0);\n\n\treturn record;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"log.h\"\n#include \"sdpd.h\"\n#include \"src/shared/util.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <stdbool.h>\n#include <sys/time.h>\n#include <assert.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <config.h>\n\nstatic uint32_t mps_handle = 0;\nstatic bool mps_mpmd = false;\n\nvoid register_mps(bool mpmd)\n{\n\tsdp_record_t *record;\n\n\trecord = mps_record(mpmd);\n\tif (!record)\n\t\treturn;\n\n\tif (add_record_to_server(BDADDR_ANY, record) < 0) {\n\t\tsdp_record_free(record);\n\t\treturn;\n\t}\n\n\tmps_handle = record->handle;\n\tmps_mpmd = mpmd;\n}"
  },
  {
    "function_name": "mps_record",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/sdpd-service.c",
    "lines": "557-602",
    "snippet": "static sdp_record_t *mps_record(int mpmd)\n{\n\tsdp_data_t *mpsd_features, *mpmd_features, *dependencies;\n\tsdp_list_t *svclass_id, *pfseq, *root;\n\tuuid_t root_uuid, svclass_uuid;\n\tsdp_profile_desc_t profile;\n\tsdp_record_t *record;\n\tuint64_t mpsd_feat = MPS_MPSD_DEFAULT_FEATURES;\n\tuint64_t mpmd_feat = MPS_MPMD_DEFAULT_FEATURES;\n\tuint16_t deps = MPS_DEFAULT_DEPS;\n\n\trecord = sdp_record_alloc();\n\tif (!record)\n\t\treturn NULL;\n\n\tsdp_uuid16_create(&root_uuid, PUBLIC_BROWSE_GROUP);\n\troot = sdp_list_append(NULL, &root_uuid);\n\tsdp_set_browse_groups(record, root);\n\tsdp_list_free(root, NULL);\n\n\tsdp_uuid16_create(&svclass_uuid, MPS_SVCLASS_ID);\n\tsvclass_id = sdp_list_append(NULL, &svclass_uuid);\n\tsdp_set_service_classes(record, svclass_id);\n\tsdp_list_free(svclass_id, NULL);\n\n\tsdp_uuid16_create(&profile.uuid, MPS_PROFILE_ID);\n\tprofile.version = 0x0100;\n\tpfseq = sdp_list_append(NULL, &profile);\n\tsdp_set_profile_descs(record, pfseq);\n\tsdp_list_free(pfseq, NULL);\n\n\tmpsd_features = sdp_data_alloc(SDP_UINT64, &mpsd_feat);\n\tsdp_attr_add(record, SDP_ATTR_MPSD_SCENARIOS, mpsd_features);\n\n\tif (mpmd) {\n\t\tmpmd_features = sdp_data_alloc(SDP_UINT64, &mpmd_feat);\n\t\tsdp_attr_add(record, SDP_ATTR_MPMD_SCENARIOS, mpmd_features);\n\t}\n\n\tdependencies = sdp_data_alloc(SDP_UINT16, &deps);\n\tsdp_attr_add(record, SDP_ATTR_MPS_DEPENDENCIES, dependencies);\n\n\tsdp_set_info_attr(record, \"Multi Profile\", 0, 0);\n\n\treturn record;\n}",
    "includes": [
      "#include \"log.h\"",
      "#include \"sdpd.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <glib.h>",
      "#include <stdbool.h>",
      "#include <sys/time.h>",
      "#include <assert.h>",
      "#include <stdlib.h>",
      "#include <errno.h>",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define MPS_DEFAULT_DEPS (MPS_DEPS_SNIFF_MODE_DURRING_STREAMING | \\\n\t\t\tMPS_DEPS_GAVDP_REQUIREMENTS | \\\n\t\t\tMPS_DEPS_DIS_CONNECTION_ORDER_BEHAVIOR)",
      "#define MPS_MPMD_DEFAULT_FEATURES 0",
      "#define MPS_MPSD_DEFAULT_FEATURES 0"
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "sdp_set_info_attr",
          "args": [
            "record",
            "\"Multi Profile\"",
            "0",
            "0"
          ],
          "line": 599
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_attr_add",
          "args": [
            "record",
            "SDP_ATTR_MPS_DEPENDENCIES",
            "dependencies"
          ],
          "line": 597
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_data_alloc",
          "args": [
            "SDP_UINT16",
            "&deps"
          ],
          "line": 596
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_attr_add",
          "args": [
            "record",
            "SDP_ATTR_MPMD_SCENARIOS",
            "mpmd_features"
          ],
          "line": 593
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_data_alloc",
          "args": [
            "SDP_UINT64",
            "&mpmd_feat"
          ],
          "line": 592
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_attr_add",
          "args": [
            "record",
            "SDP_ATTR_MPSD_SCENARIOS",
            "mpsd_features"
          ],
          "line": 589
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_data_alloc",
          "args": [
            "SDP_UINT64",
            "&mpsd_feat"
          ],
          "line": 588
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_list_free",
          "args": [
            "pfseq",
            "NULL"
          ],
          "line": 586
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_set_profile_descs",
          "args": [
            "record",
            "pfseq"
          ],
          "line": 585
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_list_append",
          "args": [
            "NULL",
            "&profile"
          ],
          "line": 584
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_uuid16_create",
          "args": [
            "&profile.uuid",
            "MPS_PROFILE_ID"
          ],
          "line": 582
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_list_free",
          "args": [
            "svclass_id",
            "NULL"
          ],
          "line": 580
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_set_service_classes",
          "args": [
            "record",
            "svclass_id"
          ],
          "line": 579
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_list_append",
          "args": [
            "NULL",
            "&svclass_uuid"
          ],
          "line": 578
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_uuid16_create",
          "args": [
            "&svclass_uuid",
            "MPS_SVCLASS_ID"
          ],
          "line": 577
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_list_free",
          "args": [
            "root",
            "NULL"
          ],
          "line": 575
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_set_browse_groups",
          "args": [
            "record",
            "root"
          ],
          "line": 574
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_list_append",
          "args": [
            "NULL",
            "&root_uuid"
          ],
          "line": 573
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_uuid16_create",
          "args": [
            "&root_uuid",
            "PUBLIC_BROWSE_GROUP"
          ],
          "line": 572
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_record_alloc",
          "args": [],
          "line": 568
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"log.h\"\n#include \"sdpd.h\"\n#include \"src/shared/util.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <stdbool.h>\n#include <sys/time.h>\n#include <assert.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <config.h>\n\n#define MPS_DEFAULT_DEPS (MPS_DEPS_SNIFF_MODE_DURRING_STREAMING | \\\n\t\t\tMPS_DEPS_GAVDP_REQUIREMENTS | \\\n\t\t\tMPS_DEPS_DIS_CONNECTION_ORDER_BEHAVIOR)\n#define MPS_MPMD_DEFAULT_FEATURES 0\n#define MPS_MPSD_DEFAULT_FEATURES 0\n\nstatic sdp_record_t *mps_record(int mpmd)\n{\n\tsdp_data_t *mpsd_features, *mpmd_features, *dependencies;\n\tsdp_list_t *svclass_id, *pfseq, *root;\n\tuuid_t root_uuid, svclass_uuid;\n\tsdp_profile_desc_t profile;\n\tsdp_record_t *record;\n\tuint64_t mpsd_feat = MPS_MPSD_DEFAULT_FEATURES;\n\tuint64_t mpmd_feat = MPS_MPMD_DEFAULT_FEATURES;\n\tuint16_t deps = MPS_DEFAULT_DEPS;\n\n\trecord = sdp_record_alloc();\n\tif (!record)\n\t\treturn NULL;\n\n\tsdp_uuid16_create(&root_uuid, PUBLIC_BROWSE_GROUP);\n\troot = sdp_list_append(NULL, &root_uuid);\n\tsdp_set_browse_groups(record, root);\n\tsdp_list_free(root, NULL);\n\n\tsdp_uuid16_create(&svclass_uuid, MPS_SVCLASS_ID);\n\tsvclass_id = sdp_list_append(NULL, &svclass_uuid);\n\tsdp_set_service_classes(record, svclass_id);\n\tsdp_list_free(svclass_id, NULL);\n\n\tsdp_uuid16_create(&profile.uuid, MPS_PROFILE_ID);\n\tprofile.version = 0x0100;\n\tpfseq = sdp_list_append(NULL, &profile);\n\tsdp_set_profile_descs(record, pfseq);\n\tsdp_list_free(pfseq, NULL);\n\n\tmpsd_features = sdp_data_alloc(SDP_UINT64, &mpsd_feat);\n\tsdp_attr_add(record, SDP_ATTR_MPSD_SCENARIOS, mpsd_features);\n\n\tif (mpmd) {\n\t\tmpmd_features = sdp_data_alloc(SDP_UINT64, &mpmd_feat);\n\t\tsdp_attr_add(record, SDP_ATTR_MPMD_SCENARIOS, mpmd_features);\n\t}\n\n\tdependencies = sdp_data_alloc(SDP_UINT16, &deps);\n\tsdp_attr_add(record, SDP_ATTR_MPS_DEPENDENCIES, dependencies);\n\n\tsdp_set_info_attr(record, \"Multi Profile\", 0, 0);\n\n\treturn record;\n}"
  },
  {
    "function_name": "mps_mpmd_features",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/sdpd-service.c",
    "lines": "525-555",
    "snippet": "static uint64_t mps_mpmd_features(void)\n{\n\tuint64_t feat = MPS_MPMD_ALL;\n\n\tif (!class_supported(HANDSFREE_AGW_SVCLASS_ID))\n\t\tfeat &= ~MPS_MPMD_HFP_AG;\n\n\tif (!class_supported(HANDSFREE_SVCLASS_ID))\n\t\tfeat &= ~MPS_MPMD_HFP_HF;\n\n\tif (!class_supported(AUDIO_SOURCE_SVCLASS_ID))\n\t\tfeat &= ~MPS_MPMD_A2DP_SRC;\n\n\tif (!class_supported(AUDIO_SINK_SVCLASS_ID))\n\t\tfeat &= ~MPS_MPMD_A2DP_SNK;\n\telse\n\t\tfeat &= ~MPS_MPMD_AVRCP_CT_ONLY;\n\n\tif (!class_supported(AV_REMOTE_CONTROLLER_SVCLASS_ID)) {\n\t\tfeat &= ~MPS_MPMD_AVRCP_CT;\n\t\tfeat &= ~MPS_MPMD_AVRCP_CT_ONLY;\n\t}\n\n\tif (!class_supported(AV_REMOTE_TARGET_SVCLASS_ID))\n\t\tfeat &= ~MPS_MPMD_AVRCP_TG;\n\n\t/* TODO */\n\tfeat &= ~MPS_MPMD_DUN_DT;\n\n\treturn feat;\n}",
    "includes": [
      "#include \"log.h\"",
      "#include \"sdpd.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <glib.h>",
      "#include <stdbool.h>",
      "#include <sys/time.h>",
      "#include <assert.h>",
      "#include <stdlib.h>",
      "#include <errno.h>",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define MPS_MPMD_ALL (MPS_MPMD_HFP_AG | MPS_MPMD_HFP_HF | MPS_MPMD_A2DP_SRC | \\\n\t\t\tMPS_MPMD_A2DP_SNK | MPS_MPMD_AVRCP_CT | \\\n\t\t\tMPS_MPMD_AVRCP_CT_ONLY | MPS_MPMD_AVRCP_TG | \\\n\t\t\tMPS_MPMD_DUN_DT)",
      "#define MPS_MPMD_DUN_DT ( \\\n\t\tMPMD_A2DP_SNK_AVRCP_CT_DUN_DT_AUDIO_DURING_DATA_COMM | \\\n\t\tMPMD_A2DP_SNK_AVRCP_CT_DUN_DT_START_DATA_DURING_AUDIO)",
      "#define MPS_MPMD_AVRCP_TG MPS_MPMD_A2DP_SRC",
      "#define MPS_MPMD_AVRCP_CT_ONLY ( \\\n\t\tMPMD_AVRCP_CT_NO_A2DP_SNK_START_AUDIO_AFTER_PLAY | \\\n\t\tMPMD_AVRCP_CT_NO_A2DP_SNK_SUSPEND_AUDIO_AFTER_PAUSE)",
      "#define MPS_MPMD_AVRCP_CT MPS_MPMD_A2DP_SNK",
      "#define MPS_MPMD_A2DP_SNK ( \\\n\t\tMPMD_HFP_HF_A2DP_SNK_AVRCP_CT_ANSWER_CALL_DURING_AUDIO | \\\n\t\tMPMD_HFP_HF_A2DP_SNK_AVRCP_CT_OUTGOING_CALL_DURING_AUDIO | \\\n\t\tMPMD_HFP_HF_A2DP_SNK_AVRCP_CT_REJECT_CALL_DURING_AUDIO | \\\n\t\tMPMD_HFP_HF_A2DP_SNK_AVRCP_CT_TERMINATION_DURING_AVP | \\\n\t\tMPMD_HFP_HF_A2DP_SNK_AVRCP_CT_PLAY_DURING_CALL | \\\n\t\tMPMD_A2DP_SNK_AVRCP_CT_DUN_DT_AUDIO_DURING_DATA_COMM | \\\n\t\tMPMD_A2DP_SNK_AVRCP_CT_DUN_DT_START_DATA_DURING_AUDIO)",
      "#define MPS_MPMD_A2DP_SRC (MPMD_A2DP_SRC_AVRCP_TG_ANSWER_CALL_DURING_AUDIO | \\\n\t\t\tMPMD_A2DP_SRC_AVRCP_TG_OUTGOING_CALL_DURING_AUDIO | \\\n\t\t\tMPMD_A2DP_SRC_AVRCP_TG_REJECT_CALL_DURING_AUDIO | \\\n\t\t\tMPMD_A2DP_SRC_AVRCP_TG_TERMINATION_DURING_AVP | \\\n\t\t\tMPMD_A2DP_SRC_AVRCP_TG_PRESS_PLAY_DURING_CALL | \\\n\t\t\tMPMD_A2DP_SRC_AVRCP_TG_START_AUDIO_AFTER_PLAY | \\\n\t\t\tMPMD_A2DP_SRC_AVRCP_TG_SUSPEND_AUDIO_AFTER_PAUSE | \\\n\t\t\tMPMD_A2DP_SRC_AVRCP_TG_START_AUDIO_DURING_DATA_COMM | \\\n\t\t\tMPMD_A2DP_SRC_AVRCP_TG_START_DATA_DURING_AUDIO)",
      "#define MPS_MPMD_HFP_HF ( \\\n\t\tMPMD_HFP_HF_A2DP_SNK_AVRCP_CT_ANSWER_CALL_DURING_AUDIO | \\\n\t\tMPMD_HFP_HF_A2DP_SNK_AVRCP_CT_OUTGOING_CALL_DURING_AUDIO | \\\n\t\tMPMD_HFP_HF_A2DP_SNK_AVRCP_CT_REJECT_CALL_DURING_AUDIO | \\\n\t\tMPMD_HFP_HF_A2DP_SNK_AVRCP_CT_TERMINATION_DURING_AVP | \\\n\t\tMPMD_HFP_HF_A2DP_SNK_AVRCP_CT_PLAY_DURING_CALL)",
      "#define MPS_MPMD_HFP_AG MPMD_HFP_AG_CALL_TERMINATION_DURING_AVP"
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "class_supported",
          "args": [
            "AV_REMOTE_TARGET_SVCLASS_ID"
          ],
          "line": 548
        },
        "resolved": true,
        "details": {
          "function_name": "class_supported",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/sdpd-service.c",
          "lines": "465-480",
          "snippet": "static bool class_supported(uint16_t class)\n{\n\tsdp_list_t *list;\n\tuuid_t uuid;\n\n\tsdp_uuid16_create(&uuid, class);\n\n\tfor (list = sdp_get_record_list(); list; list = list->next) {\n\t\tsdp_record_t *rec = list->data;\n\n\t\tif (sdp_uuid_cmp(&rec->svclass, &uuid) == 0)\n\t\t\treturn true;\n\t}\n\n\treturn false;\n}",
          "includes": [
            "#include \"log.h\"",
            "#include \"sdpd.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <stdbool.h>",
            "#include <sys/time.h>",
            "#include <assert.h>",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n#include \"sdpd.h\"\n#include \"src/shared/util.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <stdbool.h>\n#include <sys/time.h>\n#include <assert.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <config.h>\n\nstatic bool class_supported(uint16_t class)\n{\n\tsdp_list_t *list;\n\tuuid_t uuid;\n\n\tsdp_uuid16_create(&uuid, class);\n\n\tfor (list = sdp_get_record_list(); list; list = list->next) {\n\t\tsdp_record_t *rec = list->data;\n\n\t\tif (sdp_uuid_cmp(&rec->svclass, &uuid) == 0)\n\t\t\treturn true;\n\t}\n\n\treturn false;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"log.h\"\n#include \"sdpd.h\"\n#include \"src/shared/util.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <stdbool.h>\n#include <sys/time.h>\n#include <assert.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <config.h>\n\n#define MPS_MPMD_ALL (MPS_MPMD_HFP_AG | MPS_MPMD_HFP_HF | MPS_MPMD_A2DP_SRC | \\\n\t\t\tMPS_MPMD_A2DP_SNK | MPS_MPMD_AVRCP_CT | \\\n\t\t\tMPS_MPMD_AVRCP_CT_ONLY | MPS_MPMD_AVRCP_TG | \\\n\t\t\tMPS_MPMD_DUN_DT)\n#define MPS_MPMD_DUN_DT ( \\\n\t\tMPMD_A2DP_SNK_AVRCP_CT_DUN_DT_AUDIO_DURING_DATA_COMM | \\\n\t\tMPMD_A2DP_SNK_AVRCP_CT_DUN_DT_START_DATA_DURING_AUDIO)\n#define MPS_MPMD_AVRCP_TG MPS_MPMD_A2DP_SRC\n#define MPS_MPMD_AVRCP_CT_ONLY ( \\\n\t\tMPMD_AVRCP_CT_NO_A2DP_SNK_START_AUDIO_AFTER_PLAY | \\\n\t\tMPMD_AVRCP_CT_NO_A2DP_SNK_SUSPEND_AUDIO_AFTER_PAUSE)\n#define MPS_MPMD_AVRCP_CT MPS_MPMD_A2DP_SNK\n#define MPS_MPMD_A2DP_SNK ( \\\n\t\tMPMD_HFP_HF_A2DP_SNK_AVRCP_CT_ANSWER_CALL_DURING_AUDIO | \\\n\t\tMPMD_HFP_HF_A2DP_SNK_AVRCP_CT_OUTGOING_CALL_DURING_AUDIO | \\\n\t\tMPMD_HFP_HF_A2DP_SNK_AVRCP_CT_REJECT_CALL_DURING_AUDIO | \\\n\t\tMPMD_HFP_HF_A2DP_SNK_AVRCP_CT_TERMINATION_DURING_AVP | \\\n\t\tMPMD_HFP_HF_A2DP_SNK_AVRCP_CT_PLAY_DURING_CALL | \\\n\t\tMPMD_A2DP_SNK_AVRCP_CT_DUN_DT_AUDIO_DURING_DATA_COMM | \\\n\t\tMPMD_A2DP_SNK_AVRCP_CT_DUN_DT_START_DATA_DURING_AUDIO)\n#define MPS_MPMD_A2DP_SRC (MPMD_A2DP_SRC_AVRCP_TG_ANSWER_CALL_DURING_AUDIO | \\\n\t\t\tMPMD_A2DP_SRC_AVRCP_TG_OUTGOING_CALL_DURING_AUDIO | \\\n\t\t\tMPMD_A2DP_SRC_AVRCP_TG_REJECT_CALL_DURING_AUDIO | \\\n\t\t\tMPMD_A2DP_SRC_AVRCP_TG_TERMINATION_DURING_AVP | \\\n\t\t\tMPMD_A2DP_SRC_AVRCP_TG_PRESS_PLAY_DURING_CALL | \\\n\t\t\tMPMD_A2DP_SRC_AVRCP_TG_START_AUDIO_AFTER_PLAY | \\\n\t\t\tMPMD_A2DP_SRC_AVRCP_TG_SUSPEND_AUDIO_AFTER_PAUSE | \\\n\t\t\tMPMD_A2DP_SRC_AVRCP_TG_START_AUDIO_DURING_DATA_COMM | \\\n\t\t\tMPMD_A2DP_SRC_AVRCP_TG_START_DATA_DURING_AUDIO)\n#define MPS_MPMD_HFP_HF ( \\\n\t\tMPMD_HFP_HF_A2DP_SNK_AVRCP_CT_ANSWER_CALL_DURING_AUDIO | \\\n\t\tMPMD_HFP_HF_A2DP_SNK_AVRCP_CT_OUTGOING_CALL_DURING_AUDIO | \\\n\t\tMPMD_HFP_HF_A2DP_SNK_AVRCP_CT_REJECT_CALL_DURING_AUDIO | \\\n\t\tMPMD_HFP_HF_A2DP_SNK_AVRCP_CT_TERMINATION_DURING_AVP | \\\n\t\tMPMD_HFP_HF_A2DP_SNK_AVRCP_CT_PLAY_DURING_CALL)\n#define MPS_MPMD_HFP_AG MPMD_HFP_AG_CALL_TERMINATION_DURING_AVP\n\nstatic uint64_t mps_mpmd_features(void)\n{\n\tuint64_t feat = MPS_MPMD_ALL;\n\n\tif (!class_supported(HANDSFREE_AGW_SVCLASS_ID))\n\t\tfeat &= ~MPS_MPMD_HFP_AG;\n\n\tif (!class_supported(HANDSFREE_SVCLASS_ID))\n\t\tfeat &= ~MPS_MPMD_HFP_HF;\n\n\tif (!class_supported(AUDIO_SOURCE_SVCLASS_ID))\n\t\tfeat &= ~MPS_MPMD_A2DP_SRC;\n\n\tif (!class_supported(AUDIO_SINK_SVCLASS_ID))\n\t\tfeat &= ~MPS_MPMD_A2DP_SNK;\n\telse\n\t\tfeat &= ~MPS_MPMD_AVRCP_CT_ONLY;\n\n\tif (!class_supported(AV_REMOTE_CONTROLLER_SVCLASS_ID)) {\n\t\tfeat &= ~MPS_MPMD_AVRCP_CT;\n\t\tfeat &= ~MPS_MPMD_AVRCP_CT_ONLY;\n\t}\n\n\tif (!class_supported(AV_REMOTE_TARGET_SVCLASS_ID))\n\t\tfeat &= ~MPS_MPMD_AVRCP_TG;\n\n\t/* TODO */\n\tfeat &= ~MPS_MPMD_DUN_DT;\n\n\treturn feat;\n}"
  },
  {
    "function_name": "mps_mpsd_features",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/sdpd-service.c",
    "lines": "482-523",
    "snippet": "static uint64_t mps_mpsd_features(void)\n{\n\tuint64_t feat = MPS_MPSD_ALL;\n\n\tif (!class_supported(HANDSFREE_AGW_SVCLASS_ID))\n\t\tfeat &= ~MPS_MPSD_HFP_AG;\n\n\tif (!class_supported(HANDSFREE_SVCLASS_ID))\n\t\tfeat &= ~MPS_MPSD_HFP_HF;\n\n\tif (!class_supported(AUDIO_SOURCE_SVCLASS_ID))\n\t\tfeat &= ~MPS_MPSD_A2DP_SRC;\n\n\tif (!class_supported(AUDIO_SINK_SVCLASS_ID))\n\t\tfeat &= ~MPS_MPSD_A2DP_SNK;\n\n\tif (!class_supported(AV_REMOTE_CONTROLLER_SVCLASS_ID))\n\t\tfeat &= ~MPS_MPSD_AVRCP_CT;\n\n\tif (!class_supported(AV_REMOTE_TARGET_SVCLASS_ID))\n\t\tfeat &= ~MPS_MPSD_AVRCP_TG;\n\n\tif (!class_supported(DIALUP_NET_SVCLASS_ID))\n\t\tfeat &= ~MPS_MPSD_DUN_GW;\n\n\t/* TODO */\n\tfeat &= ~MPS_MPSD_DUN_DT;\n\n\tif (!class_supported(NAP_SVCLASS_ID))\n\t\tfeat &= ~MPS_MPSD_PAN_NAP;\n\n\tif (!class_supported(PANU_SVCLASS_ID))\n\t\tfeat &= ~MPS_MPSD_PAN_PANU;\n\n\tif (!class_supported(PBAP_PSE_SVCLASS_ID))\n\t\tfeat &= ~MPS_MPSD_PBAP_SRC;\n\n\tif (!class_supported(PBAP_PCE_SVCLASS_ID))\n\t\tfeat &= ~MPS_MPSD_PBAP_CLI;\n\n\treturn feat;\n}",
    "includes": [
      "#include \"log.h\"",
      "#include \"sdpd.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <glib.h>",
      "#include <stdbool.h>",
      "#include <sys/time.h>",
      "#include <assert.h>",
      "#include <stdlib.h>",
      "#include <errno.h>",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define MPS_MPSD_ALL (MPS_MPSD_HFP_AG | MPS_MPSD_HFP_HF | \\\n\t\t\tMPS_MPSD_A2DP_SRC | MPS_MPSD_A2DP_SNK | \\\n\t\t\tMPS_MPSD_AVRCP_CT | MPS_MPSD_AVRCP_TG | \\\n\t\t\tMPS_MPSD_DUN_GW | MPS_MPSD_DUN_DT | \\\n\t\t\tMPS_MPSD_PAN_NAP | MPS_MPSD_PAN_PANU | \\\n\t\t\tMPS_MPSD_PBAP_SRC | MPS_MPSD_PBAP_CLI)",
      "#define MPS_MPSD_PBAP_CLI MPSD_A2DP_SNK_PBAP_CLI_PB_DL_DURING_AUDIO_STREAM",
      "#define MPS_MPSD_PBAP_SRC MPSD_A2DP_SRC_PBAP_SRV_PB_DL_DURING_AUDIO_STREAM",
      "#define MPS_MPSD_PAN_PANU (MPSD_HFP_HF_PAN_PANU_DATA_COMM_DURING_VOICE_CALL | \\\n\t\t\tMPSD_HFP_HF_PAN_PANU_OUTGOING_CALL_DURING_DATA_COMM | \\\n\t\t\tMPSD_HFP_HF_PAN_PANU_INCOMING_CALL_DURING_DATA_COMM | \\\n\t\t\tMPSD_A2DP_SNK_PAN_PANU_START_AUDIO_DURING_DATA_COMM | \\\n\t\t\tMPSD_A2DP_SNK_PAN_PANU_DATA_COMM_DURING_AUDIO_STREAM)",
      "#define MPS_MPSD_PAN_NAP (MPSD_HFP_AG_PAN_NAP_DATA_COMM_DURING_VOICE_CALL | \\\n\t\t\tMPSD_HFP_AG_PAN_NAP_OUTGOING_CALL_DURING_DATA_COMM | \\\n\t\t\tMPSD_HFP_AG_PAN_NAP_INCOMING_CALL_DURING_DATA_COMM | \\\n\t\t\tMPSD_A2DP_SRC_PAN_NAP_START_AUDIO_DURING_DATA_COMM | \\\n\t\t\tMPSD_A2DP_SRC_PAN_NAP_DATA_COMM_DURING_AUDIO_STREAM)",
      "#define MPS_MPSD_DUN_DT (MPSD_HFP_HF_DUN_DT_DATA_COMM_DURING_VOICE_CALL | \\\n\t\t\tMPSD_HFP_HF_DUN_DT_OUTGOING_CALL_DURING_DATA_COMM | \\\n\t\t\tMPSD_HFP_HF_DUN_DT_INCOMING_CALL_DURING_DATA_COMM | \\\n\t\t\tMPSD_A2DP_SNK_DUN_DT_START_AUDIO_DURING_DATA_COMM | \\\n\t\t\tMPSD_A2DP_SNK_DUN_DT_DATA_COMM_DURING_AUDIO_STREAM | \\\n\t\t\tMPSD_HFP_HF_DUN_DT_TERMINATE_CALL_DURING_DATA_COMM)",
      "#define MPS_MPSD_DUN_GW (MPSD_HFP_AG_DUN_GW_DATA_COMM_DURING_VOICE_CALL | \\\n\t\t\tMPSD_HFP_AG_DUN_GW_OUTGOING_CALL_DURING_DATA_COMM | \\\n\t\t\tMPSD_HFP_AG_DUN_GW_INCOMING_CALL_DURING_DATA_COMM | \\\n\t\t\tMPSD_A2DP_SRC_DUN_GW_START_AUDIO_DURING_DATA_COMM | \\\n\t\t\tMPSD_A2DP_SRC_DUN_GW_DATA_COMM_DURING_AUDIO_STREAM | \\\n\t\t\tMPSD_HFP_AG_DUN_GW_TERMINATE_CALL_DURING_DATA_COMM)",
      "#define MPS_MPSD_AVRCP_TG MPS_MPSD_A2DP_SRC",
      "#define MPS_MPSD_AVRCP_CT MPS_MPSD_A2DP_SNK",
      "#define MPS_MPSD_A2DP_SNK (MPSD_HFP_HF_A2DP_SNK_ANSWER_CALL_DURING_AUDIO | \\\n\t\t\tMPSD_HFP_HF_A2DP_SNK_OUTGOING_CALL_DURING_AUDIO | \\\n\t\t\tMPSD_HFP_HF_A2DP_SNK_SRC_REJECT_CALL_DURING_AUDIO | \\\n\t\t\tMPSD_HFP_HF_A2DP_SNK_TERMINATE_CALL_DURING_AVP | \\\n\t\t\tMPSD_HFP_HF_A2DP_SNK_PRESS_PLAY_DURING_ACTIVE_CALL | \\\n\t\t\tMPSD_HFP_HF_A2DP_SNK_START_AUDIO_STREAM_AFTER_PLAY | \\\n\t\t\tMPSD_HFP_HF_A2DP_SNK_SUSPEND_AUDIO_STREAM_ON_PAUSE | \\\n\t\t\tMPSD_A2DP_SNK_DUN_DT_START_AUDIO_DURING_DATA_COMM | \\\n\t\t\tMPSD_A2DP_SNK_DUN_DT_DATA_COMM_DURING_AUDIO_STREAM | \\\n\t\t\tMPSD_A2DP_SNK_PAN_PANU_START_AUDIO_DURING_DATA_COMM | \\\n\t\t\tMPSD_A2DP_SNK_PAN_PANU_DATA_COMM_DURING_AUDIO_STREAM | \\\n\t\t\tMPSD_A2DP_SNK_PBAP_CLI_PB_DL_DURING_AUDIO_STREAM)",
      "#define MPS_MPSD_A2DP_SRC (MPSD_HFP_AG_A2DP_SRC_ANSWER_CALL_DURING_AUDIO | \\\n\t\t\tMPSD_HFP_AG_A2DP_SRC_OUTGOING_CALL_DURING_AUDIO | \\\n\t\t\tMPSD_HFP_AG_A2DP_SRC_REJECT_CALL_DURING_AUDIO | \\\n\t\t\tMPSD_HFP_AG_A2DP_SRC_TERMINATE_CALL_DURING_AVP | \\\n\t\t\tMPSD_HFP_AG_A2DP_SRC_PRESS_PLAY_DURING_ACTIVE_CALL | \\\n\t\t\tMPSD_HFP_AG_A2DP_SRC_START_AUDIO_STREAM_AFTER_PLAY | \\\n\t\t\tMPSD_HFP_AG_A2DP_SRC_SUSPEND_AUDIO_STREAM_ON_PAUSE | \\\n\t\t\tMPSD_A2DP_SRC_DUN_GW_START_AUDIO_DURING_DATA_COMM | \\\n\t\t\tMPSD_A2DP_SRC_DUN_GW_DATA_COMM_DURING_AUDIO_STREAM | \\\n\t\t\tMPSD_A2DP_SRC_PAN_NAP_START_AUDIO_DURING_DATA_COMM | \\\n\t\t\tMPSD_A2DP_SRC_PAN_NAP_DATA_COMM_DURING_AUDIO_STREAM | \\\n\t\t\tMPSD_A2DP_SRC_PBAP_SRV_PB_DL_DURING_AUDIO_STREAM)",
      "#define MPS_MPSD_HFP_HF (MPSD_HFP_HF_A2DP_SNK_ANSWER_CALL_DURING_AUDIO | \\\n\t\t\tMPSD_HFP_HF_A2DP_SNK_OUTGOING_CALL_DURING_AUDIO | \\\n\t\t\tMPSD_HFP_HF_A2DP_SNK_SRC_REJECT_CALL_DURING_AUDIO | \\\n\t\t\tMPSD_HFP_HF_A2DP_SNK_TERMINATE_CALL_DURING_AVP | \\\n\t\t\tMPSD_HFP_HF_A2DP_SNK_PRESS_PLAY_DURING_ACTIVE_CALL | \\\n\t\t\tMPSD_HFP_HF_A2DP_SNK_START_AUDIO_STREAM_AFTER_PLAY | \\\n\t\t\tMPSD_HFP_HF_A2DP_SNK_SUSPEND_AUDIO_STREAM_ON_PAUSE | \\\n\t\t\tMPSD_HFP_HF_DUN_DT_DATA_COMM_DURING_VOICE_CALL | \\\n\t\t\tMPSD_HFP_HF_DUN_DT_OUTGOING_CALL_DURING_DATA_COMM | \\\n\t\t\tMPSD_HFP_HF_DUN_DT_INCOMING_CALL_DURING_DATA_COMM | \\\n\t\t\tMPSD_HFP_HF_DUN_DT_TERMINATE_CALL_DURING_DATA_COMM | \\\n\t\t\tMPSD_HFP_HF_PAN_PANU_DATA_COMM_DURING_VOICE_CALL | \\\n\t\t\tMPSD_HFP_HF_PAN_PANU_OUTGOING_CALL_DURING_DATA_COMM | \\\n\t\t\tMPSD_HFP_HF_PAN_PANU_INCOMING_CALL_DURING_DATA_COMM)",
      "#define MPS_MPSD_HFP_AG (MPSD_HFP_AG_A2DP_SRC_ANSWER_CALL_DURING_AUDIO | \\\n\t\t\tMPSD_HFP_AG_A2DP_SRC_OUTGOING_CALL_DURING_AUDIO | \\\n\t\t\tMPSD_HFP_AG_A2DP_SRC_REJECT_CALL_DURING_AUDIO | \\\n\t\t\tMPSD_HFP_AG_A2DP_SRC_TERMINATE_CALL_DURING_AVP | \\\n\t\t\tMPSD_HFP_AG_A2DP_SRC_PRESS_PLAY_DURING_ACTIVE_CALL | \\\n\t\t\tMPSD_HFP_AG_A2DP_SRC_START_AUDIO_STREAM_AFTER_PLAY | \\\n\t\t\tMPSD_HFP_AG_DUN_GW_DATA_COMM_DURING_VOICE_CALL | \\\n\t\t\tMPSD_HFP_AG_A2DP_SRC_SUSPEND_AUDIO_STREAM_ON_PAUSE | \\\n\t\t\tMPSD_HFP_AG_DUN_GW_OUTGOING_CALL_DURING_DATA_COMM | \\\n\t\t\tMPSD_HFP_AG_DUN_GW_INCOMING_CALL_DURING_DATA_COMM | \\\n\t\t\tMPSD_HFP_AG_DUN_GW_TERMINATE_CALL_DURING_DATA_COMM | \\\n\t\t\tMPSD_HFP_AG_PAN_NAP_DATA_COMM_DURING_VOICE_CALL | \\\n\t\t\tMPSD_HFP_AG_PAN_NAP_OUTGOING_CALL_DURING_DATA_COMM | \\\n\t\t\tMPSD_HFP_AG_PAN_NAP_INCOMING_CALL_DURING_DATA_COMM)"
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "class_supported",
          "args": [
            "PBAP_PCE_SVCLASS_ID"
          ],
          "line": 519
        },
        "resolved": true,
        "details": {
          "function_name": "class_supported",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/sdpd-service.c",
          "lines": "465-480",
          "snippet": "static bool class_supported(uint16_t class)\n{\n\tsdp_list_t *list;\n\tuuid_t uuid;\n\n\tsdp_uuid16_create(&uuid, class);\n\n\tfor (list = sdp_get_record_list(); list; list = list->next) {\n\t\tsdp_record_t *rec = list->data;\n\n\t\tif (sdp_uuid_cmp(&rec->svclass, &uuid) == 0)\n\t\t\treturn true;\n\t}\n\n\treturn false;\n}",
          "includes": [
            "#include \"log.h\"",
            "#include \"sdpd.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <stdbool.h>",
            "#include <sys/time.h>",
            "#include <assert.h>",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n#include \"sdpd.h\"\n#include \"src/shared/util.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <stdbool.h>\n#include <sys/time.h>\n#include <assert.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <config.h>\n\nstatic bool class_supported(uint16_t class)\n{\n\tsdp_list_t *list;\n\tuuid_t uuid;\n\n\tsdp_uuid16_create(&uuid, class);\n\n\tfor (list = sdp_get_record_list(); list; list = list->next) {\n\t\tsdp_record_t *rec = list->data;\n\n\t\tif (sdp_uuid_cmp(&rec->svclass, &uuid) == 0)\n\t\t\treturn true;\n\t}\n\n\treturn false;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"log.h\"\n#include \"sdpd.h\"\n#include \"src/shared/util.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <stdbool.h>\n#include <sys/time.h>\n#include <assert.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <config.h>\n\n#define MPS_MPSD_ALL (MPS_MPSD_HFP_AG | MPS_MPSD_HFP_HF | \\\n\t\t\tMPS_MPSD_A2DP_SRC | MPS_MPSD_A2DP_SNK | \\\n\t\t\tMPS_MPSD_AVRCP_CT | MPS_MPSD_AVRCP_TG | \\\n\t\t\tMPS_MPSD_DUN_GW | MPS_MPSD_DUN_DT | \\\n\t\t\tMPS_MPSD_PAN_NAP | MPS_MPSD_PAN_PANU | \\\n\t\t\tMPS_MPSD_PBAP_SRC | MPS_MPSD_PBAP_CLI)\n#define MPS_MPSD_PBAP_CLI MPSD_A2DP_SNK_PBAP_CLI_PB_DL_DURING_AUDIO_STREAM\n#define MPS_MPSD_PBAP_SRC MPSD_A2DP_SRC_PBAP_SRV_PB_DL_DURING_AUDIO_STREAM\n#define MPS_MPSD_PAN_PANU (MPSD_HFP_HF_PAN_PANU_DATA_COMM_DURING_VOICE_CALL | \\\n\t\t\tMPSD_HFP_HF_PAN_PANU_OUTGOING_CALL_DURING_DATA_COMM | \\\n\t\t\tMPSD_HFP_HF_PAN_PANU_INCOMING_CALL_DURING_DATA_COMM | \\\n\t\t\tMPSD_A2DP_SNK_PAN_PANU_START_AUDIO_DURING_DATA_COMM | \\\n\t\t\tMPSD_A2DP_SNK_PAN_PANU_DATA_COMM_DURING_AUDIO_STREAM)\n#define MPS_MPSD_PAN_NAP (MPSD_HFP_AG_PAN_NAP_DATA_COMM_DURING_VOICE_CALL | \\\n\t\t\tMPSD_HFP_AG_PAN_NAP_OUTGOING_CALL_DURING_DATA_COMM | \\\n\t\t\tMPSD_HFP_AG_PAN_NAP_INCOMING_CALL_DURING_DATA_COMM | \\\n\t\t\tMPSD_A2DP_SRC_PAN_NAP_START_AUDIO_DURING_DATA_COMM | \\\n\t\t\tMPSD_A2DP_SRC_PAN_NAP_DATA_COMM_DURING_AUDIO_STREAM)\n#define MPS_MPSD_DUN_DT (MPSD_HFP_HF_DUN_DT_DATA_COMM_DURING_VOICE_CALL | \\\n\t\t\tMPSD_HFP_HF_DUN_DT_OUTGOING_CALL_DURING_DATA_COMM | \\\n\t\t\tMPSD_HFP_HF_DUN_DT_INCOMING_CALL_DURING_DATA_COMM | \\\n\t\t\tMPSD_A2DP_SNK_DUN_DT_START_AUDIO_DURING_DATA_COMM | \\\n\t\t\tMPSD_A2DP_SNK_DUN_DT_DATA_COMM_DURING_AUDIO_STREAM | \\\n\t\t\tMPSD_HFP_HF_DUN_DT_TERMINATE_CALL_DURING_DATA_COMM)\n#define MPS_MPSD_DUN_GW (MPSD_HFP_AG_DUN_GW_DATA_COMM_DURING_VOICE_CALL | \\\n\t\t\tMPSD_HFP_AG_DUN_GW_OUTGOING_CALL_DURING_DATA_COMM | \\\n\t\t\tMPSD_HFP_AG_DUN_GW_INCOMING_CALL_DURING_DATA_COMM | \\\n\t\t\tMPSD_A2DP_SRC_DUN_GW_START_AUDIO_DURING_DATA_COMM | \\\n\t\t\tMPSD_A2DP_SRC_DUN_GW_DATA_COMM_DURING_AUDIO_STREAM | \\\n\t\t\tMPSD_HFP_AG_DUN_GW_TERMINATE_CALL_DURING_DATA_COMM)\n#define MPS_MPSD_AVRCP_TG MPS_MPSD_A2DP_SRC\n#define MPS_MPSD_AVRCP_CT MPS_MPSD_A2DP_SNK\n#define MPS_MPSD_A2DP_SNK (MPSD_HFP_HF_A2DP_SNK_ANSWER_CALL_DURING_AUDIO | \\\n\t\t\tMPSD_HFP_HF_A2DP_SNK_OUTGOING_CALL_DURING_AUDIO | \\\n\t\t\tMPSD_HFP_HF_A2DP_SNK_SRC_REJECT_CALL_DURING_AUDIO | \\\n\t\t\tMPSD_HFP_HF_A2DP_SNK_TERMINATE_CALL_DURING_AVP | \\\n\t\t\tMPSD_HFP_HF_A2DP_SNK_PRESS_PLAY_DURING_ACTIVE_CALL | \\\n\t\t\tMPSD_HFP_HF_A2DP_SNK_START_AUDIO_STREAM_AFTER_PLAY | \\\n\t\t\tMPSD_HFP_HF_A2DP_SNK_SUSPEND_AUDIO_STREAM_ON_PAUSE | \\\n\t\t\tMPSD_A2DP_SNK_DUN_DT_START_AUDIO_DURING_DATA_COMM | \\\n\t\t\tMPSD_A2DP_SNK_DUN_DT_DATA_COMM_DURING_AUDIO_STREAM | \\\n\t\t\tMPSD_A2DP_SNK_PAN_PANU_START_AUDIO_DURING_DATA_COMM | \\\n\t\t\tMPSD_A2DP_SNK_PAN_PANU_DATA_COMM_DURING_AUDIO_STREAM | \\\n\t\t\tMPSD_A2DP_SNK_PBAP_CLI_PB_DL_DURING_AUDIO_STREAM)\n#define MPS_MPSD_A2DP_SRC (MPSD_HFP_AG_A2DP_SRC_ANSWER_CALL_DURING_AUDIO | \\\n\t\t\tMPSD_HFP_AG_A2DP_SRC_OUTGOING_CALL_DURING_AUDIO | \\\n\t\t\tMPSD_HFP_AG_A2DP_SRC_REJECT_CALL_DURING_AUDIO | \\\n\t\t\tMPSD_HFP_AG_A2DP_SRC_TERMINATE_CALL_DURING_AVP | \\\n\t\t\tMPSD_HFP_AG_A2DP_SRC_PRESS_PLAY_DURING_ACTIVE_CALL | \\\n\t\t\tMPSD_HFP_AG_A2DP_SRC_START_AUDIO_STREAM_AFTER_PLAY | \\\n\t\t\tMPSD_HFP_AG_A2DP_SRC_SUSPEND_AUDIO_STREAM_ON_PAUSE | \\\n\t\t\tMPSD_A2DP_SRC_DUN_GW_START_AUDIO_DURING_DATA_COMM | \\\n\t\t\tMPSD_A2DP_SRC_DUN_GW_DATA_COMM_DURING_AUDIO_STREAM | \\\n\t\t\tMPSD_A2DP_SRC_PAN_NAP_START_AUDIO_DURING_DATA_COMM | \\\n\t\t\tMPSD_A2DP_SRC_PAN_NAP_DATA_COMM_DURING_AUDIO_STREAM | \\\n\t\t\tMPSD_A2DP_SRC_PBAP_SRV_PB_DL_DURING_AUDIO_STREAM)\n#define MPS_MPSD_HFP_HF (MPSD_HFP_HF_A2DP_SNK_ANSWER_CALL_DURING_AUDIO | \\\n\t\t\tMPSD_HFP_HF_A2DP_SNK_OUTGOING_CALL_DURING_AUDIO | \\\n\t\t\tMPSD_HFP_HF_A2DP_SNK_SRC_REJECT_CALL_DURING_AUDIO | \\\n\t\t\tMPSD_HFP_HF_A2DP_SNK_TERMINATE_CALL_DURING_AVP | \\\n\t\t\tMPSD_HFP_HF_A2DP_SNK_PRESS_PLAY_DURING_ACTIVE_CALL | \\\n\t\t\tMPSD_HFP_HF_A2DP_SNK_START_AUDIO_STREAM_AFTER_PLAY | \\\n\t\t\tMPSD_HFP_HF_A2DP_SNK_SUSPEND_AUDIO_STREAM_ON_PAUSE | \\\n\t\t\tMPSD_HFP_HF_DUN_DT_DATA_COMM_DURING_VOICE_CALL | \\\n\t\t\tMPSD_HFP_HF_DUN_DT_OUTGOING_CALL_DURING_DATA_COMM | \\\n\t\t\tMPSD_HFP_HF_DUN_DT_INCOMING_CALL_DURING_DATA_COMM | \\\n\t\t\tMPSD_HFP_HF_DUN_DT_TERMINATE_CALL_DURING_DATA_COMM | \\\n\t\t\tMPSD_HFP_HF_PAN_PANU_DATA_COMM_DURING_VOICE_CALL | \\\n\t\t\tMPSD_HFP_HF_PAN_PANU_OUTGOING_CALL_DURING_DATA_COMM | \\\n\t\t\tMPSD_HFP_HF_PAN_PANU_INCOMING_CALL_DURING_DATA_COMM)\n#define MPS_MPSD_HFP_AG (MPSD_HFP_AG_A2DP_SRC_ANSWER_CALL_DURING_AUDIO | \\\n\t\t\tMPSD_HFP_AG_A2DP_SRC_OUTGOING_CALL_DURING_AUDIO | \\\n\t\t\tMPSD_HFP_AG_A2DP_SRC_REJECT_CALL_DURING_AUDIO | \\\n\t\t\tMPSD_HFP_AG_A2DP_SRC_TERMINATE_CALL_DURING_AVP | \\\n\t\t\tMPSD_HFP_AG_A2DP_SRC_PRESS_PLAY_DURING_ACTIVE_CALL | \\\n\t\t\tMPSD_HFP_AG_A2DP_SRC_START_AUDIO_STREAM_AFTER_PLAY | \\\n\t\t\tMPSD_HFP_AG_DUN_GW_DATA_COMM_DURING_VOICE_CALL | \\\n\t\t\tMPSD_HFP_AG_A2DP_SRC_SUSPEND_AUDIO_STREAM_ON_PAUSE | \\\n\t\t\tMPSD_HFP_AG_DUN_GW_OUTGOING_CALL_DURING_DATA_COMM | \\\n\t\t\tMPSD_HFP_AG_DUN_GW_INCOMING_CALL_DURING_DATA_COMM | \\\n\t\t\tMPSD_HFP_AG_DUN_GW_TERMINATE_CALL_DURING_DATA_COMM | \\\n\t\t\tMPSD_HFP_AG_PAN_NAP_DATA_COMM_DURING_VOICE_CALL | \\\n\t\t\tMPSD_HFP_AG_PAN_NAP_OUTGOING_CALL_DURING_DATA_COMM | \\\n\t\t\tMPSD_HFP_AG_PAN_NAP_INCOMING_CALL_DURING_DATA_COMM)\n\nstatic uint64_t mps_mpsd_features(void)\n{\n\tuint64_t feat = MPS_MPSD_ALL;\n\n\tif (!class_supported(HANDSFREE_AGW_SVCLASS_ID))\n\t\tfeat &= ~MPS_MPSD_HFP_AG;\n\n\tif (!class_supported(HANDSFREE_SVCLASS_ID))\n\t\tfeat &= ~MPS_MPSD_HFP_HF;\n\n\tif (!class_supported(AUDIO_SOURCE_SVCLASS_ID))\n\t\tfeat &= ~MPS_MPSD_A2DP_SRC;\n\n\tif (!class_supported(AUDIO_SINK_SVCLASS_ID))\n\t\tfeat &= ~MPS_MPSD_A2DP_SNK;\n\n\tif (!class_supported(AV_REMOTE_CONTROLLER_SVCLASS_ID))\n\t\tfeat &= ~MPS_MPSD_AVRCP_CT;\n\n\tif (!class_supported(AV_REMOTE_TARGET_SVCLASS_ID))\n\t\tfeat &= ~MPS_MPSD_AVRCP_TG;\n\n\tif (!class_supported(DIALUP_NET_SVCLASS_ID))\n\t\tfeat &= ~MPS_MPSD_DUN_GW;\n\n\t/* TODO */\n\tfeat &= ~MPS_MPSD_DUN_DT;\n\n\tif (!class_supported(NAP_SVCLASS_ID))\n\t\tfeat &= ~MPS_MPSD_PAN_NAP;\n\n\tif (!class_supported(PANU_SVCLASS_ID))\n\t\tfeat &= ~MPS_MPSD_PAN_PANU;\n\n\tif (!class_supported(PBAP_PSE_SVCLASS_ID))\n\t\tfeat &= ~MPS_MPSD_PBAP_SRC;\n\n\tif (!class_supported(PBAP_PCE_SVCLASS_ID))\n\t\tfeat &= ~MPS_MPSD_PBAP_CLI;\n\n\treturn feat;\n}"
  },
  {
    "function_name": "class_supported",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/sdpd-service.c",
    "lines": "465-480",
    "snippet": "static bool class_supported(uint16_t class)\n{\n\tsdp_list_t *list;\n\tuuid_t uuid;\n\n\tsdp_uuid16_create(&uuid, class);\n\n\tfor (list = sdp_get_record_list(); list; list = list->next) {\n\t\tsdp_record_t *rec = list->data;\n\n\t\tif (sdp_uuid_cmp(&rec->svclass, &uuid) == 0)\n\t\t\treturn true;\n\t}\n\n\treturn false;\n}",
    "includes": [
      "#include \"log.h\"",
      "#include \"sdpd.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <glib.h>",
      "#include <stdbool.h>",
      "#include <sys/time.h>",
      "#include <assert.h>",
      "#include <stdlib.h>",
      "#include <errno.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "sdp_uuid_cmp",
          "args": [
            "&rec->svclass",
            "&uuid"
          ],
          "line": 475
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_get_record_list",
          "args": [],
          "line": 472
        },
        "resolved": true,
        "details": {
          "function_name": "sdp_get_record_list",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/sdpd-database.c",
          "lines": "272-275",
          "snippet": "sdp_list_t *sdp_get_record_list(void)\n{\n\treturn service_db;\n}",
          "includes": [
            "#include \"log.h\"",
            "#include \"sdpd.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static sdp_list_t *service_db;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n#include \"sdpd.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <stdbool.h>\n#include <stdlib.h>\n#include <config.h>\n\nstatic sdp_list_t *service_db;\n\nsdp_list_t *sdp_get_record_list(void)\n{\n\treturn service_db;\n}"
        }
      },
      {
        "call_info": {
          "callee": "sdp_uuid16_create",
          "args": [
            "&uuid",
            "class"
          ],
          "line": 470
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"log.h\"\n#include \"sdpd.h\"\n#include \"src/shared/util.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <stdbool.h>\n#include <sys/time.h>\n#include <assert.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <config.h>\n\nstatic bool class_supported(uint16_t class)\n{\n\tsdp_list_t *list;\n\tuuid_t uuid;\n\n\tsdp_uuid16_create(&uuid, class);\n\n\tfor (list = sdp_get_record_list(); list; list = list->next) {\n\t\tsdp_record_t *rec = list->data;\n\n\t\tif (sdp_uuid_cmp(&rec->svclass, &uuid) == 0)\n\t\t\treturn true;\n\t}\n\n\treturn false;\n}"
  },
  {
    "function_name": "register_device_id",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/sdpd-service.c",
    "lines": "407-463",
    "snippet": "void register_device_id(uint16_t source, uint16_t vendor,\n\t\t\t\t\tuint16_t product, uint16_t version)\n{\n\tconst uint16_t spec = 0x0103;\n\tconst uint8_t primary = 1;\n\tsdp_list_t *class_list, *group_list, *profile_list;\n\tuuid_t class_uuid, group_uuid;\n\tsdp_data_t *sdp_data, *primary_data, *source_data;\n\tsdp_data_t *spec_data, *vendor_data, *product_data, *version_data;\n\tsdp_profile_desc_t profile;\n\tsdp_record_t *record = sdp_record_alloc();\n\n\tDBG(\"Adding device id record for %04x:%04x:%04x:%04x\",\n\t\t\t\t\tsource, vendor, product, version);\n\n\trecord->handle = sdp_next_handle();\n\n\tsdp_record_add(BDADDR_ANY, record);\n\tsdp_data = sdp_data_alloc(SDP_UINT32, &record->handle);\n\tsdp_attr_add(record, SDP_ATTR_RECORD_HANDLE, sdp_data);\n\n\tsdp_uuid16_create(&class_uuid, PNP_INFO_SVCLASS_ID);\n\tclass_list = sdp_list_append(0, &class_uuid);\n\tsdp_set_service_classes(record, class_list);\n\tsdp_list_free(class_list, NULL);\n\n\tsdp_uuid16_create(&group_uuid, PUBLIC_BROWSE_GROUP);\n\tgroup_list = sdp_list_append(NULL, &group_uuid);\n\tsdp_set_browse_groups(record, group_list);\n\tsdp_list_free(group_list, NULL);\n\n\tsdp_uuid16_create(&profile.uuid, PNP_INFO_PROFILE_ID);\n\tprofile.version = spec;\n\tprofile_list = sdp_list_append(NULL, &profile);\n\tsdp_set_profile_descs(record, profile_list);\n\tsdp_list_free(profile_list, NULL);\n\n\tspec_data = sdp_data_alloc(SDP_UINT16, &spec);\n\tsdp_attr_add(record, 0x0200, spec_data);\n\n\tvendor_data = sdp_data_alloc(SDP_UINT16, &vendor);\n\tsdp_attr_add(record, 0x0201, vendor_data);\n\n\tproduct_data = sdp_data_alloc(SDP_UINT16, &product);\n\tsdp_attr_add(record, 0x0202, product_data);\n\n\tversion_data = sdp_data_alloc(SDP_UINT16, &version);\n\tsdp_attr_add(record, 0x0203, version_data);\n\n\tprimary_data = sdp_data_alloc(SDP_BOOL, &primary);\n\tsdp_attr_add(record, 0x0204, primary_data);\n\n\tsource_data = sdp_data_alloc(SDP_UINT16, &source);\n\tsdp_attr_add(record, 0x0205, source_data);\n\n\tupdate_db_timestamp();\n}",
    "includes": [
      "#include \"log.h\"",
      "#include \"sdpd.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <glib.h>",
      "#include <stdbool.h>",
      "#include <sys/time.h>",
      "#include <assert.h>",
      "#include <stdlib.h>",
      "#include <errno.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "update_db_timestamp",
          "args": [],
          "line": 462
        },
        "resolved": true,
        "details": {
          "function_name": "update_db_timestamp",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/sdpd-service.c",
          "lines": "311-321",
          "snippet": "static void update_db_timestamp(void)\n{\n\tif (fixed_dbts) {\n\t\tsdp_data_t *d = sdp_data_alloc(SDP_UINT32, &fixed_dbts);\n\t\tsdp_attr_replace(server, SDP_ATTR_SVCDB_STATE, d);\n\t} else {\n\t\tuint32_t dbts = sdp_get_time();\n\t\tsdp_data_t *d = sdp_data_alloc(SDP_UINT32, &dbts);\n\t\tsdp_attr_replace(server, SDP_ATTR_SVCDB_STATE, d);\n\t}\n}",
          "includes": [
            "#include \"log.h\"",
            "#include \"sdpd.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <stdbool.h>",
            "#include <sys/time.h>",
            "#include <assert.h>",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static sdp_record_t *server = NULL;",
            "static uint32_t fixed_dbts = 0;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n#include \"sdpd.h\"\n#include \"src/shared/util.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <stdbool.h>\n#include <sys/time.h>\n#include <assert.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <config.h>\n\nstatic sdp_record_t *server = NULL;\nstatic uint32_t fixed_dbts = 0;\n\nstatic void update_db_timestamp(void)\n{\n\tif (fixed_dbts) {\n\t\tsdp_data_t *d = sdp_data_alloc(SDP_UINT32, &fixed_dbts);\n\t\tsdp_attr_replace(server, SDP_ATTR_SVCDB_STATE, d);\n\t} else {\n\t\tuint32_t dbts = sdp_get_time();\n\t\tsdp_data_t *d = sdp_data_alloc(SDP_UINT32, &dbts);\n\t\tsdp_attr_replace(server, SDP_ATTR_SVCDB_STATE, d);\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "sdp_attr_add",
          "args": [
            "record",
            "0x0205",
            "source_data"
          ],
          "line": 460
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_data_alloc",
          "args": [
            "SDP_UINT16",
            "&source"
          ],
          "line": 459
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_attr_add",
          "args": [
            "record",
            "0x0204",
            "primary_data"
          ],
          "line": 457
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_data_alloc",
          "args": [
            "SDP_BOOL",
            "&primary"
          ],
          "line": 456
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_attr_add",
          "args": [
            "record",
            "0x0203",
            "version_data"
          ],
          "line": 454
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_data_alloc",
          "args": [
            "SDP_UINT16",
            "&version"
          ],
          "line": 453
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_attr_add",
          "args": [
            "record",
            "0x0202",
            "product_data"
          ],
          "line": 451
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_data_alloc",
          "args": [
            "SDP_UINT16",
            "&product"
          ],
          "line": 450
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_attr_add",
          "args": [
            "record",
            "0x0201",
            "vendor_data"
          ],
          "line": 448
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_data_alloc",
          "args": [
            "SDP_UINT16",
            "&vendor"
          ],
          "line": 447
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_attr_add",
          "args": [
            "record",
            "0x0200",
            "spec_data"
          ],
          "line": 445
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_data_alloc",
          "args": [
            "SDP_UINT16",
            "&spec"
          ],
          "line": 444
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_list_free",
          "args": [
            "profile_list",
            "NULL"
          ],
          "line": 442
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_set_profile_descs",
          "args": [
            "record",
            "profile_list"
          ],
          "line": 441
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_list_append",
          "args": [
            "NULL",
            "&profile"
          ],
          "line": 440
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_uuid16_create",
          "args": [
            "&profile.uuid",
            "PNP_INFO_PROFILE_ID"
          ],
          "line": 438
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_list_free",
          "args": [
            "group_list",
            "NULL"
          ],
          "line": 436
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_set_browse_groups",
          "args": [
            "record",
            "group_list"
          ],
          "line": 435
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_list_append",
          "args": [
            "NULL",
            "&group_uuid"
          ],
          "line": 434
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_uuid16_create",
          "args": [
            "&group_uuid",
            "PUBLIC_BROWSE_GROUP"
          ],
          "line": 433
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_list_free",
          "args": [
            "class_list",
            "NULL"
          ],
          "line": 431
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_set_service_classes",
          "args": [
            "record",
            "class_list"
          ],
          "line": 430
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_list_append",
          "args": [
            "0",
            "&class_uuid"
          ],
          "line": 429
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_uuid16_create",
          "args": [
            "&class_uuid",
            "PNP_INFO_SVCLASS_ID"
          ],
          "line": 428
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_attr_add",
          "args": [
            "record",
            "SDP_ATTR_RECORD_HANDLE",
            "sdp_data"
          ],
          "line": 426
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_data_alloc",
          "args": [
            "SDP_UINT32",
            "&record->handle"
          ],
          "line": 425
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_record_add",
          "args": [
            "BDADDR_ANY",
            "record"
          ],
          "line": 424
        },
        "resolved": true,
        "details": {
          "function_name": "sdp_record_add",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/sdpd-database.c",
          "lines": "175-192",
          "snippet": "void sdp_record_add(const bdaddr_t *device, sdp_record_t *rec)\n{\n\tsdp_access_t *dev;\n\n\tSDPDBG(\"Adding rec : 0x%lx\", (long) rec);\n\tSDPDBG(\"with handle : 0x%x\", rec->handle);\n\n\tservice_db = sdp_list_insert_sorted(service_db, rec, record_sort);\n\n\tdev = malloc(sizeof(*dev));\n\tif (!dev)\n\t\treturn;\n\n\tbacpy(&dev->device, device);\n\tdev->handle = rec->handle;\n\n\taccess_db = sdp_list_insert_sorted(access_db, dev, access_sort);\n}",
          "includes": [
            "#include \"log.h\"",
            "#include \"sdpd.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static sdp_list_t *service_db;",
            "static sdp_list_t *access_db;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n#include \"sdpd.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <stdbool.h>\n#include <stdlib.h>\n#include <config.h>\n\nstatic sdp_list_t *service_db;\nstatic sdp_list_t *access_db;\n\nvoid sdp_record_add(const bdaddr_t *device, sdp_record_t *rec)\n{\n\tsdp_access_t *dev;\n\n\tSDPDBG(\"Adding rec : 0x%lx\", (long) rec);\n\tSDPDBG(\"with handle : 0x%x\", rec->handle);\n\n\tservice_db = sdp_list_insert_sorted(service_db, rec, record_sort);\n\n\tdev = malloc(sizeof(*dev));\n\tif (!dev)\n\t\treturn;\n\n\tbacpy(&dev->device, device);\n\tdev->handle = rec->handle;\n\n\taccess_db = sdp_list_insert_sorted(access_db, dev, access_sort);\n}"
        }
      },
      {
        "call_info": {
          "callee": "sdp_next_handle",
          "args": [],
          "line": 422
        },
        "resolved": true,
        "details": {
          "function_name": "sdp_next_handle",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/sdpd-database.c",
          "lines": "297-305",
          "snippet": "uint32_t sdp_next_handle(void)\n{\n\tuint32_t handle = 0x10000;\n\n\twhile (sdp_record_find(handle))\n\t\thandle++;\n\n\treturn handle;\n}",
          "includes": [
            "#include \"log.h\"",
            "#include \"sdpd.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n#include \"sdpd.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <stdbool.h>\n#include <stdlib.h>\n#include <config.h>\n\nuint32_t sdp_next_handle(void)\n{\n\tuint32_t handle = 0x10000;\n\n\twhile (sdp_record_find(handle))\n\t\thandle++;\n\n\treturn handle;\n}"
        }
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"Adding device id record for %04x:%04x:%04x:%04x\"",
            "source",
            "vendor",
            "product",
            "version"
          ],
          "line": 419
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_record_alloc",
          "args": [],
          "line": 417
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"log.h\"\n#include \"sdpd.h\"\n#include \"src/shared/util.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <stdbool.h>\n#include <sys/time.h>\n#include <assert.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <config.h>\n\nvoid register_device_id(uint16_t source, uint16_t vendor,\n\t\t\t\t\tuint16_t product, uint16_t version)\n{\n\tconst uint16_t spec = 0x0103;\n\tconst uint8_t primary = 1;\n\tsdp_list_t *class_list, *group_list, *profile_list;\n\tuuid_t class_uuid, group_uuid;\n\tsdp_data_t *sdp_data, *primary_data, *source_data;\n\tsdp_data_t *spec_data, *vendor_data, *product_data, *version_data;\n\tsdp_profile_desc_t profile;\n\tsdp_record_t *record = sdp_record_alloc();\n\n\tDBG(\"Adding device id record for %04x:%04x:%04x:%04x\",\n\t\t\t\t\tsource, vendor, product, version);\n\n\trecord->handle = sdp_next_handle();\n\n\tsdp_record_add(BDADDR_ANY, record);\n\tsdp_data = sdp_data_alloc(SDP_UINT32, &record->handle);\n\tsdp_attr_add(record, SDP_ATTR_RECORD_HANDLE, sdp_data);\n\n\tsdp_uuid16_create(&class_uuid, PNP_INFO_SVCLASS_ID);\n\tclass_list = sdp_list_append(0, &class_uuid);\n\tsdp_set_service_classes(record, class_list);\n\tsdp_list_free(class_list, NULL);\n\n\tsdp_uuid16_create(&group_uuid, PUBLIC_BROWSE_GROUP);\n\tgroup_list = sdp_list_append(NULL, &group_uuid);\n\tsdp_set_browse_groups(record, group_list);\n\tsdp_list_free(group_list, NULL);\n\n\tsdp_uuid16_create(&profile.uuid, PNP_INFO_PROFILE_ID);\n\tprofile.version = spec;\n\tprofile_list = sdp_list_append(NULL, &profile);\n\tsdp_set_profile_descs(record, profile_list);\n\tsdp_list_free(profile_list, NULL);\n\n\tspec_data = sdp_data_alloc(SDP_UINT16, &spec);\n\tsdp_attr_add(record, 0x0200, spec_data);\n\n\tvendor_data = sdp_data_alloc(SDP_UINT16, &vendor);\n\tsdp_attr_add(record, 0x0201, vendor_data);\n\n\tproduct_data = sdp_data_alloc(SDP_UINT16, &product);\n\tsdp_attr_add(record, 0x0202, product_data);\n\n\tversion_data = sdp_data_alloc(SDP_UINT16, &version);\n\tsdp_attr_add(record, 0x0203, version_data);\n\n\tprimary_data = sdp_data_alloc(SDP_BOOL, &primary);\n\tsdp_attr_add(record, 0x0204, primary_data);\n\n\tsource_data = sdp_data_alloc(SDP_UINT16, &source);\n\tsdp_attr_add(record, 0x0205, source_data);\n\n\tupdate_db_timestamp();\n}"
  },
  {
    "function_name": "register_server_service",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/sdpd-service.c",
    "lines": "357-405",
    "snippet": "void register_server_service(void)\n{\n\tsdp_list_t *classIDList;\n\tuuid_t classID;\n\tvoid **versions, **versionDTDs;\n\tuint8_t dtd;\n\tsdp_data_t *pData;\n\tint i;\n\n\tserver = sdp_record_alloc();\n\tserver->pattern = NULL;\n\n\t/* Force the record to be SDP_SERVER_RECORD_HANDLE */\n\tserver->handle = SDP_SERVER_RECORD_HANDLE;\n\n\tsdp_record_add(BDADDR_ANY, server);\n\tsdp_attr_add(server, SDP_ATTR_RECORD_HANDLE,\n\t\t\t\tsdp_data_alloc(SDP_UINT32, &server->handle));\n\n\tsdp_uuid16_create(&classID, SDP_SERVER_SVCLASS_ID);\n\tclassIDList = sdp_list_append(0, &classID);\n\tsdp_set_service_classes(server, classIDList);\n\tsdp_list_free(classIDList, 0);\n\n\t/*\n\t * Set the version numbers supported, these are passed as arguments\n\t * to the server on command line. Now defaults to 1.0\n\t * Build the version number sequence first\n\t */\n\tversions = malloc(sdpServerVnumEntries * sizeof(void *));\n\tversionDTDs = malloc(sdpServerVnumEntries * sizeof(void *));\n\tdtd = SDP_UINT16;\n\tfor (i = 0; i < sdpServerVnumEntries; i++) {\n\t\tuint16_t *version = malloc(sizeof(uint16_t));\n\t\t*version = sdpVnumArray[i].major;\n\t\t*version = (*version << 8);\n\t\t*version |= sdpVnumArray[i].minor;\n\t\tversions[i] = version;\n\t\tversionDTDs[i] = &dtd;\n\t}\n\tpData = sdp_seq_alloc(versionDTDs, versions, sdpServerVnumEntries);\n\tfor (i = 0; i < sdpServerVnumEntries; i++)\n\t\tfree(versions[i]);\n\tfree(versions);\n\tfree(versionDTDs);\n\tsdp_attr_add(server, SDP_ATTR_VERSION_NUM_LIST, pData);\n\n\tupdate_db_timestamp();\n}",
    "includes": [
      "#include \"log.h\"",
      "#include \"sdpd.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <glib.h>",
      "#include <stdbool.h>",
      "#include <sys/time.h>",
      "#include <assert.h>",
      "#include <stdlib.h>",
      "#include <errno.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static sdp_record_t *server = NULL;",
      "static sdp_version_t sdpVnumArray[1] = {\n\t{ 1, 0 }\n};",
      "static const int sdpServerVnumEntries = 1;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "update_db_timestamp",
          "args": [],
          "line": 404
        },
        "resolved": true,
        "details": {
          "function_name": "update_db_timestamp",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/sdpd-service.c",
          "lines": "311-321",
          "snippet": "static void update_db_timestamp(void)\n{\n\tif (fixed_dbts) {\n\t\tsdp_data_t *d = sdp_data_alloc(SDP_UINT32, &fixed_dbts);\n\t\tsdp_attr_replace(server, SDP_ATTR_SVCDB_STATE, d);\n\t} else {\n\t\tuint32_t dbts = sdp_get_time();\n\t\tsdp_data_t *d = sdp_data_alloc(SDP_UINT32, &dbts);\n\t\tsdp_attr_replace(server, SDP_ATTR_SVCDB_STATE, d);\n\t}\n}",
          "includes": [
            "#include \"log.h\"",
            "#include \"sdpd.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <stdbool.h>",
            "#include <sys/time.h>",
            "#include <assert.h>",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static sdp_record_t *server = NULL;",
            "static uint32_t fixed_dbts = 0;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n#include \"sdpd.h\"\n#include \"src/shared/util.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <stdbool.h>\n#include <sys/time.h>\n#include <assert.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <config.h>\n\nstatic sdp_record_t *server = NULL;\nstatic uint32_t fixed_dbts = 0;\n\nstatic void update_db_timestamp(void)\n{\n\tif (fixed_dbts) {\n\t\tsdp_data_t *d = sdp_data_alloc(SDP_UINT32, &fixed_dbts);\n\t\tsdp_attr_replace(server, SDP_ATTR_SVCDB_STATE, d);\n\t} else {\n\t\tuint32_t dbts = sdp_get_time();\n\t\tsdp_data_t *d = sdp_data_alloc(SDP_UINT32, &dbts);\n\t\tsdp_attr_replace(server, SDP_ATTR_SVCDB_STATE, d);\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "sdp_attr_add",
          "args": [
            "server",
            "SDP_ATTR_VERSION_NUM_LIST",
            "pData"
          ],
          "line": 402
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "free",
          "args": [
            "versionDTDs"
          ],
          "line": 401
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_server_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/attrib-server.c",
          "lines": "123-150",
          "snippet": "static void gatt_server_free(struct gatt_server *server)\n{\n\tg_list_free_full(server->database, attrib_free);\n\n\tif (server->l2cap_io != NULL) {\n\t\tg_io_channel_shutdown(server->l2cap_io, FALSE, NULL);\n\t\tg_io_channel_unref(server->l2cap_io);\n\t}\n\n\tif (server->le_io != NULL) {\n\t\tg_io_channel_shutdown(server->le_io, FALSE, NULL);\n\t\tg_io_channel_unref(server->le_io);\n\t}\n\n\tg_slist_free_full(server->clients, (GDestroyNotify) channel_free);\n\n\tif (server->gatt_sdp_handle > 0)\n\t\tadapter_service_remove(server->adapter,\n\t\t\t\t\tserver->gatt_sdp_handle);\n\n\tif (server->gap_sdp_handle > 0)\n\t\tadapter_service_remove(server->adapter, server->gap_sdp_handle);\n\n\tif (server->adapter != NULL)\n\t\tbtd_adapter_unref(server->adapter);\n\n\tg_free(server);\n}",
          "includes": [
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"attrib/att-database.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"backtrace.h\"",
            "#include \"log.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <sys/stat.h>",
            "#include <glib.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdbool.h>",
            "#include <stdint.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"attrib/att-database.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"src/shared/util.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <sys/stat.h>\n#include <glib.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdbool.h>\n#include <stdint.h>\n#include <errno.h>\n#include <config.h>\n\nstatic void gatt_server_free(struct gatt_server *server)\n{\n\tg_list_free_full(server->database, attrib_free);\n\n\tif (server->l2cap_io != NULL) {\n\t\tg_io_channel_shutdown(server->l2cap_io, FALSE, NULL);\n\t\tg_io_channel_unref(server->l2cap_io);\n\t}\n\n\tif (server->le_io != NULL) {\n\t\tg_io_channel_shutdown(server->le_io, FALSE, NULL);\n\t\tg_io_channel_unref(server->le_io);\n\t}\n\n\tg_slist_free_full(server->clients, (GDestroyNotify) channel_free);\n\n\tif (server->gatt_sdp_handle > 0)\n\t\tadapter_service_remove(server->adapter,\n\t\t\t\t\tserver->gatt_sdp_handle);\n\n\tif (server->gap_sdp_handle > 0)\n\t\tadapter_service_remove(server->adapter, server->gap_sdp_handle);\n\n\tif (server->adapter != NULL)\n\t\tbtd_adapter_unref(server->adapter);\n\n\tg_free(server);\n}"
        }
      },
      {
        "call_info": {
          "callee": "sdp_seq_alloc",
          "args": [
            "versionDTDs",
            "versions",
            "sdpServerVnumEntries"
          ],
          "line": 397
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "malloc",
          "args": [
            "sizeof(uint16_t)"
          ],
          "line": 390
        },
        "resolved": true,
        "details": {
          "function_name": "btd_malloc",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/util.c",
          "lines": "41-55",
          "snippet": "void *btd_malloc(size_t size)\n{\n\tif (__builtin_expect(!!size, 1)) {\n\t\tvoid *ptr;\n\n\t\tptr = malloc(size);\n\t\tif (ptr)\n\t\t\treturn ptr;\n\n\t\tfprintf(stderr, \"failed to allocate %zu bytes\\n\", size);\n\t\tabort();\n\t}\n\n\treturn NULL;\n}",
          "includes": [
            "#include \"src/shared/util.h\"",
            "#include <string.h>",
            "#include <limits.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <stdbool.h>",
            "#include <stdarg.h>",
            "#include <ctype.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/util.h\"\n#include <string.h>\n#include <limits.h>\n#include <dirent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <config.h>\n\nvoid *btd_malloc(size_t size)\n{\n\tif (__builtin_expect(!!size, 1)) {\n\t\tvoid *ptr;\n\n\t\tptr = malloc(size);\n\t\tif (ptr)\n\t\t\treturn ptr;\n\n\t\tfprintf(stderr, \"failed to allocate %zu bytes\\n\", size);\n\t\tabort();\n\t}\n\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "sdp_list_free",
          "args": [
            "classIDList",
            "0"
          ],
          "line": 379
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_set_service_classes",
          "args": [
            "server",
            "classIDList"
          ],
          "line": 378
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_list_append",
          "args": [
            "0",
            "&classID"
          ],
          "line": 377
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_uuid16_create",
          "args": [
            "&classID",
            "SDP_SERVER_SVCLASS_ID"
          ],
          "line": 376
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_attr_add",
          "args": [
            "server",
            "SDP_ATTR_RECORD_HANDLE",
            "sdp_data_alloc(SDP_UINT32, &server->handle)"
          ],
          "line": 373
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_data_alloc",
          "args": [
            "SDP_UINT32",
            "&server->handle"
          ],
          "line": 374
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_record_add",
          "args": [
            "BDADDR_ANY",
            "server"
          ],
          "line": 372
        },
        "resolved": true,
        "details": {
          "function_name": "sdp_record_add",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/sdpd-database.c",
          "lines": "175-192",
          "snippet": "void sdp_record_add(const bdaddr_t *device, sdp_record_t *rec)\n{\n\tsdp_access_t *dev;\n\n\tSDPDBG(\"Adding rec : 0x%lx\", (long) rec);\n\tSDPDBG(\"with handle : 0x%x\", rec->handle);\n\n\tservice_db = sdp_list_insert_sorted(service_db, rec, record_sort);\n\n\tdev = malloc(sizeof(*dev));\n\tif (!dev)\n\t\treturn;\n\n\tbacpy(&dev->device, device);\n\tdev->handle = rec->handle;\n\n\taccess_db = sdp_list_insert_sorted(access_db, dev, access_sort);\n}",
          "includes": [
            "#include \"log.h\"",
            "#include \"sdpd.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static sdp_list_t *service_db;",
            "static sdp_list_t *access_db;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n#include \"sdpd.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <stdbool.h>\n#include <stdlib.h>\n#include <config.h>\n\nstatic sdp_list_t *service_db;\nstatic sdp_list_t *access_db;\n\nvoid sdp_record_add(const bdaddr_t *device, sdp_record_t *rec)\n{\n\tsdp_access_t *dev;\n\n\tSDPDBG(\"Adding rec : 0x%lx\", (long) rec);\n\tSDPDBG(\"with handle : 0x%x\", rec->handle);\n\n\tservice_db = sdp_list_insert_sorted(service_db, rec, record_sort);\n\n\tdev = malloc(sizeof(*dev));\n\tif (!dev)\n\t\treturn;\n\n\tbacpy(&dev->device, device);\n\tdev->handle = rec->handle;\n\n\taccess_db = sdp_list_insert_sorted(access_db, dev, access_sort);\n}"
        }
      },
      {
        "call_info": {
          "callee": "sdp_record_alloc",
          "args": [],
          "line": 366
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"log.h\"\n#include \"sdpd.h\"\n#include \"src/shared/util.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <stdbool.h>\n#include <sys/time.h>\n#include <assert.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <config.h>\n\nstatic sdp_record_t *server = NULL;\nstatic sdp_version_t sdpVnumArray[1] = {\n\t{ 1, 0 }\n};\nstatic const int sdpServerVnumEntries = 1;\n\nvoid register_server_service(void)\n{\n\tsdp_list_t *classIDList;\n\tuuid_t classID;\n\tvoid **versions, **versionDTDs;\n\tuint8_t dtd;\n\tsdp_data_t *pData;\n\tint i;\n\n\tserver = sdp_record_alloc();\n\tserver->pattern = NULL;\n\n\t/* Force the record to be SDP_SERVER_RECORD_HANDLE */\n\tserver->handle = SDP_SERVER_RECORD_HANDLE;\n\n\tsdp_record_add(BDADDR_ANY, server);\n\tsdp_attr_add(server, SDP_ATTR_RECORD_HANDLE,\n\t\t\t\tsdp_data_alloc(SDP_UINT32, &server->handle));\n\n\tsdp_uuid16_create(&classID, SDP_SERVER_SVCLASS_ID);\n\tclassIDList = sdp_list_append(0, &classID);\n\tsdp_set_service_classes(server, classIDList);\n\tsdp_list_free(classIDList, 0);\n\n\t/*\n\t * Set the version numbers supported, these are passed as arguments\n\t * to the server on command line. Now defaults to 1.0\n\t * Build the version number sequence first\n\t */\n\tversions = malloc(sdpServerVnumEntries * sizeof(void *));\n\tversionDTDs = malloc(sdpServerVnumEntries * sizeof(void *));\n\tdtd = SDP_UINT16;\n\tfor (i = 0; i < sdpServerVnumEntries; i++) {\n\t\tuint16_t *version = malloc(sizeof(uint16_t));\n\t\t*version = sdpVnumArray[i].major;\n\t\t*version = (*version << 8);\n\t\t*version |= sdpVnumArray[i].minor;\n\t\tversions[i] = version;\n\t\tversionDTDs[i] = &dtd;\n\t}\n\tpData = sdp_seq_alloc(versionDTDs, versions, sdpServerVnumEntries);\n\tfor (i = 0; i < sdpServerVnumEntries; i++)\n\t\tfree(versions[i]);\n\tfree(versions);\n\tfree(versionDTDs);\n\tsdp_attr_add(server, SDP_ATTR_VERSION_NUM_LIST, pData);\n\n\tupdate_db_timestamp();\n}"
  },
  {
    "function_name": "register_public_browse_group",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/sdpd-service.c",
    "lines": "328-349",
    "snippet": "void register_public_browse_group(void)\n{\n\tsdp_list_t *browselist;\n\tuuid_t bgscid, pbgid;\n\tsdp_data_t *sdpdata;\n\tsdp_record_t *browse = sdp_record_alloc();\n\n\tbrowse->handle = SDP_SERVER_RECORD_HANDLE + 1;\n\n\tsdp_record_add(BDADDR_ANY, browse);\n\tsdpdata = sdp_data_alloc(SDP_UINT32, &browse->handle);\n\tsdp_attr_add(browse, SDP_ATTR_RECORD_HANDLE, sdpdata);\n\n\tsdp_uuid16_create(&bgscid, BROWSE_GRP_DESC_SVCLASS_ID);\n\tbrowselist = sdp_list_append(0, &bgscid);\n\tsdp_set_service_classes(browse, browselist);\n\tsdp_list_free(browselist, 0);\n\n\tsdp_uuid16_create(&pbgid, PUBLIC_BROWSE_GROUP);\n\tsdp_attr_add_new(browse, SDP_ATTR_GROUP_ID,\n\t\t\t\tSDP_UUID16, &pbgid.value.uuid16);\n}",
    "includes": [
      "#include \"log.h\"",
      "#include \"sdpd.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <glib.h>",
      "#include <stdbool.h>",
      "#include <sys/time.h>",
      "#include <assert.h>",
      "#include <stdlib.h>",
      "#include <errno.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "sdp_attr_add_new",
          "args": [
            "browse",
            "SDP_ATTR_GROUP_ID",
            "SDP_UUID16",
            "&pbgid.value.uuid16"
          ],
          "line": 347
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_uuid16_create",
          "args": [
            "&pbgid",
            "PUBLIC_BROWSE_GROUP"
          ],
          "line": 346
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_list_free",
          "args": [
            "browselist",
            "0"
          ],
          "line": 344
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_set_service_classes",
          "args": [
            "browse",
            "browselist"
          ],
          "line": 343
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_list_append",
          "args": [
            "0",
            "&bgscid"
          ],
          "line": 342
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_uuid16_create",
          "args": [
            "&bgscid",
            "BROWSE_GRP_DESC_SVCLASS_ID"
          ],
          "line": 341
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_attr_add",
          "args": [
            "browse",
            "SDP_ATTR_RECORD_HANDLE",
            "sdpdata"
          ],
          "line": 339
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_data_alloc",
          "args": [
            "SDP_UINT32",
            "&browse->handle"
          ],
          "line": 338
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_record_add",
          "args": [
            "BDADDR_ANY",
            "browse"
          ],
          "line": 337
        },
        "resolved": true,
        "details": {
          "function_name": "sdp_record_add",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/sdpd-database.c",
          "lines": "175-192",
          "snippet": "void sdp_record_add(const bdaddr_t *device, sdp_record_t *rec)\n{\n\tsdp_access_t *dev;\n\n\tSDPDBG(\"Adding rec : 0x%lx\", (long) rec);\n\tSDPDBG(\"with handle : 0x%x\", rec->handle);\n\n\tservice_db = sdp_list_insert_sorted(service_db, rec, record_sort);\n\n\tdev = malloc(sizeof(*dev));\n\tif (!dev)\n\t\treturn;\n\n\tbacpy(&dev->device, device);\n\tdev->handle = rec->handle;\n\n\taccess_db = sdp_list_insert_sorted(access_db, dev, access_sort);\n}",
          "includes": [
            "#include \"log.h\"",
            "#include \"sdpd.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static sdp_list_t *service_db;",
            "static sdp_list_t *access_db;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n#include \"sdpd.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <stdbool.h>\n#include <stdlib.h>\n#include <config.h>\n\nstatic sdp_list_t *service_db;\nstatic sdp_list_t *access_db;\n\nvoid sdp_record_add(const bdaddr_t *device, sdp_record_t *rec)\n{\n\tsdp_access_t *dev;\n\n\tSDPDBG(\"Adding rec : 0x%lx\", (long) rec);\n\tSDPDBG(\"with handle : 0x%x\", rec->handle);\n\n\tservice_db = sdp_list_insert_sorted(service_db, rec, record_sort);\n\n\tdev = malloc(sizeof(*dev));\n\tif (!dev)\n\t\treturn;\n\n\tbacpy(&dev->device, device);\n\tdev->handle = rec->handle;\n\n\taccess_db = sdp_list_insert_sorted(access_db, dev, access_sort);\n}"
        }
      },
      {
        "call_info": {
          "callee": "sdp_record_alloc",
          "args": [],
          "line": 333
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"log.h\"\n#include \"sdpd.h\"\n#include \"src/shared/util.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <stdbool.h>\n#include <sys/time.h>\n#include <assert.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <config.h>\n\nvoid register_public_browse_group(void)\n{\n\tsdp_list_t *browselist;\n\tuuid_t bgscid, pbgid;\n\tsdp_data_t *sdpdata;\n\tsdp_record_t *browse = sdp_record_alloc();\n\n\tbrowse->handle = SDP_SERVER_RECORD_HANDLE + 1;\n\n\tsdp_record_add(BDADDR_ANY, browse);\n\tsdpdata = sdp_data_alloc(SDP_UINT32, &browse->handle);\n\tsdp_attr_add(browse, SDP_ATTR_RECORD_HANDLE, sdpdata);\n\n\tsdp_uuid16_create(&bgscid, BROWSE_GRP_DESC_SVCLASS_ID);\n\tbrowselist = sdp_list_append(0, &bgscid);\n\tsdp_set_service_classes(browse, browselist);\n\tsdp_list_free(browselist, 0);\n\n\tsdp_uuid16_create(&pbgid, PUBLIC_BROWSE_GROUP);\n\tsdp_attr_add_new(browse, SDP_ATTR_GROUP_ID,\n\t\t\t\tSDP_UUID16, &pbgid.value.uuid16);\n}"
  },
  {
    "function_name": "set_fixed_db_timestamp",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/sdpd-service.c",
    "lines": "323-326",
    "snippet": "void set_fixed_db_timestamp(uint32_t dbts)\n{\n\tfixed_dbts = dbts;\n}",
    "includes": [
      "#include \"log.h\"",
      "#include \"sdpd.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <glib.h>",
      "#include <stdbool.h>",
      "#include <sys/time.h>",
      "#include <assert.h>",
      "#include <stdlib.h>",
      "#include <errno.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static uint32_t fixed_dbts = 0;"
    ],
    "called_functions": [],
    "contextual_snippet": "#include \"log.h\"\n#include \"sdpd.h\"\n#include \"src/shared/util.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <stdbool.h>\n#include <sys/time.h>\n#include <assert.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <config.h>\n\nstatic uint32_t fixed_dbts = 0;\n\nvoid set_fixed_db_timestamp(uint32_t dbts)\n{\n\tfixed_dbts = dbts;\n}"
  },
  {
    "function_name": "update_db_timestamp",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/sdpd-service.c",
    "lines": "311-321",
    "snippet": "static void update_db_timestamp(void)\n{\n\tif (fixed_dbts) {\n\t\tsdp_data_t *d = sdp_data_alloc(SDP_UINT32, &fixed_dbts);\n\t\tsdp_attr_replace(server, SDP_ATTR_SVCDB_STATE, d);\n\t} else {\n\t\tuint32_t dbts = sdp_get_time();\n\t\tsdp_data_t *d = sdp_data_alloc(SDP_UINT32, &dbts);\n\t\tsdp_attr_replace(server, SDP_ATTR_SVCDB_STATE, d);\n\t}\n}",
    "includes": [
      "#include \"log.h\"",
      "#include \"sdpd.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <glib.h>",
      "#include <stdbool.h>",
      "#include <sys/time.h>",
      "#include <assert.h>",
      "#include <stdlib.h>",
      "#include <errno.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static sdp_record_t *server = NULL;",
      "static uint32_t fixed_dbts = 0;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "sdp_attr_replace",
          "args": [
            "server",
            "SDP_ATTR_SVCDB_STATE",
            "d"
          ],
          "line": 319
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_data_alloc",
          "args": [
            "SDP_UINT32",
            "&dbts"
          ],
          "line": 318
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_get_time",
          "args": [],
          "line": 317
        },
        "resolved": true,
        "details": {
          "function_name": "sdp_get_time",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/sdpd-service.c",
          "lines": "290-300",
          "snippet": "uint32_t sdp_get_time(void)\n{\n\t/*\n\t * To handle failure in gettimeofday, so an old\n\t * value is returned and service does not fail\n\t */\n\tstatic struct timeval tm;\n\n\tgettimeofday(&tm, NULL);\n\treturn (uint32_t) tm.tv_sec;\n}",
          "includes": [
            "#include \"log.h\"",
            "#include \"sdpd.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <stdbool.h>",
            "#include <sys/time.h>",
            "#include <assert.h>",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n#include \"sdpd.h\"\n#include \"src/shared/util.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <stdbool.h>\n#include <sys/time.h>\n#include <assert.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <config.h>\n\nuint32_t sdp_get_time(void)\n{\n\t/*\n\t * To handle failure in gettimeofday, so an old\n\t * value is returned and service does not fail\n\t */\n\tstatic struct timeval tm;\n\n\tgettimeofday(&tm, NULL);\n\treturn (uint32_t) tm.tv_sec;\n}"
        }
      },
      {
        "call_info": {
          "callee": "sdp_attr_replace",
          "args": [
            "server",
            "SDP_ATTR_SVCDB_STATE",
            "d"
          ],
          "line": 315
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_data_alloc",
          "args": [
            "SDP_UINT32",
            "&fixed_dbts"
          ],
          "line": 314
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"log.h\"\n#include \"sdpd.h\"\n#include \"src/shared/util.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <stdbool.h>\n#include <sys/time.h>\n#include <assert.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <config.h>\n\nstatic sdp_record_t *server = NULL;\nstatic uint32_t fixed_dbts = 0;\n\nstatic void update_db_timestamp(void)\n{\n\tif (fixed_dbts) {\n\t\tsdp_data_t *d = sdp_data_alloc(SDP_UINT32, &fixed_dbts);\n\t\tsdp_attr_replace(server, SDP_ATTR_SVCDB_STATE, d);\n\t} else {\n\t\tuint32_t dbts = sdp_get_time();\n\t\tsdp_data_t *d = sdp_data_alloc(SDP_UINT32, &dbts);\n\t\tsdp_attr_replace(server, SDP_ATTR_SVCDB_STATE, d);\n\t}\n}"
  },
  {
    "function_name": "sdp_get_time",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/sdpd-service.c",
    "lines": "290-300",
    "snippet": "uint32_t sdp_get_time(void)\n{\n\t/*\n\t * To handle failure in gettimeofday, so an old\n\t * value is returned and service does not fail\n\t */\n\tstatic struct timeval tm;\n\n\tgettimeofday(&tm, NULL);\n\treturn (uint32_t) tm.tv_sec;\n}",
    "includes": [
      "#include \"log.h\"",
      "#include \"sdpd.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <glib.h>",
      "#include <stdbool.h>",
      "#include <sys/time.h>",
      "#include <assert.h>",
      "#include <stdlib.h>",
      "#include <errno.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "gettimeofday",
          "args": [
            "&tm",
            "NULL"
          ],
          "line": 298
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"log.h\"\n#include \"sdpd.h\"\n#include \"src/shared/util.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <stdbool.h>\n#include <sys/time.h>\n#include <assert.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <config.h>\n\nuint32_t sdp_get_time(void)\n{\n\t/*\n\t * To handle failure in gettimeofday, so an old\n\t * value is returned and service does not fail\n\t */\n\tstatic struct timeval tm;\n\n\tgettimeofday(&tm, NULL);\n\treturn (uint32_t) tm.tv_sec;\n}"
  }
]