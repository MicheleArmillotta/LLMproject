[
  {
    "function_name": "bt_hci_crypto_ah",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hci-crypto.c",
    "lines": "160-172",
    "snippet": "bool bt_hci_crypto_ah(struct bt_hci *hci,\n\t\t\tconst uint8_t k[16], const uint8_t r[3],\n\t\t\tbt_hci_crypto_func_t callback, void *user_data)\n{\n\tuint8_t rp[16];\n\n\t/* r' = padding || r */\n\tmemcpy(rp, r, 3);\n\tmemset(rp + 3, 0, 13);\n\n\t/* ah(k, r) = e(k, r') mod 2^24 */\n\treturn le_encrypt(hci, 3, k, rp, callback, user_data);\n}",
    "includes": [
      "#include \"src/shared/hci-crypto.h\"",
      "#include \"src/shared/hci.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"monitor/bt.h\"",
      "#include <string.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "le_encrypt",
          "args": [
            "hci",
            "3",
            "k",
            "rp",
            "callback",
            "user_data"
          ],
          "line": 171
        },
        "resolved": true,
        "details": {
          "function_name": "le_encrypt",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hci-crypto.c",
          "lines": "55-80",
          "snippet": "static bool le_encrypt(struct bt_hci *hci, uint8_t size,\n\t\t\tconst uint8_t key[16], const uint8_t plaintext[16],\n\t\t\tbt_hci_crypto_func_t callback, void *user_data)\n{\n\tstruct crypto_data *data;\n\tstruct bt_hci_cmd_le_encrypt cmd;\n\n\tif (!callback || !size || size > 16)\n\t\treturn false;\n\n\tmemcpy(cmd.key, key, 16);\n\tmemcpy(cmd.plaintext, plaintext, 16);\n\n\tdata = new0(struct crypto_data, 1);\n\tdata->size = size;\n\tdata->callback = callback;\n\tdata->user_data = user_data;\n\n\tif (!bt_hci_send(hci, BT_HCI_CMD_LE_ENCRYPT, &cmd, sizeof(cmd),\n\t\t\t\t\tle_encrypt_callback, data, free)) {\n\t\tfree(data);\n\t\treturn false;\n\t}\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/hci-crypto.h\"",
            "#include \"src/shared/hci.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"monitor/bt.h\"",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/hci-crypto.h\"\n#include \"src/shared/hci.h\"\n#include \"src/shared/util.h\"\n#include \"monitor/bt.h\"\n#include <string.h>\n#include <config.h>\n\nstatic bool le_encrypt(struct bt_hci *hci, uint8_t size,\n\t\t\tconst uint8_t key[16], const uint8_t plaintext[16],\n\t\t\tbt_hci_crypto_func_t callback, void *user_data)\n{\n\tstruct crypto_data *data;\n\tstruct bt_hci_cmd_le_encrypt cmd;\n\n\tif (!callback || !size || size > 16)\n\t\treturn false;\n\n\tmemcpy(cmd.key, key, 16);\n\tmemcpy(cmd.plaintext, plaintext, 16);\n\n\tdata = new0(struct crypto_data, 1);\n\tdata->size = size;\n\tdata->callback = callback;\n\tdata->user_data = user_data;\n\n\tif (!bt_hci_send(hci, BT_HCI_CMD_LE_ENCRYPT, &cmd, sizeof(cmd),\n\t\t\t\t\tle_encrypt_callback, data, free)) {\n\t\tfree(data);\n\t\treturn false;\n\t}\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "memset",
          "args": [
            "rp + 3",
            "0",
            "13"
          ],
          "line": 168
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memcpy",
          "args": [
            "rp",
            "r",
            "3"
          ],
          "line": 167
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/hci-crypto.h\"\n#include \"src/shared/hci.h\"\n#include \"src/shared/util.h\"\n#include \"monitor/bt.h\"\n#include <string.h>\n#include <config.h>\n\nbool bt_hci_crypto_ah(struct bt_hci *hci,\n\t\t\tconst uint8_t k[16], const uint8_t r[3],\n\t\t\tbt_hci_crypto_func_t callback, void *user_data)\n{\n\tuint8_t rp[16];\n\n\t/* r' = padding || r */\n\tmemcpy(rp, r, 3);\n\tmemset(rp + 3, 0, 13);\n\n\t/* ah(k, r) = e(k, r') mod 2^24 */\n\treturn le_encrypt(hci, 3, k, rp, callback, user_data);\n}"
  },
  {
    "function_name": "bt_hci_crypto_dm",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hci-crypto.c",
    "lines": "146-158",
    "snippet": "bool bt_hci_crypto_dm(struct bt_hci *hci,\n\t\t\tconst uint8_t k[16], const uint8_t r[8],\n\t\t\tbt_hci_crypto_func_t callback, void *user_data)\n{\n\tuint8_t rp[16];\n\n\t/* r' = padding || r */\n\tmemcpy(rp, r, 8);\n\tmemset(rp + 8, 0, 8);\n\n\t/* dm(k, r) = e(k, r') mod 2^16 */\n\treturn le_encrypt(hci, 8, k, rp, callback, user_data);\n}",
    "includes": [
      "#include \"src/shared/hci-crypto.h\"",
      "#include \"src/shared/hci.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"monitor/bt.h\"",
      "#include <string.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "le_encrypt",
          "args": [
            "hci",
            "8",
            "k",
            "rp",
            "callback",
            "user_data"
          ],
          "line": 157
        },
        "resolved": true,
        "details": {
          "function_name": "le_encrypt",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hci-crypto.c",
          "lines": "55-80",
          "snippet": "static bool le_encrypt(struct bt_hci *hci, uint8_t size,\n\t\t\tconst uint8_t key[16], const uint8_t plaintext[16],\n\t\t\tbt_hci_crypto_func_t callback, void *user_data)\n{\n\tstruct crypto_data *data;\n\tstruct bt_hci_cmd_le_encrypt cmd;\n\n\tif (!callback || !size || size > 16)\n\t\treturn false;\n\n\tmemcpy(cmd.key, key, 16);\n\tmemcpy(cmd.plaintext, plaintext, 16);\n\n\tdata = new0(struct crypto_data, 1);\n\tdata->size = size;\n\tdata->callback = callback;\n\tdata->user_data = user_data;\n\n\tif (!bt_hci_send(hci, BT_HCI_CMD_LE_ENCRYPT, &cmd, sizeof(cmd),\n\t\t\t\t\tle_encrypt_callback, data, free)) {\n\t\tfree(data);\n\t\treturn false;\n\t}\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/hci-crypto.h\"",
            "#include \"src/shared/hci.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"monitor/bt.h\"",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/hci-crypto.h\"\n#include \"src/shared/hci.h\"\n#include \"src/shared/util.h\"\n#include \"monitor/bt.h\"\n#include <string.h>\n#include <config.h>\n\nstatic bool le_encrypt(struct bt_hci *hci, uint8_t size,\n\t\t\tconst uint8_t key[16], const uint8_t plaintext[16],\n\t\t\tbt_hci_crypto_func_t callback, void *user_data)\n{\n\tstruct crypto_data *data;\n\tstruct bt_hci_cmd_le_encrypt cmd;\n\n\tif (!callback || !size || size > 16)\n\t\treturn false;\n\n\tmemcpy(cmd.key, key, 16);\n\tmemcpy(cmd.plaintext, plaintext, 16);\n\n\tdata = new0(struct crypto_data, 1);\n\tdata->size = size;\n\tdata->callback = callback;\n\tdata->user_data = user_data;\n\n\tif (!bt_hci_send(hci, BT_HCI_CMD_LE_ENCRYPT, &cmd, sizeof(cmd),\n\t\t\t\t\tle_encrypt_callback, data, free)) {\n\t\tfree(data);\n\t\treturn false;\n\t}\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "memset",
          "args": [
            "rp + 8",
            "0",
            "8"
          ],
          "line": 154
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memcpy",
          "args": [
            "rp",
            "r",
            "8"
          ],
          "line": 153
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/hci-crypto.h\"\n#include \"src/shared/hci.h\"\n#include \"src/shared/util.h\"\n#include \"monitor/bt.h\"\n#include <string.h>\n#include <config.h>\n\nbool bt_hci_crypto_dm(struct bt_hci *hci,\n\t\t\tconst uint8_t k[16], const uint8_t r[8],\n\t\t\tbt_hci_crypto_func_t callback, void *user_data)\n{\n\tuint8_t rp[16];\n\n\t/* r' = padding || r */\n\tmemcpy(rp, r, 8);\n\tmemset(rp + 8, 0, 8);\n\n\t/* dm(k, r) = e(k, r') mod 2^16 */\n\treturn le_encrypt(hci, 8, k, rp, callback, user_data);\n}"
  },
  {
    "function_name": "bt_hci_crypto_d1",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hci-crypto.c",
    "lines": "129-144",
    "snippet": "bool bt_hci_crypto_d1(struct bt_hci *hci,\n\t\t\tconst uint8_t k[16], uint16_t d, uint16_t r,\n\t\t\tbt_hci_crypto_func_t callback, void *user_data)\n{\n\tuint8_t dp[16];\n\n\t/* d' = padding || r || d */\n\tdp[0] = d & 0xff;\n\tdp[1] = d >> 8;\n\tdp[2] = r & 0xff;\n\tdp[3] = r >> 8;\n\tmemset(dp + 4, 0, 12);\n\n\t/* d1(k, d, r) = e(k, d') */\n\treturn le_encrypt(hci, 16, k, dp, callback, user_data);\n}",
    "includes": [
      "#include \"src/shared/hci-crypto.h\"",
      "#include \"src/shared/hci.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"monitor/bt.h\"",
      "#include <string.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "le_encrypt",
          "args": [
            "hci",
            "16",
            "k",
            "dp",
            "callback",
            "user_data"
          ],
          "line": 143
        },
        "resolved": true,
        "details": {
          "function_name": "le_encrypt",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hci-crypto.c",
          "lines": "55-80",
          "snippet": "static bool le_encrypt(struct bt_hci *hci, uint8_t size,\n\t\t\tconst uint8_t key[16], const uint8_t plaintext[16],\n\t\t\tbt_hci_crypto_func_t callback, void *user_data)\n{\n\tstruct crypto_data *data;\n\tstruct bt_hci_cmd_le_encrypt cmd;\n\n\tif (!callback || !size || size > 16)\n\t\treturn false;\n\n\tmemcpy(cmd.key, key, 16);\n\tmemcpy(cmd.plaintext, plaintext, 16);\n\n\tdata = new0(struct crypto_data, 1);\n\tdata->size = size;\n\tdata->callback = callback;\n\tdata->user_data = user_data;\n\n\tif (!bt_hci_send(hci, BT_HCI_CMD_LE_ENCRYPT, &cmd, sizeof(cmd),\n\t\t\t\t\tle_encrypt_callback, data, free)) {\n\t\tfree(data);\n\t\treturn false;\n\t}\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/hci-crypto.h\"",
            "#include \"src/shared/hci.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"monitor/bt.h\"",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/hci-crypto.h\"\n#include \"src/shared/hci.h\"\n#include \"src/shared/util.h\"\n#include \"monitor/bt.h\"\n#include <string.h>\n#include <config.h>\n\nstatic bool le_encrypt(struct bt_hci *hci, uint8_t size,\n\t\t\tconst uint8_t key[16], const uint8_t plaintext[16],\n\t\t\tbt_hci_crypto_func_t callback, void *user_data)\n{\n\tstruct crypto_data *data;\n\tstruct bt_hci_cmd_le_encrypt cmd;\n\n\tif (!callback || !size || size > 16)\n\t\treturn false;\n\n\tmemcpy(cmd.key, key, 16);\n\tmemcpy(cmd.plaintext, plaintext, 16);\n\n\tdata = new0(struct crypto_data, 1);\n\tdata->size = size;\n\tdata->callback = callback;\n\tdata->user_data = user_data;\n\n\tif (!bt_hci_send(hci, BT_HCI_CMD_LE_ENCRYPT, &cmd, sizeof(cmd),\n\t\t\t\t\tle_encrypt_callback, data, free)) {\n\t\tfree(data);\n\t\treturn false;\n\t}\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "memset",
          "args": [
            "dp + 4",
            "0",
            "12"
          ],
          "line": 140
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/hci-crypto.h\"\n#include \"src/shared/hci.h\"\n#include \"src/shared/util.h\"\n#include \"monitor/bt.h\"\n#include <string.h>\n#include <config.h>\n\nbool bt_hci_crypto_d1(struct bt_hci *hci,\n\t\t\tconst uint8_t k[16], uint16_t d, uint16_t r,\n\t\t\tbt_hci_crypto_func_t callback, void *user_data)\n{\n\tuint8_t dp[16];\n\n\t/* d' = padding || r || d */\n\tdp[0] = d & 0xff;\n\tdp[1] = d >> 8;\n\tdp[2] = r & 0xff;\n\tdp[3] = r >> 8;\n\tmemset(dp + 4, 0, 12);\n\n\t/* d1(k, d, r) = e(k, d') */\n\treturn le_encrypt(hci, 16, k, dp, callback, user_data);\n}"
  },
  {
    "function_name": "bt_hci_crypto_e",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hci-crypto.c",
    "lines": "122-127",
    "snippet": "bool bt_hci_crypto_e(struct bt_hci *hci,\n\t\t\tconst uint8_t key[16], const uint8_t plaintext[16],\n\t\t\tbt_hci_crypto_func_t callback, void *user_data)\n{\n\treturn le_encrypt(hci, 16, key, plaintext, callback, user_data);\n}",
    "includes": [
      "#include \"src/shared/hci-crypto.h\"",
      "#include \"src/shared/hci.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"monitor/bt.h\"",
      "#include <string.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "le_encrypt",
          "args": [
            "hci",
            "16",
            "key",
            "plaintext",
            "callback",
            "user_data"
          ],
          "line": 126
        },
        "resolved": true,
        "details": {
          "function_name": "le_encrypt",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hci-crypto.c",
          "lines": "55-80",
          "snippet": "static bool le_encrypt(struct bt_hci *hci, uint8_t size,\n\t\t\tconst uint8_t key[16], const uint8_t plaintext[16],\n\t\t\tbt_hci_crypto_func_t callback, void *user_data)\n{\n\tstruct crypto_data *data;\n\tstruct bt_hci_cmd_le_encrypt cmd;\n\n\tif (!callback || !size || size > 16)\n\t\treturn false;\n\n\tmemcpy(cmd.key, key, 16);\n\tmemcpy(cmd.plaintext, plaintext, 16);\n\n\tdata = new0(struct crypto_data, 1);\n\tdata->size = size;\n\tdata->callback = callback;\n\tdata->user_data = user_data;\n\n\tif (!bt_hci_send(hci, BT_HCI_CMD_LE_ENCRYPT, &cmd, sizeof(cmd),\n\t\t\t\t\tle_encrypt_callback, data, free)) {\n\t\tfree(data);\n\t\treturn false;\n\t}\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/hci-crypto.h\"",
            "#include \"src/shared/hci.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"monitor/bt.h\"",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/hci-crypto.h\"\n#include \"src/shared/hci.h\"\n#include \"src/shared/util.h\"\n#include \"monitor/bt.h\"\n#include <string.h>\n#include <config.h>\n\nstatic bool le_encrypt(struct bt_hci *hci, uint8_t size,\n\t\t\tconst uint8_t key[16], const uint8_t plaintext[16],\n\t\t\tbt_hci_crypto_func_t callback, void *user_data)\n{\n\tstruct crypto_data *data;\n\tstruct bt_hci_cmd_le_encrypt cmd;\n\n\tif (!callback || !size || size > 16)\n\t\treturn false;\n\n\tmemcpy(cmd.key, key, 16);\n\tmemcpy(cmd.plaintext, plaintext, 16);\n\n\tdata = new0(struct crypto_data, 1);\n\tdata->size = size;\n\tdata->callback = callback;\n\tdata->user_data = user_data;\n\n\tif (!bt_hci_send(hci, BT_HCI_CMD_LE_ENCRYPT, &cmd, sizeof(cmd),\n\t\t\t\t\tle_encrypt_callback, data, free)) {\n\t\tfree(data);\n\t\treturn false;\n\t}\n\n\treturn true;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/hci-crypto.h\"\n#include \"src/shared/hci.h\"\n#include \"src/shared/util.h\"\n#include \"monitor/bt.h\"\n#include <string.h>\n#include <config.h>\n\nbool bt_hci_crypto_e(struct bt_hci *hci,\n\t\t\tconst uint8_t key[16], const uint8_t plaintext[16],\n\t\t\tbt_hci_crypto_func_t callback, void *user_data)\n{\n\treturn le_encrypt(hci, 16, key, plaintext, callback, user_data);\n}"
  },
  {
    "function_name": "bt_hci_crypto_prand",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hci-crypto.c",
    "lines": "101-120",
    "snippet": "bool bt_hci_crypto_prand(struct bt_hci *hci,\n\t\t\tbt_hci_crypto_func_t callback, void *user_data)\n{\n\tstruct crypto_data *data;\n\n\tif (!callback)\n\t\treturn false;\n\n\tdata = new0(struct crypto_data, 1);\n\tdata->callback = callback;\n\tdata->user_data = user_data;\n\n\tif (!bt_hci_send(hci, BT_HCI_CMD_LE_RAND, NULL, 0,\n\t\t\t\t\tprand_callback, data, free)) {\n\t\tfree(data);\n\t\treturn false;\n\t}\n\n\treturn true;\n}",
    "includes": [
      "#include \"src/shared/hci-crypto.h\"",
      "#include \"src/shared/hci.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"monitor/bt.h\"",
      "#include <string.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "data"
          ],
          "line": 115
        },
        "resolved": true,
        "details": {
          "function_name": "bt_att_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/att.c",
          "lines": "956-985",
          "snippet": "static void bt_att_free(struct bt_att *att)\n{\n\tif (att->pending_req)\n\t\tdestroy_att_send_op(att->pending_req);\n\n\tif (att->pending_ind)\n\t\tdestroy_att_send_op(att->pending_ind);\n\n\tio_destroy(att->io);\n\tbt_crypto_unref(att->crypto);\n\n\tqueue_destroy(att->req_queue, NULL);\n\tqueue_destroy(att->ind_queue, NULL);\n\tqueue_destroy(att->write_queue, NULL);\n\tqueue_destroy(att->notify_list, NULL);\n\tqueue_destroy(att->disconn_list, NULL);\n\n\tif (att->timeout_destroy)\n\t\tatt->timeout_destroy(att->timeout_data);\n\n\tif (att->debug_destroy)\n\t\tatt->debug_destroy(att->debug_data);\n\n\tfree(att->local_sign);\n\tfree(att->remote_sign);\n\n\tfree(att->buf);\n\n\tfree(att);\n}",
          "includes": [
            "#include \"src/shared/crypto.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/l2cap.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/crypto.h\"\n#include \"src/shared/att.h\"\n#include \"lib/uuid.h\"\n#include \"lib/l2cap.h\"\n#include \"lib/bluetooth.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include <errno.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <config.h>\n\nstatic void bt_att_free(struct bt_att *att)\n{\n\tif (att->pending_req)\n\t\tdestroy_att_send_op(att->pending_req);\n\n\tif (att->pending_ind)\n\t\tdestroy_att_send_op(att->pending_ind);\n\n\tio_destroy(att->io);\n\tbt_crypto_unref(att->crypto);\n\n\tqueue_destroy(att->req_queue, NULL);\n\tqueue_destroy(att->ind_queue, NULL);\n\tqueue_destroy(att->write_queue, NULL);\n\tqueue_destroy(att->notify_list, NULL);\n\tqueue_destroy(att->disconn_list, NULL);\n\n\tif (att->timeout_destroy)\n\t\tatt->timeout_destroy(att->timeout_data);\n\n\tif (att->debug_destroy)\n\t\tatt->debug_destroy(att->debug_data);\n\n\tfree(att->local_sign);\n\tfree(att->remote_sign);\n\n\tfree(att->buf);\n\n\tfree(att);\n}"
        }
      },
      {
        "call_info": {
          "callee": "bt_hci_send",
          "args": [
            "hci",
            "BT_HCI_CMD_LE_RAND",
            "NULL",
            "0",
            "prand_callback",
            "data",
            "free"
          ],
          "line": 113
        },
        "resolved": true,
        "details": {
          "function_name": "bt_hci_send",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hci.c",
          "lines": "445-487",
          "snippet": "unsigned int bt_hci_send(struct bt_hci *hci, uint16_t opcode,\n\t\t\t\tconst void *data, uint8_t size,\n\t\t\t\tbt_hci_callback_func_t callback,\n\t\t\t\tvoid *user_data, bt_hci_destroy_func_t destroy)\n{\n\tstruct cmd *cmd;\n\n\tif (!hci)\n\t\treturn 0;\n\n\tcmd = new0(struct cmd, 1);\n\tcmd->opcode = opcode;\n\tcmd->size = size;\n\n\tif (cmd->size > 0) {\n\t\tcmd->data = malloc(cmd->size);\n\t\tif (!cmd->data) {\n\t\t\tfree(cmd);\n\t\t\treturn 0;\n\t\t}\n\n\t\tmemcpy(cmd->data, data, cmd->size);\n\t}\n\n\tif (hci->next_cmd_id < 1)\n\t\thci->next_cmd_id = 1;\n\n\tcmd->id = hci->next_cmd_id++;\n\n\tcmd->callback = callback;\n\tcmd->destroy = destroy;\n\tcmd->user_data = user_data;\n\n\tif (!queue_push_tail(hci->cmd_queue, cmd)) {\n\t\tfree(cmd->data);\n\t\tfree(cmd);\n\t\treturn 0;\n\t}\n\n\twakeup_writer(hci);\n\n\treturn cmd->id;\n}",
          "includes": [
            "#include \"src/shared/hci.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/mainloop.h\"",
            "#include \"monitor/bt.h\"",
            "#include <sys/uio.h>",
            "#include <sys/socket.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/hci.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/mainloop.h\"\n#include \"monitor/bt.h\"\n#include <sys/uio.h>\n#include <sys/socket.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nunsigned int bt_hci_send(struct bt_hci *hci, uint16_t opcode,\n\t\t\t\tconst void *data, uint8_t size,\n\t\t\t\tbt_hci_callback_func_t callback,\n\t\t\t\tvoid *user_data, bt_hci_destroy_func_t destroy)\n{\n\tstruct cmd *cmd;\n\n\tif (!hci)\n\t\treturn 0;\n\n\tcmd = new0(struct cmd, 1);\n\tcmd->opcode = opcode;\n\tcmd->size = size;\n\n\tif (cmd->size > 0) {\n\t\tcmd->data = malloc(cmd->size);\n\t\tif (!cmd->data) {\n\t\t\tfree(cmd);\n\t\t\treturn 0;\n\t\t}\n\n\t\tmemcpy(cmd->data, data, cmd->size);\n\t}\n\n\tif (hci->next_cmd_id < 1)\n\t\thci->next_cmd_id = 1;\n\n\tcmd->id = hci->next_cmd_id++;\n\n\tcmd->callback = callback;\n\tcmd->destroy = destroy;\n\tcmd->user_data = user_data;\n\n\tif (!queue_push_tail(hci->cmd_queue, cmd)) {\n\t\tfree(cmd->data);\n\t\tfree(cmd);\n\t\treturn 0;\n\t}\n\n\twakeup_writer(hci);\n\n\treturn cmd->id;\n}"
        }
      },
      {
        "call_info": {
          "callee": "new0",
          "args": [
            "structcrypto_data",
            "1"
          ],
          "line": 109
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/hci-crypto.h\"\n#include \"src/shared/hci.h\"\n#include \"src/shared/util.h\"\n#include \"monitor/bt.h\"\n#include <string.h>\n#include <config.h>\n\nbool bt_hci_crypto_prand(struct bt_hci *hci,\n\t\t\tbt_hci_crypto_func_t callback, void *user_data)\n{\n\tstruct crypto_data *data;\n\n\tif (!callback)\n\t\treturn false;\n\n\tdata = new0(struct crypto_data, 1);\n\tdata->callback = callback;\n\tdata->user_data = user_data;\n\n\tif (!bt_hci_send(hci, BT_HCI_CMD_LE_RAND, NULL, 0,\n\t\t\t\t\tprand_callback, data, free)) {\n\t\tfree(data);\n\t\treturn false;\n\t}\n\n\treturn true;\n}"
  },
  {
    "function_name": "prand_callback",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hci-crypto.c",
    "lines": "82-99",
    "snippet": "static void prand_callback(const void *response, uint8_t size,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct crypto_data *data = user_data;\n\tconst struct bt_hci_rsp_le_rand *rsp = response;\n\tuint8_t prand[3];\n\n\tif (rsp->status) {\n\t\tdata->callback(NULL, 0, data->user_data);\n\t\treturn;\n\t}\n\n\tprand[0] = (rsp->number & 0xff0000) >> 16;\n\tprand[1] = (rsp->number & 0x00ff00) >> 8;\n\tprand[2] = (rsp->number & 0x00003f) | 0x40;\n\n\tdata->callback(prand, 3, data->user_data);\n}",
    "includes": [
      "#include \"src/shared/hci-crypto.h\"",
      "#include \"src/shared/hci.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"monitor/bt.h\"",
      "#include <string.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "data->callback",
          "args": [
            "prand",
            "3",
            "data->user_data"
          ],
          "line": 98
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "data->callback",
          "args": [
            "NULL",
            "0",
            "data->user_data"
          ],
          "line": 90
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/hci-crypto.h\"\n#include \"src/shared/hci.h\"\n#include \"src/shared/util.h\"\n#include \"monitor/bt.h\"\n#include <string.h>\n#include <config.h>\n\nstatic void prand_callback(const void *response, uint8_t size,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct crypto_data *data = user_data;\n\tconst struct bt_hci_rsp_le_rand *rsp = response;\n\tuint8_t prand[3];\n\n\tif (rsp->status) {\n\t\tdata->callback(NULL, 0, data->user_data);\n\t\treturn;\n\t}\n\n\tprand[0] = (rsp->number & 0xff0000) >> 16;\n\tprand[1] = (rsp->number & 0x00ff00) >> 8;\n\tprand[2] = (rsp->number & 0x00003f) | 0x40;\n\n\tdata->callback(prand, 3, data->user_data);\n}"
  },
  {
    "function_name": "le_encrypt",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hci-crypto.c",
    "lines": "55-80",
    "snippet": "static bool le_encrypt(struct bt_hci *hci, uint8_t size,\n\t\t\tconst uint8_t key[16], const uint8_t plaintext[16],\n\t\t\tbt_hci_crypto_func_t callback, void *user_data)\n{\n\tstruct crypto_data *data;\n\tstruct bt_hci_cmd_le_encrypt cmd;\n\n\tif (!callback || !size || size > 16)\n\t\treturn false;\n\n\tmemcpy(cmd.key, key, 16);\n\tmemcpy(cmd.plaintext, plaintext, 16);\n\n\tdata = new0(struct crypto_data, 1);\n\tdata->size = size;\n\tdata->callback = callback;\n\tdata->user_data = user_data;\n\n\tif (!bt_hci_send(hci, BT_HCI_CMD_LE_ENCRYPT, &cmd, sizeof(cmd),\n\t\t\t\t\tle_encrypt_callback, data, free)) {\n\t\tfree(data);\n\t\treturn false;\n\t}\n\n\treturn true;\n}",
    "includes": [
      "#include \"src/shared/hci-crypto.h\"",
      "#include \"src/shared/hci.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"monitor/bt.h\"",
      "#include <string.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "data"
          ],
          "line": 75
        },
        "resolved": true,
        "details": {
          "function_name": "bt_att_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/att.c",
          "lines": "956-985",
          "snippet": "static void bt_att_free(struct bt_att *att)\n{\n\tif (att->pending_req)\n\t\tdestroy_att_send_op(att->pending_req);\n\n\tif (att->pending_ind)\n\t\tdestroy_att_send_op(att->pending_ind);\n\n\tio_destroy(att->io);\n\tbt_crypto_unref(att->crypto);\n\n\tqueue_destroy(att->req_queue, NULL);\n\tqueue_destroy(att->ind_queue, NULL);\n\tqueue_destroy(att->write_queue, NULL);\n\tqueue_destroy(att->notify_list, NULL);\n\tqueue_destroy(att->disconn_list, NULL);\n\n\tif (att->timeout_destroy)\n\t\tatt->timeout_destroy(att->timeout_data);\n\n\tif (att->debug_destroy)\n\t\tatt->debug_destroy(att->debug_data);\n\n\tfree(att->local_sign);\n\tfree(att->remote_sign);\n\n\tfree(att->buf);\n\n\tfree(att);\n}",
          "includes": [
            "#include \"src/shared/crypto.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/l2cap.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/crypto.h\"\n#include \"src/shared/att.h\"\n#include \"lib/uuid.h\"\n#include \"lib/l2cap.h\"\n#include \"lib/bluetooth.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include <errno.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <config.h>\n\nstatic void bt_att_free(struct bt_att *att)\n{\n\tif (att->pending_req)\n\t\tdestroy_att_send_op(att->pending_req);\n\n\tif (att->pending_ind)\n\t\tdestroy_att_send_op(att->pending_ind);\n\n\tio_destroy(att->io);\n\tbt_crypto_unref(att->crypto);\n\n\tqueue_destroy(att->req_queue, NULL);\n\tqueue_destroy(att->ind_queue, NULL);\n\tqueue_destroy(att->write_queue, NULL);\n\tqueue_destroy(att->notify_list, NULL);\n\tqueue_destroy(att->disconn_list, NULL);\n\n\tif (att->timeout_destroy)\n\t\tatt->timeout_destroy(att->timeout_data);\n\n\tif (att->debug_destroy)\n\t\tatt->debug_destroy(att->debug_data);\n\n\tfree(att->local_sign);\n\tfree(att->remote_sign);\n\n\tfree(att->buf);\n\n\tfree(att);\n}"
        }
      },
      {
        "call_info": {
          "callee": "bt_hci_send",
          "args": [
            "hci",
            "BT_HCI_CMD_LE_ENCRYPT",
            "&cmd",
            "sizeof(cmd)",
            "le_encrypt_callback",
            "data",
            "free"
          ],
          "line": 73
        },
        "resolved": true,
        "details": {
          "function_name": "bt_hci_send",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hci.c",
          "lines": "445-487",
          "snippet": "unsigned int bt_hci_send(struct bt_hci *hci, uint16_t opcode,\n\t\t\t\tconst void *data, uint8_t size,\n\t\t\t\tbt_hci_callback_func_t callback,\n\t\t\t\tvoid *user_data, bt_hci_destroy_func_t destroy)\n{\n\tstruct cmd *cmd;\n\n\tif (!hci)\n\t\treturn 0;\n\n\tcmd = new0(struct cmd, 1);\n\tcmd->opcode = opcode;\n\tcmd->size = size;\n\n\tif (cmd->size > 0) {\n\t\tcmd->data = malloc(cmd->size);\n\t\tif (!cmd->data) {\n\t\t\tfree(cmd);\n\t\t\treturn 0;\n\t\t}\n\n\t\tmemcpy(cmd->data, data, cmd->size);\n\t}\n\n\tif (hci->next_cmd_id < 1)\n\t\thci->next_cmd_id = 1;\n\n\tcmd->id = hci->next_cmd_id++;\n\n\tcmd->callback = callback;\n\tcmd->destroy = destroy;\n\tcmd->user_data = user_data;\n\n\tif (!queue_push_tail(hci->cmd_queue, cmd)) {\n\t\tfree(cmd->data);\n\t\tfree(cmd);\n\t\treturn 0;\n\t}\n\n\twakeup_writer(hci);\n\n\treturn cmd->id;\n}",
          "includes": [
            "#include \"src/shared/hci.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/mainloop.h\"",
            "#include \"monitor/bt.h\"",
            "#include <sys/uio.h>",
            "#include <sys/socket.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/hci.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/mainloop.h\"\n#include \"monitor/bt.h\"\n#include <sys/uio.h>\n#include <sys/socket.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nunsigned int bt_hci_send(struct bt_hci *hci, uint16_t opcode,\n\t\t\t\tconst void *data, uint8_t size,\n\t\t\t\tbt_hci_callback_func_t callback,\n\t\t\t\tvoid *user_data, bt_hci_destroy_func_t destroy)\n{\n\tstruct cmd *cmd;\n\n\tif (!hci)\n\t\treturn 0;\n\n\tcmd = new0(struct cmd, 1);\n\tcmd->opcode = opcode;\n\tcmd->size = size;\n\n\tif (cmd->size > 0) {\n\t\tcmd->data = malloc(cmd->size);\n\t\tif (!cmd->data) {\n\t\t\tfree(cmd);\n\t\t\treturn 0;\n\t\t}\n\n\t\tmemcpy(cmd->data, data, cmd->size);\n\t}\n\n\tif (hci->next_cmd_id < 1)\n\t\thci->next_cmd_id = 1;\n\n\tcmd->id = hci->next_cmd_id++;\n\n\tcmd->callback = callback;\n\tcmd->destroy = destroy;\n\tcmd->user_data = user_data;\n\n\tif (!queue_push_tail(hci->cmd_queue, cmd)) {\n\t\tfree(cmd->data);\n\t\tfree(cmd);\n\t\treturn 0;\n\t}\n\n\twakeup_writer(hci);\n\n\treturn cmd->id;\n}"
        }
      },
      {
        "call_info": {
          "callee": "new0",
          "args": [
            "structcrypto_data",
            "1"
          ],
          "line": 68
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memcpy",
          "args": [
            "cmd.plaintext",
            "plaintext",
            "16"
          ],
          "line": 66
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memcpy",
          "args": [
            "cmd.key",
            "key",
            "16"
          ],
          "line": 65
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/hci-crypto.h\"\n#include \"src/shared/hci.h\"\n#include \"src/shared/util.h\"\n#include \"monitor/bt.h\"\n#include <string.h>\n#include <config.h>\n\nstatic bool le_encrypt(struct bt_hci *hci, uint8_t size,\n\t\t\tconst uint8_t key[16], const uint8_t plaintext[16],\n\t\t\tbt_hci_crypto_func_t callback, void *user_data)\n{\n\tstruct crypto_data *data;\n\tstruct bt_hci_cmd_le_encrypt cmd;\n\n\tif (!callback || !size || size > 16)\n\t\treturn false;\n\n\tmemcpy(cmd.key, key, 16);\n\tmemcpy(cmd.plaintext, plaintext, 16);\n\n\tdata = new0(struct crypto_data, 1);\n\tdata->size = size;\n\tdata->callback = callback;\n\tdata->user_data = user_data;\n\n\tif (!bt_hci_send(hci, BT_HCI_CMD_LE_ENCRYPT, &cmd, sizeof(cmd),\n\t\t\t\t\tle_encrypt_callback, data, free)) {\n\t\tfree(data);\n\t\treturn false;\n\t}\n\n\treturn true;\n}"
  },
  {
    "function_name": "le_encrypt_callback",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hci-crypto.c",
    "lines": "41-53",
    "snippet": "static void le_encrypt_callback(const void *response, uint8_t size,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct crypto_data *data = user_data;\n\tconst struct bt_hci_rsp_le_encrypt *rsp = response;\n\n\tif (rsp->status) {\n\t\tdata->callback(NULL, 0, data->user_data);\n\t\treturn;\n\t}\n\n\tdata->callback(rsp->data, data->size, data->user_data);\n}",
    "includes": [
      "#include \"src/shared/hci-crypto.h\"",
      "#include \"src/shared/hci.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"monitor/bt.h\"",
      "#include <string.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "data->callback",
          "args": [
            "rsp->data",
            "data->size",
            "data->user_data"
          ],
          "line": 52
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "data->callback",
          "args": [
            "NULL",
            "0",
            "data->user_data"
          ],
          "line": 48
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/hci-crypto.h\"\n#include \"src/shared/hci.h\"\n#include \"src/shared/util.h\"\n#include \"monitor/bt.h\"\n#include <string.h>\n#include <config.h>\n\nstatic void le_encrypt_callback(const void *response, uint8_t size,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct crypto_data *data = user_data;\n\tconst struct bt_hci_rsp_le_encrypt *rsp = response;\n\n\tif (rsp->status) {\n\t\tdata->callback(NULL, 0, data->user_data);\n\t\treturn;\n\t}\n\n\tdata->callback(rsp->data, data->size, data->user_data);\n}"
  }
]